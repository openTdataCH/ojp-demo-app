(self.webpackChunkojp_demo_app=self.webpackChunkojp_demo_app||[]).push([[179],{235:(un,In,tt)=>{"use strict";function ze(n){return"function"==typeof n}function je(n){const e=n(i=>{Error.call(i),i.stack=(new Error).stack});return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}const Ve=je(n=>function(e){n(this),this.message=e?`${e.length} errors occurred during unsubscription:\n${e.map((i,r)=>`${r+1}) ${i.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=e});function p(n,t){if(n){const e=n.indexOf(t);0<=e&&n.splice(e,1)}}class he{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;const{_parentage:e}=this;if(e)if(this._parentage=null,Array.isArray(e))for(const s of e)s.remove(this);else e.remove(this);const{initialTeardown:i}=this;if(ze(i))try{i()}catch(s){t=s instanceof Ve?s.errors:[s]}const{_finalizers:r}=this;if(r){this._finalizers=null;for(const s of r)try{Xe(s)}catch(d){t=null!=t?t:[],d instanceof Ve?t=[...t,...d.errors]:t.push(d)}}if(t)throw new Ve(t)}}add(t){var e;if(t&&t!==this)if(this.closed)Xe(t);else{if(t instanceof he){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(e=this._finalizers)&&void 0!==e?e:[]).push(t)}}_hasParent(t){const{_parentage:e}=this;return e===t||Array.isArray(e)&&e.includes(t)}_addParent(t){const{_parentage:e}=this;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t}_removeParent(t){const{_parentage:e}=this;e===t?this._parentage=null:Array.isArray(e)&&p(e,t)}remove(t){const{_finalizers:e}=this;e&&p(e,t),t instanceof he&&t._removeParent(this)}}he.EMPTY=(()=>{const n=new he;return n.closed=!0,n})();const ft=he.EMPTY;function qe(n){return n instanceof he||n&&"closed"in n&&ze(n.remove)&&ze(n.add)&&ze(n.unsubscribe)}function Xe(n){ze(n)?n():n.unsubscribe()}const Qe={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},St={setTimeout(n,t,...e){const{delegate:i}=St;return null!=i&&i.setTimeout?i.setTimeout(n,t,...e):setTimeout(n,t,...e)},clearTimeout(n){const{delegate:t}=St;return((null==t?void 0:t.clearTimeout)||clearTimeout)(n)},delegate:void 0};function Ct(n){St.setTimeout(()=>{const{onUnhandledError:t}=Qe;if(!t)throw n;t(n)})}function Ze(){}const ut=He("C",void 0,void 0);function He(n,t,e){return{kind:n,value:t,error:e}}let Fn=null;function Rt(n){if(Qe.useDeprecatedSynchronousErrorHandling){const t=!Fn;if(t&&(Fn={errorThrown:!1,error:null}),n(),t){const{errorThrown:e,error:i}=Fn;if(Fn=null,e)throw i}}else n()}class Ie extends he{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,qe(t)&&t.add(this)):this.destination=$e}static create(t,e,i){return new Ge(t,e,i)}next(t){this.isStopped?Me(function _n(n){return He("N",n,void 0)}(t),this):this._next(t)}error(t){this.isStopped?Me(function jt(n){return He("E",void 0,n)}(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?Me(ut,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const ye=Function.prototype.bind;function ge(n,t){return ye.call(n,t)}class oe{constructor(t){this.partialObserver=t}next(t){const{partialObserver:e}=this;if(e.next)try{e.next(t)}catch(i){Be(i)}}error(t){const{partialObserver:e}=this;if(e.error)try{e.error(t)}catch(i){Be(i)}else Be(t)}complete(){const{partialObserver:t}=this;if(t.complete)try{t.complete()}catch(e){Be(e)}}}class Ge extends Ie{constructor(t,e,i){let r;if(super(),ze(t)||!t)r={next:null!=t?t:void 0,error:null!=e?e:void 0,complete:null!=i?i:void 0};else{let s;this&&Qe.useDeprecatedNextContext?(s=Object.create(t),s.unsubscribe=()=>this.unsubscribe(),r={next:t.next&&ge(t.next,s),error:t.error&&ge(t.error,s),complete:t.complete&&ge(t.complete,s)}):r=t}this.destination=new oe(r)}}function Be(n){Qe.useDeprecatedSynchronousErrorHandling?function Dn(n){Qe.useDeprecatedSynchronousErrorHandling&&Fn&&(Fn.errorThrown=!0,Fn.error=n)}(n):Ct(n)}function Me(n,t){const{onStoppedNotification:e}=Qe;e&&St.setTimeout(()=>e(n,t))}const $e={closed:!0,next:Ze,error:function K(n){throw n},complete:Ze},Se="function"==typeof Symbol&&Symbol.observable||"@@observable";function Je(n){return n}function cn(n){return 0===n.length?Je:1===n.length?n[0]:function(e){return n.reduce((i,r)=>r(i),e)}}let Mt=(()=>{class n{constructor(e){e&&(this._subscribe=e)}lift(e){const i=new n;return i.source=this,i.operator=e,i}subscribe(e,i,r){const s=function xn(n){return n&&n instanceof Ie||function vn(n){return n&&ze(n.next)&&ze(n.error)&&ze(n.complete)}(n)&&qe(n)}(e)?e:new Ge(e,i,r);return Rt(()=>{const{operator:d,source:m}=this;s.add(d?d.call(s,m):m?this._subscribe(s):this._trySubscribe(s))}),s}_trySubscribe(e){try{return this._subscribe(e)}catch(i){e.error(i)}}forEach(e,i){return new(i=xt(i))((r,s)=>{const d=new Ge({next:m=>{try{e(m)}catch(y){s(y),d.unsubscribe()}},error:s,complete:r});this.subscribe(d)})}_subscribe(e){var i;return null===(i=this.source)||void 0===i?void 0:i.subscribe(e)}[Se](){return this}pipe(...e){return cn(e)(this)}toPromise(e){return new(e=xt(e))((i,r)=>{let s;this.subscribe(d=>s=d,d=>r(d),()=>i(s))})}}return n.create=t=>new n(t),n})();function xt(n){var t;return null!==(t=null!=n?n:Qe.Promise)&&void 0!==t?t:Promise}const Rn=je(n=>function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let Wt=(()=>{class n extends Mt{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(e){const i=new Er(this,this);return i.operator=e,i}_throwIfClosed(){if(this.closed)throw new Rn}next(e){Rt(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const i of this.currentObservers)i.next(e)}})}error(e){Rt(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=e;const{observers:i}=this;for(;i.length;)i.shift().error(e)}})}complete(){Rt(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:e}=this;for(;e.length;)e.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0}_trySubscribe(e){return this._throwIfClosed(),super._trySubscribe(e)}_subscribe(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)}_innerSubscribe(e){const{hasError:i,isStopped:r,observers:s}=this;return i||r?ft:(this.currentObservers=null,s.push(e),new he(()=>{this.currentObservers=null,p(s,e)}))}_checkFinalizedStatuses(e){const{hasError:i,thrownError:r,isStopped:s}=this;i?e.error(r):s&&e.complete()}asObservable(){const e=new Mt;return e.source=this,e}}return n.create=(t,e)=>new Er(t,e),n})();class Er extends Wt{constructor(t,e){super(),this.destination=t,this.source=e}next(t){var e,i;null===(i=null===(e=this.destination)||void 0===e?void 0:e.next)||void 0===i||i.call(e,t)}error(t){var e,i;null===(i=null===(e=this.destination)||void 0===e?void 0:e.error)||void 0===i||i.call(e,t)}complete(){var t,e;null===(e=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===e||e.call(t)}_subscribe(t){var e,i;return null!==(i=null===(e=this.source)||void 0===e?void 0:e.subscribe(t))&&void 0!==i?i:ft}}function wo(n){return ze(null==n?void 0:n.lift)}function Cn(n){return t=>{if(wo(t))return t.lift(function(e){try{return n(e,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function bt(n,t,e,i,r){return new dn(n,t,e,i,r)}class dn extends Ie{constructor(t,e,i,r,s,d){super(t),this.onFinalize=s,this.shouldUnsubscribe=d,this._next=e?function(m){try{e(m)}catch(y){t.error(y)}}:super._next,this._error=r?function(m){try{r(m)}catch(y){t.error(y)}finally{this.unsubscribe()}}:super._error,this._complete=i?function(){try{i()}catch(m){t.error(m)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:e}=this;super.unsubscribe(),!e&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}}}function $t(n,t){return Cn((e,i)=>{let r=0;e.subscribe(bt(i,s=>{i.next(n.call(t,s,r++))}))})}function Co(n){return this instanceof Co?(this.v=n,this):new Co(n)}function hi(n,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=e.apply(n,t||[]),s=[];return r={},d("next"),d("throw"),d("return"),r[Symbol.asyncIterator]=function(){return this},r;function d(H){i[H]&&(r[H]=function(Z){return new Promise(function(te,xe){s.push([H,Z,te,xe])>1||m(H,Z)})})}function m(H,Z){try{!function y(H){H.value instanceof Co?Promise.resolve(H.value.v).then(T,M):R(s[0][2],H)}(i[H](Z))}catch(te){R(s[0][3],te)}}function T(H){m("next",H)}function M(H){m("throw",H)}function R(H,Z){H(Z),s.shift(),s.length&&m(s[0][0],s[0][1])}}function bs(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,t=n[Symbol.asyncIterator];return t?t.call(n):(n=function wn(n){var t="function"==typeof Symbol&&Symbol.iterator,e=t&&n[t],i=0;if(e)return e.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(n),e={},i("next"),i("throw"),i("return"),e[Symbol.asyncIterator]=function(){return this},e);function i(s){e[s]=n[s]&&function(d){return new Promise(function(m,y){!function r(s,d,m,y){Promise.resolve(y).then(function(T){s({value:T,done:m})},d)}(m,y,(d=n[s](d)).done,d.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const Re=n=>n&&"number"==typeof n.length&&"function"!=typeof n;function nt(n){return ze(null==n?void 0:n.then)}function vt(n){return ze(n[Se])}function Xt(n){return Symbol.asyncIterator&&ze(null==n?void 0:n[Symbol.asyncIterator])}function Bt(n){return new TypeError(`You provided ${null!==n&&"object"==typeof n?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const ai=function oi(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function li(n){return ze(null==n?void 0:n[ai])}function pi(n){return hi(this,arguments,function*(){const e=n.getReader();try{for(;;){const{value:i,done:r}=yield Co(e.read());if(r)return yield Co(void 0);yield yield Co(i)}}finally{e.releaseLock()}})}function Ti(n){return ze(null==n?void 0:n.getReader)}function Pt(n){if(n instanceof Mt)return n;if(null!=n){if(vt(n))return function Y(n){return new Mt(t=>{const e=n[Se]();if(ze(e.subscribe))return e.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(n);if(Re(n))return function ee(n){return new Mt(t=>{for(let e=0;e<n.length&&!t.closed;e++)t.next(n[e]);t.complete()})}(n);if(nt(n))return function De(n){return new Mt(t=>{n.then(e=>{t.closed||(t.next(e),t.complete())},e=>t.error(e)).then(null,Ct)})}(n);if(Xt(n))return Kt(n);if(li(n))return function gt(n){return new Mt(t=>{for(const e of n)if(t.next(e),t.closed)return;t.complete()})}(n);if(Ti(n))return function Zn(n){return Kt(pi(n))}(n)}throw Bt(n)}function Kt(n){return new Mt(t=>{(function br(n,t){var e,i,r,s;return function Ur(n,t,e,i){return new(e||(e=Promise))(function(s,d){function m(M){try{T(i.next(M))}catch(R){d(R)}}function y(M){try{T(i.throw(M))}catch(R){d(R)}}function T(M){M.done?s(M.value):function r(s){return s instanceof e?s:new e(function(d){d(s)})}(M.value).then(m,y)}T((i=i.apply(n,t||[])).next())})}(this,void 0,void 0,function*(){try{for(e=bs(n);!(i=yield e.next()).done;)if(t.next(i.value),t.closed)return}catch(d){r={error:d}}finally{try{i&&!i.done&&(s=e.return)&&(yield s.call(e))}finally{if(r)throw r.error}}t.complete()})})(n,t).catch(e=>t.error(e))})}function oo(n,t,e,i=0,r=!1){const s=t.schedule(function(){e(),r?n.add(this.schedule(null,i)):this.unsubscribe()},i);if(n.add(s),!r)return s}function Gn(n,t,e=1/0){return ze(t)?Gn((i,r)=>$t((s,d)=>t(i,s,r,d))(Pt(n(i,r))),e):("number"==typeof t&&(e=t),Cn((i,r)=>function Sa(n,t,e,i,r,s,d,m){const y=[];let T=0,M=0,R=!1;const H=()=>{R&&!y.length&&!T&&t.complete()},Z=xe=>T<i?te(xe):y.push(xe),te=xe=>{s&&t.next(xe),T++;let Ce=!1;Pt(e(xe,M++)).subscribe(bt(t,et=>{null==r||r(et),s?Z(et):t.next(et)},()=>{Ce=!0},void 0,()=>{if(Ce)try{for(T--;y.length&&T<i;){const et=y.shift();d?oo(t,d,()=>te(et)):te(et)}H()}catch(et){t.error(et)}}))};return n.subscribe(bt(t,Z,()=>{R=!0,H()})),()=>{null==m||m()}}(i,r,n,e)))}function Wo(n=1/0){return Gn(Je,n)}const so=new Mt(n=>n.complete());function fo(n){return n&&ze(n.schedule)}function No(n){return n[n.length-1]}function al(n){return ze(No(n))?n.pop():void 0}function ro(n){return fo(No(n))?n.pop():void 0}function ns(n,t=0){return Cn((e,i)=>{e.subscribe(bt(i,r=>oo(i,n,()=>i.next(r),t),()=>oo(i,n,()=>i.complete(),t),r=>oo(i,n,()=>i.error(r),t)))})}function Al(n,t=0){return Cn((e,i)=>{i.add(n.schedule(()=>e.subscribe(i),t))})}function qp(n,t){if(!n)throw new Error("Iterable cannot be null");return new Mt(e=>{oo(e,t,()=>{const i=n[Symbol.asyncIterator]();oo(e,t,()=>{i.next().then(r=>{r.done?e.complete():e.next(r.value)})},0,!0)})})}function mo(n,t){return t?function Gp(n,t){if(null!=n){if(vt(n))return function _t(n,t){return Pt(n).pipe(Al(t),ns(t))}(n,t);if(Re(n))return function To(n,t){return new Mt(e=>{let i=0;return t.schedule(function(){i===n.length?e.complete():(e.next(n[i++]),e.closed||this.schedule())})})}(n,t);if(nt(n))return function kl(n,t){return Pt(n).pipe(Al(t),ns(t))}(n,t);if(Xt(n))return qp(n,t);if(li(n))return function Xo(n,t){return new Mt(e=>{let i;return oo(e,t,()=>{i=n[ai](),oo(e,t,()=>{let r,s;try{({value:r,done:s}=i.next())}catch(d){return void e.error(d)}s?e.complete():e.next(r)},0,!0)}),()=>ze(null==i?void 0:i.return)&&i.return()})}(n,t);if(Ti(n))return function cl(n,t){return qp(pi(n),t)}(n,t)}throw Bt(n)}(n,t):Pt(n)}function Or(...n){const t=ro(n),e=function ll(n,t){return"number"==typeof No(n)?n.pop():t}(n,1/0),i=n;return i.length?1===i.length?Pt(i[0]):Wo(e)(mo(i,t)):so}function mn(n={}){const{connector:t=(()=>new Wt),resetOnError:e=!0,resetOnComplete:i=!0,resetOnRefCountZero:r=!0}=n;return s=>{let d,m,y,T=0,M=!1,R=!1;const H=()=>{null==m||m.unsubscribe(),m=void 0},Z=()=>{H(),d=y=void 0,M=R=!1},te=()=>{const xe=d;Z(),null==xe||xe.unsubscribe()};return Cn((xe,Ce)=>{T++,!R&&!M&&H();const et=y=null!=y?y:t();Ce.add(()=>{T--,0===T&&!R&&!M&&(m=Li(te,r))}),et.subscribe(Ce),!d&&T>0&&(d=new Ge({next:kt=>et.next(kt),error:kt=>{R=!0,H(),m=Li(Z,e,kt),et.error(kt)},complete:()=>{M=!0,H(),m=Li(Z,i),et.complete()}}),Pt(xe).subscribe(d))})(s)}}function Li(n,t,...e){if(!0===t)return void n();if(!1===t)return;const i=new Ge({next:()=>{i.unsubscribe(),n()}});return t(...e).subscribe(i)}function Bn(n){for(let t in n)if(n[t]===Bn)return t;throw Error("Could not find renamed property on target object.")}function As(n,t){for(const e in t)t.hasOwnProperty(e)&&!n.hasOwnProperty(e)&&(n[e]=t[e])}function Zi(n){if("string"==typeof n)return n;if(Array.isArray(n))return"["+n.map(Zi).join(", ")+"]";if(null==n)return""+n;if(n.overriddenName)return`${n.overriddenName}`;if(n.name)return`${n.name}`;const t=n.toString();if(null==t)return""+t;const e=t.indexOf("\n");return-1===e?t:t.substring(0,e)}function Mi(n,t){return null==n||""===n?null===t?"":t:null==t||""===t?n:n+" "+t}const aa=Bn({__forward_ref__:Bn});function $i(n){return n.__forward_ref__=$i,n.toString=function(){return Zi(this())},n}function ci(n){return Gs(n)?n():n}function Gs(n){return"function"==typeof n&&n.hasOwnProperty(aa)&&n.__forward_ref__===$i}class Nt extends Error{constructor(t,e){super(function Ta(n,t){return`NG0${Math.abs(n)}${t?": "+t.trim():""}`}(t,e)),this.code=t}}function xi(n){return"string"==typeof n?n:null==n?"":String(n)}function ic(n,t){throw new Nt(-201,!1)}function Bo(n,t){null==n&&function Ei(n,t,e,i){throw new Error(`ASSERTION ERROR: ${n}`+(null==i?"":` [Expected=> ${e} ${i} ${t} <=Actual]`))}(t,n,null,"!=")}function tn(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function Nn(n){return{providers:n.providers||[],imports:n.imports||[]}}function yu(n){return Na(n,oc)||Na(n,xd)}function Na(n,t){return n.hasOwnProperty(t)?n[t]:null}function ul(n){return n&&(n.hasOwnProperty(Ba)||n.hasOwnProperty(xu))?n[Ba]:null}const oc=Bn({\u0275prov:Bn}),Ba=Bn({\u0275inj:Bn}),xd=Bn({ngInjectableDef:Bn}),xu=Bn({ngInjectorDef:Bn});var ri=(()=>((ri=ri||{})[ri.Default=0]="Default",ri[ri.Host=1]="Host",ri[ri.Self=2]="Self",ri[ri.SkipSelf=4]="SkipSelf",ri[ri.Optional=8]="Optional",ri))();let Mh;function Xs(n){const t=Mh;return Mh=n,t}function kh(n,t,e){const i=yu(n);return i&&"root"==i.providedIn?void 0===i.value?i.value=i.factory():i.value:e&ri.Optional?null:void 0!==t?t:void ic(Zi(n))}function Bi(n){return{toString:n}.toString()}var za=(()=>((za=za||{})[za.OnPush=0]="OnPush",za[za.Default=1]="Default",za))(),ca=(()=>{return(n=ca||(ca={}))[n.Emulated=0]="Emulated",n[n.None=2]="None",n[n.ShadowDom=3]="ShadowDom",ca;var n})();const qr=(()=>"undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof global&&global||"undefined"!=typeof window&&window||"undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self)(),Rl={},Ji=[],Ea=Bn({\u0275cmp:Bn}),Pl=Bn({\u0275dir:Bn}),wu=Bn({\u0275pipe:Bn}),Yp=Bn({\u0275mod:Bn}),ua=Bn({\u0275fac:Bn}),Vc=Bn({__NG_ELEMENT_ID__:Bn});let Kp=0;function On(n){return Bi(()=>{const e=!0===n.standalone,i={},r={type:n.type,providersResolver:null,decls:n.decls,vars:n.vars,factory:null,template:n.template||null,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:i,inputs:null,outputs:null,exportAs:n.exportAs||null,onPush:n.changeDetection===za.OnPush,directiveDefs:null,pipeDefs:null,standalone:e,dependencies:e&&n.dependencies||null,getStandaloneInjector:null,selectors:n.selectors||Ji,viewQuery:n.viewQuery||null,features:n.features||null,data:n.data||{},encapsulation:n.encapsulation||ca.Emulated,id:"c"+Kp++,styles:n.styles||Ji,_:null,setInput:null,schemas:n.schemas||null,tView:null},s=n.dependencies,d=n.features;return r.inputs=Oh(n.inputs,i),r.outputs=Oh(n.outputs),d&&d.forEach(m=>m(r)),r.directiveDefs=s?()=>("function"==typeof s?s():s).map(Ph).filter(qi):null,r.pipeDefs=s?()=>("function"==typeof s?s():s).map(Rs).filter(qi):null,r})}function Ph(n){return xr(n)||ks(n)}function qi(n){return null!==n}function Ln(n){return Bi(()=>({type:n.type,bootstrap:n.bootstrap||Ji,declarations:n.declarations||Ji,imports:n.imports||Ji,exports:n.exports||Ji,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null}))}function Oh(n,t){if(null==n)return Rl;const e={};for(const i in n)if(n.hasOwnProperty(i)){let r=n[i],s=r;Array.isArray(r)&&(s=r[1],r=r[0]),e[r]=i,t&&(t[r]=s)}return e}const Ft=On;function Po(n){return{type:n.type,name:n.name,factory:null,pure:!1!==n.pure,standalone:!0===n.standalone,onDestroy:n.type.prototype.ngOnDestroy||null}}function xr(n){return n[Ea]||null}function ks(n){return n[Pl]||null}function Rs(n){return n[wu]||null}function Ps(n,t){const e=n[Yp]||null;if(!e&&!0===t)throw new Error(`Type ${Zi(n)} does not have '\u0275mod' property.`);return e}function Zs(n){return Array.isArray(n)&&"object"==typeof n[1]}function Va(n){return Array.isArray(n)&&!0===n[1]}function Qp(n){return 0!=(8&n.flags)}function Fh(n){return 2==(2&n.flags)}function Md(n){return 1==(1&n.flags)}function Ys(n){return null!==n.template}function Eu(n){return 0!=(256&n[2])}function Da(n,t){return n.hasOwnProperty(ua)?n[ua]:null}class sf{constructor(t,e,i){this.previousValue=t,this.currentValue=e,this.firstChange=i}isFirstChange(){return this.firstChange}}function _r(){return Iu}function Iu(n){return n.type.prototype.ngOnChanges&&(n.setInput=Vh),zh}function zh(){const n=Ia(this),t=null==n?void 0:n.current;if(t){const e=n.previous;if(e===Rl)n.previous=t;else for(let i in t)e[i]=t[i];n.current=null,this.ngOnChanges(t)}}function Vh(n,t,e,i){const r=Ia(n)||function $m(n,t){return n[yn]=t}(n,{previous:Rl,current:null}),s=r.current||(r.current={}),d=r.previous,m=this.declaredInputs[e],y=d[m];s[m]=new sf(y&&y.currentValue,t,d===Rl),n[i]=t}_r.ngInherit=!0;const yn="__ngSimpleChanges__";function Ia(n){return n[yn]||null}function lo(n){for(;Array.isArray(n);)n=n[0];return n}function Hh(n,t){return lo(t[n])}function Ks(n,t){return lo(t[n.index])}function Fd(n,t){return n.data[t]}function lc(n,t){return n[t]}function Ls(n,t){const e=t[n];return Zs(e)?e:e[0]}function cc(n){return 64==(64&n[2])}function fl(n,t){return null==t?null:n[t]}function af(n){n[18]=0}function Bd(n,t){n[5]+=t;let e=n,i=n[3];for(;null!==i&&(1===t&&1===e[5]||-1===t&&0===e[5]);)i[5]+=t,e=i,i=i[3]}const Ii={lFrame:c(null),bindingsEnabled:!0};function qh(){return Ii.bindingsEnabled}function Ot(){return Ii.lFrame.lView}function cr(){return Ii.lFrame.tView}function Vi(n){return Ii.lFrame.contextLView=n,n[8]}function Gi(n){return Ii.lFrame.contextLView=null,n}function zo(){let n=da();for(;null!==n&&64===n.type;)n=n.parent;return n}function da(){return Ii.lFrame.currentTNode}function ml(n,t){const e=Ii.lFrame;e.currentTNode=n,e.isParent=t}function ha(){return Ii.lFrame.isParent}function Ma(){Ii.lFrame.isParent=!1}function rs(){const n=Ii.lFrame;let t=n.bindingRootIndex;return-1===t&&(t=n.bindingRootIndex=n.tView.bindingStartIndex),t}function sn(){return Ii.lFrame.bindingIndex++}function Ha(n){const t=Ii.lFrame,e=t.bindingIndex;return t.bindingIndex=t.bindingIndex+n,e}function cf(n,t){const e=Ii.lFrame;e.bindingIndex=e.bindingRootIndex=n,Xh(t)}function Xh(n){Ii.lFrame.currentDirectiveIndex=n}function uf(n){const t=Ii.lFrame.currentDirectiveIndex;return-1===t?null:n[t]}function Km(){return Ii.lFrame.currentQueryIndex}function zd(n){Ii.lFrame.currentQueryIndex=n}function df(n){const t=n[1];return 2===t.type?t.declTNode:1===t.type?n[6]:null}function Zh(n,t,e){if(e&ri.SkipSelf){let r=t,s=n;for(;!(r=r.parent,null!==r||e&ri.Host||(r=df(s),null===r||(s=s[15],10&r.type))););if(null===r)return!1;t=r,n=s}const i=Ii.lFrame=g();return i.currentTNode=t,i.lView=n,!0}function dc(n){const t=g(),e=n[1];Ii.lFrame=t,t.currentTNode=e.firstChild,t.lView=n,t.tView=e,t.contextLView=n,t.bindingIndex=e.bindingStartIndex,t.inI18n=!1}function g(){const n=Ii.lFrame,t=null===n?null:n.child;return null===t?c(n):t}function c(n){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return null!==n&&(n.child=t),t}function h(){const n=Ii.lFrame;return Ii.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}const _=h;function w(){const n=h();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function A(){return Ii.lFrame.selectedIndex}function P(n){Ii.lFrame.selectedIndex=n}function N(){const n=Ii.lFrame;return Fd(n.tView,n.selectedIndex)}function B(){Ii.lFrame.currentNamespace="svg"}function Q(){!function re(){Ii.lFrame.currentNamespace=null}()}function ce(n,t){for(let e=t.directiveStart,i=t.directiveEnd;e<i;e++){const s=n.data[e].type.prototype,{ngAfterContentInit:d,ngAfterContentChecked:m,ngAfterViewInit:y,ngAfterViewChecked:T,ngOnDestroy:M}=s;d&&(n.contentHooks||(n.contentHooks=[])).push(-e,d),m&&((n.contentHooks||(n.contentHooks=[])).push(e,m),(n.contentCheckHooks||(n.contentCheckHooks=[])).push(e,m)),y&&(n.viewHooks||(n.viewHooks=[])).push(-e,y),T&&((n.viewHooks||(n.viewHooks=[])).push(e,T),(n.viewCheckHooks||(n.viewCheckHooks=[])).push(e,T)),null!=M&&(n.destroyHooks||(n.destroyHooks=[])).push(e,M)}}function q(n,t,e){be(n,t,3,e)}function ie(n,t,e,i){(3&n[2])===e&&be(n,t,e,i)}function me(n,t){let e=n[2];(3&e)===t&&(e&=2047,e+=1,n[2]=e)}function be(n,t,e,i){const s=null!=i?i:-1,d=t.length-1;let m=0;for(let y=void 0!==i?65535&n[18]:0;y<d;y++)if("number"==typeof t[y+1]){if(m=t[y],null!=i&&m>=i)break}else t[y]<0&&(n[18]+=65536),(m<s||-1==s)&&(Le(n,e,t,y),n[18]=(4294901760&n[18])+y+2),y++}function Le(n,t,e,i){const r=e[i]<0,s=e[i+1],m=n[r?-e[i]:e[i]];if(r){if(n[2]>>11<n[18]>>16&&(3&n[2])===t){n[2]+=2048;try{s.call(m)}finally{}}}else try{s.call(m)}finally{}}class Oe{constructor(t,e,i){this.factory=t,this.resolving=!1,this.canSeeViewProviders=e,this.injectImpl=i}}function ot(n,t,e){let i=0;for(;i<e.length;){const r=e[i];if("number"==typeof r){if(0!==r)break;i++;const s=e[i++],d=e[i++],m=e[i++];n.setAttribute(t,d,m,s)}else{const s=r,d=e[++i];Ut(s)?n.setProperty(t,s,d):n.setAttribute(t,s,d),i++}}return i}function wt(n){return 3===n||4===n||6===n}function Ut(n){return 64===n.charCodeAt(0)}function At(n,t){if(null!==t&&0!==t.length)if(null===n||0===n.length)n=t.slice();else{let e=-1;for(let i=0;i<t.length;i++){const r=t[i];"number"==typeof r?e=r:0===e||qt(n,e,r,null,-1===e||2===e?t[++i]:null)}}return n}function qt(n,t,e,i,r){let s=0,d=n.length;if(-1===t)d=-1;else for(;s<n.length;){const m=n[s++];if("number"==typeof m){if(m===t){d=-1;break}if(m>t){d=s-1;break}}}for(;s<n.length;){const m=n[s];if("number"==typeof m)break;if(m===e){if(null===i)return void(null!==r&&(n[s+1]=r));if(i===n[s+1])return void(n[s+2]=r)}s++,null!==i&&s++,null!==r&&s++}-1!==d&&(n.splice(d,0,t),s=d+1),n.splice(s++,0,e),null!==i&&n.splice(s++,0,i),null!==r&&n.splice(s++,0,r)}function Un(n){return-1!==n}function ti(n){return 32767&n}function Hn(n,t){let e=function An(n){return n>>16}(n),i=t;for(;e>0;)i=i[15],e--;return i}let Ai=!0;function wi(n){const t=Ai;return Ai=n,t}let Dr=0;const ji={};function _o(n,t){const e=Aa(n,t);if(-1!==e)return e;const i=t[1];i.firstCreatePass&&(n.injectorIndex=t.length,Js(i.data,n),Js(t,null),Js(i.blueprint,null));const r=Fr(n,t),s=n.injectorIndex;if(Un(r)){const d=ti(r),m=Hn(r,t),y=m[1].data;for(let T=0;T<8;T++)t[s+T]=m[d+T]|y[d+T]}return t[s+8]=r,s}function Js(n,t){n.push(0,0,0,0,0,0,0,0,t)}function Aa(n,t){return-1===n.injectorIndex||n.parent&&n.parent.injectorIndex===n.injectorIndex||null===t[n.injectorIndex+8]?-1:n.injectorIndex}function Fr(n,t){if(n.parent&&-1!==n.parent.injectorIndex)return n.parent.injectorIndex;let e=0,i=null,r=t;for(;null!==r;){if(i=Uv(r),null===i)return-1;if(e++,r=r[15],-1!==i.injectorIndex)return i.injectorIndex|e<<16}return-1}function pr(n,t,e){!function xs(n,t,e){let i;"string"==typeof e?i=e.charCodeAt(0)||0:e.hasOwnProperty(Vc)&&(i=e[Vc]),null==i&&(i=e[Vc]=Dr++);const r=255&i;t.data[n+(r>>5)]|=1<<r}(n,t,e)}function yo(n,t,e){if(e&ri.Optional||void 0!==n)return n;ic()}function ws(n,t,e,i){if(e&ri.Optional&&void 0===i&&(i=null),0==(e&(ri.Self|ri.Host))){const r=n[9],s=Xs(void 0);try{return r?r.get(t,i,e&ri.Optional):kh(t,i,e&ri.Optional)}finally{Xs(s)}}return yo(i,0,e)}function Hr(n,t,e,i=ri.Default,r){if(null!==n){if(1024&t[2]){const d=function jv(n,t,e,i,r){let s=n,d=t;for(;null!==s&&null!==d&&1024&d[2]&&!(256&d[2]);){const m=Fs(s,d,e,i|ri.Self,ji);if(m!==ji)return m;let y=s.parent;if(!y){const T=d[21];if(T){const M=T.get(e,ji,i);if(M!==ji)return M}y=Uv(d),d=d[15]}s=y}return r}(n,t,e,i,ji);if(d!==ji)return d}const s=Fs(n,t,e,i,ji);if(s!==ji)return s}return ws(t,e,i,r)}function Fs(n,t,e,i,r){const s=function Bl(n){if("string"==typeof n)return n.charCodeAt(0)||0;const t=n.hasOwnProperty(Vc)?n[Vc]:void 0;return"number"==typeof t?t>=0?255&t:Vd:t}(e);if("function"==typeof s){if(!Zh(t,n,i))return i&ri.Host?yo(r,0,i):ws(t,e,i,r);try{const d=s(i);if(null!=d||i&ri.Optional)return d;ic()}finally{_()}}else if("number"==typeof s){let d=null,m=Aa(n,t),y=-1,T=i&ri.Host?t[16][6]:null;for((-1===m||i&ri.SkipSelf)&&(y=-1===m?Fr(n,t):t[m+8],-1!==y&&hc(i,!1)?(d=t[1],m=ti(y),t=Hn(y,t)):m=-1);-1!==m;){const M=t[1];if(zl(s,m,M.data)){const R=Yh(m,t,e,d,i,T);if(R!==ji)return R}y=t[m+8],-1!==y&&hc(i,t[1].data[m+8]===T)&&zl(s,m,t)?(d=M,m=ti(y),t=Hn(y,t)):m=-1}}return r}function Yh(n,t,e,i,r,s){const d=t[1],m=d.data[n+8],M=gl(m,d,e,null==i?Fh(m)&&Ai:i!=d&&0!=(3&m.type),r&ri.Host&&s===m);return null!==M?Nl(t,d,M,m):ji}function gl(n,t,e,i,r){const s=n.providerIndexes,d=t.data,m=1048575&s,y=n.directiveStart,M=s>>20,H=r?m+M:n.directiveEnd;for(let Z=i?m:m+M;Z<H;Z++){const te=d[Z];if(Z<y&&e===te||Z>=y&&te.type===e)return Z}if(r){const Z=d[y];if(Z&&Ys(Z)&&Z.type===e)return y}return null}function Nl(n,t,e,i){let r=n[e];const s=t.data;if(function Ke(n){return n instanceof Oe}(r)){const d=r;d.resolving&&function Wp(n,t){const e=t?`. Dependency path: ${t.join(" > ")} > ${n}`:"";throw new Nt(-200,`Circular dependency in DI detected for ${n}${e}`)}(function ir(n){return"function"==typeof n?n.name||n.toString():"object"==typeof n&&null!=n&&"function"==typeof n.type?n.type.name||n.type.toString():xi(n)}(s[e]));const m=wi(d.canSeeViewProviders);d.resolving=!0;const y=d.injectImpl?Xs(d.injectImpl):null;Zh(n,i,ri.Default);try{r=n[e]=d.factory(void 0,s,n,i),t.firstCreatePass&&e>=i.directiveStart&&function se(n,t,e){const{ngOnChanges:i,ngOnInit:r,ngDoCheck:s}=t.type.prototype;if(i){const d=Iu(t);(e.preOrderHooks||(e.preOrderHooks=[])).push(n,d),(e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(n,d)}r&&(e.preOrderHooks||(e.preOrderHooks=[])).push(0-n,r),s&&((e.preOrderHooks||(e.preOrderHooks=[])).push(n,s),(e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(n,s))}(e,s[e],t)}finally{null!==y&&Xs(y),wi(m),d.resolving=!1,_()}}return r}function zl(n,t,e){return!!(e[t+(n>>5)]&1<<n)}function hc(n,t){return!(n&ri.Self||n&ri.Host&&t)}class Vl{constructor(t,e){this._tNode=t,this._lView=e}get(t,e,i){return Hr(this._tNode,this._lView,t,i,e)}}function Vd(){return new Vl(zo(),Ot())}function Yi(n){return Bi(()=>{const t=n.prototype.constructor,e=t[ua]||Qm(t),i=Object.prototype;let r=Object.getPrototypeOf(n.prototype).constructor;for(;r&&r!==i;){const s=r[ua]||Qm(r);if(s&&s!==e)return s;r=Object.getPrototypeOf(r)}return s=>new s})}function Qm(n){return Gs(n)?()=>{const t=Qm(ci(n));return t&&t()}:Da(n)}function Uv(n){const t=n[1],e=t.type;return 2===e?t.declTNode:1===e?n[6]:null}function os(n){return function or(n,t){if("class"===t)return n.classes;if("style"===t)return n.styles;const e=n.attrs;if(e){const i=e.length;let r=0;for(;r<i;){const s=e[r];if(wt(s))break;if(0===s)r+=2;else if("number"==typeof s)for(r++;r<i&&"string"==typeof e[r];)r++;else{if(s===t)return e[r+1];r+=2}}}return null}(zo(),n)}const jd="__parameters__";function Zc(n,t,e){return Bi(()=>{const i=function jl(n){return function(...e){if(n){const i=n(...e);for(const r in i)this[r]=i[r]}}}(t);function r(...s){if(this instanceof r)return i.apply(this,s),this;const d=new r(...s);return m.annotation=d,m;function m(y,T,M){const R=y.hasOwnProperty(jd)?y[jd]:Object.defineProperty(y,jd,{value:[]})[jd];for(;R.length<=M;)R.push(null);return(R[M]=R[M]||[]).push(d),y}}return e&&(r.prototype=Object.create(e.prototype)),r.prototype.ngMetadataName=n,r.annotationCls=r,r})}class Dt{constructor(t,e){this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof e?this.__NG_ELEMENT_ID__=e:void 0!==e&&(this.\u0275prov=tn({token:this,providedIn:e.providedIn||"root",factory:e.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function ka(n,t){void 0===t&&(t=n);for(let e=0;e<n.length;e++){let i=n[e];Array.isArray(i)?(t===n&&(t=n.slice(0,e)),ka(i,t)):t!==n&&t.push(i)}return t}function as(n,t){n.forEach(e=>Array.isArray(e)?as(e,t):t(e))}function Gv(n,t,e){t>=n.length?n.push(e):n.splice(t,0,e)}function eg(n,t){return t>=n.length-1?n.pop():n.splice(t,1)[0]}function to(n,t){const e=[];for(let i=0;i<n;i++)e.push(t);return e}function Do(n,t,e){let i=_l(n,t);return i>=0?n[1|i]=e:(i=~i,function tg(n,t,e,i){let r=n.length;if(r==t)n.push(e,i);else if(1===r)n.push(i,n[0]),n[0]=e;else{for(r--,n.push(n[r-1],n[r]);r>t;)n[r]=n[r-2],r--;n[t]=e,n[t+1]=i}}(n,i,t,e)),i}function mf(n,t){const e=_l(n,t);if(e>=0)return n[1|e]}function _l(n,t){return function Fu(n,t,e){let i=0,r=n.length>>e;for(;r!==i;){const s=i+(r-i>>1),d=n[s<<e];if(t===d)return s<<e;d>t?r=s:i=s+1}return~(r<<e)}(n,t,1)}const qa={},bf="__NG_DI_FLAG__",_f="ngTempTokenPath",vf=/\n/gm,Qh="__source";let Zo;function Ns(n){const t=Zo;return Zo=n,t}function y_(n,t=ri.Default){if(void 0===Zo)throw new Nt(-203,!1);return null===Zo?kh(n,void 0,t):Zo.get(n,t&ri.Optional?null:void 0,t)}function Ue(n,t=ri.Default){return(function Ah(){return Mh}()||y_)(ci(n),t)}function Wr(n,t=ri.Default){return"number"!=typeof t&&(t=0|(t.optional&&8)|(t.host&&1)|(t.self&&2)|(t.skipSelf&&4)),Ue(n,t)}function Wa(n){const t=[];for(let e=0;e<n.length;e++){const i=ci(n[e]);if(Array.isArray(i)){if(0===i.length)throw new Nt(900,!1);let r,s=ri.Default;for(let d=0;d<i.length;d++){const m=i[d],y=HS(m);"number"==typeof y?-1===y?r=m.token:s|=y:r=m}t.push(Ue(r,s))}else t.push(Ue(i))}return t}function xf(n,t){return n[bf]=t,n.prototype[bf]=t,n}function HS(n){return n[bf]}const Jh=xf(Zc("Optional"),8),ep=xf(Zc("SkipSelf"),4);var fa=(()=>((fa=fa||{})[fa.Important=1]="Important",fa[fa.DashCase=2]="DashCase",fa))();const mc=new Map;let Ir=0;const pg="__ngContext__";function Vo(n,t){Zs(t)?(n[pg]=t[20],function gc(n){mc.set(n[20],n)}(t)):n[pg]=t}function bg(n,t){return undefined(n,t)}function Xd(n){const t=n[3];return Va(t)?t[3]:t}function _g(n){return Vu(n[13])}function yg(n){return Vu(n[4])}function Vu(n){for(;null!==n&&!Va(n);)n=n[4];return n}function tp(n,t,e,i,r){if(null!=i){let s,d=!1;Va(i)?s=i:Zs(i)&&(d=!0,i=i[0]);const m=lo(i);0===n&&null!==e?null==r?u0(t,e,m):eu(t,e,m,r||null,!0):1===n&&null!==e?eu(t,e,m,r||null,!0):2===n?function Pf(n,t,e){const i=Zd(n,t);i&&function n1(n,t,e,i){n.removeChild(t,e,i)}(n,i,t,e)}(t,m,d):3===n&&t.destroyNode(m),null!=s&&function Tg(n,t,e,i,r){const s=e[7];s!==lo(e)&&tp(t,n,i,s,r);for(let m=10;m<e.length;m++){const y=e[m];bc(y[1],y,n,t,i,s)}}(t,n,s,e,r)}}function vg(n,t,e){return n.createElement(t,e)}function l0(n,t){const e=n[9],i=e.indexOf(t),r=t[3];512&t[2]&&(t[2]&=-513,Bd(r,-1)),e.splice(i,1)}function xg(n,t){if(n.length<=10)return;const e=10+t,i=n[e];if(i){const r=i[17];null!==r&&r!==n&&l0(r,i),t>0&&(n[e-1][4]=i[4]);const s=eg(n,10+t);!function QS(n,t){bc(n,t,t[11],2,null,null),t[0]=null,t[6]=null}(i[1],i);const d=s[19];null!==d&&d.detachView(s[1]),i[3]=null,i[4]=null,i[2]&=-65}return i}function L_(n,t){if(!(128&t[2])){const e=t[11];e.destroyNode&&bc(n,t,e,3,null,null),function e1(n){let t=n[13];if(!t)return wg(n[1],n);for(;t;){let e=null;if(Zs(t))e=t[13];else{const i=t[10];i&&(e=i)}if(!e){for(;t&&!t[4]&&t!==n;)Zs(t)&&wg(t[1],t),t=t[3];null===t&&(t=n),Zs(t)&&wg(t[1],t),e=t&&t[4]}t=e}}(t)}}function wg(n,t){if(!(128&t[2])){t[2]&=-65,t[2]|=128,function Jc(n,t){let e;if(null!=n&&null!=(e=n.destroyHooks))for(let i=0;i<e.length;i+=2){const r=t[e[i]];if(!(r instanceof Oe)){const s=e[i+1];if(Array.isArray(s))for(let d=0;d<s.length;d+=2){const m=r[s[d]],y=s[d+1];try{y.call(m)}finally{}}else try{s.call(r)}finally{}}}}(n,t),function F_(n,t){const e=n.cleanup,i=t[7];let r=-1;if(null!==e)for(let s=0;s<e.length-1;s+=2)if("string"==typeof e[s]){const d=e[s+1],m="function"==typeof d?d(t):lo(t[d]),y=i[r=e[s+2]],T=e[s+3];"boolean"==typeof T?m.removeEventListener(e[s],y,T):T>=0?i[r=T]():i[r=-T].unsubscribe(),s+=2}else{const d=i[r=e[s+1]];e[s].call(d)}if(null!==i){for(let s=r+1;s<i.length;s++)(0,i[s])();t[7]=null}}(n,t),1===t[1].type&&t[11].destroy();const e=t[17];if(null!==e&&Va(t[3])){e!==t[3]&&l0(e,t);const i=t[19];null!==i&&i.detachView(n)}!function Hl(n){mc.delete(n[20])}(t)}}function ma(n,t,e){return function c0(n,t,e){let i=t;for(;null!==i&&40&i.type;)i=(t=i).parent;if(null===i)return e[0];if(2&i.flags){const r=n.data[i.directiveStart].encapsulation;if(r===ca.None||r===ca.Emulated)return null}return Ks(i,e)}(n,t.parent,e)}function eu(n,t,e,i,r){n.insertBefore(t,e,i,r)}function u0(n,t,e){n.appendChild(t,e)}function d0(n,t,e,i,r){null!==i?eu(n,t,e,i,r):u0(n,t,e)}function Zd(n,t){return n.parentNode(t)}function Uu(n,t,e){return f0(n,t,e)}let Hu,U_,f0=function np(n,t,e){return 40&n.type?Ks(n,e):null};function Sg(n,t,e,i){const r=ma(n,i,t),s=t[11],m=Uu(i.parent||t[6],i,t);if(null!=r)if(Array.isArray(e))for(let y=0;y<e.length;y++)d0(s,r,e[y],m,!1);else d0(s,r,e,m,!1)}function Cg(n,t){if(null!==t){const e=t.type;if(3&e)return Ks(t,n);if(4&e)return B_(-1,n[t.index]);if(8&e){const i=t.child;if(null!==i)return Cg(n,i);{const r=n[t.index];return Va(r)?B_(-1,r):lo(r)}}if(32&e)return bg(t,n)()||lo(n[t.index]);{const i=g0(n,t);return null!==i?Array.isArray(i)?i[0]:Cg(Xd(n[16]),i):Cg(n,t.next)}}return null}function g0(n,t){return null!==t?n[16][6].projection[t.projection]:null}function B_(n,t){const e=10+n+1;if(e<t.length){const i=t[e],r=i[1].firstChild;if(null!==r)return Cg(i,r)}return t[7]}function z_(n,t,e,i,r,s,d){for(;null!=e;){const m=i[e.index],y=e.type;if(d&&0===t&&(m&&Vo(lo(m),i),e.flags|=4),64!=(64&e.flags))if(8&y)z_(n,t,e.child,i,r,s,!1),tp(t,n,r,m,s);else if(32&y){const T=bg(e,i);let M;for(;M=T();)tp(t,n,r,M,s);tp(t,n,r,m,s)}else 16&y?vo(n,t,i,e,r,s):tp(t,n,r,m,s);e=d?e.projectionNext:e.next}}function bc(n,t,e,i,r,s){z_(e,i,n.firstChild,t,r,s,!1)}function vo(n,t,e,i,r,s){const d=e[16],y=d[6].projection[i.projection];if(Array.isArray(y))for(let T=0;T<y.length;T++)tp(t,n,r,y[T],s);else z_(n,t,y,d[3],r,s,!0)}function Of(n,t,e){n.setAttribute(t,"style",e)}function ip(n,t,e){""===e?n.removeAttribute(t,"class"):n.setAttribute(t,"class",e)}function $u(n){var t;return(null===(t=function Eg(){if(void 0===Hu&&(Hu=null,qr.trustedTypes))try{Hu=qr.trustedTypes.createPolicy("angular",{createHTML:n=>n,createScript:n=>n,createScriptURL:n=>n})}catch(n){}return Hu}())||void 0===t?void 0:t.createHTML(n))||n}class _c{constructor(t){this.changingThisBreaksApplicationSecurity=t}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}class o1 extends _c{getTypeName(){return"HTML"}}class s1 extends _c{getTypeName(){return"Style"}}class a1 extends _c{getTypeName(){return"Script"}}class l1 extends _c{getTypeName(){return"URL"}}class c1 extends _c{getTypeName(){return"ResourceURL"}}function Za(n){return n instanceof _c?n.changingThisBreaksApplicationSecurity:n}function Ya(n,t){const e=function u1(n){return n instanceof _c&&n.getTypeName()||null}(n);if(null!=e&&e!==t){if("ResourceURL"===e&&"URL"===t)return!0;throw new Error(`Required a safe ${t}, got a ${e} (see https://g.co/ng/security#xss)`)}return e===t}class w0{constructor(t){this.inertDocumentHelper=t}getInertBodyElement(t){t="<body><remove></remove>"+t;try{const e=(new window.DOMParser).parseFromString($u(t),"text/html").body;return null===e?this.inertDocumentHelper.getInertBodyElement(t):(e.removeChild(e.firstChild),e)}catch(e){return null}}}class f1{constructor(t){if(this.defaultDoc=t,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert"),null==this.inertDocument.body){const e=this.inertDocument.createElement("html");this.inertDocument.appendChild(e);const i=this.inertDocument.createElement("body");e.appendChild(i)}}getInertBodyElement(t){const e=this.inertDocument.createElement("template");if("content"in e)return e.innerHTML=$u(t),e;const i=this.inertDocument.createElement("body");return i.innerHTML=$u(t),this.defaultDoc.documentMode&&this.stripCustomNsAttrs(i),i}stripCustomNsAttrs(t){const e=t.attributes;for(let r=e.length-1;0<r;r--){const d=e.item(r).name;("xmlns:ns1"===d||0===d.indexOf("ns1:"))&&t.removeAttribute(d)}let i=t.firstChild;for(;i;)i.nodeType===Node.ELEMENT_NODE&&this.stripCustomNsAttrs(i),i=i.nextSibling}}const g1=/^(?:(?:https?|mailto|data|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi;function sp(n){return(n=String(n)).match(g1)?n:"unsafe:"+n}function vl(n){const t={};for(const e of n.split(","))t[e]=!0;return t}function qu(...n){const t={};for(const e of n)for(const i in e)e.hasOwnProperty(i)&&(t[i]=!0);return t}const S0=vl("area,br,col,hr,img,wbr"),C0=vl("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),ap=vl("rp,rt"),Rg=qu(S0,qu(C0,vl("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),qu(ap,vl("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),qu(ap,C0)),$_=vl("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),q_=qu($_,vl("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,srcset,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),vl("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),T0=vl("script,style,template");class E0{constructor(){this.sanitizedSomething=!1,this.buf=[]}sanitizeChildren(t){let e=t.firstChild,i=!0;for(;e;)if(e.nodeType===Node.ELEMENT_NODE?i=this.startElement(e):e.nodeType===Node.TEXT_NODE?this.chars(e.nodeValue):this.sanitizedSomething=!0,i&&e.firstChild)e=e.firstChild;else for(;e;){e.nodeType===Node.ELEMENT_NODE&&this.endElement(e);let r=this.checkClobberedElement(e,e.nextSibling);if(r){e=r;break}e=this.checkClobberedElement(e,e.parentNode)}return this.buf.join("")}startElement(t){const e=t.nodeName.toLowerCase();if(!Rg.hasOwnProperty(e))return this.sanitizedSomething=!0,!T0.hasOwnProperty(e);this.buf.push("<"),this.buf.push(e);const i=t.attributes;for(let r=0;r<i.length;r++){const s=i.item(r),d=s.name,m=d.toLowerCase();if(!q_.hasOwnProperty(m)){this.sanitizedSomething=!0;continue}let y=s.value;$_[m]&&(y=sp(y)),this.buf.push(" ",d,'="',I0(y),'"')}return this.buf.push(">"),!0}endElement(t){const e=t.nodeName.toLowerCase();Rg.hasOwnProperty(e)&&!S0.hasOwnProperty(e)&&(this.buf.push("</"),this.buf.push(e),this.buf.push(">"))}chars(t){this.buf.push(I0(t))}checkClobberedElement(t,e){if(e&&(t.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error(`Failed to sanitize html because the element is clobbered: ${t.outerHTML}`);return e}}const D0=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,v1=/([^\#-~ |!])/g;function I0(n){return n.replace(/&/g,"&amp;").replace(D0,function(t){return"&#"+(1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320)+65536)+";"}).replace(v1,function(t){return"&#"+t.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}let Nf;function Bf(n,t){let e=null;try{Nf=Nf||function H_(n){const t=new f1(n);return function m1(){try{return!!(new window.DOMParser).parseFromString($u(""),"text/html")}catch(n){return!1}}()?new w0(t):t}(n);let i=t?String(t):"";e=Nf.getInertBodyElement(i);let r=5,s=i;do{if(0===r)throw new Error("Failed to sanitize html because the input is unstable");r--,i=s,s=e.innerHTML,e=Nf.getInertBodyElement(i)}while(i!==s);return $u((new E0).sanitizeChildren(Pg(e)||e))}finally{if(e){const i=Pg(e)||e;for(;i.firstChild;)i.removeChild(i.firstChild)}}}function Pg(n){return"content"in n&&function ta(n){return n.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===n.nodeName}(n)?n.content:null}var fr=(()=>((fr=fr||{})[fr.NONE=0]="NONE",fr[fr.HTML=1]="HTML",fr[fr.STYLE=2]="STYLE",fr[fr.SCRIPT=3]="SCRIPT",fr[fr.URL=4]="URL",fr[fr.RESOURCE_URL=5]="RESOURCE_URL",fr))();function yc(n){const t=function Vf(){const n=Ot();return n&&n[12]}();return t?t.sanitize(fr.URL,n)||"":Ya(n,"URL")?Za(n):sp(xi(n))}const Og=new Dt("ENVIRONMENT_INITIALIZER"),X_=new Dt("INJECTOR",-1),Z_=new Dt("INJECTOR_DEF_TYPES");class M0{get(t,e=qa){if(e===qa){const i=new Error(`NullInjectorError: No provider for ${Zi(t)}!`);throw i.name="NullInjectorError",i}return e}}function E1(...n){return{\u0275providers:A0(0,n)}}function A0(n,...t){const e=[],i=new Set;let r;return as(t,s=>{const d=s;Y_(d,e,[],i)&&(r||(r=[]),r.push(d))}),void 0!==r&&k0(r,e),e}function k0(n,t){for(let e=0;e<n.length;e++){const{providers:r}=n[e];as(r,s=>{t.push(s)})}}function Y_(n,t,e,i){if(!(n=ci(n)))return!1;let r=null,s=ul(n);const d=!s&&xr(n);if(s||d){if(d&&!d.standalone)return!1;r=n}else{const y=n.ngModule;if(s=ul(y),!s)return!1;r=y}const m=i.has(r);if(d){if(m)return!1;if(i.add(r),d.dependencies){const y="function"==typeof d.dependencies?d.dependencies():d.dependencies;for(const T of y)Y_(T,t,e,i)}}else{if(!s)return!1;{if(null!=s.imports&&!m){let T;i.add(r);try{as(s.imports,M=>{Y_(M,t,e,i)&&(T||(T=[]),T.push(M))})}finally{}void 0!==T&&k0(T,t)}if(!m){const T=Da(r)||(()=>new r);t.push({provide:r,useFactory:T,deps:Ji},{provide:Z_,useValue:r,multi:!0},{provide:Og,useValue:()=>Ue(r),multi:!0})}const y=s.providers;null==y||m||as(y,M=>{t.push(M)})}}return r!==n&&void 0!==n.providers}const I1=Bn({provide:String,useValue:Bn});function jo(n){return null!==n&&"object"==typeof n&&I1 in n}function vc(n){return"function"==typeof n}const K_=new Dt("Set Injector scope."),Fg={},jf={};let Q_;function Ng(){return void 0===Q_&&(Q_=new M0),Q_}class tu{}class J_ extends tu{constructor(t,e,i,r){super(),this.parent=e,this.source=i,this.scopes=r,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,ny(t,d=>this.processProvider(d)),this.records.set(X_,Yd(void 0,this)),r.has("environment")&&this.records.set(tu,Yd(void 0,this));const s=this.records.get(K_);null!=s&&"string"==typeof s.value&&this.scopes.add(s.value),this.injectorDefTypes=new Set(this.get(Z_.multi,Ji,ri.Self))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const t of this._ngOnDestroyHooks)t.ngOnDestroy();for(const t of this._onDestroyHooks)t()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),this._onDestroyHooks.length=0}}onDestroy(t){this._onDestroyHooks.push(t)}runInContext(t){this.assertNotDestroyed();const e=Ns(this),i=Xs(void 0);try{return t()}finally{Ns(e),Xs(i)}}get(t,e=qa,i=ri.Default){this.assertNotDestroyed();const r=Ns(this),s=Xs(void 0);try{if(!(i&ri.SkipSelf)){let m=this.records.get(t);if(void 0===m){const y=function R0(n){return"function"==typeof n||"object"==typeof n&&n instanceof Dt}(t)&&yu(t);m=y&&this.injectableDefInScope(y)?Yd(Bg(t),Fg):null,this.records.set(t,m)}if(null!=m)return this.hydrate(t,m)}return(i&ri.Self?Ng():this.parent).get(t,e=i&ri.Optional&&e===qa?null:e)}catch(d){if("NullInjectorError"===d.name){if((d[_f]=d[_f]||[]).unshift(Zi(t)),r)throw d;return function Zv(n,t,e,i){const r=n[_f];throw t[Qh]&&r.unshift(t[Qh]),n.message=function Yv(n,t,e,i=null){n=n&&"\n"===n.charAt(0)&&"\u0275"==n.charAt(1)?n.slice(2):n;let r=Zi(t);if(Array.isArray(t))r=t.map(Zi).join(" -> ");else if("object"==typeof t){let s=[];for(let d in t)if(t.hasOwnProperty(d)){let m=t[d];s.push(d+":"+("string"==typeof m?JSON.stringify(m):Zi(m)))}r=`{${s.join(", ")}}`}return`${e}${i?"("+i+")":""}[${r}]: ${n.replace(vf,"\n  ")}`}("\n"+n.message,r,e,i),n.ngTokenPath=r,n[_f]=null,n}(d,t,"R3InjectorError",this.source)}throw d}finally{Xs(s),Ns(r)}}resolveInjectorInitializers(){const t=Ns(this),e=Xs(void 0);try{const i=this.get(Og.multi,Ji,ri.Self);for(const r of i)r()}finally{Ns(t),Xs(e)}}toString(){const t=[],e=this.records;for(const i of e.keys())t.push(Zi(i));return`R3Injector[${t.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Nt(205,!1)}processProvider(t){let e=vc(t=ci(t))?t:ci(t&&t.provide);const i=function ey(n){return jo(n)?Yd(void 0,n.useValue):Yd(ty(n),Fg)}(t);if(vc(t)||!0!==t.multi)this.records.get(e);else{let r=this.records.get(e);r||(r=Yd(void 0,Fg,!0),r.factory=()=>Wa(r.multi),this.records.set(e,r)),e=t,r.multi.push(t)}this.records.set(e,i)}hydrate(t,e){return e.value===Fg&&(e.value=jf,e.value=e.factory()),"object"==typeof e.value&&e.value&&function up(n){return null!==n&&"object"==typeof n&&"function"==typeof n.ngOnDestroy}(e.value)&&this._ngOnDestroyHooks.add(e.value),e.value}injectableDefInScope(t){if(!t.providedIn)return!1;const e=ci(t.providedIn);return"string"==typeof e?"any"===e||this.scopes.has(e):this.injectorDefTypes.has(e)}}function Bg(n){const t=yu(n),e=null!==t?t.factory:Da(n);if(null!==e)return e;if(n instanceof Dt)throw new Nt(204,!1);if(n instanceof Function)return function Nr(n){const t=n.length;if(t>0)throw to(t,"?"),new Nt(204,!1);const e=function Zp(n){const t=n&&(n[oc]||n[xd]);if(t){const e=function zc(n){if(n.hasOwnProperty("name"))return n.name;const t=(""+n).match(/^function\s*([^\s(]+)/);return null===t?"":t[1]}(n);return console.warn(`DEPRECATED: DI is instantiating a token "${e}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${e}" class.`),t}return null}(n);return null!==e?()=>e.factory(n):()=>new n}(n);throw new Nt(204,!1)}function ty(n,t,e){let i;if(vc(n)){const r=ci(n);return Da(r)||Bg(r)}if(jo(n))i=()=>ci(n.useValue);else if(function Lg(n){return!(!n||!n.useFactory)}(n))i=()=>n.useFactory(...Wa(n.deps||[]));else if(function xl(n){return!(!n||!n.useExisting)}(n))i=()=>Ue(ci(n.useExisting));else{const r=ci(n&&(n.useClass||n.provide));if(!function nu(n){return!!n.deps}(n))return Da(r)||Bg(r);i=()=>new r(...Wa(n.deps))}return i}function Yd(n,t,e=!1){return{factory:n,value:t,multi:e?[]:void 0}}function M1(n){return!!n.\u0275providers}function ny(n,t){for(const e of n)Array.isArray(e)?ny(e,t):M1(e)?ny(e.\u0275providers,t):t(e)}class P0{}class R1{resolveComponentFactory(t){throw function k1(n){const t=Error(`No component factory found for ${Zi(n)}. Did you add it to @NgModule.entryComponents?`);return t.ngComponent=n,t}(t)}}let Kd=(()=>{class n{}return n.NULL=new R1,n})();function zg(){return $l(zo(),Ot())}function $l(n,t){return new zn(Ks(n,t))}let zn=(()=>{class n{constructor(e){this.nativeElement=e}}return n.__NG_ELEMENT_ID__=zg,n})();function Vg(n){return n instanceof zn?n.nativeElement:n}class Uf{}let xc=(()=>{class n{}return n.__NG_ELEMENT_ID__=()=>function P1(){const n=Ot(),e=Ls(zo().index,n);return(Zs(e)?e:n)[11]}(),n})(),F0=(()=>{class n{}return n.\u0275prov=tn({token:n,providedIn:"root",factory:()=>null}),n})();class iu{constructor(t){this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}}const ga=new iu("14.3.0"),Hf={};function Ug(n){return n.ngOriginalError}class wl{constructor(){this._console=console}handleError(t){const e=this._findOriginalError(t);this._console.error("ERROR",t),e&&this._console.error("ORIGINAL ERROR",e)}_findOriginalError(t){let e=t&&Ug(t);for(;e&&Ug(e);)e=Ug(e);return e||null}}function wc(n){return n instanceof Function?n():n}function oy(n,t,e){let i=n.length;for(;;){const r=n.indexOf(t,e);if(-1===r)return r;if(0===r||n.charCodeAt(r-1)<=32){const s=t.length;if(r+s===i||n.charCodeAt(r+s)<=32)return r}e=r+1}}const sy="ng-template";function z1(n,t,e){let i=0;for(;i<n.length;){let r=n[i++];if(e&&"class"===r){if(r=n[i],-1!==oy(r.toLowerCase(),t,0))return!0}else if(1===r){for(;i<n.length&&"string"==typeof(r=n[i++]);)if(r.toLowerCase()===t)return!0;return!1}}return!1}function V0(n){return 4===n.type&&n.value!==sy}function j0(n,t,e){return t===(4!==n.type||e?n.value:sy)}function U0(n,t,e){let i=4;const r=n.attrs||[],s=function ly(n){for(let t=0;t<n.length;t++)if(wt(n[t]))return t;return n.length}(r);let d=!1;for(let m=0;m<t.length;m++){const y=t[m];if("number"!=typeof y){if(!d)if(4&i){if(i=2|1&i,""!==y&&!j0(n,y,e)||""===y&&1===t.length){if(ba(i))return!1;d=!0}}else{const T=8&i?y:t[++m];if(8&i&&null!==n.attrs){if(!z1(n.attrs,T,e)){if(ba(i))return!1;d=!0}continue}const R=H0(8&i?"class":y,r,V0(n),e);if(-1===R){if(ba(i))return!1;d=!0;continue}if(""!==T){let H;H=R>s?"":r[R+1].toLowerCase();const Z=8&i?H:null;if(Z&&-1!==oy(Z,T,0)||2&i&&T!==H){if(ba(i))return!1;d=!0}}}}else{if(!d&&!ba(i)&&!ba(y))return!1;if(d&&ba(y))continue;d=!1,i=y|1&i}}return ba(i)||d}function ba(n){return 0==(1&n)}function H0(n,t,e,i){if(null===t)return-1;let r=0;if(i||!e){let s=!1;for(;r<t.length;){const d=t[r];if(d===n)return r;if(3===d||6===d)s=!0;else{if(1===d||2===d){let m=t[++r];for(;"string"==typeof m;)m=t[++r];continue}if(4===d)break;if(0===d){r+=4;continue}}r+=s?1:2}return-1}return function hp(n,t){let e=n.indexOf(4);if(e>-1)for(e++;e<n.length;){const i=n[e];if("number"==typeof i)return-1;if(i===t)return e;e++}return-1}(t,n)}function ay(n,t,e=!1){for(let i=0;i<t.length;i++)if(U0(n,t[i],e))return!0;return!1}function pp(n,t){e:for(let e=0;e<t.length;e++){const i=t[e];if(n.length===i.length){for(let r=0;r<n.length;r++)if(n[r]!==i[r])continue e;return!0}}return!1}function cy(n,t){return n?":not("+t.trim()+")":t}function $g(n){let t=n[0],e=1,i=2,r="",s=!1;for(;e<n.length;){let d=n[e];if("string"==typeof d)if(2&i){const m=n[++e];r+="["+d+(m.length>0?'="'+m+'"':"")+"]"}else 8&i?r+="."+d:4&i&&(r+=" "+d);else""!==r&&!ba(d)&&(t+=cy(s,r),r=""),i=d,s=s||!ba(i);e++}return""!==r&&(t+=cy(s,r)),t}const ki={};function Fe(n){q0(cr(),Ot(),A()+n,!1)}function q0(n,t,e,i){if(!i)if(3==(3&t[2])){const s=n.preOrderCheckHooks;null!==s&&q(t,s,e)}else{const s=n.preOrderHooks;null!==s&&ie(t,s,0,e)}P(e)}function Wg(n,t=null,e=null,i){const r=X0(n,t,e,i);return r.resolveInjectorInitializers(),r}function X0(n,t=null,e=null,i,r=new Set){const s=[e||Ji,E1(n)];return i=i||("object"==typeof n?void 0:Zi(n)),new J_(s,t||Ng(),i||null,r)}let Xr=(()=>{class n{static create(e,i){var r;if(Array.isArray(e))return Wg({name:""},i,e,"");{const s=null!==(r=e.name)&&void 0!==r?r:"";return Wg({name:s},e.parent,e.providers,s)}}}return n.THROW_IF_NOT_FOUND=qa,n.NULL=new M0,n.\u0275prov=tn({token:n,providedIn:"any",factory:()=>Ue(X_)}),n.__NG_ELEMENT_ID__=-1,n})();function X(n,t=ri.Default){const e=Ot();return null===e?Ue(n,t):Hr(zo(),e,ci(n),t)}function ru(){throw new Error("invalid")}function tb(n,t){return n<<17|t<<2}function Qa(n){return n>>17&32767}function hy(n){return 2|n}function Gl(n){return(131068&n)>>2}function ib(n,t){return-131069&n|t<<2}function py(n){return 1|n}function vy(n,t){const e=n.contentQueries;if(null!==e)for(let i=0;i<e.length;i+=2){const r=e[i],s=e[i+1];if(-1!==s){const d=n.data[s];zd(r),d.contentQueries(2,t[s],s)}}}function oh(n,t,e,i,r,s,d,m,y,T,M){const R=t.blueprint.slice();return R[0]=r,R[2]=76|i,(null!==M||n&&1024&n[2])&&(R[2]|=1024),af(R),R[3]=R[15]=n,R[8]=e,R[10]=d||n&&n[10],R[11]=m||n&&n[11],R[12]=y||n&&n[12]||null,R[9]=T||n&&n[9]||null,R[6]=s,R[20]=function A_(){return Ir++}(),R[21]=M,R[16]=2==t.type?n[16]:R,R}function sh(n,t,e,i,r){let s=n.data[t];if(null===s)s=function lb(n,t,e,i,r){const s=da(),d=ha(),y=n.data[t]=function Cy(n,t,e,i,r,s){return{type:e,index:i,insertBeforeIndex:null,injectorIndex:t?t.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:r,attrs:s,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,d?s:s&&s.parent,e,t,i,r);return null===n.firstChild&&(n.firstChild=y),null!==s&&(d?null==s.child&&null!==y.parent&&(s.child=y):null===s.next&&(s.next=y)),y}(n,t,e,i,r),function f_(){return Ii.lFrame.inI18n}()&&(s.flags|=64);else if(64&s.type){s.type=e,s.value=i,s.attrs=r;const d=function ku(){const n=Ii.lFrame,t=n.currentTNode;return n.isParent?t:t.parent}();s.injectorIndex=null===d?-1:d.injectorIndex}return ml(s,!0),s}function _p(n,t,e,i){if(0===e)return-1;const r=t.length;for(let s=0;s<e;s++)t.push(i),n.blueprint.push(i),n.data.push(null);return r}function cb(n,t,e){dc(t);try{const i=n.viewQuery;null!==i&&fi(1,i,e);const r=n.template;null!==r&&xy(n,t,r,1,e),n.firstCreatePass&&(n.firstCreatePass=!1),n.staticContentQueries&&vy(n,t),n.staticViewQueries&&fi(2,n.viewQuery,e);const s=n.components;null!==s&&function Zf(n,t){for(let e=0;e<t.length;e++)Lt(n,t[e])}(t,s)}catch(i){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),i}finally{t[2]&=-5,w()}}function Yf(n,t,e,i){const r=t[2];if(128!=(128&r)){dc(t);try{af(t),function uc(n){return Ii.lFrame.bindingIndex=n}(n.bindingStartIndex),null!==e&&xy(n,t,e,2,i);const d=3==(3&r);if(d){const T=n.preOrderCheckHooks;null!==T&&q(t,T,null)}else{const T=n.preOrderHooks;null!==T&&ie(t,T,0,null),me(t,0)}if(function dt(n){for(let t=_g(n);null!==t;t=yg(t)){if(!t[2])continue;const e=t[9];for(let i=0;i<e.length;i++){const r=e[i],s=r[3];0==(512&r[2])&&Bd(s,1),r[2]|=512}}}(t),function Ht(n){for(let t=_g(n);null!==t;t=yg(t))for(let e=10;e<t.length;e++){const i=t[e],r=i[1];cc(i)&&Yf(r,i,r.template,i[8])}}(t),null!==n.contentQueries&&vy(n,t),d){const T=n.contentCheckHooks;null!==T&&q(t,T)}else{const T=n.contentHooks;null!==T&&ie(t,T,1),me(t,1)}!function rh(n,t){const e=n.hostBindingOpCodes;if(null!==e)try{for(let i=0;i<e.length;i++){const r=e[i];if(r<0)P(~r);else{const s=r,d=e[++i],m=e[++i];cf(d,s),m(2,t[s])}}}finally{P(-1)}}(n,t);const m=n.components;null!==m&&function rx(n,t){for(let e=0;e<t.length;e++)It(n,t[e])}(t,m);const y=n.viewQuery;if(null!==y&&fi(2,y,i),d){const T=n.viewCheckHooks;null!==T&&q(t,T)}else{const T=n.viewHooks;null!==T&&ie(t,T,2),me(t,2)}!0===n.firstUpdatePass&&(n.firstUpdatePass=!1),t[2]&=-41,512&t[2]&&(t[2]&=-513,Bd(t[3],-1))}finally{w()}}}function xy(n,t,e,i,r){const s=A(),d=2&i;try{P(-1),d&&t.length>22&&q0(n,t,22,!1),e(i,r)}finally{P(s)}}function ox(n,t,e){if(Qp(t)){const r=t.directiveEnd;for(let s=t.directiveStart;s<r;s++){const d=n.data[s];d.contentQueries&&d.contentQueries(1,e[s],s)}}}function Kf(n,t,e){!qh()||(function k(n,t,e,i){const r=e.directiveStart,s=e.directiveEnd;n.firstCreatePass||_o(e,t),Vo(i,t);const d=e.initialInputs;for(let m=r;m<s;m++){const y=n.data[m],T=Ys(y);T&&de(t,e,y);const M=Nl(t,n,m,e);Vo(M,t),null!==d&&ke(0,m-r,M,y,0,d),T&&(Ls(e.index,t)[8]=M)}}(n,t,e,Ks(e,t)),128==(128&e.flags)&&function O(n,t,e){const i=e.directiveStart,r=e.directiveEnd,s=e.index,d=function Ym(){return Ii.lFrame.currentDirectiveIndex}();try{P(s);for(let m=i;m<r;m++){const y=n.data[m],T=t[m];Xh(m),(null!==y.hostBindings||0!==y.hostVars||null!==y.hostAttrs)&&F(y,T)}}finally{P(-1),Xh(d)}}(n,t,e))}function ub(n,t,e=Ks){const i=t.localNames;if(null!==i){let r=t.index+1;for(let s=0;s<i.length;s+=2){const d=i[s+1],m=-1===d?e(t,n):n[d];n[r++]=m}}}function wy(n){const t=n.tView;return null===t||t.incompleteFirstPass?n.tView=db(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts):t}function db(n,t,e,i,r,s,d,m,y,T){const M=22+i,R=M+r,H=function Sy(n,t){const e=[];for(let i=0;i<t;i++)e.push(i<n?null:ki);return e}(M,R),Z="function"==typeof T?T():T;return H[1]={type:n,blueprint:H,template:e,queries:null,viewQuery:m,declTNode:t,data:H.slice().fill(null,M),bindingStartIndex:M,expandoStartIndex:R,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof s?s():s,pipeRegistry:"function"==typeof d?d():d,firstChild:null,schemas:y,consts:Z,incompleteFirstPass:!1}}function yp(n,t,e,i){const r=$n(t);null===e?r.push(i):(r.push(e),n.firstCreatePass&&_i(n).push(i,r.length-1))}function Ty(n,t,e){for(let i in n)if(n.hasOwnProperty(i)){const r=n[i];(e=null===e?{}:e).hasOwnProperty(i)?e[i].push(t,r):e[i]=[t,r]}return e}function a(n,t){const i=t.directiveEnd,r=n.data,s=t.attrs,d=[];let m=null,y=null;for(let T=t.directiveStart;T<i;T++){const M=r[T],R=M.inputs,H=null===s||V0(t)?null:ct(R,s);d.push(H),m=Ty(R,T,m),y=Ty(M.outputs,T,y)}null!==m&&(m.hasOwnProperty("class")&&(t.flags|=16),m.hasOwnProperty("style")&&(t.flags|=32)),t.initialInputs=d,t.inputs=m,t.outputs=y}function l(n,t,e,i,r,s,d,m){const y=Ks(t,e);let M,T=t.inputs;!m&&null!=T&&(M=T[i])?(Qn(n,e,M,i,r),Fh(t)&&u(e,t.index)):3&t.type&&(i=function o(n){return"class"===n?"className":"for"===n?"htmlFor":"formaction"===n?"formAction":"innerHtml"===n?"innerHTML":"readonly"===n?"readOnly":"tabindex"===n?"tabIndex":n}(i),r=null!=d?d(r,t.value||"",i):r,s.setProperty(y,i,r))}function u(n,t){const e=Ls(t,n);16&e[2]||(e[2]|=32)}function S(n,t,e,i){let r=!1;if(qh()){const s=function V(n,t,e){const i=n.directiveRegistry;let r=null;if(i)for(let s=0;s<i.length;s++){const d=i[s];ay(e,d.selectors,!1)&&(r||(r=[]),pr(_o(e,t),n,d.type),Ys(d)?(U(n,e),r.unshift(d)):r.push(d))}return r}(n,t,e),d=null===i?null:{"":-1};if(null!==s){r=!0,ue(e,n.data.length,s.length);for(let M=0;M<s.length;M++){const R=s[M];R.providersResolver&&R.providersResolver(R)}let m=!1,y=!1,T=_p(n,t,s.length,null);for(let M=0;M<s.length;M++){const R=s[M];e.mergedAttrs=At(e.mergedAttrs,R.hostAttrs),we(n,e,t,T,R),J(T,R,d),null!==R.contentQueries&&(e.flags|=8),(null!==R.hostBindings||null!==R.hostAttrs||0!==R.hostVars)&&(e.flags|=128);const H=R.type.prototype;!m&&(H.ngOnChanges||H.ngOnInit||H.ngDoCheck)&&((n.preOrderHooks||(n.preOrderHooks=[])).push(e.index),m=!0),!y&&(H.ngOnChanges||H.ngDoCheck)&&((n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e.index),y=!0),T++}a(n,e)}d&&function G(n,t,e){if(t){const i=n.localNames=[];for(let r=0;r<t.length;r+=2){const s=e[t[r+1]];if(null==s)throw new Nt(-301,!1);i.push(t[r],s)}}}(e,i,d)}return e.mergedAttrs=At(e.mergedAttrs,e.attrs),r}function E(n,t,e,i,r,s){const d=s.hostBindings;if(d){let m=n.hostBindingOpCodes;null===m&&(m=n.hostBindingOpCodes=[]);const y=~t.index;(function D(n){let t=n.length;for(;t>0;){const e=n[--t];if("number"==typeof e&&e<0)return e}return 0})(m)!=y&&m.push(y),m.push(i,r,d)}}function F(n,t){null!==n.hostBindings&&n.hostBindings(1,t)}function U(n,t){t.flags|=2,(n.components||(n.components=[])).push(t.index)}function J(n,t,e){if(e){if(t.exportAs)for(let i=0;i<t.exportAs.length;i++)e[t.exportAs[i]]=n;Ys(t)&&(e[""]=n)}}function ue(n,t,e){n.flags|=1,n.directiveStart=t,n.directiveEnd=t+e,n.providerIndexes=t}function we(n,t,e,i,r){n.data[i]=r;const s=r.factory||(r.factory=Da(r.type)),d=new Oe(s,Ys(r),X);n.blueprint[i]=d,e[i]=d,E(n,t,0,i,_p(n,e,r.hostVars,ki),r)}function de(n,t,e){const i=Ks(t,n),r=wy(e),s=n[10],d=mt(n,oh(n,r,null,e.onPush?32:16,i,t,s,s.createRenderer(i,e),null,null,null));n[t.index]=d}function ve(n,t,e,i,r,s){const d=Ks(n,t);!function Ae(n,t,e,i,r,s,d){if(null==s)n.removeAttribute(t,r,e);else{const m=null==d?xi(s):d(s,i||"",r);n.setAttribute(t,r,m,e)}}(t[11],d,s,n.value,e,i,r)}function ke(n,t,e,i,r,s){const d=s[t];if(null!==d){const m=i.setInput;for(let y=0;y<d.length;){const T=d[y++],M=d[y++],R=d[y++];null!==m?i.setInput(e,R,T,M):e[M]=R}}}function ct(n,t){let e=null,i=0;for(;i<t.length;){const r=t[i];if(0!==r)if(5!==r){if("number"==typeof r)break;n.hasOwnProperty(r)&&(null===e&&(e=[]),e.push(r,n[r],t[i+1])),i+=2}else i+=2;else i+=4}return e}function yt(n,t,e,i){return new Array(n,!0,!1,t,null,0,i,e,null,null)}function It(n,t){const e=Ls(t,n);if(cc(e)){const i=e[1];48&e[2]?Yf(i,e,i.template,e[8]):e[5]>0&&Et(e)}}function Et(n){for(let i=_g(n);null!==i;i=yg(i))for(let r=10;r<i.length;r++){const s=i[r];if(cc(s))if(512&s[2]){const d=s[1];Yf(d,s,d.template,s[8])}else s[5]>0&&Et(s)}const e=n[1].components;if(null!==e)for(let i=0;i<e.length;i++){const r=Ls(e[i],n);cc(r)&&r[5]>0&&Et(r)}}function Lt(n,t){const e=Ls(t,n),i=e[1];(function Zt(n,t){for(let e=t.length;e<n.blueprint.length;e++)t.push(n.blueprint[e])})(i,e),cb(i,e,e[8])}function mt(n,t){return n[13]?n[14][4]=t:n[13]=t,n[14]=t,t}function an(n){for(;n;){n[2]|=32;const t=Xd(n);if(Eu(n)&&!t)return n;n=t}return null}function En(n,t,e,i=!0){const r=t[10];r.begin&&r.begin();try{Yf(n,t,n.template,e)}catch(d){throw i&&yi(t,d),d}finally{r.end&&r.end()}}function fi(n,t,e){zd(0),t(n,e)}function $n(n){return n[7]||(n[7]=[])}function _i(n){return n.cleanup||(n.cleanup=[])}function Ki(n,t,e){return(null===n||Ys(n))&&(e=function Mu(n){for(;Array.isArray(n);){if("object"==typeof n[1])return n;n=n[0]}return null}(e[t.index])),e[11]}function yi(n,t){const e=n[9],i=e?e.get(wl,null):null;i&&i.handleError(t)}function Qn(n,t,e,i,r){for(let s=0;s<e.length;){const d=e[s++],m=e[s++],y=t[d],T=n.data[d];null!==T.setInput?T.setInput(y,r,i,m):y[m]=r}}function er(n,t,e){const i=Hh(t,n);!function Rf(n,t,e){n.setValue(t,e)}(n[11],i,e)}function mi(n,t,e){let i=e?n.styles:null,r=e?n.classes:null,s=0;if(null!==t)for(let d=0;d<t.length;d++){const m=t[d];"number"==typeof m?s=m:1==s?r=Mi(r,m):2==s&&(i=Mi(i,m+": "+t[++d]+";"))}e?n.styles=i:n.stylesWithoutHost=i,e?n.classes=r:n.classesWithoutHost=r}function gi(n,t,e,i,r=!1){for(;null!==e;){const s=t[e.index];if(null!==s&&i.push(lo(s)),Va(s))for(let m=10;m<s.length;m++){const y=s[m],T=y[1].firstChild;null!==T&&gi(y[1],y,T,i)}const d=e.type;if(8&d)gi(n,t,e.child,i);else if(32&d){const m=bg(e,t);let y;for(;y=m();)i.push(y)}else if(16&d){const m=g0(t,e);if(Array.isArray(m))i.push(...m);else{const y=Xd(t[16]);gi(y[1],y,m,i,!0)}}e=r?e.projectionNext:e.next}return i}class dr{constructor(t,e){this._lView=t,this._cdRefInjectingView=e,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const t=this._lView,e=t[1];return gi(e,t,e.firstChild,[])}get context(){return this._lView[8]}set context(t){this._lView[8]=t}get destroyed(){return 128==(128&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const t=this._lView[3];if(Va(t)){const e=t[8],i=e?e.indexOf(this):-1;i>-1&&(xg(t,i),eg(e,i))}this._attachedToViewContainer=!1}L_(this._lView[1],this._lView)}onDestroy(t){yp(this._lView[1],this._lView,null,t)}markForCheck(){an(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-65}reattach(){this._lView[2]|=64}detectChanges(){En(this._lView[1],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Nt(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function s0(n,t){bc(n,t,t[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new Nt(902,!1);this._appRef=t}}class Br extends dr{constructor(t){super(t),this._view=t}detectChanges(){const t=this._view;En(t[1],t,t[8],!1)}checkNoChanges(){}get context(){return null}}class Sr extends Kd{constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){const e=xr(t);return new io(e,this.ngModule)}}function Cr(n){const t=[];for(let e in n)n.hasOwnProperty(e)&&t.push({propName:n[e],templateName:e});return t}class co{constructor(t,e){this.injector=t,this.parentInjector=e}get(t,e,i){const r=this.injector.get(t,Hf,i);return r!==Hf||e===Hf?r:this.parentInjector.get(t,e,i)}}class io extends P0{constructor(t,e){super(),this.componentDef=t,this.ngModule=e,this.componentType=t.type,this.selector=function $0(n){return n.map($g).join(",")}(t.selectors),this.ngContentSelectors=t.ngContentSelectors?t.ngContentSelectors:[],this.isBoundToModule=!!e}get inputs(){return Cr(this.componentDef.inputs)}get outputs(){return Cr(this.componentDef.outputs)}create(t,e,i,r){let s=(r=r||this.ngModule)instanceof tu?r:null==r?void 0:r.injector;s&&null!==this.componentDef.getStandaloneInjector&&(s=this.componentDef.getStandaloneInjector(s)||s);const d=s?new co(t,s):t,m=d.get(Uf,null);if(null===m)throw new Nt(407,!1);const y=d.get(F0,null),T=m.createRenderer(null,this.componentDef),M=this.componentDef.selectors[0][0]||"div",R=i?function ax(n,t,e){return n.selectRootElement(t,e===ca.ShadowDom)}(T,i,this.componentDef.encapsulation):vg(T,M,function no(n){const t=n.toLowerCase();return"svg"===t?"svg":"math"===t?"math":null}(M)),H=this.componentDef.onPush?288:272,Z=db(0,null,null,1,0,null,null,null,null,null),te=oh(null,Z,null,H,null,null,m,T,y,d,null);let xe,Ce;dc(te);try{const et=function sr(n,t,e,i,r,s){const d=e[1];e[22]=n;const y=sh(d,22,2,"#host",null),T=y.mergedAttrs=t.hostAttrs;null!==T&&(mi(y,T,!0),null!==n&&(ot(r,n,T),null!==y.classes&&ip(r,n,y.classes),null!==y.styles&&Of(r,n,y.styles)));const M=i.createRenderer(n,t),R=oh(e,wy(t),null,t.onPush?32:16,e[22],y,i,M,s||null,null,null);return d.firstCreatePass&&(pr(_o(y,e),d,t.type),U(d,y),ue(y,e.length,1)),mt(e,R),e[22]=R}(R,this.componentDef,te,m,T);if(R)if(i)ot(T,R,["ng-version",ga.full]);else{const{attrs:kt,classes:pt}=function qg(n){const t=[],e=[];let i=1,r=2;for(;i<n.length;){let s=n[i];if("string"==typeof s)2===r?""!==s&&t.push(s,n[++i]):8===r&&e.push(s);else{if(!ba(r))break;r=s}i++}return{attrs:t,classes:e}}(this.componentDef.selectors[0]);kt&&ot(T,R,kt),pt&&pt.length>0&&ip(T,R,pt.join(" "))}if(Ce=Fd(Z,22),void 0!==e){const kt=Ce.projection=[];for(let pt=0;pt<this.ngContentSelectors.length;pt++){const en=e[pt];kt.push(null!=en?Array.from(en):null)}}xe=function Mo(n,t,e,i){const r=e[1],s=function v(n,t,e){const i=zo();n.firstCreatePass&&(e.providersResolver&&e.providersResolver(e),we(n,i,t,_p(n,t,1,null),e),a(n,i));const r=Nl(t,n,i.directiveStart,i);Vo(r,t);const s=Ks(i,t);return s&&Vo(s,t),r}(r,e,t);if(n[8]=e[8]=s,null!==i)for(const m of i)m(s,t);if(t.contentQueries){const m=zo();t.contentQueries(1,s,m.directiveStart)}const d=zo();return!r.firstCreatePass||null===t.hostBindings&&null===t.hostAttrs||(P(d.index),E(e[1],d,0,d.directiveStart,d.directiveEnd,t),F(t,s)),s}(et,this.componentDef,te,[zr]),cb(Z,te,null)}finally{w()}return new Io(this.componentType,xe,$l(Ce,te),te,Ce)}}class Io extends class A1{}{constructor(t,e,i,r,s){super(),this.location=i,this._rootLView=r,this._tNode=s,this.instance=e,this.hostView=this.changeDetectorRef=new Br(r),this.componentType=t}setInput(t,e){const i=this._tNode.inputs;let r;if(null!==i&&(r=i[t])){const s=this._rootLView;Qn(s[1],s,r,t,e),u(s,this._tNode.index)}}get injector(){return new Vl(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}}function zr(){const n=zo();ce(Ot()[1],n)}function Yt(n){let t=function Bs(n){return Object.getPrototypeOf(n.prototype).constructor}(n.type),e=!0;const i=[n];for(;t;){let r;if(Ys(n))r=t.\u0275cmp||t.\u0275dir;else{if(t.\u0275cmp)throw new Nt(903,!1);r=t.\u0275dir}if(r){if(e){i.push(r);const d=n;d.inputs=Lo(n.inputs),d.declaredInputs=Lo(n.declaredInputs),d.outputs=Lo(n.outputs);const m=r.hostBindings;m&&Xl(n,m);const y=r.viewQuery,T=r.contentQueries;if(y&&na(n,y),T&&Yo(n,T),As(n.inputs,r.inputs),As(n.declaredInputs,r.declaredInputs),As(n.outputs,r.outputs),Ys(r)&&r.data.animation){const M=n.data;M.animation=(M.animation||[]).concat(r.data.animation)}}const s=r.features;if(s)for(let d=0;d<s.length;d++){const m=s[d];m&&m.ngInherit&&m(n),m===Yt&&(e=!1)}}t=Object.getPrototypeOf(t)}!function cs(n){let t=0,e=null;for(let i=n.length-1;i>=0;i--){const r=n[i];r.hostVars=t+=r.hostVars,r.hostAttrs=At(r.hostAttrs,e=At(e,r.hostAttrs))}}(i)}function Lo(n){return n===Rl?{}:n===Ji?[]:n}function na(n,t){const e=n.viewQuery;n.viewQuery=e?(i,r)=>{t(i,r),e(i,r)}:t}function Yo(n,t){const e=n.contentQueries;n.contentQueries=e?(i,r,s)=>{t(i,r,s),e(i,r,s)}:t}function Xl(n,t){const e=n.hostBindings;n.hostBindings=e?(i,r)=>{t(i,r),e(i,r)}:t}let em=null;function Qu(){if(!em){const n=qr.Symbol;if(n&&n.iterator)em=n.iterator;else{const t=Object.getOwnPropertyNames(Map.prototype);for(let e=0;e<t.length;++e){const i=t[e];"entries"!==i&&"size"!==i&&Map.prototype[i]===Map.prototype.entries&&(em=i)}}}return em}function xp(n){return!!Cl(n)&&(Array.isArray(n)||!(n instanceof Map)&&Qu()in n)}function Cl(n){return null!==n&&("function"==typeof n||"object"==typeof n)}function Ss(n,t,e){return!Object.is(n[t],e)&&(n[t]=e,!0)}function Sn(n,t,e,i){const r=Ot();return Ss(r,sn(),t)&&(cr(),ve(N(),r,n,t,e,i)),Sn}function Ic(n,t,e,i){return Ss(n,sn(),e)?t+xi(e)+i:ki}function Ju(n,t,e,i,r,s){const m=function Ra(n,t,e,i){const r=Ss(n,t,e);return Ss(n,t+1,i)||r}(n,function Qs(){return Ii.lFrame.bindingIndex}(),e,r);return Ha(2),m?t+xi(e)+i+xi(r)+s:ki}function Jt(n,t,e,i,r,s,d,m){const y=Ot(),T=cr(),M=n+22,R=T.firstCreatePass?function YN(n,t,e,i,r,s,d,m,y){const T=t.consts,M=sh(t,n,4,d||null,fl(T,m));S(t,e,M,fl(T,y)),ce(t,M);const R=M.tViews=db(2,M,i,r,s,t.directiveRegistry,t.pipeRegistry,null,t.schemas,T);return null!==t.queries&&(t.queries.template(t,M),R.queries=t.queries.embeddedTView(M)),M}(M,T,y,t,e,i,r,s,d):T.data[M];ml(R,!1);const H=y[11].createComment("");Sg(T,y,H,R),Vo(H,y),mt(y,y[M]=yt(H,y,H,R)),Md(R)&&Kf(T,y,R),null!=d&&ub(y,R,m)}function Zl(n){return lc(function Gh(){return Ii.lFrame.contextLView}(),22+n)}function rt(n,t,e){const i=Ot();return Ss(i,sn(),t)&&l(cr(),N(),i,n,t,i[11],e,!1),rt}function sC(n,t,e,i,r){const d=r?"class":"style";Qn(n,e,t.inputs[d],d,i)}function le(n,t,e,i){const r=Ot(),s=cr(),d=22+n,m=r[11],y=r[d]=vg(m,t,function ae(){return Ii.lFrame.currentNamespace}()),T=s.firstCreatePass?function QN(n,t,e,i,r,s,d){const m=t.consts,T=sh(t,n,2,r,fl(m,s));return S(t,e,T,fl(m,d)),null!==T.attrs&&mi(T,T.attrs,!1),null!==T.mergedAttrs&&mi(T,T.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,T),T}(d,s,r,0,t,e,i):s.data[d];ml(T,!0);const M=T.mergedAttrs;null!==M&&ot(m,y,M);const R=T.classes;null!==R&&ip(m,y,R);const H=T.styles;return null!==H&&Of(m,y,H),64!=(64&T.flags)&&Sg(s,r,y,T),0===function Gm(){return Ii.lFrame.elementDepthCount}()&&Vo(y,r),function p_(){Ii.lFrame.elementDepthCount++}(),Md(T)&&(Kf(s,r,T),ox(s,T,r)),null!==i&&ub(r,T),le}function pe(){let n=zo();ha()?Ma():(n=n.parent,ml(n,!1));const t=n;!function Wm(){Ii.lFrame.elementDepthCount--}();const e=cr();return e.firstCreatePass&&(ce(e,n),Qp(n)&&e.queries.elementEnd(n)),null!=t.classesWithoutHost&&function it(n){return 0!=(16&n.flags)}(t)&&sC(e,t,Ot(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function Tt(n){return 0!=(32&n.flags)}(t)&&sC(e,t,Ot(),t.stylesWithoutHost,!1),pe}function bn(n,t,e,i){return le(n,t,e,i),pe(),bn}function Yl(n,t,e){const i=Ot(),r=cr(),s=n+22,d=r.firstCreatePass?function JN(n,t,e,i,r){const s=t.consts,d=fl(s,i),m=sh(t,n,8,"ng-container",d);return null!==d&&mi(m,d,!0),S(t,e,m,fl(s,r)),null!==t.queries&&t.queries.elementStart(t,m),m}(s,r,i,t,e):r.data[s];ml(d,!0);const m=i[s]=i[11].createComment("");return Sg(r,i,m,d),Vo(m,i),Md(d)&&(Kf(r,i,d),ox(r,d,i)),null!=e&&ub(i,d),Yl}function Kl(){let n=zo();const t=cr();return ha()?Ma():(n=n.parent,ml(n,!1)),t.firstCreatePass&&(ce(t,n),Qp(n)&&t.queries.elementEnd(n)),Kl}function Ja(n,t,e){return Yl(n,t,e),Kl(),Ja}function Ho(){return Ot()}function Iy(n){return!!n&&"function"==typeof n.then}function jI(n){return!!n&&"function"==typeof n.subscribe}const aC=jI;function nn(n,t,e,i){const r=Ot(),s=cr(),d=zo();return UI(s,r,r[11],d,n,t,0,i),nn}function My(n,t){const e=zo(),i=Ot(),r=cr();return UI(r,i,Ki(uf(r.data),e,i),e,n,t),My}function UI(n,t,e,i,r,s,d,m){const y=Md(i),M=n.firstCreatePass&&_i(n),R=t[8],H=$n(t);let Z=!0;if(3&i.type||m){const Ce=Ks(i,t),et=m?m(Ce):Ce,kt=H.length,pt=m?Xn=>m(lo(Xn[i.index])):i.index;let en=null;if(!m&&y&&(en=function eB(n,t,e,i){const r=n.cleanup;if(null!=r)for(let s=0;s<r.length-1;s+=2){const d=r[s];if(d===e&&r[s+1]===i){const m=t[7],y=r[s+2];return m.length>y?m[y]:null}"string"==typeof d&&(s+=2)}return null}(n,t,r,i.index)),null!==en)(en.__ngLastListenerFn__||en).__ngNextListenerFn__=s,en.__ngLastListenerFn__=s,Z=!1;else{s=$I(i,t,R,s,!1);const Xn=e.listen(et,r,s);H.push(s,Xn),M&&M.push(r,pt,kt,kt+1)}}else s=$I(i,t,R,s,!1);const te=i.outputs;let xe;if(Z&&null!==te&&(xe=te[r])){const Ce=xe.length;if(Ce)for(let et=0;et<Ce;et+=2){const si=t[xe[et]][xe[et+1]].subscribe(s),Ni=H.length;H.push(s,si),M&&M.push(r,i.index,Ni,-(Ni+1))}}}function HI(n,t,e,i){try{return!1!==e(i)}catch(r){return yi(n,r),!1}}function $I(n,t,e,i,r){return function s(d){if(d===Function)return i;an(2&n.flags?Ls(n.index,t):t);let y=HI(t,0,i,d),T=s.__ngNextListenerFn__;for(;T;)y=HI(t,0,T,d)&&y,T=T.__ngNextListenerFn__;return r&&!1===y&&(d.preventDefault(),d.returnValue=!1),y}}function rn(n=1){return function C(n){return(Ii.lFrame.contextLView=function I(n,t){for(;n>0;)t=t[15],n--;return t}(n,Ii.lFrame.contextLView))[8]}(n)}function tB(n,t){let e=null;const i=function ql(n){const t=n.attrs;if(null!=t){const e=t.indexOf(5);if(0==(1&e))return t[e+1]}return null}(n);for(let r=0;r<t.length;r++){const s=t[r];if("*"!==s){if(null===i?ay(n,s,!0):pp(i,s))return r}else e=r}return e}function $o(n){const t=Ot()[16][6];if(!t.projection){const i=t.projection=to(n?n.length:1,null),r=i.slice();let s=t.child;for(;null!==s;){const d=n?tB(s,n):0;null!==d&&(r[d]?r[d].projectionNext=s:i[d]=s,r[d]=s),s=s.next}}}function $r(n,t=0,e){const i=Ot(),r=cr(),s=sh(r,22+n,16,null,e||null);null===s.projection&&(s.projection=t),Ma(),64!=(64&s.flags)&&function r1(n,t,e){vo(t[11],0,t,e,ma(n,e,t),Uu(e.parent||t[6],e,t))}(r,i,s)}function au(n,t,e){return lC(n,"",t,"",e),au}function lC(n,t,e,i,r){const s=Ot(),d=Ic(s,t,e,i);return d!==ki&&l(cr(),N(),s,n,d,s[11],r,!1),lC}function JI(n,t,e,i,r){const s=n[e+1],d=null===t;let m=i?Qa(s):Gl(s),y=!1;for(;0!==m&&(!1===y||d);){const M=n[m+1];rB(n[m],t)&&(y=!0,n[m+1]=i?py(M):hy(M)),m=i?Qa(M):Gl(M)}y&&(n[e+1]=i?hy(s):py(s))}function rB(n,t){return null===n||null==t||(Array.isArray(n)?n[1]:n)===t||!(!Array.isArray(n)||"string"!=typeof t)&&_l(n,t)>=0}function ed(n,t,e){return lu(n,t,e,!1),ed}function Ui(n,t){return lu(n,t,null,!0),Ui}function lu(n,t,e,i){const r=Ot(),s=cr(),d=Ha(2);s.firstUpdatePass&&function aM(n,t,e,i){const r=n.data;if(null===r[e+1]){const s=r[A()],d=function sM(n,t){return t>=n.expandoStartIndex}(n,e);(function dM(n,t){return 0!=(n.flags&(t?16:32))})(s,i)&&null===t&&!d&&(t=!1),t=function pB(n,t,e,i){const r=uf(n);let s=i?t.residualClasses:t.residualStyles;if(null===r)0===(i?t.classBindings:t.styleBindings)&&(e=Ay(e=cC(null,n,t,e,i),t.attrs,i),s=null);else{const d=t.directiveStylingLast;if(-1===d||n[d]!==r)if(e=cC(r,n,t,e,i),null===s){let y=function fB(n,t,e){const i=e?t.classBindings:t.styleBindings;if(0!==Gl(i))return n[Qa(i)]}(n,t,i);void 0!==y&&Array.isArray(y)&&(y=cC(null,n,t,y[1],i),y=Ay(y,t.attrs,i),function mB(n,t,e,i){n[Qa(e?t.classBindings:t.styleBindings)]=i}(n,t,i,y))}else s=function gB(n,t,e){let i;const r=t.directiveEnd;for(let s=1+t.directiveStylingLast;s<r;s++)i=Ay(i,n[s].hostAttrs,e);return Ay(i,t.attrs,e)}(n,t,i)}return void 0!==s&&(i?t.residualClasses=s:t.residualStyles=s),e}(r,s,t,i),function nB(n,t,e,i,r,s){let d=s?t.classBindings:t.styleBindings,m=Qa(d),y=Gl(d);n[i]=e;let M,T=!1;if(Array.isArray(e)){const R=e;M=R[1],(null===M||_l(R,M)>0)&&(T=!0)}else M=e;if(r)if(0!==y){const H=Qa(n[m+1]);n[i+1]=tb(H,m),0!==H&&(n[H+1]=ib(n[H+1],i)),n[m+1]=function Xu(n,t){return 131071&n|t<<17}(n[m+1],i)}else n[i+1]=tb(m,0),0!==m&&(n[m+1]=ib(n[m+1],i)),m=i;else n[i+1]=tb(y,0),0===m?m=i:n[y+1]=ib(n[y+1],i),y=i;T&&(n[i+1]=hy(n[i+1])),JI(n,M,i,!0),JI(n,M,i,!1),function iB(n,t,e,i,r){const s=r?n.residualClasses:n.residualStyles;null!=s&&"string"==typeof t&&_l(s,t)>=0&&(e[i+1]=py(e[i+1]))}(t,M,n,i,s),d=tb(m,y),s?t.classBindings=d:t.styleBindings=d}(r,s,t,e,d,i)}}(s,n,d,i),t!==ki&&Ss(r,d,t)&&function cM(n,t,e,i,r,s,d,m){if(!(3&t.type))return;const y=n.data,T=y[m+1];cx(function Gf(n){return 1==(1&n)}(T)?uM(y,t,e,r,Gl(T),d):void 0)||(cx(s)||function nb(n){return 2==(2&n)}(T)&&(s=uM(y,null,e,r,m,d)),function b0(n,t,e,i,r){if(t)r?n.addClass(e,i):n.removeClass(e,i);else{let s=-1===i.indexOf("-")?void 0:fa.DashCase;null==r?n.removeStyle(e,i,s):("string"==typeof r&&r.endsWith("!important")&&(r=r.slice(0,-10),s|=fa.Important),n.setStyle(e,i,r,s))}}(i,d,Hh(A(),e),r,s))}(s,s.data[A()],r,r[11],n,r[d+1]=function yB(n,t){return null==n||("string"==typeof t?n+=t:"object"==typeof n&&(n=Zi(Za(n)))),n}(t,e),i,d)}function cC(n,t,e,i,r){let s=null;const d=e.directiveEnd;let m=e.directiveStylingLast;for(-1===m?m=e.directiveStart:m++;m<d&&(s=t[m],i=Ay(i,s.hostAttrs,r),s!==n);)m++;return null!==n&&(e.directiveStylingLast=m),i}function Ay(n,t,e){const i=e?1:2;let r=-1;if(null!==t)for(let s=0;s<t.length;s++){const d=t[s];"number"==typeof d?r=d:r===i&&(Array.isArray(n)||(n=void 0===n?[]:["",n]),Do(n,d,!!e||t[++s]))}return void 0===n?null:n}function uM(n,t,e,i,r,s){const d=null===t;let m;for(;r>0;){const y=n[r],T=Array.isArray(y),M=T?y[1]:y,R=null===M;let H=e[r+1];H===ki&&(H=R?Ji:void 0);let Z=R?mf(H,i):M===i?H:void 0;if(T&&!cx(Z)&&(Z=mf(y,i)),cx(Z)&&(m=Z,d))return m;const te=n[r+1];r=d?Qa(te):Gl(te)}if(null!==t){let y=s?t.residualClasses:t.residualStyles;null!=y&&(m=mf(y,i))}return m}function cx(n){return void 0!==n}function Ye(n,t=""){const e=Ot(),i=cr(),r=n+22,s=i.firstCreatePass?sh(i,r,1,t,null):i.data[r],d=e[r]=function ju(n,t){return n.createText(t)}(e[11],t);Sg(i,e,d,s),ml(s,!1)}function Pi(n){return Vr("",n,""),Pi}function Vr(n,t,e){const i=Ot(),r=Ic(i,n,t,e);return r!==ki&&er(i,A(),r),Vr}function ux(n,t,e,i,r){const s=Ot(),d=Ju(s,n,t,e,i,r);return d!==ki&&er(s,A(),d),ux}function Mc(n,t,e){const i=Ot();return Ss(i,sn(),t)&&l(cr(),N(),i,n,t,i[11],e,!0),Mc}function ky(n,t,e){const i=Ot();if(Ss(i,sn(),t)){const s=cr(),d=N();l(s,d,i,n,t,Ki(uf(s.data),d,i),e,!0)}return ky}const tm=void 0;var zB=["en",[["a","p"],["AM","PM"],tm],[["AM","PM"],tm,tm],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],tm,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],tm,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",tm,"{1} 'at' {0}",tm],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function BB(n){const e=Math.floor(Math.abs(n)),i=n.toString().replace(/^[^.]*\.?/,"").length;return 1===e&&0===i?1:5}];let bb={};function el(n){const t=function VB(n){return n.toLowerCase().replace(/_/g,"-")}(n);let e=MM(t);if(e)return e;const i=t.split("-")[0];if(e=MM(i),e)return e;if("en"===i)return zB;throw new Nt(701,!1)}function MM(n){return n in bb||(bb[n]=qr.ng&&qr.ng.common&&qr.ng.common.locales&&qr.ng.common.locales[n]),bb[n]}var jn=(()=>((jn=jn||{})[jn.LocaleId=0]="LocaleId",jn[jn.DayPeriodsFormat=1]="DayPeriodsFormat",jn[jn.DayPeriodsStandalone=2]="DayPeriodsStandalone",jn[jn.DaysFormat=3]="DaysFormat",jn[jn.DaysStandalone=4]="DaysStandalone",jn[jn.MonthsFormat=5]="MonthsFormat",jn[jn.MonthsStandalone=6]="MonthsStandalone",jn[jn.Eras=7]="Eras",jn[jn.FirstDayOfWeek=8]="FirstDayOfWeek",jn[jn.WeekendRange=9]="WeekendRange",jn[jn.DateFormat=10]="DateFormat",jn[jn.TimeFormat=11]="TimeFormat",jn[jn.DateTimeFormat=12]="DateTimeFormat",jn[jn.NumberSymbols=13]="NumberSymbols",jn[jn.NumberFormats=14]="NumberFormats",jn[jn.CurrencyCode=15]="CurrencyCode",jn[jn.CurrencySymbol=16]="CurrencySymbol",jn[jn.CurrencyName=17]="CurrencyName",jn[jn.Currencies=18]="Currencies",jn[jn.Directionality=19]="Directionality",jn[jn.PluralCase=20]="PluralCase",jn[jn.ExtraData=21]="ExtraData",jn))();const _b="en-US";let AM=_b;function hC(n,t,e,i,r){if(n=ci(n),Array.isArray(n))for(let s=0;s<n.length;s++)hC(n[s],t,e,i,r);else{const s=cr(),d=Ot();let m=vc(n)?n:ci(n.provide),y=ty(n);const T=zo(),M=1048575&T.providerIndexes,R=T.directiveStart,H=T.providerIndexes>>20;if(vc(n)||!n.multi){const Z=new Oe(y,r,X),te=fC(m,t,r?M:M+H,R);-1===te?(pr(_o(T,d),s,m),pC(s,n,t.length),t.push(m),T.directiveStart++,T.directiveEnd++,r&&(T.providerIndexes+=1048576),e.push(Z),d.push(Z)):(e[te]=Z,d[te]=Z)}else{const Z=fC(m,t,M+H,R),te=fC(m,t,M,M+H),xe=Z>=0&&e[Z],Ce=te>=0&&e[te];if(r&&!Ce||!r&&!xe){pr(_o(T,d),s,m);const et=function B3(n,t,e,i,r){const s=new Oe(n,e,X);return s.multi=[],s.index=t,s.componentProviders=0,tA(s,r,i&&!e),s}(r?N3:F3,e.length,r,i,y);!r&&Ce&&(e[te].providerFactory=et),pC(s,n,t.length,0),t.push(m),T.directiveStart++,T.directiveEnd++,r&&(T.providerIndexes+=1048576),e.push(et),d.push(et)}else pC(s,n,Z>-1?Z:te,tA(e[r?te:Z],y,!r&&i));!r&&i&&Ce&&e[te].componentProviders++}}}function pC(n,t,e,i){const r=vc(t),s=function cp(n){return!!n.useClass}(t);if(r||s){const y=(s?ci(t.useClass):t).prototype.ngOnDestroy;if(y){const T=n.destroyHooks||(n.destroyHooks=[]);if(!r&&t.multi){const M=T.indexOf(e);-1===M?T.push(e,[i,y]):T[M+1].push(i,y)}else T.push(e,y)}}}function tA(n,t,e){return e&&n.componentProviders++,n.multi.push(t)-1}function fC(n,t,e,i){for(let r=e;r<i;r++)if(t[r]===n)return r;return-1}function F3(n,t,e,i){return mC(this.multi,[])}function N3(n,t,e,i){const r=this.multi;let s;if(this.providerFactory){const d=this.providerFactory.componentProviders,m=Nl(e,e[1],this.providerFactory.index,i);s=m.slice(0,d),mC(r,s);for(let y=d;y<m.length;y++)s.push(m[y])}else s=[],mC(r,s);return s}function mC(n,t){for(let e=0;e<n.length;e++)t.push((0,n[e])());return t}function ni(n,t=[]){return e=>{e.providersResolver=(i,r)=>function L3(n,t,e){const i=cr();if(i.firstCreatePass){const r=Ys(n);hC(e,i.data,i.blueprint,r,!0),hC(t,i.data,i.blueprint,r,!1)}}(i,r?r(n):n,t)}}class nm{}class nA{}class iA extends nm{constructor(t,e){super(),this._parent=e,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new Sr(this);const i=Ps(t);this._bootstrapComponents=wc(i.bootstrap),this._r3Injector=X0(t,e,[{provide:nm,useValue:this},{provide:Kd,useValue:this.componentFactoryResolver}],Zi(t),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(t)}get injector(){return this._r3Injector}destroy(){const t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(e=>e()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}}class gC extends nA{constructor(t){super(),this.moduleType=t}create(t){return new iA(this.moduleType,t)}}class V3 extends nm{constructor(t,e,i){super(),this.componentFactoryResolver=new Sr(this),this.instance=null;const r=new J_([...t,{provide:nm,useValue:this},{provide:Kd,useValue:this.componentFactoryResolver}],e||Ng(),i,new Set(["environment"]));this.injector=r,r.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(t){this.injector.onDestroy(t)}}function mx(n,t,e=null){return new V3(n,t,e).injector}let j3=(()=>{class n{constructor(e){this._injector=e,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(e){if(!e.standalone)return null;if(!this.cachedInjectors.has(e.id)){const i=A0(0,e.type),r=i.length>0?mx([i],this._injector,`Standalone[${e.type.name}]`):null;this.cachedInjectors.set(e.id,r)}return this.cachedInjectors.get(e.id)}ngOnDestroy(){try{for(const e of this.cachedInjectors.values())null!==e&&e.destroy()}finally{this.cachedInjectors.clear()}}}return n.\u0275prov=tn({token:n,providedIn:"environment",factory:()=>new n(Ue(tu))}),n})();function rA(n){n.getStandaloneInjector=t=>t.get(j3).getOrCreateStandaloneInjector(n)}function _C(n,t,e,i){return dA(Ot(),rs(),n,t,e,i)}function dA(n,t,e,i,r,s){const d=t+e;return Ss(n,d,r)?function ia(n,t,e){return n[t]=e}(n,d+1,s?i.call(s,r):i(r)):function Ny(n,t){const e=n[t];return e===ki?void 0:e}(n,d+1)}function yb(n,t){const e=cr();let i;const r=n+22;e.firstCreatePass?(i=function oz(n,t){if(t)for(let e=t.length-1;e>=0;e--){const i=t[e];if(n===i.name)return i}}(t,e.pipeRegistry),e.data[r]=i,i.onDestroy&&(e.destroyHooks||(e.destroyHooks=[])).push(r,i.onDestroy)):i=e.data[r];const s=i.factory||(i.factory=Da(i.type)),d=Xs(X);try{const m=wi(!1),y=s();return wi(m),function KN(n,t,e,i){e>=n.data.length&&(n.data[e]=null,n.blueprint[e]=null),t[e]=i}(e,Ot(),r,y),y}finally{Xs(d)}}function vb(n,t,e){const i=n+22,r=Ot(),s=lc(r,i);return function By(n,t){return n[1].data[t].pure}(r,i)?dA(r,rs(),t,s.transform,e,s):s.transform(e)}function yC(n){return t=>{setTimeout(n,void 0,t)}}const on=class uz extends Wt{constructor(t=!1){super(),this.__isAsync=t}emit(t){super.next(t)}subscribe(t,e,i){var r,s,d;let m=t,y=e||(()=>null),T=i;if(t&&"object"==typeof t){const R=t;m=null===(r=R.next)||void 0===r?void 0:r.bind(R),y=null===(s=R.error)||void 0===s?void 0:s.bind(R),T=null===(d=R.complete)||void 0===d?void 0:d.bind(R)}this.__isAsync&&(y=yC(y),m&&(m=yC(m)),T&&(T=yC(T)));const M=super.subscribe({next:m,error:y,complete:T});return t instanceof he&&t.add(M),M}};function dz(){return this._results[Qu()]()}class im{constructor(t=!1){this._emitDistinctChangesOnly=t,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const e=Qu(),i=im.prototype;i[e]||(i[e]=dz)}get changes(){return this._changes||(this._changes=new on)}get(t){return this._results[t]}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,e){return this._results.reduce(t,e)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(t,e){const i=this;i.dirty=!1;const r=ka(t);(this._changesDetected=!function qv(n,t,e){if(n.length!==t.length)return!1;for(let i=0;i<n.length;i++){let r=n[i],s=t[i];if(e&&(r=e(r),s=e(s)),s!==r)return!1}return!0}(i._results,r,e))&&(i._results=r,i.length=r.length,i.last=r[this.length-1],i.first=r[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let ho=(()=>{class n{}return n.__NG_ELEMENT_ID__=fz,n})();const hz=ho,pz=class extends hz{constructor(t,e,i){super(),this._declarationLView=t,this._declarationTContainer=e,this.elementRef=i}createEmbeddedView(t,e){const i=this._declarationTContainer.tViews,r=oh(this._declarationLView,i,t,16,null,i.declTNode,null,null,null,null,e||null);r[17]=this._declarationLView[this._declarationTContainer.index];const d=this._declarationLView[19];return null!==d&&(r[19]=d.createEmbeddedView(i)),cb(i,r,t),new dr(r)}};function fz(){return gx(zo(),Ot())}function gx(n,t){return 4&n.type?new pz(t,n,$l(n,t)):null}let Qo=(()=>{class n{}return n.__NG_ELEMENT_ID__=mz,n})();function mz(){return _A(zo(),Ot())}const gz=Qo,gA=class extends gz{constructor(t,e,i){super(),this._lContainer=t,this._hostTNode=e,this._hostLView=i}get element(){return $l(this._hostTNode,this._hostLView)}get injector(){return new Vl(this._hostTNode,this._hostLView)}get parentInjector(){const t=Fr(this._hostTNode,this._hostLView);if(Un(t)){const e=Hn(t,this._hostLView),i=ti(t);return new Vl(e[1].data[i+8],e)}return new Vl(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){const e=bA(this._lContainer);return null!==e&&e[t]||null}get length(){return this._lContainer.length-10}createEmbeddedView(t,e,i){let r,s;"number"==typeof i?r=i:null!=i&&(r=i.index,s=i.injector);const d=t.createEmbeddedView(e||{},s);return this.insert(d,r),d}createComponent(t,e,i,r,s){const d=t&&!function ff(n){return"function"==typeof n}(t);let m;if(d)m=e;else{const R=e||{};m=R.index,i=R.injector,r=R.projectableNodes,s=R.environmentInjector||R.ngModuleRef}const y=d?t:new io(xr(t)),T=i||this.parentInjector;if(!s&&null==y.ngModule){const H=(d?T:this.parentInjector).get(tu,null);H&&(s=H)}const M=y.create(T,r,void 0,s);return this.insert(M.hostView,m),M}insert(t,e){const i=t._lView,r=i[1];if(function Nd(n){return Va(n[3])}(i)){const M=this.indexOf(t);if(-1!==M)this.detach(M);else{const R=i[3],H=new gA(R,R[6],R[3]);H.detach(H.indexOf(t))}}const s=this._adjustIndex(e),d=this._lContainer;!function a0(n,t,e,i){const r=10+i,s=e.length;i>0&&(e[r-1][4]=t),i<s-10?(t[4]=e[r],Gv(e,10+i,t)):(e.push(t),t[4]=null),t[3]=e;const d=t[17];null!==d&&e!==d&&function t1(n,t){const e=n[9];t[16]!==t[3][3][16]&&(n[2]=!0),null===e?n[9]=[t]:e.push(t)}(d,t);const m=t[19];null!==m&&m.insertView(n),t[2]|=64}(r,i,d,s);const m=B_(s,d),y=i[11],T=Zd(y,d[7]);return null!==T&&function JS(n,t,e,i,r,s){i[0]=r,i[6]=t,bc(n,i,e,1,r,s)}(r,d[6],y,i,T,m),t.attachToViewContainerRef(),Gv(vC(d),s,t),t}move(t,e){return this.insert(t,e)}indexOf(t){const e=bA(this._lContainer);return null!==e?e.indexOf(t):-1}remove(t){const e=this._adjustIndex(t,-1),i=xg(this._lContainer,e);i&&(eg(vC(this._lContainer),e),L_(i[1],i))}detach(t){const e=this._adjustIndex(t,-1),i=xg(this._lContainer,e);return i&&null!=eg(vC(this._lContainer),e)?new dr(i):null}_adjustIndex(t,e=0){return null==t?this.length+e:t}};function bA(n){return n[8]}function vC(n){return n[8]||(n[8]=[])}function _A(n,t){let e;const i=t[n.index];if(Va(i))e=i;else{let r;if(8&n.type)r=lo(i);else{const s=t[11];r=s.createComment("");const d=Ks(n,t);eu(s,Zd(s,d),r,function p0(n,t){return n.nextSibling(t)}(s,d),!1)}t[n.index]=e=yt(i,t,r,n),mt(t,e)}return new gA(e,n,t)}class xC{constructor(t){this.queryList=t,this.matches=null}clone(){return new xC(this.queryList)}setDirty(){this.queryList.setDirty()}}class wC{constructor(t=[]){this.queries=t}createEmbeddedView(t){const e=t.queries;if(null!==e){const i=null!==t.contentQueries?t.contentQueries[0]:e.length,r=[];for(let s=0;s<i;s++){const d=e.getByIndex(s);r.push(this.queries[d.indexInDeclarationView].clone())}return new wC(r)}return null}insertView(t){this.dirtyQueriesWithMatches(t)}detachView(t){this.dirtyQueriesWithMatches(t)}dirtyQueriesWithMatches(t){for(let e=0;e<this.queries.length;e++)null!==SA(t,e).matches&&this.queries[e].setDirty()}}class yA{constructor(t,e,i=null){this.predicate=t,this.flags=e,this.read=i}}class SC{constructor(t=[]){this.queries=t}elementStart(t,e){for(let i=0;i<this.queries.length;i++)this.queries[i].elementStart(t,e)}elementEnd(t){for(let e=0;e<this.queries.length;e++)this.queries[e].elementEnd(t)}embeddedTView(t){let e=null;for(let i=0;i<this.length;i++){const r=null!==e?e.length:0,s=this.getByIndex(i).embeddedTView(t,r);s&&(s.indexInDeclarationView=i,null!==e?e.push(s):e=[s])}return null!==e?new SC(e):null}template(t,e){for(let i=0;i<this.queries.length;i++)this.queries[i].template(t,e)}getByIndex(t){return this.queries[t]}get length(){return this.queries.length}track(t){this.queries.push(t)}}class CC{constructor(t,e=-1){this.metadata=t,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=e}elementStart(t,e){this.isApplyingToNode(e)&&this.matchTNode(t,e)}elementEnd(t){this._declarationNodeIndex===t.index&&(this._appliesToNextNode=!1)}template(t,e){this.elementStart(t,e)}embeddedTView(t,e){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,e),new CC(this.metadata)):null}isApplyingToNode(t){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const e=this._declarationNodeIndex;let i=t.parent;for(;null!==i&&8&i.type&&i.index!==e;)i=i.parent;return e===(null!==i?i.index:-1)}return this._appliesToNextNode}matchTNode(t,e){const i=this.metadata.predicate;if(Array.isArray(i))for(let r=0;r<i.length;r++){const s=i[r];this.matchTNodeWithReadOption(t,e,yz(e,s)),this.matchTNodeWithReadOption(t,e,gl(e,t,s,!1,!1))}else i===ho?4&e.type&&this.matchTNodeWithReadOption(t,e,-1):this.matchTNodeWithReadOption(t,e,gl(e,t,i,!1,!1))}matchTNodeWithReadOption(t,e,i){if(null!==i){const r=this.metadata.read;if(null!==r)if(r===zn||r===Qo||r===ho&&4&e.type)this.addMatch(e.index,-2);else{const s=gl(e,t,r,!1,!1);null!==s&&this.addMatch(e.index,s)}else this.addMatch(e.index,i)}}addMatch(t,e){null===this.matches?this.matches=[t,e]:this.matches.push(t,e)}}function yz(n,t){const e=n.localNames;if(null!==e)for(let i=0;i<e.length;i+=2)if(e[i]===t)return e[i+1];return null}function xz(n,t,e,i){return-1===e?function vz(n,t){return 11&n.type?$l(n,t):4&n.type?gx(n,t):null}(t,n):-2===e?function wz(n,t,e){return e===zn?$l(t,n):e===ho?gx(t,n):e===Qo?_A(t,n):void 0}(n,t,i):Nl(n,n[1],e,t)}function vA(n,t,e,i){const r=t[19].queries[i];if(null===r.matches){const s=n.data,d=e.matches,m=[];for(let y=0;y<d.length;y+=2){const T=d[y];m.push(T<0?null:xz(t,s[T],d[y+1],e.metadata.read))}r.matches=m}return r.matches}function TC(n,t,e,i){const r=n.queries.getByIndex(e),s=r.matches;if(null!==s){const d=vA(n,t,r,e);for(let m=0;m<s.length;m+=2){const y=s[m];if(y>0)i.push(d[m/2]);else{const T=s[m+1],M=t[-y];for(let R=10;R<M.length;R++){const H=M[R];H[17]===H[3]&&TC(H[1],H,T,i)}if(null!==M[9]){const R=M[9];for(let H=0;H<R.length;H++){const Z=R[H];TC(Z[1],Z,T,i)}}}}}return i}function Jn(n){const t=Ot(),e=cr(),i=Km();zd(i+1);const r=SA(e,i);if(n.dirty&&function $h(n){return 4==(4&n[2])}(t)===(2==(2&r.metadata.flags))){if(null===r.matches)n.reset([]);else{const s=r.crossesNgTemplate?TC(e,t,i,[]):vA(e,t,r,i);n.reset(s,Vg),n.notifyOnChanges()}return!0}return!1}function yr(n,t,e){const i=cr();i.firstCreatePass&&(wA(i,new yA(n,t,e),-1),2==(2&t)&&(i.staticViewQueries=!0)),xA(i,Ot(),t)}function Kr(n,t,e,i){const r=cr();if(r.firstCreatePass){const s=zo();wA(r,new yA(t,e,i),s.index),function Cz(n,t){const e=n.contentQueries||(n.contentQueries=[]);t!==(e.length?e[e.length-1]:-1)&&e.push(n.queries.length-1,t)}(r,n),2==(2&e)&&(r.staticContentQueries=!0)}xA(r,Ot(),e)}function ei(){return function Sz(n,t){return n[19].queries[t].queryList}(Ot(),Km())}function xA(n,t,e){const i=new im(4==(4&e));yp(n,t,i,i.destroy),null===t[19]&&(t[19]=new wC),t[19].queries.push(new xC(i))}function wA(n,t,e){null===n.queries&&(n.queries=new SC),n.queries.track(new CC(t,e))}function SA(n,t){return n.queries.getByIndex(t)}function rm(n,t){return gx(n,t)}function _x(...n){}const yx=new Dt("Application Initializer");let vx=(()=>{class n{constructor(e){this.appInits=e,this.resolve=_x,this.reject=_x,this.initialized=!1,this.done=!1,this.donePromise=new Promise((i,r)=>{this.resolve=i,this.reject=r})}runInitializers(){if(this.initialized)return;const e=[],i=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let r=0;r<this.appInits.length;r++){const s=this.appInits[r]();if(Iy(s))e.push(s);else if(aC(s)){const d=new Promise((m,y)=>{s.subscribe({complete:m,error:y})});e.push(d)}}Promise.all(e).then(()=>{i()}).catch(r=>{this.reject(r)}),0===e.length&&i(),this.initialized=!0}}return n.\u0275fac=function(e){return new(e||n)(Ue(yx,8))},n.\u0275prov=tn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const Sb=new Dt("AppId",{providedIn:"root",factory:function UA(){return`${AC()}${AC()}${AC()}`}});function AC(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const HA=new Dt("Platform Initializer"),xx=new Dt("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),$A=new Dt("appBootstrapListener"),id=new Dt("AnimationModuleType");let $z=(()=>{class n{log(e){console.log(e)}warn(e){console.warn(e)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=tn({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})();const Ql=new Dt("LocaleId",{providedIn:"root",factory:()=>Wr(Ql,ri.Optional|ri.SkipSelf)||function qz(){return"undefined"!=typeof $localize&&$localize.locale||_b}()});class Wz{constructor(t,e){this.ngModuleFactory=t,this.componentFactories=e}}let kC=(()=>{class n{compileModuleSync(e){return new gC(e)}compileModuleAsync(e){return Promise.resolve(this.compileModuleSync(e))}compileModuleAndAllComponentsSync(e){const i=this.compileModuleSync(e),s=wc(Ps(e).declarations).reduce((d,m)=>{const y=xr(m);return y&&d.push(new io(y)),d},[]);return new Wz(i,s)}compileModuleAndAllComponentsAsync(e){return Promise.resolve(this.compileModuleAndAllComponentsSync(e))}clearCache(){}clearCacheFor(e){}getModuleId(e){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=tn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const Yz=(()=>Promise.resolve(0))();function RC(n){"undefined"==typeof Zone?Yz.then(()=>{n&&n.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",n)}class di{constructor({enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:e=!1,shouldCoalesceRunChangeDetection:i=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new on(!1),this.onMicrotaskEmpty=new on(!1),this.onStable=new on(!1),this.onError=new on(!1),"undefined"==typeof Zone)throw new Nt(908,!1);Zone.assertZonePatched();const r=this;if(r._nesting=0,r._outer=r._inner=Zone.current,Zone.AsyncStackTaggingZoneSpec){const s=Zone.AsyncStackTaggingZoneSpec;r._inner=r._inner.fork(new s("Angular"))}Zone.TaskTrackingZoneSpec&&(r._inner=r._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(r._inner=r._inner.fork(Zone.longStackTraceZoneSpec)),r.shouldCoalesceEventChangeDetection=!i&&e,r.shouldCoalesceRunChangeDetection=i,r.lastRequestAnimationFrameId=-1,r.nativeRequestAnimationFrame=function Kz(){let n=qr.requestAnimationFrame,t=qr.cancelAnimationFrame;if("undefined"!=typeof Zone&&n&&t){const e=n[Zone.__symbol__("OriginalDelegate")];e&&(n=e);const i=t[Zone.__symbol__("OriginalDelegate")];i&&(t=i)}return{nativeRequestAnimationFrame:n,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function eV(n){const t=()=>{!function Jz(n){n.isCheckStableRunning||-1!==n.lastRequestAnimationFrameId||(n.lastRequestAnimationFrameId=n.nativeRequestAnimationFrame.call(qr,()=>{n.fakeTopEventTask||(n.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{n.lastRequestAnimationFrameId=-1,OC(n),n.isCheckStableRunning=!0,PC(n),n.isCheckStableRunning=!1},void 0,()=>{},()=>{})),n.fakeTopEventTask.invoke()}),OC(n))}(n)};n._inner=n._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(e,i,r,s,d,m)=>{try{return WA(n),e.invokeTask(r,s,d,m)}finally{(n.shouldCoalesceEventChangeDetection&&"eventTask"===s.type||n.shouldCoalesceRunChangeDetection)&&t(),XA(n)}},onInvoke:(e,i,r,s,d,m,y)=>{try{return WA(n),e.invoke(r,s,d,m,y)}finally{n.shouldCoalesceRunChangeDetection&&t(),XA(n)}},onHasTask:(e,i,r,s)=>{e.hasTask(r,s),i===r&&("microTask"==s.change?(n._hasPendingMicrotasks=s.microTask,OC(n),PC(n)):"macroTask"==s.change&&(n.hasPendingMacrotasks=s.macroTask))},onHandleError:(e,i,r,s)=>(e.handleError(r,s),n.runOutsideAngular(()=>n.onError.emit(s)),!1)})}(r)}static isInAngularZone(){return"undefined"!=typeof Zone&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!di.isInAngularZone())throw new Nt(909,!1)}static assertNotInAngularZone(){if(di.isInAngularZone())throw new Nt(909,!1)}run(t,e,i){return this._inner.run(t,e,i)}runTask(t,e,i,r){const s=this._inner,d=s.scheduleEventTask("NgZoneEvent: "+r,t,Qz,_x,_x);try{return s.runTask(d,e,i)}finally{s.cancelTask(d)}}runGuarded(t,e,i){return this._inner.runGuarded(t,e,i)}runOutsideAngular(t){return this._outer.run(t)}}const Qz={};function PC(n){if(0==n._nesting&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function OC(n){n.hasPendingMicrotasks=!!(n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&-1!==n.lastRequestAnimationFrameId)}function WA(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function XA(n){n._nesting--,PC(n)}class tV{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new on,this.onMicrotaskEmpty=new on,this.onStable=new on,this.onError=new on}run(t,e,i){return t.apply(e,i)}runGuarded(t,e,i){return t.apply(e,i)}runOutsideAngular(t){return t()}runTask(t,e,i,r){return t.apply(e,i)}}const ZA=new Dt(""),wx=new Dt("");let Vy,LC=(()=>{class n{constructor(e,i,r){this._ngZone=e,this.registry=i,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,Vy||(function nV(n){Vy=n}(r),r.addToWindow(i)),this._watchAngularEvents(),e.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{di.assertNotInAngularZone(),RC(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())RC(()=>{for(;0!==this._callbacks.length;){let e=this._callbacks.pop();clearTimeout(e.timeoutId),e.doneCb(this._didWork)}this._didWork=!1});else{let e=this.getPendingTasks();this._callbacks=this._callbacks.filter(i=>!i.updateCb||!i.updateCb(e)||(clearTimeout(i.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(e=>({source:e.source,creationLocation:e.creationLocation,data:e.data})):[]}addCallback(e,i,r){let s=-1;i&&i>0&&(s=setTimeout(()=>{this._callbacks=this._callbacks.filter(d=>d.timeoutId!==s),e(this._didWork,this.getPendingTasks())},i)),this._callbacks.push({doneCb:e,timeoutId:s,updateCb:r})}whenStable(e,i,r){if(r&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(e,i,r),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(e){this.registry.registerApplication(e,this)}unregisterApplication(e){this.registry.unregisterApplication(e)}findProviders(e,i,r){return[]}}return n.\u0275fac=function(e){return new(e||n)(Ue(di),Ue(FC),Ue(wx))},n.\u0275prov=tn({token:n,factory:n.\u0275fac}),n})(),FC=(()=>{class n{constructor(){this._applications=new Map}registerApplication(e,i){this._applications.set(e,i)}unregisterApplication(e){this._applications.delete(e)}unregisterAllApplications(){this._applications.clear()}getTestability(e){return this._applications.get(e)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(e,i=!0){var r;return null!==(r=null==Vy?void 0:Vy.findTestabilityInTree(this,e,i))&&void 0!==r?r:null}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=tn({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})(),rd=null;const YA=new Dt("AllowMultipleToken"),NC=new Dt("PlatformDestroyListeners");class KA{constructor(t,e){this.name=t,this.token=e}}function JA(n,t,e=[]){const i=`Platform: ${t}`,r=new Dt(i);return(s=[])=>{let d=BC();if(!d||d.injector.get(YA,!1)){const m=[...e,...s,{provide:r,useValue:!0}];n?n(m):function oV(n){if(rd&&!rd.get(YA,!1))throw new Nt(400,!1);rd=n;const t=n.get(tk);(function QA(n){const t=n.get(HA,null);t&&t.forEach(e=>e())})(n)}(function ek(n=[],t){return Xr.create({name:t,providers:[{provide:K_,useValue:"platform"},{provide:NC,useValue:new Set([()=>rd=null])},...n]})}(m,i))}return function aV(n){const t=BC();if(!t)throw new Nt(401,!1);return t}()}}function BC(){var n;return null!==(n=null==rd?void 0:rd.get(tk))&&void 0!==n?n:null}let tk=(()=>{class n{constructor(e){this._injector=e,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(e,i){const r=function ik(n,t){let e;return e="noop"===n?new tV:("zone.js"===n?void 0:n)||new di(t),e}(null==i?void 0:i.ngZone,function nk(n){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!(!n||!n.ngZoneEventCoalescing)||!1,shouldCoalesceRunChangeDetection:!(!n||!n.ngZoneRunCoalescing)||!1}}(i)),s=[{provide:di,useValue:r}];return r.run(()=>{const d=Xr.create({providers:s,parent:this.injector,name:e.moduleType.name}),m=e.create(d),y=m.injector.get(wl,null);if(!y)throw new Nt(402,!1);return r.runOutsideAngular(()=>{const T=r.onError.subscribe({next:M=>{y.handleError(M)}});m.onDestroy(()=>{Sx(this._modules,m),T.unsubscribe()})}),function rk(n,t,e){try{const i=e();return Iy(i)?i.catch(r=>{throw t.runOutsideAngular(()=>n.handleError(r)),r}):i}catch(i){throw t.runOutsideAngular(()=>n.handleError(i)),i}}(y,r,()=>{const T=m.injector.get(vx);return T.runInitializers(),T.donePromise.then(()=>(function kM(n){Bo(n,"Expected localeId to be defined"),"string"==typeof n&&(AM=n.toLowerCase().replace(/_/g,"-"))}(m.injector.get(Ql,_b)||_b),this._moduleDoBootstrap(m),m))})})}bootstrapModule(e,i=[]){const r=ok({},i);return function iV(n,t,e){const i=new gC(e);return Promise.resolve(i)}(0,0,e).then(s=>this.bootstrapModuleFactory(s,r))}_moduleDoBootstrap(e){const i=e.injector.get(Cb);if(e._bootstrapComponents.length>0)e._bootstrapComponents.forEach(r=>i.bootstrap(r));else{if(!e.instance.ngDoBootstrap)throw new Nt(403,!1);e.instance.ngDoBootstrap(i)}this._modules.push(e)}onDestroy(e){this._destroyListeners.push(e)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Nt(404,!1);this._modules.slice().forEach(i=>i.destroy()),this._destroyListeners.forEach(i=>i());const e=this._injector.get(NC,null);e&&(e.forEach(i=>i()),e.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return n.\u0275fac=function(e){return new(e||n)(Ue(Xr))},n.\u0275prov=tn({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})();function ok(n,t){return Array.isArray(t)?t.reduce(ok,n):Object.assign(Object.assign({},n),t)}let Cb=(()=>{class n{constructor(e,i,r){this._zone=e,this._injector=i,this._exceptionHandler=r,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this._destroyed=!1,this._destroyListeners=[],this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const s=new Mt(m=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{m.next(this._stable),m.complete()})}),d=new Mt(m=>{let y;this._zone.runOutsideAngular(()=>{y=this._zone.onStable.subscribe(()=>{di.assertNotInAngularZone(),RC(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,m.next(!0))})})});const T=this._zone.onUnstable.subscribe(()=>{di.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{m.next(!1)}))});return()=>{y.unsubscribe(),T.unsubscribe()}});this.isStable=Or(s,d.pipe(mn()))}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(e,i){const r=e instanceof P0;if(!this._injector.get(vx).done)throw!r&&function Su(n){const t=xr(n)||ks(n)||Rs(n);return null!==t&&t.standalone}(e),new Nt(405,false);let d;d=r?e:this._injector.get(Kd).resolveComponentFactory(e),this.componentTypes.push(d.componentType);const m=function rV(n){return n.isBoundToModule}(d)?void 0:this._injector.get(nm),T=d.create(Xr.NULL,[],i||d.selector,m),M=T.location.nativeElement,R=T.injector.get(ZA,null);return null==R||R.registerApplication(M),T.onDestroy(()=>{this.detachView(T.hostView),Sx(this.components,T),null==R||R.unregisterApplication(M)}),this._loadComponent(T),T}tick(){if(this._runningTick)throw new Nt(101,!1);try{this._runningTick=!0;for(let e of this._views)e.detectChanges()}catch(e){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(e))}finally{this._runningTick=!1}}attachView(e){const i=e;this._views.push(i),i.attachToAppRef(this)}detachView(e){const i=e;Sx(this._views,i),i.detachFromAppRef()}_loadComponent(e){this.attachView(e.hostView),this.tick(),this.components.push(e),this._injector.get($A,[]).concat(this._bootstrapListeners).forEach(r=>r(e))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(e=>e()),this._views.slice().forEach(e=>e.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(e){return this._destroyListeners.push(e),()=>Sx(this._destroyListeners,e)}destroy(){if(this._destroyed)throw new Nt(406,!1);const e=this._injector;e.destroy&&!e.destroyed&&e.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return n.\u0275fac=function(e){return new(e||n)(Ue(di),Ue(tu),Ue(wl))},n.\u0275prov=tn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function Sx(n,t){const e=n.indexOf(t);e>-1&&n.splice(e,1)}let ak=!0,kr=(()=>{class n{}return n.__NG_ELEMENT_ID__=uV,n})();function uV(n){return function dV(n,t,e){if(Fh(n)&&!e){const i=Ls(n.index,t);return new dr(i,i)}return 47&n.type?new dr(t[16],t):null}(zo(),Ot(),16==(16&n))}class hk{constructor(){}supports(t){return xp(t)}create(t){return new bV(t)}}const gV=(n,t)=>t;class bV{constructor(t){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||gV}forEachItem(t){let e;for(e=this._itHead;null!==e;e=e._next)t(e)}forEachOperation(t){let e=this._itHead,i=this._removalsHead,r=0,s=null;for(;e||i;){const d=!i||e&&e.currentIndex<fk(i,r,s)?e:i,m=fk(d,r,s),y=d.currentIndex;if(d===i)r--,i=i._nextRemoved;else if(e=e._next,null==d.previousIndex)r++;else{s||(s=[]);const T=m-r,M=y-r;if(T!=M){for(let H=0;H<T;H++){const Z=H<s.length?s[H]:s[H]=0,te=Z+H;M<=te&&te<T&&(s[H]=Z+1)}s[d.previousIndex]=M-T}}m!==y&&t(d,m,y)}}forEachPreviousItem(t){let e;for(e=this._previousItHead;null!==e;e=e._nextPrevious)t(e)}forEachAddedItem(t){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)}forEachMovedItem(t){let e;for(e=this._movesHead;null!==e;e=e._nextMoved)t(e)}forEachRemovedItem(t){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)}forEachIdentityChange(t){let e;for(e=this._identityChangesHead;null!==e;e=e._nextIdentityChange)t(e)}diff(t){if(null==t&&(t=[]),!xp(t))throw new Nt(900,!1);return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let r,s,d,e=this._itHead,i=!1;if(Array.isArray(t)){this.length=t.length;for(let m=0;m<this.length;m++)s=t[m],d=this._trackByFn(m,s),null!==e&&Object.is(e.trackById,d)?(i&&(e=this._verifyReinsertion(e,s,d,m)),Object.is(e.item,s)||this._addIdentityChange(e,s)):(e=this._mismatch(e,s,d,m),i=!0),e=e._next}else r=0,function Dy(n,t){if(Array.isArray(n))for(let e=0;e<n.length;e++)t(n[e]);else{const e=n[Qu()]();let i;for(;!(i=e.next()).done;)t(i.value)}}(t,m=>{d=this._trackByFn(r,m),null!==e&&Object.is(e.trackById,d)?(i&&(e=this._verifyReinsertion(e,m,d,r)),Object.is(e.item,m)||this._addIdentityChange(e,m)):(e=this._mismatch(e,m,d,r),i=!0),e=e._next,r++}),this.length=r;return this._truncate(e),this.collection=t,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let t;for(t=this._previousItHead=this._itHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;null!==t;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;null!==t;t=t._nextMoved)t.previousIndex=t.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(t,e,i,r){let s;return null===t?s=this._itTail:(s=t._prev,this._remove(t)),null!==(t=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null))?(Object.is(t.item,e)||this._addIdentityChange(t,e),this._reinsertAfter(t,s,r)):null!==(t=null===this._linkedRecords?null:this._linkedRecords.get(i,r))?(Object.is(t.item,e)||this._addIdentityChange(t,e),this._moveAfter(t,s,r)):t=this._addAfter(new _V(e,i),s,r),t}_verifyReinsertion(t,e,i,r){let s=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null);return null!==s?t=this._reinsertAfter(s,t._prev,r):t.currentIndex!=r&&(t.currentIndex=r,this._addToMoves(t,r)),t}_truncate(t){for(;null!==t;){const e=t._next;this._addToRemovals(this._unlink(t)),t=e}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(t,e,i){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(t);const r=t._prevRemoved,s=t._nextRemoved;return null===r?this._removalsHead=s:r._nextRemoved=s,null===s?this._removalsTail=r:s._prevRemoved=r,this._insertAfter(t,e,i),this._addToMoves(t,i),t}_moveAfter(t,e,i){return this._unlink(t),this._insertAfter(t,e,i),this._addToMoves(t,i),t}_addAfter(t,e,i){return this._insertAfter(t,e,i),this._additionsTail=null===this._additionsTail?this._additionsHead=t:this._additionsTail._nextAdded=t,t}_insertAfter(t,e,i){const r=null===e?this._itHead:e._next;return t._next=r,t._prev=e,null===r?this._itTail=t:r._prev=t,null===e?this._itHead=t:e._next=t,null===this._linkedRecords&&(this._linkedRecords=new pk),this._linkedRecords.put(t),t.currentIndex=i,t}_remove(t){return this._addToRemovals(this._unlink(t))}_unlink(t){null!==this._linkedRecords&&this._linkedRecords.remove(t);const e=t._prev,i=t._next;return null===e?this._itHead=i:e._next=i,null===i?this._itTail=e:i._prev=e,t}_addToMoves(t,e){return t.previousIndex===e||(this._movesTail=null===this._movesTail?this._movesHead=t:this._movesTail._nextMoved=t),t}_addToRemovals(t){return null===this._unlinkedRecords&&(this._unlinkedRecords=new pk),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}_addIdentityChange(t,e){return t.item=e,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=t:this._identityChangesTail._nextIdentityChange=t,t}}class _V{constructor(t,e){this.item=t,this.trackById=e,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class yV{constructor(){this._head=null,this._tail=null}add(t){null===this._head?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}get(t,e){let i;for(i=this._head;null!==i;i=i._nextDup)if((null===e||e<=i.currentIndex)&&Object.is(i.trackById,t))return i;return null}remove(t){const e=t._prevDup,i=t._nextDup;return null===e?this._head=i:e._nextDup=i,null===i?this._tail=e:i._prevDup=e,null===this._head}}class pk{constructor(){this.map=new Map}put(t){const e=t.trackById;let i=this.map.get(e);i||(i=new yV,this.map.set(e,i)),i.add(t)}get(t,e){const r=this.map.get(t);return r?r.get(t,e):null}remove(t){const e=t.trackById;return this.map.get(e).remove(t)&&this.map.delete(e),t}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function fk(n,t,e){const i=n.previousIndex;if(null===i)return i;let r=0;return e&&i<e.length&&(r=e[i]),i+t+r}class mk{constructor(){}supports(t){return t instanceof Map||Cl(t)}create(){return new vV}}class vV{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(t){let e;for(e=this._mapHead;null!==e;e=e._next)t(e)}forEachPreviousItem(t){let e;for(e=this._previousMapHead;null!==e;e=e._nextPrevious)t(e)}forEachChangedItem(t){let e;for(e=this._changesHead;null!==e;e=e._nextChanged)t(e)}forEachAddedItem(t){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)}forEachRemovedItem(t){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)}diff(t){if(t){if(!(t instanceof Map||Cl(t)))throw new Nt(900,!1)}else t=new Map;return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let e=this._mapHead;if(this._appendAfter=null,this._forEach(t,(i,r)=>{if(e&&e.key===r)this._maybeAddToChanges(e,i),this._appendAfter=e,e=e._next;else{const s=this._getOrCreateRecordForKey(r,i);e=this._insertBeforeOrAppend(e,s)}}),e){e._prev&&(e._prev._next=null),this._removalsHead=e;for(let i=e;null!==i;i=i._nextRemoved)i===this._mapHead&&(this._mapHead=null),this._records.delete(i.key),i._nextRemoved=i._next,i.previousValue=i.currentValue,i.currentValue=null,i._prev=null,i._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(t,e){if(t){const i=t._prev;return e._next=t,e._prev=i,t._prev=e,i&&(i._next=e),t===this._mapHead&&(this._mapHead=e),this._appendAfter=t,t}return this._appendAfter?(this._appendAfter._next=e,e._prev=this._appendAfter):this._mapHead=e,this._appendAfter=e,null}_getOrCreateRecordForKey(t,e){if(this._records.has(t)){const r=this._records.get(t);this._maybeAddToChanges(r,e);const s=r._prev,d=r._next;return s&&(s._next=d),d&&(d._prev=s),r._next=null,r._prev=null,r}const i=new xV(t);return this._records.set(t,i),i.currentValue=e,this._addToAdditions(i),i}_reset(){if(this.isDirty){let t;for(this._previousMapHead=this._mapHead,t=this._previousMapHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._changesHead;null!==t;t=t._nextChanged)t.previousValue=t.currentValue;for(t=this._additionsHead;null!=t;t=t._nextAdded)t.previousValue=t.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(t,e){Object.is(e,t.currentValue)||(t.previousValue=t.currentValue,t.currentValue=e,this._addToChanges(t))}_addToAdditions(t){null===this._additionsHead?this._additionsHead=this._additionsTail=t:(this._additionsTail._nextAdded=t,this._additionsTail=t)}_addToChanges(t){null===this._changesHead?this._changesHead=this._changesTail=t:(this._changesTail._nextChanged=t,this._changesTail=t)}_forEach(t,e){t instanceof Map?t.forEach(e):Object.keys(t).forEach(i=>e(t[i],i))}}class xV{constructor(t){this.key=t,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function gk(){return new od([new hk])}let od=(()=>{class n{constructor(e){this.factories=e}static create(e,i){if(null!=i){const r=i.factories.slice();e=e.concat(r)}return new n(e)}static extend(e){return{provide:n,useFactory:i=>n.create(e,i||gk()),deps:[[n,new ep,new Jh]]}}find(e){const i=this.factories.find(r=>r.supports(e));if(null!=i)return i;throw new Nt(901,!1)}}return n.\u0275prov=tn({token:n,providedIn:"root",factory:gk}),n})();function bk(){return new jy([new mk])}let jy=(()=>{class n{constructor(e){this.factories=e}static create(e,i){if(i){const r=i.factories.slice();e=e.concat(r)}return new n(e)}static extend(e){return{provide:n,useFactory:i=>n.create(e,i||bk()),deps:[[n,new ep,new Jh]]}}find(e){const i=this.factories.find(r=>r.supports(e));if(i)return i;throw new Nt(901,!1)}}return n.\u0275prov=tn({token:n,providedIn:"root",factory:bk}),n})();const CV=JA(null,"core",[]);let TV=(()=>{class n{constructor(e){}}return n.\u0275fac=function(e){return new(e||n)(Ue(Cb))},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({}),n})();function uh(n){return"boolean"==typeof n?n:null!=n&&"false"!==n}let Ex=null;function sd(){return Ex}const ui=new Dt("DocumentToken");let HC=(()=>{class n{historyGo(e){throw new Error("Not implemented")}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=tn({token:n,factory:function(){return function MV(){return Ue(_k)}()},providedIn:"platform"}),n})();const AV=new Dt("Location Initialized");let _k=(()=>{class n extends HC{constructor(e){super(),this._doc=e,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return sd().getBaseHref(this._doc)}onPopState(e){const i=sd().getGlobalEventTarget(this._doc,"window");return i.addEventListener("popstate",e,!1),()=>i.removeEventListener("popstate",e)}onHashChange(e){const i=sd().getGlobalEventTarget(this._doc,"window");return i.addEventListener("hashchange",e,!1),()=>i.removeEventListener("hashchange",e)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(e){this.location.pathname=e}pushState(e,i,r){yk()?this._history.pushState(e,i,r):this.location.hash=r}replaceState(e,i,r){yk()?this._history.replaceState(e,i,r):this.location.hash=r}forward(){this._history.forward()}back(){this._history.back()}historyGo(e=0){this._history.go(e)}getState(){return this._history.state}}return n.\u0275fac=function(e){return new(e||n)(Ue(ui))},n.\u0275prov=tn({token:n,factory:function(){return function kV(){return new _k(Ue(ui))}()},providedIn:"platform"}),n})();function yk(){return!!window.history.pushState}function $C(n,t){if(0==n.length)return t;if(0==t.length)return n;let e=0;return n.endsWith("/")&&e++,t.startsWith("/")&&e++,2==e?n+t.substring(1):1==e?n+t:n+"/"+t}function vk(n){const t=n.match(/#|\?|$/),e=t&&t.index||n.length;return n.slice(0,e-("/"===n[e-1]?1:0))+n.slice(e)}function dh(n){return n&&"?"!==n[0]?"?"+n:n}let sm=(()=>{class n{historyGo(e){throw new Error("Not implemented")}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=tn({token:n,factory:function(){return Wr(wk)},providedIn:"root"}),n})();const xk=new Dt("appBaseHref");let wk=(()=>{class n extends sm{constructor(e,i){var r,s,d;super(),this._platformLocation=e,this._removeListenerFns=[],this._baseHref=null!==(d=null!==(r=null!=i?i:this._platformLocation.getBaseHrefFromDOM())&&void 0!==r?r:null===(s=Wr(ui).location)||void 0===s?void 0:s.origin)&&void 0!==d?d:""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}prepareExternalUrl(e){return $C(this._baseHref,e)}path(e=!1){const i=this._platformLocation.pathname+dh(this._platformLocation.search),r=this._platformLocation.hash;return r&&e?`${i}${r}`:i}pushState(e,i,r,s){const d=this.prepareExternalUrl(r+dh(s));this._platformLocation.pushState(e,i,d)}replaceState(e,i,r,s){const d=this.prepareExternalUrl(r+dh(s));this._platformLocation.replaceState(e,i,d)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){var i,r;null===(r=(i=this._platformLocation).historyGo)||void 0===r||r.call(i,e)}}return n.\u0275fac=function(e){return new(e||n)(Ue(HC),Ue(xk,8))},n.\u0275prov=tn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),RV=(()=>{class n extends sm{constructor(e,i){super(),this._platformLocation=e,this._baseHref="",this._removeListenerFns=[],null!=i&&(this._baseHref=i)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}path(e=!1){let i=this._platformLocation.hash;return null==i&&(i="#"),i.length>0?i.substring(1):i}prepareExternalUrl(e){const i=$C(this._baseHref,e);return i.length>0?"#"+i:i}pushState(e,i,r,s){let d=this.prepareExternalUrl(r+dh(s));0==d.length&&(d=this._platformLocation.pathname),this._platformLocation.pushState(e,i,d)}replaceState(e,i,r,s){let d=this.prepareExternalUrl(r+dh(s));0==d.length&&(d=this._platformLocation.pathname),this._platformLocation.replaceState(e,i,d)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){var i,r;null===(r=(i=this._platformLocation).historyGo)||void 0===r||r.call(i,e)}}return n.\u0275fac=function(e){return new(e||n)(Ue(HC),Ue(xk,8))},n.\u0275prov=tn({token:n,factory:n.\u0275fac}),n})(),Dx=(()=>{class n{constructor(e){this._subject=new on,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=e;const i=this._locationStrategy.getBaseHref();this._baseHref=vk(Sk(i)),this._locationStrategy.onPopState(r=>{this._subject.emit({url:this.path(!0),pop:!0,state:r.state,type:r.type})})}ngOnDestroy(){var e;null===(e=this._urlChangeSubscription)||void 0===e||e.unsubscribe(),this._urlChangeListeners=[]}path(e=!1){return this.normalize(this._locationStrategy.path(e))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(e,i=""){return this.path()==this.normalize(e+dh(i))}normalize(e){return n.stripTrailingSlash(function OV(n,t){return n&&t.startsWith(n)?t.substring(n.length):t}(this._baseHref,Sk(e)))}prepareExternalUrl(e){return e&&"/"!==e[0]&&(e="/"+e),this._locationStrategy.prepareExternalUrl(e)}go(e,i="",r=null){this._locationStrategy.pushState(r,"",e,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+dh(i)),r)}replaceState(e,i="",r=null){this._locationStrategy.replaceState(r,"",e,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+dh(i)),r)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(e=0){var i,r;null===(r=(i=this._locationStrategy).historyGo)||void 0===r||r.call(i,e)}onUrlChange(e){return this._urlChangeListeners.push(e),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(i=>{this._notifyUrlChangeListeners(i.url,i.state)})),()=>{var i;const r=this._urlChangeListeners.indexOf(e);this._urlChangeListeners.splice(r,1),0===this._urlChangeListeners.length&&(null===(i=this._urlChangeSubscription)||void 0===i||i.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(e="",i){this._urlChangeListeners.forEach(r=>r(e,i))}subscribe(e,i,r){return this._subject.subscribe({next:e,error:i,complete:r})}}return n.normalizeQueryParams=dh,n.joinWithSlash=$C,n.stripTrailingSlash=vk,n.\u0275fac=function(e){return new(e||n)(Ue(sm))},n.\u0275prov=tn({token:n,factory:function(){return function PV(){return new Dx(Ue(sm))}()},providedIn:"root"}),n})();function Sk(n){return n.replace(/\/index.html$/,"")}var ds=(()=>((ds=ds||{})[ds.Format=0]="Format",ds[ds.Standalone=1]="Standalone",ds))(),mr=(()=>((mr=mr||{})[mr.Narrow=0]="Narrow",mr[mr.Abbreviated=1]="Abbreviated",mr[mr.Wide=2]="Wide",mr[mr.Short=3]="Short",mr))(),qo=(()=>((qo=qo||{})[qo.Short=0]="Short",qo[qo.Medium=1]="Medium",qo[qo.Long=2]="Long",qo[qo.Full=3]="Full",qo))(),Si=(()=>((Si=Si||{})[Si.Decimal=0]="Decimal",Si[Si.Group=1]="Group",Si[Si.List=2]="List",Si[Si.PercentSign=3]="PercentSign",Si[Si.PlusSign=4]="PlusSign",Si[Si.MinusSign=5]="MinusSign",Si[Si.Exponential=6]="Exponential",Si[Si.SuperscriptingExponent=7]="SuperscriptingExponent",Si[Si.PerMille=8]="PerMille",Si[Si.Infinity=9]="Infinity",Si[Si.NaN=10]="NaN",Si[Si.TimeSeparator=11]="TimeSeparator",Si[Si.CurrencyDecimal=12]="CurrencyDecimal",Si[Si.CurrencyGroup=13]="CurrencyGroup",Si))();function Ix(n,t){return kc(el(n)[jn.DateFormat],t)}function Mx(n,t){return kc(el(n)[jn.TimeFormat],t)}function Ax(n,t){return kc(el(n)[jn.DateTimeFormat],t)}function Ac(n,t){const e=el(n),i=e[jn.NumberSymbols][t];if(void 0===i){if(t===Si.CurrencyDecimal)return e[jn.NumberSymbols][Si.Decimal];if(t===Si.CurrencyGroup)return e[jn.NumberSymbols][Si.Group]}return i}function Tk(n){if(!n[jn.ExtraData])throw new Error(`Missing extra locale data for the locale "${n[jn.LocaleId]}". Use "registerLocaleData" to load new data. See the "I18n guide" on angular.io to know more.`)}function kc(n,t){for(let e=t;e>-1;e--)if(void 0!==n[e])return n[e];throw new Error("Locale data API: locale data undefined")}function GC(n){const[t,e]=n.split(":");return{hours:+t,minutes:+e}}const WV=/^(\d{4,})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,Uy={},XV=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;var Vs=(()=>((Vs=Vs||{})[Vs.Short=0]="Short",Vs[Vs.ShortGMT=1]="ShortGMT",Vs[Vs.Long=2]="Long",Vs[Vs.Extended=3]="Extended",Vs))(),Ri=(()=>((Ri=Ri||{})[Ri.FullYear=0]="FullYear",Ri[Ri.Month=1]="Month",Ri[Ri.Date=2]="Date",Ri[Ri.Hours=3]="Hours",Ri[Ri.Minutes=4]="Minutes",Ri[Ri.Seconds=5]="Seconds",Ri[Ri.FractionalSeconds=6]="FractionalSeconds",Ri[Ri.Day=7]="Day",Ri))(),Qi=(()=>((Qi=Qi||{})[Qi.DayPeriods=0]="DayPeriods",Qi[Qi.Days=1]="Days",Qi[Qi.Months=2]="Months",Qi[Qi.Eras=3]="Eras",Qi))();function ZV(n,t,e,i){let r=function rj(n){if(Ik(n))return n;if("number"==typeof n&&!isNaN(n))return new Date(n);if("string"==typeof n){if(n=n.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(n)){const[r,s=1,d=1]=n.split("-").map(m=>+m);return kx(r,s-1,d)}const e=parseFloat(n);if(!isNaN(n-e))return new Date(e);let i;if(i=n.match(WV))return function oj(n){const t=new Date(0);let e=0,i=0;const r=n[8]?t.setUTCFullYear:t.setFullYear,s=n[8]?t.setUTCHours:t.setHours;n[9]&&(e=Number(n[9]+n[10]),i=Number(n[9]+n[11])),r.call(t,Number(n[1]),Number(n[2])-1,Number(n[3]));const d=Number(n[4]||0)-e,m=Number(n[5]||0)-i,y=Number(n[6]||0),T=Math.floor(1e3*parseFloat("0."+(n[7]||0)));return s.call(t,d,m,y,T),t}(i)}const t=new Date(n);if(!Ik(t))throw new Error(`Unable to convert "${n}" into a date`);return t}(n);t=hh(e,t)||t;let m,d=[];for(;t;){if(m=XV.exec(t),!m){d.push(t);break}{d=d.concat(m.slice(1));const M=d.pop();if(!M)break;t=M}}let y=r.getTimezoneOffset();i&&(y=Dk(i,y),r=function ij(n,t,e){const i=e?-1:1,r=n.getTimezoneOffset();return function nj(n,t){return(n=new Date(n.getTime())).setMinutes(n.getMinutes()+t),n}(n,i*(Dk(t,r)-r))}(r,i,!0));let T="";return d.forEach(M=>{const R=function tj(n){if(XC[n])return XC[n];let t;switch(n){case"G":case"GG":case"GGG":t=xo(Qi.Eras,mr.Abbreviated);break;case"GGGG":t=xo(Qi.Eras,mr.Wide);break;case"GGGGG":t=xo(Qi.Eras,mr.Narrow);break;case"y":t=Ts(Ri.FullYear,1,0,!1,!0);break;case"yy":t=Ts(Ri.FullYear,2,0,!0,!0);break;case"yyy":t=Ts(Ri.FullYear,3,0,!1,!0);break;case"yyyy":t=Ts(Ri.FullYear,4,0,!1,!0);break;case"Y":t=Lx(1);break;case"YY":t=Lx(2,!0);break;case"YYY":t=Lx(3);break;case"YYYY":t=Lx(4);break;case"M":case"L":t=Ts(Ri.Month,1,1);break;case"MM":case"LL":t=Ts(Ri.Month,2,1);break;case"MMM":t=xo(Qi.Months,mr.Abbreviated);break;case"MMMM":t=xo(Qi.Months,mr.Wide);break;case"MMMMM":t=xo(Qi.Months,mr.Narrow);break;case"LLL":t=xo(Qi.Months,mr.Abbreviated,ds.Standalone);break;case"LLLL":t=xo(Qi.Months,mr.Wide,ds.Standalone);break;case"LLLLL":t=xo(Qi.Months,mr.Narrow,ds.Standalone);break;case"w":t=WC(1);break;case"ww":t=WC(2);break;case"W":t=WC(1,!0);break;case"d":t=Ts(Ri.Date,1);break;case"dd":t=Ts(Ri.Date,2);break;case"c":case"cc":t=Ts(Ri.Day,1);break;case"ccc":t=xo(Qi.Days,mr.Abbreviated,ds.Standalone);break;case"cccc":t=xo(Qi.Days,mr.Wide,ds.Standalone);break;case"ccccc":t=xo(Qi.Days,mr.Narrow,ds.Standalone);break;case"cccccc":t=xo(Qi.Days,mr.Short,ds.Standalone);break;case"E":case"EE":case"EEE":t=xo(Qi.Days,mr.Abbreviated);break;case"EEEE":t=xo(Qi.Days,mr.Wide);break;case"EEEEE":t=xo(Qi.Days,mr.Narrow);break;case"EEEEEE":t=xo(Qi.Days,mr.Short);break;case"a":case"aa":case"aaa":t=xo(Qi.DayPeriods,mr.Abbreviated);break;case"aaaa":t=xo(Qi.DayPeriods,mr.Wide);break;case"aaaaa":t=xo(Qi.DayPeriods,mr.Narrow);break;case"b":case"bb":case"bbb":t=xo(Qi.DayPeriods,mr.Abbreviated,ds.Standalone,!0);break;case"bbbb":t=xo(Qi.DayPeriods,mr.Wide,ds.Standalone,!0);break;case"bbbbb":t=xo(Qi.DayPeriods,mr.Narrow,ds.Standalone,!0);break;case"B":case"BB":case"BBB":t=xo(Qi.DayPeriods,mr.Abbreviated,ds.Format,!0);break;case"BBBB":t=xo(Qi.DayPeriods,mr.Wide,ds.Format,!0);break;case"BBBBB":t=xo(Qi.DayPeriods,mr.Narrow,ds.Format,!0);break;case"h":t=Ts(Ri.Hours,1,-12);break;case"hh":t=Ts(Ri.Hours,2,-12);break;case"H":t=Ts(Ri.Hours,1);break;case"HH":t=Ts(Ri.Hours,2);break;case"m":t=Ts(Ri.Minutes,1);break;case"mm":t=Ts(Ri.Minutes,2);break;case"s":t=Ts(Ri.Seconds,1);break;case"ss":t=Ts(Ri.Seconds,2);break;case"S":t=Ts(Ri.FractionalSeconds,1);break;case"SS":t=Ts(Ri.FractionalSeconds,2);break;case"SSS":t=Ts(Ri.FractionalSeconds,3);break;case"Z":case"ZZ":case"ZZZ":t=Px(Vs.Short);break;case"ZZZZZ":t=Px(Vs.Extended);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":t=Px(Vs.ShortGMT);break;case"OOOO":case"ZZZZ":case"zzzz":t=Px(Vs.Long);break;default:return null}return XC[n]=t,t}(M);T+=R?R(r,e,y):"''"===M?"'":M.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),T}function kx(n,t,e){const i=new Date(0);return i.setFullYear(n,t,e),i.setHours(0,0,0),i}function hh(n,t){const e=function LV(n){return el(n)[jn.LocaleId]}(n);if(Uy[e]=Uy[e]||{},Uy[e][t])return Uy[e][t];let i="";switch(t){case"shortDate":i=Ix(n,qo.Short);break;case"mediumDate":i=Ix(n,qo.Medium);break;case"longDate":i=Ix(n,qo.Long);break;case"fullDate":i=Ix(n,qo.Full);break;case"shortTime":i=Mx(n,qo.Short);break;case"mediumTime":i=Mx(n,qo.Medium);break;case"longTime":i=Mx(n,qo.Long);break;case"fullTime":i=Mx(n,qo.Full);break;case"short":const r=hh(n,"shortTime"),s=hh(n,"shortDate");i=Rx(Ax(n,qo.Short),[r,s]);break;case"medium":const d=hh(n,"mediumTime"),m=hh(n,"mediumDate");i=Rx(Ax(n,qo.Medium),[d,m]);break;case"long":const y=hh(n,"longTime"),T=hh(n,"longDate");i=Rx(Ax(n,qo.Long),[y,T]);break;case"full":const M=hh(n,"fullTime"),R=hh(n,"fullDate");i=Rx(Ax(n,qo.Full),[M,R])}return i&&(Uy[e][t]=i),i}function Rx(n,t){return t&&(n=n.replace(/\{([^}]+)}/g,function(e,i){return null!=t&&i in t?t[i]:e})),n}function du(n,t,e="-",i,r){let s="";(n<0||r&&n<=0)&&(r?n=1-n:(n=-n,s=e));let d=String(n);for(;d.length<t;)d="0"+d;return i&&(d=d.slice(d.length-t)),s+d}function Ts(n,t,e=0,i=!1,r=!1){return function(s,d){let m=function KV(n,t){switch(n){case Ri.FullYear:return t.getFullYear();case Ri.Month:return t.getMonth();case Ri.Date:return t.getDate();case Ri.Hours:return t.getHours();case Ri.Minutes:return t.getMinutes();case Ri.Seconds:return t.getSeconds();case Ri.FractionalSeconds:return t.getMilliseconds();case Ri.Day:return t.getDay();default:throw new Error(`Unknown DateType value "${n}".`)}}(n,s);if((e>0||m>-e)&&(m+=e),n===Ri.Hours)0===m&&-12===e&&(m=12);else if(n===Ri.FractionalSeconds)return function YV(n,t){return du(n,3).substring(0,t)}(m,t);const y=Ac(d,Si.MinusSign);return du(m,t,y,i,r)}}function xo(n,t,e=ds.Format,i=!1){return function(r,s){return function QV(n,t,e,i,r,s){switch(e){case Qi.Months:return function BV(n,t,e){const i=el(n),s=kc([i[jn.MonthsFormat],i[jn.MonthsStandalone]],t);return kc(s,e)}(t,r,i)[n.getMonth()];case Qi.Days:return function NV(n,t,e){const i=el(n),s=kc([i[jn.DaysFormat],i[jn.DaysStandalone]],t);return kc(s,e)}(t,r,i)[n.getDay()];case Qi.DayPeriods:const d=n.getHours(),m=n.getMinutes();if(s){const T=function UV(n){const t=el(n);return Tk(t),(t[jn.ExtraData][2]||[]).map(i=>"string"==typeof i?GC(i):[GC(i[0]),GC(i[1])])}(t),M=function HV(n,t,e){const i=el(n);Tk(i);const s=kc([i[jn.ExtraData][0],i[jn.ExtraData][1]],t)||[];return kc(s,e)||[]}(t,r,i),R=T.findIndex(H=>{if(Array.isArray(H)){const[Z,te]=H,xe=d>=Z.hours&&m>=Z.minutes,Ce=d<te.hours||d===te.hours&&m<te.minutes;if(Z.hours<te.hours){if(xe&&Ce)return!0}else if(xe||Ce)return!0}else if(H.hours===d&&H.minutes===m)return!0;return!1});if(-1!==R)return M[R]}return function FV(n,t,e){const i=el(n),s=kc([i[jn.DayPeriodsFormat],i[jn.DayPeriodsStandalone]],t);return kc(s,e)}(t,r,i)[d<12?0:1];case Qi.Eras:return function zV(n,t){return kc(el(n)[jn.Eras],t)}(t,i)[n.getFullYear()<=0?0:1];default:throw new Error(`unexpected translation type ${e}`)}}(r,s,n,t,e,i)}}function Px(n){return function(t,e,i){const r=-1*i,s=Ac(e,Si.MinusSign),d=r>0?Math.floor(r/60):Math.ceil(r/60);switch(n){case Vs.Short:return(r>=0?"+":"")+du(d,2,s)+du(Math.abs(r%60),2,s);case Vs.ShortGMT:return"GMT"+(r>=0?"+":"")+du(d,1,s);case Vs.Long:return"GMT"+(r>=0?"+":"")+du(d,2,s)+":"+du(Math.abs(r%60),2,s);case Vs.Extended:return 0===i?"Z":(r>=0?"+":"")+du(d,2,s)+":"+du(Math.abs(r%60),2,s);default:throw new Error(`Unknown zone width "${n}"`)}}}function Ek(n){return kx(n.getFullYear(),n.getMonth(),n.getDate()+(4-n.getDay()))}function WC(n,t=!1){return function(e,i){let r;if(t){const s=new Date(e.getFullYear(),e.getMonth(),1).getDay()-1,d=e.getDate();r=1+Math.floor((d+s)/7)}else{const s=Ek(e),d=function ej(n){const t=kx(n,0,1).getDay();return kx(n,0,1+(t<=4?4:11)-t)}(s.getFullYear()),m=s.getTime()-d.getTime();r=1+Math.round(m/6048e5)}return du(r,n,Ac(i,Si.MinusSign))}}function Lx(n,t=!1){return function(e,i){return du(Ek(e).getFullYear(),n,Ac(i,Si.MinusSign),t)}}const XC={};function Dk(n,t){n=n.replace(/:/g,"");const e=Date.parse("Jan 01, 1970 00:00:00 "+n)/6e4;return isNaN(e)?t:e}function Ik(n){return n instanceof Date&&!isNaN(n.valueOf())}function Rk(n,t){t=encodeURIComponent(t);for(const e of n.split(";")){const i=e.indexOf("="),[r,s]=-1==i?[e,""]:[e.slice(0,i),e.slice(i+1)];if(r.trim()===t)return decodeURIComponent(s)}return null}let Tb=(()=>{class n{constructor(e,i,r,s){this._iterableDiffers=e,this._keyValueDiffers=i,this._ngEl=r,this._renderer=s,this._iterableDiffer=null,this._keyValueDiffer=null,this._initialClasses=[],this._rawClass=null}set klass(e){this._removeClasses(this._initialClasses),this._initialClasses="string"==typeof e?e.split(/\s+/):[],this._applyClasses(this._initialClasses),this._applyClasses(this._rawClass)}set ngClass(e){this._removeClasses(this._rawClass),this._applyClasses(this._initialClasses),this._iterableDiffer=null,this._keyValueDiffer=null,this._rawClass="string"==typeof e?e.split(/\s+/):e,this._rawClass&&(xp(this._rawClass)?this._iterableDiffer=this._iterableDiffers.find(this._rawClass).create():this._keyValueDiffer=this._keyValueDiffers.find(this._rawClass).create())}ngDoCheck(){if(this._iterableDiffer){const e=this._iterableDiffer.diff(this._rawClass);e&&this._applyIterableChanges(e)}else if(this._keyValueDiffer){const e=this._keyValueDiffer.diff(this._rawClass);e&&this._applyKeyValueChanges(e)}}_applyKeyValueChanges(e){e.forEachAddedItem(i=>this._toggleClass(i.key,i.currentValue)),e.forEachChangedItem(i=>this._toggleClass(i.key,i.currentValue)),e.forEachRemovedItem(i=>{i.previousValue&&this._toggleClass(i.key,!1)})}_applyIterableChanges(e){e.forEachAddedItem(i=>{if("string"!=typeof i.item)throw new Error(`NgClass can only toggle CSS classes expressed as strings, got ${Zi(i.item)}`);this._toggleClass(i.item,!0)}),e.forEachRemovedItem(i=>this._toggleClass(i.item,!1))}_applyClasses(e){e&&(Array.isArray(e)||e instanceof Set?e.forEach(i=>this._toggleClass(i,!0)):Object.keys(e).forEach(i=>this._toggleClass(i,!!e[i])))}_removeClasses(e){e&&(Array.isArray(e)||e instanceof Set?e.forEach(i=>this._toggleClass(i,!1)):Object.keys(e).forEach(i=>this._toggleClass(i,!1)))}_toggleClass(e,i){(e=e.trim())&&e.split(/\s+/g).forEach(r=>{i?this._renderer.addClass(this._ngEl.nativeElement,r):this._renderer.removeClass(this._ngEl.nativeElement,r)})}}return n.\u0275fac=function(e){return new(e||n)(X(od),X(jy),X(zn),X(xc))},n.\u0275dir=Ft({type:n,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"},standalone:!0}),n})();class _j{constructor(t,e,i,r){this.$implicit=t,this.ngForOf=e,this.index=i,this.count=r}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let Rc=(()=>{class n{constructor(e,i,r){this._viewContainer=e,this._template=i,this._differs=r,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(e){this._ngForOf=e,this._ngForOfDirty=!0}set ngForTrackBy(e){this._trackByFn=e}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(e){e&&(this._template=e)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const e=this._ngForOf;!this._differ&&e&&(this._differ=this._differs.find(e).create(this.ngForTrackBy))}if(this._differ){const e=this._differ.diff(this._ngForOf);e&&this._applyChanges(e)}}_applyChanges(e){const i=this._viewContainer;e.forEachOperation((r,s,d)=>{if(null==r.previousIndex)i.createEmbeddedView(this._template,new _j(r.item,this._ngForOf,-1,-1),null===d?void 0:d);else if(null==d)i.remove(null===s?void 0:s);else if(null!==s){const m=i.get(s);i.move(m,d),Lk(m,r)}});for(let r=0,s=i.length;r<s;r++){const m=i.get(r).context;m.index=r,m.count=s,m.ngForOf=this._ngForOf}e.forEachIdentityChange(r=>{Lk(i.get(r.currentIndex),r)})}static ngTemplateContextGuard(e,i){return!0}}return n.\u0275fac=function(e){return new(e||n)(X(Qo),X(ho),X(od))},n.\u0275dir=Ft({type:n,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0}),n})();function Lk(n,t){n.context.$implicit=t.item}let js=(()=>{class n{constructor(e,i){this._viewContainer=e,this._context=new vj,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=i}set ngIf(e){this._context.$implicit=this._context.ngIf=e,this._updateView()}set ngIfThen(e){Fk("ngIfThen",e),this._thenTemplateRef=e,this._thenViewRef=null,this._updateView()}set ngIfElse(e){Fk("ngIfElse",e),this._elseTemplateRef=e,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(e,i){return!0}}return n.\u0275fac=function(e){return new(e||n)(X(Qo),X(ho))},n.\u0275dir=Ft({type:n,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0}),n})();class vj{constructor(){this.$implicit=null,this.ngIf=null}}function Fk(n,t){if(t&&!t.createEmbeddedView)throw new Error(`${n} must be a TemplateRef, but received '${Zi(t)}'.`)}class eT{constructor(t,e){this._viewContainerRef=t,this._templateRef=e,this._created=!1}create(){this._created=!0,this._viewContainerRef.createEmbeddedView(this._templateRef)}destroy(){this._created=!1,this._viewContainerRef.clear()}enforceState(t){t&&!this._created?this.create():!t&&this._created&&this.destroy()}}let Eb=(()=>{class n{constructor(){this._defaultUsed=!1,this._caseCount=0,this._lastCaseCheckIndex=0,this._lastCasesMatched=!1}set ngSwitch(e){this._ngSwitch=e,0===this._caseCount&&this._updateDefaultCases(!0)}_addCase(){return this._caseCount++}_addDefault(e){this._defaultViews||(this._defaultViews=[]),this._defaultViews.push(e)}_matchCase(e){const i=e==this._ngSwitch;return this._lastCasesMatched=this._lastCasesMatched||i,this._lastCaseCheckIndex++,this._lastCaseCheckIndex===this._caseCount&&(this._updateDefaultCases(!this._lastCasesMatched),this._lastCaseCheckIndex=0,this._lastCasesMatched=!1),i}_updateDefaultCases(e){if(this._defaultViews&&e!==this._defaultUsed){this._defaultUsed=e;for(let i=0;i<this._defaultViews.length;i++)this._defaultViews[i].enforceState(e)}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=Ft({type:n,selectors:[["","ngSwitch",""]],inputs:{ngSwitch:"ngSwitch"},standalone:!0}),n})(),Nx=(()=>{class n{constructor(e,i,r){this.ngSwitch=r,r._addCase(),this._view=new eT(e,i)}ngDoCheck(){this._view.enforceState(this.ngSwitch._matchCase(this.ngSwitchCase))}}return n.\u0275fac=function(e){return new(e||n)(X(Qo),X(ho),X(Eb,9))},n.\u0275dir=Ft({type:n,selectors:[["","ngSwitchCase",""]],inputs:{ngSwitchCase:"ngSwitchCase"},standalone:!0}),n})(),Bk=(()=>{class n{constructor(e,i,r){this._ngEl=e,this._differs=i,this._renderer=r,this._ngStyle=null,this._differ=null}set ngStyle(e){this._ngStyle=e,!this._differ&&e&&(this._differ=this._differs.find(e).create())}ngDoCheck(){if(this._differ){const e=this._differ.diff(this._ngStyle);e&&this._applyChanges(e)}}_setStyle(e,i){const[r,s]=e.split("."),d=-1===r.indexOf("-")?void 0:fa.DashCase;null!=i?this._renderer.setStyle(this._ngEl.nativeElement,r,s?`${i}${s}`:i,d):this._renderer.removeStyle(this._ngEl.nativeElement,r,d)}_applyChanges(e){e.forEachRemovedItem(i=>this._setStyle(i.key,null)),e.forEachAddedItem(i=>this._setStyle(i.key,i.currentValue)),e.forEachChangedItem(i=>this._setStyle(i.key,i.currentValue))}}return n.\u0275fac=function(e){return new(e||n)(X(zn),X(jy),X(xc))},n.\u0275dir=Ft({type:n,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"},standalone:!0}),n})(),tT=(()=>{class n{constructor(e){this._viewContainerRef=e,this._viewRef=null,this.ngTemplateOutletContext=null,this.ngTemplateOutlet=null,this.ngTemplateOutletInjector=null}ngOnChanges(e){if(e.ngTemplateOutlet||e.ngTemplateOutletInjector){const i=this._viewContainerRef;if(this._viewRef&&i.remove(i.indexOf(this._viewRef)),this.ngTemplateOutlet){const{ngTemplateOutlet:r,ngTemplateOutletContext:s,ngTemplateOutletInjector:d}=this;this._viewRef=i.createEmbeddedView(r,s,d?{injector:d}:void 0)}else this._viewRef=null}else this._viewRef&&e.ngTemplateOutletContext&&this.ngTemplateOutletContext&&(this._viewRef.context=this.ngTemplateOutletContext)}}return n.\u0275fac=function(e){return new(e||n)(X(Qo))},n.\u0275dir=Ft({type:n,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet",ngTemplateOutletInjector:"ngTemplateOutletInjector"},standalone:!0,features:[_r]}),n})();function hu(n,t){return new Nt(2100,!1)}class Sj{createSubscription(t,e){return t.subscribe({next:e,error:i=>{throw i}})}dispose(t){t.unsubscribe()}}class Cj{createSubscription(t,e){return t.then(e,i=>{throw i})}dispose(t){}}const Tj=new Cj,Ej=new Sj;let $y=(()=>{class n{constructor(e){this._latestValue=null,this._subscription=null,this._obj=null,this._strategy=null,this._ref=e}ngOnDestroy(){this._subscription&&this._dispose(),this._ref=null}transform(e){return this._obj?e!==this._obj?(this._dispose(),this.transform(e)):this._latestValue:(e&&this._subscribe(e),this._latestValue)}_subscribe(e){this._obj=e,this._strategy=this._selectStrategy(e),this._subscription=this._strategy.createSubscription(e,i=>this._updateLatestValue(e,i))}_selectStrategy(e){if(Iy(e))return Tj;if(jI(e))return Ej;throw hu()}_dispose(){this._strategy.dispose(this._subscription),this._latestValue=null,this._subscription=null,this._obj=null}_updateLatestValue(e,i){e===this._obj&&(this._latestValue=i,this._ref.markForCheck())}}return n.\u0275fac=function(e){return new(e||n)(X(kr,16))},n.\u0275pipe=Po({name:"async",type:n,pure:!1,standalone:!0}),n})();const Ij=/(?:[0-9A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u0870-\u0887\u0889-\u088E\u08A0-\u08C9\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C5D\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u1711\u171F-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4C\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7CA\uA7D0\uA7D1\uA7D3\uA7D5-\uA7D9\uA7F2-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF40\uDF42-\uDF49\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67\uDF80-\uDF85\uDF87-\uDFB0\uDFB2-\uDFBA]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDE80-\uDEA9\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDF70-\uDF81\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC71\uDC72\uDC75\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A\uDF40-\uDF46]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEB0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDEE0-\uDEF2\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC80-\uDD43]|\uD80B[\uDF90-\uDFF0]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE70-\uDEBE\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD837[\uDF00-\uDF1E]|\uD838[\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDE90-\uDEAD\uDEC0-\uDEEB]|\uD839[\uDFE0-\uDFE6\uDFE8-\uDFEB\uDFED\uDFEE\uDFF0-\uDFFE]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF38\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])\S*/g;let zk=(()=>{class n{transform(e){if(null==e)return null;if("string"!=typeof e)throw hu();return e.replace(Ij,i=>i[0].toUpperCase()+i.slice(1).toLowerCase())}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275pipe=Po({name:"titlecase",type:n,pure:!0,standalone:!0}),n})();const Aj=new Dt("DATE_PIPE_DEFAULT_TIMEZONE");let Vk=(()=>{class n{constructor(e,i){this.locale=e,this.defaultTimezone=i}transform(e,i="mediumDate",r,s){var d;if(null==e||""===e||e!=e)return null;try{return ZV(e,i,s||this.locale,null!==(d=null!=r?r:this.defaultTimezone)&&void 0!==d?d:void 0)}catch(m){throw hu()}}}return n.\u0275fac=function(e){return new(e||n)(X(Ql,16),X(Aj,24))},n.\u0275pipe=Po({name:"date",type:n,pure:!0,standalone:!0}),n})(),Tr=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({}),n})();const Uk="browser";let qj=(()=>{class n{}return n.\u0275prov=tn({token:n,providedIn:"root",factory:()=>new Gj(Ue(ui),window)}),n})();class Gj{constructor(t,e){this.document=t,this.window=e,this.offset=()=>[0,0]}setOffset(t){this.offset=Array.isArray(t)?()=>t:t}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(t){this.supportsScrolling()&&this.window.scrollTo(t[0],t[1])}scrollToAnchor(t){if(!this.supportsScrolling())return;const e=function Wj(n,t){const e=n.getElementById(t)||n.getElementsByName(t)[0];if(e)return e;if("function"==typeof n.createTreeWalker&&n.body&&(n.body.createShadowRoot||n.body.attachShadow)){const i=n.createTreeWalker(n.body,NodeFilter.SHOW_ELEMENT);let r=i.currentNode;for(;r;){const s=r.shadowRoot;if(s){const d=s.getElementById(t)||s.querySelector(`[name="${t}"]`);if(d)return d}r=i.nextNode()}}return null}(this.document,t);e&&(this.scrollToElement(e),e.focus())}setHistoryScrollRestoration(t){if(this.supportScrollRestoration()){const e=this.window.history;e&&e.scrollRestoration&&(e.scrollRestoration=t)}}scrollToElement(t){const e=t.getBoundingClientRect(),i=e.left+this.window.pageXOffset,r=e.top+this.window.pageYOffset,s=this.offset();this.window.scrollTo(i-s[0],r-s[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const t=Hk(this.window.history)||Hk(Object.getPrototypeOf(this.window.history));return!(!t||!t.writable&&!t.set)}catch(t){return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch(t){return!1}}}function Hk(n){return Object.getOwnPropertyDescriptor(n,"scrollRestoration")}class $k{}class sT extends class v6 extends class IV{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function DV(n){Ex||(Ex=n)}(new sT)}onAndCancel(t,e,i){return t.addEventListener(e,i,!1),()=>{t.removeEventListener(e,i,!1)}}dispatchEvent(t,e){t.dispatchEvent(e)}remove(t){t.parentNode&&t.parentNode.removeChild(t)}createElement(t,e){return(e=e||this.getDefaultDocument()).createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,e){return"window"===e?window:"document"===e?t:"body"===e?t.body:null}getBaseHref(t){const e=function x6(){return Gy=Gy||document.querySelector("base"),Gy?Gy.getAttribute("href"):null}();return null==e?null:function w6(n){Vx=Vx||document.createElement("a"),Vx.setAttribute("href",n);const t=Vx.pathname;return"/"===t.charAt(0)?t:`/${t}`}(e)}resetBaseElement(){Gy=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return Rk(document.cookie,t)}}let Vx,Gy=null;const Zk=new Dt("TRANSITION_ID"),C6=[{provide:yx,useFactory:function S6(n,t,e){return()=>{e.get(vx).donePromise.then(()=>{const i=sd(),r=t.querySelectorAll(`style[ng-transition="${n}"]`);for(let s=0;s<r.length;s++)i.remove(r[s])})}},deps:[Zk,ui,Xr],multi:!0}];let E6=(()=>{class n{build(){return new XMLHttpRequest}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=tn({token:n,factory:n.\u0275fac}),n})();const jx=new Dt("EventManagerPlugins");let Ux=(()=>{class n{constructor(e,i){this._zone=i,this._eventNameToPlugin=new Map,e.forEach(r=>r.manager=this),this._plugins=e.slice().reverse()}addEventListener(e,i,r){return this._findPluginFor(i).addEventListener(e,i,r)}addGlobalEventListener(e,i,r){return this._findPluginFor(i).addGlobalEventListener(e,i,r)}getZone(){return this._zone}_findPluginFor(e){const i=this._eventNameToPlugin.get(e);if(i)return i;const r=this._plugins;for(let s=0;s<r.length;s++){const d=r[s];if(d.supports(e))return this._eventNameToPlugin.set(e,d),d}throw new Error(`No event manager plugin found for event ${e}`)}}return n.\u0275fac=function(e){return new(e||n)(Ue(jx),Ue(di))},n.\u0275prov=tn({token:n,factory:n.\u0275fac}),n})();class Yk{constructor(t){this._doc=t}addGlobalEventListener(t,e,i){const r=sd().getGlobalEventTarget(this._doc,t);if(!r)throw new Error(`Unsupported event target ${r} for event ${e}`);return this.addEventListener(r,e,i)}}let Kk=(()=>{class n{constructor(){this._stylesSet=new Set}addStyles(e){const i=new Set;e.forEach(r=>{this._stylesSet.has(r)||(this._stylesSet.add(r),i.add(r))}),this.onStylesAdded(i)}onStylesAdded(e){}getAllStyles(){return Array.from(this._stylesSet)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=tn({token:n,factory:n.\u0275fac}),n})(),Wy=(()=>{class n extends Kk{constructor(e){super(),this._doc=e,this._hostNodes=new Map,this._hostNodes.set(e.head,[])}_addStylesToHost(e,i,r){e.forEach(s=>{const d=this._doc.createElement("style");d.textContent=s,r.push(i.appendChild(d))})}addHost(e){const i=[];this._addStylesToHost(this._stylesSet,e,i),this._hostNodes.set(e,i)}removeHost(e){const i=this._hostNodes.get(e);i&&i.forEach(Qk),this._hostNodes.delete(e)}onStylesAdded(e){this._hostNodes.forEach((i,r)=>{this._addStylesToHost(e,r,i)})}ngOnDestroy(){this._hostNodes.forEach(e=>e.forEach(Qk))}}return n.\u0275fac=function(e){return new(e||n)(Ue(ui))},n.\u0275prov=tn({token:n,factory:n.\u0275fac}),n})();function Qk(n){sd().remove(n)}const aT={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},lT=/%COMP%/g;function Hx(n,t,e){for(let i=0;i<t.length;i++){let r=t[i];Array.isArray(r)?Hx(n,r,e):(r=r.replace(lT,n),e.push(r))}return e}function tR(n){return t=>{if("__ngUnwrap__"===t)return n;!1===n(t)&&(t.preventDefault(),t.returnValue=!1)}}let $x=(()=>{class n{constructor(e,i,r){this.eventManager=e,this.sharedStylesHost=i,this.appId=r,this.rendererByCompId=new Map,this.defaultRenderer=new cT(e)}createRenderer(e,i){if(!e||!i)return this.defaultRenderer;switch(i.encapsulation){case ca.Emulated:{let r=this.rendererByCompId.get(i.id);return r||(r=new R6(this.eventManager,this.sharedStylesHost,i,this.appId),this.rendererByCompId.set(i.id,r)),r.applyToHost(e),r}case 1:case ca.ShadowDom:return new P6(this.eventManager,this.sharedStylesHost,e,i);default:if(!this.rendererByCompId.has(i.id)){const r=Hx(i.id,i.styles,[]);this.sharedStylesHost.addStyles(r),this.rendererByCompId.set(i.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return n.\u0275fac=function(e){return new(e||n)(Ue(Ux),Ue(Wy),Ue(Sb))},n.\u0275prov=tn({token:n,factory:n.\u0275fac}),n})();class cT{constructor(t){this.eventManager=t,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(t,e){return e?document.createElementNS(aT[e]||e,t):document.createElement(t)}createComment(t){return document.createComment(t)}createText(t){return document.createTextNode(t)}appendChild(t,e){(iR(t)?t.content:t).appendChild(e)}insertBefore(t,e,i){t&&(iR(t)?t.content:t).insertBefore(e,i)}removeChild(t,e){t&&t.removeChild(e)}selectRootElement(t,e){let i="string"==typeof t?document.querySelector(t):t;if(!i)throw new Error(`The selector "${t}" did not match any elements`);return e||(i.textContent=""),i}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,e,i,r){if(r){e=r+":"+e;const s=aT[r];s?t.setAttributeNS(s,e,i):t.setAttribute(e,i)}else t.setAttribute(e,i)}removeAttribute(t,e,i){if(i){const r=aT[i];r?t.removeAttributeNS(r,e):t.removeAttribute(`${i}:${e}`)}else t.removeAttribute(e)}addClass(t,e){t.classList.add(e)}removeClass(t,e){t.classList.remove(e)}setStyle(t,e,i,r){r&(fa.DashCase|fa.Important)?t.style.setProperty(e,i,r&fa.Important?"important":""):t.style[e]=i}removeStyle(t,e,i){i&fa.DashCase?t.style.removeProperty(e):t.style[e]=""}setProperty(t,e,i){t[e]=i}setValue(t,e){t.nodeValue=e}listen(t,e,i){return"string"==typeof t?this.eventManager.addGlobalEventListener(t,e,tR(i)):this.eventManager.addEventListener(t,e,tR(i))}}function iR(n){return"TEMPLATE"===n.tagName&&void 0!==n.content}class R6 extends cT{constructor(t,e,i,r){super(t),this.component=i;const s=Hx(r+"-"+i.id,i.styles,[]);e.addStyles(s),this.contentAttr=function M6(n){return"_ngcontent-%COMP%".replace(lT,n)}(r+"-"+i.id),this.hostAttr=function A6(n){return"_nghost-%COMP%".replace(lT,n)}(r+"-"+i.id)}applyToHost(t){super.setAttribute(t,this.hostAttr,"")}createElement(t,e){const i=super.createElement(t,e);return super.setAttribute(i,this.contentAttr,""),i}}class P6 extends cT{constructor(t,e,i,r){super(t),this.sharedStylesHost=e,this.hostEl=i,this.shadowRoot=i.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const s=Hx(r.id,r.styles,[]);for(let d=0;d<s.length;d++){const m=document.createElement("style");m.textContent=s[d],this.shadowRoot.appendChild(m)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(t,e){return super.appendChild(this.nodeOrShadowRoot(t),e)}insertBefore(t,e,i){return super.insertBefore(this.nodeOrShadowRoot(t),e,i)}removeChild(t,e){return super.removeChild(this.nodeOrShadowRoot(t),e)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}}let O6=(()=>{class n extends Yk{constructor(e){super(e)}supports(e){return!0}addEventListener(e,i,r){return e.addEventListener(i,r,!1),()=>this.removeEventListener(e,i,r)}removeEventListener(e,i,r){return e.removeEventListener(i,r)}}return n.\u0275fac=function(e){return new(e||n)(Ue(ui))},n.\u0275prov=tn({token:n,factory:n.\u0275fac}),n})();const rR=["alt","control","meta","shift"],L6={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},F6={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey};let N6=(()=>{class n extends Yk{constructor(e){super(e)}supports(e){return null!=n.parseEventName(e)}addEventListener(e,i,r){const s=n.parseEventName(i),d=n.eventCallback(s.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>sd().onAndCancel(e,s.domEventName,d))}static parseEventName(e){const i=e.toLowerCase().split("."),r=i.shift();if(0===i.length||"keydown"!==r&&"keyup"!==r)return null;const s=n._normalizeKey(i.pop());let d="",m=i.indexOf("code");if(m>-1&&(i.splice(m,1),d="code."),rR.forEach(T=>{const M=i.indexOf(T);M>-1&&(i.splice(M,1),d+=T+".")}),d+=s,0!=i.length||0===s.length)return null;const y={};return y.domEventName=r,y.fullKey=d,y}static matchEventFullKeyCode(e,i){let r=L6[e.key]||e.key,s="";return i.indexOf("code.")>-1&&(r=e.code,s="code."),!(null==r||!r)&&(r=r.toLowerCase()," "===r?r="space":"."===r&&(r="dot"),rR.forEach(d=>{d!==r&&(0,F6[d])(e)&&(s+=d+".")}),s+=r,s===i)}static eventCallback(e,i,r){return s=>{n.matchEventFullKeyCode(s,e)&&r.runGuarded(()=>i(s))}}static _normalizeKey(e){return"esc"===e?"escape":e}}return n.\u0275fac=function(e){return new(e||n)(Ue(ui))},n.\u0275prov=tn({token:n,factory:n.\u0275fac}),n})();const j6=JA(CV,"browser",[{provide:xx,useValue:Uk},{provide:HA,useValue:function B6(){sT.makeCurrent()},multi:!0},{provide:ui,useFactory:function V6(){return function y0(n){U_=n}(document),document},deps:[]}]),aR=new Dt(""),lR=[{provide:wx,useClass:class T6{addToWindow(t){qr.getAngularTestability=(i,r=!0)=>{const s=t.findTestabilityInTree(i,r);if(null==s)throw new Error("Could not find testability for element.");return s},qr.getAllAngularTestabilities=()=>t.getAllTestabilities(),qr.getAllAngularRootElements=()=>t.getAllRootElements(),qr.frameworkStabilizers||(qr.frameworkStabilizers=[]),qr.frameworkStabilizers.push(i=>{const r=qr.getAllAngularTestabilities();let s=r.length,d=!1;const m=function(y){d=d||y,s--,0==s&&i(d)};r.forEach(function(y){y.whenStable(m)})})}findTestabilityInTree(t,e,i){if(null==e)return null;const r=t.getTestability(e);return null!=r?r:i?sd().isShadowRoot(e)?this.findTestabilityInTree(t,e.host,!0):this.findTestabilityInTree(t,e.parentElement,!0):null}},deps:[]},{provide:ZA,useClass:LC,deps:[di,FC,wx]},{provide:LC,useClass:LC,deps:[di,FC,wx]}],cR=[{provide:K_,useValue:"root"},{provide:wl,useFactory:function z6(){return new wl},deps:[]},{provide:jx,useClass:O6,multi:!0,deps:[ui,di,xx]},{provide:jx,useClass:N6,multi:!0,deps:[ui]},{provide:$x,useClass:$x,deps:[Ux,Wy,Sb]},{provide:Uf,useExisting:$x},{provide:Kk,useExisting:Wy},{provide:Wy,useClass:Wy,deps:[ui]},{provide:Ux,useClass:Ux,deps:[jx,di]},{provide:$k,useClass:E6,deps:[]},[]];let uR=(()=>{class n{constructor(e){}static withServerTransition(e){return{ngModule:n,providers:[{provide:Sb,useValue:e.appId},{provide:Zk,useExisting:Sb},C6]}}}return n.\u0275fac=function(e){return new(e||n)(Ue(aR,12))},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({providers:[...cR,...lR],imports:[Tr,TV]}),n})(),dR=(()=>{class n{constructor(e){this._doc=e}getTitle(){return this._doc.title}setTitle(e){this._doc.title=e||""}}return n.\u0275fac=function(e){return new(e||n)(Ue(ui))},n.\u0275prov=tn({token:n,factory:function(e){let i=null;return i=e?new e:function H6(){return new dR(Ue(ui))}(),i},providedIn:"root"}),n})();"undefined"!=typeof window&&window;let fR=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=tn({token:n,factory:function(e){let i=null;return i=e?new(e||n):Ue(mR),i},providedIn:"root"}),n})(),mR=(()=>{class n extends fR{constructor(e){super(),this._doc=e}sanitize(e,i){if(null==i)return null;switch(e){case fr.NONE:return i;case fr.HTML:return Ya(i,"HTML")?Za(i):Bf(this._doc,String(i)).toString();case fr.STYLE:return Ya(i,"Style")?Za(i):i;case fr.SCRIPT:if(Ya(i,"Script"))return Za(i);throw new Error("unsafe value used in a script context");case fr.URL:return Ya(i,"URL")?Za(i):sp(String(i));case fr.RESOURCE_URL:if(Ya(i,"ResourceURL"))return Za(i);throw new Error("unsafe value used in a resource URL context (see https://g.co/ng/security#xss)");default:throw new Error(`Unexpected SecurityContext ${e} (see https://g.co/ng/security#xss)`)}}bypassSecurityTrustHtml(e){return function x0(n){return new o1(n)}(e)}bypassSecurityTrustStyle(e){return function op(n){return new s1(n)}(e)}bypassSecurityTrustScript(e){return function d1(n){return new a1(n)}(e)}bypassSecurityTrustUrl(e){return function h1(n){return new l1(n)}(e)}bypassSecurityTrustResourceUrl(e){return function p1(n){return new c1(n)}(e)}}return n.\u0275fac=function(e){return new(e||n)(Ue(ui))},n.\u0275prov=tn({token:n,factory:function(e){let i=null;return i=e?new e:function Y6(n){return new mR(n.get(ui))}(Ue(Xr)),i},providedIn:"root"}),n})();class gR{}const ph="*";function Us(n,t){return{type:7,name:n,definitions:t,options:{}}}function ar(n,t=null){return{type:4,styles:t,timings:n}}function bR(n,t=null){return{type:3,steps:n,options:t}}function _R(n,t=null){return{type:2,steps:n,options:t}}function Yn(n){return{type:6,styles:n,offset:null}}function vr(n,t,e){return{type:0,name:n,styles:t,options:e}}function Xy(n){return{type:5,steps:n}}function tr(n,t,e=null){return{type:1,expr:n,animation:t,options:e}}function hT(n=null){return{type:9,options:n}}function pT(n,t,e=null){return{type:11,selector:n,animation:t,options:e}}function yR(n){Promise.resolve().then(n)}class Zy{constructor(t=0,e=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=t+e}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}onStart(t){this._originalOnStartFns.push(t),this._onStartFns.push(t)}onDone(t){this._originalOnDoneFns.push(t),this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){yR(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(t=>t()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(t){this._position=this.totalTime?t*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(t){const e="start"==t?this._onStartFns:this._onDoneFns;e.forEach(i=>i()),e.length=0}}class vR{constructor(t){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=t;let e=0,i=0,r=0;const s=this.players.length;0==s?yR(()=>this._onFinish()):this.players.forEach(d=>{d.onDone(()=>{++e==s&&this._onFinish()}),d.onDestroy(()=>{++i==s&&this._onDestroy()}),d.onStart(()=>{++r==s&&this._onStart()})}),this.totalTime=this.players.reduce((d,m)=>Math.max(d,m.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this.players.forEach(t=>t.init())}onStart(t){this._onStartFns.push(t)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(t=>t()),this._onStartFns=[])}onDone(t){this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(t=>t.play())}pause(){this.players.forEach(t=>t.pause())}restart(){this.players.forEach(t=>t.restart())}finish(){this._onFinish(),this.players.forEach(t=>t.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(t=>t.destroy()),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}reset(){this.players.forEach(t=>t.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(t){const e=t*this.totalTime;this.players.forEach(i=>{const r=i.totalTime?Math.min(1,e/i.totalTime):1;i.setPosition(r)})}getPosition(){const t=this.players.reduce((e,i)=>null===e||i.totalTime>e.totalTime?i:e,null);return null!=t?t.getPosition():0}beforeDestroy(){this.players.forEach(t=>{t.beforeDestroy&&t.beforeDestroy()})}triggerCallback(t){const e="start"==t?this._onStartFns:this._onDoneFns;e.forEach(i=>i()),e.length=0}}function xR(n){return new Nt(3e3,!1)}function P5(){return"undefined"!=typeof window&&void 0!==window.document}function mT(){return"undefined"!=typeof process&&"[object process]"==={}.toString.call(process)}function Cp(n){switch(n.length){case 0:return new Zy;case 1:return n[0];default:return new vR(n)}}function wR(n,t,e,i,r=new Map,s=new Map){const d=[],m=[];let y=-1,T=null;if(i.forEach(M=>{const R=M.get("offset"),H=R==y,Z=H&&T||new Map;M.forEach((te,xe)=>{let Ce=xe,et=te;if("offset"!==xe)switch(Ce=t.normalizePropertyName(Ce,d),et){case"!":et=r.get(xe);break;case ph:et=s.get(xe);break;default:et=t.normalizeStyleValue(xe,Ce,et,d)}Z.set(Ce,et)}),H||m.push(Z),T=Z,y=R}),d.length)throw function x5(n){return new Nt(3502,!1)}();return m}function gT(n,t,e,i){switch(t){case"start":n.onStart(()=>i(e&&bT(e,"start",n)));break;case"done":n.onDone(()=>i(e&&bT(e,"done",n)));break;case"destroy":n.onDestroy(()=>i(e&&bT(e,"destroy",n)))}}function bT(n,t,e){const i=e.totalTime,s=_T(n.element,n.triggerName,n.fromState,n.toState,t||n.phaseName,null==i?n.totalTime:i,!!e.disabled),d=n._data;return null!=d&&(s._data=d),s}function _T(n,t,e,i,r="",s=0,d){return{element:n,triggerName:t,fromState:e,toState:i,phaseName:r,totalTime:s,disabled:!!d}}function Jl(n,t,e){let i=n.get(t);return i||n.set(t,i=e),i}function SR(n){const t=n.indexOf(":");return[n.substring(1,t),n.slice(t+1)]}let yT=(n,t)=>!1,CR=(n,t,e)=>[],TR=null;function vT(n){const t=n.parentNode||n.host;return t===TR?null:t}(mT()||"undefined"!=typeof Element)&&(P5()?(TR=(()=>document.documentElement)(),yT=(n,t)=>{for(;t;){if(t===n)return!0;t=vT(t)}return!1}):yT=(n,t)=>n.contains(t),CR=(n,t,e)=>{if(e)return Array.from(n.querySelectorAll(t));const i=n.querySelector(t);return i?[i]:[]});let am=null,ER=!1;const DR=yT,IR=CR;let MR=(()=>{class n{validateStyleProperty(e){return function L5(n){am||(am=function F5(){return"undefined"!=typeof document?document.body:null}()||{},ER=!!am.style&&"WebkitAppearance"in am.style);let t=!0;return am.style&&!function O5(n){return"ebkit"==n.substring(1,6)}(n)&&(t=n in am.style,!t&&ER&&(t="Webkit"+n.charAt(0).toUpperCase()+n.slice(1)in am.style)),t}(e)}matchesElement(e,i){return!1}containsElement(e,i){return DR(e,i)}getParentElement(e){return vT(e)}query(e,i,r){return IR(e,i,r)}computeStyle(e,i,r){return r||""}animate(e,i,r,s,d,m=[],y){return new Zy(r,s)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=tn({token:n,factory:n.\u0275fac}),n})(),xT=(()=>{class n{}return n.NOOP=new MR,n})();const wT="ng-enter",qx="ng-leave",Gx="ng-trigger",Wx=".ng-trigger",kR="ng-animating",ST=".ng-animating";function fh(n){if("number"==typeof n)return n;const t=n.match(/^(-?[\.\d]+)(m?s)/);return!t||t.length<2?0:CT(parseFloat(t[1]),t[2])}function CT(n,t){return"s"===t?1e3*n:n}function Xx(n,t,e){return n.hasOwnProperty("duration")?n:function z5(n,t,e){let r,s=0,d="";if("string"==typeof n){const m=n.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===m)return t.push(xR()),{duration:0,delay:0,easing:""};r=CT(parseFloat(m[1]),m[2]);const y=m[3];null!=y&&(s=CT(parseFloat(y),m[4]));const T=m[5];T&&(d=T)}else r=n;if(!e){let m=!1,y=t.length;r<0&&(t.push(function Q6(){return new Nt(3100,!1)}()),m=!0),s<0&&(t.push(function J6(){return new Nt(3101,!1)}()),m=!0),m&&t.splice(y,0,xR())}return{duration:r,delay:s,easing:d}}(n,t,e)}function Yy(n,t={}){return Object.keys(n).forEach(e=>{t[e]=n[e]}),t}function RR(n){const t=new Map;return Object.keys(n).forEach(e=>{t.set(e,n[e])}),t}function Tp(n,t=new Map,e){if(e)for(let[i,r]of e)t.set(i,r);for(let[i,r]of n)t.set(i,r);return t}function OR(n,t,e){return e?t+":"+e+";":""}function LR(n){let t="";for(let e=0;e<n.style.length;e++){const i=n.style.item(e);t+=OR(0,i,n.style.getPropertyValue(i))}for(const e in n.style)n.style.hasOwnProperty(e)&&!e.startsWith("_")&&(t+=OR(0,H5(e),n.style[e]));n.setAttribute("style",t)}function ad(n,t,e){n.style&&(t.forEach((i,r)=>{const s=ET(r);e&&!e.has(r)&&e.set(r,n.style[s]),n.style[s]=i}),mT()&&LR(n))}function lm(n,t){n.style&&(t.forEach((e,i)=>{const r=ET(i);n.style[r]=""}),mT()&&LR(n))}function Ky(n){return Array.isArray(n)?1==n.length?n[0]:_R(n):n}const TT=new RegExp("{{\\s*(.+?)\\s*}}","g");function FR(n){let t=[];if("string"==typeof n){let e;for(;e=TT.exec(n);)t.push(e[1]);TT.lastIndex=0}return t}function Qy(n,t,e){const i=n.toString(),r=i.replace(TT,(s,d)=>{let m=t[d];return null==m&&(e.push(function t5(n){return new Nt(3003,!1)}()),m=""),m.toString()});return r==i?n:r}function Zx(n){const t=[];let e=n.next();for(;!e.done;)t.push(e.value),e=n.next();return t}const U5=/-+([a-z0-9])/g;function ET(n){return n.replace(U5,(...t)=>t[1].toUpperCase())}function H5(n){return n.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function ec(n,t,e){switch(t.type){case 7:return n.visitTrigger(t,e);case 0:return n.visitState(t,e);case 1:return n.visitTransition(t,e);case 2:return n.visitSequence(t,e);case 3:return n.visitGroup(t,e);case 4:return n.visitAnimate(t,e);case 5:return n.visitKeyframes(t,e);case 6:return n.visitStyle(t,e);case 8:return n.visitReference(t,e);case 9:return n.visitAnimateChild(t,e);case 10:return n.visitAnimateRef(t,e);case 11:return n.visitQuery(t,e);case 12:return n.visitStagger(t,e);default:throw function n5(n){return new Nt(3004,!1)}()}}function NR(n,t){return window.getComputedStyle(n)[t]}function Z5(n,t){const e=[];return"string"==typeof n?n.split(/\s*,\s*/).forEach(i=>function Y5(n,t,e){if(":"==n[0]){const y=function K5(n,t){switch(n){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(e,i)=>parseFloat(i)>parseFloat(e);case":decrement":return(e,i)=>parseFloat(i)<parseFloat(e);default:return t.push(function b5(n){return new Nt(3016,!1)}()),"* => *"}}(n,e);if("function"==typeof y)return void t.push(y);n=y}const i=n.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==i||i.length<4)return e.push(function g5(n){return new Nt(3015,!1)}()),t;const r=i[1],s=i[2],d=i[3];t.push(BR(r,d));"<"==s[0]&&!("*"==r&&"*"==d)&&t.push(BR(d,r))}(i,e,t)):e.push(n),e}const Jx=new Set(["true","1"]),ew=new Set(["false","0"]);function BR(n,t){const e=Jx.has(n)||ew.has(n),i=Jx.has(t)||ew.has(t);return(r,s)=>{let d="*"==n||n==r,m="*"==t||t==s;return!d&&e&&"boolean"==typeof r&&(d=r?Jx.has(n):ew.has(n)),!m&&i&&"boolean"==typeof s&&(m=s?Jx.has(t):ew.has(t)),d&&m}}const Q5=new RegExp("s*:selfs*,?","g");function DT(n,t,e,i){return new J5(n).build(t,e,i)}class J5{constructor(t){this._driver=t}build(t,e,i){const r=new n4(e);return this._resetContextStyleTimingState(r),ec(this,Ky(t),r)}_resetContextStyleTimingState(t){t.currentQuerySelector="",t.collectedStyles=new Map,t.collectedStyles.set("",new Map),t.currentTime=0}visitTrigger(t,e){let i=e.queryCount=0,r=e.depCount=0;const s=[],d=[];return"@"==t.name.charAt(0)&&e.errors.push(function o5(){return new Nt(3006,!1)}()),t.definitions.forEach(m=>{if(this._resetContextStyleTimingState(e),0==m.type){const y=m,T=y.name;T.toString().split(/\s*,\s*/).forEach(M=>{y.name=M,s.push(this.visitState(y,e))}),y.name=T}else if(1==m.type){const y=this.visitTransition(m,e);i+=y.queryCount,r+=y.depCount,d.push(y)}else e.errors.push(function s5(){return new Nt(3007,!1)}())}),{type:7,name:t.name,states:s,transitions:d,queryCount:i,depCount:r,options:null}}visitState(t,e){const i=this.visitStyle(t.styles,e),r=t.options&&t.options.params||null;if(i.containsDynamicStyles){const s=new Set,d=r||{};i.styles.forEach(m=>{m instanceof Map&&m.forEach(y=>{FR(y).forEach(T=>{d.hasOwnProperty(T)||s.add(T)})})}),s.size&&(Zx(s.values()),e.errors.push(function a5(n,t){return new Nt(3008,!1)}()))}return{type:0,name:t.name,style:i,options:r?{params:r}:null}}visitTransition(t,e){e.queryCount=0,e.depCount=0;const i=ec(this,Ky(t.animation),e);return{type:1,matchers:Z5(t.expr,e.errors),animation:i,queryCount:e.queryCount,depCount:e.depCount,options:cm(t.options)}}visitSequence(t,e){return{type:2,steps:t.steps.map(i=>ec(this,i,e)),options:cm(t.options)}}visitGroup(t,e){const i=e.currentTime;let r=0;const s=t.steps.map(d=>{e.currentTime=i;const m=ec(this,d,e);return r=Math.max(r,e.currentTime),m});return e.currentTime=r,{type:3,steps:s,options:cm(t.options)}}visitAnimate(t,e){const i=function o4(n,t){if(n.hasOwnProperty("duration"))return n;if("number"==typeof n)return IT(Xx(n,t).duration,0,"");const e=n;if(e.split(/\s+/).some(s=>"{"==s.charAt(0)&&"{"==s.charAt(1))){const s=IT(0,0,"");return s.dynamic=!0,s.strValue=e,s}const r=Xx(e,t);return IT(r.duration,r.delay,r.easing)}(t.timings,e.errors);e.currentAnimateTimings=i;let r,s=t.styles?t.styles:Yn({});if(5==s.type)r=this.visitKeyframes(s,e);else{let d=t.styles,m=!1;if(!d){m=!0;const T={};i.easing&&(T.easing=i.easing),d=Yn(T)}e.currentTime+=i.duration+i.delay;const y=this.visitStyle(d,e);y.isEmptyStep=m,r=y}return e.currentAnimateTimings=null,{type:4,timings:i,style:r,options:null}}visitStyle(t,e){const i=this._makeStyleAst(t,e);return this._validateStyleAst(i,e),i}_makeStyleAst(t,e){const i=[],r=Array.isArray(t.styles)?t.styles:[t.styles];for(let m of r)"string"==typeof m?m===ph?i.push(m):e.errors.push(new Nt(3002,!1)):i.push(RR(m));let s=!1,d=null;return i.forEach(m=>{if(m instanceof Map&&(m.has("easing")&&(d=m.get("easing"),m.delete("easing")),!s))for(let y of m.values())if(y.toString().indexOf("{{")>=0){s=!0;break}}),{type:6,styles:i,easing:d,offset:t.offset,containsDynamicStyles:s,options:null}}_validateStyleAst(t,e){const i=e.currentAnimateTimings;let r=e.currentTime,s=e.currentTime;i&&s>0&&(s-=i.duration+i.delay),t.styles.forEach(d=>{"string"!=typeof d&&d.forEach((m,y)=>{const T=e.collectedStyles.get(e.currentQuerySelector),M=T.get(y);let R=!0;M&&(s!=r&&s>=M.startTime&&r<=M.endTime&&(e.errors.push(function c5(n,t,e,i,r){return new Nt(3010,!1)}()),R=!1),s=M.startTime),R&&T.set(y,{startTime:s,endTime:r}),e.options&&function j5(n,t,e){const i=t.params||{},r=FR(n);r.length&&r.forEach(s=>{i.hasOwnProperty(s)||e.push(function e5(n){return new Nt(3001,!1)}())})}(m,e.options,e.errors)})})}visitKeyframes(t,e){const i={type:5,styles:[],options:null};if(!e.currentAnimateTimings)return e.errors.push(function u5(){return new Nt(3011,!1)}()),i;let s=0;const d=[];let m=!1,y=!1,T=0;const M=t.steps.map(et=>{const kt=this._makeStyleAst(et,e);let pt=null!=kt.offset?kt.offset:function r4(n){if("string"==typeof n)return null;let t=null;if(Array.isArray(n))n.forEach(e=>{if(e instanceof Map&&e.has("offset")){const i=e;t=parseFloat(i.get("offset")),i.delete("offset")}});else if(n instanceof Map&&n.has("offset")){const e=n;t=parseFloat(e.get("offset")),e.delete("offset")}return t}(kt.styles),en=0;return null!=pt&&(s++,en=kt.offset=pt),y=y||en<0||en>1,m=m||en<T,T=en,d.push(en),kt});y&&e.errors.push(function d5(){return new Nt(3012,!1)}()),m&&e.errors.push(function h5(){return new Nt(3200,!1)}());const R=t.steps.length;let H=0;s>0&&s<R?e.errors.push(function p5(){return new Nt(3202,!1)}()):0==s&&(H=1/(R-1));const Z=R-1,te=e.currentTime,xe=e.currentAnimateTimings,Ce=xe.duration;return M.forEach((et,kt)=>{const pt=H>0?kt==Z?1:H*kt:d[kt],en=pt*Ce;e.currentTime=te+xe.delay+en,xe.duration=en,this._validateStyleAst(et,e),et.offset=pt,i.styles.push(et)}),i}visitReference(t,e){return{type:8,animation:ec(this,Ky(t.animation),e),options:cm(t.options)}}visitAnimateChild(t,e){return e.depCount++,{type:9,options:cm(t.options)}}visitAnimateRef(t,e){return{type:10,animation:this.visitReference(t.animation,e),options:cm(t.options)}}visitQuery(t,e){const i=e.currentQuerySelector,r=t.options||{};e.queryCount++,e.currentQuery=t;const[s,d]=function e4(n){const t=!!n.split(/\s*,\s*/).find(e=>":self"==e);return t&&(n=n.replace(Q5,"")),n=n.replace(/@\*/g,Wx).replace(/@\w+/g,e=>Wx+"-"+e.slice(1)).replace(/:animating/g,ST),[n,t]}(t.selector);e.currentQuerySelector=i.length?i+" "+s:s,Jl(e.collectedStyles,e.currentQuerySelector,new Map);const m=ec(this,Ky(t.animation),e);return e.currentQuery=null,e.currentQuerySelector=i,{type:11,selector:s,limit:r.limit||0,optional:!!r.optional,includeSelf:d,animation:m,originalSelector:t.selector,options:cm(t.options)}}visitStagger(t,e){e.currentQuery||e.errors.push(function f5(){return new Nt(3013,!1)}());const i="full"===t.timings?{duration:0,delay:0,easing:"full"}:Xx(t.timings,e.errors,!0);return{type:12,animation:ec(this,Ky(t.animation),e),timings:i,options:null}}}class n4{constructor(t){this.errors=t,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}}function cm(n){return n?(n=Yy(n)).params&&(n.params=function t4(n){return n?Yy(n):null}(n.params)):n={},n}function IT(n,t,e){return{duration:n,delay:t,easing:e}}function MT(n,t,e,i,r,s,d=null,m=!1){return{type:1,element:n,keyframes:t,preStyleProps:e,postStyleProps:i,duration:r,delay:s,totalTime:r+s,easing:d,subTimeline:m}}class tw{constructor(){this._map=new Map}get(t){return this._map.get(t)||[]}append(t,e){let i=this._map.get(t);i||this._map.set(t,i=[]),i.push(...e)}has(t){return this._map.has(t)}clear(){this._map.clear()}}const l4=new RegExp(":enter","g"),u4=new RegExp(":leave","g");function AT(n,t,e,i,r,s=new Map,d=new Map,m,y,T=[]){return(new d4).buildKeyframes(n,t,e,i,r,s,d,m,y,T)}class d4{buildKeyframes(t,e,i,r,s,d,m,y,T,M=[]){T=T||new tw;const R=new kT(t,e,T,r,s,M,[]);R.options=y;const H=y.delay?fh(y.delay):0;R.currentTimeline.delayNextStep(H),R.currentTimeline.setStyles([d],null,R.errors,y),ec(this,i,R);const Z=R.timelines.filter(te=>te.containsAnimation());if(Z.length&&m.size){let te;for(let xe=Z.length-1;xe>=0;xe--){const Ce=Z[xe];if(Ce.element===e){te=Ce;break}}te&&!te.allowOnlyTimelineStyles()&&te.setStyles([m],null,R.errors,y)}return Z.length?Z.map(te=>te.buildKeyframes()):[MT(e,[],[],[],0,H,"",!1)]}visitTrigger(t,e){}visitState(t,e){}visitTransition(t,e){}visitAnimateChild(t,e){const i=e.subInstructions.get(e.element);if(i){const r=e.createSubContext(t.options),s=e.currentTimeline.currentTime,d=this._visitSubInstructions(i,r,r.options);s!=d&&e.transformIntoNewTimeline(d)}e.previousNode=t}visitAnimateRef(t,e){const i=e.createSubContext(t.options);i.transformIntoNewTimeline(),this._applyAnimationRefDelays([t.options,t.animation.options],e,i),this.visitReference(t.animation,i),e.transformIntoNewTimeline(i.currentTimeline.currentTime),e.previousNode=t}_applyAnimationRefDelays(t,e,i){var r;for(const s of t){const d=null==s?void 0:s.delay;if(d){const m="number"==typeof d?d:fh(Qy(d,null!==(r=null==s?void 0:s.params)&&void 0!==r?r:{},e.errors));i.delayNextStep(m)}}}_visitSubInstructions(t,e,i){let s=e.currentTimeline.currentTime;const d=null!=i.duration?fh(i.duration):null,m=null!=i.delay?fh(i.delay):null;return 0!==d&&t.forEach(y=>{const T=e.appendInstructionToTimeline(y,d,m);s=Math.max(s,T.duration+T.delay)}),s}visitReference(t,e){e.updateOptions(t.options,!0),ec(this,t.animation,e),e.previousNode=t}visitSequence(t,e){const i=e.subContextCount;let r=e;const s=t.options;if(s&&(s.params||s.delay)&&(r=e.createSubContext(s),r.transformIntoNewTimeline(),null!=s.delay)){6==r.previousNode.type&&(r.currentTimeline.snapshotCurrentStyles(),r.previousNode=nw);const d=fh(s.delay);r.delayNextStep(d)}t.steps.length&&(t.steps.forEach(d=>ec(this,d,r)),r.currentTimeline.applyStylesToKeyframe(),r.subContextCount>i&&r.transformIntoNewTimeline()),e.previousNode=t}visitGroup(t,e){const i=[];let r=e.currentTimeline.currentTime;const s=t.options&&t.options.delay?fh(t.options.delay):0;t.steps.forEach(d=>{const m=e.createSubContext(t.options);s&&m.delayNextStep(s),ec(this,d,m),r=Math.max(r,m.currentTimeline.currentTime),i.push(m.currentTimeline)}),i.forEach(d=>e.currentTimeline.mergeTimelineCollectedStyles(d)),e.transformIntoNewTimeline(r),e.previousNode=t}_visitTiming(t,e){if(t.dynamic){const i=t.strValue;return Xx(e.params?Qy(i,e.params,e.errors):i,e.errors)}return{duration:t.duration,delay:t.delay,easing:t.easing}}visitAnimate(t,e){const i=e.currentAnimateTimings=this._visitTiming(t.timings,e),r=e.currentTimeline;i.delay&&(e.incrementTime(i.delay),r.snapshotCurrentStyles());const s=t.style;5==s.type?this.visitKeyframes(s,e):(e.incrementTime(i.duration),this.visitStyle(s,e),r.applyStylesToKeyframe()),e.currentAnimateTimings=null,e.previousNode=t}visitStyle(t,e){const i=e.currentTimeline,r=e.currentAnimateTimings;!r&&i.hasCurrentStyleProperties()&&i.forwardFrame();const s=r&&r.easing||t.easing;t.isEmptyStep?i.applyEmptyStep(s):i.setStyles(t.styles,s,e.errors,e.options),e.previousNode=t}visitKeyframes(t,e){const i=e.currentAnimateTimings,r=e.currentTimeline.duration,s=i.duration,m=e.createSubContext().currentTimeline;m.easing=i.easing,t.styles.forEach(y=>{m.forwardTime((y.offset||0)*s),m.setStyles(y.styles,y.easing,e.errors,e.options),m.applyStylesToKeyframe()}),e.currentTimeline.mergeTimelineCollectedStyles(m),e.transformIntoNewTimeline(r+s),e.previousNode=t}visitQuery(t,e){const i=e.currentTimeline.currentTime,r=t.options||{},s=r.delay?fh(r.delay):0;s&&(6===e.previousNode.type||0==i&&e.currentTimeline.hasCurrentStyleProperties())&&(e.currentTimeline.snapshotCurrentStyles(),e.previousNode=nw);let d=i;const m=e.invokeQuery(t.selector,t.originalSelector,t.limit,t.includeSelf,!!r.optional,e.errors);e.currentQueryTotal=m.length;let y=null;m.forEach((T,M)=>{e.currentQueryIndex=M;const R=e.createSubContext(t.options,T);s&&R.delayNextStep(s),T===e.element&&(y=R.currentTimeline),ec(this,t.animation,R),R.currentTimeline.applyStylesToKeyframe(),d=Math.max(d,R.currentTimeline.currentTime)}),e.currentQueryIndex=0,e.currentQueryTotal=0,e.transformIntoNewTimeline(d),y&&(e.currentTimeline.mergeTimelineCollectedStyles(y),e.currentTimeline.snapshotCurrentStyles()),e.previousNode=t}visitStagger(t,e){const i=e.parentContext,r=e.currentTimeline,s=t.timings,d=Math.abs(s.duration),m=d*(e.currentQueryTotal-1);let y=d*e.currentQueryIndex;switch(s.duration<0?"reverse":s.easing){case"reverse":y=m-y;break;case"full":y=i.currentStaggerTime}const M=e.currentTimeline;y&&M.delayNextStep(y);const R=M.currentTime;ec(this,t.animation,e),e.previousNode=t,i.currentStaggerTime=r.currentTime-R+(r.startTime-i.currentTimeline.startTime)}}const nw={};class kT{constructor(t,e,i,r,s,d,m,y){this._driver=t,this.element=e,this.subInstructions=i,this._enterClassName=r,this._leaveClassName=s,this.errors=d,this.timelines=m,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=nw,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=y||new iw(this._driver,e,0),m.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(t,e){if(!t)return;const i=t;let r=this.options;null!=i.duration&&(r.duration=fh(i.duration)),null!=i.delay&&(r.delay=fh(i.delay));const s=i.params;if(s){let d=r.params;d||(d=this.options.params={}),Object.keys(s).forEach(m=>{(!e||!d.hasOwnProperty(m))&&(d[m]=Qy(s[m],d,this.errors))})}}_copyOptions(){const t={};if(this.options){const e=this.options.params;if(e){const i=t.params={};Object.keys(e).forEach(r=>{i[r]=e[r]})}}return t}createSubContext(t=null,e,i){const r=e||this.element,s=new kT(this._driver,r,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(r,i||0));return s.previousNode=this.previousNode,s.currentAnimateTimings=this.currentAnimateTimings,s.options=this._copyOptions(),s.updateOptions(t),s.currentQueryIndex=this.currentQueryIndex,s.currentQueryTotal=this.currentQueryTotal,s.parentContext=this,this.subContextCount++,s}transformIntoNewTimeline(t){return this.previousNode=nw,this.currentTimeline=this.currentTimeline.fork(this.element,t),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(t,e,i){const r={duration:null!=e?e:t.duration,delay:this.currentTimeline.currentTime+(null!=i?i:0)+t.delay,easing:""},s=new h4(this._driver,t.element,t.keyframes,t.preStyleProps,t.postStyleProps,r,t.stretchStartingKeyframe);return this.timelines.push(s),r}incrementTime(t){this.currentTimeline.forwardTime(this.currentTimeline.duration+t)}delayNextStep(t){t>0&&this.currentTimeline.delayNextStep(t)}invokeQuery(t,e,i,r,s,d){let m=[];if(r&&m.push(this.element),t.length>0){t=(t=t.replace(l4,"."+this._enterClassName)).replace(u4,"."+this._leaveClassName);let T=this._driver.query(this.element,t,1!=i);0!==i&&(T=i<0?T.slice(T.length+i,T.length):T.slice(0,i)),m.push(...T)}return!s&&0==m.length&&d.push(function m5(n){return new Nt(3014,!1)}()),m}}class iw{constructor(t,e,i,r){this._driver=t,this.element=e,this.startTime=i,this._elementTimelineStylesLookup=r,this.duration=0,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(e),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(e,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(t){const e=1===this._keyframes.size&&this._pendingStyles.size;this.duration||e?(this.forwardTime(this.currentTime+t),e&&this.snapshotCurrentStyles()):this.startTime+=t}fork(t,e){return this.applyStylesToKeyframe(),new iw(this._driver,t,e||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(t){this.applyStylesToKeyframe(),this.duration=t,this._loadKeyframe()}_updateStyle(t,e){this._localTimelineStyles.set(t,e),this._globalTimelineStyles.set(t,e),this._styleSummary.set(t,{time:this.currentTime,value:e})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(t){t&&this._previousKeyframe.set("easing",t);for(let[e,i]of this._globalTimelineStyles)this._backFill.set(e,i||ph),this._currentKeyframe.set(e,ph);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(t,e,i,r){var s;e&&this._previousKeyframe.set("easing",e);const d=r&&r.params||{},m=function p4(n,t){const e=new Map;let i;return n.forEach(r=>{if("*"===r){i=i||t.keys();for(let s of i)e.set(s,ph)}else Tp(r,e)}),e}(t,this._globalTimelineStyles);for(let[y,T]of m){const M=Qy(T,d,i);this._pendingStyles.set(y,M),this._localTimelineStyles.has(y)||this._backFill.set(y,null!==(s=this._globalTimelineStyles.get(y))&&void 0!==s?s:ph),this._updateStyle(y,M)}}applyStylesToKeyframe(){0!=this._pendingStyles.size&&(this._pendingStyles.forEach((t,e)=>{this._currentKeyframe.set(e,t)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((t,e)=>{this._currentKeyframe.has(e)||this._currentKeyframe.set(e,t)}))}snapshotCurrentStyles(){for(let[t,e]of this._localTimelineStyles)this._pendingStyles.set(t,e),this._updateStyle(t,e)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const t=[];for(let e in this._currentKeyframe)t.push(e);return t}mergeTimelineCollectedStyles(t){t._styleSummary.forEach((e,i)=>{const r=this._styleSummary.get(i);(!r||e.time>r.time)&&this._updateStyle(i,e.value)})}buildKeyframes(){this.applyStylesToKeyframe();const t=new Set,e=new Set,i=1===this._keyframes.size&&0===this.duration;let r=[];this._keyframes.forEach((m,y)=>{const T=Tp(m,new Map,this._backFill);T.forEach((M,R)=>{"!"===M?t.add(R):M===ph&&e.add(R)}),i||T.set("offset",y/this.duration),r.push(T)});const s=t.size?Zx(t.values()):[],d=e.size?Zx(e.values()):[];if(i){const m=r[0],y=new Map(m);m.set("offset",0),y.set("offset",1),r=[m,y]}return MT(this.element,r,s,d,this.duration,this.startTime,this.easing,!1)}}class h4 extends iw{constructor(t,e,i,r,s,d,m=!1){super(t,e,d.delay),this.keyframes=i,this.preStyleProps=r,this.postStyleProps=s,this._stretchStartingKeyframe=m,this.timings={duration:d.duration,delay:d.delay,easing:d.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let t=this.keyframes,{delay:e,duration:i,easing:r}=this.timings;if(this._stretchStartingKeyframe&&e){const s=[],d=i+e,m=e/d,y=Tp(t[0]);y.set("offset",0),s.push(y);const T=Tp(t[0]);T.set("offset",jR(m)),s.push(T);const M=t.length-1;for(let R=1;R<=M;R++){let H=Tp(t[R]);const Z=H.get("offset");H.set("offset",jR((e+Z*i)/d)),s.push(H)}i=d,e=0,r="",t=s}return MT(this.element,t,this.preStyleProps,this.postStyleProps,i,e,r,!0)}}function jR(n,t=3){const e=Math.pow(10,t-1);return Math.round(n*e)/e}class RT{}const f4=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]);class m4 extends RT{normalizePropertyName(t,e){return ET(t)}normalizeStyleValue(t,e,i,r){let s="";const d=i.toString().trim();if(f4.has(e)&&0!==i&&"0"!==i)if("number"==typeof i)s="px";else{const m=i.match(/^[+-]?[\d\.]+([a-z]*)$/);m&&0==m[1].length&&r.push(function r5(n,t){return new Nt(3005,!1)}())}return d+s}}function UR(n,t,e,i,r,s,d,m,y,T,M,R,H){return{type:0,element:n,triggerName:t,isRemovalTransition:r,fromState:e,fromStyles:s,toState:i,toStyles:d,timelines:m,queriedElements:y,preStyleProps:T,postStyleProps:M,totalTime:R,errors:H}}const PT={};class HR{constructor(t,e,i){this._triggerName=t,this.ast=e,this._stateStyles=i}match(t,e,i,r){return function g4(n,t,e,i,r){return n.some(s=>s(t,e,i,r))}(this.ast.matchers,t,e,i,r)}buildStyles(t,e,i){let r=this._stateStyles.get("*");return void 0!==t&&(r=this._stateStyles.get(null==t?void 0:t.toString())||r),r?r.buildStyles(e,i):new Map}build(t,e,i,r,s,d,m,y,T,M){var R;const H=[],Z=this.ast.options&&this.ast.options.params||PT,xe=this.buildStyles(i,m&&m.params||PT,H),Ce=y&&y.params||PT,et=this.buildStyles(r,Ce,H),kt=new Set,pt=new Map,en=new Map,Xn="void"===r,si={params:b4(Ce,Z),delay:null===(R=this.ast.options)||void 0===R?void 0:R.delay},Ni=M?[]:AT(t,e,this.ast.animation,s,d,xe,et,si,T,H);let Zr=0;if(Ni.forEach(sa=>{Zr=Math.max(sa.duration+sa.delay,Zr)}),H.length)return UR(e,this._triggerName,i,r,Xn,xe,et,[],[],pt,en,Zr,H);Ni.forEach(sa=>{const Eh=sa.element,Dh=Jl(pt,Eh,new Set);sa.preStyleProps.forEach(md=>Dh.add(md));const Ih=Jl(en,Eh,new Set);sa.postStyleProps.forEach(md=>Ih.add(md)),Eh!==e&&kt.add(Eh)});const _u=Zx(kt.values());return UR(e,this._triggerName,i,r,Xn,xe,et,Ni,_u,pt,en,Zr)}}function b4(n,t){const e=Yy(t);for(const i in n)n.hasOwnProperty(i)&&null!=n[i]&&(e[i]=n[i]);return e}class _4{constructor(t,e,i){this.styles=t,this.defaultParams=e,this.normalizer=i}buildStyles(t,e){const i=new Map,r=Yy(this.defaultParams);return Object.keys(t).forEach(s=>{const d=t[s];null!==d&&(r[s]=d)}),this.styles.styles.forEach(s=>{"string"!=typeof s&&s.forEach((d,m)=>{d&&(d=Qy(d,r,e));const y=this.normalizer.normalizePropertyName(m,e);d=this.normalizer.normalizeStyleValue(m,y,d,e),i.set(y,d)})}),i}}class v4{constructor(t,e,i){this.name=t,this.ast=e,this._normalizer=i,this.transitionFactories=[],this.states=new Map,e.states.forEach(r=>{this.states.set(r.name,new _4(r.style,r.options&&r.options.params||{},i))}),$R(this.states,"true","1"),$R(this.states,"false","0"),e.transitions.forEach(r=>{this.transitionFactories.push(new HR(t,r,this.states))}),this.fallbackTransition=function x4(n,t,e){return new HR(n,{type:1,animation:{type:2,steps:[],options:null},matchers:[(d,m)=>!0],options:null,queryCount:0,depCount:0},t)}(t,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(t,e,i,r){return this.transitionFactories.find(d=>d.match(t,e,i,r))||null}matchStyles(t,e,i){return this.fallbackTransition.buildStyles(t,e,i)}}function $R(n,t,e){n.has(t)?n.has(e)||n.set(e,n.get(t)):n.has(e)&&n.set(t,n.get(e))}const w4=new tw;class S4{constructor(t,e,i){this.bodyNode=t,this._driver=e,this._normalizer=i,this._animations=new Map,this._playersById=new Map,this.players=[]}register(t,e){const i=[],s=DT(this._driver,e,i,[]);if(i.length)throw function w5(n){return new Nt(3503,!1)}();this._animations.set(t,s)}_buildPlayer(t,e,i){const r=t.element,s=wR(0,this._normalizer,0,t.keyframes,e,i);return this._driver.animate(r,s,t.duration,t.delay,t.easing,[],!0)}create(t,e,i={}){const r=[],s=this._animations.get(t);let d;const m=new Map;if(s?(d=AT(this._driver,e,s,wT,qx,new Map,new Map,i,w4,r),d.forEach(M=>{const R=Jl(m,M.element,new Map);M.postStyleProps.forEach(H=>R.set(H,null))})):(r.push(function S5(){return new Nt(3300,!1)}()),d=[]),r.length)throw function C5(n){return new Nt(3504,!1)}();m.forEach((M,R)=>{M.forEach((H,Z)=>{M.set(Z,this._driver.computeStyle(R,Z,ph))})});const T=Cp(d.map(M=>{const R=m.get(M.element);return this._buildPlayer(M,new Map,R)}));return this._playersById.set(t,T),T.onDestroy(()=>this.destroy(t)),this.players.push(T),T}destroy(t){const e=this._getPlayer(t);e.destroy(),this._playersById.delete(t);const i=this.players.indexOf(e);i>=0&&this.players.splice(i,1)}_getPlayer(t){const e=this._playersById.get(t);if(!e)throw function T5(n){return new Nt(3301,!1)}();return e}listen(t,e,i,r){const s=_T(e,"","","");return gT(this._getPlayer(t),i,s,r),()=>{}}command(t,e,i,r){if("register"==i)return void this.register(t,r[0]);if("create"==i)return void this.create(t,e,r[0]||{});const s=this._getPlayer(t);switch(i){case"play":s.play();break;case"pause":s.pause();break;case"reset":s.reset();break;case"restart":s.restart();break;case"finish":s.finish();break;case"init":s.init();break;case"setPosition":s.setPosition(parseFloat(r[0]));break;case"destroy":this.destroy(t)}}}const qR="ng-animate-queued",OT="ng-animate-disabled",I4=[],GR={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},M4={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},Pc="__ng_removed";class LT{constructor(t,e=""){this.namespaceId=e;const i=t&&t.hasOwnProperty("value");if(this.value=function P4(n){return null!=n?n:null}(i?t.value:t),i){const s=Yy(t);delete s.value,this.options=s}else this.options={};this.options.params||(this.options.params={})}get params(){return this.options.params}absorbOptions(t){const e=t.params;if(e){const i=this.options.params;Object.keys(e).forEach(r=>{null==i[r]&&(i[r]=e[r])})}}}const Jy="void",FT=new LT(Jy);class A4{constructor(t,e,i){this.id=t,this.hostElement=e,this._engine=i,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+t,Oc(e,this._hostClassName)}listen(t,e,i,r){if(!this._triggers.has(e))throw function E5(n,t){return new Nt(3302,!1)}();if(null==i||0==i.length)throw function D5(n){return new Nt(3303,!1)}();if(!function O4(n){return"start"==n||"done"==n}(i))throw function I5(n,t){return new Nt(3400,!1)}();const s=Jl(this._elementListeners,t,[]),d={name:e,phase:i,callback:r};s.push(d);const m=Jl(this._engine.statesByElement,t,new Map);return m.has(e)||(Oc(t,Gx),Oc(t,Gx+"-"+e),m.set(e,FT)),()=>{this._engine.afterFlush(()=>{const y=s.indexOf(d);y>=0&&s.splice(y,1),this._triggers.has(e)||m.delete(e)})}}register(t,e){return!this._triggers.has(t)&&(this._triggers.set(t,e),!0)}_getTrigger(t){const e=this._triggers.get(t);if(!e)throw function M5(n){return new Nt(3401,!1)}();return e}trigger(t,e,i,r=!0){const s=this._getTrigger(e),d=new NT(this.id,e,t);let m=this._engine.statesByElement.get(t);m||(Oc(t,Gx),Oc(t,Gx+"-"+e),this._engine.statesByElement.set(t,m=new Map));let y=m.get(e);const T=new LT(i,this.id);if(!(i&&i.hasOwnProperty("value"))&&y&&T.absorbOptions(y.options),m.set(e,T),y||(y=FT),T.value!==Jy&&y.value===T.value){if(!function N4(n,t){const e=Object.keys(n),i=Object.keys(t);if(e.length!=i.length)return!1;for(let r=0;r<e.length;r++){const s=e[r];if(!t.hasOwnProperty(s)||n[s]!==t[s])return!1}return!0}(y.params,T.params)){const xe=[],Ce=s.matchStyles(y.value,y.params,xe),et=s.matchStyles(T.value,T.params,xe);xe.length?this._engine.reportError(xe):this._engine.afterFlush(()=>{lm(t,Ce),ad(t,et)})}return}const H=Jl(this._engine.playersByElement,t,[]);H.forEach(xe=>{xe.namespaceId==this.id&&xe.triggerName==e&&xe.queued&&xe.destroy()});let Z=s.matchTransition(y.value,T.value,t,T.params),te=!1;if(!Z){if(!r)return;Z=s.fallbackTransition,te=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:e,transition:Z,fromState:y,toState:T,player:d,isFallbackTransition:te}),te||(Oc(t,qR),d.onStart(()=>{Db(t,qR)})),d.onDone(()=>{let xe=this.players.indexOf(d);xe>=0&&this.players.splice(xe,1);const Ce=this._engine.playersByElement.get(t);if(Ce){let et=Ce.indexOf(d);et>=0&&Ce.splice(et,1)}}),this.players.push(d),H.push(d),d}deregister(t){this._triggers.delete(t),this._engine.statesByElement.forEach(e=>e.delete(t)),this._elementListeners.forEach((e,i)=>{this._elementListeners.set(i,e.filter(r=>r.name!=t))})}clearElementCache(t){this._engine.statesByElement.delete(t),this._elementListeners.delete(t);const e=this._engine.playersByElement.get(t);e&&(e.forEach(i=>i.destroy()),this._engine.playersByElement.delete(t))}_signalRemovalForInnerTriggers(t,e){const i=this._engine.driver.query(t,Wx,!0);i.forEach(r=>{if(r[Pc])return;const s=this._engine.fetchNamespacesByElement(r);s.size?s.forEach(d=>d.triggerLeaveAnimation(r,e,!1,!0)):this.clearElementCache(r)}),this._engine.afterFlushAnimationsDone(()=>i.forEach(r=>this.clearElementCache(r)))}triggerLeaveAnimation(t,e,i,r){const s=this._engine.statesByElement.get(t),d=new Map;if(s){const m=[];if(s.forEach((y,T)=>{if(d.set(T,y.value),this._triggers.has(T)){const M=this.trigger(t,T,Jy,r);M&&m.push(M)}}),m.length)return this._engine.markElementAsRemoved(this.id,t,!0,e,d),i&&Cp(m).onDone(()=>this._engine.processLeaveNode(t)),!0}return!1}prepareLeaveAnimationListeners(t){const e=this._elementListeners.get(t),i=this._engine.statesByElement.get(t);if(e&&i){const r=new Set;e.forEach(s=>{const d=s.name;if(r.has(d))return;r.add(d);const y=this._triggers.get(d).fallbackTransition,T=i.get(d)||FT,M=new LT(Jy),R=new NT(this.id,d,t);this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:d,transition:y,fromState:T,toState:M,player:R,isFallbackTransition:!0})})}}removeNode(t,e){const i=this._engine;if(t.childElementCount&&this._signalRemovalForInnerTriggers(t,e),this.triggerLeaveAnimation(t,e,!0))return;let r=!1;if(i.totalAnimations){const s=i.players.length?i.playersByQueriedElement.get(t):[];if(s&&s.length)r=!0;else{let d=t;for(;d=d.parentNode;)if(i.statesByElement.get(d)){r=!0;break}}}if(this.prepareLeaveAnimationListeners(t),r)i.markElementAsRemoved(this.id,t,!1,e);else{const s=t[Pc];(!s||s===GR)&&(i.afterFlush(()=>this.clearElementCache(t)),i.destroyInnerAnimations(t),i._onRemovalComplete(t,e))}}insertNode(t,e){Oc(t,this._hostClassName)}drainQueuedTransitions(t){const e=[];return this._queue.forEach(i=>{const r=i.player;if(r.destroyed)return;const s=i.element,d=this._elementListeners.get(s);d&&d.forEach(m=>{if(m.name==i.triggerName){const y=_T(s,i.triggerName,i.fromState.value,i.toState.value);y._data=t,gT(i.player,m.phase,y,m.callback)}}),r.markedForDestroy?this._engine.afterFlush(()=>{r.destroy()}):e.push(i)}),this._queue=[],e.sort((i,r)=>{const s=i.transition.ast.depCount,d=r.transition.ast.depCount;return 0==s||0==d?s-d:this._engine.driver.containsElement(i.element,r.element)?1:-1})}destroy(t){this.players.forEach(e=>e.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,t)}elementContainsData(t){let e=!1;return this._elementListeners.has(t)&&(e=!0),e=!!this._queue.find(i=>i.element===t)||e,e}}class k4{constructor(t,e,i){this.bodyNode=t,this.driver=e,this._normalizer=i,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(r,s)=>{}}_onRemovalComplete(t,e){this.onRemovalComplete(t,e)}get queuedPlayers(){const t=[];return this._namespaceList.forEach(e=>{e.players.forEach(i=>{i.queued&&t.push(i)})}),t}createNamespace(t,e){const i=new A4(t,e,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,e)?this._balanceNamespaceList(i,e):(this.newHostElements.set(e,i),this.collectEnterElement(e)),this._namespaceLookup[t]=i}_balanceNamespaceList(t,e){const i=this._namespaceList,r=this.namespacesByHostElement;if(i.length-1>=0){let d=!1,m=this.driver.getParentElement(e);for(;m;){const y=r.get(m);if(y){const T=i.indexOf(y);i.splice(T+1,0,t),d=!0;break}m=this.driver.getParentElement(m)}d||i.unshift(t)}else i.push(t);return r.set(e,t),t}register(t,e){let i=this._namespaceLookup[t];return i||(i=this.createNamespace(t,e)),i}registerTrigger(t,e,i){let r=this._namespaceLookup[t];r&&r.register(e,i)&&this.totalAnimations++}destroy(t,e){if(!t)return;const i=this._fetchNamespace(t);this.afterFlush(()=>{this.namespacesByHostElement.delete(i.hostElement),delete this._namespaceLookup[t];const r=this._namespaceList.indexOf(i);r>=0&&this._namespaceList.splice(r,1)}),this.afterFlushAnimationsDone(()=>i.destroy(e))}_fetchNamespace(t){return this._namespaceLookup[t]}fetchNamespacesByElement(t){const e=new Set,i=this.statesByElement.get(t);if(i)for(let r of i.values())if(r.namespaceId){const s=this._fetchNamespace(r.namespaceId);s&&e.add(s)}return e}trigger(t,e,i,r){if(rw(e)){const s=this._fetchNamespace(t);if(s)return s.trigger(e,i,r),!0}return!1}insertNode(t,e,i,r){if(!rw(e))return;const s=e[Pc];if(s&&s.setForRemoval){s.setForRemoval=!1,s.setForMove=!0;const d=this.collectedLeaveElements.indexOf(e);d>=0&&this.collectedLeaveElements.splice(d,1)}if(t){const d=this._fetchNamespace(t);d&&d.insertNode(e,i)}r&&this.collectEnterElement(e)}collectEnterElement(t){this.collectedEnterElements.push(t)}markElementAsDisabled(t,e){e?this.disabledNodes.has(t)||(this.disabledNodes.add(t),Oc(t,OT)):this.disabledNodes.has(t)&&(this.disabledNodes.delete(t),Db(t,OT))}removeNode(t,e,i,r){if(rw(e)){const s=t?this._fetchNamespace(t):null;if(s?s.removeNode(e,r):this.markElementAsRemoved(t,e,!1,r),i){const d=this.namespacesByHostElement.get(e);d&&d.id!==t&&d.removeNode(e,r)}}else this._onRemovalComplete(e,r)}markElementAsRemoved(t,e,i,r,s){this.collectedLeaveElements.push(e),e[Pc]={namespaceId:t,setForRemoval:r,hasAnimation:i,removedBeforeQueried:!1,previousTriggersValues:s}}listen(t,e,i,r,s){return rw(e)?this._fetchNamespace(t).listen(e,i,r,s):()=>{}}_buildInstruction(t,e,i,r,s){return t.transition.build(this.driver,t.element,t.fromState.value,t.toState.value,i,r,t.fromState.options,t.toState.options,e,s)}destroyInnerAnimations(t){let e=this.driver.query(t,Wx,!0);e.forEach(i=>this.destroyActiveAnimationsForElement(i)),0!=this.playersByQueriedElement.size&&(e=this.driver.query(t,ST,!0),e.forEach(i=>this.finishActiveQueriedAnimationOnElement(i)))}destroyActiveAnimationsForElement(t){const e=this.playersByElement.get(t);e&&e.forEach(i=>{i.queued?i.markedForDestroy=!0:i.destroy()})}finishActiveQueriedAnimationOnElement(t){const e=this.playersByQueriedElement.get(t);e&&e.forEach(i=>i.finish())}whenRenderingDone(){return new Promise(t=>{if(this.players.length)return Cp(this.players).onDone(()=>t());t()})}processLeaveNode(t){var e;const i=t[Pc];if(i&&i.setForRemoval){if(t[Pc]=GR,i.namespaceId){this.destroyInnerAnimations(t);const r=this._fetchNamespace(i.namespaceId);r&&r.clearElementCache(t)}this._onRemovalComplete(t,i.setForRemoval)}!(null===(e=t.classList)||void 0===e)&&e.contains(OT)&&this.markElementAsDisabled(t,!1),this.driver.query(t,".ng-animate-disabled",!0).forEach(r=>{this.markElementAsDisabled(r,!1)})}flush(t=-1){let e=[];if(this.newHostElements.size&&(this.newHostElements.forEach((i,r)=>this._balanceNamespaceList(i,r)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let i=0;i<this.collectedEnterElements.length;i++)Oc(this.collectedEnterElements[i],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const i=[];try{e=this._flushAnimations(i,t)}finally{for(let r=0;r<i.length;r++)i[r]()}}else for(let i=0;i<this.collectedLeaveElements.length;i++)this.processLeaveNode(this.collectedLeaveElements[i]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(i=>i()),this._flushFns=[],this._whenQuietFns.length){const i=this._whenQuietFns;this._whenQuietFns=[],e.length?Cp(e).onDone(()=>{i.forEach(r=>r())}):i.forEach(r=>r())}}reportError(t){throw function A5(n){return new Nt(3402,!1)}()}_flushAnimations(t,e){const i=new tw,r=[],s=new Map,d=[],m=new Map,y=new Map,T=new Map,M=new Set;this.disabledNodes.forEach(Kn=>{M.add(Kn);const bi=this.driver.query(Kn,".ng-animate-queued",!0);for(let Ci=0;Ci<bi.length;Ci++)M.add(bi[Ci])});const R=this.bodyNode,H=Array.from(this.statesByElement.keys()),Z=ZR(H,this.collectedEnterElements),te=new Map;let xe=0;Z.forEach((Kn,bi)=>{const Ci=wT+xe++;te.set(bi,Ci),Kn.forEach(gr=>Oc(gr,Ci))});const Ce=[],et=new Set,kt=new Set;for(let Kn=0;Kn<this.collectedLeaveElements.length;Kn++){const bi=this.collectedLeaveElements[Kn],Ci=bi[Pc];Ci&&Ci.setForRemoval&&(Ce.push(bi),et.add(bi),Ci.hasAnimation?this.driver.query(bi,".ng-star-inserted",!0).forEach(gr=>et.add(gr)):kt.add(bi))}const pt=new Map,en=ZR(H,Array.from(et));en.forEach((Kn,bi)=>{const Ci=qx+xe++;pt.set(bi,Ci),Kn.forEach(gr=>Oc(gr,Ci))}),t.push(()=>{Z.forEach((Kn,bi)=>{const Ci=te.get(bi);Kn.forEach(gr=>Db(gr,Ci))}),en.forEach((Kn,bi)=>{const Ci=pt.get(bi);Kn.forEach(gr=>Db(gr,Ci))}),Ce.forEach(Kn=>{this.processLeaveNode(Kn)})});const Xn=[],si=[];for(let Kn=this._namespaceList.length-1;Kn>=0;Kn--)this._namespaceList[Kn].drainQueuedTransitions(e).forEach(Ci=>{const gr=Ci.player,ts=Ci.element;if(Xn.push(gr),this.collectedEnterElements.length){const Oa=ts[Pc];if(Oa&&Oa.setForMove){if(Oa.previousTriggersValues&&Oa.previousTriggersValues.has(Ci.triggerName)){const Lm=Oa.previousTriggersValues.get(Ci.triggerName),Bc=this.statesByElement.get(Ci.element);if(Bc&&Bc.has(Ci.triggerName)){const zS=Bc.get(Ci.triggerName);zS.value=Lm,Bc.set(Ci.triggerName,zS)}}return void gr.destroy()}}const gd=!R||!this.driver.containsElement(R,ts),nc=pt.get(ts),$p=te.get(ts),Go=this._buildInstruction(Ci,i,$p,nc,gd);if(Go.errors&&Go.errors.length)return void si.push(Go);if(gd)return gr.onStart(()=>lm(ts,Go.fromStyles)),gr.onDestroy(()=>ad(ts,Go.toStyles)),void r.push(gr);if(Ci.isFallbackTransition)return gr.onStart(()=>lm(ts,Go.fromStyles)),gr.onDestroy(()=>ad(ts,Go.toStyles)),void r.push(gr);const WN=[];Go.timelines.forEach(Oa=>{Oa.stretchStartingKeyframe=!0,this.disabledNodes.has(Oa.element)||WN.push(Oa)}),Go.timelines=WN,i.append(ts,Go.timelines),d.push({instruction:Go,player:gr,element:ts}),Go.queriedElements.forEach(Oa=>Jl(m,Oa,[]).push(gr)),Go.preStyleProps.forEach((Oa,Lm)=>{if(Oa.size){let Bc=y.get(Lm);Bc||y.set(Lm,Bc=new Set),Oa.forEach((zS,mI)=>Bc.add(mI))}}),Go.postStyleProps.forEach((Oa,Lm)=>{let Bc=T.get(Lm);Bc||T.set(Lm,Bc=new Set),Oa.forEach((zS,mI)=>Bc.add(mI))})});if(si.length){const Kn=[];si.forEach(bi=>{Kn.push(function k5(n,t){return new Nt(3505,!1)}())}),Xn.forEach(bi=>bi.destroy()),this.reportError(Kn)}const Ni=new Map,Zr=new Map;d.forEach(Kn=>{const bi=Kn.element;i.has(bi)&&(Zr.set(bi,bi),this._beforeAnimationBuild(Kn.player.namespaceId,Kn.instruction,Ni))}),r.forEach(Kn=>{const bi=Kn.element;this._getPreviousPlayers(bi,!1,Kn.namespaceId,Kn.triggerName,null).forEach(gr=>{Jl(Ni,bi,[]).push(gr),gr.destroy()})});const _u=Ce.filter(Kn=>KR(Kn,y,T)),sa=new Map;XR(sa,this.driver,kt,T,ph).forEach(Kn=>{KR(Kn,y,T)&&_u.push(Kn)});const Dh=new Map;Z.forEach((Kn,bi)=>{XR(Dh,this.driver,new Set(Kn),y,"!")}),_u.forEach(Kn=>{var bi,Ci;const gr=sa.get(Kn),ts=Dh.get(Kn);sa.set(Kn,new Map([...Array.from(null!==(bi=null==gr?void 0:gr.entries())&&void 0!==bi?bi:[]),...Array.from(null!==(Ci=null==ts?void 0:ts.entries())&&void 0!==Ci?Ci:[])]))});const Ih=[],md=[],t_={};d.forEach(Kn=>{const{element:bi,player:Ci,instruction:gr}=Kn;if(i.has(bi)){if(M.has(bi))return Ci.onDestroy(()=>ad(bi,gr.toStyles)),Ci.disabled=!0,Ci.overrideTotalTime(gr.totalTime),void r.push(Ci);let ts=t_;if(Zr.size>1){let nc=bi;const $p=[];for(;nc=nc.parentNode;){const Go=Zr.get(nc);if(Go){ts=Go;break}$p.push(nc)}$p.forEach(Go=>Zr.set(Go,ts))}const gd=this._buildAnimation(Ci.namespaceId,gr,Ni,s,Dh,sa);if(Ci.setRealPlayer(gd),ts===t_)Ih.push(Ci);else{const nc=this.playersByElement.get(ts);nc&&nc.length&&(Ci.parentPlayer=Cp(nc)),r.push(Ci)}}else lm(bi,gr.fromStyles),Ci.onDestroy(()=>ad(bi,gr.toStyles)),md.push(Ci),M.has(bi)&&r.push(Ci)}),md.forEach(Kn=>{const bi=s.get(Kn.element);if(bi&&bi.length){const Ci=Cp(bi);Kn.setRealPlayer(Ci)}}),r.forEach(Kn=>{Kn.parentPlayer?Kn.syncPlayerEvents(Kn.parentPlayer):Kn.destroy()});for(let Kn=0;Kn<Ce.length;Kn++){const bi=Ce[Kn],Ci=bi[Pc];if(Db(bi,qx),Ci&&Ci.hasAnimation)continue;let gr=[];if(m.size){let gd=m.get(bi);gd&&gd.length&&gr.push(...gd);let nc=this.driver.query(bi,ST,!0);for(let $p=0;$p<nc.length;$p++){let Go=m.get(nc[$p]);Go&&Go.length&&gr.push(...Go)}}const ts=gr.filter(gd=>!gd.destroyed);ts.length?L4(this,bi,ts):this.processLeaveNode(bi)}return Ce.length=0,Ih.forEach(Kn=>{this.players.push(Kn),Kn.onDone(()=>{Kn.destroy();const bi=this.players.indexOf(Kn);this.players.splice(bi,1)}),Kn.play()}),Ih}elementContainsData(t,e){let i=!1;const r=e[Pc];return r&&r.setForRemoval&&(i=!0),this.playersByElement.has(e)&&(i=!0),this.playersByQueriedElement.has(e)&&(i=!0),this.statesByElement.has(e)&&(i=!0),this._fetchNamespace(t).elementContainsData(e)||i}afterFlush(t){this._flushFns.push(t)}afterFlushAnimationsDone(t){this._whenQuietFns.push(t)}_getPreviousPlayers(t,e,i,r,s){let d=[];if(e){const m=this.playersByQueriedElement.get(t);m&&(d=m)}else{const m=this.playersByElement.get(t);if(m){const y=!s||s==Jy;m.forEach(T=>{T.queued||!y&&T.triggerName!=r||d.push(T)})}}return(i||r)&&(d=d.filter(m=>!(i&&i!=m.namespaceId||r&&r!=m.triggerName))),d}_beforeAnimationBuild(t,e,i){const s=e.element,d=e.isRemovalTransition?void 0:t,m=e.isRemovalTransition?void 0:e.triggerName;for(const y of e.timelines){const T=y.element,M=T!==s,R=Jl(i,T,[]);this._getPreviousPlayers(T,M,d,m,e.toState).forEach(Z=>{const te=Z.getRealPlayer();te.beforeDestroy&&te.beforeDestroy(),Z.destroy(),R.push(Z)})}lm(s,e.fromStyles)}_buildAnimation(t,e,i,r,s,d){const m=e.triggerName,y=e.element,T=[],M=new Set,R=new Set,H=e.timelines.map(te=>{const xe=te.element;M.add(xe);const Ce=xe[Pc];if(Ce&&Ce.removedBeforeQueried)return new Zy(te.duration,te.delay);const et=xe!==y,kt=function F4(n){const t=[];return YR(n,t),t}((i.get(xe)||I4).map(Ni=>Ni.getRealPlayer())).filter(Ni=>!!Ni.element&&Ni.element===xe),pt=s.get(xe),en=d.get(xe),Xn=wR(0,this._normalizer,0,te.keyframes,pt,en),si=this._buildPlayer(te,Xn,kt);if(te.subTimeline&&r&&R.add(xe),et){const Ni=new NT(t,m,xe);Ni.setRealPlayer(si),T.push(Ni)}return si});T.forEach(te=>{Jl(this.playersByQueriedElement,te.element,[]).push(te),te.onDone(()=>function R4(n,t,e){let i=n.get(t);if(i){if(i.length){const r=i.indexOf(e);i.splice(r,1)}0==i.length&&n.delete(t)}return i}(this.playersByQueriedElement,te.element,te))}),M.forEach(te=>Oc(te,kR));const Z=Cp(H);return Z.onDestroy(()=>{M.forEach(te=>Db(te,kR)),ad(y,e.toStyles)}),R.forEach(te=>{Jl(r,te,[]).push(Z)}),Z}_buildPlayer(t,e,i){return e.length>0?this.driver.animate(t.element,e,t.duration,t.delay,t.easing,i):new Zy(t.duration,t.delay)}}class NT{constructor(t,e,i){this.namespaceId=t,this.triggerName=e,this.element=i,this._player=new Zy,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(t){this._containsRealPlayer||(this._player=t,this._queuedCallbacks.forEach((e,i)=>{e.forEach(r=>gT(t,i,void 0,r))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(t.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(t){this.totalTime=t}syncPlayerEvents(t){const e=this._player;e.triggerCallback&&t.onStart(()=>e.triggerCallback("start")),t.onDone(()=>this.finish()),t.onDestroy(()=>this.destroy())}_queueEvent(t,e){Jl(this._queuedCallbacks,t,[]).push(e)}onDone(t){this.queued&&this._queueEvent("done",t),this._player.onDone(t)}onStart(t){this.queued&&this._queueEvent("start",t),this._player.onStart(t)}onDestroy(t){this.queued&&this._queueEvent("destroy",t),this._player.onDestroy(t)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(t){this.queued||this._player.setPosition(t)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(t){const e=this._player;e.triggerCallback&&e.triggerCallback(t)}}function rw(n){return n&&1===n.nodeType}function WR(n,t){const e=n.style.display;return n.style.display=null!=t?t:"none",e}function XR(n,t,e,i,r){const s=[];e.forEach(y=>s.push(WR(y)));const d=[];i.forEach((y,T)=>{const M=new Map;y.forEach(R=>{const H=t.computeStyle(T,R,r);M.set(R,H),(!H||0==H.length)&&(T[Pc]=M4,d.push(T))}),n.set(T,M)});let m=0;return e.forEach(y=>WR(y,s[m++])),d}function ZR(n,t){const e=new Map;if(n.forEach(m=>e.set(m,[])),0==t.length)return e;const r=new Set(t),s=new Map;function d(m){if(!m)return 1;let y=s.get(m);if(y)return y;const T=m.parentNode;return y=e.has(T)?T:r.has(T)?1:d(T),s.set(m,y),y}return t.forEach(m=>{const y=d(m);1!==y&&e.get(y).push(m)}),e}function Oc(n,t){var e;null===(e=n.classList)||void 0===e||e.add(t)}function Db(n,t){var e;null===(e=n.classList)||void 0===e||e.remove(t)}function L4(n,t,e){Cp(e).onDone(()=>n.processLeaveNode(t))}function YR(n,t){for(let e=0;e<n.length;e++){const i=n[e];i instanceof vR?YR(i.players,t):t.push(i)}}function KR(n,t,e){const i=e.get(n);if(!i)return!1;let r=t.get(n);return r?i.forEach(s=>r.add(s)):t.set(n,i),e.delete(n),!0}class ow{constructor(t,e,i){this.bodyNode=t,this._driver=e,this._normalizer=i,this._triggerCache={},this.onRemovalComplete=(r,s)=>{},this._transitionEngine=new k4(t,e,i),this._timelineEngine=new S4(t,e,i),this._transitionEngine.onRemovalComplete=(r,s)=>this.onRemovalComplete(r,s)}registerTrigger(t,e,i,r,s){const d=t+"-"+r;let m=this._triggerCache[d];if(!m){const y=[],M=DT(this._driver,s,y,[]);if(y.length)throw function v5(n,t){return new Nt(3404,!1)}();m=function y4(n,t,e){return new v4(n,t,e)}(r,M,this._normalizer),this._triggerCache[d]=m}this._transitionEngine.registerTrigger(e,r,m)}register(t,e){this._transitionEngine.register(t,e)}destroy(t,e){this._transitionEngine.destroy(t,e)}onInsert(t,e,i,r){this._transitionEngine.insertNode(t,e,i,r)}onRemove(t,e,i,r){this._transitionEngine.removeNode(t,e,r||!1,i)}disableAnimations(t,e){this._transitionEngine.markElementAsDisabled(t,e)}process(t,e,i,r){if("@"==i.charAt(0)){const[s,d]=SR(i);this._timelineEngine.command(s,e,d,r)}else this._transitionEngine.trigger(t,e,i,r)}listen(t,e,i,r,s){if("@"==i.charAt(0)){const[d,m]=SR(i);return this._timelineEngine.listen(d,e,m,s)}return this._transitionEngine.listen(t,e,i,r,s)}flush(t=-1){this._transitionEngine.flush(t)}get players(){return this._transitionEngine.players.concat(this._timelineEngine.players)}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}}let z4=(()=>{class n{constructor(e,i,r){this._element=e,this._startStyles=i,this._endStyles=r,this._state=0;let s=n.initialStylesByElement.get(e);s||n.initialStylesByElement.set(e,s=new Map),this._initialStyles=s}start(){this._state<1&&(this._startStyles&&ad(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(ad(this._element,this._initialStyles),this._endStyles&&(ad(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(n.initialStylesByElement.delete(this._element),this._startStyles&&(lm(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(lm(this._element,this._endStyles),this._endStyles=null),ad(this._element,this._initialStyles),this._state=3)}}return n.initialStylesByElement=new WeakMap,n})();function BT(n){let t=null;return n.forEach((e,i)=>{(function V4(n){return"display"===n||"position"===n})(i)&&(t=t||new Map,t.set(i,e))}),t}class QR{constructor(t,e,i,r){this.element=t,this.keyframes=e,this.options=i,this._specialStyles=r,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=i.duration,this._delay=i.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const t=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,t,this.options),this._finalKeyframe=t.length?t[t.length-1]:new Map,this.domPlayer.addEventListener("finish",()=>this._onFinish())}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(t){const e=[];return t.forEach(i=>{e.push(Object.fromEntries(i))}),e}_triggerWebAnimation(t,e,i){return t.animate(this._convertKeyframesToObject(e),i)}onStart(t){this._originalOnStartFns.push(t),this._onStartFns.push(t)}onDone(t){this._originalOnDoneFns.push(t),this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(t=>t()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}setPosition(t){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=t*this.time}getPosition(){return this.domPlayer.currentTime/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const t=new Map;this.hasStarted()&&this._finalKeyframe.forEach((i,r)=>{"offset"!==r&&t.set(r,this._finished?i:NR(this.element,r))}),this.currentSnapshot=t}triggerCallback(t){const e="start"===t?this._onStartFns:this._onDoneFns;e.forEach(i=>i()),e.length=0}}class j4{validateStyleProperty(t){return!0}validateAnimatableStyleProperty(t){return!0}matchesElement(t,e){return!1}containsElement(t,e){return DR(t,e)}getParentElement(t){return vT(t)}query(t,e,i){return IR(t,e,i)}computeStyle(t,e,i){return window.getComputedStyle(t)[e]}animate(t,e,i,r,s,d=[]){const y={duration:i,delay:r,fill:0==r?"both":"forwards"};s&&(y.easing=s);const T=new Map,M=d.filter(Z=>Z instanceof QR);(function $5(n,t){return 0===n||0===t})(i,r)&&M.forEach(Z=>{Z.currentSnapshot.forEach((te,xe)=>T.set(xe,te))});let R=function V5(n){return n.length?n[0]instanceof Map?n:n.map(t=>RR(t)):[]}(e).map(Z=>Tp(Z));R=function q5(n,t,e){if(e.size&&t.length){let i=t[0],r=[];if(e.forEach((s,d)=>{i.has(d)||r.push(d),i.set(d,s)}),r.length)for(let s=1;s<t.length;s++){let d=t[s];r.forEach(m=>d.set(m,NR(n,m)))}}return t}(t,R,T);const H=function B4(n,t){let e=null,i=null;return Array.isArray(t)&&t.length?(e=BT(t[0]),t.length>1&&(i=BT(t[t.length-1]))):t instanceof Map&&(e=BT(t)),e||i?new z4(n,e,i):null}(t,R);return new QR(t,R,y,H)}}let U4=(()=>{class n extends gR{constructor(e,i){super(),this._nextAnimationId=0,this._renderer=e.createRenderer(i.body,{id:"0",encapsulation:ca.None,styles:[],data:{animation:[]}})}build(e){const i=this._nextAnimationId.toString();this._nextAnimationId++;const r=Array.isArray(e)?_R(e):e;return JR(this._renderer,null,i,"register",[r]),new H4(i,this._renderer)}}return n.\u0275fac=function(e){return new(e||n)(Ue(Uf),Ue(ui))},n.\u0275prov=tn({token:n,factory:n.\u0275fac}),n})();class H4 extends class K6{}{constructor(t,e){super(),this._id=t,this._renderer=e}create(t,e){return new $4(this._id,t,e||{},this._renderer)}}class $4{constructor(t,e,i,r){this.id=t,this.element=e,this._renderer=r,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",i)}_listen(t,e){return this._renderer.listen(this.element,`@@${this.id}:${t}`,e)}_command(t,...e){return JR(this._renderer,this.element,this.id,t,e)}onDone(t){this._listen("done",t)}onStart(t){this._listen("start",t)}onDestroy(t){this._listen("destroy",t)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset"),this._started=!1}setPosition(t){this._command("setPosition",t)}getPosition(){var t,e;return null!==(e=null===(t=this._renderer.engine.players[+this.id])||void 0===t?void 0:t.getPosition())&&void 0!==e?e:0}}function JR(n,t,e,i,r){return n.setProperty(t,`@@${e}:${i}`,r)}const eP="@.disabled";let q4=(()=>{class n{constructor(e,i,r){this.delegate=e,this.engine=i,this._zone=r,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,this.promise=Promise.resolve(0),i.onRemovalComplete=(s,d)=>{const m=null==d?void 0:d.parentNode(s);m&&d.removeChild(m,s)}}createRenderer(e,i){const s=this.delegate.createRenderer(e,i);if(!(e&&i&&i.data&&i.data.animation)){let M=this._rendererCache.get(s);return M||(M=new tP("",s,this.engine,()=>this._rendererCache.delete(s)),this._rendererCache.set(s,M)),M}const d=i.id,m=i.id+"-"+this._currentId;this._currentId++,this.engine.register(m,e);const y=M=>{Array.isArray(M)?M.forEach(y):this.engine.registerTrigger(d,m,e,M.name,M)};return i.data.animation.forEach(y),new G4(this,m,s,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){this.promise.then(()=>{this._microtaskId++})}scheduleListenerCallback(e,i,r){e>=0&&e<this._microtaskId?this._zone.run(()=>i(r)):(0==this._animationCallbacksBuffer.length&&Promise.resolve(null).then(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(s=>{const[d,m]=s;d(m)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([i,r]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}return n.\u0275fac=function(e){return new(e||n)(Ue(Uf),Ue(ow),Ue(di))},n.\u0275prov=tn({token:n,factory:n.\u0275fac}),n})();class tP{constructor(t,e,i,r){this.namespaceId=t,this.delegate=e,this.engine=i,this._onDestroy=r,this.destroyNode=this.delegate.destroyNode?s=>e.destroyNode(s):null}get data(){return this.delegate.data}destroy(){var t;this.engine.destroy(this.namespaceId,this.delegate),this.delegate.destroy(),null===(t=this._onDestroy)||void 0===t||t.call(this)}createElement(t,e){return this.delegate.createElement(t,e)}createComment(t){return this.delegate.createComment(t)}createText(t){return this.delegate.createText(t)}appendChild(t,e){this.delegate.appendChild(t,e),this.engine.onInsert(this.namespaceId,e,t,!1)}insertBefore(t,e,i,r=!0){this.delegate.insertBefore(t,e,i),this.engine.onInsert(this.namespaceId,e,t,r)}removeChild(t,e,i){this.engine.onRemove(this.namespaceId,e,this.delegate,i)}selectRootElement(t,e){return this.delegate.selectRootElement(t,e)}parentNode(t){return this.delegate.parentNode(t)}nextSibling(t){return this.delegate.nextSibling(t)}setAttribute(t,e,i,r){this.delegate.setAttribute(t,e,i,r)}removeAttribute(t,e,i){this.delegate.removeAttribute(t,e,i)}addClass(t,e){this.delegate.addClass(t,e)}removeClass(t,e){this.delegate.removeClass(t,e)}setStyle(t,e,i,r){this.delegate.setStyle(t,e,i,r)}removeStyle(t,e,i){this.delegate.removeStyle(t,e,i)}setProperty(t,e,i){"@"==e.charAt(0)&&e==eP?this.disableAnimations(t,!!i):this.delegate.setProperty(t,e,i)}setValue(t,e){this.delegate.setValue(t,e)}listen(t,e,i){return this.delegate.listen(t,e,i)}disableAnimations(t,e){this.engine.disableAnimations(t,e)}}class G4 extends tP{constructor(t,e,i,r,s){super(e,i,r,s),this.factory=t,this.namespaceId=e}setProperty(t,e,i){"@"==e.charAt(0)?"."==e.charAt(1)&&e==eP?this.disableAnimations(t,i=void 0===i||!!i):this.engine.process(this.namespaceId,t,e.slice(1),i):this.delegate.setProperty(t,e,i)}listen(t,e,i){if("@"==e.charAt(0)){const r=function W4(n){switch(n){case"body":return document.body;case"document":return document;case"window":return window;default:return n}}(t);let s=e.slice(1),d="";return"@"!=s.charAt(0)&&([s,d]=function X4(n){const t=n.indexOf(".");return[n.substring(0,t),n.slice(t+1)]}(s)),this.engine.listen(this.namespaceId,r,s,d,m=>{this.factory.scheduleListenerCallback(m._data||-1,i,m)})}return this.delegate.listen(t,e,i)}}const nP=[{provide:gR,useClass:U4},{provide:RT,useFactory:function Y4(){return new m4}},{provide:ow,useClass:(()=>{class n extends ow{constructor(e,i,r,s){super(e.body,i,r)}ngOnDestroy(){this.flush()}}return n.\u0275fac=function(e){return new(e||n)(Ue(ui),Ue(xT),Ue(RT),Ue(Cb))},n.\u0275prov=tn({token:n,factory:n.\u0275fac}),n})()},{provide:Uf,useFactory:function K4(n,t,e){return new q4(n,t,e)},deps:[$x,ow,di]}],zT=[{provide:xT,useFactory:()=>new j4},{provide:id,useValue:"BrowserAnimations"},...nP],iP=[{provide:xT,useClass:MR},{provide:id,useValue:"NoopAnimations"},...nP];let Q4=(()=>{class n{static withConfig(e){return{ngModule:n,providers:e.disableAnimations?iP:zT}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({providers:zT,imports:[uR]}),n})();function qn(...n){return mo(n,ro(n))}function Ep(n,t){return ze(t)?Gn(n,t,1):Gn(n,1)}function Rr(n,t){return Cn((e,i)=>{let r=0;e.subscribe(bt(i,s=>n.call(t,s,r++)&&i.next(s)))})}class rP{}class oP{}class mh{constructor(t){this.normalizedNames=new Map,this.lazyUpdate=null,t?this.lazyInit="string"==typeof t?()=>{this.headers=new Map,t.split("\n").forEach(e=>{const i=e.indexOf(":");if(i>0){const r=e.slice(0,i),s=r.toLowerCase(),d=e.slice(i+1).trim();this.maybeSetNormalizedName(r,s),this.headers.has(s)?this.headers.get(s).push(d):this.headers.set(s,[d])}})}:()=>{this.headers=new Map,Object.keys(t).forEach(e=>{let i=t[e];const r=e.toLowerCase();"string"==typeof i&&(i=[i]),i.length>0&&(this.headers.set(r,i),this.maybeSetNormalizedName(e,r))})}:this.headers=new Map}has(t){return this.init(),this.headers.has(t.toLowerCase())}get(t){this.init();const e=this.headers.get(t.toLowerCase());return e&&e.length>0?e[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(t){return this.init(),this.headers.get(t.toLowerCase())||null}append(t,e){return this.clone({name:t,value:e,op:"a"})}set(t,e){return this.clone({name:t,value:e,op:"s"})}delete(t,e){return this.clone({name:t,value:e,op:"d"})}maybeSetNormalizedName(t,e){this.normalizedNames.has(e)||this.normalizedNames.set(e,t)}init(){this.lazyInit&&(this.lazyInit instanceof mh?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(t=>this.applyUpdate(t)),this.lazyUpdate=null))}copyFrom(t){t.init(),Array.from(t.headers.keys()).forEach(e=>{this.headers.set(e,t.headers.get(e)),this.normalizedNames.set(e,t.normalizedNames.get(e))})}clone(t){const e=new mh;return e.lazyInit=this.lazyInit&&this.lazyInit instanceof mh?this.lazyInit:this,e.lazyUpdate=(this.lazyUpdate||[]).concat([t]),e}applyUpdate(t){const e=t.name.toLowerCase();switch(t.op){case"a":case"s":let i=t.value;if("string"==typeof i&&(i=[i]),0===i.length)return;this.maybeSetNormalizedName(t.name,e);const r=("a"===t.op?this.headers.get(e):void 0)||[];r.push(...i),this.headers.set(e,r);break;case"d":const s=t.value;if(s){let d=this.headers.get(e);if(!d)return;d=d.filter(m=>-1===s.indexOf(m)),0===d.length?(this.headers.delete(e),this.normalizedNames.delete(e)):this.headers.set(e,d)}else this.headers.delete(e),this.normalizedNames.delete(e)}}forEach(t){this.init(),Array.from(this.normalizedNames.keys()).forEach(e=>t(this.normalizedNames.get(e),this.headers.get(e)))}}class J4{encodeKey(t){return sP(t)}encodeValue(t){return sP(t)}decodeKey(t){return decodeURIComponent(t)}decodeValue(t){return decodeURIComponent(t)}}const tU=/%(\d[a-f0-9])/gi,nU={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function sP(n){return encodeURIComponent(n).replace(tU,(t,e)=>{var i;return null!==(i=nU[e])&&void 0!==i?i:t})}function aw(n){return`${n}`}class Dp{constructor(t={}){if(this.updates=null,this.cloneFrom=null,this.encoder=t.encoder||new J4,t.fromString){if(t.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function eU(n,t){const e=new Map;return n.length>0&&n.replace(/^\?/,"").split("&").forEach(r=>{const s=r.indexOf("="),[d,m]=-1==s?[t.decodeKey(r),""]:[t.decodeKey(r.slice(0,s)),t.decodeValue(r.slice(s+1))],y=e.get(d)||[];y.push(m),e.set(d,y)}),e}(t.fromString,this.encoder)}else t.fromObject?(this.map=new Map,Object.keys(t.fromObject).forEach(e=>{const i=t.fromObject[e],r=Array.isArray(i)?i.map(aw):[aw(i)];this.map.set(e,r)})):this.map=null}has(t){return this.init(),this.map.has(t)}get(t){this.init();const e=this.map.get(t);return e?e[0]:null}getAll(t){return this.init(),this.map.get(t)||null}keys(){return this.init(),Array.from(this.map.keys())}append(t,e){return this.clone({param:t,value:e,op:"a"})}appendAll(t){const e=[];return Object.keys(t).forEach(i=>{const r=t[i];Array.isArray(r)?r.forEach(s=>{e.push({param:i,value:s,op:"a"})}):e.push({param:i,value:r,op:"a"})}),this.clone(e)}set(t,e){return this.clone({param:t,value:e,op:"s"})}delete(t,e){return this.clone({param:t,value:e,op:"d"})}toString(){return this.init(),this.keys().map(t=>{const e=this.encoder.encodeKey(t);return this.map.get(t).map(i=>e+"="+this.encoder.encodeValue(i)).join("&")}).filter(t=>""!==t).join("&")}clone(t){const e=new Dp({encoder:this.encoder});return e.cloneFrom=this.cloneFrom||this,e.updates=(this.updates||[]).concat(t),e}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(t=>this.map.set(t,this.cloneFrom.map.get(t))),this.updates.forEach(t=>{switch(t.op){case"a":case"s":const e=("a"===t.op?this.map.get(t.param):void 0)||[];e.push(aw(t.value)),this.map.set(t.param,e);break;case"d":if(void 0===t.value){this.map.delete(t.param);break}{let i=this.map.get(t.param)||[];const r=i.indexOf(aw(t.value));-1!==r&&i.splice(r,1),i.length>0?this.map.set(t.param,i):this.map.delete(t.param)}}}),this.cloneFrom=this.updates=null)}}class iU{constructor(){this.map=new Map}set(t,e){return this.map.set(t,e),this}get(t){return this.map.has(t)||this.map.set(t,t.defaultValue()),this.map.get(t)}delete(t){return this.map.delete(t),this}has(t){return this.map.has(t)}keys(){return this.map.keys()}}function aP(n){return"undefined"!=typeof ArrayBuffer&&n instanceof ArrayBuffer}function lP(n){return"undefined"!=typeof Blob&&n instanceof Blob}function cP(n){return"undefined"!=typeof FormData&&n instanceof FormData}class ev{constructor(t,e,i,r){let s;if(this.url=e,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=t.toUpperCase(),function rU(n){switch(n){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||r?(this.body=void 0!==i?i:null,s=r):s=i,s&&(this.reportProgress=!!s.reportProgress,this.withCredentials=!!s.withCredentials,s.responseType&&(this.responseType=s.responseType),s.headers&&(this.headers=s.headers),s.context&&(this.context=s.context),s.params&&(this.params=s.params)),this.headers||(this.headers=new mh),this.context||(this.context=new iU),this.params){const d=this.params.toString();if(0===d.length)this.urlWithParams=e;else{const m=e.indexOf("?");this.urlWithParams=e+(-1===m?"?":m<e.length-1?"&":"")+d}}else this.params=new Dp,this.urlWithParams=e}serializeBody(){return null===this.body?null:aP(this.body)||lP(this.body)||cP(this.body)||function oU(n){return"undefined"!=typeof URLSearchParams&&n instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof Dp?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||cP(this.body)?null:lP(this.body)?this.body.type||null:aP(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Dp?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(t={}){var e;const i=t.method||this.method,r=t.url||this.url,s=t.responseType||this.responseType,d=void 0!==t.body?t.body:this.body,m=void 0!==t.withCredentials?t.withCredentials:this.withCredentials,y=void 0!==t.reportProgress?t.reportProgress:this.reportProgress;let T=t.headers||this.headers,M=t.params||this.params;const R=null!==(e=t.context)&&void 0!==e?e:this.context;return void 0!==t.setHeaders&&(T=Object.keys(t.setHeaders).reduce((H,Z)=>H.set(Z,t.setHeaders[Z]),T)),t.setParams&&(M=Object.keys(t.setParams).reduce((H,Z)=>H.set(Z,t.setParams[Z]),M)),new ev(i,r,d,{params:M,headers:T,context:R,reportProgress:y,responseType:s,withCredentials:m})}}var Es=(()=>((Es=Es||{})[Es.Sent=0]="Sent",Es[Es.UploadProgress=1]="UploadProgress",Es[Es.ResponseHeader=2]="ResponseHeader",Es[Es.DownloadProgress=3]="DownloadProgress",Es[Es.Response=4]="Response",Es[Es.User=5]="User",Es))();class VT{constructor(t,e=200,i="OK"){this.headers=t.headers||new mh,this.status=void 0!==t.status?t.status:e,this.statusText=t.statusText||i,this.url=t.url||null,this.ok=this.status>=200&&this.status<300}}class jT extends VT{constructor(t={}){super(t),this.type=Es.ResponseHeader}clone(t={}){return new jT({headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class lw extends VT{constructor(t={}){super(t),this.type=Es.Response,this.body=void 0!==t.body?t.body:null}clone(t={}){return new lw({body:void 0!==t.body?t.body:this.body,headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class uP extends VT{constructor(t){super(t,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${t.url||"(unknown url)"}`:`Http failure response for ${t.url||"(unknown url)"}: ${t.status} ${t.statusText}`,this.error=t.error||null}}function UT(n,t){return{body:t,headers:n.headers,context:n.context,observe:n.observe,params:n.params,reportProgress:n.reportProgress,responseType:n.responseType,withCredentials:n.withCredentials}}let dP=(()=>{class n{constructor(e){this.handler=e}request(e,i,r={}){let s;if(e instanceof ev)s=e;else{let y,T;y=r.headers instanceof mh?r.headers:new mh(r.headers),r.params&&(T=r.params instanceof Dp?r.params:new Dp({fromObject:r.params})),s=new ev(e,i,void 0!==r.body?r.body:null,{headers:y,context:r.context,params:T,reportProgress:r.reportProgress,responseType:r.responseType||"json",withCredentials:r.withCredentials})}const d=qn(s).pipe(Ep(y=>this.handler.handle(y)));if(e instanceof ev||"events"===r.observe)return d;const m=d.pipe(Rr(y=>y instanceof lw));switch(r.observe||"body"){case"body":switch(s.responseType){case"arraybuffer":return m.pipe($t(y=>{if(null!==y.body&&!(y.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return y.body}));case"blob":return m.pipe($t(y=>{if(null!==y.body&&!(y.body instanceof Blob))throw new Error("Response is not a Blob.");return y.body}));case"text":return m.pipe($t(y=>{if(null!==y.body&&"string"!=typeof y.body)throw new Error("Response is not a string.");return y.body}));default:return m.pipe($t(y=>y.body))}case"response":return m;default:throw new Error(`Unreachable: unhandled observe type ${r.observe}}`)}}delete(e,i={}){return this.request("DELETE",e,i)}get(e,i={}){return this.request("GET",e,i)}head(e,i={}){return this.request("HEAD",e,i)}jsonp(e,i){return this.request("JSONP",e,{params:(new Dp).append(i,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(e,i={}){return this.request("OPTIONS",e,i)}patch(e,i,r={}){return this.request("PATCH",e,UT(r,i))}post(e,i,r={}){return this.request("POST",e,UT(r,i))}put(e,i,r={}){return this.request("PUT",e,UT(r,i))}}return n.\u0275fac=function(e){return new(e||n)(Ue(rP))},n.\u0275prov=tn({token:n,factory:n.\u0275fac}),n})();class hP{constructor(t,e){this.next=t,this.interceptor=e}handle(t){return this.interceptor.intercept(t,this.next)}}const pP=new Dt("HTTP_INTERCEPTORS");let sU=(()=>{class n{intercept(e,i){return i.handle(e)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=tn({token:n,factory:n.\u0275fac}),n})();const aU=/^\)\]\}',?\n/;let fP=(()=>{class n{constructor(e){this.xhrFactory=e}handle(e){if("JSONP"===e.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new Mt(i=>{const r=this.xhrFactory.build();if(r.open(e.method,e.urlWithParams),e.withCredentials&&(r.withCredentials=!0),e.headers.forEach((Z,te)=>r.setRequestHeader(Z,te.join(","))),e.headers.has("Accept")||r.setRequestHeader("Accept","application/json, text/plain, */*"),!e.headers.has("Content-Type")){const Z=e.detectContentTypeHeader();null!==Z&&r.setRequestHeader("Content-Type",Z)}if(e.responseType){const Z=e.responseType.toLowerCase();r.responseType="json"!==Z?Z:"text"}const s=e.serializeBody();let d=null;const m=()=>{if(null!==d)return d;const Z=r.statusText||"OK",te=new mh(r.getAllResponseHeaders()),xe=function lU(n){return"responseURL"in n&&n.responseURL?n.responseURL:/^X-Request-URL:/m.test(n.getAllResponseHeaders())?n.getResponseHeader("X-Request-URL"):null}(r)||e.url;return d=new jT({headers:te,status:r.status,statusText:Z,url:xe}),d},y=()=>{let{headers:Z,status:te,statusText:xe,url:Ce}=m(),et=null;204!==te&&(et=void 0===r.response?r.responseText:r.response),0===te&&(te=et?200:0);let kt=te>=200&&te<300;if("json"===e.responseType&&"string"==typeof et){const pt=et;et=et.replace(aU,"");try{et=""!==et?JSON.parse(et):null}catch(en){et=pt,kt&&(kt=!1,et={error:en,text:et})}}kt?(i.next(new lw({body:et,headers:Z,status:te,statusText:xe,url:Ce||void 0})),i.complete()):i.error(new uP({error:et,headers:Z,status:te,statusText:xe,url:Ce||void 0}))},T=Z=>{const{url:te}=m(),xe=new uP({error:Z,status:r.status||0,statusText:r.statusText||"Unknown Error",url:te||void 0});i.error(xe)};let M=!1;const R=Z=>{M||(i.next(m()),M=!0);let te={type:Es.DownloadProgress,loaded:Z.loaded};Z.lengthComputable&&(te.total=Z.total),"text"===e.responseType&&!!r.responseText&&(te.partialText=r.responseText),i.next(te)},H=Z=>{let te={type:Es.UploadProgress,loaded:Z.loaded};Z.lengthComputable&&(te.total=Z.total),i.next(te)};return r.addEventListener("load",y),r.addEventListener("error",T),r.addEventListener("timeout",T),r.addEventListener("abort",T),e.reportProgress&&(r.addEventListener("progress",R),null!==s&&r.upload&&r.upload.addEventListener("progress",H)),r.send(s),i.next({type:Es.Sent}),()=>{r.removeEventListener("error",T),r.removeEventListener("abort",T),r.removeEventListener("load",y),r.removeEventListener("timeout",T),e.reportProgress&&(r.removeEventListener("progress",R),null!==s&&r.upload&&r.upload.removeEventListener("progress",H)),r.readyState!==r.DONE&&r.abort()}})}}return n.\u0275fac=function(e){return new(e||n)(Ue($k))},n.\u0275prov=tn({token:n,factory:n.\u0275fac}),n})();const HT=new Dt("XSRF_COOKIE_NAME"),$T=new Dt("XSRF_HEADER_NAME");class mP{}let cU=(()=>{class n{constructor(e,i,r){this.doc=e,this.platform=i,this.cookieName=r,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const e=this.doc.cookie||"";return e!==this.lastCookieString&&(this.parseCount++,this.lastToken=Rk(e,this.cookieName),this.lastCookieString=e),this.lastToken}}return n.\u0275fac=function(e){return new(e||n)(Ue(ui),Ue(xx),Ue(HT))},n.\u0275prov=tn({token:n,factory:n.\u0275fac}),n})(),qT=(()=>{class n{constructor(e,i){this.tokenService=e,this.headerName=i}intercept(e,i){const r=e.url.toLowerCase();if("GET"===e.method||"HEAD"===e.method||r.startsWith("http://")||r.startsWith("https://"))return i.handle(e);const s=this.tokenService.getToken();return null!==s&&!e.headers.has(this.headerName)&&(e=e.clone({headers:e.headers.set(this.headerName,s)})),i.handle(e)}}return n.\u0275fac=function(e){return new(e||n)(Ue(mP),Ue($T))},n.\u0275prov=tn({token:n,factory:n.\u0275fac}),n})(),uU=(()=>{class n{constructor(e,i){this.backend=e,this.injector=i,this.chain=null}handle(e){if(null===this.chain){const i=this.injector.get(pP,[]);this.chain=i.reduceRight((r,s)=>new hP(r,s),this.backend)}return this.chain.handle(e)}}return n.\u0275fac=function(e){return new(e||n)(Ue(oP),Ue(Xr))},n.\u0275prov=tn({token:n,factory:n.\u0275fac}),n})(),dU=(()=>{class n{static disable(){return{ngModule:n,providers:[{provide:qT,useClass:sU}]}}static withOptions(e={}){return{ngModule:n,providers:[e.cookieName?{provide:HT,useValue:e.cookieName}:[],e.headerName?{provide:$T,useValue:e.headerName}:[]]}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({providers:[qT,{provide:pP,useExisting:qT,multi:!0},{provide:mP,useClass:cU},{provide:HT,useValue:"XSRF-TOKEN"},{provide:$T,useValue:"X-XSRF-TOKEN"}]}),n})(),hU=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({providers:[dP,{provide:rP,useClass:uU},fP,{provide:oP,useExisting:fP}],imports:[dU.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]}),n})();const{isArray:pU}=Array,{getPrototypeOf:fU,prototype:mU,keys:gU}=Object;function gP(n){if(1===n.length){const t=n[0];if(pU(t))return{args:t,keys:null};if(function bU(n){return n&&"object"==typeof n&&fU(n)===mU}(t)){const e=gU(t);return{args:e.map(i=>t[i]),keys:e}}}return{args:n,keys:null}}const{isArray:_U}=Array;function GT(n){return $t(t=>function yU(n,t){return _U(t)?n(...t):n(t)}(n,t))}function bP(n,t){return n.reduce((e,i,r)=>(e[i]=t[r],e),{})}function _P(...n){const t=al(n),{args:e,keys:i}=gP(n),r=new Mt(s=>{const{length:d}=e;if(!d)return void s.complete();const m=new Array(d);let y=d,T=d;for(let M=0;M<d;M++){let R=!1;Pt(e[M]).subscribe(bt(s,H=>{R||(R=!0,T--),m[M]=H},()=>y--,void 0,()=>{(!y||!R)&&(T||s.next(i?bP(i,m):m),s.complete())}))}});return t?r.pipe(GT(t)):r}let yP=(()=>{class n{constructor(e,i){this._renderer=e,this._elementRef=i,this.onChange=r=>{},this.onTouched=()=>{}}setProperty(e,i){this._renderer.setProperty(this._elementRef.nativeElement,e,i)}registerOnTouched(e){this.onTouched=e}registerOnChange(e){this.onChange=e}setDisabledState(e){this.setProperty("disabled",e)}}return n.\u0275fac=function(e){return new(e||n)(X(xc),X(zn))},n.\u0275dir=Ft({type:n}),n})(),um=(()=>{class n extends yP{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Yi(n)))(i||n)}}(),n.\u0275dir=Ft({type:n,features:[Yt]}),n})();const nl=new Dt("NgValueAccessor"),xU={provide:nl,useExisting:$i(()=>ld),multi:!0},SU=new Dt("CompositionEventMode");let ld=(()=>{class n extends yP{constructor(e,i,r){super(e,i),this._compositionMode=r,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function wU(){const n=sd()?sd().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}())}writeValue(e){this.setProperty("value",null==e?"":e)}_handleInput(e){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(e)}_compositionStart(){this._composing=!0}_compositionEnd(e){this._composing=!1,this._compositionMode&&this.onChange(e)}}return n.\u0275fac=function(e){return new(e||n)(X(xc),X(zn),X(SU,8))},n.\u0275dir=Ft({type:n,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(e,i){1&e&&nn("input",function(s){return i._handleInput(s.target.value)})("blur",function(){return i.onTouched()})("compositionstart",function(){return i._compositionStart()})("compositionend",function(s){return i._compositionEnd(s.target.value)})},features:[ni([xU]),Yt]}),n})();function Ip(n){return null==n||("string"==typeof n||Array.isArray(n))&&0===n.length}function xP(n){return null!=n&&"number"==typeof n.length}const ra=new Dt("NgValidators"),Mp=new Dt("NgAsyncValidators"),TU=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class WT{static min(t){return function wP(n){return t=>{if(Ip(t.value)||Ip(n))return null;const e=parseFloat(t.value);return!isNaN(e)&&e<n?{min:{min:n,actual:t.value}}:null}}(t)}static max(t){return function SP(n){return t=>{if(Ip(t.value)||Ip(n))return null;const e=parseFloat(t.value);return!isNaN(e)&&e>n?{max:{max:n,actual:t.value}}:null}}(t)}static required(t){return CP(t)}static requiredTrue(t){return TP(t)}static email(t){return function EP(n){return Ip(n.value)||TU.test(n.value)?null:{email:!0}}(t)}static minLength(t){return function DP(n){return t=>Ip(t.value)||!xP(t.value)?null:t.value.length<n?{minlength:{requiredLength:n,actualLength:t.value.length}}:null}(t)}static maxLength(t){return function IP(n){return t=>xP(t.value)&&t.value.length>n?{maxlength:{requiredLength:n,actualLength:t.value.length}}:null}(t)}static pattern(t){return function MP(n){if(!n)return cw;let t,e;return"string"==typeof n?(e="","^"!==n.charAt(0)&&(e+="^"),e+=n,"$"!==n.charAt(n.length-1)&&(e+="$"),t=new RegExp(e)):(e=n.toString(),t=n),i=>{if(Ip(i.value))return null;const r=i.value;return t.test(r)?null:{pattern:{requiredPattern:e,actualValue:r}}}}(t)}static nullValidator(t){return null}static compose(t){return LP(t)}static composeAsync(t){return FP(t)}}function CP(n){return Ip(n.value)?{required:!0}:null}function TP(n){return!0===n.value?null:{required:!0}}function cw(n){return null}function AP(n){return null!=n}function kP(n){return Iy(n)?mo(n):n}function RP(n){let t={};return n.forEach(e=>{t=null!=e?Object.assign(Object.assign({},t),e):t}),0===Object.keys(t).length?null:t}function PP(n,t){return t.map(e=>e(n))}function OP(n){return n.map(t=>function EU(n){return!n.validate}(t)?t:e=>t.validate(e))}function LP(n){if(!n)return null;const t=n.filter(AP);return 0==t.length?null:function(e){return RP(PP(e,t))}}function XT(n){return null!=n?LP(OP(n)):null}function FP(n){if(!n)return null;const t=n.filter(AP);return 0==t.length?null:function(e){return _P(PP(e,t).map(kP)).pipe($t(RP))}}function ZT(n){return null!=n?FP(OP(n)):null}function NP(n,t){return null===n?[t]:Array.isArray(n)?[...n,t]:[n,t]}function BP(n){return n._rawValidators}function zP(n){return n._rawAsyncValidators}function YT(n){return n?Array.isArray(n)?n:[n]:[]}function uw(n,t){return Array.isArray(n)?n.includes(t):n===t}function VP(n,t){const e=YT(t);return YT(n).forEach(r=>{uw(e,r)||e.push(r)}),e}function jP(n,t){return YT(t).filter(e=>!uw(n,e))}class UP{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(t){this._rawValidators=t||[],this._composedValidatorFn=XT(this._rawValidators)}_setAsyncValidators(t){this._rawAsyncValidators=t||[],this._composedAsyncValidatorFn=ZT(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(t){this._onDestroyCallbacks.push(t)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(t=>t()),this._onDestroyCallbacks=[]}reset(t){this.control&&this.control.reset(t)}hasError(t,e){return!!this.control&&this.control.hasError(t,e)}getError(t,e){return this.control?this.control.getError(t,e):null}}class tc extends UP{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class il extends UP{get formDirective(){return null}get path(){return null}}let gh=(()=>{class n extends class HP{constructor(t){this._cd=t}get isTouched(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.touched)}get isUntouched(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.untouched)}get isPristine(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.pristine)}get isDirty(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.dirty)}get isValid(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.valid)}get isInvalid(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.invalid)}get isPending(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.pending)}get isSubmitted(){var t;return!(null===(t=this._cd)||void 0===t||!t.submitted)}}{constructor(e){super(e)}}return n.\u0275fac=function(e){return new(e||n)(X(tc,2))},n.\u0275dir=Ft({type:n,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(e,i){2&e&&Ui("ng-untouched",i.isUntouched)("ng-touched",i.isTouched)("ng-pristine",i.isPristine)("ng-dirty",i.isDirty)("ng-valid",i.isValid)("ng-invalid",i.isInvalid)("ng-pending",i.isPending)},features:[Yt]}),n})();const tv="VALID",hw="INVALID",Ib="PENDING",nv="DISABLED";function eE(n){return(pw(n)?n.validators:n)||null}function qP(n){return Array.isArray(n)?XT(n):n||null}function tE(n,t){return(pw(t)?t.asyncValidators:n)||null}function GP(n){return Array.isArray(n)?ZT(n):n||null}function pw(n){return null!=n&&!Array.isArray(n)&&"object"==typeof n}class ZP{constructor(t,e){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=t,this._rawAsyncValidators=e,this._composedValidatorFn=qP(this._rawValidators),this._composedAsyncValidatorFn=GP(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(t){this._rawValidators=this._composedValidatorFn=t}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(t){this._rawAsyncValidators=this._composedAsyncValidatorFn=t}get parent(){return this._parent}get valid(){return this.status===tv}get invalid(){return this.status===hw}get pending(){return this.status==Ib}get disabled(){return this.status===nv}get enabled(){return this.status!==nv}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(t){this._rawValidators=t,this._composedValidatorFn=qP(t)}setAsyncValidators(t){this._rawAsyncValidators=t,this._composedAsyncValidatorFn=GP(t)}addValidators(t){this.setValidators(VP(t,this._rawValidators))}addAsyncValidators(t){this.setAsyncValidators(VP(t,this._rawAsyncValidators))}removeValidators(t){this.setValidators(jP(t,this._rawValidators))}removeAsyncValidators(t){this.setAsyncValidators(jP(t,this._rawAsyncValidators))}hasValidator(t){return uw(this._rawValidators,t)}hasAsyncValidator(t){return uw(this._rawAsyncValidators,t)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(t={}){this.touched=!0,this._parent&&!t.onlySelf&&this._parent.markAsTouched(t)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(t=>t.markAllAsTouched())}markAsUntouched(t={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(e=>{e.markAsUntouched({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}markAsDirty(t={}){this.pristine=!1,this._parent&&!t.onlySelf&&this._parent.markAsDirty(t)}markAsPristine(t={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(e=>{e.markAsPristine({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}markAsPending(t={}){this.status=Ib,!1!==t.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!t.onlySelf&&this._parent.markAsPending(t)}disable(t={}){const e=this._parentMarkedDirty(t.onlySelf);this.status=nv,this.errors=null,this._forEachChild(i=>{i.disable(Object.assign(Object.assign({},t),{onlySelf:!0}))}),this._updateValue(),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Object.assign(Object.assign({},t),{skipPristineCheck:e})),this._onDisabledChange.forEach(i=>i(!0))}enable(t={}){const e=this._parentMarkedDirty(t.onlySelf);this.status=tv,this._forEachChild(i=>{i.enable(Object.assign(Object.assign({},t),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent}),this._updateAncestors(Object.assign(Object.assign({},t),{skipPristineCheck:e})),this._onDisabledChange.forEach(i=>i(!1))}_updateAncestors(t){this._parent&&!t.onlySelf&&(this._parent.updateValueAndValidity(t),t.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(t){this._parent=t}getRawValue(){return this.value}updateValueAndValidity(t={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===tv||this.status===Ib)&&this._runAsyncValidator(t.emitEvent)),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!t.onlySelf&&this._parent.updateValueAndValidity(t)}_updateTreeValidity(t={emitEvent:!0}){this._forEachChild(e=>e._updateTreeValidity(t)),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?nv:tv}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(t){if(this.asyncValidator){this.status=Ib,this._hasOwnPendingAsyncValidator=!0;const e=kP(this.asyncValidator(this));this._asyncValidationSubscription=e.subscribe(i=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(i,{emitEvent:t})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(t,e={}){this.errors=t,this._updateControlsErrors(!1!==e.emitEvent)}get(t){let e=t;return null==e||(Array.isArray(e)||(e=e.split(".")),0===e.length)?null:e.reduce((i,r)=>i&&i._find(r),this)}getError(t,e){const i=e?this.get(e):this;return i&&i.errors?i.errors[t]:null}hasError(t,e){return!!this.getError(t,e)}get root(){let t=this;for(;t._parent;)t=t._parent;return t}_updateControlsErrors(t){this.status=this._calculateStatus(),t&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(t)}_initObservables(){this.valueChanges=new on,this.statusChanges=new on}_calculateStatus(){return this._allControlsDisabled()?nv:this.errors?hw:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Ib)?Ib:this._anyControlsHaveStatus(hw)?hw:tv}_anyControlsHaveStatus(t){return this._anyControls(e=>e.status===t)}_anyControlsDirty(){return this._anyControls(t=>t.dirty)}_anyControlsTouched(){return this._anyControls(t=>t.touched)}_updatePristine(t={}){this.pristine=!this._anyControlsDirty(),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}_updateTouched(t={}){this.touched=this._anyControlsTouched(),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}_registerOnCollectionChange(t){this._onCollectionChange=t}_setUpdateStrategy(t){pw(t)&&null!=t.updateOn&&(this._updateOn=t.updateOn)}_parentMarkedDirty(t){return!t&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(t){return null}}class nE extends ZP{constructor(t,e,i){super(eE(e),tE(i,e)),this.controls=t,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(t,e){return this.controls[t]?this.controls[t]:(this.controls[t]=e,e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange),e)}addControl(t,e,i={}){this.registerControl(t,e),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}removeControl(t,e={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}setControl(t,e,i={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],e&&this.registerControl(t,e),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}contains(t){return this.controls.hasOwnProperty(t)&&this.controls[t].enabled}setValue(t,e={}){(function XP(n,t,e){n._forEachChild((i,r)=>{if(void 0===e[r])throw new Nt(1002,"")})})(this,0,t),Object.keys(t).forEach(i=>{(function WP(n,t,e){const i=n.controls;if(!(t?Object.keys(i):i).length)throw new Nt(1e3,"");if(!i[e])throw new Nt(1001,"")})(this,!0,i),this.controls[i].setValue(t[i],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(t,e={}){null!=t&&(Object.keys(t).forEach(i=>{const r=this.controls[i];r&&r.patchValue(t[i],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(t={},e={}){this._forEachChild((i,r)=>{i.reset(t[r],{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e),this._updateTouched(e),this.updateValueAndValidity(e)}getRawValue(){return this._reduceChildren({},(t,e,i)=>(t[i]=e.getRawValue(),t))}_syncPendingControls(){let t=this._reduceChildren(!1,(e,i)=>!!i._syncPendingControls()||e);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_forEachChild(t){Object.keys(this.controls).forEach(e=>{const i=this.controls[e];i&&t(i,e)})}_setUpControls(){this._forEachChild(t=>{t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(t){for(const[e,i]of Object.entries(this.controls))if(this.contains(e)&&t(i))return!0;return!1}_reduceValue(){return this._reduceChildren({},(e,i,r)=>((i.enabled||this.disabled)&&(e[r]=i.value),e))}_reduceChildren(t,e){let i=t;return this._forEachChild((r,s)=>{i=e(i,r,s)}),i}_allControlsDisabled(){for(const t of Object.keys(this.controls))if(this.controls[t].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(t){return this.controls.hasOwnProperty(t)?this.controls[t]:null}}function iv(n,t){var e,i;iE(n,t),t.valueAccessor.writeValue(n.value),n.disabled&&(null===(i=(e=t.valueAccessor).setDisabledState)||void 0===i||i.call(e,!0)),function FU(n,t){t.valueAccessor.registerOnChange(e=>{n._pendingValue=e,n._pendingChange=!0,n._pendingDirty=!0,"change"===n.updateOn&&YP(n,t)})}(n,t),function BU(n,t){const e=(i,r)=>{t.valueAccessor.writeValue(i),r&&t.viewToModelUpdate(i)};n.registerOnChange(e),t._registerOnDestroy(()=>{n._unregisterOnChange(e)})}(n,t),function NU(n,t){t.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,"blur"===n.updateOn&&n._pendingChange&&YP(n,t),"submit"!==n.updateOn&&n.markAsTouched()})}(n,t),function LU(n,t){if(t.valueAccessor.setDisabledState){const e=i=>{t.valueAccessor.setDisabledState(i)};n.registerOnDisabledChange(e),t._registerOnDestroy(()=>{n._unregisterOnDisabledChange(e)})}}(n,t)}function mw(n,t,e=!0){const i=()=>{};t.valueAccessor&&(t.valueAccessor.registerOnChange(i),t.valueAccessor.registerOnTouched(i)),bw(n,t),n&&(t._invokeOnDestroyCallbacks(),n._registerOnCollectionChange(()=>{}))}function gw(n,t){n.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(t)})}function iE(n,t){const e=BP(n);null!==t.validator?n.setValidators(NP(e,t.validator)):"function"==typeof e&&n.setValidators([e]);const i=zP(n);null!==t.asyncValidator?n.setAsyncValidators(NP(i,t.asyncValidator)):"function"==typeof i&&n.setAsyncValidators([i]);const r=()=>n.updateValueAndValidity();gw(t._rawValidators,r),gw(t._rawAsyncValidators,r)}function bw(n,t){let e=!1;if(null!==n){if(null!==t.validator){const r=BP(n);if(Array.isArray(r)&&r.length>0){const s=r.filter(d=>d!==t.validator);s.length!==r.length&&(e=!0,n.setValidators(s))}}if(null!==t.asyncValidator){const r=zP(n);if(Array.isArray(r)&&r.length>0){const s=r.filter(d=>d!==t.asyncValidator);s.length!==r.length&&(e=!0,n.setAsyncValidators(s))}}}const i=()=>{};return gw(t._rawValidators,i),gw(t._rawAsyncValidators,i),e}function YP(n,t){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),t.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function KP(n,t){iE(n,t)}function rE(n,t){if(!n.hasOwnProperty("model"))return!1;const e=n.model;return!!e.isFirstChange()||!Object.is(t,e.currentValue)}function JP(n,t){n._syncPendingControls(),t.forEach(e=>{const i=e.control;"submit"===i.updateOn&&i._pendingChange&&(e.viewToModelUpdate(i._pendingValue),i._pendingChange=!1)})}function oE(n,t){if(!t)return null;let e,i,r;return Array.isArray(t),t.forEach(s=>{s.constructor===ld?e=s:function jU(n){return Object.getPrototypeOf(n.constructor)===um}(s)?i=s:r=s}),r||i||e||null}const HU={provide:il,useExisting:$i(()=>Mb)},rv=(()=>Promise.resolve())();let Mb=(()=>{class n extends il{constructor(e,i){super(),this.submitted=!1,this._directives=new Set,this.ngSubmit=new on,this.form=new nE({},XT(e),ZT(i))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(e){rv.then(()=>{const i=this._findContainer(e.path);e.control=i.registerControl(e.name,e.control),iv(e.control,e),e.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(e)})}getControl(e){return this.form.get(e.path)}removeControl(e){rv.then(()=>{const i=this._findContainer(e.path);i&&i.removeControl(e.name),this._directives.delete(e)})}addFormGroup(e){rv.then(()=>{const i=this._findContainer(e.path),r=new nE({});KP(r,e),i.registerControl(e.name,r),r.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(e){rv.then(()=>{const i=this._findContainer(e.path);i&&i.removeControl(e.name)})}getFormGroup(e){return this.form.get(e.path)}updateModel(e,i){rv.then(()=>{this.form.get(e.path).setValue(i)})}setValue(e){this.control.setValue(e)}onSubmit(e){var i;return this.submitted=!0,JP(this.form,this._directives),this.ngSubmit.emit(e),"dialog"===(null===(i=null==e?void 0:e.target)||void 0===i?void 0:i.method)}onReset(){this.resetForm()}resetForm(e){this.form.reset(e),this.submitted=!1}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(e){return e.pop(),e.length?this.form.get(e):this.form}}return n.\u0275fac=function(e){return new(e||n)(X(ra,10),X(Mp,10))},n.\u0275dir=Ft({type:n,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(e,i){1&e&&nn("submit",function(s){return i.onSubmit(s)})("reset",function(){return i.onReset()})},inputs:{options:["ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[ni([HU]),Yt]}),n})();function eO(n,t){const e=n.indexOf(t);e>-1&&n.splice(e,1)}function tO(n){return"object"==typeof n&&null!==n&&2===Object.keys(n).length&&"value"in n&&"disabled"in n}const _w=class extends ZP{constructor(t=null,e,i){super(eE(e),tE(i,e)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(t),this._setUpdateStrategy(e),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),pw(e)&&(e.nonNullable||e.initialValueIsDefault)&&(this.defaultValue=tO(t)?t.value:t)}setValue(t,e={}){this.value=this._pendingValue=t,this._onChange.length&&!1!==e.emitModelToViewChange&&this._onChange.forEach(i=>i(this.value,!1!==e.emitViewToModelChange)),this.updateValueAndValidity(e)}patchValue(t,e={}){this.setValue(t,e)}reset(t=this.defaultValue,e={}){this._applyFormState(t),this.markAsPristine(e),this.markAsUntouched(e),this.setValue(this.value,e),this._pendingChange=!1}_updateValue(){}_anyControls(t){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(t){this._onChange.push(t)}_unregisterOnChange(t){eO(this._onChange,t)}registerOnDisabledChange(t){this._onDisabledChange.push(t)}_unregisterOnDisabledChange(t){eO(this._onDisabledChange,t)}_forEachChild(t){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(t){tO(t)?(this.value=this._pendingValue=t.value,t.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=t}},GU={provide:tc,useExisting:$i(()=>Ap)},rO=(()=>Promise.resolve())();let Ap=(()=>{class n extends tc{constructor(e,i,r,s,d){super(),this._changeDetectorRef=d,this.control=new _w,this._registered=!1,this.update=new on,this._parent=e,this._setValidators(i),this._setAsyncValidators(r),this.valueAccessor=oE(0,s)}ngOnChanges(e){if(this._checkForErrors(),!this._registered||"name"in e){if(this._registered&&(this._checkName(),this.formDirective)){const i=e.name.previousValue;this.formDirective.removeControl({name:i,path:this._getPath(i)})}this._setUpControl()}"isDisabled"in e&&this._updateDisabled(e),rE(e,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){iv(this.control,this),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(e){rO.then(()=>{var i;this.control.setValue(e,{emitViewToModelChange:!1}),null===(i=this._changeDetectorRef)||void 0===i||i.markForCheck()})}_updateDisabled(e){const i=e.isDisabled.currentValue,r=0!==i&&uh(i);rO.then(()=>{var s;r&&!this.control.disabled?this.control.disable():!r&&this.control.disabled&&this.control.enable(),null===(s=this._changeDetectorRef)||void 0===s||s.markForCheck()})}_getPath(e){return this._parent?function fw(n,t){return[...t.path,n]}(e,this._parent):[e]}}return n.\u0275fac=function(e){return new(e||n)(X(il,9),X(ra,10),X(Mp,10),X(nl,10),X(kr,8))},n.\u0275dir=Ft({type:n,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[ni([GU]),Yt,_r]}),n})(),sO=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({}),n})();const sE=new Dt("NgModelWithFormControlWarning"),QU={provide:tc,useExisting:$i(()=>yw)};let yw=(()=>{class n extends tc{constructor(e,i,r,s){super(),this._ngModelWarningConfig=s,this.update=new on,this._ngModelWarningSent=!1,this._setValidators(e),this._setAsyncValidators(i),this.valueAccessor=oE(0,r)}set isDisabled(e){}ngOnChanges(e){if(this._isControlChanged(e)){const i=e.form.previousValue;i&&mw(i,this,!1),iv(this.form,this),this.form.updateValueAndValidity({emitEvent:!1})}rE(e,this.viewModel)&&(this.form.setValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.form&&mw(this.form,this,!1)}get path(){return[]}get control(){return this.form}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_isControlChanged(e){return e.hasOwnProperty("form")}}return n._ngModelWarningSentOnce=!1,n.\u0275fac=function(e){return new(e||n)(X(ra,10),X(Mp,10),X(nl,10),X(sE,8))},n.\u0275dir=Ft({type:n,selectors:[["","formControl",""]],inputs:{form:["formControl","form"],isDisabled:["disabled","isDisabled"],model:["ngModel","model"]},outputs:{update:"ngModelChange"},exportAs:["ngForm"],features:[ni([QU]),Yt,_r]}),n})();const JU={provide:il,useExisting:$i(()=>Ab)};let Ab=(()=>{class n extends il{constructor(e,i){super(),this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new on,this._setValidators(e),this._setAsyncValidators(i)}ngOnChanges(e){this._checkFormPresent(),e.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(bw(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(e){const i=this.form.get(e.path);return iv(i,e),i.updateValueAndValidity({emitEvent:!1}),this.directives.push(e),i}getControl(e){return this.form.get(e.path)}removeControl(e){mw(e.control||null,e,!1),function UU(n,t){const e=n.indexOf(t);e>-1&&n.splice(e,1)}(this.directives,e)}addFormGroup(e){this._setUpFormContainer(e)}removeFormGroup(e){this._cleanUpFormContainer(e)}getFormGroup(e){return this.form.get(e.path)}addFormArray(e){this._setUpFormContainer(e)}removeFormArray(e){this._cleanUpFormContainer(e)}getFormArray(e){return this.form.get(e.path)}updateModel(e,i){this.form.get(e.path).setValue(i)}onSubmit(e){var i;return this.submitted=!0,JP(this.form,this.directives),this.ngSubmit.emit(e),"dialog"===(null===(i=null==e?void 0:e.target)||void 0===i?void 0:i.method)}onReset(){this.resetForm()}resetForm(e){this.form.reset(e),this.submitted=!1}_updateDomValue(){this.directives.forEach(e=>{const i=e.control,r=this.form.get(e.path);i!==r&&(mw(i||null,e),(n=>n instanceof _w)(r)&&(iv(r,e),e.control=r))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(e){const i=this.form.get(e.path);KP(i,e),i.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(e){if(this.form){const i=this.form.get(e.path);i&&function zU(n,t){return bw(n,t)}(i,e)&&i.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){iE(this.form,this),this._oldForm&&bw(this._oldForm,this)}_checkFormPresent(){}}return n.\u0275fac=function(e){return new(e||n)(X(ra,10),X(Mp,10))},n.\u0275dir=Ft({type:n,selectors:[["","formGroup",""]],hostBindings:function(e,i){1&e&&nn("submit",function(s){return i.onSubmit(s)})("reset",function(){return i.onReset()})},inputs:{form:["formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[ni([JU]),Yt,_r]}),n})(),dm=(()=>{class n{constructor(){this._validator=cw}ngOnChanges(e){if(this.inputName in e){const i=this.normalizeInput(e[this.inputName].currentValue);this._enabled=this.enabled(i),this._validator=this._enabled?this.createValidator(i):cw,this._onChange&&this._onChange()}}validate(e){return this._validator(e)}registerOnValidatorChange(e){this._onChange=e}enabled(e){return null!=e}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=Ft({type:n,features:[_r]}),n})();const dH={provide:ra,useExisting:$i(()=>dE),multi:!0},hH={provide:ra,useExisting:$i(()=>hE),multi:!0};let dE=(()=>{class n extends dm{constructor(){super(...arguments),this.inputName="required",this.normalizeInput=uh,this.createValidator=e=>CP}enabled(e){return e}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Yi(n)))(i||n)}}(),n.\u0275dir=Ft({type:n,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(e,i){2&e&&Sn("required",i._enabled?"":null)},inputs:{required:"required"},features:[ni([dH]),Yt]}),n})(),hE=(()=>{class n extends dE{constructor(){super(...arguments),this.createValidator=e=>TP}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Yi(n)))(i||n)}}(),n.\u0275dir=Ft({type:n,selectors:[["input","type","checkbox","required","","formControlName",""],["input","type","checkbox","required","","formControl",""],["input","type","checkbox","required","","ngModel",""]],hostVars:1,hostBindings:function(e,i){2&e&&Sn("required",i._enabled?"":null)},features:[ni([hH]),Yt]}),n})(),xO=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({imports:[sO]}),n})(),bH=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({imports:[xO]}),n})(),_H=(()=>{class n{static withConfig(e){return{ngModule:n,providers:[{provide:sE,useValue:e.warnOnNgModelWithFormControl}]}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({imports:[xO]}),n})();class _a extends Wt{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){const e=super._subscribe(t);return!e.closed&&t.next(this._value),e}getValue(){const{hasError:t,thrownError:e,_value:i}=this;if(t)throw e;return this._throwIfClosed(),i}next(t){super.next(this._value=t)}}const vw=je(n=>function(){n(this),this.name="EmptyError",this.message="no elements in sequence"});function hm(...n){const t=ro(n),e=al(n),{args:i,keys:r}=gP(n);if(0===i.length)return mo([],t);const s=new Mt(function vH(n,t,e=Je){return i=>{wO(t,()=>{const{length:r}=n,s=new Array(r);let d=r,m=r;for(let y=0;y<r;y++)wO(t,()=>{const T=mo(n[y],t);let M=!1;T.subscribe(bt(i,R=>{s[y]=R,M||(M=!0,m--),m||i.next(e(s.slice()))},()=>{--d||i.complete()}))},i)},i)}}(i,t,r?d=>bP(r,d):Je));return e?s.pipe(GT(e)):s}function wO(n,t,e){n?oo(e,n,t):t()}function ov(...n){return function xH(){return Wo(1)}()(mo(n,ro(n)))}function pm(n){return new Mt(t=>{Pt(n()).subscribe(t)})}function kb(n,t){const e=ze(n)?n:()=>n,i=r=>r.error(e());return new Mt(t?r=>t.schedule(i,0,r):i)}function pE(){return Cn((n,t)=>{let e=null;n._refCount++;const i=bt(t,void 0,void 0,void 0,()=>{if(!n||n._refCount<=0||0<--n._refCount)return void(e=null);const r=n._connection,s=e;e=null,r&&(!s||r===s)&&r.unsubscribe(),t.unsubscribe()});n.subscribe(i),i.closed||(e=n.connect())})}class fE extends Mt{constructor(t,e){super(),this.source=t,this.subjectFactory=e,this._subject=null,this._refCount=0,this._connection=null,wo(t)&&(this.lift=t.lift)}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){const t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:t}=this;this._subject=this._connection=null,null==t||t.unsubscribe()}connect(){let t=this._connection;if(!t){t=this._connection=new he;const e=this.getSubject();t.add(this.source.subscribe(bt(e,void 0,()=>{this._teardown(),e.complete()},i=>{this._teardown(),e.error(i)},()=>this._teardown()))),t.closed&&(this._connection=null,t=he.EMPTY)}return t}refCount(){return pE()(this)}}function ya(n,t){return Cn((e,i)=>{let r=null,s=0,d=!1;const m=()=>d&&!r&&i.complete();e.subscribe(bt(i,y=>{null==r||r.unsubscribe();let T=0;const M=s++;Pt(n(y,M)).subscribe(r=bt(i,R=>i.next(t?t(y,R,M,T++):R),()=>{r=null,m()}))},()=>{d=!0,m()}))})}function Qr(n){return n<=0?()=>so:Cn((t,e)=>{let i=0;t.subscribe(bt(e,r=>{++i<=n&&(e.next(r),n<=i&&e.complete())}))})}function Hs(...n){const t=ro(n);return Cn((e,i)=>{(t?ov(n,e,t):ov(n,e)).subscribe(i)})}function xw(n){return Cn((t,e)=>{let i=!1;t.subscribe(bt(e,r=>{i=!0,e.next(r)},()=>{i||e.next(n),e.complete()}))})}function SO(n=wH){return Cn((t,e)=>{let i=!1;t.subscribe(bt(e,r=>{i=!0,e.next(r)},()=>i?e.complete():e.error(n())))})}function wH(){return new vw}function kp(n,t){const e=arguments.length>=2;return i=>i.pipe(n?Rr((r,s)=>n(r,s,i)):Je,Qr(1),e?xw(t):SO(()=>new vw))}function Jo(n,t,e){const i=ze(n)||t||e?{next:n,error:t,complete:e}:n;return i?Cn((r,s)=>{var d;null===(d=i.subscribe)||void 0===d||d.call(i);let m=!0;r.subscribe(bt(s,y=>{var T;null===(T=i.next)||void 0===T||T.call(i,y),s.next(y)},()=>{var y;m=!1,null===(y=i.complete)||void 0===y||y.call(i),s.complete()},y=>{var T;m=!1,null===(T=i.error)||void 0===T||T.call(i,y),s.error(y)},()=>{var y,T;m&&(null===(y=i.unsubscribe)||void 0===y||y.call(i)),null===(T=i.finalize)||void 0===T||T.call(i)}))}):Je}function bh(n){return Cn((t,e)=>{let s,i=null,r=!1;i=t.subscribe(bt(e,void 0,void 0,d=>{s=Pt(n(d,bh(n)(t))),i?(i.unsubscribe(),i=null,s.subscribe(e)):r=!0})),r&&(i.unsubscribe(),i=null,s.subscribe(e))})}function SH(n,t,e,i,r){return(s,d)=>{let m=e,y=t,T=0;s.subscribe(bt(d,M=>{const R=T++;y=m?n(y,M,R):(m=!0,M),i&&d.next(y)},r&&(()=>{m&&d.next(y),d.complete()})))}}function CO(n,t){return Cn(SH(n,t,arguments.length>=2,!0))}function mE(n){return n<=0?()=>so:Cn((t,e)=>{let i=[];t.subscribe(bt(e,r=>{i.push(r),n<i.length&&i.shift()},()=>{for(const r of i)e.next(r);e.complete()},void 0,()=>{i=null}))})}function TO(n,t){const e=arguments.length>=2;return i=>i.pipe(n?Rr((r,s)=>n(r,s,i)):Je,mE(1),e?xw(t):SO(()=>new vw))}function EO(n,t=!1){return Cn((e,i)=>{let r=0;e.subscribe(bt(i,s=>{const d=n(s,r++);(d||t)&&i.next(s),!d&&i.complete()}))})}function sv(n){return $t(()=>n)}function ww(n){return Cn((t,e)=>{try{t.subscribe(e)}finally{e.add(n)}})}const lr="primary",av=Symbol("RouteTitle");class CH{constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){const e=this.params[t];return Array.isArray(e)?e[0]:e}return null}getAll(t){if(this.has(t)){const e=this.params[t];return Array.isArray(e)?e:[e]}return[]}get keys(){return Object.keys(this.params)}}function Rb(n){return new CH(n)}function TH(n,t,e){const i=e.path.split("/");if(i.length>n.length||"full"===e.pathMatch&&(t.hasChildren()||i.length<n.length))return null;const r={};for(let s=0;s<i.length;s++){const d=i[s],m=n[s];if(d.startsWith(":"))r[d.substring(1)]=m;else if(d!==m.path)return null}return{consumed:n.slice(0,i.length),posParams:r}}function cd(n,t){const e=n?Object.keys(n):void 0,i=t?Object.keys(t):void 0;if(!e||!i||e.length!=i.length)return!1;let r;for(let s=0;s<e.length;s++)if(r=e[s],!DO(n[r],t[r]))return!1;return!0}function DO(n,t){if(Array.isArray(n)&&Array.isArray(t)){if(n.length!==t.length)return!1;const e=[...n].sort(),i=[...t].sort();return e.every((r,s)=>i[s]===r)}return n===t}function IO(n){return Array.prototype.concat.apply([],n)}function MO(n){return n.length>0?n[n.length-1]:null}function va(n,t){for(const e in n)n.hasOwnProperty(e)&&t(n[e],e)}function Rp(n){return aC(n)?n:Iy(n)?mo(Promise.resolve(n)):qn(n)}const IH={exact:function RO(n,t,e){if(!mm(n.segments,t.segments)||!Sw(n.segments,t.segments,e)||n.numberOfChildren!==t.numberOfChildren)return!1;for(const i in t.children)if(!n.children[i]||!RO(n.children[i],t.children[i],e))return!1;return!0},subset:PO},AO={exact:function MH(n,t){return cd(n,t)},subset:function AH(n,t){return Object.keys(t).length<=Object.keys(n).length&&Object.keys(t).every(e=>DO(n[e],t[e]))},ignored:()=>!0};function kO(n,t,e){return IH[e.paths](n.root,t.root,e.matrixParams)&&AO[e.queryParams](n.queryParams,t.queryParams)&&!("exact"===e.fragment&&n.fragment!==t.fragment)}function PO(n,t,e){return OO(n,t,t.segments,e)}function OO(n,t,e,i){if(n.segments.length>e.length){const r=n.segments.slice(0,e.length);return!(!mm(r,e)||t.hasChildren()||!Sw(r,e,i))}if(n.segments.length===e.length){if(!mm(n.segments,e)||!Sw(n.segments,e,i))return!1;for(const r in t.children)if(!n.children[r]||!PO(n.children[r],t.children[r],i))return!1;return!0}{const r=e.slice(0,n.segments.length),s=e.slice(n.segments.length);return!!(mm(n.segments,r)&&Sw(n.segments,r,i)&&n.children[lr])&&OO(n.children[lr],t,s,i)}}function Sw(n,t,e){return t.every((i,r)=>AO[e](n[r].parameters,i.parameters))}class fm{constructor(t,e,i){this.root=t,this.queryParams=e,this.fragment=i}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Rb(this.queryParams)),this._queryParamMap}toString(){return PH.serialize(this)}}class hr{constructor(t,e){this.segments=t,this.children=e,this.parent=null,va(e,(i,r)=>i.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Cw(this)}}class lv{constructor(t,e){this.path=t,this.parameters=e}get parameterMap(){return this._parameterMap||(this._parameterMap=Rb(this.parameters)),this._parameterMap}toString(){return BO(this)}}function mm(n,t){return n.length===t.length&&n.every((e,i)=>e.path===t[i].path)}let LO=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=tn({token:n,factory:function(){return new bE},providedIn:"root"}),n})();class bE{parse(t){const e=new UH(t);return new fm(e.parseRootSegment(),e.parseQueryParams(),e.parseFragment())}serialize(t){const e=`/${cv(t.root,!0)}`,i=function FH(n){const t=Object.keys(n).map(e=>{const i=n[e];return Array.isArray(i)?i.map(r=>`${Tw(e)}=${Tw(r)}`).join("&"):`${Tw(e)}=${Tw(i)}`}).filter(e=>!!e);return t.length?`?${t.join("&")}`:""}(t.queryParams);return`${e}${i}${"string"==typeof t.fragment?`#${function OH(n){return encodeURI(n)}(t.fragment)}`:""}`}}const PH=new bE;function Cw(n){return n.segments.map(t=>BO(t)).join("/")}function cv(n,t){if(!n.hasChildren())return Cw(n);if(t){const e=n.children[lr]?cv(n.children[lr],!1):"",i=[];return va(n.children,(r,s)=>{s!==lr&&i.push(`${s}:${cv(r,!1)}`)}),i.length>0?`${e}(${i.join("//")})`:e}{const e=function RH(n,t){let e=[];return va(n.children,(i,r)=>{r===lr&&(e=e.concat(t(i,r)))}),va(n.children,(i,r)=>{r!==lr&&(e=e.concat(t(i,r)))}),e}(n,(i,r)=>r===lr?[cv(n.children[lr],!1)]:[`${r}:${cv(i,!1)}`]);return 1===Object.keys(n.children).length&&null!=n.children[lr]?`${Cw(n)}/${e[0]}`:`${Cw(n)}/(${e.join("//")})`}}function FO(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Tw(n){return FO(n).replace(/%3B/gi,";")}function _E(n){return FO(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Ew(n){return decodeURIComponent(n)}function NO(n){return Ew(n.replace(/\+/g,"%20"))}function BO(n){return`${_E(n.path)}${function LH(n){return Object.keys(n).map(t=>`;${_E(t)}=${_E(n[t])}`).join("")}(n.parameters)}`}const NH=/^[^\/()?;=#]+/;function Dw(n){const t=n.match(NH);return t?t[0]:""}const BH=/^[^=?&#]+/,VH=/^[^&#]+/;class UH{constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new hr([],{}):new hr([],this.parseChildren())}parseQueryParams(){const t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let e={};this.peekStartsWith("/(")&&(this.capture("/"),e=this.parseParens(!0));let i={};return this.peekStartsWith("(")&&(i=this.parseParens(!1)),(t.length>0||Object.keys(e).length>0)&&(i[lr]=new hr(t,e)),i}parseSegment(){const t=Dw(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new Nt(4009,!1);return this.capture(t),new lv(Ew(t),this.parseMatrixParams())}parseMatrixParams(){const t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){const e=Dw(this.remaining);if(!e)return;this.capture(e);let i="";if(this.consumeOptional("=")){const r=Dw(this.remaining);r&&(i=r,this.capture(i))}t[Ew(e)]=Ew(i)}parseQueryParam(t){const e=function zH(n){const t=n.match(BH);return t?t[0]:""}(this.remaining);if(!e)return;this.capture(e);let i="";if(this.consumeOptional("=")){const d=function jH(n){const t=n.match(VH);return t?t[0]:""}(this.remaining);d&&(i=d,this.capture(i))}const r=NO(e),s=NO(i);if(t.hasOwnProperty(r)){let d=t[r];Array.isArray(d)||(d=[d],t[r]=d),d.push(s)}else t[r]=s}parseParens(t){const e={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const i=Dw(this.remaining),r=this.remaining[i.length];if("/"!==r&&")"!==r&&";"!==r)throw new Nt(4010,!1);let s;i.indexOf(":")>-1?(s=i.slice(0,i.indexOf(":")),this.capture(s),this.capture(":")):t&&(s=lr);const d=this.parseChildren();e[s]=1===Object.keys(d).length?d[lr]:new hr([],d),this.consumeOptional("//")}return e}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)}capture(t){if(!this.consumeOptional(t))throw new Nt(4011,!1)}}function yE(n){return n.segments.length>0?new hr([],{[lr]:n}):n}function Iw(n){const t={};for(const i of Object.keys(n.children)){const s=Iw(n.children[i]);(s.segments.length>0||s.hasChildren())&&(t[i]=s)}return function HH(n){if(1===n.numberOfChildren&&n.children[lr]){const t=n.children[lr];return new hr(n.segments.concat(t.segments),t.children)}return n}(new hr(n.segments,t))}function gm(n){return n instanceof fm}function GH(n,t,e,i,r){var s;if(0===e.length)return Pb(t.root,t.root,t.root,i,r);const m=function jO(n){if("string"==typeof n[0]&&1===n.length&&"/"===n[0])return new VO(!0,0,n);let t=0,e=!1;const i=n.reduce((r,s,d)=>{if("object"==typeof s&&null!=s){if(s.outlets){const m={};return va(s.outlets,(y,T)=>{m[T]="string"==typeof y?y.split("/"):y}),[...r,{outlets:m}]}if(s.segmentPath)return[...r,s.segmentPath]}return"string"!=typeof s?[...r,s]:0===d?(s.split("/").forEach((m,y)=>{0==y&&"."===m||(0==y&&""===m?e=!0:".."===m?t++:""!=m&&r.push(m))}),r):[...r,s]},[]);return new VO(e,t,i)}(e);return m.toRoot()?Pb(t.root,t.root,new hr([],{}),i,r):function y(M){var R;const H=function XH(n,t,e,i){if(n.isAbsolute)return new Ob(t.root,!0,0);if(-1===i)return new Ob(e,e===t.root,0);return function UO(n,t,e){let i=n,r=t,s=e;for(;s>r;){if(s-=r,i=i.parent,!i)throw new Nt(4005,!1);r=i.segments.length}return new Ob(i,!1,r-s)}(e,i+(uv(n.commands[0])?0:1),n.numberOfDoubleDots)}(m,t,null===(R=n.snapshot)||void 0===R?void 0:R._urlSegment,M),Z=H.processChildren?hv(H.segmentGroup,H.index,m.commands):xE(H.segmentGroup,H.index,m.commands);return Pb(t.root,H.segmentGroup,Z,i,r)}(null===(s=n.snapshot)||void 0===s?void 0:s._lastPathIndex)}function uv(n){return"object"==typeof n&&null!=n&&!n.outlets&&!n.segmentPath}function dv(n){return"object"==typeof n&&null!=n&&n.outlets}function Pb(n,t,e,i,r){let d,s={};i&&va(i,(y,T)=>{s[T]=Array.isArray(y)?y.map(M=>`${M}`):`${y}`}),d=n===t?e:zO(n,t,e);const m=yE(Iw(d));return new fm(m,s,r)}function zO(n,t,e){const i={};return va(n.children,(r,s)=>{i[s]=r===t?e:zO(r,t,e)}),new hr(n.segments,i)}class VO{constructor(t,e,i){if(this.isAbsolute=t,this.numberOfDoubleDots=e,this.commands=i,t&&i.length>0&&uv(i[0]))throw new Nt(4003,!1);const r=i.find(dv);if(r&&r!==MO(i))throw new Nt(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Ob{constructor(t,e,i){this.segmentGroup=t,this.processChildren=e,this.index=i}}function xE(n,t,e){if(n||(n=new hr([],{})),0===n.segments.length&&n.hasChildren())return hv(n,t,e);const i=function YH(n,t,e){let i=0,r=t;const s={match:!1,pathIndex:0,commandIndex:0};for(;r<n.segments.length;){if(i>=e.length)return s;const d=n.segments[r],m=e[i];if(dv(m))break;const y=`${m}`,T=i<e.length-1?e[i+1]:null;if(r>0&&void 0===y)break;if(y&&T&&"object"==typeof T&&void 0===T.outlets){if(!$O(y,T,d))return s;i+=2}else{if(!$O(y,{},d))return s;i++}r++}return{match:!0,pathIndex:r,commandIndex:i}}(n,t,e),r=e.slice(i.commandIndex);if(i.match&&i.pathIndex<n.segments.length){const s=new hr(n.segments.slice(0,i.pathIndex),{});return s.children[lr]=new hr(n.segments.slice(i.pathIndex),n.children),hv(s,0,r)}return i.match&&0===r.length?new hr(n.segments,{}):i.match&&!n.hasChildren()?wE(n,t,e):i.match?hv(n,0,r):wE(n,t,e)}function hv(n,t,e){if(0===e.length)return new hr(n.segments,{});{const i=function ZH(n){return dv(n[0])?n[0].outlets:{[lr]:n}}(e),r={};return va(i,(s,d)=>{"string"==typeof s&&(s=[s]),null!==s&&(r[d]=xE(n.children[d],t,s))}),va(n.children,(s,d)=>{void 0===i[d]&&(r[d]=s)}),new hr(n.segments,r)}}function wE(n,t,e){const i=n.segments.slice(0,t);let r=0;for(;r<e.length;){const s=e[r];if(dv(s)){const y=KH(s.outlets);return new hr(i,y)}if(0===r&&uv(e[0])){i.push(new lv(n.segments[t].path,HO(e[0]))),r++;continue}const d=dv(s)?s.outlets[lr]:`${s}`,m=r<e.length-1?e[r+1]:null;d&&m&&uv(m)?(i.push(new lv(d,HO(m))),r+=2):(i.push(new lv(d,{})),r++)}return new hr(i,{})}function KH(n){const t={};return va(n,(e,i)=>{"string"==typeof e&&(e=[e]),null!==e&&(t[i]=wE(new hr([],{}),0,e))}),t}function HO(n){const t={};return va(n,(e,i)=>t[i]=`${e}`),t}function $O(n,t,e){return n==e.path&&cd(t,e.parameters)}class _h{constructor(t,e){this.id=t,this.url=e}}class SE extends _h{constructor(t,e,i="imperative",r=null){super(t,e),this.type=0,this.navigationTrigger=i,this.restoredState=r}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class bm extends _h{constructor(t,e,i){super(t,e),this.urlAfterRedirects=i,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class Mw extends _h{constructor(t,e,i,r){super(t,e),this.reason=i,this.code=r,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class qO extends _h{constructor(t,e,i,r){super(t,e),this.error=i,this.target=r,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class QH extends _h{constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class JH extends _h{constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class e8 extends _h{constructor(t,e,i,r,s){super(t,e),this.urlAfterRedirects=i,this.state=r,this.shouldActivate=s,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class t8 extends _h{constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class n8 extends _h{constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class i8{constructor(t){this.route=t,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class r8{constructor(t){this.route=t,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class o8{constructor(t){this.snapshot=t,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class s8{constructor(t){this.snapshot=t,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class a8{constructor(t){this.snapshot=t,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class l8{constructor(t){this.snapshot=t,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class GO{constructor(t,e,i){this.routerEvent=t,this.position=e,this.anchor=i,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class WO{constructor(t){this._root=t}get root(){return this._root.value}parent(t){const e=this.pathFromRoot(t);return e.length>1?e[e.length-2]:null}children(t){const e=CE(t,this._root);return e?e.children.map(i=>i.value):[]}firstChild(t){const e=CE(t,this._root);return e&&e.children.length>0?e.children[0].value:null}siblings(t){const e=TE(t,this._root);return e.length<2?[]:e[e.length-2].children.map(r=>r.value).filter(r=>r!==t)}pathFromRoot(t){return TE(t,this._root).map(e=>e.value)}}function CE(n,t){if(n===t.value)return t;for(const e of t.children){const i=CE(n,e);if(i)return i}return null}function TE(n,t){if(n===t.value)return[t];for(const e of t.children){const i=TE(n,e);if(i.length)return i.unshift(t),i}return[]}class yh{constructor(t,e){this.value=t,this.children=e}toString(){return`TreeNode(${this.value})`}}function Lb(n){const t={};return n&&n.children.forEach(e=>t[e.value.outlet]=e),t}class XO extends WO{constructor(t,e){super(t),this.snapshot=e,EE(this,t)}toString(){return this.snapshot.toString()}}function ZO(n,t){const e=function u8(n,t){const d=new Aw([],{},{},"",{},lr,t,null,n.root,-1,{});return new KO("",new yh(d,[]))}(n,t),i=new _a([new lv("",{})]),r=new _a({}),s=new _a({}),d=new _a({}),m=new _a(""),y=new _m(i,r,d,m,s,lr,t,e.root);return y.snapshot=e.root,new XO(new yh(y,[]),e)}class _m{constructor(t,e,i,r,s,d,m,y){var T,M;this.url=t,this.params=e,this.queryParams=i,this.fragment=r,this.data=s,this.outlet=d,this.component=m,this.title=null!==(M=null===(T=this.data)||void 0===T?void 0:T.pipe($t(R=>R[av])))&&void 0!==M?M:qn(void 0),this._futureSnapshot=y}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe($t(t=>Rb(t)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe($t(t=>Rb(t)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function YO(n,t="emptyOnly"){const e=n.pathFromRoot;let i=0;if("always"!==t)for(i=e.length-1;i>=1;){const r=e[i],s=e[i-1];if(r.routeConfig&&""===r.routeConfig.path)i--;else{if(s.component)break;i--}}return function d8(n){return n.reduce((t,e)=>{var i;return{params:Object.assign(Object.assign({},t.params),e.params),data:Object.assign(Object.assign({},t.data),e.data),resolve:Object.assign(Object.assign(Object.assign(Object.assign({},e.data),t.resolve),null===(i=e.routeConfig)||void 0===i?void 0:i.data),e._resolvedData)}},{params:{},data:{},resolve:{}})}(e.slice(i))}class Aw{constructor(t,e,i,r,s,d,m,y,T,M,R,H){var Z;this.url=t,this.params=e,this.queryParams=i,this.fragment=r,this.data=s,this.outlet=d,this.component=m,this.title=null===(Z=this.data)||void 0===Z?void 0:Z[av],this.routeConfig=y,this._urlSegment=T,this._lastPathIndex=M,this._correctedLastPathIndex=null!=H?H:M,this._resolve=R}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Rb(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Rb(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(i=>i.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class KO extends WO{constructor(t,e){super(e),this.url=t,EE(this,e)}toString(){return QO(this._root)}}function EE(n,t){t.value._routerState=n,t.children.forEach(e=>EE(n,e))}function QO(n){const t=n.children.length>0?` { ${n.children.map(QO).join(", ")} } `:"";return`${n.value}${t}`}function DE(n){if(n.snapshot){const t=n.snapshot,e=n._futureSnapshot;n.snapshot=e,cd(t.queryParams,e.queryParams)||n.queryParams.next(e.queryParams),t.fragment!==e.fragment&&n.fragment.next(e.fragment),cd(t.params,e.params)||n.params.next(e.params),function EH(n,t){if(n.length!==t.length)return!1;for(let e=0;e<n.length;++e)if(!cd(n[e],t[e]))return!1;return!0}(t.url,e.url)||n.url.next(e.url),cd(t.data,e.data)||n.data.next(e.data)}else n.snapshot=n._futureSnapshot,n.data.next(n._futureSnapshot.data)}function IE(n,t){const e=cd(n.params,t.params)&&function kH(n,t){return mm(n,t)&&n.every((e,i)=>cd(e.parameters,t[i].parameters))}(n.url,t.url);return e&&!(!n.parent!=!t.parent)&&(!n.parent||IE(n.parent,t.parent))}function pv(n,t,e){if(e&&n.shouldReuseRoute(t.value,e.value.snapshot)){const i=e.value;i._futureSnapshot=t.value;const r=function p8(n,t,e){return t.children.map(i=>{for(const r of e.children)if(n.shouldReuseRoute(i.value,r.value.snapshot))return pv(n,i,r);return pv(n,i)})}(n,t,e);return new yh(i,r)}{if(n.shouldAttach(t.value)){const s=n.retrieve(t.value);if(null!==s){const d=s.route;return d.value._futureSnapshot=t.value,d.children=t.children.map(m=>pv(n,m)),d}}const i=function f8(n){return new _m(new _a(n.url),new _a(n.params),new _a(n.queryParams),new _a(n.fragment),new _a(n.data),n.outlet,n.component,n)}(t.value),r=t.children.map(s=>pv(n,s));return new yh(i,r)}}const ME="ngNavigationCancelingError";function JO(n,t){const{redirectTo:e,navigationBehaviorOptions:i}=gm(t)?{redirectTo:t,navigationBehaviorOptions:void 0}:t,r=eL(!1,0,t);return r.url=e,r.navigationBehaviorOptions=i,r}function eL(n,t,e){const i=new Error("NavigationCancelingError: "+(n||""));return i[ME]=!0,i.cancellationCode=t,e&&(i.url=e),i}function tL(n){return nL(n)&&gm(n.url)}function nL(n){return n&&n[ME]}class m8{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.injector=null,this.children=new fv,this.attachRef=null}}let fv=(()=>{class n{constructor(){this.contexts=new Map}onChildOutletCreated(e,i){const r=this.getOrCreateContext(e);r.outlet=i,this.contexts.set(e,r)}onChildOutletDestroyed(e){const i=this.getContext(e);i&&(i.outlet=null,i.attachRef=null)}onOutletDeactivated(){const e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let i=this.getContext(e);return i||(i=new m8,this.contexts.set(e,i)),i}getContext(e){return this.contexts.get(e)||null}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=tn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const kw=!1;let AE=(()=>{class n{constructor(e,i,r,s,d){this.parentContexts=e,this.location=i,this.changeDetector=s,this.environmentInjector=d,this.activated=null,this._activatedRoute=null,this.activateEvents=new on,this.deactivateEvents=new on,this.attachEvents=new on,this.detachEvents=new on,this.name=r||lr,e.onChildOutletCreated(this.name,this)}ngOnDestroy(){var e;(null===(e=this.parentContexts.getContext(this.name))||void 0===e?void 0:e.outlet)===this&&this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const e=this.parentContexts.getContext(this.name);e&&e.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.injector))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Nt(4012,kw);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Nt(4012,kw);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Nt(4012,kw);this.location.detach();const e=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(e.instance),e}attach(e,i){this.activated=e,this._activatedRoute=i,this.location.insert(e.hostView),this.attachEvents.emit(e.instance)}deactivate(){if(this.activated){const e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}activateWith(e,i){if(this.isActivated)throw new Nt(4013,kw);this._activatedRoute=e;const r=this.location,d=e._futureSnapshot.component,m=this.parentContexts.getOrCreateContext(this.name).children,y=new g8(e,m,r.injector);if(i&&function b8(n){return!!n.resolveComponentFactory}(i)){const T=i.resolveComponentFactory(d);this.activated=r.createComponent(T,r.length,y)}else this.activated=r.createComponent(d,{index:r.length,injector:y,environmentInjector:null!=i?i:this.environmentInjector});this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return n.\u0275fac=function(e){return new(e||n)(X(fv),X(Qo),os("name"),X(kr),X(tu))},n.\u0275dir=Ft({type:n,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0}),n})();class g8{constructor(t,e,i){this.route=t,this.childContexts=e,this.parent=i}get(t,e){return t===_m?this.route:t===fv?this.childContexts:this.parent.get(t,e)}}let kE=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=On({type:n,selectors:[["ng-component"]],standalone:!0,features:[rA],decls:1,vars:0,template:function(e,i){1&e&&bn(0,"router-outlet")},dependencies:[AE],encapsulation:2}),n})();function iL(n,t){var e;return n.providers&&!n._injector&&(n._injector=mx(n.providers,t,`Route: ${n.path}`)),null!==(e=n._injector)&&void 0!==e?e:t}function PE(n){const t=n.children&&n.children.map(PE),e=t?Object.assign(Object.assign({},n),{children:t}):Object.assign({},n);return!e.component&&!e.loadComponent&&(t||e.loadChildren)&&e.outlet&&e.outlet!==lr&&(e.component=kE),e}function Lc(n){return n.outlet||lr}function rL(n,t){const e=n.filter(i=>Lc(i)===t);return e.push(...n.filter(i=>Lc(i)!==t)),e}function mv(n){var t;if(!n)return null;if(null!==(t=n.routeConfig)&&void 0!==t&&t._injector)return n.routeConfig._injector;for(let e=n.parent;e;e=e.parent){const i=e.routeConfig;if(null!=i&&i._loadedInjector)return i._loadedInjector;if(null!=i&&i._injector)return i._injector}return null}class w8{constructor(t,e,i,r){this.routeReuseStrategy=t,this.futureState=e,this.currState=i,this.forwardEvent=r}activate(t){const e=this.futureState._root,i=this.currState?this.currState._root:null;this.deactivateChildRoutes(e,i,t),DE(this.futureState.root),this.activateChildRoutes(e,i,t)}deactivateChildRoutes(t,e,i){const r=Lb(e);t.children.forEach(s=>{const d=s.value.outlet;this.deactivateRoutes(s,r[d],i),delete r[d]}),va(r,(s,d)=>{this.deactivateRouteAndItsChildren(s,i)})}deactivateRoutes(t,e,i){const r=t.value,s=e?e.value:null;if(r===s)if(r.component){const d=i.getContext(r.outlet);d&&this.deactivateChildRoutes(t,e,d.children)}else this.deactivateChildRoutes(t,e,i);else s&&this.deactivateRouteAndItsChildren(e,i)}deactivateRouteAndItsChildren(t,e){t.value.component&&this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,e):this.deactivateRouteAndOutlet(t,e)}detachAndStoreRouteSubtree(t,e){const i=e.getContext(t.value.outlet),r=i&&t.value.component?i.children:e,s=Lb(t);for(const d of Object.keys(s))this.deactivateRouteAndItsChildren(s[d],r);if(i&&i.outlet){const d=i.outlet.detach(),m=i.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:d,route:t,contexts:m})}}deactivateRouteAndOutlet(t,e){const i=e.getContext(t.value.outlet),r=i&&t.value.component?i.children:e,s=Lb(t);for(const d of Object.keys(s))this.deactivateRouteAndItsChildren(s[d],r);i&&i.outlet&&(i.outlet.deactivate(),i.children.onOutletDeactivated(),i.attachRef=null,i.resolver=null,i.route=null)}activateChildRoutes(t,e,i){const r=Lb(e);t.children.forEach(s=>{this.activateRoutes(s,r[s.value.outlet],i),this.forwardEvent(new l8(s.value.snapshot))}),t.children.length&&this.forwardEvent(new s8(t.value.snapshot))}activateRoutes(t,e,i){var r;const s=t.value,d=e?e.value:null;if(DE(s),s===d)if(s.component){const m=i.getOrCreateContext(s.outlet);this.activateChildRoutes(t,e,m.children)}else this.activateChildRoutes(t,e,i);else if(s.component){const m=i.getOrCreateContext(s.outlet);if(this.routeReuseStrategy.shouldAttach(s.snapshot)){const y=this.routeReuseStrategy.retrieve(s.snapshot);this.routeReuseStrategy.store(s.snapshot,null),m.children.onOutletReAttached(y.contexts),m.attachRef=y.componentRef,m.route=y.route.value,m.outlet&&m.outlet.attach(y.componentRef,y.route.value),DE(y.route.value),this.activateChildRoutes(t,null,m.children)}else{const y=mv(s.snapshot),T=null!==(r=null==y?void 0:y.get(Kd))&&void 0!==r?r:null;m.attachRef=null,m.route=s,m.resolver=T,m.injector=y,m.outlet&&m.outlet.activateWith(s,m.injector),this.activateChildRoutes(t,null,m.children)}}else this.activateChildRoutes(t,null,i)}}class oL{constructor(t){this.path=t,this.route=this.path[this.path.length-1]}}class Rw{constructor(t,e){this.component=t,this.route=e}}function S8(n,t,e){const i=n._root;return gv(i,t?t._root:null,e,[i.value])}function Fb(n,t){const e=Symbol(),i=t.get(n,e);return i===e?"function"!=typeof n||function vu(n){return null!==yu(n)}(n)?t.get(n):n:i}function gv(n,t,e,i,r={canDeactivateChecks:[],canActivateChecks:[]}){const s=Lb(t);return n.children.forEach(d=>{(function T8(n,t,e,i,r={canDeactivateChecks:[],canActivateChecks:[]}){const s=n.value,d=t?t.value:null,m=e?e.getContext(n.value.outlet):null;if(d&&s.routeConfig===d.routeConfig){const y=function E8(n,t,e){if("function"==typeof e)return e(n,t);switch(e){case"pathParamsChange":return!mm(n.url,t.url);case"pathParamsOrQueryParamsChange":return!mm(n.url,t.url)||!cd(n.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!IE(n,t)||!cd(n.queryParams,t.queryParams);default:return!IE(n,t)}}(d,s,s.routeConfig.runGuardsAndResolvers);y?r.canActivateChecks.push(new oL(i)):(s.data=d.data,s._resolvedData=d._resolvedData),gv(n,t,s.component?m?m.children:null:e,i,r),y&&m&&m.outlet&&m.outlet.isActivated&&r.canDeactivateChecks.push(new Rw(m.outlet.component,d))}else d&&bv(t,m,r),r.canActivateChecks.push(new oL(i)),gv(n,null,s.component?m?m.children:null:e,i,r)})(d,s[d.value.outlet],e,i.concat([d.value]),r),delete s[d.value.outlet]}),va(s,(d,m)=>bv(d,e.getContext(m),r)),r}function bv(n,t,e){const i=Lb(n),r=n.value;va(i,(s,d)=>{bv(s,r.component?t?t.children.getContext(d):null:t,e)}),e.canDeactivateChecks.push(new Rw(r.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,r))}function _v(n){return"function"==typeof n}function OE(n){return n instanceof vw||"EmptyError"===(null==n?void 0:n.name)}const Pw=Symbol("INITIAL_VALUE");function Nb(){return ya(n=>hm(n.map(t=>t.pipe(Qr(1),Hs(Pw)))).pipe($t(t=>{for(const e of t)if(!0!==e){if(e===Pw)return Pw;if(!1===e||e instanceof fm)return e}return!0}),Rr(t=>t!==Pw),Qr(1)))}function sL(n){return function lt(...n){return cn(n)}(Jo(t=>{if(gm(t))throw JO(0,t)}),$t(t=>!0===t))}const LE={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function aL(n,t,e,i,r){const s=FE(n,t,e);return s.matched?function H8(n,t,e,i){const r=t.canMatch;return r&&0!==r.length?qn(r.map(d=>{const m=Fb(d,n);return Rp(function R8(n){return n&&_v(n.canMatch)}(m)?m.canMatch(t,e):n.runInContext(()=>m(t,e)))})).pipe(Nb(),sL()):qn(!0)}(i=iL(t,i),t,e).pipe($t(d=>!0===d?s:Object.assign({},LE))):qn(s)}function FE(n,t,e){var i;if(""===t.path)return"full"===t.pathMatch&&(n.hasChildren()||e.length>0)?Object.assign({},LE):{matched:!0,consumedSegments:[],remainingSegments:e,parameters:{},positionalParamSegments:{}};const s=(t.matcher||TH)(e,n,t);if(!s)return Object.assign({},LE);const d={};va(s.posParams,(y,T)=>{d[T]=y.path});const m=s.consumed.length>0?Object.assign(Object.assign({},d),s.consumed[s.consumed.length-1].parameters):d;return{matched:!0,consumedSegments:s.consumed,remainingSegments:e.slice(s.consumed.length),parameters:m,positionalParamSegments:null!==(i=s.posParams)&&void 0!==i?i:{}}}function Ow(n,t,e,i,r="corrected"){if(e.length>0&&function G8(n,t,e){return e.some(i=>Lw(n,t,i)&&Lc(i)!==lr)}(n,e,i)){const d=new hr(t,function q8(n,t,e,i){const r={};r[lr]=i,i._sourceSegment=n,i._segmentIndexShift=t.length;for(const s of e)if(""===s.path&&Lc(s)!==lr){const d=new hr([],{});d._sourceSegment=n,d._segmentIndexShift=t.length,r[Lc(s)]=d}return r}(n,t,i,new hr(e,n.children)));return d._sourceSegment=n,d._segmentIndexShift=t.length,{segmentGroup:d,slicedSegments:[]}}if(0===e.length&&function W8(n,t,e){return e.some(i=>Lw(n,t,i))}(n,e,i)){const d=new hr(n.segments,function $8(n,t,e,i,r,s){const d={};for(const m of i)if(Lw(n,e,m)&&!r[Lc(m)]){const y=new hr([],{});y._sourceSegment=n,y._segmentIndexShift="legacy"===s?n.segments.length:t.length,d[Lc(m)]=y}return Object.assign(Object.assign({},r),d)}(n,t,e,i,n.children,r));return d._sourceSegment=n,d._segmentIndexShift=t.length,{segmentGroup:d,slicedSegments:e}}const s=new hr(n.segments,n.children);return s._sourceSegment=n,s._segmentIndexShift=t.length,{segmentGroup:s,slicedSegments:e}}function Lw(n,t,e){return(!(n.hasChildren()||t.length>0)||"full"!==e.pathMatch)&&""===e.path}function lL(n,t,e,i){return!!(Lc(n)===i||i!==lr&&Lw(t,e,n))&&("**"===n.path||FE(t,n,e).matched)}function cL(n,t,e){return 0===t.length&&!n.children[e]}const Fw=!1;class Nw{constructor(t){this.segmentGroup=t||null}}class uL{constructor(t){this.urlTree=t}}function yv(n){return kb(new Nw(n))}function dL(n){return kb(new uL(n))}class K8{constructor(t,e,i,r,s){this.injector=t,this.configLoader=e,this.urlSerializer=i,this.urlTree=r,this.config=s,this.allowRedirects=!0}apply(){const t=Ow(this.urlTree.root,[],[],this.config).segmentGroup,e=new hr(t.segments,t.children);return this.expandSegmentGroup(this.injector,this.config,e,lr).pipe($t(s=>this.createUrlTree(Iw(s),this.urlTree.queryParams,this.urlTree.fragment))).pipe(bh(s=>{if(s instanceof uL)return this.allowRedirects=!1,this.match(s.urlTree);throw s instanceof Nw?this.noMatchError(s):s}))}match(t){return this.expandSegmentGroup(this.injector,this.config,t.root,lr).pipe($t(r=>this.createUrlTree(Iw(r),t.queryParams,t.fragment))).pipe(bh(r=>{throw r instanceof Nw?this.noMatchError(r):r}))}noMatchError(t){return new Nt(4002,Fw)}createUrlTree(t,e,i){const r=yE(t);return new fm(r,e,i)}expandSegmentGroup(t,e,i,r){return 0===i.segments.length&&i.hasChildren()?this.expandChildren(t,e,i).pipe($t(s=>new hr([],s))):this.expandSegment(t,i,e,i.segments,r,!0)}expandChildren(t,e,i){const r=[];for(const s of Object.keys(i.children))"primary"===s?r.unshift(s):r.push(s);return mo(r).pipe(Ep(s=>{const d=i.children[s],m=rL(e,s);return this.expandSegmentGroup(t,m,d,s).pipe($t(y=>({segment:y,outlet:s})))}),CO((s,d)=>(s[d.outlet]=d.segment,s),{}),TO())}expandSegment(t,e,i,r,s,d){return mo(i).pipe(Ep(m=>this.expandSegmentAgainstRoute(t,e,i,m,r,s,d).pipe(bh(T=>{if(T instanceof Nw)return qn(null);throw T}))),kp(m=>!!m),bh((m,y)=>{if(OE(m))return cL(e,r,s)?qn(new hr([],{})):yv(e);throw m}))}expandSegmentAgainstRoute(t,e,i,r,s,d,m){return lL(r,e,s,d)?void 0===r.redirectTo?this.matchSegmentAgainstRoute(t,e,r,s,d):m&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(t,e,i,r,s,d):yv(e):yv(e)}expandSegmentAgainstRouteUsingRedirect(t,e,i,r,s,d){return"**"===r.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(t,i,r,d):this.expandRegularSegmentAgainstRouteUsingRedirect(t,e,i,r,s,d)}expandWildCardWithParamsAgainstRouteUsingRedirect(t,e,i,r){const s=this.applyRedirectCommands([],i.redirectTo,{});return i.redirectTo.startsWith("/")?dL(s):this.lineralizeSegments(i,s).pipe(Gn(d=>{const m=new hr(d,{});return this.expandSegment(t,m,e,d,r,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(t,e,i,r,s,d){const{matched:m,consumedSegments:y,remainingSegments:T,positionalParamSegments:M}=FE(e,r,s);if(!m)return yv(e);const R=this.applyRedirectCommands(y,r.redirectTo,M);return r.redirectTo.startsWith("/")?dL(R):this.lineralizeSegments(r,R).pipe(Gn(H=>this.expandSegment(t,e,i,H.concat(T),d,!1)))}matchSegmentAgainstRoute(t,e,i,r,s){return"**"===i.path?(t=iL(i,t),i.loadChildren?(i._loadedRoutes?qn({routes:i._loadedRoutes,injector:i._loadedInjector}):this.configLoader.loadChildren(t,i)).pipe($t(m=>(i._loadedRoutes=m.routes,i._loadedInjector=m.injector,new hr(r,{})))):qn(new hr(r,{}))):aL(e,i,r,t).pipe(ya(({matched:d,consumedSegments:m,remainingSegments:y})=>{var T;return d?(t=null!==(T=i._injector)&&void 0!==T?T:t,this.getChildConfig(t,i,r).pipe(Gn(R=>{var H;const Z=null!==(H=R.injector)&&void 0!==H?H:t,te=R.routes,{segmentGroup:xe,slicedSegments:Ce}=Ow(e,m,y,te),et=new hr(xe.segments,xe.children);if(0===Ce.length&&et.hasChildren())return this.expandChildren(Z,te,et).pipe($t(Xn=>new hr(m,Xn)));if(0===te.length&&0===Ce.length)return qn(new hr(m,{}));const kt=Lc(i)===s;return this.expandSegment(Z,et,te,Ce,kt?lr:s,!0).pipe($t(en=>new hr(m.concat(en.segments),en.children)))}))):yv(e)}))}getChildConfig(t,e,i){return e.children?qn({routes:e.children,injector:t}):e.loadChildren?void 0!==e._loadedRoutes?qn({routes:e._loadedRoutes,injector:e._loadedInjector}):function U8(n,t,e,i){const r=t.canLoad;return void 0===r||0===r.length?qn(!0):qn(r.map(d=>{const m=Fb(d,n);return Rp(function I8(n){return n&&_v(n.canLoad)}(m)?m.canLoad(t,e):n.runInContext(()=>m(t,e)))})).pipe(Nb(),sL())}(t,e,i).pipe(Gn(r=>r?this.configLoader.loadChildren(t,e).pipe(Jo(s=>{e._loadedRoutes=s.routes,e._loadedInjector=s.injector})):function Z8(n){return kb(eL(Fw,3))}())):qn({routes:[],injector:t})}lineralizeSegments(t,e){let i=[],r=e.root;for(;;){if(i=i.concat(r.segments),0===r.numberOfChildren)return qn(i);if(r.numberOfChildren>1||!r.children[lr])return kb(new Nt(4e3,Fw));r=r.children[lr]}}applyRedirectCommands(t,e,i){return this.applyRedirectCreateUrlTree(e,this.urlSerializer.parse(e),t,i)}applyRedirectCreateUrlTree(t,e,i,r){const s=this.createSegmentGroup(t,e.root,i,r);return new fm(s,this.createQueryParams(e.queryParams,this.urlTree.queryParams),e.fragment)}createQueryParams(t,e){const i={};return va(t,(r,s)=>{if("string"==typeof r&&r.startsWith(":")){const m=r.substring(1);i[s]=e[m]}else i[s]=r}),i}createSegmentGroup(t,e,i,r){const s=this.createSegments(t,e.segments,i,r);let d={};return va(e.children,(m,y)=>{d[y]=this.createSegmentGroup(t,m,i,r)}),new hr(s,d)}createSegments(t,e,i,r){return e.map(s=>s.path.startsWith(":")?this.findPosParam(t,s,r):this.findOrReturn(s,i))}findPosParam(t,e,i){const r=i[e.path.substring(1)];if(!r)throw new Nt(4001,Fw);return r}findOrReturn(t,e){let i=0;for(const r of e){if(r.path===t.path)return e.splice(i),r;i++}return t}}class J8{}class n${constructor(t,e,i,r,s,d,m,y){this.injector=t,this.rootComponentType=e,this.config=i,this.urlTree=r,this.url=s,this.paramsInheritanceStrategy=d,this.relativeLinkResolution=m,this.urlSerializer=y}recognize(){const t=Ow(this.urlTree.root,[],[],this.config.filter(e=>void 0===e.redirectTo),this.relativeLinkResolution).segmentGroup;return this.processSegmentGroup(this.injector,this.config,t,lr).pipe($t(e=>{if(null===e)return null;const i=new Aw([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},lr,this.rootComponentType,null,this.urlTree.root,-1,{}),r=new yh(i,e),s=new KO(this.url,r);return this.inheritParamsAndData(s._root),s}))}inheritParamsAndData(t){const e=t.value,i=YO(e,this.paramsInheritanceStrategy);e.params=Object.freeze(i.params),e.data=Object.freeze(i.data),t.children.forEach(r=>this.inheritParamsAndData(r))}processSegmentGroup(t,e,i,r){return 0===i.segments.length&&i.hasChildren()?this.processChildren(t,e,i):this.processSegment(t,e,i,i.segments,r)}processChildren(t,e,i){return mo(Object.keys(i.children)).pipe(Ep(r=>{const s=i.children[r],d=rL(e,r);return this.processSegmentGroup(t,d,s,r)}),CO((r,s)=>r&&s?(r.push(...s),r):null),EO(r=>null!==r),xw(null),TO(),$t(r=>{if(null===r)return null;const s=hL(r);return function i$(n){n.sort((t,e)=>t.value.outlet===lr?-1:e.value.outlet===lr?1:t.value.outlet.localeCompare(e.value.outlet))}(s),s}))}processSegment(t,e,i,r,s){return mo(e).pipe(Ep(d=>{var m;return this.processSegmentAgainstRoute(null!==(m=d._injector)&&void 0!==m?m:t,d,i,r,s)}),kp(d=>!!d),bh(d=>{if(OE(d))return cL(i,r,s)?qn([]):qn(null);throw d}))}processSegmentAgainstRoute(t,e,i,r,s){var d,m;if(e.redirectTo||!lL(e,i,r,s))return qn(null);let y;if("**"===e.path){const T=r.length>0?MO(r).parameters:{},M=fL(i)+r.length;y=qn({snapshot:new Aw(r,T,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,gL(e),Lc(e),null!==(m=null!==(d=e.component)&&void 0!==d?d:e._loadedComponent)&&void 0!==m?m:null,e,pL(i),M,bL(e),M),consumedSegments:[],remainingSegments:[]})}else y=aL(i,e,r,t).pipe($t(({matched:T,consumedSegments:M,remainingSegments:R,parameters:H})=>{var Z,te;if(!T)return null;const xe=fL(i)+M.length;return{snapshot:new Aw(M,H,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,gL(e),Lc(e),null!==(te=null!==(Z=e.component)&&void 0!==Z?Z:e._loadedComponent)&&void 0!==te?te:null,e,pL(i),xe,bL(e),xe),consumedSegments:M,remainingSegments:R}}));return y.pipe(ya(T=>{var M,R;if(null===T)return qn(null);const{snapshot:H,consumedSegments:Z,remainingSegments:te}=T;t=null!==(M=e._injector)&&void 0!==M?M:t;const xe=null!==(R=e._loadedInjector)&&void 0!==R?R:t,Ce=function r$(n){return n.children?n.children:n.loadChildren?n._loadedRoutes:[]}(e),{segmentGroup:et,slicedSegments:kt}=Ow(i,Z,te,Ce.filter(en=>void 0===en.redirectTo),this.relativeLinkResolution);if(0===kt.length&&et.hasChildren())return this.processChildren(xe,Ce,et).pipe($t(en=>null===en?null:[new yh(H,en)]));if(0===Ce.length&&0===kt.length)return qn([new yh(H,[])]);const pt=Lc(e)===s;return this.processSegment(xe,Ce,et,kt,pt?lr:s).pipe($t(en=>null===en?null:[new yh(H,en)]))}))}}function o$(n){const t=n.value.routeConfig;return t&&""===t.path&&void 0===t.redirectTo}function hL(n){const t=[],e=new Set;for(const i of n){if(!o$(i)){t.push(i);continue}const r=t.find(s=>i.value.routeConfig===s.value.routeConfig);void 0!==r?(r.children.push(...i.children),e.add(r)):t.push(i)}for(const i of e){const r=hL(i.children);t.push(new yh(i.value,r))}return t.filter(i=>!e.has(i))}function pL(n){let t=n;for(;t._sourceSegment;)t=t._sourceSegment;return t}function fL(n){var t,e;let i=n,r=null!==(t=i._segmentIndexShift)&&void 0!==t?t:0;for(;i._sourceSegment;)i=i._sourceSegment,r+=null!==(e=i._segmentIndexShift)&&void 0!==e?e:0;return r-1}function gL(n){return n.data||{}}function bL(n){return n.resolve||{}}function _L(n){return"string"==typeof n.title||null===n.title}function NE(n){return ya(t=>{const e=n(t);return e?mo(e).pipe($t(()=>t)):qn(t)})}let yL=(()=>{class n{buildTitle(e){var i;let r,s=e.root;for(;void 0!==s;)r=null!==(i=this.getResolvedTitleForRoute(s))&&void 0!==i?i:r,s=s.children.find(d=>d.outlet===lr);return r}getResolvedTitleForRoute(e){return e.data[av]}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=tn({token:n,factory:function(){return Wr(vL)},providedIn:"root"}),n})(),vL=(()=>{class n extends yL{constructor(e){super(),this.title=e}updateTitle(e){const i=this.buildTitle(e);void 0!==i&&this.title.setTitle(i)}}return n.\u0275fac=function(e){return new(e||n)(Ue(dR))},n.\u0275prov=tn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class p${}class m$ extends class f${shouldDetach(t){return!1}store(t,e){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,e){return t.routeConfig===e.routeConfig}}{}const zw=new Dt("",{providedIn:"root",factory:()=>({})}),BE=new Dt("ROUTES");let zE=(()=>{class n{constructor(e,i){this.injector=e,this.compiler=i,this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap}loadComponent(e){if(this.componentLoaders.get(e))return this.componentLoaders.get(e);if(e._loadedComponent)return qn(e._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(e);const i=Rp(e.loadComponent()).pipe(Jo(s=>{this.onLoadEndListener&&this.onLoadEndListener(e),e._loadedComponent=s}),ww(()=>{this.componentLoaders.delete(e)})),r=new fE(i,()=>new Wt).pipe(pE());return this.componentLoaders.set(e,r),r}loadChildren(e,i){if(this.childrenLoaders.get(i))return this.childrenLoaders.get(i);if(i._loadedRoutes)return qn({routes:i._loadedRoutes,injector:i._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(i);const s=this.loadModuleFactoryOrRoutes(i.loadChildren).pipe($t(m=>{this.onLoadEndListener&&this.onLoadEndListener(i);let y,T,M=!1;Array.isArray(m)?T=m:(y=m.create(e).injector,T=IO(y.get(BE,[],ri.Self|ri.Optional)));return{routes:T.map(PE),injector:y}}),ww(()=>{this.childrenLoaders.delete(i)})),d=new fE(s,()=>new Wt).pipe(pE());return this.childrenLoaders.set(i,d),d}loadModuleFactoryOrRoutes(e){return Rp(e()).pipe(Gn(i=>i instanceof nA||Array.isArray(i)?qn(i):mo(this.compiler.compileModuleAsync(i))))}}return n.\u0275fac=function(e){return new(e||n)(Ue(Xr),Ue(kC))},n.\u0275prov=tn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class b${}class _${shouldProcessUrl(t){return!0}extract(t){return t}merge(t,e){return t}}function y$(n){throw n}function v$(n,t,e){return t.parse("/")}const x$={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},w$={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};function wL(){var n,t;const e=Wr(LO),i=Wr(fv),r=Wr(Dx),s=Wr(Xr),d=Wr(kC),m=null!==(n=Wr(BE,{optional:!0}))&&void 0!==n?n:[],y=null!==(t=Wr(zw,{optional:!0}))&&void 0!==t?t:{},T=Wr(vL),M=Wr(yL,{optional:!0}),R=Wr(b$,{optional:!0}),H=Wr(p$,{optional:!0}),Z=new Ds(null,e,i,r,s,d,IO(m));return R&&(Z.urlHandlingStrategy=R),H&&(Z.routeReuseStrategy=H),Z.titleStrategy=null!=M?M:T,function S$(n,t){n.errorHandler&&(t.errorHandler=n.errorHandler),n.malformedUriErrorHandler&&(t.malformedUriErrorHandler=n.malformedUriErrorHandler),n.onSameUrlNavigation&&(t.onSameUrlNavigation=n.onSameUrlNavigation),n.paramsInheritanceStrategy&&(t.paramsInheritanceStrategy=n.paramsInheritanceStrategy),n.relativeLinkResolution&&(t.relativeLinkResolution=n.relativeLinkResolution),n.urlUpdateStrategy&&(t.urlUpdateStrategy=n.urlUpdateStrategy),n.canceledNavigationResolution&&(t.canceledNavigationResolution=n.canceledNavigationResolution)}(y,Z),Z}let Ds=(()=>{class n{constructor(e,i,r,s,d,m,y){this.rootComponentType=e,this.urlSerializer=i,this.rootContexts=r,this.location=s,this.config=y,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new Wt,this.errorHandler=y$,this.malformedUriErrorHandler=v$,this.navigated=!1,this.lastSuccessfulId=-1,this.afterPreactivation=()=>qn(void 0),this.urlHandlingStrategy=new _$,this.routeReuseStrategy=new m$,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.configLoader=d.get(zE),this.configLoader.onLoadEndListener=H=>this.triggerEvent(new r8(H)),this.configLoader.onLoadStartListener=H=>this.triggerEvent(new i8(H)),this.ngModule=d.get(nm),this.console=d.get($z);const R=d.get(di);this.isNgZoneEnabled=R instanceof di&&di.isInAngularZone(),this.resetConfig(y),this.currentUrlTree=function DH(){return new fm(new hr([],{}),{},null)}(),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=ZO(this.currentUrlTree,this.rootComponentType),this.transitions=new _a({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){var e;return null===(e=this.location.getState())||void 0===e?void 0:e.\u0275routerPageId}setupNavigations(e){const i=this.events;return e.pipe(Rr(r=>0!==r.id),$t(r=>Object.assign(Object.assign({},r),{extractedUrl:this.urlHandlingStrategy.extract(r.rawUrl)})),ya(r=>{let s=!1,d=!1;return qn(r).pipe(Jo(m=>{this.currentNavigation={id:m.id,initialUrl:m.rawUrl,extractedUrl:m.extractedUrl,trigger:m.source,extras:m.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),ya(m=>{const y=this.browserUrlTree.toString(),T=!this.navigated||m.extractedUrl.toString()!==y||y!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||T)&&this.urlHandlingStrategy.shouldProcessUrl(m.rawUrl))return SL(m.source)&&(this.browserUrlTree=m.extractedUrl),qn(m).pipe(ya(R=>{const H=this.transitions.getValue();return i.next(new SE(R.id,this.serializeUrl(R.extractedUrl),R.source,R.restoredState)),H!==this.transitions.getValue()?so:Promise.resolve(R)}),function Q8(n,t,e,i){return ya(r=>function Y8(n,t,e,i,r){return new K8(n,t,e,i,r).apply()}(n,t,e,r.extractedUrl,i).pipe($t(s=>Object.assign(Object.assign({},r),{urlAfterRedirects:s}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),Jo(R=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:R.urlAfterRedirects}),r.urlAfterRedirects=R.urlAfterRedirects}),function a$(n,t,e,i,r,s){return Gn(d=>function t$(n,t,e,i,r,s,d="emptyOnly",m="legacy"){return new n$(n,t,e,i,r,d,m,s).recognize().pipe(ya(y=>null===y?function e$(n){return new Mt(t=>t.error(n))}(new J8):qn(y)))}(n,t,e,d.urlAfterRedirects,i.serialize(d.urlAfterRedirects),i,r,s).pipe($t(m=>Object.assign(Object.assign({},d),{targetSnapshot:m}))))}(this.ngModule.injector,this.rootComponentType,this.config,this.urlSerializer,this.paramsInheritanceStrategy,this.relativeLinkResolution),Jo(R=>{if(r.targetSnapshot=R.targetSnapshot,"eager"===this.urlUpdateStrategy){if(!R.extras.skipLocationChange){const Z=this.urlHandlingStrategy.merge(R.urlAfterRedirects,R.rawUrl);this.setBrowserUrl(Z,R)}this.browserUrlTree=R.urlAfterRedirects}const H=new QH(R.id,this.serializeUrl(R.extractedUrl),this.serializeUrl(R.urlAfterRedirects),R.targetSnapshot);i.next(H)}));if(T&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:H,extractedUrl:Z,source:te,restoredState:xe,extras:Ce}=m,et=new SE(H,this.serializeUrl(Z),te,xe);i.next(et);const kt=ZO(Z,this.rootComponentType).snapshot;return qn(r=Object.assign(Object.assign({},m),{targetSnapshot:kt,urlAfterRedirects:Z,extras:Object.assign(Object.assign({},Ce),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=m.rawUrl,m.resolve(null),so}),Jo(m=>{const y=new JH(m.id,this.serializeUrl(m.extractedUrl),this.serializeUrl(m.urlAfterRedirects),m.targetSnapshot);this.triggerEvent(y)}),$t(m=>r=Object.assign(Object.assign({},m),{guards:S8(m.targetSnapshot,m.currentSnapshot,this.rootContexts)})),function O8(n,t){return Gn(e=>{const{targetSnapshot:i,currentSnapshot:r,guards:{canActivateChecks:s,canDeactivateChecks:d}}=e;return 0===d.length&&0===s.length?qn(Object.assign(Object.assign({},e),{guardsResult:!0})):function L8(n,t,e,i){return mo(n).pipe(Gn(r=>function j8(n,t,e,i,r){const s=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return s&&0!==s.length?qn(s.map(m=>{var y;const T=null!==(y=mv(t))&&void 0!==y?y:r,M=Fb(m,T);return Rp(function k8(n){return n&&_v(n.canDeactivate)}(M)?M.canDeactivate(n,t,e,i):T.runInContext(()=>M(n,t,e,i))).pipe(kp())})).pipe(Nb()):qn(!0)}(r.component,r.route,e,t,i)),kp(r=>!0!==r,!0))}(d,i,r,n).pipe(Gn(m=>m&&function D8(n){return"boolean"==typeof n}(m)?function F8(n,t,e,i){return mo(t).pipe(Ep(r=>ov(function B8(n,t){return null!==n&&t&&t(new o8(n)),qn(!0)}(r.route.parent,i),function N8(n,t){return null!==n&&t&&t(new a8(n)),qn(!0)}(r.route,i),function V8(n,t,e){const i=t[t.length-1],s=t.slice(0,t.length-1).reverse().map(d=>function C8(n){const t=n.routeConfig?n.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:n,guards:t}:null}(d)).filter(d=>null!==d).map(d=>pm(()=>qn(d.guards.map(y=>{var T;const M=null!==(T=mv(d.node))&&void 0!==T?T:e,R=Fb(y,M);return Rp(function A8(n){return n&&_v(n.canActivateChild)}(R)?R.canActivateChild(i,n):M.runInContext(()=>R(i,n))).pipe(kp())})).pipe(Nb())));return qn(s).pipe(Nb())}(n,r.path,e),function z8(n,t,e){const i=t.routeConfig?t.routeConfig.canActivate:null;if(!i||0===i.length)return qn(!0);const r=i.map(s=>pm(()=>{var d;const m=null!==(d=mv(t))&&void 0!==d?d:e,y=Fb(s,m);return Rp(function M8(n){return n&&_v(n.canActivate)}(y)?y.canActivate(t,n):m.runInContext(()=>y(t,n))).pipe(kp())}));return qn(r).pipe(Nb())}(n,r.route,e))),kp(r=>!0!==r,!0))}(i,s,n,t):qn(m)),$t(m=>Object.assign(Object.assign({},e),{guardsResult:m})))})}(this.ngModule.injector,m=>this.triggerEvent(m)),Jo(m=>{if(r.guardsResult=m.guardsResult,gm(m.guardsResult))throw JO(0,m.guardsResult);const y=new e8(m.id,this.serializeUrl(m.extractedUrl),this.serializeUrl(m.urlAfterRedirects),m.targetSnapshot,!!m.guardsResult);this.triggerEvent(y)}),Rr(m=>!!m.guardsResult||(this.restoreHistory(m),this.cancelNavigationTransition(m,"",3),!1)),NE(m=>{if(m.guards.canActivateChecks.length)return qn(m).pipe(Jo(y=>{const T=new t8(y.id,this.serializeUrl(y.extractedUrl),this.serializeUrl(y.urlAfterRedirects),y.targetSnapshot);this.triggerEvent(T)}),ya(y=>{let T=!1;return qn(y).pipe(function l$(n,t){return Gn(e=>{const{targetSnapshot:i,guards:{canActivateChecks:r}}=e;if(!r.length)return qn(e);let s=0;return mo(r).pipe(Ep(d=>function c$(n,t,e,i){const r=n.routeConfig,s=n._resolve;return void 0!==(null==r?void 0:r.title)&&!_L(r)&&(s[av]=r.title),function u$(n,t,e,i){const r=function d$(n){return[...Object.keys(n),...Object.getOwnPropertySymbols(n)]}(n);if(0===r.length)return qn({});const s={};return mo(r).pipe(Gn(d=>function h$(n,t,e,i){var r;const s=null!==(r=mv(t))&&void 0!==r?r:i,d=Fb(n,s);return Rp(d.resolve?d.resolve(t,e):s.runInContext(()=>d(t,e)))}(n[d],t,e,i).pipe(kp(),Jo(m=>{s[d]=m}))),mE(1),sv(s),bh(d=>OE(d)?so:kb(d)))}(s,n,t,i).pipe($t(d=>(n._resolvedData=d,n.data=YO(n,e).resolve,r&&_L(r)&&(n.data[av]=r.title),null)))}(d.route,i,n,t)),Jo(()=>s++),mE(1),Gn(d=>s===r.length?qn(e):so))})}(this.paramsInheritanceStrategy,this.ngModule.injector),Jo({next:()=>T=!0,complete:()=>{T||(this.restoreHistory(y),this.cancelNavigationTransition(y,"",2))}}))}),Jo(y=>{const T=new n8(y.id,this.serializeUrl(y.extractedUrl),this.serializeUrl(y.urlAfterRedirects),y.targetSnapshot);this.triggerEvent(T)}))}),NE(m=>{const y=T=>{var M;const R=[];(null===(M=T.routeConfig)||void 0===M?void 0:M.loadComponent)&&!T.routeConfig._loadedComponent&&R.push(this.configLoader.loadComponent(T.routeConfig).pipe(Jo(H=>{T.component=H}),$t(()=>{})));for(const H of T.children)R.push(...y(H));return R};return hm(y(m.targetSnapshot.root)).pipe(xw(),Qr(1))}),NE(()=>this.afterPreactivation()),$t(m=>{const y=function h8(n,t,e){const i=pv(n,t._root,e?e._root:void 0);return new XO(i,t)}(this.routeReuseStrategy,m.targetSnapshot,m.currentRouterState);return r=Object.assign(Object.assign({},m),{targetRouterState:y})}),Jo(m=>{this.currentUrlTree=m.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(m.urlAfterRedirects,m.rawUrl),this.routerState=m.targetRouterState,"deferred"===this.urlUpdateStrategy&&(m.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,m),this.browserUrlTree=m.urlAfterRedirects)}),((n,t,e)=>$t(i=>(new w8(t,i.targetRouterState,i.currentRouterState,e).activate(n),i)))(this.rootContexts,this.routeReuseStrategy,m=>this.triggerEvent(m)),Jo({next(){s=!0},complete(){s=!0}}),ww(()=>{var m;s||d||this.cancelNavigationTransition(r,"",1),(null===(m=this.currentNavigation)||void 0===m?void 0:m.id)===r.id&&(this.currentNavigation=null)}),bh(m=>{var y;if(d=!0,nL(m)){tL(m)||(this.navigated=!0,this.restoreHistory(r,!0));const T=new Mw(r.id,this.serializeUrl(r.extractedUrl),m.message,m.cancellationCode);if(i.next(T),tL(m)){const M=this.urlHandlingStrategy.merge(m.url,this.rawUrlTree),R={skipLocationChange:r.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||SL(r.source)};this.scheduleNavigation(M,"imperative",null,R,{resolve:r.resolve,reject:r.reject,promise:r.promise})}else r.resolve(!1)}else{this.restoreHistory(r,!0);const T=new qO(r.id,this.serializeUrl(r.extractedUrl),m,null!==(y=r.targetSnapshot)&&void 0!==y?y:void 0);i.next(T);try{r.resolve(this.errorHandler(m))}catch(M){r.reject(M)}}return so}))}))}resetRootComponentType(e){this.rootComponentType=e,this.routerState.root.component=this.rootComponentType}setTransition(e){this.transitions.next(Object.assign(Object.assign({},this.transitions.value),e))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(e=>{const i="popstate"===e.type?"popstate":"hashchange";"popstate"===i&&setTimeout(()=>{var r;const s={replaceUrl:!0},d=null!==(r=e.state)&&void 0!==r&&r.navigationId?e.state:null;if(d){const y=Object.assign({},d);delete y.navigationId,delete y.\u0275routerPageId,0!==Object.keys(y).length&&(s.state=y)}const m=this.parseUrl(e.url);this.scheduleNavigation(m,i,d,s)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(e){this.events.next(e)}resetConfig(e){this.config=e.map(PE),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(e,i={}){const{relativeTo:r,queryParams:s,fragment:d,queryParamsHandling:m,preserveFragment:y}=i,T=r||this.routerState.root,M=y?this.currentUrlTree.fragment:d;let R=null;switch(m){case"merge":R=Object.assign(Object.assign({},this.currentUrlTree.queryParams),s);break;case"preserve":R=this.currentUrlTree.queryParams;break;default:R=s||null}return null!==R&&(R=this.removeEmptyProps(R)),GH(T,this.currentUrlTree,e,R,null!=M?M:null)}navigateByUrl(e,i={skipLocationChange:!1}){const r=gm(e)?e:this.parseUrl(e),s=this.urlHandlingStrategy.merge(r,this.rawUrlTree);return this.scheduleNavigation(s,"imperative",null,i)}navigate(e,i={skipLocationChange:!1}){return function C$(n){for(let t=0;t<n.length;t++){if(null==n[t])throw new Nt(4008,false)}}(e),this.navigateByUrl(this.createUrlTree(e,i),i)}serializeUrl(e){return this.urlSerializer.serialize(e)}parseUrl(e){let i;try{i=this.urlSerializer.parse(e)}catch(r){i=this.malformedUriErrorHandler(r,this.urlSerializer,e)}return i}isActive(e,i){let r;if(r=!0===i?Object.assign({},x$):!1===i?Object.assign({},w$):i,gm(e))return kO(this.currentUrlTree,e,r);const s=this.parseUrl(e);return kO(this.currentUrlTree,s,r)}removeEmptyProps(e){return Object.keys(e).reduce((i,r)=>{const s=e[r];return null!=s&&(i[r]=s),i},{})}processNavigations(){this.navigations.subscribe(e=>{var i;this.navigated=!0,this.lastSuccessfulId=e.id,this.currentPageId=e.targetPageId,this.events.next(new bm(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,null===(i=this.titleStrategy)||void 0===i||i.updateTitle(this.routerState.snapshot),e.resolve(!0)},e=>{this.console.warn(`Unhandled Navigation Error: ${e}`)})}scheduleNavigation(e,i,r,s,d){var m,y;if(this.disposed)return Promise.resolve(!1);let T,M,R;d?(T=d.resolve,M=d.reject,R=d.promise):R=new Promise((te,xe)=>{T=te,M=xe});const H=++this.navigationId;let Z;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(r=this.location.getState()),Z=r&&r.\u0275routerPageId?r.\u0275routerPageId:s.replaceUrl||s.skipLocationChange?null!==(m=this.browserPageId)&&void 0!==m?m:0:(null!==(y=this.browserPageId)&&void 0!==y?y:0)+1):Z=0,this.setTransition({id:H,targetPageId:Z,source:i,restoredState:r,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:e,extras:s,resolve:T,reject:M,promise:R,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),R.catch(te=>Promise.reject(te))}setBrowserUrl(e,i){const r=this.urlSerializer.serialize(e),s=Object.assign(Object.assign({},i.extras.state),this.generateNgRouterState(i.id,i.targetPageId));this.location.isCurrentPathEqualTo(r)||i.extras.replaceUrl?this.location.replaceState(r,"",s):this.location.go(r,"",s)}restoreHistory(e,i=!1){var r,s;if("computed"===this.canceledNavigationResolution){const d=this.currentPageId-e.targetPageId;"popstate"!==e.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null===(r=this.currentNavigation)||void 0===r?void 0:r.finalUrl)||0===d?this.currentUrlTree===(null===(s=this.currentNavigation)||void 0===s?void 0:s.finalUrl)&&0===d&&(this.resetState(e),this.browserUrlTree=e.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(d)}else"replace"===this.canceledNavigationResolution&&(i&&this.resetState(e),this.resetUrlToCurrentUrlTree())}resetState(e){this.routerState=e.currentRouterState,this.currentUrlTree=e.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,e.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(e,i,r){const s=new Mw(e.id,this.serializeUrl(e.extractedUrl),i,r);this.triggerEvent(s),e.resolve(!1)}generateNgRouterState(e,i){return"computed"===this.canceledNavigationResolution?{navigationId:e,\u0275routerPageId:i}:{navigationId:e}}}return n.\u0275fac=function(e){ru()},n.\u0275prov=tn({token:n,factory:function(){return wL()},providedIn:"root"}),n})();function SL(n){return"imperative"!==n}let vv=(()=>{class n{constructor(e,i,r){this.router=e,this.route=i,this.locationStrategy=r,this._preserveFragment=!1,this._skipLocationChange=!1,this._replaceUrl=!1,this.commands=null,this.href=null,this.onChanges=new Wt,this.subscription=e.events.subscribe(s=>{s instanceof bm&&this.updateTargetUrlAndHref()})}set preserveFragment(e){this._preserveFragment=uh(e)}get preserveFragment(){return this._preserveFragment}set skipLocationChange(e){this._skipLocationChange=uh(e)}get skipLocationChange(){return this._skipLocationChange}set replaceUrl(e){this._replaceUrl=uh(e)}get replaceUrl(){return this._replaceUrl}set routerLink(e){this.commands=null!=e?Array.isArray(e)?e:[e]:null}ngOnChanges(e){this.updateTargetUrlAndHref(),this.onChanges.next(this)}ngOnDestroy(){this.subscription.unsubscribe()}onClick(e,i,r,s,d){return!!(0!==e||i||r||s||d||"string"==typeof this.target&&"_self"!=this.target||null===this.urlTree)||(this.router.navigateByUrl(this.urlTree,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state}),!1)}updateTargetUrlAndHref(){this.href=null!==this.urlTree?this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}}return n.\u0275fac=function(e){return new(e||n)(X(Ds),X(_m),X(sm))},n.\u0275dir=Ft({type:n,selectors:[["a","routerLink",""],["area","routerLink",""]],hostVars:2,hostBindings:function(e,i){1&e&&nn("click",function(s){return i.onClick(s.button,s.ctrlKey,s.shiftKey,s.altKey,s.metaKey)}),2&e&&Sn("target",i.target)("href",i.href,yc)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",relativeTo:"relativeTo",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",routerLink:"routerLink"},standalone:!0,features:[_r]}),n})();class CL{}let D$=(()=>{class n{constructor(e,i,r,s,d){this.router=e,this.injector=r,this.preloadingStrategy=s,this.loader=d}setUpPreloading(){this.subscription=this.router.events.pipe(Rr(e=>e instanceof bm),Ep(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(e,i){var r,s,d;const m=[];for(const y of i){y.providers&&!y._injector&&(y._injector=mx(y.providers,e,`Route: ${y.path}`));const T=null!==(r=y._injector)&&void 0!==r?r:e,M=null!==(s=y._loadedInjector)&&void 0!==s?s:T;y.loadChildren&&!y._loadedRoutes&&void 0===y.canLoad||y.loadComponent&&!y._loadedComponent?m.push(this.preloadConfig(T,y)):(y.children||y._loadedRoutes)&&m.push(this.processRoutes(M,null!==(d=y.children)&&void 0!==d?d:y._loadedRoutes))}return mo(m).pipe(Wo())}preloadConfig(e,i){return this.preloadingStrategy.preload(i,()=>{let r;r=i.loadChildren&&void 0===i.canLoad?this.loader.loadChildren(e,i):qn(null);const s=r.pipe(Gn(d=>{var m;return null===d?qn(void 0):(i._loadedRoutes=d.routes,i._loadedInjector=d.injector,this.processRoutes(null!==(m=d.injector)&&void 0!==m?m:e,d.routes))}));return i.loadComponent&&!i._loadedComponent?mo([s,this.loader.loadComponent(i)]).pipe(Wo()):s})}}return n.\u0275fac=function(e){return new(e||n)(Ue(Ds),Ue(kC),Ue(tu),Ue(CL),Ue(zE))},n.\u0275prov=tn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const jE=new Dt("");let TL=(()=>{class n{constructor(e,i,r={}){this.router=e,this.viewportScroller=i,this.options=r,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},r.scrollPositionRestoration=r.scrollPositionRestoration||"disabled",r.anchorScrolling=r.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(e=>{e instanceof SE?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=e.navigationTrigger,this.restoredId=e.restoredState?e.restoredState.navigationId:0):e instanceof bm&&(this.lastId=e.id,this.scheduleScrollEvent(e,this.router.parseUrl(e.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(e=>{e instanceof GO&&(e.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(e.position):e.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(e.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(e,i){this.router.triggerEvent(new GO(e,"popstate"===this.lastSource?this.store[this.restoredId]:null,i))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return n.\u0275fac=function(e){ru()},n.\u0275prov=tn({token:n,factory:n.\u0275fac}),n})();function Bb(n,t){return{\u0275kind:n,\u0275providers:t}}function UE(n){return[{provide:BE,multi:!0,useValue:n}]}function DL(){const n=Wr(Xr);return t=>{var e,i;const r=n.get(Cb);if(t!==r.components[0])return;const s=n.get(Ds),d=n.get(IL);1===n.get(HE)&&s.initialNavigation(),null===(e=n.get(ML,null,ri.Optional))||void 0===e||e.setUpPreloading(),null===(i=n.get(jE,null,ri.Optional))||void 0===i||i.init(),s.resetRootComponentType(r.componentTypes[0]),d.closed||(d.next(),d.unsubscribe())}}const IL=new Dt("",{factory:()=>new Wt}),HE=new Dt("",{providedIn:"root",factory:()=>1});const ML=new Dt("");function k$(n){return Bb(0,[{provide:ML,useExisting:D$},{provide:CL,useExisting:n}])}const AL=new Dt("ROUTER_FORROOT_GUARD"),R$=[Dx,{provide:LO,useClass:bE},{provide:Ds,useFactory:wL},fv,{provide:_m,useFactory:function EL(n){return n.routerState.root},deps:[Ds]},zE];function P$(){return new KA("Router",Ds)}let Hw=(()=>{class n{constructor(e){}static forRoot(e,i){return{ngModule:n,providers:[R$,[],UE(e),{provide:AL,useFactory:N$,deps:[[Ds,new Jh,new ep]]},{provide:zw,useValue:i||{}},null!=i&&i.useHash?{provide:sm,useClass:RV}:{provide:sm,useClass:wk},{provide:jE,useFactory:()=>{const n=Wr(Ds),t=Wr(qj),e=Wr(zw);return e.scrollOffset&&t.setOffset(e.scrollOffset),new TL(n,t,e)}},null!=i&&i.preloadingStrategy?k$(i.preloadingStrategy).\u0275providers:[],{provide:KA,multi:!0,useFactory:P$},null!=i&&i.initialNavigation?B$(i):[],[{provide:kL,useFactory:DL},{provide:$A,multi:!0,useExisting:kL}]]}}static forChild(e){return{ngModule:n,providers:[UE(e)]}}}return n.\u0275fac=function(e){return new(e||n)(Ue(AL,8))},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({imports:[kE]}),n})();function N$(n){return"guarded"}function B$(n){return["disabled"===n.initialNavigation?Bb(3,[{provide:yx,multi:!0,useFactory:()=>{const t=Wr(Ds);return()=>{t.setUpLocationChangeListener()}}},{provide:HE,useValue:2}]).\u0275providers:[],"enabledBlocking"===n.initialNavigation?Bb(2,[{provide:HE,useValue:0},{provide:yx,multi:!0,deps:[Xr],useFactory:t=>{const e=t.get(AV,Promise.resolve());let i=!1;return()=>e.then(()=>new Promise(s=>{const d=t.get(Ds),m=t.get(IL);(function r(s){t.get(Ds).events.pipe(Rr(m=>m instanceof bm||m instanceof Mw||m instanceof qO),$t(m=>m instanceof bm||m instanceof Mw&&(0===m.code||1===m.code)&&null),Rr(m=>null!==m),Qr(1)).subscribe(()=>{s()})})(()=>{s(!0),i=!0}),d.afterPreactivation=()=>(s(!0),i||m.closed?qn(void 0):m),d.initialNavigation()}))}}]).\u0275providers:[]]}const kL=new Dt("");let $E;try{$E="undefined"!=typeof Intl&&Intl.v8BreakIterator}catch(n){$E=!1}let zb,Is=(()=>{class n{constructor(e){this._platformId=e,this.isBrowser=this._platformId?function $j(n){return n===Uk}(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!$E)&&"undefined"!=typeof CSS&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}}return n.\u0275fac=function(e){return new(e||n)(Ue(xx))},n.\u0275prov=tn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const RL=["color","button","checkbox","date","datetime-local","email","file","hidden","image","month","number","password","radio","range","reset","search","submit","tel","text","time","url","week"];function PL(){if(zb)return zb;if("object"!=typeof document||!document)return zb=new Set(RL),zb;let n=document.createElement("input");return zb=new Set(RL.filter(t=>(n.setAttribute("type",t),n.type===t))),zb}let xv,ym,qE;function Pp(n){return function V$(){if(null==xv&&"undefined"!=typeof window)try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>xv=!0}))}finally{xv=xv||!1}return xv}()?n:!!n.capture}function j$(){if(null==ym){if("object"!=typeof document||!document||"function"!=typeof Element||!Element)return ym=!1,ym;if("scrollBehavior"in document.documentElement.style)ym=!0;else{const n=Element.prototype.scrollTo;ym=!!n&&!/\{\s*\[native code\]\s*\}/.test(n.toString())}}return ym}function pu(){let n="undefined"!=typeof document&&document?document.activeElement:null;for(;n&&n.shadowRoot;){const t=n.shadowRoot.activeElement;if(t===n)break;n=t}return n}function Op(n){return n.composedPath?n.composedPath()[0]:n.target}function GE(){return"undefined"!=typeof __karma__&&!!__karma__||"undefined"!=typeof jasmine&&!!jasmine||"undefined"!=typeof jest&&!!jest||"undefined"!=typeof Mocha&&!!Mocha}function xa(n,...t){return t.length?t.some(e=>n[e]):n.altKey||n.shiftKey||n.ctrlKey||n.metaKey}class tq extends he{constructor(t,e){super()}schedule(t,e=0){return this}}const qw={setInterval(n,t,...e){const{delegate:i}=qw;return null!=i&&i.setInterval?i.setInterval(n,t,...e):setInterval(n,t,...e)},clearInterval(n){const{delegate:t}=qw;return((null==t?void 0:t.clearInterval)||clearInterval)(n)},delegate:void 0};class KE extends tq{constructor(t,e){super(t,e),this.scheduler=t,this.work=e,this.pending=!1}schedule(t,e=0){var i;if(this.closed)return this;this.state=t;const r=this.id,s=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(s,r,e)),this.pending=!0,this.delay=e,this.id=null!==(i=this.id)&&void 0!==i?i:this.requestAsyncId(s,this.id,e),this}requestAsyncId(t,e,i=0){return qw.setInterval(t.flush.bind(t,this),i)}recycleAsyncId(t,e,i=0){if(null!=i&&this.delay===i&&!1===this.pending)return e;null!=e&&qw.clearInterval(e)}execute(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const i=this._execute(t,e);if(i)return i;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,e){let r,i=!1;try{this.work(t)}catch(s){i=!0,r=s||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),r}unsubscribe(){if(!this.closed){const{id:t,scheduler:e}=this,{actions:i}=e;this.work=this.state=this.scheduler=null,this.pending=!1,p(i,this),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null,super.unsubscribe()}}}const NL={now:()=>(NL.delegate||Date).now(),delegate:void 0};class wv{constructor(t,e=wv.now){this.schedulerActionCtor=t,this.now=e}schedule(t,e=0,i){return new this.schedulerActionCtor(this,t).schedule(i,e)}}wv.now=NL.now;class QE extends wv{constructor(t,e=wv.now){super(t,e),this.actions=[],this._active=!1}flush(t){const{actions:e}=this;if(this._active)return void e.push(t);let i;this._active=!0;do{if(i=t.execute(t.state,t.delay))break}while(t=e.shift());if(this._active=!1,i){for(;t=e.shift();)t.unsubscribe();throw i}}}const Gw=new QE(KE),nq=Gw;function Sv(n,t=Gw){return Cn((e,i)=>{let r=null,s=null,d=null;const m=()=>{if(r){r.unsubscribe(),r=null;const T=s;s=null,i.next(T)}};function y(){const T=d+n,M=t.now();if(M<T)return r=this.schedule(void 0,T-M),void i.add(r);m()}e.subscribe(bt(i,T=>{s=T,d=t.now(),r||(r=t.schedule(y,n),i.add(r))},()=>{m(),i.complete()},void 0,()=>{s=r=null}))})}function BL(n){return Rr((t,e)=>n<=e)}function Lp(n,t=Je){return n=null!=n?n:iq,Cn((e,i)=>{let r,s=!0;e.subscribe(bt(i,d=>{const m=t(d);(s||!n(r,m))&&(s=!1,r=m,i.next(d))}))})}function iq(n,t){return n===t}function Hi(n){return Cn((t,e)=>{Pt(n).subscribe(bt(e,()=>e.complete(),Ze)),!e.closed&&t.subscribe(e)})}function ii(n){return null!=n&&"false"!=`${n}`}function wh(n,t=0){return function rq(n){return!isNaN(parseFloat(n))&&!isNaN(Number(n))}(n)?Number(n):t}function Ww(n){return Array.isArray(n)?n:[n]}function Ms(n){return null==n?"":"string"==typeof n?n:`${n}px`}function wm(n){return n instanceof zn?n.nativeElement:n}function JE(n,t=/\s+/){const e=[];if(null!=n){const i=Array.isArray(n)?n:`${n}`.split(t);for(const r of i){const s=`${r}`.trim();s&&e.push(s)}}return e}let zL=(()=>{class n{create(e){return"undefined"==typeof MutationObserver?null:new MutationObserver(e)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=tn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),VL=(()=>{class n{constructor(e){this._mutationObserverFactory=e,this._observedElements=new Map}ngOnDestroy(){this._observedElements.forEach((e,i)=>this._cleanupObserver(i))}observe(e){const i=wm(e);return new Mt(r=>{const d=this._observeElement(i).subscribe(r);return()=>{d.unsubscribe(),this._unobserveElement(i)}})}_observeElement(e){if(this._observedElements.has(e))this._observedElements.get(e).count++;else{const i=new Wt,r=this._mutationObserverFactory.create(s=>i.next(s));r&&r.observe(e,{characterData:!0,childList:!0,subtree:!0}),this._observedElements.set(e,{observer:r,stream:i,count:1})}return this._observedElements.get(e).stream}_unobserveElement(e){this._observedElements.has(e)&&(this._observedElements.get(e).count--,this._observedElements.get(e).count||this._cleanupObserver(e))}_cleanupObserver(e){if(this._observedElements.has(e)){const{observer:i,stream:r}=this._observedElements.get(e);i&&i.disconnect(),r.complete(),this._observedElements.delete(e)}}}return n.\u0275fac=function(e){return new(e||n)(Ue(zL))},n.\u0275prov=tn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),jL=(()=>{class n{constructor(e,i,r){this._contentObserver=e,this._elementRef=i,this._ngZone=r,this.event=new on,this._disabled=!1,this._currentSubscription=null}get disabled(){return this._disabled}set disabled(e){this._disabled=ii(e),this._disabled?this._unsubscribe():this._subscribe()}get debounce(){return this._debounce}set debounce(e){this._debounce=wh(e),this._subscribe()}ngAfterContentInit(){!this._currentSubscription&&!this.disabled&&this._subscribe()}ngOnDestroy(){this._unsubscribe()}_subscribe(){this._unsubscribe();const e=this._contentObserver.observe(this._elementRef);this._ngZone.runOutsideAngular(()=>{this._currentSubscription=(this.debounce?e.pipe(Sv(this.debounce)):e).subscribe(this.event)})}_unsubscribe(){var e;null===(e=this._currentSubscription)||void 0===e||e.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)(X(VL),X(zn),X(di))},n.\u0275dir=Ft({type:n,selectors:[["","cdkObserveContent",""]],inputs:{disabled:["cdkObserveContentDisabled","disabled"],debounce:"debounce"},outputs:{event:"cdkObserveContent"},exportAs:["cdkObserveContent"]}),n})(),Xw=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({providers:[zL]}),n})();const UL=new Set;let jb,oq=(()=>{class n{constructor(e){this._platform=e,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):aq}matchMedia(e){return(this._platform.WEBKIT||this._platform.BLINK)&&function sq(n){if(!UL.has(n))try{jb||(jb=document.createElement("style"),jb.setAttribute("type","text/css"),document.head.appendChild(jb)),jb.sheet&&(jb.sheet.insertRule(`@media ${n} {body{ }}`,0),UL.add(n))}catch(t){console.error(t)}}(e),this._matchMedia(e)}}return n.\u0275fac=function(e){return new(e||n)(Ue(Is))},n.\u0275prov=tn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function aq(n){return{matches:"all"===n||""===n,media:n,addListener:()=>{},removeListener:()=>{}}}let eD=(()=>{class n{constructor(e,i){this._mediaMatcher=e,this._zone=i,this._queries=new Map,this._destroySubject=new Wt}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(e){return HL(Ww(e)).some(r=>this._registerQuery(r).mql.matches)}observe(e){let s=hm(HL(Ww(e)).map(d=>this._registerQuery(d).observable));return s=ov(s.pipe(Qr(1)),s.pipe(BL(1),Sv(0))),s.pipe($t(d=>{const m={matches:!1,breakpoints:{}};return d.forEach(({matches:y,query:T})=>{m.matches=m.matches||y,m.breakpoints[T]=y}),m}))}_registerQuery(e){if(this._queries.has(e))return this._queries.get(e);const i=this._mediaMatcher.matchMedia(e),s={observable:new Mt(d=>{const m=y=>this._zone.run(()=>d.next(y));return i.addListener(m),()=>{i.removeListener(m)}}).pipe(Hs(i),$t(({matches:d})=>({query:e,matches:d})),Hi(this._destroySubject)),mql:i};return this._queries.set(e,s),s}}return n.\u0275fac=function(e){return new(e||n)(Ue(oq),Ue(di))},n.\u0275prov=tn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function HL(n){return n.map(t=>t.split(",")).reduce((t,e)=>t.concat(e)).map(t=>t.trim())}function Zw(n,t){return(n.getAttribute(t)||"").match(/\S+/g)||[]}const qL="cdk-describedby-message",Yw="cdk-describedby-host";let tD=0,GL=(()=>{class n{constructor(e,i){this._platform=i,this._messageRegistry=new Map,this._messagesContainer=null,this._id=""+tD++,this._document=e,this._id=Wr(Sb)+"-"+tD++}describe(e,i,r){if(!this._canBeDescribed(e,i))return;const s=nD(i,r);"string"!=typeof i?(WL(i,this._id),this._messageRegistry.set(s,{messageElement:i,referenceCount:0})):this._messageRegistry.has(s)||this._createMessageElement(i,r),this._isElementDescribedByMessage(e,s)||this._addMessageReference(e,s)}removeDescription(e,i,r){var s;if(!i||!this._isElementNode(e))return;const d=nD(i,r);if(this._isElementDescribedByMessage(e,d)&&this._removeMessageReference(e,d),"string"==typeof i){const m=this._messageRegistry.get(d);m&&0===m.referenceCount&&this._deleteMessageElement(d)}0===(null===(s=this._messagesContainer)||void 0===s?void 0:s.childNodes.length)&&(this._messagesContainer.remove(),this._messagesContainer=null)}ngOnDestroy(){var e;const i=this._document.querySelectorAll(`[${Yw}="${this._id}"]`);for(let r=0;r<i.length;r++)this._removeCdkDescribedByReferenceIds(i[r]),i[r].removeAttribute(Yw);null===(e=this._messagesContainer)||void 0===e||e.remove(),this._messagesContainer=null,this._messageRegistry.clear()}_createMessageElement(e,i){const r=this._document.createElement("div");WL(r,this._id),r.textContent=e,i&&r.setAttribute("role",i),this._createMessagesContainer(),this._messagesContainer.appendChild(r),this._messageRegistry.set(nD(e,i),{messageElement:r,referenceCount:0})}_deleteMessageElement(e){var i,r;null===(r=null===(i=this._messageRegistry.get(e))||void 0===i?void 0:i.messageElement)||void 0===r||r.remove(),this._messageRegistry.delete(e)}_createMessagesContainer(){if(this._messagesContainer)return;const e="cdk-describedby-message-container",i=this._document.querySelectorAll(`.${e}[platform="server"]`);for(let s=0;s<i.length;s++)i[s].remove();const r=this._document.createElement("div");r.style.visibility="hidden",r.classList.add(e),r.classList.add("cdk-visually-hidden"),this._platform&&!this._platform.isBrowser&&r.setAttribute("platform","server"),this._document.body.appendChild(r),this._messagesContainer=r}_removeCdkDescribedByReferenceIds(e){const i=Zw(e,"aria-describedby").filter(r=>0!=r.indexOf(qL));e.setAttribute("aria-describedby",i.join(" "))}_addMessageReference(e,i){const r=this._messageRegistry.get(i);(function lq(n,t,e){const i=Zw(n,t);i.some(r=>r.trim()==e.trim())||(i.push(e.trim()),n.setAttribute(t,i.join(" ")))})(e,"aria-describedby",r.messageElement.id),e.setAttribute(Yw,this._id),r.referenceCount++}_removeMessageReference(e,i){const r=this._messageRegistry.get(i);r.referenceCount--,function cq(n,t,e){const r=Zw(n,t).filter(s=>s!=e.trim());r.length?n.setAttribute(t,r.join(" ")):n.removeAttribute(t)}(e,"aria-describedby",r.messageElement.id),e.removeAttribute(Yw)}_isElementDescribedByMessage(e,i){const r=Zw(e,"aria-describedby"),s=this._messageRegistry.get(i),d=s&&s.messageElement.id;return!!d&&-1!=r.indexOf(d)}_canBeDescribed(e,i){if(!this._isElementNode(e))return!1;if(i&&"object"==typeof i)return!0;const r=null==i?"":`${i}`.trim(),s=e.getAttribute("aria-label");return!(!r||s&&s.trim()===r)}_isElementNode(e){return e.nodeType===this._document.ELEMENT_NODE}}return n.\u0275fac=function(e){return new(e||n)(Ue(ui),Ue(Is))},n.\u0275prov=tn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function nD(n,t){return"string"==typeof n?`${t||""}/${n}`:n}function WL(n,t){n.id||(n.id=`${qL}-${t}-${tD++}`)}class XL{constructor(t){this._items=t,this._activeItemIndex=-1,this._activeItem=null,this._wrap=!1,this._letterKeyStream=new Wt,this._typeaheadSubscription=he.EMPTY,this._vertical=!0,this._allowedModifierKeys=[],this._homeAndEnd=!1,this._skipPredicateFn=e=>e.disabled,this._pressedLetters=[],this.tabOut=new Wt,this.change=new Wt,t instanceof im&&t.changes.subscribe(e=>{if(this._activeItem){const r=e.toArray().indexOf(this._activeItem);r>-1&&r!==this._activeItemIndex&&(this._activeItemIndex=r)}})}skipPredicate(t){return this._skipPredicateFn=t,this}withWrap(t=!0){return this._wrap=t,this}withVerticalOrientation(t=!0){return this._vertical=t,this}withHorizontalOrientation(t){return this._horizontal=t,this}withAllowedModifierKeys(t){return this._allowedModifierKeys=t,this}withTypeAhead(t=200){return this._typeaheadSubscription.unsubscribe(),this._typeaheadSubscription=this._letterKeyStream.pipe(Jo(e=>this._pressedLetters.push(e)),Sv(t),Rr(()=>this._pressedLetters.length>0),$t(()=>this._pressedLetters.join(""))).subscribe(e=>{const i=this._getItemsArray();for(let r=1;r<i.length+1;r++){const s=(this._activeItemIndex+r)%i.length,d=i[s];if(!this._skipPredicateFn(d)&&0===d.getLabel().toUpperCase().trim().indexOf(e)){this.setActiveItem(s);break}}this._pressedLetters=[]}),this}withHomeAndEnd(t=!0){return this._homeAndEnd=t,this}setActiveItem(t){const e=this._activeItem;this.updateActiveItem(t),this._activeItem!==e&&this.change.next(this._activeItemIndex)}onKeydown(t){const e=t.keyCode,r=["altKey","ctrlKey","metaKey","shiftKey"].every(s=>!t[s]||this._allowedModifierKeys.indexOf(s)>-1);switch(e){case 9:return void this.tabOut.next();case 40:if(this._vertical&&r){this.setNextItemActive();break}return;case 38:if(this._vertical&&r){this.setPreviousItemActive();break}return;case 39:if(this._horizontal&&r){"rtl"===this._horizontal?this.setPreviousItemActive():this.setNextItemActive();break}return;case 37:if(this._horizontal&&r){"rtl"===this._horizontal?this.setNextItemActive():this.setPreviousItemActive();break}return;case 36:if(this._homeAndEnd&&r){this.setFirstItemActive();break}return;case 35:if(this._homeAndEnd&&r){this.setLastItemActive();break}return;default:return void((r||xa(t,"shiftKey"))&&(t.key&&1===t.key.length?this._letterKeyStream.next(t.key.toLocaleUpperCase()):(e>=65&&e<=90||e>=48&&e<=57)&&this._letterKeyStream.next(String.fromCharCode(e))))}this._pressedLetters=[],t.preventDefault()}get activeItemIndex(){return this._activeItemIndex}get activeItem(){return this._activeItem}isTyping(){return this._pressedLetters.length>0}setFirstItemActive(){this._setActiveItemByIndex(0,1)}setLastItemActive(){this._setActiveItemByIndex(this._items.length-1,-1)}setNextItemActive(){this._activeItemIndex<0?this.setFirstItemActive():this._setActiveItemByDelta(1)}setPreviousItemActive(){this._activeItemIndex<0&&this._wrap?this.setLastItemActive():this._setActiveItemByDelta(-1)}updateActiveItem(t){const e=this._getItemsArray(),i="number"==typeof t?t:e.indexOf(t),r=e[i];this._activeItem=null==r?null:r,this._activeItemIndex=i}_setActiveItemByDelta(t){this._wrap?this._setActiveInWrapMode(t):this._setActiveInDefaultMode(t)}_setActiveInWrapMode(t){const e=this._getItemsArray();for(let i=1;i<=e.length;i++){const r=(this._activeItemIndex+t*i+e.length)%e.length;if(!this._skipPredicateFn(e[r]))return void this.setActiveItem(r)}}_setActiveInDefaultMode(t){this._setActiveItemByIndex(this._activeItemIndex+t,t)}_setActiveItemByIndex(t,e){const i=this._getItemsArray();if(i[t]){for(;this._skipPredicateFn(i[t]);)if(!i[t+=e])return;this.setActiveItem(t)}}_getItemsArray(){return this._items instanceof im?this._items.toArray():this._items}}class ZL extends XL{setActiveItem(t){this.activeItem&&this.activeItem.setInactiveStyles(),super.setActiveItem(t),this.activeItem&&this.activeItem.setActiveStyles()}}class iD extends XL{constructor(){super(...arguments),this._origin="program"}setFocusOrigin(t){return this._origin=t,this}setActiveItem(t){super.setActiveItem(t),this.activeItem&&this.activeItem.focus(this._origin)}}let Sm=(()=>{class n{constructor(e){this._platform=e}isDisabled(e){return e.hasAttribute("disabled")}isVisible(e){return function dq(n){return!!(n.offsetWidth||n.offsetHeight||"function"==typeof n.getClientRects&&n.getClientRects().length)}(e)&&"visible"===getComputedStyle(e).visibility}isTabbable(e){if(!this._platform.isBrowser)return!1;const i=function uq(n){try{return n.frameElement}catch(t){return null}}(function yq(n){return n.ownerDocument&&n.ownerDocument.defaultView||window}(e));if(i&&(-1===KL(i)||!this.isVisible(i)))return!1;let r=e.nodeName.toLowerCase(),s=KL(e);return e.hasAttribute("contenteditable")?-1!==s:!("iframe"===r||"object"===r||this._platform.WEBKIT&&this._platform.IOS&&!function bq(n){let t=n.nodeName.toLowerCase(),e="input"===t&&n.type;return"text"===e||"password"===e||"select"===t||"textarea"===t}(e))&&("audio"===r?!!e.hasAttribute("controls")&&-1!==s:"video"===r?-1!==s&&(null!==s||this._platform.FIREFOX||e.hasAttribute("controls")):e.tabIndex>=0)}isFocusable(e,i){return function _q(n){return!function pq(n){return function mq(n){return"input"==n.nodeName.toLowerCase()}(n)&&"hidden"==n.type}(n)&&(function hq(n){let t=n.nodeName.toLowerCase();return"input"===t||"select"===t||"button"===t||"textarea"===t}(n)||function fq(n){return function gq(n){return"a"==n.nodeName.toLowerCase()}(n)&&n.hasAttribute("href")}(n)||n.hasAttribute("contenteditable")||YL(n))}(e)&&!this.isDisabled(e)&&((null==i?void 0:i.ignoreVisibility)||this.isVisible(e))}}return n.\u0275fac=function(e){return new(e||n)(Ue(Is))},n.\u0275prov=tn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function YL(n){if(!n.hasAttribute("tabindex")||void 0===n.tabIndex)return!1;let t=n.getAttribute("tabindex");return!(!t||isNaN(parseInt(t,10)))}function KL(n){if(!YL(n))return null;const t=parseInt(n.getAttribute("tabindex")||"",10);return isNaN(t)?-1:t}class QL{constructor(t,e,i,r,s=!1){this._element=t,this._checker=e,this._ngZone=i,this._document=r,this._hasAttached=!1,this.startAnchorListener=()=>this.focusLastTabbableElement(),this.endAnchorListener=()=>this.focusFirstTabbableElement(),this._enabled=!0,s||this.attachAnchors()}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(t,this._startAnchor),this._toggleAnchorTabIndex(t,this._endAnchor))}destroy(){const t=this._startAnchor,e=this._endAnchor;t&&(t.removeEventListener("focus",this.startAnchorListener),t.remove()),e&&(e.removeEventListener("focus",this.endAnchorListener),e.remove()),this._startAnchor=this._endAnchor=null,this._hasAttached=!1}attachAnchors(){return!!this._hasAttached||(this._ngZone.runOutsideAngular(()=>{this._startAnchor||(this._startAnchor=this._createAnchor(),this._startAnchor.addEventListener("focus",this.startAnchorListener)),this._endAnchor||(this._endAnchor=this._createAnchor(),this._endAnchor.addEventListener("focus",this.endAnchorListener))}),this._element.parentNode&&(this._element.parentNode.insertBefore(this._startAnchor,this._element),this._element.parentNode.insertBefore(this._endAnchor,this._element.nextSibling),this._hasAttached=!0),this._hasAttached)}focusInitialElementWhenReady(t){return new Promise(e=>{this._executeOnStable(()=>e(this.focusInitialElement(t)))})}focusFirstTabbableElementWhenReady(t){return new Promise(e=>{this._executeOnStable(()=>e(this.focusFirstTabbableElement(t)))})}focusLastTabbableElementWhenReady(t){return new Promise(e=>{this._executeOnStable(()=>e(this.focusLastTabbableElement(t)))})}_getRegionBoundary(t){const e=this._element.querySelectorAll(`[cdk-focus-region-${t}], [cdkFocusRegion${t}], [cdk-focus-${t}]`);return"start"==t?e.length?e[0]:this._getFirstTabbableElement(this._element):e.length?e[e.length-1]:this._getLastTabbableElement(this._element)}focusInitialElement(t){const e=this._element.querySelector("[cdk-focus-initial], [cdkFocusInitial]");if(e){if(!this._checker.isFocusable(e)){const i=this._getFirstTabbableElement(e);return null==i||i.focus(t),!!i}return e.focus(t),!0}return this.focusFirstTabbableElement(t)}focusFirstTabbableElement(t){const e=this._getRegionBoundary("start");return e&&e.focus(t),!!e}focusLastTabbableElement(t){const e=this._getRegionBoundary("end");return e&&e.focus(t),!!e}hasAttached(){return this._hasAttached}_getFirstTabbableElement(t){if(this._checker.isFocusable(t)&&this._checker.isTabbable(t))return t;const e=t.children;for(let i=0;i<e.length;i++){const r=e[i].nodeType===this._document.ELEMENT_NODE?this._getFirstTabbableElement(e[i]):null;if(r)return r}return null}_getLastTabbableElement(t){if(this._checker.isFocusable(t)&&this._checker.isTabbable(t))return t;const e=t.children;for(let i=e.length-1;i>=0;i--){const r=e[i].nodeType===this._document.ELEMENT_NODE?this._getLastTabbableElement(e[i]):null;if(r)return r}return null}_createAnchor(){const t=this._document.createElement("div");return this._toggleAnchorTabIndex(this._enabled,t),t.classList.add("cdk-visually-hidden"),t.classList.add("cdk-focus-trap-anchor"),t.setAttribute("aria-hidden","true"),t}_toggleAnchorTabIndex(t,e){t?e.setAttribute("tabindex","0"):e.removeAttribute("tabindex")}toggleAnchors(t){this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(t,this._startAnchor),this._toggleAnchorTabIndex(t,this._endAnchor))}_executeOnStable(t){this._ngZone.isStable?t():this._ngZone.onStable.pipe(Qr(1)).subscribe(t)}}let Ub=(()=>{class n{constructor(e,i,r){this._checker=e,this._ngZone=i,this._document=r}create(e,i=!1){return new QL(e,this._checker,this._ngZone,this._document,i)}}return n.\u0275fac=function(e){return new(e||n)(Ue(Sm),Ue(di),Ue(ui))},n.\u0275prov=tn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),vq=(()=>{class n{constructor(e,i,r){this._elementRef=e,this._focusTrapFactory=i,this._previouslyFocusedElement=null,this.focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement,!0)}get enabled(){return this.focusTrap.enabled}set enabled(e){this.focusTrap.enabled=ii(e)}get autoCapture(){return this._autoCapture}set autoCapture(e){this._autoCapture=ii(e)}ngOnDestroy(){this.focusTrap.destroy(),this._previouslyFocusedElement&&(this._previouslyFocusedElement.focus(),this._previouslyFocusedElement=null)}ngAfterContentInit(){this.focusTrap.attachAnchors(),this.autoCapture&&this._captureFocus()}ngDoCheck(){this.focusTrap.hasAttached()||this.focusTrap.attachAnchors()}ngOnChanges(e){const i=e.autoCapture;i&&!i.firstChange&&this.autoCapture&&this.focusTrap.hasAttached()&&this._captureFocus()}_captureFocus(){this._previouslyFocusedElement=pu(),this.focusTrap.focusInitialElementWhenReady()}}return n.\u0275fac=function(e){return new(e||n)(X(zn),X(Ub),X(ui))},n.\u0275dir=Ft({type:n,selectors:[["","cdkTrapFocus",""]],inputs:{enabled:["cdkTrapFocus","enabled"],autoCapture:["cdkTrapFocusAutoCapture","autoCapture"]},exportAs:["cdkTrapFocus"],features:[_r]}),n})();class xq extends QL{constructor(t,e,i,r,s,d,m){super(t,e,i,r,m.defer),this._focusTrapManager=s,this._inertStrategy=d,this._focusTrapManager.register(this)}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this._enabled?this._focusTrapManager.register(this):this._focusTrapManager.deregister(this)}destroy(){this._focusTrapManager.deregister(this),super.destroy()}_enable(){this._inertStrategy.preventFocus(this),this.toggleAnchors(!0)}_disable(){this._inertStrategy.allowFocus(this),this.toggleAnchors(!1)}}const wq=new Dt("FOCUS_TRAP_INERT_STRATEGY");class Sq{constructor(){this._listener=null}preventFocus(t){this._listener&&t._document.removeEventListener("focus",this._listener,!0),this._listener=e=>this._trapFocus(t,e),t._ngZone.runOutsideAngular(()=>{t._document.addEventListener("focus",this._listener,!0)})}allowFocus(t){!this._listener||(t._document.removeEventListener("focus",this._listener,!0),this._listener=null)}_trapFocus(t,e){var i;const r=e.target,s=t._element;r&&!s.contains(r)&&(null===(i=r.closest)||void 0===i||!i.call(r,"div.cdk-overlay-pane"))&&setTimeout(()=>{t.enabled&&!s.contains(t._document.activeElement)&&t.focusFirstTabbableElement()})}}let Cq=(()=>{class n{constructor(){this._focusTrapStack=[]}register(e){this._focusTrapStack=this._focusTrapStack.filter(r=>r!==e);let i=this._focusTrapStack;i.length&&i[i.length-1]._disable(),i.push(e),e._enable()}deregister(e){e._disable();const i=this._focusTrapStack,r=i.indexOf(e);-1!==r&&(i.splice(r,1),i.length&&i[i.length-1]._enable())}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=tn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),JL=(()=>{class n{constructor(e,i,r,s,d){this._checker=e,this._ngZone=i,this._focusTrapManager=r,this._document=s,this._inertStrategy=d||new Sq}create(e,i={defer:!1}){let r;return r="boolean"==typeof i?{defer:i}:i,new xq(e,this._checker,this._ngZone,this._document,this._focusTrapManager,this._inertStrategy,r)}}return n.\u0275fac=function(e){return new(e||n)(Ue(Sm),Ue(di),Ue(Cq),Ue(ui),Ue(wq,8))},n.\u0275prov=tn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const Dq=new Dt("cdk-input-modality-detector-options"),Iq={ignoreKeys:[18,17,224,91,16]},Hb=Pp({passive:!0,capture:!0});let Mq=(()=>{class n{constructor(e,i,r,s){this._platform=e,this._mostRecentTarget=null,this._modality=new _a(null),this._lastTouchMs=0,this._onKeydown=d=>{var m,y;null!==(y=null===(m=this._options)||void 0===m?void 0:m.ignoreKeys)&&void 0!==y&&y.some(T=>T===d.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=Op(d))},this._onMousedown=d=>{Date.now()-this._lastTouchMs<650||(this._modality.next(function Tq(n){return 0===n.buttons||0===n.offsetX&&0===n.offsetY}(d)?"keyboard":"mouse"),this._mostRecentTarget=Op(d))},this._onTouchstart=d=>{!function Eq(n){const t=n.touches&&n.touches[0]||n.changedTouches&&n.changedTouches[0];return!(!t||-1!==t.identifier||null!=t.radiusX&&1!==t.radiusX||null!=t.radiusY&&1!==t.radiusY)}(d)?(this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=Op(d)):this._modality.next("keyboard")},this._options=Object.assign(Object.assign({},Iq),s),this.modalityDetected=this._modality.pipe(BL(1)),this.modalityChanged=this.modalityDetected.pipe(Lp()),e.isBrowser&&i.runOutsideAngular(()=>{r.addEventListener("keydown",this._onKeydown,Hb),r.addEventListener("mousedown",this._onMousedown,Hb),r.addEventListener("touchstart",this._onTouchstart,Hb)})}get mostRecentModality(){return this._modality.value}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,Hb),document.removeEventListener("mousedown",this._onMousedown,Hb),document.removeEventListener("touchstart",this._onTouchstart,Hb))}}return n.\u0275fac=function(e){return new(e||n)(Ue(Is),Ue(di),Ue(ui),Ue(Dq,8))},n.\u0275prov=tn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const Aq=new Dt("liveAnnouncerElement",{providedIn:"root",factory:function kq(){return null}}),Rq=new Dt("LIVE_ANNOUNCER_DEFAULT_OPTIONS");let t2=(()=>{class n{constructor(e,i,r,s){this._ngZone=i,this._defaultOptions=s,this._document=r,this._liveElement=e||this._createLiveElement()}announce(e,...i){const r=this._defaultOptions;let s,d;return 1===i.length&&"number"==typeof i[0]?d=i[0]:[s,d]=i,this.clear(),clearTimeout(this._previousTimeout),s||(s=r&&r.politeness?r.politeness:"polite"),null==d&&r&&(d=r.duration),this._liveElement.setAttribute("aria-live",s),this._ngZone.runOutsideAngular(()=>(this._currentPromise||(this._currentPromise=new Promise(m=>this._currentResolve=m)),clearTimeout(this._previousTimeout),this._previousTimeout=setTimeout(()=>{this._liveElement.textContent=e,"number"==typeof d&&(this._previousTimeout=setTimeout(()=>this.clear(),d)),this._currentResolve(),this._currentPromise=this._currentResolve=void 0},100),this._currentPromise))}clear(){this._liveElement&&(this._liveElement.textContent="")}ngOnDestroy(){var e,i;clearTimeout(this._previousTimeout),null===(e=this._liveElement)||void 0===e||e.remove(),this._liveElement=null,null===(i=this._currentResolve)||void 0===i||i.call(this),this._currentPromise=this._currentResolve=void 0}_createLiveElement(){const e="cdk-live-announcer-element",i=this._document.getElementsByClassName(e),r=this._document.createElement("div");for(let s=0;s<i.length;s++)i[s].remove();return r.classList.add(e),r.classList.add("cdk-visually-hidden"),r.setAttribute("aria-atomic","true"),r.setAttribute("aria-live","polite"),this._document.body.appendChild(r),r}}return n.\u0275fac=function(e){return new(e||n)(Ue(Aq,8),Ue(di),Ue(ui),Ue(Rq,8))},n.\u0275prov=tn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const Pq=new Dt("cdk-focus-monitor-default-options"),Kw=Pp({passive:!0,capture:!0});let Pa=(()=>{class n{constructor(e,i,r,s,d){this._ngZone=e,this._platform=i,this._inputModalityDetector=r,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=window.setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new Wt,this._rootNodeFocusAndBlurListener=m=>{for(let T=Op(m);T;T=T.parentElement)"focus"===m.type?this._onFocus(m,T):this._onBlur(m,T)},this._document=s,this._detectionMode=(null==d?void 0:d.detectionMode)||0}monitor(e,i=!1){const r=wm(e);if(!this._platform.isBrowser||1!==r.nodeType)return qn(null);const s=function H$(n){if(function U$(){if(null==qE){const n="undefined"!=typeof document?document.head:null;qE=!(!n||!n.createShadowRoot&&!n.attachShadow)}return qE}()){const t=n.getRootNode?n.getRootNode():null;if("undefined"!=typeof ShadowRoot&&ShadowRoot&&t instanceof ShadowRoot)return t}return null}(r)||this._getDocument(),d=this._elementInfo.get(r);if(d)return i&&(d.checkChildren=!0),d.subject;const m={checkChildren:i,subject:new Wt,rootNode:s};return this._elementInfo.set(r,m),this._registerGlobalListeners(m),m.subject}stopMonitoring(e){const i=wm(e),r=this._elementInfo.get(i);r&&(r.subject.complete(),this._setClasses(i),this._elementInfo.delete(i),this._removeGlobalListeners(r))}focusVia(e,i,r){const s=wm(e);s===this._getDocument().activeElement?this._getClosestElementsInfo(s).forEach(([m,y])=>this._originChanged(m,i,y)):(this._setOrigin(i),"function"==typeof s.focus&&s.focus(r))}ngOnDestroy(){this._elementInfo.forEach((e,i)=>this.stopMonitoring(i))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(e){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(e)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:e&&this._isLastInteractionFromInputLabel(e)?"mouse":"program"}_shouldBeAttributedToTouch(e){return 1===this._detectionMode||!(null==e||!e.contains(this._inputModalityDetector._mostRecentTarget))}_setClasses(e,i){e.classList.toggle("cdk-focused",!!i),e.classList.toggle("cdk-touch-focused","touch"===i),e.classList.toggle("cdk-keyboard-focused","keyboard"===i),e.classList.toggle("cdk-mouse-focused","mouse"===i),e.classList.toggle("cdk-program-focused","program"===i)}_setOrigin(e,i=!1){this._ngZone.runOutsideAngular(()=>{this._origin=e,this._originFromTouchInteraction="touch"===e&&i,0===this._detectionMode&&(clearTimeout(this._originTimeoutId),this._originTimeoutId=setTimeout(()=>this._origin=null,this._originFromTouchInteraction?650:1))})}_onFocus(e,i){const r=this._elementInfo.get(i),s=Op(e);!r||!r.checkChildren&&i!==s||this._originChanged(i,this._getFocusOrigin(s),r)}_onBlur(e,i){const r=this._elementInfo.get(i);!r||r.checkChildren&&e.relatedTarget instanceof Node&&i.contains(e.relatedTarget)||(this._setClasses(i),this._emitOrigin(r,null))}_emitOrigin(e,i){e.subject.observers.length&&this._ngZone.run(()=>e.subject.next(i))}_registerGlobalListeners(e){if(!this._platform.isBrowser)return;const i=e.rootNode,r=this._rootNodeFocusListenerCount.get(i)||0;r||this._ngZone.runOutsideAngular(()=>{i.addEventListener("focus",this._rootNodeFocusAndBlurListener,Kw),i.addEventListener("blur",this._rootNodeFocusAndBlurListener,Kw)}),this._rootNodeFocusListenerCount.set(i,r+1),1==++this._monitoredElementCount&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(Hi(this._stopInputModalityDetector)).subscribe(s=>{this._setOrigin(s,!0)}))}_removeGlobalListeners(e){const i=e.rootNode;if(this._rootNodeFocusListenerCount.has(i)){const r=this._rootNodeFocusListenerCount.get(i);r>1?this._rootNodeFocusListenerCount.set(i,r-1):(i.removeEventListener("focus",this._rootNodeFocusAndBlurListener,Kw),i.removeEventListener("blur",this._rootNodeFocusAndBlurListener,Kw),this._rootNodeFocusListenerCount.delete(i))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(e,i,r){this._setClasses(e,i),this._emitOrigin(r,i),this._lastFocusOrigin=i}_getClosestElementsInfo(e){const i=[];return this._elementInfo.forEach((r,s)=>{(s===e||r.checkChildren&&s.contains(e))&&i.push([s,r])}),i}_isLastInteractionFromInputLabel(e){const{_mostRecentTarget:i,mostRecentModality:r}=this._inputModalityDetector;if("mouse"!==r||!i||i===e||"INPUT"!==e.nodeName&&"TEXTAREA"!==e.nodeName||e.disabled)return!1;const s=e.labels;if(s)for(let d=0;d<s.length;d++)if(s[d].contains(i))return!0;return!1}}return n.\u0275fac=function(e){return new(e||n)(Ue(di),Ue(Is),Ue(Mq),Ue(ui,8),Ue(Pq,8))},n.\u0275prov=tn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),Oq=(()=>{class n{constructor(e,i){this._elementRef=e,this._focusMonitor=i,this._focusOrigin=null,this.cdkFocusChange=new on}get focusOrigin(){return this._focusOrigin}ngAfterViewInit(){const e=this._elementRef.nativeElement;this._monitorSubscription=this._focusMonitor.monitor(e,1===e.nodeType&&e.hasAttribute("cdkMonitorSubtreeFocus")).subscribe(i=>{this._focusOrigin=i,this.cdkFocusChange.emit(i)})}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._monitorSubscription&&this._monitorSubscription.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)(X(zn),X(Pa))},n.\u0275dir=Ft({type:n,selectors:[["","cdkMonitorElementFocus",""],["","cdkMonitorSubtreeFocus",""]],outputs:{cdkFocusChange:"cdkFocusChange"},exportAs:["cdkMonitorFocus"]}),n})();const n2="cdk-high-contrast-black-on-white",r2="cdk-high-contrast-white-on-black",rD="cdk-high-contrast-active";let o2=(()=>{class n{constructor(e,i){this._platform=e,this._document=i,this._breakpointSubscription=Wr(eD).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return 0;const e=this._document.createElement("div");e.style.backgroundColor="rgb(1,2,3)",e.style.position="absolute",this._document.body.appendChild(e);const i=this._document.defaultView||window,r=i&&i.getComputedStyle?i.getComputedStyle(e):null,s=(r&&r.backgroundColor||"").replace(/ /g,"");switch(e.remove(),s){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return 2;case"rgb(255,255,255)":case"rgb(255,250,239)":return 1}return 0}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const e=this._document.body.classList;e.remove(rD,n2,r2),this._hasCheckedHighContrastMode=!0;const i=this.getHighContrastMode();1===i?e.add(rD,n2):2===i&&e.add(rD,r2)}}}return n.\u0275fac=function(e){return new(e||n)(Ue(Is),Ue(ui))},n.\u0275prov=tn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),Cm=(()=>{class n{constructor(e){e._applyBodyHighContrastModeCssClasses()}}return n.\u0275fac=function(e){return new(e||n)(Ue(o2))},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({imports:[Xw]}),n})();class oD{attach(t){return this._attachedHost=t,t.attach(this)}detach(){let t=this._attachedHost;null!=t&&(this._attachedHost=null,t.detach())}get isAttached(){return null!=this._attachedHost}setAttachedHost(t){this._attachedHost=t}}class ud extends oD{constructor(t,e,i,r){super(),this.component=t,this.viewContainerRef=e,this.injector=i,this.componentFactoryResolver=r}}class Tm extends oD{constructor(t,e,i,r){super(),this.templateRef=t,this.viewContainerRef=e,this.context=i,this.injector=r}get origin(){return this.templateRef.elementRef}attach(t,e=this.context){return this.context=e,super.attach(t)}detach(){return this.context=void 0,super.detach()}}class Lq extends oD{constructor(t){super(),this.element=t instanceof zn?t.nativeElement:t}}class Cv{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(t){return t instanceof ud?(this._attachedPortal=t,this.attachComponentPortal(t)):t instanceof Tm?(this._attachedPortal=t,this.attachTemplatePortal(t)):this.attachDomPortal&&t instanceof Lq?(this._attachedPortal=t,this.attachDomPortal(t)):void 0}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(t){this._disposeFn=t}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}}class Fq extends Cv{constructor(t,e,i,r,s){super(),this.outletElement=t,this._componentFactoryResolver=e,this._appRef=i,this._defaultInjector=r,this.attachDomPortal=d=>{const m=d.element,y=this._document.createComment("dom-portal");m.parentNode.insertBefore(y,m),this.outletElement.appendChild(m),this._attachedPortal=d,super.setDisposeFn(()=>{y.parentNode&&y.parentNode.replaceChild(m,y)})},this._document=s}attachComponentPortal(t){const i=(t.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(t.component);let r;return t.viewContainerRef?(r=t.viewContainerRef.createComponent(i,t.viewContainerRef.length,t.injector||t.viewContainerRef.injector),this.setDisposeFn(()=>r.destroy())):(r=i.create(t.injector||this._defaultInjector||Xr.NULL),this._appRef.attachView(r.hostView),this.setDisposeFn(()=>{this._appRef.viewCount>0&&this._appRef.detachView(r.hostView),r.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(r)),this._attachedPortal=t,r}attachTemplatePortal(t){let e=t.viewContainerRef,i=e.createEmbeddedView(t.templateRef,t.context,{injector:t.injector});return i.rootNodes.forEach(r=>this.outletElement.appendChild(r)),i.detectChanges(),this.setDisposeFn(()=>{let r=e.indexOf(i);-1!==r&&e.remove(r)}),this._attachedPortal=t,i}dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(t){return t.hostView.rootNodes[0]}}let dd=(()=>{class n extends Cv{constructor(e,i,r){super(),this._componentFactoryResolver=e,this._viewContainerRef=i,this._isInitialized=!1,this.attached=new on,this.attachDomPortal=s=>{const d=s.element,m=this._document.createComment("dom-portal");s.setAttachedHost(this),d.parentNode.insertBefore(m,d),this._getRootNode().appendChild(d),this._attachedPortal=s,super.setDisposeFn(()=>{m.parentNode&&m.parentNode.replaceChild(d,m)})},this._document=r}get portal(){return this._attachedPortal}set portal(e){this.hasAttached()&&!e&&!this._isInitialized||(this.hasAttached()&&super.detach(),e&&super.attach(e),this._attachedPortal=e||null)}get attachedRef(){return this._attachedRef}ngOnInit(){this._isInitialized=!0}ngOnDestroy(){super.dispose(),this._attachedPortal=null,this._attachedRef=null}attachComponentPortal(e){e.setAttachedHost(this);const i=null!=e.viewContainerRef?e.viewContainerRef:this._viewContainerRef,s=(e.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(e.component),d=i.createComponent(s,i.length,e.injector||i.injector);return i!==this._viewContainerRef&&this._getRootNode().appendChild(d.hostView.rootNodes[0]),super.setDisposeFn(()=>d.destroy()),this._attachedPortal=e,this._attachedRef=d,this.attached.emit(d),d}attachTemplatePortal(e){e.setAttachedHost(this);const i=this._viewContainerRef.createEmbeddedView(e.templateRef,e.context,{injector:e.injector});return super.setDisposeFn(()=>this._viewContainerRef.clear()),this._attachedPortal=e,this._attachedRef=i,this.attached.emit(i),i}_getRootNode(){const e=this._viewContainerRef.element.nativeElement;return e.nodeType===e.ELEMENT_NODE?e:e.parentNode}}return n.\u0275fac=function(e){return new(e||n)(X(Kd),X(Qo),X(ui))},n.\u0275dir=Ft({type:n,selectors:[["","cdkPortalOutlet",""]],inputs:{portal:["cdkPortalOutlet","portal"]},outputs:{attached:"attached"},exportAs:["cdkPortalOutlet"],features:[Yt]}),n})(),wa=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({}),n})();class s2{constructor(t,e){this._parentInjector=t,this._customTokens=e}get(t,e){const i=this._customTokens.get(t);return void 0!==i?i:this._parentInjector.get(t,e)}}const Nq=["addListener","removeListener"],Bq=["addEventListener","removeEventListener"],zq=["on","off"];function fu(n,t,e,i){if(ze(e)&&(i=e,e=void 0),i)return fu(n,t,e).pipe(GT(i));const[r,s]=function Uq(n){return ze(n.addEventListener)&&ze(n.removeEventListener)}(n)?Bq.map(d=>m=>n[d](t,m,e)):function Vq(n){return ze(n.addListener)&&ze(n.removeListener)}(n)?Nq.map(a2(n,t)):function jq(n){return ze(n.on)&&ze(n.off)}(n)?zq.map(a2(n,t)):[];if(!r&&Re(n))return Gn(d=>fu(d,t,e))(Pt(n));if(!r)throw new TypeError("Invalid event target");return new Mt(d=>{const m=(...y)=>d.next(1<y.length?y:y[0]);return r(m),()=>s(m)})}function a2(n,t){return e=>i=>n[e](t,i)}const Tv={schedule(n){let t=requestAnimationFrame,e=cancelAnimationFrame;const{delegate:i}=Tv;i&&(t=i.requestAnimationFrame,e=i.cancelAnimationFrame);const r=t(s=>{e=void 0,n(s)});return new he(()=>null==e?void 0:e(r))},requestAnimationFrame(...n){const{delegate:t}=Tv;return((null==t?void 0:t.requestAnimationFrame)||requestAnimationFrame)(...n)},cancelAnimationFrame(...n){const{delegate:t}=Tv;return((null==t?void 0:t.cancelAnimationFrame)||cancelAnimationFrame)(...n)},delegate:void 0};new class $q extends QE{flush(t){this._active=!0;const e=this._scheduled;this._scheduled=void 0;const{actions:i}=this;let r;t=t||i.shift();do{if(r=t.execute(t.state,t.delay))break}while((t=i[0])&&t.id===e&&i.shift());if(this._active=!1,r){for(;(t=i[0])&&t.id===e&&i.shift();)t.unsubscribe();throw r}}}(class Hq extends KE{constructor(t,e){super(t,e),this.scheduler=t,this.work=e}requestAsyncId(t,e,i=0){return null!==i&&i>0?super.requestAsyncId(t,e,i):(t.actions.push(this),t._scheduled||(t._scheduled=Tv.requestAnimationFrame(()=>t.flush(void 0))))}recycleAsyncId(t,e,i=0){var r;if(null!=i?i>0:this.delay>0)return super.recycleAsyncId(t,e,i);const{actions:s}=t;null!=e&&(null===(r=s[s.length-1])||void 0===r?void 0:r.id)!==e&&(Tv.cancelAnimationFrame(e),t._scheduled=void 0)}});let sD,Gq=1;const Qw={};function l2(n){return n in Qw&&(delete Qw[n],!0)}const Wq={setImmediate(n){const t=Gq++;return Qw[t]=!0,sD||(sD=Promise.resolve()),sD.then(()=>l2(t)&&n()),t},clearImmediate(n){l2(n)}},{setImmediate:Xq,clearImmediate:Zq}=Wq,Jw={setImmediate(...n){const{delegate:t}=Jw;return((null==t?void 0:t.setImmediate)||Xq)(...n)},clearImmediate(n){const{delegate:t}=Jw;return((null==t?void 0:t.clearImmediate)||Zq)(n)},delegate:void 0};new class Kq extends QE{flush(t){this._active=!0;const e=this._scheduled;this._scheduled=void 0;const{actions:i}=this;let r;t=t||i.shift();do{if(r=t.execute(t.state,t.delay))break}while((t=i[0])&&t.id===e&&i.shift());if(this._active=!1,r){for(;(t=i[0])&&t.id===e&&i.shift();)t.unsubscribe();throw r}}}(class Yq extends KE{constructor(t,e){super(t,e),this.scheduler=t,this.work=e}requestAsyncId(t,e,i=0){return null!==i&&i>0?super.requestAsyncId(t,e,i):(t.actions.push(this),t._scheduled||(t._scheduled=Jw.setImmediate(t.flush.bind(t,void 0))))}recycleAsyncId(t,e,i=0){var r;if(null!=i?i>0:this.delay>0)return super.recycleAsyncId(t,e,i);const{actions:s}=t;null!=e&&(null===(r=s[s.length-1])||void 0===r?void 0:r.id)!==e&&(Jw.clearImmediate(e),t._scheduled=void 0)}});function aD(n=0,t,e=nq){let i=-1;return null!=t&&(fo(t)?e=t:i=t),new Mt(r=>{let s=function eG(n){return n instanceof Date&&!isNaN(n)}(n)?+n-e.now():n;s<0&&(s=0);let d=0;return e.schedule(function(){r.closed||(r.next(d++),0<=i?this.schedule(void 0,i):r.complete())},s)})}function c2(n,t=Gw){return function Jq(n){return Cn((t,e)=>{let i=!1,r=null,s=null,d=!1;const m=()=>{if(null==s||s.unsubscribe(),s=null,i){i=!1;const T=r;r=null,e.next(T)}d&&e.complete()},y=()=>{s=null,d&&e.complete()};t.subscribe(bt(e,T=>{i=!0,r=T,s||Pt(n(T)).subscribe(s=bt(e,m,y))},()=>{d=!0,(!i||!s||s.closed)&&e.complete()}))})}(()=>aD(n,t))}const tG=new Dt("cdk-dir-doc",{providedIn:"root",factory:function nG(){return Wr(ui)}}),iG=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;let Fp=(()=>{class n{constructor(e){if(this.value="ltr",this.change=new on,e){const r=e.documentElement?e.documentElement.dir:null;this.value=function rG(n){const t=(null==n?void 0:n.toLowerCase())||"";return"auto"===t&&"undefined"!=typeof navigator&&(null==navigator?void 0:navigator.language)?iG.test(navigator.language)?"rtl":"ltr":"rtl"===t?"rtl":"ltr"}((e.body?e.body.dir:null)||r||"ltr")}}ngOnDestroy(){this.change.complete()}}return n.\u0275fac=function(e){return new(e||n)(Ue(tG,8))},n.\u0275prov=tn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),eS=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({}),n})(),u2=(()=>{class n{constructor(e,i,r){this._ngZone=e,this._platform=i,this._scrolled=new Wt,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=r}register(e){this.scrollContainers.has(e)||this.scrollContainers.set(e,e.elementScrolled().subscribe(()=>this._scrolled.next(e)))}deregister(e){const i=this.scrollContainers.get(e);i&&(i.unsubscribe(),this.scrollContainers.delete(e))}scrolled(e=20){return this._platform.isBrowser?new Mt(i=>{this._globalSubscription||this._addGlobalListener();const r=e>0?this._scrolled.pipe(c2(e)).subscribe(i):this._scrolled.subscribe(i);return this._scrolledCount++,()=>{r.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):qn()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((e,i)=>this.deregister(i)),this._scrolled.complete()}ancestorScrolled(e,i){const r=this.getAncestorScrollContainers(e);return this.scrolled(i).pipe(Rr(s=>!s||r.indexOf(s)>-1))}getAncestorScrollContainers(e){const i=[];return this.scrollContainers.forEach((r,s)=>{this._scrollableContainsElement(s,e)&&i.push(s)}),i}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(e,i){let r=wm(i),s=e.getElementRef().nativeElement;do{if(r==s)return!0}while(r=r.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>fu(this._getWindow().document,"scroll").subscribe(()=>this._scrolled.next()))}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}}return n.\u0275fac=function(e){return new(e||n)(Ue(di),Ue(Is),Ue(ui,8))},n.\u0275prov=tn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),mu=(()=>{class n{constructor(e,i,r){this._platform=e,this._change=new Wt,this._changeListener=s=>{this._change.next(s)},this._document=r,i.runOutsideAngular(()=>{if(e.isBrowser){const s=this._getWindow();s.addEventListener("resize",this._changeListener),s.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){const e=this._getWindow();e.removeEventListener("resize",this._changeListener),e.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();const e={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),e}getViewportRect(){const e=this.getViewportScrollPosition(),{width:i,height:r}=this.getViewportSize();return{top:e.top,left:e.left,bottom:e.top+r,right:e.left+i,height:r,width:i}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};const e=this._document,i=this._getWindow(),r=e.documentElement,s=r.getBoundingClientRect();return{top:-s.top||e.body.scrollTop||i.scrollY||r.scrollTop||0,left:-s.left||e.body.scrollLeft||i.scrollX||r.scrollLeft||0}}change(e=20){return e>0?this._change.pipe(c2(e)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){const e=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:e.innerWidth,height:e.innerHeight}:{width:0,height:0}}}return n.\u0275fac=function(e){return new(e||n)(Ue(Is),Ue(di),Ue(ui,8))},n.\u0275prov=tn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),Em=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({}),n})(),lD=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({imports:[eS,Em,eS,Em]}),n})();const aG=["*",[["sbb-option"],["ng-container"],["sbb-option-hint"],["sbb-autocomplete-hint"]]],lG=["*","sbb-option, ng-container, sbb-option-hint, sbb-autocomplete-hint"];function cG(n,t){if(1&n&&bn(0,"sbb-pseudo-checkbox",2),2&n){const e=rn();rt("disabled",e.disabled)("state",e.selected?"checked":"unchecked")}}function uG(n,t){if(1&n&&(le(0,"span",3),Ye(1),pe()),2&n){const e=rn();Fe(1),Vr("(",e.group.label,")")}}const dG=["*"],hG=(new iu("14.1.7"),"undefined"!=typeof globalThis&&globalThis),pG="undefined"!=typeof window&&window,fG="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,cD=hG||"undefined"!=typeof global&&global||pG||fG,uD=function(n,...t){if(uD.translate){const i=uD.translate(n,t);n=i[0],t=i[1]}let e=f2(n[0],n.raw[0]);for(let i=1;i<n.length;i++)e+=t[i-1]+f2(n[i],n.raw[i]);return e};function f2(n,t){return":"===t.charAt(0)?n.substring(function mG(n,t){for(let e=1,i=1;e<n.length;e++,i++)if("\\"===t[i])i++;else if(":"===n[e])return e;throw new Error(`Unterminated $localize metadata block in "${t}".`)}(n,t)+1):n}const dD=new _a("standard");function Dm(n){return class extends n{constructor(...t){super(...t),this.variant=dD}get variantSnapshot(){return dD.value}}}const bG=new Dt("sbb-sanity-checks",{providedIn:"root",factory:function gG(){return!0}});let nr=(()=>{class n{constructor(e,i,r){this._sanityChecks=i,this._document=r,this._hasDoneGlobalChecks=!1,dD.next(this._document.documentElement.classList.contains("sbb-lean")?"lean":"standard"),e._applyBodyHighContrastModeCssClasses(),function _G(){"function"!=typeof cD.$localize&&(cD.$localize=Object.assign(uD,cD.$localize))}(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(e){return!GE()&&("boolean"==typeof this._sanityChecks?this._sanityChecks:!!this._sanityChecks[e])}}return n.\u0275fac=function(e){return new(e||n)(Ue(o2),Ue(bG,8),Ue(ui))},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({}),n})();function rl(n){return class extends n{constructor(...t){super(...t),this._disabled=!1}get disabled(){return this._disabled}set disabled(t){this._disabled=ii(t)}}}function tS(n){return class extends n{constructor(...t){super(...t),this.errorState=!1}updateErrorState(){const t=this.errorState,s=(this.errorStateMatcher||this._defaultErrorStateMatcher).isErrorState(this.ngControl?this.ngControl.control:null,this._parentFormGroup||this._parentForm);s!==t&&(this.errorState=s,this.stateChanges.next())}}}function m2(n){return class extends n{constructor(...t){super(...t),this._isInitialized=!1,this._pendingSubscribers=[],this.initialized=new Mt(e=>{this._isInitialized?this._notifySubscriber(e):this._pendingSubscribers.push(e)})}_markInitialized(){this._isInitialized=!0,this._pendingSubscribers.forEach(this._notifySubscriber),this._pendingSubscribers=null}_notifySubscriber(t){t.next(),t.complete()}}}function $b(n,t=0){return class extends n{constructor(...e){super(...e),this._tabIndex=t,this.defaultTabIndex=t}get tabIndex(){return this.disabled?-1:this._tabIndex}set tabIndex(e){this._tabIndex=null!=e?wh(e):this.defaultTabIndex}}}class Np{deserialize(t){return null==t||this.isDateInstance(t)&&this.isValid(t)?t:this.invalid()}setLocale(t){this._locale=t}compareDate(t,e){return this.getYear(t)-this.getYear(e)||this.getMonth(t)-this.getMonth(e)||this.getDate(t)-this.getDate(e)}sameDate(t,e){if(t&&e){const i=this.isValid(t),r=this.isValid(e);return i&&r?!this.compareDate(t,e):i===r}return t===e}clampDate(t,e,i){return e&&this.compareDate(t,e)<0?e:i&&this.compareDate(t,i)>0?i:t}}const nS=new Dt("sbb-date-formats"),yG={dateInput:"EEEEEE, dd.MM.yyyy",dateInputPure:"dd.MM.yyyy",dateA11yLabel:"dd MM yyyy"},g2=new Dt("SBB_DATEPICKER_2DIGIT_YEAR_PIVOT"),vG=/^\d{4}-\d{2}-\d{2}(?:T\d{2}:\d{2}:\d{2}(?:\.\d+)?(?:Z|(?:(?:\+|-)\d{2}:\d{2}))?)?$/;function hD(n,t){const e=Array(n);for(let i=0;i<n;i++)e[i]=t(i);return e}let b2=(()=>{class n extends Np{constructor(e,i){super(),this._locale=e,this._titleCasePipe=new zk,this._datePipe=new Vk(e),this._yearPivot="number"==typeof i?i:(new Date).getFullYear()-1975}getYear(e){return e.getFullYear()}getMonth(e){return e.getMonth()}getDate(e){return e.getDate()}getDayOfWeek(e){return e.getDay()}getMonthName(e){return this._datePipe.transform(e,"LLLL")}getMonthNames(e){let i;switch(e){case"long":i="LLLL";break;case"narrow":i="LLLLL";break;default:i="LLL"}return hD(12,r=>this._datePipe.transform(new Date(2017,r,1),i))}getDateNames(){return hD(31,e=>this._datePipe.transform(new Date(2017,0,e+1),"d"))}getDayOfWeekNames(e){let i;switch(e){case"long":i="EEEE";break;case"narrow":i="EEEEE";break;default:i="EEE"}return hD(7,r=>this._datePipe.transform(new Date(2017,0,r+1),i))}getYearName(e){return this._datePipe.transform(e,"yyyy")}getFirstDayOfWeek(){return 1}getNumDaysInMonth(e){const i=new Date(0);return i.setFullYear(e.getFullYear(),e.getMonth()+1,0),i.setHours(0,0,0,0),i.getDate()}clone(e){return new Date(e.valueOf())}createDate(e,i,r){if(i<0||i>11)throw Error(`Invalid month index "${i}". Month index has to be between 0 and 11.`);if(r<1)throw Error(`Invalid date "${r}". Date has to be greater than 0.`);const s=this._createDateWithOverflow(e,i,r);if(s.getMonth()!==i)throw Error(`Invalid date "${r}" for month with index "${i}".`);return s}today(){const e=new Date;return e.setHours(0,0,0,0),e}parse(e){return"number"==typeof e?new Date(e):"string"==typeof e?this._parseStringDate(e):null}format(e,i){if(!this.isValid(e))throw Error("NativeDateAdapter: Cannot format invalid date.");return this._titleCasePipe.transform(this._datePipe.transform(e,i))}addCalendarYears(e,i){return this.addCalendarMonths(e,12*i)}addCalendarMonths(e,i){const r=e.getMonth()+i,s=new Date(0);s.setFullYear(e.getFullYear(),r,1),s.setHours(0,0,0,0);const d=this.getNumDaysInMonth(s),m=this.clone(e);return m.setMonth(r,Math.min(d,e.getDate())),m}addCalendarDays(e,i){const r=this.clone(e);return r.setDate(r.getDate()+i),r}toIso8601(e){return this._datePipe.transform(e,"yyyy-MM-dd")}deserialize(e){if("string"==typeof e){if(!e)return null;if(vG.test(e)){const i=new Date(e);if(this.isValid(i))return i}}return super.deserialize(e)}isDateInstance(e){return e instanceof Date}isValid(e){return!isNaN(e.valueOf())}invalid(){return new Date(NaN)}_parseStringDate(e){const i=/^(\w+,[ ]?)?(\d+)\.(\d+)\.(\d+)$/.exec(e);if(!i)return null;const r=this._createDateWithOverflow(+i[4],+i[3]-1,+i[2]);return this._normalizeYear(r)}_normalizeYear(e){if(e.getFullYear()<0||e.getFullYear()>=100)return e;const i=e.getFullYear()<=this._yearPivot?2e3:1900;return new Date(e.getFullYear()+i,e.getMonth(),e.getDate())}_createDateWithOverflow(e,i,r){const s=new Date(e,i,r);return e>=0&&e<100&&s.setFullYear(this.getYear(s)-1900),s}}return n.\u0275fac=function(e){return new(e||n)(Ue(Ql),Ue(g2,8))},n.\u0275prov=tn({token:n,factory:n.\u0275fac}),n})(),pD=(()=>{class n{isErrorState(e,i){return!!(e&&e.invalid&&(e.touched||i&&i.submitted))}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=tn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const iS=new Dt("SBB_OPTION_PARENT_COMPONENT"),xG=rl(class{});let wG=0;const _2=new Dt("SbbOptgroup");let fD=(()=>{class n extends xG{constructor(e){var i;super(),this._labelId="sbb-optgroup-label-"+wG++,this._inert=null!==(i=null==e?void 0:e.inertGroups)&&void 0!==i&&i}}return n.\u0275fac=function(e){return new(e||n)(X(iS,8))},n.\u0275cmp=On({type:n,selectors:[["sbb-optgroup"]],hostAttrs:[1,"sbb-optgroup","sbb-menu-group"],hostVars:5,hostBindings:function(e,i){2&e&&(Sn("role",i._inert?null:"group")("aria-disabled",i._inert?null:i.disabled.toString())("aria-labelledby",i._inert?null:i._labelId),Ui("sbb-disabled",i.disabled))},inputs:{disabled:"disabled",label:"label"},exportAs:["sbbOptgroup"],features:[ni([{provide:_2,useExisting:n}]),Yt],ngContentSelectors:lG,decls:4,vars:2,consts:[[1,"sbb-label","sbb-optgroup-label",3,"id"]],template:function(e,i){1&e&&($o(aG),le(0,"label",0),Ye(1),$r(2),pe(),$r(3,1)),2&e&&(rt("id",i._labelId),Fe(1),Vr("",i.label," "))},encapsulation:2,changeDetection:0}),n})(),SG=(()=>{class n{constructor(){this.state="unchecked",this.disabled=!1}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=On({type:n,selectors:[["sbb-pseudo-checkbox"]],hostAttrs:[1,"sbb-pseudo-checkbox"],hostVars:6,hostBindings:function(e,i){2&e&&Ui("sbb-selection-disabled",i.disabled)("sbb-selection-checked","checked"===i.state)("sbb-selection-indeterminate","indeterminate"===i.state)},inputs:{state:"state",disabled:"disabled"},decls:4,vars:0,consts:[[1,"sbb-selection-container"],[1,"sbb-selection-container-checked"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","focusable","false"],["fill","none","fill-rule","evenodd","stroke","#000","stroke-width","1","points","6 12 10 16 19 7.01"]],template:function(e,i){1&e&&(le(0,"div",0)(1,"span",1),B(),le(2,"svg",2),bn(3,"polyline",3),pe()()())},encapsulation:2,changeDetection:0}),n})(),CG=0;class y2{constructor(t,e=!1){this.source=t,this.isUserInput=e}}let Ev=(()=>{class n{constructor(e,i,r,s,d){this._element=e,this._document=i,this._changeDetectorRef=r,this._parent=s,this.group=d,this._selected=!1,this._active=!1,this._disabled=!1,this._mostRecentViewValue="",this._highlighted=!1,this.id="sbb-option-"+CG++,this.onSelectionChange=new on,this._stateChanges=new Wt}get multiple(){return this._parent&&this._parent.multiple}get selected(){return this._selected}get disabled(){return this.group&&this.group.disabled||this._disabled}set disabled(e){this._disabled=ii(e),this._changeDetectorRef.markForCheck()}get active(){return this._active}get viewValue(){return(this._getHostElement().textContent||"").trim()}select(){this.selected||(this._selected=!0,this._changeDetectorRef.markForCheck(),this._emitSelectionChangeEvent())}deselect(){this._selected&&(this._selected=!1,this._changeDetectorRef.markForCheck(),this._emitSelectionChangeEvent())}focus(e,i){const r=this._getHostElement();"function"==typeof r.focus&&r.focus(i)}setActiveStyles(){this.active||(this._active=!0,this._changeDetectorRef.markForCheck())}setInactiveStyles(){this.active&&(this._active=!1,this._changeDetectorRef.markForCheck())}getLabel(){return this.viewValue}_handleKeydown(e){(13===e.keyCode||32===e.keyCode)&&!xa(e)&&(this._selectViaInteraction(),e.preventDefault())}_selectViaInteraction(){this.disabled||(this._selected=!this.multiple||!this.selected,this._changeDetectorRef.markForCheck(),this._emitSelectionChangeEvent(!0))}_getAriaSelected(){return this.selected||!this.multiple&&null}_getTabIndex(){return this.disabled?"-1":"0"}_getHostElement(){return this._element.nativeElement}ngAfterViewChecked(){if(this._selected){const e=this.viewValue;e!==this._mostRecentViewValue&&(this._mostRecentViewValue=e,this._stateChanges.next())}}ngOnDestroy(){this._stateChanges.complete()}_highlight(e,i){if(void 0===this._originalInnerHtml)this._originalInnerHtml=this._element.nativeElement.innerHTML;else{if(e===this._highlightValue)return;this._highlighted&&(this._element.nativeElement.innerHTML=this._originalInnerHtml,this._highlighted=!1)}if(this._highlightValue=e,e&&this._originalInnerHtml){const r=i||(y=>y),s=(e=r(e)).replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),d=new RegExp(`${s}+`,"i"),m=this._findAllTextNodesWithMatch(d,r);m.forEach(y=>this._highlightNode(y,d,r)),this._highlighted=!!m.length}}_findAllTextNodesWithMatch(e,i,r=this._element.nativeElement){const s=[],d=r.childNodes;for(let m=0;m<d.length;m++){const y=d[m];3===y.nodeType&&e.test(i(y.textContent||""))?s.push(y):y.childNodes.length&&s.push(...this._findAllTextNodesWithMatch(e,i,y))}return s}_highlightNode(e,i,r){const s=[],d=this._document;i.lastIndex=0;let y,m=e.textContent||"";do{if(y=r(m).match(i),!y){s.push(d.createTextNode(m));continue}y.index&&(s.push(d.createTextNode(m.substring(0,y.index))),m=m.substring(y.index));const M=d.createElement("strong");M.textContent=m.substring(0,y[0].length),s.push(M),m=m.substring(y[0].length)}while(y);const T=e.parentNode;s.forEach(M=>T.insertBefore(M,e)),T.removeChild(e)}_emitSelectionChangeEvent(e=!1){this.onSelectionChange.emit(new y2(this,e))}}return n.\u0275fac=function(e){return new(e||n)(X(zn),X(ui),X(kr),X(iS,8),X(_2,8))},n.\u0275cmp=On({type:n,selectors:[["sbb-option"]],hostAttrs:["role","option",1,"sbb-option","sbb-menu-item","sbb-link-reset"],hostVars:12,hostBindings:function(e,i){1&e&&nn("keydown",function(s){return i._handleKeydown(s)})("click",function(){return i._selectViaInteraction()}),2&e&&(Mc("id",i.id),Sn("tabindex",i._getTabIndex())("aria-selected",i._getAriaSelected())("aria-disabled",i.disabled.toString()),Ui("sbb-selected",i.selected)("sbb-option-multiple",i.multiple)("sbb-focused",i.active)("sbb-disabled",i.disabled))},inputs:{value:"value",id:"id",disabled:"disabled"},outputs:{onSelectionChange:"onSelectionChange"},exportAs:["sbbOption"],ngContentSelectors:dG,decls:3,vars:2,consts:[[3,"disabled","state",4,"ngIf"],["class","cdk-visually-hidden",4,"ngIf"],[3,"disabled","state"],[1,"cdk-visually-hidden"]],template:function(e,i){1&e&&($o(),Jt(0,cG,1,2,"sbb-pseudo-checkbox",0),$r(1),Jt(2,uG,2,1,"span",1)),2&e&&(rt("ngIf",i.multiple),Fe(2),rt("ngIf",i.group&&i.group._inert))},dependencies:[js,SG],styles:[".sbb-option.sbb-menu-item{cursor:default}.sbb-pseudo-checkbox{display:inline-block;margin-right:calc(0.5333333333rem * var(--sbb-scaling-factor));margin-bottom:calc(-0.3rem * var(--sbb-scaling-factor));overflow:hidden;line-height:0}.sbb-pseudo-checkbox .sbb-selection-container{margin:0}"],encapsulation:2,changeDetection:0}),n})();function v2(n,t,e,i){return n<e?n:n+t>e+i?Math.max(0,n-i+t):e}let EG=0,DG=(()=>{class n{constructor(){this.id="sbb-option-hint-"+EG++}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=Ft({type:n,selectors:[["sbb-option-hint"]],hostAttrs:[1,"sbb-option-hint","sbb-label"],hostVars:1,hostBindings:function(e,i){2&e&&Sn("id",i.id)}}),n})(),rS=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({imports:[Tr,nr]}),n})();const IG=["*"];let oS;function Dv(n){var t;return(null===(t=function MG(){if(void 0===oS&&(oS=null,"undefined"!=typeof window)){const n=window;void 0!==n.trustedTypes&&(oS=n.trustedTypes.createPolicy("sbb-esta#angular",{createHTML:t=>t}))}return oS}())||void 0===t?void 0:t.createHTML(n))||n}function x2(n){return Error(`Unable to find icon with the name "${n}"`)}function w2(n){return Error(`The URL provided to SbbIconRegistry was not trusted as a resource URL via Angular's DomSanitizer. Attempted URL was "${n}".`)}function S2(n){return Error(`The literal provided to SbbIconRegistry was not trusted as safe HTML by Angular's DomSanitizer. Attempted literal was "${n}".`)}class Bp{constructor(t,e,i){this.url=t,this.svgText=e,this.options=i}}let kG=(()=>{class n{constructor(e,i,r,s){this._httpClient=e,this._sanitizer=i,this._errorHandler=s,this._svgIconConfigs=new Map,this._iconSetConfigs=new Map,this._cachedIconsByUrl=new Map,this._inProgressUrlFetches=new Map,this._fontCssClassesByAlias=new Map,this._resolvers=[],this._defaultFontSetClass=["sbb-icons"],this._sbbCdnSupportedNamespaces=["kom","fpl"],this._document=r}addSvgIcon(e,i,r){return this.addSvgIconInNamespace("",e,i,r)}addSvgIconLiteral(e,i,r){return this.addSvgIconLiteralInNamespace("",e,i,r)}addSvgIconInNamespace(e,i,r,s){return this._addSvgIconConfig(e,i,new Bp(r,null,s))}addSvgIconResolver(e){return this._resolvers.push(e),this}addSvgIconLiteralInNamespace(e,i,r,s){const d=this._sanitizer.sanitize(fr.HTML,r);if(!d)throw S2(r);const m=Dv(d);return this._addSvgIconConfig(e,i,new Bp("",m,s))}addSvgIconSet(e,i){return this.addSvgIconSetInNamespace("",e,i)}addSvgIconSetLiteral(e,i){return this.addSvgIconSetLiteralInNamespace("",e,i)}addSvgIconSetInNamespace(e,i,r){return this._addSvgIconSetConfig(e,new Bp(i,null,r))}addSvgIconSetLiteralInNamespace(e,i,r){const s=this._sanitizer.sanitize(fr.HTML,i);if(!s)throw S2(i);const d=Dv(s);return this._addSvgIconSetConfig(e,new Bp("",d,r))}registerFontClassAlias(e,i=e){return this._fontCssClassesByAlias.set(e,i),this}classNameForFontAlias(e){return this._fontCssClassesByAlias.get(e)||e}setDefaultFontSetClass(...e){return this._defaultFontSetClass=e,this}getDefaultFontSetClass(){return this._defaultFontSetClass}getSvgIconFromUrl(e){const i=this._sanitizer.sanitize(fr.RESOURCE_URL,e);if(!i)throw w2(e);const r=this._cachedIconsByUrl.get(i);return r?qn(sS(r)):this._loadSvgIconFromConfig(new Bp(e,null)).pipe(Jo(s=>this._cachedIconsByUrl.set(i,s)),$t(s=>sS(s)))}getNamedSvgIcon(e,i=""){const r=C2(i,e);let s=this._svgIconConfigs.get(r);if(s)return this._getSvgFromConfig(s);if(s=this._getIconConfigFromResolvers(i,e),s)return this._svgIconConfigs.set(r,s),this._getSvgFromConfig(s);const d=this._iconSetConfigs.get(i);return d?this._getSvgFromIconSetConfigs(e,d):kb(x2(r))}ngOnDestroy(){this._resolvers=[],this._svgIconConfigs.clear(),this._iconSetConfigs.clear(),this._cachedIconsByUrl.clear()}_getSvgFromConfig(e){return e.svgText?qn(sS(this._svgElementFromConfig(e))):this._loadSvgIconFromConfig(e).pipe($t(i=>sS(i)))}_getSvgFromIconSetConfigs(e,i){const r=this._extractIconWithNameFromAnySet(e,i);return r?qn(r):_P(i.filter(d=>!d.svgText).map(d=>this._loadSvgIconSetFromConfig(d).pipe(bh(m=>{const T=`Loading icon set URL: ${this._sanitizer.sanitize(fr.RESOURCE_URL,d.url)} failed: ${m.message}`;return this._errorHandler.handleError(new Error(T)),qn(null)})))).pipe($t(()=>{const d=this._extractIconWithNameFromAnySet(e,i);if(!d)throw x2(e);return d}))}_extractIconWithNameFromAnySet(e,i){for(let r=i.length-1;r>=0;r--){const s=i[r];if(s.svgText&&s.svgText.toString().indexOf(e)>-1){const d=this._svgElementFromConfig(s),m=this._extractSvgIconFromSet(d,e,s.options);if(m)return m}}return null}_loadSvgIconFromConfig(e){return this._fetchIcon(e).pipe(Jo(i=>e.svgText=i),$t(()=>this._svgElementFromConfig(e)))}_loadSvgIconSetFromConfig(e){return e.svgText?qn(null):this._fetchIcon(e).pipe(Jo(i=>e.svgText=i))}_extractSvgIconFromSet(e,i,r){const s=e.querySelector(`[id="${i}"]`);if(!s)return null;const d=s.cloneNode(!0);if(d.removeAttribute("id"),"svg"===d.nodeName.toLowerCase())return this._setSvgAttributes(d,r);if("symbol"===d.nodeName.toLowerCase())return this._setSvgAttributes(this._toSvgElement(d),r);const m=this._svgElementFromString(Dv("<svg></svg>"));return m.appendChild(d),this._setSvgAttributes(m,r)}_svgElementFromString(e){const i=this._document.createElement("DIV");i.innerHTML=e;const r=i.querySelector("svg");if(!r)throw Error("<svg> tag not found");return r}_toSvgElement(e){const i=this._svgElementFromString(Dv("<svg></svg>")),r=e.attributes;for(let s=0;s<r.length;s++){const{name:d,value:m}=r[s];"id"!==d&&i.setAttribute(d,m)}for(let s=0;s<e.childNodes.length;s++)e.childNodes[s].nodeType===this._document.ELEMENT_NODE&&i.appendChild(e.childNodes[s].cloneNode(!0));return i}_setSvgAttributes(e,i){return e.setAttribute("fit",""),e.setAttribute("preserveAspectRatio","xMidYMid meet"),e.setAttribute("focusable","false"),i&&i.viewBox&&e.setAttribute("viewBox",i.viewBox),e}_fetchIcon(e){var i;const{url:r,options:s}=e,d=null!==(i=null==s?void 0:s.withCredentials)&&void 0!==i&&i;if(!this._httpClient)throw function AG(){return Error("Could not find HttpClient provider for use with Sbb Angular icons. Please include the HttpClientModule from @angular/common/http in your app imports.")}();if(null==r)throw Error(`Cannot fetch icon from URL "${r}".`);const m=this._sanitizer.sanitize(fr.RESOURCE_URL,r);if(!m)throw w2(r);const y=this._inProgressUrlFetches.get(m);if(y)return y;const T=this._httpClient.get(m,{responseType:"text",withCredentials:d}).pipe($t(M=>Dv(M)),ww(()=>this._inProgressUrlFetches.delete(m)),mn());return this._inProgressUrlFetches.set(m,T),T}_addSvgIconConfig(e,i,r){return this._svgIconConfigs.set(C2(e,i),r),this}_addSvgIconSetConfig(e,i){const r=this._iconSetConfigs.get(e);return r?r.push(i):this._iconSetConfigs.set(e,[i]),this}_svgElementFromConfig(e){if(!e.svgElement){const i=this._svgElementFromString(e.svgText);this._setSvgAttributes(i,e.options),e.svgElement=i}return e.svgElement}_getIconConfigFromResolvers(e,i){for(let r=0;r<this._resolvers.length;r++){const s=this._resolvers[r](i,e);if(s)return RG(s)?new Bp(s.url,null,s.options):new Bp(s,null)}if(-1!==this._sbbCdnSupportedNamespaces.indexOf(e)){const r=this._sanitizer.bypassSecurityTrustResourceUrl(`https://icons.app.sbb.ch/${e}/${i}.svg`);return new Bp(r,null)}}}return n.\u0275fac=function(e){return new(e||n)(Ue(dP,8),Ue(fR),Ue(ui,8),Ue(wl))},n.\u0275prov=tn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function sS(n){return n.cloneNode(!0)}function C2(n,t){return n+":"+t}function RG(n){return!(!n.url||!n.options)}const PG=new Dt("sbb-icon-location",{providedIn:"root",factory:function OG(){const n=Wr(ui),t=n?n.location:null;return{getPathname:()=>t?t.pathname+t.search:""}}}),T2=["clip-path","color-profile","src","cursor","fill","filter","marker","marker-start","marker-mid","marker-end","mask","stroke"],LG=T2.map(n=>`[${n}]`).join(", "),FG=/^url\(['"]?#(.*?)['"]?\)$/;let ol=(()=>{class n{constructor(e,i,r,s,d){this._elementRef=e,this._iconRegistry=i,this._location=s,this._errorHandler=d,this._inline=!1,this._previousFontSetClass=[],this._currentIconFetch=he.EMPTY,r||this._elementRef.nativeElement.setAttribute("aria-hidden","true")}get inline(){return this._inline}set inline(e){this._inline=ii(e)}get svgIcon(){return this._svgIcon}set svgIcon(e){e!==this._svgIcon&&(e?this._updateSvgIcon(e):this._svgIcon&&this._clearSvgElement(),this._svgIcon=e)}get fontSet(){return this._fontSet}set fontSet(e){const i=this._cleanupFontValue(e);i!==this._fontSet&&(this._fontSet=i,this._updateFontIconClasses())}get fontIcon(){return this._fontIcon}set fontIcon(e){const i=this._cleanupFontValue(e);i!==this._fontIcon&&(this._fontIcon=i,this._updateFontIconClasses())}_splitIconName(e){if(!e)return["",""];const i=e.split(":");switch(i.length){case 1:return["",i[0]];case 2:return i;default:throw Error(`Invalid icon name: "${e}"`)}}ngOnInit(){this._updateFontIconClasses()}ngAfterViewChecked(){const e=this._elementsWithExternalReferences;if(e&&e.size){const i=this._location.getPathname();i!==this._previousPath&&(this._previousPath=i,this._prependPathToReferences(i))}}ngOnDestroy(){this._currentIconFetch.unsubscribe(),this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear()}_usingFontIcon(){return!this.svgIcon}_setSvgElement(e){this._clearSvgElement();const i=this._location.getPathname();this._previousPath=i,this._cacheChildrenWithExternalReferences(e),this._prependPathToReferences(i),this._elementRef.nativeElement.appendChild(e)}_clearSvgElement(){const e=this._elementRef.nativeElement;let i=e.childNodes.length;for(this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear();i--;){const r=e.childNodes[i];(1!==r.nodeType||"svg"===r.nodeName.toLowerCase())&&r.remove()}}_updateFontIconClasses(){if(!this._usingFontIcon())return;const e=this._elementRef.nativeElement,i=(this.fontSet?[this._iconRegistry.classNameForFontAlias(this.fontSet)]:this._iconRegistry.getDefaultFontSetClass()).filter(r=>r.length>0);this._previousFontSetClass.forEach(r=>e.classList.remove(r)),i.forEach(r=>e.classList.add(r)),this._previousFontSetClass=i,this.fontIcon!==this._previousFontIconClass&&(this._previousFontIconClass&&e.classList.remove(this._previousFontIconClass),this.fontIcon&&e.classList.add(this.fontIcon),this._previousFontIconClass=this.fontIcon)}_cleanupFontValue(e){return"string"==typeof e?e.trim().split(" ")[0]:e}_prependPathToReferences(e){const i=this._elementsWithExternalReferences;i&&i.forEach((r,s)=>{r.forEach(d=>{s.setAttribute(d.name,`url('${e}#${d.value}')`)})})}_cacheChildrenWithExternalReferences(e){const i=e.querySelectorAll(LG),r=this._elementsWithExternalReferences=this._elementsWithExternalReferences||new Map;for(let s=0;s<i.length;s++)T2.forEach(d=>{const m=i[s],y=m.getAttribute(d),T=y?y.match(FG):null;if(T){let M=r.get(m);M||(M=[],r.set(m,M)),M.push({name:d,value:T[1]})}})}_updateSvgIcon(e){if(this._svgNamespace=null,this._svgName=null,this._currentIconFetch.unsubscribe(),e){const[i,r]=this._splitIconName(e);i&&(this._svgNamespace=i),r&&(this._svgName=r),this._currentIconFetch=this._iconRegistry.getNamedSvgIcon(r,i).pipe(Qr(1)).subscribe(s=>this._setSvgElement(s),s=>{this._errorHandler.handleError(new Error(`Error retrieving icon ${i}:${r}! ${s.message}`))})}}}return n.\u0275fac=function(e){return new(e||n)(X(zn),X(kG),os("aria-hidden"),X(PG),X(wl))},n.\u0275cmp=On({type:n,selectors:[["sbb-icon"]],hostAttrs:["role","img",1,"sbb-icon","notranslate"],hostVars:5,hostBindings:function(e,i){2&e&&(Sn("data-sbb-icon-type",i._usingFontIcon()?"font":"svg")("data-sbb-icon-name",i._svgName||i.fontIcon)("data-sbb-icon-namespace",i._svgNamespace||i.fontSet),Ui("sbb-icon-inline",i.inline))},inputs:{color:"color",inline:"inline",svgIcon:"svgIcon",fontSet:"fontSet",fontIcon:"fontIcon"},exportAs:["sbbIcon"],ngContentSelectors:IG,decls:1,vars:0,template:function(e,i){1&e&&($o(),$r(0))},styles:[".sbb-icon{background-repeat:no-repeat;display:inline-block;line-height:0;overflow:hidden}.sbb-icon svg:not(.color-immutable) [fill]:not([fill=none]){fill:currentColor}.sbb-icon svg:not(.color-immutable) [stroke]:not([stroke=none]){stroke:currentColor}.sbb-icon svg:not(.color-immutable)>:where(path,polygon,polyline):where(:not([stroke]):not([fill])),.sbb-icon svg:not(.color-immutable) :where(:not([stroke]):not([fill])) :where(path,polygon,polyline):where(:not([stroke]):not([fill])){fill:currentColor}.sbb-icon.sbb-icon-inline{vertical-align:middle;margin-block-start:calc(-.2666666667rem*var(--sbb-scaling-factor));margin-block-end:calc(-.1333333333rem*var(--sbb-scaling-factor))}:where(.sbb-icon-fit) .sbb-icon,.sbb-icon:where(.sbb-icon-fit),:where(.sbb-icon-fit,.sbb-icon-scaled) .sbb-icon svg,.sbb-icon:where(.sbb-icon-fit,.sbb-icon-scaled) svg{width:100%;height:100%}:where(.sbb-icon-scaled) .sbb-icon,.sbb-icon:where(.sbb-icon-scaled){width:var(--sbb-icon-size-default);height:var(--sbb-icon-size-default)}"],encapsulation:2,changeDetection:0}),n})(),Ao=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({imports:[nr]}),n})();const E2=["*"],NG=["tabListContainer"],BG=["tabList"],zG=["tabListInner"],VG=["nextPaginator"],jG=["previousPaginator"],qG=["sbb-tab-nav-bar",""];new Dt("SbbTabContent"),new Dt("SbbTabLabel"),new Dt("SBB_TAB"),rl(class{}),new Dt("SBB_TAB_GROUP"),Us("translateTab",[vr("hidden",Yn({visibility:"hidden"})),tr("* => void, * => hidden",[Yn({opacity:1}),ar("{{animationDurationHide}} ease",Yn({opacity:0}))]),tr("hidden => show",[Yn({opacity:0,visibility:"visible"}),ar("{{animationDuration}} ease",Yn({opacity:1}))]),tr("void => show",ar("0s"))]),new Dt("SBB_TABS_CONFIG"),rl(class{});const mD=Pp({passive:!0}),XG=Dm(class{});let ZG=(()=>{class n extends XG{constructor(e,i,r,s,d,m){super(),this._elementRef=e,this._changeDetectorRef=i,this._viewportRuler=r,this._ngZone=s,this._platform=d,this._animationMode=m,this._scrollShadowTrigger=new Wt,this._scrollDistance=0,this._selectedIndexChanged=!1,this._destroyed=new Wt,this._showPaginationControls=!1,this._disableScrollAfter=!0,this._disableScrollBefore=!0,this._stopScrolling=new Wt,this._disablePagination=!1,this._selectedIndex=0,this.selectFocusedIndex=new on,this.indexFocused=new on,s.runOutsideAngular(()=>{fu(e.nativeElement,"mouseleave").pipe(Hi(this._destroyed)).subscribe(()=>{this._stopInterval()})})}get disablePagination(){return this._disablePagination}set disablePagination(e){this._disablePagination=ii(e)}get selectedIndex(){return this._selectedIndex}set selectedIndex(e){e=wh(e),this._selectedIndex!==e&&(this._selectedIndexChanged=!0,this._selectedIndex=e,this._keyManager&&this._keyManager.updateActiveItem(e))}ngAfterViewInit(){fu(this._previousPaginator.nativeElement,"touchstart",mD).pipe(Hi(this._destroyed)).subscribe(()=>{this._handlePaginatorPress("before")}),fu(this._nextPaginator.nativeElement,"touchstart",mD).pipe(Hi(this._destroyed)).subscribe(()=>{this._handlePaginatorPress("after")})}ngAfterContentInit(){const e=this._viewportRuler.change(150),i=()=>this.updatePagination();this._keyManager=new iD(this._items).withHorizontalOrientation("ltr").withHomeAndEnd().withWrap(),this._keyManager.updateActiveItem(this._selectedIndex),this._ngZone.onStable.pipe(Qr(1)).subscribe(i),Or(e,this._items.changes,this.variant).pipe(Hi(this._destroyed)).subscribe(()=>{this._ngZone.run(()=>{Promise.resolve().then(()=>{this._scrollDistance=Math.max(0,Math.min(this._getMaxScrollDistance(),this._scrollDistance)),i()})})}),this._keyManager.change.pipe(Hi(this._destroyed)).subscribe(r=>{this.indexFocused.emit(r),this._setTabFocus(r)}),this._ngZone.runOutsideAngular(()=>{this.variant.pipe(Rr(r=>"standard"===r),ya(()=>Or(fu(this._tabListContainer.nativeElement,"scroll",mD),this._scrollShadowTrigger,e)),Hs(null),$t(()=>this._calculateScrollState()),Lp(),Hi(this._destroyed)).subscribe(r=>this._applyScrollShadows(r))}),this._ngZone.runOutsideAngular(()=>{this.variant.pipe(Hi(this._destroyed)).subscribe(r=>{"lean"===r?this._tabListContainer.nativeElement.scrollLeft=0:this._tabList.nativeElement.style.removeProperty("transform")})})}ngAfterContentChecked(){this._tabLabelCount!==this._items.length&&(this.updatePagination(),this._tabLabelCount=this._items.length,this._changeDetectorRef.markForCheck()),this._selectedIndexChanged&&(this._scrollToLabel(this._selectedIndex),this._checkScrollingControls(),this._selectedIndexChanged=!1,this._changeDetectorRef.markForCheck()),this._scrollDistanceChanged&&(this._updateTabScrollPosition(),this._scrollDistanceChanged=!1,this._changeDetectorRef.markForCheck())}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete(),this._stopScrolling.complete()}_handleKeydown(e){if(!xa(e))switch(e.keyCode){case 13:case 32:this.focusIndex!==this.selectedIndex&&(this.selectFocusedIndex.emit(this.focusIndex),this._itemSelected(e));break;default:this._keyManager.onKeydown(e)}}_onContentChanges(){const e=this._elementRef.nativeElement.textContent;e!==this._currentTextContent&&(this._currentTextContent=e||"",this._ngZone.run(()=>{this.updatePagination(),this._changeDetectorRef.markForCheck()}))}updatePagination(){this._checkPaginationEnabled(),this._checkScrollingControls(),this._updateTabScrollPosition()}get focusIndex(){return this._keyManager?this._keyManager.activeItemIndex:0}set focusIndex(e){!this._isValidIndex(e)||this.focusIndex===e||!this._keyManager||this._keyManager.setActiveItem(e)}_isValidIndex(e){if(!this._items)return!0;const i=this._items?this._items.toArray()[e]:null;return!!i&&!i.disabled}_setTabFocus(e){this._showPaginationControls&&this._scrollToLabel(e),this._items&&this._items.length&&(this._items.toArray()[e].focus(),this._tabListContainer.nativeElement.scrollLeft=0)}_updateTabScrollPosition(){this.disablePagination||"standard"===this.variantSnapshot||(this._tabList.nativeElement.style.transform=`translateX(${Math.round(-this.scrollDistance)}px)`,(this._platform.TRIDENT||this._platform.EDGE)&&(this._tabListContainer.nativeElement.scrollLeft=0))}get scrollDistance(){return this._scrollDistance}set scrollDistance(e){this._scrollTo(e)}_scrollHeader(e){return this._scrollTo(this._scrollDistance+("before"===e?-1:1)*this._tabListContainer.nativeElement.offsetWidth/3)}_handlePaginatorClick(e){this._stopInterval(),this._scrollHeader(e)}_scrollToLabel(e){if(this.disablePagination||"standard"===this.variantSnapshot)return;const i=this._items?this._items.toArray()[e]:null;if(!i)return;const r=this._tabListContainer.nativeElement.offsetWidth,{offsetLeft:s,offsetWidth:d}=i.elementRef.nativeElement,y=s+d,T=this.scrollDistance,M=this.scrollDistance+r;s<T?this.scrollDistance-=T-s+60:y>M&&(this.scrollDistance+=y-M+60)}_checkPaginationEnabled(){if(this.disablePagination||"standard"===this.variantSnapshot)this._showPaginationControls=!1;else{const e=this._tabListInner.nativeElement.scrollWidth-this._elementRef.nativeElement.offsetWidth>1;e||(this.scrollDistance=0),e!==this._showPaginationControls&&this._changeDetectorRef.markForCheck(),this._showPaginationControls=e}}_checkScrollingControls(){this.disablePagination||"standard"===this.variantSnapshot?this._disableScrollAfter=this._disableScrollBefore=!0:(this._disableScrollBefore=0===this.scrollDistance,this._disableScrollAfter=this.scrollDistance===this._getMaxScrollDistance(),this._changeDetectorRef.markForCheck())}_getMaxScrollDistance(){return this._tabListInner.nativeElement.scrollWidth-this._tabListContainer.nativeElement.offsetWidth||0}_stopInterval(){this._stopScrolling.next()}_handlePaginatorPress(e,i){i&&null!=i.button&&0!==i.button||(this._stopInterval(),aD(650,100).pipe(Hi(Or(this._stopScrolling,this._destroyed))).subscribe(()=>{const{maxScrollDistance:r,distance:s}=this._scrollHeader(e);(0===s||s>=r)&&this._stopInterval()}))}_scrollTo(e){if(this.disablePagination||"standard"===this.variantSnapshot)return{maxScrollDistance:0,distance:0};const i=this._getMaxScrollDistance();return this._scrollDistance=Math.max(0,Math.min(i,e)),this._scrollDistanceChanged=!0,this._checkScrollingControls(),{maxScrollDistance:i,distance:this._scrollDistance}}_calculateScrollState(){const e=this._tabListContainer.nativeElement;if(e.scrollWidth===e.offsetWidth)return"hidden";const i=0===e.scrollLeft;return i||e.scrollWidth-e.scrollLeft-e.offsetWidth<=1?i?"left":"right":"middle"}_applyScrollShadows(e){const i=this._elementRef.nativeElement;"hidden"===e||"left"===e?i.classList.remove("sbb-tab-header-left-shadow"):i.classList.add("sbb-tab-header-left-shadow"),"hidden"===e||"right"===e?i.classList.remove("sbb-tab-header-right-shadow"):i.classList.add("sbb-tab-header-right-shadow")}}return n.\u0275fac=function(e){return new(e||n)(X(zn),X(kr),X(mu),X(di),X(Is),X(id,8))},n.\u0275dir=Ft({type:n,inputs:{disablePagination:"disablePagination"},features:[Yt]}),n})(),I2=0,M2=(()=>{class n extends ZG{constructor(e,i,r,s,d,m){super(e,r,s,i,d,m)}_itemSelected(){}ngAfterContentInit(){this._items.changes.pipe(Hs(null),Hi(this._destroyed)).subscribe(()=>{this.updateActiveLink()}),super.ngAfterContentInit()}updateActiveLink(){if(!this._items)return;const e=this._items.toArray();for(let i=0;i<e.length;i++)if(e[i].active)return this.selectedIndex=i,this._changeDetectorRef.markForCheck(),void(this.tabPanel&&(this.tabPanel._activeTabId=e[i].id));this.selectedIndex=-1}_getRole(){return this.tabPanel?"tablist":this._elementRef.nativeElement.getAttribute("role")}}return n.\u0275fac=function(e){return new(e||n)(X(zn),X(di),X(kr),X(mu),X(Is),X(id,8))},n.\u0275dir=Ft({type:n,inputs:{tabPanel:"tabPanel"},features:[Yt]}),n})(),gD=(()=>{class n extends M2{constructor(e,i,r,s,d,m){super(e,i,r,s,d,m)}}return n.\u0275fac=function(e){return new(e||n)(X(zn),X(di),X(kr),X(mu),X(Is),X(id,8))},n.\u0275cmp=On({type:n,selectors:[["","sbb-tab-nav-bar",""]],contentQueries:function(e,i,r){if(1&e&&Kr(r,bD,5),2&e){let s;Jn(s=ei())&&(i._items=s)}},viewQuery:function(e,i){if(1&e&&(yr(NG,7),yr(BG,7),yr(zG,7),yr(VG,5),yr(jG,5)),2&e){let r;Jn(r=ei())&&(i._tabListContainer=r.first),Jn(r=ei())&&(i._tabList=r.first),Jn(r=ei())&&(i._tabListInner=r.first),Jn(r=ei())&&(i._nextPaginator=r.first),Jn(r=ei())&&(i._previousPaginator=r.first)}},hostAttrs:[1,"sbb-tab-nav-bar","sbb-tab-header"],hostVars:3,hostBindings:function(e,i){2&e&&(Sn("role",i._getRole()),Ui("sbb-tab-header-pagination-controls-enabled",i._showPaginationControls&&"lean"===i.variantSnapshot))},exportAs:["sbbTabNavBar","sbbTabNav"],features:[Yt],attrs:qG,ngContentSelectors:E2,decls:13,vars:8,consts:[["aria-hidden","true","type","button","tabindex","-1",1,"sbb-tab-header-pagination","sbb-tab-header-pagination-before","sbb-button-reset-frameless",3,"disabled","click","mousedown","touchend"],["previousPaginator",""],["svgIcon","kom:chevron-left-small",1,"sbb-tab-header-pagination-chevron"],[1,"sbb-tab-link-container","sbb-scrollbar",3,"keydown"],["tabListContainer",""],[1,"sbb-tab-list",3,"cdkObserveContent"],["tabList",""],[1,"sbb-tab-links"],["tabListInner",""],["aria-hidden","true","type","button","tabindex","-1",1,"sbb-tab-header-pagination","sbb-tab-header-pagination-after","sbb-button-reset-frameless",3,"disabled","mousedown","click","touchend"],["nextPaginator",""],["svgIcon","kom:chevron-right-small",1,"sbb-tab-header-pagination-chevron"]],template:function(e,i){1&e&&($o(),le(0,"button",0,1),nn("click",function(){return i._handlePaginatorClick("before")})("mousedown",function(s){return i._handlePaginatorPress("before",s)})("touchend",function(){return i._stopInterval()}),bn(2,"sbb-icon",2),pe(),le(3,"div",3,4),nn("keydown",function(s){return i._handleKeydown(s)}),le(5,"div",5,6),nn("cdkObserveContent",function(){return i._onContentChanges()}),le(7,"div",7,8),$r(9),pe()()(),le(10,"button",9,10),nn("mousedown",function(s){return i._handlePaginatorPress("after",s)})("click",function(){return i._handlePaginatorClick("after")})("touchend",function(){return i._stopInterval()}),bn(12,"sbb-icon",11),pe()),2&e&&(Ui("sbb-tab-header-pagination-disabled",i._disableScrollBefore),rt("disabled",i._disableScrollBefore||null),Fe(5),Ui("_sbb-animation-noopable","NoopAnimations"===i._animationMode),Fe(5),Ui("sbb-tab-header-pagination-disabled",i._disableScrollAfter),rt("disabled",i._disableScrollAfter||null))},dependencies:[jL,ol],styles:['.sbb-tab-header{display:flex;overflow:hidden;position:relative;flex-shrink:0}.sbb-tab-header-pagination{-webkit-user-select:none;user-select:none;position:relative;display:none;justify-content:center;align-items:center;min-width:2.1333333333rem;cursor:pointer;z-index:2;-webkit-tap-highlight-color:rgba(0,0,0,0);touch-action:none;color:var(--sbb-color-granite);box-shadow:0 .1333333333rem .2666666667rem -.0666666667rem rgba(0,0,0,.2),0 .2666666667rem .3333333333rem rgba(0,0,0,.1411764706),0 .0666666667rem .6666666667rem rgba(0,0,0,.1215686275)}.sbb-tab-header-pagination::after{content:"";display:block;position:absolute;bottom:0;height:0;margin:0 auto;border-bottom:var(--sbb-border-width-thin) solid var(--sbb-color-text)}:where(html:not(.sbb-lean)) .sbb-tab-header-pagination::after{transition:width var(--sbb-transition-duration-default),left var(--sbb-transition-duration-default);left:0;right:0;width:0}:where(html.sbb-lean) .sbb-tab-header-pagination::after{left:var(--sbb-border-width-negative);right:var(--sbb-border-width-negative);border-color:var(--sbb-color-graphite)}.sbb-tab-header-pagination-controls-enabled .sbb-tab-header-pagination{display:flex}.sbb-tab-header-pagination:hover:not(.sbb-tab-header-pagination-disabled){color:var(--sbb-color-call-to-action-hover)}.sbb-tab-header-pagination::after{right:0;left:0}.sbb-tab-header-pagination.sbb-tab-header-pagination-after.sbb-tab-header-pagination-disabled::after{left:-.0666666667rem}.sbb-tab-header-pagination-disabled .sbb-tab-header-pagination-chevron{opacity:.4}.sbb-tab-header-pagination-disabled{box-shadow:none;cursor:default}.sbb-tab-list{flex-grow:1;position:relative;transition:transform var(--sbb-transition-duration-slow) var(--sbb-transition-timing-fast-start);will-change:transform}.sbb-tab-header{position:relative}:where(html:not(.sbb-lean)) .sbb-tab-header::before,:where(html:not(.sbb-lean)) .sbb-tab-header::after{position:absolute;top:0;content:"";z-index:2;width:.8rem;height:calc(100% - .5rem);transition:transform var(--sbb-transition-duration-fast) var(--sbb-transition-timing-default);pointer-events:none}@media all and (min-width: 40.1875em){:where(html:not(.sbb-lean)) .sbb-tab-header::before,:where(html:not(.sbb-lean)) .sbb-tab-header::after{width:calc(1.6rem * var(--sbb-scaling-factor))}}:where(html:not(.sbb-lean)) .sbb-tab-header::before{left:0;transform:translateX(-100%);background:linear-gradient(270deg, hsla(0deg, 0%, 100%, 0.37) 0, var(--sbb-color-background))}:where(html:not(.sbb-lean)) .sbb-tab-header.sbb-tab-header-left-shadow::before{transform:translateX(0)}:where(html:not(.sbb-lean)) .sbb-tab-header::after{right:0;transform:translateX(100%);background:linear-gradient(90deg, hsla(0deg, 0%, 100%, 0.37) 0, var(--sbb-color-background))}:where(html:not(.sbb-lean)) .sbb-tab-header.sbb-tab-header-right-shadow::after{transform:translateX(0)}.sbb-tab-links{display:flex;padding-top:calc(0.1333333333rem * var(--sbb-scaling-factor))}:where(html.sbb-lean) .sbb-tab-links{padding-top:0}:where(html.sbb-lean) .sbb-tab-links::after{content:"";width:100%;flex-grow:1;flex-shrink:1;border-bottom:var(--sbb-border-width) solid var(--sbb-color-graphite)}.sbb-tab-link-container{display:flex;position:relative;flex-grow:1;overflow-x:auto;z-index:1;padding-bottom:1.3333333333rem}:where(html.sbb-lean) .sbb-tab-link-container{overflow:hidden;padding-bottom:0}.sbb-tab-link{margin-right:2.1333333333rem;cursor:pointer;box-sizing:border-box;text-align:center;display:inline-flex;justify-content:center;align-items:center;white-space:nowrap;font-family:var(--sbb-font-light);font-size:1.3333333333rem;color:var(--sbb-color-text);line-height:1em;padding-bottom:1.3333333333rem;outline:none;vertical-align:top;text-decoration:none;position:relative;overflow:hidden;-webkit-tap-highlight-color:rgba(0,0,0,0)}.sbb-tab-link::after{content:"";display:block;position:absolute;bottom:0;height:0;margin:0 auto;border-bottom:var(--sbb-border-width-thin) solid var(--sbb-color-text)}:where(html:not(.sbb-lean)) .sbb-tab-link::after{transition:width var(--sbb-transition-duration-default),left var(--sbb-transition-duration-default);left:0;right:0;width:0}:where(html.sbb-lean) .sbb-tab-link::after{left:var(--sbb-border-width-negative);right:var(--sbb-border-width-negative);border-color:var(--sbb-color-graphite)}@media all and (min-width: 40.1875em){:where(html:not(.sbb-lean)) .sbb-tab-link{margin-right:calc(2.8rem * var(--sbb-scaling-factor));font-size:calc(1.7333333333rem * var(--sbb-scaling-factor))}}:where(html.sbb-lean) .sbb-tab-link{font-size:var(--sbb-font-size);line-height:1.3333333333rem;padding:.4rem 1rem .6rem;background-color:var(--sbb-color-background);margin-right:0;border:var(--sbb-border-width) solid rgba(0,0,0,0);border-bottom:none;border-radius:var(--sbb-border-radius) var(--sbb-border-radius) 0 0}.sbb-tab-link:last-child{margin-right:0 !important}:where(html:not(.sbb-lean)) .sbb-tab-link.sbb-tab-label-active::after{width:100%}:where(html.sbb-lean) .sbb-tab-link.sbb-tab-label-active{border-color:var(--sbb-color-graphite)}:where(html.sbb-lean) .sbb-tab-link.sbb-tab-label-active::after{display:none}.sbb-tab-link:not(.sbb-tab-label-active):not(.sbb-tab-disabled):is(:focus,:hover){color:var(--sbb-color-call-to-action-hover)}.sbb-tab-link:not(.sbb-tab-label-active):not(.sbb-tab-disabled):is(:focus,:hover)::after{border-bottom-color:var(--sbb-color-call-to-action-hover)}:where(html:not(.sbb-lean)) .sbb-tab-link:not(.sbb-tab-label-active):not(.sbb-tab-disabled):is(:focus,:hover)::after{width:100%}.sbb-tab-link.sbb-tab-label-active:is(:hover,:focus){color:currentColor;cursor:default}:where(html.sbb-lean) .sbb-tab-link.sbb-tab-label-active:focus-visible{outline:var(--sbb-border-width) solid var(--sbb-color-black);outline-offset:calc(-1*var(--sbb-border-width))}.sbb-tab-link.sbb-tab-disabled{color:var(--sbb-color-storm)}.sbb-tab-link.sbb-tab-disabled:is(:hover,:focus){cursor:default}:where(html:not(.sbb-lean)) .sbb-tab-link.sbb-tab-disabled::after{width:0 !important}.sbb-tab-link .sbb-tab-label-content{display:inline-flex;justify-content:center;align-items:center;white-space:nowrap}:where(html.sbb-lean) .sbb-tab-link .sbb-badge:not(.sbb-badge-hidden){padding-right:.7333333333rem}:where(html.sbb-lean) .sbb-tab-link .sbb-badge-content{transform:scale(0.8)}[sbb-stretch-tabs] .sbb-tab-link{flex-basis:0;flex-grow:1}:where(html.sbb-lean) .sbb-tab-link{overflow:unset}.sbb-tab-link.sbb-tab-disabled{pointer-events:none}:is(.sbb-tab-nav-panel,.sbb-tab-nav-bar-body){display:block;position:relative;overflow:hidden;transition:height var(--sbb-transition-duration-slow)}:where(html.sbb-lean) :is(.sbb-tab-nav-panel,.sbb-tab-nav-bar-body){border:var(--sbb-border-width) solid var(--sbb-color-graphite);border-top:none;background-color:var(--sbb-color-background)}:where(html.sbb-lean) :is(.sbb-tab-nav-panel,.sbb-tab-nav-bar-body){padding:1rem}'],encapsulation:2}),n})();const YG=$b(rl(class{}));let KG=(()=>{class n extends YG{constructor(e,i,r,s){super(),this._tabNavBar=e,this.elementRef=i,this._focusMonitor=s,this._isActive=!1,this.id="sbb-tab-link-"+I2++,this.tabIndex=parseInt(r,10)||0}get active(){return this._isActive}set active(e){const i=ii(e);i!==this._isActive&&(this._isActive=i,this._tabNavBar.updateActiveLink())}focus(){this.elementRef.nativeElement.focus()}ngAfterViewInit(){this._focusMonitor.monitor(this.elementRef)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this.elementRef)}_handleFocus(){this._tabNavBar.focusIndex=this._tabNavBar._items.toArray().indexOf(this)}_handleKeydown(e){this._tabNavBar.tabPanel&&32===e.keyCode&&this.elementRef.nativeElement.click()}_getAriaControls(){var e;return this._tabNavBar.tabPanel?null===(e=this._tabNavBar.tabPanel)||void 0===e?void 0:e.id:this.elementRef.nativeElement.getAttribute("aria-controls")}_getAriaSelected(){return this._tabNavBar.tabPanel?this.active?"true":"false":this.elementRef.nativeElement.getAttribute("aria-selected")}_getAriaCurrent(){return this.active&&!this._tabNavBar.tabPanel?"page":null}_getRole(){return this._tabNavBar.tabPanel?"tab":this.elementRef.nativeElement.getAttribute("role")}_getTabIndex(){return this._tabNavBar.tabPanel?this._isActive?0:-1:this.tabIndex}}return n.\u0275fac=function(e){return new(e||n)(X(M2),X(zn),os("tabindex"),X(Pa))},n.\u0275dir=Ft({type:n,inputs:{active:"active",id:"id"},features:[Yt]}),n})(),bD=(()=>{class n extends KG{constructor(e,i,r,s){super(e,i,r,s)}}return n.\u0275fac=function(e){return new(e||n)(X(gD),X(zn),os("tabindex"),X(Pa))},n.\u0275dir=Ft({type:n,selectors:[["","sbb-tab-link",""],["","sbbTabLink",""]],hostAttrs:[1,"sbb-tab-link","sbb-link-reset"],hostVars:11,hostBindings:function(e,i){1&e&&nn("focus",function(){return i._handleFocus()})("keydown",function(s){return i._handleKeydown(s)}),2&e&&(Sn("aria-controls",i._getAriaControls())("aria-current",i._getAriaCurrent())("aria-disabled",i.disabled)("aria-selected",i._getAriaSelected())("id",i.id)("tabIndex",i._getTabIndex())("role",i._getRole()),Ui("sbb-tab-disabled",i.disabled)("sbb-tab-label-active",i.active))},inputs:{disabled:"disabled",tabIndex:"tabIndex"},exportAs:["sbbTabLink"],features:[Yt]}),n})(),A2=(()=>{class n{constructor(){this.id="sbb-tab-nav-panel-"+I2++}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=On({type:n,selectors:[["sbb-tab-nav-panel"]],hostAttrs:["role","tabpanel",1,"sbb-tab-nav-panel"],hostVars:2,hostBindings:function(e,i){2&e&&Sn("aria-labelledby",i._activeTabId)("id",i.id)},inputs:{id:"id"},exportAs:["sbbTabNavPanel"],ngContentSelectors:E2,decls:1,vars:0,template:function(e,i){1&e&&($o(),$r(0))},encapsulation:2,changeDetection:0}),n})(),k2=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({imports:[Tr,wa,Xw,Cm,Em,nr,Ao]}),n})();const Im={app_stages:[{key:"PROD",apiEndpoint:"https://api.opentransportdata.swiss/ojp2020",authBearerKey:"eyJvcmciOiI2NDA2NTFhNTIyZmEwNTAwMDEyOWJiZTEiLCJpZCI6Ijk0YTFhNjExYjM5ZjQ4MWNiMGI5MjFiNTgyNmM1ZGFjIiwiaCI6Im11cm11cjEyOCJ9"},{key:"INT",apiEndpoint:"https://odpch-api.clients.liip.ch/ojp-passiv-int",authBearerKey:"eyJvcmciOiI2M2Q4ODhiMDNmZmRmODAwMDEzMDIwODkiLCJpZCI6ImJkOTNmYzA1ZGMwYzQwM2Q4MWYzMmFhNWMxNWZjMjU2IiwiaCI6Im11cm11cjEyOCJ9"},{key:"TEST",apiEndpoint:"https://odpch-api.clients.liip.ch/ojp-test",authBearerKey:"eyJvcmciOiI2M2Q4ODhiMDNmZmRmODAwMDEzMDIwODkiLCJpZCI6ImZlYWJiMjEzZDcyZTRhYmM5N2RhYWJiZDM5YWZmZWIwIiwiaCI6Im11cm11cjEyOCJ9"},{key:"LA Beta",apiEndpoint:"https://api.opentransportdata.swiss/ojp-la-aktiv",authBearerKey:"eyJvcmciOiI2NDA2NTFhNTIyZmEwNTAwMDEyOWJiZTEiLCJpZCI6ImE5ZDFkYmI4YWVjMDRiYjFiZjA2ZmUyNmZmZTk2YTY2IiwiaCI6Im11cm11cjEyOCJ9"}],map_app_map_layers:{stops:{LIR_Restriction_Type:"stop",minZoom:13,layer_ids:["stops-circle","stops-label"],click_layer_ids:"SAME_AS_LAYER_IDS"},addresses:{LIR_Restriction_Type:"address",minZoom:17,layer_ids:["address-circle"],click_layer_ids:"SAME_AS_LAYER_IDS"},sharing_cars:{LIR_Restriction_Type:"poi_amenity",LIR_POI_Type:"car_sharing",minZoom:12,layer_ids:["car-rental-icon","car-rental-text-number","car-rental-text-provider"],click_layer_ids:"SAME_AS_LAYER_IDS"},sharing_bicycles:{LIR_Restriction_Type:"poi_amenity",LIR_POI_Type:"bicycle_rental",minZoom:14,layer_ids:["bike-icon","bike-text-number","bike-text-provider"],click_layer_ids:"SAME_AS_LAYER_IDS"},sharing_scooters:{LIR_Restriction_Type:"poi_amenity",LIR_POI_Type:"escooter_rental",minZoom:14,layer_ids:["scooter-icon","scooter-text-number","scooter-text-provider"],click_layer_ids:"SAME_AS_LAYER_IDS"},charging_stations:{LIR_Restriction_Type:"poi_amenity",LIR_POI_Type:"charging_station",minZoom:12,layer_ids:["charging-station-icon","charging-station-text-number","charging-station-text-provider"],click_layer_ids:"SAME_AS_LAYER_IDS"},sbb_services:{LIR_Restriction_Type:"poi_amenity",LIR_POI_Type:"sbb_services",minZoom:12,layer_ids:["charging-station-icon","charging-station-text-number","charging-station-text-provider"],click_layer_ids:"SAME_AS_LAYER_IDS"},pois_other:{LIR_Restriction_Type:"poi_amenity",LIR_POI_Type:"other",minZoom:12,layer_ids:["charging-station-icon","charging-station-text-number","charging-station-text-provider"],click_layer_ids:"SAME_AS_LAYER_IDS"},"pois-ALL":{LIR_Restriction_Type:"poi_all",LIR_POI_Type:["service","shopping","leisure","catering","public","parkride","accommodation"],minZoom:16,layer_ids:["poi-all"],click_layer_ids:"SAME_AS_LAYER_IDS"}}},Iv={ContinousLeg:"#009933",TransferLeg:"#0000ff",TimedLeg:"#D04D44"},QG=["ContinousLeg","TimedLeg","TransferLeg"],Mm={Unknown:"#ffafcc",LongDistanceRail:"#D04D44",SBahn:"#3D69CA",Bus:"#5F8EF4",PostAuto:"#EBBE24",OnDemand:"#D77D00",Aerial:"#8B4513",Funicular:"#006400",Walk:"#009933","Self-Drive Car":"#ff004f","Shared Mobility":"#32CD32",Guidance:"#6f0000",Transfer:"#088F8F"},JG=["LongDistanceRail","SBahn","Bus","PostAuto","OnDemand","Aerial","Walk","Guidance","Transfer","Self-Drive Car","Shared Mobility"];class Il{static formatDate(t){return[t.getFullYear(),"-",("00"+(t.getMonth()+1)).slice(-2),"-",("00"+t.getDate()).slice(-2)," ",("00"+t.getHours()).slice(-2),":",("00"+t.getMinutes()).slice(-2),":",("00"+t.getSeconds()).slice(-2)].join("")}static formatTimeHHMM(t){return Il.formatDate(t).substring(11,16)}static formatDistance(t){return t>1e3?(t/1e3).toFixed(1)+"km":t+"m"}}var ps=(()=>{return(n=ps||(ps={})).LegType="leg.type",n.DrawType="draw.type",n.PointType="point.type",n.LineType="line.type",ps;var n})();class Fc{static FilterBeelines(){return this.FilterByDrawType("Beeline")}static FilterWalkingLegs(){return["all",this.FilterByDrawType("LegLine"),this.FilterByLineType("Walk")]}static FilterLegPoints(){return this.FilterByDrawType("LegPoint")}static ColorCaseByLegLineType(){const t=["case"];return JG.forEach(e=>{t.push(["==",["get",ps.LineType],e]),t.push(Mm[e])}),t.push("#FF1493"),t}static FilterByDrawType(t){return["==",["get",ps.DrawType],t]}static FilterByPointType(t){return["==",["get",ps.PointType],t]}static FilterByLineType(t){return["==",["get",ps.LineType],t]}static FilterTimedLegTracks(){return["all",this.FilterByDrawType("LegLine")]}static ColorCaseByLegType(){const t=["case"];return QG.forEach(e=>{t.push(["==",["get",ps.LegType],e]),t.push(Iv[e])}),t.push("#FF1493"),t}}var R2=tt(823);const P2={siri:"http://www.siri.org.uk/siri",ojp:"http://www.vdv.de/ojp"};class Gt{static queryNodes(t,e){return R2.useNamespaces(P2)(t,e)}static queryNode(t,e){const i=Gt.queryNodes(t,e);return 0===i.length?null:i[0]}static queryText(t,e){const r=R2.useNamespaces(P2)(t,e,!0);return r?r.textContent:null}}class hd{constructor(t,e){this.hours=t,this.minutes=e,this.totalMinutes=60*t+e}static initFromContextNode(t,e="ojp:Duration"){if(null===t)return null;let i=Gt.queryText(e,t);if(null===i)return null;i=i.replace("PT","");let r=0;const s=i.match(/([0-9]+?)H/);s&&(r=parseInt(s[1]));let d=0;const m=i.match(/([0-9]+?)M/);return m&&(d=parseInt(m[1])),new hd(r,d)}static initFromTotalMinutes(t){const e=Math.floor(t/60);return new hd(e,t-60*e)}formatDuration(){const t=[];return this.hours>0&&t.push(this.hours+"h "),t.push(this.minutes+"min"),t.join("")}plus(t){return hd.initFromTotalMinutes(this.totalMinutes+t.totalMinutes)}}class eW{constructor(t){this.sections=t}computeAggregatedTrips(){let t=[],e=[],i=0,r=0;const s=this.sections.length>1;return this.sections.forEach((d,m)=>{if(m===this.sections.length-1)d.response.trips.forEach(T=>{if(s){let M=this.computeFirstValidTrip();T.stats.startDatetime=M?M.stats.startDatetime:new Date,T.stats.transferNo+=this.sections.length-1,T.stats.distanceMeters+=i,T.stats.duration=hd.initFromTotalMinutes(r+T.stats.duration.totalMinutes)}T.legs=e.concat(T.legs)}),t=d.response.trips;else if(d.response.trips.length>0){const M=d.response.trips[0];e=e.concat(M.legs),i+=M.stats.distanceMeters,r+=M.stats.duration.totalMinutes}}),t}computeFirstValidTrip(){for(let t of this.sections)if(t.response.trips.length>0)return t.response.trips[0];return null}}class oa{constructor(t,e){this.longitude=parseFloat(t.toFixed(6)),this.latitude=parseFloat(e.toFixed(6)),this.properties=null}static initFromContextNode(t){const e=Gt.queryText("ojp:GeoPosition/siri:Longitude",t),i=Gt.queryText("ojp:GeoPosition/siri:Latitude",t);if(null===e||null===i)return null;const r=parseFloat(e),s=parseFloat(i);return 0===r||0===s?null:new oa(r,s)}static initWithFeature(t){if("Point"!==t.geometry.type)return null;const e=t.geometry.coordinates,s=new oa(e[0],e[1]);return s.properties=t.properties,s}asLngLat(){return[this.longitude,this.latitude]}asLatLngString(t=!0){let e="";return e=t?this.latitude.toFixed(6)+","+this.longitude.toFixed(6):this.latitude+","+this.longitude,e}asPosition(){return[this.longitude,this.latitude]}distanceFrom(t){const i=(t.latitude-this.latitude)*Math.PI/180,r=(t.longitude-this.longitude)*Math.PI/180,s=Math.sin(i/2)*Math.sin(i/2)+Math.cos(this.latitude*Math.PI/180)*Math.cos(t.latitude*Math.PI/180)*Math.sin(r/2)*Math.sin(r/2),d=2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s));return Math.round(6371*d*1e3)}}class zp{constructor(t,e,i,r="StopPlace"){this.stopPlaceRef=t,this.stopPlaceName=e,this.topographicPlaceRef=i,this.stopType=r}static initFromContextNode(t){let e="StopPlace",i=Gt.queryText("ojp:StopPlace/ojp:StopPlaceRef",t),r=Gt.queryText("ojp:StopPlace/ojp:StopPlaceName/ojp:Text",t);if(i&&r||(e="StopPoint",i=Gt.queryText("ojp:StopPoint/siri:StopPointRef",t),r=Gt.queryText("ojp:StopPoint/ojp:StopPointName/ojp:Text",t)),!i||!r)return null;const s=Gt.queryText("ojp:StopPlace/ojp:TopographicPlaceRef",t);return new zp(i,r,s,e)}static initFromServiceNode(t,e){const i=Gt.queryText("ojp:"+e+"StopPointRef",t),r=Gt.queryText("ojp:"+e+"Text/ojp:Text",t);return i&&r?new zp(i,r,null,"StopPlace"):null}}class aS{constructor(t,e,i){this.addressCode=t,this.addressName=e,this.topographicPlaceRef=i}static initFromContextNode(t){const e=Gt.queryText("ojp:Address/ojp:AddressCode",t);if(null===e)return null;const i=Gt.queryText("ojp:Address/ojp:AddressName/ojp:Text",t),r=Gt.queryText("ojp:Address/ojp:TopographicPlaceRef",t);return new aS(e,i,r)}}const _D={service:["atm","hairdresser"],shopping:["all","clothes","optician"],catering:["all"],accommodation:["all"]};class yD{constructor(t,e,i,r,s){this.code=t,this.name=e,this.category=i,this.subCategory=r,this.categoryTags=s}static initFromContextNode(t){const e=Gt.queryText("ojp:PointOfInterest/ojp:PointOfInterestCode",t),i=Gt.queryText("ojp:PointOfInterest/ojp:PointOfInterestName/ojp:Text",t);if(!e||!i)return null;const r=[],s=[];Gt.queryNodes("ojp:PointOfInterest/ojp:PointOfInterestCategory",t).forEach(M=>{const R=Gt.queryText("ojp:OsmTag/ojp:Value",M);R&&r.push(R);const H=Gt.queryText("ojp:OsmTag/ojp:Tag",M);H&&s.push(H)});let m=null,y=null;return 2===r.length&&(m=r[1],y=r[0]),1===r.length&&(m=r[0]),null===m?null:new yD(e,i,m,y,r)}computePoiMapIcon(){const t="poi-unknown";return this.category in _D?this.subCategory&&_D[this.category].indexOf(this.subCategory)>-1?"poi-"+this.category+"-"+this.subCategory:_D[this.category].indexOf("all")>-1?"poi-"+this.category+"-all":t:t}}class vD{constructor(t,e){this.code=t,this.name=e}static initFromContextNode(t){const e=Gt.queryText("ojp:TopographicPlace/ojp:TopographicPlaceCode",t),i=Gt.queryText("ojp:TopographicPlace/ojp:TopographicPlaceName/ojp:Text",t);return e&&i?new vD(e,i):null}}const tW=/^([0-9\.]+?),([0-9\.]+?)$/;class fs{constructor(){this.address=null,this.stopPointRef=null,this.locationName=null,this.stopPlace=null,this.geoPosition=null,this.poi=null,this.topographicPlace=null,this.attributes={},this.probability=null,this.originSystem=null}static initWithOJPContextNode(t){var e;const i=new fs;i.address=aS.initFromContextNode(t),i.stopPointRef=Gt.queryText("siri:StopPointRef",t),i.stopPlace=zp.initFromContextNode(t),i.geoPosition=oa.initFromContextNode(t),i.poi=yD.initFromContextNode(t),i.topographicPlace=vD.initFromContextNode(t);let r=Gt.queryText("ojp:LocationName/ojp:Text",t);null===r&&(r=Gt.queryText("ojp:StopPointName/ojp:Text",t)),i.locationName=r,i.attributes={},Gt.queryNodes("ojp:Attribute/*",t).forEach(y=>{const T=y.nodeName.split(":"),M=1===T.length?T[0]:T[1],R=Gt.queryText("ojp:Attribute/"+y.nodeName,t);R&&(i.attributes[M]=R.trim())}),Gt.queryNodes("ojp:Extension/ojp:LocationExtensionStructure/*",t).forEach(y=>{const T=y.nodeName.split(":");2===T.length&&(i.attributes[T[1]]=y.textContent)}),null===i.stopPointRef&&(null===(e=i.stopPlace)||void 0===e?void 0:e.stopPlaceRef)&&(i.stopPointRef=i.stopPlace.stopPlaceRef);const m=Gt.queryText("../ojp:Probability",t);return m&&(i.probability=parseFloat(m)),i.originSystem=Gt.queryText("../ojp:OriginSystem",t),i}static initWithStopPlaceRef(t,e=""){const i=new fs;return i.stopPlace=new zp(t,e,null),i}static initWithLngLat(t,e){const i=new fs;return i.geoPosition=new oa(t,e),i}static initWithFeature(t){var e,i,r,s;const d=oa.initWithFeature(t);if(null===d)return null;const m=t.properties;if(null===m)return null;const y=new fs;y.geoPosition=d,y.locationName=null!==(e=m.locationName)&&void 0!==e?e:null;const T=m["stopPlace.stopPlaceRef"];if(T){const R=null!==(i=m["stopPlace.stopPlaceName"])&&void 0!==i?i:null;y.stopPlace=new zp(T,R,null)}const M=m.addressCode;if(M){const R=null!==(r=m.addressName)&&void 0!==r?r:null,H=null!==(s=m.topographicPlaceRef)&&void 0!==s?s:null;y.address=new aS(M,R,H)}return y}static initFromLiteralCoords(t){let e=t.trim();e=e.replace(/\(.+?\)/g,""),e=e.replace(/[^0-9\.,]/g,"");const i=e.match(tW);if(null===i)return null;let r=parseFloat(i[1]),s=parseFloat(i[2]);r>s&&(r=parseFloat(i[2]),s=parseFloat(i[1]));const d=fs.initWithLngLat(r,s),m=t.trim().match(/\(([^\)]*)\)?/);return null!==m&&(d.locationName=m[1]),d}asGeoJSONFeature(){var t,e,i,r,s,d,m,y,T,M,R,H,Z,te,xe;if(null===this.geoPosition)return null;const Ce={};(null!==(e=null===(t=this.stopPlace)||void 0===t?void 0:t.stopPlaceRef)&&void 0!==e?e:null)&&(Ce["stopPlace.stopPlaceRef"]=null!==(r=null===(i=this.stopPlace)||void 0===i?void 0:i.stopPlaceRef)&&void 0!==r?r:"",Ce["stopPlace.stopPlaceName"]=null!==(d=null===(s=this.stopPlace)||void 0===s?void 0:s.stopPlaceName)&&void 0!==d?d:"",Ce["stopPlace.topographicPlaceRef"]=null!==(y=null===(m=this.stopPlace)||void 0===m?void 0:m.topographicPlaceRef)&&void 0!==y?y:""),this.address&&(Ce.addressCode=null!==(M=null===(T=this.address)||void 0===T?void 0:T.addressCode)&&void 0!==M?M:"",Ce.addressName=null!==(H=null===(R=this.address)||void 0===R?void 0:R.addressName)&&void 0!==H?H:"",Ce.topographicPlaceRef=null!==(te=null===(Z=this.address)||void 0===Z?void 0:Z.topographicPlaceRef)&&void 0!==te?te:""),this.poi&&(Ce["poi.name"]=this.poi.name,Ce["poi.code"]=this.poi.code,Ce["poi.category"]=this.poi.category,Ce["poi.subcategory"]=this.poi.subCategory,Ce["poi.osm.tags"]=this.poi.categoryTags.join(",")),Ce.locationName=null!==(xe=this.locationName)&&void 0!==xe?xe:"";for(let pt in this.attributes)Ce["OJP.Attr."+pt]=this.attributes[pt];return{type:"Feature",properties:Ce,geometry:{type:"Point",coordinates:[this.geoPosition.longitude,this.geoPosition.latitude]}}}computeLocationName(t=!0){var e;return this.stopPlace?this.stopPlace.stopPlaceName:null!==(e=this.topographicPlace)&&void 0!==e&&e.name?this.topographicPlace.name:this.poi&&this.poi.name?this.poi.name:this.locationName?this.locationName:t&&this.geoPosition?this.geoPosition.asLatLngString():null}findClosestLocation(t){const e=this.geoPosition;if(null===e)return null;let i=null;return t.forEach(r=>{const s=r.geoPosition;if(null===s)return;const d=e.distanceFrom(s);(null===i||d<i.distance)&&(i={location:r,distance:d})}),i}getLocationType(){return this.stopPlace?"stop":this.poi?"poi":this.address?"address":this.topographicPlace?"topographicPlace":null}}class Vp{constructor(t){Array.isArray(t)||(t=[t]);const e=Math.min.apply(null,t.map(d=>d.longitude)),i=Math.min.apply(null,t.map(d=>d.latitude)),r=Math.max.apply(null,t.map(d=>d.longitude)),s=Math.max.apply(null,t.map(d=>d.latitude));this.southWest=new oa(e,i),this.northEast=new oa(r,s)}static initFromGeoPosition(t,e,i){const r=.1*e/7612,s=.1*i/11119,d=new oa(t.longitude-r/2,t.latitude-s/2),m=new oa(t.longitude+r/2,t.latitude+s/2);return new Vp([d,m])}extend(t){Array.isArray(t)||(t=[t]),t.forEach(e=>{const i=Math.min(this.southWest.longitude,e.longitude),r=Math.min(this.southWest.latitude,e.latitude),s=Math.max(this.northEast.longitude,e.longitude),d=Math.max(this.northEast.latitude,e.latitude);this.southWest=new oa(i,r),this.northEast=new oa(s,d)})}asFeatureBBOX(){return[this.southWest.longitude,this.southWest.latitude,this.northEast.longitude,this.northEast.latitude]}isValid(){return this.southWest.longitude!==1/0}containsGeoPosition(t){return!(t.longitude<this.southWest.longitude||t.latitude<this.southWest.latitude||t.longitude>this.northEast.longitude||t.latitude>this.northEast.latitude)}}class xD{constructor(t,e,i){this.summary=t,this.description=e,this.details=i}static initFromSituationNode(t){const e=Gt.queryText("siri:Summary",t),i=Gt.queryText("siri:Description",t);if(!e||!i)return console.error("ERROR: SituationContent.initFromSituationNode - cant init"),console.log(t),null;const r=[];return Gt.queryNodes("siri:Detail",t).forEach(m=>{const y=Gt.queryText(".",m);y&&r.push(y)}),0===r.length?(console.error("ERROR: SituationContent.initFromSituationNode - empty details"),console.log(t),null):new xD(e,i,r)}}class wD{constructor(t){this.sourceType=t,this.countryRef=null,this.name=null,this.externalCode=null}static initFromSituationNode(t){const e=Gt.queryText("siri:Source/siri:SourceType",t);if(null===e)return console.log("ERROR - cant PtSituationSource.initFromSituationNode"),console.log(t),null;const i=new wD(e);return i.countryRef=Gt.queryText("siri:Source/siri:CountryRef",t),i.name=Gt.queryText("siri:Source/siri:Name",t),i.externalCode=Gt.queryText("siri:Source/siri:ExternalCode",t),i}}class lS{constructor(t,e,i,r,s,d,m,y){this.situationNumber=t,this.creationTime=e,this.participantRef=i,this.version=r,this.source=s,this.validityPeriod=d,this.priority=m,this.situationContent=y,this.nodeXML=null}static initFromSituationNode(t){const e=Gt.queryText("siri:SituationNumber",t),i=Gt.queryText("siri:CreationTime",t);if(null===i)return console.error("ERROR: PtSituationElement.initFromSituationNode - creationTimeS is null"),console.log(t),null;const r=new Date(i),s=Gt.queryText("siri:ParticipantRef",t),d=Gt.queryText("siri:Version",t);if(null===d)return console.error("ERROR: PtSituationElement.initFromSituationNode - Version is NULL"),console.log(t),null;const m=parseInt(d),y=wD.initFromSituationNode(t),T=Gt.queryText("siri:ValidityPeriod/siri:StartTime",t),M=Gt.queryText("siri:ValidityPeriod/siri:EndTime",t);if(!T||!M)return console.error("ERROR: PtSituationElement.initFromSituationNode - ValidityPeriod is null"),console.log("      PtSituationElement.initFromSituationNode - ValidityPeriod/StartTime"+T),console.log("      PtSituationElement.initFromSituationNode - ValidityPeriod/EndTime"+M),null;const R={startDate:new Date(T),endDate:new Date(M)},H=Gt.queryText("siri:Priority",t);if(null===H)return console.error("ERROR: PtSituationElement.initFromSituationNode - Priority is NULL"),console.log(t),null;const Z=parseInt(H),te=xD.initFromSituationNode(t);if(!(e&&s&&y&&te))return console.error("ERROR: PtSituationElement.initFromSituationNode - cant init"),console.log(t),null;const xe=new lS(e,r,s,m,y,R,Z,te);return xe.nodeXML=t,xe}}class SD{constructor(t,e){if(this.timetableTime=t,this.estimatedTime=e,e){const i=(e.getTime()-t.getTime())/1e3;this.delayMinutes=Math.floor(i/60)}else this.delayMinutes=null}static initWithContextNode(t){const e=Gt.queryText("ojp:TimetabledTime",t);if(null===e)return null;const i=new Date(Date.parse(e));let r=null;const s=Gt.queryText("ojp:EstimatedTime",t);return s&&(r=new Date(Date.parse(s))),new SD(i,r)}}class Sh{constructor(t,e,i,r,s,d){this.stopPointType=t,this.location=e,this.arrivalData=i,this.departureData=r,this.plannedPlatform=s,this.actualPlatform=null,this.sequenceOrder=d,this.siriSituationIds=[],this.siriSituations=[]}static initWithContextNode(t,e){if(null===Gt.queryText("siri:StopPointRef",e))return null;const r=fs.initWithOJPContextNode(e),s=Sh.computeStopPointTime("ServiceArrival",e),d=Sh.computeStopPointTime("ServiceDeparture",e),m=Gt.queryText("ojp:PlannedQuay/ojp:Text",e),y=Gt.queryText("ojp:Order",e),T=null===y?null:parseInt(y,10),M=new Sh(t,r,s,d,m,T);return M.actualPlatform=Gt.queryText("ojp:EstimatedQuay/ojp:Text",e),M.siriSituationIds=[],Gt.queryNodes("ojp:SituationFullRef/siri:SituationNumber",e).forEach(H=>{const Z=Gt.queryText(".",H);Z&&M.siriSituationIds.push(Z)}),M}static computeStopPointTime(t,e){const r=Gt.queryNode("ojp:"+t,e);return null===r?null:SD.initWithContextNode(r)}patchSituations(t){this.siriSituations=[],this.siriSituationIds.forEach(e=>{var i;const r=null!==(i=t[e])&&void 0!==i?i:null;r&&this.siriSituations.push(r)})}}class CD{constructor(t,e,i){this.ptMode=t,this.name=e,this.shortName=i,this.isDemandMode=!1}static initFromServiceNode(t){const e=Gt.queryText("ojp:Mode/ojp:PtMode",t);if(null===e)return null;const i=Gt.queryText("ojp:Mode/ojp:Name/ojp:Text",t),r=Gt.queryText("ojp:Mode/ojp:ShortName/ojp:Text",t),s=new CD(e,i,r),d=Gt.queryText("ojp:Mode/siri:BusSubmode",t);return s.isDemandMode="demandAndResponseBus"===d||"unknown"===d,s}isRail(){return"rail"===this.ptMode}hasPrecisePolyline(){if(this.isDemandMode)return!0;const e=this.computePublicTransportPictogram();return-1===["picto-bus","picto-bus-fallback","picto-tram"].indexOf(e)}computePublicTransportPictogram(){return"bus"===this.ptMode?"picto-bus":this.isRail()?"picto-railway":"tram"===this.ptMode?"picto-tram":"CC"===this.shortName?"picto-rack-railway":"FUN"===this.shortName?"picto-funicular":"PB"===this.shortName?"picto-cablecar":"GB"===this.shortName?"picto-gondola":"SL"===this.shortName?"picto-chairlift":"water"===this.ptMode?"picto-boat":this.isDemandMode?"car-sharing":"picto-bus-fallback"}}class cS{constructor(t,e,i){this.journeyRef=t,this.ptMode=e,this.agencyID=i,this.originStopPlace=null,this.destinationStopPlace=null,this.serviceLineNumber=null,this.journeyNumber=null,this.siriSituationIds=[],this.siriSituations=[]}static initFromContextNode(t){const e=Gt.queryNode("ojp:Service",t);if(null===e)return null;const i=Gt.queryText("ojp:JourneyRef",e),r=CD.initFromServiceNode(e),s=Gt.queryText("ojp:OperatorRef",e),d=null==s?void 0:s.replace("ojp:","");if(!(i&&r&&d))return null;const m=new cS(i,r,d);return m.originStopPlace=zp.initFromServiceNode(e,"Origin"),m.destinationStopPlace=zp.initFromServiceNode(e,"Destination"),m.serviceLineNumber=Gt.queryText("ojp:PublishedLineName/ojp:Text",e),m.journeyNumber=Gt.queryText("ojp:Extension/ojp:PublishedJourneyNumber/ojp:Text",t),m.siriSituationIds=[],Gt.queryNodes("ojp:SituationFullRef/siri:SituationNumber",e).forEach(T=>{const M=Gt.queryText(".",T);M&&m.siriSituationIds.push(M)}),m}computeLegLineType(){return"801"===this.agencyID?"PostAuto":this.ptMode.isRail()?"LongDistanceRail":this.ptMode.isDemandMode?"OnDemand":"Bus"}formatServiceName(){var t,e,i,r;if(this.ptMode.isDemandMode)return null!==(t=this.serviceLineNumber)&&void 0!==t?t:"OnDemand";const s=[];return this.serviceLineNumber?(this.ptMode.isRail()||s.push(null!==(e=this.ptMode.shortName)&&void 0!==e?e:this.ptMode.ptMode),s.push(this.serviceLineNumber),s.push(null!==(i=this.journeyNumber)&&void 0!==i?i:"")):s.push(null!==(r=this.ptMode.shortName)&&void 0!==r?r:this.ptMode.ptMode),s.push("("+this.agencyID+")"),s.join(" ")}}class TD{constructor(t,e){this.stopPoint=t,this.journeyService=e,this.prevStopPoints=[],this.nextStopPoints=[]}static initFromContextNode(t){const e=Gt.queryNode("ojp:ThisCall/ojp:CallAtStop",t);if(null===e)return null;const i=Sh.initWithContextNode("Intermediate",e);if(null===i)return null;const r=cS.initFromContextNode(t);if(null===r)return null;const s=new TD(i,r);return["PreviousCall","OnwardCall"].forEach(m=>{const T=Gt.queryNodes("ojp:"+m+"/ojp:CallAtStop",t);if(0===T.length)return;let R="PreviousCall"===m?s.prevStopPoints:s.nextStopPoints;T.forEach(H=>{const Z=Sh.initWithContextNode("Intermediate",H);Z&&R.push(Z)})}),s}patchStopEventLocations(t){let e=[this.stopPoint];["prev","next"].forEach(r=>{e=e.concat("prev"===r?this.prevStopPoints:this.nextStopPoints)}),e.forEach(r=>{const s=r.location.stopPointRef;s&&s in t&&(r.location=t[s])})}asStationBoard(){var t,e,i;const r=this.computeServiceLineNumber(),s=null!==(t=this.journeyService.ptMode.shortName)&&void 0!==t?t:"N/A",d=this.computeStopTimeData(this.stopPoint.arrivalData),m=this.computeStopTimeData(this.stopPoint.departureData);return{stopEvent:this,serviceLineNumber:r,servicePtMode:s,tripNumber:this.journeyService.journeyNumber,tripHeading:null!==(i=null===(e=this.journeyService.destinationStopPlace)||void 0===e?void 0:e.stopPlaceName)&&void 0!==i?i:"N/A",tripOperator:this.journeyService.agencyID,mapStationBoardTime:{Arrivals:d,Departures:m},stopPlatform:this.stopPoint.plannedPlatform,stopPlatformActual:this.stopPoint.actualPlatform,stopSituations:this.stopPoint.siriSituations}}computeServiceLineNumber(){var t;const e=null!==(t=this.journeyService.ptMode.shortName)&&void 0!==t?t:"N/A";return this.journeyService.serviceLineNumber||e}computeStopTimeData(t){var e;if(null===t)return null;const i=null!==t.delayMinutes,r=Il.formatTimeHHMM(t.timetableTime),s=t.estimatedTime?Il.formatTimeHHMM(t.estimatedTime):"n/a",d=!!t.estimatedTime&&r!==s,m=this.computeStopTime(t.timetableTime);return null===m?null:{stopTime:m,stopTimeActual:this.computeStopTime(null!==(e=t.estimatedTime)&&void 0!==e?e:null),stopDelayText:this.computeDelayTime(t),hasDelay:i,hasDelayDifferentTime:d}}computeStopTime(t){return null===t?null:Il.formatTimeHHMM(t)}computeDelayTime(t){var e;const i=null!==(e=t.delayMinutes)&&void 0!==e?e:null;if(null===i)return null;if(0===i)return"ON TIME";const r=[];return r.push(" "),r.push(i>0?"+":""),r.push(""+i),r.push("'"),r.join("")}}var nW=tt(904),iW=tt(472);class qb{constructor(t){this.stageConfig=t,this.serviceRequestNode=this.computeServiceRequestNode(),this.logRequests=!1,this.lastRequestData={requestXmlS:null,requestDatetime:null,responseXmlS:null,responseDatetime:null}}computeServiceRequestNode(){const t=nW.create("OJP",{encoding:"utf-8"});t.att("xmlns","http://www.siri.org.uk/siri"),t.att("xmlns:xsi","http://www.w3.org/2001/XMLSchema-instance"),t.att("xmlns:xsd","http://www.w3.org/2001/XMLSchema"),t.att("xmlns:ojp","http://www.vdv.de/ojp"),t.att("xsi:schemaLocation","http://www.siri.org.uk/siri ../ojp-xsd-v1.0/OJP.xsd"),t.att("version","1.0");const e=t.ele("OJPRequest").ele("ServiceRequest");return e.ele("RequestorRef","OJP SDK v1.0"),e}fetchOJPResponse(t,e){const i=this.stageConfig.apiEndpoint,s=iW(i,{headers:{"Content-Type":"text/xml",Authorization:"Bearer "+this.stageConfig.authBearerKey},body:t,method:"POST"});this.logRequests&&(console.log("OJP Request: /POST - "+i),console.log(t));const d={requestXmlS:t,requestDatetime:new Date,responseXmlS:null,responseDatetime:null};this.lastRequestData=d,s.then(m=>{m.text().then(y=>{d.responseXmlS=y,d.responseDatetime=new Date,e(y,null)}).catch(y=>{e("",{error:"ParseTextError",message:y})})}).catch(m=>{e("",{error:"FetchError",message:"API Endpoint Error: "+m})})}}class rW{constructor(t,e){this.requestData=t,this.response=e}}class uS{constructor(t,e){this.coordinates=t,this.bbox=e}static initFromTrackSectionNode(t){const e=[];if(Gt.queryNodes("ojp:LinkProjection/ojp:Position",t).forEach(d=>{const m=Gt.queryText("siri:Longitude",d),y=Gt.queryText("siri:Latitude",d);if(m&&y){const T=new oa(parseFloat(m),parseFloat(y));e.push(T)}}),e.length<2)return null;const r=new Vp(e);return new uS(e,r)}asGeoJSONFeature(){const t={type:"Feature",bbox:this.bbox.asFeatureBBOX(),properties:{},geometry:{type:"LineString",coordinates:[]}};return this.coordinates.forEach(e=>{t.geometry.coordinates.push([e.longitude,e.latitude])}),t}}class ED{constructor(t){this.sections=t}static initFromTripLeg(t){const e=Gt.queryNodes("ojp:PathGuidance/ojp:PathGuidanceSection",t);let i=[];return e.forEach(s=>{const d=DD.initFromSectionNode(s);d&&i.push(d)}),new ED(i)}}class DD{constructor(){this.trackSection=null,this.guidanceAdvice=null,this.turnAction=null}static initFromSectionNode(t){const e=new DD,i=Gt.queryNode("ojp:TrackSection",t);return i&&(e.trackSection=ID.initFromTrackSectionNode(i)),e.guidanceAdvice=Gt.queryText("ojp:GuidanceAdvice",t),e.turnAction=Gt.queryText("ojp:TurnAction",t),e}}class ID{constructor(){this.linkProjection=null,this.roadName=null,this.duration=null,this.length=null}static initFromTrackSectionNode(t){const e=new ID;e.linkProjection=uS.initFromTrackSectionNode(t),e.roadName=Gt.queryText("ojp:RoadName",t),e.duration=Gt.queryText("ojp:Duration",t);const i=Gt.queryText("ojp:Length",t);return i&&(e.length=parseInt(i,10)),e}}class dS{constructor(t){this.trackSections=t;let e=0;this.hasGeoData=!1,t.forEach(i=>{i.linkProjection&&(this.hasGeoData=!0),i.duration&&(e+=i.duration.totalMinutes)}),this.duration=null,e>0&&(this.duration=hd.initFromTotalMinutes(e))}static initFromLegNode(t){const e=Gt.queryNode("ojp:LegTrack",t);if(null===e)return null;let i=[];return Gt.queryNodes("ojp:TrackSection",e).forEach(d=>{const m=MD.initFromContextNode(d);m&&i.push(m)}),new dS(i)}fromGeoPosition(){if(0===this.trackSections.length)return null;const e=this.trackSections[0].linkProjection;return null===e?null:e.coordinates[0]}toGeoPosition(){if(0===this.trackSections.length)return null;const e=this.trackSections[this.trackSections.length-1].linkProjection;return null===e?null:e.coordinates[e.coordinates.length-1]}}class MD{constructor(t,e){this.fromLocation=t,this.toLocation=e,this.duration=null,this.length=null,this.linkProjection=null}static initFromContextNode(t){const e=Gt.queryNode("ojp:TrackStart",t),i=Gt.queryNode("ojp:TrackEnd",t);if(null===e||null===i)return null;const r=fs.initWithOJPContextNode(e),s=fs.initWithOJPContextNode(i),d=new MD(r,s);d.duration=hd.initFromContextNode(t);const m=Gt.queryText("ojp:Length",t);return m&&(d.length=parseInt(m,10)),d.linkProjection=uS.initFromTrackSectionNode(t),d}}class O2{constructor(t,e,i,r){this.legType=t,this.legID=e,this.fromLocation=i,this.toLocation=r,this.legTrack=null,this.legDuration=null}patchLocations(t){[this.fromLocation,this.toLocation].forEach(e=>{var i;this.patchLocation(e,t),!e.geoPosition&&null!==(i=this.legTrack)&&void 0!==i&&i.hasGeoData&&(e===this.fromLocation?this.fromLocation.geoPosition=this.legTrack.fromGeoPosition():this.toLocation.geoPosition=this.legTrack.toGeoPosition())})}patchSituations(t){}patchLocation(t,e){if(t.geoPosition)return;const i=t.stopPointRef;if(i&&i in e){const r=e[i];t.locationName=r.locationName,t.stopPlace=r.stopPlace,t.geoPosition=r.geoPosition}}computeGeoJSONFeatures(){let t=[];if(this.useBeeline()){const r=this.computeBeelineFeature();r&&t.push(r)}const i=this.computeLinePointFeatures();return t=t.concat(i),t=t.concat(this.computeSpecificJSONFeatures()),t.forEach(r=>{r.properties&&(r.properties["leg.idx"]=this.legID-1,r.properties[ps.LegType]=this.computeLegType())}),t}useBeeline(){var t;return!(null!==(t=this.legTrack)&&void 0!==t&&t.hasGeoData)}computeLegType(){return"TimedLeg"==this.legType?"TimedLeg":"TransferLeg"==this.legType?"TransferLeg":"ContinousLeg"==this.legType?"ContinousLeg":"n/a"}computeSpecificJSONFeatures(){return[]}computeLegColor(){var t;return null!==(t=Iv[this.legType])&&void 0!==t?t:Iv.TimedLeg}computeLinePointsData(){const t=[];return[this.fromLocation,this.toLocation].forEach(i=>{var r,s;const d=i.asGeoJSONFeature();if(null!=d&&d.properties){const m=i===this.fromLocation,y=m?"From":"To",T=m?null===(r=this.legTrack)||void 0===r?void 0:r.fromGeoPosition():null===(s=this.legTrack)||void 0===s?void 0:s.toGeoPosition();T&&(d.geometry.coordinates=T.asPosition()),t.push({type:y,feature:d})}}),t}computeLinePointFeatures(){const t=[],e=this.computeLegLineType();return this.computeLinePointsData().forEach(r=>{const d=r.feature;null!==d.properties&&(d.properties[ps.PointType]=r.type,d.properties[ps.DrawType]="LegPoint",d.properties[ps.LineType]=e,d.bbox=[d.geometry.coordinates[0],d.geometry.coordinates[1],d.geometry.coordinates[0],d.geometry.coordinates[1]],t.push(d))}),t}computeLegLineType(){return"Unknown"}computeBeelineFeature(){const t=this.computeBeelineGeoPositions();if(t.length<2)return null;const e=[];t.forEach(y=>{e.push(y.asPosition())});const i={};i[ps.DrawType]="Beeline";const s=this.computeLegLineType();i[ps.LineType]=s;const d=new Vp(t);return{type:"Feature",properties:i,geometry:{type:"LineString",coordinates:e},bbox:d.asFeatureBBOX()}}computeBeelineGeoPositions(){const t=[];return[this.fromLocation,this.toLocation].forEach(i=>{i.geoPosition&&t.push(i.geoPosition)}),t}}class hS{constructor(t){this.bookingArrangements=t}static initWithContextNode(t){const e=Gt.queryNodes("ojp:service/ojp:BookingArrangements/ojp:BookingArrangement",t);if(0===e.length)return console.error("ERROR - no BookingArrangements nodes found"),null;const i=[];return e.forEach(s=>{const d=Gt.queryText("ojp:BookingAgencyName/ojp:Text",s);let m=Gt.queryText("ojp:InfoUrl",s);if(null===d||null===m||(m=m.trim(),m.length<2))return;"<"===m[0]&&(m=m.substring(1,m.length-1));var y=document.createElement("textarea");y.innerHTML=m.trim(),m=y.innerText;const T={agencyCode:d.trim(),agencyName:hS.computeAgencyName(d),infoURL:m};i.push(T)}),new hS(i)}static computeAgencyName(t){return(t=t.trim()).endsWith("_local.ch")?"local.ch":t.endsWith("_maps.google.ch")?"maps.google.com":t.endsWith("_openstreetmap.org")?"openstreetmap.org":"n/a catalog: "+t}}class pS extends O2{constructor(t,e,i,r,s){super(t,e,r,s),this.legTransportMode=null,this.legDistance=i,this.pathGuidance=null,this.walkDuration=null,this.serviceBooking=null}static initFromTripLeg(t,e,i){if(null===e)return null;const r=Gt.queryNode("ojp:LegStart",e),s=Gt.queryNode("ojp:LegEnd",e);if(null===r||null===s)return null;const d=fs.initWithOJPContextNode(r),m=fs.initWithOJPContextNode(s);let y=Gt.queryText("ojp:Length",e);null===y&&(y="0");const T=parseInt(y),M=new pS(i,t,T,d,m);return M.legDuration=hd.initFromContextNode(e),M.pathGuidance=ED.initFromTripLeg(e),M.legTransportMode=M.computeLegTransportMode(e),("taxi"===M.legTransportMode||"others-drive-car"===M.legTransportMode)&&(M.serviceBooking=hS.initWithContextNode(e)),M.legTrack=dS.initFromLegNode(e),"TransferLeg"===i&&(M.walkDuration=hd.initFromContextNode(e,"ojp:WalkDuration")),M}computeLegTransportMode(t){const e=Gt.queryText("ojp:Service/ojp:IndividualMode",t);if(null===e)return null;if("walk"===e)return"walk";if("self-drive-car"===e)return"self-drive-car";if("cycle"===e)return"cycle";if("taxi"===e){const i=Gt.queryText("ojp:Service/ojp:BookingArrangements/ojp:BookingArrangement/ojp:BookingAgencyName/ojp:Text",t);return-1!==(null==i?void 0:i.indexOf("_limousine_"))?"others-drive-car":"taxi"}return null}isDriveCarLeg(){return"self-drive-car"===this.legTransportMode}isSharedMobility(){return null!==this.legTransportMode&&-1!==["cycle","bicycle_rental","car_sharing","escooter_rental"].indexOf(this.legTransportMode)}isWalking(){return"walk"===this.legTransportMode}isTaxi(){return"taxi"===this.legTransportMode||"others-drive-car"===this.legTransportMode}computeSpecificJSONFeatures(){var t,e;const i=[];return null===(t=this.pathGuidance)||void 0===t||t.sections.forEach((r,s)=>{var d,m,y,T,M,R,H,Z,te,xe;const Ce=null===(m=null===(d=r.trackSection)||void 0===d?void 0:d.linkProjection)||void 0===m?void 0:m.asGeoJSONFeature();null!=Ce&&Ce.properties&&(Ce.properties[ps.DrawType]="LegLine",Ce.properties[ps.LineType]="Guidance",Ce.properties["PathGuidanceSection.idx"]=s,Ce.properties["PathGuidanceSection.TrackSection.RoadName"]=null!==(T=null===(y=r.trackSection)||void 0===y?void 0:y.roadName)&&void 0!==T?T:"",Ce.properties["PathGuidanceSection.TrackSection.Duration"]=null!==(R=null===(M=r.trackSection)||void 0===M?void 0:M.duration)&&void 0!==R?R:"",Ce.properties["PathGuidanceSection.TrackSection.Length"]=null!==(Z=null===(H=r.trackSection)||void 0===H?void 0:H.length)&&void 0!==Z?Z:"",Ce.properties["PathGuidanceSection.GuidanceAdvice"]=null!==(te=r.guidanceAdvice)&&void 0!==te?te:"",Ce.properties["PathGuidanceSection.TurnAction"]=null!==(xe=r.turnAction)&&void 0!==xe?xe:"",i.push(Ce))}),null===(e=this.legTrack)||void 0===e||e.trackSections.forEach(r=>{var s;const d=null===(s=r.linkProjection)||void 0===s?void 0:s.asGeoJSONFeature();null!=d&&d.properties&&(d.properties[ps.DrawType]="LegLine",d.properties[ps.LineType]=this.computeLegLineType(),i.push(d))}),i}computeLegLineType(){return this.isDriveCarLeg()?"Self-Drive Car":this.isSharedMobility()?"Shared Mobility":this.isTaxi()?"OnDemand":"TransferLeg"===this.legType?"Transfer":"Walk"}computeLinePointsData(){return"TransferLeg"===this.legType?[]:super.computeLinePointsData()}computeLegColor(){return this.isDriveCarLeg()?Mm["Self-Drive Car"]:this.isSharedMobility()?Mm["Shared Mobility"]:"TransferLeg"===this.legType?Mm.Transfer:this.isTaxi()?Mm.OnDemand:Mm.Walk}formatDistance(){return this.legDistance>1e3?(this.legDistance/1e3).toFixed(1)+" km":this.legDistance+" m"}useBeeline(){if("TransferLeg"===this.legType){if(null===this.pathGuidance)return super.useBeeline();let t=!1;return this.pathGuidance.sections.forEach(e=>{var i;null!==(i=e.trackSection)&&void 0!==i&&i.linkProjection&&(t=!0)}),!1===t}return super.useBeeline()}}class Mv extends O2{constructor(t,e,i,r,s=[]){super("TimedLeg",t,i.location,r.location),this.service=e,this.fromStopPoint=i,this.toStopPoint=r,this.intermediateStopPoints=s}static initFromTripLeg(t,e){var i;if(null===e)return null;const r=cS.initFromContextNode(e);if(null===r)return null;const s=Gt.queryNode("ojp:LegBoard",e),d=Gt.queryNode("ojp:LegAlight",e);if(null===s||null===d)return null;const m=Sh.initWithContextNode("From",s),y=Sh.initWithContextNode("To",d);if(null===m||null===y)return null;const T=[];(null!==(i=Gt.queryNodes("ojp:LegIntermediates",e))&&void 0!==i?i:[]).forEach(H=>{const Z=Sh.initWithContextNode("Intermediate",H);Z&&T.push(Z)});const R=new Mv(t,r,m,y,T);return R.legTrack=dS.initFromLegNode(e),R.legTrack&&null===R.legDuration&&(R.legDuration=R.legTrack.duration),R}patchLocations(t){super.patchLocations(t),this.intermediateStopPoints.forEach(e=>{this.patchLocation(e.location,t)})}computeDepartureTime(){return this.computeStopPointTime(this.fromStopPoint.departureData)}computeArrivalTime(){return this.computeStopPointTime(this.toStopPoint.arrivalData)}computeStopPointTime(t){var e;return null===t?null:null!==(e=t.estimatedTime)&&void 0!==e?e:t.timetableTime}computeSpecificJSONFeatures(){var t;let e=[];const i=this.service.computeLegLineType();return!this.useBeeline()&&(null===(t=this.legTrack)||void 0===t||t.trackSections.forEach(s=>{var d;const m=null===(d=s.linkProjection)||void 0===d?void 0:d.asGeoJSONFeature();null!=m&&m.properties&&(m.properties[ps.DrawType]="LegLine",m.properties[ps.LineType]=i,e.push(m))})),e}computeLegLineType(){return this.service.computeLegLineType()}computeLinePointsData(){const t=super.computeLinePointsData();return this.intermediateStopPoints.forEach(e=>{const i=e.location.asGeoJSONFeature();null!=i&&i.properties&&t.push({type:"Intermediate",feature:i})}),t}computeLegColor(){var t;const e=super.computeLegColor(),i=this.service.computeLegLineType();return null!==(t=Mm[i])&&void 0!==t?t:e}computeBeelineGeoPositions(){const t=[],e=[];return e.push(this.fromStopPoint),this.intermediateStopPoints.forEach(i=>{e.push(i)}),e.push(this.toStopPoint),e.forEach(i=>{i.location.geoPosition&&t.push(i.location.geoPosition)}),t}useBeeline(){const t=this.service.ptMode.hasPrecisePolyline();return super.useBeeline()||!t}patchSituations(t){this.service.siriSituations=[],this.service.siriSituationIds.forEach(e=>{var i;const r=null!==(i=t[e])&&void 0!==i?i:null;r&&this.service.siriSituations.push(r)})}}class AD{constructor(t,e,i){this.id=t,this.legs=e,this.stats=i}static initFromTripResultNode(t){const e=Gt.queryText("ojp:Trip/ojp:TripId",t);if(null===e)return null;const i=Gt.queryNode("ojp:Trip",t),r=hd.initFromContextNode(i);if(null===r)return null;const s=Gt.queryText("ojp:Trip/ojp:Distance",t);if(null===s)return null;const d=Gt.queryText("ojp:Trip/ojp:Transfers",t);if(null===d)return null;const m=Gt.queryText("ojp:Trip/ojp:StartTime",t),y=Gt.queryText("ojp:Trip/ojp:EndTime",t);if(null===m||null===y)return null;const T=new Date(Date.parse(m)),M=new Date(Date.parse(y)),R={duration:r,distanceMeters:parseInt(s),transferNo:parseInt(d),startDatetime:T,endDatetime:M};let H=[];return Gt.queryNodes("ojp:Trip/ojp:TripLeg",t).forEach(xe=>{const Ce=class oW{static initWithContextNode(t){const e=Gt.queryText("ojp:LegId",t);if(null===e)return null;const i=parseInt(e,10),r=Gt.queryNode("ojp:ContinuousLeg",t),s=pS.initFromTripLeg(i,r,"ContinousLeg");if(s)return s;const d=Gt.queryNode("ojp:TimedLeg",t),m=Mv.initFromTripLeg(i,d);if(m)return m;const y=Gt.queryNode("ojp:TransferLeg",t);return pS.initFromTripLeg(i,y,"TransferLeg")||(console.log("Cant factory leg #"+i),console.log(t),null)}}.initWithContextNode(xe);null!==Ce&&H.push(Ce)}),new AD(e,H,R)}computeDepartureTime(){var t;const e=this.legs.filter(d=>d instanceof Mv);if(0===e.length)return console.log("No TimedLeg found for this trip"),console.log(this),null;const r=e[0].fromStopPoint.departureData;return null===r?null:null!==(t=r.estimatedTime)&&void 0!==t?t:r.timetableTime}computeArrivalTime(){var t;const e=this.legs.filter(d=>d instanceof Mv);if(0===e.length)return console.log("No TimedLeg found for this trip"),console.log(this),new Date;const r=e[e.length-1].toStopPoint.arrivalData;return null===r?null:null!==(t=r.estimatedTime)&&void 0!==t?t:r.timetableTime}computeGeoJSON(){let t=[];return this.legs.forEach(i=>{const r=i.computeGeoJSONFeatures();t=t.concat(r)}),{type:"FeatureCollection",features:t}}computeFromLocation(){return 0===this.legs.length?null:this.legs[0].fromLocation}computeToLocation(){return 0===this.legs.length?null:this.legs[this.legs.length-1].toLocation}computeBBOX(){var t,e;const i=new Vp([]),r=null===(t=this.computeFromLocation())||void 0===t?void 0:t.geoPosition;r&&i.extend(r);const s=null===(e=this.computeToLocation())||void 0===e?void 0:e.geoPosition;return s&&i.extend(s),this.legs.forEach(d=>{d.computeGeoJSONFeatures().forEach(y=>{var T;const M=null!==(T=y.bbox)&&void 0!==T?T:null;null!==M&&(i.extend(new oa(M[0],M[1])),i.extend(new oa(M[2],M[3])))})}),i}debugTrip(){console.log("DEBUG - TRIP"),console.log(this),this.legs.forEach((t,e)=>{const i=t.computeGeoJSONFeatures();console.log("DEBUG - leg "+e),console.log(t),i.forEach(r=>{console.log(r)})})}}class pd{constructor(t,e,i,r){this.hasValidResponse=t,this.responseXMLText=e,this.contextLocations=i,this.trips=r}static initWithXML(t,e,i){const r=(new DOMParser).parseFromString(t,"application/xml"),d="true"===Gt.queryText("//siri:OJPResponse/siri:ServiceDelivery/siri:Status",r),m=pd.parseContextLocations(r),y=pd.parseContextSituations(r),T=pd.parseTrips(r,m,y,e,i);return new pd(d,t,m,T)}static parseContextLocations(t){let e=[];return Gt.queryNodes("//ojp:TripResponseContext/ojp:Places/ojp:Location",t).forEach(r=>{const s=fs.initWithOJPContextNode(r);e.push(s)}),e}static parseContextSituations(t){let e=[];return Gt.queryNodes("//ojp:TripResponseContext/ojp:Situations/ojp:PtSituation",t).forEach(r=>{const s=lS.initFromSituationNode(r);s&&e.push(s)}),e}static parseTrips(t,e,i,r,s){const d=[],m={};e.forEach(M=>{var R;const H=null===(R=M.stopPlace)||void 0===R?void 0:R.stopPlaceRef;H&&(m[H]=M)});const y={};return i.forEach(M=>{y[M.situationNumber]=M}),Gt.queryNodes("//ojp:TripResult",t).forEach(M=>{const R=AD.initFromTripResultNode(M);R&&(R.legs.forEach(H=>{H.patchLocations(m),H.patchSituations(y)}),d.push(R))}),pd.sortTrips(d,r,s),d}static sortTrips(t,e,i){var r;if("monomodal"!==e)return;const s=null!==(r=t.find(d=>1===d.legs.length&&"ContinousLeg"===d.legs[0].legType&&d.legs[0].legTransportMode===i))&&void 0!==r?r:null;if(s){const d=t.indexOf(s);t.splice(d,1),t.unshift(s)}}}class L2 extends qb{constructor(t,e){super(t),this.requestParams=e}fetchResponse(t){this.buildTripRequestNode();const e=this.serviceRequestNode.end({pretty:!0});super.fetchOJPResponse(e,(i,r)=>{const s=pd.initWithXML(i,this.requestParams.modeType,this.requestParams.transportMode);null===r&&!s.hasValidResponse&&(r={error:"ParseTripsXMLError",message:"Invalid TripsRequest Response XML"}),t(s,r)})}computeRequestXmlString(){return this.buildTripRequestNode(),this.serviceRequestNode.end({pretty:!0})}buildTripRequestNode(){const e=(new Date).toISOString();this.serviceRequestNode.ele("RequestTimestamp",e);const i=this.serviceRequestNode.ele("ojp:OJPTripRequest");i.ele("RequestTimestamp",e);const s="monomodal"===this.requestParams.modeType,d=this.requestParams.transportMode,m=["From","To"];m.forEach(R=>{var H,Z,te,xe;const Ce="From"===R,et=Ce?this.requestParams.fromTripLocation:this.requestParams.toTripLocation,kt=et.location,en=i.ele("ojp:"+(Ce?"Origin":"Destination")),Xn=en.ele("ojp:PlaceRef");if(null!==(H=kt.stopPlace)&&void 0!==H&&H.stopPlaceRef){const si=null!==(Z=kt.locationName)&&void 0!==Z?Z:"n/a";let Ni=null!==(xe=null===(te=kt.stopPlace)||void 0===te?void 0:te.stopPlaceRef)&&void 0!==xe?xe:"";Xn.ele("StopPointRef",Ni),Xn.ele("ojp:LocationName").ele("ojp:Text",si)}else if(kt.geoPosition){const si=Xn.ele("ojp:GeoPosition");si.ele("Longitude",kt.geoPosition.longitude),si.ele("Latitude",kt.geoPosition.latitude);const Ni=kt.geoPosition.asLatLngString();Xn.ele("ojp:LocationName").ele("ojp:Text",Ni)}if(Ce){const si=this.requestParams.departureDate.toISOString();en.ele("ojp:DepArrTime",si)}if(s){if(Ce&&-1!==["walk","cycle"].indexOf(d)){const Ni=en.ele("ojp:IndividualTransportOptions");Ni.ele("ojp:Mode",d),"walk"===d&&Ni.ele("ojp:MaxDuration","PT3000M"),"cycle"===d&&Ni.ele("ojp:MaxDuration","PT600M")}}else if(("taxi"===d||"others-drive-car"===d)&&(()=>!(Ce&&"mode_at_end"===this.requestParams.modeType||!Ce&&"mode_at_start"===this.requestParams.modeType))()){const Zr=en.ele("ojp:IndividualTransportOptions");et.customTransportMode&&Zr.ele("ojp:Mode",et.customTransportMode),Zr.ele("ojp:MinDuration","PT"+et.minDuration+"M"),Zr.ele("ojp:MaxDuration","PT"+et.maxDuration+"M"),Zr.ele("ojp:MinDistance",et.minDistance),Zr.ele("ojp:MaxDistance",et.maxDistance)}});const y=i.ele("ojp:Params");if(y.ele(this.requestParams.useNumberOfResultsAfter?"ojp:NumberOfResultsAfter":"ojp:NumberOfResults",5),this.requestParams.useNumberOfResultsAfter&&y.ele("ojp:NumberOfResultsBefore",0),y.ele("ojp:IncludeTrackSections",!0),y.ele("ojp:IncludeLegProjection",this.requestParams.includeLegProjection),y.ele("ojp:IncludeTurnDescription",!0),y.ele("ojp:IncludeIntermediateStops",!0),s)-1!==["walk","self-drive-car","cycle","taxi","others-drive-car"].indexOf(d)&&y.ele("ojp:ItModesToCover",d),-1!==["bicycle_rental","car_sharing","escooter_rental"].indexOf(d)&&y.ele("ojp:Extension").ele("ojp:ItModesToCover",d);else if("taxi"!==d&&"others-drive-car"!==d){const Z=y.ele("ojp:Extension");m.forEach(te=>{const xe="From"===te;if(xe&&"mode_at_end"===this.requestParams.modeType||!xe&&"mode_at_start"===this.requestParams.modeType)return;const Ce=xe?this.requestParams.fromTripLocation:this.requestParams.toTripLocation,kt=Z.ele("ojp:"+(xe?"Origin":"Destination"));kt.ele("ojp:MinDuration","PT"+Ce.minDuration+"M"),kt.ele("ojp:MaxDuration","PT"+Ce.maxDuration+"M"),kt.ele("ojp:MinDistance",Ce.minDistance),kt.ele("ojp:MaxDistance",Ce.maxDistance),Ce.customTransportMode&&kt.ele("ojp:Mode",Ce.customTransportMode)})}}}class fS{constructor(t,e,i){this.fromTripLocation=t,this.toTripLocation=e,this.departureDate=i,this.modeType="monomodal",this.transportMode="public_transport",this.includeLegProjection=!0,this.useNumberOfResultsAfter=!0}static initWithLocationsAndDate(t,e,i){return null===t||null===e||!t.location.geoPosition&&!t.location.stopPlace||!e.location.geoPosition&&!e.location.stopPlace?null:new fS(t,e,i)}}class sW extends qb{constructor(t,e){super(t),this.requestParams=e,this.lastJourneyResponse=null}fetchResponse(t){const e=new eW([]),i=this.requestParams.departureDate;this.lastJourneyResponse=null,this.computeTripResponse(0,i,e,t)}computeTripResponse(t,e,i,r){const s=t===this.requestParams.tripModeTypes.length-1,y=fS.initWithLocationsAndDate(this.requestParams.tripLocations[t],this.requestParams.tripLocations[t+1],e);if(null===y)return void console.error("JourneyRequest - TripsRequestParams null for trip idx "+t);y.includeLegProjection=this.requestParams.includeLegProjection,y.useNumberOfResultsAfter=this.requestParams.useNumberOfResultsAfter,y.modeType=this.requestParams.tripModeTypes[t],y.transportMode=this.requestParams.transportModes[t];const T=new L2(this.stageConfig,y);T.fetchResponse((M,R)=>{if(R)return void r([],R);if(T.lastRequestData){const Z=new rW(T.lastRequestData,M);i.sections.push(Z)}const H=M.trips.length>0;if(H||(console.error("ERROR: no trips found for section "+t+" MODE - "+y.modeType+" + "+y.transportMode),console.log(M)),s){const Z=i.computeAggregatedTrips();this.lastJourneyResponse=i,r(Z,null)}else H&&(e=M.trips[0].stats.endDatetime),this.computeTripResponse(t+1,e,i,r)})}}class kD{constructor(t,e,i,r){this.tripLocations=t,this.tripModeTypes=e,this.transportModes=i,this.departureDate=r,this.includeLegProjection=!0,this.useNumberOfResultsAfter=!0}static initWithLocationsAndDate(t,e,i,r,s,d){if(null===t||null===e)return null;if(!t.location.geoPosition&&!t.location.stopPlace||!e.location.geoPosition&&!e.location.stopPlace)return console.error("JourneyRequestParams.initWithLocationsAndDate - broken from, to"),console.log(t),console.log(e),null;let m=!1;if(i.forEach(M=>{null===M.location.geoPosition&&(m=!0)}),m)return console.error("JourneyRequestParams.initWithLocationsAndDate - broken via"),console.log(i),null;if(i.length+1!==r.length)return console.error("JourneyRequestParams.initWithLocationsAndDate - wrong via/mot types"),console.log(i),console.log(r),null;let y=[];return y.push(t),y=y.concat(i),y.push(e),new kD(y,r,s,d)}}class gu extends qb{constructor(t,e){super(t),this.requestParams=e}static initWithLocationName(t,e,i=null){const r={locationName:e};return null!==i&&(r.geoRestrictionType=i),new gu(t,r)}static initWithStopPlaceRef(t,e){return new gu(t,{stopPlaceRef:e})}static initWithBBOXAndType(t,e,i,r,s,d,m=1e3,y=null){return new gu(t,{bboxWest:e,bboxNorth:i,bboxEast:r,bboxSouth:s,numberOfResults:m,geoRestrictionType:d,poiOsmTags:y})}fetchResponse(){this.buildRequestNode();const t=this.serviceRequestNode.end({pretty:!0});return new Promise((i,r)=>{super.fetchOJPResponse(t,(s,d)=>{const m=(new DOMParser).parseFromString(s,"application/xml"),T="true"===Gt.queryText("//siri:OJPResponse/siri:ServiceDelivery/siri:Status",m),M=[];if(!T)return null===d&&!T&&(d={error:"ParseLocationInformationRequestXMLError",message:"Invalid LocationInformationRequest Response XML"}),void r(d);Gt.queryNodes("//ojp:OJPLocationInformationDelivery/ojp:Location",m).forEach(H=>{const Z=Gt.queryNode("ojp:Location",H);if(null===Z)return;const te=fs.initWithOJPContextNode(Z);M.push(te)}),i(M)})})}buildRequestNode(){var t,e,i,r,s,d,m;const T=(new Date).toISOString();this.serviceRequestNode.ele("RequestTimestamp",T);const M=this.serviceRequestNode.ele("ojp:OJPLocationInformationRequest");M.ele("RequestTimestamp",T);let R=null;const H=null!==(t=this.requestParams.locationName)&&void 0!==t?t:null;H&&(R=M.ele("ojp:InitialInput"),R.ele("ojp:LocationName",H));const Z=null!==(e=this.requestParams.stopPlaceRef)&&void 0!==e?e:null;if(Z){const si=M.ele("ojp:PlaceRef");si.ele("ojp:StopPlaceRef",Z),si.ele("ojp:LocationName").ele("ojp:Text","")}const te=null!==(i=this.requestParams.bboxWest)&&void 0!==i?i:null,xe=null!==(r=this.requestParams.bboxNorth)&&void 0!==r?r:null,Ce=null!==(s=this.requestParams.bboxEast)&&void 0!==s?s:null,et=null!==(d=this.requestParams.bboxSouth)&&void 0!==d?d:null;if(te&&xe&&Ce&&et){null===R&&(R=M.ele("ojp:InitialInput"));const si=R.ele("ojp:GeoRestriction").ele("ojp:Rectangle"),Ni=si.ele("ojp:UpperLeft");Ni.ele("Longitude",te.toFixed(6)),Ni.ele("Latitude",xe.toFixed(6));const Zr=si.ele("ojp:LowerRight");Zr.ele("Longitude",Ce.toFixed(6)),Zr.ele("Latitude",et.toFixed(6))}const kt=M.ele("ojp:Restrictions"),pt=null!==(m=this.requestParams.numberOfResults)&&void 0!==m?m:10;kt.ele("ojp:NumberOfResults",pt);const en=this.computeRestrictionType();if(en&&(kt.ele("ojp:Type",en),("poi_amenity"===this.requestParams.geoRestrictionType||"poi_all"===this.requestParams.geoRestrictionType)&&this.requestParams.poiOsmTags)){const Ni=kt.ele("ojp:PointOfInterestFilter").ele("ojp:PointOfInterestCategory"),Zr="poi_amenity"===this.requestParams.geoRestrictionType?"amenity":"POI";this.requestParams.poiOsmTags.forEach(_u=>{const sa=Ni.ele("ojp:OsmTag");sa.ele("ojp:Tag",Zr),sa.ele("ojp:Value",_u)})}M.ele("Extensions").ele("ParamsExtension").ele("PrivateModeFilter").ele("Exclude","false")}computeRestrictionType(){return"stop"===this.requestParams.geoRestrictionType?"stop":"poi_all"===this.requestParams.geoRestrictionType||"poi_amenity"===this.requestParams.geoRestrictionType?"poi":this.requestParams.geoRestrictionType}}class aW{constructor(t,e,i,r){this.stopPlaceRef=t,this.geoPosition=e,this.depArrTime=r,this.numberOfResults=10,this.stopEventType=i,this.includePreviousCalls=!1,this.includeOnwardCalls=!1,this.includeRealtimeData=!0}buildRequestXML(t){const e=(new Date).toISOString(),i=this.depArrTime.toISOString();t.ele("RequestTimestamp",e);const r=t.ele("ojp:OJPStopEventRequest");r.ele("RequestTimestamp",e);const s=r.ele("ojp:Location");if(this.stopPlaceRef){const T=s.ele("ojp:PlaceRef");T.ele("ojp:StopPlaceRef",this.stopPlaceRef),T.ele("ojp:LocationName").ele("ojp:Text","")}s.ele("ojp:DepArrTime",i);const d=r.ele("ojp:Params");return d.ele("ojp:NumberOfResults",this.numberOfResults),d.ele("ojp:StopEventType",this.stopEventType),d.ele("ojp:IncludePreviousCalls",this.includePreviousCalls),d.ele("ojp:IncludeOnwardCalls",this.includeOnwardCalls),d.ele("ojp:IncludeRealtimeData",this.includeRealtimeData),r.ele("Extensions").ele("ParamsExtension").ele("PrivateModeFilter").ele("Exclude","false"),t.end({pretty:!0})}}var lW=tt(978);class jp extends qb{constructor(t,e){e.includePreviousCalls=!0,e.includeOnwardCalls=!0,super(t),this.requestParams=e}fetchResponse(){const e=this.requestParams.buildRequestXML(this.serviceRequestNode);return new Promise(r=>{super.fetchOJPResponse(e,(s,d)=>{const m=jp.handleResponseData(s,d);r(m)})})}static handleResponseData(t,e){const i=[];if(null!==e)return console.error("ERROR StopEventRequest"),console.log(e),i;const r=(new lW.DOMParser).parseFromString(t,"application/xml"),s=jp.parseMapContextLocations(r),d=jp.parseContextSituations(r);return Gt.queryNodes("//ojp:OJPStopEventDelivery/ojp:StopEventResult/ojp:StopEvent",r).forEach(y=>{const T=TD.initFromContextNode(y);T&&(T.patchStopEventLocations(s),T.stopPoint.patchSituations(d),i.push(T))}),i}computeRequestXmlString(){return this.requestParams.buildRequestXML(this.serviceRequestNode)}static parseMapContextLocations(t){const e={};return Gt.queryNodes("//ojp:OJPStopEventDelivery/ojp:StopEventResponseContext/ojp:Places/ojp:Location",t).forEach(r=>{var s,d;const m=fs.initWithOJPContextNode(r),y=null!==(d=null===(s=m.stopPlace)||void 0===s?void 0:s.stopPlaceRef)&&void 0!==d?d:null;y&&(e[y]=m)}),e}static parseContextSituations(t){const e={};return Gt.queryNodes("//ojp:OJPStopEventDelivery/ojp:StopEventResponseContext/ojp:Situations/ojp:PtSituation",t).forEach(r=>{const s=lS.initFromSituationNode(r);s&&(e[s.situationNumber]=s)}),console.log(e),e}static initWithStopPlaceRef(t,e,i,r){const s=new aW(e,null,i,r);return new jp(t,s)}}class fd{constructor(t){this.location=t,this.minDuration=2,this.maxDuration=30,this.minDistance=100,this.maxDistance=2e4,this.customTransportMode=null}}const cW={key:"PROD",apiEndpoint:"https://api.opentransportdata.swiss/ojp2020",authBearerKey:"57c5dbbbf1fe4d00010000186ba6e4bb4be543a9b4e40d2d6495592b"};"localhost"===document.location.hostname&&console.log("USING experimental OJP-JS SDK");var uW=tt(898),$s=tt.n(uW);let Up=(()=>{class n{constructor(){this.newMapBoundsRequested=new on,this.newMapCenterAndZoomRequested=new on,this.initialMapCenter=null,this.initialMapZoom=null}tryToCenterAndZoomToLocation(e,i=16){var r,s;if(null===e)return;const d=null!==(s=null===(r=e.geoPosition)||void 0===r?void 0:r.asLngLat())&&void 0!==s?s:null;if(null===d)return;const m=new($s().LngLat)(d[0],d[1]);this.newMapCenterAndZoomRequested.emit({lnglat:m,zoom:i})}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=tn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),Nc=(()=>{class n{constructor(e){this.mapService=e,this.embedQueryParams=new URLSearchParams,this.defaultsInited=new on,this.locationsUpdated=new on,this.geoLocationsUpdated=new on,this.tripsUpdated=new on,this.activeTripSelected=new on,this.viaAtIndexRemoved=new on,this.viaAtIndexUpdated=new on,this.searchParamsReset=new on,this.queryParams=new URLSearchParams(document.location.search),this.fromTripLocation=null,this.toTripLocation=null,this.viaTripLocations=[],this.journeyTripsPlaceholder=["-"],this.tripModeTypes=["monomodal"],this.tripTransportModes=["public_transport"],this.lastJourneyResponse=null,this.departureDate=this.computeInitialDate(),this.currentAppStage="PROD",this.permalinkRelativeURL=null}initDefaults(){var e,i,r,s,d;let m=this.queryParams.get("stage");m&&(this.currentAppStage=this.computeAppStageFromString(m));const T=null!==(e=this.queryParams.get("from"))&&void 0!==e?e:"8507000",M=null!==(i=this.queryParams.get("to"))&&void 0!==i?i:"8503000",R=[],H=this.getStageConfig(),Z=["From","To"];Z.forEach(pt=>{let Xn="From"===pt?T:M;if("LA Beta"===this.currentAppStage){const Ni=Xn.match(/^[^\|]+?\|(.+?)$/);Ni?Xn=Ni[1]:console.error("ERROR LA Beta - CANT match stopPlaceRef")}const si=fs.initFromLiteralCoords(Xn);if(si){const Ni=new Promise((Zr,_u)=>{Zr([si])});R.push(Ni)}else{const Zr=gu.initWithStopPlaceRef(H,Xn).fetchResponse();R.push(Zr)}});const te=new Vp([]),xe=null!==(r=this.queryParams.get("via"))&&void 0!==r?r:null;(null===xe?[]:xe.split(";")).forEach(pt=>{const en=fs.initFromLiteralCoords(pt);if(en){const Xn=new fd(en);this.viaTripLocations.push(Xn),en.geoPosition&&te.extend(en.geoPosition)}}),this.journeyTripsPlaceholder=[],this.tripModeTypes=[];const et=null!==(s=this.queryParams.get("mode_types"))&&void 0!==s?s:null;et?et.split(";").forEach(pt=>{this.tripModeTypes.push(pt),this.journeyTripsPlaceholder.push("-")}):(this.journeyTripsPlaceholder=["-"],this.tripModeTypes=["monomodal"]),this.tripTransportModes=[];const kt=null!==(d=this.queryParams.get("transport_modes"))&&void 0!==d?d:null;kt?kt.split(";").forEach(pt=>{this.tripTransportModes.push(pt)}):this.tripTransportModes=["public_transport"],Promise.all(R).then(pt=>{if(Z.forEach(en=>{const Xn="From"===en,si=Xn?pt[0]:pt[1];if(0===si.length)return;const Ni=si[0];Xn?this.fromTripLocation=new fd(Ni):this.toTripLocation=new fd(Ni),Ni.geoPosition&&te.extend(Ni.geoPosition)}),this.locationsUpdated.emit(),this.geoLocationsUpdated.emit(),this.updatePermalinkAddress(),te.isValid()&&(this.queryParams.has("from")||this.queryParams.has("to"))&&!this.mapService.initialMapCenter){const si={bounds:new($s().LngLatBounds)(te.asFeatureBBOX())};this.mapService.newMapBoundsRequested.emit(si)}this.defaultsInited.emit()})}refetchEndpointsByName(){const e=[],i=new Promise((s,d)=>{s(null)}),r=["From","To"];r.forEach(s=>{const y="From"===s?this.fromTripLocation:this.toTripLocation;if(null===y)return void e.push(i);const T=y.location.geoPosition;if(null===T)return void e.push(i);const M=Vp.initFromGeoPosition(T,200,200),R=this.getStageConfig(),Z=gu.initWithBBOXAndType(R,M.southWest.longitude,M.northEast.latitude,M.northEast.longitude,M.southWest.latitude,"stop",300).fetchResponse();e.push(Z)}),Promise.all(e).then(s=>{r.forEach(d=>{const m="From"===d,y=m?s[0]:s[1];if(null===y)return;const T=m?this.fromTripLocation:this.toTripLocation;if(null===T)return void e.push(i);const M=T.location.findClosestLocation(y);null!==M&&(m?this.fromTripLocation=new fd(M.location):this.toTripLocation=new fd(M.location),this.updatePermalinkAddress(),this.locationsUpdated.emit(),this.geoLocationsUpdated.emit())})})}switchEndpoints(){const e=Object.assign({},this.fromTripLocation);this.fromTripLocation=Object.assign({},this.toTripLocation),this.toTripLocation=Object.assign({},e),this.updatePermalinkAddress(),this.locationsUpdated.emit(),this.geoLocationsUpdated.emit()}computeAppStageFromString(e){const i=["INT","LA Beta","PROD","TEST"],r=i.map(m=>m.toLowerCase()),s=e.trim(),d=r.indexOf(s.toLowerCase());return-1!==d?i[d]:"PROD"}updateTripEndpoint(e,i,r){if("From"===i&&(this.fromTripLocation=e?new fd(e):null),"To"===i&&(this.toTripLocation=e?new fd(e):null),e&&"Via"===i){const s=new fd(e);this.viaTripLocations.push(s),this.journeyTripsPlaceholder.push("-"),this.tripModeTypes.push("monomodal"),this.tripTransportModes.push("public_transport")}this.locationsUpdated.emit(),this.geoLocationsUpdated.emit(),this.activeTripSelected.emit(null),this.searchParamsReset.emit(),this.updatePermalinkAddress()}updateViaPoint(e,i){this.viaTripLocations[i].location=e,this.viaAtIndexUpdated.emit({location:e,idx:i}),this.activeTripSelected.emit(null),this.searchParamsReset.emit(),this.updatePermalinkAddress()}updateTrips(e){this.tripsUpdated.emit(e),this.activeTripSelected.emit(e.length>0?e[0]:null)}removeViaAtIndex(e){this.viaTripLocations.splice(e,1),this.tripModeTypes.splice(e,1),this.journeyTripsPlaceholder.splice(e,1),this.tripTransportModes.splice(e,1),0===this.viaTripLocations.length&&(this.journeyTripsPlaceholder=["-"],this.tripModeTypes=["monomodal"],this.tripTransportModes=["public_transport"]),this.viaAtIndexRemoved.emit(e),this.activeTripSelected.emit(null),this.searchParamsReset.emit(),this.updatePermalinkAddress()}computeJourneyRequestParams(){return kD.initWithLocationsAndDate(this.fromTripLocation,this.toTripLocation,this.viaTripLocations,this.tripModeTypes,this.tripTransportModes,this.departureDate)}computeTripRequestXML(e){const i=this.getStageConfig(),r=fS.initWithLocationsAndDate(this.fromTripLocation,this.toTripLocation,e);return null===r?"BROKEN TripsRequestParams":new L2(i,r).computeRequestXmlString()}updatePermalinkAddress(){const e=new URLSearchParams;["From","To"].forEach(T=>{var M,R,H,Z;const te="From"===T?this.fromTripLocation:this.toTripLocation,xe=T.toLowerCase(),Ce=null!==(R=null===(M=null==te?void 0:te.location.stopPlace)||void 0===M?void 0:M.stopPlaceRef)&&void 0!==R?R:null;if(Ce)e.append(xe,Ce);else{let et=null!==(Z=null===(H=null==te?void 0:te.location.geoPosition)||void 0===H?void 0:H.asLatLngString(!0))&&void 0!==Z?Z:null;if(et){const pt=null==te?void 0:te.location.computeLocationName(!1);pt&&(et=et+"("+pt+")"),e.append(xe,et)}}});const r=[];this.viaTripLocations.forEach(T=>{var M,R;const H=T.location,Z=null!==(R=null===(M=null==H?void 0:H.geoPosition)||void 0===M?void 0:M.asLatLngString(!0))&&void 0!==R?R:null;Z&&r.push(Z)}),r.length>0&&e.append("via",r.join(";")),e.append("mode_types",this.tripModeTypes.join(";")),e.append("transport_modes",this.tripTransportModes.join(";"));const s=Il.formatDate(this.departureDate);e.append("trip_datetime",s.substring(0,16));const d=this.currentAppStage.toLowerCase();e.append("stage",d),this.permalinkRelativeURL=document.location.pathname.replace("/embed","")+"?"+e.toString();const m=new URLSearchParams;["from","to"].forEach(T=>{const M=e.get(T);null!==M&&m.append(T,M)}),this.embedQueryParams=m}computeInitialDate(){var e;const i=new Date,r=null!==(e=this.queryParams.get("trip_datetime"))&&void 0!==e?e:null;return null===r?i:new Date(Date.parse(r))}getStageConfig(e=this.currentAppStage){var i;const r=null!==(i=Im.app_stages.find(s=>s.key===e))&&void 0!==i?i:null;return null===r?(console.error("ERROR - cant find stage"+e+" using PROD"),cW):r}updateAppStage(e){this.currentAppStage=e,this.updatePermalinkAddress()}updateDepartureDateTime(e){this.departureDate=e,this.updatePermalinkAddress()}updateTripMode(e,i,r){this.tripModeTypes[r]=e,this.tripTransportModes[r]=i,this.updatePermalinkAddress()}computeTripLocationsToUpdate(e){const i=[],r=[this.fromTripLocation];this.viaTripLocations.forEach(y=>{r.push(y)}),r.push(this.toTripLocation);const s=this.tripModeTypes[e],d=r[e];d&&("mode_at_start"===s||"mode_at_start_end"===s)&&i.push(d);const m=r[e+1];return m&&("mode_at_end"===s||"mode_at_start_end"===s)&&i.push(m),i}updateTripLocationRestrictions(e,i,r,s,d){this.computeTripLocationsToUpdate(d).forEach(y=>{y.minDuration=e,y.maxDuration=i,y.minDistance=r,y.maxDistance=s})}updateTripLocationCustomMode(e){const i=this.computeTripLocationsToUpdate(e),r=this.tripModeTypes[e];i.forEach(s=>{s.customTransportMode="monomodal"===r?null:this.tripTransportModes[e]})}updateParamsFromTrip(e){if(!(e.legs.length>0))return;const s=e.legs[e.legs.length-1];this.fromTripLocation=new fd(e.legs[0].fromLocation),this.toTripLocation=new fd(s.toLocation),this.viaTripLocations=[],this.journeyTripsPlaceholder=["-"],this.tripModeTypes=["monomodal"],this.tripTransportModes=["public_transport"],this.geoLocationsUpdated.emit(),this.updatePermalinkAddress()}}return n.\u0275fac=function(e){return new(e||n)(Ue(Up))},n.\u0275prov=tn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class dW{constructor(t=!1,e,i=!0,r){this._multiple=t,this._emitChanges=i,this.compareWith=r,this._selection=new Set,this._deselectedToEmit=[],this._selectedToEmit=[],this.changed=new Wt,e&&e.length&&(t?e.forEach(s=>this._markSelected(s)):this._markSelected(e[0]),this._selectedToEmit.length=0)}get selected(){return this._selected||(this._selected=Array.from(this._selection.values())),this._selected}select(...t){this._verifyValueAssignment(t),t.forEach(i=>this._markSelected(i));const e=this._hasQueuedChanges();return this._emitChangeEvent(),e}deselect(...t){this._verifyValueAssignment(t),t.forEach(i=>this._unmarkSelected(i));const e=this._hasQueuedChanges();return this._emitChangeEvent(),e}setSelection(...t){this._verifyValueAssignment(t);const e=this.selected,i=new Set(t);t.forEach(s=>this._markSelected(s)),e.filter(s=>!i.has(s)).forEach(s=>this._unmarkSelected(s));const r=this._hasQueuedChanges();return this._emitChangeEvent(),r}toggle(t){return this.isSelected(t)?this.deselect(t):this.select(t)}clear(t=!0){this._unmarkAll();const e=this._hasQueuedChanges();return t&&this._emitChangeEvent(),e}isSelected(t){if(this.compareWith){for(const e of this._selection)if(this.compareWith(e,t))return!0;return!1}return this._selection.has(t)}isEmpty(){return 0===this._selection.size}hasValue(){return!this.isEmpty()}sort(t){this._multiple&&this.selected&&this._selected.sort(t)}isMultipleSelection(){return this._multiple}_emitChangeEvent(){this._selected=null,(this._selectedToEmit.length||this._deselectedToEmit.length)&&(this.changed.next({source:this,added:this._selectedToEmit,removed:this._deselectedToEmit}),this._deselectedToEmit=[],this._selectedToEmit=[])}_markSelected(t){this.isSelected(t)||(this._multiple||this._unmarkAll(),this.isSelected(t)||this._selection.add(t),this._emitChanges&&this._selectedToEmit.push(t))}_unmarkSelected(t){this.isSelected(t)&&(this._selection.delete(t),this._emitChanges&&this._deselectedToEmit.push(t))}_unmarkAll(){this.isEmpty()||this._selection.forEach(t=>this._unmarkSelected(t))}_verifyValueAssignment(t){}_hasQueuedChanges(){return!(!this._deselectedToEmit.length&&!this._selectedToEmit.length)}}let PD=(()=>{class n{constructor(){this._listeners=[]}notify(e,i){for(let r of this._listeners)r(e,i)}listen(e){return this._listeners.push(e),()=>{this._listeners=this._listeners.filter(i=>e!==i)}}ngOnDestroy(){this._listeners=[]}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=tn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),hW=0;const OD=new Dt("CdkAccordion");let pW=(()=>{class n{constructor(){this._stateChanges=new Wt,this._openCloseAllActions=new Wt,this.id="cdk-accordion-"+hW++,this._multi=!1}get multi(){return this._multi}set multi(e){this._multi=ii(e)}openAll(){this._multi&&this._openCloseAllActions.next(!0)}closeAll(){this._openCloseAllActions.next(!1)}ngOnChanges(e){this._stateChanges.next(e)}ngOnDestroy(){this._stateChanges.complete(),this._openCloseAllActions.complete()}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=Ft({type:n,selectors:[["cdk-accordion"],["","cdkAccordion",""]],inputs:{multi:"multi"},exportAs:["cdkAccordion"],features:[ni([{provide:OD,useExisting:n}]),_r]}),n})(),fW=0,mW=(()=>{class n{constructor(e,i,r){this.accordion=e,this._changeDetectorRef=i,this._expansionDispatcher=r,this._openCloseAllSubscription=he.EMPTY,this.closed=new on,this.opened=new on,this.destroyed=new on,this.expandedChange=new on,this.id="cdk-accordion-child-"+fW++,this._expanded=!1,this._disabled=!1,this._removeUniqueSelectionListener=()=>{},this._removeUniqueSelectionListener=r.listen((s,d)=>{this.accordion&&!this.accordion.multi&&this.accordion.id===d&&this.id!==s&&(this.expanded=!1)}),this.accordion&&(this._openCloseAllSubscription=this._subscribeToOpenCloseAllActions())}get expanded(){return this._expanded}set expanded(e){e=ii(e),this._expanded!==e&&(this._expanded=e,this.expandedChange.emit(e),e?(this.opened.emit(),this._expansionDispatcher.notify(this.id,this.accordion?this.accordion.id:this.id)):this.closed.emit(),this._changeDetectorRef.markForCheck())}get disabled(){return this._disabled}set disabled(e){this._disabled=ii(e)}ngOnDestroy(){this.opened.complete(),this.closed.complete(),this.destroyed.emit(),this.destroyed.complete(),this._removeUniqueSelectionListener(),this._openCloseAllSubscription.unsubscribe()}toggle(){this.disabled||(this.expanded=!this.expanded)}close(){this.disabled||(this.expanded=!1)}open(){this.disabled||(this.expanded=!0)}_subscribeToOpenCloseAllActions(){return this.accordion._openCloseAllActions.subscribe(e=>{this.disabled||(this.expanded=e)})}}return n.\u0275fac=function(e){return new(e||n)(X(OD,12),X(kr),X(PD))},n.\u0275dir=Ft({type:n,selectors:[["cdk-accordion-item"],["","cdkAccordionItem",""]],inputs:{expanded:"expanded",disabled:"disabled"},outputs:{closed:"closed",opened:"opened",destroyed:"destroyed",expandedChange:"expandedChange"},exportAs:["cdkAccordionItem"],features:[ni([{provide:OD,useValue:void 0}])]}),n})(),gW=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({}),n})();const bW=["body"];function _W(n,t){}const yW=[[["sbb-expansion-panel-header"]],"*"],vW=["sbb-expansion-panel-header","*"];function xW(n,t){1&n&&bn(0,"sbb-icon",5),2&n&&rt("@indicatorRotate",rn(2)._getExpandedState())}function wW(n,t){1&n&&bn(0,"sbb-icon",9)}function SW(n,t){1&n&&bn(0,"sbb-icon",10)}function CW(n,t){1&n&&(Yl(0,6),Jt(1,wW,1,0,"sbb-icon",7),Jt(2,SW,1,0,"sbb-icon",8),Kl()),2&n&&(rt("ngSwitch",rn(2)._isExpanded()),Fe(1),rt("ngSwitchCase",!1),Fe(1),rt("ngSwitchCase",!0))}function TW(n,t){1&n&&(le(0,"span",2),yb(1,"async"),Jt(2,xW,1,1,"sbb-icon",3),Jt(3,CW,3,3,"ng-container",4),pe()),2&n&&(rt("ngSwitch",vb(1,3,rn().panel.variant)),Fe(2),rt("ngSwitchCase","lean"),Fe(1),rt("ngSwitchCase","standard"))}const EW=["*"],LD=new Dt("SBB_ACCORDION"),B2="225ms cubic-bezier(0.4,0.0,0.2,1)",z2={indicatorRotate:Us("indicatorRotate",[vr("collapsed, void",Yn({transform:"rotate(90deg)"})),vr("expanded",Yn({transform:"rotate(-90deg)"})),tr("expanded <=> collapsed, void => collapsed",ar(B2))]),bodyExpansion:Us("bodyExpansion",[vr("collapsed, void",Yn({height:"0px",visibility:"hidden"})),vr("expanded",Yn({height:"*",visibility:"visible"})),tr("expanded <=> collapsed, void => collapsed",ar(B2))])},V2=new Dt("SBB_EXPANSION_PANEL");let DW=(()=>{class n{constructor(e,i){this._template=e,this._expansionPanel=i}}return n.\u0275fac=function(e){return new(e||n)(X(ho),X(V2,8))},n.\u0275dir=Ft({type:n,selectors:[["ng-template","sbbExpansionPanelContent",""]]}),n})();const IW=Dm(mW);let MW=0,Am=(()=>{class n extends IW{constructor(e,i,r,s,d){super(i,r,s),this._viewContainerRef=e,this._hideToggle=!1,this.afterExpand=new on,this.afterCollapse=new on,this._inputChanges=new Wt,this._headerId="sbb-expansion-panel-header-"+MW++,this._bodyAnimationDone=new Wt,this.accordion=i,this._document=d,this._bodyAnimationDone.pipe(Lp((m,y)=>m.fromState===y.fromState&&m.toState===y.toState)).subscribe(m=>{"void"!==m.fromState&&("expanded"===m.toState?this.afterExpand.emit():"collapsed"===m.toState&&this.afterCollapse.emit())})}get hideToggle(){return this._hideToggle||this.accordion&&this.accordion.hideToggle}set hideToggle(e){this._hideToggle=ii(e)}_getExpandedState(){return this.expanded?"expanded":"collapsed"}toggle(){this.expanded=!this.expanded}close(){this.expanded=!1}open(){this.expanded=!0}ngAfterContentInit(){this._lazyContent&&this._lazyContent._expansionPanel===this&&this.opened.pipe(Hs(null),Rr(()=>this.expanded&&!this._portal),Qr(1)).subscribe(()=>{this._portal=new Tm(this._lazyContent._template,this._viewContainerRef)})}ngOnChanges(e){this._inputChanges.next(e)}ngOnDestroy(){super.ngOnDestroy(),this._bodyAnimationDone.complete(),this._inputChanges.complete()}_containsFocus(){if(this._body){const e=this._document.activeElement,i=this._body.nativeElement;return e===i||i.contains(e)}return!1}}return n.\u0275fac=function(e){return new(e||n)(X(Qo),X(LD,12),X(kr),X(PD),X(ui))},n.\u0275cmp=On({type:n,selectors:[["sbb-expansion-panel"]],contentQueries:function(e,i,r){if(1&e&&Kr(r,DW,5),2&e){let s;Jn(s=ei())&&(i._lazyContent=s.first)}},viewQuery:function(e,i){if(1&e&&yr(bW,5),2&e){let r;Jn(r=ei())&&(i._body=r.first)}},hostAttrs:[1,"sbb-expansion-panel"],hostVars:2,hostBindings:function(e,i){2&e&&Ui("sbb-expanded",i.expanded)},inputs:{disabled:"disabled",expanded:"expanded",hideToggle:"hideToggle"},outputs:{afterExpand:"afterExpand",afterCollapse:"afterCollapse"},exportAs:["sbbExpansionPanel"],features:[ni([{provide:LD,useValue:void 0},{provide:V2,useExisting:n}]),Yt,_r],ngContentSelectors:vW,decls:6,vars:4,consts:[["role","region",1,"sbb-expansion-panel-content",3,"id"],["body",""],[1,"sbb-expansion-panel-body","sbb-expansion-panel-horizontal-padding"],[3,"cdkPortalOutlet"]],template:function(e,i){1&e&&($o(yW),$r(0),le(1,"div",0,1),nn("@bodyExpansion.done",function(s){return i._bodyAnimationDone.next(s)}),le(3,"div",2),$r(4,1),Jt(5,_W,0,0,"ng-template",3),pe()()),2&e&&(Fe(1),rt("@bodyExpansion",i._getExpandedState())("id",i.id),Sn("aria-labelledby",i._headerId),Fe(4),rt("cdkPortalOutlet",i._portal))},dependencies:[dd],styles:['.sbb-expansion-panel{box-sizing:content-box;display:block;margin:0;transition:border-color var(--sbb-transition-fast-start);border:var(--sbb-border-width-thin) solid var(--sbb-color-milk)}.sbb-expansion-panel+.sbb-expansion-panel{margin-top:calc(var(--sbb-border-width-thin)*2)}.sbb-expansion-panel.sbb-expanded{border-color:var(--sbb-color-cloud)}.sbb-expansion-panel.sbb-expanded.sbb-expansion-panel-full-width{border-left-color:rgba(0,0,0,0);border-right-color:rgba(0,0,0,0);border-left-width:0;border-right-width:0;padding-left:var(--sbb-border-width-thin);padding-right:var(--sbb-border-width-thin)}.sbb-expansion-panel-horizontal-padding{padding-left:calc(var(--sbb-expansion-panel-padding-horizontal) - var(--sbb-border-width-thin));padding-right:calc(var(--sbb-expansion-panel-padding-horizontal) - var(--sbb-border-width-thin))}.sbb-expansion-panel-header{cursor:pointer;display:flex;align-items:center;position:relative;background-color:var(--sbb-color-milk);outline:none;padding-top:var(--sbb-expansion-panel-header-padding-top);padding-bottom:var(--sbb-expansion-panel-header-padding-bottom)}:where(html.sbb-lean) .sbb-expansion-panel-header{padding-bottom:calc(0.8rem - var(--sbb-border-width-thin))}.sbb-expansion-panel-header.sbb-expanded::after{content:"";display:block;position:absolute;height:0;bottom:0;width:calc(100% - var(--sbb-expansion-panel-padding-horizontal)*2 + var(--sbb-border-width-thin)*2);left:calc(var(--sbb-expansion-panel-padding-horizontal) - var(--sbb-border-width-thin));border-bottom:var(--sbb-border-width-thin) solid var(--sbb-color-cloud)}.sbb-expansion-panel-header:is(.sbb-expanded,.sbb-expanded:is(:focus,:hover)){background:inherit}.sbb-expansion-panel-header.sbb-disabled{cursor:default;opacity:.75}.sbb-expansion-panel-header-indicator{flex:0 0 auto;line-height:0;height:var(--sbb-icon-size-default);width:var(--sbb-icon-size-default);margin-left:1.6rem;color:var(--sbb-color-black);margin-top:-0.5em;margin-bottom:-0.5em}:where(html:not(.sbb-lean)) .sbb-expansion-panel-header-indicator{border:var(--sbb-border-width-thin) solid var(--sbb-color-storm);border-radius:50%;padding:calc(0.2666666667rem * var(--sbb-scaling-factor) - var(--sbb-border-width-thin))}@media all and (min-width: 40.1875em)and (max-width: 64.0525em){:where(html:not(.sbb-lean)) .sbb-expansion-panel-header-indicator{margin-left:2.6666666667rem}}@media all and (min-width: 40.1875em){:where(html:not(.sbb-lean)) .sbb-expansion-panel-header-indicator{height:calc(2.1333333333rem * var(--sbb-scaling-factor));width:calc(2.1333333333rem * var(--sbb-scaling-factor))}}@media all and (min-width: 160.0625em){:where(html:not(.sbb-lean)) .sbb-expansion-panel-header-indicator{margin-left:2.4rem}}@media all and (min-width: 240.0625em){:where(html:not(.sbb-lean)) .sbb-expansion-panel-header-indicator{margin-left:2.9333333333rem}}.sbb-expansion-panel-header-content{display:flex;flex:1;overflow:hidden;font-family:var(--sbb-font-light);font-size:var(--sbb-font-size-large);line-height:var(--sbb-expansion-panel-line-height)}.sbb-expansion-panel-content{display:flex;flex-direction:column;overflow:visible}.sbb-expansion-panel-content[style*="visibility: hidden"] *{visibility:hidden !important}.sbb-expansion-panel-content.ng-animating,.sbb-expansion-panel:not(.sbb-expanded) .sbb-expansion-panel-content{overflow:hidden}.sbb-expansion-panel-body{font-size:var(--sbb-font-size);line-height:var(--sbb-line-height);padding-top:var(--sbb-divider-medium);padding-bottom:var(--sbb-divider-medium)}.sbb-expansion-panel-body>*:first-child{margin-top:0}'],encapsulation:2,data:{animation:[z2.bodyExpansion]},changeDetection:0}),n})();const kW=$b(class AW{});let mS=(()=>{class n extends kW{constructor(e,i,r,s,d,m){super(),this.panel=e,this._element=i,this._focusMonitor=r,this._changeDetectorRef=s,this._document=d,this._parentChangeSubscription=he.EMPTY;const y=e.accordion?e.accordion._stateChanges.pipe(Rr(T=>!!T.hideToggle)):so;this.tabIndex=parseInt(m||"",10)||0,this._parentChangeSubscription=Or(e.opened,e.closed,y,e._inputChanges.pipe(Rr(T=>!(!T.hideToggle&&!T.disabled)))).subscribe(()=>this._changeDetectorRef.markForCheck()),e.closed.pipe(Rr(()=>e._containsFocus())).subscribe(()=>r.focusVia(i,"program"))}get disabled(){return this.panel.disabled}_toggle(){this.disabled||this.panel.toggle()}_isExpanded(){return this.panel.expanded}_getExpandedState(){return this.panel._getExpandedState()}_getPanelId(){return this.panel.id}_showToggle(){return!this.panel.hideToggle&&!this.panel.disabled}_keydown(e){switch(e.keyCode){case 32:case 13:!xa(e)&&this._isFocused()&&(e.preventDefault(),this._toggle());break;default:return void(this.panel.accordion&&this.panel.accordion._handleHeaderKeydown(e))}}focus(e,i){e?this._focusMonitor.focusVia(this._element,e,i):this._element.nativeElement.focus(i)}ngAfterViewInit(){this._focusMonitor.monitor(this._element).subscribe(e=>{e&&this.panel.accordion&&this.panel.accordion._handleHeaderFocus(this)})}ngOnDestroy(){this._parentChangeSubscription.unsubscribe(),this._focusMonitor.stopMonitoring(this._element)}_isFocused(){var e;return(null===(e=this._document)||void 0===e?void 0:e.activeElement)===this._element.nativeElement}}return n.\u0275fac=function(e){return new(e||n)(X(Am,1),X(zn),X(Pa),X(kr),X(ui),os("tabindex"))},n.\u0275cmp=On({type:n,selectors:[["sbb-expansion-panel-header"]],hostAttrs:["role","button",1,"sbb-expansion-panel-header","sbb-expansion-panel-horizontal-padding"],hostVars:9,hostBindings:function(e,i){1&e&&nn("click",function(){return i._toggle()})("keydown",function(s){return i._keydown(s)}),2&e&&(Sn("id",i.panel._headerId)("tabindex",i.tabIndex)("aria-controls",i._getPanelId())("aria-expanded",i._isExpanded())("aria-disabled",i.disabled),Ui("sbb-expanded",i._isExpanded())("sbb-disabled",i.disabled))},inputs:{tabIndex:"tabIndex"},features:[Yt],ngContentSelectors:EW,decls:3,vars:1,consts:[[1,"sbb-expansion-panel-header-content"],["class","sbb-expansion-panel-header-indicator sbb-icon-fit",3,"ngSwitch",4,"ngIf"],[1,"sbb-expansion-panel-header-indicator","sbb-icon-fit",3,"ngSwitch"],["svgIcon","kom:chevron-right-small",4,"ngSwitchCase"],[3,"ngSwitch",4,"ngSwitchCase"],["svgIcon","kom:chevron-right-small"],[3,"ngSwitch"],["svgIcon","kom:plus-small",4,"ngSwitchCase"],["svgIcon","kom:minus-small",4,"ngSwitchCase"],["svgIcon","kom:plus-small"],["svgIcon","kom:minus-small"]],template:function(e,i){1&e&&($o(),le(0,"span",0),$r(1),pe(),Jt(2,TW,4,5,"span",1)),2&e&&(Fe(2),rt("ngIf",i._showToggle()))},dependencies:[js,Eb,Nx,ol,$y],encapsulation:2,data:{animation:[z2.indicatorRotate]},changeDetection:0}),n})(),FD=(()=>{class n extends pW{constructor(){super(...arguments),this._ownHeaders=new im,this._hideToggle=!1}get hideToggle(){return this._hideToggle}set hideToggle(e){this._hideToggle=ii(e)}ngAfterContentInit(){this._headers.changes.pipe(Hs(this._headers)).subscribe(e=>{this._ownHeaders.reset(e.filter(i=>i.panel.accordion===this)),this._ownHeaders.notifyOnChanges()}),this._keyManager=new iD(this._ownHeaders).withWrap().withHomeAndEnd()}_handleHeaderKeydown(e){this._keyManager.onKeydown(e)}_handleHeaderFocus(e){this._keyManager.updateActiveItem(e)}ngOnDestroy(){super.ngOnDestroy(),this._ownHeaders.destroy()}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Yi(n)))(i||n)}}(),n.\u0275dir=Ft({type:n,selectors:[["sbb-accordion"]],contentQueries:function(e,i,r){if(1&e&&Kr(r,mS,5),2&e){let s;Jn(s=ei())&&(i._headers=s)}},hostAttrs:[1,"sbb-accordion"],inputs:{hideToggle:"hideToggle"},exportAs:["sbbAccordion"],features:[ni([{provide:LD,useExisting:n}]),Yt]}),n})(),j2=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({imports:[Tr,gW,wa,nr,Ao]}),n})();const U2=j$();class RW{constructor(t,e){this._viewportRuler=t,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=e}attach(){}enable(){if(this._canBeEnabled()){const t=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=t.style.left||"",this._previousHTMLStyles.top=t.style.top||"",t.style.left=Ms(-this._previousScrollPosition.left),t.style.top=Ms(-this._previousScrollPosition.top),t.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){const t=this._document.documentElement,i=t.style,r=this._document.body.style,s=i.scrollBehavior||"",d=r.scrollBehavior||"";this._isEnabled=!1,i.left=this._previousHTMLStyles.left,i.top=this._previousHTMLStyles.top,t.classList.remove("cdk-global-scrollblock"),U2&&(i.scrollBehavior=r.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),U2&&(i.scrollBehavior=s,r.scrollBehavior=d)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;const e=this._document.body,i=this._viewportRuler.getViewportSize();return e.scrollHeight>i.height||e.scrollWidth>i.width}}class PW{constructor(t,e,i,r){this._scrollDispatcher=t,this._ngZone=e,this._viewportRuler=i,this._config=r,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(t){this._overlayRef=t}enable(){if(this._scrollSubscription)return;const t=this._scrollDispatcher.scrolled(0);this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=t.subscribe(()=>{const e=this._viewportRuler.getViewportScrollPosition().top;Math.abs(e-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=t.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}class H2{enable(){}disable(){}attach(){}}function ND(n,t){return t.some(e=>n.bottom<e.top||n.top>e.bottom||n.right<e.left||n.left>e.right)}function $2(n,t){return t.some(e=>n.top<e.top||n.bottom>e.bottom||n.left<e.left||n.right>e.right)}class OW{constructor(t,e,i,r){this._scrollDispatcher=t,this._viewportRuler=e,this._ngZone=i,this._config=r,this._scrollSubscription=null}attach(t){this._overlayRef=t}enable(){this._scrollSubscription||(this._scrollSubscription=this._scrollDispatcher.scrolled(this._config?this._config.scrollThrottle:0).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){const e=this._overlayRef.overlayElement.getBoundingClientRect(),{width:i,height:r}=this._viewportRuler.getViewportSize();ND(e,[{width:i,height:r,bottom:r,right:i,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}}))}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}let LW=(()=>{class n{constructor(e,i,r,s){this._scrollDispatcher=e,this._viewportRuler=i,this._ngZone=r,this.noop=()=>new H2,this.close=d=>new PW(this._scrollDispatcher,this._ngZone,this._viewportRuler,d),this.block=()=>new RW(this._viewportRuler,this._document),this.reposition=d=>new OW(this._scrollDispatcher,this._viewportRuler,this._ngZone,d),this._document=s}}return n.\u0275fac=function(e){return new(e||n)(Ue(u2),Ue(mu),Ue(di),Ue(ui))},n.\u0275prov=tn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class km{constructor(t){if(this.scrollStrategy=new H2,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,t){const e=Object.keys(t);for(const i of e)void 0!==t[i]&&(this[i]=t[i])}}}class FW{constructor(t,e){this.connectionPair=t,this.scrollableViewProperties=e}}class Hp{constructor(t,e,i,r,s,d,m,y,T,M=!1){this._portalOutlet=t,this._host=e,this._pane=i,this._config=r,this._ngZone=s,this._keyboardDispatcher=d,this._document=m,this._location=y,this._outsideClickDispatcher=T,this._animationsDisabled=M,this._backdropElement=null,this._backdropClick=new Wt,this._attachments=new Wt,this._detachments=new Wt,this._locationChanges=he.EMPTY,this._backdropClickHandler=R=>this._backdropClick.next(R),this._backdropTransitionendHandler=R=>{this._disposeBackdrop(R.target)},this._keydownEvents=new Wt,this._outsidePointerEvents=new Wt,r.scrollStrategy&&(this._scrollStrategy=r.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=r.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(t){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);const e=this._portalOutlet.attach(t);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe(Qr(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),"function"==typeof(null==e?void 0:e.onDestroy)&&e.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),e}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();const t=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),t}dispose(){var t;const e=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),null===(t=this._host)||void 0===t||t.remove(),this._previousHostParent=this._pane=this._host=null,e&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(t){t!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=t,this.hasAttached()&&(t.attach(this),this.updatePosition()))}updateSize(t){this._config=Object.assign(Object.assign({},this._config),t),this._updateElementSize()}setDirection(t){this._config=Object.assign(Object.assign({},this._config),{direction:t}),this._updateElementDirection()}addPanelClass(t){this._pane&&this._toggleClasses(this._pane,t,!0)}removePanelClass(t){this._pane&&this._toggleClasses(this._pane,t,!1)}getDirection(){const t=this._config.direction;return t?"string"==typeof t?t:t.value:"ltr"}updateScrollStrategy(t){t!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=t,this.hasAttached()&&(t.attach(this),t.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;const t=this._pane.style;t.width=Ms(this._config.width),t.height=Ms(this._config.height),t.minWidth=Ms(this._config.minWidth),t.minHeight=Ms(this._config.minHeight),t.maxWidth=Ms(this._config.maxWidth),t.maxHeight=Ms(this._config.maxHeight)}_togglePointerEvents(t){this._pane.style.pointerEvents=t?"":"none"}_attachBackdrop(){const t="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._animationsDisabled&&this._backdropElement.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),this._animationsDisabled||"undefined"==typeof requestAnimationFrame?this._backdropElement.classList.add(t):this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(t)})})}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){const t=this._backdropElement;if(t){if(this._animationsDisabled)return void this._disposeBackdrop(t);t.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{t.addEventListener("transitionend",this._backdropTransitionendHandler)}),t.style.pointerEvents="none",this._backdropTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(()=>{this._disposeBackdrop(t)},500))}}_toggleClasses(t,e,i){const r=Ww(e||[]).filter(s=>!!s);r.length&&(i?t.classList.add(...r):t.classList.remove(...r))}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{const t=this._ngZone.onStable.pipe(Hi(Or(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||0===this._pane.children.length)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),t.unsubscribe())})})}_disposeScrollStrategy(){const t=this._scrollStrategy;t&&(t.disable(),t.detach&&t.detach())}_disposeBackdrop(t){t&&(t.removeEventListener("click",this._backdropClickHandler),t.removeEventListener("transitionend",this._backdropTransitionendHandler),t.remove(),this._backdropElement===t&&(this._backdropElement=null)),this._backdropTimeout&&(clearTimeout(this._backdropTimeout),this._backdropTimeout=void 0)}}let Wb=(()=>{class n{constructor(e,i){this._platform=i,this._document=e}ngOnDestroy(){var e;null===(e=this._containerElement)||void 0===e||e.remove()}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){const e="cdk-overlay-container";if(this._platform.isBrowser||GE()){const r=this._document.querySelectorAll(`.${e}[platform="server"], .${e}[platform="test"]`);for(let s=0;s<r.length;s++)r[s].remove()}const i=this._document.createElement("div");i.classList.add(e),GE()?i.setAttribute("platform","test"):this._platform.isBrowser||i.setAttribute("platform","server"),this._document.body.appendChild(i),this._containerElement=i}}return n.\u0275fac=function(e){return new(e||n)(Ue(ui),Ue(Is))},n.\u0275prov=tn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const q2="cdk-overlay-connected-position-bounding-box",NW=/([A-Za-z%]+)$/;class BW{constructor(t,e,i,r,s){this._viewportRuler=e,this._document=i,this._platform=r,this._overlayContainer=s,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new Wt,this._resizeSubscription=he.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(t)}get positions(){return this._preferredPositions}attach(t){this._validatePositions(),t.hostElement.classList.add(q2),this._overlayRef=t,this._boundingBox=t.hostElement,this._pane=t.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition)return void this.reapplyLastPosition();this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const t=this._originRect,e=this._overlayRect,i=this._viewportRect,r=this._containerRect,s=[];let d;for(let m of this._preferredPositions){let y=this._getOriginPoint(t,r,m),T=this._getOverlayPoint(y,e,m),M=this._getOverlayFit(T,e,i,m);if(M.isCompletelyWithinViewport)return this._isPushed=!1,void this._applyPosition(m,y);this._canFitWithFlexibleDimensions(M,T,i)?s.push({position:m,origin:y,overlayRect:e,boundingBoxRect:this._calculateBoundingBoxRect(y,m)}):(!d||d.overlayFit.visibleArea<M.visibleArea)&&(d={overlayFit:M,overlayPoint:T,originPoint:y,position:m,overlayRect:e})}if(s.length){let m=null,y=-1;for(const T of s){const M=T.boundingBoxRect.width*T.boundingBoxRect.height*(T.position.weight||1);M>y&&(y=M,m=T)}return this._isPushed=!1,void this._applyPosition(m.position,m.origin)}if(this._canPush)return this._isPushed=!0,void this._applyPosition(d.position,d.originPoint);this._applyPosition(d.position,d.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&Rm(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(q2),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;const t=this._lastPosition;if(t){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const e=this._getOriginPoint(this._originRect,this._containerRect,t);this._applyPosition(t,e)}else this.apply()}withScrollableContainers(t){return this._scrollables=t,this}withPositions(t){return this._preferredPositions=t,-1===t.indexOf(this._lastPosition)&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(t){return this._viewportMargin=t,this}withFlexibleDimensions(t=!0){return this._hasFlexibleDimensions=t,this}withGrowAfterOpen(t=!0){return this._growAfterOpen=t,this}withPush(t=!0){return this._canPush=t,this}withLockedPosition(t=!0){return this._positionLocked=t,this}setOrigin(t){return this._origin=t,this}withDefaultOffsetX(t){return this._offsetX=t,this}withDefaultOffsetY(t){return this._offsetY=t,this}withTransformOriginOn(t){return this._transformOriginSelector=t,this}_getOriginPoint(t,e,i){let r,s;if("center"==i.originX)r=t.left+t.width/2;else{const d=this._isRtl()?t.right:t.left,m=this._isRtl()?t.left:t.right;r="start"==i.originX?d:m}return e.left<0&&(r-=e.left),s="center"==i.originY?t.top+t.height/2:"top"==i.originY?t.top:t.bottom,e.top<0&&(s-=e.top),{x:r,y:s}}_getOverlayPoint(t,e,i){let r,s;return r="center"==i.overlayX?-e.width/2:"start"===i.overlayX?this._isRtl()?-e.width:0:this._isRtl()?0:-e.width,s="center"==i.overlayY?-e.height/2:"top"==i.overlayY?0:-e.height,{x:t.x+r,y:t.y+s}}_getOverlayFit(t,e,i,r){const s=W2(e);let{x:d,y:m}=t,y=this._getOffset(r,"x"),T=this._getOffset(r,"y");y&&(d+=y),T&&(m+=T);let H=0-m,Z=m+s.height-i.height,te=this._subtractOverflows(s.width,0-d,d+s.width-i.width),xe=this._subtractOverflows(s.height,H,Z),Ce=te*xe;return{visibleArea:Ce,isCompletelyWithinViewport:s.width*s.height===Ce,fitsInViewportVertically:xe===s.height,fitsInViewportHorizontally:te==s.width}}_canFitWithFlexibleDimensions(t,e,i){if(this._hasFlexibleDimensions){const r=i.bottom-e.y,s=i.right-e.x,d=G2(this._overlayRef.getConfig().minHeight),m=G2(this._overlayRef.getConfig().minWidth),T=t.fitsInViewportHorizontally||null!=m&&m<=s;return(t.fitsInViewportVertically||null!=d&&d<=r)&&T}return!1}_pushOverlayOnScreen(t,e,i){if(this._previousPushAmount&&this._positionLocked)return{x:t.x+this._previousPushAmount.x,y:t.y+this._previousPushAmount.y};const r=W2(e),s=this._viewportRect,d=Math.max(t.x+r.width-s.width,0),m=Math.max(t.y+r.height-s.height,0),y=Math.max(s.top-i.top-t.y,0),T=Math.max(s.left-i.left-t.x,0);let M=0,R=0;return M=r.width<=s.width?T||-d:t.x<this._viewportMargin?s.left-i.left-t.x:0,R=r.height<=s.height?y||-m:t.y<this._viewportMargin?s.top-i.top-t.y:0,this._previousPushAmount={x:M,y:R},{x:t.x+M,y:t.y+R}}_applyPosition(t,e){if(this._setTransformOrigin(t),this._setOverlayElementStyles(e,t),this._setBoundingBoxStyles(e,t),t.panelClass&&this._addPanelClasses(t.panelClass),this._lastPosition=t,this._positionChanges.observers.length){const i=this._getScrollVisibility(),r=new FW(t,i);this._positionChanges.next(r)}this._isInitialRender=!1}_setTransformOrigin(t){if(!this._transformOriginSelector)return;const e=this._boundingBox.querySelectorAll(this._transformOriginSelector);let i,r=t.overlayY;i="center"===t.overlayX?"center":this._isRtl()?"start"===t.overlayX?"right":"left":"start"===t.overlayX?"left":"right";for(let s=0;s<e.length;s++)e[s].style.transformOrigin=`${i} ${r}`}_calculateBoundingBoxRect(t,e){const i=this._viewportRect,r=this._isRtl();let s,d,m,M,R,H;if("top"===e.overlayY)d=t.y,s=i.height-d+this._viewportMargin;else if("bottom"===e.overlayY)m=i.height-t.y+2*this._viewportMargin,s=i.height-m+this._viewportMargin;else{const Z=Math.min(i.bottom-t.y+i.top,t.y),te=this._lastBoundingBoxSize.height;s=2*Z,d=t.y-Z,s>te&&!this._isInitialRender&&!this._growAfterOpen&&(d=t.y-te/2)}if("end"===e.overlayX&&!r||"start"===e.overlayX&&r)H=i.width-t.x+this._viewportMargin,M=t.x-this._viewportMargin;else if("start"===e.overlayX&&!r||"end"===e.overlayX&&r)R=t.x,M=i.right-t.x;else{const Z=Math.min(i.right-t.x+i.left,t.x),te=this._lastBoundingBoxSize.width;M=2*Z,R=t.x-Z,M>te&&!this._isInitialRender&&!this._growAfterOpen&&(R=t.x-te/2)}return{top:d,left:R,bottom:m,right:H,width:M,height:s}}_setBoundingBoxStyles(t,e){const i=this._calculateBoundingBoxRect(t,e);!this._isInitialRender&&!this._growAfterOpen&&(i.height=Math.min(i.height,this._lastBoundingBoxSize.height),i.width=Math.min(i.width,this._lastBoundingBoxSize.width));const r={};if(this._hasExactPosition())r.top=r.left="0",r.bottom=r.right=r.maxHeight=r.maxWidth="",r.width=r.height="100%";else{const s=this._overlayRef.getConfig().maxHeight,d=this._overlayRef.getConfig().maxWidth;r.height=Ms(i.height),r.top=Ms(i.top),r.bottom=Ms(i.bottom),r.width=Ms(i.width),r.left=Ms(i.left),r.right=Ms(i.right),r.alignItems="center"===e.overlayX?"center":"end"===e.overlayX?"flex-end":"flex-start",r.justifyContent="center"===e.overlayY?"center":"bottom"===e.overlayY?"flex-end":"flex-start",s&&(r.maxHeight=Ms(s)),d&&(r.maxWidth=Ms(d))}this._lastBoundingBoxSize=i,Rm(this._boundingBox.style,r)}_resetBoundingBoxStyles(){Rm(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){Rm(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(t,e){const i={},r=this._hasExactPosition(),s=this._hasFlexibleDimensions,d=this._overlayRef.getConfig();if(r){const M=this._viewportRuler.getViewportScrollPosition();Rm(i,this._getExactOverlayY(e,t,M)),Rm(i,this._getExactOverlayX(e,t,M))}else i.position="static";let m="",y=this._getOffset(e,"x"),T=this._getOffset(e,"y");y&&(m+=`translateX(${y}px) `),T&&(m+=`translateY(${T}px)`),i.transform=m.trim(),d.maxHeight&&(r?i.maxHeight=Ms(d.maxHeight):s&&(i.maxHeight="")),d.maxWidth&&(r?i.maxWidth=Ms(d.maxWidth):s&&(i.maxWidth="")),Rm(this._pane.style,i)}_getExactOverlayY(t,e,i){let r={top:"",bottom:""},s=this._getOverlayPoint(e,this._overlayRect,t);return this._isPushed&&(s=this._pushOverlayOnScreen(s,this._overlayRect,i)),"bottom"===t.overlayY?r.bottom=this._document.documentElement.clientHeight-(s.y+this._overlayRect.height)+"px":r.top=Ms(s.y),r}_getExactOverlayX(t,e,i){let d,r={left:"",right:""},s=this._getOverlayPoint(e,this._overlayRect,t);return this._isPushed&&(s=this._pushOverlayOnScreen(s,this._overlayRect,i)),d=this._isRtl()?"end"===t.overlayX?"left":"right":"end"===t.overlayX?"right":"left","right"===d?r.right=this._document.documentElement.clientWidth-(s.x+this._overlayRect.width)+"px":r.left=Ms(s.x),r}_getScrollVisibility(){const t=this._getOriginRect(),e=this._pane.getBoundingClientRect(),i=this._scrollables.map(r=>r.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:$2(t,i),isOriginOutsideView:ND(t,i),isOverlayClipped:$2(e,i),isOverlayOutsideView:ND(e,i)}}_subtractOverflows(t,...e){return e.reduce((i,r)=>i-Math.max(r,0),t)}_getNarrowedViewportRect(){const t=this._document.documentElement.clientWidth,e=this._document.documentElement.clientHeight,i=this._viewportRuler.getViewportScrollPosition();return{top:i.top+this._viewportMargin,left:i.left+this._viewportMargin,right:i.left+t-this._viewportMargin,bottom:i.top+e-this._viewportMargin,width:t-2*this._viewportMargin,height:e-2*this._viewportMargin}}_isRtl(){return"rtl"===this._overlayRef.getDirection()}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(t,e){return"x"===e?null==t.offsetX?this._offsetX:t.offsetX:null==t.offsetY?this._offsetY:t.offsetY}_validatePositions(){}_addPanelClasses(t){this._pane&&Ww(t).forEach(e=>{""!==e&&-1===this._appliedPanelClasses.indexOf(e)&&(this._appliedPanelClasses.push(e),this._pane.classList.add(e))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(t=>{this._pane.classList.remove(t)}),this._appliedPanelClasses=[])}_getOriginRect(){const t=this._origin;if(t instanceof zn)return t.nativeElement.getBoundingClientRect();if(t instanceof Element)return t.getBoundingClientRect();const e=t.width||0,i=t.height||0;return{top:t.y,bottom:t.y+i,left:t.x,right:t.x+e,height:i,width:e}}}function Rm(n,t){for(let e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}function G2(n){if("number"!=typeof n&&null!=n){const[t,e]=n.split(NW);return e&&"px"!==e?null:parseFloat(t)}return n||null}function W2(n){return{top:Math.floor(n.top),right:Math.floor(n.right),bottom:Math.floor(n.bottom),left:Math.floor(n.left),width:Math.floor(n.width),height:Math.floor(n.height)}}const X2="cdk-global-overlay-wrapper";class zW{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._alignItems="",this._xPosition="",this._xOffset="",this._width="",this._height="",this._isDisposed=!1}attach(t){const e=t.getConfig();this._overlayRef=t,this._width&&!e.width&&t.updateSize({width:this._width}),this._height&&!e.height&&t.updateSize({height:this._height}),t.hostElement.classList.add(X2),this._isDisposed=!1}top(t=""){return this._bottomOffset="",this._topOffset=t,this._alignItems="flex-start",this}left(t=""){return this._xOffset=t,this._xPosition="left",this}bottom(t=""){return this._topOffset="",this._bottomOffset=t,this._alignItems="flex-end",this}right(t=""){return this._xOffset=t,this._xPosition="right",this}start(t=""){return this._xOffset=t,this._xPosition="start",this}end(t=""){return this._xOffset=t,this._xPosition="end",this}width(t=""){return this._overlayRef?this._overlayRef.updateSize({width:t}):this._width=t,this}height(t=""){return this._overlayRef?this._overlayRef.updateSize({height:t}):this._height=t,this}centerHorizontally(t=""){return this.left(t),this._xPosition="center",this}centerVertically(t=""){return this.top(t),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;const t=this._overlayRef.overlayElement.style,e=this._overlayRef.hostElement.style,i=this._overlayRef.getConfig(),{width:r,height:s,maxWidth:d,maxHeight:m}=i,y=!("100%"!==r&&"100vw"!==r||d&&"100%"!==d&&"100vw"!==d),T=!("100%"!==s&&"100vh"!==s||m&&"100%"!==m&&"100vh"!==m),M=this._xPosition,R=this._xOffset,H="rtl"===this._overlayRef.getConfig().direction;let Z="",te="",xe="";y?xe="flex-start":"center"===M?(xe="center",H?te=R:Z=R):H?"left"===M||"end"===M?(xe="flex-end",Z=R):("right"===M||"start"===M)&&(xe="flex-start",te=R):"left"===M||"start"===M?(xe="flex-start",Z=R):("right"===M||"end"===M)&&(xe="flex-end",te=R),t.position=this._cssPosition,t.marginLeft=y?"0":Z,t.marginTop=T?"0":this._topOffset,t.marginBottom=this._bottomOffset,t.marginRight=y?"0":te,e.justifyContent=xe,e.alignItems=T?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;const t=this._overlayRef.overlayElement.style,e=this._overlayRef.hostElement,i=e.style;e.classList.remove(X2),i.justifyContent=i.alignItems=t.marginTop=t.marginBottom=t.marginLeft=t.marginRight=t.position="",this._overlayRef=null,this._isDisposed=!0}}let VW=(()=>{class n{constructor(e,i,r,s){this._viewportRuler=e,this._document=i,this._platform=r,this._overlayContainer=s}global(){return new zW}flexibleConnectedTo(e){return new BW(e,this._viewportRuler,this._document,this._platform,this._overlayContainer)}}return n.\u0275fac=function(e){return new(e||n)(Ue(mu),Ue(ui),Ue(Is),Ue(Wb))},n.\u0275prov=tn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),Z2=(()=>{class n{constructor(e){this._attachedOverlays=[],this._document=e}ngOnDestroy(){this.detach()}add(e){this.remove(e),this._attachedOverlays.push(e)}remove(e){const i=this._attachedOverlays.indexOf(e);i>-1&&this._attachedOverlays.splice(i,1),0===this._attachedOverlays.length&&this.detach()}}return n.\u0275fac=function(e){return new(e||n)(Ue(ui))},n.\u0275prov=tn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),jW=(()=>{class n extends Z2{constructor(e,i){super(e),this._ngZone=i,this._keydownListener=r=>{const s=this._attachedOverlays;for(let d=s.length-1;d>-1;d--)if(s[d]._keydownEvents.observers.length>0){const m=s[d]._keydownEvents;this._ngZone?this._ngZone.run(()=>m.next(r)):m.next(r);break}}}add(e){super.add(e),this._isAttached||(this._ngZone?this._ngZone.runOutsideAngular(()=>this._document.body.addEventListener("keydown",this._keydownListener)):this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}}return n.\u0275fac=function(e){return new(e||n)(Ue(ui),Ue(di,8))},n.\u0275prov=tn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),UW=(()=>{class n extends Z2{constructor(e,i,r){super(e),this._platform=i,this._ngZone=r,this._cursorStyleIsSet=!1,this._pointerDownListener=s=>{this._pointerDownEventTarget=Op(s)},this._clickListener=s=>{const d=Op(s),m="click"===s.type&&this._pointerDownEventTarget?this._pointerDownEventTarget:d;this._pointerDownEventTarget=null;const y=this._attachedOverlays.slice();for(let T=y.length-1;T>-1;T--){const M=y[T];if(M._outsidePointerEvents.observers.length<1||!M.hasAttached())continue;if(M.overlayElement.contains(d)||M.overlayElement.contains(m))break;const R=M._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>R.next(s)):R.next(s)}}}add(e){if(super.add(e),!this._isAttached){const i=this._document.body;this._ngZone?this._ngZone.runOutsideAngular(()=>this._addEventListeners(i)):this._addEventListeners(i),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=i.style.cursor,i.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){const e=this._document.body;e.removeEventListener("pointerdown",this._pointerDownListener,!0),e.removeEventListener("click",this._clickListener,!0),e.removeEventListener("auxclick",this._clickListener,!0),e.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(e.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}_addEventListeners(e){e.addEventListener("pointerdown",this._pointerDownListener,!0),e.addEventListener("click",this._clickListener,!0),e.addEventListener("auxclick",this._clickListener,!0),e.addEventListener("contextmenu",this._clickListener,!0)}}return n.\u0275fac=function(e){return new(e||n)(Ue(ui),Ue(Is),Ue(di,8))},n.\u0275prov=tn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),HW=0,es=(()=>{class n{constructor(e,i,r,s,d,m,y,T,M,R,H,Z){this.scrollStrategies=e,this._overlayContainer=i,this._componentFactoryResolver=r,this._positionBuilder=s,this._keyboardDispatcher=d,this._injector=m,this._ngZone=y,this._document=T,this._directionality=M,this._location=R,this._outsideClickDispatcher=H,this._animationsModuleType=Z}create(e){const i=this._createHostElement(),r=this._createPaneElement(i),s=this._createPortalOutlet(r),d=new km(e);return d.direction=d.direction||this._directionality.value,new Hp(s,i,r,d,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher,"NoopAnimations"===this._animationsModuleType)}position(){return this._positionBuilder}_createPaneElement(e){const i=this._document.createElement("div");return i.id="cdk-overlay-"+HW++,i.classList.add("cdk-overlay-pane"),e.appendChild(i),i}_createHostElement(){const e=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(e),e}_createPortalOutlet(e){return this._appRef||(this._appRef=this._injector.get(Cb)),new Fq(e,this._componentFactoryResolver,this._appRef,this._injector,this._document)}}return n.\u0275fac=function(e){return new(e||n)(Ue(LW),Ue(Wb),Ue(Kd),Ue(VW),Ue(jW),Ue(Xr),Ue(di),Ue(ui),Ue(Fp),Ue(Dx),Ue(UW),Ue(id,8))},n.\u0275prov=tn({token:n,factory:n.\u0275fac}),n})();const $W=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom"},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"}],Y2=new Dt("cdk-connected-overlay-scroll-strategy");let K2=(()=>{class n{constructor(e){this.elementRef=e}}return n.\u0275fac=function(e){return new(e||n)(X(zn))},n.\u0275dir=Ft({type:n,selectors:[["","cdk-overlay-origin",""],["","overlay-origin",""],["","cdkOverlayOrigin",""]],exportAs:["cdkOverlayOrigin"]}),n})(),Q2=(()=>{class n{constructor(e,i,r,s,d){this._overlay=e,this._dir=d,this._hasBackdrop=!1,this._lockPosition=!1,this._growAfterOpen=!1,this._flexibleDimensions=!1,this._push=!1,this._backdropSubscription=he.EMPTY,this._attachSubscription=he.EMPTY,this._detachSubscription=he.EMPTY,this._positionSubscription=he.EMPTY,this.viewportMargin=0,this.open=!1,this.disableClose=!1,this.backdropClick=new on,this.positionChange=new on,this.attach=new on,this.detach=new on,this.overlayKeydown=new on,this.overlayOutsideClick=new on,this._templatePortal=new Tm(i,r),this._scrollStrategyFactory=s,this.scrollStrategy=this._scrollStrategyFactory()}get offsetX(){return this._offsetX}set offsetX(e){this._offsetX=e,this._position&&this._updatePositionStrategy(this._position)}get offsetY(){return this._offsetY}set offsetY(e){this._offsetY=e,this._position&&this._updatePositionStrategy(this._position)}get hasBackdrop(){return this._hasBackdrop}set hasBackdrop(e){this._hasBackdrop=ii(e)}get lockPosition(){return this._lockPosition}set lockPosition(e){this._lockPosition=ii(e)}get flexibleDimensions(){return this._flexibleDimensions}set flexibleDimensions(e){this._flexibleDimensions=ii(e)}get growAfterOpen(){return this._growAfterOpen}set growAfterOpen(e){this._growAfterOpen=ii(e)}get push(){return this._push}set push(e){this._push=ii(e)}get overlayRef(){return this._overlayRef}get dir(){return this._dir?this._dir.value:"ltr"}ngOnDestroy(){this._attachSubscription.unsubscribe(),this._detachSubscription.unsubscribe(),this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe(),this._overlayRef&&this._overlayRef.dispose()}ngOnChanges(e){this._position&&(this._updatePositionStrategy(this._position),this._overlayRef.updateSize({width:this.width,minWidth:this.minWidth,height:this.height,minHeight:this.minHeight}),e.origin&&this.open&&this._position.apply()),e.open&&(this.open?this._attachOverlay():this._detachOverlay())}_createOverlay(){(!this.positions||!this.positions.length)&&(this.positions=$W);const e=this._overlayRef=this._overlay.create(this._buildConfig());this._attachSubscription=e.attachments().subscribe(()=>this.attach.emit()),this._detachSubscription=e.detachments().subscribe(()=>this.detach.emit()),e.keydownEvents().subscribe(i=>{this.overlayKeydown.next(i),27===i.keyCode&&!this.disableClose&&!xa(i)&&(i.preventDefault(),this._detachOverlay())}),this._overlayRef.outsidePointerEvents().subscribe(i=>{this.overlayOutsideClick.next(i)})}_buildConfig(){const e=this._position=this.positionStrategy||this._createPositionStrategy(),i=new km({direction:this._dir,positionStrategy:e,scrollStrategy:this.scrollStrategy,hasBackdrop:this.hasBackdrop});return(this.width||0===this.width)&&(i.width=this.width),(this.height||0===this.height)&&(i.height=this.height),(this.minWidth||0===this.minWidth)&&(i.minWidth=this.minWidth),(this.minHeight||0===this.minHeight)&&(i.minHeight=this.minHeight),this.backdropClass&&(i.backdropClass=this.backdropClass),this.panelClass&&(i.panelClass=this.panelClass),i}_updatePositionStrategy(e){const i=this.positions.map(r=>({originX:r.originX,originY:r.originY,overlayX:r.overlayX,overlayY:r.overlayY,offsetX:r.offsetX||this.offsetX,offsetY:r.offsetY||this.offsetY,panelClass:r.panelClass||void 0}));return e.setOrigin(this._getFlexibleConnectedPositionStrategyOrigin()).withPositions(i).withFlexibleDimensions(this.flexibleDimensions).withPush(this.push).withGrowAfterOpen(this.growAfterOpen).withViewportMargin(this.viewportMargin).withLockedPosition(this.lockPosition).withTransformOriginOn(this.transformOriginSelector)}_createPositionStrategy(){const e=this._overlay.position().flexibleConnectedTo(this._getFlexibleConnectedPositionStrategyOrigin());return this._updatePositionStrategy(e),e}_getFlexibleConnectedPositionStrategyOrigin(){return this.origin instanceof K2?this.origin.elementRef:this.origin}_attachOverlay(){this._overlayRef?this._overlayRef.getConfig().hasBackdrop=this.hasBackdrop:this._createOverlay(),this._overlayRef.hasAttached()||this._overlayRef.attach(this._templatePortal),this.hasBackdrop?this._backdropSubscription=this._overlayRef.backdropClick().subscribe(e=>{this.backdropClick.emit(e)}):this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe(),this.positionChange.observers.length>0&&(this._positionSubscription=this._position.positionChanges.pipe(EO(()=>this.positionChange.observers.length>0)).subscribe(e=>{this.positionChange.emit(e),0===this.positionChange.observers.length&&this._positionSubscription.unsubscribe()}))}_detachOverlay(){this._overlayRef&&this._overlayRef.detach(),this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)(X(es),X(ho),X(Qo),X(Y2),X(Fp,8))},n.\u0275dir=Ft({type:n,selectors:[["","cdk-connected-overlay",""],["","connected-overlay",""],["","cdkConnectedOverlay",""]],inputs:{origin:["cdkConnectedOverlayOrigin","origin"],positions:["cdkConnectedOverlayPositions","positions"],positionStrategy:["cdkConnectedOverlayPositionStrategy","positionStrategy"],offsetX:["cdkConnectedOverlayOffsetX","offsetX"],offsetY:["cdkConnectedOverlayOffsetY","offsetY"],width:["cdkConnectedOverlayWidth","width"],height:["cdkConnectedOverlayHeight","height"],minWidth:["cdkConnectedOverlayMinWidth","minWidth"],minHeight:["cdkConnectedOverlayMinHeight","minHeight"],backdropClass:["cdkConnectedOverlayBackdropClass","backdropClass"],panelClass:["cdkConnectedOverlayPanelClass","panelClass"],viewportMargin:["cdkConnectedOverlayViewportMargin","viewportMargin"],scrollStrategy:["cdkConnectedOverlayScrollStrategy","scrollStrategy"],open:["cdkConnectedOverlayOpen","open"],disableClose:["cdkConnectedOverlayDisableClose","disableClose"],transformOriginSelector:["cdkConnectedOverlayTransformOriginOn","transformOriginSelector"],hasBackdrop:["cdkConnectedOverlayHasBackdrop","hasBackdrop"],lockPosition:["cdkConnectedOverlayLockPosition","lockPosition"],flexibleDimensions:["cdkConnectedOverlayFlexibleDimensions","flexibleDimensions"],growAfterOpen:["cdkConnectedOverlayGrowAfterOpen","growAfterOpen"],push:["cdkConnectedOverlayPush","push"]},outputs:{backdropClick:"backdropClick",positionChange:"positionChange",attach:"attach",detach:"detach",overlayKeydown:"overlayKeydown",overlayOutsideClick:"overlayOutsideClick"},exportAs:["cdkConnectedOverlay"],features:[_r]}),n})();const GW={provide:Y2,deps:[es],useFactory:function qW(n){return()=>n.scrollStrategies.reposition()}};let Ml=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({providers:[es,GW],imports:[eS,wa,lD,lD]}),n})();const WW=["tooltip"];function XW(n,t){1&n&&Ja(0)}function ZW(n,t){if(1&n&&(Yl(0),Jt(1,XW,1,0,"ng-container",7),Kl()),2&n){const e=t.ngIf;Fe(1),rt("ngTemplateOutlet",e)}}function YW(n,t){1&n&&Ye(0),2&n&&Pi(rn().message)}function KW(n,t){if(1&n){const e=Ho();le(0,"button",8),nn("click",function(){return Vi(e),Gi(rn().hide(0))}),bn(1,"sbb-icon",9),pe()}}function QW(n,t){1&n&&$r(0)}const JW=["*"],BD="tooltip-panel",J2=Pp({passive:!0}),eF=new Dt("sbb-tooltip-scroll-strategy"),i7={provide:eF,deps:[es],useFactory:function n7(n){return()=>n.scrollStrategies.reposition({scrollThrottle:20})}},r7=new Dt("sbb-tooltip-default-options",{providedIn:"root",factory:function o7(){return{showDelay:0,hideDelay:0,touchendHideDelay:1500,autoFocus:!0,restoreFocus:!0}}});class tF{constructor(t){this.instance=t}}let s7=(()=>{class n{constructor(e,i,r,s,d,m,y,T,M,R,H){this._overlay=e,this._elementRef=i,this._scrollDispatcher=r,this._viewContainerRef=s,this._ngZone=d,this._platform=m,this._ariaDescriber=y,this._focusMonitor=T,this._defaultOptions=R,this._disabled=!1,this._viewInitialized=!1,this._pointerExitEventsInitialized=!1,this._viewportMargin=8,this._cssClassPrefix="sbb",this.trigger="hover",this._showDelay=this._defaultOptions.showDelay,this._hideDelay=this._defaultOptions.hideDelay,this.touchGestures="auto",this._message="",this.tooltipPanelClass="",this._passiveListeners=[],this._destroyed=new Wt,this.opened=new on,this.dismissed=new on,this._scrollStrategy=M,this._document=H,null!=R&&R.touchGestures&&(this.touchGestures=R.touchGestures)}get disabled(){return this._disabled}set disabled(e){this._disabled=ii(e),this._disabled?this.hide(0):this._setupPointerEnterEventsIfNeeded()}get showDelay(){return this._showDelay}set showDelay(e){this._showDelay=wh(e)}get hideDelay(){return this._hideDelay}set hideDelay(e){this._hideDelay=wh(e),this._tooltipInstance&&(this._tooltipInstance._mouseLeaveHideDelay=this._hideDelay)}get message(){return this._message}set message(e){"string"==typeof this._message&&this._ariaDescriber.removeDescription(this._elementRef.nativeElement,this._message,"tooltip"),this._message=e instanceof ho?e:null!=e?String(e).trim():"",!this._message&&this._isTooltipVisible()?this.hide(0):(this._setupPointerEnterEventsIfNeeded(),this._updateTooltipMessage(),"string"==typeof this._message&&this._ngZone.runOutsideAngular(()=>{Promise.resolve().then(()=>{this._ariaDescriber.describe(this._elementRef.nativeElement,this._message,"tooltip")})}))}get tooltipClass(){return this._tooltipClass}set tooltipClass(e){this._tooltipClass=e,this._tooltipInstance&&this._setTooltipClass(this._tooltipClass)}_preventClickBubbling(e){!this.disabled&&"click"===this.trigger&&e.stopPropagation()}ngAfterViewInit(){this._viewInitialized=!0,this._setupPointerEnterEventsIfNeeded(),this._focusMonitor.monitor(this._elementRef).pipe(Rr(()=>"hover"===this.trigger),Hi(this._destroyed)).subscribe(e=>{e?"keyboard"===e&&this._ngZone.run(()=>this.show()):this._ngZone.run(()=>this.hide(0))})}ngOnDestroy(){const e=this._elementRef.nativeElement;clearTimeout(this._touchstartTimeout),this._overlayRef&&(this._overlayRef.dispose(),this._tooltipInstance=null),this._passiveListeners.forEach(([i,r])=>{e.removeEventListener(i,r,J2)}),this._passiveListeners.length=0,this._destroyed.next(),this._destroyed.complete(),"string"==typeof this._message&&this._ariaDescriber.removeDescription(e,this._message,"tooltip"),this._focusMonitor.stopMonitoring(e)}show(e=this.showDelay){var i,r;if(this.disabled||!this.message||this._isTooltipVisible()&&!this._tooltipInstance._showTimeoutId&&!this._tooltipInstance._hideTimeoutId)return;const s=this._createOverlay();this._detach(),this._portal=this._portal||new ud(this._tooltipComponent,this._viewContainerRef),this._tooltipInstance=s.attach(this._portal).instance,this._tooltipInstance._triggerElement=this._elementRef.nativeElement,this._tooltipInstance._mouseLeaveHideDelay=this._hideDelay,this.message instanceof ho&&this._ariaDescriber.describe(this._elementRef.nativeElement,this._tooltipInstance._elementRef.nativeElement),this._tooltipInstance.afterShown().pipe(Hi(this._destroyed)).subscribe(()=>this.opened.emit(new tF(this))),this._tooltipInstance.afterHidden().pipe(Hi(this._destroyed)).subscribe(()=>{this.dismissed.emit(new tF(this)),this._detach()}),this._setTooltipClass(this._tooltipClass),this._updateTooltipMessage(),"click"===this.trigger?(this._tooltipInstance._config={autoFocus:null===(i=this._defaultOptions.autoFocus)||void 0===i||i,restoreFocus:null===(r=this._defaultOptions.restoreFocus)||void 0===r||r},this._tooltipInstance._initializeWithAttachedContent(),this._tooltipInstance._triggeredByClick=!0):(this._tooltipInstance._config=void 0,this._tooltipInstance._triggeredByClick=!1),this._tooltipInstance.show(e)}hide(e=this.hideDelay){this._tooltipInstance&&this._tooltipInstance.hide(e)}toggle(){this._isTooltipVisible()?this.hide():this.show()}_isTooltipVisible(){return!!this._tooltipInstance&&this._tooltipInstance.isVisible()}_createOverlay(){var e;if(this._overlayRef)return this._overlayRef;const i=this._scrollDispatcher.getAncestorScrollContainers(this._elementRef),r=`${this._cssClassPrefix}-${BD}-`,s=this._overlay.position().flexibleConnectedTo(this._elementRef).withTransformOriginOn(`.${this._cssClassPrefix}-tooltip`).withFlexibleDimensions(!1).withViewportMargin(this._viewportMargin).withScrollableContainers(i).withPositions([{originX:"center",originY:"bottom",overlayX:"center",overlayY:"top",offsetY:2},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top",offsetX:5,offsetY:2,panelClass:`${r}left`},{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top",offsetX:-5,offsetY:2,panelClass:`${r}right`},{originX:"center",originY:"top",overlayX:"center",overlayY:"bottom",offsetY:-2},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom",offsetX:5,offsetY:-2,panelClass:`${r}left`},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom",offsetX:-5,offsetY:-2,panelClass:`${r}right`}]);return s.positionChanges.pipe(Hi(this._destroyed)).subscribe(d=>{this._updateCurrentPositionClass(d.connectionPair),this._tooltipInstance&&d.scrollableViewProperties.isOriginOutsideView&&this._tooltipInstance.isVisible()&&this._ngZone.run(()=>this.hide(0))}),this._overlayRef=this._overlay.create({positionStrategy:s,panelClass:JE(this.tooltipPanelClass).concat(`${this._cssClassPrefix}-${BD}`),scrollStrategy:this._scrollStrategy()}),this._overlayRef.detachments().pipe(Hi(this._destroyed)).subscribe(()=>this._detach()),this._overlayRef.keydownEvents().pipe(Hi(this._destroyed)).subscribe(d=>{this._isTooltipVisible()&&27===d.keyCode&&!xa(d)&&(d.preventDefault(),d.stopPropagation(),this._ngZone.run(()=>this.hide(0)))}),this._overlayRef.outsidePointerEvents().pipe(Hi(this._destroyed)).subscribe(()=>{var d;return null===(d=this._tooltipInstance)||void 0===d?void 0:d._handleBodyInteraction()}),!(null===(e=this._defaultOptions)||void 0===e)&&e.disableTooltipInteractivity&&this._overlayRef.addPanelClass(`${this._cssClassPrefix}-tooltip-panel-non-interactive`),this._overlayRef}_detach(){this._overlayRef&&this._overlayRef.hasAttached()&&(this.message instanceof ho&&this._tooltipInstance&&this._ariaDescriber.removeDescription(this._elementRef.nativeElement,this._tooltipInstance._elementRef.nativeElement),this._overlayRef.detach()),this._tooltipInstance=null}_updateTooltipMessage(){this._tooltipInstance&&(this._tooltipInstance.message=this.message,this._tooltipInstance._markForCheck(),this._ngZone.onMicrotaskEmpty.pipe(Qr(1),Hi(this._destroyed)).subscribe(()=>{this._tooltipInstance&&this._overlayRef.updatePosition()}))}_setTooltipClass(e){this._tooltipInstance&&(this._tooltipInstance.tooltipClass=e,this._tooltipInstance._markForCheck())}_updateCurrentPositionClass(e){const{overlayY:i,originX:r,originY:s}=e;let d;if(d="center"===i?"start"===r?"left":"right":"bottom"===i&&"top"===s?"above":"below",d!==this._currentPosition){const m=this._overlayRef;if(m){const y=`${this._cssClassPrefix}-${BD}-`;m.removePanelClass(y+this._currentPosition),m.addPanelClass(y+d)}this._currentPosition=d}}_setupPointerEnterEventsIfNeeded(){this._disabled||!this.message||!this._viewInitialized||this._passiveListeners.length||("click"===this.trigger?this._passiveListeners.push(["click",()=>this.show(0)]):this._platformSupportsMouseEvents()?this._passiveListeners.push(["mouseenter",()=>{this._setupPointerExitEventsIfNeeded(),this.show()}]):"off"!==this.touchGestures&&(this._disableNativeGesturesIfNecessary(),this._passiveListeners.push(["touchstart",()=>{this._setupPointerExitEventsIfNeeded(),clearTimeout(this._touchstartTimeout),this._touchstartTimeout=setTimeout(()=>this.show(),500)}])),this._addListeners(this._passiveListeners))}_setupPointerExitEventsIfNeeded(){if(this._pointerExitEventsInitialized)return;this._pointerExitEventsInitialized=!0;const e=[];if(this._platformSupportsMouseEvents())e.push(["mouseleave",i=>{var r;const s=i.relatedTarget;(!s||null===(r=this._overlayRef)||void 0===r||!r.overlayElement.contains(s))&&this.hide()}],["wheel",i=>this._wheelListener(i)]);else if("off"!==this.touchGestures){this._disableNativeGesturesIfNecessary();const i=()=>{clearTimeout(this._touchstartTimeout),this.hide(this._defaultOptions.touchendHideDelay)};e.push(["touchend",i],["touchcancel",i])}this._addListeners(e),this._passiveListeners.push(...e)}_addListeners(e){e.forEach(([i,r])=>{this._elementRef.nativeElement.addEventListener(i,r,J2)})}_platformSupportsMouseEvents(){return!this._platform.IOS&&!this._platform.ANDROID}_wheelListener(e){if(this._isTooltipVisible()){const i=this._document.elementFromPoint(e.clientX,e.clientY),r=this._elementRef.nativeElement;i!==r&&!r.contains(i)&&this.hide()}}_disableNativeGesturesIfNecessary(){const e=this.touchGestures;if("off"!==e){const i=this._elementRef.nativeElement,r=i.style;("on"===e||"INPUT"!==i.nodeName&&"TEXTAREA"!==i.nodeName)&&(r.userSelect=r.msUserSelect=r.webkitUserSelect=r.MozUserSelect="none"),("on"===e||!i.draggable)&&(r.webkitUserDrag="none"),r.touchAction="none",r.webkitTapHighlightColor="transparent"}}}return n.\u0275fac=function(e){ru()},n.\u0275dir=Ft({type:n,hostBindings:function(e,i){1&e&&nn("click",function(s){return i._preventClickBubbling(s)})},inputs:{trigger:["sbbTooltipTrigger","trigger"],disabled:["sbbTooltipDisabled","disabled"],showDelay:["sbbTooltipShowDelay","showDelay"],hideDelay:["sbbTooltipHideDelay","hideDelay"],touchGestures:["sbbTooltipTouchGestures","touchGestures"],message:["sbbTooltip","message"],tooltipClass:["sbbTooltipClass","tooltipClass"],tooltipPanelClass:["sbbTooltipPanelClass","tooltipPanelClass"]},outputs:{opened:"opened",dismissed:"dismissed"}}),n})(),nF=(()=>{class n extends s7{constructor(e,i,r,s,d,m,y,T,M,R,H){super(e,i,r,s,d,m,y,T,M,R,H),this._tooltipComponent=l7}}return n.\u0275fac=function(e){return new(e||n)(X(es),X(zn),X(u2),X(Qo),X(di),X(Is),X(GL),X(Pa),X(eF),X(r7,8),X(ui))},n.\u0275dir=Ft({type:n,selectors:[["","sbbTooltip",""]],hostVars:3,hostBindings:function(e,i){2&e&&(Sn("aria-expanded","click"===i.trigger?i._isTooltipVisible():null),Ui("sbb-tooltip-trigger","click"===i.trigger))},exportAs:["sbbTooltip"],features:[Yt]}),n})(),a7=(()=>{class n{constructor(e,i,r,s,d,m){this._elementRef=e,this._focusTrapFactory=i,this._changeDetectorRef=r,this._focusMonitor=s,this._visibility="initial",this._closeInteractionType=null,this._config={},this._closeOnInteraction=!1,this._elementFocusedBeforeDialogWasOpened=null,this._isVisible=!1,this._onShow=new Wt,this._onHide=new Wt,this._triggeredByClick=!1,this._animationsDisabled="NoopAnimations"===m,this._document=d}show(e){clearTimeout(this._hideTimeoutId),this._closeOnInteraction=!0,this._showTimeoutId=setTimeout(()=>{this._showTimeoutId=void 0,this._toggleVisibility(!0)},e)}hide(e){clearTimeout(this._showTimeoutId),this._hideTimeoutId=setTimeout(()=>{this._toggleVisibility(!1),this._hideTimeoutId=void 0,this._markForCheck()},e)}afterShown(){return this._onShow}afterHidden(){return this._onHide}isVisible(){return this._isVisible}ngOnDestroy(){clearTimeout(this._showTimeoutId),clearTimeout(this._hideTimeoutId),this._onShow.complete(),this._onHide.complete(),this._triggerElement=null}_handleBodyInteraction(){this._closeOnInteraction&&this.hide(0)}_initializeWithAttachedContent(){this._setupFocusTrap(),this._capturePreviouslyFocusedElement(),this._focusDialogContainer()}_markForCheck(){this._changeDetectorRef.markForCheck()}_handleMouseLeave({relatedTarget:e}){!this._triggeredByClick&&(!e||!this._triggerElement.contains(e))&&this.hide(this._mouseLeaveHideDelay)}_handleAnimationEnd({animationName:e}){(e===this._showAnimation||e===this._hideAnimation)&&this._finalizeAnimation(e===this._showAnimation)}_finalizeAnimation(e){e?this._closeOnInteraction=!0:this.isVisible()||this._onHide.next(),e&&this.isVisible()&&this._config&&this._trapFocus(),!e&&!this.isVisible()&&this._restoreFocus()}_toggleVisibility(e){const i=this._tooltip.nativeElement,r=this._showAnimation,s=this._hideAnimation;if(i.classList.remove(e?s:r),i.classList.add(e?r:s),this._isVisible=e,e&&!this._animationsDisabled&&"function"==typeof getComputedStyle){const d=getComputedStyle(i);("0s"===d.getPropertyValue("animation-duration")||"none"===d.getPropertyValue("animation-name"))&&(this._animationsDisabled=!0)}e&&this._onShow.next(),this._animationsDisabled&&(i.classList.add("_sbb-animation-noopable"),this._finalizeAnimation(e))}_trapFocus(){var e;null!==(e=this._config)&&void 0!==e&&e.autoFocus?this._focusTrap.focusInitialElementWhenReady():this._containsFocus()||this._elementRef.nativeElement.focus()}_restoreFocus(){var e;const i=this._elementFocusedBeforeDialogWasOpened;if((null===(e=this._config)||void 0===e?void 0:e.restoreFocus)&&i&&"function"==typeof i.focus){const r=pu(),s=this._elementRef.nativeElement;(!r||r===this._document.body||r===s||s.contains(r))&&(this._focusMonitor.focusVia(i,this._closeInteractionType),this._closeInteractionType=null)}this._focusTrap&&this._focusTrap.destroy()}_setupFocusTrap(){this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement)}_capturePreviouslyFocusedElement(){this._document&&(this._elementFocusedBeforeDialogWasOpened=pu())}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){const e=this._elementRef.nativeElement,i=pu();return e===i||e.contains(i)}}return n.\u0275fac=function(e){return new(e||n)(X(zn),X(JL),X(kr),X(Pa),X(ui,8),X(id,8))},n.\u0275dir=Ft({type:n}),n})(),l7=(()=>{class n extends a7{constructor(e,i,r,s,d,m,y){super(e,i,r,s,d,y),this._breakpointObserver=m,this._isHandset=this._breakpointObserver.observe("(max-width: 642.99px) and (orientation: portrait), (max-width: 1024.99px) and (orientation: landscape)"),this._showAnimation="sbb-tooltip-container-show",this._hideAnimation="sbb-tooltip-container-hide"}get _templateRef(){return this.message instanceof ho?this.message:null}}return n.\u0275fac=function(e){return new(e||n)(X(zn),X(JL),X(kr),X(Pa),X(ui,8),X(eD),X(id,8))},n.\u0275cmp=On({type:n,selectors:[["sbb-tooltip-component"]],viewQuery:function(e,i){if(1&e&&yr(WW,7),2&e){let r;Jn(r=ei())&&(i._tooltip=r.first)}},hostAttrs:["aria-hidden","true",1,"sbb-tooltip-component"],hostVars:2,hostBindings:function(e,i){1&e&&nn("mouseleave",function(s){return i._handleMouseLeave(s)}),2&e&&ed("zoom",i.isVisible()?1:null)},features:[Yt],decls:9,vars:10,consts:[[1,"sbb-tooltip-container",3,"animationend"],["tooltip",""],[1,"sbb-tooltip",3,"ngClass"],[1,"sbb-tooltip-content"],[4,"ngIf","ngIfElse"],["stringMessage",""],["type","button","class","sbb-tooltip-icon sbb-tooltip-close-button sbb-icon-fit sbb-button-reset-frameless",3,"click",4,"ngIf"],[4,"ngTemplateOutlet"],["type","button",1,"sbb-tooltip-icon","sbb-tooltip-close-button","sbb-icon-fit","sbb-button-reset-frameless",3,"click"],["svgIcon","kom:cross-small"]],template:function(e,i){if(1&e&&(le(0,"div",0,1),nn("animationend",function(s){return i._handleAnimationEnd(s)}),yb(2,"async"),le(3,"div",2)(4,"div",3),Jt(5,ZW,2,1,"ng-container",4),Jt(6,YW,1,1,"ng-template",null,5,rm),pe(),Jt(8,KW,2,0,"button",6),pe()()),2&e){const r=Zl(7);let s;Ui("sbb-tooltip-handset",null==(s=vb(2,8,i._isHandset))?null:s.matches),Fe(3),Ui("sbb-tooltip-has-close-button",i._triggeredByClick),rt("ngClass",i.tooltipClass),Fe(2),rt("ngIf",i._templateRef)("ngIfElse",r),Fe(3),rt("ngIf",i._triggeredByClick)}},dependencies:[Tb,js,tT,ol,$y],styles:['.sbb-tooltip-component{display:block;filter:drop-shadow(0 var(--sbb-box-shadow-width) 0 var(--sbb-box-shadow-color))}.sbb-tooltip-container{height:100%;font-size:var(--sbb-font-size);line-height:var(--sbb-line-height);opacity:0}.sbb-tooltip-container._sbb-animation-noopable{animation:none;opacity:1}.sbb-tooltip-container::after,.sbb-tooltip-container::before{top:calc(.5*var(--sbb-border-width));left:0;right:0;margin-left:auto;margin-right:auto;content:"";height:var(--sbb-tooltip-content-arrow-size);width:var(--sbb-tooltip-content-arrow-size);position:absolute;pointer-events:none;transform:rotate(45deg);border:var(--sbb-border-width) solid rgba(0,0,0,0)}.sbb-tooltip-panel-above .sbb-tooltip-container::after,.sbb-tooltip-panel-above .sbb-tooltip-container::before{top:auto;bottom:calc(.5*var(--sbb-tooltip-shadow-arrow-size));transform:rotate(225deg)}.sbb-tooltip-panel-left .sbb-tooltip-container::after,.sbb-tooltip-panel-left .sbb-tooltip-container::before{margin-right:var(--sbb-tooltip-arrow-horizontal-space)}.sbb-tooltip-panel-right .sbb-tooltip-container::after,.sbb-tooltip-panel-right .sbb-tooltip-container::before{margin-left:var(--sbb-tooltip-arrow-horizontal-space)}.sbb-tooltip-container::before{border-color:var(--sbb-color-weak-accent);z-index:1}.sbb-tooltip-container::after{background-color:var(--sbb-tooltip-background-color);background-clip:padding-box;z-index:2;--sbb-tooltip-arrow-padding-offset: 0rem;clip-path:polygon(0 0, calc(var(--sbb-tooltip-content-arrow-size) - var(--sbb-tooltip-arrow-padding-offset)) 0, 0 calc(var(--sbb-tooltip-content-arrow-size) - var(--sbb-tooltip-arrow-padding-offset)))}html.sbb-lean .sbb-tooltip-container::after{--sbb-tooltip-arrow-padding-offset: 0.0666666667rem}.sbb-tooltip-panel-above .sbb-tooltip-container{margin-bottom:calc(0.8rem * var(--sbb-scaling-factor))}@keyframes sbb-tooltip-container-show{0%{opacity:0}100%{opacity:1}}@keyframes sbb-tooltip-container-hide{0%{opacity:1}100%{opacity:0}}.sbb-tooltip-container-show{animation:sbb-tooltip-container-show var(--sbb-transition-duration-fast) cubic-bezier(0, 0, 0.2, 1) forwards}.sbb-tooltip-container-hide{animation:sbb-tooltip-container-hide 75ms cubic-bezier(0, 0, 0.2, 1) forwards}.sbb-tooltip{max-width:calc(30.6666666667rem * var(--sbb-scaling-factor));padding:var(--sbb-tooltip-padding);position:relative;overflow:hidden;color:var(--sbb-color-granite);text-overflow:ellipsis;background-color:var(--sbb-tooltip-background-color);border:var(--sbb-border-width) solid var(--sbb-color-weak-accent);border-radius:var(--sbb-border-radius);z-index:2}.cdk-high-contrast-active .sbb-tooltip{outline:solid 1px}.sbb-tooltip-panel-below .sbb-tooltip{margin-top:var(--sbb-tooltip-arrow-offset)}:where(html.sbb-lean) .sbb-tooltip{color:var(--sbb-color-text)}.sbb-tooltip-zero-padding{--sbb-tooltip-padding: 0}.sbb-tooltip-has-close-button{padding-right:calc(4.7333333333rem * var(--sbb-scaling-factor))}:where(html.sbb-lean) .sbb-tooltip-has-close-button{padding-right:3.2rem}.sbb-tooltip-zero-padding .sbb-tooltip-has-close-button{padding-right:0}.sbb-tooltip-close-button{color:var(--sbb-color-weak-accent);position:absolute;width:var(--sbb-icon-size-default);height:var(--sbb-icon-size-default);top:var(--sbb-tooltip-padding);right:var(--sbb-tooltip-padding);line-height:0}:where(html:not(.sbb-lean)) .sbb-tooltip-close-button{border:var(--sbb-border-width-thin) solid var(--sbb-color-storm);border-radius:50%}.sbb-tooltip-panel-non-interactive{pointer-events:none}'],encapsulation:2,changeDetection:0}),n})();const c7=rl(class{});let u7=1,iF=(()=>{class n extends c7{constructor(){super(...arguments),this.id="sbb-tooltip-id-"+u7++,this.trigger="click",this._destroyed=new Wt,this.svgIcon="kom:circle-question-mark-small",this.opened=new on,this.dismissed=new on}get hoverShowDelay(){return this._hoverShowDelay}set hoverShowDelay(e){this._hoverShowDelay=wh(e,0)}get hoverHideDelay(){return this._hoverHideDelay}set hoverHideDelay(e){this._hoverHideDelay=wh(e,0)}ngOnInit(){this._tooltip.opened.pipe(Hi(this._destroyed)).subscribe(e=>this.opened.emit(e)),this._tooltip.dismissed.pipe(Hi(this._destroyed)).subscribe(e=>this.dismissed.emit(e))}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}show(){this._tooltip.show(0)}hide(){this._tooltip.hide(0)}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Yi(n)))(i||n)}}(),n.\u0275cmp=On({type:n,selectors:[["sbb-tooltip"]],viewQuery:function(e,i){if(1&e&&yr(nF,7),2&e){let r;Jn(r=ei())&&(i._tooltip=r.first)}},hostAttrs:[1,"sbb-tooltip-wrapper"],hostVars:2,hostBindings:function(e,i){2&e&&Sn("id",i.id)("aria-expanded",i._tooltip._isTooltipVisible())},inputs:{disabled:"disabled",id:"id",trigger:"trigger",hoverShowDelay:"hoverShowDelay",hoverHideDelay:"hoverHideDelay",svgIcon:"svgIcon",sbbTooltipClass:"sbbTooltipClass",sbbTooltipPanelClass:"sbbTooltipPanelClass"},outputs:{opened:"opened",dismissed:"dismissed"},features:[Yt],ngContentSelectors:JW,decls:5,vars:9,consts:[["type","button",1,"sbb-tooltip-icon","sbb-tooltip-trigger","sbb-icon-scaled","sbb-button-reset-frameless",3,"sbbTooltip","sbbTooltipTrigger","sbbTooltipShowDelay","sbbTooltipHideDelay","sbbTooltipClass","sbbTooltipPanelClass","click"],["tooltip","sbbTooltip"],[3,"svgIcon"],["tooltipTemplate",""]],template:function(e,i){if(1&e){const r=Ho();$o(),le(0,"button",0,1),nn("click",function(){return Vi(r),Gi(Zl(1).show(0))}),bn(2,"sbb-icon",2),pe(),Jt(3,QW,1,0,"ng-template",null,3,rm)}if(2&e){const r=Zl(1),s=Zl(4);Ui("sbb-tooltip-trigger-active",r._isTooltipVisible()),rt("sbbTooltip",s)("sbbTooltipTrigger",i.trigger)("sbbTooltipShowDelay",i.hoverShowDelay)("sbbTooltipHideDelay",i.hoverHideDelay)("sbbTooltipClass",i.sbbTooltipClass)("sbbTooltipPanelClass",i.sbbTooltipPanelClass),Fe(2),rt("svgIcon",i.svgIcon)}},dependencies:[ol,nF],encapsulation:2,changeDetection:0}),n})(),rF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({providers:[i7],imports:[Cm,Tr,Ml,wa,nr,Ao,Em]}),n})();function d7(n,t){if(1&n){const e=Ho();le(0,"div",15)(1,"div",16),nn("click",function(){return Vi(e),Gi(rn().handleTapOnPill())}),Ye(2,"MAP"),pe()()}}function h7(n,t){1&n&&Ja(0)}function p7(n,t){1&n&&Ja(0)}function f7(n,t){1&n&&Ja(0)}function m7(n,t){if(1&n&&(le(0,"div")(1,"div"),Ye(2),pe()()),2&n){const e=rn(3);Fe(2),Vr("Pl. ",e.legInfoDataModel.fromLocationData.platformText,"")}}function g7(n,t){if(1&n&&(le(0,"div")(1,"div"),Ye(2,"Pl. "),le(3,"del"),Ye(4),pe(),le(5,"span",21),Ye(6),pe()()()),2&n){const e=rn(3);Fe(4),Vr(" ",e.legInfoDataModel.fromLocationData.platformText,""),Fe(2),Vr(" ",e.legInfoDataModel.fromLocationData.actualPlatformText,"")}}function b7(n,t){if(1&n&&(le(0,"div"),Jt(1,m7,3,1,"div",19),Jt(2,g7,7,2,"div",19),pe()),2&n){const e=rn(2);Fe(1),rt("ngIf",!e.legInfoDataModel.fromLocationData.actualPlatformText),Fe(1),rt("ngIf",e.legInfoDataModel.fromLocationData.actualPlatformText)}}function _7(n,t){if(1&n&&(le(0,"li"),Ye(1),pe()),2&n){const e=t.$implicit;Fe(1),Vr(" ",e," ")}}function y7(n,t){if(1&n&&(le(0,"div")(1,"p")(2,"strong"),Ye(3),pe()(),le(4,"div"),Ye(5),pe(),le(6,"ul",28),Jt(7,_7,2,1,"li",27),pe()()),2&n){const e=t.$implicit;Fe(3),Pi(e.situationContent.summary),Fe(2),Vr(" ",e.situationContent.description," "),Fe(2),rt("ngForOf",e.situationContent.details)}}function v7(n,t){if(1&n&&(le(0,"div",25)(1,"sbb-tooltip",26),Jt(2,y7,8,3,"div",27),pe()()),2&n){const e=rn(2);Fe(2),rt("ngForOf",e.legInfoDataModel.situations)}}function x7(n,t){if(1&n&&(le(0,"div")(1,"div"),Ye(2),pe()()),2&n){const e=rn(3);Fe(2),Vr("Pl. ",e.legInfoDataModel.toLocationData.platformText,"")}}function w7(n,t){if(1&n&&(le(0,"div")(1,"div"),Ye(2,"Pl. "),le(3,"del"),Ye(4),pe(),le(5,"span",21),Ye(6),pe()()()),2&n){const e=rn(3);Fe(4),Vr(" ",e.legInfoDataModel.toLocationData.platformText,""),Fe(2),Vr(" ",e.legInfoDataModel.toLocationData.actualPlatformText,"")}}function S7(n,t){if(1&n&&(le(0,"div"),Jt(1,x7,3,1,"div",19),Jt(2,w7,7,2,"div",19),pe()),2&n){const e=rn(2);Fe(1),rt("ngIf",!e.legInfoDataModel.toLocationData.actualPlatformText),Fe(1),rt("ngIf",e.legInfoDataModel.toLocationData.actualPlatformText)}}function C7(n,t){if(1&n){const e=Ho();le(0,"div",17)(1,"div",18),nn("click",function(){return Vi(e),Gi(rn().handleClickOnLocation("From"))}),le(2,"span"),Ye(3),pe(),Jt(4,b7,3,2,"div",19),pe(),le(5,"div",20)(6,"span"),Ye(7),pe(),le(8,"span",21),Ye(9),pe()()(),le(10,"div",4)(11,"div",22),bn(12,"div",23),pe(),Jt(13,v7,3,1,"div",24),pe(),le(14,"div",17)(15,"div",18),nn("click",function(){return Vi(e),Gi(rn().handleClickOnLocation("To"))}),le(16,"span"),Ye(17),pe(),Jt(18,S7,3,2,"div",19),pe(),le(19,"div",20)(20,"span"),Ye(21),pe(),le(22,"span",21),Ye(23),pe()()()}if(2&n){const e=rn();Fe(3),Pi(e.legInfoDataModel.fromLocationData.locationText),Fe(1),rt("ngIf",e.legInfoDataModel.fromLocationData.platformText),Fe(3),Pi(e.legInfoDataModel.fromLocationData.timeText),Fe(2),Pi(e.legInfoDataModel.fromLocationData.delayText),Fe(4),rt("ngIf",e.legInfoDataModel.hasSituations),Fe(4),Pi(e.legInfoDataModel.toLocationData.locationText),Fe(1),rt("ngIf",e.legInfoDataModel.toLocationData.platformText),Fe(3),Pi(e.legInfoDataModel.toLocationData.timeText),Fe(2),Pi(e.legInfoDataModel.toLocationData.delayText)}}function T7(n,t){if(1&n&&(le(0,"li"),Ye(1),pe()),2&n){const e=t.$implicit;Fe(1),Vr(" ",e," ")}}function E7(n,t){if(1&n&&(le(0,"sbb-tooltip",33)(1,"ul",28),Jt(2,T7,2,1,"li",27),pe()()),2&n){const e=rn(2);Fe(2),rt("ngForOf",e.legInfoDataModel.guidanceTextLines)}}function D7(n,t){1&n&&(le(0,"div"),bn(1,"div",34),pe())}function I7(n,t){if(1&n){const e=Ho();le(0,"div",17)(1,"div",29)(2,"div",30)(3,"div",31),nn("click",function(){return Vi(e),Gi(rn().handleClickOnLocation("From"))}),Ye(4),pe(),Jt(5,E7,3,1,"sbb-tooltip",32),Jt(6,D7,2,0,"div",19),le(7,"div",31),nn("click",function(){return Vi(e),Gi(rn().handleClickOnLocation("To"))}),Ye(8),pe()()(),le(9,"div",20)(10,"div"),Ye(11),pe()()()}if(2&n){const e=rn();Fe(4),Pi(e.legInfoDataModel.fromLocationData.locationText),Fe(1),rt("ngIf",e.legInfoDataModel.hasGuidance),Fe(1),rt("ngIf",0==e.legInfoDataModel.hasGuidance),Fe(2),Pi(e.legInfoDataModel.toLocationData.locationText),Fe(3),Pi(e.legInfoDataModel.durationText)}}function M7(n,t){if(1&n&&(le(0,"li"),Ye(1," Book on "),le(2,"a",36),Ye(3),pe()()),2&n){const e=t.$implicit;Fe(2),au("href",e.infoURL,yc),Fe(1),Pi(e.agencyName)}}function A7(n,t){if(1&n){const e=Ho();le(0,"div",17)(1,"div",29)(2,"div",30)(3,"div",31),nn("click",function(){return Vi(e),Gi(rn().handleClickOnLocation("From"))}),Ye(4),pe(),le(5,"ul",35),Jt(6,M7,4,2,"li",27),pe(),le(7,"div",31),nn("click",function(){return Vi(e),Gi(rn().handleClickOnLocation("To"))}),Ye(8),pe()()(),le(9,"div",20)(10,"div"),Ye(11),pe()()()}if(2&n){const e=rn();Fe(4),Pi(e.legInfoDataModel.fromLocationData.locationText),Fe(2),rt("ngForOf",e.legInfoDataModel.bookingArrangements),Fe(2),Pi(e.legInfoDataModel.toLocationData.locationText),Fe(3),Pi(e.legInfoDataModel.durationText)}}const k7=function(n){return{"background-color":n}};let R7=(()=>{class n{constructor(e,i){this.mapService=e,this.router=i,this.legInfoDataModel={},this.isEmbed=-1!==this.router.url.indexOf("/embed/")}ngOnInit(){this.leg&&this.initLegInfo(this.leg)}computeLegLeadText(){if(void 0===this.leg)return"n/a";if("TransferLeg"===this.leg.legType){const e="Transfer",i=this.leg;let r="";return i.walkDuration&&(r=" "+i.walkDuration.formatDuration()),e+r}if("ContinousLeg"===this.leg.legType){const i=this.computeLegLeadTextContinousLeg(this.leg);let r="";return this.leg.legDuration&&(r=" "+this.leg.legDuration.formatDuration()),i+r}if("TimedLeg"===this.leg.legType){const i=this.leg.service.formatServiceName();let r="";return this.leg.legDuration&&(r=" "+this.leg.legDuration.formatDuration()),i+r}return this.leg.legType}computeLegLeadTextContinousLeg(e){return"walk"===e.legTransportMode?"Walk":e.isDriveCarLeg()?"Drive":e.isSharedMobility()?"Ride":e.isTaxi()?"others-drive-car"===e.legTransportMode?"Limo":"Taxi":"PLACEHOLDER - NEW MOT?"}computeLegPillClassName(){return this.leg?"ContinousLeg"===this.leg.legType?"continous-leg-pill":"TimedLeg"===this.leg.legType?"timed-leg-pill":"TransferLeg"===this.leg.legType?"transfer-leg-pill":"":""}handleTapOnPill(){if(!this.leg)return;const e=this.leg.computeGeoJSONFeatures(),i=new Vp([]);if(e.forEach(m=>{const y=m.bbox;if(y){const T=new oa(y[0],y[1]);i.extend(T);const M=new oa(y[2],y[3]);i.extend(M)}}),!i.isValid())return console.error("Invalid BBOX for leg"),void console.log(this.leg);const r=new($s().LngLatBounds)(i.asFeatureBBOX());if(r.getSouthWest().distanceTo(r.getNorthEast())<20){const m={lnglat:r.getCenter(),zoom:16};this.mapService.newMapCenterAndZoomRequested.emit(m)}else this.mapService.newMapBoundsRequested.emit({bounds:r})}computeLegColor(){var e,i;return null!==(i=null===(e=this.leg)||void 0===e?void 0:e.computeLegColor())&&void 0!==i?i:Iv.TimedLeg}initLegInfo(e){var i,r,s,d;this.legInfoDataModel.legColor=this.computeLegColor(),this.legInfoDataModel.leadingText=this.computeLegLeadText();const m="TransferLeg"===e.legType;this.legInfoDataModel.guidanceTextLines=[],m&&(null!==(r=null===(i=e.pathGuidance)||void 0===i?void 0:i.sections)&&void 0!==r?r:[]).forEach(Z=>{var te,xe,Ce,et,kt,pt;if(null===Z.guidanceAdvice)return;const en=[null!==(te=Z.guidanceAdvice)&&void 0!==te?te:"","(",null!==(xe=Z.turnAction)&&void 0!==xe?xe:"",") - ",null!==(et=null===(Ce=Z.trackSection)||void 0===Ce?void 0:Ce.roadName)&&void 0!==et?et:""],Xn=null!==(pt=null===(kt=Z.trackSection)||void 0===kt?void 0:kt.length)&&void 0!==pt?pt:0;Xn>0&&(en.push(" ("),en.push(""+Xn),en.push("m)"));const si=en.join("");this.legInfoDataModel.guidanceTextLines.push(si)});let y="TransferLeg"===e.legType;const T="ContinousLeg"===e.legType;if(T){const R=e;y=R.isWalking(),y&&(this.legInfoDataModel.distanceText=R.formatDistance())}this.legInfoDataModel.isWalking=y,this.legInfoDataModel.legTemplate=y?"walk":T&&e.isTaxi()?"taxi":"timed",this.legInfoDataModel.bookingArrangements=T?null===e.serviceBooking?[]:e.serviceBooking.bookingArrangements:[],this.legInfoDataModel.durationText=null!==(d=null===(s=e.legDuration)||void 0===s?void 0:s.formatDuration())&&void 0!==d?d:"",this.legInfoDataModel.hasGuidance=this.legInfoDataModel.guidanceTextLines.length>0;const M=this.computeLegIconFilename(e);this.legInfoDataModel.legIconPath="assets/pictograms/"+M+".png",this.legInfoDataModel.isTimed="TimedLeg"===e.legType,this.legInfoDataModel.fromLocationData=this.computeLocationData(e,"From"),this.legInfoDataModel.toLocationData=this.computeLocationData(e,"To"),this.legInfoDataModel.situations="TimedLeg"!==e.legType?[]:e.service.siriSituations,this.legInfoDataModel.hasSituations=this.legInfoDataModel.situations.length>0}computeLegIconFilename(e){if("TransferLeg"===e.legType)return"picto-walk";if("TimedLeg"===e.legType)return e.service.ptMode.computePublicTransportPictogram();if("ContinousLeg"===e.legType){const i=e;return i.isDriveCarLeg()?"car-sharing":i.isSharedMobility()?"velo-scooter-sharing":i.isTaxi()?"taxi":"picto-walk"}return"picto-bus-fallback"}computeLocationData(e,i){var r;const s="From"===i,m={locationText:null!==(r=(s?e.fromLocation:e.toLocation).locationName)&&void 0!==r?r:"",platformText:null,timeText:null,delayText:null};if("TimedLeg"===e.legType){const y=e,T=s?y.fromStopPoint:y.toStopPoint,M=s?T.departureData:T.arrivalData,R=null==M?void 0:M.timetableTime;if(R){m.timeText=Il.formatTimeHHMM(R);const H=null==M?void 0:M.delayMinutes;if(H){const Z=[];Z.push(" "),Z.push(H>0?"+":""),Z.push(""+H),Z.push("'"),m.delayText=Z.join("")}}m.platformText=T.plannedPlatform,m.actualPlatformText=T.actualPlatform}return m}handleClickOnLocation(e){this.leg&&this.mapService.tryToCenterAndZoomToLocation("From"===e?this.leg.fromLocation:this.leg.toLocation)}}return n.\u0275fac=function(e){return new(e||n)(X(Up),X(Ds))},n.\u0275cmp=On({type:n,selectors:[["result-trip-leg"]],inputs:{leg:"leg"},decls:24,vars:13,consts:[[1,"mb-2","d-flex","flex-row"],[1,"flex-grow-1"],[1,"badge","leg-pill","pill-hover","leg-leading-text",3,"ngStyle","click"],["class","flex-grow-0 leg-right-side",4,"ngIf"],[1,"mb-2","d-flex","flex-row","align-items-center"],[1,"flex-grow-0","leg-left-side"],[1,"d-flex","flex-column","leg-icon-wrapper"],[1,"text-center"],[1,"leg-icon",3,"src"],[4,"ngIf","ngIfThen"],[1,"mb-2"],[1,"border-bottom",2,"height","8px"],["timedLegTemplate",""],["walkingLegTemplate",""],["taxiLegTemplate",""],[1,"flex-grow-0","leg-right-side"],[1,"badge","leg-pill","pill-hover","bg-primary",3,"click"],[1,"d-flex","flex-row","align-items-center"],[1,"flex-grow-1","leg-location","location-hover",3,"click"],[4,"ngIf"],[1,"flex-grow-0","leg-time","leg-right-side"],[1,"time-delay"],[1,"flex-grow-1","leg-location","location-hover"],[1,"border-bottom",2,"height","8px","margin-left","4px"],["class","flex-grow-0 situation-info",4,"ngIf"],[1,"flex-grow-0","situation-info"],["svgIcon","fpl:info"],[4,"ngFor","ngForOf"],[1,"tooltip-list"],[1,"flex-grow-1","leg-location"],[1,"d-flex","flex-column","leg-location"],[1,"location-hover",3,"click"],["svgIcon","kom:arrow-change-horizontal-medium",4,"ngIf"],["svgIcon","kom:arrow-change-horizontal-medium"],[1,"border-bottom",2,"height","8px","margin-left","4px","margin-right","8px"],[1,"booking-arrangement"],["target","_blank",3,"href"]],template:function(e,i){if(1&e&&(le(0,"div",0)(1,"div",1)(2,"div",2),nn("click",function(){return i.handleTapOnPill()}),Ye(3),pe()(),Jt(4,d7,3,0,"div",3),pe(),le(5,"div",4)(6,"div",5)(7,"div",6)(8,"div",7),bn(9,"img",8),pe(),le(10,"div",7),Ye(11),pe()()(),le(12,"div",1),Jt(13,h7,1,0,"ng-container",9),Jt(14,p7,1,0,"ng-container",9),Jt(15,f7,1,0,"ng-container",9),pe()(),le(16,"div",10),bn(17,"div",11),pe(),Jt(18,C7,24,9,"ng-template",null,12,rm),Jt(20,I7,12,5,"ng-template",null,13,rm),Jt(22,A7,12,4,"ng-template",null,14,rm)),2&e){const r=Zl(19),s=Zl(21),d=Zl(23);Fe(2),rt("ngStyle",_C(11,k7,i.legInfoDataModel.legColor)),Fe(1),Pi(i.legInfoDataModel.leadingText),Fe(1),rt("ngIf",!1===i.isEmbed),Fe(5),au("src",i.legInfoDataModel.legIconPath,yc),Fe(2),Pi(i.legInfoDataModel.distanceText),Fe(2),rt("ngIf","walk"==i.legInfoDataModel.legTemplate)("ngIfThen",s),Fe(1),rt("ngIf","timed"==i.legInfoDataModel.legTemplate)("ngIfThen",r),Fe(1),rt("ngIf","taxi"==i.legInfoDataModel.legTemplate)("ngIfThen",d)}},dependencies:[Rc,js,Bk,iF],styles:[".pill-hover[_ngcontent-%COMP%]:hover, .location-hover[_ngcontent-%COMP%]:hover{cursor:pointer}.tooltip-list[_ngcontent-%COMP%]{margin-top:16px;margin-bottom:8px}.leg-left-side[_ngcontent-%COMP%]{width:50px}.leg-right-side[_ngcontent-%COMP%]{width:auto}.leg-leading-text[_ngcontent-%COMP%]{margin-bottom:2px}.leg-icon[_ngcontent-%COMP%]{width:40px;height:40px}.leg-location[_ngcontent-%COMP%]{background-color:transparent;margin-left:4px}.leg-time-wrapper[_ngcontent-%COMP%]{background-color:transparent}.leg-time[_ngcontent-%COMP%]{font-size:15px}.time-delay[_ngcontent-%COMP%]{color:#c45f00}.booking-arrangement[_ngcontent-%COMP%]{margin-top:4px;margin-bottom:4px}.booking-arrangement[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-top:0;padding-left:0}.situation-info[_ngcontent-%COMP%]{margin-left:4px}"]}),n})();function P7(n,t){1&n&&bn(0,"result-trip-leg",4),2&n&&rt("leg",t.$implicit)}let O7=(()=>{class n{constructor(e){this.userTripService=e,this.tripHeaderStats={}}ngOnInit(){var e;this.trip&&this.initTripHeaderStats(this.trip),this.tripPanel&&0===this.idx&&this.tripPanel.open(),null===(e=this.tripPanel)||void 0===e||e.afterExpand.subscribe(r=>{this.trip&&this.userTripService.activeTripSelected.emit(this.trip)})}initTripHeaderStats(e){var i;this.tripHeaderStats.title="Trip "+((null!==(i=this.idx)&&void 0!==i?i:0)+1),this.tripHeaderStats.tripChangesInfo=0===e.stats.transferNo?"direct":1===e.stats.transferNo?e.stats.transferNo+" transfer":e.stats.transferNo+" transfers",this.tripHeaderStats.tripFromTime=Il.formatTimeHHMM(e.stats.startDatetime),this.tripHeaderStats.tripToTime=Il.formatTimeHHMM(e.stats.endDatetime),this.tripHeaderStats.tripDurationS=e.stats.duration.formatDuration(),this.tripHeaderStats.tripDistanceS=Il.formatDistance(e.stats.distanceMeters)}}return n.\u0275fac=function(e){return new(e||n)(X(Nc))},n.\u0275cmp=On({type:n,selectors:[["journey-result-row"]],viewQuery:function(e,i){if(1&e&&yr(Am,7),2&e){let r;Jn(r=ei())&&(i.tripPanel=r.first)}},inputs:{trip:"trip",idx:"idx"},decls:15,vars:8,consts:[[3,"hideToggle"],[1,"d-flex","justify-content-between","w-100","trip-info"],[1,"trip-info-header"],[3,"leg",4,"ngFor","ngForOf"],[3,"leg"]],template:function(e,i){1&e&&(le(0,"sbb-expansion-panel",0)(1,"sbb-expansion-panel-header")(2,"div",1)(3,"div")(4,"div",2),Ye(5),pe(),le(6,"div"),Ye(7),pe()(),le(8,"div",2)(9,"div"),Ye(10),pe(),le(11,"div"),Ye(12),pe()()()(),le(13,"div"),Jt(14,P7,1,1,"result-trip-leg",3),pe()()),2&e&&(rt("hideToggle",!0),Fe(5),ux("",i.tripHeaderStats.title," - ",i.tripHeaderStats.tripChangesInfo,""),Fe(2),ux("",i.tripHeaderStats.tripDurationS," - ",i.tripHeaderStats.tripDistanceS,""),Fe(3),Pi(i.tripHeaderStats.tripFromTime),Fe(2),Pi(i.tripHeaderStats.tripToTime),Fe(2),rt("ngForOf",null==i.trip?null:i.trip.legs))},dependencies:[Rc,Am,mS,R7],styles:[".trip-info[_ngcontent-%COMP%]{font-size:14px}.trip-info-header[_ngcontent-%COMP%]{font-size:16px}"]}),n})();function L7(n,t){if(1&n&&bn(0,"journey-result-row",1),2&n){const i=t.index;rt("trip",t.$implicit)("idx",i)}}let oF=(()=>{class n{constructor(e){this.userTripService=e,this.trips=[]}ngOnInit(){this.userTripService.tripsUpdated.subscribe(e=>{this.trips=e}),this.userTripService.searchParamsReset.subscribe(()=>{this.trips=[]})}}return n.\u0275fac=function(e){return new(e||n)(X(Nc))},n.\u0275cmp=On({type:n,selectors:[["journey-results"]],decls:2,vars:1,consts:[[3,"trip","idx",4,"ngFor","ngForOf"],[3,"trip","idx"]],template:function(e,i){1&e&&(le(0,"sbb-accordion"),Jt(1,L7,1,2,"journey-result-row",0),pe()),2&e&&(Fe(1),rt("ngForOf",i.trips))},dependencies:[Rc,FD,O7],encapsulation:2}),n})();class Pm{static formatMapboxLngLatAsLatLng(t){return t.lat.toFixed(6)+","+t.lng.toFixed(6)}static computePointLngLatFromFeature(t){if("Point"!==t.geometry.type)return null;const e=t.geometry.coordinates;return $s().LngLat.convert(e)}static bboxPxFromLngLatWidthPx(t,e,i,r=null){null===r&&(r=i);const s=t.project(e);return[[s.x-i/2,s.y+r/2],[s.x+i/2,s.y-r/2]]}static areBoundsInsideOtherBounds(t,e){return!(t.getWest()<e.getWest()||t.getNorth()>e.getNorth()||t.getEast()>e.getEast()||t.getSouth()<e.getSouth())}static queryNearbyFeaturesByLayerIDs(t,e,i){const r=Pm.bboxPxFromLngLatWidthPx(t,e,30),s=t.queryRenderedFeatures(r,{layers:i});let d=[],m=null;return s.forEach(y=>{const T=Pm.computePointLngLatFromFeature(y);if(null===T)return;const M=Math.round(e.distanceTo(T));null!==m&&M>m||(m=M,d.push({feature:y,distance:M}))}),d.sort((y,T)=>y.distance-T.distance),d}}class sF{constructor(t){this.map=t,this.container=null,this.debugCenterEl=null,this.debugZoomEl=null}onAdd(t){return this.map=t,this.container=document.createElement("div"),this.container.className="mapboxgl-ctrl mapboxgl-ctrl-group map-control",this.container.innerHTML=document.getElementById("map-debug-control").innerHTML,t.on("move",()=>{this.updateDebugCenter()}),t.on("zoom",()=>{this.updateDebugZoom()}),setTimeout(()=>{this.debugCenterEl=document.getElementById("map_debug_center"),this.debugZoomEl=document.getElementById("map_debug_zoom"),this.updateDebugZoom(),this.updateDebugCenter()},200),this.container}onRemove(){this.map=null,this.container=null}updateDebugZoom(){!this.map||!this.debugZoomEl||(this.debugZoomEl.innerText=this.map.getZoom().toFixed(2).toString())}updateDebugCenter(){if(!this.map||!this.debugCenterEl)return;const t=this.map.getCenter().toArray().map(e=>e.toFixed(6));this.debugCenterEl.innerText=t.join(",")}}class aF{static prettyPrintXML(t){var e=(new DOMParser).parseFromString(t,"application/xml"),i=(new DOMParser).parseFromString(['<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform">','  <xsl:strip-space elements="*"/>','  <xsl:template match="para[content-style][not(text())]">','    <xsl:value-of select="normalize-space(.)"/>',"  </xsl:template>",'  <xsl:template match="node()|@*">','    <xsl:copy><xsl:apply-templates select="node()|@*"/></xsl:copy>',"  </xsl:template>",'  <xsl:output indent="yes"/>',"</xsl:stylesheet>"].join("\n"),"application/xml");try{var r=new XSLTProcessor;r.importStylesheet(i);var s=r.transformToDocument(e);return(new XMLSerializer).serializeToString(s)}catch(m){return console.error("XML_Helpers.prettyPrintXML - fails, see TODO"),t}}}function F7(n,t){}function N7(n,t){}function B7(n,t){1&n&&(le(0,"button",1),bn(1,"sbb-icon",2),pe()),2&n&&rt("aria-label",rn().closeAriaLabel)}const z7=["*"];class gS{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.ariaModal=!0,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.closeOnNavigation=!0,this.closeOnDestroy=!0}}let lF=(()=>{class n extends Cv{constructor(e,i,r,s,d,m,y,T){super(),this._elementRef=e,this._focusTrapFactory=i,this._config=s,this._interactivityChecker=d,this._ngZone=m,this._overlayRef=y,this._focusMonitor=T,this._elementFocusedBeforeDialogWasOpened=null,this._closeInteractionType=null,this.attachDomPortal=M=>{this._portalOutlet.hasAttached();const R=this._portalOutlet.attachDomPortal(M);return this._contentAttached(),R},this._ariaLabelledBy=this._config.ariaLabelledBy||null,this._document=r}_contentAttached(){this._initializeFocusTrap(),this._handleBackdropClicks(),this._captureInitialFocus()}_captureInitialFocus(){this._trapFocus()}ngOnDestroy(){this._restoreFocus()}attachComponentPortal(e){this._portalOutlet.hasAttached();const i=this._portalOutlet.attachComponentPortal(e);return this._contentAttached(),i}attachTemplatePortal(e){this._portalOutlet.hasAttached();const i=this._portalOutlet.attachTemplatePortal(e);return this._contentAttached(),i}_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(e,i){this._interactivityChecker.isFocusable(e)||(e.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{const r=()=>{e.removeEventListener("blur",r),e.removeEventListener("mousedown",r),e.removeAttribute("tabindex")};e.addEventListener("blur",r),e.addEventListener("mousedown",r)})),e.focus(i)}_focusByCssSelector(e,i){let r=this._elementRef.nativeElement.querySelector(e);r&&this._forceFocus(r,i)}_trapFocus(){const e=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||e.focus();break;case!0:case"first-tabbable":this._focusTrap.focusInitialElementWhenReady().then(i=>{i||this._focusDialogContainer()});break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this._config.autoFocus)}}_restoreFocus(){const e=this._config.restoreFocus;let i=null;if("string"==typeof e?i=this._document.querySelector(e):"boolean"==typeof e?i=e?this._elementFocusedBeforeDialogWasOpened:null:e&&(i=e),this._config.restoreFocus&&i&&"function"==typeof i.focus){const r=pu(),s=this._elementRef.nativeElement;(!r||r===this._document.body||r===s||s.contains(r))&&(this._focusMonitor?(this._focusMonitor.focusVia(i,this._closeInteractionType),this._closeInteractionType=null):i.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){const e=this._elementRef.nativeElement,i=pu();return e===i||e.contains(i)}_initializeFocusTrap(){this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=pu())}_handleBackdropClicks(){this._overlayRef.backdropClick().subscribe(()=>{this._config.disableClose&&this._recaptureFocus()})}}return n.\u0275fac=function(e){return new(e||n)(X(zn),X(Ub),X(ui,8),X(gS),X(Sm),X(di),X(Hp),X(Pa))},n.\u0275cmp=On({type:n,selectors:[["cdk-dialog-container"]],viewQuery:function(e,i){if(1&e&&yr(dd,7),2&e){let r;Jn(r=ei())&&(i._portalOutlet=r.first)}},hostAttrs:["tabindex","-1",1,"cdk-dialog-container"],hostVars:6,hostBindings:function(e,i){2&e&&Sn("id",i._config.id||null)("role",i._config.role)("aria-modal",i._config.ariaModal)("aria-labelledby",i._config.ariaLabel?null:i._ariaLabelledBy)("aria-label",i._config.ariaLabel)("aria-describedby",i._config.ariaDescribedBy||null)},features:[Yt],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(e,i){1&e&&Jt(0,F7,0,0,"ng-template",0)},dependencies:[dd],styles:[".cdk-dialog-container{display:block;width:100%;height:100%;min-height:inherit;max-height:inherit}"],encapsulation:2}),n})();class zD{constructor(t,e){this.overlayRef=t,this.config=e,this.closed=new Wt,this.disableClose=e.disableClose,this.backdropClick=t.backdropClick(),this.keydownEvents=t.keydownEvents(),this.outsidePointerEvents=t.outsidePointerEvents(),this.id=e.id,this.keydownEvents.subscribe(i=>{27===i.keyCode&&!this.disableClose&&!xa(i)&&(i.preventDefault(),this.close(void 0,{focusOrigin:"keyboard"}))}),this.backdropClick.subscribe(()=>{this.disableClose||this.close(void 0,{focusOrigin:"mouse"})})}close(t,e){if(this.containerInstance){const i=this.closed;this.containerInstance._closeInteractionType=(null==e?void 0:e.focusOrigin)||"program",this.overlayRef.dispose(),i.next(t),i.complete(),this.componentInstance=this.containerInstance=null}}updatePosition(){return this.overlayRef.updatePosition(),this}updateSize(t="",e=""){return this.overlayRef.updateSize({width:t,height:e}),this}addPanelClass(t){return this.overlayRef.addPanelClass(t),this}removePanelClass(t){return this.overlayRef.removePanelClass(t),this}}const cF=new Dt("DialogScrollStrategy"),V7=new Dt("DialogData"),j7=new Dt("DefaultDialogConfig"),H7={provide:cF,deps:[es],useFactory:function U7(n){return()=>n.scrollStrategies.block()}};let $7=0,uF=(()=>{class n{constructor(e,i,r,s,d,m){this._overlay=e,this._injector=i,this._defaultOptions=r,this._parentDialog=s,this._overlayContainer=d,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new Wt,this._afterOpenedAtThisLevel=new Wt,this._ariaHiddenElements=new Map,this.afterAllClosed=pm(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(Hs(void 0))),this._scrollStrategy=m}get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}open(e,i){const r=this._defaultOptions||new gS;(i=Object.assign(Object.assign({},r),i)).id=i.id||"cdk-dialog-"+$7++,i.id&&this.getDialogById(i.id);const s=this._getOverlayConfig(i),d=this._overlay.create(s),m=new zD(d,i),y=this._attachContainer(d,m,i);return m.containerInstance=y,this._attachDialogContent(e,m,y,i),this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(m),m.closed.subscribe(()=>this._removeOpenDialog(m,!0)),this.afterOpened.next(m),m}closeAll(){VD(this.openDialogs,e=>e.close())}getDialogById(e){return this.openDialogs.find(i=>i.id===e)}ngOnDestroy(){VD(this._openDialogsAtThisLevel,e=>{!1===e.config.closeOnDestroy&&this._removeOpenDialog(e,!1)}),VD(this._openDialogsAtThisLevel,e=>e.close()),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete(),this._openDialogsAtThisLevel=[]}_getOverlayConfig(e){const i=new km({positionStrategy:e.positionStrategy||this._overlay.position().global().centerHorizontally().centerVertically(),scrollStrategy:e.scrollStrategy||this._scrollStrategy(),panelClass:e.panelClass,hasBackdrop:e.hasBackdrop,direction:e.direction,minWidth:e.minWidth,minHeight:e.minHeight,maxWidth:e.maxWidth,maxHeight:e.maxHeight,width:e.width,height:e.height,disposeOnNavigation:e.closeOnNavigation});return e.backdropClass&&(i.backdropClass=e.backdropClass),i}_attachContainer(e,i,r){var s;const d=r.injector||(null===(s=r.viewContainerRef)||void 0===s?void 0:s.injector),m=[{provide:gS,useValue:r},{provide:zD,useValue:i},{provide:Hp,useValue:e}];let y;r.container?"function"==typeof r.container?y=r.container:(y=r.container.type,m.push(...r.container.providers(r))):y=lF;const T=new ud(y,r.viewContainerRef,Xr.create({parent:d||this._injector,providers:m}),r.componentFactoryResolver);return e.attach(T).instance}_attachDialogContent(e,i,r,s){if(e instanceof ho){const d=this._createInjector(s,i,r,void 0);let m={$implicit:s.data,dialogRef:i};s.templateContext&&(m=Object.assign(Object.assign({},m),"function"==typeof s.templateContext?s.templateContext():s.templateContext)),r.attachTemplatePortal(new Tm(e,null,m,d))}else{const d=this._createInjector(s,i,r,this._injector),m=r.attachComponentPortal(new ud(e,s.viewContainerRef,d,s.componentFactoryResolver));i.componentInstance=m.instance}}_createInjector(e,i,r,s){var d;const m=e.injector||(null===(d=e.viewContainerRef)||void 0===d?void 0:d.injector),y=[{provide:V7,useValue:e.data},{provide:zD,useValue:i}];return e.providers&&("function"==typeof e.providers?y.push(...e.providers(i,e,r)):y.push(...e.providers)),e.direction&&(!m||!m.get(Fp,null,ri.Optional))&&y.push({provide:Fp,useValue:{value:e.direction,change:qn()}}),Xr.create({parent:m||s,providers:y})}_removeOpenDialog(e,i){const r=this.openDialogs.indexOf(e);r>-1&&(this.openDialogs.splice(r,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((s,d)=>{s?d.setAttribute("aria-hidden",s):d.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),i&&this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){const e=this._overlayContainer.getContainerElement();if(e.parentElement){const i=e.parentElement.children;for(let r=i.length-1;r>-1;r--){const s=i[r];s!==e&&"SCRIPT"!==s.nodeName&&"STYLE"!==s.nodeName&&!s.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(s,s.getAttribute("aria-hidden")),s.setAttribute("aria-hidden","true"))}}}_getAfterAllClosed(){const e=this._parentDialog;return e?e._getAfterAllClosed():this._afterAllClosedAtThisLevel}}return n.\u0275fac=function(e){return new(e||n)(Ue(es),Ue(Xr),Ue(j7,8),Ue(n,12),Ue(Wb),Ue(cF))},n.\u0275prov=tn({token:n,factory:n.\u0275fac}),n})();function VD(n,t){let e=n.length;for(;e--;)t(n[e])}let q7=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({providers:[uF,H7],imports:[Ml,wa,Cm,wa]}),n})();const Xb={params:{enterAnimationDuration:"150ms",exitAnimationDuration:"75ms"}},G7={dialogContainer:Us("dialogContainer",[vr("void, exit",Yn({opacity:0,transform:"scale(0.7)"})),vr("enter",Yn({transform:"none"})),tr("* => enter",bR([ar("{{enterAnimationDuration}} cubic-bezier(0, 0, 0.2, 1)",Yn({transform:"none",opacity:1})),pT("@*",hT(),{optional:!0})]),Xb),tr("* => void, * => exit",bR([ar("{{exitAnimationDuration}} cubic-bezier(0.4, 0.0, 0.2, 1)",Yn({opacity:0})),pT("@*",hT(),{optional:!0})]),Xb)])};class Av{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.maxWidth="80vw",this.maxHeight="96vh",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.autoFocus=!0,this.restoreFocus=!0,this.delayFocusTrap=!1,this.closeOnNavigation=!0,this.enterAnimationDuration=Xb.params.enterAnimationDuration,this.exitAnimationDuration=Xb.params.exitAnimationDuration}}let dF=(()=>{class n extends lF{constructor(e,i,r,s,d,m,y,T){super(e,i,r,s,d,m,y,T),this._animationStateChanged=new on,this._state="enter"}_captureInitialFocus(){this._config.delayFocusTrap||this._trapFocus()}_getAnimationState(){return{value:this._state,params:{enterAnimationDuration:this._config.enterAnimationDuration||Xb.params.enterAnimationDuration,exitAnimationDuration:this._config.exitAnimationDuration||Xb.params.exitAnimationDuration}}}_openAnimationDone(e){this._config.delayFocusTrap&&this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:e})}}return n.\u0275fac=function(e){return new(e||n)(X(zn),X(Ub),X(ui,8),X(Av),X(Sm),X(di),X(Hp),X(Pa))},n.\u0275cmp=On({type:n,selectors:[["ng-component"]],features:[Yt],decls:0,vars:0,template:function(e,i){},encapsulation:2}),n})(),W7=(()=>{class n extends dF{constructor(e,i,r,s,d,m,y,T,M){super(e,i,r,s,d,m,y,M),this._changeDetectorRef=T}_onAnimationDone({toState:e,totalTime:i}){"enter"===e?this._openAnimationDone(i):"exit"===e&&this._animationStateChanged.next({state:"closed",totalTime:i})}_onAnimationStart({toState:e,totalTime:i}){"enter"===e?this._animationStateChanged.next({state:"opening",totalTime:i}):("exit"===e||"void"===e)&&this._animationStateChanged.next({state:"closing",totalTime:i})}_startExitAnimation(){this._state="exit",this._changeDetectorRef.markForCheck()}}return n.\u0275fac=function(e){return new(e||n)(X(zn),X(Ub),X(ui,8),X(Av),X(Sm),X(di),X(Hp),X(kr),X(Pa))},n.\u0275cmp=On({type:n,selectors:[["sbb-dialog-container"]],hostAttrs:["tabindex","-1","aria-modal","true",1,"sbb-dialog-container"],hostVars:6,hostBindings:function(e,i){1&e&&My("@dialogContainer.done",function(s){return i._onAnimationDone(s)})("@dialogContainer.start",function(s){return i._onAnimationStart(s)}),2&e&&(Mc("id",i._config.id),Sn("role",i._config.role)("aria-labelledby",i._config.ariaLabel?null:i._ariaLabelledBy)("aria-label",i._config.ariaLabel)("aria-describedby",i._config.ariaDescribedBy||null),ky("@dialogContainer",i._getAnimationState()))},features:[Yt],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(e,i){1&e&&Jt(0,N7,0,0,"ng-template",0)},dependencies:[dd],styles:[".sbb-overlay-background{background-color:var(--sbb-color-white-alpha70);align-items:center}.sbb-dialog-container{display:flex;flex-direction:column;border:var(--sbb-border-width) solid var(--sbb-color-weak-accent);box-sizing:border-box;overflow:hidden;outline:0;background-color:var(--sbb-color-background);box-shadow:var(--sbb-box-shadow-below);width:100%;height:100%;min-height:inherit;max-height:inherit}.cdk-high-contrast-active .sbb-dialog-container{outline:solid .0666666667rem}.sbb-dialog-container>*:only-child:not(.sbb-dialog-content){width:100%;height:100%;display:flex;flex-direction:column}.sbb-dialog-content{display:block;padding:var(--sbb-dialog-padding);flex:1 1 auto;max-height:80vh;overflow:auto;-webkit-overflow-scrolling:touch}.sbb-dialog-content>*:first-child{margin-top:0}.sbb-dialog-title{font-size:var(--sbb-font-size);padding:calc(1rem * var(--sbb-scaling-factor)) calc(2.6666666667rem * var(--sbb-scaling-factor)) calc(1rem * var(--sbb-scaling-factor)) var(--sbb-dialog-padding);flex:0 0 auto;display:block;position:relative;box-shadow:var(--sbb-box-shadow-horizontal-border-top);overflow:hidden;white-space:nowrap;text-overflow:ellipsis;min-height:calc(3.5333333333rem * var(--sbb-scaling-factor))}.sbb-dialog-title-close-button{position:absolute;right:calc(1.0666666667rem * var(--sbb-scaling-factor));cursor:pointer;line-height:0}.sbb-dialog-title-close-button:is(:hover,:focus){color:var(--sbb-color-call-to-action-hover)}.sbb-dialog-actions{padding:calc(0.4666666667rem * var(--sbb-scaling-factor)) calc(1.0666666667rem * var(--sbb-scaling-factor));display:flex;flex:0 0 auto;flex-wrap:wrap;gap:var(--sbb-button-gap);align-items:center;box-sizing:content-box;box-shadow:var(--sbb-box-shadow-horizontal-border-bottom)}.sbb-dialog-actions.sbb-dialog-actions-align-start,.sbb-dialog-actions[align=start],.sbb-dialog-actions[align=left]{justify-content:flex-start}.sbb-dialog-actions.sbb-dialog-actions-align-center,.sbb-dialog-actions[align=center]{justify-content:center}.sbb-dialog-actions.sbb-dialog-actions-align-end,.sbb-dialog-actions[align=end]{justify-content:flex-end}"],encapsulation:2,data:{animation:[G7.dialogContainer]}}),n})();class bS{constructor(t,e,i){this.ref=t,this._containerInstance=i,this._afterOpened=new Wt,this._beforeClosed=new Wt,this._state=0,this.disableClose=e.disableClose,this.id=t.id,i._animationStateChanged.pipe(Rr(r=>"opened"===r.state),Qr(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),i._animationStateChanged.pipe(Rr(r=>"closed"===r.state),Qr(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._finishDialogClose()}),t.overlayRef.detachments().subscribe(()=>{this._beforeClosed.next(this._result),this._beforeClosed.complete(),this._finishDialogClose()}),Or(this.backdropClick(),this.keydownEvents().pipe(Rr(r=>27===r.keyCode&&!this.disableClose&&!xa(r)))).subscribe(r=>{this.disableClose||(r.preventDefault(),hF(this,"keydown"===r.type?"keyboard":"mouse"))})}close(t){this._result=t,this._containerInstance._animationStateChanged.pipe(Rr(e=>"closing"===e.state),Qr(1)).subscribe(e=>{this._beforeClosed.next(t),this._beforeClosed.complete(),this.ref.overlayRef.detachBackdrop(),this._closeFallbackTimeout=setTimeout(()=>this._finishDialogClose(),e.totalTime+100)}),this._state=1,this._containerInstance._startExitAnimation()}afterOpened(){return this._afterOpened}afterClosed(){return this.ref.closed}beforeClosed(){return this._beforeClosed}backdropClick(){return this.ref.backdropClick}keydownEvents(){return this.ref.keydownEvents}updatePosition(t){const e=this.ref.config.positionStrategy;return t&&(t.left||t.right)?t.left?e.left(t.left):e.right(t.right):e.centerHorizontally(),t&&(t.top||t.bottom)?t.top?e.top(t.top):e.bottom(t.bottom):e.centerVertically(),this.ref.updatePosition(),this}updateSize(t="",e=""){return this.ref.updateSize(t,e),this}addPanelClass(t){return this.ref.addPanelClass(t),this}removePanelClass(t){return this.ref.removePanelClass(t),this}getState(){return this._state}_finishDialogClose(){this._state=2,this.ref.close(this._result,{focusOrigin:this._closeInteractionType}),this.componentInstance=null}}function hF(n,t,e){return n._closeInteractionType=t,n.close(e)}const X7=new Dt("SbbDialogData"),Z7=new Dt("sbb-dialog-default-options"),pF=new Dt("sbb-dialog-scroll-strategy"),K7={provide:pF,deps:[es],useFactory:function Y7(n){return()=>n.scrollStrategies.block()}};let Q7=0,fF=(()=>{class n{constructor(e,i,r,s,d,m,y,T,M){this._overlay=e,this._defaultOptions=r,this._parentDialog=s,this._dialogRefConstructor=y,this._dialogContainerType=T,this._dialogDataToken=M,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new Wt,this._afterOpenedAtThisLevel=new Wt,this._idPrefix="sbb-dialog-",this.afterAllClosed=pm(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(Hs(void 0))),this._scrollStrategy=m,this._dialog=i.get(uF)}get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}_getAfterAllClosed(){const e=this._parentDialog;return e?e._getAfterAllClosed():this._afterAllClosedAtThisLevel}open(e,i){let r;(i=Object.assign(Object.assign({},this._defaultOptions||new Av),i)).id=i.id||`${this._idPrefix}${Q7++}`,i.scrollStrategy=i.scrollStrategy||this._scrollStrategy(),i.backdropClass=i.backdropClass||"sbb-overlay-background";const s=this._dialog.open(e,Object.assign(Object.assign({},i),{positionStrategy:this._overlay.position().global().centerHorizontally().centerVertically(),disableClose:!0,closeOnDestroy:!1,container:{type:this._dialogContainerType,providers:()=>[{provide:Av,useValue:i},{provide:gS,useValue:i}]},templateContext:()=>({dialogRef:r,lightboxRef:r}),providers:(d,m,y)=>(r=new this._dialogRefConstructor(d,i,y),r.updatePosition(null==i?void 0:i.position),[{provide:this._dialogContainerType,useValue:y},{provide:this._dialogDataToken,useValue:m.data},{provide:this._dialogRefConstructor,useValue:r}])}));return r.componentInstance=s.componentInstance,this.openDialogs.push(r),this.afterOpened.next(r),r.afterClosed().subscribe(()=>{const d=this.openDialogs.indexOf(r);d>-1&&(this.openDialogs.splice(d,1),this.openDialogs.length||this._getAfterAllClosed().next())}),r}closeAll(){this._closeDialogs(this.openDialogs)}getDialogById(e){return this.openDialogs.find(i=>i.id===e)}ngOnDestroy(){this._closeDialogs(this._openDialogsAtThisLevel),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete()}_closeDialogs(e){let i=e.length;for(;i--;)e[i].close()}}return n.\u0275fac=function(e){ru()},n.\u0275prov=tn({token:n,factory:n.\u0275fac}),n})(),bu=(()=>{class n extends fF{constructor(e,i,r,s,d,m){super(e,i,r,d,m,s,bS,W7,X7)}}return n.\u0275fac=function(e){return new(e||n)(Ue(es),Ue(Xr),Ue(Z7,8),Ue(pF),Ue(n,12),Ue(Wb))},n.\u0275prov=tn({token:n,factory:n.\u0275fac}),n})(),J7=0,Zb=(()=>{class n{constructor(e,i,r){this._dialogRef=e,this._elementRef=i,this._dialog=r,this.ariaLabel=$localize`:Aria label to close a dialog@@sbbDialogCloseDialog:Close dialog`,this.type="button",this._canCloseInterceptor=()=>!0}ngOnInit(){this._dialogRef||(this._dialogRef=mF(this._elementRef,this._dialog.openDialogs))}ngOnChanges(e){const i=e._sbbDialogClose||e._sbbDialogCloseResult;i&&(this.dialogResult=i.currentValue)}_onButtonClick(e){!this._canCloseInterceptor()||hF(this._dialogRef,0===e.screenX&&0===e.screenY?"keyboard":"mouse",this.dialogResult)}}return n.\u0275fac=function(e){return new(e||n)(X(bS,8),X(zn),X(bu))},n.\u0275dir=Ft({type:n,selectors:[["","sbb-dialog-close",""],["","sbbDialogClose",""]],hostVars:2,hostBindings:function(e,i){1&e&&nn("click",function(s){return i._onButtonClick(s)}),2&e&&Sn("aria-label",i.ariaLabel||null)("type",i.type)},inputs:{ariaLabel:["aria-label","ariaLabel"],type:"type",dialogResult:["sbb-dialog-close","dialogResult"],_sbbDialogClose:["sbbDialogClose","_sbbDialogClose"]},exportAs:["sbbDialogClose"],features:[_r]}),n})(),e9=(()=>{class n{constructor(e,i,r,s){this._dialogRef=e,this._elementRef=i,this._dialog=r,this._changeDetectorRef=s,this.id="sbb-dialog-title-"+J7++,this.closeAriaLabel=$localize`:Aria label to close a dialog@@sbbDialogCloseDialog:Close dialog`,this._closeEnabled=!0}ngOnInit(){this._dialogRef||(this._dialogRef=mF(this._elementRef,this._dialog.openDialogs)),this._dialogRef&&Promise.resolve().then(()=>{const e=this._dialogRef._containerInstance;!e||(e._config.disableClose&&(this._closeEnabled=!1,this._changeDetectorRef.markForCheck()),e._ariaLabelledBy||(e._ariaLabelledBy=this.id))})}}return n.\u0275fac=function(e){return new(e||n)(X(bS,8),X(zn),X(bu),X(kr))},n.\u0275dir=Ft({type:n,inputs:{id:"id",closeAriaLabel:"closeAriaLabel"}}),n})(),kv=(()=>{class n extends e9{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Yi(n)))(i||n)}}(),n.\u0275cmp=On({type:n,selectors:[["sbb-dialog-title"],["","sbb-dialog-title",""],["","sbbDialogTitle",""]],hostAttrs:[1,"sbb-dialog-title"],hostVars:1,hostBindings:function(e,i){2&e&&Mc("id",i.id)},exportAs:["sbbDialogTitle"],features:[Yt],ngContentSelectors:z7,decls:2,vars:1,consts:[["sbb-dialog-close","","class","sbb-dialog-title-close-button sbb-button-reset-frameless",3,"aria-label",4,"ngIf"],["sbb-dialog-close","",1,"sbb-dialog-title-close-button","sbb-button-reset-frameless",3,"aria-label"],["svgIcon","kom:cross-small"]],template:function(e,i){1&e&&($o(),$r(0),Jt(1,B7,2,1,"button",0)),2&e&&(Fe(1),rt("ngIf",i._closeEnabled))},dependencies:[js,ol,Zb],encapsulation:2,changeDetection:0}),n})(),Rv=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=Ft({type:n,selectors:[["","sbb-dialog-content",""],["sbb-dialog-content"],["","sbbDialogContent",""]],hostAttrs:[1,"sbb-dialog-content","sbb-scrollbar"]}),n})(),Pv=(()=>{class n{constructor(){this.align="end"}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=Ft({type:n,selectors:[["","sbb-dialog-actions",""],["sbb-dialog-actions"],["","sbbDialogActions",""]],hostAttrs:[1,"sbb-dialog-actions"],hostVars:6,hostBindings:function(e,i){2&e&&Ui("sbb-dialog-actions-align-start","start"===i.align)("sbb-dialog-actions-align-center","center"===i.align)("sbb-dialog-actions-align-end","end"===i.align)},inputs:{align:"align"}}),n})();function mF(n,t){let e=n.nativeElement.parentElement;for(;e&&!e.classList.contains("sbb-dialog-container")&&!e.classList.contains("sbb-lightbox-container");)e=e.parentElement;return e?t.find(i=>i.id===e.id):null}let jD=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({providers:[bu,K7],imports:[Tr,q7,Ml,wa,nr,Ao]}),n})(),UD=(()=>{class n{constructor(){this.requestXmlS="n/a",this.responseXmlS="n/a"}updateRequestData(e){this.requestXmlS=e&&e.requestXmlS?aF.prettyPrintXML(e.requestXmlS):"n/a",this.responseXmlS=e&&e.responseXmlS?aF.prettyPrintXML(e.responseXmlS):"n/a"}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=On({type:n,selectors:[["debug-xml-popover"]],decls:15,vars:2,consts:[["sbbDialogTitle",""],["sbbDialogContent",""],[2,"width","500px"],["rows","7",1,"w-100"],["sbbDialogActions",""],["type","button","sbbDialogClose","",1,"btn","btn-secondary"]],template:function(e,i){1&e&&(le(0,"div",0),Ye(1,"Debug XML"),pe(),le(2,"div",1)(3,"div",2)(4,"div"),Ye(5," Request XML "),le(6,"textarea",3),Ye(7),pe()(),le(8,"div"),Ye(9," Response XML "),le(10,"textarea",3),Ye(11),pe()()()(),le(12,"div",4)(13,"button",5),Ye(14," Close "),pe()()),2&e&&(Fe(7),Pi(i.requestXmlS),Fe(4),Pi(i.responseXmlS))},dependencies:[Zb,kv,Rv,Pv],encapsulation:2}),n})();const t9=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"circle","minzoom":0,"paint":{"circle-color":"#0000FF","circle-radius":4,"circle-stroke-width":1,"circle-stroke-color":"#fff"}}'),n9=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":14.5,"layout":{"text-field":"{stopPlace.stopPlaceName} \\n {stopPlace.stopPlaceRefLabel}","text-size":12,"text-justify":"left","text-anchor":"top-left","text-offset":[0.2,0.2]},"paint":{"text-halo-color":"rgba(241, 231, 231, 1)","text-halo-width":1}}'),i9=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"circle","minzoom":0,"paint":{"circle-color":"#eb0000","circle-radius":4,"circle-stroke-width":1,"circle-stroke-color":"#fff"}}'),r9=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":0,"layout":{"icon-image":"poi-charging-station","icon-allow-overlap":true,"icon-size":0.5}}'),o9=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":0,"layout":{"icon-image":"car-15","icon-allow-overlap":true,"icon-size":1.4}}'),s9=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":0,"layout":{"icon-image":"bicycle-15","icon-allow-overlap":true,"icon-size":1.4}}'),a9=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":0,"layout":{"icon-image":"poi-scooter","icon-allow-overlap":true,"icon-size":0.4}}'),_S=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","layout":{"text-field":"{sharedVehicle.itemsNo}","text-allow-overlap":true,"text-size":12,"text-offset":[0.7,-1.2]},"paint":{"text-halo-color":"rgba(241, 231, 231, 1)","text-color":["case",["==",["get","sharedVehicle.itemsNo"],0],"red","#006400"],"text-halo-width":1}}'),yS=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":15,"layout":{"text-field":"{sharedVehicle.provider}","text-allow-overlap":true,"text-size":12,"text-offset":[0,1.2]},"paint":{"text-halo-color":"rgba(241, 231, 231, 1)","text-halo-width":1}}'),gF={"stops-circle":t9,"stops-label":n9,"address-circle":i9,"charging-station-icon":r9,"charging-station-text-number":_S,"charging-station-text-provider":yS,"car-rental-icon":o9,"car-rental-text-number":_S,"car-rental-text-provider":yS,"bike-icon":s9,"bike-text-number":_S,"bike-text-provider":yS,"scooter-icon":a9,"scooter-text-number":_S,"scooter-text-provider":yS,"poi-all":JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":0,"layout":{"icon-image":["get","style.icon-image"],"icon-allow-overlap":true,"icon-size":0.4}}')};class Ov{constructor(t,e,i,r){this.layerKey=t,this.map=e,this.geoRestrictionType=i.LIR_Restriction_Type,this.geoRestrictionPoiOSMTags=i.LIR_POI_Type?Array.isArray(i.LIR_POI_Type)?i.LIR_POI_Type:[i.LIR_POI_Type]:null,this.minZoom=i.minZoom,this.features=[],this.mapSourceID=t+"-map-src",this.userTripService=r,this.isEnabled=!1,this.lastOJPRequest=null,this.addMapSourceAndLayers(),this.currentLocations=[]}addMapSourceAndLayers(){var t;this.map.addSource(this.mapSourceID,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this.layerKey in Im.map_app_map_layers?(null!==(t=Im.map_app_map_layers[this.layerKey].layer_ids)&&void 0!==t?t:[this.layerKey]).forEach(r=>{if(!(r in gF))return void console.error("ERROR - AppMapLayer.addMapSourceAndLayers no layer def for "+r);const d=JSON.parse(JSON.stringify(gF[r]));d.id=r,d.source=this.mapSourceID,this.map.addLayer(d)}):console.error("ERROR - AppMapLayer.addMapSourceAndLayers no layers defined for "+this.layerKey)}shouldLoadNewFeatures(){return!(!this.isEnabled||this.map.getZoom()<this.minZoom)}refreshFeatures(){if(!this.shouldLoadNewFeatures())return void this.removeAllFeatures();const t="poi_all"===this.geoRestrictionType?1e3:300,e=this.map.getBounds(),i=gu.initWithBBOXAndType(this.userTripService.getStageConfig(),e.getWest(),e.getNorth(),e.getEast(),e.getSouth(),this.geoRestrictionType,t,this.geoRestrictionPoiOSMTags);this.lastOJPRequest=i;const r=Im.map_app_map_layers[this.layerKey];i.fetchResponse().then(s=>{this.shouldLoadNewFeatures()||this.removeAllFeatures();const d=[],m={};s.forEach((T,M)=>{var R,H,Z;if(null===T.geoPosition)return;if("poi_amenity"===r.LIR_Restriction_Type&&r.LIR_POI_Type!==(null!==(H=null===(R=T.poi)||void 0===R?void 0:R.category)&&void 0!==H?H:null))return void d.push(T);const te=T.geoPosition.asLatLngString();if(!(te in m)){const et={type:"Feature",properties:{locations_idx:[]},geometry:{type:"Point",coordinates:T.geoPosition.asPosition()}};m[te]=et}const xe=null!==(Z=m[te])&&void 0!==Z?Z:null;null!==xe&&null!==xe.properties&&xe.properties.locations_idx.push(M)}),this.currentLocations=s;const y=Object.values(m);y.forEach(T=>{if(null===T.properties)return;const M=T.properties.locations_idx,R=[];M.forEach(H=>{var Z;const te=null!==(Z=s[H])&&void 0!==Z?Z:null;te&&R.push(te)}),T.properties.locations_idx=M.join(","),this.annotateFeatureFromLocations(T,R)}),this.setSourceFeatures(y)}).catch(s=>{console.log("AppMapLayer: "+this.layerKey+" backend ERROR"),console.log(s)})}removeAllFeatures(){0!==this.features.length&&this.setSourceFeatures([])}setSourceFeatures(t){this.features=t,this.map.getSource(this.mapSourceID).setData({type:"FeatureCollection",features:t})}annotateFeatureFromLocations(t,e){}handleMapClick(t){var e,i,r;if(!this.shouldLoadNewFeatures())return!1;const s=Im.map_app_map_layers[this.layerKey];let d=null!==(e=s.click_layer_ids)&&void 0!==e?e:[];if(0===d.length)return!1;"SAME_AS_LAYER_IDS"===d&&(d=null!==(i=s.layer_ids)&&void 0!==i?i:[this.layerKey]);const m=Pm.queryNearbyFeaturesByLayerIDs(this.map,t.lngLat,d);if(0===m.length)return!1;const y=m[0];if(null===y.feature.properties)return!1;let T=null!==(r=y.feature.properties.locations_idx)&&void 0!==r?r:"";if(T=T.trim(),""===T)return!1;const M=[];T.split(",").forEach(Z=>{var te;const xe=parseInt(Z,10),Ce=null!==(te=this.currentLocations[xe])&&void 0!==te?te:null;Ce&&!(xe in M)&&(M[xe]=Ce)});const H=Object.values(M);return 0!==H.length&&(this.showPopup(H),!0)}showPopup(t){var e,i;const r=t[0],s=null!==(i=null===(e=r.geoPosition)||void 0===e?void 0:e.asLngLat())&&void 0!==i?i:null;if(null===s)return;const d=this.computePopupHTML(t);if(null===d)return;const m=document.createElement("div");m.innerHTML=d;const y=new($s().Popup)({focusAfterOpen:!1,maxWidth:"400px"});m.addEventListener("click",T=>{const R=T.target.getAttribute("data-endpoint-type");null!==R&&(this.userTripService.updateTripEndpoint(r,R,"MapPopupClick"),y.remove())}),y.setLngLat(s).setDOMContent(m).addTo(this.map)}computePopupHTML(t){var e,i,r,s;if(0===t.length)return null;const d=t[0],m=document.getElementById("map-endpoint-picker-popup");if(null===m)return null;let y=m.innerHTML;y=y.replace("[GEO_RESTRICTION_TYPE]",this.geoRestrictionType);const T=null!==(s=null!==(i=null===(e=d.geoPosition)||void 0===e?void 0:e.properties)&&void 0!==i?i:null===(r=d.asGeoJSONFeature())||void 0===r?void 0:r.properties)&&void 0!==s?s:null;if(null==T)return y=y.replace("[GEOJSON_PROPERTIES_TABLE]","ERROR: cant read GeoJSON properties"),y;const M=[];for(let H in T){let Z=T[H];if("string"==typeof Z){const xe=new String(Z);xe.startsWith("http")&&(Z='<a href="'+xe+'" target="_blank">'+xe+"</a>")}M.push("<tr><td>"+H+"</td><td>"+Z+"</td></tr>")}const R='<table class="table">'+M.join("")+"</table>";return y=y.replace("[GEOJSON_PROPERTIES_TABLE]",R),y}}class c9 extends Ov{annotateFeatureFromLocations(t,e){if(null===t.properties||0===e.length)return;let i=0;e.forEach((r,s)=>{"available"===this.computeLocationStatus(r)&&(i+=1)}),t.properties["sharedVehicle.itemsNo"]=i}computeLocationStatus(t){var e;const i=null!==(e=t.attributes.locationStatus)&&void 0!==e?e:null;if(null===i)return null;const r=i.toUpperCase();return"AVAILABALE"===r?"available":"OCCUPIED"===r?"occupied":"UNKNOWN"===r?"unknown":null}computePopupHTML(t){var e;const i=document.getElementById("map-poi-picker-popup");if(null===i||0===t.length)return null;const r=t[0];if(null===r.poi||"charging_station"!==r.poi.category)return null;const s=[];s.push('<tr><td style="width:50px;">Name</td><td>'+r.poi.name+" - "+r.locationName+"</td></tr>");let d=r.poi.code;d=d.replace(r.poi.name,""),d=d.replace(null!==(e=r.locationName)&&void 0!==e?e:"n/a",""),s.push("<tr><td>Code</td><td>"+d+"</td></tr>");const m=[];t.forEach((M,R)=>{var H;if(null===M.poi)return;const Z=this.computeLocationStatus(M);if(null===Z)return;const te=(()=>{let et="bg-success";return"occupied"===Z&&(et="bg-danger"),"unknown"===Z&&(et="bg-secondary"),'<span class="badge rounded-pill '+et+'">'+Z.toUpperCase()+"</span>"})(),xe=null!==(H=M.attributes.Code)&&void 0!==H?H:null;m.push("<li>"+te+" "+xe+"</li>")}),s.push('<tr><td colspan="2"><p>Chargers ('+t.length+")</p><ul>"+m.join("")+"</ul></td></tr>");let y=i.innerHTML;y=y.replace("[POI_NAME]","Charging Station");const T='<table class="table popup-charging-station">'+s.join("")+"</table>";return y=y.replace("[GEOJSON_PROPERTIES_TABLE]",T),y}}class u9 extends Ov{annotateFeatureFromLocations(t,e){null!==t.properties&&(0===e.length||null===e[0].poi||(t.properties["style.icon-image"]=e[0].poi.computePoiMapIcon()))}computePopupHTML(t){if(0===t.length)return null;const e=t[0];if(null===e.poi)return null;const i=document.getElementById("map-poi-picker-popup");if(null===i)return null;let r=i.innerHTML;r=r.replace("[POI_NAME]",e.poi.name);const s=[];s.push("<tr><td>Code</td><td>"+e.poi.code.substring(0,20)+"...</td></tr>"),s.push("<tr><td>Category</td><td>"+e.poi.category+"</td></tr>"),s.push("<tr><td>SubCategory</td><td>"+e.poi.subCategory+"</td></tr>");const d='<table class="table">'+s.join("")+"</table>";return r=r.replace("[GEOJSON_PROPERTIES_TABLE]",d),r}}class Lv{constructor(t,e,i,r,s){this.poiType=t,this.vehicleType=e,this.provider=i,this.code=r,this.name=s,this.hireFacility=null,this.isFixedStation=!1,this.docksNo=null,this.vehiclesNo=null,this.vehicleName=null}static initFromLocation(t){var e,i,r;if(null===t.poi)return null;const s=t.poi.category,d=(()=>{var te;const xe=null!==(te=t.attributes.Code)&&void 0!==te?te:null;return null!==xe?xe:t.poi.code})(),m=(()=>{if("bicycle_rental"===s){if("Publibike"===t.locationName)return["PubliBike","Bike"];if("Publiebike"===t.locationName)return["PubliBike","E-Bike"];if("Nextbike"===t.locationName)return["Nextbike","Bike"]}return d.startsWith("2em_cars")?["2EM Car Sharing","Car"]:d.startsWith("2em_cars_e")?["2EM Car Sharing","E-Car"]:d.startsWith("bird-")?["Bird","E-Scooter"]:d.startsWith("bolt_")?["Bolt","E-Scooter"]:d.startsWith("carvelo2go")?["Carvelo2go","E-CargoBike"]:d.startsWith("donkey_kreuzlingen")?["Regivelo.ch","Bike"]:d.startsWith("donkey_")?["Donkey Republic","Bike"]:d.startsWith("edrivecarsharing")?["E-drive Car Sharing","E-Car"]:d.startsWith("bird-platform-partner-jmfleetswl-")?["JM Fleets","E-Scooter"]:d.startsWith("liemobil_liechtenstein_ebike")?["LIEmobil","E-Bike"]:d.startsWith("lime_")?d.includes("_escooter")?["Lime","E-Scooter"]:["Lime","E-Bike"]:d.startsWith("mobility")?["Mobility","Car"]:d.startsWith("emobility")?["Mobility","E-Car"]:d.startsWith("nextbike_ch")?["Nextbike","Bike"]:d.startsWith("pickebike_")?d.includes("_emoped")?["Pick-e-Bike","E-Moped"]:["Pick-e-Bike","E-Bike"]:d.startsWith("share_birrer_ch")?["Share Birrer","E-Car"]:d.startsWith("sponticar")?["Sponti-Car","E-Car"]:d.startsWith("tier")?["TIER","E-Scooter"]:d.startsWith("tier_ebike")?["TIER","E-Bike"]:d.startsWith("voiscooters.com")?["VOI","E-Scooter"]:[null,"E-Scooter"]})(),y=m[0],T=m[1];if(null===y)return console.error("CANT DETECT provider"),console.log(t),null;const M="escooter_rental"===s?null!==(te=t.attributes.Text)&&void 0!==te?te:null:"2EM Car Sharing"===y?y:"bicycle_rental"===s||"car_sharing"===s?t.poi.name:null;var te;if(null===M)return console.error("CANT find name"),console.log(t),null;const R=new Lv(s,T,y,d,M),H=null!==(e=t.attributes.num_docks_available)&&void 0!==e?e:null;null!==H&&(R.docksNo=parseInt(H,10));const Z=null!==(i=t.attributes.num_vehicles_available)&&void 0!==i?i:null;return null!==Z&&(R.isFixedStation=!0,R.vehiclesNo=parseInt(Z,10)),R.hireFacility=null!==(r=t.attributes.HireFacility)&&void 0!==r?r:null,"2EM Car Sharing"===y&&(R.vehicleName=t.poi.name),R}computeProviderLabel(){return"2EM Car Sharing"===this.provider?"2EM Car":"Carvelo2go"===this.provider?"Carvelo":"E-drive Car Sharing"===this.provider?"E-drive":"Donkey Republic"===this.provider?"Donkey Rep.":this.provider}}class d9 extends Ov{annotateFeatureFromLocations(t,e){if(null===t.properties||0===e.length)return;let i=null;e.forEach(s=>{const d=Lv.initFromLocation(s);null!==d&&null!==d.vehiclesNo&&(null===i&&(i=0),i+=d.vehiclesNo)}),null!==i&&(t.properties["sharedVehicle.itemsNo"]=i);const r=Lv.initFromLocation(e[0]);r&&(t.properties["sharedVehicle.provider"]=r.computeProviderLabel())}computePopupHTML(t){if(0===t.length)return null;const e=document.getElementById("map-poi-picker-popup");if(null===e)return null;let i=e.innerHTML;const r=[];if(t.forEach(M=>{const R=Lv.initFromLocation(M);R&&r.push(R)}),0===r.length){const M=t[0];i=i.replace("[POI_NAME]","GENERIC SHARED MOBILITY");const R=[];for(let Z in M.attributes){let te=M.attributes[Z];if("string"==typeof te){const Ce=new String(te);Ce.startsWith("http")&&(te='<a href="'+Ce+'" target="_blank">'+Ce+"</a>")}R.push("<tr><td>"+Z+"</td><td>"+te+"</td></tr>")}const H='<table class="table">'+R.join("")+"</table>";return i=i.replace("[GEOJSON_PROPERTIES_TABLE]",H),null}const s=r[0];i=i.replace("[POI_NAME]",s.provider);const m=[];if(m.push('<tr><td style="width:75px;">Name</td><td>'+s.name+"</td></tr>"),m.push("<tr><td>Code</td><td>"+s.code+"</td></tr>"),s.isFixedStation){const M=[];r.forEach(R=>{let Z=R.vehiclesNo+" "+R.vehicleType+(1===R.vehiclesNo?"":"s");null!==R.vehicleName&&(Z+=" - "+R.vehicleName),M.push("<li>"+Z+"</li>")}),m.push('<tr><td class="align-middle">Vehicles</td><td><ul>'+M.join("")+"</ul></td></tr>")}const T='<div class="popup-shared-mobility">'+['<table class="table">'+m.join("")+"</table>"].join("")+"</div>";return i=i.replace("[GEOJSON_PROPERTIES_TABLE]",T),i}}class h9 extends Ov{annotateFeatureFromLocations(t,e){if(null===t.properties||0===e.length)return;const i=e[0];if(null===i.stopPlace)return;const r=i.stopPlace.stopPlaceRef;t.properties["stopPlace.stopPlaceRef"]=r,t.properties["stopPlace.stopPlaceName"]=i.stopPlace.stopPlaceName;let s=r.slice();s.length>32&&(s=r.substring(0,32)+"..."),t.properties["stopPlace.stopPlaceRefLabel"]=s}computePopupHTML(t){var e,i;if(0===t.length)return null;const r=document.getElementById("map-endpoint-stop-picker-popup");if(null===r)return null;const s=t[0],d=s.computeLocationName(),m=null!==(i=null===(e=s.stopPlace)||void 0===e?void 0:e.stopPlaceRef)&&void 0!==i?i:null;if(null===d||null===m)return null;let y=r.innerHTML;return y=y.replace("[STOP_NAME]",d),y=y.replace("[STOP_ID]",m),y}}class bF{static init(t,e,i,r){return"stop"===i.LIR_Restriction_Type?new h9(t,e,i,r):"poi_amenity"===i.LIR_Restriction_Type&&"charging_station"===i.LIR_POI_Type?new c9(t,e,i,r):"poi_amenity"===i.LIR_Restriction_Type?new d9(t,e,i,r):"poi_all"===i.LIR_Restriction_Type?new u9(t,e,i,r):new Ov(t,e,i,r)}}class _F{constructor(t,e,i){this.debugXmlPopover=e,this.prevMapBoundsHash="",this.map=t,this.layersData=[],this.userTripService=i}onAdd(t){this.map=t;const e=document.createElement("div");return e.className="mapboxgl-ctrl mapboxgl-ctrl-group map-control",e.innerHTML=document.getElementById("map-layers-legend-control").innerHTML,this.addLayers(e,t),this.addPOICompositeLayers(e,t),t.on("zoom",i=>{this.onZoomChanged(t)}),this.onZoomChanged(t),t.on("idle",i=>{this.handleMapIdleEvents(t)}),t.on("click",i=>{this.handleMapClickEvents(i,t)}),e}onRemove(){this.map=null}addLayers(t,e){t.querySelectorAll(".map-layer-data").forEach(i=>{var r;const s=i.getAttribute("data-map-layer-key");if(null===s)return;const d=i.querySelector(".map-layer-checkbox");if(null===d)return;const m=i.querySelector(".layer-xml-info"),y=null!==(r=Im.map_app_map_layers[s])&&void 0!==r?r:null;if(null===y)return console.error("ERROR - MapLayersLegendControl - cant find layerKey "+s+" in APP_CONFIG"),d.disabled=!0,i.insertAdjacentHTML("beforeend",'<span class="badge bg-danger text-white">ERROR</span>'),void(m&&m.classList.add("d-none"));const T=bF.init(s,e,y,this.userTripService);T.isEnabled=d.checked,m&&this.addLayerInfoClickHandler(m,T),d.addEventListener("change",R=>{T.isEnabled=d.checked,d.checked?T.refreshFeatures():T.removeAllFeatures()}),this.layersData.push({inputEls:[d],xmlInfoEl:m,layer:T})})}addLayerInfoClickHandler(t,e){t.addEventListener("click",i=>{const r=e.lastOJPRequest;if(r){const s=this.debugXmlPopover.open(UD,{position:{top:"10px"}});s.afterOpened().subscribe(()=>{s.componentInstance.updateRequestData(r.lastRequestData)})}})}addPOICompositeLayers(t,e){t.querySelectorAll(".map-composite-pois").forEach(i=>{this.addPOICompositeLayer(i,e)})}addPOICompositeLayer(t,e){const i="pois-ALL",r=JSON.parse(JSON.stringify(Im.map_app_map_layers[i])),s=[],d=[];t.querySelectorAll(".map-layer-poi").forEach(M=>{const R=M,H=R.getAttribute("data-osm-tag");null!==H&&(d.push(R),R.checked&&s.push(H),R.addEventListener("change",Z=>{const te=[];d.forEach(xe=>{const Ce=xe.getAttribute("data-osm-tag");xe.checked&&Ce&&te.push(Ce)}),m.geoRestrictionPoiOSMTags=te,m.isEnabled=te.length>0,m.refreshFeatures(),T.xmlInfoEl&&(m.isEnabled?T.xmlInfoEl.classList.remove("d-none"):T.xmlInfoEl.classList.add("d-none"))}))}),r.LIR_POI_Type=s;const m=bF.init(i,e,r,this.userTripService);m.isEnabled=s.length>0;const y=t.querySelector(".layer-xml-info");this.addLayerInfoClickHandler(y,m);const T={layer:m,inputEls:d,xmlInfoEl:y};this.layersData.push(T)}handleMapIdleEvents(t){const e=t.getBounds().toString();this.prevMapBoundsHash!==e&&(this.prevMapBoundsHash=e,this.layersData.forEach(r=>{r.layer.refreshFeatures()}))}onZoomChanged(t){this.layersData.forEach(e=>{var i;const r=e.layer.minZoom,s=t.getZoom()<r;null===(i=e.inputEls)||void 0===i||i.forEach(d=>{d.disabled=s}),e.xmlInfoEl&&(s?e.xmlInfoEl.classList.add("d-none"):e.xmlInfoEl.classList.remove("d-none"))})}handleMapClickEvents(t,e){let i=!1;this.layersData.forEach(r=>{i||r.layer.handleMapClick(t)&&(i=!0)})}}const p9=JSON.parse('{"id":"ojp-trip-leg-beeline","type":"line","source":"[SOURCE]","filter":["[CASE_FILTER_BY_DRAW_TYPE]"],"layout":{"line-join":"round","line-cap":"round","visibility":"visible"},"paint":{"line-width":4,"line-opacity":0.4,"line-color":["[CASE_COLOR_BY_LEG_TYPE]"]}}'),f9=JSON.parse('{"id":"ojp-trip-timed-leg-point-circle","type":"circle","source":"[SOURCE]","filter":["[FILTER BY DRAW_TYPE == TimedLegPoint]"],"layout":{},"paint":{"circle-radius":["IF POINT_TYPE: FROM",4,"IF POINT_TYPE: TO",8,"OTHERWISE",2],"circle-color":["IF POINT_TYPE: TO","COLOR BY TIMED_LEG","OTHERWISE","#FFF"],"circle-stroke-color":["IF POINT_TYPE: TO","#FFF","OTHERWISE","COLOR BY TIMED_LEG"],"circle-stroke-width":["IF POINT_TYPE: FROM",4,"IF POINT_TYPE: TO",1,"OTHERWISE",3]}}'),m9=JSON.parse('{"id":"ojp-trip-timed-leg-track","type":"line","source":"[SOURCE]","filter":["[FILTER BY DRAW_TYPE == TimedLegLine]"],"layout":{"line-join":"round","line-cap":"round","visibility":"visible"},"paint":{"line-width":4,"line-opacity":1,"line-color":["[CASE COLOR BY TIMED_LEG"]}}'),g9=JSON.parse('{"id":"ojp-trip-walking-leg-line","type":"line","source":"[SOURCE]","filter":["all","[FILTER BY DRAW_TYPE == ContinousLegLine]","[FILTER BY LINE_TYPE == Walk]"],"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":"#009933","line-width":4,"line-dasharray":[0.2,2]}}');class b9{constructor(t){this.mapSourceId="trip-data",this.features=[],this.map=t,this.addMapSourceAndLayers()}renderTrip(t){if(t){const e=t.computeGeoJSON();this.setSourceFeatures(e.features)}else this.removeAllFeatures()}addMapSourceAndLayers(){this.map.addSource(this.mapSourceId,{type:"geojson",data:{type:"FeatureCollection",features:[]}});const t=p9;t.filter=Fc.FilterBeelines(),t.paint&&(t.paint["line-color"]=Fc.ColorCaseByLegLineType());const e=Fc.ColorCaseByLegLineType(),i=f9;if(i.filter=Fc.FilterLegPoints(),i.paint){const m=["case",Fc.FilterByPointType("From"),4,Fc.FilterByPointType("To"),8,2];i.paint["circle-radius"]=m;const y=["case",Fc.FilterByPointType("To"),e,"#FFF"];i.paint["circle-color"]=y;const T=["case",Fc.FilterByPointType("To"),"#FFF",e];i.paint["circle-stroke-color"]=T;const M=["case",Fc.FilterByPointType("From"),4,Fc.FilterByPointType("To"),1,3];i.paint["circle-stroke-width"]=M}const r=m9;r.filter=Fc.FilterTimedLegTracks(),r.paint&&(r.paint["line-color"]=e);const s=g9;s.filter=Fc.FilterWalkingLegs(),s.paint&&(s.paint["line-color"]=Iv.ContinousLeg),[t,r,s,i].forEach(m=>{const y=m;y.source=this.mapSourceId,this.map.addLayer(y)})}removeAllFeatures(){0!==this.features.length&&this.setSourceFeatures([])}setSourceFeatures(t){this.features=t,this.map.getSource(this.mapSourceId).setData({type:"FeatureCollection",features:t})}}let _9=(()=>{class n{constructor(e,i,r){this.userTripService=e,this.mapService=i,this.debugXmlPopover=r,this.fromMarker=new($s().Marker),this.toMarker=new($s().Marker),["From","To"].forEach(d=>{var m=document.createElement("div");m.className="marker-journey-endpoint marker-journey-endpoint-"+d;const y=new($s().Marker)({element:m,draggable:!0,anchor:"bottom"});y.on("dragend",T=>{this.handleMarkerDrag(y,d)}),"From"===d&&(this.fromMarker=y),"To"===d&&(this.toMarker=y)}),this.viaMarkers=[],this.mapLoadingPromise=null,this.popupContextMenu=new($s().Popup)({focusAfterOpen:!1}),this.tripRenderController=null}ngOnInit(){this.userTripService.geoLocationsUpdated.subscribe(e=>{this.updateMarkers()}),this.userTripService.activeTripSelected.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{var s;null===(s=this.tripRenderController)||void 0===s||s.renderTrip(e)})}),this.mapService.newMapBoundsRequested.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{var s,d;const m=e.bounds,y=null!==(s=e.padding)&&void 0!==s?s:100;if(null!==(d=e.onlyIfOutside)&&void 0!==d&&d&&Pm.areBoundsInsideOtherBounds(m,r.getBounds()))return;const M=[m.getWest(),m.getSouth(),m.getEast(),m.getNorth()];r.fitBounds(M,{padding:y,duration:0})})}),this.mapService.newMapCenterAndZoomRequested.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{r.jumpTo({center:e.lnglat,zoom:e.zoom})})}),this.userTripService.viaAtIndexRemoved.subscribe(e=>{e>this.viaMarkers.length-1||(this.viaMarkers[e].remove(),this.viaMarkers.splice(e,1))}),this.initMap()}initMap(){const e=new($s().LngLatBounds)([[5.9559,45.818],[10.4921,47.8084]]),i=new($s().Map)({container:"map_canvas",style:"mapbox://styles/mapbox/light-v10",bounds:e,accessToken:"pk.eyJ1IjoidmFzaWxlIiwiYSI6ImNra2k2dWFkeDFrbG0ycXF0Nmg0Z2tsNXAifQ.nK-i-3cpWmji7HvK1Ilynw"});this.mapService.initialMapCenter?(i.setCenter(this.mapService.initialMapCenter),this.mapService.initialMapZoom&&i.setZoom(this.mapService.initialMapZoom)):i.fitBounds(e,{padding:50,duration:0}),this.mapLoadingPromise=new Promise((r,s)=>{i.on("load",d=>{r(i),this.onMapLoad(i)})})}updateMarkers(){["From","To"].forEach(s=>{var d;const m="From"===s,y=m?this.userTripService.fromTripLocation:this.userTripService.toTripLocation;this.updateMarkerLocation(m?this.fromMarker:this.toMarker,null!==(d=null==y?void 0:y.location)&&void 0!==d?d:null)});const i=this.viaMarkers.length,r=this.userTripService.viaTripLocations.length;if(i>r){let s=this.viaMarkers;r>0&&(s=this.viaMarkers.splice(r,i-r)),s.forEach(d=>{d.remove()})}this.userTripService.viaTripLocations.forEach((s,d)=>{var m;let y=null!==(m=this.viaMarkers[d])&&void 0!==m?m:null;null===y&&(y=this.createViaMarker(s.location),this.viaMarkers.push(y)),this.updateMarkerLocation(y,s.location)})}handleMarkerDrag(e,i){const r=e.getLngLat();let s=fs.initWithLngLat(r.lng,r.lat);this.userTripService.updateTripEndpoint(s,i,"MapDragend")}onMapLoad(e){this.addMapControls(e),e.on("contextmenu",i=>{this.showPickupPopup(e,i.lngLat)}),e.on("styleimagemissing",i=>{e.loadImage("./assets/map-style-icons/"+i.id+".png",(s,d)=>{s?console.error(s):!e.hasImage(i.id)&&d&&e.addImage(i.id,d)})}),this.tripRenderController=new b9(e)}showPickupPopup(e,i){let r=document.getElementById("map-endpoint-coords-picker-popup").innerHTML;const s=Pm.formatMapboxLngLatAsLatLng(i);r=r.replace("[PICKER_COORDS]",s);const d=document.createElement("div");d.innerHTML=r,d.addEventListener("click",m=>{const T=m.target.getAttribute("data-endpoint-type");if(null===T)return;const M=fs.initWithLngLat(i.lng,i.lat);this.userTripService.updateTripEndpoint(M,T,"MapPopupClick"),this.popupContextMenu.remove()}),this.popupContextMenu.setLngLat(i).setDOMContent(d).addTo(e)}addMapControls(e){const i=new($s().NavigationControl)({showCompass:!1,visualizePitch:!1});e.addControl(i,"bottom-right");const r=new($s().ScaleControl)({maxWidth:200,unit:"metric"});e.addControl(r);const s=new sF(e);e.addControl(s,"top-left");const d=new _F(e,this.debugXmlPopover,this.userTripService);e.addControl(d,"top-right")}updateMarkerLocation(e,i){var r,s,d;const m=null!==(s=null===(r=null==i?void 0:i.geoPosition)||void 0===r?void 0:r.asLngLat())&&void 0!==s?s:null;if(null===m)return void e.remove();const y=void 0===e.getLngLat();e.setLngLat(m),y&&(null===(d=this.mapLoadingPromise)||void 0===d||d.then(T=>{e.addTo(T)}))}createViaMarker(e){var i;const r=document.createElement("div");r.className="marker-journey-endpoint marker-journey-endpoint-Via";let s=!1;null===(null===(i=e.geoPosition)||void 0===i?void 0:i.properties)&&(s=!0);const d=new($s().Marker)({element:r,anchor:"bottom",draggable:s}),m=this.viaMarkers.length;return d.on("dragend",y=>{const T=d.getLngLat();let M=fs.initWithLngLat(T.lng,T.lat);this.userTripService.updateViaPoint(M,m)}),d}}return n.\u0275fac=function(e){return new(e||n)(X(Nc),X(Up),X(bu))},n.\u0275cmp=On({type:n,selectors:[["app-map"]],decls:48,vars:0,consts:[["id","map_canvas",1,"map_wrapper"],[1,"d-none"],["id","map-endpoint-coords-picker-popup"],[1,"popup-picker","p-2"],[1,"popup-picker-header","mb-2"],[1,"popup-picker-body"],["type","button","data-endpoint-type","From",1,"btn","btn-primary","btn-sm"],["type","button","data-endpoint-type","To",1,"btn","btn-primary","btn-sm"],["type","button","data-endpoint-type","Via",1,"btn","btn-primary","btn-sm"],["id","map-endpoint-stop-picker-popup"],["id","map-endpoint-picker-popup"],["id","map-poi-picker-popup"]],template:function(e,i){1&e&&(bn(0,"div",0),le(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),Ye(5," Coords: [PICKER_COORDS] "),pe(),le(6,"div",5)(7,"button",6),Ye(8,"From"),pe(),le(9,"button",7),Ye(10,"To"),pe(),le(11,"button",8),Ye(12,"Via"),pe()()()(),le(13,"div",9)(14,"div",3)(15,"div",4),Ye(16," [STOP_NAME] ([STOP_ID]) "),pe(),le(17,"div",5)(18,"button",6),Ye(19,"From"),pe(),le(20,"button",7),Ye(21,"To"),pe(),le(22,"button",8),Ye(23,"Via"),pe()()()(),le(24,"div",10)(25,"div",3)(26,"div",4),Ye(27," TYPE: [GEO_RESTRICTION_TYPE] "),pe(),le(28,"div",5),Ye(29," [GEOJSON_PROPERTIES_TABLE] "),le(30,"button",6),Ye(31,"From"),pe(),le(32,"button",7),Ye(33,"To"),pe(),le(34,"button",8),Ye(35,"Via"),pe()()()(),le(36,"div",11)(37,"div",3)(38,"div",4),Ye(39," [POI_NAME] "),pe(),le(40,"div",5),Ye(41," [GEOJSON_PROPERTIES_TABLE] "),le(42,"button",6),Ye(43,"From"),pe(),le(44,"button",7),Ye(45,"To"),pe(),le(46,"button",8),Ye(47,"Via"),pe()()()()())},styles:[".map_wrapper[_ngcontent-%COMP%]{height:600px;border:1px solid #e5e5e5}.popup-picker-body[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:2px}"]}),n})();function y9(n,t){1&n&&bn(0,"span",11)}let v9=(()=>{class n{constructor(e){this.userTripService=e,this.tripCustomRequestSaved=new on,this.tripCustomResponseSaved=new on,this.inputTripRequestXmlS="... loading",this.inputTripRequestResponseXmlS="Paste custom OJP TripRequest Response XML here...",this.isRunningTripRequest=!1}parseCustomRequestXML(){this.isRunningTripRequest=!0;const e=this.userTripService.getStageConfig();new qb(e).fetchOJPResponse(this.inputTripRequestXmlS,r=>{this.isRunningTripRequest=!1,this.tripCustomRequestSaved.emit(r)})}parseCustomResponseXML(){this.tripCustomResponseSaved.emit(this.inputTripRequestResponseXmlS)}}return n.\u0275fac=function(e){return new(e||n)(X(Nc))},n.\u0275cmp=On({type:n,selectors:[["input-xml-popover"]],outputs:{tripCustomRequestSaved:"tripCustomRequestSaved",tripCustomResponseSaved:"tripCustomResponseSaved"},decls:26,vars:5,consts:[["sbbDialogTitle",""],["sbbDialogContent",""],[2,"width","500px"],[1,"d-flex","justify-content-between"],["target","_blank","href","https://opentransportdata.swiss/en/cookbook/ojptriprequest/"],["rows","7",1,"w-100",3,"ngModel","ngModelChange"],[1,"d-flex"],["type","button",1,"btn","btn-primary",3,"disabled","click"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],["sbbDialogActions",""],["type","button","sbbDialogClose","",1,"btn","btn-secondary"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"]],template:function(e,i){1&e&&(le(0,"div",0),Ye(1,"Custom Trip Request / Response XML"),pe(),le(2,"div",1)(3,"div",2)(4,"div",3)(5,"div"),Ye(6,"Trip Request XML"),pe(),le(7,"div")(8,"a",4),Ye(9,"Cookbook opentransportdata.swiss"),pe()()(),le(10,"textarea",5),nn("ngModelChange",function(s){return i.inputTripRequestXmlS=s}),pe(),le(11,"div",6)(12,"button",7),nn("click",function(){return i.parseCustomRequestXML()}),Jt(13,y9,1,0,"span",8),Ye(14," Execute OJPTripRequest "),pe()(),bn(15,"hr"),le(16,"div",3)(17,"div"),Ye(18,"Trip Request Response XML"),pe()(),le(19,"textarea",5),nn("ngModelChange",function(s){return i.inputTripRequestResponseXmlS=s}),pe(),le(20,"div",6)(21,"button",7),nn("click",function(){return i.parseCustomResponseXML()}),Ye(22," Display Trips "),pe()()()(),le(23,"div",9)(24,"button",10),Ye(25," Close "),pe()()),2&e&&(Fe(10),rt("ngModel",i.inputTripRequestXmlS),Fe(2),rt("disabled",i.isRunningTripRequest),Fe(1),rt("ngIf",i.isRunningTripRequest),Fe(6),rt("ngModel",i.inputTripRequestResponseXmlS),Fe(2),rt("disabled",i.isRunningTripRequest))},dependencies:[js,ld,gh,Ap,Zb,kv,Rv,Pv],encapsulation:2}),n})();const x9=["input"],w9=["*"],S9=new Dt("sbb-checkbox-default-options",{providedIn:"root",factory:function yF(){return{clickAction:"check-indeterminate"}}});const C9={provide:ra,useExisting:$i(()=>T9),multi:!0};let T9=(()=>{class n extends hE{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Yi(n)))(i||n)}}(),n.\u0275dir=Ft({type:n,selectors:[["sbb-checkbox","required","","formControlName",""],["sbb-checkbox","required","","formControl",""],["sbb-checkbox","required","","ngModel",""]],features:[ni([C9]),Yt]}),n})(),E9=0;const D9={clickAction:"check-indeterminate"},I9={provide:nl,useExisting:$i(()=>xF),multi:!0};class M9{}const A9=$b(rl(class{}));let vF=(()=>{class n extends A9{constructor(e,i,r,s,d){super(),this._elementRef=e,this._changeDetectorRef=i,this._focusMonitor=r,this._options=d,this.ariaLabel="",this.ariaLabelledby=null,this._uniqueId="sbb-checkbox-"+ ++E9,this.id=this._uniqueId,this.labelPosition="after",this.name=null,this.change=new on,this.indeterminateChange=new on,this._onTouched=()=>{},this._controlValueAccessorChangeFn=()=>{},this._checked=!1,this._disabled=!1,this._indeterminate=!1,this._options=this._options||D9,this.tabIndex=parseInt(s,10)||0}get inputId(){return`${this.id||this._uniqueId}-input`}get required(){return this._required}set required(e){this._required=ii(e)}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(e=>{e||Promise.resolve().then(()=>{this._onTouched(),this._changeDetectorRef.markForCheck()})}),this._syncIndeterminate(this._indeterminate)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}get checked(){return this._checked}set checked(e){const i=ii(e);i!==this.checked&&(this._checked=i,this._changeDetectorRef.markForCheck())}get disabled(){return this._disabled}set disabled(e){const i=ii(e);i!==this.disabled&&(this._disabled=i,this._changeDetectorRef.markForCheck())}get indeterminate(){return this._indeterminate}set indeterminate(e){const i=e!==this._indeterminate;this._indeterminate=ii(e),i&&this.indeterminateChange.emit(this._indeterminate),this._syncIndeterminate(this._indeterminate)}_onLabelTextChange(){this._changeDetectorRef.detectChanges()}writeValue(e){this.checked=!!e}registerOnChange(e){this._controlValueAccessorChangeFn=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this.disabled=e}_getAriaChecked(){return this.checked?"true":this.indeterminate?"mixed":"false"}_emitChangeEvent(){const e=new M9;e.source=this,e.checked=this.checked,this._controlValueAccessorChangeFn(this.checked),this.change.emit(e)}toggle(){this.checked=!this.checked,this._controlValueAccessorChangeFn(this.checked)}_onInputClick(e){var i;const r=null===(i=this._options)||void 0===i?void 0:i.clickAction;e.stopPropagation(),this.disabled||"noop"===r?!this.disabled&&"noop"===r&&(this._inputElement.nativeElement.checked=this.checked,this._inputElement.nativeElement.indeterminate=this.indeterminate):(this.indeterminate&&"check"!==r&&Promise.resolve().then(()=>{this._indeterminate=!1,this.indeterminateChange.emit(this._indeterminate)}),this._checked=!this._checked,this._emitChangeEvent())}focus(e,i){e?this._focusMonitor.focusVia(this._inputElement,e,i):this._inputElement.nativeElement.focus(i)}_onInteractionEvent(e){e.stopPropagation()}_syncIndeterminate(e){const i=this._inputElement;i&&(i.nativeElement.indeterminate=e)}}return n.\u0275fac=function(e){return new(e||n)(X(zn),X(kr),X(Pa),os("tabindex"),X(S9,8))},n.\u0275dir=Ft({type:n,viewQuery:function(e,i){if(1&e&&yr(x9,5),2&e){let r;Jn(r=ei())&&(i._inputElement=r.first)}},inputs:{ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],ariaDescribedby:["aria-describedby","ariaDescribedby"],id:"id",required:"required",labelPosition:"labelPosition",name:"name",value:"value",checked:"checked",disabled:"disabled",indeterminate:"indeterminate"},outputs:{change:"change",indeterminateChange:"indeterminateChange"},features:[Yt]}),n})(),xF=(()=>{class n extends vF{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Yi(n)))(i||n)}}(),n.\u0275cmp=On({type:n,selectors:[["sbb-checkbox"]],hostAttrs:[1,"sbb-checkbox","sbb-selection-item"],hostVars:10,hostBindings:function(e,i){2&e&&(Mc("id",i.id),Sn("tabindex",null)("aria-label",null)("aria-labelledby",null),Ui("sbb-selection-indeterminate",i.indeterminate)("sbb-selection-checked",i.checked)("sbb-selection-disabled",i.disabled))},inputs:{tabIndex:"tabIndex"},exportAs:["sbbCheckbox"],features:[ni([I9]),Yt],ngContentSelectors:w9,decls:11,vars:12,consts:[[1,"sbb-selection-item-label"],["type","checkbox",1,"cdk-visually-hidden","sbb-selection-input","sbb-checkbox-input","sbb-transparent-parent-overlay",3,"id","required","checked","disabled","tabIndex","change","click"],["input",""],[1,"sbb-selection-container"],[1,"sbb-selection-container-checked"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","focusable","false"],["fill","none","fill-rule","evenodd","stroke","#000","stroke-width","1","points","6 12 10 16 19 7.01"],[1,"sbb-selection-content",3,"cdkObserveContent"],[2,"display","none"]],template:function(e,i){1&e&&($o(),le(0,"label",0)(1,"input",1,2),nn("change",function(s){return i._onInteractionEvent(s)})("click",function(s){return i._onInputClick(s)}),pe(),le(3,"div",3)(4,"span",4),B(),le(5,"svg",5),bn(6,"polyline",6),pe()()(),Q(),le(7,"div",7),nn("cdkObserveContent",function(){return i._onLabelTextChange()}),le(8,"span",8),Ye(9,"\xa0"),pe(),$r(10),pe()()),2&e&&(Sn("for",i.inputId),Fe(1),rt("id",i.inputId)("required",i.required)("checked",i.checked)("disabled",i.disabled)("tabIndex",i.tabIndex),Sn("value",i.value)("name",i.name)("aria-label",i.ariaLabel||null)("aria-labelledby",i.ariaLabelledby)("aria-checked",i._getAriaChecked())("aria-describedby",i.ariaDescribedby))},dependencies:[jL],encapsulation:2,changeDetection:0}),n})(),wF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({imports:[Xw,nr]}),n})(),k9=(()=>{class n{constructor(e){var i,r;this.userTripService=e,this.embedHTMLs="n/a",this.fromLocationText="",this.toLocationText="",this.fromLocationChecked=!1,this.toLocationChecked=!0,this.fromLocationText=n.computeLocationText(null===(i=e.fromTripLocation)||void 0===i?void 0:i.location),this.toLocationText=n.computeLocationText(null===(r=e.toTripLocation)||void 0===r?void 0:r.location),this.updateEmbedHTML()}static computeLocationText(e){var i,r,s,d,m;if(!e)return"";const y=e.getLocationType();if("stop"===y)return e.computeLocationName()+"(stopRef "+(null!==(r=null===(i=e.stopPlace)||void 0===i?void 0:i.stopPlaceRef)&&void 0!==r?r:"")+")";const T=e.geoPosition;return T?(null!==(s=e.computeLocationName())&&void 0!==s?s:"")+"(coords "+(null!==(d=T.asLatLngString(!0))&&void 0!==d?d:"")+")":y+" - "+(null!==(m=e.computeLocationName())&&void 0!==m?m:"")}updateEmbedHTML(){const e=new URLSearchParams;["from","to"].forEach(s=>{const d=(()=>{if("from"===s?this.fromLocationChecked:this.toLocationChecked){const y=this.userTripService.embedQueryParams.get(s);if(null!==y)return y}return""})();e.append(s,d)});const i=document.location.pathname.replace("/search","/embed/search")+"?"+e.toString(),r=document.location.protocol+"//"+document.location.host+i;this.embedHTMLs='<iframe src="'+r+'" width="100%" height="100%" frameBorder="0"></iframe>'}}return n.\u0275fac=function(e){return new(e||n)(X(Nc))},n.\u0275cmp=On({type:n,selectors:[["embed-search-popover"]],decls:20,vars:5,consts:[["sbbDialogTitle",""],["sbbDialogContent",""],[2,"width","500px"],[3,"ngModel","ngModelChange","change"],["rows","7",1,"w-100"],["sbbDialogActions",""],["type","button","sbbDialogClose","",1,"btn","btn-secondary"]],template:function(e,i){1&e&&(le(0,"div",0),Ye(1,"Embed journey in another website"),pe(),le(2,"div",1)(3,"div",2)(4,"p"),Ye(5,"Select which journey endpoints should be prefilled:"),pe(),le(6,"div")(7,"div")(8,"sbb-checkbox",3),nn("ngModelChange",function(s){return i.fromLocationChecked=s})("change",function(){return i.updateEmbedHTML()}),Ye(9),pe()(),le(10,"div")(11,"sbb-checkbox",3),nn("ngModelChange",function(s){return i.toLocationChecked=s})("change",function(){return i.updateEmbedHTML()}),Ye(12),pe()()(),le(13,"p"),Ye(14,"Copy the following code in the target webpage"),pe(),le(15,"textarea",4),Ye(16),pe()()(),le(17,"div",5)(18,"button",6),Ye(19," Close "),pe()()),2&e&&(Fe(8),rt("ngModel",i.fromLocationChecked),Fe(1),Vr("(From) ",i.fromLocationText,""),Fe(2),rt("ngModel",i.toLocationChecked),Fe(1),Vr("(To) ",i.toLocationText,""),Fe(4),Pi(i.embedHTMLs))},dependencies:[gh,Ap,xF,Zb,kv,Rv,Pv],encapsulation:2}),n})();function R9(n,t){}const SF=new Dt("SbbNotificationToastData");class vS{constructor(){this.politeness="assertive",this.duration=0,this.data=null,this.verticalPosition="bottom",this.type="success"}}const P9={notificationState:Us("state",[vr("void, hidden",Yn({transform:"scale(0.8)",opacity:0})),vr("visible",Yn({transform:"scale(1)",opacity:1})),tr("* => visible",ar("150ms cubic-bezier(0, 0, 0.2, 1)")),tr("* => void, * => hidden",ar("75ms cubic-bezier(0.4, 0.0, 1, 1)",Yn({opacity:0})))])};let O9=(()=>{class n extends Cv{constructor(e,i,r,s){super(),this._ngZone=e,this._elementRef=i,this._changeDetectorRef=r,this.config=s,this._destroyed=!1,this._onExit=new Wt,this._onEnter=new Wt,this._animationState="void",this.attachDomPortal=d=>{this._assertNotAttached();const m=this._portalOutlet.attachDomPortal(d);return this._afterPortalAttached(),m},this._role="assertive"!==s.politeness||s.announcementMessage?"off"===s.politeness?null:"status":"alert"}get _svgIcon(){switch(this.config.type){case"success":return"kom:tick-small";case"error":case"warn":return"kom:sign-exclamation-point-small";default:return"kom:circle-information-small"}}attachComponentPortal(e){this._assertNotAttached();const i=this._portalOutlet.attachComponentPortal(e);return this._afterPortalAttached(),i}attachTemplatePortal(e){this._assertNotAttached();const i=this._portalOutlet.attachTemplatePortal(e);return this._afterPortalAttached(),i}onAnimationEnd(e){const{fromState:i,toState:r}=e;if(("void"===r&&"void"!==i||"hidden"===r)&&this._completeExit(),"visible"===r){const s=this._onEnter;this._ngZone.run(()=>{s.next(),s.complete()})}}enter(){this._destroyed||(this._animationState="visible",this._changeDetectorRef.detectChanges())}exit(){return this._animationState="hidden",this._elementRef.nativeElement.setAttribute("sbb-exit",""),this._onExit}ngOnDestroy(){this._destroyed=!0,this._completeExit()}_completeExit(){this._ngZone.onMicrotaskEmpty.pipe(Qr(1)).subscribe(()=>{this._onExit.next(),this._onExit.complete()})}_afterPortalAttached(){const e=this._elementRef.nativeElement,i=this.config.panelClass;i&&(Array.isArray(i)?i.forEach(r=>e.classList.add(r)):e.classList.add(i)),e.classList.add("sbb-notification-toast-center")}_assertNotAttached(){if(this._portalOutlet.hasAttached())throw Error("Attempting to attach notification content after content is already attached")}}return n.\u0275fac=function(e){return new(e||n)(X(di),X(zn),X(kr),X(vS))},n.\u0275dir=Ft({type:n,viewQuery:function(e,i){if(1&e&&yr(dd,7),2&e){let r;Jn(r=ei())&&(i._portalOutlet=r.first)}},features:[Yt]}),n})(),L9=(()=>{class n extends O9{_afterPortalAttached(){super._afterPortalAttached(),"top"===this.config.verticalPosition&&this._elementRef.nativeElement.classList.add("sbb-notification-toast-top")}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Yi(n)))(i||n)}}(),n.\u0275cmp=On({type:n,selectors:[["sbb-notification-toast-container"]],hostAttrs:[1,"sbb-notification-toast"],hostVars:10,hostBindings:function(e,i){1&e&&My("@state.done",function(s){return i.onAnimationEnd(s)}),2&e&&(Sn("role",i._role),ky("@state",i._animationState),Ui("sbb-notification-toast-success","success"===i.config.type)("sbb-notification-toast-info","info"===i.config.type)("sbb-notification-toast-warn","warn"===i.config.type)("sbb-notification-toast-error","error"===i.config.type))},features:[Yt],decls:6,vars:1,consts:[[1,"sbb-notification-toast-icon-wrapper","sbb-icon-fit"],[3,"svgIcon"],[1,"sbb-notification-toast-content"],["cdkPortalOutlet",""],["type","button",1,"sbb-notification-toast-icon-wrapper","sbb-notification-toast-icon-close-wrapper","sbb-icon-fit",3,"click"],["svgIcon","kom:cross-small"]],template:function(e,i){1&e&&(le(0,"span",0),bn(1,"sbb-icon",1),pe(),le(2,"div",2),Jt(3,R9,0,0,"ng-template",3),pe(),le(4,"button",4),nn("click",function(){return i.exit()}),bn(5,"sbb-icon",5),pe()),2&e&&(Fe(1),rt("svgIcon",i._svgIcon))},dependencies:[dd,ol],styles:[".sbb-notification-toast{display:flex;min-height:calc(3.2rem * var(--sbb-scaling-factor));border-radius:var(--sbb-border-radius);color:var(--sbb-color-white);background-color:var(--sbb-color-background);font-size:var(--sbb-font-size);line-height:var(--sbb-line-height);padding-top:calc(0.8rem * var(--sbb-scaling-factor) - var(--sbb-border-width-thin));padding-bottom:calc(\n    0.8rem * var(--sbb-scaling-factor) - var(--sbb-border-width-thin) - var(\n        --sbb-line-height\n      ) + var(--sbb-icon-size-default)\n  );margin:calc(1.3333333333rem * var(--sbb-scaling-factor))}:where(html.sbb-lean) .sbb-notification-toast{padding-bottom:calc(\n      0.8rem * var(--sbb-scaling-factor) - var(--sbb-border-width-thin)\n    )}.sbb-notification-toast-mobile .sbb-notification-toast{margin:calc(0.5333333333rem * var(--sbb-scaling-factor));max-width:100%;min-width:0;width:100%}.sbb-notification-toast-mobile{width:100%}.sbb-notification-toast-error{background-color:var(--sbb-color-error)}:is(.sbb-notification-toast-error,.sbb-notification-toast-error :is(a,button)){color:var(--sbb-color-white)}.sbb-notification-toast-success{border:var(--sbb-border-width-thin) solid var(--sbb-color-green)}:is(.sbb-notification-toast-success,.sbb-notification-toast-success :is(a,button)){color:var(--sbb-color-green)}.sbb-notification-toast-info{border:var(--sbb-border-width-thin) solid var(--sbb-color-granite)}:is(.sbb-notification-toast-info,.sbb-notification-toast-info :is(a,button)){color:var(--sbb-color-granite)}.sbb-notification-toast-warn{background-color:var(--sbb-color-orange)}:is(.sbb-notification-toast-warn,.sbb-notification-toast-warn :is(a,button)){color:var(--sbb-color-white)}.sbb-notification-toast-content{margin-left:calc(0.5333333333rem * var(--sbb-scaling-factor));margin-right:calc(1.6rem * var(--sbb-scaling-factor))}.sbb-notification-toast-icon-wrapper{min-width:var(--sbb-icon-size-default);width:var(--sbb-icon-size-default);height:var(--sbb-icon-size-default);margin-left:calc(1.0666666667rem * var(--sbb-scaling-factor));border:none;background:none;padding:0;align-self:flex-start}.sbb-notification-toast-icon-close-wrapper{cursor:pointer;margin-left:auto;margin-right:calc(1.4666666667rem * var(--sbb-scaling-factor))}"],encapsulation:2,data:{animation:[P9.notificationState]}}),n})();const F9=Math.pow(2,31)-1;class HD{constructor(t,e){this._overlayRef=e,this._afterDismissed=new Wt,this._afterOpened=new Wt,this.containerInstance=t,t._onExit.subscribe(()=>this._finishDismiss())}dismiss(){this._afterDismissed.closed||this.containerInstance.exit(),clearTimeout(this._durationTimeoutId)}_dismissAfter(t){this._durationTimeoutId=setTimeout(()=>this.dismiss(),Math.min(t,F9))}_open(){this._afterOpened.closed||(this._afterOpened.next(),this._afterOpened.complete())}_finishDismiss(){this._overlayRef.dispose(),this._afterDismissed.next(null),this._afterDismissed.complete()}afterDismissed(){return this._afterDismissed.asObservable()}afterOpened(){return this.containerInstance._onEnter}}let N9=(()=>{class n{constructor(e,i){this.notificationToastRef=e,this.data=i}dismiss(){this.notificationToastRef.dismiss()}}return n.\u0275fac=function(e){return new(e||n)(X(HD),X(SF))},n.\u0275cmp=On({type:n,selectors:[["sbb-simple-notification"]],decls:2,vars:1,template:function(e,i){1&e&&(le(0,"span"),Ye(1),pe()),2&e&&(Fe(1),Pi(i.data.message))},encapsulation:2,changeDetection:0}),n})(),$D=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({imports:[Tr,wa,Ml,nr,Ao]}),n})();const B9=new Dt("notification-default-options",{providedIn:"root",factory:function z9(){return new vS}});let CF=(()=>{class n{constructor(e,i,r,s,d,m){this._overlay=e,this._injector=i,this._live=r,this._breakpointObserver=s,this._parentNotification=d,this._defaultConfig=m,this._notificationRefAtThisLevel=null,this._simpleNotificationToastComponent=N9,this._notificationToastContainerComponent=L9,this._mobileDeviceCssClass="sbb-notification-toast-mobile"}get _openedNotificationRef(){const e=this._parentNotification;return e?e._openedNotificationRef:this._notificationRefAtThisLevel}set _openedNotificationRef(e){this._parentNotification?this._parentNotification._openedNotificationRef=e:this._notificationRefAtThisLevel=e}openFromComponent(e,i){return this._attach(e,i)}openFromTemplate(e,i){return this._attach(e,i)}open(e,i){const r=Object.assign(Object.assign({},this._defaultConfig),i);return r.data={message:e},r.announcementMessage===e&&(r.announcementMessage=void 0),this.openFromComponent(this._simpleNotificationToastComponent,r)}dismiss(){this._openedNotificationRef&&this._openedNotificationRef.dismiss()}ngOnDestroy(){this._notificationRefAtThisLevel&&this._notificationRefAtThisLevel.dismiss()}_attachNotificationToastContainer(e,i){var r;const s=null===(r=null==i?void 0:i.viewContainerRef)||void 0===r?void 0:r.injector,d=new s2(s||this._injector,new WeakMap([[vS,i]])),m=new ud(this._notificationToastContainerComponent,i.viewContainerRef,d),y=e.attach(m);return y.instance.config=i,y.instance}_attach(e,i){const r=Object.assign(Object.assign(Object.assign({},new vS),this._defaultConfig),i),s=this._createOverlay(r),d=this._attachNotificationToastContainer(s,r),m=new HD(d,s);if(e instanceof ho){const y=new Tm(e,null,{$implicit:r.data,notificationRef:m});m.instance=d.attachTemplatePortal(y)}else{const y=this._createInjector(r,m),T=new ud(e,void 0,y),M=d.attachComponentPortal(T);m.instance=M.instance}return this._breakpointObserver.observe("(max-width: 642.99px) and (orientation: portrait)").pipe(Hi(s.detachments())).subscribe(y=>{const T=s.overlayElement.classList;y.matches?T.add(this._mobileDeviceCssClass):T.remove(this._mobileDeviceCssClass)}),this._animateNotification(m,r),this._openedNotificationRef=m,this._openedNotificationRef}_animateNotification(e,i){e.afterDismissed().subscribe(()=>{this._openedNotificationRef===e&&(this._openedNotificationRef=null),i.announcementMessage&&this._live.clear()}),this._openedNotificationRef?(this._openedNotificationRef.afterDismissed().subscribe(()=>{e.containerInstance.enter()}),this._openedNotificationRef.dismiss()):e.containerInstance.enter(),i.duration&&i.duration>0&&e.afterOpened().subscribe(()=>e._dismissAfter(i.duration)),i.announcementMessage&&this._live.announce(i.announcementMessage,i.politeness)}_createOverlay(e){const i=new km,r=this._overlay.position().global();return r.centerHorizontally(),"top"===e.verticalPosition?r.top("0"):r.bottom("0"),i.positionStrategy=r,this._overlay.create(i)}_createInjector(e,i){var r;const s=null===(r=null==e?void 0:e.viewContainerRef)||void 0===r?void 0:r.injector;return new s2(s||this._injector,new WeakMap([[HD,i],[SF,e.data]]))}}return n.\u0275fac=function(e){return new(e||n)(Ue(es),Ue(Xr),Ue(t2),Ue(eD),Ue(n,12),Ue(B9))},n.\u0275prov=tn({token:n,factory:n.\u0275fac,providedIn:$D}),n})();const V9=["sbb-button",""];function j9(n,t){1&n&&bn(0,"sbb-icon",2),2&n&&rt("svgIcon",rn().svgIcon)}function U9(n,t){1&n&&bn(0,"sbb-icon",3),2&n&&rt("svgIcon",rn().svgIcon)}const H9=["*"],$9=["sbb-button","sbb-alt-button","sbb-secondary-button","sbb-ghost-button","sbb-frameless-button","sbb-link"],q9=["sbb-button","sbb-secondary-button","sbb-frameless-button","sbb-link"],G9=["sbb-button","sbb-alt-button","sbb-secondary-button","sbb-ghost-button"],TF={"sbb-button":"kom:arrow-right-small","sbb-secondary-button":"kom:arrow-right-small","sbb-frameless-button":"kom:plus-small","sbb-link":"kom:arrow-right-small"},W9=rl(Dm(class{constructor(n){this._elementRef=n}}));let EF=(()=>{class n extends W9{constructor(e,i,r,s){super(e),this._focusMonitor=i,this._animationMode=r,this._contentObserver=s,this._hasIconIndicator=this._hasHostAttributes(...q9),this._hasIconButtonClass=!1,this._iconRefs=new im;for(const d of $9)this._hasHostAttributes(d)&&(this._getHostElement().classList.add(d),d in TF&&(this.svgIcon=TF[d]));e.nativeElement.classList.add("sbb-button-base")}ngAfterContentInit(){var e,i;const r=null!==(i=null===(e=this._contentObserver)||void 0===e?void 0:e.observe(this._elementRef))&&void 0!==i?i:this._iconRefs.changes;this._isIconButton=null==r?void 0:r.pipe(Hs([]),$t(()=>this._hasHostAttributes(...G9)&&""===this._elementRef.nativeElement.textContent.trim()&&1===this._iconRefs.length)),this._isIconButton.subscribe(s=>this._hasIconButtonClass=s),this._leftIconVisible=hm([this.variant,this._isIconButton]).pipe($t(([s,d])=>!d&&"standard"===s&&this._hasIconIndicator)),this._rightIconVisible=hm([this.variant,this._isIconButton]).pipe($t(([s,d])=>!d&&("standard"===s&&this._hasIconIndicator||"lean"===s&&this._hasHostAttributes("sbb-link"))))}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}focus(e,i){e?this._focusMonitor.focusVia(this._getHostElement(),e,i):this._getHostElement().focus(i)}_getHostElement(){return this._elementRef.nativeElement}_hasHostAttributes(...e){return e.some(i=>this._getHostElement().hasAttribute(i))}}return n.\u0275fac=function(e){return new(e||n)(X(zn),X(Pa),X(id,8),X(VL,8))},n.\u0275cmp=On({type:n,selectors:[["button","sbb-button",""],["button","sbb-alt-button",""],["button","sbb-secondary-button",""],["button","sbb-ghost-button",""],["button","sbb-frameless-button",""],["button","sbb-link",""]],contentQueries:function(e,i,r){if(1&e&&Kr(r,ol,4,zn),2&e){let s;Jn(s=ei())&&(i._iconRefs=s)}},hostVars:7,hostBindings:function(e,i){2&e&&(Sn("disabled",i.disabled||null),Ui("_sbb-animation-noopable","NoopAnimations"===i._animationMode)("sbb-disabled",i.disabled)("sbb-icon-button",i._hasIconButtonClass))},inputs:{disabled:"disabled",svgIcon:"svgIcon"},exportAs:["sbbButton"],features:[Yt],attrs:V9,ngContentSelectors:H9,decls:5,vars:6,consts:[["class","sbb-button-indicator-icon sbb-button-left-icon",3,"svgIcon",4,"ngIf"],["class","sbb-button-indicator-icon sbb-button-right-icon",3,"svgIcon",4,"ngIf"],[1,"sbb-button-indicator-icon","sbb-button-left-icon",3,"svgIcon"],[1,"sbb-button-indicator-icon","sbb-button-right-icon",3,"svgIcon"]],template:function(e,i){1&e&&($o(),Jt(0,j9,1,1,"sbb-icon",0),yb(1,"async"),$r(2),Jt(3,U9,1,1,"sbb-icon",1),yb(4,"async")),2&e&&(rt("ngIf",vb(1,2,i._leftIconVisible)&&i.svgIcon),Fe(3),rt("ngIf",vb(4,4,i._rightIconVisible)&&i.svgIcon))},dependencies:[js,ol,$y],encapsulation:2,changeDetection:0}),n})(),qD=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({imports:[Tr,nr,Ao]}),n})();const Z9=["connectionContainer"];function Y9(n,t){if(1&n&&(Yl(0),le(1,"span"),Ye(2),pe(),Kl()),2&n){const e=rn();Fe(2),Pi(e.label)}}function K9(n,t){1&n&&$r(0,1,["*ngSwitchCase","true"])}function Q9(n,t){1&n&&$r(0,2,["*ngIf","_hasErrors()"])}const J9=["*",[["sbb-label"]],[["sbb-error"],["","sbbError",""]]],eX=["*","sbb-label","sbb-error,[sbbError]"];let tX=0;const DF=new Dt("SbbError");let nX=(()=>{class n{constructor(e,i){this.id="sbb-error-"+tX++,e||i.nativeElement.setAttribute("aria-live","polite")}}return n.\u0275fac=function(e){return new(e||n)(os("aria-live"),X(zn))},n.\u0275dir=Ft({type:n,selectors:[["sbb-error"],["","sbbError",""]],hostAttrs:["aria-atomic","true",1,"sbb-error"],hostVars:1,hostBindings:function(e,i){2&e&&Sn("id",i.id)},inputs:{id:"id"},features:[ni([{provide:DF,useExisting:n}])]}),n})();class Fv{}let GD=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=Ft({type:n,selectors:[["sbb-label"]],hostAttrs:[1,"sbb-label"]}),n})(),iX=0;const xS=new Dt("SBB_FORM_FIELD");let Nv=(()=>{class n{constructor(e,i){this._elementRef=e,this._changeDetectorRef=i,this._destroyed=new Wt,this._labelId="sbb-form-field-label-"+iX++}get _control(){return this._explicitFormFieldControl||this._controlNonStatic||this._controlStatic}set _control(e){this._explicitFormFieldControl=e}getLabelId(){return this._hasLabel()||this.label?this._labelId:null}ngAfterContentInit(){this._validateControlChild();const e=this._control;e.controlType&&this._elementRef.nativeElement.classList.add(`sbb-form-field-type-${e.controlType}`),e.stateChanges.pipe(Hs(null)).subscribe(()=>{this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()}),e.ngControl&&e.ngControl.valueChanges&&e.ngControl.valueChanges.pipe(Hi(this._destroyed)).subscribe(()=>this._changeDetectorRef.markForCheck()),this._errorChildren.changes.pipe(Hs(null)).subscribe(()=>{this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()})}ngAfterContentChecked(){this._validateControlChild()}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}_shouldForward(e){const i=this._control?this._control.ngControl:null;return i&&i[e]}_hasLabel(){return!(!this._labelChildNonStatic&&!this._labelChildStatic)}_hasErrors(){return!!(this._errorChildren&&this._errorChildren.length&&this._control.errorState)}_syncDescribedByIds(){if(this._control){const e=[];this._control.userAriaDescribedBy&&"string"==typeof this._control.userAriaDescribedBy&&e.push(...this._control.userAriaDescribedBy.split(" ")),this._errorChildren&&e.push(...this._errorChildren.map(i=>i.id)),this._control.setDescribedByIds(e)}}_validateControlChild(){}getConnectedOverlayOrigin(){return this._connectionContainerRef||this._elementRef}}return n.\u0275fac=function(e){return new(e||n)(X(zn),X(kr))},n.\u0275cmp=On({type:n,selectors:[["sbb-form-field"]],contentQueries:function(e,i,r){if(1&e&&(Kr(r,Fv,5),Kr(r,Fv,7),Kr(r,GD,5),Kr(r,GD,7),Kr(r,DF,5)),2&e){let s;Jn(s=ei())&&(i._controlNonStatic=s.first),Jn(s=ei())&&(i._controlStatic=s.first),Jn(s=ei())&&(i._labelChildNonStatic=s.first),Jn(s=ei())&&(i._labelChildStatic=s.first),Jn(s=ei())&&(i._errorChildren=s)}},viewQuery:function(e,i){if(1&e&&yr(Z9,7),2&e){let r;Jn(r=ei())&&(i._connectionContainerRef=r.first)}},hostAttrs:[1,"sbb-form-field"],hostVars:20,hostBindings:function(e,i){2&e&&Ui("sbb-form-field-invalid",null==i._control?null:i._control.errorState)("sbb-form-field-disabled",null==i._control?null:i._control.disabled)("sbb-focused",null==i._control?null:i._control.focused)("ng-untouched",i._shouldForward("untouched"))("ng-touched",i._shouldForward("touched"))("ng-pristine",i._shouldForward("pristine"))("ng-dirty",i._shouldForward("dirty"))("ng-valid",i._shouldForward("valid"))("ng-invalid",i._shouldForward("invalid"))("ng-pending",i._shouldForward("pending"))},inputs:{label:"label"},exportAs:["sbbFormField"],features:[ni([{provide:xS,useExisting:n}])],ngContentSelectors:eX,decls:10,vars:9,consts:[[1,"sbb-form-field-wrapper"],[1,"sbb-form-field-label-wrapper",3,"click"],[1,"sbb-label","sbb-form-field-label",3,"id","ngSwitch"],[4,"ngSwitchCase"],[1,"sbb-form-field-input-wrapper"],["connectionContainer",""],[1,"sbb-form-field-error-wrapper"],[4,"ngIf"]],template:function(e,i){1&e&&($o(J9),le(0,"div",0)(1,"div",1),nn("click",function(s){return i._control.onContainerClick&&i._control.onContainerClick(s)}),le(2,"label",2),Jt(3,Y9,3,1,"ng-container",3),Jt(4,K9,1,0,"ng-content",3),pe()(),le(5,"div",4,5),$r(7),pe(),le(8,"div",6),Jt(9,Q9,1,0,"ng-content",7),pe()()),2&e&&(Fe(2),Ui("sbb-form-field-empty",i._control.empty),rt("id",i._labelId)("ngSwitch",i._hasLabel()),Sn("for",i._control.id)("aria-owns",i._control.id),Fe(1),rt("ngSwitchCase",!1),Fe(1),rt("ngSwitchCase",!0),Fe(5),rt("ngIf",i._hasErrors()))},dependencies:[js,Eb,Nx],styles:[".sbb-form-field{display:inline-block;position:relative;width:var(--sbb-form-field-width)}.sbb-form-field-short{width:33.333%}@media all and (min-width: 26.3125em){.sbb-form-field-short{width:25%}}@media all and (min-width: 64.0625em){.sbb-form-field-short{width:16.66666%}}.sbb-form-field-medium{width:100%}@media all and (min-width: 40.1875em){.sbb-form-field-medium{width:50%}}.sbb-form-field-long{width:100%}.sbb-form-field-wrapper{padding-bottom:calc(1.5333333333rem * var(--sbb-scaling-factor))}:where(html.sbb-lean) .sbb-form-field-wrapper{padding-bottom:1.0666666667rem}.sbb-form-field-flexible-errors .sbb-form-field-wrapper{padding-bottom:0}.sbb-form-field-label-wrapper{margin-bottom:var(--sbb-form-label-wrapper-margin-bottom);padding-left:var(--sbb-form-label-wrapper-padding-left)}.sbb-form-field .sbb-input-element{width:100%;max-width:100%}.sbb-form-field textarea.sbb-input-element{resize:vertical;overflow:auto}.sbb-form-field textarea.sbb-input-element.cdk-textarea-autosize{resize:none}.sbb-form-field-error-wrapper{position:absolute;box-sizing:border-box;width:100%;overflow:hidden}.sbb-form-field-flexible-errors .sbb-form-field-error-wrapper{position:relative}:is(.sbb-form-field-error-wrapper,.sbb-form-field-label-wrapper) :is(.sbb-icon,.sbb-tooltip-icon),:is(.sbb-form-field-error-wrapper,.sbb-form-field-label-wrapper) .sbb-icon svg{vertical-align:bottom;width:calc(1.0666666667rem * var(--sbb-scaling-factor));height:calc(1.0666666667rem * var(--sbb-scaling-factor))}:is(.sbb-form-field-error-wrapper,.sbb-form-field-label-wrapper) .sbb-tooltip-icon:not(:hover):not(:focus){color:inherit}:is(.sbb-form-field-error-wrapper,.sbb-form-field-label-wrapper) .sbb-tooltip-trigger{margin-left:calc(0.5333333333rem * var(--sbb-scaling-factor))}.sbb-form-group,.sbb-form-group-center,.sbb-form-group-wrap,.sbb-form-group-vertical{display:flex;gap:var(--sbb-divider-thin)}:is(.sbb-form-group,.sbb-form-group-center,.sbb-form-group-wrap){align-items:flex-start}.sbb-form-group-wrap{flex-wrap:wrap}.sbb-form-group-center{justify-content:center}:is(.sbb-form-group,.sbb-form-group-center,.sbb-form-group-wrap):where(:not(.sbb-form-group-vertical)) :is(.sbb-button,.sbb-alt-button,.sbb-secondary-button,.sbb-ghost-button,.sbb-icon-button){margin-top:calc(var(--sbb-form-label-line-height) + var(--sbb-form-label-wrapper-margin-bottom))}.sbb-form-group-vertical{flex-direction:column}.sbb-form-group-vertical.sbb-form-group-center{justify-content:inherit;align-items:center}.sbb-form-group-vertical>:is(.sbb-button,.sbb-alt-button,.sbb-secondary-button,.sbb-ghost-button,.sbb-icon-button){width:var(--sbb-form-field-width)}:where(html:not(.sbb-lean)) .sbb-form-group-vertical>:is(.sbb-button,.sbb-alt-button,.sbb-secondary-button,.sbb-ghost-button,.sbb-icon-button) .sbb-button-right-icon{right:unset !important}"],encapsulation:2,changeDetection:0}),n})(),wS=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({imports:[Tr,nr]}),n})();const IF=Pp({passive:!0});let rX=(()=>{class n{constructor(e,i){this._platform=e,this._ngZone=i,this._monitoredElements=new Map}monitor(e){if(!this._platform.isBrowser)return so;const i=wm(e),r=this._monitoredElements.get(i);if(r)return r.subject;const s=new Wt,d="cdk-text-field-autofilled",m=y=>{"cdk-text-field-autofill-start"!==y.animationName||i.classList.contains(d)?"cdk-text-field-autofill-end"===y.animationName&&i.classList.contains(d)&&(i.classList.remove(d),this._ngZone.run(()=>s.next({target:y.target,isAutofilled:!1}))):(i.classList.add(d),this._ngZone.run(()=>s.next({target:y.target,isAutofilled:!0})))};return this._ngZone.runOutsideAngular(()=>{i.addEventListener("animationstart",m,IF),i.classList.add("cdk-text-field-autofill-monitored")}),this._monitoredElements.set(i,{subject:s,unlisten:()=>{i.removeEventListener("animationstart",m,IF)}}),s}stopMonitoring(e){const i=wm(e),r=this._monitoredElements.get(i);r&&(r.unlisten(),r.subject.complete(),i.classList.remove("cdk-text-field-autofill-monitored"),i.classList.remove("cdk-text-field-autofilled"),this._monitoredElements.delete(i))}ngOnDestroy(){this._monitoredElements.forEach((e,i)=>this.stopMonitoring(i))}}return n.\u0275fac=function(e){return new(e||n)(Ue(Is),Ue(di))},n.\u0275prov=tn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),WD=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({}),n})();const MF=new Dt("SBB_INPUT_VALUE_ACCESSOR");let oX=0;const sX=["button","checkbox","file","hidden","image","radio","range","reset","submit"],aX=tS(class{constructor(n,t,e,i){this._defaultErrorStateMatcher=n,this._parentForm=t,this._parentFormGroup=e,this.ngControl=i,this.stateChanges=new Wt}});let Yb=(()=>{class n extends aX{constructor(e,i,r,s,d,m,y,T,M){super(m,s,d,r),this._elementRef=e,this._platform=i,this.ngControl=r,this._autofillMonitor=T,this.focused=!1,this.controlType="sbb-input",this.autofilled=!1,this._disabled=!1,this.id="sbb-native-input-"+oX++,this._required=!1,this._type="text",this._readonly=!1,this._neverEmptyInputTypes=["date","datetime","datetime-local","month","time","week"].filter(Z=>PL().has(Z)),this._iOSKeyupListener=Z=>{const te=Z.target;!te.value&&0===te.selectionStart&&0===te.selectionEnd&&(te.setSelectionRange(1,1),te.setSelectionRange(0,0))};const R=this._elementRef.nativeElement,H=R.nodeName.toLowerCase();this._inputValueAccessor=y||R,this._previousNativeValue=this.value,i.IOS&&M.runOutsideAngular(()=>{e.nativeElement.addEventListener("keyup",this._iOSKeyupListener)}),this._isNativeSelect="select"===H,this._isTextarea="textarea"===H,this._isNativeSelect&&(this.controlType=R.multiple?"sbb-native-select-multiple":"sbb-native-select")}get disabled(){return this.ngControl&&null!==this.ngControl.disabled?this.ngControl.disabled:this._disabled}set disabled(e){this._disabled=ii(e),this.focused&&(this.focused=!1,this.stateChanges.next())}get required(){return this._required}set required(e){this._required=ii(e)}get type(){return this._type}set type(e){this._type=e||"text",this._validateType(),!this._isTextarea&&PL().has(this._type)&&(this._elementRef.nativeElement.type=this._type)}get value(){return this._inputValueAccessor.value}set value(e){e!==this.value&&(this._inputValueAccessor.value=e,this.stateChanges.next())}get readonly(){return this._readonly}set readonly(e){this._readonly=ii(e)}get empty(){return!(this._isNeverEmpty()||this._elementRef.nativeElement.value||this._isBadInput()||this.autofilled)}ngAfterViewInit(){this._platform.isBrowser&&this._autofillMonitor.monitor(this._elementRef.nativeElement).subscribe(e=>{this.autofilled=e.isAutofilled,this.stateChanges.next()}),this._platform.IOS&&this._elementRef.nativeElement.removeEventListener("keyup",this._iOSKeyupListener)}ngOnChanges(){this.stateChanges.next()}ngOnDestroy(){this.stateChanges.complete(),this._platform.isBrowser&&this._autofillMonitor.stopMonitoring(this._elementRef.nativeElement)}ngDoCheck(){this.ngControl&&this.updateErrorState(),this._dirtyCheckNativeValue()}focus(e){this._elementRef.nativeElement.focus(e)}_focusChanged(e){e!==this.focused&&(this.focused=e,this.stateChanges.next())}_dirtyCheckNativeValue(){const e=this._elementRef.nativeElement.value;this._previousNativeValue!==e&&(this._previousNativeValue=e,this.stateChanges.next())}_validateType(){sX.indexOf(this._type)}_isNeverEmpty(){return this._neverEmptyInputTypes.indexOf(this._type)>-1}_isBadInput(){const e=this._elementRef.nativeElement.validity;return e&&e.badInput}setDescribedByIds(e){e.length?this._elementRef.nativeElement.setAttribute("aria-describedby",e.join(" ")):this._elementRef.nativeElement.removeAttribute("aria-describedby")}onContainerClick(){this.focused||this.focus()}}return n.\u0275fac=function(e){return new(e||n)(X(zn),X(Is),X(tc,10),X(Mb,8),X(Ab,8),X(pD),X(MF,10),X(rX),X(di))},n.\u0275dir=Ft({type:n,selectors:[["input","sbbInput",""],["select","sbbInput",""],["textarea","sbbInput",""]],hostAttrs:[1,"sbb-input-element"],hostVars:9,hostBindings:function(e,i){1&e&&nn("focus",function(){return i._focusChanged(!0)})("blur",function(){return i._focusChanged(!1)}),2&e&&(Mc("disabled",i.disabled)("required",i.required),Sn("id",i.id)("name",i.name||null)("readonly",i.readonly&&!i._isNativeSelect||null)("aria-invalid",i.empty&&i.required?null:i.errorState)("aria-required",i.required)("placeholder",i.readonly?"-":i.placeholder||null)("tabindex",i.empty&&i.readonly?-1:null))},inputs:{disabled:"disabled",id:"id",placeholder:"placeholder",name:"name",required:"required",type:"type",errorStateMatcher:"errorStateMatcher",userAriaDescribedBy:["aria-describedby","userAriaDescribedBy"],value:"value",readonly:"readonly"},exportAs:["sbbInput"],features:[ni([{provide:Fv,useExisting:n}]),Yt,_r]}),n})(),AF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({imports:[WD,nr,wS,WD,wS]}),n})();const lX=["sbb-calendar-body",""];function cX(n,t){1&n&&bn(0,"td",4),2&n&&Sn("colspan",rn(2).firstRowOffset)}function uX(n,t){if(1&n){const e=Ho();le(0,"td",5)(1,"button",6),nn("click",function(){const s=Vi(e).$implicit;return Gi(rn(2).cellClicked(s))})("focus",function(r){const d=Vi(e).$implicit;return Gi(rn(2)._emitActiveDateChange(d,r))}),le(2,"div",7),Ye(3),pe()()()}if(2&n){const e=t.$implicit,i=t.index,r=rn().index,s=rn();ed("width",100/s.numCols,"%"),Sn("data-sbb-row",r)("data-sbb-col",i),Fe(1),Ui("sbb-calendar-body-disabled",!e.enabled)("sbb-calendar-body-active",s.isActiveCell(r,i))("sbb-calendar-body-range-background","range"===e.rangeBackground)("sbb-calendar-body-range-background-offset-start",null!==e.rangeBackground&&0===r&&s.firstRowOffset&&0===i)("sbb-calendar-body-selected-begin","begin"===e.rangeBackground)("sbb-calendar-body-selected-end","end"===e.rangeBackground)("sbb-calendar-body-selected",s.selectedValue===e.value)("sbb-calendar-body-today",s.todayValue===e.value),rt("tabindex",s.isActiveCell(r,i)?0:-1),Sn("aria-label",e.ariaLabel)("aria-disabled",!e.enabled||null)("aria-pressed",s.selectedValue===e.value)("aria-current",s.todayValue===e.value?"date":null),Fe(2),Pi(e.displayValue)}}function dX(n,t){if(1&n&&(le(0,"tr",1),Jt(1,cX,1,1,"td",2),Jt(2,uX,4,26,"td",3),pe()),2&n){const e=t.$implicit,i=t.index,r=rn();Fe(1),rt("ngIf",0===i&&r.firstRowOffset),Fe(1),rt("ngForOf",e)}}function hX(n,t){if(1&n&&(le(0,"th")(1,"span",5),Ye(2),pe(),le(3,"span",6),Ye(4),pe()()),2&n){const e=t.$implicit;Fe(2),Pi(e.long),Fe(2),Pi(e.narrow)}}function pX(n,t){}function fX(n,t){if(1&n){const e=Ho();le(0,"button",3),nn("click",function(){return Vi(e),Gi(rn().prevDay())}),bn(1,"sbb-icon",4),pe()}if(2&n){const e=rn();rt("disabled",e.disabled),Sn("aria-label",e.prevDayAriaLabel)}}function mX(n,t){1&n&&bn(0,"sbb-datepicker-toggle")}function gX(n,t){if(1&n){const e=Ho();le(0,"button",5),nn("click",function(){return Vi(e),Gi(rn().nextDay())}),bn(1,"sbb-icon",6),pe()}if(2&n){const e=rn();rt("disabled",e.disabled),Sn("aria-label",e.nextDayAriaLabel)}}const bX=["*"];class _X{constructor(t,e,i,r,s){this.value=t,this.displayValue=e,this.ariaLabel=i,this.enabled=r,this.rangeBackground=s}}let kF=(()=>{class n{constructor(e,i){this._elementRef=e,this._ngZone=i,this._focusActiveCellAfterViewChecked=!1,this.numCols=7,this.allowDisabledSelection=!1,this.activeCell=0,this.selectedValueChange=new on,this.activeDateChange=new on}ngAfterViewChecked(){this._focusActiveCellAfterViewChecked&&(this.focusActiveCell(),this._focusActiveCellAfterViewChecked=!1)}cellClicked(e){!this.allowDisabledSelection&&!e.enabled||this.selectedValueChange.emit(e.value)}_emitActiveDateChange(e,i){e.enabled&&this.activeDateChange.emit(e.value)}get firstRowOffset(){return this.rows&&this.rows.length&&this.rows[0].length?this.numCols-this.rows[0].length:0}isActiveCell(e,i){let r=e*this.numCols+i;return e&&(r-=this.firstRowOffset),r===this.activeCell}focusActiveCell(){this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.asObservable().pipe(Qr(1)).subscribe(()=>{setTimeout(()=>{const e=this._elementRef.nativeElement.querySelector(".sbb-calendar-body-active");e&&e.focus()})})})}_scheduleFocusActiveCellAfterViewChecked(){this._focusActiveCellAfterViewChecked=!0}}return n.\u0275fac=function(e){return new(e||n)(X(zn),X(di))},n.\u0275cmp=On({type:n,selectors:[["","sbb-calendar-body",""]],hostAttrs:["role","grid",1,"sbb-calendar-body"],hostVars:1,hostBindings:function(e,i){2&e&&Sn("aria-readonly",!0)},inputs:{label:"label",rows:"rows",todayValue:"todayValue",selectedValue:"selectedValue",labelMinRequiredCells:"labelMinRequiredCells",numCols:"numCols",allowDisabledSelection:"allowDisabledSelection",activeCell:"activeCell"},outputs:{selectedValueChange:"selectedValueChange",activeDateChange:"activeDateChange"},exportAs:["sbbCalendarBody"],attrs:lX,decls:1,vars:1,consts:[["role","row",4,"ngFor","ngForOf"],["role","row"],["class","sbb-calendar-body-label",4,"ngIf"],["role","gridcell","class","sbb-calendar-body-cell-container",3,"width",4,"ngFor","ngForOf"],[1,"sbb-calendar-body-label"],["role","gridcell",1,"sbb-calendar-body-cell-container"],["type","button",1,"sbb-calendar-body-cell","sbb-button-reset-frameless",3,"tabindex","click","focus"],[1,"sbb-calendar-body-cell-content"]],template:function(e,i){1&e&&Jt(0,dX,3,2,"tr",0),2&e&&rt("ngForOf",i.rows)},dependencies:[Rc,js],encapsulation:2,changeDetection:0}),n})();function Om(n){return Error(`SbbDatepicker: No provider found for ${n}.`)}class RF{constructor(t,e){this.start=t,this.end=e}}const XD=new Dt("SBB_DATEPICKER");let PF=(()=>{class n{constructor(e,i,r,s,d){if(this._dateAdapter=e,this.locale=i,this._changeDetectorRef=r,this._dateFormats=s,this.selectedChange=new on,this.userSelection=new on,this.activeDateChange=new on,this.dateRange=null,!this._dateAdapter)throw Om("DateAdapter");if(!this._dateFormats)throw Om("SBB_DATE_FORMATS");d&&d.connected&&d.datepickerInput.value&&d.connected.datepickerInput.value?this.dateRange=new RF(d.datepickerInput.value,d.connected.datepickerInput.value):d&&d.main&&d.datepickerInput.value&&d.main.datepickerInput.value&&(this.dateRange=new RF(d.main.datepickerInput.value,d.datepickerInput.value));const m=this._dateAdapter.getFirstDayOfWeek(),y=this._dateAdapter.getDayOfWeekNames("narrow"),M=this._dateAdapter.getDayOfWeekNames("long").map((R,H)=>({long:R,narrow:y[H]}));this.weekdays=M.slice(m).concat(M.slice(0,m)),this._activeDate=this._dateAdapter.today()}get activeDate(){return this._activeDate}set activeDate(e){const i=this._activeDate,r=this._getValidDateOrNull(this._dateAdapter.deserialize(e))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(r,this.minDate,this.maxDate),this._hasSameMonthAndYear(i,this._activeDate)||this.init()}get selected(){return this._selected}set selected(e){this._selected=this._getValidDateOrNull(this._dateAdapter.deserialize(e)),this.selectedDate=this._getDateInCurrentMonth(this._selected)}get minDate(){return this._minDate}set minDate(e){this._minDate=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get maxDate(){return this._maxDate}set maxDate(e){this._maxDate=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}ngAfterContentInit(){this.init()}dateSelected(e){if(this.selectedDate!==e){const i=this._getDateFromDayOfMonth(e);this.selectedChange.emit(i)}this.userSelection.emit()}_updateActiveDate(e){const i=this._activeDate;this.activeDate=this._getDateFromDayOfMonth(e),this._dateAdapter.compareDate(i,this.activeDate)&&this.activeDateChange.emit(this._activeDate)}handleCalendarBodyKeydown(e){const i=this._activeDate;switch(e.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,1);break;case 38:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,-7);break;case 40:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,7);break;case 36:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,1-this._dateAdapter.getDate(this._activeDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,this._dateAdapter.getNumDaysInMonth(this._activeDate)-this._dateAdapter.getDate(this._activeDate));break;case 33:this.activeDate=e.altKey?this._dateAdapter.addCalendarYears(this._activeDate,-1):this._dateAdapter.addCalendarMonths(this._activeDate,-1);break;case 34:this.activeDate=e.altKey?this._dateAdapter.addCalendarYears(this._activeDate,1):this._dateAdapter.addCalendarMonths(this._activeDate,1);break;case 13:return void((!this.dateFilter||this.dateFilter(this._activeDate))&&(this.dateSelected(this._dateAdapter.getDate(this._activeDate)),this.userSelection.emit(),e.preventDefault()));default:return}this._dateAdapter.compareDate(i,this.activeDate)&&(this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked()),e.preventDefault()}init(){this.selectedDate=this._getDateInCurrentMonth(this.selected),this.todayDate=this._getDateInCurrentMonth(this._dateAdapter.today()),this.monthLabel=this._dateAdapter.getMonthNames("short")[this._dateAdapter.getMonth(this.activeDate)].toLocaleUpperCase();const e=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),1);this.firstWeekOffset=(7+this._dateAdapter.getDayOfWeek(e)-this._dateAdapter.getFirstDayOfWeek())%7,this._createWeekCells(),this._changeDetectorRef.markForCheck()}focusActiveCell(){this.sbbCalendarBody.focusActiveCell()}_focusActiveCellAfterViewChecked(){this.sbbCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_getDateFromDayOfMonth(e){return this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),e)}_createWeekCells(){const e=this._dateAdapter.getNumDaysInMonth(this.activeDate),i=this._dateAdapter.getDateNames();this.weeks=[[]];for(let r=0,s=this.firstWeekOffset;r<e;r++,s++){7===s&&(this.weeks.push([]),s=0);const d=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),r+1),m=this._shouldEnableDate(d),y=this._dateAdapter.format(d,this._dateFormats.dateA11yLabel),T=this._shouldApplyRangeBackground(d);this.weeks[this.weeks.length-1].push(new _X(r+1,i[r],y,m,T))}}_shouldApplyRangeBackground(e){return this.dateRange&&this.dateRange.start&&this.dateRange.end&&!this._dateAdapter.sameDate(this.dateRange.start,this.dateRange.end)?this._dateAdapter.compareDate(e,this.dateRange.start)>0&&this._dateAdapter.compareDate(e,this.dateRange.end)<0?"range":this._isRangeLimit(e):null}_isRangeLimit(e){return 0===this._dateAdapter.compareDate(e,this.dateRange.start)?"begin":0===this._dateAdapter.compareDate(e,this.dateRange.end)?"end":null}_shouldEnableDate(e){return!!e&&(!this.dateFilter||this.dateFilter(e))&&(!this.minDate||this._dateAdapter.compareDate(e,this.minDate)>=0)&&(!this.maxDate||this._dateAdapter.compareDate(e,this.maxDate)<=0)}_getDateInCurrentMonth(e){return e&&this._hasSameMonthAndYear(e,this.activeDate)?this._dateAdapter.getDate(e):null}_hasSameMonthAndYear(e,i){return!(!e||!i||this._dateAdapter.getMonth(e)!==this._dateAdapter.getMonth(i)||this._dateAdapter.getYear(e)!==this._dateAdapter.getYear(i))}_getValidDateOrNull(e){return this._dateAdapter.isDateInstance(e)&&this._dateAdapter.isValid(e)?e:null}}return n.\u0275fac=function(e){return new(e||n)(X(Np,8),X(Ql),X(kr),X(nS,8),X(XD,8))},n.\u0275cmp=On({type:n,selectors:[["sbb-month-view"]],viewQuery:function(e,i){if(1&e&&yr(kF,7),2&e){let r;Jn(r=ei())&&(i.sbbCalendarBody=r.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter"},outputs:{selectedChange:"selectedChange",userSelection:"userSelection",activeDateChange:"activeDateChange"},exportAs:["sbbMonthView"],decls:7,vars:7,consts:[[1,"sbb-calendar-table"],[1,"sbb-calendar-table-header"],[4,"ngFor","ngForOf"],["colspan","7","aria-hidden","true",1,"sbb-calendar-table-header-divider"],["sbb-calendar-body","",3,"label","rows","todayValue","selectedValue","labelMinRequiredCells","activeCell","selectedValueChange","activeDateChange","keydown"],[1,"cdk-visually-hidden"],["aria-hidden","true"]],template:function(e,i){1&e&&(le(0,"table",0)(1,"thead",1)(2,"tr"),Jt(3,hX,5,2,"th",2),pe(),le(4,"tr"),bn(5,"th",3),pe()(),le(6,"tbody",4),nn("selectedValueChange",function(s){return i.dateSelected(s)})("activeDateChange",function(s){return i._updateActiveDate(s)})("keydown",function(s){return i.handleCalendarBodyKeydown(s)}),pe()()),2&e&&(Fe(3),rt("ngForOf",i.weekdays),Fe(3),au("label",i.monthLabel),rt("rows",i.weeks)("todayValue",i.todayDate)("selectedValue",i.selectedDate)("labelMinRequiredCells",3)("activeCell",i._dateAdapter.getDate(i.activeDate)-1))},dependencies:[Rc,kF],encapsulation:2,changeDetection:0}),n})(),yX=(()=>{class n{constructor(e,i,r){this._dateAdapter=e,this._labelSwitchToPreviousMonth=$localize`:Button label to switch to the previous month@@sbbDatepickerSwitchToPreviousMonth:Change to the previous month`,this._labelSwitchToNextMonth=$localize`:Button label to switch to the next month@@sbbDatepickerSwitchToNextMonth:Change to the next month`,this._labelSwitchToPreviousYear=$localize`:Button label to switch to the previous year@@sbbDatepickerSwitchToPreviousYear:Change to the previous year`,this._labelSwitchToNextYear=$localize`:Button label to switch to the next year@@sbbDatepickerSwitchToNextYear:Change to the next year`,this.calendar=i,this.calendar.stateChanges.subscribe(()=>r.markForCheck())}get monthText(){return this._dateAdapter.getMonthName(this.calendar.activeDate)}get yearText(){return this._dateAdapter.getYearName(this.calendar.activeDate)}previousMonthClicked(){const e=this._dateAdapter.addCalendarMonths(this.calendar.activeDate,-1);this._assignActiveDate(e)}nextMonthClicked(){const e=this._dateAdapter.addCalendarMonths(this.calendar.activeDate,1);this._assignActiveDate(e)}previousMonthEnabled(){return!this.calendar.minDate||!this._isSameMonthView(this.calendar.activeDate,this.calendar.minDate)}nextMonthEnabled(){return!this.calendar.maxDate||!this._isSameMonthView(this.calendar.activeDate,this.calendar.maxDate)}_isSameMonthView(e,i){return this._dateAdapter.getYear(e)===this._dateAdapter.getYear(i)&&this._dateAdapter.getMonth(e)===this._dateAdapter.getMonth(i)}previousYearClicked(){const e=this._dateAdapter.addCalendarYears(this.calendar.activeDate,-1);this._assignActiveDate(e)}nextYearClicked(){const e=this._dateAdapter.addCalendarYears(this.calendar.activeDate,1);this._assignActiveDate(e)}previousYearEnabled(){return!this.calendar.minDate||!this._isSameYearView(this.calendar.activeDate,this.calendar.minDate)}nextYearEnabled(){return!this.calendar.maxDate||!this._isSameYearView(this.calendar.activeDate,this.calendar.maxDate)}_isSameYearView(e,i){return this._dateAdapter.getYear(e)===this._dateAdapter.getYear(i)}_assignActiveDate(e){this.calendar.activeDate=this.calendar.minDate&&this._dateAdapter.compareDate(this.calendar.minDate,e)>0?this.calendar.minDate:this.calendar.maxDate&&this._dateAdapter.compareDate(this.calendar.maxDate,e)<0?this.calendar.maxDate:e}}return n.\u0275fac=function(e){return new(e||n)(X(Np,8),X($i(()=>YD)),X(kr))},n.\u0275cmp=On({type:n,selectors:[["sbb-calendar-header"]],hostAttrs:[1,"sbb-calendar-header","sbb-icon-scaled"],exportAs:["sbbCalendarHeader"],decls:15,vars:12,consts:[[1,"sbb-calendar-controls"],[1,"sbb-calendar-controls-months"],["type","button",1,"sbb-calendar-controls-button","sbb-calendar-controls-button-previous",3,"disabled","click"],["svgIcon","kom:chevron-small-left-small"],["aria-live","polite",1,"sbb-calendar-controls-label"],["type","button",1,"sbb-calendar-controls-button","sbb-calendar-controls-button-next",3,"disabled","click"],["svgIcon","kom:chevron-small-right-small"],[1,"sbb-calendar-controls-years"]],template:function(e,i){1&e&&(le(0,"div",0)(1,"div",1)(2,"button",2),nn("click",function(){return i.previousMonthClicked()}),bn(3,"sbb-icon",3),pe(),le(4,"span",4),Ye(5),pe(),le(6,"button",5),nn("click",function(){return i.nextMonthClicked()}),bn(7,"sbb-icon",6),pe()(),le(8,"div",7)(9,"button",2),nn("click",function(){return i.previousYearClicked()}),bn(10,"sbb-icon",3),pe(),le(11,"span",4),Ye(12),pe(),le(13,"button",5),nn("click",function(){return i.nextYearClicked()}),bn(14,"sbb-icon",6),pe()()()),2&e&&(Fe(2),rt("disabled",!i.previousMonthEnabled()),Sn("aria-label",i._labelSwitchToPreviousMonth),Fe(2),Sn("aria-label",i.monthText),Fe(1),Pi(i.monthText),Fe(1),rt("disabled",!i.nextMonthEnabled()),Sn("aria-label",i._labelSwitchToNextMonth),Fe(3),rt("disabled",!i.previousYearEnabled()),Sn("aria-label",i._labelSwitchToPreviousYear),Fe(2),Sn("aria-label",i.yearText),Fe(1),Pi(i.yearText),Fe(1),rt("disabled",!i.nextYearEnabled()),Sn("aria-label",i._labelSwitchToNextYear))},dependencies:[ol],encapsulation:2,changeDetection:0}),n})(),YD=(()=>{class n{constructor(e,i,r){if(this._dateAdapter=e,this._dateFormats=i,this._changeDetectorRef=r,this._moveFocusOnNextTick=!1,this.selectedChange=new on,this.userSelection=new on,this.stateChanges=new Wt,!this._dateAdapter)throw Om("DateAdapter");if(!this._dateFormats)throw Om("SBB_DATE_FORMATS")}get startAt(){return this._startAt}set startAt(e){this._startAt=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get selected(){return this._selected}set selected(e){this._selected=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get minDate(){return this._minDate}set minDate(e){this._minDate=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get maxDate(){return this._maxDate}set maxDate(e){this._maxDate=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get activeDate(){return this._clampedActiveDate}set activeDate(e){this._clampedActiveDate=this._dateAdapter.clampDate(e,this.minDate,this.maxDate),this.stateChanges.next()}ngAfterContentInit(){this.calendarHeaderPortal=new ud(this.headerComponent||yX),this.activeDate=this.startAt||this._dateAdapter.today()}ngAfterViewChecked(){this._moveFocusOnNextTick&&(this._moveFocusOnNextTick=!1,this.focusActiveCell())}ngOnDestroy(){this.stateChanges.complete()}ngOnChanges(e){const i=e.minDate&&!this._dateAdapter.sameDate(e.minDate.previousValue,e.minDate.currentValue)?e.minDate:void 0,r=e.maxDate&&!this._dateAdapter.sameDate(e.maxDate.previousValue,e.maxDate.currentValue)?e.maxDate:void 0,s=i||r||e.dateFilter;if(s&&!s.firstChange){const d=this._getCurrentViewComponent();d&&(this._changeDetectorRef.detectChanges(),d.init())}this.stateChanges.next()}focusActiveCell(){this._getCurrentViewComponent().focusActiveCell()}dateSelected(e){e&&!this._dateAdapter.sameDate(e,this.selected)&&this.selectedChange.emit(e)}userSelected(){this.userSelection.emit()}_getValidDateOrNull(e){return this._dateAdapter.isDateInstance(e)&&this._dateAdapter.isValid(e)?e:null}_getCurrentViewComponent(){return this.monthView}}return n.\u0275fac=function(e){return new(e||n)(X(Np,8),X(nS,8),X(kr))},n.\u0275cmp=On({type:n,selectors:[["sbb-calendar"]],viewQuery:function(e,i){if(1&e&&yr(PF,7),2&e){let r;Jn(r=ei())&&(i.monthView=r.first)}},hostAttrs:[1,"sbb-calendar"],inputs:{headerComponent:"headerComponent",startAt:"startAt",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter"},outputs:{selectedChange:"selectedChange",userSelection:"userSelection"},exportAs:["sbbCalendar"],features:[_r],decls:3,vars:6,consts:[[3,"cdkPortalOutlet"],["cdkMonitorSubtreeFocus","","tabindex","-1",1,"sbb-calendar-content"],[3,"activeDate","selected","dateFilter","maxDate","minDate","activeDateChange","selectedChange","userSelection"]],template:function(e,i){1&e&&(Jt(0,pX,0,0,"ng-template",0),le(1,"div",1)(2,"sbb-month-view",2),nn("activeDateChange",function(s){return i.activeDate=s})("selectedChange",function(s){return i.dateSelected(s)})("userSelection",function(){return i.userSelected()}),pe()()),2&e&&(rt("cdkPortalOutlet",i.calendarHeaderPortal),Fe(2),rt("activeDate",i.activeDate)("selected",i.selected)("dateFilter",i.dateFilter)("maxDate",i.maxDate)("minDate",i.minDate))},dependencies:[dd,Oq,PF],encapsulation:2,changeDetection:0}),n})(),vX=(()=>{class n{ngAfterViewInit(){this.calendar.focusActiveCell()}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=On({type:n,selectors:[["sbb-datepicker-content"]],viewQuery:function(e,i){if(1&e&&yr(YD,7),2&e){let r;Jn(r=ei())&&(i.calendar=r.first)}},hostAttrs:[1,"sbb-datepicker-content"],exportAs:["sbbDatepickerContent"],decls:1,vars:10,consts:[["cdkTrapFocus","","role","dialog",1,"sbb-datepicker-content-container",3,"id","ngClass","startAt","minDate","maxDate","dateFilter","headerComponent","selected","selectedChange","userSelection"]],template:function(e,i){if(1&e&&(le(0,"sbb-calendar",0),nn("selectedChange",function(s){return i.datepicker.select(s)})("userSelection",function(){return i.datepicker.close()}),pe()),2&e){let r;rt("id",i.datepicker.id)("ngClass",i.datepicker.panelClass)("startAt",i.datepicker.startAt)("minDate",i.datepicker.minDate)("maxDate",i.datepicker.maxDate)("dateFilter",i.datepicker.dateFilter)("headerComponent",i.datepicker.calendarHeaderComponent)("selected",i.datepicker.selected),Sn("aria-modal",!0)("aria-labelledby",null!==(r=i._dialogLabelId)&&void 0!==r?r:void 0)}},dependencies:[Tb,vq,YD],styles:['.sbb-datepicker-content{position:relative;top:var(--sbb-datepicker-content-offset);font-size:var(--sbb-font-size)}.sbb-datepicker-panel-above .sbb-datepicker-content{top:auto;bottom:var(--sbb-datepicker-content-offset)}.sbb-datepicker-content::after{top:var(--sbb-datepicker-calendar-arrow-offset);left:calc(var(--sbb-datepicker-button-offset) + var(--sbb-border-width));content:"";height:var(--sbb-datepicker-calendar-arrow-width);width:var(--sbb-datepicker-calendar-arrow-width);position:absolute;pointer-events:none;transform:rotate(-135deg);background-color:var(--sbb-color-background);border:var(--sbb-border-width) solid rgba(0,0,0,0);border-right-color:var(--sbb-color-weak-accent);border-bottom-color:var(--sbb-color-weak-accent);clip-path:polygon(-0.4px 100%, 100% -0.4px, 100% 100%)}.sbb-datepicker-with-arrows .sbb-datepicker-content::after{left:calc(var(--sbb-datepicker-button-offset) + var(--sbb-border-width) + var(--sbb-icon-size-default) + var(--sbb-datepicker-button-gap))}.sbb-datepicker-panel-above .sbb-datepicker-content::after{top:auto;bottom:var(--sbb-datepicker-calendar-arrow-offset);transform:rotate(45deg);clip-path:var(--sbb-box-shadow-arrow-clip-path);box-shadow:var(--sbb-box-shadow-arrow-width) var(--sbb-box-shadow-arrow-width) 0 var(--sbb-box-shadow-arrow-width) var(--sbb-box-shadow-color)}.sbb-calendar{display:block;max-width:100%;width:var(--sbb-datepicker-calendar-width);height:var(--sbb-datepicker-calendar-height);background-color:var(--sbb-color-background);border:var(--sbb-border-width) solid var(--sbb-color-weak-accent);border-radius:var(--sbb-border-radius);box-shadow:var(--sbb-box-shadow-below)}.sbb-calendar-header{display:block;border-bottom:var(--sbb-border-width-thin) solid var(--sbb-datepicker-calendar-line-color)}.sbb-calendar-controls{display:flex;height:var(--sbb-datepicker-calendar-header-height);align-items:center}.sbb-calendar-controls-months,.sbb-calendar-controls-years{display:flex;height:var(--sbb-datepicker-calendar-header-height);flex:1 0 50%;text-align:center;position:relative}.sbb-calendar-controls-months::after{content:"";display:block;position:absolute;width:0;height:100%;top:0;right:0;border-right:var(--sbb-border-width-thin) solid var(--sbb-datepicker-calendar-line-color)}.sbb-calendar-controls-button{background:none;max-width:none;min-width:0;padding:0;margin:0;border:none;display:flex;align-items:center;justify-content:center;flex-shrink:0;flex-grow:0;outline:0;padding-left:var(--sbb-datepicker-calendar-controls-padding);padding-right:var(--sbb-datepicker-calendar-controls-padding);height:var(--sbb-datepicker-calendar-header-height);cursor:pointer;color:var(--sbb-datepicker-calendar-header-color)}.sbb-calendar-controls-button:is(:hover,:focus,:active){color:var(--sbb-color-call-to-action-hover)}.sbb-calendar-controls-button:disabled{cursor:default;opacity:0}.sbb-calendar-controls-button-previous{float:left;padding-right:0}.sbb-calendar-controls-button-next{float:right;padding-left:0}.sbb-calendar-controls-label{flex-grow:1;flex-shrink:1;font-family:var(--sbb-font-light);font-size:1.4rem;line-height:3.2;color:var(--sbb-datepicker-calendar-header-color)}@media all and (min-width: 40.1875em){:where(html:not(.sbb-lean)) .sbb-calendar-controls-label{font-size:var(--sbb-font-size-large)}}:where(html.sbb-lean) .sbb-calendar-controls-label{font-size:var(--sbb-font-size);line-height:2.4rem}.sbb-calendar-content{padding:0 var(--sbb-datepicker-calendar-table-content-padding-width)}.sbb-calendar-table{width:100%;border-spacing:0;border-collapse:collapse;margin:0;position:relative}.sbb-calendar-table :is(td,th){color:var(--sbb-color-weak-accent);font-size:var(--sbb-font-size);line-height:1.5}.sbb-calendar-table-header::after{content:"";display:block;position:absolute;top:calc(2.2rem * var(--sbb-scaling-factor));border-bottom:var(--sbb-border-width-thin) solid var(--sbb-datepicker-calendar-line-color);width:calc(100% + var(--sbb-datepicker-calendar-table-content-padding-width)*2);left:calc(var(--sbb-datepicker-calendar-table-content-padding-width)*-1)}.sbb-calendar-table-header tr th{font-family:var(--sbb-font-roman);font-weight:400;font-size:var(--sbb-font-size-small);text-transform:uppercase;padding:calc(0.4666666667rem * var(--sbb-scaling-factor));color:var(--sbb-datepicker-calendar-header-color)}.sbb-calendar-table-header-divider{height:calc(1rem * var(--sbb-scaling-factor))}.sbb-calendar-body-cell-container{position:relative;height:0;padding:0;line-height:0;text-align:center}.sbb-calendar-body-cell{position:relative;top:0;left:0;width:100%;height:100%;background:none;text-align:center;outline:none;font-family:inherit;margin:0;cursor:pointer}.sbb-calendar-body-cell:is(.sbb-calendar-body-range-background,.sbb-calendar-body-selected-begin,.sbb-calendar-body-selected-end)::before{position:absolute;top:12.5%;left:12.5%;display:flex;align-items:center;justify-content:center;width:var(--sbb-datepicker-calendar-body-cell-size);height:var(--sbb-datepicker-calendar-body-cell-size);line-height:1;padding-left:calc(0.0666666667rem * var(--sbb-scaling-factor));padding-bottom:calc(0.0666666667rem * var(--sbb-scaling-factor));content:"";background-color:var(--sbb-datepicker-calendar-table-range-bg-color);width:100%;left:0}:is(.sbb-calendar-body-cell-container:is(:last-child,:first-child)>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell:is(.sbb-calendar-body-selected-begin,.sbb-calendar-body-selected-end,.sbb-calendar-body-range-background-offset-start))::before{width:50%}:is(.sbb-calendar-body-cell-container:first-child>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell:is(.sbb-calendar-body-selected-begin,.sbb-calendar-body-range-background-offset-start))::before{left:auto;right:0}:is(.sbb-calendar-body-cell-container:is(:last-child,:first-child)>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell.sbb-calendar-body-range-background-offset-start)::after{position:absolute;top:12.5%;left:12.5%;display:flex;align-items:center;justify-content:center;width:var(--sbb-datepicker-calendar-body-cell-size);height:var(--sbb-datepicker-calendar-body-cell-size);line-height:1;padding-left:calc(0.0666666667rem * var(--sbb-scaling-factor));padding-bottom:calc(0.0666666667rem * var(--sbb-scaling-factor));content:"";background-color:var(--sbb-datepicker-calendar-table-range-bg-color)}:is(.sbb-calendar-body-cell-container:first-child>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell.sbb-calendar-body-range-background-offset-start)::after{border-radius:50% 0 0 50%}.sbb-calendar-body-cell-container:last-child>.sbb-calendar-body-cell.sbb-calendar-body-range-background::after{border-radius:0 50% 50% 0}:is(.sbb-calendar-body-cell-container:first-child:last-child>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell-container:last-child>.sbb-calendar-body-cell:is(.sbb-calendar-body-range-background-offset-start,.sbb-calendar-body-selected-begin),.sbb-calendar-body-cell-container:first-child>.sbb-calendar-body-cell.sbb-calendar-body-selected-end,.sbb-calendar-body-cell.sbb-calendar-body-range-background-offset-start.sbb-calendar-body-selected-end)::before{display:none}:is(.sbb-calendar-body-cell-container:first-child:last-child>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell-container:last-child>.sbb-calendar-body-cell:is(.sbb-calendar-body-range-background-offset-start,.sbb-calendar-body-selected-begin),.sbb-calendar-body-cell-container:first-child>.sbb-calendar-body-cell.sbb-calendar-body-selected-end,.sbb-calendar-body-cell.sbb-calendar-body-range-background-offset-start.sbb-calendar-body-selected-end)::after{border-radius:50%}.sbb-calendar-body-cell,.sbb-calendar-body-label{padding-top:var(--sbb-datepicker-calendar-body-cell-padding);padding-bottom:var(--sbb-datepicker-calendar-body-cell-padding)}.sbb-calendar-body-cell.sbb-calendar-body-disabled{color:var(--sbb-color-cement);cursor:default}:where(html.sbb-lean) .sbb-calendar-body-cell.sbb-calendar-body-disabled{color:var(--sbb-color-storm)}.sbb-calendar-body-cell.sbb-calendar-body-disabled::after{content:"";width:calc(2.1333333333rem * var(--sbb-scaling-factor));height:calc(0.0666666667rem * var(--sbb-scaling-factor));top:calc(1.6666666667rem * var(--sbb-scaling-factor));left:calc(50% - var(--sbb-datepicker-calendar-body-cell-disabled-offset));background-color:var(--sbb-color-cement);display:block;position:absolute;transform:rotate(-45deg)}:where(html.sbb-lean) .sbb-calendar-body-cell.sbb-calendar-body-disabled::after{background-color:var(--sbb-color-storm);width:1.6rem;top:1.2rem}.sbb-calendar-body-today{font-family:var(--sbb-font-bold);color:var(--sbb-color-black)}.sbb-calendar-body-cell-content{position:absolute;top:12.5%;left:12.5%;display:flex;align-items:center;justify-content:center;width:var(--sbb-datepicker-calendar-body-cell-size);height:var(--sbb-datepicker-calendar-body-cell-size);line-height:1;padding-left:calc(0.0666666667rem * var(--sbb-scaling-factor));padding-bottom:calc(0.0666666667rem * var(--sbb-scaling-factor));border:var(--sbb-border-width) solid rgba(0,0,0,0);border-radius:50%;z-index:1}.sbb-calendar-body-cell:not(.sbb-calendar-body-disabled):is(:hover,:focus) .sbb-calendar-body-cell-content{background-color:var(--sbb-color-background);color:var(--sbb-color-call-to-action-hover);border-color:var(--sbb-color-call-to-action-hover)}:is(.sbb-calendar-body-cell:not(.sbb-calendar-body-disabled).sbb-calendar-body-selected,.sbb-calendar-body-selected-begin,.sbb-calendar-body-selected-end) .sbb-calendar-body-cell-content{background-color:var(--sbb-color-background);color:var(--sbb-color-weak-accent);border-color:var(--sbb-color-weak-accent)}'],encapsulation:2,changeDetection:0}),n})(),xX=(()=>{class n{constructor(e,i,r){this._changeDetectorRef=e,this._datepicker=i,this._labelShowCalendar=$localize`:Open calendar@@sbbDatepickerOpenCalendar:Show calendar`,this._stateChanges=he.EMPTY;const s=Number(r);this.tabIndex=s||0===s?s:null}get disabled(){return void 0===this._disabled?this._datepicker.disabled:this._disabled}set disabled(e){this._disabled=ii(e)}ngOnChanges(e){e.datepicker&&this._watchStateChanges()}ngOnDestroy(){this._stateChanges.unsubscribe()}ngAfterContentInit(){this._watchStateChanges()}open(e){this._datepicker&&!this.disabled&&(this._datepicker.open(),e.stopPropagation())}_watchStateChanges(){const e=this._datepicker?this._datepicker.disabledChange:qn(),i=this._datepicker&&this._datepicker.datepickerInput?this._datepicker.datepickerInput.disabledChange:qn(),r=this._datepicker?Or(this._datepicker.openedStream,this._datepicker.closedStream):qn();this._stateChanges.unsubscribe(),this._stateChanges=Or(e,i,r).subscribe(()=>this._changeDetectorRef.markForCheck())}}return n.\u0275fac=function(e){return new(e||n)(X(kr),X(XD),os("tabindex"))},n.\u0275cmp=On({type:n,selectors:[["sbb-datepicker-toggle"]],hostAttrs:[1,"sbb-datepicker-toggle"],hostVars:3,hostBindings:function(e,i){2&e&&(Sn("tabindex",null),Ui("sbb-datepicker-toggle-active",i._datepicker&&i._datepicker.opened))},inputs:{tabIndex:"tabIndex",disabled:"disabled"},features:[_r],decls:2,vars:3,consts:[["aria-haspopup","true","type","button",1,"sbb-datepicker-toggle-button","sbb-icon-scaled",3,"disabled","click"],["svgIcon","kom:calendar-small"]],template:function(e,i){1&e&&(le(0,"button",0),nn("click",function(s){return i.open(s)}),bn(1,"sbb-icon",1),pe()),2&e&&(rt("disabled",i.disabled),Sn("aria-label",i._labelShowCalendar)("tabindex",i.disabled?-1:i.tabIndex))},dependencies:[ol],encapsulation:2,changeDetection:0}),n})(),wX=0;const OF=new Dt("sbb-datepicker-scroll-strategy"),CX={provide:OF,deps:[es],useFactory:function SX(n){return()=>n.scrollStrategies.reposition()}};let KD=(()=>{class n{constructor(e,i,r,s,d,m,y){if(this._overlay=e,this._ngZone=i,this._viewContainerRef=r,this._changeDetectorRef=s,this._scrollStrategy=d,this._dateAdapter=m,this.locale=y,this._arrows=!1,this._toggle=!0,this.openedStream=new on,this.closedStream=new on,this._opened=!1,this.id="sbb-datepicker-"+wX++,this._validSelected=null,this.nextDayAriaLabel=$localize`:Next day button's aria-label@@sbbDatePickerNextDayAriaLabel:Next day`,this.prevDayAriaLabel=$localize`:Previous day button's aria-label@@sbbDatePickerPrevDayAriaLabel:Previous day`,this._focusedElementBeforeOpen=null,this._inputSubscription=he.EMPTY,this._inputChangeSubscription=he.EMPTY,this._connectedDatepickerSubscription=he.EMPTY,this._posStrategySubscription=he.EMPTY,this.disabledChange=new Wt,this.selectedChanged=new Wt,!this._dateAdapter)throw Om("DateAdapter");this._dateAdapter.setLocale(y)}get startAt(){return this._startAt||(this.datepickerInput?this.datepickerInput.value:null)}set startAt(e){this._startAt=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get disabled(){return void 0===this._disabled&&this.datepickerInput?this.datepickerInput.disabled:!!this._disabled}set disabled(e){const i=ii(e);i!==this._disabled&&(this._disabled=i,this.disabledChange.next(i))}set connected(e){e!==this._connected&&this._connected&&(this._connected.main=null),e&&(e.main=this),this._connected=e}get connected(){return this._connected}get arrows(){return this._arrows}set arrows(e){this._arrows=ii(e)}get arrowsVisible(){var e;return this.arrows&&!(null!==(e=this.datepickerInput)&&void 0!==e&&e.readonly)}get toggle(){return this._toggle}set toggle(e){this._toggle=ii(e)}set notoggle(e){this._toggle=!ii(e)}get toggleVisible(){var e;return this.toggle&&!(null!==(e=this.datepickerInput)&&void 0!==e&&e.readonly)}get opened(){return this._opened}set opened(e){ii(e)?this.open():this.close()}get selected(){return this._validSelected}set selected(e){this._validSelected=e,this._changeDetectorRef.markForCheck()}get minDate(){return this.datepickerInput&&this.datepickerInput.min}get maxDate(){return this.datepickerInput&&this.datepickerInput.max}get dateFilter(){return this.datepickerInput&&this.datepickerInput.dateFilter}get prevDayActive(){return this.arrowsVisible&&this.datepickerInput&&!!this.datepickerInput.value&&(!this.minDate||this._dateAdapter.compareDate(this.datepickerInput.value,this.minDate)>0)}get nextDayActive(){return this.arrowsVisible&&this.datepickerInput&&!!this.datepickerInput.value&&(!this.maxDate||this._dateAdapter.compareDate(this.datepickerInput.value,this.maxDate)<0)}ngOnDestroy(){this.close(),this._inputSubscription.unsubscribe(),this._inputChangeSubscription.unsubscribe(),this._connectedDatepickerSubscription.unsubscribe(),this.disabledChange.complete(),this.popupRef&&(this._posStrategySubscription.unsubscribe(),this.popupRef.dispose(),this._popupComponentRef=null)}select(e){const i=this.selected;this.selected=e,this._dateAdapter.sameDate(i,this.selected)||this.selectedChanged.next(e)}nextDay(){this.selected&&(this.selected=this._dateAdapter.addCalendarDays(this.selected,1),this.selectedChanged.next(this.selected))}prevDay(){this.selected&&(this.selected=this._dateAdapter.addCalendarDays(this.selected,-1),this.selectedChanged.next(this.selected))}registerInput(e){if(this.datepickerInput)throw Error("A SbbDatepicker can only be associated with a single input.");this.datepickerInput=e,this._inputSubscription=this.datepickerInput.valueChange.subscribe(i=>this.selected=i),this._inputChangeSubscription=Or(this.datepickerInput.disabledChange,this.datepickerInput.readonlyChange).subscribe(()=>this._changeDetectorRef.markForCheck()),this._connectedDatepickerSubscription=Or(this.openedStream.pipe(sv("opened")),this.selectedChanged.pipe(sv("selected")),this.closedStream.pipe(sv("closed"))).pipe(function X9(n,t=null){return t=null!=t?t:n,Cn((e,i)=>{let r=[],s=0;e.subscribe(bt(i,d=>{let m=null;s++%t==0&&r.push([]);for(const y of r)y.push(d),n<=y.length&&(m=null!=m?m:[],m.push(y));if(m)for(const y of m)p(r,y),i.next(y)},()=>{for(const d of r)i.next(d);i.complete()},void 0,()=>{r=null}))})}(3,1),Rr(([i,r,s])=>!!this.connected&&!!this.datepickerInput.value&&"opened"===i&&"selected"===r&&"closed"===s&&(!this.connected.datepickerInput.value||this._dateAdapter.compareDate(this.datepickerInput.value,this.connected.datepickerInput.value)>0)),Jo(()=>{this.connected.datepickerInput.value&&(this.connected.datepickerInput.value=null,this.connected.datepickerInput._cvaOnChange(null))})).subscribe(()=>this.connected.open())}open(){if(!this._opened&&!this.disabled){if(!this.datepickerInput)throw Error("Attempted to open an SbbDatepicker with no associated input.");this._focusedElementBeforeOpen=pu(),this._openAsPopup(),this._opened=!0,this.openedStream.emit()}}close(){if(!this._opened)return;this.popupRef&&this.popupRef.hasAttached()&&this.popupRef.detach(),this._calendarPortal&&this._calendarPortal.isAttached&&this._calendarPortal.detach();const e=()=>{this._opened&&(this._opened=!1,this.closedStream.emit(),this._focusedElementBeforeOpen=null)};this._focusedElementBeforeOpen&&"function"==typeof this._focusedElementBeforeOpen.focus?(this._focusedElementBeforeOpen.focus(),setTimeout(e)):e()}_getPanelClasses(){return["sbb-datepicker-panel",this.arrows?"sbb-datepicker-with-arrows":"sbb-datepicker-no-arrows"]}_openAsPopup(){this._calendarPortal||(this._calendarPortal=new ud(vX,this._viewContainerRef)),this.popupRef?this.popupRef.getConfig().panelClass=this._getPanelClasses():this._createPopup(),this.popupRef.hasAttached()||(this._popupComponentRef=this.popupRef.attach(this._calendarPortal),this._popupComponentRef.instance.datepicker=this,this._popupComponentRef.instance._dialogLabelId=this.datepickerInput.getOverlayLabelId(),this._ngZone.onStable.asObservable().pipe(Qr(1)).subscribe(()=>{this.popupRef.updatePosition()}))}_createPopup(){const e=new km({positionStrategy:this._createPopupPositionStrategy(),hasBackdrop:!0,backdropClass:"sbb-overlay-transparent-backdrop",scrollStrategy:this._scrollStrategy(),panelClass:this._getPanelClasses()});this.popupRef=this._overlay.create(e),Or(this.popupRef.backdropClick(),this.popupRef.detachments(),this.popupRef.keydownEvents().pipe(Rr(i=>27===i.keyCode||this.datepickerInput&&i.altKey&&38===i.keyCode))).subscribe(()=>this.close())}_createPopupPositionStrategy(){const e=this._overlay.position().flexibleConnectedTo(this.datepickerInput.getConnectedOverlayOrigin()).withTransformOriginOn(".sbb-datepicker-content").withFlexibleDimensions(!1).withViewportMargin(8).withPush(!1).withPositions([{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom"}]);return this._posStrategySubscription=e.positionChanges.subscribe(i=>{"top"===i.connectionPair.originY?this.popupRef.hostElement.classList.add("sbb-datepicker-panel-above"):this.popupRef.hostElement.classList.remove("sbb-datepicker-panel-above")}),e}_getValidDateOrNull(e){return this._dateAdapter.isDateInstance(e)&&this._dateAdapter.isValid(e)?e:null}}return n.\u0275fac=function(e){return new(e||n)(X(es),X(di),X(Qo),X(kr),X(OF),X(Np,8),X(Ql))},n.\u0275cmp=On({type:n,selectors:[["sbb-datepicker"]],hostAttrs:[1,"sbb-datepicker"],hostVars:6,hostBindings:function(e,i){2&e&&Ui("sbb-datepicker-arrows-enabled",i.arrowsVisible)("sbb-datepicker-toggle-enabled",i.toggleVisible)("sbb-datepicker-disabled",i.disabled)},inputs:{calendarHeaderComponent:"calendarHeaderComponent",startAt:"startAt",disabled:"disabled",panelClass:"panelClass",connected:"connected",arrows:"arrows",toggle:"toggle",notoggle:"notoggle",opened:"opened",nextDayAriaLabel:"nextDayAriaLabel",prevDayAriaLabel:"prevDayAriaLabel"},outputs:{openedStream:"opened",closedStream:"closed"},exportAs:["sbbDatepicker"],features:[ni([{provide:XD,useExisting:n}])],ngContentSelectors:bX,decls:4,vars:3,consts:[["type","button","class","sbb-datepicker-arrow-button sbb-datepicker-arrow-button-left sbb-icon-scaled",3,"disabled","click",4,"ngIf"],[4,"ngIf"],["type","button","class","sbb-datepicker-arrow-button sbb-datepicker-arrow-button-right sbb-icon-scaled",3,"disabled","click",4,"ngIf"],["type","button",1,"sbb-datepicker-arrow-button","sbb-datepicker-arrow-button-left","sbb-icon-scaled",3,"disabled","click"],["svgIcon","kom:chevron-small-left-small"],["type","button",1,"sbb-datepicker-arrow-button","sbb-datepicker-arrow-button-right","sbb-icon-scaled",3,"disabled","click"],["svgIcon","kom:chevron-small-right-small"]],template:function(e,i){1&e&&($o(),Jt(0,fX,2,2,"button",0),Jt(1,mX,1,0,"sbb-datepicker-toggle",1),$r(2),Jt(3,gX,2,2,"button",2)),2&e&&(rt("ngIf",i.prevDayActive),Fe(1),rt("ngIf",i.toggleVisible),Fe(2),rt("ngIf",i.nextDayActive))},dependencies:[js,ol,xX],styles:[".sbb-datepicker{display:inline-block;position:relative;color:var(--sbb-color-weak-accent)}.sbb-form-field .sbb-datepicker{width:100%}.sbb-datepicker-disabled{color:var(--sbb-color-granite)}.sbb-datepicker>.sbb-date-input{width:100%}:is(.sbb-datepicker-toggle-enabled,.sbb-datepicker-arrows-enabled)>.sbb-date-input{padding-left:var(--sbb-datepicker-toggle-or-arrows-padding)}.sbb-datepicker-arrows-enabled>.sbb-date-input{padding-right:var(--sbb-datepicker-toggle-or-arrows-padding)}.sbb-datepicker-arrows-enabled.sbb-datepicker-toggle-enabled>.sbb-date-input{padding-left:var(--sbb-datepicker-toggle-and-arrows-padding)}:is(.sbb-datepicker-arrow-button,.sbb-datepicker-toggle-button){background:none;max-width:none;min-width:0;padding:0;margin:0;border:none;position:absolute;top:50%;transform:translateY(-50%);outline:0;color:inherit;line-height:0}:is(.sbb-datepicker-arrow-button,.sbb-datepicker-toggle-button):not(:disabled){cursor:pointer}:is(.sbb-datepicker-arrow-button,.sbb-datepicker-toggle-button):not(:disabled):is(:hover,:focus,:active){color:var(--sbb-color-call-to-action-hover)}.sbb-datepicker-arrow-button-left,.sbb-datepicker-toggle-button{left:var(--sbb-datepicker-button-offset)}.sbb-datepicker-arrows-enabled .sbb-datepicker-toggle-button{left:var(--sbb-datepicker-adjacent-button-offset)}.sbb-datepicker-arrow-button-right{right:var(--sbb-datepicker-button-offset)}"],encapsulation:2,changeDetection:0}),n})();class SS{constructor(t,e){this.target=t,this.targetElement=e,this.value=this.target.value}}const TX={provide:nl,useExisting:$i(()=>CS),multi:!0},EX={provide:ra,useExisting:$i(()=>CS),multi:!0};let CS=(()=>{class n{constructor(e,i,r,s,d){if(this._elementRef=e,this._dateAdapter=i,this._dateFormats=r,this._datepicker=s,this._formField=d,this._disabled=!1,this._readonly=!1,this.dateChange=new on,this.dateInput=new on,this.inputBlurred=new on,this.valueChange=new on,this.disabledChange=new on,this.readonlyChange=new on,this._datepickerSubscription=he.EMPTY,this._lastValueValid=!1,this._onTouched=()=>{},this._cvaOnChange=()=>{},this._validatorOnChange=()=>{},this._parseValidator=()=>this._lastValueValid?null:{sbbDateParse:{text:this._elementRef.nativeElement.value}},this._minValidator=m=>{const y=this._getValidDateOrNull(this._dateAdapter.deserialize(m.value));return!this.min||!y||this._dateAdapter.compareDate(this.min,y)<=0?null:{sbbDateMin:{min:this.min,actual:y}}},this._maxValidator=m=>{const y=this._getValidDateOrNull(this._dateAdapter.deserialize(m.value));return!this.max||!y||this._dateAdapter.compareDate(this.max,y)>=0?null:{sbbDateMax:{max:this.max,actual:y}}},this._filterValidator=m=>{const y=this._getValidDateOrNull(this._dateAdapter.deserialize(m.value));return this._dateFilter&&y&&!this._dateFilter(y)?{sbbDateFilter:!0}:null},this._validator=WT.compose([this._parseValidator,this._minValidator,this._maxValidator,this._filterValidator]),!this._dateAdapter)throw Om("DateAdapter");if(!this._dateFormats)throw Om("SBB_DATE_FORMATS")}set dateFilter(e){this._dateFilter=e,this._validatorOnChange()}get dateFilter(){return this._dateFilter}get value(){return this._value}set value(e){e=this._dateAdapter.deserialize(e),this._lastValueValid=!e||this._dateAdapter.isValid(e),e=this._getValidDateOrNull(e);const i=this.value;this._value=e,this._formatValue(e),this._dateAdapter.sameDate(i,e)||this.valueChange.emit(e)}get min(){return this._min||(this._datepicker&&this._datepicker.main&&this._datepicker.main.datepickerInput&&this._datepicker.main.datepickerInput.value?this._datepicker.main.datepickerInput.value:null)}set min(e){this._min=this._getValidDateOrNull(this._dateAdapter.deserialize(e)),this._validatorOnChange()}get max(){return this._max}set max(e){this._max=this._getValidDateOrNull(this._dateAdapter.deserialize(e)),this._validatorOnChange()}get disabled(){return this._disabled}set disabled(e){const i=ii(e),r=this._elementRef.nativeElement;this._disabled!==i&&(this._disabled=i,this.disabledChange.emit(i)),i&&r.blur&&r.blur()}get readonly(){return this._readonly}set readonly(e){this._readonly=ii(e),this.readonlyChange.next(this._readonly)}ngOnInit(){!this._datepicker||(this._datepicker.registerInput(this),this._datepickerSubscription.unsubscribe(),this._datepickerSubscription=this._datepicker.selectedChanged.subscribe(e=>{this.value=e,this._cvaOnChange(e),this._onTouched(),this.dateInput.emit(new SS(this,this._elementRef.nativeElement)),this.dateChange.emit(new SS(this,this._elementRef.nativeElement))}))}ngOnDestroy(){this._datepickerSubscription.unsubscribe(),this.valueChange.complete(),this.disabledChange.complete()}registerOnValidatorChange(e){this._validatorOnChange=e}validate(e){return this._validator?this._validator(e):null}getConnectedOverlayOrigin(){return this._elementRef}writeValue(e){this.value=e}registerOnChange(e){this._cvaOnChange=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this.disabled=e}_onKeydown(e){this._datepicker&&e.altKey&&40===e.keyCode&&(this._datepicker.open(),e.preventDefault())}_onInput(e){let i=this._dateAdapter.parse(e);this._lastValueValid=!i||this._dateAdapter.isValid(i),i=this._getValidDateOrNull(i),this._dateAdapter.sameDate(i,this._value)?this._validatorOnChange():(this._value=i,this._cvaOnChange(i),this.valueChange.emit(i),this.dateInput.emit(new SS(this,this._elementRef.nativeElement)))}_onChange(){this.dateChange.emit(new SS(this,this._elementRef.nativeElement))}_onBlur(){this.value&&this._formatValue(this.value),this._onTouched(),this.inputBlurred.emit()}_formatValue(e){var i;const r=this._datepicker?this._dateFormats.dateInput:null!==(i=this._dateFormats.dateInputPure)&&void 0!==i?i:this._dateFormats.dateInput;this._elementRef.nativeElement.value=null!=e?this._dateAdapter.format(e,r):""}_getValidDateOrNull(e){return this._dateAdapter.isDateInstance(e)&&this._dateAdapter.isValid(e)?e:null}getOverlayLabelId(){return this._formField?this._formField.getLabelId():this._elementRef.nativeElement.getAttribute("aria-labelledby")}}return n.\u0275fac=function(e){return new(e||n)(X(zn),X(Np,8),X(nS,8),X(KD,8),X(xS,8))},n.\u0275dir=Ft({type:n,selectors:[["input","sbbDateInput",""]],hostAttrs:[1,"sbb-date-input"],hostVars:5,hostBindings:function(e,i){1&e&&nn("keydown",function(s){return i._onKeydown(s)})("input",function(s){return i._onInput(s.target.value)})("change",function(){return i._onChange()})("blur",function(){return i._onBlur()}),2&e&&(Mc("disabled",i.disabled),Sn("aria-haspopup",i._datepicker?"dialog":null)("aria-owns",(null==i._datepicker?null:i._datepicker.opened)&&i._datepicker.id||null)("min",i.min?i._dateAdapter.toIso8601(i.min):null)("max",i.max?i._dateAdapter.toIso8601(i.max):null))},inputs:{dateFilter:"dateFilter",value:"value",min:"min",max:"max",disabled:"disabled",readonly:"readonly"},outputs:{dateChange:"dateChange",dateInput:"dateInput",inputBlurred:"inputBlurred"},exportAs:["sbbDateInput"],features:[ni([TX,EX,{provide:MF,useExisting:n}])]}),n})(),LF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({providers:[CX,{provide:Np,useClass:b2},{provide:nS,useValue:yG}],imports:[Tr,wa,Cm,Ml,nr,Ao]}),n})();const DX=["input"],IX=["*"];let MX=0;const AX={provide:nl,useExisting:$i(()=>JD),multi:!0};class FF{constructor(t,e){this.source=t,this.value=e}}const NF=new Dt("SbbRadioGroup"),QD=new Dt("SbbRadioButton");let kX=(()=>{class n{constructor(e){this._changeDetector=e,this.change=new on,this._value=null,this._name="sbb-radio-group-"+MX++,this._selected=null,this._isInitialized=!1,this._disabled=!1,this._required=!1,this._controlValueAccessorChangeFn=()=>{},this._onTouched=()=>{}}get name(){return this._name}set name(e){this._name=e,this._updateRadioButtonNames()}get value(){return this._value}set value(e){this._value!==e&&(this._value=e,this._updateSelectedRadioFromValue(),this._checkSelectedRadioButton())}get selected(){return this._selected}set selected(e){this._selected=e,this.value=e?e.value:null,this._checkSelectedRadioButton()}get disabled(){return this._disabled}set disabled(e){this._disabled=ii(e),this._markRadiosForCheck()}get required(){return this._required}set required(e){this._required=ii(e),this._markRadiosForCheck()}_checkSelectedRadioButton(){this._selected&&!this._selected.checked&&(this._selected.checked=!0)}ngAfterContentInit(){this._isInitialized=!0}_touch(){this._onTouched&&this._onTouched()}_emitChangeEvent(){this._isInitialized&&this.change.emit(new FF(this._selected,this._value))}_markRadiosForCheck(){this._radios&&this._radios.forEach(e=>e._markForCheck())}writeValue(e){this.value=e,this._changeDetector.markForCheck()}registerOnChange(e){this._controlValueAccessorChangeFn=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this.disabled=e,this._changeDetector.markForCheck()}_updateRadioButtonNames(){this._radios&&this._radios.forEach(e=>{e.name=this.name,e._markForCheck()})}_updateSelectedRadioFromValue(){this._radios&&(null===this._selected||this._selected.value!==this._value)&&(this._selected=null,this._radios.forEach(i=>{i.checked=this.value===i.value,i.checked&&(this._selected=i)}))}}return n.\u0275fac=function(e){return new(e||n)(X(kr))},n.\u0275dir=Ft({type:n,contentQueries:function(e,i,r){if(1&e&&Kr(r,QD,5),2&e){let s;Jn(s=ei())&&(i._radios=s)}},hostAttrs:[1,"sbb-radio-group-base"],inputs:{name:"name",value:"value",selected:"selected",disabled:"disabled",required:"required"},outputs:{change:"change"}}),n})(),JD=(()=>{class n extends kX{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Yi(n)))(i||n)}}(),n.\u0275dir=Ft({type:n,selectors:[["sbb-radio-group"]],contentQueries:function(e,i,r){if(1&e&&Kr(r,QD,5),2&e){let s;Jn(s=ei())&&(i._radios=s)}},hostAttrs:["role","radiogroup",1,"sbb-radio-group"],exportAs:["sbbRadioGroup"],features:[ni([AX,{provide:NF,useExisting:n}]),Yt]}),n})();const PX=$b(class RX{});let OX=0,LX=(()=>{class n extends PX{constructor(e,i,r,s,d,m){super(),this._elementRef=i,this._changeDetector=r,this._focusMonitor=s,this._radioDispatcher=d,this._uniqueId="sbb-radio-button-"+ ++OX,this.id=this._uniqueId,this.change=new on,this._checked=!1,this._value=null,this._removeUniqueSelectionListener=()=>{},this.radioGroup=e,m&&(this.tabIndex=wh(m,0)),this._removeUniqueSelectionListener=d.listen((y,T)=>{y!==this.id&&T===this.name&&(this.checked=!1)})}get checked(){return this._checked}set checked(e){const i=ii(e);this._checked!==i&&(this._checked=i,i&&this.radioGroup&&this.radioGroup.value!==this.value?this.radioGroup.selected=this:!i&&this.radioGroup&&this.radioGroup.value===this.value&&(this.radioGroup.selected=null),i&&this._radioDispatcher.notify(this.id,this.name),this._changeDetector.markForCheck())}get value(){return this._value}set value(e){this._value!==e&&(this._value=e,null!==this.radioGroup&&(this.checked||(this.checked=this.radioGroup.value===e),this.checked&&(this.radioGroup.selected=this)))}get disabled(){return this._disabled||null!==this.radioGroup&&this.radioGroup.disabled}set disabled(e){this._setDisabled(ii(e))}get required(){return this._required||this.radioGroup&&this.radioGroup.required}set required(e){this._required=ii(e)}get inputId(){return`${this.id||this._uniqueId}-input`}focus(e,i){i?this._focusMonitor.focusVia(this._inputElement,i,e):this._inputElement.nativeElement.focus(e)}_markForCheck(){this._changeDetector.markForCheck()}ngOnInit(){this.radioGroup&&(this.checked=this.radioGroup.value===this._value,this.checked&&(this.radioGroup.selected=this),this.name=this.radioGroup.name)}ngDoCheck(){this._updateTabIndex()}ngAfterViewInit(){this._updateTabIndex(),this._focusMonitor.monitor(this._elementRef,!0).subscribe(e=>{!e&&this.radioGroup&&this.radioGroup._touch()})}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._removeUniqueSelectionListener()}_emitChangeEvent(){this.change.emit(new FF(this,this._value))}_onInputClick(e){e.stopPropagation()}_onInputChange(e){null==e||e.stopPropagation();const i=this.radioGroup&&this.value!==this.radioGroup.value;this.checked=!0,this._emitChangeEvent(),this.radioGroup&&(this.radioGroup._controlValueAccessorChangeFn(this.value),i&&this.radioGroup._emitChangeEvent())}_setDisabled(e){this._disabled!==e&&(this._disabled=e,this._changeDetector.markForCheck())}_updateTabIndex(){var e;const i=this.radioGroup;let r;if(r=i&&i.selected&&!this.disabled?i.selected===this?this.tabIndex:-1:this.tabIndex,r!==this._previousTabIndex){const s=null===(e=this._inputElement)||void 0===e?void 0:e.nativeElement;s&&(s.setAttribute("tabindex",r+""),this._previousTabIndex=r)}}}return n.\u0275fac=function(e){ru()},n.\u0275dir=Ft({type:n,viewQuery:function(e,i){if(1&e&&yr(DX,5),2&e){let r;Jn(r=ei())&&(i._inputElement=r.first)}},hostVars:1,hostBindings:function(e,i){2&e&&Sn("id",i.id)},inputs:{id:"id",name:"name",ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],ariaDescribedby:["aria-describedby","ariaDescribedby"],checked:"checked",value:"value",disabled:"disabled",required:"required"},outputs:{change:"change"},features:[Yt]}),n})(),BF=(()=>{class n extends LX{constructor(e,i,r,s,d,m){super(e,i,r,s,d,m)}}return n.\u0275fac=function(e){return new(e||n)(X(NF,8),X(zn),X(kr),X(Pa),X(PD),os("tabindex"))},n.\u0275cmp=On({type:n,selectors:[["sbb-radio-button"]],hostAttrs:[1,"sbb-radio-button","sbb-selection-item"],hostVars:9,hostBindings:function(e,i){1&e&&nn("focus",function(){return i._inputElement.nativeElement.focus()}),2&e&&(Sn("tabindex",null)("id",i.id)("aria-label",null)("aria-labelledby",null)("aria-describedby",null),Ui("sbb-selection-checked",i.checked)("sbb-selection-disabled",i.disabled))},inputs:{tabIndex:"tabIndex"},exportAs:["sbbRadioButton"],features:[ni([{provide:QD,useExisting:n}]),Yt],ngContentSelectors:IX,decls:9,vars:11,consts:[[1,"sbb-selection-item-label"],["type","radio",1,"sbb-selection-input","sbb-radio-input","sbb-transparent-parent-overlay",3,"id","checked","disabled","tabIndex","required","change","click"],["input",""],[1,"sbb-selection-container"],[1,"sbb-selection-container-checked"],[1,"sbb-selection-content"],[2,"display","none"]],template:function(e,i){1&e&&($o(),le(0,"label",0)(1,"input",1,2),nn("change",function(s){return i._onInputChange(s)})("click",function(s){return i._onInputClick(s)}),pe(),le(3,"div",3),bn(4,"div",4),pe(),le(5,"div",5)(6,"span",6),Ye(7,"\xa0"),pe(),$r(8),pe()()),2&e&&(Sn("for",i.inputId),Fe(1),rt("id",i.inputId)("checked",i.checked)("disabled",i.disabled)("tabIndex",i.tabIndex)("required",i.required),Sn("name",i.name)("value",i.value)("aria-label",i.ariaLabel)("aria-labelledby",i.ariaLabelledby)("aria-describedby",i.ariaDescribedby))},encapsulation:2,changeDetection:0}),n})(),eI=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({imports:[nr]}),n})();const FX=/[0-9]{3,4}/,NX=/([0-9]{1,2})[.:,\-;_hH]?([0-9]{1,2})?/,BX=/([0-9]{1,2})([0-9]{2})/;let VF=(()=>{class n{constructor(e,i,r,s,d){this._elementRef=e,this._renderer=i,this._control=r,this._input=d,this._document=s,this.placeholder="HH:MM"}get placeholder(){return this._placeholder}set placeholder(e){this._placeholder=null!=e?e:"HH:MM",this._input&&(this._input.placeholder=this._placeholder)}_onBlur(e){const i=this._validateInput(e);if(!i||i.length<=2)return;const r=this._parseHour(i[1]),s=this._parseMinute(i[2]);if(this._control&&this._control.control)this._control.control.setValue(`${r}:${s}`);else{this._renderer.setProperty(this._elementRef.nativeElement,"value",`${r}:${s}`);const d=this._document.createEvent("Event");d.initEvent("input",!0,!0),this._elementRef.nativeElement.dispatchEvent(d)}}_validateInput(e){return FX.test(e)?e.match(BX):e?e.match(NX):null}_parseHour(e){return e.length>1?e:"0"+e}_parseMinute(e){return(e=e||"00").length>1?e:"0"+e}}return n.\u0275fac=function(e){return new(e||n)(X(zn),X(xc),X(tc,10),X(ui),X(Yb,8))},n.\u0275dir=Ft({type:n,selectors:[["input","sbbTimeInput",""]],hostAttrs:["type","text","pattern","[0-9]*","inputmode","numeric",1,"sbb-time-input","sbb-input-element"],hostVars:1,hostBindings:function(e,i){1&e&&nn("blur",function(s){return i._onBlur(s.target.value)}),2&e&&Sn("placeholder",i.placeholder)},inputs:{placeholder:"placeholder"},exportAs:["sbbTimeInput"]}),n})(),jF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({imports:[nr]}),n})();function UF(n,t){return t?e=>ov(t.pipe(Qr(1),function zX(){return Cn((n,t)=>{n.subscribe(bt(t,Ze))})}()),e.pipe(UF(n))):Gn((e,i)=>n(e,i).pipe(Qr(1),sv(e)))}const jX=["panel"];function UX(n,t){if(1&n&&(le(0,"div",0,1),$r(2),pe()),2&n){const e=t.id,i=rn();rt("id",i.id)("ngClass",i._classList),Sn("aria-label",i.ariaLabel||null)("aria-labelledby",i._getPanelAriaLabelledby(e))}}const HX=["*"];let $X=0;class qX{constructor(t,e){this.source=t,this.option=e}}const HF=new Dt("sbb-autocomplete-default-options",{providedIn:"root",factory:function GX(){return{autoActiveFirstOption:!1,autoSelectActiveOption:!1}}});let $F=(()=>{class n{constructor(e,i,r,s){this._changeDetectorRef=e,this._elementRef=i,this._activeOptionChanges=he.EMPTY,this._visibleClass="sbb-autocomplete-visible",this._hiddenClass="sbb-autocomplete-hidden",this._showPanel=new _a(!1),this._isOpen=!1,this.displayWith=null,this.localeNormalizer=null,this.optionSelected=new on,this.opened=new on,this.closed=new on,this.optionActivated=new on,this._classList={},this._showHintIfNoOptions=!1,this.id="sbb-autocomplete-"+$X++,this.inertGroups=(null==s?void 0:s.SAFARI)||!1,this._autoActiveFirstOption=!!r.autoActiveFirstOption,this._autoSelectActiveOption=!!r.autoSelectActiveOption}get showPanel(){return this._showPanel.value}get isOpen(){return this._isOpen&&this.showPanel}get autoActiveFirstOption(){return this._autoActiveFirstOption}set autoActiveFirstOption(e){this._autoActiveFirstOption=ii(e)}get autoSelectActiveOption(){return this._autoSelectActiveOption}set autoSelectActiveOption(e){this._autoSelectActiveOption=ii(e)}set classList(e){this._classList=e&&e.length?JE(e).reduce((i,r)=>(i[r]=!0,i),{}):{},this._setVisibilityClasses(this._classList),this._elementRef.nativeElement.className=""}get showHintIfNoOptions(){return this._showHintIfNoOptions}set showHintIfNoOptions(e){this._showHintIfNoOptions=ii(e)}ngAfterContentInit(){this._keyManager=new ZL(this.options).withWrap(),this._activeOptionChanges=this._keyManager.change.subscribe(e=>{this.isOpen&&this.optionActivated.emit({source:this,option:this.options.toArray()[e]||null})}),this._setVisibility()}ngOnDestroy(){this._activeOptionChanges.unsubscribe()}_setScrollTop(e){this.panel&&(this.panel.nativeElement.scrollTop=e)}_getScrollTop(){return this.panel?this.panel.nativeElement.scrollTop:0}_setVisibility(){this._showPanel.next(!!this.options.length||!!this.hints.length&&this.showHintIfNoOptions),this._setVisibilityClasses(this._classList),this._changeDetectorRef.markForCheck()}_emitSelectEvent(e){const i=new qX(this,e);this.optionSelected.emit(i)}_getPanelAriaLabelledby(e){return this.ariaLabel?null:this.ariaLabelledby?(e?e+" ":"")+this.ariaLabelledby:e}_setVisibilityClasses(e){e[this._visibleClass]=this.showPanel,e[this._hiddenClass]=!this.showPanel}}return n.\u0275fac=function(e){return new(e||n)(X(kr),X(zn),X(HF),X(Is))},n.\u0275cmp=On({type:n,selectors:[["sbb-autocomplete"]],contentQueries:function(e,i,r){if(1&e&&(Kr(r,Ev,5),Kr(r,fD,5),Kr(r,DG,5)),2&e){let s;Jn(s=ei())&&(i.options=s),Jn(s=ei())&&(i.optionGroups=s),Jn(s=ei())&&(i.hints=s)}},viewQuery:function(e,i){if(1&e&&(yr(ho,7),yr(jX,5)),2&e){let r;Jn(r=ei())&&(i.template=r.first),Jn(r=ei())&&(i.panel=r.first)}},hostAttrs:[1,"sbb-autocomplete"],inputs:{ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],displayWith:"displayWith",localeNormalizer:"localeNormalizer",autoActiveFirstOption:"autoActiveFirstOption",autoSelectActiveOption:"autoSelectActiveOption",panelWidth:"panelWidth",classList:["class","classList"],showHintIfNoOptions:"showHintIfNoOptions"},outputs:{optionSelected:"optionSelected",opened:"opened",closed:"closed",optionActivated:"optionActivated"},exportAs:["sbbAutocomplete"],features:[ni([{provide:iS,useExisting:n}])],ngContentSelectors:HX,decls:1,vars:0,consts:[["role","listbox",1,"sbb-panel","sbb-panel-padded","sbb-autocomplete-panel","sbb-scrollbar",3,"id","ngClass"],["panel",""]],template:function(e,i){1&e&&($o(),Jt(0,UX,3,4,"ng-template"))},dependencies:[Tb],styles:[".sbb-autocomplete-visible{visibility:visible}.sbb-autocomplete-hidden{visibility:hidden;padding:0 !important}:where(html:not(.sbb-lean)) .sbb-autocomplete-panel .sbb-menu-group .sbb-menu-item{padding-left:calc(0.9333333333rem * var(--sbb-scaling-factor))}"],encapsulation:2,changeDetection:0}),n})();const qF=new Dt("sbb-autocomplete-scroll-strategy"),XX={provide:qF,deps:[es],useFactory:function WX(n){return()=>n.scrollStrategies.reposition()}};let TS=(()=>{class n{constructor(e,i,r,s,d,m,y,T,M,R){this._element=e,this._overlay=i,this._viewContainerRef=r,this._zone=s,this._changeDetectorRef=d,this._formField=y,this._document=T,this._viewportRuler=M,this._defaults=R,this._componentDestroyed=!1,this._autocompleteDisabled=!1,this._viewportSubscription=he.EMPTY,this._positionSubscription=he.EMPTY,this._highlightSubscription=he.EMPTY,this._connectedElementClassSubscription=he.EMPTY,this._inputValue=new _a(""),this._canOpenOnNextFocus=!0,this._closeKeyEventStream=new Wt,this._windowBlurHandler=()=>{this._canOpenOnNextFocus=this._document.activeElement!==this._element.nativeElement||this.panelOpen},this._onChange=()=>{},this._onTouched=()=>{},this.position="auto",this.autocompleteAttribute="off",this._aboveClass="sbb-autocomplete-panel-above",this._overlayAttached=!1,this.optionSelections=pm(()=>{const H=this.autocomplete?this.autocomplete.options:null;return H?H.changes.pipe(Hs(H),ya(()=>Or(...H.map(Z=>Z.onSelectionChange)))):this._zone.onStable.pipe(Qr(1),ya(()=>this.optionSelections))}),this._scrollStrategy=m}get autocomplete(){return this._autocomplete}set autocomplete(e){if(this._autocomplete=e,this._highlightSubscription.unsubscribe(),this._connectedElementClassSubscription.unsubscribe(),!e)return;const i=e.options?qn(null):this._zone.onStable.pipe(Qr(1));this._highlightSubscription=i.pipe(ya(()=>hm([this._inputValue,e.options.changes.pipe(Hs(e.options.toArray()))])),Rr(r=>!!r[1]&&!!r[1].length)).subscribe(([r,s])=>{s.forEach(d=>d._highlight(r,this.autocomplete.localeNormalizer))}),this._connectedElementClassSubscription=this.autocomplete._showPanel.pipe(Lp(),Rr(r=>!r)).subscribe(()=>{this._getConnectedElement().nativeElement.classList.remove("sbb-input-with-open-panel"),this._getConnectedElement().nativeElement.classList.remove("sbb-input-with-open-panel-above")})}get autocompleteDisabled(){return this._autocompleteDisabled}set autocompleteDisabled(e){this._autocompleteDisabled=ii(e)}ngAfterViewInit(){const e=this._getWindow();void 0!==e&&this._zone.runOutsideAngular(()=>e.addEventListener("blur",this._windowBlurHandler))}ngOnChanges(e){e.position&&this._positionStrategy&&(this._setStrategyPositions(this._positionStrategy),this.panelOpen&&this._overlayRef.updatePosition())}ngOnDestroy(){const e=this._getWindow();void 0!==e&&e.removeEventListener("blur",this._windowBlurHandler),this._viewportSubscription.unsubscribe(),this._positionSubscription.unsubscribe(),this._highlightSubscription.unsubscribe(),this._connectedElementClassSubscription.unsubscribe(),this._componentDestroyed=!0,this._destroyPanel(),this._closeKeyEventStream.complete()}get panelOpen(){return this._overlayAttached&&this.autocomplete.showPanel}openPanel(){this._attachOverlay()}closePanel(){!this._overlayAttached||(this.panelOpen&&this._zone.run(()=>{this.autocomplete.closed.emit()}),this.autocomplete._isOpen=this._overlayAttached=!1,this._pendingAutoselectedOption=null,this._overlayRef&&this._overlayRef.hasAttached()&&(this._overlayRef.detach(),this._closingActionsSubscription.unsubscribe()),this._getConnectedElement().nativeElement.classList.remove("sbb-input-with-open-panel"),this._getConnectedElement().nativeElement.classList.remove("sbb-input-with-open-panel-above"),this._componentDestroyed||this._changeDetectorRef.detectChanges())}updatePosition(){this._overlayAttached&&this._overlayRef.updatePosition()}get panelClosingActions(){return Or(this.optionSelections,this.autocomplete._keyManager.tabOut.pipe(Rr(()=>this._overlayAttached)),this._closeKeyEventStream,this._getOutsideClickStream(),this._overlayRef?this._overlayRef.detachments().pipe(Rr(()=>this._overlayAttached)):qn()).pipe($t(e=>e instanceof y2?e:null))}get activeOption(){return this.autocomplete&&this.autocomplete._keyManager?this.autocomplete._keyManager.activeItem:null}_getOutsideClickStream(){return Or(fu(this._document,"click"),fu(this._document,"auxclick"),fu(this._document,"touchend")).pipe(Rr(e=>{const i=Op(e),r=this._formField?this._formField._elementRef.nativeElement:null,s=this.connectedTo?this.connectedTo.elementRef.nativeElement:null;return this._overlayAttached&&i!==this._element.nativeElement&&this._document.activeElement!==this._element.nativeElement&&(!r||!r.contains(i))&&(!s||!s.contains(i))&&!!this._overlayRef&&!this._overlayRef.overlayElement.contains(i)}))}writeValue(e){Promise.resolve(null).then(()=>this._assignOptionValue(e))}registerOnChange(e){this._onChange=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this._element.nativeElement.disabled=e}_handleKeydown(e){const i=e.keyCode,r=xa(e);if(27===i&&!r&&e.preventDefault(),this.activeOption&&13===i&&this.panelOpen&&!r)this.activeOption._selectViaInteraction(),this._resetActiveItem(),e.preventDefault();else if(this.autocomplete){const s=this.autocomplete._keyManager.activeItem,d=38===i||40===i;9===i||d&&!r&&this.panelOpen?this.autocomplete._keyManager.onKeydown(e):d&&this._canOpen()&&this.openPanel(),(d||this.autocomplete._keyManager.activeItem!==s)&&(this._scrollToOption(this.autocomplete._keyManager.activeItemIndex||0),this.autocomplete.autoSelectActiveOption&&this.activeOption&&(this._pendingAutoselectedOption||(this._valueBeforeAutoSelection=this._element.nativeElement.value),this._pendingAutoselectedOption=this.activeOption,this._assignOptionValue(this.activeOption.value)))}}_handleInput(e){const i=e.target;let r=i.value;"number"===i.type&&(r=""===r?null:parseFloat(r)),this._previousValue!==r&&(this._previousValue=r,this._pendingAutoselectedOption=null,this._onChange(r),this._inputValue.next(i.value),this._canOpen()&&this._document.activeElement===e.target&&this.openPanel())}_handleFocus(){this._canOpenOnNextFocus?this._canOpen()&&(this._previousValue=this._element.nativeElement.value,this._attachOverlay()):this._canOpenOnNextFocus=!0}_handleClick(){this._canOpen()&&!this.panelOpen&&this.openPanel()}_updateSize(){var e;null===(e=this._overlayRef)||void 0===e||e.updateSize({width:this._getPanelWidth()})}_subscribeToClosingActions(){const e=this._zone.onStable.pipe(Qr(1)),i=this.autocomplete.options.changes.pipe(Jo(()=>this._positionStrategy.reapplyLastPosition()),function VX(n,t=Gw){const e=aD(n,t);return UF(()=>e)}(0));return Or(e,i).pipe(ya(()=>(this._zone.run(()=>{const r=this.panelOpen;if(this._resetActiveItem(),this.autocomplete._setVisibility(),this._changeDetectorRef.detectChanges(),this.panelOpen){const s=this.autocomplete.panel.nativeElement.scrollTop;this._overlayRef.updatePosition(),this.autocomplete.panel.nativeElement.scrollTop=s}r!==this.panelOpen&&(this.panelOpen?this.autocomplete.opened.emit():this.autocomplete.closed.emit())}),this.panelClosingActions)),Qr(1)).subscribe(r=>this._setValueAndClose(r))}_destroyPanel(){this._overlayRef&&(this.closePanel(),this._overlayRef.dispose(),this._overlayRef=null)}_assignOptionValue(e){const i=this.autocomplete&&this.autocomplete.displayWith?this.autocomplete.displayWith(e):e;this._updateNativeInputValue(null!=i?i:"")}_updateNativeInputValue(e){this._formField&&this._formField._control?this._formField._control.value=e:this._element.nativeElement.value=e,this._previousValue=e,this._inputValue.next(e)}_setValueAndClose(e){const i=e?e.source:this._pendingAutoselectedOption;i&&(this._clearPreviousSelectedOption(i),this._assignOptionValue(i.value),this._onChange(i.value),this.autocomplete._emitSelectEvent(i),this._element.nativeElement.focus()),this.closePanel()}_clearPreviousSelectedOption(e){this.autocomplete.options.forEach(i=>{i!==e&&i.selected&&i.deselect()})}_attachOverlay(){var e;let i=this._overlayRef;i?(this._positionStrategy.setOrigin(this._getConnectedElement()),i.updateSize({width:this._getPanelWidth()})):(this._portal=new Tm(this.autocomplete.template,this._viewContainerRef,{id:null===(e=this._formField)||void 0===e?void 0:e.getLabelId()}),i=this._overlay.create(this._getOverlayConfig()),this._overlayRef=i,this._positionStrategy&&(this._positionSubscription.unsubscribe(),this._positionSubscription=hm([this._positionStrategy.positionChanges,this.autocomplete._showPanel]).subscribe(([s,d])=>{this.autocomplete.panel&&d&&(this._getConnectedElement().nativeElement.classList.add("sbb-input-with-open-panel"),"top"===s.connectionPair.originY?(this.autocomplete.panel.nativeElement.classList.add("sbb-panel-above"),this._getConnectedElement().nativeElement.classList.add("sbb-input-with-open-panel-above")):(this.autocomplete.panel.nativeElement.classList.remove("sbb-panel-above"),this._getConnectedElement().nativeElement.classList.remove("sbb-input-with-open-panel-above")))})),this._handleOverlayEvents(i),this._viewportSubscription=this._viewportRuler.change().subscribe(()=>{this.panelOpen&&i&&i.updateSize({width:this._getPanelWidth()})})),i&&!i.hasAttached()&&(i.attach(this._portal),this._closingActionsSubscription=this._subscribeToClosingActions());const r=this.panelOpen;this.autocomplete._setVisibility(),this.autocomplete._isOpen=this._overlayAttached=!0,this.panelOpen&&r!==this.panelOpen&&this.autocomplete.opened.emit()}_getOverlayConfig(){var e;return new km({positionStrategy:this._getOverlayPosition(),scrollStrategy:this._scrollStrategy(),width:this._getPanelWidth(),panelClass:JE(null===(e=this._defaults)||void 0===e?void 0:e.overlayPanelClass).concat("sbb-overlay-panel"),minHeight:0})}_getOverlayPosition(){const e=this._overlay.position().flexibleConnectedTo(this._getConnectedElement()).withFlexibleDimensions(!0).withPush(!1);return this._setStrategyPositions(e),this._positionStrategy=e,e}_setStrategyPositions(e){const i=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"}],r=this._aboveClass,s=[{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom",panelClass:r},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom",panelClass:r}];let d;d="above"===this.position?s:"below"===this.position?i:[...i,...s],e.withPositions(d)}_getConnectedElement(){return this.connectedTo?this.connectedTo.elementRef:this._formField?this._formField.getConnectedOverlayOrigin():this._element}_getPanelWidth(){return this.autocomplete.panelWidth||this._getHostWidth()}_getHostWidth(){return this._getConnectedElement().nativeElement.getBoundingClientRect().width}_resetActiveItem(){const e=this.autocomplete;e.autoActiveFirstOption?e._keyManager.setFirstItemActive():e._keyManager.setActiveItem(-1)}_canOpen(){const e=this._element.nativeElement;return!e.readOnly&&!e.disabled&&!this.autocompleteDisabled}_getWindow(){var e;return(null===(e=this._document)||void 0===e?void 0:e.defaultView)||window}_scrollToOption(e){const i=this.autocomplete,r=function TG(n,t,e){if(e.length){const i=t.toArray(),r=e.toArray();let s=0;for(let d=0;d<n+1;d++)i[d].group&&i[d].group===r[s]&&s++;return s}return 0}(e,i.options,i.optionGroups);if(0===e&&1===r)i._setScrollTop(0);else if(i.panel){const s=i.options.toArray()[e];if(s){const d=s._getHostElement(),m=v2(d.offsetTop,d.offsetHeight,i._getScrollTop(),i.panel.nativeElement.offsetHeight);i._setScrollTop(m)}}}_handleOverlayEvents(e){e.keydownEvents().subscribe(i=>{var r;(27===i.keyCode&&!xa(i)||38===i.keyCode&&xa(i,"altKey"))&&(this._pendingAutoselectedOption&&(this._updateNativeInputValue(null!==(r=this._valueBeforeAutoSelection)&&void 0!==r?r:""),this._pendingAutoselectedOption=null),this._closeKeyEventStream.next(),this._resetActiveItem(),i.stopPropagation(),i.preventDefault())}),e.outsidePointerEvents().subscribe()}}return n.\u0275fac=function(e){return new(e||n)(X(zn),X(es),X(Qo),X(di),X(kr),X(qF),X(xS,9),X(ui,8),X(mu),X(HF,8))},n.\u0275dir=Ft({type:n,selectors:[["input","sbbAutocomplete",""]],hostAttrs:[1,"sbb-autocomplete-trigger"],hostVars:9,hostBindings:function(e,i){1&e&&nn("focusin",function(){return i._handleFocus()})("blur",function(){return i._onTouched()})("input",function(s){return i._handleInput(s)})("keydown",function(s){return i._handleKeydown(s)})("click",function(){return i._handleClick()}),2&e&&(Sn("autocomplete",i.autocompleteAttribute)("role",i.autocompleteDisabled?null:"combobox")("aria-autocomplete",i.autocompleteDisabled?null:"list")("aria-activedescendant",i.panelOpen&&i.activeOption?i.activeOption.id:null)("aria-expanded",i.autocompleteDisabled?null:i.panelOpen.toString())("aria-owns",i.autocompleteDisabled||!i.panelOpen||null==i.autocomplete?null:i.autocomplete.id)("aria-haspopup",i.autocompleteDisabled?null:"listbox"),Ui("sbb-focused",i.panelOpen))},inputs:{autocomplete:["sbbAutocomplete","autocomplete"],position:["sbbAutocompletePosition","position"],connectedTo:["sbbAutocompleteConnectedTo","connectedTo"],autocompleteAttribute:["autocomplete","autocompleteAttribute"],autocompleteDisabled:["sbbAutocompleteDisabled","autocompleteDisabled"]},exportAs:["sbbAutocompleteTrigger"],features:[ni([{provide:nl,useExisting:$i(()=>n),multi:!0}]),_r]}),n})(),GF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({providers:[XX],imports:[Tr,Cm,Ml,nr,rS,rS,Ml]}),n})();function ZX(n,t){if(1&n&&(le(0,"sbb-option",11),Ye(1),pe()),2&n){const e=t.$implicit,i=t.index;rt("value",rn(2).$implicit[0]+"."+i),Fe(1),Vr(" ",e.computeLocationName()," ")}}function YX(n,t){if(1&n&&(le(0,"sbb-optgroup",9),Jt(1,ZX,2,2,"sbb-option",10),pe()),2&n){const e=rn().$implicit,i=rn();rt("label",e[1]),Fe(1),rt("ngForOf",i.mapLookupLocations[e[0]])}}function KX(n,t){if(1&n&&(Yl(0),Jt(1,YX,2,2,"sbb-optgroup",8),Kl()),2&n){const e=t.$implicit,i=rn();Fe(1),rt("ngIf",i.mapLookupLocations[e[0]].length>0)}}class QX{isErrorState(t,e){return!!(t&&t.invalid&&(t.dirty||t.touched||e&&e.submitted))}}let JX=(()=>{class n{constructor(e,i){this.mapService=e,this.userTripService=i,this.shouldFetchNewData=!0,this.inputControl=new _w("",[WT.required]),this.inputControlMatcher=new QX,this.placeholder="",this.endpointType="From",this.inputValue="",this.selectedLocation=new on,this.mapLookupLocations={},this.resetMapLocations(),this.optionLocationTypes=[["stop","Stops"],["poi","POIs"],["topographicPlace","Topographic Places"],["address","Addresses"]]}ngOnInit(){this.inputControl.valueChanges.pipe(Sv(500),Lp()).subscribe(e=>{if(null===e||!this.shouldFetchNewData)return;if(0===e.trim().length)return void this.selectedLocation.emit(null);if(e.length<2)return;const i=fs.initFromLiteralCoords(e);if(i)return this.resetMapLocations(),void this.handleCoordsPick(i);this.fetchJourneyPoints(e)})}ngOnChanges(e){if("inputValue"in e){const i=e.inputValue.currentValue;if(""===i)return;this.inputControl.setValue(i,{emitEvent:!1})}}onOpenAutocomplete(){this.shouldFetchNewData=!0}onOptionSelected(e){this.shouldFetchNewData=!1;const i=e.option.value.split(".");if(2!==i.length)return;const r=i[0],s=parseInt(i[1],10),d=this.mapLookupLocations[r][s],m=d.computeLocationName();this.inputControl.setValue(m),this.selectedLocation.emit(d)}fetchJourneyPoints(e){let i=this.userTripService.getStageConfig();gu.initWithLocationName(i,e).fetchResponse().then(s=>{this.resetMapLocations(),s.forEach(d=>{const m=d.getLocationType();null!==m&&this.mapLookupLocations[m].push(d)})})}handleTapOnMapButton(){var e;const i="From"===this.endpointType?this.userTripService.fromTripLocation:this.userTripService.toTripLocation,r=null!==(e=null==i?void 0:i.location)&&void 0!==e?e:null;this.mapService.tryToCenterAndZoomToLocation(r)}handleCoordsPick(e){const i=e.geoPosition;if(null===i)return;const r=i.asLatLngString(!1);this.inputControl.setValue(r),this.selectedLocation.emit(e)}resetMapLocations(){this.mapLookupLocations={address:[],poi:[],stop:[],topographicPlace:[]}}}return n.\u0275fac=function(e){return new(e||n)(X(Up),X(Nc))},n.\u0275cmp=On({type:n,selectors:[["journey-point-input"]],inputs:{placeholder:"placeholder",endpointType:"endpointType",inputValue:"inputValue"},outputs:{selectedLocation:"selectedLocation"},features:[_r],decls:11,vars:5,consts:[[1,"w-100","trip-endpoint"],[1,"endpoint-label",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","12","height","12","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-map"],["fill-rule","evenodd","d","M15.817.113A.5.5 0 0 1 16 .5v14a.5.5 0 0 1-.402.49l-5 1a.502.502 0 0 1-.196 0L5.5 15.01l-4.902.98A.5.5 0 0 1 0 15.5v-14a.5.5 0 0 1 .402-.49l5-1a.5.5 0 0 1 .196 0L10.5.99l4.902-.98a.5.5 0 0 1 .415.103zM10 1.91l-4-.8v12.98l4 .8V1.91zm1 12.98 4-.8V1.11l-4 .8v12.98zm-6-.8V1.11l-4 .8v12.98l4-.8z"],["sbbInput","","type","text",1,"trip-endpoint",3,"placeholder","formControl","sbbAutocomplete"],[3,"optionSelected","opened"],["journeyPoint","sbbAutocomplete"],[4,"ngFor","ngForOf"],[3,"label",4,"ngIf"],[3,"label"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(e,i){if(1&e&&(le(0,"sbb-form-field",0)(1,"div",1),nn("click",function(){return i.handleTapOnMapButton()}),B(),le(2,"svg",2),bn(3,"path",3),pe(),Ye(4),pe(),Q(),bn(5,"input",4),le(6,"sbb-error"),Ye(7,"Mandatory field, please complete."),pe()(),le(8,"sbb-autocomplete",5,6),nn("optionSelected",function(s){return i.onOptionSelected(s)})("opened",function(){return i.onOpenAutocomplete()}),Jt(10,KX,2,1,"ng-container",7),pe()),2&e){const r=Zl(9);Fe(4),Vr(" ",i.placeholder," "),Fe(1),rt("placeholder",i.placeholder)("formControl",i.inputControl)("sbbAutocomplete",r),Fe(5),rt("ngForOf",i.optionLocationTypes)}},dependencies:[Rc,js,ld,gh,yw,Ev,fD,$F,TS,Nv,nX,Yb],styles:[".endpoint-label[_ngcontent-%COMP%]{font-size:12px}.endpoint-label[_ngcontent-%COMP%]:hover{cursor:pointer}"]}),n})();const eZ=["panel"];function tZ(n,t){if(1&n&&(le(0,"span",7),Ye(1),pe()),2&n){const e=rn();Fe(1),Pi(e.readonly?"-":e.placeholder||"\xa0")}}function nZ(n,t){if(1&n&&(le(0,"span",8)(1,"span"),Ye(2),pe()()),2&n){const e=rn();Fe(2),Pi(e.triggerValue||"\xa0")}}function iZ(n,t){1&n&&bn(0,"sbb-icon",9)}function rZ(n,t){1&n&&bn(0,"sbb-icon",10)}function oZ(n,t){if(1&n){const e=Ho();le(0,"div",11,12),nn("@transformPanel.done",function(r){return Vi(e),Gi(rn()._panelDoneAnimatingStream.next(r.toState))})("keydown",function(r){return Vi(e),Gi(rn()._handleKeydown(r))}),$r(2),pe()}if(2&n){const e=rn();ed("transform-origin",e._transformOrigin)("font-size",e._triggerFontSize,"px"),Ui("sbb-select-multiple",e.multiple),rt("ngClass",e.panelClass)("@transformPanel",e.multiple?"showing-multiple":"showing"),Sn("id",e.id+"-panel")("aria-multiselectable",e.multiple)("aria-label",e.ariaLabel||null)("aria-labelledby",e._getPanelAriaLabelledby())}}const sZ=["*"],aZ={transformPanel:Us("transformPanel",[vr("void",Yn({opacity:0})),vr("showing",Yn({opacity:1})),vr("showing-multiple",Yn({opacity:1})),tr("void => *",ar("120ms cubic-bezier(0, 0, 0.2, 1)")),tr("* => void",ar("100ms 25ms linear",Yn({opacity:0})))])};let WF=0;const XF=new Dt("sbb-select-scroll-strategy"),cZ=new Dt("SBB_SELECT_CONFIG"),uZ={provide:XF,deps:[es],useFactory:function lZ(n){return()=>n.scrollStrategies.reposition()}};class dZ{constructor(t,e){this.source=t,this.value=e}}const hZ=$b(rl(tS(Dm(class{constructor(n,t,e,i){this._defaultErrorStateMatcher=n,this._parentForm=t,this._parentFormGroup=e,this.ngControl=i,this.stateChanges=new Wt}}))));let pZ=(()=>{class n extends hZ{constructor(e,i,r,s,d,m,y,T,M,R,H,Z,te){var xe;super(s,m,y,M),this._viewportRuler=e,this._changeDetectorRef=i,this._ngZone=r,this._elementRef=d,this._parentFormField=T,this.ngControl=M,this._liveAnnouncer=Z,this._defaultOptions=te,this._scrollTop=0,this._triggerFontSize=0,this._transformOrigin="top",this._offsetY=0,this._positions=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom"}],this._panelOpen=!1,this._compareWith=(Ce,et)=>Ce===et,this._uid="sbb-select-"+WF++,this._triggerAriaLabelledBy=null,this._destroy=new Wt,this._onChange=()=>{},this._onTouched=()=>{},this._valueId="sbb-select-value-"+WF++,this._panelDoneAnimatingStream=new Wt,this._overlayPanelClass=(null===(xe=this._defaultOptions)||void 0===xe?void 0:xe.overlayPanelClass)||"sbb-overlay-panel",this._focused=!1,this.controlType="sbb-select",this._multiple=!1,this._readonly=!1,this.ariaLabel="",this.optionSelectionChanges=pm(()=>{const Ce=this.options;return Ce?Ce.changes.pipe(Hs(Ce),ya(()=>Or(...Ce.map(et=>et.onSelectionChange)))):this._ngZone.onStable.pipe(Qr(1),ya(()=>this.optionSelectionChanges))}),this.openedChange=new on,this._openedStream=this.openedChange.pipe(Rr(Ce=>Ce),$t(()=>{})),this._closedStream=this.openedChange.pipe(Rr(Ce=>!Ce),$t(()=>{})),this.selectionChange=new on,this.valueChange=new on,this.ngControl&&(this.ngControl.valueAccessor=this),null!=(null==te?void 0:te.typeaheadDebounceInterval)&&(this._typeaheadDebounceInterval=te.typeaheadDebounceInterval),this._scrollStrategyFactory=H,this._scrollStrategy=this._scrollStrategyFactory(),this.tabIndex=parseInt(R,10)||0,this.id=this.id,this._overlayOrigin=new K2(d)}get focused(){return this._focused||this._panelOpen}get placeholder(){return this._placeholder}set placeholder(e){this._placeholder=e,this.stateChanges.next()}get required(){var e,i,r,s;return null!==(s=null!==(e=this._required)&&void 0!==e?e:null===(r=null===(i=this.ngControl)||void 0===i?void 0:i.control)||void 0===r?void 0:r.hasValidator(WT.required))&&void 0!==s&&s}set required(e){this._required=ii(e),this.stateChanges.next()}get multiple(){return this._multiple}set multiple(e){this._multiple=ii(e)}get readonly(){return this._readonly}set readonly(e){this._readonly=ii(e),this.stateChanges.next()}get compareWith(){return this._compareWith}set compareWith(e){this._compareWith=e,this._selectionModel&&this._initializeSelection()}get value(){return this._value}set value(e){this._assignValue(e)&&this._onChange(e)}get typeaheadDebounceInterval(){return this._typeaheadDebounceInterval}set typeaheadDebounceInterval(e){this._typeaheadDebounceInterval=wh(e)}get id(){return this._id}set id(e){this._id=e||this._uid,this.stateChanges.next()}ngOnInit(){this._selectionModel=new dW(this.multiple),this.stateChanges.next(),this._panelDoneAnimatingStream.pipe(Lp(),Hi(this._destroy)).subscribe(()=>this._panelDoneAnimating(this.panelOpen)),this._viewportRuler.change().pipe(Hi(this._destroy)).subscribe(()=>{this.panelOpen&&(this._triggerRect=this._elementRef.nativeElement.getBoundingClientRect(),this._changeDetectorRef.markForCheck())})}ngAfterContentInit(){this._initKeyManager(),this._selectionModel.changed.pipe(Hi(this._destroy)).subscribe(e=>{e.added.forEach(i=>i.select()),e.removed.forEach(i=>i.deselect())}),this.options.changes.pipe(Hs(null),Hi(this._destroy)).subscribe(()=>{this._resetOptions(),this._initializeSelection()})}ngDoCheck(){const e=this._getTriggerAriaLabelledby(),i=this.ngControl;if(e!==this._triggerAriaLabelledBy){const r=this._elementRef.nativeElement;this._triggerAriaLabelledBy=e,e?r.setAttribute("aria-labelledby",e):r.removeAttribute("aria-labelledby")}this.ngControl&&(this._previousControl!==i.control&&(void 0!==this._previousControl&&null!==i.disabled&&i.disabled!==this.disabled&&(this.disabled=i.disabled),this._previousControl=i.control),this.updateErrorState())}ngOnChanges(e){(e.disabled||e.userAriaDescribedBy)&&this.stateChanges.next(),e.typeaheadDebounceInterval&&this._keyManager&&this._keyManager.withTypeAhead(this._typeaheadDebounceInterval)}ngOnDestroy(){this._destroy.next(),this._destroy.complete(),this.stateChanges.complete()}toggle(){this.panelOpen?this.close():this.open()}open(){this._canOpen()&&(this._panelOpen=!0,this._keyManager.withHorizontalOrientation(null),this._highlightCorrectOption(),this._changeDetectorRef.markForCheck(),this._triggerRect=this._elementRef.nativeElement.getBoundingClientRect(),this._triggerFontSize=parseInt(getComputedStyle(this._elementRef.nativeElement).fontSize||"0",10),this._ngZone.onStable.pipe(Qr(1)).subscribe(()=>{this._triggerFontSize&&this.overlayDir.overlayRef&&this.overlayDir.overlayRef.overlayElement&&(this.overlayDir.overlayRef.overlayElement.style.fontSize=`${this._triggerFontSize}px`),this._calculateOverlayPosition()}))}close(){this._panelOpen&&(this._panelOpen=!1,this._keyManager.withHorizontalOrientation("ltr"),this._changeDetectorRef.markForCheck(),this._onTouched())}writeValue(e){this._assignValue(e)}registerOnChange(e){this._onChange=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this.disabled=e,this._changeDetectorRef.markForCheck(),this.stateChanges.next()}get panelOpen(){return this._panelOpen}get selected(){var e,i;return this.multiple?(null===(e=this._selectionModel)||void 0===e?void 0:e.selected)||[]:null===(i=this._selectionModel)||void 0===i?void 0:i.selected[0]}get triggerValue(){return this.empty?"":this._multiple?this._selectionModel.selected.map(i=>i.viewValue).join(", "):this._selectionModel.selected[0].viewValue}_handleKeydown(e){this.disabled||(this.panelOpen?this._handleOpenKeydown(e):this._handleClosedKeydown(e))}_handleClosedKeydown(e){const i=e.keyCode,r=40===i||38===i||37===i||39===i,s=13===i||32===i,d=this._keyManager;if(!d.isTyping()&&s&&!xa(e)||(this.multiple||e.altKey)&&r)e.preventDefault(),this.open();else if(!this.multiple){const m=this.selected;d.onKeydown(e);const y=this.selected;y&&m!==y&&this._liveAnnouncer.announce(y.viewValue,1e4)}}_handleOpenKeydown(e){const i=this._keyManager,r=e.keyCode,s=40===r||38===r,d=i.isTyping();if(s&&e.altKey)e.preventDefault(),this.close();else if(d||13!==r&&32!==r||!i.activeItem||xa(e))if(!d&&this._multiple&&65===r&&e.ctrlKey){e.preventDefault();const m=this.options.some(y=>!y.disabled&&!y.selected);this.options.forEach(y=>{y.disabled||(m?y.select():y.deselect())})}else{const m=i.activeItemIndex;i.onKeydown(e),this._multiple&&s&&e.shiftKey&&i.activeItem&&i.activeItemIndex!==m&&i.activeItem._selectViaInteraction()}else e.preventDefault(),i.activeItem._selectViaInteraction()}_onFocus(){this.disabled||(this._focused=!0,this.stateChanges.next())}_onBlur(){this._focused=!1,!this.disabled&&!this.panelOpen&&(this._onTouched(),this._changeDetectorRef.markForCheck(),this.stateChanges.next())}_onAttached(){this.overlayDir.positionChange.pipe(Qr(1)).subscribe(e=>{"top"===e.connectionPair.originY?(this.panel.nativeElement.classList.add("sbb-panel-above"),this._elementRef.nativeElement.classList.add("sbb-input-with-open-panel-above")):(this.panel.nativeElement.classList.remove("sbb-panel-above"),this._elementRef.nativeElement.classList.remove("sbb-input-with-open-panel-above")),this._changeDetectorRef.detectChanges(),this._positioningSettled()})}get empty(){return!this._selectionModel||this._selectionModel.isEmpty()}_initializeSelection(){Promise.resolve().then(()=>{this.ngControl&&(this._value=this.ngControl.value),this._setSelectionByValue(this._value),this.stateChanges.next()})}_setSelectionByValue(e){if(this._selectionModel.selected.forEach(i=>i.setInactiveStyles()),this._selectionModel.clear(),this.multiple&&e)Array.isArray(e),e.forEach(i=>this._selectOptionByValue(i)),this._sortValues();else{const i=this._selectOptionByValue(e);i?this._keyManager.updateActiveItem(i):this.panelOpen||this._keyManager.updateActiveItem(-1)}this._changeDetectorRef.markForCheck()}_selectOptionByValue(e){const i=this.options.find(r=>{if(this._selectionModel.isSelected(r))return!1;try{return null!=r.value&&this._compareWith(r.value,e)}catch(s){return!1}});return i&&this._selectionModel.select(i),i}_assignValue(e){return!!(e!==this._value||this._multiple&&Array.isArray(e))&&(this.options&&this._setSelectionByValue(e),this._value=e,!0)}_initKeyManager(){this._keyManager=new ZL(this.options).withTypeAhead(this._typeaheadDebounceInterval).withVerticalOrientation().withHorizontalOrientation("ltr").withHomeAndEnd().withAllowedModifierKeys(["shiftKey"]),this._keyManager.tabOut.pipe(Hi(this._destroy)).subscribe(()=>{this.panelOpen&&(!this.multiple&&this._keyManager.activeItem&&this._keyManager.activeItem._selectViaInteraction(),this.focus(),this.close())}),this._keyManager.change.pipe(Hi(this._destroy)).subscribe(()=>{this._panelOpen&&this.panel?this._scrollOptionIntoView(this._keyManager.activeItemIndex||0):!this._panelOpen&&!this.multiple&&this._keyManager.activeItem&&this._keyManager.activeItem._selectViaInteraction()})}_resetOptions(){const e=Or(this.options.changes,this._destroy);this.optionSelectionChanges.pipe(Hi(e)).subscribe(i=>{this._onSelect(i.source,i.isUserInput),i.isUserInput&&!this.multiple&&this._panelOpen&&(this.close(),this.focus())}),Or(...this.options.map(i=>i._stateChanges)).pipe(Hi(e)).subscribe(()=>{this._changeDetectorRef.markForCheck(),this.stateChanges.next()})}_onSelect(e,i){const r=this._selectionModel.isSelected(e);null!=e.value||this._multiple?(r!==e.selected&&(e.selected?this._selectionModel.select(e):this._selectionModel.deselect(e)),i&&this._keyManager.setActiveItem(e),this.multiple&&(this._sortValues(),i&&this.focus())):(e.deselect(),this._selectionModel.clear(),null!=this.value&&this._propagateChanges(e.value)),r!==this._selectionModel.isSelected(e)&&this._propagateChanges(),this.stateChanges.next()}_sortValues(){if(this.multiple){const e=this.options.toArray();this._selectionModel.sort((i,r)=>this.sortComparator?this.sortComparator(i,r,e):e.indexOf(i)-e.indexOf(r)),this.stateChanges.next()}}_propagateChanges(e){let i=null;i=this.multiple?this.selected.map(r=>r.value):this.selected?this.selected.value:e,this._value=i,this.valueChange.emit(i),this._onChange(i),this.selectionChange.emit(new dZ(this,i)),this._changeDetectorRef.markForCheck()}_highlightCorrectOption(){this._keyManager&&(this.empty?this._keyManager.setFirstItemActive():this._keyManager.setActiveItem(this._selectionModel.selected[0]))}_canOpen(){var e;return!this._panelOpen&&!this.disabled&&(null===(e=this.options)||void 0===e?void 0:e.length)>0&&!this.readonly}focus(e){this._elementRef.nativeElement.focus(e)}_getPanelAriaLabelledby(){var e;if(this.ariaLabel)return null;const i=null===(e=this._parentFormField)||void 0===e?void 0:e.getLabelId();return this.ariaLabelledby?(i?i+" ":"")+this.ariaLabelledby:i}_getAriaActiveDescendant(){return this.panelOpen&&this._keyManager&&this._keyManager.activeItem?this._keyManager.activeItem.id:null}_getTriggerAriaLabelledby(){var e;if(this.ariaLabel)return null;const i=null===(e=this._parentFormField)||void 0===e?void 0:e.getLabelId();let r=(i?i+" ":"")+this._valueId;return this.ariaLabelledby&&(r+=" "+this.ariaLabelledby),r}_panelDoneAnimating(e){this.panelOpen?this._scrollTop=0:(this.overlayDir.offsetX=0,this._changeDetectorRef.markForCheck()),e||this._elementRef.nativeElement.classList.remove("sbb-input-with-open-panel-above"),this.openedChange.emit(e)}_getOverlayMinWidth(){var e;return null===(e=this._triggerRect)||void 0===e?void 0:e.width}setDescribedByIds(e){e.length?this._elementRef.nativeElement.setAttribute("aria-describedby",e.join(" ")):this._elementRef.nativeElement.removeAttribute("aria-describedby")}onContainerClick(){this.focus(),this.open()}_calculateOverlayScroll(e,i,r){const s=e._getHostElement().offsetHeight,d=e._getHostElement().offsetTop;return Math.min(Math.max(0,d-i+s/2),r)}_scrollOptionIntoView(e){if(0===e)this.panel.nativeElement.scrollTop=0;else{const i=this.options.toArray()[e];if(i){const r=i._getHostElement();this.panel.nativeElement.scrollTop=v2(r.offsetTop,r.offsetHeight,this.panel.nativeElement.scrollTop,this.panel.nativeElement.offsetHeight)}}}_positioningSettled(){this.panel.nativeElement.scrollTop=this._scrollTop}_calculateOverlayPosition(){if(!this.panel)return;const e=this.panel.nativeElement.clientHeight,r=this.panel.nativeElement.scrollHeight-e,s=this._selectionModel.selected[0];this._scrollTop=this.empty||-1===this.options.toArray().indexOf(s)?0:this._calculateOverlayScroll(s,e/2,r)}}return n.\u0275fac=function(e){return new(e||n)(X(mu),X(kr),X(di),X(pD),X(zn),X(Mb,8),X(Ab,8),X(xS,8),X(tc,10),os("tabindex"),X(XF),X(t2),X(cZ,8))},n.\u0275cmp=On({type:n,selectors:[["sbb-select"]],contentQueries:function(e,i,r){if(1&e&&(Kr(r,Ev,5),Kr(r,fD,5)),2&e){let s;Jn(s=ei())&&(i.options=s),Jn(s=ei())&&(i.optionGroups=s)}},viewQuery:function(e,i){if(1&e&&(yr(eZ,5),yr(Q2,5)),2&e){let r;Jn(r=ei())&&(i.panel=r.first),Jn(r=ei())&&(i.overlayDir=r.first)}},hostAttrs:["role","combobox","aria-autocomplete","none","aria-haspopup","true",1,"sbb-select","sbb-input-element"],hostVars:26,hostBindings:function(e,i){1&e&&nn("click",function(){return i.toggle()})("keydown",function(s){return i._handleKeydown(s)})("focus",function(){return i._onFocus()})("blur",function(){return i._onBlur()}),2&e&&(Sn("id",i.id)("tabindex",i.readonly?-1:i.tabIndex)("aria-controls",i.panelOpen?i.id+"-panel":null)("aria-owns",i.panelOpen?i.id+"-panel":null)("aria-expanded",i.panelOpen)("aria-label",i.ariaLabel||null)("aria-required",i.required.toString())("aria-disabled",i.disabled.toString())("aria-invalid",i.errorState)("aria-activedescendant",i._getAriaActiveDescendant()),Ui("sbb-disabled",i.disabled)("sbb-select-invalid",i.errorState)("sbb-select-required",i.required)("sbb-select-empty",i.empty)("sbb-select-multiple",i.multiple)("sbb-readonly",i.readonly)("sbb-focused",i.focused)("sbb-input-with-open-panel",i.panelOpen))},inputs:{disabled:"disabled",tabIndex:"tabIndex",userAriaDescribedBy:["aria-describedby","userAriaDescribedBy"],panelClass:"panelClass",placeholder:"placeholder",required:"required",multiple:"multiple",readonly:"readonly",compareWith:"compareWith",value:"value",ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],errorStateMatcher:"errorStateMatcher",typeaheadDebounceInterval:"typeaheadDebounceInterval",sortComparator:"sortComparator",id:"id"},outputs:{openedChange:"openedChange",_openedStream:"opened",_closedStream:"closed",selectionChange:"selectionChange",valueChange:"valueChange"},exportAs:["sbbSelect"],features:[ni([{provide:Fv,useExisting:n},{provide:iS,useExisting:n}]),Yt,_r],ngContentSelectors:sZ,decls:8,vars:20,consts:[["aria-hidden","true",1,"sbb-select-value",3,"ngSwitch"],["class","sbb-select-placeholder",4,"ngSwitchCase"],["class","sbb-select-value-text",4,"ngSwitchCase"],[3,"ngSwitch"],["class","sbb-icon-scaled sbb-select-arrow-icon","svgIcon","kom:chevron-small-down-small",4,"ngSwitchCase"],["class","sbb-icon-scaled sbb-select-arrow-icon sbb-select-arrow-icon-lean","svgIcon","kom:chevron-right-small",4,"ngSwitchCase"],["cdk-connected-overlay","","cdkConnectedOverlayLockPosition","","cdkConnectedOverlayFlexibleDimensions","","cdkConnectedOverlayHasBackdrop","","cdkConnectedOverlayBackdropClass","cdk-overlay-transparent-backdrop",3,"cdkConnectedOverlayPanelClass","cdkConnectedOverlayScrollStrategy","cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayPositions","cdkConnectedOverlayWidth","cdkConnectedOverlayOffsetX","cdkConnectedOverlayOffsetY","cdkConnectedOverlayMinHeight","backdropClick","attach","detach"],[1,"sbb-select-placeholder"],[1,"sbb-select-value-text"],["svgIcon","kom:chevron-small-down-small",1,"sbb-icon-scaled","sbb-select-arrow-icon"],["svgIcon","kom:chevron-right-small",1,"sbb-icon-scaled","sbb-select-arrow-icon","sbb-select-arrow-icon-lean"],["role","listbox","tabindex","-1",1,"sbb-panel","sbb-panel-padded","sbb-select-panel","sbb-scrollbar",3,"ngClass","keydown"],["panel",""]],template:function(e,i){1&e&&($o(),le(0,"div",0),Jt(1,tZ,2,1,"span",1),Jt(2,nZ,3,1,"span",2),pe(),Yl(3,3),yb(4,"async"),Jt(5,iZ,1,0,"sbb-icon",4),Jt(6,rZ,1,0,"sbb-icon",5),Kl(),Jt(7,oZ,3,12,"ng-template",6),nn("backdropClick",function(){return i.close()})("attach",function(){return i._onAttached()})("detach",function(){return i.close()})),2&e&&(Ui("sbb-select-value-empty",i.empty),rt("ngSwitch",i.empty),Sn("id",i._valueId),Fe(1),rt("ngSwitchCase",!0),Fe(1),rt("ngSwitchCase",!1),Fe(1),rt("ngSwitch",vb(4,18,i.variant)),Fe(2),rt("ngSwitchCase","standard"),Fe(1),rt("ngSwitchCase","lean"),Fe(1),rt("cdkConnectedOverlayPanelClass",i._overlayPanelClass)("cdkConnectedOverlayScrollStrategy",i._scrollStrategy)("cdkConnectedOverlayOrigin",i._overlayOrigin)("cdkConnectedOverlayOpen",i.panelOpen)("cdkConnectedOverlayPositions",i._positions)("cdkConnectedOverlayWidth",i._getOverlayMinWidth())("cdkConnectedOverlayOffsetX",0)("cdkConnectedOverlayOffsetY",i._offsetY)("cdkConnectedOverlayMinHeight",30))},dependencies:[Tb,Eb,Nx,Q2,ol,$y],styles:[".sbb-select{display:inline-block;cursor:pointer;position:relative;text-align:left;padding-right:calc(2.9333333333rem * var(--sbb-scaling-factor))}:where(html.sbb-lean) .sbb-select{padding-right:2.5333333333rem}.sbb-select:is([readonly],.sbb-readonly){cursor:default}.sbb-form-field .sbb-select,.sbb-table th.sbb-header-cell.sbb-table-filter .sbb-select{display:block}.sbb-select-value{overflow:hidden;text-overflow:ellipsis}:where(html.sbb-lean) .sbb-select-value-empty{color:var(--sbb-color-storm)}.sbb-select-arrow-icon{position:absolute;top:50%;transform:translateY(-50%);right:calc(0.6rem * var(--sbb-scaling-factor));color:var(--sbb-color-granite)}:where(html.sbb-lean) .sbb-select-arrow-icon{right:.4rem}.sbb-select:is([readonly],.sbb-readonly) .sbb-select-arrow-icon{display:none}.sbb-select-arrow-icon>svg{transition:transform 120ms cubic-bezier(0, 0, 0.2, 1)}.sbb-input-with-open-panel .sbb-select-arrow-icon>svg{transform:rotate(180deg)}.sbb-icon.sbb-select-arrow-icon-lean>svg{transform:rotate(90deg)}.sbb-input-with-open-panel .sbb-icon.sbb-select-arrow-icon-lean>svg{transform:rotate(-90deg)}.sbb-select-panel :is(.sbb-menu-group+.sbb-menu-group,.sbb-menu-item+.sbb-menu-group,.sbb-menu-group+.sbb-menu-item){border-top:none}:where(html:not(.sbb-lean)) .sbb-select-panel.sbb-select-multiple .sbb-menu-group .sbb-menu-item{padding-left:calc(0.9333333333rem * var(--sbb-scaling-factor))}"],encapsulation:2,data:{animation:[aZ.transformPanel]},changeDetection:0}),n})(),ZF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({providers:[uZ],imports:[Tr,Ml,nr,Ao,rS,rS,Ml]}),n})();const fZ=["settingsContainer"];function mZ(n,t){if(1&n&&(le(0,"sbb-option",17),Ye(1),pe()),2&n){const e=t.$implicit,i=rn();rt("value",e.modeType),Fe(1),Pi(i.computeTripModeTypeText(e.modeType))}}function gZ(n,t){if(1&n){const e=Ho();le(0,"div",18),nn("click",function(){return Vi(e),Gi(rn().showRequestXmlPopover())}),le(1,"span",19),Ye(2,"XML"),pe()()}}function bZ(n,t){if(1&n&&(le(0,"sbb-option",17),Ye(1),pe()),2&n){const e=t.$implicit,i=rn();rt("value",e),Fe(1),Pi(i.computeTripTransportModeText(e))}}function _Z(n,t){if(1&n){const e=Ho();le(0,"div",20)(1,"div",21),nn("click",function(){return Vi(e),Gi(rn().handleTapOnMapButton())}),B(),le(2,"svg",22),bn(3,"path",23),pe(),Ye(4," Via "),pe(),Q(),le(5,"div",24)(6,"div"),Ye(7),pe(),bn(8,"div",25),le(9,"button",26),nn("click",function(){return Vi(e),Gi(rn().removeVia())}),B(),le(10,"svg",27),bn(11,"path",28)(12,"path",29),pe(),Ye(13," Remove "),pe()()()}if(2&n){const e=rn();Fe(7),Pi(e.computeViaName())}}let yZ=(()=>{class n{constructor(e,i,r){this.debugXmlPopover=e,this.userTripService=i,this.mapService=r,this.tripTransportModeData=[{modeType:"monomodal",transportModes:["public_transport","walk","cycle","self-drive-car","bicycle_rental","escooter_rental","car_sharing","taxi","others-drive-car"]},{modeType:"mode_at_start",transportModes:["walk","cycle","bicycle_rental","escooter_rental","taxi","others-drive-car"]},{modeType:"mode_at_end",transportModes:["walk","bicycle_rental","escooter_rental","car_sharing","taxi","others-drive-car"]},{modeType:"mode_at_start_end",transportModes:["walk","bicycle_rental","escooter_rental"]}],this.tripModeType=this.tripTransportModeData[0].modeType,this.tripTransportModes=JSON.parse(JSON.stringify(this.tripTransportModeData[0].transportModes)),this.tripTransportMode=this.tripTransportModes[0],this.tripModeTypeIdx=0,this.tripMotTypeDataModel={},this.settingsCollapseID="mode_custom_mode_settings_NOT_READY_YET",this.endpointMinDurationS="2",this.endpointMaxDurationS="30",this.endpointMinDistanceS="100",this.endpointMaxDistanceS="20000"}ngOnInit(){var e;this.tripModeType=this.userTripService.tripModeTypes[this.tripModeTypeIdx];const i=null!==(e=this.tripTransportModeData.find(r=>r.modeType===this.tripModeType))&&void 0!==e?e:this.tripTransportModeData[0];this.tripTransportModes=JSON.parse(JSON.stringify(i.transportModes)),this.tripTransportMode=this.userTripService.tripTransportModes[this.tripModeTypeIdx],this.tripMotTypeDataModel.isNotLastSegment=!this.isLastSegment(),this.tripMotTypeDataModel.sectionRequestData=null,this.userTripService.activeTripSelected.subscribe(r=>{this.updateRequestDataModel()}),this.userTripService.defaultsInited.subscribe(r=>{this.userTripService.updateTripLocationCustomMode(this.tripModeTypeIdx)}),this.settingsCollapseID="mode_custom_mode_settings_"+this.tripModeTypeIdx}isLastSegment(){return this.tripModeTypeIdx===this.userTripService.tripModeTypes.length-1}handleTapOnMapButton(){var e;const i=null!==(e=this.userTripService.viaTripLocations[this.tripModeTypeIdx])&&void 0!==e?e:null;this.mapService.tryToCenterAndZoomToLocation(i.location)}computeViaName(){var e,i,r;const s=null!==(e=this.userTripService.viaTripLocations[this.tripModeTypeIdx])&&void 0!==e?e:null;return null===s?"":null!==(r=null===(i=s.location.geoPosition)||void 0===i?void 0:i.asLatLngString())&&void 0!==r?r:""}removeVia(){this.userTripService.removeViaAtIndex(this.tripModeTypeIdx)}onTripModeChange(){var e;const i=null!==(e=this.tripTransportModeData.find(s=>s.modeType===this.tripModeType))&&void 0!==e?e:null;null!==i&&(this.tripTransportModes=JSON.parse(JSON.stringify(i.transportModes)),-1!==this.tripTransportModes.indexOf(this.tripTransportMode)||(this.tripTransportMode=this.tripTransportModes[0]),this.userTripService.updateTripMode(this.tripModeType,this.tripTransportMode,this.tripModeTypeIdx),this.userTripService.updateTripLocationCustomMode(this.tripModeTypeIdx))}onTransportModeChange(){this.userTripService.updateTripMode(this.tripModeType,this.tripTransportMode,this.tripModeTypeIdx),this.userTripService.updateTripLocationCustomMode(this.tripModeTypeIdx),"public_transport"===this.tripTransportMode&&this.settingsContainer.nativeElement.classList.remove("show")}updateRequestDataModel(){var e;this.tripMotTypeDataModel.isNotLastSegment=!this.isLastSegment();const i=this.userTripService.lastJourneyResponse;if(null===i)return void(this.tripMotTypeDataModel.sectionRequestData=null);const r=null!==(e=i.sections[this.tripModeTypeIdx])&&void 0!==e?e:null;this.tripMotTypeDataModel.sectionRequestData=null!==r?r.requestData:null}showRequestXmlPopover(){const e=this.debugXmlPopover.open(UD,{position:{top:"10px"}});e.afterOpened().subscribe(()=>{e.componentInstance.updateRequestData(this.tripMotTypeDataModel.sectionRequestData)})}computeTripModeTypeText(e){var i;return null!==(i={monomodal:"Monomodal",mode_at_start:"Mode at Start",mode_at_end:"Mode at End",mode_at_start_end:"Mode at Start & End"}[e])&&void 0!==i?i:"n/a"}computeTripTransportModeText(e){var i;return null!==(i={public_transport:"Public Transport",walk:"Walking",cycle:"Own Bicycle",escooter_rental:"eScooter Sharing",car_sharing:"Car Sharing","self-drive-car":"Own Car",bicycle_rental:"Bicycle Sharing",charging_station:"Charging Stations",taxi:"Taxi","others-drive-car":"Limousine"}[e])&&void 0!==i?i:"n/a"}onRestrictionsChange(){const e=parseInt(this.endpointMinDurationS,10),i=parseInt(this.endpointMaxDurationS,10),r=parseInt(this.endpointMinDistanceS,10),s=parseInt(this.endpointMaxDistanceS,10);this.userTripService.updateTripLocationRestrictions(e,i,r,s,this.tripModeTypeIdx)}}return n.\u0275fac=function(e){return new(e||n)(X(bu),X(Nc),X(Up))},n.\u0275cmp=On({type:n,selectors:[["trip-mode-type"]],viewQuery:function(e,i){if(1&e&&yr(fZ,5),2&e){let r;Jn(r=ei())&&(i.settingsContainer=r.first)}},inputs:{tripModeTypeIdx:"tripModeTypeIdx"},decls:39,vars:14,consts:[[1,"trip-mot-type-container"],[1,"d-flex","align-items-center","via-mot"],[1,"flex-grow-1"],[1,"w-100"],[3,"ngModel","ngModelChange","selectionChange"],[3,"value",4,"ngFor","ngForOf"],["class","xml-info",3,"click",4,"ngIf"],[1,"mobility-settings"],["sbb-secondary-button","","type","button","data-bs-toggle","collapse","aria-expanded","false",3,"disabled"],["svgIcon","kom:combined-mobility-small"],[1,"mobility-settings-left-v2","endpoint-settings-wrapper","collapse",3,"id"],["settingsContainer",""],[1,"endpoint-settings","d-none2"],[1,"d-flex","align-items-center","mb-2"],["sbbInput","",2,"width","50px",3,"ngModel","ngModelChange","change"],["sbbInput","",2,"width","70px",3,"ngModel","ngModelChange","change"],["class","via-content",4,"ngIf"],[3,"value"],[1,"xml-info",3,"click"],[1,"layer-xml-info","badge","bg-info","text-dark"],[1,"via-content"],[1,"via-label",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","12","height","12","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-map"],["fill-rule","evenodd","d","M15.817.113A.5.5 0 0 1 16 .5v14a.5.5 0 0 1-.402.49l-5 1a.502.502 0 0 1-.196 0L5.5 15.01l-4.902.98A.5.5 0 0 1 0 15.5v-14a.5.5 0 0 1 .402-.49l5-1a.5.5 0 0 1 .196 0L10.5.99l4.902-.98a.5.5 0 0 1 .415.103zM10 1.91l-4-.8v12.98l4 .8V1.91zm1 12.98 4-.8V1.11l-4 .8v12.98zm-6-.8V1.11l-4 .8v12.98l4-.8z"],[1,"d-flex","align-items-center"],[2,"width","8px"],["type","button",1,"btn","btn-sm","btn-outline-danger",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-x-circle"],["d","M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"],["d","M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"]],template:function(e,i){1&e&&(le(0,"div",0)(1,"div",1)(2,"div",2)(3,"sbb-form-field",3)(4,"sbb-label"),Ye(5,"Choose Monomodal / Multimodal"),pe(),le(6,"sbb-select",4),nn("ngModelChange",function(s){return i.tripModeType=s})("selectionChange",function(){return i.onTripModeChange()}),Jt(7,mZ,2,2,"sbb-option",5),pe()()(),Jt(8,gZ,3,0,"div",6),pe(),le(9,"div",1)(10,"div",2)(11,"sbb-form-field",3)(12,"sbb-label"),Ye(13,"Choose MOT (Mode of Transport)"),pe(),le(14,"sbb-select",4),nn("ngModelChange",function(s){return i.tripTransportMode=s})("selectionChange",function(){return i.onTransportModeChange()}),Jt(15,bZ,2,2,"sbb-option",5),pe()()(),le(16,"div",7)(17,"button",8),bn(18,"sbb-icon",9),pe()()(),le(19,"div",10,11)(21,"div",12)(22,"div",13)(23,"div",2),Ye(24," Duration (mins) "),pe(),le(25,"div")(26,"input",14),nn("ngModelChange",function(s){return i.endpointMinDurationS=s})("change",function(){return i.onRestrictionsChange()}),pe(),le(27,"span"),Ye(28," to "),pe(),le(29,"input",14),nn("ngModelChange",function(s){return i.endpointMaxDurationS=s})("change",function(){return i.onRestrictionsChange()}),pe()()(),le(30,"div",13)(31,"div",2),Ye(32," Distance (meters) "),pe(),le(33,"div")(34,"input",14),nn("ngModelChange",function(s){return i.endpointMinDistanceS=s})("change",function(){return i.onRestrictionsChange()}),pe(),le(35,"span"),Ye(36," to "),pe(),le(37,"input",15),nn("ngModelChange",function(s){return i.endpointMaxDistanceS=s})("change",function(){return i.onRestrictionsChange()}),pe()()()()(),Jt(38,_Z,14,1,"div",16),pe()),2&e&&(Fe(6),rt("ngModel",i.tripModeType),Fe(1),rt("ngForOf",i.tripTransportModeData),Fe(1),rt("ngIf",i.tripMotTypeDataModel.sectionRequestData),Fe(6),rt("ngModel",i.tripTransportMode),Fe(1),rt("ngForOf",i.tripTransportModes),Fe(2),au("disabled","monomodal"===i.tripModeType),Sn("data-bs-target","#"+i.settingsCollapseID+("monomodal"===i.tripModeType?"_DISABLED":""))("aria-controls",i.settingsCollapseID),Fe(2),au("id",i.settingsCollapseID),Fe(7),rt("ngModel",i.endpointMinDurationS),Fe(3),rt("ngModel",i.endpointMaxDurationS),Fe(5),rt("ngModel",i.endpointMinDistanceS),Fe(3),rt("ngModel",i.endpointMaxDistanceS),Fe(1),rt("ngIf",i.tripMotTypeDataModel.isNotLastSegment))},dependencies:[Rc,js,ld,gh,Ap,Ev,EF,Nv,GD,ol,Yb,pZ],styles:[".trip-mot-type-container[_ngcontent-%COMP%]{margin-top:0;margin-bottom:0}.via-content[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:16px}.via-mot[_ngcontent-%COMP%]{margin-left:12px}.via-label[_ngcontent-%COMP%]{font-size:12px}.via-label[_ngcontent-%COMP%]:hover{cursor:pointer}.xml-info[_ngcontent-%COMP%]{cursor:pointer;margin-left:5px}.mobility-settings[_ngcontent-%COMP%]{margin-left:5px;margin-top:3px}.mobility-settings-left-v2[_ngcontent-%COMP%]{margin-left:10px}.endpoint-settings[_ngcontent-%COMP%]{margin-bottom:18px;margin-left:12px;margin-right:12px;padding:0 14px;border-color:#cacaca;border-style:solid;border-width:0 1px 1px 1px;border-radius:2px}"]}),n})();function vZ(n,t){1&n&&Ja(0)}function xZ(n,t){1&n&&bn(0,"trip-mode-type",26),2&n&&rt("tripModeTypeIdx",t.index)}function wZ(n,t){if(1&n&&(Yl(0),Jt(1,xZ,1,1,"trip-mode-type",25),Kl()),2&n){const e=rn(2);Fe(1),rt("ngForOf",e.userTripService.journeyTripsPlaceholder)}}function SZ(n,t){if(1&n){const e=Ho();le(0,"sbb-radio-button",30),nn("change",function(r){return Vi(e),Gi(rn(3).onChangeStageAPI(r))}),Ye(1),pe()}if(2&n){const e=t.$implicit,i=rn(3);rt("value",e)("checked",i.userTripService.currentAppStage==e),Fe(1),Vr(" ",e," ")}}function CZ(n,t){if(1&n&&(le(0,"div",27)(1,"div")(2,"sbb-radio-group",28),Jt(3,SZ,2,3,"sbb-radio-button",29),pe()()()),2&n){const e=rn(2);Fe(3),rt("ngForOf",e.appStageOptions)}}function TZ(n,t){1&n&&bn(0,"span",31)}function EZ(n,t){if(1&n){const e=Ho();le(0,"div",32)(1,"button",33),nn("click",function(){return Vi(e),Gi(rn(2).loadInputTripXMLPopover())}),Ye(2," Debug XML "),pe()()}}function DZ(n,t){if(1&n){const e=Ho();le(0,"div",6)(1,"div",7)(2,"journey-point-input",8),nn("selectedLocation",function(r){return Vi(e),Gi(rn().onLocationSelected(r,"From"))}),pe()()(),Jt(3,wZ,2,1,"ng-container",9),le(4,"div",10)(5,"div",7)(6,"journey-point-input",8),nn("selectedLocation",function(r){return Vi(e),Gi(rn().onLocationSelected(r,"To"))}),pe()(),le(7,"div",11)(8,"button",12),nn("click",function(){return Vi(e),Gi(rn().swapEndpoints())}),bn(9,"sbb-icon",13),pe()()(),le(10,"div",6)(11,"div")(12,"sbb-form-field",14)(13,"sbb-datepicker",15)(14,"input",16),nn("ngModelChange",function(r){return Vi(e),Gi(rn().searchDate=r)})("dateChange",function(){return Vi(e),Gi(rn().onChangeDateTime())}),pe()()()(),le(15,"div",17)(16,"sbb-form-field",18)(17,"input",19),nn("ngModelChange",function(r){return Vi(e),Gi(rn().searchTime=r)})("change",function(){return Vi(e),Gi(rn().onChangeDateTime())}),pe()()()(),Jt(18,CZ,4,1,"div",20),le(19,"div",6)(20,"div",21)(21,"button",22),nn("click",function(){return Vi(e),Gi(rn().handleTapOnSearch())}),Jt(22,TZ,1,0,"span",23),Ye(23," Search Journeys "),pe()(),Jt(24,EZ,3,0,"div",24),pe()}if(2&n){const e=rn();Fe(2),rt("endpointType","From")("inputValue",e.fromLocationText)("placeholder","From"),Fe(1),rt("ngIf",!e.isEmbed),Fe(3),rt("endpointType","To")("inputValue",e.toLocationText)("placeholder","To"),Fe(8),rt("ngModel",e.searchDate),Fe(3),rt("ngModel",e.searchTime),Fe(1),rt("ngIf",!1===e.isEmbed),Fe(3),rt("disabled",e.shouldDisableSearchButton()),Fe(1),rt("ngIf",e.isSearching),Fe(2),rt("ngIf",!e.isEmbed)}}function IZ(n,t){if(1&n&&(le(0,"div")(1,"span",37),Ye(2),pe()()),2&n){const e=rn(2);Fe(2),Pi(e.requestDuration)}}function MZ(n,t){if(1&n){const e=Ho();Yl(0),le(1,"div")(2,"a",38),Ye(3,"Permalink"),pe()(),le(4,"div",39),Ye(5," | "),pe(),le(6,"div")(7,"a",40),nn("click",function(){return Vi(e),Gi(rn(2).loadEmbedHTMLPopover())}),Ye(8,"Embed"),pe()(),Kl()}if(2&n){const e=rn(2);Fe(2),au("href",e.userTripService.permalinkRelativeURL,yc)}}function AZ(n,t){if(1&n&&(le(0,"div",34)(1,"div",1)(2,"div",35),Jt(3,IZ,3,1,"div",9),bn(4,"div",36),Jt(5,MZ,9,1,"ng-container",9),pe()()()),2&n){const e=rn();Fe(3),rt("ngIf",null!==e.requestDuration),Fe(2),rt("ngIf",null!==e.userTripService.permalinkRelativeURL)}}function kZ(n,t){if(1&n&&(le(0,"div",34)(1,"div",1)(2,"div",35)(3,"div")(4,"a",38),Ye(5,"Open in OJP Demo App"),pe()()()()()),2&n){const e=rn();Fe(4),au("href",e.userTripService.permalinkRelativeURL,yc)}}let YF=(()=>{class n{constructor(e,i,r,s,d,m){this.notificationToast=e,this.tripXmlPopover=i,this.embedHTMLPopover=r,this.router=s,this.userTripService=d,this.mapService=m,this.appStageOptions=[];const y=this.userTripService.departureDate;this.searchDate=y,this.searchTime=Il.formatTimeHHMM(y),this.fromLocationText="",this.toLocationText="",this.appStageOptions=["PROD","INT","TEST","LA Beta"],this.isSearching=!1,this.tripRequestFormattedXML="RequestXML",this.tripResponseFormattedXML="ResponseXML",this.requestDuration=null,this.lastCustomTripRequestXML=null,this.useMocks=!1,this.headerText="Search",this.isEmbed=-1!==this.router.url.indexOf("/embed/")}ngOnInit(){this.userTripService.initDefaults(),this.userTripService.locationsUpdated.subscribe(e=>{this.updateLocationTexts()}),this.userTripService.tripsUpdated.subscribe(e=>{e.length>0?this.collapseSearchPanel():this.expandSearchPanel()}),this.userTripService.searchParamsReset.subscribe(()=>{this.expandSearchPanel(),this.requestDuration=null}),this.userTripService.defaultsInited.subscribe(e=>{var i;null!==(i=new URLSearchParams(document.location.search).get("do_search"))&&void 0!==i&&i&&this.handleTapOnSearch()}),this.useMocks&&this.initLocationsFromMocks()}updateLocationTexts(){const i=[];if(["From","To"].forEach(r=>{var s,d;const m="From"===r?this.userTripService.fromTripLocation:this.userTripService.toTripLocation,y=null!==(s=null==m?void 0:m.location)&&void 0!==s?s:null;if(null===y)return;let T=null!==(d=y.computeLocationName())&&void 0!==d?d:"";"From"===r?this.fromLocationText=T.trim():this.toLocationText=T.trim(),i.push(T)}),this.isEmbed){const r=[];r.push(""===this.fromLocationText?"From Location":this.fromLocationText),r.push("-"),r.push(""===this.toLocationText?"To Location":this.toLocationText),this.headerText=r.join(" ")}}initLocationsFromMocks(){let i="n/a";i="assets/mocks/ojp-trips-response/on-demand-response.xml";const r=fetch(i);console.log("USE MOCKS: "+i),r.then(s=>{s.text().then(d=>{const y=pd.initWithXML(d,this.userTripService.tripModeTypes[0],"public_transport");console.log("MOCK RESPONSE from "+i),console.log(y),this.handleCustomTripResponse(y);const T=i.split("/");this.requestDuration="MOCK from "+T[T.length-1],y.trips.length>0&&this.zoomToTrip(y.trips[0])})})}zoomToTrip(e){const i=e.computeBBOX(),s={bounds:new($s().LngLatBounds)(i.asFeatureBBOX())};this.mapService.newMapBoundsRequested.emit(s)}onLocationSelected(e,i){this.userTripService.updateTripEndpoint(e,i,"SearchForm")}onChangeStageAPI(e){this.userTripService.updateAppStage(e.value),this.userTripService.refetchEndpointsByName()}onChangeDateTime(){this.userTripService.updateDepartureDateTime(this.computeFormDepartureDate())}computeFormDepartureDate(){const e=this.searchDate,i=this.searchTime.split(":");if(2===i.length){const r=parseInt(i[0]),s=parseInt(i[1]);e.setHours(r),e.setMinutes(s)}return e}shouldDisableSearchButton(){return!!this.isSearching}handleTapOnSearch(){this.userTripService.updateDepartureDateTime(this.computeFormDepartureDate());const e=this.userTripService.computeJourneyRequestParams();if(null===e)return void this.notificationToast.open("Please check from/to input points",{type:"error",verticalPosition:"top"});this.notificationToast.dismiss();const i=this.userTripService.getStageConfig(),r=new sW(i,e);this.isSearching=!0;const s=new Date;r.fetchResponse((d,m)=>{if(m)return this.notificationToast.open(m.message,{type:"error",verticalPosition:"top"}),this.isSearching=!1,this.userTripService.lastJourneyResponse=null,this.requestDuration=null,void this.userTripService.updateTrips([]);0===d.length?this.notificationToast.open("No trips found",{type:"info",verticalPosition:"top"}):this.zoomToTrip(d[0]);const T=(((new Date).getTime()-s.getTime())/1e3).toFixed(2);this.requestDuration=T+" sec",this.isSearching=!1,this.userTripService.lastJourneyResponse=r.lastJourneyResponse,this.userTripService.updateTrips(d)})}expandSearchPanel(){var e;null===(e=this.searchPanel)||void 0===e||e.open()}collapseSearchPanel(){var e;null===(e=this.searchPanel)||void 0===e||e.close()}loadInputTripXMLPopover(){const e=this.tripXmlPopover.open(v9,{position:{top:"20px"}});e.afterOpened().subscribe(()=>{const i=e.componentInstance;i.inputTripRequestXmlS=this.userTripService.computeTripRequestXML(this.computeFormDepartureDate()),i.tripCustomRequestSaved.subscribe(r=>{this.lastCustomTripRequestXML=i.inputTripRequestXmlS;const d=pd.initWithXML(r,this.userTripService.tripModeTypes[0],"public_transport");0!==d.trips.length?(e.close(),this.handleCustomTripResponse(d)):i.inputTripRequestResponseXmlS=r}),i.tripCustomResponseSaved.subscribe(r=>{const d=pd.initWithXML(r,this.userTripService.tripModeTypes[0],"public_transport");0!==d.trips.length&&(e.close(),this.handleCustomTripResponse(d))})})}handleCustomTripResponse(e){this.requestDuration="USER XML",this.isSearching=!1,this.userTripService.lastJourneyResponse=null,this.userTripService.updateTrips(e.trips),this.updateSearchForm(e),e.trips.length>0&&this.zoomToTrip(e.trips[0])}updateSearchForm(e){const i=e.trips[0];null!==i&&(this.userTripService.updateParamsFromTrip(i),this.updateLocationTexts())}swapEndpoints(){this.userTripService.switchEndpoints()}loadEmbedHTMLPopover(){this.embedHTMLPopover.open(k9,{position:{top:"20px"}}).afterOpened().subscribe(()=>{})}}return n.\u0275fac=function(e){return new(e||n)(X(CF),X(bu),X(bu),X(Ds),X(Nc),X(Up))},n.\u0275cmp=On({type:n,selectors:[["app-search-form"]],viewQuery:function(e,i){if(1&e&&yr(Am,7),2&e){let r;Jn(r=ei())&&(i.searchPanel=r.first)}},decls:11,vars:5,consts:[[1,"row","mb-1"],[1,"col"],[3,"expanded"],[4,"ngTemplateOutlet"],["searchContent",""],["class","row mb-2",4,"ngIf"],[1,"d-flex"],[1,"flex-grow-1","journey-endpoint"],[3,"endpointType","inputValue","placeholder","selectedLocation"],[4,"ngIf"],[1,"d-flex","align-items-center"],[1,"swap-endpoints"],["sbb-secondary-button","","data-bs-toggle","collapse","aria-expanded","false",3,"click"],["svgIcon","kom:arrow-change-horizontal-medium"],["label","Choose Day"],["arrows",""],["sbbInput","","sbbDateInput","",3,"ngModel","ngModelChange","dateChange"],[2,"margin-left","8px"],["label","Time"],["sbbInput","","sbbTimeInput","",3,"ngModel","ngModelChange","change"],["class","mb-2 d-flex",4,"ngIf"],[2,"margin-right","4px"],["type","button",1,"btn","btn-primary",3,"disabled","click"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],["class","ms-auto",4,"ngIf"],[3,"tripModeTypeIdx",4,"ngFor","ngForOf"],[3,"tripModeTypeIdx"],[1,"mb-2","d-flex"],[1,"sbb-radio-group-horizontal"],[3,"value","checked","change",4,"ngFor","ngForOf"],[3,"value","checked","change"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"],[1,"ms-auto"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"row","mb-2"],[1,"d-flex","flex-row-reverse"],[2,"width","7px"],[1,"badge","bg-success"],["target","_blank",3,"href"],["clas","text-center",2,"width","7px","margin-left","4px"],["target","_blank","role","button",1,"text-decoration-underline",3,"click"]],template:function(e,i){if(1&e&&(le(0,"div",0)(1,"div",1)(2,"sbb-accordion")(3,"sbb-expansion-panel",2)(4,"sbb-expansion-panel-header"),Ye(5),pe(),Jt(6,vZ,1,0,"ng-container",3),pe()()()(),Jt(7,DZ,25,13,"ng-template",null,4,rm),Jt(9,AZ,6,2,"div",5),Jt(10,kZ,6,1,"div",5)),2&e){const r=Zl(8);Fe(3),rt("expanded",!0),Fe(2),Pi(i.headerText),Fe(1),rt("ngTemplateOutlet",r),Fe(3),rt("ngIf",!i.isEmbed),Fe(1),rt("ngIf",i.isEmbed&&null!==i.userTripService.permalinkRelativeURL)}},dependencies:[Rc,js,tT,ld,gh,Ap,FD,Am,mS,EF,KD,CS,Nv,ol,Yb,BF,JD,VF,JX,yZ],styles:[".debug-xml[_ngcontent-%COMP%]:hover{cursor:pointer}.swap-endpoints[_ngcontent-%COMP%]{margin-left:5px;margin-top:10px}"]}),n})(),KF=(()=>{class n{ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=On({type:n,selectors:[["web-footer"]],decls:129,vars:0,consts:[[1,"d-none"],["id","map-debug-control"],[1,"fw-bold"],["id","map_debug_center"],["id","map_debug_zoom"],["id","map-layers-legend-control"],[1,"map-layers-legend-wrapper"],[1,"d-flex","flex-row"],[1,"flex-grow-1","map-layers-header"],["href","#map_layers_body","data-bs-toggle","collapse","aria-expanded","true","aria-controls","map_layers_body",1,"content-collapse","align-middle"],[1,"bi","bi-plus-circle"],[1,"bi","bi-dash-circle"],["id","map_layers_body",1,"collapse","show"],["data-map-layer-key","stops",1,"map-layer-data","mb-2"],["type","checkbox","checked","",1,"map-layer-checkbox","align-middle"],[1,"layer-text"],[1,"layer-xml-info","badge","bg-info","text-dark"],["data-map-layer-key","addresses",1,"map-layer-data","mb-2"],["type","checkbox",1,"map-layer-checkbox","align-middle"],[1,"flex-grow-1"],["href","#map_layers_mobility_body","data-bs-toggle","collapse","aria-expanded","true","aria-controls","map_layers_mobility_body",1,"content-collapse","collapsed","align-middle"],["id","map_layers_mobility_body",1,"collapse","mb-2",2,"margin-left","8px"],["data-map-layer-key","sharing_cars",1,"map-layer-data"],["data-map-layer-key","sharing_bicycles",1,"map-layer-data"],["data-map-layer-key","sharing_scooters",1,"map-layer-data"],["data-map-layer-key","charging_stations",1,"map-layer-data"],[1,"map-composite-pois"],["href","#map_layers_pois_body","data-bs-toggle","collapse","aria-expanded","true","aria-controls","map_layers_pois_body",1,"content-collapse","collapsed","align-middle"],["id","map_layers_pois_body",1,"collapse","mb-2",2,"margin-left","8px"],["type","checkbox","data-osm-tag","service",1,"map-layer-poi","align-middle"],["type","checkbox","data-osm-tag","shopping",1,"map-layer-poi","align-middle"],["type","checkbox","data-osm-tag","leisure",1,"map-layer-poi","align-middle"],["type","checkbox","data-osm-tag","catering",1,"map-layer-poi","align-middle"],["type","checkbox","data-osm-tag","public",1,"map-layer-poi","align-middle"],["type","checkbox","data-osm-tag","parkride",1,"map-layer-poi","align-middle"],["type","checkbox","data-osm-tag","accommodation",1,"map-layer-poi","align-middle"],["type","checkbox","data-osm-tag","sbb_services",1,"map-layer-poi","align-middle"],["type","checkbox","data-osm-tag","other",1,"map-layer-poi","align-middle"],[1,"row","bg-ojp-blue","text-white"],[1,"bg-ojp-orange","w-100",2,"height","5px"],[1,"col"],[1,"footer"],["href","https://opentransportdata.swiss/en/","target","_blank"],["href","https://github.com/openTdataCH/ojp-demo-app-src/blob/main/CHANGELOG.md","target","_blank"],[1,"row",2,"height","16px"]],template:function(e,i){1&e&&(le(0,"div",0)(1,"div",1)(2,"div")(3,"span",2),Ye(4,"Center"),pe(),Ye(5,": "),le(6,"span",3),Ye(7,"n/a"),pe()(),le(8,"div")(9,"span",2),Ye(10,"Zoom"),pe(),Ye(11,": "),le(12,"span",4),Ye(13,"n/a"),pe()()(),le(14,"div",5)(15,"div",6)(16,"div",7)(17,"div",8),Ye(18,"Toggle Map Layers"),pe(),le(19,"div")(20,"a",9),bn(21,"i",10)(22,"i",11),pe()()(),le(23,"div",12)(24,"div",13),bn(25,"input",14),le(26,"span",15),Ye(27,"Stops (z13+)"),pe(),le(28,"span",16),Ye(29,"XML"),pe()(),le(30,"div",17),bn(31,"input",18),le(32,"span",15),Ye(33,"Addresses (z17+)"),pe(),le(34,"span",16),Ye(35,"XML"),pe()(),le(36,"div",7)(37,"div",19),Ye(38,"Shared Mobility"),pe(),le(39,"div")(40,"a",20),bn(41,"i",10)(42,"i",11),pe()()(),le(43,"div",21)(44,"div",22),bn(45,"input",18),le(46,"span",15),Ye(47,"Shared Cars (z12+)"),pe(),le(48,"span",16),Ye(49,"XML"),pe()(),le(50,"div",23),bn(51,"input",18),le(52,"span",15),Ye(53,"Shared Bicycles (z14+)"),pe(),le(54,"span",16),Ye(55,"XML"),pe()(),le(56,"div",24),bn(57,"input",18),le(58,"span",15),Ye(59,"Shared Scooters (z14+)"),pe(),le(60,"span",16),Ye(61,"XML"),pe()(),le(62,"div",25),bn(63,"input",18),le(64,"span",15),Ye(65,"Charging Stations (z12+)"),pe(),le(66,"span",16),Ye(67,"XML"),pe()()(),le(68,"div",26)(69,"div",7)(70,"div",19),Ye(71,"Other POIs (z16+) "),le(72,"span",16),Ye(73,"XML"),pe()(),le(74,"div")(75,"a",27),bn(76,"i",10)(77,"i",11),pe()()(),le(78,"div",28)(79,"div"),bn(80,"input",29),le(81,"span",15),Ye(82,"Service"),pe()(),le(83,"div"),bn(84,"input",30),le(85,"span",15),Ye(86,"Shopping"),pe()(),le(87,"div"),bn(88,"input",31),le(89,"span",15),Ye(90,"Leisure"),pe()(),le(91,"div"),bn(92,"input",32),le(93,"span",15),Ye(94,"Catering"),pe()(),le(95,"div"),bn(96,"input",33),le(97,"span",15),Ye(98,"Public"),pe()(),le(99,"div"),bn(100,"input",34),le(101,"span",15),Ye(102,"Parkride"),pe()(),le(103,"div"),bn(104,"input",35),le(105,"span",15),Ye(106,"Accommodation"),pe()(),le(107,"div"),bn(108,"input",36),le(109,"span",15),Ye(110,"SBB Services"),pe()(),le(111,"div"),bn(112,"input",37),le(113,"span",15),Ye(114,"Other"),pe()()()()()()()(),le(115,"div",38),bn(116,"div",39),le(117,"div",40)(118,"div",41)(119,"div"),Ye(120," \xa9 "),le(121,"a",42),Ye(122,"Open-Data-Plattform Mobilit\xe4t Schweiz"),pe(),Ye(123," 2021 - 2023 "),pe(),le(124,"div"),Ye(125," Last Update: "),le(126,"a",43),Ye(127,"28.October 2023"),pe()()()()(),bn(128,"div",44))},encapsulation:2}),n})(),QF=(()=>{class n{ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=On({type:n,selectors:[["web-header"]],decls:19,vars:0,consts:[[1,"row"],[1,"col","nav-main","bg-ojp-blue"],[1,"d-flex","flex-row","align-items-center","justify-content-between"],[1,"navbar-brand","text-white"],["src","assets/opentransportdata.swiss.header-icons.svg","height","23",1,"mb-2"],[1,"d-none","d-md-flex"],[1,"nav-item"],["href","https://github.com/openTdataCH/ojp-demo-app-src",1,"nav-link"],["href","https://github.com/openTdataCH/ojp-demo-app-src/blob/main/docs/README.md",1,"nav-link"],["href","https://opentransportdata.swiss/en/cookbook/open-journey-planner-ojp/",1,"nav-link"],[1,"bg-ojp-orange","w-100",2,"height","10px"]],template:function(e,i){1&e&&(le(0,"div",0)(1,"div",1)(2,"div",2)(3,"div")(4,"span",3),Ye(5,"OJP Demo"),pe(),bn(6,"br")(7,"img",4),pe(),le(8,"div",5)(9,"div",6)(10,"a",7),Ye(11,"Source Code"),pe()(),le(12,"div",6)(13,"a",8),Ye(14,"Docs"),pe()(),le(15,"div",6)(16,"a",9),Ye(17,"OJP Cookbook"),pe()()()()(),bn(18,"div",10),pe())},encapsulation:2}),n})(),RZ=(()=>{class n{ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=On({type:n,selectors:[["journey-search"]],decls:17,vars:4,consts:[[1,"container"],[1,"app-root"],["sbb-tab-nav-bar","",3,"tabPanel"],["sbb-tab-link","",3,"active"],["sbb-tab-link","",3,"active","routerLink"],["tabPanel",""],[1,"row"],[1,"col-md-4"],[1,"col-md-8"]],template:function(e,i){if(1&e&&(le(0,"div",0),bn(1,"web-header"),le(2,"div",1)(3,"nav",2)(4,"a",3),Ye(5,"Journey Search"),pe(),le(6,"a",4),Ye(7,"Station Board"),pe()(),le(8,"sbb-tab-nav-panel",null,5)(10,"div",6)(11,"div",7),bn(12,"app-search-form")(13,"journey-results"),pe(),le(14,"div",8),bn(15,"app-map"),pe()()()(),bn(16,"web-footer"),pe()),2&e){const r=Zl(9);Fe(3),rt("tabPanel",r),Fe(1),rt("active","true"),Fe(2),rt("active","false")("routerLink","../board")}},dependencies:[vv,gD,A2,bD,oF,_9,YF,KF,QF],styles:[".app-root[_ngcontent-%COMP%]{border:1px solid #CACACA;margin-left:calc(-.5 * var(--bs-gutter-x));margin-right:calc(-.5 * var(--bs-gutter-x));padding:8px}"]}),n})();const PZ=JSON.parse('{"id":"ojp-service-track-line","type":"line","source":"[SOURCE_ID]","filter":["all",["==",["geometry-type"],"LineString"]],"layout":{"line-join":"round","line-cap":"round"},"paint":{"line-width":4,"line-opacity":1,"line-color":["case",["==",["get","line-type"],"prev"],"#D3D3D3","#3D69CA"]}}'),OZ=JSON.parse('{"id":"ojp-service-track-stop","type":"circle","source":"[SOURCE_ID]","filter":["all",["==",["geometry-type"],"Point"]],"layout":{},"paint":{"circle-radius":["case",["==",["get","point-size"],"large"],6,4],"circle-color":["case",["==",["get","line-type"],"prev"],"#D3D3D3","#3D69CA"],"circle-stroke-color":"#FFF","circle-stroke-width":["case",["==",["get","point-size"],"large"],3,1]}}');class LZ{constructor(t){this.map=t,this.sourceID="stop-event-service-data",this.addMapLayers(t)}addMapLayers(t){t.addSource(this.sourceID,{type:"geojson",data:{type:"FeatureCollection",features:[]}});const i=PZ;i.source=this.sourceID,t.addLayer(i);const r=OZ;r.source=this.sourceID,t.addLayer(r)}drawStopEvent(t){let e=[];const i={prev:[],next:[]},r={prev:[],next:[]},s=["prev","next"];s.forEach(y=>{const T="prev"===y;let M=T?t.prevStopPoints:t.nextStopPoints;M.forEach((R,H)=>{const Z=R.location.geoPosition;if(null===Z)return;i[y].push(Z.asPosition());const te=0===H,xe=H===M.length-1,Ce=R.location.asGeoJSONFeature();Ce&&Ce.properties&&(Ce.properties["point-type"]=y,Ce.properties["point-size"]=T?te?"large":"normal":xe?"large":"normal",r[y].push(Ce))})});const d=t.stopPoint.location.geoPosition;if(d){i.prev.push(d.asPosition()),i.next.unshift(d.asPosition());const y=t.stopPoint.location.asGeoJSONFeature();y&&y.properties&&(y.properties["point-type"]="next",y.properties["point-size"]="large",r.next.push(y))}s.forEach(y=>{const T=i[y];T.length<2||(e.push({type:"Feature",properties:{"line-type":y},geometry:{type:"LineString",coordinates:T}}),e=e.concat(r[y]))}),this.udateStopEventSource({type:"FeatureCollection",features:e})}resetStopEventLayers(){this.udateStopEventSource({type:"FeatureCollection",features:[]})}udateStopEventSource(t){const e=this.map.getSource(this.sourceID);if(null===e)return console.error("ERROR - cant find the source "+this.sourceID),void console.log(this.map.getStyle());e.setData(t)}}let tI=(()=>{class n{constructor(){this.stationBoardDataUpdated=new on,this.stationBoardEntrySelected=new on,this.stationOnMapClicked=new on}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=tn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),FZ=(()=>{class n{constructor(e,i,r,s){this.userTripService=e,this.mapService=i,this.debugXmlPopover=r,this.stationBoardService=s,this.mapLoadingPromise=null,this.stopEventServiceRenderer=null}ngOnInit(){this.initMap(),this.mapService.newMapCenterAndZoomRequested.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{r.jumpTo({center:e.lnglat,zoom:e.zoom})})}),this.stationBoardService.stationBoardEntrySelected.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{this.updateMapForEntry(e)})})}initMap(){const e=new($s().LngLatBounds)([[5.9559,45.818],[10.4921,47.8084]]),i=new($s().Map)({container:"map_canvas_station_board",style:"mapbox://styles/mapbox/light-v10",bounds:e,accessToken:"pk.eyJ1IjoidmFzaWxlIiwiYSI6ImNra2k2dWFkeDFrbG0ycXF0Nmg0Z2tsNXAifQ.nK-i-3cpWmji7HvK1Ilynw"});this.mapService.initialMapCenter?(i.setCenter(this.mapService.initialMapCenter),this.mapService.initialMapZoom&&i.setZoom(this.mapService.initialMapZoom)):i.fitBounds(e,{padding:50,duration:0}),this.mapLoadingPromise=new Promise((r,s)=>{i.on("load",d=>{r(i),this.onMapLoad(i)})})}onMapLoad(e){this.addMapControls(e),this.addMapListeners(e),this.stopEventServiceRenderer=new LZ(e)}addMapControls(e){const i=new($s().NavigationControl)({showCompass:!1,visualizePitch:!1});e.addControl(i,"bottom-right");const r=new($s().ScaleControl)({maxWidth:200,unit:"metric"});e.addControl(r);const s=new sF(e);e.addControl(s,"top-left");const d=new _F(e,this.debugXmlPopover,this.userTripService);e.addControl(d,"top-right")}updateMapForEntry(e){var i,r;null===e?null===(i=this.stopEventServiceRenderer)||void 0===i||i.resetStopEventLayers():null===(r=this.stopEventServiceRenderer)||void 0===r||r.drawStopEvent(e)}addMapListeners(e){e.on("styleimagemissing",i=>{e.loadImage("./assets/map-style-icons/"+i.id+".png",(s,d)=>{s?console.error(s):!e.hasImage(i.id)&&d&&e.addImage(i.id,d)})}),e.on("click",i=>{const r=Pm.queryNearbyFeaturesByLayerIDs(e,i.lngLat,["stops-circle","stops-label"]);r.length>0&&this.stationBoardService.stationOnMapClicked.emit(r[0].feature)})}}return n.\u0275fac=function(e){return new(e||n)(X(Nc),X(Up),X(bu),X(tI))},n.\u0275cmp=On({type:n,selectors:[["station-board-map"]],decls:1,vars:0,consts:[["id","map_canvas_station_board",1,"map_wrapper"]],template:function(e,i){1&e&&bn(0,"div",0)},styles:[".map_wrapper[_ngcontent-%COMP%]{height:600px;border:1px solid #e5e5e5}"]}),n})();const NZ=["stationBoardWrapper"];function BZ(n,t){if(1&n&&(le(0,"div")(1,"div"),Ye(2),pe()()),2&n){const e=rn(2).$implicit;Fe(2),Vr("Pl. ",e.stopPlatform,"")}}function zZ(n,t){if(1&n&&(le(0,"div")(1,"div"),Ye(2,"Pl. "),le(3,"del"),Ye(4),pe(),Ye(5),pe()()),2&n){const e=rn(2).$implicit;Fe(4),Vr(" ",e.stopPlatform,""),Fe(1),Vr(" ",e.stopPlatformActual,"")}}function VZ(n,t){if(1&n&&(le(0,"div",14),Jt(1,BZ,3,1,"div",13),Jt(2,zZ,6,2,"div",13),pe()),2&n){const e=rn().$implicit;Fe(1),rt("ngIf",!e.stopPlatformActual),Fe(1),rt("ngIf",e.stopPlatformActual)}}function jZ(n,t){if(1&n&&(le(0,"div")(1,"div",15),Ye(2),pe()()),2&n){const e=rn().$implicit,i=rn();Fe(2),Pi(e.mapStationBoardTime[i.stationBoardType].stopTime)}}function UZ(n,t){if(1&n&&(le(0,"div")(1,"del"),Ye(2),pe()()),2&n){const e=rn(2).$implicit,i=rn();Fe(2),Pi(e.mapStationBoardTime[i.stationBoardType].stopTime)}}function HZ(n,t){if(1&n&&(le(0,"div"),Jt(1,UZ,3,1,"div",13),le(2,"div",15),Ye(3),pe(),le(4,"div",16),Ye(5),pe()()),2&n){const e=rn().$implicit,i=rn();Fe(1),rt("ngIf",i.hasDelayDifferentTime(e)),Fe(2),Pi(e.mapStationBoardTime[i.stationBoardType].stopTimeActual),Fe(2),Pi(e.mapStationBoardTime[i.stationBoardType].stopDelayText)}}function $Z(n,t){if(1&n&&(le(0,"li"),Ye(1),pe()),2&n){const e=t.$implicit;Fe(1),Vr(" ",e," ")}}function qZ(n,t){if(1&n&&(le(0,"div")(1,"p")(2,"strong"),Ye(3),pe()(),le(4,"div"),Ye(5),pe(),le(6,"ul",19),Jt(7,$Z,2,1,"li",18),pe()()),2&n){const e=t.$implicit;Fe(3),Pi(e.situationContent.summary),Fe(2),Vr(" ",e.situationContent.description," "),Fe(2),rt("ngForOf",e.situationContent.details)}}function GZ(n,t){if(1&n&&(le(0,"div")(1,"sbb-tooltip",17),Jt(2,qZ,8,3,"div",18),pe()()),2&n){const e=rn().$implicit;Fe(2),rt("ngForOf",e.stopSituations)}}const WZ=function(n){return{"item-selected":n}};function XZ(n,t){if(1&n&&(le(0,"div",2)(1,"div",3)(2,"div",4)(3,"div",5)(4,"div",6),Ye(5),pe(),le(6,"div",7),Ye(7),pe()(),le(8,"div",8)(9,"div",9),Ye(10),pe(),Jt(11,VZ,3,2,"div",10),le(12,"div",11)(13,"span"),Ye(14),pe(),Ye(15," - "),le(16,"span"),Ye(17),pe()()(),le(18,"div",12),Jt(19,jZ,3,1,"div",13),Jt(20,HZ,6,3,"div",13),Jt(21,GZ,3,1,"div",13),pe()()()()),2&n){const e=t.$implicit,i=t.index,r=rn();rt("ngClass",_C(11,WZ,i===r.selectedIDx)),Sn("data-index",i),Fe(5),Pi(e.serviceLineNumber),Fe(2),Pi(e.tripNumber),Fe(3),Pi(e.tripHeading),Fe(1),rt("ngIf",e.stopPlatform),Fe(3),Vr("Operator: ",e.tripOperator,""),Fe(3),Vr("Type: ",e.servicePtMode,""),Fe(2),rt("ngIf",!r.hasDelay(e)),Fe(1),rt("ngIf",r.hasDelay(e)),Fe(1),rt("ngIf",r.hasSituations(e))}}let JF=(()=>{class n{constructor(e){this.stationBoardService=e,this.stopEventsData=[],this.selectedIDx=null,this.stationBoardType="Departures"}ngOnInit(){this.stationBoardService.stationBoardDataUpdated.subscribe(e=>{this.stationBoardType=e.type;const i=e.items;this.stopEventsData=[],i.forEach(r=>{const s=r.asStationBoard();this.stopEventsData.push(s)}),i.length>0?this.selectDataRowAtIndex(0):this.stationBoardService.stationBoardEntrySelected.emit(null)})}ngAfterViewInit(){var e;(null===(e=this.stationBoardWrapperRef)||void 0===e?void 0:e.nativeElement).addEventListener("click",i=>{var r,s;const d=i.target;if(null===d)return;const m=null!==(s=null===(r=d.closest(".card-item"))||void 0===r?void 0:r.getAttribute("data-index"))&&void 0!==s?s:null;if(null===m)return;const y=parseInt(m,10);this.selectedIDx!==y&&this.selectDataRowAtIndex(y)})}selectDataRowAtIndex(e){this.selectedIDx=e,this.stationBoardService.stationBoardEntrySelected.emit(this.stopEventsData[e].stopEvent)}hasDelay(e){return e.mapStationBoardTime[this.stationBoardType].hasDelay}hasDelayDifferentTime(e){return e.mapStationBoardTime[this.stationBoardType].hasDelayDifferentTime}hasSituations(e){return e.stopSituations.length>0}}return n.\u0275fac=function(e){return new(e||n)(X(tI))},n.\u0275cmp=On({type:n,selectors:[["station-board-result"]],viewQuery:function(e,i){if(1&e&&yr(NZ,5),2&e){let r;Jn(r=ei())&&(i.stationBoardWrapperRef=r.first)}},decls:3,vars:1,consts:[["stationBoardWrapper",""],["class","card card card-item mb-2",3,"ngClass",4,"ngFor","ngForOf"],[1,"card","card","card-item","mb-2",3,"ngClass"],[1,"card-body"],[1,"d-flex","dep-content","align-items-center"],[1,"service-line-number-wrapper"],[1,"service-line-number","text-center"],[1,"trip-info","text-center"],[1,"flex-fill","dep-center"],[1,"trip-heading"],["class","stop-platform-text",4,"ngIf"],[1,"trip-debug"],[1,"text-center"],[4,"ngIf"],[1,"stop-platform-text"],[1,"departure-time"],[1,"departure-delay"],["svgIcon","fpl:info"],[4,"ngFor","ngForOf"],[1,"tooltip-list"]],template:function(e,i){1&e&&(le(0,"div",null,0),Jt(2,XZ,22,13,"div",1),pe()),2&e&&(Fe(2),rt("ngForOf",i.stopEventsData))},dependencies:[Tb,Rc,js,iF],styles:[".service-line-number-wrapper[_ngcontent-%COMP%]{padding:0 16px 0 4px}.service-line-number[_ngcontent-%COMP%]{font-size:24px}.service-pt-mode[_ngcontent-%COMP%]{font-size:12px}.trip-heading[_ngcontent-%COMP%]{margin-top:2px;font-size:20px}.trip-info[_ngcontent-%COMP%]{font-size:12px}.stop-platform-wrapper[_ngcontent-%COMP%]{margin-right:4px}.stop-platform-text[_ngcontent-%COMP%]{font-size:14px}.stop-platform[_ngcontent-%COMP%]{font-size:18px}.departure-time[_ngcontent-%COMP%]{width:80px;font-size:20px}.departure-delay[_ngcontent-%COMP%]{color:#c45f00}.trip-debug[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{font-size:12px}.card-item[_ngcontent-%COMP%]{cursor:pointer}.item-selected[_ngcontent-%COMP%]{background-color:#f5f5f5}"]}),n})();function ZZ(n,t){if(1&n&&(le(0,"sbb-option",5),Ye(1),pe()),2&n){const e=t.$implicit,i=rn();rt("value",e.stopPlaceRef),Fe(1),Vr(" ",i.renderLookupName(e)," ")}}let eN=(()=>{class n{constructor(e){this.userTripService=e,this.locationSelected=new on,this.searchInputControl=new _w(""),this.stopLookups=[n.AroundMeStopLookup],this.currentStopLookup=null,this.isBusySearching=!1,this.hackIgnoreInputChangesFlag=!1}static get AroundMeStopLookup(){return{stopPlaceRef:"AROUND_ME",stopName:"Current Location",special_type:"around_me",location:null}}ngOnInit(){this.searchInputControl.valueChanges.pipe(Sv(500),Lp()).subscribe(e=>{this.onInputChangeAfterIdle()})}renderLookupName(e){let i=e.stopName;return e.distance&&(i+=" ("+e.distance+" m)"),i}onInputChangeAfterIdle(){const e=this.searchInputControl.value.trim();this.hackIgnoreInputChangesFlag?this.hackIgnoreInputChangesFlag=!1:0!==e.length?e.length<3||this.fetchLookupLocations(e):this.stopLookups=[n.AroundMeStopLookup]}fetchLookupLocations(e){this.isBusySearching=!0;const r=this.userTripService.getStageConfig();gu.initWithLocationName(r,e,"stop").fetchResponse().then(d=>{this.parseLocations(d),this.isBusySearching=!1})}parseLocations(e,i=null){this.stopLookups=[],e.forEach(r=>{var s;const d=null===(s=r.stopPlace)||void 0===s?void 0:s.stopPlaceRef;if(null===d)return;const y={stopPlaceRef:d,stopName:r.computeLocationName(),location:r};r.geoPosition&&i&&(y.distance=r.geoPosition.distanceFrom(i)),this.stopLookups.push(y)}),i&&this.stopLookups.sort((r,s)=>null==r.distance||null==s.distance?0:r.distance-s.distance),this.stopLookups=this.stopLookups.slice(0,10)}onStopLookupSelected(e){var i;const r=e.option.value;let s=null!==(i=this.stopLookups.find(m=>m.stopPlaceRef===r))&&void 0!==i?i:null;if(null===s)return void console.log("WHOOPS - cant find the stop for: "+r);if("around_me"===s.special_type)return void this.handleGeolocationLookup();this.currentStopLookup=s,this.hackIgnoreInputChangesFlag=!0,this.searchInputControl.setValue(s.stopName);const d=s.location;d&&this.locationSelected.emit(d)}handleGeolocationLookup(){navigator.geolocation?(this.hackIgnoreInputChangesFlag=!0,this.searchInputControl.setValue("... looking up location"),navigator.geolocation.getCurrentPosition(e=>{this.handleNewGeoPosition(e,i=>{var r;const s=new oa(e.coords.longitude,e.coords.latitude);this.parseLocations(i,s),null===(r=this.autocompleteInputTrigger)||void 0===r||r.openPanel()})})):console.log("no navigator.geolocation enabled")}handleNewGeoPosition(e,i){const d=e.coords.longitude-.025,m=e.coords.longitude+.025,y=e.coords.latitude+.025,T=e.coords.latitude-.025,M=this.userTripService.getStageConfig();gu.initWithBBOXAndType(M,d,y,m,T,"stop",300,null).fetchResponse().then(H=>{i(H)})}updateLocationText(e){var i,r;const s=null!==(r=null===(i=e.stopPlace)||void 0===i?void 0:i.stopPlaceName)&&void 0!==r?r:null;null!==s&&(this.hackIgnoreInputChangesFlag=!0,this.searchInputControl.setValue(s))}}return n.\u0275fac=function(e){return new(e||n)(X(Nc))},n.\u0275cmp=On({type:n,selectors:[["station-board-input"]],viewQuery:function(e,i){if(1&e&&yr(TS,7),2&e){let r;Jn(r=ei())&&(i.autocompleteInputTrigger=r.first)}},outputs:{locationSelected:"locationSelected"},decls:6,vars:4,consts:[["label","Station",1,"w-100"],["sbbInput","","type","text",3,"placeholder","formControl","sbbAutocomplete"],[3,"optionSelected"],["autocompleteTemplate","sbbAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(e,i){if(1&e&&(le(0,"div")(1,"sbb-form-field",0),bn(2,"input",1),pe(),le(3,"sbb-autocomplete",2,3),nn("optionSelected",function(s){return i.onStopLookupSelected(s)}),Jt(5,ZZ,2,2,"sbb-option",4),pe()()),2&e){const r=Zl(4);Fe(2),rt("placeholder","Type to search for stations")("formControl",i.searchInputControl)("sbbAutocomplete",r),Fe(3),rt("ngForOf",i.stopLookups)}},dependencies:[Rc,ld,gh,yw,Ev,$F,TS,Nv,Yb],encapsulation:2}),n})();function YZ(n,t){1&n&&bn(0,"span",12)}let KZ=(()=>{class n{constructor(e){this.userTripService=e,this.customRequestSaved=new on,this.customResponseSaved=new on,this.customRequestXMLs="... wait",this.customResponseXMLs="Paste custom OJP StopEventRequest Response XML here...",this.isRunningRequest=!1}parseCustomRequestXML(){this.isRunningRequest=!0;const e=this.userTripService.getStageConfig();new qb(e).fetchOJPResponse(this.customRequestXMLs,(r,s)=>{this.isRunningRequest=!1,this.customRequestSaved.emit(r)})}parseCustomResponseXML(){this.customResponseSaved.emit(this.customResponseXMLs)}}return n.\u0275fac=function(e){return new(e||n)(X(Nc))},n.\u0275cmp=On({type:n,selectors:[["custom-stop-event-popover"]],outputs:{customRequestSaved:"customRequestSaved",customResponseSaved:"customResponseSaved"},decls:26,vars:4,consts:[["sbbDialogTitle",""],["sbbDialogContent",""],[2,"width","500px"],[1,"d-flex","justify-content-between"],["target","_blank","href","https://opentransportdata.swiss/en/cookbook/ojp-stopeventservice/"],["rows","7",1,"w-100",3,"ngModel","ngModelChange"],[1,"d-flex"],["type","button",1,"btn","btn-primary",3,"disabled","click"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],["type","button",1,"btn","btn-primary",3,"click"],["sbbDialogActions",""],["type","button","sbbDialogClose","",1,"btn","btn-secondary"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"]],template:function(e,i){1&e&&(le(0,"div",0),Ye(1,"Custom StopEvent Request / Response XML"),pe(),le(2,"div",1)(3,"div",2)(4,"div",3)(5,"div"),Ye(6,"StopEvent Request XML"),pe(),le(7,"div")(8,"a",4),Ye(9,"Cookbook opentransportdata.swiss"),pe()()(),le(10,"textarea",5),nn("ngModelChange",function(s){return i.customRequestXMLs=s}),pe(),le(11,"div",6)(12,"button",7),nn("click",function(){return i.parseCustomRequestXML()}),Jt(13,YZ,1,0,"span",8),Ye(14," Execute OJP StopEvent Request "),pe()(),bn(15,"hr"),le(16,"div",3)(17,"div"),Ye(18,"StopEvent Request Response XML"),pe()(),le(19,"textarea",5),nn("ngModelChange",function(s){return i.customResponseXMLs=s}),pe(),le(20,"div",6)(21,"button",9),nn("click",function(){return i.parseCustomResponseXML()}),Ye(22," Display StopEvents "),pe()()()(),le(23,"div",10)(24,"button",11),Ye(25," Close "),pe()()),2&e&&(Fe(10),rt("ngModel",i.customRequestXMLs),Fe(2),rt("disabled",i.isRunningRequest),Fe(1),rt("ngIf",i.isRunningRequest),Fe(6),rt("ngModel",i.customResponseXMLs))},dependencies:[js,ld,gh,Ap,Zb,kv,Rv,Pv],encapsulation:2}),n})(),QZ=(()=>{class n{constructor(){this.embedHTMLs="n/a"}updateEmbedHTML(e){var i,r;const s=null!==(r=null===(i=e.stopPlace)||void 0===i?void 0:i.stopPlaceRef)&&void 0!==r?r:"n/a",d=document.location.pathname.replace("/board","/embed/board")+"?stop_id="+s,m=document.location.protocol+"//"+document.location.host+d;this.embedHTMLs='<iframe src="'+m+'" width="100%" height="100%" frameBorder="0"></iframe>'}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=On({type:n,selectors:[["embed-station-board-popover"]],decls:11,vars:1,consts:[["sbbDialogTitle",""],["sbbDialogContent",""],[2,"width","500px"],["rows","7",1,"w-100"],["sbbDialogActions",""],["type","button","sbbDialogClose","",1,"btn","btn-secondary"]],template:function(e,i){1&e&&(le(0,"div",0),Ye(1,"Embed journey in another website"),pe(),le(2,"div",1)(3,"div",2)(4,"p"),Ye(5,"Copy the following code in the target webpage"),pe(),le(6,"textarea",3),Ye(7),pe()()(),le(8,"div",4)(9,"button",5),Ye(10," Close "),pe()()),2&e&&(Fe(7),Pi(i.embedHTMLs))},dependencies:[Zb,kv,Rv,Pv],encapsulation:2}),n})();function JZ(n,t){if(1&n){const e=Ho();le(0,"div",20),nn("click",function(){return Vi(e),Gi(rn().showRequestXmlPopover())}),le(1,"span",21),Ye(2,"XML"),pe()()}}function eY(n,t){if(1&n&&(le(0,"sbb-radio-button",25),Ye(1),pe()),2&n){const e=t.$implicit;rt("value",e),Fe(1),Vr(" ",e," ")}}function tY(n,t){if(1&n){const e=Ho();le(0,"div",22)(1,"div")(2,"sbb-radio-group",23),nn("ngModelChange",function(r){return Vi(e),Gi(rn().stationBoardType=r)})("change",function(){return Vi(e),Gi(rn().onTypeChanged())}),Jt(3,eY,2,2,"sbb-radio-button",24),pe()()()}if(2&n){const e=rn();Fe(2),rt("ngModel",e.stationBoardType),Fe(1),rt("ngForOf",e.stationBoardTypes)}}function nY(n,t){if(1&n){const e=Ho();le(0,"sbb-radio-button",28),nn("change",function(r){return Vi(e),Gi(rn(2).onChangeStageAPI(r))}),Ye(1),pe()}if(2&n){const e=t.$implicit,i=rn(2);rt("value",e)("checked",i.userTripService.currentAppStage==e),Fe(1),Vr(" ",e," ")}}function iY(n,t){if(1&n&&(le(0,"div",22)(1,"div")(2,"sbb-radio-group",26),Jt(3,nY,2,3,"sbb-radio-button",27),pe()()()),2&n){const e=rn();Fe(3),rt("ngForOf",e.appStageOptions)}}function rY(n,t){1&n&&bn(0,"span",29)}function oY(n,t){if(1&n){const e=Ho();le(0,"div",30)(1,"button",31),nn("click",function(){return Vi(e),Gi(rn().loadCustomXMLPopover())}),Ye(2," Custom XML "),pe()()}}function sY(n,t){if(1&n&&(le(0,"div",0)(1,"div",1)(2,"div",32)(3,"div")(4,"a",33),Ye(5,"Open in OJP Demo App"),pe()()()()()),2&n){const e=rn();Fe(4),au("href",e.permalinkURLAddress,yc)}}function aY(n,t){if(1&n){const e=Ho();Yl(0),le(1,"div",35),Ye(2," | "),pe(),le(3,"div")(4,"a",36),nn("click",function(){return Vi(e),Gi(rn(2).loadEmbedHTMLPopover())}),Ye(5,"Embed"),pe()(),Kl()}}function lY(n,t){if(1&n&&(le(0,"div",0)(1,"div",1)(2,"div",32)(3,"div")(4,"a",33),Ye(5,"Permalink"),pe()(),Jt(6,aY,6,0,"ng-container",34),pe()()()),2&n){const e=rn();Fe(4),au("href",e.permalinkURLAddress,yc),Fe(2),rt("ngIf",null!==e.searchLocation)}}let tN=(()=>{class n{constructor(e,i,r,s,d,m,y,T){this.notificationToast=e,this.debugXmlPopover=i,this.customXmlPopover=r,this.mapService=s,this.stationBoardService=d,this.userTripService=m,this.embedHTMLPopover=y,this.router=T,this.headerText="Search",this.queryParams=new URLSearchParams(document.location.search),this.appStageOptions=["PROD","INT","TEST","LA Beta"],this.stationBoardTypes=["Departures","Arrivals"],this.stationBoardType=this.computeStationBoardType(),this.searchLocation=null,this.searchDate=this.computeSearchDateTime(),this.searchTime=Il.formatTimeHHMM(this.searchDate),this.isSearching=!1,this.permalinkURLAddress="",this.updatePermalinkURLAddress(),this.currentRequestData={requestXmlS:null,requestDatetime:null,responseXmlS:null,responseDatetime:null},this.isEmbed=-1!==this.router.url.indexOf("/embed/"),this.isEmbed&&(this.headerText=this.stationBoardType)}ngOnInit(){const e=this.queryParams.get("stage");if(e){const r=this.computeAppStageFromString(e);r&&this.userTripService.updateAppStage(r)}const i=this.queryParams.get("stop_id");i&&(this.updateCurrentRequestData(i),this.fetchStopEventsForStopRef(i),this.lookupStopPlaceRef(i)),this.stationBoardService.stationOnMapClicked.subscribe(r=>{this.handleMapClick(r)})}computeAppStageFromString(e){const i=this.appStageOptions.map(d=>d.toLowerCase()),r=e.trim(),s=i.indexOf(r.toLowerCase());return-1!==s?this.appStageOptions[s]:null}onLocationSelected(e){var i,r;const s=null!==(r=null===(i=e.stopPlace)||void 0===i?void 0:i.stopPlaceRef)&&void 0!==r?r:null;s&&this.updateCurrentRequestData(s),this.searchLocation=e,this.mapService.tryToCenterAndZoomToLocation(e),this.updatePermalinkURLAddress(),this.updateHeaderText(),this.resetResultList()}onDateTimeChanged(){const e=this.searchTime.split(":");if(2===e.length){const i=parseInt(e[0],10),r=parseInt(e[1],10);this.searchDate.setHours(i),this.searchDate.setMinutes(r)}this.updatePermalinkURLAddress()}onTypeChanged(){this.updatePermalinkURLAddress()}isSearchButtonDisabled(){return!(!this.isSearching&&null!==this.searchLocation)}searchButtonClicked(){var e,i,r;this.notificationToast.dismiss();const s=null!==(r=null===(i=null===(e=this.searchLocation)||void 0===e?void 0:e.stopPlace)||void 0===i?void 0:i.stopPlaceRef)&&void 0!==r?r:null;null!==s?this.fetchStopEventsForStopRef(s):console.error("ERROR - no stopPlaceRef available")}computeSearchDateTime(){let e=new Date;const i=this.queryParams.get("day");i&&(e=new Date(Date.parse(i)));const r=this.queryParams.get("time"),s=new Date;let d=s.getHours(),m=s.getMinutes();if(r){const y=r.split(":");2===y.length&&(d=parseInt(y[0],10),m=parseInt(y[1],10))}return e.setHours(d),e.setMinutes(m),e}computeStationBoardType(){return"arr"===this.queryParams.get("type")?"Arrivals":"Departures"}updatePermalinkURLAddress(){var e,i,r;const s=new URLSearchParams;"Arrivals"===this.stationBoardType&&s.set("type","arr");const d=null!==(r=null===(i=null===(e=this.searchLocation)||void 0===e?void 0:e.stopPlace)||void 0===i?void 0:i.stopPlaceRef)&&void 0!==r?r:null;d&&s.set("stop_id",d);const m=Il.formatDate(new Date),y=Il.formatDate(this.searchDate),T=m.substring(0,10),M=y.substring(0,10);M!==T&&s.set("day",M);const R=m.substring(11,16),H=y.substring(11,16);R!==H&&s.set("time",H);const Z=document.location.pathname.replace("/embed","")+"?"+s.toString();this.permalinkURLAddress=Z}fetchStopEventsForStopRef(e){const i=this.computeStopEventRequest(e);i.fetchResponse().then(r=>{i.lastRequestData&&(this.currentRequestData=i.lastRequestData),this.parseStopEvents(r)})}computeStopEventRequest(e){const i="Arrivals"===this.stationBoardType?"arrival":"departure",r=this.computeStopBoardDate(),s=this.userTripService.getStageConfig();return jp.initWithStopPlaceRef(s,e,i,r)}parseStopEvents(e){var i;e.length>0&&(null===(i=this.searchPanel)||void 0===i||i.close()),this.stationBoardService.stationBoardDataUpdated.emit({type:this.stationBoardType,items:e})}lookupStopPlaceRef(e){const i=this.userTripService.getStageConfig();gu.initWithStopPlaceRef(i,e).fetchResponse().then(d=>{if(0===d.length)return void console.error("ERROR - cant find stopPlaceRef with ID: "+e);const m=d[0];this.searchLocation=m,this.mapService.tryToCenterAndZoomToLocation(m),this.updatePermalinkURLAddress(),this.updateHeaderText(),this.autocompleteInputComponent&&this.autocompleteInputComponent.updateLocationText(m)})}updateHeaderText(){if(!this.isEmbed||null===this.searchLocation)return;const e=this.searchLocation.computeLocationName();null!==e&&(this.headerText=e+" "+this.stationBoardType)}handleMapClick(e){var i;const r=fs.initWithFeature(e);null!==r&&(this.searchLocation=r,this.autocompleteInputComponent&&this.autocompleteInputComponent.updateLocationText(r),this.resetResultList(),this.updatePermalinkURLAddress(),null===(i=this.searchPanel)||void 0===i||i.open())}resetResultList(){this.stationBoardService.stationBoardDataUpdated.emit({type:this.stationBoardType,items:[]})}computeStopBoardDate(){const e=this.searchDate,i=this.searchTime.split(":");if(2===i.length){const r=parseInt(i[0]),s=parseInt(i[1]);e.setHours(r),e.setMinutes(s)}return e}showRequestXmlPopover(){const e=this.debugXmlPopover.open(UD,{position:{top:"10px"}});e.afterOpened().subscribe(()=>{e.componentInstance.updateRequestData(this.currentRequestData)})}onChangeStageAPI(e){this.userTripService.updateAppStage(e.value)}loadCustomXMLPopover(){const e=this.customXmlPopover.open(KZ,{position:{top:"20px"}});e.afterOpened().subscribe(()=>{this.notificationToast.dismiss();const i=e.componentInstance;if(null===this.currentRequestData.requestXmlS){const s=this.computeStopEventRequest("8503000");this.currentRequestData.requestXmlS=s.computeRequestXmlString()}i.customRequestXMLs=this.currentRequestData.requestXmlS,i.customRequestSaved.subscribe(r=>{e.close(),this.handleCustomResponse(r)}),i.customResponseSaved.subscribe(r=>{e.close(),this.handleCustomResponse(r)})})}handleCustomResponse(e){this.currentRequestData.responseDatetime=new Date,this.currentRequestData.responseXmlS=e;const i=jp.handleResponseData(e,null);i.length>0?this.mapService.tryToCenterAndZoomToLocation(i[0].stopPoint.location):this.notificationToast.open("No StopEvents found",{type:"error",verticalPosition:"top"}),this.parseStopEvents(i)}updateCurrentRequestData(e){const i=this.computeStopEventRequest(e);this.currentRequestData.requestDatetime=new Date,this.currentRequestData.requestXmlS=i.computeRequestXmlString()}loadEmbedHTMLPopover(){const e=this.embedHTMLPopover.open(QZ,{position:{top:"20px"}});e.afterOpened().subscribe(()=>{this.searchLocation&&e.componentInstance.updateEmbedHTML(this.searchLocation)})}}return n.\u0275fac=function(e){return new(e||n)(X(CF),X(bu),X(bu),X(Up),X(tI),X(Nc),X(bu),X(Ds))},n.\u0275cmp=On({type:n,selectors:[["station-board-search"]],viewQuery:function(e,i){if(1&e&&(yr(Am,7),yr(eN,5)),2&e){let r;Jn(r=ei())&&(i.searchPanel=r.first),Jn(r=ei())&&(i.autocompleteInputComponent=r.first)}},decls:28,vars:12,consts:[[1,"row","mb-2"],[1,"col"],[3,"expanded"],[1,"d-flex","align-items-center"],[1,"flex-grow-1"],[3,"locationSelected"],["class","xml-info",3,"click",4,"ngIf"],["class","mb-3 d-flex",4,"ngIf"],[1,"d-flex"],["label","Choose Day"],["arrows",""],["sbbInput","","sbbDateInput","",3,"ngModel","ngModelChange","dateChange"],[2,"margin-left","8px"],["label","Time"],["sbbInput","","sbbTimeInput","",3,"ngModel","ngModelChange","change"],[2,"margin-right","4px"],["type","button",1,"btn","btn-primary",3,"disabled","click"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],["class","ms-auto",4,"ngIf"],["class","row mb-2",4,"ngIf"],[1,"xml-info",3,"click"],[1,"layer-xml-info","badge","bg-info","text-dark"],[1,"mb-3","d-flex"],[1,"sbb-radio-group-horizontal",3,"ngModel","ngModelChange","change"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"sbb-radio-group-horizontal"],[3,"value","checked","change",4,"ngFor","ngForOf"],[3,"value","checked","change"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"],[1,"ms-auto"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"d-flex","flex-row-reverse"],["target","_blank",3,"href"],[4,"ngIf"],["clas","text-center",2,"width","7px","margin-left","4px"],["target","_blank","role","button",1,"text-decoration-underline",3,"click"]],template:function(e,i){1&e&&(le(0,"div",0)(1,"div",1)(2,"sbb-accordion")(3,"sbb-expansion-panel",2)(4,"sbb-expansion-panel-header"),Ye(5),pe(),le(6,"div",3)(7,"div",4)(8,"station-board-input",5),nn("locationSelected",function(s){return i.onLocationSelected(s)}),pe()(),Jt(9,JZ,3,0,"div",6),pe(),Jt(10,tY,4,2,"div",7),le(11,"div",8)(12,"div")(13,"sbb-form-field",9)(14,"sbb-datepicker",10)(15,"input",11),nn("ngModelChange",function(s){return i.searchDate=s})("dateChange",function(){return i.onDateTimeChanged()}),pe()()()(),le(16,"div",12)(17,"sbb-form-field",13)(18,"input",14),nn("ngModelChange",function(s){return i.searchTime=s})("change",function(){return i.onDateTimeChanged()}),pe()()()(),Jt(19,iY,4,1,"div",7),le(20,"div",8)(21,"div",15)(22,"button",16),nn("click",function(){return i.searchButtonClicked()}),Jt(23,rY,1,0,"span",17),Ye(24," Search "),pe()(),Jt(25,oY,3,0,"div",18),pe()()()()(),Jt(26,sY,6,1,"div",19),Jt(27,lY,7,2,"div",19)),2&e&&(Fe(3),rt("expanded",!0),Fe(2),Pi(i.headerText),Fe(4),rt("ngIf",i.currentRequestData.requestXmlS&&!i.isEmbed),Fe(1),rt("ngIf",!i.isEmbed),Fe(5),rt("ngModel",i.searchDate),Fe(3),rt("ngModel",i.searchTime),Fe(1),rt("ngIf",!i.isEmbed),Fe(3),rt("disabled",i.isSearchButtonDisabled()),Fe(1),rt("ngIf",i.isSearching),Fe(2),rt("ngIf",!i.isEmbed),Fe(1),rt("ngIf",i.isEmbed),Fe(1),rt("ngIf",!i.isEmbed))},dependencies:[Rc,js,ld,gh,Ap,FD,Am,mS,KD,CS,Nv,Yb,BF,JD,VF,eN],styles:[".xml-info[_ngcontent-%COMP%]{cursor:pointer;margin-left:5px}"]}),n})();const cY=[{path:"embed/search",component:(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=On({type:n,selectors:[["embed-search"]],decls:5,vars:0,consts:[[1,"container"],[1,"row","app-root"],[1,"col"]],template:function(e,i){1&e&&(le(0,"div",0)(1,"div",1)(2,"div",2),bn(3,"app-search-form")(4,"journey-results"),pe()()())},dependencies:[oF,YF],styles:[".app-root[_ngcontent-%COMP%]{background-color:#fff;padding:8px}"]}),n})()},{path:"embed/board",component:(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=On({type:n,selectors:[["embed-search"]],decls:5,vars:0,consts:[[1,"container"],[1,"row","app-root"],[1,"col"]],template:function(e,i){1&e&&(le(0,"div",0)(1,"div",1)(2,"div",2),bn(3,"station-board-search")(4,"station-board-result"),pe()()())},dependencies:[JF,tN],styles:[".app-root[_ngcontent-%COMP%]{background-color:#fff;padding:8px}"]}),n})()},{path:"search",component:RZ},{path:"board",component:(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=On({type:n,selectors:[["station-board"]],decls:17,vars:4,consts:[[1,"container"],[1,"app-root"],["sbb-tab-nav-bar","",3,"tabPanel"],["sbb-tab-link","",3,"active","routerLink"],["sbb-tab-link","",3,"active"],["tabPanel",""],[1,"row"],[1,"col-md-4"],[1,"col-md-8"]],template:function(e,i){if(1&e&&(le(0,"div",0),bn(1,"web-header"),le(2,"div",1)(3,"nav",2)(4,"a",3),Ye(5,"Journey Search"),pe(),le(6,"a",4),Ye(7,"Station Board"),pe()(),le(8,"sbb-tab-nav-panel",null,5)(10,"div",6)(11,"div",7),bn(12,"station-board-search")(13,"station-board-result"),pe(),le(14,"div",8),bn(15,"station-board-map"),pe()()()(),bn(16,"web-footer"),pe()),2&e){const r=Zl(9);Fe(3),rt("tabPanel",r),Fe(1),rt("active","false")("routerLink","../search"),Fe(2),rt("active","true")}},dependencies:[vv,gD,A2,bD,FZ,JF,tN,KF,QF],styles:[".app-root[_ngcontent-%COMP%]{background-color:#fff;border:1px solid #CACACA;margin-left:calc(-.5 * var(--bs-gutter-x));margin-right:calc(-.5 * var(--bs-gutter-x));padding:8px}"]}),n})()},{path:"",redirectTo:"/search",pathMatch:"full"}];let uY=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({imports:[Hw.forRoot(cY),Hw]}),n})(),dY=(()=>{class n{ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=On({type:n,selectors:[["app-root"]],decls:1,vars:0,template:function(e,i){1&e&&bn(0,"router-outlet")},dependencies:[AE],encapsulation:2}),n})();Us("showDismiss",[vr("void, dismissed",Yn({height:0,paddingTop:0,paddingBottom:0,borderTopWidth:0,borderBottomWidth:0})),vr("visible",Yn({height:"*",paddingTop:"*",paddingBottom:"*",borderTopWidth:"*",borderBottomWidth:"*"})),tr("void => visible",ar("0.25s cubic-bezier(0.4,0.0,0.2,1)")),tr("visible => dismissed",ar("0.25s cubic-bezier(0.4,0.0,0.2,1)"))]);let nN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({imports:[Tr,Hw,nr,Ao]}),n})();rl(class{});let nI=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({imports:[Cm,nr]}),n})();Us("transformMenu",[vr("void",Yn({opacity:0})),vr("enter-usermenu",Yn({width:"{{width}}",maxHeight:"100%"}),{params:{width:"288px"}}),tr("void => enter",ar("120ms cubic-bezier(0, 0, 0.2, 1)",Yn({opacity:1}))),tr("enter => void",ar("100ms linear",Yn({opacity:0}))),tr("void => enter-usermenu",ar("300ms cubic-bezier(.785,.135,.15,.86)",Xy([Yn({width:"var(--sbb-menu-trigger-width)",height:"var(--sbb-menu-trigger-height)",offset:0}),Yn({width:"{{width}}",height:"*",opacity:1,maxHeight:"100%",offset:1})]))),tr("enter-usermenu => void",ar("300ms cubic-bezier(.785,.135,.15,.86)",Yn({opacity:0,width:"var(--sbb-menu-trigger-width)",height:"var(--sbb-menu-trigger-height)"})))]),new Dt("SbbMenuContent"),new Dt("SBB_MENU_PANEL"),rl(class{}),new Dt("sbb-menu-default-options",{providedIn:"root",factory:function gY(){return{overlapTrigger:!1,xPosition:"after",yPosition:"below",backdropClass:"cdk-overlay-transparent-backdrop"}}}),new Dt("sbb-menu-inherited-trigger-context");const yY={provide:new Dt("sbb-menu-scroll-strategy"),deps:[es],useFactory:function _Y(n){return()=>n.scrollStrategies.reposition()}};Pp({passive:!0}),Dm(class{});let ES=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({providers:[yY],imports:[Tr,Ml,wa,nr,Ao,Em]}),n})(),iN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({imports:[Tr,nr,ES,Ao]}),n})();new Dt("recaptcha-settings");let rN=(()=>{class n{get nativeWindow(){return function wY(){return window}()}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=tn({token:n,factory:n.\u0275fac}),n})();const SY=new Dt("recaptcha-language"),CY=new Dt("recaptcha-base-url"),TY=new Dt("recaptcha-nonce-tag");let EY=(()=>{class n{constructor(e,i,r,s,d){this._windowRef=e,this._language=r||null,this._baseUrl=s||null,this._nonce=d||null,this._document=i,this._init(),this.ready=n._ready.pipe(Rr(m=>!!m))}_init(){if(n._ready)return;this._windowRef.nativeWindow.ng2recaptchaloaded=()=>{n._ready.next(grecaptcha)},n._ready=new _a(null);const e=this._document.createElement("script");e.innerHTML="",e.src=`${this._baseUrl||"https://www.google.com/recaptcha/api.js"}?render=explicit&onload=ng2recaptchaloaded${this._language?"&hl="+this._language:""}`,this._nonce&&(e.nonce=this._nonce),e.async=!0,e.defer=!0,this._document.head.appendChild(e)}}return n._ready=null,n.\u0275fac=function(e){return new(e||n)(Ue(rN),Ue(ui),Ue(SY,8),Ue(CY,8),Ue(TY,8))},n.\u0275prov=tn({token:n,factory:n.\u0275fac}),n})(),oN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({providers:[EY,rN],imports:[Tr,nr]}),n})();const DY=["*",[["sbb-checkbox-panel-subtitle"]],[["sbb-checkbox-panel-warning"]],[["sbb-checkbox-panel-note"]]],IY=["*","sbb-checkbox-panel-subtitle","sbb-checkbox-panel-warning","sbb-checkbox-panel-note"],MY={provide:nl,useExisting:$i(()=>AY),multi:!0};let AY=(()=>{class n extends vF{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Yi(n)))(i||n)}}(),n.\u0275cmp=On({type:n,selectors:[["sbb-checkbox-panel"]],hostAttrs:[1,"sbb-checkbox-panel","sbb-selection-panel-item","sbb-checkbox","sbb-selection-item"],hostVars:8,hostBindings:function(e,i){2&e&&(Mc("id",i.id),Sn("tabindex",null),Ui("sbb-selection-indeterminate",i.indeterminate)("sbb-selection-checked",i.checked)("sbb-selection-disabled",i.disabled))},inputs:{tabIndex:"tabIndex"},exportAs:["sbbCheckboxPanel"],features:[ni([MY]),Yt],ngContentSelectors:IY,decls:16,vars:12,consts:[[1,"sbb-selection-item-label"],["type","checkbox",1,"cdk-visually-hidden","sbb-selection-input","sbb-checkbox-input","sbb-transparent-parent-overlay",3,"id","required","checked","disabled","tabIndex","change","click"],["input",""],[1,"sbb-selection-container"],[1,"sbb-selection-container-checked"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","focusable","false"],["fill","none","fill-rule","evenodd","stroke","#000","stroke-width","1","points","6 12 10 16 19 7.01"],[1,"sbb-selection-content"],[1,"sbb-selection-inner-content"],[2,"display","none"]],template:function(e,i){1&e&&($o(DY),le(0,"label",0)(1,"input",1,2),nn("change",function(s){return i._onInteractionEvent(s)})("click",function(s){return i._onInputClick(s)}),pe(),le(3,"span",3)(4,"span",4),B(),le(5,"svg",5),bn(6,"polyline",6),pe()()(),Q(),le(7,"span",7)(8,"span",8)(9,"span",9),Ye(10,"\xa0"),pe(),le(11,"span"),$r(12),pe(),$r(13,1),pe(),$r(14,2),$r(15,3),pe()()),2&e&&(Sn("for",i.inputId),Fe(1),rt("id",i.inputId)("required",i.required)("checked",i.checked)("disabled",i.disabled)("tabIndex",i.tabIndex),Sn("value",i.value)("name",i.name)("aria-label",i.ariaLabel||null)("aria-labelledby",i.ariaLabelledby)("aria-checked",i._getAriaChecked())("aria-describedby",i.ariaDescribedby))},encapsulation:2,changeDetection:0}),n})(),sN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({imports:[Tr,nr]}),n})();new Dt("SBB_CHIP_LIST"),new Dt("SBB_CHIP"),new Dt("SbbChipRemove"),new Dt("SbbChipTrailingIcon"),$b(class RY{constructor(t){this._elementRef=t}},-1);const pN=new Dt("sbb-chips-default-options");tS(class{constructor(n,t,e,i){this._defaultErrorStateMatcher=n,this._parentForm=t,this._parentFormGroup=e,this.ngControl=i,this.stateChanges=new Wt}});let fN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({providers:[{provide:pN,useValue:{separatorKeyCodes:[13]}}],imports:[Tr,nr,Ao]}),n})();new Dt("FILE_SELECTOR_OPTIONS");const ms={TEXT:["text/*"],IMAGE:["image/*"],IMAGE_JPG:["image/jpeg","image/pjpeg"],IMAGE_PNG:["image/png"],IMAGE_SVG:["image/svg+xml"],IMAGE_GIF:["image/gif"],AUDIO:["audio/*"],AUDIO_MP4:["audio/mp4"],AUDIO_MP3:["audio/mpeg","audio/mp3"],AUDIO_OGG:["audio/ogg"],AUDIO_WAVE:["audio/wave"],AUDIO_WAV:["audio/wav","audio/x-wav","audio/x-pn-wav","audio/webm"],VIDEO:["video/*"],VIDEO_MP4:["video/mp4"],VIDEO_MPEG:["video/mpeg"],VIDEO_OGG:["video/ogg"],VIDEO_MOV:["video/quicktime"],VIDEO_WEBM:["video/webm"],VIDEO_AVI:["video/x-msvideo"],VIDEO_WMV:["video/x-ms-wmv"],PDF:["application/pdf"],MS_WORD_DOC:["application/msword","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.wordprocessingml.template","application/vnd.ms-word.document.macroEnabled.12","application/vnd.ms-word.template.macroEnabled.12"],MS_EXCEL:["application/vnd.ms-excel","application/vnd.ms-excel","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.openxmlformats-officedocument.spreadsheetml.template","application/vnd.ms-excel.sheet.macroEnabled.12","application/vnd.ms-excel.template.macroEnabled.12","application/vnd.ms-excel.addin.macroEnabled.12","application/vnd.ms-excel.sheet.binary.macroEnabled.12"],MS_POWERPOINT:["application/vnd.ms-powerpoint","application/vnd.ms-powerpoint","application/vnd.ms-powerpoint","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.presentationml.template","application/vnd.openxmlformats-officedocument.presentationml.slideshow","application/vnd.ms-powerpoint.addin.macroEnabled.12","application/vnd.ms-powerpoint.presentation.macroEnabled.12","application/vnd.ms-powerpoint.presentation.macroEnabled.12","application/vnd.ms-powerpoint.slideshow.macroEnabled.12"],ZIP:["application/x-gtar","application/x-gcompress","application/compress","application/x-tar","application/x-rar-compressed","application/octet-stream","application/x-zip-compressed","application/zip-compressed","application/x-7z-compressed","application/gzip","application/zip","application/x-bzip2"]};(new Map).set("doc",[...ms.MS_WORD_DOC,...ms.MS_EXCEL,...ms.MS_POWERPOINT]).set("audio",[...ms.AUDIO_MP4,...ms.AUDIO_MP3,...ms.AUDIO_OGG,...ms.AUDIO_WAVE,...ms.AUDIO_WAV]).set("image",[...ms.IMAGE_GIF,...ms.IMAGE_JPG,...ms.IMAGE_PNG,...ms.IMAGE_SVG]).set("pdf",ms.PDF).set("video",[...ms.VIDEO_MP4,...ms.VIDEO_MPEG,...ms.VIDEO_OGG,...ms.VIDEO_MOV,...ms.VIDEO_WEBM,...ms.VIDEO_AVI,...ms.VIDEO_WMV]).set("zip",ms.ZIP),rl(class{constructor(n){this._elementRef=n}});let mN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({imports:[Tr,nr,Ao]}),n})();new Dt("SBB_HEADER"),Us("menu",[vr("open",Yn({left:0})),vr("void",Yn({left:-305,visibility:"hidden"})),tr("open => void, void => open",[ar("0.3s ease-in-out")])]);const KY={provide:new Dt("sbb-header-menu-scroll-strategy"),deps:[es],useFactory:function YY(n){return()=>n.scrollStrategies.reposition()}};Pp({passive:!0}),rl(class{});let gN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({providers:[KY],imports:[Tr,Xw,Ml,wa,nr,Ao]}),n})();function QY(n,t){}function JY(n,t){}class rI{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.ariaModal=!0,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.closeOnNavigation=!0,this.closeOnDestroy=!0}}let eK=(()=>{class n extends Cv{constructor(e,i,r,s,d,m,y,T){super(),this._elementRef=e,this._focusTrapFactory=i,this._config=s,this._interactivityChecker=d,this._ngZone=m,this._overlayRef=y,this._focusMonitor=T,this._elementFocusedBeforeDialogWasOpened=null,this._closeInteractionType=null,this.attachDomPortal=M=>{this._portalOutlet.hasAttached();const R=this._portalOutlet.attachDomPortal(M);return this._contentAttached(),R},this._ariaLabelledBy=this._config.ariaLabelledBy||null,this._document=r}_contentAttached(){this._initializeFocusTrap(),this._handleBackdropClicks(),this._captureInitialFocus()}_captureInitialFocus(){this._trapFocus()}ngOnDestroy(){this._restoreFocus()}attachComponentPortal(e){this._portalOutlet.hasAttached();const i=this._portalOutlet.attachComponentPortal(e);return this._contentAttached(),i}attachTemplatePortal(e){this._portalOutlet.hasAttached();const i=this._portalOutlet.attachTemplatePortal(e);return this._contentAttached(),i}_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(e,i){this._interactivityChecker.isFocusable(e)||(e.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{const r=()=>{e.removeEventListener("blur",r),e.removeEventListener("mousedown",r),e.removeAttribute("tabindex")};e.addEventListener("blur",r),e.addEventListener("mousedown",r)})),e.focus(i)}_focusByCssSelector(e,i){let r=this._elementRef.nativeElement.querySelector(e);r&&this._forceFocus(r,i)}_trapFocus(){const e=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||e.focus();break;case!0:case"first-tabbable":this._focusTrap.focusInitialElementWhenReady().then(i=>{i||this._focusDialogContainer()});break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this._config.autoFocus)}}_restoreFocus(){const e=this._config.restoreFocus;let i=null;if("string"==typeof e?i=this._document.querySelector(e):"boolean"==typeof e?i=e?this._elementFocusedBeforeDialogWasOpened:null:e&&(i=e),this._config.restoreFocus&&i&&"function"==typeof i.focus){const r=pu(),s=this._elementRef.nativeElement;(!r||r===this._document.body||r===s||s.contains(r))&&(this._focusMonitor?(this._focusMonitor.focusVia(i,this._closeInteractionType),this._closeInteractionType=null):i.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){const e=this._elementRef.nativeElement,i=pu();return e===i||e.contains(i)}_initializeFocusTrap(){this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=pu())}_handleBackdropClicks(){this._overlayRef.backdropClick().subscribe(()=>{this._config.disableClose&&this._recaptureFocus()})}}return n.\u0275fac=function(e){return new(e||n)(X(zn),X(Ub),X(ui,8),X(rI),X(Sm),X(di),X(Hp),X(Pa))},n.\u0275cmp=On({type:n,selectors:[["cdk-dialog-container"]],viewQuery:function(e,i){if(1&e&&yr(dd,7),2&e){let r;Jn(r=ei())&&(i._portalOutlet=r.first)}},hostAttrs:["tabindex","-1",1,"cdk-dialog-container"],hostVars:6,hostBindings:function(e,i){2&e&&Sn("id",i._config.id||null)("role",i._config.role)("aria-modal",i._config.ariaModal)("aria-labelledby",i._config.ariaLabel?null:i._ariaLabelledBy)("aria-label",i._config.ariaLabel)("aria-describedby",i._config.ariaDescribedBy||null)},features:[Yt],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(e,i){1&e&&Jt(0,QY,0,0,"ng-template",0)},dependencies:[dd],styles:[".cdk-dialog-container{display:block;width:100%;height:100%;min-height:inherit;max-height:inherit}"],encapsulation:2}),n})();class oI{constructor(t,e){this.overlayRef=t,this.config=e,this.closed=new Wt,this.disableClose=e.disableClose,this.backdropClick=t.backdropClick(),this.keydownEvents=t.keydownEvents(),this.outsidePointerEvents=t.outsidePointerEvents(),this.id=e.id,this.keydownEvents.subscribe(i=>{27===i.keyCode&&!this.disableClose&&!xa(i)&&(i.preventDefault(),this.close(void 0,{focusOrigin:"keyboard"}))}),this.backdropClick.subscribe(()=>{this.disableClose||this.close(void 0,{focusOrigin:"mouse"})})}close(t,e){if(this.containerInstance){const i=this.closed;this.containerInstance._closeInteractionType=(null==e?void 0:e.focusOrigin)||"program",this.overlayRef.dispose(),i.next(t),i.complete(),this.componentInstance=this.containerInstance=null}}updatePosition(){return this.overlayRef.updatePosition(),this}updateSize(t="",e=""){return this.overlayRef.updateSize({width:t,height:e}),this}addPanelClass(t){return this.overlayRef.addPanelClass(t),this}removePanelClass(t){return this.overlayRef.removePanelClass(t),this}}const bN=new Dt("DialogScrollStrategy"),tK=new Dt("DialogData"),nK=new Dt("DefaultDialogConfig"),rK={provide:bN,deps:[es],useFactory:function iK(n){return()=>n.scrollStrategies.block()}};let oK=0,sK=(()=>{class n{constructor(e,i,r,s,d,m){this._overlay=e,this._injector=i,this._defaultOptions=r,this._parentDialog=s,this._overlayContainer=d,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new Wt,this._afterOpenedAtThisLevel=new Wt,this._ariaHiddenElements=new Map,this.afterAllClosed=pm(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(Hs(void 0))),this._scrollStrategy=m}get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}open(e,i){const r=this._defaultOptions||new rI;(i=Object.assign(Object.assign({},r),i)).id=i.id||"cdk-dialog-"+oK++,i.id&&this.getDialogById(i.id);const s=this._getOverlayConfig(i),d=this._overlay.create(s),m=new oI(d,i),y=this._attachContainer(d,m,i);return m.containerInstance=y,this._attachDialogContent(e,m,y,i),this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(m),m.closed.subscribe(()=>this._removeOpenDialog(m,!0)),this.afterOpened.next(m),m}closeAll(){sI(this.openDialogs,e=>e.close())}getDialogById(e){return this.openDialogs.find(i=>i.id===e)}ngOnDestroy(){sI(this._openDialogsAtThisLevel,e=>{!1===e.config.closeOnDestroy&&this._removeOpenDialog(e,!1)}),sI(this._openDialogsAtThisLevel,e=>e.close()),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete(),this._openDialogsAtThisLevel=[]}_getOverlayConfig(e){const i=new km({positionStrategy:e.positionStrategy||this._overlay.position().global().centerHorizontally().centerVertically(),scrollStrategy:e.scrollStrategy||this._scrollStrategy(),panelClass:e.panelClass,hasBackdrop:e.hasBackdrop,direction:e.direction,minWidth:e.minWidth,minHeight:e.minHeight,maxWidth:e.maxWidth,maxHeight:e.maxHeight,width:e.width,height:e.height,disposeOnNavigation:e.closeOnNavigation});return e.backdropClass&&(i.backdropClass=e.backdropClass),i}_attachContainer(e,i,r){var s;const d=r.injector||(null===(s=r.viewContainerRef)||void 0===s?void 0:s.injector),m=[{provide:rI,useValue:r},{provide:oI,useValue:i},{provide:Hp,useValue:e}];let y;r.container?"function"==typeof r.container?y=r.container:(y=r.container.type,m.push(...r.container.providers(r))):y=eK;const T=new ud(y,r.viewContainerRef,Xr.create({parent:d||this._injector,providers:m}),r.componentFactoryResolver);return e.attach(T).instance}_attachDialogContent(e,i,r,s){if(e instanceof ho){const d=this._createInjector(s,i,r,void 0);let m={$implicit:s.data,dialogRef:i};s.templateContext&&(m=Object.assign(Object.assign({},m),"function"==typeof s.templateContext?s.templateContext():s.templateContext)),r.attachTemplatePortal(new Tm(e,null,m,d))}else{const d=this._createInjector(s,i,r,this._injector),m=r.attachComponentPortal(new ud(e,s.viewContainerRef,d,s.componentFactoryResolver));i.componentInstance=m.instance}}_createInjector(e,i,r,s){var d;const m=e.injector||(null===(d=e.viewContainerRef)||void 0===d?void 0:d.injector),y=[{provide:tK,useValue:e.data},{provide:oI,useValue:i}];return e.providers&&("function"==typeof e.providers?y.push(...e.providers(i,e,r)):y.push(...e.providers)),e.direction&&(!m||!m.get(Fp,null,ri.Optional))&&y.push({provide:Fp,useValue:{value:e.direction,change:qn()}}),Xr.create({parent:m||s,providers:y})}_removeOpenDialog(e,i){const r=this.openDialogs.indexOf(e);r>-1&&(this.openDialogs.splice(r,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((s,d)=>{s?d.setAttribute("aria-hidden",s):d.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),i&&this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){const e=this._overlayContainer.getContainerElement();if(e.parentElement){const i=e.parentElement.children;for(let r=i.length-1;r>-1;r--){const s=i[r];s!==e&&"SCRIPT"!==s.nodeName&&"STYLE"!==s.nodeName&&!s.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(s,s.getAttribute("aria-hidden")),s.setAttribute("aria-hidden","true"))}}}_getAfterAllClosed(){const e=this._parentDialog;return e?e._getAfterAllClosed():this._afterAllClosedAtThisLevel}}return n.\u0275fac=function(e){return new(e||n)(Ue(es),Ue(Xr),Ue(nK,8),Ue(n,12),Ue(Wb),Ue(bN))},n.\u0275prov=tn({token:n,factory:n.\u0275fac}),n})();function sI(n,t){let e=n.length;for(;e--;)t(n[e])}let aK=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({providers:[sK,rK],imports:[Ml,wa,Cm,wa]}),n})();const DS={params:{enterAnimationDuration:"150ms",exitAnimationDuration:"75ms"}},lK={lightboxContainer:Us("lightboxContainer",[vr("void, exit",Yn({opacity:0,transform:"scale(0.7)"})),vr("enter",Yn({transform:"none"})),tr("* => enter",ar("{{enterAnimationDuration}} cubic-bezier(0, 0, 0.2, 1)",Yn({transform:"none",opacity:1})),DS),tr("* => void, * => exit",ar("{{exitAnimationDuration}} cubic-bezier(0.4, 0.0, 0.2, 1)",Yn({opacity:0})),DS)])};let cK=(()=>{class n extends dF{constructor(e,i,r,s,d,m,y,T,M,R){var H;super(e,i,r,s,d,m,y,M),this._changeDetectorRef=T,this._viewportRuler=R,this._destroyed=new Wt,null===(H=this._viewportRuler)||void 0===H||H.change().pipe(Hi(this._destroyed),Hs(null)).subscribe(()=>{this._height=this._viewportRuler.getViewportSize().height})}_onAnimationDone({toState:e,totalTime:i}){"enter"===e?(this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:i})):"exit"===e&&this._animationStateChanged.next({state:"closed",totalTime:i})}_onAnimationStart({toState:e,totalTime:i}){"enter"===e?this._animationStateChanged.next({state:"opening",totalTime:i}):("exit"===e||"void"===e)&&this._animationStateChanged.next({state:"closing",totalTime:i})}_startExitAnimation(){this._state="exit",this._changeDetectorRef.markForCheck()}ngOnDestroy(){super.ngOnDestroy(),this._destroyed.next(),this._destroyed.complete()}}return n.\u0275fac=function(e){return new(e||n)(X(zn),X(Ub),X(ui,8),X(Av),X(Sm),X(di),X(Hp),X(kr),X(Pa),X(mu))},n.\u0275cmp=On({type:n,selectors:[["sbb-lightbox-container"]],hostAttrs:["tabindex","-1","aria-modal","true",1,"sbb-lightbox-container"],hostVars:8,hostBindings:function(e,i){1&e&&My("@lightboxContainer.done",function(s){return i._onAnimationDone(s)})("@lightboxContainer.start",function(s){return i._onAnimationStart(s)}),2&e&&(Mc("id",i._config.id),Sn("role",i._config.role)("aria-labelledby",i._config.ariaLabel?null:i._ariaLabelledBy)("aria-label",i._config.ariaLabel)("aria-describedby",i._config.ariaDescribedBy||null),ky("@lightboxContainer",i._getAnimationState()),ed("height",i._height,"px"))},features:[Yt],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(e,i){1&e&&Jt(0,JY,0,0,"ng-template",0)},dependencies:[dd],styles:[".sbb-overlay-background{background-color:var(--sbb-color-white-alpha70);align-items:center}.sbb-lightbox-container{display:flex;flex-direction:column;box-sizing:border-box;overflow:hidden;outline:0;background-color:var(--sbb-color-background);width:100%;height:100vh}.cdk-high-contrast-active .sbb-lightbox-container{outline:solid .0666666667rem}.sbb-lightbox-container>*:only-child:not(.sbb-lightbox-content){width:100%;height:100%;display:flex;flex-direction:column}.sbb-lightbox-content{display:block;padding:var(--sbb-divider-big) var(--sbb-lightbox-padding-horizontal);flex:1 1 auto;overflow:auto;-webkit-overflow-scrolling:touch}.sbb-lightbox-content>*:first-child{margin-top:0}.sbb-lightbox-title{padding:calc(1.4rem * var(--sbb-scaling-factor)) 3.7333333333rem calc(1.1333333333rem * var(--sbb-scaling-factor)) 1.3333333333rem;flex:0 0 auto;font-size:var(--sbb-font-size);line-height:var(--sbb-line-height);display:block;position:relative;box-shadow:var(--sbb-box-shadow-horizontal-border-top);overflow:hidden;white-space:nowrap;text-overflow:ellipsis;min-height:calc(4.2666666667rem * var(--sbb-scaling-factor))}@media all and (min-width: 40.1875em){.sbb-lightbox-title{padding-left:1.6rem;padding-right:4rem}}@media all and (min-width: 64.0625em){.sbb-lightbox-title{padding-left:calc(5.3333333333rem * var(--sbb-scaling-factor));padding-right:calc(6.1333333333rem * var(--sbb-scaling-factor))}}@media all and (min-width: 160.0625em)and (max-width: 240.0525em){:where(html:not(.sbb-lean)) .sbb-lightbox-title{padding-top:1.8666666667rem;padding-bottom:1.8666666667rem}}.sbb-lightbox-title-close-button{position:absolute;right:1.3333333333rem;cursor:pointer;line-height:0;color:var(--sbb-color-storm);outline:0}.sbb-lightbox-title-close-button:is(:hover,:focus){color:var(--sbb-color-call-to-action-hover)}@media all and (min-width: 40.1875em){.sbb-lightbox-title-close-button{right:1.6rem}}@media all and (min-width: 64.0625em){.sbb-lightbox-title-close-button{right:calc(3.7333333333rem * var(--sbb-scaling-factor))}}.sbb-lightbox-actions{padding:var(--sbb-lightbox-actions-padding-vertical) var(--sbb-lightbox-padding-horizontal);display:flex;flex:0 0 auto;flex-flow:column wrap;gap:var(--sbb-button-gap);align-items:center;justify-content:space-between;box-sizing:content-box;box-shadow:var(--sbb-box-shadow-horizontal-border-bottom)}@media all and (min-width: 40.1875em){.sbb-lightbox-actions{flex-direction:row}}"],encapsulation:2,data:{animation:[lK.lightboxContainer]}}),n})();class uK extends bS{constructor(t,e,i){super(t,e,i),this.closeRequest=new Wt,t.overlayRef.keydownEvents().pipe(Rr(r=>27===r.keyCode&&!!this.disableClose&&!xa(r))).subscribe(()=>this.closeRequest.next(null)),t.overlayRef.detachments().subscribe(()=>{this.closeRequest.complete()})}updatePosition(){return this}updateSize(){return this}}const dK=new Dt("SbbLightboxData"),hK=new Dt("sbb-lightbox-default-options"),_N=new Dt("sbb-lightbox-scroll-strategy"),fK={provide:_N,deps:[es],useFactory:function pK(n){return()=>n.scrollStrategies.block()}};let mK=0,gK=(()=>{class n extends fF{constructor(e,i,r,s,d,m){super(e,i,r,d,m,s,uK,cK,dK),this._idPrefix="sbb-lightbox-"}get openLightboxes(){return this.openDialogs}open(e,i){const r=Object.assign(Object.assign({},i),{width:"100vw",minWidth:"100vw",maxWidth:"100vw",height:"auto",minHeight:"auto",maxHeight:"none"});return r.id=r.id||`${this._idPrefix}${mK++}`,super.open(e,r)}getDialogById(e){return this.openDialogs.find(i=>i.id===e)}getLightboxById(e){return this.getDialogById(e)}}return n.\u0275fac=function(e){return new(e||n)(Ue(es),Ue(Xr),Ue(hK,8),Ue(_N),Ue(n,12),Ue(Wb))},n.\u0275prov=tn({token:n,factory:n.\u0275fac}),n})(),yN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({providers:[gK,fK],imports:[Tr,aK,jD,Ml,wa,nr,Ao]}),n})(),vN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({imports:[Tr,nr]}),n})();Us("showDismiss",[vr("void, dismissed",Yn({height:0,paddingTop:0,paddingBottom:0,borderTopWidth:0,borderBottomWidth:0})),vr("visible",Yn({height:"*",paddingTop:"*",paddingBottom:"*",borderTopWidth:"*",borderBottomWidth:"*"})),tr("visible => dismissed",ar("0.25s cubic-bezier(0.4,0.0,0.2,1)"))]),Dm(class{});let xN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({imports:[Tr,nr,Ao]}),n})();new Dt("SBB_PAGINATOR_DEFAULT_OPTIONS"),rl(m2(class{}));let wN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({imports:[Tr,Hw,nr,Ao]}),n})(),xK=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({imports:[eS]}),n})();Us("stepTransition",[tr("* => previous, * => next",[Yn({opacity:1}),ar("150ms ease",Yn({opacity:0}))]),tr("previous => current, next => current",[Yn({opacity:0}),ar("500ms ease",Yn({opacity:1}))]),tr("void => current",ar("0s"))]);let SN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({imports:[Tr,wa,xK,nr,Ao]}),n})(),CN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({imports:[Tr,nr,eI]}),n})();Us("growShrink",[vr("void",Yn({opacity:0,width:"0px"})),vr("open",Yn({opacity:1,width:"*"})),tr("void => *",ar("300ms ease")),tr("* => void",ar("300ms 25ms linear"))]);const EK={provide:new Dt("sbb-select-scroll-strategy"),deps:[es],useFactory:function TK(n){return()=>n.scrollStrategies.reposition()}};["start","center","end"].map(n=>({originX:n,originY:"top",overlayX:n,overlayY:"top"}));let TN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({providers:[EK],imports:[Tr,wa,Ml,nr,qD,Ao]}),n})();new Dt("SBB_SIDEBAR_CONTAINER"),Us("transform",[vr("open, open-instant",Yn({transform:"none",visibility:"visible"})),vr("void",Yn({"box-shadow":"none",visibility:"hidden"})),tr("void => open-instant",ar("0ms")),tr("void <=> open, open-instant => void",ar("300ms cubic-bezier(0.785, 0.135, 0.15, 0.86)"))]);let EN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({imports:[Tr,Em,nr,Ao,Em]}),n})(),DN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({imports:[Tr,nr,Ao]}),n})(),jK=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({imports:[lD]}),n})();new Dt("SBB_SORT_DEFAULT_OPTIONS"),m2(rl(class{}));const e_="225ms cubic-bezier(0.4,0.0,0.2,1)";Us("indicator",[vr("active-asc, asc",Yn({transform:"scaleY(-1)"})),vr("active-desc, desc",Yn({transform:"scaleY(1)"})),tr("active-asc <=> active-desc",ar(e_)),tr("asc <=> desc",ar("0ms"))]),Us("arrowOpacity",[vr("desc-to-active, asc-to-active, active",Yn({opacity:1})),vr("desc-to-hint, asc-to-hint, hint",Yn({opacity:.54})),vr("hint-to-desc, active-to-desc, desc, hint-to-asc, active-to-asc, asc, void",Yn({opacity:0})),tr("* => asc, * => desc, * => active, * => hint, * => void",ar("0ms")),tr("* <=> *",ar(e_))]),Us("arrowPosition",[tr("* => desc-to-hint, * => desc-to-active",ar(e_,Xy([Yn({transform:"translateY(-25%)"}),Yn({transform:"translateY(0)"})]))),tr("* => hint-to-desc, * => active-to-desc",ar(e_,Xy([Yn({transform:"translateY(0)"}),Yn({transform:"translateY(25%)"})]))),tr("* => asc-to-hint, * => asc-to-active",ar(e_,Xy([Yn({transform:"translateY(25%)"}),Yn({transform:"translateY(0)"})]))),tr("* => hint-to-asc, * => active-to-asc",ar(e_,Xy([Yn({transform:"translateY(0)"}),Yn({transform:"translateY(-25%)"})]))),vr("desc-to-hint, asc-to-hint, hint, desc-to-active, asc-to-active, active",Yn({transform:"translateY(0)"})),vr("hint-to-desc, active-to-desc, desc",Yn({transform:"translateY(-25%)"})),vr("hint-to-asc, active-to-asc, asc",Yn({transform:"translateY(25%)"}))]),Us("allowChildren",[tr("* <=> *",[pT("@*",hT(),{optional:!0})])]),rl(class{}),Pp({passive:!0});let VN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({imports:[jK,Tr,nr]}),n})(),jN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({imports:[Tr,nr,nI]}),n})();tS(class{constructor(n,t,e,i){this._defaultErrorStateMatcher=n,this._parentForm=t,this._parentFormGroup=e,this.ngControl=i,this.stateChanges=new Wt}});let UN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({imports:[Tr,WD,nr]}),n})(),HN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({imports:[Tr,nr]}),n})();const $N="225ms cubic-bezier(0.785, 0.135, 0.15, 0.86)";Us("translateHeight",[vr("void",Yn({height:0,paddingTop:0,paddingBottom:0})),vr("auto",Yn({height:"*",paddingTop:"*",paddingBottom:"*"})),tr("fixed => auto, initial => auto, * => void",[Yn({height:"{{currentHeight}}px"}),ar($N)]),tr("void => fixed, void => auto",ar($N)),tr("void => initial",ar(0))]);let qN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({imports:[Tr,wa,nr,Ao]}),n})();Dm(class{});let GN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({imports:[Tr,nr,Ao,ES]}),n})();const EQ=[j2,nN,GF,nI,iN,qD,oN,wF,sN,fN,LF,jD,mN,wS,gN,Ao,AF,yN,vN,ES,xN,$D,wN,SN,eI,CN,TN,ZF,EN,DN,VN,k2,jN,UN,HN,jF,qN,rF,GN];let DQ=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n}),n.\u0275inj=Nn({imports:[EQ,j2,nN,GF,nI,iN,qD,oN,wF,sN,fN,LF,jD,mN,wS,gN,Ao,AF,yN,vN,ES,xN,$D,wN,SN,eI,CN,TN,ZF,EN,DN,VN,k2,jN,UN,HN,jF,qN,rF,GN]}),n})(),IQ=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ln({type:n,bootstrap:[dY]}),n.\u0275inj=Nn({imports:[uR,Q4,hU,uY,bH,_H,DQ]}),n})();(function cV(){ak=!1})(),j6().bootstrapModule(IQ).catch(n=>console.error(n))},401:(un,In)=>{"use strict";function ze(he,ft){return void 0===ft&&(ft=Object),ft&&"function"==typeof ft.freeze?ft.freeze(he):he}var Ve=ze({HTML:"text/html",isHTML:function(he){return he===Ve.HTML},XML_APPLICATION:"application/xml",XML_TEXT:"text/xml",XML_XHTML_APPLICATION:"application/xhtml+xml",XML_SVG_IMAGE:"image/svg+xml"}),p=ze({HTML:"http://www.w3.org/1999/xhtml",isHTML:function(he){return he===p.HTML},SVG:"http://www.w3.org/2000/svg",XML:"http://www.w3.org/XML/1998/namespace",XMLNS:"http://www.w3.org/2000/xmlns/"});In.assign=function je(he,ft){if(null===he||"object"!=typeof he)throw new TypeError("target is not an object");for(var qe in ft)Object.prototype.hasOwnProperty.call(ft,qe)&&(he[qe]=ft[qe]);return he},In.find=function tt(he,ft,qe){if(void 0===qe&&(qe=Array.prototype),he&&"function"==typeof qe.find)return qe.find.call(he,ft);for(var Xe=0;Xe<he.length;Xe++)if(Object.prototype.hasOwnProperty.call(he,Xe)){var Qe=he[Xe];if(ft.call(void 0,Qe,Xe,he))return Qe}},In.freeze=ze,In.MIME_TYPE=Ve,In.NAMESPACE=p},991:(un,In,tt)=>{var je=tt(401),Ve=tt(853),p=tt(436),he=tt(702),ft=Ve.DOMImplementation,qe=je.NAMESPACE,Xe=he.ParseError,Qe=he.XMLReader;function St(Rt){return Rt.replace(/\r[\n\u0085]/g,"\n").replace(/[\r\u0085\u2028]/g,"\n")}function Ct(Rt){this.options=Rt||{locator:{}}}function ut(){this.cdata=!1}function jt(Rt,Dn){Dn.lineNumber=Rt.lineNumber,Dn.columnNumber=Rt.columnNumber}function _n(Rt){if(Rt)return"\n@"+(Rt.systemId||"")+"#[line:"+Rt.lineNumber+",col:"+Rt.columnNumber+"]"}function He(Rt,Dn,Ie){return"string"==typeof Rt?Rt.substr(Dn,Ie):Rt.length>=Dn+Ie||Dn?new java.lang.String(Rt,Dn,Ie)+"":Rt}function Fn(Rt,Dn){Rt.currentElement?Rt.currentElement.appendChild(Dn):Rt.doc.appendChild(Dn)}Ct.prototype.parseFromString=function(Rt,Dn){var Ie=this.options,ye=new Qe,ge=Ie.domBuilder||new ut,oe=Ie.errorHandler,Ge=Ie.locator,Be=Ie.xmlns||{},K=/\/x?html?$/.test(Dn),Me=K?p.HTML_ENTITIES:p.XML_ENTITIES;return Ge&&ge.setDocumentLocator(Ge),ye.errorHandler=function Ze(Rt,Dn,Ie){if(!Rt){if(Dn instanceof ut)return Dn;Rt=Dn}var ye={},ge=Rt instanceof Function;function oe(Ge){var Be=Rt[Ge];!Be&&ge&&(Be=2==Rt.length?function(K){Rt(Ge,K)}:Rt),ye[Ge]=Be&&function(K){Be("[xmldom "+Ge+"]\t"+K+_n(Ie))}||function(){}}return Ie=Ie||{},oe("warning"),oe("error"),oe("fatalError"),ye}(oe,ge,Ge),ye.domBuilder=Ie.domBuilder||ge,K&&(Be[""]=qe.HTML),Be.xml=Be.xml||qe.XML,Rt&&"string"==typeof Rt?ye.parse((Ie.normalizeLineEndings||St)(Rt),Be,Me):ye.errorHandler.error("invalid doc source"),ge.doc},ut.prototype={startDocument:function(){this.doc=(new ft).createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(Rt,Dn,Ie,ye){var ge=this.doc,oe=ge.createElementNS(Rt,Ie||Dn),Ge=ye.length;Fn(this,oe),this.currentElement=oe,this.locator&&jt(this.locator,oe);for(var Be=0;Be<Ge;Be++){Rt=ye.getURI(Be);var K=ye.getValue(Be),Me=(Ie=ye.getQName(Be),ge.createAttributeNS(Rt,Ie));this.locator&&jt(ye.getLocator(Be),Me),Me.value=Me.nodeValue=K,oe.setAttributeNode(Me)}},endElement:function(Rt,Dn,Ie){this.currentElement=this.currentElement.parentNode},startPrefixMapping:function(Rt,Dn){},endPrefixMapping:function(Rt){},processingInstruction:function(Rt,Dn){var Ie=this.doc.createProcessingInstruction(Rt,Dn);this.locator&&jt(this.locator,Ie),Fn(this,Ie)},ignorableWhitespace:function(Rt,Dn,Ie){},characters:function(Rt,Dn,Ie){if(Rt=He.apply(this,arguments)){if(this.cdata)var ye=this.doc.createCDATASection(Rt);else ye=this.doc.createTextNode(Rt);this.currentElement?this.currentElement.appendChild(ye):/^\s*$/.test(Rt)&&this.doc.appendChild(ye),this.locator&&jt(this.locator,ye)}},skippedEntity:function(Rt){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(Rt){(this.locator=Rt)&&(Rt.lineNumber=0)},comment:function(Rt,Dn,Ie){Rt=He.apply(this,arguments);var ye=this.doc.createComment(Rt);this.locator&&jt(this.locator,ye),Fn(this,ye)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(Rt,Dn,Ie){var ye=this.doc.implementation;if(ye&&ye.createDocumentType){var ge=ye.createDocumentType(Rt,Dn,Ie);this.locator&&jt(this.locator,ge),Fn(this,ge),this.doc.doctype=ge}},warning:function(Rt){console.warn("[xmldom warning]\t"+Rt,_n(this.locator))},error:function(Rt){console.error("[xmldom error]\t"+Rt,_n(this.locator))},fatalError:function(Rt){throw new Xe(Rt,this.locator)}},"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(Rt){ut.prototype[Rt]=function(){return null}}),In.DOMParser=Ct},853:(un,In,tt)=>{var ze=tt(401),je=ze.find,Ve=ze.NAMESPACE;function p(Y){return""!==Y}function ft(Y,ee){return Y.hasOwnProperty(ee)||(Y[ee]=!0),Y}function qe(Y){if(!Y)return[];var ee=function he(Y){return Y?Y.split(/[\t\n\f\r ]+/).filter(p):[]}(Y);return Object.keys(ee.reduce(ft,{}))}function Qe(Y,ee){for(var De in Y)Object.prototype.hasOwnProperty.call(Y,De)&&(ee[De]=Y[De])}function St(Y,ee){var De=Y.prototype;if(!(De instanceof ee)){let Kt=function(){};Kt.prototype=ee.prototype,Kt=new Kt,Qe(De,Kt),Y.prototype=De=Kt}De.constructor!=Y&&("function"!=typeof Y&&console.error("unknown Class:"+Y),De.constructor=Y)}var Ct={},Ze=Ct.ELEMENT_NODE=1,ut=Ct.ATTRIBUTE_NODE=2,jt=Ct.TEXT_NODE=3,_n=Ct.CDATA_SECTION_NODE=4,He=Ct.ENTITY_REFERENCE_NODE=5,Fn=Ct.ENTITY_NODE=6,Rt=Ct.PROCESSING_INSTRUCTION_NODE=7,Dn=Ct.COMMENT_NODE=8,Ie=Ct.DOCUMENT_NODE=9,ye=Ct.DOCUMENT_TYPE_NODE=10,ge=Ct.DOCUMENT_FRAGMENT_NODE=11,oe=Ct.NOTATION_NODE=12,Ge={},Be={},$e=(Ge.INDEX_SIZE_ERR=(Be[1]="Index size error",1),Ge.DOMSTRING_SIZE_ERR=(Be[2]="DOMString size error",2),Ge.HIERARCHY_REQUEST_ERR=(Be[3]="Hierarchy request error",3)),Mt=(Ge.WRONG_DOCUMENT_ERR=(Be[4]="Wrong document",4),Ge.INVALID_CHARACTER_ERR=(Be[5]="Invalid character",5),Ge.NO_DATA_ALLOWED_ERR=(Be[6]="No data allowed",6),Ge.NO_MODIFICATION_ALLOWED_ERR=(Be[7]="No modification allowed",7),Ge.NOT_FOUND_ERR=(Be[8]="Not found",8)),vn=(Ge.NOT_SUPPORTED_ERR=(Be[9]="Not supported",9),Ge.INUSE_ATTRIBUTE_ERR=(Be[10]="Attribute in use",10));function Cn(Y,ee){if(ee instanceof Error)var De=ee;else De=this,Error.call(this,Be[Y]),this.message=Be[Y],Error.captureStackTrace&&Error.captureStackTrace(this,Cn);return De.code=Y,ee&&(this.message=this.message+": "+ee),De}function bt(){}function dn(Y,ee){this._node=Y,this._refresh=ee,$t(this)}function $t(Y){var ee=Y._node._inc||Y._node.ownerDocument._inc;if(Y._inc!=ee){var De=Y._refresh(Y._node);Ti(Y,"length",De.length),Qe(De,Y),Y._inc=ee}}function Wi(){}function vi(Y,ee){for(var De=Y.length;De--;)if(Y[De]===ee)return De}function Pn(Y,ee,De,gt){if(gt?ee[vi(ee,gt)]=De:ee[ee.length++]=De,Y){De.ownerElement=Y;var Kt=Y.ownerDocument;Kt&&(gt&&ko(Kt,Y,gt),function Tn(Y,ee,De){Y&&Y._inc++,De.namespaceURI===Ve.XMLNS&&(ee._nsMap[De.prefix?De.localName:""]=De.value)}(Kt,Y,De))}}function ln(Y,ee,De){var gt=vi(ee,De);if(!(gt>=0))throw new Cn(Mt,new Error(Y.tagName+"@"+De));for(var Kt=ee.length-1;gt<Kt;)ee[gt]=ee[++gt];if(ee.length=Kt,Y){var Zn=Y.ownerDocument;Zn&&(ko(Zn,Y,De),De.ownerElement=null)}}function Fo(){}function zi(){}function pn(Y){return("<"==Y?"&lt;":">"==Y&&"&gt;")||"&"==Y&&"&amp;"||'"'==Y&&"&quot;"||"&#"+Y.charCodeAt()+";"}function Xi(Y,ee){if(ee(Y))return!0;if(Y=Y.firstChild)do{if(Xi(Y,ee))return!0}while(Y=Y.nextSibling)}function jr(){this.ownerDocument=this}function ko(Y,ee,De,gt){Y&&Y._inc++,De.namespaceURI===Ve.XMLNS&&delete ee._nsMap[De.prefix?De.localName:""]}function Ur(Y,ee,De){if(Y&&Y._inc){Y._inc++;var gt=ee.childNodes;if(De)gt[gt.length++]=De;else{for(var Kt=ee.firstChild,Zn=0;Kt;)gt[Zn++]=Kt,Kt=Kt.nextSibling;gt.length=Zn,delete gt[gt.length]}}}function So(Y,ee){var De=ee.previousSibling,gt=ee.nextSibling;return De?De.nextSibling=gt:Y.firstChild=gt,gt?gt.previousSibling=De:Y.lastChild=De,ee.parentNode=null,ee.previousSibling=null,ee.nextSibling=null,Ur(Y.ownerDocument,Y),ee}function wn(Y){return Y&&Y.nodeType===zi.DOCUMENT_TYPE_NODE}function hn(Y){return Y&&Y.nodeType===zi.ELEMENT_NODE}function Ro(Y){return Y&&Y.nodeType===zi.TEXT_NODE}function po(Y,ee){var De=Y.childNodes||[];if(je(De,hn)||wn(ee))return!1;var gt=je(De,wn);return!(ee&&gt&&De.indexOf(gt)>De.indexOf(ee))}function gs(Y,ee){var De=Y.childNodes||[];if(je(De,function gt(Zn){return hn(Zn)&&Zn!==ee}))return!1;var Kt=je(De,wn);return!(ee&&Kt&&De.indexOf(Kt)>De.indexOf(ee))}function hi(Y,ee,De){var gt=Y.childNodes||[],Kt=ee.childNodes||[];if(ee.nodeType===zi.DOCUMENT_FRAGMENT_NODE){var Zn=Kt.filter(hn);if(Zn.length>1||je(Kt,Ro))throw new Cn($e,"More than one element or text in fragment");if(1===Zn.length&&!po(Y,De))throw new Cn($e,"Element in fragment can not be inserted before doctype")}if(hn(ee)&&!po(Y,De))throw new Cn($e,"Only one element can be added and only after doctype");if(wn(ee)){if(je(gt,wn))throw new Cn($e,"Only one doctype is allowed");var br=je(gt,hn);if(De&&gt.indexOf(br)<gt.indexOf(De))throw new Cn($e,"Doctype can only be inserted before an element");if(!De&&br)throw new Cn($e,"Doctype can not be appended since element is present")}}function qs(Y,ee,De){var gt=Y.childNodes||[],Kt=ee.childNodes||[];if(ee.nodeType===zi.DOCUMENT_FRAGMENT_NODE){var Zn=Kt.filter(hn);if(Zn.length>1||je(Kt,Ro))throw new Cn($e,"More than one element or text in fragment");if(1===Zn.length&&!gs(Y,De))throw new Cn($e,"Element in fragment can not be inserted before doctype")}if(hn(ee)&&!gs(Y,De))throw new Cn($e,"Only one element can be added and only after doctype");if(wn(ee)){if(je(gt,function(Gn){return wn(Gn)&&Gn!==De}))throw new Cn($e,"Only one doctype is allowed");var br=je(gt,hn);if(De&&gt.indexOf(br)<gt.indexOf(De))throw new Cn($e,"Doctype can only be inserted before an element")}}function bs(Y,ee,De,gt){(function Co(Y,ee,De){if(!function Oi(Y){return Y&&(Y.nodeType===zi.DOCUMENT_NODE||Y.nodeType===zi.DOCUMENT_FRAGMENT_NODE||Y.nodeType===zi.ELEMENT_NODE)}(Y))throw new Cn($e,"Unexpected parent node type "+Y.nodeType);if(De&&De.parentNode!==Y)throw new Cn(Mt,"child not in parent");if(!function Pr(Y){return Y&&(hn(Y)||Ro(Y)||wn(Y)||Y.nodeType===zi.DOCUMENT_FRAGMENT_NODE||Y.nodeType===zi.COMMENT_NODE||Y.nodeType===zi.PROCESSING_INSTRUCTION_NODE)}(ee)||wn(ee)&&Y.nodeType!==zi.DOCUMENT_NODE)throw new Cn($e,"Unexpected node type "+ee.nodeType+" for parent node type "+Y.nodeType)})(Y,ee,De),Y.nodeType===zi.DOCUMENT_NODE&&(gt||hi)(Y,ee,De);var Kt=ee.parentNode;if(Kt&&Kt.removeChild(ee),ee.nodeType===ge){var Zn=ee.firstChild;if(null==Zn)return ee;var br=ee.lastChild}else Zn=br=ee;var oo=De?De.previousSibling:Y.lastChild;Zn.previousSibling=oo,br.nextSibling=De,oo?oo.nextSibling=Zn:Y.firstChild=Zn,null==De?Y.lastChild=br:De.previousSibling=br;do{Zn.parentNode=Y}while(Zn!==br&&(Zn=Zn.nextSibling));return Ur(Y.ownerDocument||Y,Y),ee.nodeType==ge&&(ee.firstChild=ee.lastChild=null),ee}function j(){this._nsMap={}}function fe(){}function W(){}function z(){}function L(){}function ne(){}function _e(){}function Te(){}function Ee(){}function Ne(){}function Re(){}function nt(){}function vt(){}function Xt(Y,ee){var De=[],gt=9==this.nodeType&&this.documentElement||this,Kt=gt.prefix,Zn=gt.namespaceURI;if(Zn&&null==Kt&&null==(Kt=gt.lookupPrefix(Zn)))var br=[{namespace:Zn,prefix:null}];return ai(this,De,Y,ee,br),De.join("")}function Bt(Y,ee,De){var gt=Y.prefix||"",Kt=Y.namespaceURI;if(!Kt||"xml"===gt&&Kt===Ve.XML||Kt===Ve.XMLNS)return!1;for(var Zn=De.length;Zn--;){var br=De[Zn];if(br.prefix===gt)return br.namespace!==Kt}return!0}function oi(Y,ee,De){Y.push(" ",ee,'="',De.replace(/[<>&"\t\n\r]/g,pn),'"')}function ai(Y,ee,De,gt,Kt){if(Kt||(Kt=[]),gt){if(!(Y=gt(Y)))return;if("string"==typeof Y)return void ee.push(Y)}switch(Y.nodeType){case Ze:var Zn=Y.attributes,br=Zn.length,ro=Y.firstChild,oo=Y.tagName,Sa=oo;if(!(De=Ve.isHTML(Y.namespaceURI)||De)&&!Y.prefix&&Y.namespaceURI){for(var Gn,Wo=0;Wo<Zn.length;Wo++)if("xmlns"===Zn.item(Wo).name){Gn=Zn.item(Wo).value;break}if(!Gn)for(var so=Kt.length-1;so>=0;so--)if(""===(sl=Kt[so]).prefix&&sl.namespace===Y.namespaceURI){Gn=sl.namespace;break}if(Gn!==Y.namespaceURI)for(so=Kt.length-1;so>=0;so--){var sl;if((sl=Kt[so]).namespace===Y.namespaceURI){sl.prefix&&(Sa=sl.prefix+":"+oo);break}}}ee.push("<",Sa);for(var Ca=0;Ca<br;Ca++)"xmlns"==(fo=Zn.item(Ca)).prefix?Kt.push({prefix:fo.localName,namespace:fo.value}):"xmlns"==fo.nodeName&&Kt.push({prefix:"",namespace:fo.value});for(Ca=0;Ca<br;Ca++){var fo,No,al;Bt(fo=Zn.item(Ca),0,Kt)&&(oi(ee,(No=fo.prefix||"")?"xmlns:"+No:"xmlns",al=fo.namespaceURI),Kt.push({prefix:No,namespace:al})),ai(fo,ee,De,gt,Kt)}if(oo===Sa&&Bt(Y,0,Kt)&&(oi(ee,(No=Y.prefix||"")?"xmlns:"+No:"xmlns",al=Y.namespaceURI),Kt.push({prefix:No,namespace:al})),ro||De&&!/^(?:meta|link|img|br|hr|input)$/i.test(oo)){if(ee.push(">"),De&&/^script$/i.test(oo))for(;ro;)ro.data?ee.push(ro.data):ai(ro,ee,De,gt,Kt.slice()),ro=ro.nextSibling;else for(;ro;)ai(ro,ee,De,gt,Kt.slice()),ro=ro.nextSibling;ee.push("</",Sa,">")}else ee.push("/>");return;case Ie:case ge:for(ro=Y.firstChild;ro;)ai(ro,ee,De,gt,Kt.slice()),ro=ro.nextSibling;return;case ut:return oi(ee,Y.name,Y.value);case jt:return ee.push(Y.data.replace(/[<&>]/g,pn));case _n:return ee.push("<![CDATA[",Y.data,"]]>");case Dn:return ee.push("\x3c!--",Y.data,"--\x3e");case ye:var ll=Y.publicId,ns=Y.systemId;if(ee.push("<!DOCTYPE ",Y.name),ll)ee.push(" PUBLIC ",ll),ns&&"."!=ns&&ee.push(" ",ns),ee.push(">");else if(ns&&"."!=ns)ee.push(" SYSTEM ",ns,">");else{var Al=Y.internalSubset;Al&&ee.push(" [",Al,"]"),ee.push(">")}return;case Rt:return ee.push("<?",Y.target," ",Y.data,"?>");case He:return ee.push("&",Y.nodeName,";");default:ee.push("??",Y.nodeName)}}function li(Y,ee,De){var gt;switch(ee.nodeType){case Ze:(gt=ee.cloneNode(!1)).ownerDocument=Y;case ge:break;case ut:De=!0}if(gt||(gt=ee.cloneNode(!1)),gt.ownerDocument=Y,gt.parentNode=null,De)for(var Kt=ee.firstChild;Kt;)gt.appendChild(li(Y,Kt,De)),Kt=Kt.nextSibling;return gt}function pi(Y,ee,De){var gt=new ee.constructor;for(var Kt in ee)if(Object.prototype.hasOwnProperty.call(ee,Kt)){var Zn=ee[Kt];"object"!=typeof Zn&&Zn!=gt[Kt]&&(gt[Kt]=Zn)}switch(ee.childNodes&&(gt.childNodes=new bt),gt.ownerDocument=Y,gt.nodeType){case Ze:var br=ee.attributes,oo=gt.attributes=new Wi,Sa=br.length;oo._ownerElement=gt;for(var Gn=0;Gn<Sa;Gn++)gt.setAttributeNode(pi(Y,br.item(Gn),!0));break;case ut:De=!0}if(De)for(var Wo=ee.firstChild;Wo;)gt.appendChild(pi(Y,Wo,De)),Wo=Wo.nextSibling;return gt}function Ti(Y,ee,De){Y[ee]=De}Ge.INVALID_STATE_ERR=(Be[11]="Invalid state",11),Ge.SYNTAX_ERR=(Be[12]="Syntax error",12),Ge.INVALID_MODIFICATION_ERR=(Be[13]="Invalid modification",13),Ge.NAMESPACE_ERR=(Be[14]="Invalid namespace",14),Ge.INVALID_ACCESS_ERR=(Be[15]="Invalid access",15),Cn.prototype=Error.prototype,Qe(Ge,Cn),bt.prototype={length:0,item:function(Y){return this[Y]||null},toString:function(Y,ee){for(var De=[],gt=0;gt<this.length;gt++)ai(this[gt],De,Y,ee);return De.join("")},filter:function(Y){return Array.prototype.filter.call(this,Y)},indexOf:function(Y){return Array.prototype.indexOf.call(this,Y)}},dn.prototype.item=function(Y){return $t(this),this[Y]},St(dn,bt),Wi.prototype={length:0,item:bt.prototype.item,getNamedItem:function(Y){for(var ee=this.length;ee--;){var De=this[ee];if(De.nodeName==Y)return De}},setNamedItem:function(Y){var ee=Y.ownerElement;if(ee&&ee!=this._ownerElement)throw new Cn(vn);var De=this.getNamedItem(Y.nodeName);return Pn(this._ownerElement,this,Y,De),De},setNamedItemNS:function(Y){var De,ee=Y.ownerElement;if(ee&&ee!=this._ownerElement)throw new Cn(vn);return De=this.getNamedItemNS(Y.namespaceURI,Y.localName),Pn(this._ownerElement,this,Y,De),De},removeNamedItem:function(Y){var ee=this.getNamedItem(Y);return ln(this._ownerElement,this,ee),ee},removeNamedItemNS:function(Y,ee){var De=this.getNamedItemNS(Y,ee);return ln(this._ownerElement,this,De),De},getNamedItemNS:function(Y,ee){for(var De=this.length;De--;){var gt=this[De];if(gt.localName==ee&&gt.namespaceURI==Y)return gt}return null}},Fo.prototype={hasFeature:function(Y,ee){return!0},createDocument:function(Y,ee,De){var gt=new jr;if(gt.implementation=this,gt.childNodes=new bt,gt.doctype=De||null,De&&gt.appendChild(De),ee){var Kt=gt.createElementNS(Y,ee);gt.appendChild(Kt)}return gt},createDocumentType:function(Y,ee,De){var gt=new _e;return gt.name=Y,gt.nodeName=Y,gt.publicId=ee||"",gt.systemId=De||"",gt}},zi.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(Y,ee){return bs(this,Y,ee)},replaceChild:function(Y,ee){bs(this,Y,ee,qs),ee&&this.removeChild(ee)},removeChild:function(Y){return So(this,Y)},appendChild:function(Y){return this.insertBefore(Y,null)},hasChildNodes:function(){return null!=this.firstChild},cloneNode:function(Y){return pi(this.ownerDocument||this,this,Y)},normalize:function(){for(var Y=this.firstChild;Y;){var ee=Y.nextSibling;ee&&ee.nodeType==jt&&Y.nodeType==jt?(this.removeChild(ee),Y.appendData(ee.data)):(Y.normalize(),Y=ee)}},isSupported:function(Y,ee){return this.ownerDocument.implementation.hasFeature(Y,ee)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(Y){for(var ee=this;ee;){var De=ee._nsMap;if(De)for(var gt in De)if(Object.prototype.hasOwnProperty.call(De,gt)&&De[gt]===Y)return gt;ee=ee.nodeType==ut?ee.ownerDocument:ee.parentNode}return null},lookupNamespaceURI:function(Y){for(var ee=this;ee;){var De=ee._nsMap;if(De&&Object.prototype.hasOwnProperty.call(De,Y))return De[Y];ee=ee.nodeType==ut?ee.ownerDocument:ee.parentNode}return null},isDefaultNamespace:function(Y){return null==this.lookupPrefix(Y)}},Qe(Ct,zi),Qe(Ct,zi.prototype),jr.prototype={nodeName:"#document",nodeType:Ie,doctype:null,documentElement:null,_inc:1,insertBefore:function(Y,ee){if(Y.nodeType==ge){for(var De=Y.firstChild;De;){var gt=De.nextSibling;this.insertBefore(De,ee),De=gt}return Y}return bs(this,Y,ee),Y.ownerDocument=this,null===this.documentElement&&Y.nodeType===Ze&&(this.documentElement=Y),Y},removeChild:function(Y){return this.documentElement==Y&&(this.documentElement=null),So(this,Y)},replaceChild:function(Y,ee){bs(this,Y,ee,qs),Y.ownerDocument=this,ee&&this.removeChild(ee),hn(Y)&&(this.documentElement=Y)},importNode:function(Y,ee){return li(this,Y,ee)},getElementById:function(Y){var ee=null;return Xi(this.documentElement,function(De){if(De.nodeType==Ze&&De.getAttribute("id")==Y)return ee=De,!0}),ee},getElementsByClassName:function(Y){var ee=qe(Y);return new dn(this,function(De){var gt=[];return ee.length>0&&Xi(De.documentElement,function(Kt){if(Kt!==De&&Kt.nodeType===Ze){var Zn=Kt.getAttribute("class");if(Zn){var br=Y===Zn;if(!br){var oo=qe(Zn);br=ee.every(function Xe(Y){return function(ee){return Y&&-1!==Y.indexOf(ee)}}(oo))}br&&gt.push(Kt)}}}),gt})},createElement:function(Y){var ee=new j;return ee.ownerDocument=this,ee.nodeName=Y,ee.tagName=Y,ee.localName=Y,ee.childNodes=new bt,(ee.attributes=new Wi)._ownerElement=ee,ee},createDocumentFragment:function(){var Y=new Re;return Y.ownerDocument=this,Y.childNodes=new bt,Y},createTextNode:function(Y){var ee=new z;return ee.ownerDocument=this,ee.appendData(Y),ee},createComment:function(Y){var ee=new L;return ee.ownerDocument=this,ee.appendData(Y),ee},createCDATASection:function(Y){var ee=new ne;return ee.ownerDocument=this,ee.appendData(Y),ee},createProcessingInstruction:function(Y,ee){var De=new nt;return De.ownerDocument=this,De.tagName=De.target=Y,De.nodeValue=De.data=ee,De},createAttribute:function(Y){var ee=new fe;return ee.ownerDocument=this,ee.name=Y,ee.nodeName=Y,ee.localName=Y,ee.specified=!0,ee},createEntityReference:function(Y){var ee=new Ne;return ee.ownerDocument=this,ee.nodeName=Y,ee},createElementNS:function(Y,ee){var De=new j,gt=ee.split(":"),Kt=De.attributes=new Wi;return De.childNodes=new bt,De.ownerDocument=this,De.nodeName=ee,De.tagName=ee,De.namespaceURI=Y,2==gt.length?(De.prefix=gt[0],De.localName=gt[1]):De.localName=ee,Kt._ownerElement=De,De},createAttributeNS:function(Y,ee){var De=new fe,gt=ee.split(":");return De.ownerDocument=this,De.nodeName=ee,De.name=ee,De.namespaceURI=Y,De.specified=!0,2==gt.length?(De.prefix=gt[0],De.localName=gt[1]):De.localName=ee,De}},St(jr,zi),jr.prototype.getElementsByTagName=(j.prototype={nodeType:Ze,hasAttribute:function(Y){return null!=this.getAttributeNode(Y)},getAttribute:function(Y){var ee=this.getAttributeNode(Y);return ee&&ee.value||""},getAttributeNode:function(Y){return this.attributes.getNamedItem(Y)},setAttribute:function(Y,ee){var De=this.ownerDocument.createAttribute(Y);De.value=De.nodeValue=""+ee,this.setAttributeNode(De)},removeAttribute:function(Y){var ee=this.getAttributeNode(Y);ee&&this.removeAttributeNode(ee)},appendChild:function(Y){return Y.nodeType===ge?this.insertBefore(Y,null):function x(Y,ee){return ee.parentNode&&ee.parentNode.removeChild(ee),ee.parentNode=Y,ee.previousSibling=Y.lastChild,ee.nextSibling=null,ee.previousSibling?ee.previousSibling.nextSibling=ee:Y.firstChild=ee,Y.lastChild=ee,Ur(Y.ownerDocument,Y,ee),ee}(this,Y)},setAttributeNode:function(Y){return this.attributes.setNamedItem(Y)},setAttributeNodeNS:function(Y){return this.attributes.setNamedItemNS(Y)},removeAttributeNode:function(Y){return this.attributes.removeNamedItem(Y.nodeName)},removeAttributeNS:function(Y,ee){var De=this.getAttributeNodeNS(Y,ee);De&&this.removeAttributeNode(De)},hasAttributeNS:function(Y,ee){return null!=this.getAttributeNodeNS(Y,ee)},getAttributeNS:function(Y,ee){var De=this.getAttributeNodeNS(Y,ee);return De&&De.value||""},setAttributeNS:function(Y,ee,De){var gt=this.ownerDocument.createAttributeNS(Y,ee);gt.value=gt.nodeValue=""+De,this.setAttributeNode(gt)},getAttributeNodeNS:function(Y,ee){return this.attributes.getNamedItemNS(Y,ee)},getElementsByTagName:function(Y){return new dn(this,function(ee){var De=[];return Xi(ee,function(gt){gt!==ee&&gt.nodeType==Ze&&("*"===Y||gt.tagName==Y)&&De.push(gt)}),De})},getElementsByTagNameNS:function(Y,ee){return new dn(this,function(De){var gt=[];return Xi(De,function(Kt){Kt!==De&&Kt.nodeType===Ze&&("*"===Y||Kt.namespaceURI===Y)&&("*"===ee||Kt.localName==ee)&&gt.push(Kt)}),gt})}}).getElementsByTagName,jr.prototype.getElementsByTagNameNS=j.prototype.getElementsByTagNameNS,St(j,zi),fe.prototype.nodeType=ut,St(fe,zi),W.prototype={data:"",substringData:function(Y,ee){return this.data.substring(Y,Y+ee)},appendData:function(Y){this.nodeValue=this.data=Y=this.data+Y,this.length=Y.length},insertData:function(Y,ee){this.replaceData(Y,0,ee)},appendChild:function(Y){throw new Error(Be[$e])},deleteData:function(Y,ee){this.replaceData(Y,ee,"")},replaceData:function(Y,ee,De){var gt=this.data.substring(0,Y),Kt=this.data.substring(Y+ee);this.nodeValue=this.data=De=gt+De+Kt,this.length=De.length}},St(W,zi),z.prototype={nodeName:"#text",nodeType:jt,splitText:function(Y){var ee=this.data,De=ee.substring(Y);ee=ee.substring(0,Y),this.data=this.nodeValue=ee,this.length=ee.length;var gt=this.ownerDocument.createTextNode(De);return this.parentNode&&this.parentNode.insertBefore(gt,this.nextSibling),gt}},St(z,W),L.prototype={nodeName:"#comment",nodeType:Dn},St(L,W),ne.prototype={nodeName:"#cdata-section",nodeType:_n},St(ne,W),_e.prototype.nodeType=ye,St(_e,zi),Te.prototype.nodeType=oe,St(Te,zi),Ee.prototype.nodeType=Fn,St(Ee,zi),Ne.prototype.nodeType=He,St(Ne,zi),Re.prototype.nodeName="#document-fragment",Re.prototype.nodeType=ge,St(Re,zi),nt.prototype.nodeType=Rt,St(nt,zi),vt.prototype.serializeToString=function(Y,ee,De){return Xt.call(Y,ee,De)},zi.prototype.toString=Xt;try{if(Object.defineProperty){let Y=function(ee){switch(ee.nodeType){case Ze:case ge:var De=[];for(ee=ee.firstChild;ee;)7!==ee.nodeType&&8!==ee.nodeType&&De.push(Y(ee)),ee=ee.nextSibling;return De.join("");default:return ee.nodeValue}};Object.defineProperty(dn.prototype,"length",{get:function(){return $t(this),this.$$length}}),Object.defineProperty(zi.prototype,"textContent",{get:function(){return Y(this)},set:function(ee){switch(this.nodeType){case Ze:case ge:for(;this.firstChild;)this.removeChild(this.firstChild);(ee||String(ee))&&this.appendChild(this.ownerDocument.createTextNode(ee));break;default:this.data=ee,this.value=ee,this.nodeValue=ee}}}),Ti=function(ee,De,gt){ee["$$"+De]=gt}}}catch(Y){}In.DocumentType=_e,In.DOMException=Cn,In.DOMImplementation=Fo,In.Element=j,In.Node=zi,In.NodeList=bt,In.XMLSerializer=vt},436:(un,In,tt)=>{var ze=tt(401).freeze;In.XML_ENTITIES=ze({amp:"&",apos:"'",gt:">",lt:"<",quot:'"'}),In.HTML_ENTITIES=ze({lt:"<",gt:">",amp:"&",quot:'"',apos:"'",Agrave:"\xc0",Aacute:"\xc1",Acirc:"\xc2",Atilde:"\xc3",Auml:"\xc4",Aring:"\xc5",AElig:"\xc6",Ccedil:"\xc7",Egrave:"\xc8",Eacute:"\xc9",Ecirc:"\xca",Euml:"\xcb",Igrave:"\xcc",Iacute:"\xcd",Icirc:"\xce",Iuml:"\xcf",ETH:"\xd0",Ntilde:"\xd1",Ograve:"\xd2",Oacute:"\xd3",Ocirc:"\xd4",Otilde:"\xd5",Ouml:"\xd6",Oslash:"\xd8",Ugrave:"\xd9",Uacute:"\xda",Ucirc:"\xdb",Uuml:"\xdc",Yacute:"\xdd",THORN:"\xde",szlig:"\xdf",agrave:"\xe0",aacute:"\xe1",acirc:"\xe2",atilde:"\xe3",auml:"\xe4",aring:"\xe5",aelig:"\xe6",ccedil:"\xe7",egrave:"\xe8",eacute:"\xe9",ecirc:"\xea",euml:"\xeb",igrave:"\xec",iacute:"\xed",icirc:"\xee",iuml:"\xef",eth:"\xf0",ntilde:"\xf1",ograve:"\xf2",oacute:"\xf3",ocirc:"\xf4",otilde:"\xf5",ouml:"\xf6",oslash:"\xf8",ugrave:"\xf9",uacute:"\xfa",ucirc:"\xfb",uuml:"\xfc",yacute:"\xfd",thorn:"\xfe",yuml:"\xff",nbsp:"\xa0",iexcl:"\xa1",cent:"\xa2",pound:"\xa3",curren:"\xa4",yen:"\xa5",brvbar:"\xa6",sect:"\xa7",uml:"\xa8",copy:"\xa9",ordf:"\xaa",laquo:"\xab",not:"\xac",shy:"\xad\xad",reg:"\xae",macr:"\xaf",deg:"\xb0",plusmn:"\xb1",sup2:"\xb2",sup3:"\xb3",acute:"\xb4",micro:"\xb5",para:"\xb6",middot:"\xb7",cedil:"\xb8",sup1:"\xb9",ordm:"\xba",raquo:"\xbb",frac14:"\xbc",frac12:"\xbd",frac34:"\xbe",iquest:"\xbf",times:"\xd7",divide:"\xf7",forall:"\u2200",part:"\u2202",exist:"\u2203",empty:"\u2205",nabla:"\u2207",isin:"\u2208",notin:"\u2209",ni:"\u220b",prod:"\u220f",sum:"\u2211",minus:"\u2212",lowast:"\u2217",radic:"\u221a",prop:"\u221d",infin:"\u221e",ang:"\u2220",and:"\u2227",or:"\u2228",cap:"\u2229",cup:"\u222a",int:"\u222b",there4:"\u2234",sim:"\u223c",cong:"\u2245",asymp:"\u2248",ne:"\u2260",equiv:"\u2261",le:"\u2264",ge:"\u2265",sub:"\u2282",sup:"\u2283",nsub:"\u2284",sube:"\u2286",supe:"\u2287",oplus:"\u2295",otimes:"\u2297",perp:"\u22a5",sdot:"\u22c5",Alpha:"\u0391",Beta:"\u0392",Gamma:"\u0393",Delta:"\u0394",Epsilon:"\u0395",Zeta:"\u0396",Eta:"\u0397",Theta:"\u0398",Iota:"\u0399",Kappa:"\u039a",Lambda:"\u039b",Mu:"\u039c",Nu:"\u039d",Xi:"\u039e",Omicron:"\u039f",Pi:"\u03a0",Rho:"\u03a1",Sigma:"\u03a3",Tau:"\u03a4",Upsilon:"\u03a5",Phi:"\u03a6",Chi:"\u03a7",Psi:"\u03a8",Omega:"\u03a9",alpha:"\u03b1",beta:"\u03b2",gamma:"\u03b3",delta:"\u03b4",epsilon:"\u03b5",zeta:"\u03b6",eta:"\u03b7",theta:"\u03b8",iota:"\u03b9",kappa:"\u03ba",lambda:"\u03bb",mu:"\u03bc",nu:"\u03bd",xi:"\u03be",omicron:"\u03bf",pi:"\u03c0",rho:"\u03c1",sigmaf:"\u03c2",sigma:"\u03c3",tau:"\u03c4",upsilon:"\u03c5",phi:"\u03c6",chi:"\u03c7",psi:"\u03c8",omega:"\u03c9",thetasym:"\u03d1",upsih:"\u03d2",piv:"\u03d6",OElig:"\u0152",oelig:"\u0153",Scaron:"\u0160",scaron:"\u0161",Yuml:"\u0178",fnof:"\u0192",circ:"\u02c6",tilde:"\u02dc",ensp:"\u2002",emsp:"\u2003",thinsp:"\u2009",zwnj:"\u200c",zwj:"\u200d",lrm:"\u200e",rlm:"\u200f",ndash:"\u2013",mdash:"\u2014",lsquo:"\u2018",rsquo:"\u2019",sbquo:"\u201a",ldquo:"\u201c",rdquo:"\u201d",bdquo:"\u201e",dagger:"\u2020",Dagger:"\u2021",bull:"\u2022",hellip:"\u2026",permil:"\u2030",prime:"\u2032",Prime:"\u2033",lsaquo:"\u2039",rsaquo:"\u203a",oline:"\u203e",euro:"\u20ac",trade:"\u2122",larr:"\u2190",uarr:"\u2191",rarr:"\u2192",darr:"\u2193",harr:"\u2194",crarr:"\u21b5",lceil:"\u2308",rceil:"\u2309",lfloor:"\u230a",rfloor:"\u230b",loz:"\u25ca",spades:"\u2660",clubs:"\u2663",hearts:"\u2665",diams:"\u2666"}),In.entityMap=In.HTML_ENTITIES},978:(un,In,tt)=>{tt(853);In.DOMParser=tt(991).DOMParser},702:(un,In,tt)=>{var ze=tt(401).NAMESPACE,je=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,Ve=new RegExp("[\\-\\.0-9"+je.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),p=new RegExp("^"+je.source+Ve.source+"*(?::"+je.source+Ve.source+"*)?$");function ut(K,Me){this.message=K,this.locator=Me,Error.captureStackTrace&&Error.captureStackTrace(this,ut)}function jt(){}function He(K,Me){return Me.lineNumber=K.lineNumber,Me.columnNumber=K.columnNumber,Me}function Fn(K,Me,$e,Se,Je,lt){function cn(Er,wo,Cn){$e.attributeNames.hasOwnProperty(Er)&&lt.fatalError("Attribute "+Er+" redefined"),$e.addValue(Er,wo.replace(/[\t\n\r]/g," ").replace(/&#?\w+;/g,Je),Cn)}for(var Mt,vn=++Me,xn=0;;){var Rn=K.charAt(vn);switch(Rn){case"=":if(1===xn)Mt=K.slice(Me,vn),xn=3;else{if(2!==xn)throw new Error("attribute equal must after attrName");xn=3}break;case"'":case'"':if(3===xn||1===xn){if(1===xn&&(lt.warning('attribute value must after "="'),Mt=K.slice(Me,vn)),!((vn=K.indexOf(Rn,Me=vn+1))>0))throw new Error("attribute value no end '"+Rn+"' match");cn(Mt,xt=K.slice(Me,vn),Me-1),xn=5}else{if(4!=xn)throw new Error('attribute value must after "="');cn(Mt,xt=K.slice(Me,vn),Me),lt.warning('attribute "'+Mt+'" missed start quot('+Rn+")!!"),Me=vn+1,xn=5}break;case"/":switch(xn){case 0:$e.setTagName(K.slice(Me,vn));case 5:case 6:case 7:xn=7,$e.closed=!0;case 4:case 1:break;case 2:$e.closed=!0;break;default:throw new Error("attribute invalid close char('/')")}break;case"":return lt.error("unexpected end of input"),0==xn&&$e.setTagName(K.slice(Me,vn)),vn;case">":switch(xn){case 0:$e.setTagName(K.slice(Me,vn));case 5:case 6:case 7:break;case 4:case 1:"/"===(xt=K.slice(Me,vn)).slice(-1)&&($e.closed=!0,xt=xt.slice(0,-1));case 2:2===xn&&(xt=Mt),4==xn?(lt.warning('attribute "'+xt+'" missed quot(")!'),cn(Mt,xt,Me)):((!ze.isHTML(Se[""])||!xt.match(/^(?:disabled|checked|selected)$/i))&&lt.warning('attribute "'+xt+'" missed value!! "'+xt+'" instead!!'),cn(xt,xt,Me));break;case 3:throw new Error("attribute value missed!!")}return vn;case"\x80":Rn=" ";default:if(Rn<=" ")switch(xn){case 0:$e.setTagName(K.slice(Me,vn)),xn=6;break;case 1:Mt=K.slice(Me,vn),xn=2;break;case 4:var xt=K.slice(Me,vn);lt.warning('attribute "'+xt+'" missed quot(")!!'),cn(Mt,xt,Me);case 5:xn=6}else switch(xn){case 2:(!ze.isHTML(Se[""])||!Mt.match(/^(?:disabled|checked|selected)$/i))&&lt.warning('attribute "'+Mt+'" missed value!! "'+Mt+'" instead2!!'),cn(Mt,Mt,Me),Me=vn,xn=1;break;case 5:lt.warning('attribute space is required"'+Mt+'"!!');case 6:xn=1,Me=vn;break;case 3:xn=4,Me=vn;break;case 7:throw new Error("elements closed character '/' and '>' must be connected to")}}vn++}}function Rt(K,Me,$e){for(var Se=K.tagName,Je=null,Rn=K.length;Rn--;){var lt=K[Rn],cn=lt.qName,Mt=lt.value;if((Wt=cn.indexOf(":"))>0)var xt=lt.prefix=cn.slice(0,Wt),vn=cn.slice(Wt+1),xn="xmlns"===xt&&vn;else vn=cn,xt=null,xn="xmlns"===cn&&"";lt.localName=vn,!1!==xn&&(null==Je&&(Je={},ye($e,$e={})),$e[xn]=Je[xn]=Mt,lt.uri=ze.XMLNS,Me.startPrefixMapping(xn,Mt))}for(Rn=K.length;Rn--;)(xt=(lt=K[Rn]).prefix)&&("xml"===xt&&(lt.uri=ze.XML),"xmlns"!==xt&&(lt.uri=$e[xt||""]));var Wt;(Wt=Se.indexOf(":"))>0?(xt=K.prefix=Se.slice(0,Wt),vn=K.localName=Se.slice(Wt+1)):(xt=null,vn=K.localName=Se);var Er=K.uri=$e[xt||""];if(Me.startElement(Er,vn,Se,K),!K.closed)return K.currentNSMap=$e,K.localNSMap=Je,!0;if(Me.endElement(Er,vn,Se),Je)for(xt in Je)Object.prototype.hasOwnProperty.call(Je,xt)&&Me.endPrefixMapping(xt)}function Dn(K,Me,$e,Se,Je){if(/^(?:script|textarea)$/i.test($e)){var lt=K.indexOf("</"+$e+">",Me),cn=K.substring(Me+1,lt);if(/[&<]/.test(cn))return/^script$/i.test($e)?(Je.characters(cn,0,cn.length),lt):(cn=cn.replace(/&#?\w+;/g,Se),Je.characters(cn,0,cn.length),lt)}return Me+1}function Ie(K,Me,$e,Se){var Je=Se[$e];return null==Je&&((Je=K.lastIndexOf("</"+$e+">"))<Me&&(Je=K.lastIndexOf("</"+$e)),Se[$e]=Je),Je<Me}function ye(K,Me){for(var $e in K)Object.prototype.hasOwnProperty.call(K,$e)&&(Me[$e]=K[$e])}function ge(K,Me,$e,Se){if("-"===K.charAt(Me+2))return"-"===K.charAt(Me+3)?(lt=K.indexOf("--\x3e",Me+4))>Me?($e.comment(K,Me+4,lt-Me-4),lt+3):(Se.error("Unclosed comment"),-1):-1;if("CDATA["==K.substr(Me+3,6)){var lt=K.indexOf("]]>",Me+9);return $e.startCDATA(),$e.characters(K,Me+9,lt-Me-9),$e.endCDATA(),lt+3}var cn=function Be(K,Me){var $e,Se=[],Je=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(Je.lastIndex=Me,Je.exec(K);$e=Je.exec(K);)if(Se.push($e),$e[1])return Se}(K,Me),Mt=cn.length;if(Mt>1&&/!doctype/i.test(cn[0][0])){var xt=cn[1][0],vn=!1,xn=!1;Mt>3&&(/^public$/i.test(cn[2][0])?(vn=cn[3][0],xn=Mt>4&&cn[4][0]):/^system$/i.test(cn[2][0])&&(xn=cn[3][0]));var Rn=cn[Mt-1];return $e.startDTD(xt,vn,xn),$e.endDTD(),Rn.index+Rn[0].length}return-1}function oe(K,Me,$e){var Se=K.indexOf("?>",Me);if(Se){var Je=K.substring(Me,Se).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);return Je?($e.processingInstruction(Je[1],Je[2]),Se+2):-1}return-1}function Ge(){this.attributeNames={}}(ut.prototype=new Error).name=ut.name,jt.prototype={parse:function(K,Me,$e){var Se=this.domBuilder;Se.startDocument(),ye(Me,Me={}),function _n(K,Me,$e,Se,Je){function cn(Oi){var Pr=Oi.slice(1,-1);return Object.hasOwnProperty.call($e,Pr)?$e[Pr]:"#"===Pr.charAt(0)?function lt(Oi){return Oi>65535?(Oi-=65536,String.fromCharCode(55296+(Oi>>10),56320+(1023&Oi))):String.fromCharCode(Oi)}(parseInt(Pr.substr(1).replace("x","0x"))):(Je.error("entity not found:"+Oi),Oi)}function Mt(Oi){if(Oi>Cn){var Pr=K.substring(Cn,Oi).replace(/&#?\w+;/g,cn);Wt&&xt(Cn),Se.characters(Pr,0,Oi-Cn),Cn=Oi}}function xt(Oi,Pr){for(;Oi>=xn&&(Pr=Rn.exec(K));)xn=(vn=Pr.index)+Pr[0].length,Wt.lineNumber++;Wt.columnNumber=Oi-vn+1}for(var vn=0,xn=0,Rn=/.*(?:\r\n?|\n)|.*$/g,Wt=Se.locator,Er=[{currentNSMap:Me}],wo={},Cn=0;;){try{var bt=K.indexOf("<",Cn);if(bt<0){if(!K.substr(Cn).match(/^\s*$/)){var dn=Se.doc,$t=dn.createTextNode(K.substr(Cn));dn.appendChild($t),Se.currentElement=$t}return}switch(bt>Cn&&Mt(bt),K.charAt(bt+1)){case"/":var jr=K.indexOf(">",bt+3),Wi=K.substring(bt+2,jr).replace(/[ \t\n\r]+$/g,""),vi=Er.pop();jr<0?(Wi=K.substring(bt+2).replace(/[\s<].*/,""),Je.error("end tag name: "+Wi+" is not complete:"+vi.tagName),jr=bt+1+Wi.length):Wi.match(/\s</)&&(Wi=Wi.replace(/[\s<].*/,""),Je.error("end tag name: "+Wi+" maybe not complete"),jr=bt+1+Wi.length);var Pn=vi.localNSMap,ln=vi.tagName==Wi;if(ln||vi.tagName&&vi.tagName.toLowerCase()==Wi.toLowerCase()){if(Se.endElement(vi.uri,vi.localName,Wi),Pn)for(var zi in Pn)Object.prototype.hasOwnProperty.call(Pn,zi)&&Se.endPrefixMapping(zi);ln||Je.fatalError("end tag name: "+Wi+" is not match the current start tagName:"+vi.tagName)}else Er.push(vi);jr++;break;case"?":Wt&&xt(bt),jr=oe(K,bt,Se);break;case"!":Wt&&xt(bt),jr=ge(K,bt,Se,Je);break;default:Wt&&xt(bt);var pn=new Ge,Xi=Er[Er.length-1].currentNSMap,Tn=(jr=Fn(K,bt,pn,Xi,cn,Je),pn.length);if(!pn.closed&&Ie(K,jr,pn.tagName,wo)&&(pn.closed=!0,$e.nbsp||Je.warning("unclosed xml attribute")),Wt&&Tn){for(var ko=He(Wt,{}),Ur=0;Ur<Tn;Ur++){var So=pn[Ur];xt(So.offset),So.locator=He(Wt,{})}Se.locator=ko,Rt(pn,Se,Xi)&&Er.push(pn),Se.locator=Wt}else Rt(pn,Se,Xi)&&Er.push(pn);ze.isHTML(pn.uri)&&!pn.closed?jr=Dn(K,jr,pn.tagName,cn,Se):jr++}}catch(Oi){if(Oi instanceof ut)throw Oi;Je.error("element parse error: "+Oi),jr=-1}jr>Cn?Cn=jr:Mt(Math.max(bt,Cn)+1)}}(K,Me,$e,Se,this.errorHandler),Se.endDocument()}},Ge.prototype={setTagName:function(K){if(!p.test(K))throw new Error("invalid tagName:"+K);this.tagName=K},addValue:function(K,Me,$e){if(!p.test(K))throw new Error("invalid attribute:"+K);this.attributeNames[K]=this.length,this[this.length++]={qName:K,value:Me,offset:$e}},length:0,getLocalName:function(K){return this[K].localName},getLocator:function(K){return this[K].locator},getQName:function(K){return this[K].qName},getURI:function(K){return this[K].uri},getValue:function(K){return this[K].value}},In.XMLReader=jt,In.ParseError=ut},472:function(un,In){var Ve,tt="undefined"!=typeof self?self:this,ze=function(){function Ve(){this.fetch=!1,this.DOMException=tt.DOMException}return Ve.prototype=tt,new Ve}();Ve=ze,function(he){var ft_searchParams="URLSearchParams"in Ve,ft_iterable="Symbol"in Ve&&"iterator"in Symbol,ft_blob="FileReader"in Ve&&"Blob"in Ve&&function(){try{return new Blob,!0}catch(Se){return!1}}(),ft_formData="FormData"in Ve,ft_arrayBuffer="ArrayBuffer"in Ve;if(ft_arrayBuffer)var Xe=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],Qe=ArrayBuffer.isView||function(Se){return Se&&Xe.indexOf(Object.prototype.toString.call(Se))>-1};function St(Se){if("string"!=typeof Se&&(Se=String(Se)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(Se))throw new TypeError("Invalid character in header field name");return Se.toLowerCase()}function Ct(Se){return"string"!=typeof Se&&(Se=String(Se)),Se}function Ze(Se){var Je={next:function(){var lt=Se.shift();return{done:void 0===lt,value:lt}}};return ft_iterable&&(Je[Symbol.iterator]=function(){return Je}),Je}function ut(Se){this.map={},Se instanceof ut?Se.forEach(function(Je,lt){this.append(lt,Je)},this):Array.isArray(Se)?Se.forEach(function(Je){this.append(Je[0],Je[1])},this):Se&&Object.getOwnPropertyNames(Se).forEach(function(Je){this.append(Je,Se[Je])},this)}function jt(Se){if(Se.bodyUsed)return Promise.reject(new TypeError("Already read"));Se.bodyUsed=!0}function _n(Se){return new Promise(function(Je,lt){Se.onload=function(){Je(Se.result)},Se.onerror=function(){lt(Se.error)}})}function He(Se){var Je=new FileReader,lt=_n(Je);return Je.readAsArrayBuffer(Se),lt}function Dn(Se){if(Se.slice)return Se.slice(0);var Je=new Uint8Array(Se.byteLength);return Je.set(new Uint8Array(Se)),Je.buffer}function Ie(){return this.bodyUsed=!1,this._initBody=function(Se){this._bodyInit=Se,Se?"string"==typeof Se?this._bodyText=Se:ft_blob&&Blob.prototype.isPrototypeOf(Se)?this._bodyBlob=Se:ft_formData&&FormData.prototype.isPrototypeOf(Se)?this._bodyFormData=Se:ft_searchParams&&URLSearchParams.prototype.isPrototypeOf(Se)?this._bodyText=Se.toString():ft_arrayBuffer&&ft_blob&&function qe(Se){return Se&&DataView.prototype.isPrototypeOf(Se)}(Se)?(this._bodyArrayBuffer=Dn(Se.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):ft_arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(Se)||Qe(Se))?this._bodyArrayBuffer=Dn(Se):this._bodyText=Se=Object.prototype.toString.call(Se):this._bodyText="",this.headers.get("content-type")||("string"==typeof Se?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):ft_searchParams&&URLSearchParams.prototype.isPrototypeOf(Se)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},ft_blob&&(this.blob=function(){var Se=jt(this);if(Se)return Se;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?jt(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(He)}),this.text=function(){var Se=jt(this);if(Se)return Se;if(this._bodyBlob)return function Fn(Se){var Je=new FileReader,lt=_n(Je);return Je.readAsText(Se),lt}(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(function Rt(Se){for(var Je=new Uint8Array(Se),lt=new Array(Je.length),cn=0;cn<Je.length;cn++)lt[cn]=String.fromCharCode(Je[cn]);return lt.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},ft_formData&&(this.formData=function(){return this.text().then(Ge)}),this.json=function(){return this.text().then(JSON.parse)},this}ut.prototype.append=function(Se,Je){Se=St(Se),Je=Ct(Je);var lt=this.map[Se];this.map[Se]=lt?lt+", "+Je:Je},ut.prototype.delete=function(Se){delete this.map[St(Se)]},ut.prototype.get=function(Se){return Se=St(Se),this.has(Se)?this.map[Se]:null},ut.prototype.has=function(Se){return this.map.hasOwnProperty(St(Se))},ut.prototype.set=function(Se,Je){this.map[St(Se)]=Ct(Je)},ut.prototype.forEach=function(Se,Je){for(var lt in this.map)this.map.hasOwnProperty(lt)&&Se.call(Je,this.map[lt],lt,this)},ut.prototype.keys=function(){var Se=[];return this.forEach(function(Je,lt){Se.push(lt)}),Ze(Se)},ut.prototype.values=function(){var Se=[];return this.forEach(function(Je){Se.push(Je)}),Ze(Se)},ut.prototype.entries=function(){var Se=[];return this.forEach(function(Je,lt){Se.push([lt,Je])}),Ze(Se)},ft_iterable&&(ut.prototype[Symbol.iterator]=ut.prototype.entries);var ye=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function oe(Se,Je){var lt=(Je=Je||{}).body;if(Se instanceof oe){if(Se.bodyUsed)throw new TypeError("Already read");this.url=Se.url,this.credentials=Se.credentials,Je.headers||(this.headers=new ut(Se.headers)),this.method=Se.method,this.mode=Se.mode,this.signal=Se.signal,!lt&&null!=Se._bodyInit&&(lt=Se._bodyInit,Se.bodyUsed=!0)}else this.url=String(Se);if(this.credentials=Je.credentials||this.credentials||"same-origin",(Je.headers||!this.headers)&&(this.headers=new ut(Je.headers)),this.method=function ge(Se){var Je=Se.toUpperCase();return ye.indexOf(Je)>-1?Je:Se}(Je.method||this.method||"GET"),this.mode=Je.mode||this.mode||null,this.signal=Je.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&lt)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(lt)}function Ge(Se){var Je=new FormData;return Se.trim().split("&").forEach(function(lt){if(lt){var cn=lt.split("="),Mt=cn.shift().replace(/\+/g," "),xt=cn.join("=").replace(/\+/g," ");Je.append(decodeURIComponent(Mt),decodeURIComponent(xt))}}),Je}function Be(Se){var Je=new ut;return Se.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(cn){var Mt=cn.split(":"),xt=Mt.shift().trim();if(xt){var vn=Mt.join(":").trim();Je.append(xt,vn)}}),Je}function K(Se,Je){Je||(Je={}),this.type="default",this.status=void 0===Je.status?200:Je.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in Je?Je.statusText:"OK",this.headers=new ut(Je.headers),this.url=Je.url||"",this._initBody(Se)}oe.prototype.clone=function(){return new oe(this,{body:this._bodyInit})},Ie.call(oe.prototype),Ie.call(K.prototype),K.prototype.clone=function(){return new K(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new ut(this.headers),url:this.url})},K.error=function(){var Se=new K(null,{status:0,statusText:""});return Se.type="error",Se};var Me=[301,302,303,307,308];K.redirect=function(Se,Je){if(-1===Me.indexOf(Je))throw new RangeError("Invalid status code");return new K(null,{status:Je,headers:{location:Se}})},he.DOMException=Ve.DOMException;try{new he.DOMException}catch(Se){he.DOMException=function(Je,lt){this.message=Je,this.name=lt;var cn=Error(Je);this.stack=cn.stack},he.DOMException.prototype=Object.create(Error.prototype),he.DOMException.prototype.constructor=he.DOMException}function $e(Se,Je){return new Promise(function(lt,cn){var Mt=new oe(Se,Je);if(Mt.signal&&Mt.signal.aborted)return cn(new he.DOMException("Aborted","AbortError"));var xt=new XMLHttpRequest;function vn(){xt.abort()}xt.onload=function(){var xn={status:xt.status,statusText:xt.statusText,headers:Be(xt.getAllResponseHeaders()||"")};xn.url="responseURL"in xt?xt.responseURL:xn.headers.get("X-Request-URL"),lt(new K("response"in xt?xt.response:xt.responseText,xn))},xt.onerror=function(){cn(new TypeError("Network request failed"))},xt.ontimeout=function(){cn(new TypeError("Network request failed"))},xt.onabort=function(){cn(new he.DOMException("Aborted","AbortError"))},xt.open(Mt.method,Mt.url,!0),"include"===Mt.credentials?xt.withCredentials=!0:"omit"===Mt.credentials&&(xt.withCredentials=!1),"responseType"in xt&&ft_blob&&(xt.responseType="blob"),Mt.headers.forEach(function(xn,Rn){xt.setRequestHeader(Rn,xn)}),Mt.signal&&(Mt.signal.addEventListener("abort",vn),xt.onreadystatechange=function(){4===xt.readyState&&Mt.signal.removeEventListener("abort",vn)}),xt.send(void 0===Mt._bodyInit?null:Mt._bodyInit)})}$e.polyfill=!0,Ve.fetch||(Ve.fetch=$e,Ve.Headers=ut,Ve.Request=oe,Ve.Response=K),he.Headers=ut,he.Request=oe,he.Response=K,he.fetch=$e,Object.defineProperty(he,"__esModule",{value:!0})}({}),ze.fetch.ponyfill=!0,delete ze.fetch.polyfill;var je=ze;(In=je.fetch).default=je.fetch,In.fetch=je.fetch,In.Headers=je.Headers,In.Request=je.Request,In.Response=je.Response,un.exports=In},898:function(un){un.exports=function(){"use strict";var In,tt,ze;function je(p,he){if(In)if(tt){var ft="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+In+")(sharedChunk); ("+tt+")(sharedChunk); self.onerror = null;",qe={};In(qe),ze=he(qe),"undefined"!=typeof window&&window&&window.URL&&window.URL.createObjectURL&&(ze.workerUrl=window.URL.createObjectURL(new Blob([ft],{type:"text/javascript"})))}else tt=he;else In=he}return je(0,function(p){var he="undefined"!=typeof self?self:{},ft="2.15.0";let qe;const Xe={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==qe){const a=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{qe=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):a}catch(o){qe=a}}return qe},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Xe.API_URL)return null;try{const a=new URL(Xe.API_URL);return"api.mapbox.cn"===a.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===a.hostname?"https://events.mapbox.com/events/v2":null}catch(a){return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Qe={supported:!1,testSupport:function(a){!Ze&&Ct&&(ut?jt(a):St=a)}};let St,Ct,Ze=!1,ut=!1;function jt(a){const o=a.createTexture();a.bindTexture(a.TEXTURE_2D,o);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,Ct),a.isContextLost())return;Qe.supported=!0}catch(l){}a.deleteTexture(o),Ze=!0}he.document&&(Ct=he.document.createElement("img"),Ct.onload=function(){St&&jt(St),St=null,ut=!0},Ct.onerror=function(){Ze=!0,St=null},Ct.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const _n="01";function He(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var Fn=Rt;function Rt(a,o,l,u){this.cx=3*a,this.bx=3*(l-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(u-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=o,this.p2x=l,this.p2y=u}Rt.prototype={sampleCurveX:function(a){return((this.ax*a+this.bx)*a+this.cx)*a},sampleCurveY:function(a){return((this.ay*a+this.by)*a+this.cy)*a},sampleCurveDerivativeX:function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},solveCurveX:function(a,o){if(void 0===o&&(o=1e-6),a<0)return 0;if(a>1)return 1;for(var l=a,u=0;u<8;u++){var f=this.sampleCurveX(l)-a;if(Math.abs(f)<o)return l;var b=this.sampleCurveDerivativeX(l);if(Math.abs(b)<1e-6)break;l-=f/b}var v=0,S=1;for(l=a,u=0;u<20&&(f=this.sampleCurveX(l),!(Math.abs(f-a)<o));u++)a>f?v=l:S=l,l=.5*(S-v)+v;return l},solve:function(a,o){return this.sampleCurveY(this.solveCurveX(a,o))}};var Dn=He(Fn),Ie=ye;function ye(a,o){this.x=a,this.y=o}ye.prototype={clone:function(){return new ye(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,o){return this.clone()._rotateAround(a,o)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var o=a.x-this.x,l=a.y-this.y;return o*o+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,o){return Math.atan2(this.x*o-this.y*a,this.x*a+this.y*o)},_matMult:function(a){var o=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=o,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var o=Math.cos(a),l=Math.sin(a),u=l*this.x+o*this.y;return this.x=o*this.x-l*this.y,this.y=u,this},_rotateAround:function(a,o){var l=Math.cos(a),u=Math.sin(a),f=o.y+u*(this.x-o.x)+l*(this.y-o.y);return this.x=o.x+l*(this.x-o.x)-u*(this.y-o.y),this.y=f,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ye.convert=function(a){return a instanceof ye?a:Array.isArray(a)?new ye(a[0],a[1]):a};var ge=He(Ie);const oe=Math.PI/180,Ge=180/Math.PI;function Be(a){return a*oe}function K(a){return a*Ge}const Me=[[0,0],[1,0],[1,1],[0,1]];function $e(a){if(a<=0)return 0;if(a>=1)return 1;const o=a*a,l=o*a;return 4*(a<.5?l:3*(a-o)+l-.75)}function Se(a,o,l,u){const f=new Dn(a,o,l,u);return function(b){return f.solve(b)}}const Je=Se(.25,.1,.25,1);function lt(a,o,l){return Math.min(l,Math.max(o,a))}function cn(a,o,l){return(l=lt((l-a)/(o-a),0,1))*l*(3-2*l)}function Mt(a,o,l){const u=l-o,f=((a-o)%u+u)%u+o;return f===o?l:f}function xt(a,o,l){if(!a.length)return l(null,[]);let u=a.length;const f=new Array(a.length);let b=null;a.forEach((v,S)=>{o(v,(E,D)=>{E&&(b=E),f[S]=D,0==--u&&l(b,f)})})}function vn(a){const o=[];for(const l in a)o.push(a[l]);return o}function xn(a,...o){for(const l of o)for(const u in l)a[u]=l[u];return a}let Rn=1;function Wt(){return Rn++}function Er(){return function a(o){return o?(o^Math.random()*(16>>o/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()}function wo(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))}function Cn(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)}function bt(a,o){a.forEach(l=>{o[l]&&(o[l]=o[l].bind(o))})}function dn(a,o){return-1!==a.indexOf(o,a.length-o.length)}function $t(a,o,l){const u={};for(const f in a)u[f]=o.call(l||this,a[f],f,a);return u}function Wi(a,o,l){const u={};for(const f in a)o.call(l||this,a[f],f,a)&&(u[f]=a[f]);return u}function vi(a){return Array.isArray(a)?a.map(vi):"object"==typeof a&&a?$t(a,vi):a}const Pn={};function ln(a){Pn[a]||("undefined"!=typeof console&&console.warn(a),Pn[a]=!0)}function Fo(a,o,l){return(l.y-a.y)*(o.x-a.x)>(o.y-a.y)*(l.x-a.x)}function zi(a){let o=0;for(let l,u,f=0,b=a.length,v=b-1;f<b;v=f++)l=a[f],u=a[v],o+=(u.x-l.x)*(l.y+u.y);return o}function pn(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function Xi(a){const o={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,u,f,b)=>{const v=f||b;return o[u]=!v||v.toLowerCase(),""}),o["max-age"]){const l=parseInt(o["max-age"],10);isNaN(l)?delete o["max-age"]:o["max-age"]=l}return o}let jr=null;function Tn(a){if(null==jr){const o=a.navigator?a.navigator.userAgent:null;jr=!!a.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return jr}function ko(a){try{const o=he[a];return o.setItem("_mapbox_test_",1),o.removeItem("_mapbox_test_"),!0}catch(o){return!1}}function Ur(a,o){return[a[4*o],a[4*o+1],a[4*o+2],a[4*o+3]]}const So="mapbox-tiles";let wn,hn,Oi=500,Pr=50;function Ro(){try{return he.caches}catch(a){}}function po(){Ro()&&!wn&&(wn=he.caches.open(So))}function gs(a){const o=a.indexOf("?");if(o<0)return a;const u=function(f){const b=f.indexOf("?");return b>0?f.slice(b+1).split("&"):[]}(a).filter(f=>{const b=f.split("=");return"language"===b[0]||"worldview"===b[0]});return u.length?`${a.slice(0,o)}?${u.join("&")}`:a.slice(0,o)}let Co=1/0;const hi={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(hi);class qs extends Error{constructor(o,l,u){401===l&&Ee(u)&&(o+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(o),this.status=l,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const bs=pn()?()=>self.worker&&self.worker.referrer:()=>("blob:"===he.location.protocol?he.parent:he).location.href,x=function(a,o){if(!(/^file:/.test(l=a.url)||/^file:/.test(bs())&&!/^\w+:/.test(l))){if(he.fetch&&he.Request&&he.AbortController&&he.Request.prototype.hasOwnProperty("signal"))return function(u,f){const b=new he.AbortController,v=new he.Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:bs(),referrerPolicy:u.referrerPolicy,signal:b.signal});let S=!1,E=!1;const D=(k=v.url).indexOf("sku=")>0&&Ee(k);var k;"json"===u.type&&v.headers.set("Accept","application/json");const O=(V,U,G)=>{if(E)return;if(V&&"SecurityError"!==V.message&&ln(V.toString()),U&&G)return F(U);const J=Date.now();he.fetch(v).then(ue=>{if(ue.ok){const we=D?ue.clone():null;return F(ue,we,J)}return f(new qs(ue.statusText,ue.status,u.url))}).catch(ue=>{"AbortError"!==ue.name&&f(new Error(`${ue.message} ${u.url}`))})},F=(V,U,G)=>{("arrayBuffer"===u.type?V.arrayBuffer():"json"===u.type?V.json():V.text()).then(J=>{E||(U&&G&&function(ue,we,de){if(po(),!wn)return;const ve={status:we.status,statusText:we.statusText,headers:new he.Headers};we.headers.forEach((ct,st)=>ve.headers.set(st,ct));const Ae=Xi(we.headers.get("Cache-Control")||"");if(Ae["no-store"])return;Ae["max-age"]&&ve.headers.set("Expires",new Date(de+1e3*Ae["max-age"]).toUTCString());const ke=ve.headers.get("Expires");ke&&(new Date(ke).getTime()-de<42e4||function(ct,st){if(void 0===hn)try{new Response(new ReadableStream),hn=!0}catch(yt){hn=!1}hn?st(ct.body):ct.blob().then(st)}(we,ct=>{const st=new he.Response(ct,ve);po(),wn&&wn.then(yt=>yt.put(gs(ue.url),st)).catch(yt=>ln(yt.message))}))}(v,U,G),S=!0,f(null,J,V.headers.get("Cache-Control"),V.headers.get("Expires")))}).catch(J=>{E||f(new Error(J.message))})};return D?function(V,U){if(po(),!wn)return U(null);const G=gs(V.url);wn.then(J=>{J.match(G).then(ue=>{const we=function(de){if(!de)return!1;const ve=new Date(de.headers.get("Expires")||0),Ae=Xi(de.headers.get("Cache-Control")||"");return ve>Date.now()&&!Ae["no-cache"]}(ue);J.delete(G),we&&J.put(G,ue.clone()),U(null,ue,we)}).catch(U)}).catch(U)}(v,O):O(null,null),{cancel:()=>{E=!0,S||b.abort()}}}(a,o);if(pn()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,o,void 0,!0)}var l;return function(u,f){const b=new he.XMLHttpRequest;b.open(u.method||"GET",u.url,!0),"arrayBuffer"===u.type&&(b.responseType="arraybuffer");for(const v in u.headers)b.setRequestHeader(v,u.headers[v]);return"json"===u.type&&(b.responseType="text",b.setRequestHeader("Accept","application/json")),b.withCredentials="include"===u.credentials,b.onerror=()=>{f(new Error(b.statusText))},b.onload=()=>{if((b.status>=200&&b.status<300||0===b.status)&&null!==b.response){let v=b.response;if("json"===u.type)try{v=JSON.parse(b.response)}catch(S){return f(S)}f(null,v,b.getResponseHeader("Cache-Control"),b.getResponseHeader("Expires"))}else f(new qs(b.statusText,b.status,u.url))},b.send(u.body),{cancel:()=>b.abort()}}(a,o)},j=function(a,o){return x(xn(a,{type:"arrayBuffer"}),o)};function fe(a){const o=he.document.createElement("a");return o.href=a,o.protocol===he.document.location.protocol&&o.host===he.document.location.host}const W="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let z,L;z=[],L=0;const ne=function(a,o){if(Qe.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),L>=Xe.MAX_PARALLEL_IMAGE_REQUESTS){const b={requestParameters:a,callback:o,cancelled:!1,cancel(){this.cancelled=!0}};return z.push(b),b}L++;let l=!1;const u=()=>{if(!l)for(l=!0,L--;z.length&&L<Xe.MAX_PARALLEL_IMAGE_REQUESTS;){const b=z.shift(),{requestParameters:v,callback:S,cancelled:E}=b;E||(b.cancel=ne(v,S).cancel)}},f=j(a,(b,v,S,E)=>{u(),b?o(b):v&&(he.createImageBitmap?function(D,k){const O=new he.Blob([new Uint8Array(D)],{type:"image/png"});he.createImageBitmap(O).then(F=>{k(null,F)}).catch(F=>{k(new Error(`Could not load image because of ${F.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(v,(D,k)=>o(D,k,S,E)):function(D,k){const O=new he.Image,F=he.URL;O.onload=()=>{k(null,O),F.revokeObjectURL(O.src),O.onload=null,he.requestAnimationFrame(()=>{O.src=W})},O.onerror=()=>k(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const V=new he.Blob([new Uint8Array(D)],{type:"image/png"});O.src=D.byteLength?F.createObjectURL(V):W}(v,(D,k)=>o(D,k,S,E)))});return{cancel:()=>{f.cancel(),u()}}},_e="NO_ACCESS_TOKEN";function Te(a){return 0===a.indexOf("mapbox:")}function Ee(a){return Xe.API_URL_REGEX.test(a)}function Ne(a){return Xe.API_CDN_URL_REGEX.test(a)}function Re(a){return Xe.API_STYLE_REGEX.test(a)&&!nt(a)}function nt(a){return Xe.API_SPRITE_REGEX.test(a)}const vt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Xt(a){const o=a.match(vt);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function Bt(a){const o=a.params.length?`?${a.params.join("&")}`:"";return`${a.protocol}://${a.authority}${a.path}${o}`}const oi="mapbox.eventData";function ai(a){if(!a)return null;const o=a.split(".");if(!o||3!==o.length)return null;try{return JSON.parse(decodeURIComponent(he.atob(o[1]).split("").map(l=>"%"+("00"+l.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(l){return null}}class li{constructor(o){this.type=o,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(o){const l=ai(Xe.ACCESS_TOKEN);let u="";return u=l&&l.u?he.btoa(encodeURIComponent(l.u).replace(/%([0-9A-F]{2})/g,(f,b)=>String.fromCharCode(Number("0x"+b)))):Xe.ACCESS_TOKEN||"",o?`${oi}.${o}:${u}`:`${oi}:${u}`}fetchEventData(){const o=ko("localStorage"),l=this.getStorageKey(),u=this.getStorageKey("uuid");if(o)try{const f=he.localStorage.getItem(l);f&&(this.eventData=JSON.parse(f));const b=he.localStorage.getItem(u);b&&(this.anonId=b)}catch(f){ln("Unable to read from LocalStorage")}}saveEventData(){const o=ko("localStorage"),l=this.getStorageKey(),u=this.getStorageKey("uuid");if(o)try{he.localStorage.setItem(u,this.anonId),Object.keys(this.eventData).length>=1&&he.localStorage.setItem(l,JSON.stringify(this.eventData))}catch(f){ln("Unable to write to LocalStorage")}}processRequests(o){}postEvent(o,l,u,f){if(!Xe.EVENTS_URL)return;const b=Xt(Xe.EVENTS_URL);b.params.push(`access_token=${f||Xe.ACCESS_TOKEN||""}`);const v={event:this.type,created:new Date(o).toISOString()},S=l?xn(v,l):v,E={url:Bt(b),headers:{"Content-Type":"text/plain"},body:JSON.stringify([S])};var k;this.pendingRequest=(k=D=>{this.pendingRequest=null,u(D),this.saveEventData(),this.processRequests(f)},x(xn(E,{method:"POST"}),k))}queueRequest(o,l){this.queue.push(o),this.processRequests(l)}}const pi=new class extends li{constructor(a){super("appUserTurnstile"),this._customAccessToken=a}postTurnstileEvent(a,o){Xe.EVENTS_URL&&Xe.ACCESS_TOKEN&&Array.isArray(a)&&a.some(l=>Te(l)||Ee(l))&&this.queueRequest(Date.now(),o)}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const o=ai(Xe.ACCESS_TOKEN),l=o?o.u:Xe.ACCESS_TOKEN;let u=l!==this.eventData.tokenU;Cn(this.anonId)||(this.anonId=Er(),u=!0);const f=this.queue.shift();if(this.eventData.lastSuccess){const b=new Date(this.eventData.lastSuccess),v=new Date(f),S=(f-this.eventData.lastSuccess)/864e5;u=u||S>=1||S<-1||b.getDate()!==v.getDate()}else u=!0;u?this.postEvent(f,{sdkIdentifier:"mapbox-gl-js",sdkVersion:ft,skuId:_n,"enabled.telemetry":!1,userId:this.anonId},b=>{b||(this.eventData.lastSuccess=f,this.eventData.tokenU=l)},a):this.processRequests()}},Ti=pi.postTurnstileEvent.bind(pi),Pt=new class extends li{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(a,o,l,u){this.skuToken=o,this.errorCb=u,Xe.EVENTS_URL&&(l||Xe.ACCESS_TOKEN?this.queueRequest({id:a,timestamp:Date.now()},l):this.errorCb(new Error(_e)))}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;const{id:o,timestamp:l}=this.queue.shift();o&&this.success[o]||(this.anonId||this.fetchEventData(),Cn(this.anonId)||(this.anonId=Er()),this.postEvent(l,{sdkIdentifier:"mapbox-gl-js",sdkVersion:ft,skuId:_n,skuToken:this.skuToken,userId:this.anonId},u=>{u?this.errorCb(u):o&&(this.success[o]=!0)},a))}},Y=Pt.postMapLoadEvent.bind(Pt),ee=new class extends li{constructor(){super("gljs.performance")}postPerformanceEvent(a,o){Xe.EVENTS_URL&&(a||Xe.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:o},a)}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:o,performanceData:l}=this.queue.shift(),u=function(f){const b=he.performance.getEntriesByType("resource"),v=he.performance.getEntriesByType("mark"),S=function(F){const V={};if(F)for(const U in F)if("other"!==U)for(const G of F[U]){const J=`${U}ResolveRangeMin`,ue=`${U}ResolveRangeMax`,we=`${U}RequestCount`,de=`${U}RequestCachedCount`;V[J]=Math.min(V[J]||1/0,G.startTime),V[ue]=Math.max(V[ue]||-1/0,G.responseEnd);const ve=Ae=>{void 0===V[Ae]&&(V[Ae]=0),++V[Ae]};void 0!==G.transferSize&&0===G.transferSize&&ve(de),ve(we)}return V}(function(F,V){const U={};if(F)for(const G of F){const J=V(G);void 0===U[J]&&(U[J]=[]),U[J].push(G)}return U}(b,Sa)),E=he.devicePixelRatio,D=he.navigator.connection||he.navigator.mozConnection||he.navigator.webkitConnection,k={counters:[],metadata:[],attributes:[]},O=(F,V,U)=>{null!=U&&F.push({name:V,value:U.toString()})};for(const F in S)O(k.counters,F,S[F]);if(f.interactionRange[0]!==1/0&&f.interactionRange[1]!==-1/0&&(O(k.counters,"interactionRangeMin",f.interactionRange[0]),O(k.counters,"interactionRangeMax",f.interactionRange[1])),v)for(const F of Object.keys(br)){const V=br[F],U=v.find(G=>G.name===V);U&&O(k.counters,V,U.startTime)}return O(k.counters,"visibilityHidden",f.visibilityHidden),O(k.attributes,"style",function(F){if(F)for(const V of F){const U=V.name.split("?")[0];if(Re(U)){const G=U.split("/").slice(-2);if(2===G.length)return`mapbox://styles/${G[0]}/${G[1]}`}}}(b)),O(k.attributes,"terrainEnabled",f.terrainEnabled?"true":"false"),O(k.attributes,"fogEnabled",f.fogEnabled?"true":"false"),O(k.attributes,"projection",f.projection),O(k.attributes,"zoom",f.zoom),O(k.metadata,"devicePixelRatio",E),O(k.metadata,"connectionEffectiveType",D?D.effectiveType:void 0),O(k.metadata,"navigatorUserAgent",he.navigator.userAgent),O(k.metadata,"screenWidth",he.screen.width),O(k.metadata,"screenHeight",he.screen.height),O(k.metadata,"windowWidth",he.innerWidth),O(k.metadata,"windowHeight",he.innerHeight),O(k.metadata,"mapWidth",f.width/E),O(k.metadata,"mapHeight",f.height/E),O(k.metadata,"webglRenderer",f.renderer),O(k.metadata,"webglVendor",f.vendor),O(k.metadata,"sdkVersion",ft),O(k.metadata,"sdkIdentifier","mapbox-gl-js"),k}(l);for(const f of u.metadata);for(const f of u.counters);for(const f of u.attributes);this.postEvent(o,u,()=>{},a)}},De=ee.postPerformanceEvent.bind(ee),gt=new class extends li{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(a,o,l,u){if(!Xe.API_URL||!Xe.SESSION_PATH)return;const f=Xt(Xe.API_URL+Xe.SESSION_PATH);f.params.push(`sku=${o||""}`),f.params.push(`access_token=${u||Xe.ACCESS_TOKEN||""}`);const b={url:Bt(f),headers:{"Content-Type":"text/plain"}};var S;this.pendingRequest=(S=v=>{this.pendingRequest=null,l(v),this.saveEventData(),this.processRequests(u)},x(xn(b,{method:"GET"}),S))}getSessionAPI(a,o,l,u){this.skuToken=o,this.errorCb=u,Xe.SESSION_PATH&&Xe.API_URL&&(l||Xe.ACCESS_TOKEN?this.queueRequest({id:a,timestamp:Date.now()},l):this.errorCb(new Error(_e)))}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;const{id:o,timestamp:l}=this.queue.shift();o&&this.success[o]||this.getSession(l,this.skuToken,u=>{u?this.errorCb(u):o&&(this.success[o]=!0)},a)}},Kt=gt.getSessionAPI.bind(gt),Zn=new Set,br={create:"create",load:"load",fullLoad:"fullLoad"},oo={mark(a){he.performance.mark(a)},measure(a,o,l){he.performance.measure(a,o,l)}};function Sa(a){const o=a.name.split("?")[0];return Ne(o)&&o.includes("mapbox-gl.js")?"javascript":Ne(o)&&o.includes("mapbox-gl.css")?"css":Xe.API_FONTS_REGEX.test(o)?"fontRange":nt(o)?"sprite":Re(o)?"style":Xe.API_TILEJSON_REGEX.test(o)?"tilejson":"other"}const Gn=he.performance;function Wo(a){const o=a?a.url.toString():void 0;return Gn.getEntriesByName(o)}let so,sl,Ca,fo;const No={now:()=>void 0!==Ca?Ca:he.performance.now(),setNow(a){Ca=a},restoreNow(){Ca=void 0},frame(a){const o=he.requestAnimationFrame(a);return{cancel:()=>he.cancelAnimationFrame(o)}},getImageData(a,o=0){const{width:l,height:u}=a;fo||(fo=he.document.createElement("canvas"));const f=fo.getContext("2d",{willReadFrequently:!0});if(!f)throw new Error("failed to create canvas 2d context");return(l>fo.width||u>fo.height)&&(fo.width=l,fo.height=u),f.clearRect(-o,-o,l+2*o,u+2*o),f.drawImage(a,0,0,l,u),f.getImageData(-o,-o,l+2*o,u+2*o)},resolveURL:a=>(so||(so=he.document.createElement("a")),so.href=a,so.href),get devicePixelRatio(){return he.devicePixelRatio},get prefersReducedMotion(){return!!he.matchMedia&&(null==sl&&(sl=he.matchMedia("(prefers-reduced-motion: reduce)")),sl.matches)}};function al(a,o,l){l[a]&&-1!==l[a].indexOf(o)||(l[a]=l[a]||[],l[a].push(o))}function ro(a,o,l){if(l&&l[a]){const u=l[a].indexOf(o);-1!==u&&l[a].splice(u,1)}}class ll{constructor(o,l={}){xn(this,l),this.type=o}}class ns extends ll{constructor(o,l={}){super("error",xn({error:o},l))}}class Al{on(o,l){return this._listeners=this._listeners||{},al(o,l,this._listeners),this}off(o,l){return ro(o,l,this._listeners),ro(o,l,this._oneTimeListeners),this}once(o,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},al(o,l,this._oneTimeListeners),this):new Promise(u=>this.once(o,u))}fire(o,l){"string"==typeof o&&(o=new ll(o,l||{}));const u=o.type;if(this.listens(u)){o.target=this;const f=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(const S of f)S.call(this,o);const b=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(const S of b)ro(u,S,this._oneTimeListeners),S.call(this,o);const v=this._eventedParent;v&&(xn(o,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),v.fire(o))}else o instanceof ns&&console.error(o.error);return this}listens(o){return!!(this._listeners&&this._listeners[o]&&this._listeners[o].length>0||this._oneTimeListeners&&this._oneTimeListeners[o]&&this._oneTimeListeners[o].length>0||this._eventedParent&&this._eventedParent.listens(o))}setEventedParent(o,l){return this._eventedParent=o,this._eventedParentData=l,this}}var _t=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function kl(a,...o){for(const l of o)for(const u in l)a[u]=l[u];return a}function To(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function Xo(a){if(Array.isArray(a))return a.map(Xo);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const o={};for(const l in a)o[l]=Xo(a[l]);return o}return To(a)}class qp extends Error{constructor(o,l){super(l),this.message=l,this.key=o}}var cl=qp;class Gp{constructor(o,l=[]){this.parent=o,this.bindings={};for(const[u,f]of l)this.bindings[u]=f}concat(o){return new Gp(this,o)}get(o){if(this.bindings[o])return this.bindings[o];if(this.parent)return this.parent.get(o);throw new Error(`${o} not found in scope.`)}has(o){return!!this.bindings[o]||!!this.parent&&this.parent.has(o)}}var mo=Gp;const Or={kind:"null"},mn={kind:"number"},Li={kind:"string"},Bn={kind:"boolean"},As={kind:"color"},Zi={kind:"object"},Mi={kind:"value"},aa={kind:"collator"},$i={kind:"formatted"},ci={kind:"resolvedImage"};function Gs(a,o){return{kind:"array",itemType:a,N:o}}function eo(a){if("array"===a.kind){const o=eo(a.itemType);return"number"==typeof a.N?`array<${o}, ${a.N}>`:"value"===a.itemType.kind?"array":`array<${o}>`}return a.kind}const Nt=[Or,mn,Li,Bn,As,$i,Zi,Gs(Mi),ci];function Ta(a,o){if("error"===o.kind)return null;if("array"===a.kind){if("array"===o.kind&&(0===o.N&&"value"===o.itemType.kind||!Ta(a.itemType,o.itemType))&&("number"!=typeof a.N||a.N===o.N))return null}else{if(a.kind===o.kind)return null;if("value"===a.kind)for(const l of Nt)if(!Ta(l,o))return null}return`Expected ${eo(a)} but found ${eo(o)} instead.`}function xi(a,o){return o.some(l=>l.kind===a.kind)}function ir(a,o){return o.some(l=>"null"===l?null===a:"array"===l?Array.isArray(a):"object"===l?a&&!Array.isArray(a)&&"object"==typeof a:l===typeof a)}var Wp,n_={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function bd(a){return(a=Math.round(a))<0?0:a>255?255:a}function ic(a){return bd("%"===a[a.length-1]?parseFloat(a)/100*255:parseInt(a))}function _s(a){return(o="%"===a[a.length-1]?parseFloat(a)/100:parseFloat(a))<0?0:o>1?1:o;var o}function _d(a,o,l){return l<0?l+=1:l>1&&(l-=1),6*l<1?a+(o-a)*l*6:2*l<1?o:3*l<2?a+(o-a)*(2/3-l)*6:a}try{Wp={}.parseCSSColor=function(a){var o,l=a.replace(/ /g,"").toLowerCase();if(l in n_)return n_[l].slice();if("#"===l[0])return 4===l.length?(o=parseInt(l.substr(1),16))>=0&&o<=4095?[(3840&o)>>4|(3840&o)>>8,240&o|(240&o)>>4,15&o|(15&o)<<4,1]:null:7===l.length&&(o=parseInt(l.substr(1),16))>=0&&o<=16777215?[(16711680&o)>>16,(65280&o)>>8,255&o,1]:null;var u=l.indexOf("("),f=l.indexOf(")");if(-1!==u&&f+1===l.length){var b=l.substr(0,u),v=l.substr(u+1,f-(u+1)).split(","),S=1;switch(b){case"rgba":if(4!==v.length)return null;S=_s(v.pop());case"rgb":return 3!==v.length?null:[ic(v[0]),ic(v[1]),ic(v[2]),S];case"hsla":if(4!==v.length)return null;S=_s(v.pop());case"hsl":if(3!==v.length)return null;var E=(parseFloat(v[0])%360+360)%360/360,D=_s(v[1]),k=_s(v[2]),O=k<=.5?k*(D+1):k+D-k*D,F=2*k-O;return[bd(255*_d(F,O,E+1/3)),bd(255*_d(F,O,E)),bd(255*_d(F,O,E-1/3)),S];default:return null}}return null}}catch(a){}class Ws{constructor(o,l,u,f=1){this.r=o,this.g=l,this.b=u,this.a=f}static parse(o){if(!o)return;if(o instanceof Ws)return o;if("string"!=typeof o)return;const l=Wp(o);return l?new Ws(l[0]/255*l[3],l[1]/255*l[3],l[2]/255*l[3],l[3]):void 0}toString(){const[o,l,u,f]=this.toArray();return`rgba(${Math.round(o)},${Math.round(l)},${Math.round(u)},${f})`}toArray(){const{r:o,g:l,b:u,a:f}=this;return 0===f?[0,0,0,0]:[255*o/f,255*l/f,255*u/f,f]}toArray01(){const{r:o,g:l,b:u,a:f}=this;return 0===f?[0,0,0,0]:[o/f,l/f,u/f,f]}toArray01PremultipliedAlpha(){const{r:o,g:l,b:u,a:f}=this;return[o,l,u,f]}}Ws.black=new Ws(0,0,0,1),Ws.white=new Ws(1,1,1,1),Ws.transparent=new Ws(0,0,0,0),Ws.red=new Ws(1,0,0,1),Ws.blue=new Ws(0,0,1,1);var Eo=Ws;class La{constructor(o,l,u){this.sensitivity=o?l?"variant":"case":l?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(o,l){return this.collator.compare(o,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Fm{constructor(o,l,u,f,b){this.text=o.normalize?o.normalize():o,this.image=l,this.scale=u,this.fontStack=f,this.textColor=b}}class la{constructor(o){this.sections=o}static fromString(o){return new la([new Fm(o,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(o=>0!==o.text.length||o.image&&0!==o.image.name.length)}static factory(o){return o instanceof la?o:la.fromString(o)}toString(){return 0===this.sections.length?"":this.sections.map(o=>o.text).join("")}serialize(){const o=["format"];for(const l of this.sections){if(l.image){o.push(["image",l.image.name]);continue}o.push(l.text);const u={};l.fontStack&&(u["text-font"]=["literal",l.fontStack.split(",")]),l.scale&&(u["font-scale"]=l.scale),l.textColor&&(u["text-color"]=["rgba"].concat(l.textColor.toArray())),o.push(u)}return o}}class Fa{constructor(o){this.name=o.name,this.available=o.available}toString(){return this.name}static fromString(o){return o?new Fa({name:o,available:!1}):null}serialize(){return["image",this.name]}}function i_(a,o,l,u){return"number"==typeof a&&a>=0&&a<=255&&"number"==typeof o&&o>=0&&o<=255&&"number"==typeof l&&l>=0&&l<=255?void 0===u||"number"==typeof u&&u>=0&&u<=1?null:`Invalid rgba value [${[a,o,l,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof u?[a,o,l,u]:[a,o,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function yd(a){if(null===a||"string"==typeof a||"boolean"==typeof a||"number"==typeof a||a instanceof Eo||a instanceof La||a instanceof la||a instanceof Fa)return!0;if(Array.isArray(a)){for(const o of a)if(!yd(o))return!1;return!0}if("object"==typeof a){for(const o in a)if(!yd(a[o]))return!1;return!0}return!1}function go(a){if(null===a)return Or;if("string"==typeof a)return Li;if("boolean"==typeof a)return Bn;if("number"==typeof a)return mn;if(a instanceof Eo)return As;if(a instanceof La)return aa;if(a instanceof la)return $i;if(a instanceof Fa)return ci;if(Array.isArray(a)){const o=a.length;let l;for(const u of a){const f=go(u);if(l){if(l===f)continue;l=Mi;break}l=f}return Gs(l||Mi,o)}return Zi}function vd(a){const o=typeof a;return null===a?"":"string"===o||"number"===o||"boolean"===o?String(a):a instanceof Eo||a instanceof la||a instanceof Fa?a.toString():JSON.stringify(a)}class Nm{constructor(o,l){this.type=o,this.value=l}static parse(o,l){if(2!==o.length)return l.error(`'literal' expression requires exactly one argument, but found ${o.length-1} instead.`);if(!yd(o[1]))return l.error("invalid value");const u=o[1];let f=go(u);const b=l.expectedType;return"array"!==f.kind||0!==f.N||!b||"array"!==b.kind||"number"==typeof b.N&&0!==b.N||(f=b),new Nm(f,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Eo?["rgba"].concat(this.value.toArray()):this.value instanceof la?this.value.serialize():this.value}}var Bo=Nm,Ei=class{constructor(a){this.name="ExpressionEvaluationError",this.message=a}toJSON(){return this.message}};const Bm={string:Li,number:mn,boolean:Bn,object:Zi};class zm{constructor(o,l){this.type=o,this.args=l}static parse(o,l){if(o.length<2)return l.error("Expected at least one argument.");let u,f=1;const b=o[0];if("array"===b){let S,E;if(o.length>2){const D=o[1];if("string"!=typeof D||!(D in Bm)||"object"===D)return l.error('The item type argument of "array" must be one of string, number, boolean',1);S=Bm[D],f++}else S=Mi;if(o.length>3){if(null!==o[2]&&("number"!=typeof o[2]||o[2]<0||o[2]!==Math.floor(o[2])))return l.error('The length argument to "array" must be a positive integer literal',2);E=o[2],f++}u=Gs(S,E)}else u=Bm[b];const v=[];for(;f<o.length;f++){const S=l.parse(o[f],f,Mi);if(!S)return null;v.push(S)}return new zm(u,v)}evaluate(o){for(let l=0;l<this.args.length;l++){const u=this.args[l].evaluate(o);if(!Ta(this.type,go(u)))return u;if(l===this.args.length-1)throw new Ei(`Expected value to be of type ${eo(this.type)}, but found ${eo(go(u))} instead.`)}return null}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){const o=this.type,l=[o.kind];if("array"===o.kind){const u=o.itemType;if("string"===u.kind||"number"===u.kind||"boolean"===u.kind){l.push(u.kind);const f=o.N;("number"==typeof f||this.args.length>1)&&l.push(f)}}return l.concat(this.args.map(u=>u.serialize()))}}var rc=zm;class tn{constructor(o){this.type=$i,this.sections=o}static parse(o,l){if(o.length<2)return l.error("Expected at least one argument.");const u=o[1];if(!Array.isArray(u)&&"object"==typeof u)return l.error("First argument must be an image or text section.");const f=[];let b=!1;for(let v=1;v<=o.length-1;++v){const S=o[v];if(b&&"object"==typeof S&&!Array.isArray(S)){b=!1;let E=null;if(S["font-scale"]&&(E=l.parse(S["font-scale"],1,mn),!E))return null;let D=null;if(S["text-font"]&&(D=l.parse(S["text-font"],1,Gs(Li)),!D))return null;let k=null;if(S["text-color"]&&(k=l.parse(S["text-color"],1,As),!k))return null;const O=f[f.length-1];O.scale=E,O.font=D,O.textColor=k}else{const E=l.parse(o[v],1,Mi);if(!E)return null;const D=E.type.kind;if("string"!==D&&"value"!==D&&"null"!==D&&"resolvedImage"!==D)return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");b=!0,f.push({content:E,scale:null,font:null,textColor:null})}}return new tn(f)}evaluate(o){return new la(this.sections.map(l=>{const u=l.content.evaluate(o);return go(u)===ci?new Fm("",u,null,null,null):new Fm(vd(u),null,l.scale?l.scale.evaluate(o):null,l.font?l.font.evaluate(o).join(","):null,l.textColor?l.textColor.evaluate(o):null)}))}eachChild(o){for(const l of this.sections)o(l.content),l.scale&&o(l.scale),l.font&&o(l.font),l.textColor&&o(l.textColor)}outputDefined(){return!1}serialize(){const o=["format"];for(const l of this.sections){o.push(l.content.serialize());const u={};l.scale&&(u["font-scale"]=l.scale.serialize()),l.font&&(u["text-font"]=l.font.serialize()),l.textColor&&(u["text-color"]=l.textColor.serialize()),o.push(u)}return o}}class Xp{constructor(o){this.type=ci,this.input=o}static parse(o,l){if(2!==o.length)return l.error("Expected two arguments.");const u=l.parse(o[1],1,Li);return u?new Xp(u):l.error("No image name provided.")}evaluate(o){const l=this.input.evaluate(o),u=Fa.fromString(l);return u&&o.availableImages&&(u.available=o.availableImages.indexOf(l)>-1),u}eachChild(o){o(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Nn={"to-boolean":Bn,"to-color":As,"to-number":mn,"to-string":Li};class yu{constructor(o,l){this.type=o,this.args=l}static parse(o,l){if(o.length<2)return l.error("Expected at least one argument.");const u=o[0];if(("to-boolean"===u||"to-string"===u)&&2!==o.length)return l.error("Expected one argument.");const f=Nn[u],b=[];for(let v=1;v<o.length;v++){const S=l.parse(o[v],v,Mi);if(!S)return null;b.push(S)}return new yu(f,b)}evaluate(o){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(o));if("color"===this.type.kind){let l,u;for(const f of this.args){if(l=f.evaluate(o),u=null,l instanceof Eo)return l;if("string"==typeof l){const b=o.parseColor(l);if(b)return b}else if(Array.isArray(l)&&(u=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:i_(l[0],l[1],l[2],l[3]),!u))return new Eo(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new Ei(u||`Could not parse color from value '${"string"==typeof l?l:String(JSON.stringify(l))}'`)}if("number"===this.type.kind){let l=null;for(const u of this.args){if(l=u.evaluate(o),null===l)return 0;const f=Number(l);if(!isNaN(f))return f}throw new Ei(`Could not convert ${JSON.stringify(l)} to number.`)}return"formatted"===this.type.kind?la.fromString(vd(this.args[0].evaluate(o))):"resolvedImage"===this.type.kind?Fa.fromString(vd(this.args[0].evaluate(o))):vd(this.args[0].evaluate(o))}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){if("formatted"===this.type.kind)return new tn([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Xp(this.args[0]).serialize();const o=[`to-${this.type.kind}`];return this.eachChild(l=>{o.push(l.serialize())}),o}}var vu=yu;const Na=["Unknown","Point","LineString","Polygon"];var Zp=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Na[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const a=this.featureDistanceData.center,o=this.featureDistanceData.scale,{x:l,y:u}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(l*o-a[0])+this.featureDistanceData.bearing[1]*(u*o-a[1])}return 0}parseColor(a){let o=this._parseColorCache[a];return o||(o=this._parseColorCache[a]=Eo.parse(a)),o}};class zc{constructor(o,l,u,f){this.name=o,this.type=l,this._evaluate=u,this.args=f}evaluate(o){return this._evaluate(o,this.args)}eachChild(o){this.args.forEach(o)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(o=>o.serialize()))}static parse(o,l){const u=o[0],f=zc.definitions[u];if(!f)return l.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const b=Array.isArray(f)?f[0]:f.type,v=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,S=v.filter(([D])=>!Array.isArray(D)||D.length===o.length-1);let E=null;for(const[D,k]of S){E=new Vc(l.registry,l.path,null,l.scope);const O=[];let F=!1;for(let V=1;V<o.length;V++){const U=o[V],G=Array.isArray(D)?D[V-1]:D.type,J=E.parse(U,1+O.length,G);if(!J){F=!0;break}O.push(J)}if(!F)if(Array.isArray(D)&&D.length!==O.length)E.error(`Expected ${D.length} arguments, but found ${O.length} instead.`);else{for(let V=0;V<O.length;V++){const U=Array.isArray(D)?D[V]:D.type,G=O[V];E.concat(V+1).checkSubtype(U,G.type)}if(0===E.errors.length)return new zc(u,b,k,O)}}if(1===S.length)l.errors.push(...E.errors);else{const D=(S.length?S:v).map(([O])=>{return F=O,Array.isArray(F)?`(${F.map(eo).join(", ")})`:`(${eo(F.type)}...)`;var F}).join(" | "),k=[];for(let O=1;O<o.length;O++){const F=l.parse(o[O],1+k.length);if(!F)return null;k.push(eo(F.type))}l.error(`Expected arguments of type ${D}, but found (${k.join(", ")}) instead.`)}return null}static register(o,l){zc.definitions=l;for(const u in l)o[u]=zc}}var ul=zc;class oc{constructor(o,l,u){this.type=aa,this.locale=u,this.caseSensitive=o,this.diacriticSensitive=l}static parse(o,l){if(2!==o.length)return l.error("Expected one argument.");const u=o[1];if("object"!=typeof u||Array.isArray(u))return l.error("Collator options argument must be an object.");const f=l.parse(void 0!==u["case-sensitive"]&&u["case-sensitive"],1,Bn);if(!f)return null;const b=l.parse(void 0!==u["diacritic-sensitive"]&&u["diacritic-sensitive"],1,Bn);if(!b)return null;let v=null;return u.locale&&(v=l.parse(u.locale,1,Li),!v)?null:new oc(f,b,v)}evaluate(o){return new La(this.caseSensitive.evaluate(o),this.diacriticSensitive.evaluate(o),this.locale?this.locale.evaluate(o):null)}eachChild(o){o(this.caseSensitive),o(this.diacriticSensitive),this.locale&&o(this.locale)}outputDefined(){return!1}serialize(){const o={};return o["case-sensitive"]=this.caseSensitive.serialize(),o["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(o.locale=this.locale.serialize()),["collator",o]}}const Ba=8192;function xd(a,o){a[0]=Math.min(a[0],o[0]),a[1]=Math.min(a[1],o[1]),a[2]=Math.max(a[2],o[0]),a[3]=Math.max(a[3],o[1])}function xu(a,o){return!(a[0]<=o[0]||a[2]>=o[2]||a[1]<=o[1]||a[3]>=o[3])}function ri(a,o){const l=(180+a[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,f=Math.pow(2,o.z);return[Math.round(l*f*Ba),Math.round(u*f*Ba)]}function Mh(a,o,l){const u=a[0]-o[0],f=a[1]-o[1],b=a[0]-l[0],v=a[1]-l[1];return u*v-b*f==0&&u*b<=0&&f*v<=0}function Ah(a,o){let l=!1;for(let v=0,S=o.length;v<S;v++){const E=o[v];for(let D=0,k=E.length;D<k-1;D++){if(Mh(a,E[D],E[D+1]))return!1;(f=E[D])[1]>(u=a)[1]!=(b=E[D+1])[1]>u[1]&&u[0]<(b[0]-f[0])*(u[1]-f[1])/(b[1]-f[1])+f[0]&&(l=!l)}}var u,f,b;return l}function Xs(a,o){for(let l=0;l<o.length;l++)if(Ah(a,o[l]))return!0;return!1}function kh(a,o,l,u){const f=u[0]-l[0],b=u[1]-l[1],v=(a[0]-l[0])*b-f*(a[1]-l[1]),S=(o[0]-l[0])*b-f*(o[1]-l[1]);return v>0&&S<0||v<0&&S>0}function wd(a,o,l){for(const D of l)for(let k=0;k<D.length-1;++k)if((S=[(v=D[k+1])[0]-(b=D[k])[0],v[1]-b[1]])[0]*(E=[(f=o)[0]-(u=a)[0],f[1]-u[1]])[1]-S[1]*E[0]!=0&&kh(u,f,b,v)&&kh(b,v,u,f))return!0;var u,f,b,v,S,E;return!1}function Bi(a,o){for(let l=0;l<a.length;++l)if(!Ah(a[l],o))return!1;for(let l=0;l<a.length-1;++l)if(wd(a[l],a[l+1],o))return!1;return!0}function za(a,o){for(let l=0;l<o.length;l++)if(Bi(a,o[l]))return!0;return!1}function Vm(a,o,l){const u=[];for(let f=0;f<a.length;f++){const b=[];for(let v=0;v<a[f].length;v++){const S=ri(a[f][v],l);xd(o,S),b.push(S)}u.push(b)}return u}function r_(a,o,l){const u=[];for(let f=0;f<a.length;f++){const b=Vm(a[f],o,l);u.push(b)}return u}function ca(a,o,l,u){if(a[0]<l[0]||a[0]>l[2]){const f=.5*u;let b=a[0]-l[0]>f?-u:l[0]-a[0]>f?u:0;0===b&&(b=a[0]-l[2]>f?-u:l[2]-a[0]>f?u:0),a[0]+=b}xd(o,a)}function qr(a,o,l,u){const f=Math.pow(2,u.z)*Ba,b=[u.x*Ba,u.y*Ba],v=[];if(!a)return v;for(const S of a)for(const E of S){const D=[E.x+b[0],E.y+b[1]];ca(D,o,l,f),v.push(D)}return v}function jm(a,o,l,u){const f=Math.pow(2,u.z)*Ba,b=[u.x*Ba,u.y*Ba],v=[];if(!a)return v;for(const E of a){const D=[];for(const k of E){const O=[k.x+b[0],k.y+b[1]];xd(o,O),D.push(O)}v.push(D)}if(o[2]-o[0]<=f/2){(S=o)[0]=S[1]=1/0,S[2]=S[3]=-1/0;for(const E of v)for(const D of E)ca(D,o,l,f)}var S;return v}class Sd{constructor(o,l){this.type=Bn,this.geojson=o,this.geometries=l}static parse(o,l){if(2!==o.length)return l.error(`'within' expression requires exactly one argument, but found ${o.length-1} instead.`);if(yd(o[1])){const u=o[1];if("FeatureCollection"===u.type)for(let f=0;f<u.features.length;++f){const b=u.features[f].geometry.type;if("Polygon"===b||"MultiPolygon"===b)return new Sd(u,u.features[f].geometry)}else if("Feature"===u.type){const f=u.geometry.type;if("Polygon"===f||"MultiPolygon"===f)return new Sd(u,u.geometry)}else if("Polygon"===u.type||"MultiPolygon"===u.type)return new Sd(u,u)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(o){if(null!=o.geometry()&&null!=o.canonicalID()){if("Point"===o.geometryType())return function(l,u){const f=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],v=l.canonicalID();if(!v)return!1;if("Polygon"===u.type){const S=Vm(u.coordinates,b,v),E=qr(l.geometry(),f,b,v);if(!xu(f,b))return!1;for(const D of E)if(!Ah(D,S))return!1}if("MultiPolygon"===u.type){const S=r_(u.coordinates,b,v),E=qr(l.geometry(),f,b,v);if(!xu(f,b))return!1;for(const D of E)if(!Xs(D,S))return!1}return!0}(o,this.geometries);if("LineString"===o.geometryType())return function(l,u){const f=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],v=l.canonicalID();if(!v)return!1;if("Polygon"===u.type){const S=Vm(u.coordinates,b,v),E=jm(l.geometry(),f,b,v);if(!xu(f,b))return!1;for(const D of E)if(!Bi(D,S))return!1}if("MultiPolygon"===u.type){const S=r_(u.coordinates,b,v),E=jm(l.geometry(),f,b,v);if(!xu(f,b))return!1;for(const D of E)if(!za(D,S))return!1}return!0}(o,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Rl=Sd;function Ji(a){if(a instanceof ul&&("get"===a.name&&1===a.args.length||"feature-state"===a.name||"has"===a.name&&1===a.args.length||"properties"===a.name||"geometry-type"===a.name||"id"===a.name||/^filter-/.test(a.name))||a instanceof Rl)return!1;let o=!0;return a.eachChild(l=>{o&&!Ji(l)&&(o=!1)}),o}function Ea(a){if(a instanceof ul&&"feature-state"===a.name)return!1;let o=!0;return a.eachChild(l=>{o&&!Ea(l)&&(o=!1)}),o}function Pl(a,o){if(a instanceof ul&&o.indexOf(a.name)>=0)return!1;let l=!0;return a.eachChild(u=>{l&&!Pl(u,o)&&(l=!1)}),l}class wu{constructor(o,l){this.type=l.type,this.name=o,this.boundExpression=l}static parse(o,l){if(2!==o.length||"string"!=typeof o[1])return l.error("'var' expression requires exactly one string literal argument.");const u=o[1];return l.scope.has(u)?new wu(u,l.scope.get(u)):l.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(o){return this.boundExpression.evaluate(o)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Yp=wu;class ua{constructor(o,l=[],u,f=new mo,b=[]){this.registry=o,this.path=l,this.key=l.map(v=>`[${v}]`).join(""),this.scope=f,this.errors=b,this.expectedType=u}parse(o,l,u,f,b={}){return l?this.concat(l,u,f)._parse(o,b):this._parse(o,b)}_parse(o,l){function u(f,b,v){return"assert"===v?new rc(b,[f]):"coerce"===v?new vu(b,[f]):f}if(null!==o&&"string"!=typeof o&&"boolean"!=typeof o&&"number"!=typeof o||(o=["literal",o]),Array.isArray(o)){if(0===o.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const f=o[0];if("string"!=typeof f)return this.error(`Expression name must be a string, but found ${typeof f} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const b=this.registry[f];if(b){let v=b.parse(o,this);if(!v)return null;if(this.expectedType){const S=this.expectedType,E=v.type;if("string"!==S.kind&&"number"!==S.kind&&"boolean"!==S.kind&&"object"!==S.kind&&"array"!==S.kind||"value"!==E.kind)if("color"!==S.kind&&"formatted"!==S.kind&&"resolvedImage"!==S.kind||"value"!==E.kind&&"string"!==E.kind){if(this.checkSubtype(S,E))return null}else v=u(v,S,l.typeAnnotation||"coerce");else v=u(v,S,l.typeAnnotation||"assert")}if(!(v instanceof Bo)&&"resolvedImage"!==v.type.kind&&Kp(v)){const S=new Zp;try{v=new Bo(v.type,v.evaluate(S))}catch(E){return this.error(E.message),null}}return v}return this.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===o?"'undefined' value invalid. Use null instead.":"object"==typeof o?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof o} instead.`)}concat(o,l,u){const f="number"==typeof o?this.path.concat(o):this.path,b=u?this.scope.concat(u):this.scope;return new ua(this.registry,f,l||null,b,this.errors)}error(o,...l){const u=`${this.key}${l.map(f=>`[${f}]`).join("")}`;this.errors.push(new cl(u,o))}checkSubtype(o,l){const u=Ta(o,l);return u&&this.error(u),u}}var Vc=ua;function Kp(a){if(a instanceof Yp)return Kp(a.boundExpression);if(a instanceof ul&&"error"===a.name||a instanceof oc||a instanceof Rl)return!1;const o=a instanceof vu||a instanceof rc;let l=!0;return a.eachChild(u=>{l=o?l&&Kp(u):l&&u instanceof Bo}),!!l&&Ji(a)&&Pl(a,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function On(a,o){const l=a.length-1;let u,f,b=0,v=l,S=0;for(;b<=v;)if(S=Math.floor((b+v)/2),u=a[S],f=a[S+1],u<=o){if(S===l||o<f)return S;b=S+1}else{if(!(u>o))throw new Ei("Input is not a number.");v=S-1}return 0}class Rh{constructor(o,l,u){this.type=o,this.input=l,this.labels=[],this.outputs=[];for(const[f,b]of u)this.labels.push(f),this.outputs.push(b)}static parse(o,l){if(o.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return l.error("Expected an even number of arguments.");const u=l.parse(o[1],1,mn);if(!u)return null;const f=[];let b=null;l.expectedType&&"value"!==l.expectedType.kind&&(b=l.expectedType);for(let v=1;v<o.length;v+=2){const S=1===v?-1/0:o[v],E=o[v+1],D=v,k=v+1;if("number"!=typeof S)return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(f.length&&f[f.length-1][0]>=S)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);const O=l.parse(E,k,b);if(!O)return null;b=b||O.type,f.push([S,O])}return new Rh(b,u,f)}evaluate(o){const l=this.labels,u=this.outputs;if(1===l.length)return u[0].evaluate(o);const f=this.input.evaluate(o);if(f<=l[0])return u[0].evaluate(o);const b=l.length;return f>=l[b-1]?u[b-1].evaluate(o):u[On(l,f)].evaluate(o)}eachChild(o){o(this.input);for(const l of this.outputs)o(l)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}serialize(){const o=["step",this.input.serialize()];for(let l=0;l<this.labels.length;l++)l>0&&o.push(this.labels[l]),o.push(this.outputs[l].serialize());return o}}var Ph=Rh;function qi(a,o,l){return a*(1-l)+o*l}var Ln=Object.freeze({__proto__:null,array:function(a,o,l){return a.map((u,f)=>qi(u,o[f],l))},color:function(a,o,l){return new Eo(qi(a.r,o.r,l),qi(a.g,o.g,l),qi(a.b,o.b,l),qi(a.a,o.a,l))},number:qi});const Ft=4/29,Po=6/29,xr=3*Po*Po,Rs=Math.PI/180,Su=180/Math.PI;function Ps(a){return a>.008856451679035631?Math.pow(a,1/3):a/xr+Ft}function Cu(a){return a>Po?a*a*a:xr*(a-Ft)}function Cd(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function sc(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function Td(a){const o=sc(a.r),l=sc(a.g),u=sc(a.b),f=Ps((.4124564*o+.3575761*l+.1804375*u)/.95047),b=Ps((.2126729*o+.7151522*l+.072175*u)/1);return{l:116*b-16,a:500*(f-b),b:200*(b-Ps((.0193339*o+.119192*l+.9503041*u)/1.08883)),alpha:a.a}}function ac(a){let o=(a.l+16)/116,l=isNaN(a.a)?o:o+a.a/500,u=isNaN(a.b)?o:o-a.b/200;return o=1*Cu(o),l=.95047*Cu(l),u=1.08883*Cu(u),new Eo(Cd(3.2404542*l-1.5371385*o-.4985314*u),Cd(-.969266*l+1.8760108*o+.041556*u),Cd(.0556434*l-.2040259*o+1.0572252*u),a.alpha)}function ys(a,o,l){const u=o-a;return a+l*(u>180||u<-180?u-360*Math.round(u/360):u)}const Ed={forward:Td,reverse:ac,interpolate:function(a,o,l){return{l:qi(a.l,o.l,l),a:qi(a.a,o.a,l),b:qi(a.b,o.b,l),alpha:qi(a.alpha,o.alpha,l)}}},is={forward:function(a){const{l:o,a:l,b:u}=Td(a),f=Math.atan2(u,l)*Su;return{h:f<0?f+360:f,c:Math.sqrt(l*l+u*u),l:o,alpha:a.a}},reverse:function(a){const o=a.h*Rs,l=a.c;return ac({l:a.l,a:Math.cos(o)*l,b:Math.sin(o)*l,alpha:a.alpha})},interpolate:function(a,o,l){return{h:ys(a.h,o.h,l),c:qi(a.c,o.c,l),l:qi(a.l,o.l,l),alpha:qi(a.alpha,o.alpha,l)}}};var kn=Object.freeze({__proto__:null,hcl:is,lab:Ed});class Di{constructor(o,l,u,f,b){this.type=o,this.operator=l,this.interpolation=u,this.input=f,this.labels=[],this.outputs=[];for(const[v,S]of b)this.labels.push(v),this.outputs.push(S)}static interpolationFactor(o,l,u,f){let b=0;if("exponential"===o.name)b=Yr(l,o.base,u,f);else if("linear"===o.name)b=Yr(l,1,u,f);else if("cubic-bezier"===o.name){const v=o.controlPoints;b=new Dn(v[0],v[1],v[2],v[3]).solve(Yr(l,1,u,f))}return b}static parse(o,l){let[u,f,b,...v]=o;if(!Array.isArray(f)||0===f.length)return l.error("Expected an interpolation type expression.",1);if("linear"===f[0])f={name:"linear"};else if("exponential"===f[0]){const D=f[1];if("number"!=typeof D)return l.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:D}}else{if("cubic-bezier"!==f[0])return l.error(`Unknown interpolation type ${String(f[0])}`,1,0);{const D=f.slice(1);if(4!==D.length||D.some(k=>"number"!=typeof k||k<0||k>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:D}}}if(o.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(b=l.parse(b,2,mn),!b)return null;const S=[];let E=null;"interpolate-hcl"===u||"interpolate-lab"===u?E=As:l.expectedType&&"value"!==l.expectedType.kind&&(E=l.expectedType);for(let D=0;D<v.length;D+=2){const k=v[D],O=v[D+1],F=D+3,V=D+4;if("number"!=typeof k)return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',F);if(S.length&&S[S.length-1][0]>=k)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',F);const U=l.parse(O,V,E);if(!U)return null;E=E||U.type,S.push([k,U])}return"number"===E.kind||"color"===E.kind||"array"===E.kind&&"number"===E.itemType.kind&&"number"==typeof E.N?new Di(E,u,f,b,S):l.error(`Type ${eo(E)} is not interpolatable.`)}evaluate(o){const l=this.labels,u=this.outputs;if(1===l.length)return u[0].evaluate(o);const f=this.input.evaluate(o);if(f<=l[0])return u[0].evaluate(o);const b=l.length;if(f>=l[b-1])return u[b-1].evaluate(o);const v=On(l,f),S=Di.interpolationFactor(this.interpolation,f,l[v],l[v+1]),E=u[v].evaluate(o),D=u[v+1].evaluate(o);return"interpolate"===this.operator?Ln[this.type.kind.toLowerCase()](E,D,S):"interpolate-hcl"===this.operator?is.reverse(is.interpolate(is.forward(E),is.forward(D),S)):Ed.reverse(Ed.interpolate(Ed.forward(E),Ed.forward(D),S))}eachChild(o){o(this.input);for(const l of this.outputs)o(l)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}serialize(){let o;o="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const l=[this.operator,o,this.input.serialize()];for(let u=0;u<this.labels.length;u++)l.push(this.labels[u],this.outputs[u].serialize());return l}}function Yr(a,o,l,u){const f=u-l,b=a-l;return 0===f?0:1===o?b/f:(Math.pow(o,b)-1)/(Math.pow(o,f)-1)}var bo=Di;class dl{constructor(o,l){this.type=o,this.args=l}static parse(o,l){if(o.length<2)return l.error("Expectected at least one argument.");let u=null;const f=l.expectedType;f&&"value"!==f.kind&&(u=f);const b=[];for(const S of o.slice(1)){const E=l.parse(S,1+b.length,u,void 0,{typeAnnotation:"omit"});if(!E)return null;u=u||E.type,b.push(E)}const v=f&&b.some(S=>Ta(f,S.type));return new dl(v?Mi:u,b)}evaluate(o){let l,u=null,f=0;for(const b of this.args){if(f++,u=b.evaluate(o),u&&u instanceof Fa&&!u.available&&(l||(l=u),u=null,f===this.args.length))return l;if(null!==u)break}return u}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){const o=["coalesce"];return this.eachChild(l=>{o.push(l.serialize())}),o}}var Oo=dl;class hl{constructor(o,l){this.type=l.type,this.bindings=[].concat(o),this.result=l}evaluate(o){return this.result.evaluate(o)}eachChild(o){for(const l of this.bindings)o(l[1]);o(this.result)}static parse(o,l){if(o.length<4)return l.error(`Expected at least 3 arguments, but found ${o.length-1} instead.`);const u=[];for(let b=1;b<o.length-1;b+=2){const v=o[b];if("string"!=typeof v)return l.error(`Expected string, but found ${typeof v} instead.`,b);if(/[^a-zA-Z0-9_]/.test(v))return l.error("Variable names must contain only alphanumeric characters or '_'.",b);const S=l.parse(o[b+1],b+1);if(!S)return null;u.push([v,S])}const f=l.parse(o[o.length-1],o.length-1,l.expectedType,u);return f?new hl(u,f):null}outputDefined(){return this.result.outputDefined()}serialize(){const o=["let"];for(const[l,u]of this.bindings)o.push(l,u.serialize());return o.push(this.result.serialize()),o}}var ao=hl;class jc{constructor(o,l,u){this.type=o,this.index=l,this.input=u}static parse(o,l){if(3!==o.length)return l.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const u=l.parse(o[1],1,mn),f=l.parse(o[2],2,Gs(l.expectedType||Mi));return u&&f?new jc(f.type.itemType,u,f):null}evaluate(o){const l=this.index.evaluate(o),u=this.input.evaluate(o);if(l<0)throw new Ei(`Array index out of bounds: ${l} < 0.`);if(l>=u.length)throw new Ei(`Array index out of bounds: ${l} > ${u.length-1}.`);if(l!==Math.floor(l))throw new Ei(`Array index must be an integer, but found ${l} instead.`);return u[l]}eachChild(o){o(this.index),o(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Dd=jc;class Fi{constructor(o,l){this.type=Bn,this.needle=o,this.haystack=l}static parse(o,l){if(3!==o.length)return l.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const u=l.parse(o[1],1,Mi),f=l.parse(o[2],2,Mi);return u&&f?xi(u.type,[Bn,Li,mn,Or,Mi])?new Fi(u,f):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${eo(u.type)} instead`):null}evaluate(o){const l=this.needle.evaluate(o),u=this.haystack.evaluate(o);if(null==u)return!1;if(!ir(l,["boolean","string","number","null"]))throw new Ei(`Expected first argument to be of type boolean, string, number or null, but found ${eo(go(l))} instead.`);if(!ir(u,["string","array"]))throw new Ei(`Expected second argument to be of type array or string, but found ${eo(go(u))} instead.`);return u.indexOf(l)>=0}eachChild(o){o(this.needle),o(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Uc=Fi;class pl{constructor(o,l,u){this.type=mn,this.needle=o,this.haystack=l,this.fromIndex=u}static parse(o,l){if(o.length<=2||o.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const u=l.parse(o[1],1,Mi),f=l.parse(o[2],2,Mi);if(!u||!f)return null;if(!xi(u.type,[Bn,Li,mn,Or,Mi]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${eo(u.type)} instead`);if(4===o.length){const b=l.parse(o[3],3,mn);return b?new pl(u,f,b):null}return new pl(u,f)}evaluate(o){const l=this.needle.evaluate(o),u=this.haystack.evaluate(o);if(!ir(l,["boolean","string","number","null"]))throw new Ei(`Expected first argument to be of type boolean, string, number or null, but found ${eo(go(l))} instead.`);if(!ir(u,["string","array"]))throw new Ei(`Expected second argument to be of type array or string, but found ${eo(go(u))} instead.`);if(this.fromIndex){const f=this.fromIndex.evaluate(o);return u.indexOf(l,f)}return u.indexOf(l)}eachChild(o){o(this.needle),o(this.haystack),this.fromIndex&&o(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const o=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),o]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Lh=pl;class Ol{constructor(o,l,u,f,b,v){this.inputType=o,this.type=l,this.input=u,this.cases=f,this.outputs=b,this.otherwise=v}static parse(o,l){if(o.length<5)return l.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if(o.length%2!=1)return l.error("Expected an even number of arguments.");let u,f;l.expectedType&&"value"!==l.expectedType.kind&&(f=l.expectedType);const b={},v=[];for(let D=2;D<o.length-1;D+=2){let k=o[D];const O=o[D+1];Array.isArray(k)||(k=[k]);const F=l.concat(D);if(0===k.length)return F.error("Expected at least one branch label.");for(const U of k){if("number"!=typeof U&&"string"!=typeof U)return F.error("Branch labels must be numbers or strings.");if("number"==typeof U&&Math.abs(U)>Number.MAX_SAFE_INTEGER)return F.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof U&&Math.floor(U)!==U)return F.error("Numeric branch labels must be integer values.");if(u){if(F.checkSubtype(u,go(U)))return null}else u=go(U);if(void 0!==b[String(U)])return F.error("Branch labels must be unique.");b[String(U)]=v.length}const V=l.parse(O,D,f);if(!V)return null;f=f||V.type,v.push(V)}const S=l.parse(o[1],1,Mi);if(!S)return null;const E=l.parse(o[o.length-1],o.length-1,f);return E?"value"!==S.type.kind&&l.concat(1).checkSubtype(u,S.type)?null:new Ol(u,f,S,b,v,E):null}evaluate(o){const l=this.input.evaluate(o);return(go(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(o)}eachChild(o){o(this.input),this.outputs.forEach(o),o(this.otherwise)}outputDefined(){return this.outputs.every(o=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){const o=["match",this.input.serialize()],l=Object.keys(this.cases).sort(),u=[],f={};for(const v of l){const S=f[this.cases[v]];void 0===S?(f[this.cases[v]]=u.length,u.push([this.cases[v],[v]])):u[S][1].push(v)}const b=v=>"number"===this.inputType.kind?Number(v):v;for(const[v,S]of u)o.push(1===S.length?b(S[0]):S.map(b)),o.push(this.outputs[v].serialize());return o.push(this.otherwise.serialize()),o}}var vs=Ol;class Hc{constructor(o,l,u){this.type=o,this.branches=l,this.otherwise=u}static parse(o,l){if(o.length<4)return l.error(`Expected at least 3 arguments, but found only ${o.length-1}.`);if(o.length%2!=0)return l.error("Expected an odd number of arguments.");let u;l.expectedType&&"value"!==l.expectedType.kind&&(u=l.expectedType);const f=[];for(let v=1;v<o.length-1;v+=2){const S=l.parse(o[v],v,Bn);if(!S)return null;const E=l.parse(o[v+1],v+1,u);if(!E)return null;f.push([S,E]),u=u||E.type}const b=l.parse(o[o.length-1],o.length-1,u);return b?new Hc(u,f,b):null}evaluate(o){for(const[l,u]of this.branches)if(l.evaluate(o))return u.evaluate(o);return this.otherwise.evaluate(o)}eachChild(o){for(const[l,u]of this.branches)o(l),o(u);o(this.otherwise)}outputDefined(){return this.branches.every(([o,l])=>l.outputDefined())&&this.otherwise.outputDefined()}serialize(){const o=["case"];return this.eachChild(l=>{o.push(l.serialize())}),o}}var $c=Hc;class Os{constructor(o,l,u,f){this.type=o,this.input=l,this.beginIndex=u,this.endIndex=f}static parse(o,l){if(o.length<=2||o.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const u=l.parse(o[1],1,Mi),f=l.parse(o[2],2,mn);if(!u||!f)return null;if(!xi(u.type,[Gs(Mi),Li,Mi]))return l.error(`Expected first argument to be of type array or string, but found ${eo(u.type)} instead`);if(4===o.length){const b=l.parse(o[3],3,mn);return b?new Os(u.type,u,f,b):null}return new Os(u.type,u,f)}evaluate(o){const l=this.input.evaluate(o),u=this.beginIndex.evaluate(o);if(!ir(l,["string","array"]))throw new Ei(`Expected first argument to be of type array or string, but found ${eo(go(l))} instead.`);if(this.endIndex){const f=this.endIndex.evaluate(o);return l.slice(u,f)}return l.slice(u)}eachChild(o){o(this.input),o(this.beginIndex),this.endIndex&&o(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const o=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),o]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var qc=Os;function Id(a,o){return"=="===a||"!="===a?"boolean"===o.kind||"string"===o.kind||"number"===o.kind||"null"===o.kind||"value"===o.kind:"string"===o.kind||"number"===o.kind||"value"===o.kind}function Gr(a,o,l,u){return 0===u.compare(o,l)}function Tu(a,o,l){const u="=="!==a&&"!="!==a;return class XN{constructor(b,v,S){this.type=Bn,this.lhs=b,this.rhs=v,this.collator=S,this.hasUntypedArgument="value"===b.type.kind||"value"===v.type.kind}static parse(b,v){if(3!==b.length&&4!==b.length)return v.error("Expected two or three arguments.");const S=b[0];let E=v.parse(b[1],1,Mi);if(!E)return null;if(!Id(S,E.type))return v.concat(1).error(`"${S}" comparisons are not supported for type '${eo(E.type)}'.`);let D=v.parse(b[2],2,Mi);if(!D)return null;if(!Id(S,D.type))return v.concat(2).error(`"${S}" comparisons are not supported for type '${eo(D.type)}'.`);if(E.type.kind!==D.type.kind&&"value"!==E.type.kind&&"value"!==D.type.kind)return v.error(`Cannot compare types '${eo(E.type)}' and '${eo(D.type)}'.`);u&&("value"===E.type.kind&&"value"!==D.type.kind?E=new rc(D.type,[E]):"value"!==E.type.kind&&"value"===D.type.kind&&(D=new rc(E.type,[D])));let k=null;if(4===b.length){if("string"!==E.type.kind&&"string"!==D.type.kind&&"value"!==E.type.kind&&"value"!==D.type.kind)return v.error("Cannot use collator to compare non-string types.");if(k=v.parse(b[3],3,aa),!k)return null}return new XN(E,D,k)}evaluate(b){const v=this.lhs.evaluate(b),S=this.rhs.evaluate(b);if(u&&this.hasUntypedArgument){const E=go(v),D=go(S);if(E.kind!==D.kind||"string"!==E.kind&&"number"!==E.kind)throw new Ei(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${E.kind}, ${D.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const E=go(v),D=go(S);if("string"!==E.kind||"string"!==D.kind)return o(b,v,S)}return this.collator?l(b,v,S,this.collator.evaluate(b)):o(b,v,S)}eachChild(b){b(this.lhs),b(this.rhs),this.collator&&b(this.collator)}outputDefined(){return!0}serialize(){const b=[a];return this.eachChild(v=>{b.push(v.serialize())}),b}}}const o_=Tu("==",function(a,o,l){return o===l},Gr),Zs=Tu("!=",function(a,o,l){return o!==l},function(a,o,l,u){return!Gr(0,o,l,u)}),Va=Tu("<",function(a,o,l){return o<l},function(a,o,l,u){return u.compare(o,l)<0}),Qp=Tu(">",function(a,o,l){return o>l},function(a,o,l,u){return u.compare(o,l)>0}),Fh=Tu("<=",function(a,o,l){return o<=l},function(a,o,l,u){return u.compare(o,l)<=0}),Md=Tu(">=",function(a,o,l){return o>=l},function(a,o,l,u){return u.compare(o,l)>=0});class Ys{constructor(o,l,u,f,b,v){this.type=Li,this.number=o,this.locale=l,this.currency=u,this.unit=f,this.minFractionDigits=b,this.maxFractionDigits=v}static parse(o,l){if(3!==o.length)return l.error("Expected two arguments.");const u=l.parse(o[1],1,mn);if(!u)return null;const f=o[2];if("object"!=typeof f||Array.isArray(f))return l.error("NumberFormat options argument must be an object.");let b=null;if(f.locale&&(b=l.parse(f.locale,1,Li),!b))return null;let v=null;if(f.currency&&(v=l.parse(f.currency,1,Li),!v))return null;let S=null;if(f.unit&&(S=l.parse(f.unit,1,Li),!S))return null;let E=null;if(f["min-fraction-digits"]&&(E=l.parse(f["min-fraction-digits"],1,mn),!E))return null;let D=null;return f["max-fraction-digits"]&&(D=l.parse(f["max-fraction-digits"],1,mn),!D)?null:new Ys(u,b,v,S,E,D)}evaluate(o){return new Intl.NumberFormat(this.locale?this.locale.evaluate(o):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(o):void 0,unit:this.unit?this.unit.evaluate(o):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(o):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(o):void 0}).format(this.number.evaluate(o))}eachChild(o){o(this.number),this.locale&&o(this.locale),this.currency&&o(this.currency),this.unit&&o(this.unit),this.minFractionDigits&&o(this.minFractionDigits),this.maxFractionDigits&&o(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const o={};return this.locale&&(o.locale=this.locale.serialize()),this.currency&&(o.currency=this.currency.serialize()),this.unit&&(o.unit=this.unit.serialize()),this.minFractionDigits&&(o["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(o["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),o]}}class Eu{constructor(o){this.type=mn,this.input=o}static parse(o,l){if(2!==o.length)return l.error(`Expected 1 argument, but found ${o.length-1} instead.`);const u=l.parse(o[1],1);return u?"array"!==u.type.kind&&"string"!==u.type.kind&&"value"!==u.type.kind?l.error(`Expected argument of type string or array, but found ${eo(u.type)} instead.`):new Eu(u):null}evaluate(o){const l=this.input.evaluate(o);if("string"==typeof l||Array.isArray(l))return l.length;throw new Ei(`Expected value to be of type string or array, but found ${eo(go(l))} instead.`)}eachChild(o){o(this.input)}outputDefined(){return!1}serialize(){const o=["length"];return this.eachChild(l=>{o.push(l.serialize())}),o}}const s_={"==":o_,"!=":Zs,">":Qp,"<":Va,">=":Md,"<=":Fh,array:rc,at:Dd,boolean:rc,case:$c,coalesce:Oo,collator:oc,format:tn,image:Xp,in:Uc,"index-of":Lh,interpolate:bo,"interpolate-hcl":bo,"interpolate-lab":bo,length:Eu,let:ao,literal:Bo,match:vs,number:rc,"number-format":Ys,object:rc,slice:qc,step:Ph,string:rc,"to-boolean":vu,"to-color":vu,"to-number":vu,"to-string":vu,var:Yp,within:Rl};function Hm(a,[o,l,u,f]){o=o.evaluate(a),l=l.evaluate(a),u=u.evaluate(a);const b=f?f.evaluate(a):1,v=i_(o,l,u,b);if(v)throw new Ei(v);return new Eo(o/255*b,l/255*b,u/255*b,b)}function Ll(a,o){return a in o}function Jp(a,o){const l=o[a];return void 0===l?null:l}function ja(a){return{type:a}}ul.register(s_,{error:[{kind:"error"},[Li],(a,[o])=>{throw new Ei(o.evaluate(a))}],typeof:[Li,[Mi],(a,[o])=>eo(go(o.evaluate(a)))],"to-rgba":[Gs(mn,4),[As],(a,[o])=>o.evaluate(a).toArray()],rgb:[As,[mn,mn,mn],Hm],rgba:[As,[mn,mn,mn,mn],Hm],has:{type:Bn,overloads:[[[Li],(a,[o])=>Ll(o.evaluate(a),a.properties())],[[Li,Zi],(a,[o,l])=>Ll(o.evaluate(a),l.evaluate(a))]]},get:{type:Mi,overloads:[[[Li],(a,[o])=>Jp(o.evaluate(a),a.properties())],[[Li,Zi],(a,[o,l])=>Jp(o.evaluate(a),l.evaluate(a))]]},"feature-state":[Mi,[Li],(a,[o])=>Jp(o.evaluate(a),a.featureState||{})],properties:[Zi,[],a=>a.properties()],"geometry-type":[Li,[],a=>a.geometryType()],id:[Mi,[],a=>a.id()],zoom:[mn,[],a=>a.globals.zoom],pitch:[mn,[],a=>a.globals.pitch||0],"distance-from-center":[mn,[],a=>a.distanceFromCenter()],"heatmap-density":[mn,[],a=>a.globals.heatmapDensity||0],"line-progress":[mn,[],a=>a.globals.lineProgress||0],"sky-radial-progress":[mn,[],a=>a.globals.skyRadialProgress||0],accumulated:[Mi,[],a=>void 0===a.globals.accumulated?null:a.globals.accumulated],"+":[mn,ja(mn),(a,o)=>{let l=0;for(const u of o)l+=u.evaluate(a);return l}],"*":[mn,ja(mn),(a,o)=>{let l=1;for(const u of o)l*=u.evaluate(a);return l}],"-":{type:mn,overloads:[[[mn,mn],(a,[o,l])=>o.evaluate(a)-l.evaluate(a)],[[mn],(a,[o])=>-o.evaluate(a)]]},"/":[mn,[mn,mn],(a,[o,l])=>o.evaluate(a)/l.evaluate(a)],"%":[mn,[mn,mn],(a,[o,l])=>o.evaluate(a)%l.evaluate(a)],ln2:[mn,[],()=>Math.LN2],pi:[mn,[],()=>Math.PI],e:[mn,[],()=>Math.E],"^":[mn,[mn,mn],(a,[o,l])=>Math.pow(o.evaluate(a),l.evaluate(a))],sqrt:[mn,[mn],(a,[o])=>Math.sqrt(o.evaluate(a))],log10:[mn,[mn],(a,[o])=>Math.log(o.evaluate(a))/Math.LN10],ln:[mn,[mn],(a,[o])=>Math.log(o.evaluate(a))],log2:[mn,[mn],(a,[o])=>Math.log(o.evaluate(a))/Math.LN2],sin:[mn,[mn],(a,[o])=>Math.sin(o.evaluate(a))],cos:[mn,[mn],(a,[o])=>Math.cos(o.evaluate(a))],tan:[mn,[mn],(a,[o])=>Math.tan(o.evaluate(a))],asin:[mn,[mn],(a,[o])=>Math.asin(o.evaluate(a))],acos:[mn,[mn],(a,[o])=>Math.acos(o.evaluate(a))],atan:[mn,[mn],(a,[o])=>Math.atan(o.evaluate(a))],min:[mn,ja(mn),(a,o)=>Math.min(...o.map(l=>l.evaluate(a)))],max:[mn,ja(mn),(a,o)=>Math.max(...o.map(l=>l.evaluate(a)))],abs:[mn,[mn],(a,[o])=>Math.abs(o.evaluate(a))],round:[mn,[mn],(a,[o])=>{const l=o.evaluate(a);return l<0?-Math.round(-l):Math.round(l)}],floor:[mn,[mn],(a,[o])=>Math.floor(o.evaluate(a))],ceil:[mn,[mn],(a,[o])=>Math.ceil(o.evaluate(a))],"filter-==":[Bn,[Li,Mi],(a,[o,l])=>a.properties()[o.value]===l.value],"filter-id-==":[Bn,[Mi],(a,[o])=>a.id()===o.value],"filter-type-==":[Bn,[Li],(a,[o])=>a.geometryType()===o.value],"filter-<":[Bn,[Li,Mi],(a,[o,l])=>{const u=a.properties()[o.value],f=l.value;return typeof u==typeof f&&u<f}],"filter-id-<":[Bn,[Mi],(a,[o])=>{const l=a.id(),u=o.value;return typeof l==typeof u&&l<u}],"filter->":[Bn,[Li,Mi],(a,[o,l])=>{const u=a.properties()[o.value],f=l.value;return typeof u==typeof f&&u>f}],"filter-id->":[Bn,[Mi],(a,[o])=>{const l=a.id(),u=o.value;return typeof l==typeof u&&l>u}],"filter-<=":[Bn,[Li,Mi],(a,[o,l])=>{const u=a.properties()[o.value],f=l.value;return typeof u==typeof f&&u<=f}],"filter-id-<=":[Bn,[Mi],(a,[o])=>{const l=a.id(),u=o.value;return typeof l==typeof u&&l<=u}],"filter->=":[Bn,[Li,Mi],(a,[o,l])=>{const u=a.properties()[o.value],f=l.value;return typeof u==typeof f&&u>=f}],"filter-id->=":[Bn,[Mi],(a,[o])=>{const l=a.id(),u=o.value;return typeof l==typeof u&&l>=u}],"filter-has":[Bn,[Mi],(a,[o])=>o.value in a.properties()],"filter-has-id":[Bn,[],a=>null!==a.id()&&void 0!==a.id()],"filter-type-in":[Bn,[Gs(Li)],(a,[o])=>o.value.indexOf(a.geometryType())>=0],"filter-id-in":[Bn,[Gs(Mi)],(a,[o])=>o.value.indexOf(a.id())>=0],"filter-in-small":[Bn,[Li,Gs(Mi)],(a,[o,l])=>l.value.indexOf(a.properties()[o.value])>=0],"filter-in-large":[Bn,[Li,Gs(Mi)],(a,[o,l])=>function(u,f,b,v){for(;b<=v;){const S=b+v>>1;if(f[S]===u)return!0;f[S]>u?v=S-1:b=S+1}return!1}(a.properties()[o.value],l.value,0,l.value.length-1)],all:{type:Bn,overloads:[[[Bn,Bn],(a,[o,l])=>o.evaluate(a)&&l.evaluate(a)],[ja(Bn),(a,o)=>{for(const l of o)if(!l.evaluate(a))return!1;return!0}]]},any:{type:Bn,overloads:[[[Bn,Bn],(a,[o,l])=>o.evaluate(a)||l.evaluate(a)],[ja(Bn),(a,o)=>{for(const l of o)if(l.evaluate(a))return!0;return!1}]]},"!":[Bn,[Bn],(a,[o])=>!o.evaluate(a)],"is-supported-script":[Bn,[Li],(a,[o])=>{const l=a.globals&&a.globals.isSupportedScript;return!l||l(o.evaluate(a))}],upcase:[Li,[Li],(a,[o])=>o.evaluate(a).toUpperCase()],downcase:[Li,[Li],(a,[o])=>o.evaluate(a).toLowerCase()],concat:[Li,ja(Mi),(a,o)=>o.map(l=>vd(l.evaluate(a))).join("")],"resolved-locale":[Li,[aa],(a,[o])=>o.evaluate(a).resolvedLocale()]});var Nh=s_;function a_(a){return{result:"success",value:a}}function Du(a){return{result:"error",value:a}}function Ad(a){return"data-driven"===a["property-type"]}function ef(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function tf(a){return!!a.expression&&a.expression.interpolated}function rr(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":null===a?"null":typeof a}function Bh(a){return"object"==typeof a&&null!==a&&!Array.isArray(a)}function l_(a){return a}function nf(a,o){const l="color"===o.type,u=a.stops&&"object"==typeof a.stops[0][0],f=u||!(u||void 0!==a.property),b=a.type||(tf(o)?"exponential":"interval");if(l&&((a=kl({},a)).stops&&(a.stops=a.stops.map(D=>[D[0],Eo.parse(D[1])])),a.default=Eo.parse(a.default?a.default:o.default)),a.colorSpace&&"rgb"!==a.colorSpace&&!kn[a.colorSpace])throw new Error(`Unknown color space: ${a.colorSpace}`);let v,S,E;if("exponential"===b)v=Ua;else if("interval"===b)v=Rd;else if("categorical"===b){v=c_,S=Object.create(null);for(const D of a.stops)S[D[0]]=D[1];E=typeof a.stops[0][0]}else{if("identity"!==b)throw new Error(`Unknown function type "${b}"`);v=u_}if(u){const D={},k=[];for(let V=0;V<a.stops.length;V++){const U=a.stops[V],G=U[0].zoom;void 0===D[G]&&(D[G]={zoom:G,type:a.type,property:a.property,default:a.default,stops:[]},k.push(G)),D[G].stops.push([U[0].value,U[1]])}const O=[];for(const V of k)O.push([D[V].zoom,nf(D[V],o)]);const F={name:"linear"};return{kind:"composite",interpolationType:F,interpolationFactor:bo.interpolationFactor.bind(void 0,F),zoomStops:O.map(V=>V[0]),evaluate:({zoom:V},U)=>Ua({stops:O,base:a.base},o,V).evaluate(V,U)}}if(f){const D="exponential"===b?{name:"exponential",base:void 0!==a.base?a.base:1}:null;return{kind:"camera",interpolationType:D,interpolationFactor:bo.interpolationFactor.bind(void 0,D),zoomStops:a.stops.map(k=>k[0]),evaluate:({zoom:k})=>v(a,o,k,S,E)}}return{kind:"source",evaluate(D,k){const O=k&&k.properties?k.properties[a.property]:void 0;return void 0===O?kd(a.default,o.default):v(a,o,O,S,E)}}}function kd(a,o,l){return void 0!==a?a:void 0!==o?o:void 0!==l?l:void 0}function c_(a,o,l,u,f){return kd(typeof l===f?u[l]:void 0,a.default,o.default)}function Rd(a,o,l){if("number"!==rr(l))return kd(a.default,o.default);const u=a.stops.length;if(1===u||l<=a.stops[0][0])return a.stops[0][1];if(l>=a.stops[u-1][0])return a.stops[u-1][1];const f=On(a.stops.map(b=>b[0]),l);return a.stops[f][1]}function Ua(a,o,l){const u=void 0!==a.base?a.base:1;if("number"!==rr(l))return kd(a.default,o.default);const f=a.stops.length;if(1===f||l<=a.stops[0][0])return a.stops[0][1];if(l>=a.stops[f-1][0])return a.stops[f-1][1];const b=On(a.stops.map(k=>k[0]),l),v=function(k,O,F,V){const U=V-F,G=k-F;return 0===U?0:1===O?G/U:(Math.pow(O,G)-1)/(Math.pow(O,U)-1)}(l,u,a.stops[b][0],a.stops[b+1][0]),S=a.stops[b][1],E=a.stops[b+1][1];let D=Ln[o.type]||l_;if(a.colorSpace&&"rgb"!==a.colorSpace){const k=kn[a.colorSpace];D=(O,F)=>k.reverse(k.interpolate(k.forward(O),k.forward(F),v))}return"function"==typeof S.evaluate?{evaluate(...k){const O=S.evaluate.apply(void 0,k),F=E.evaluate.apply(void 0,k);if(void 0!==O&&void 0!==F)return D(O,F,v)}}:D(S,E,v)}function u_(a,o,l){return"color"===o.type?l=Eo.parse(l):"formatted"===o.type?l=la.fromString(l.toString()):"resolvedImage"===o.type?l=Fa.fromString(l.toString()):rr(l)===o.type||"enum"===o.type&&o.values[l]||(l=void 0),kd(l,a.default,o.default)}class rf{constructor(o,l){var u;this.expression=o,this._warningHistory={},this._evaluator=new Zp,this._defaultValue=l?"color"===(u=l).type&&(Bh(u.default)||Array.isArray(u.default))?new Eo(0,0,0,0):"color"===u.type?Eo.parse(u.default)||null:void 0===u.default?null:u.default:null,this._enumValues=l&&"enum"===l.type?l.values:null}evaluateWithoutErrorHandling(o,l,u,f,b,v,S,E){return this._evaluator.globals=o,this._evaluator.feature=l,this._evaluator.featureState=u,this._evaluator.canonical=f||null,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=v,this._evaluator.featureTileCoord=S||null,this._evaluator.featureDistanceData=E||null,this.expression.evaluate(this._evaluator)}evaluate(o,l,u,f,b,v,S,E){this._evaluator.globals=o,this._evaluator.feature=l||null,this._evaluator.featureState=u||null,this._evaluator.canonical=f||null,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=v||null,this._evaluator.featureTileCoord=S||null,this._evaluator.featureDistanceData=E||null;try{const D=this.expression.evaluate(this._evaluator);if(null==D||"number"==typeof D&&D!=D)return this._defaultValue;if(this._enumValues&&!(D in this._enumValues))throw new Ei(`Expected value to be one of ${Object.keys(this._enumValues).map(k=>JSON.stringify(k)).join(", ")}, but found ${JSON.stringify(D)} instead.`);return D}catch(D){return this._warningHistory[D.message]||(this._warningHistory[D.message]=!0,"undefined"!=typeof console&&console.warn(D.message)),this._defaultValue}}}function Pd(a){return Array.isArray(a)&&a.length>0&&"string"==typeof a[0]&&a[0]in Nh}function Da(a,o){const l=new Vc(Nh,[],o?function(f){const b={color:As,string:Li,number:mn,enum:Li,boolean:Bn,formatted:$i,resolvedImage:ci};return"array"===f.type?Gs(b[f.value]||Mi,f.length):b[f.type]}(o):void 0),u=l.parse(a,void 0,void 0,void 0,o&&"string"===o.type?{typeAnnotation:"coerce"}:void 0);return u?a_(new rf(u,o)):Du(l.errors)}class sf{constructor(o,l){this.kind=o,this._styleExpression=l,this.isStateDependent="constant"!==o&&!Ea(l.expression)}evaluateWithoutErrorHandling(o,l,u,f,b,v){return this._styleExpression.evaluateWithoutErrorHandling(o,l,u,f,b,v)}evaluate(o,l,u,f,b,v){return this._styleExpression.evaluate(o,l,u,f,b,v)}}class _r{constructor(o,l,u,f){this.kind=o,this.zoomStops=u,this._styleExpression=l,this.isStateDependent="camera"!==o&&!Ea(l.expression),this.interpolationType=f}evaluateWithoutErrorHandling(o,l,u,f,b,v){return this._styleExpression.evaluateWithoutErrorHandling(o,l,u,f,b,v)}evaluate(o,l,u,f,b,v){return this._styleExpression.evaluate(o,l,u,f,b,v)}interpolationFactor(o,l,u){return this.interpolationType?bo.interpolationFactor(this.interpolationType,o,l,u):0}}function Iu(a,o){if("error"===(a=Da(a,o)).result)return a;const l=a.value.expression,u=Ji(l);if(!u&&!Ad(o))return Du([new cl("","data expressions not supported")]);const f=Pl(l,["zoom","pitch","distance-from-center"]);if(!f&&!ef(o))return Du([new cl("","zoom expressions not supported")]);const b=Vh(l);return b||f?b instanceof cl?Du([b]):b instanceof bo&&!tf(o)?Du([new cl("",'"interpolate" expressions cannot be used with this property')]):a_(b?new _r(u?"camera":"composite",a.value,b.labels,b instanceof bo?b.interpolation:void 0):new sf(u?"constant":"source",a.value)):Du([new cl("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class zh{constructor(o,l){this._parameters=o,this._specification=l,kl(this,nf(this._parameters,this._specification))}static deserialize(o){return new zh(o._parameters,o._specification)}static serialize(o){return{_parameters:o._parameters,_specification:o._specification}}}function Vh(a){let o=null;if(a instanceof ao)o=Vh(a.result);else if(a instanceof Oo){for(const l of a.args)if(o=Vh(l),o)break}else(a instanceof Ph||a instanceof bo)&&a.input instanceof ul&&"zoom"===a.input.name&&(o=a);return o instanceof cl||a.eachChild(l=>{const u=Vh(l);u instanceof cl?o=u:!o&&u?o=new cl("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):o&&u&&o!==u&&(o=new cl("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),o}class yn{constructor(o,l,u,f){this.message=(o?`${o}: `:"")+u,f&&(this.identifier=f),null!=l&&l.__line__&&(this.line=l.__line__)}}function Ia(a){const o=a.key,l=a.value,u=a.valueSpec||{},f=a.objectElementValidators||{},b=a.style,v=a.styleSpec;let S=[];const E=rr(l);if("object"!==E)return[new yn(o,l,`object expected, ${E} found`)];for(const D in l){const k=D.split(".")[0];let O;f[k]?O=f[k]:u[k]?O=Ot:f["*"]?O=f["*"]:u["*"]&&(O=Ot),O?S=S.concat(O({key:(o&&`${o}.`)+D,value:l[D],valueSpec:u[k]||u["*"],style:b,styleSpec:v,object:l,objectKey:D},l)):S.push(new yn(o,l[D],`unknown property "${D}"`))}for(const D in u)f[D]||u[D].required&&void 0===u[D].default&&void 0===l[D]&&S.push(new yn(o,l,`missing required property "${D}"`));return S}function $m(a){const o=a.value,l=a.valueSpec,u=a.style,f=a.styleSpec,b=a.key,v=a.arrayElementValidator||Ot;if("array"!==rr(o))return[new yn(b,o,`array expected, ${rr(o)} found`)];if(l.length&&o.length!==l.length)return[new yn(b,o,`array length ${l.length} expected, length ${o.length} found`)];if(l["min-length"]&&o.length<l["min-length"])return[new yn(b,o,`array length at least ${l["min-length"]} expected, length ${o.length} found`)];let S={type:l.value,values:l.values,minimum:l.minimum,maximum:l.maximum,function:void 0};f.$version<7&&(S.function=l.function),"object"===rr(l.value)&&(S=l.value);let E=[];for(let D=0;D<o.length;D++)E=E.concat(v({array:o,arrayIndex:D,value:o[D],valueSpec:S,style:u,styleSpec:f,key:`${b}[${D}]`}));return E}function Gc(a){const o=a.key,l=a.value,u=a.valueSpec;let f=rr(l);if("number"===f&&l!=l&&(f="NaN"),"number"!==f)return[new yn(o,l,`number expected, ${f} found`)];if("minimum"in u){let b=u.minimum;if("array"===rr(u.minimum)&&(b=u.minimum[a.arrayIndex]),l<b)return[new yn(o,l,`${l} is less than the minimum value ${b}`)]}if("maximum"in u){let b=u.maximum;if("array"===rr(u.maximum)&&(b=u.maximum[a.arrayIndex]),l>b)return[new yn(o,l,`${l} is greater than the maximum value ${b}`)]}return[]}function Od(a){const o=a.valueSpec,l=To(a.value.type);let u,f,b,v={};const S="categorical"!==l&&void 0===a.value.property,E=!S,D="array"===rr(a.value.stops)&&"array"===rr(a.value.stops[0])&&"object"===rr(a.value.stops[0][0]),k=Ia({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(V){if("identity"===l)return[new yn(V.key,V.value,'identity function may not have a "stops" property')];let U=[];const G=V.value;return U=U.concat($m({key:V.key,value:G,valueSpec:V.valueSpec,style:V.style,styleSpec:V.styleSpec,arrayElementValidator:O})),"array"===rr(G)&&0===G.length&&U.push(new yn(V.key,G,"array must have at least one stop")),U},default:function(V){return Ot({key:V.key,value:V.value,valueSpec:o,style:V.style,styleSpec:V.styleSpec})}}});return"identity"===l&&S&&k.push(new yn(a.key,a.value,'missing required property "property"')),"identity"===l||a.value.stops||k.push(new yn(a.key,a.value,'missing required property "stops"')),"exponential"===l&&a.valueSpec.expression&&!tf(a.valueSpec)&&k.push(new yn(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(E&&!Ad(a.valueSpec)?k.push(new yn(a.key,a.value,"property functions not supported")):S&&!ef(a.valueSpec)&&k.push(new yn(a.key,a.value,"zoom functions not supported"))),"categorical"!==l&&!D||void 0!==a.value.property||k.push(new yn(a.key,a.value,'"property" property is required')),k;function O(V){let U=[];const G=V.value,J=V.key;if("array"!==rr(G))return[new yn(J,G,`array expected, ${rr(G)} found`)];if(2!==G.length)return[new yn(J,G,`array length 2 expected, length ${G.length} found`)];if(D){if("object"!==rr(G[0]))return[new yn(J,G,`object expected, ${rr(G[0])} found`)];if(void 0===G[0].zoom)return[new yn(J,G,"object stop key must have zoom")];if(void 0===G[0].value)return[new yn(J,G,"object stop key must have value")];const ue=To(G[0].zoom);if("number"!=typeof ue)return[new yn(J,G[0].zoom,"stop zoom values must be numbers")];if(b&&b>ue)return[new yn(J,G[0].zoom,"stop zoom values must appear in ascending order")];ue!==b&&(b=ue,f=void 0,v={}),U=U.concat(Ia({key:`${J}[0]`,value:G[0],valueSpec:{zoom:{}},style:V.style,styleSpec:V.styleSpec,objectElementValidators:{zoom:Gc,value:F}}))}else U=U.concat(F({key:`${J}[0]`,value:G[0],valueSpec:{},style:V.style,styleSpec:V.styleSpec},G));return Pd(Xo(G[1]))?U.concat([new yn(`${J}[1]`,G[1],"expressions are not allowed in function stops.")]):U.concat(Ot({key:`${J}[1]`,value:G[1],valueSpec:o,style:V.style,styleSpec:V.styleSpec}))}function F(V,U){const G=rr(V.value),J=To(V.value),ue=null!==V.value?V.value:U;if(u){if(G!==u)return[new yn(V.key,ue,`${G} stop domain type must match previous stop domain type ${u}`)]}else u=G;if("number"!==G&&"string"!==G&&"boolean"!==G&&"number"!=typeof J&&"string"!=typeof J&&"boolean"!=typeof J)return[new yn(V.key,ue,"stop domain value must be a number, string, or boolean")];if("number"!==G&&"categorical"!==l){let we=`number expected, ${G} found`;return Ad(o)&&void 0===l&&(we+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new yn(V.key,ue,we)]}return"categorical"!==l||"number"!==G||"number"==typeof J&&isFinite(J)&&Math.floor(J)===J?"categorical"!==l&&"number"===G&&"number"==typeof J&&"number"==typeof f&&void 0!==f&&J<f?[new yn(V.key,ue,"stop domain values must appear in ascending order")]:(f=J,"categorical"===l&&J in v?[new yn(V.key,ue,"stop domain values must be unique")]:(v[J]=!0,[])):[new yn(V.key,ue,`integer expected, found ${String(J)}`)]}}function Lr(a){const o=("property"===a.expressionContext?Iu:Da)(Xo(a.value),a.valueSpec);if("error"===o.result)return o.value.map(u=>new yn(`${a.key}${u.key}`,a.value,u.message));const l=o.value.expression||o.value._styleExpression.expression;if("property"===a.expressionContext&&"text-font"===a.propertyKey&&!l.outputDefined())return[new yn(a.key,a.value,`Invalid data expression for "${a.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===a.expressionContext&&"layout"===a.propertyType&&!Ea(l))return[new yn(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===a.expressionContext)return Wc(l,a);if(a.expressionContext&&0===a.expressionContext.indexOf("cluster")){if(!Pl(l,["zoom","feature-state"]))return[new yn(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===a.expressionContext&&!Ji(l))return[new yn(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Wc(a,o){const l=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(o.valueSpec&&o.valueSpec.expression)for(const f of o.valueSpec.expression.parameters)l.delete(f);if(0===l.size)return[];const u=[];return a instanceof ul&&l.has(a.name)?[new yn(o.key,o.value,`["${a.name}"] expression is not supported in a filter for a ${o.object.type} layer with id: ${o.object.id}`)]:(a.eachChild(f=>{u.push(...Wc(f,o))}),u)}function jh(a){const o=a.key,l=a.value,u=a.valueSpec,f=[];return Array.isArray(u.values)?-1===u.values.indexOf(To(l))&&f.push(new yn(o,l,`expected one of [${u.values.join(", ")}], ${JSON.stringify(l)} found`)):-1===Object.keys(u.values).indexOf(To(l))&&f.push(new yn(o,l,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(l)} found`)),f}function Ld(a){if(!0===a||!1===a)return!0;if(!Array.isArray(a)||0===a.length)return!1;switch(a[0]){case"has":return a.length>=2&&"$id"!==a[1]&&"$type"!==a[1];case"in":return a.length>=3&&("string"!=typeof a[1]||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==a.length||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const o of a.slice(1))if(!Ld(o)&&"boolean"!=typeof o)return!1;return!0;default:return!0}}function Uh(a,o="fill"){if(null==a)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Ld(a)||(a=Au(a));const l=a;let u=!0;try{u=function(D){if(!Mu(D))return D;let k=Xo(D);return lo(k),k=d_(k),k}(l)}catch(D){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(l,null,2)}\n        `)}const f=_t[`filter_${o}`],b=Da(u,f);let v=null;if("error"===b.result)throw new Error(b.value.map(D=>`${D.key}: ${D.message}`).join(", "));v=(D,k,O)=>b.value.evaluate(D,k,{},O);let S=null,E=null;if(u!==l){const D=Da(l,f);if("error"===D.result)throw new Error(D.value.map(k=>`${k.key}: ${k.message}`).join(", "));S=(k,O,F,V,U)=>D.value.evaluate(k,O,{},F,void 0,void 0,V,U),E=!Ji(D.value.expression)}return{filter:v,dynamicFilter:S||void 0,needGeometry:Ks(u),needFeature:!!E}}function d_(a){if(!Array.isArray(a))return a;const o=function(l){if(qm.has(l[0]))for(let u=1;u<l.length;u++)if(Mu(l[u]))return!0;return l}(a);return!0===o?o:o.map(l=>d_(l))}function lo(a){let o=!1;const l=[];if("case"===a[0]){for(let u=1;u<a.length-1;u+=2)o=o||Mu(a[u]),l.push(a[u+1]);l.push(a[a.length-1])}else if("match"===a[0]){o=o||Mu(a[1]);for(let u=2;u<a.length-1;u+=2)l.push(a[u+1]);l.push(a[a.length-1])}else if("step"===a[0]){o=o||Mu(a[1]);for(let u=1;u<a.length-1;u+=2)l.push(a[u+1])}o&&(a.length=0,a.push("any",...l));for(let u=1;u<a.length;u++)lo(a[u])}function Mu(a){if(!Array.isArray(a))return!1;if("pitch"===(o=a[0])||"distance-from-center"===o)return!0;var o;for(let l=1;l<a.length;l++)if(Mu(a[l]))return!0;return!1}const qm=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Hh(a,o){return a<o?-1:a>o?1:0}function Ks(a){if(!Array.isArray(a))return!1;if("within"===a[0])return!0;for(let o=1;o<a.length;o++)if(Ks(a[o]))return!0;return!1}function Au(a){if(!a)return!0;const o=a[0];return a.length<=1?"any"!==o:"=="===o?Fd(a[1],a[2],"=="):"!="===o?$h(Fd(a[1],a[2],"==")):"<"===o||">"===o||"<="===o||">="===o?Fd(a[1],a[2],o):"any"===o?(l=a.slice(1),["any"].concat(l.map(Au))):"all"===o?["all"].concat(a.slice(1).map(Au)):"none"===o?["all"].concat(a.slice(1).map(Au).map($h)):"in"===o?lc(a[1],a.slice(2)):"!in"===o?$h(lc(a[1],a.slice(2))):"has"===o?Ls(a[1]):"!has"===o?$h(Ls(a[1])):"within"!==o||a;var l}function Fd(a,o,l){switch(a){case"$type":return[`filter-type-${l}`,o];case"$id":return[`filter-id-${l}`,o];default:return[`filter-${l}`,a,o]}}function lc(a,o){if(0===o.length)return!1;switch(a){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(l=>typeof l!=typeof o[0])?["filter-in-large",a,["literal",o.sort(Hh)]]:["filter-in-small",a,["literal",o]]}}function Ls(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function $h(a){return["!",a]}function cc(a){return Ld(Xo(a.value))?Lr(kl({},a,{expressionContext:"filter",valueSpec:a.styleSpec[`filter_${a.layerType||"fill"}`]})):Nd(a)}function Nd(a){const o=a.value,l=a.key;if("array"!==rr(o))return[new yn(l,o,`array expected, ${rr(o)} found`)];const u=a.styleSpec;let f,b=[];if(o.length<1)return[new yn(l,o,"filter array must have at least 1 element")];switch(b=b.concat(jh({key:`${l}[0]`,value:o[0],valueSpec:u.filter_operator,style:a.style,styleSpec:a.styleSpec})),To(o[0])){case"<":case"<=":case">":case">=":o.length>=2&&"$type"===To(o[1])&&b.push(new yn(l,o,`"$type" cannot be use with operator "${o[0]}"`));case"==":case"!=":3!==o.length&&b.push(new yn(l,o,`filter array for operator "${o[0]}" must have 3 elements`));case"in":case"!in":o.length>=2&&(f=rr(o[1]),"string"!==f&&b.push(new yn(`${l}[1]`,o[1],`string expected, ${f} found`)));for(let v=2;v<o.length;v++)f=rr(o[v]),"$type"===To(o[1])?b=b.concat(jh({key:`${l}[${v}]`,value:o[v],valueSpec:u.geometry_type,style:a.style,styleSpec:a.styleSpec})):"string"!==f&&"number"!==f&&"boolean"!==f&&b.push(new yn(`${l}[${v}]`,o[v],`string, number, or boolean expected, ${f} found`));break;case"any":case"all":case"none":for(let v=1;v<o.length;v++)b=b.concat(Nd({key:`${l}[${v}]`,value:o[v],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":f=rr(o[1]),2!==o.length?b.push(new yn(l,o,`filter array for "${o[0]}" operator must have 2 elements`)):"string"!==f&&b.push(new yn(`${l}[1]`,o[1],`string expected, ${f} found`));break;case"within":f=rr(o[1]),2!==o.length?b.push(new yn(l,o,`filter array for "${o[0]}" operator must have 2 elements`)):"object"!==f&&b.push(new yn(`${l}[1]`,o[1],`object expected, ${f} found`))}return b}function fl(a,o){const l=a.key,u=a.style,f=a.styleSpec,b=a.value,v=a.objectKey,S=f[`${o}_${a.layerType}`];if(!S)return[];const E=v.match(/^(.*)-transition$/);if("paint"===o&&E&&S[E[1]]&&S[E[1]].transition)return Ot({key:l,value:b,valueSpec:f.transition,style:u,styleSpec:f});const D=a.valueSpec||S[v];if(!D)return[new yn(l,b,`unknown property "${v}"`)];let k;if("string"===rr(b)&&Ad(D)&&!D.tokens&&(k=/^{([^}]+)}$/.exec(b))){const F=`\`{ "type": "identity", "property": ${k?JSON.stringify(k[1]):'"_"'} }\``;return[new yn(l,b,`"${v}" does not support interpolation syntax\nUse an identity property function instead: ${F}.`)]}const O=[];return"symbol"===a.layerType&&("text-field"===v&&u&&!u.glyphs&&O.push(new yn(l,b,'use of "text-field" requires a style "glyphs" property')),"text-font"===v&&Bh(Xo(b))&&"identity"===To(b.type)&&O.push(new yn(l,b,'"text-font" does not support identity functions'))),O.concat(Ot({key:a.key,value:b,valueSpec:D,style:u,styleSpec:f,expressionContext:"property",propertyType:o,propertyKey:v}))}function af(a){return fl(a,"paint")}function Bd(a){return fl(a,"layout")}function Ii(a){let o=[];const l=a.value,u=a.key,f=a.style,b=a.styleSpec;l.type||l.ref||o.push(new yn(u,l,'either "type" or "ref" is required'));let v=To(l.type);const S=To(l.ref);if(l.id){const E=To(l.id);for(let D=0;D<a.arrayIndex;D++){const k=f.layers[D];To(k.id)===E&&o.push(new yn(u,l.id,`duplicate layer id "${l.id}", previously used at line ${k.id.__line__}`))}}if("ref"in l){let E;["type","source","source-layer","filter","layout"].forEach(D=>{D in l&&o.push(new yn(u,l[D],`"${D}" is prohibited for ref layers`))}),f.layers.forEach(D=>{To(D.id)===S&&(E=D)}),E?E.ref?o.push(new yn(u,l.ref,"ref cannot reference another ref layer")):v=To(E.type):"string"==typeof S&&o.push(new yn(u,l.ref,`ref layer "${S}" not found`))}else if("background"!==v&&"sky"!==v)if(l.source){const E=f.sources&&f.sources[l.source],D=E&&To(E.type);E?"vector"===D&&"raster"===v?o.push(new yn(u,l.source,`layer "${l.id}" requires a raster source`)):"raster"===D&&"raster"!==v?o.push(new yn(u,l.source,`layer "${l.id}" requires a vector source`)):"vector"!==D||l["source-layer"]?"raster-dem"===D&&"hillshade"!==v?o.push(new yn(u,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==v||!l.paint||!l.paint["line-gradient"]&&!l.paint["line-trim-offset"]||"geojson"===D&&E.lineMetrics||o.push(new yn(u,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):o.push(new yn(u,l,`layer "${l.id}" must specify a "source-layer"`)):o.push(new yn(u,l.source,`source "${l.source}" not found`))}else o.push(new yn(u,l,'missing required property "source"'));return o=o.concat(Ia({key:u,value:l,valueSpec:b.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Ot({key:`${u}.type`,value:l.type,valueSpec:b.layer.type,style:a.style,styleSpec:a.styleSpec,object:l,objectKey:"type"}),filter:E=>cc(kl({layerType:v},E)),layout:E=>Ia({layer:l,key:E.key,value:E.value,valueSpec:{},style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":D=>Bd(kl({layerType:v},D))}}),paint:E=>Ia({layer:l,key:E.key,value:E.value,valueSpec:{},style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":D=>af(kl({layerType:v},D))}})}})),o}function Fl(a){const o=a.value,l=a.key,u=rr(o);return"string"!==u?[new yn(l,o,`string expected, ${u} found`)]:[]}const h_={promoteId:function({key:a,value:o}){if("string"===rr(o))return Fl({key:a,value:o});{const l=[];for(const u in o)l.push(...Fl({key:`${a}.${u}`,value:o[u]}));return l}}};function Gm(a){const o=a.value,l=a.key,u=a.styleSpec,f=a.style;if(!o.type)return[new yn(l,o,'"type" is required')];const b=To(o.type);let v;switch(b){case"vector":case"raster":case"raster-dem":return v=Ia({key:l,value:o,valueSpec:u[`source_${b.replace("-","_")}`],style:a.style,styleSpec:u,objectElementValidators:h_}),v;case"geojson":if(v=Ia({key:l,value:o,valueSpec:u.source_geojson,style:f,styleSpec:u,objectElementValidators:h_}),o.cluster)for(const S in o.clusterProperties){const[E,D]=o.clusterProperties[S],k="string"==typeof E?[E,["accumulated"],["get",S]]:E;v.push(...Lr({key:`${l}.${S}.map`,value:D,expressionContext:"cluster-map"})),v.push(...Lr({key:`${l}.${S}.reduce`,value:k,expressionContext:"cluster-reduce"}))}return v;case"video":return Ia({key:l,value:o,valueSpec:u.source_video,style:f,styleSpec:u});case"image":return Ia({key:l,value:o,valueSpec:u.source_image,style:f,styleSpec:u});case"canvas":return[new yn(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return jh({key:`${l}.type`,value:o.type,valueSpec:{values:p_(u)},style:f,styleSpec:u})}}function p_(a){return a.source.reduce((o,l)=>{const u=a[l];return"enum"===u.type.type&&(o=o.concat(Object.keys(u.type.values))),o},[])}function Wm(a){const o=a.value,l=a.styleSpec,u=l.light,f=a.style;let b=[];const v=rr(o);if(void 0===o)return b;if("object"!==v)return b=b.concat([new yn("light",o,`object expected, ${v} found`)]),b;for(const S in o){const E=S.match(/^(.*)-transition$/);b=b.concat(E&&u[E[1]]&&u[E[1]].transition?Ot({key:S,value:o[S],valueSpec:l.transition,style:f,styleSpec:l}):u[S]?Ot({key:S,value:o[S],valueSpec:u[S],style:f,styleSpec:l}):[new yn(S,o[S],`unknown property "${S}"`)])}return b}function qh(a){const o=a.value,l=a.key,u=a.style,f=a.styleSpec,b=f.terrain;let v=[];const S=rr(o);if(void 0===o)return v;if("object"!==S)return v=v.concat([new yn("terrain",o,`object expected, ${S} found`)]),v;for(const E in o){const D=E.match(/^(.*)-transition$/);v=v.concat(D&&b[D[1]]&&b[D[1]].transition?Ot({key:E,value:o[E],valueSpec:f.transition,style:u,styleSpec:f}):b[E]?Ot({key:E,value:o[E],valueSpec:b[E],style:u,styleSpec:f}):[new yn(E,o[E],`unknown property "${E}"`)])}if(o.source){const E=u.sources&&u.sources[o.source],D=E&&To(E.type);E?"raster-dem"!==D&&v.push(new yn(l,o.source,`terrain cannot be used with a source of type ${String(D)}, it only be used with a "raster-dem" source type`)):v.push(new yn(l,o.source,`source "${o.source}" not found`))}else v.push(new yn(l,o,'terrain is missing required property "source"'));return v}function Xm(a){const o=a.value,l=a.style,u=a.styleSpec,f=u.fog;let b=[];const v=rr(o);if(void 0===o)return b;if("object"!==v)return b=b.concat([new yn("fog",o,`object expected, ${v} found`)]),b;for(const S in o){const E=S.match(/^(.*)-transition$/);b=b.concat(E&&f[E[1]]&&f[E[1]].transition?Ot({key:S,value:o[S],valueSpec:u.transition,style:l,styleSpec:u}):f[S]?Ot({key:S,value:o[S],valueSpec:f[S],style:l,styleSpec:u}):[new yn(S,o[S],`unknown property "${S}"`)])}return b}const Zm={"*":()=>[],array:$m,boolean:function(a){const o=a.value,l=a.key,u=rr(o);return"boolean"!==u?[new yn(l,o,`boolean expected, ${u} found`)]:[]},number:Gc,color:function(a){const o=a.key,l=a.value,u=rr(l);return"string"!==u?[new yn(o,l,`color expected, ${u} found`)]:null===Wp(l)?[new yn(o,l,`color expected, "${l}" found`)]:[]},enum:jh,filter:cc,function:Od,layer:Ii,object:Ia,source:Gm,light:Wm,terrain:qh,fog:Xm,string:Fl,formatted:function(a){return 0===Fl(a).length?[]:Lr(a)},resolvedImage:function(a){return 0===Fl(a).length?[]:Lr(a)},projection:function(a){const o=a.value,l=a.styleSpec,u=l.projection,f=a.style;let b=[];const v=rr(o);if("object"===v)for(const S in o)b=b.concat(Ot({key:S,value:o[S],valueSpec:u[S],style:f,styleSpec:l}));else"string"!==v&&(b=b.concat([new yn("projection",o,`object or string expected, ${v} found`)]));return b}};function Ot(a){const o=a.value,l=a.valueSpec,u=a.styleSpec;return l.expression&&Bh(To(o))?Od(a):l.expression&&Pd(Xo(o))?Lr(a):l.type&&Zm[l.type]?Zm[l.type](a):Ia(kl({},a,{valueSpec:l.type?u[l.type]:l}))}function cr(a){const o=a.value,l=a.key,u=Fl(a);return u.length||(-1===o.indexOf("{fontstack}")&&u.push(new yn(l,o,'"glyphs" url must include a "{fontstack}" token')),-1===o.indexOf("{range}")&&u.push(new yn(l,o,'"glyphs" url must include a "{range}" token'))),u}function Vi(a,o=_t){return da(Ot({key:"",value:a,valueSpec:o.$root,styleSpec:o,style:a,objectElementValidators:{glyphs:cr,"*":()=>[]}}))}const Gi=a=>da(af(a)),zo=a=>da(Bd(a));function da(a){return a.slice().sort((o,l)=>o.line&&l.line?o.line-l.line:0)}function ku(a,o){let l=!1;if(o&&o.length)for(const u of o)a.fire(new ns(new Error(u.message))),l=!0;return l}var ml=Ma;function Ma(a,o,l){var u=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var f=new Int32Array(this.arrayBuffer);a=f[0],this.d=(o=f[1])+2*(l=f[2]);for(var b=0;b<this.d*this.d;b++){var v=f[3+b],S=f[3+b+1];u.push(v===S?null:f.subarray(v,S))}var E=f[3+u.length+1];this.keys=f.subarray(f[3+u.length],E),this.bboxes=f.subarray(E),this.insert=this._insertReadonly}else{this.d=o+2*l;for(var D=0;D<this.d*this.d;D++)u.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=a,this.padding=l,this.scale=o/a,this.uid=0;var k=l/o*a;this.min=-k,this.max=a+k}Ma.prototype.insert=function(a,o,l,u,f){this._forEachCell(o,l,u,f,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(o),this.bboxes.push(l),this.bboxes.push(u),this.bboxes.push(f)},Ma.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Ma.prototype._insertCell=function(a,o,l,u,f,b){this.cells[f].push(b)},Ma.prototype.query=function(a,o,l,u,f){var b=this.min,v=this.max;if(a<=b&&o<=b&&v<=l&&v<=u&&!f)return Array.prototype.slice.call(this.keys);var S=[];return this._forEachCell(a,o,l,u,this._queryCell,S,{},f),S},Ma.prototype._queryCell=function(a,o,l,u,f,b,v,S){var E=this.cells[f];if(null!==E)for(var D=this.keys,k=this.bboxes,O=0;O<E.length;O++){var F=E[O];if(void 0===v[F]){var V=4*F;(S?S(k[V+0],k[V+1],k[V+2],k[V+3]):a<=k[V+2]&&o<=k[V+3]&&l>=k[V+0]&&u>=k[V+1])?(v[F]=!0,b.push(D[F])):v[F]=!1}}},Ma.prototype._forEachCell=function(a,o,l,u,f,b,v,S){for(var E=this._convertToCellCoord(a),D=this._convertToCellCoord(o),k=this._convertToCellCoord(l),O=this._convertToCellCoord(u),F=E;F<=k;F++)for(var V=D;V<=O;V++){var U=this.d*V+F;if((!S||S(this._convertFromCellCoord(F),this._convertFromCellCoord(V),this._convertFromCellCoord(F+1),this._convertFromCellCoord(V+1)))&&f.call(this,a,o,l,u,U,b,v,S))return}},Ma.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},Ma.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},Ma.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,o=3+this.cells.length+1+1,l=0,u=0;u<this.cells.length;u++)l+=this.cells[u].length;var f=new Int32Array(o+l+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;for(var b=o,v=0;v<a.length;v++){var S=a[v];f[3+v]=b,f.set(S,b),b+=S.length}return f[3+a.length]=b,f.set(this.keys,b),f[3+a.length+1]=b+=this.keys.length,f.set(this.bboxes,b),b+=this.bboxes.length,f.buffer};var Ru=He(ml);const Gh={};function Mn(a,o,l={}){Object.defineProperty(a,"_classRegistryKey",{value:o,writeable:!1}),Gh[o]={klass:a,omit:l.omit||[]}}Mn(Object,"Object"),Ru.serialize=function(a,o){const l=a.toArrayBuffer();return o&&o.push(l),{buffer:l}},Ru.deserialize=function(a){return new Ru(a.buffer)},Object.defineProperty(Ru,"name",{value:"Grid"}),Mn(Ru,"Grid"),Mn(Eo,"Color"),Mn(Error,"Error"),Mn(qs,"AJAXError"),Mn(Fa,"ResolvedImage"),Mn(zh,"StylePropertyFunction"),Mn(rf,"StyleExpression",{omit:["_evaluator"]}),Mn(_r,"ZoomDependentExpression"),Mn(sf,"ZoomConstantExpression"),Mn(ul,"CompoundExpression",{omit:["_evaluate"]});for(const a in Nh)Gh[Nh[a]._classRegistryKey]||Mn(Nh[a],`Expression${a}`);function Wh(a){return a&&"undefined"!=typeof ArrayBuffer&&(a instanceof ArrayBuffer||a.constructor&&"ArrayBuffer"===a.constructor.name)}function rs(a){return he.ImageBitmap&&a instanceof he.ImageBitmap}function Qs(a,o){if(null==a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(Wh(a)||rs(a))return o&&o.push(a),a;if(ArrayBuffer.isView(a)){const l=a;return o&&o.push(l.buffer),l}if(a instanceof he.ImageData)return o&&o.push(a.data.buffer),a;if(Array.isArray(a)){const l=[];for(const u of a)l.push(Qs(u,o));return l}if("object"==typeof a){const l=a.constructor,u=l._classRegistryKey;if(!u)throw new Error(`can't serialize object of unregistered class ${u}`);const f=l.serialize?l.serialize(a,o):{};if(!l.serialize){for(const b in a)a.hasOwnProperty(b)&&(Gh[u].omit.indexOf(b)>=0||(f[b]=Qs(a[b],o)));a instanceof Error&&(f.message=a.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==u&&(f.$name=u),f}throw new Error("can't serialize object of type "+typeof a)}function uc(a){if(null==a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||Wh(a)||rs(a)||ArrayBuffer.isView(a)||a instanceof he.ImageData)return a;if(Array.isArray(a))return a.map(uc);if("object"==typeof a){const o=a.$name||"Object",{klass:l}=Gh[o];if(!l)throw new Error(`can't deserialize unregistered class ${o}`);if(l.deserialize)return l.deserialize(a);const u=Object.create(l.prototype);for(const f of Object.keys(a))"$name"!==f&&(u[f]=uc(a[f]));return u}throw new Error("can't deserialize object of type "+typeof a)}const sn_Latin_1_Supplement=a=>a>=128&&a<=255,sn_Arabic=a=>a>=1536&&a<=1791,sn_Arabic_Supplement=a=>a>=1872&&a<=1919,sn_Arabic_Extended_A=a=>a>=2208&&a<=2303,sn_Hangul_Jamo=a=>a>=4352&&a<=4607,sn_Unified_Canadian_Aboriginal_Syllabics=a=>a>=5120&&a<=5759,sn_Khmer=a=>a>=6016&&a<=6143,sn_Unified_Canadian_Aboriginal_Syllabics_Extended=a=>a>=6320&&a<=6399,sn_General_Punctuation=a=>a>=8192&&a<=8303,sn_Letterlike_Symbols=a=>a>=8448&&a<=8527,sn_Number_Forms=a=>a>=8528&&a<=8591,sn_Miscellaneous_Technical=a=>a>=8960&&a<=9215,sn_Control_Pictures=a=>a>=9216&&a<=9279,sn_Optical_Character_Recognition=a=>a>=9280&&a<=9311,sn_Enclosed_Alphanumerics=a=>a>=9312&&a<=9471,sn_Geometric_Shapes=a=>a>=9632&&a<=9727,sn_Miscellaneous_Symbols=a=>a>=9728&&a<=9983,sn_Miscellaneous_Symbols_and_Arrows=a=>a>=11008&&a<=11263,sn_CJK_Radicals_Supplement=a=>a>=11904&&a<=12031,sn_Kangxi_Radicals=a=>a>=12032&&a<=12255,sn_Ideographic_Description_Characters=a=>a>=12272&&a<=12287,sn_CJK_Symbols_and_Punctuation=a=>a>=12288&&a<=12351,sn_Hiragana=a=>a>=12352&&a<=12447,sn_Katakana=a=>a>=12448&&a<=12543,sn_Bopomofo=a=>a>=12544&&a<=12591,sn_Hangul_Compatibility_Jamo=a=>a>=12592&&a<=12687,sn_Kanbun=a=>a>=12688&&a<=12703,sn_Bopomofo_Extended=a=>a>=12704&&a<=12735,sn_CJK_Strokes=a=>a>=12736&&a<=12783,sn_Katakana_Phonetic_Extensions=a=>a>=12784&&a<=12799,sn_Enclosed_CJK_Letters_and_Months=a=>a>=12800&&a<=13055,sn_CJK_Compatibility=a=>a>=13056&&a<=13311,sn_CJK_Unified_Ideographs_Extension_A=a=>a>=13312&&a<=19903,sn_Yijing_Hexagram_Symbols=a=>a>=19904&&a<=19967,sn_CJK_Unified_Ideographs=a=>a>=19968&&a<=40959,sn_Yi_Syllables=a=>a>=40960&&a<=42127,sn_Yi_Radicals=a=>a>=42128&&a<=42191,sn_Hangul_Jamo_Extended_A=a=>a>=43360&&a<=43391,sn_Hangul_Syllables=a=>a>=44032&&a<=55215,sn_Hangul_Jamo_Extended_B=a=>a>=55216&&a<=55295,sn_Private_Use_Area=a=>a>=57344&&a<=63743,sn_CJK_Compatibility_Ideographs=a=>a>=63744&&a<=64255,sn_Arabic_Presentation_Forms_A=a=>a>=64336&&a<=65023,sn_Vertical_Forms=a=>a>=65040&&a<=65055,sn_CJK_Compatibility_Forms=a=>a>=65072&&a<=65103,sn_Small_Form_Variants=a=>a>=65104&&a<=65135,sn_Arabic_Presentation_Forms_B=a=>a>=65136&&a<=65279,sn_Halfwidth_and_Fullwidth_Forms=a=>a>=65280&&a<=65519;function Ha(a){for(const o of a)if(cf(o.charCodeAt(0)))return!0;return!1}function f_(a){for(const o of a)if(!lf(o.charCodeAt(0)))return!1;return!0}function lf(a){return!(sn_Arabic(a)||sn_Arabic_Supplement(a)||sn_Arabic_Extended_A(a)||sn_Arabic_Presentation_Forms_A(a)||sn_Arabic_Presentation_Forms_B(a))}function cf(a){return!(746!==a&&747!==a&&(a<4352||!(sn_Bopomofo_Extended(a)||sn_Bopomofo(a)||sn_CJK_Compatibility_Forms(a)&&!(a>=65097&&a<=65103)||sn_CJK_Compatibility_Ideographs(a)||sn_CJK_Compatibility(a)||sn_CJK_Radicals_Supplement(a)||sn_CJK_Strokes(a)||!(!sn_CJK_Symbols_and_Punctuation(a)||a>=12296&&a<=12305||a>=12308&&a<=12319||12336===a)||sn_CJK_Unified_Ideographs_Extension_A(a)||sn_CJK_Unified_Ideographs(a)||sn_Enclosed_CJK_Letters_and_Months(a)||sn_Hangul_Compatibility_Jamo(a)||sn_Hangul_Jamo_Extended_A(a)||sn_Hangul_Jamo_Extended_B(a)||sn_Hangul_Jamo(a)||sn_Hangul_Syllables(a)||sn_Hiragana(a)||sn_Ideographic_Description_Characters(a)||sn_Kanbun(a)||sn_Kangxi_Radicals(a)||sn_Katakana_Phonetic_Extensions(a)||sn_Katakana(a)&&12540!==a||!(!sn_Halfwidth_and_Fullwidth_Forms(a)||65288===a||65289===a||65293===a||a>=65306&&a<=65310||65339===a||65341===a||65343===a||a>=65371&&a<=65503||65507===a||a>=65512&&a<=65519)||!(!sn_Small_Form_Variants(a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||sn_Unified_Canadian_Aboriginal_Syllabics(a)||sn_Unified_Canadian_Aboriginal_Syllabics_Extended(a)||sn_Vertical_Forms(a)||sn_Yijing_Hexagram_Symbols(a)||sn_Yi_Syllables(a)||sn_Yi_Radicals(a))))}function Ym(a){return!(cf(a)||(o=a,sn_Latin_1_Supplement(o)&&(167===o||169===o||174===o||177===o||188===o||189===o||190===o||215===o||247===o)||sn_General_Punctuation(o)&&(8214===o||8224===o||8225===o||8240===o||8241===o||8251===o||8252===o||8258===o||8263===o||8264===o||8265===o||8273===o)||sn_Letterlike_Symbols(o)||sn_Number_Forms(o)||sn_Miscellaneous_Technical(o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||9003===o||o>=9085&&o<=9114||o>=9150&&o<=9165||9167===o||o>=9169&&o<=9179||o>=9186&&o<=9215)||sn_Control_Pictures(o)&&9251!==o||sn_Optical_Character_Recognition(o)||sn_Enclosed_Alphanumerics(o)||sn_Geometric_Shapes(o)||sn_Miscellaneous_Symbols(o)&&!(o>=9754&&o<=9759)||sn_Miscellaneous_Symbols_and_Arrows(o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||sn_CJK_Symbols_and_Punctuation(o)||sn_Katakana(o)||sn_Private_Use_Area(o)||sn_CJK_Compatibility_Forms(o)||sn_Small_Form_Variants(o)||sn_Halfwidth_and_Fullwidth_Forms(o)||8734===o||8756===o||8757===o||o>=9984&&o<=10087||o>=10102&&o<=10131||65532===o||65533===o));var o}function Xh(a){return a>=1424&&a<=2303||sn_Arabic_Presentation_Forms_A(a)||sn_Arabic_Presentation_Forms_B(a)}function uf(a,o){return!(!o&&Xh(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||sn_Khmer(a))}function Km(a){for(const o of a)if(Xh(o.charCodeAt(0)))return!0;return!1}const zd="deferred",df="loading",Zh="loaded";let dc=null,g="unavailable",c=null;const h=function(a){a&&"string"==typeof a&&a.indexOf("NetworkError")>-1&&(g="error"),dc&&dc(a)};function _(){w.fire(new ll("pluginStateChange",{pluginStatus:g,pluginURL:c}))}const w=new Al,C=function(){return g},I=function(){if(g!==zd||!c)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");g=df,_(),c&&j({url:c},a=>{a?h(a):(g=Zh,_())})},A={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>g===Zh||null!=A.applyArabicShaping,isLoading:()=>g===df,setState(a){g=a.pluginStatus,c=a.pluginURL},isParsed:()=>null!=A.applyArabicShaping&&null!=A.processBidirectionalText&&null!=A.processStyledBidirectionalText,getPluginURL:()=>c};class P{constructor(o,l){this.zoom=o,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.transition=l.transition,this.pitch=l.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(o){return function(l,u){for(const f of l)if(!uf(f.charCodeAt(0),u))return!1;return!0}(o,A.isLoaded())}}class N{constructor(o,l){this.property=o,this.value=l,this.expression=function(u,f){if(Bh(u))return new zh(u,f);if(Pd(u)){const b=Iu(u,f);if("error"===b.result)throw new Error(b.value.map(v=>`${v.key}: ${v.message}`).join(", "));return b.value}{let b=u;return"string"==typeof u&&"color"===f.type&&(b=Eo.parse(u)),{kind:"constant",evaluate:()=>b}}}(void 0===l?o.specification.default:l,o.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(o,l,u){return this.property.possiblyEvaluate(this,o,l,u)}}class B{constructor(o){this.property=o,this.value=new N(o,void 0)}transitioned(o,l){return new Q(this.property,this.value,l,xn({},o.transition,this.transition),o.now)}untransitioned(){return new Q(this.property,this.value,null,{},0)}}class ${constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitionablePropertyValues)}getValue(o){return vi(this._values[o].value.value)}setValue(o,l){this._values.hasOwnProperty(o)||(this._values[o]=new B(this._values[o].property)),this._values[o].value=new N(this._values[o].property,null===l?void 0:vi(l))}getTransition(o){return vi(this._values[o].transition)}setTransition(o,l){this._values.hasOwnProperty(o)||(this._values[o]=new B(this._values[o].property)),this._values[o].transition=vi(l)||void 0}serialize(){const o={};for(const l of Object.keys(this._values)){const u=this.getValue(l);void 0!==u&&(o[l]=u);const f=this.getTransition(l);void 0!==f&&(o[`${l}-transition`]=f)}return o}transitioned(o,l){const u=new re(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].transitioned(o,l._values[f]);return u}untransitioned(){const o=new re(this._properties);for(const l of Object.keys(this._values))o._values[l]=this._values[l].untransitioned();return o}}class Q{constructor(o,l,u,f,b){const v=f.delay||0,S=f.duration||0;b=b||0,this.property=o,this.value=l,this.begin=b+v,this.end=this.begin+S,o.specification.transition&&(f.delay||f.duration)&&(this.prior=u)}possiblyEvaluate(o,l,u){const f=o.now||0,b=this.value.possiblyEvaluate(o,l,u),v=this.prior;if(v){if(f>this.end)return this.prior=null,b;if(this.value.isDataDriven())return this.prior=null,b;if(f<this.begin)return v.possiblyEvaluate(o,l,u);{const S=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(v.possiblyEvaluate(o,l,u),b,$e(S))}}return b}}class re{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitioningPropertyValues)}possiblyEvaluate(o,l,u){const f=new ce(this._properties);for(const b of Object.keys(this._values))f._values[b]=this._values[b].possiblyEvaluate(o,l,u);return f}hasTransition(){for(const o of Object.keys(this._values))if(this._values[o].prior)return!0;return!1}}class ae{constructor(o){this._properties=o,this._values=Object.create(o.defaultPropertyValues)}getValue(o){return vi(this._values[o].value)}setValue(o,l){this._values[o]=new N(this._values[o].property,null===l?void 0:vi(l))}serialize(){const o={};for(const l of Object.keys(this._values)){const u=this.getValue(l);void 0!==u&&(o[l]=u)}return o}possiblyEvaluate(o,l,u){const f=new ce(this._properties);for(const b of Object.keys(this._values))f._values[b]=this._values[b].possiblyEvaluate(o,l,u);return f}}class se{constructor(o,l,u){this.property=o,this.value=l,this.parameters=u}isConstant(){return"constant"===this.value.kind}constantOr(o){return"constant"===this.value.kind?this.value.value:o}evaluate(o,l,u,f){return this.property.evaluate(this.value,this.parameters,o,l,u,f)}}class ce{constructor(o){this._properties=o,this._values=Object.create(o.defaultPossiblyEvaluatedValues)}get(o){return this._values[o]}}class q{constructor(o){this.specification=o}possiblyEvaluate(o,l){return o.expression.evaluate(l)}interpolate(o,l,u){const f=Ln[this.specification.type];return f?f(o,l,u):o}}class ie{constructor(o,l){this.specification=o,this.overrides=l}possiblyEvaluate(o,l,u,f){return new se(this,"constant"===o.expression.kind||"camera"===o.expression.kind?{kind:"constant",value:o.expression.evaluate(l,null,{},u,f)}:o.expression,l)}interpolate(o,l,u){if("constant"!==o.value.kind||"constant"!==l.value.kind)return o;if(void 0===o.value.value||void 0===l.value.value)return new se(this,{kind:"constant",value:void 0},o.parameters);const f=Ln[this.specification.type];return f?new se(this,{kind:"constant",value:f(o.value.value,l.value.value,u)},o.parameters):o}evaluate(o,l,u,f,b,v){return"constant"===o.kind?o.value:o.evaluate(l,u,f,b,v)}}class me{constructor(o){this.specification=o}possiblyEvaluate(o,l,u,f){return!!o.expression.evaluate(l,null,{},u,f)}interpolate(){return!1}}class be{constructor(o){this.properties=o,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const l=new P(0,{});for(const u in o){const f=o[u];f.specification.overridable&&this.overridableProperties.push(u);const b=this.defaultPropertyValues[u]=new N(f,void 0),v=this.defaultTransitionablePropertyValues[u]=new B(f);this.defaultTransitioningPropertyValues[u]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=b.possiblyEvaluate(l)}}}function Le(a,o){return 256*(a=lt(Math.floor(a),0,255))+lt(Math.floor(o),0,255)}Mn(ie,"DataDrivenProperty"),Mn(q,"DataConstantProperty"),Mn(me,"ColorRampProperty");const Pe={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Oe{constructor(o,l){this._structArray=o,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ke{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(o,l){return o._trim(),l&&(o.isTransferred=!0,l.push(o.arrayBuffer)),{length:o.length,arrayBuffer:o.arrayBuffer}}static deserialize(o){const l=Object.create(this.prototype);return l.arrayBuffer=o.arrayBuffer,l.length=o.length,l.capacity=o.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(o){this.reserve(o),this.length=o}reserve(o){if(o>this.capacity){this.capacity=Math.max(o,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function We(a,o=1){let l=0,u=0;return{members:a.map(f=>{const b=Pe[f.type].BYTES_PER_ELEMENT,v=l=at(l,Math.max(o,b)),S=f.components||1;return u=Math.max(u,b),l+=b*S,{name:f.name,type:f.type,components:S,offset:v}}),size:at(l,Math.max(u,o)),alignment:o}}function at(a,o){return Math.ceil(a/o)*o}class zt extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l){const u=this.length;return this.resize(u+1),this.emplace(u,o,l)}emplace(o,l,u){const f=2*o;return this.int16[f+0]=l,this.int16[f+1]=u,o}}zt.prototype.bytesPerElement=4,Mn(zt,"StructArrayLayout2i4");class it extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,u){const f=this.length;return this.resize(f+1),this.emplace(f,o,l,u)}emplace(o,l,u,f){const b=3*o;return this.int16[b+0]=l,this.int16[b+1]=u,this.int16[b+2]=f,o}}it.prototype.bytesPerElement=6,Mn(it,"StructArrayLayout3i6");class Tt extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,u,f){const b=this.length;return this.resize(b+1),this.emplace(b,o,l,u,f)}emplace(o,l,u,f,b){const v=4*o;return this.int16[v+0]=l,this.int16[v+1]=u,this.int16[v+2]=f,this.int16[v+3]=b,o}}Tt.prototype.bytesPerElement=8,Mn(Tt,"StructArrayLayout4i8");class ht extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b,v,S){const E=this.length;return this.resize(E+1),this.emplace(E,o,l,u,f,b,v,S)}emplace(o,l,u,f,b,v,S,E){const D=6*o,k=12*o,O=3*o;return this.int16[D+0]=l,this.int16[D+1]=u,this.uint8[k+4]=f,this.uint8[k+5]=b,this.uint8[k+6]=v,this.uint8[k+7]=S,this.float32[O+2]=E,o}}ht.prototype.bytesPerElement=12,Mn(ht,"StructArrayLayout2i4ub1f12");class Vt extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,u,f){const b=this.length;return this.resize(b+1),this.emplace(b,o,l,u,f)}emplace(o,l,u,f,b){const v=4*o;return this.float32[v+0]=l,this.float32[v+1]=u,this.float32[v+2]=f,this.float32[v+3]=b,o}}Vt.prototype.bytesPerElement=16,Mn(Vt,"StructArrayLayout4f16");class ot extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b){const v=this.length;return this.resize(v+1),this.emplace(v,o,l,u,f,b)}emplace(o,l,u,f,b,v){const S=6*o,E=3*o;return this.uint16[S+0]=l,this.uint16[S+1]=u,this.uint16[S+2]=f,this.uint16[S+3]=b,this.float32[E+2]=v,o}}ot.prototype.bytesPerElement=12,Mn(ot,"StructArrayLayout4ui1f12");class wt extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,u,f){const b=this.length;return this.resize(b+1),this.emplace(b,o,l,u,f)}emplace(o,l,u,f,b){const v=4*o;return this.uint16[v+0]=l,this.uint16[v+1]=u,this.uint16[v+2]=f,this.uint16[v+3]=b,o}}wt.prototype.bytesPerElement=8,Mn(wt,"StructArrayLayout4ui8");class Ut extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b,v){const S=this.length;return this.resize(S+1),this.emplace(S,o,l,u,f,b,v)}emplace(o,l,u,f,b,v,S){const E=6*o;return this.int16[E+0]=l,this.int16[E+1]=u,this.int16[E+2]=f,this.int16[E+3]=b,this.int16[E+4]=v,this.int16[E+5]=S,o}}Ut.prototype.bytesPerElement=12,Mn(Ut,"StructArrayLayout6i12");class At extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b,v,S,E,D,k,O,F){const V=this.length;return this.resize(V+1),this.emplace(V,o,l,u,f,b,v,S,E,D,k,O,F)}emplace(o,l,u,f,b,v,S,E,D,k,O,F,V){const U=12*o;return this.int16[U+0]=l,this.int16[U+1]=u,this.int16[U+2]=f,this.int16[U+3]=b,this.uint16[U+4]=v,this.uint16[U+5]=S,this.uint16[U+6]=E,this.uint16[U+7]=D,this.int16[U+8]=k,this.int16[U+9]=O,this.int16[U+10]=F,this.int16[U+11]=V,o}}At.prototype.bytesPerElement=24,Mn(At,"StructArrayLayout4i4ui4i24");class qt extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b,v){const S=this.length;return this.resize(S+1),this.emplace(S,o,l,u,f,b,v)}emplace(o,l,u,f,b,v,S){const E=10*o,D=5*o;return this.int16[E+0]=l,this.int16[E+1]=u,this.int16[E+2]=f,this.float32[D+2]=b,this.float32[D+3]=v,this.float32[D+4]=S,o}}qt.prototype.bytesPerElement=20,Mn(qt,"StructArrayLayout3i3f20");class Un extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.uint32[1*o+0]=l,o}}Un.prototype.bytesPerElement=4,Mn(Un,"StructArrayLayout1ul4");class ti extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b,v,S,E,D,k,O,F,V){const U=this.length;return this.resize(U+1),this.emplace(U,o,l,u,f,b,v,S,E,D,k,O,F,V)}emplace(o,l,u,f,b,v,S,E,D,k,O,F,V,U){const G=20*o,J=10*o;return this.int16[G+0]=l,this.int16[G+1]=u,this.int16[G+2]=f,this.int16[G+3]=b,this.int16[G+4]=v,this.float32[J+3]=S,this.float32[J+4]=E,this.float32[J+5]=D,this.float32[J+6]=k,this.int16[G+14]=O,this.uint32[J+8]=F,this.uint16[G+18]=V,this.uint16[G+19]=U,o}}ti.prototype.bytesPerElement=40,Mn(ti,"StructArrayLayout5i4f1i1ul2ui40");class An extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b,v,S){const E=this.length;return this.resize(E+1),this.emplace(E,o,l,u,f,b,v,S)}emplace(o,l,u,f,b,v,S,E){const D=8*o;return this.int16[D+0]=l,this.int16[D+1]=u,this.int16[D+2]=f,this.int16[D+4]=b,this.int16[D+5]=v,this.int16[D+6]=S,this.int16[D+7]=E,o}}An.prototype.bytesPerElement=16,Mn(An,"StructArrayLayout3i2i2i16");class Hn extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b){const v=this.length;return this.resize(v+1),this.emplace(v,o,l,u,f,b)}emplace(o,l,u,f,b,v){const S=4*o,E=8*o;return this.float32[S+0]=l,this.float32[S+1]=u,this.float32[S+2]=f,this.int16[E+6]=b,this.int16[E+7]=v,o}}Hn.prototype.bytesPerElement=16,Mn(Hn,"StructArrayLayout2f1f2i16");class Ai extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,u,f){const b=this.length;return this.resize(b+1),this.emplace(b,o,l,u,f)}emplace(o,l,u,f,b){const v=12*o,S=3*o;return this.uint8[v+0]=l,this.uint8[v+1]=u,this.float32[S+1]=f,this.float32[S+2]=b,o}}Ai.prototype.bytesPerElement=12,Mn(Ai,"StructArrayLayout2ub2f12");class wi extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,u){const f=this.length;return this.resize(f+1),this.emplace(f,o,l,u)}emplace(o,l,u,f){const b=3*o;return this.float32[b+0]=l,this.float32[b+1]=u,this.float32[b+2]=f,o}}wi.prototype.bytesPerElement=12,Mn(wi,"StructArrayLayout3f12");class Vn extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,u){const f=this.length;return this.resize(f+1),this.emplace(f,o,l,u)}emplace(o,l,u,f){const b=3*o;return this.uint16[b+0]=l,this.uint16[b+1]=u,this.uint16[b+2]=f,o}}Vn.prototype.bytesPerElement=6,Mn(Vn,"StructArrayLayout3ui6");class ur extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b,v,S,E,D,k,O,F,V,U,G,J,ue,we,de,ve,Ae){const ke=this.length;return this.resize(ke+1),this.emplace(ke,o,l,u,f,b,v,S,E,D,k,O,F,V,U,G,J,ue,we,de,ve,Ae)}emplace(o,l,u,f,b,v,S,E,D,k,O,F,V,U,G,J,ue,we,de,ve,Ae,ke){const ct=30*o,st=15*o,yt=60*o;return this.int16[ct+0]=l,this.int16[ct+1]=u,this.int16[ct+2]=f,this.float32[st+2]=b,this.float32[st+3]=v,this.uint16[ct+8]=S,this.uint16[ct+9]=E,this.uint32[st+5]=D,this.uint32[st+6]=k,this.uint32[st+7]=O,this.uint16[ct+16]=F,this.uint16[ct+17]=V,this.uint16[ct+18]=U,this.float32[st+10]=G,this.float32[st+11]=J,this.uint8[yt+48]=ue,this.uint8[yt+49]=we,this.uint8[yt+50]=de,this.uint32[st+13]=ve,this.int16[ct+28]=Ae,this.uint8[yt+58]=ke,o}}ur.prototype.bytesPerElement=60,Mn(ur,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class wr extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b,v,S,E,D,k,O,F,V,U,G,J,ue,we,de,ve,Ae,ke,ct,st,yt,Ht,dt,It,Et,Lt){const Zt=this.length;return this.resize(Zt+1),this.emplace(Zt,o,l,u,f,b,v,S,E,D,k,O,F,V,U,G,J,ue,we,de,ve,Ae,ke,ct,st,yt,Ht,dt,It,Et,Lt)}emplace(o,l,u,f,b,v,S,E,D,k,O,F,V,U,G,J,ue,we,de,ve,Ae,ke,ct,st,yt,Ht,dt,It,Et,Lt,Zt){const mt=38*o,an=19*o;return this.int16[mt+0]=l,this.int16[mt+1]=u,this.int16[mt+2]=f,this.float32[an+2]=b,this.float32[an+3]=v,this.int16[mt+8]=S,this.int16[mt+9]=E,this.int16[mt+10]=D,this.int16[mt+11]=k,this.int16[mt+12]=O,this.int16[mt+13]=F,this.uint16[mt+14]=V,this.uint16[mt+15]=U,this.uint16[mt+16]=G,this.uint16[mt+17]=J,this.uint16[mt+18]=ue,this.uint16[mt+19]=we,this.uint16[mt+20]=de,this.uint16[mt+21]=ve,this.uint16[mt+22]=Ae,this.uint16[mt+23]=ke,this.uint16[mt+24]=ct,this.uint16[mt+25]=st,this.uint16[mt+26]=yt,this.uint16[mt+27]=Ht,this.uint16[mt+28]=dt,this.uint32[an+15]=It,this.float32[an+16]=Et,this.float32[an+17]=Lt,this.float32[an+18]=Zt,o}}wr.prototype.bytesPerElement=76,Mn(wr,"StructArrayLayout3i2f6i15ui1ul3f76");class Dr extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.float32[1*o+0]=l,o}}Dr.prototype.bytesPerElement=4,Mn(Dr,"StructArrayLayout1f4");class ji extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b){const v=this.length;return this.resize(v+1),this.emplace(v,o,l,u,f,b)}emplace(o,l,u,f,b,v){const S=5*o;return this.float32[S+0]=l,this.float32[S+1]=u,this.float32[S+2]=f,this.float32[S+3]=b,this.float32[S+4]=v,o}}ji.prototype.bytesPerElement=20,Mn(ji,"StructArrayLayout5f20");class xs extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,u,f){const b=this.length;return this.resize(b+1),this.emplace(b,o,l,u,f)}emplace(o,l,u,f,b){const v=6*o;return this.uint32[3*o+0]=l,this.uint16[v+2]=u,this.uint16[v+3]=f,this.uint16[v+4]=b,o}}xs.prototype.bytesPerElement=12,Mn(xs,"StructArrayLayout1ul3ui12");class _o extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l){const u=this.length;return this.resize(u+1),this.emplace(u,o,l)}emplace(o,l,u){const f=2*o;return this.uint16[f+0]=l,this.uint16[f+1]=u,o}}_o.prototype.bytesPerElement=4,Mn(_o,"StructArrayLayout2ui4");class Js extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.uint16[1*o+0]=l,o}}Js.prototype.bytesPerElement=2,Mn(Js,"StructArrayLayout1ui2");class Aa extends Ke{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l){const u=this.length;return this.resize(u+1),this.emplace(u,o,l)}emplace(o,l,u){const f=2*o;return this.float32[f+0]=l,this.float32[f+1]=u,o}}Aa.prototype.bytesPerElement=8,Mn(Aa,"StructArrayLayout2f8");class Fr extends Oe{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Fr.prototype.size=40;class pr extends ti{get(o){return new Fr(this,o)}}Mn(pr,"CollisionBoxArray");class or extends Oe{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(o){this._structArray.uint8[this._pos1+49]=o}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(o){this._structArray.uint8[this._pos1+50]=o}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(o){this._structArray.uint32[this._pos4+13]=o}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(o){this._structArray.uint8[this._pos1+58]=o}}or.prototype.size=60;class yo extends ur{get(o){return new or(this,o)}}Mn(yo,"PlacedSymbolArray");class ws extends Oe{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(o){this._structArray.uint32[this._pos4+15]=o}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}ws.prototype.size=76;class Hr extends wr{get(o){return new ws(this,o)}}Mn(Hr,"SymbolInstanceArray");class Fs extends Dr{getoffsetX(o){return this.float32[1*o+0]}}Mn(Fs,"GlyphOffsetArray");class Yh extends zt{getx(o){return this.int16[2*o+0]}gety(o){return this.int16[2*o+1]}}Mn(Yh,"SymbolLineVertexArray");class gl extends Oe{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}gl.prototype.size=12;class Nl extends xs{get(o){return new gl(this,o)}}Mn(Nl,"FeatureIndexArray");class Bl extends _o{geta_centroid_pos0(o){return this.uint16[2*o+0]}geta_centroid_pos1(o){return this.uint16[2*o+1]}}Mn(Bl,"FillExtrusionCentroidArray");const zl=We([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),hc=We([{name:"a_dash",components:4,type:"Uint16"}]);var Vl={exports:{}},jv=function(a,o){var l,u,f,b,v,S,E,D;for(u=a.length-(l=3&a.length),f=o,v=3432918353,S=461845907,D=0;D<u;)E=255&a.charCodeAt(D)|(255&a.charCodeAt(++D))<<8|(255&a.charCodeAt(++D))<<16|(255&a.charCodeAt(++D))<<24,++D,f=27492+(65535&(b=5*(65535&(f=(f^=E=(65535&(E=(E=(65535&E)*v+(((E>>>16)*v&65535)<<16)&4294967295)<<15|E>>>17))*S+(((E>>>16)*S&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(b>>>16)&65535)<<16);switch(E=0,l){case 3:E^=(255&a.charCodeAt(D+2))<<16;case 2:E^=(255&a.charCodeAt(D+1))<<8;case 1:f^=E=(65535&(E=(E=(65535&(E^=255&a.charCodeAt(D)))*v+(((E>>>16)*v&65535)<<16)&4294967295)<<15|E>>>17))*S+(((E>>>16)*S&65535)<<16)&4294967295}return f^=a.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0},Uv=function(a,o){for(var l,u=a.length,f=o^u,b=0;u>=4;)l=1540483477*(65535&(l=255&a.charCodeAt(b)|(255&a.charCodeAt(++b))<<8|(255&a.charCodeAt(++b))<<16|(255&a.charCodeAt(++b))<<24))+((1540483477*(l>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),u-=4,++b;switch(u){case 3:f^=(255&a.charCodeAt(b+2))<<16;case 2:f^=(255&a.charCodeAt(b+1))<<8;case 1:f=1540483477*(65535&(f^=255&a.charCodeAt(b)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0};Vl.exports=jv,Vl.exports.murmur3=jv,Vl.exports.murmur2=Uv;var os=He(Vl.exports);class Xc{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(o,l,u,f){this.ids.push(jd(o)),this.positions.push(l,u,f)}getPositions(o){const l=jd(o);let u=0,f=this.ids.length-1;for(;u<f;){const v=u+f>>1;this.ids[v]>=l?f=v:u=v+1}const b=[];for(;this.ids[u]===l;)b.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return b}static serialize(o,l){const u=new Float64Array(o.ids),f=new Uint32Array(o.positions);return Pu(u,f,0,u.length-1),l&&l.push(u.buffer,f.buffer),{ids:u,positions:f}}static deserialize(o){const l=new Xc;return l.ids=o.ids,l.positions=o.positions,l.indexed=!0,l}}function jd(a){const o=+a;return!isNaN(o)&&Number.MIN_SAFE_INTEGER<=o&&o<=Number.MAX_SAFE_INTEGER?o:os(String(a))}function Pu(a,o,l,u){for(;l<u;){const f=a[l+u>>1];let b=l-1,v=u+1;for(;;){do{b++}while(a[b]<f);do{v--}while(a[v]>f);if(b>=v)break;hf(a,b,v),hf(o,3*b,3*v),hf(o,3*b+1,3*v+1),hf(o,3*b+2,3*v+2)}v-l<u-v?(Pu(a,o,l,v),l=v+1):(Pu(a,o,v+1,u),u=v)}}function hf(a,o,l){const u=a[o];a[o]=a[l],a[l]=u}Mn(Xc,"FeaturePositionMap");class jl{constructor(o){this.gl=o.gl,this.initialized=!1}fetchUniformLocation(o,l){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(o,l),this.initialized=!0),!!this.location}}class Zc extends jl{constructor(o){super(o),this.current=0}set(o,l,u){this.fetchUniformLocation(o,l)&&this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class VS extends jl{constructor(o){super(o),this.current=[0,0,0,0]}set(o,l,u){this.fetchUniformLocation(o,l)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3])))}}class Hv extends jl{constructor(o){super(o),this.current=Eo.transparent}set(o,l,u){this.fetchUniformLocation(o,l)&&(u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a)))}}const Dt=new Float32Array(16),gI=new Float32Array(9),bI=new Float32Array(4);function $v(a){return[Le(255*a.r,255*a.g),Le(255*a.b,255*a.a)]}class Jm{constructor(o,l,u){this.value=o,this.uniformNames=l.map(f=>`u_${f}`),this.type=u}setUniform(o,l,u,f,b){l.set(o,b,f.constantOr(this.value))}getBinding(o,l){return"color"===this.type?new Hv(o):new Zc(o)}}class pf{constructor(o,l){this.uniformNames=l.map(u=>`u_${u}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(o){this.pixelRatio=o.pixelRatio||1,this.pattern=o.tl.concat(o.br)}setUniform(o,l,u,f,b){const v="u_pattern"===b||"u_dash"===b?this.pattern:"u_pixel_ratio"===b?this.pixelRatio:null;v&&l.set(o,b,v)}getBinding(o,l){return"u_pattern"===l||"u_dash"===l?new VS(o):new Zc(o)}}class Ou{constructor(o,l,u,f){this.expression=o,this.type=u,this.maxValue=0,this.paintVertexAttributes=l.map(b=>({name:`a_${b}`,type:"Float32",components:"color"===u?2:1,offset:0})),this.paintVertexArray=new f}populatePaintArray(o,l,u,f,b,v){const S=this.paintVertexArray.length,E=this.expression.evaluate(new P(0),l,{},b,f,v);this.paintVertexArray.resize(o),this._setPaintValue(S,o,E)}updatePaintArray(o,l,u,f,b){const v=this.expression.evaluate({zoom:0},u,f,void 0,b);this._setPaintValue(o,l,v)}_setPaintValue(o,l,u){if("color"===this.type){const f=$v(u);for(let b=o;b<l;b++)this.paintVertexArray.emplace(b,f[0],f[1])}else{for(let f=o;f<l;f++)this.paintVertexArray.emplace(f,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class pc{constructor(o,l,u,f,b,v){this.expression=o,this.uniformNames=l.map(S=>`u_${S}_t`),this.type=u,this.useIntegerZoom=f,this.zoom=b,this.maxValue=0,this.paintVertexAttributes=l.map(S=>({name:`a_${S}`,type:"Float32",components:"color"===u?4:2,offset:0})),this.paintVertexArray=new v}populatePaintArray(o,l,u,f,b,v){const S=this.expression.evaluate(new P(this.zoom),l,{},b,f,v),E=this.expression.evaluate(new P(this.zoom+1),l,{},b,f,v),D=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValue(D,o,S,E)}updatePaintArray(o,l,u,f,b){const v=this.expression.evaluate({zoom:this.zoom},u,f,void 0,b),S=this.expression.evaluate({zoom:this.zoom+1},u,f,void 0,b);this._setPaintValue(o,l,v,S)}_setPaintValue(o,l,u,f){if("color"===this.type){const b=$v(u),v=$v(f);for(let S=o;S<l;S++)this.paintVertexArray.emplace(S,b[0],b[1],v[0],v[1])}else{for(let b=o;b<l;b++)this.paintVertexArray.emplace(b,u,f);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(f))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(o,l,u,f,b){const v=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,S=lt(this.expression.interpolationFactor(v,this.zoom,this.zoom+1),0,1);l.set(o,b,S)}getBinding(o,l){return new Zc(o)}}class bl{constructor(o,l,u,f,b){this.expression=o,this.layerId=b,this.paintVertexAttributes=("array"===u?hc:zl).members;for(let v=0;v<l.length;++v);this.paintVertexArray=new f}populatePaintArray(o,l,u){const f=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValues(f,o,l.patterns&&l.patterns[this.layerId],u)}updatePaintArray(o,l,u,f,b,v){this._setPaintValues(o,l,u.patterns&&u.patterns[this.layerId],v)}_setPaintValues(o,l,u,f){if(!f||!u)return;const b=f[u];if(!b)return;const{tl:v,br:S,pixelRatio:E}=b;for(let D=o;D<l;D++)this.paintVertexArray.emplace(D,v[0],v[1],S[0],S[1],E)}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ud{constructor(o,l,u=(()=>!0)){this.binders={},this._buffers=[];const f=[];for(const b in o.paint._values){if(!u(b))continue;const v=o.paint.get(b);if(!(v instanceof se&&Ad(v.property.specification)))continue;const S=m_(b,o.type),E=v.value,D=v.property.specification.type,k=!!v.property.useIntegerZoom,O="line-dasharray"===b||b.endsWith("pattern"),F="line-dasharray"===b&&"constant"!==o.layout.get("line-cap").value.kind;if("constant"!==E.kind||F)if("source"===E.kind||F||O){const V=qv(b,D,"source");this.binders[b]=O?new bl(E,S,D,V,o.id):new Ou(E,S,D,V),f.push(`/a_${b}`)}else{const V=qv(b,D,"composite");this.binders[b]=new pc(E,S,D,k,l,V),f.push(`/z_${b}`)}else this.binders[b]=O?new pf(E.value,S):new Jm(E.value,S,D),f.push(`/u_${b}`)}this.cacheKey=f.sort().join("")}getMaxValue(o){const l=this.binders[o];return l instanceof Ou||l instanceof pc?l.maxValue:0}populatePaintArrays(o,l,u,f,b,v){for(const S in this.binders){const E=this.binders[S];(E instanceof Ou||E instanceof pc||E instanceof bl)&&E.populatePaintArray(o,l,u,f,b,v)}}setConstantPatternPositions(o){for(const l in this.binders){const u=this.binders[l];u instanceof pf&&u.setConstantPatternPositions(o)}}updatePaintArrays(o,l,u,f,b,v){let S=!1;for(const E in o){const D=l.getPositions(E);for(const k of D){const O=u.feature(k.index);for(const F in this.binders){const V=this.binders[F];if((V instanceof Ou||V instanceof pc||V instanceof bl)&&!0===V.expression.isStateDependent){const U=f.paint.get(F);V.expression=U.value,V.updatePaintArray(k.start,k.end,O,o[E],b,v),S=!0}}}}return S}defines(){const o=[];for(const l in this.binders){const u=this.binders[l];(u instanceof Jm||u instanceof pf)&&o.push(...u.uniformNames.map(f=>`#define HAS_UNIFORM_${f}`))}return o}getBinderAttributes(){const o=[];for(const l in this.binders){const u=this.binders[l];if(u instanceof Ou||u instanceof pc||u instanceof bl)for(let f=0;f<u.paintVertexAttributes.length;f++)o.push(u.paintVertexAttributes[f].name)}return o}getBinderUniforms(){const o=[];for(const l in this.binders){const u=this.binders[l];if(u instanceof Jm||u instanceof pf||u instanceof pc)for(const f of u.uniformNames)o.push(f)}return o}getPaintVertexBuffers(){return this._buffers}getUniforms(o){const l=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof Jm||f instanceof pf||f instanceof pc)for(const b of f.uniformNames)l.push({name:b,property:u,binding:f.getBinding(o,b)})}return l}setUniforms(o,l,u,f,b){for(const{name:v,property:S,binding:E}of u)this.binders[S].setUniform(o,E,b,f.get(S),v)}updatePaintBuffers(){this._buffers=[];for(const o in this.binders){const l=this.binders[o];(l instanceof Ou||l instanceof pc||l instanceof bl)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(o){for(const l in this.binders){const u=this.binders[l];(u instanceof Ou||u instanceof pc||u instanceof bl)&&u.upload(o)}this.updatePaintBuffers()}destroy(){for(const o in this.binders){const l=this.binders[o];(l instanceof Ou||l instanceof pc||l instanceof bl)&&l.destroy()}}}class Kh{constructor(o,l,u=(()=>!0)){this.programConfigurations={};for(const f of o)this.programConfigurations[f.id]=new Ud(f,l,u);this.needsUpload=!1,this._featureMap=new Xc,this._bufferOffset=0}populatePaintArrays(o,l,u,f,b,v,S){for(const E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(o,l,f,b,v,S);void 0!==l.id&&this._featureMap.add(l.id,u,this._bufferOffset,o),this._bufferOffset=o,this.needsUpload=!0}updatePaintArrays(o,l,u,f,b){for(const v of u)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(o,this._featureMap,l,v,f,b)||this.needsUpload}get(o){return this.programConfigurations[o]}upload(o){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(o);this.needsUpload=!1}}destroy(){for(const o in this.programConfigurations)this.programConfigurations[o].destroy()}}const ss={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function m_(a,o){return ss[a]||[a.replace(`${o}-`,"").replace(/-/g,"_")]}const ff={"line-pattern":{source:ot,composite:ot},"fill-pattern":{source:ot,composite:ot},"fill-extrusion-pattern":{source:ot,composite:ot},"line-dasharray":{source:wt,composite:wt}},_I={color:{source:Aa,composite:Vt},number:{source:Dr,composite:Aa}};function qv(a,o,l){const u=ff[a];return u&&u[l]||_I[o][l]}Mn(Jm,"ConstantBinder"),Mn(pf,"PatternConstantBinder"),Mn(Ou,"SourceExpressionBinder"),Mn(bl,"PatternCompositeBinder"),Mn(pc,"CompositeExpressionBinder"),Mn(Ud,"ProgramConfiguration",{omit:["_buffers"]}),Mn(Kh,"ProgramConfigurationSet");const ka="-transition";class as extends Al{constructor(o,l){if(super(),this.id=o.id,this.type=o.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==o.type&&(this.metadata=o.metadata,this.minzoom=o.minzoom,this.maxzoom=o.maxzoom,"background"!==o.type&&"sky"!==o.type&&(this.source=o.source,this.sourceLayer=o["source-layer"],this.filter=o.filter),l.layout&&(this._unevaluatedLayout=new ae(l.layout)),l.paint)){this._transitionablePaint=new $(l.paint);for(const u in o.paint)this.setPaintProperty(u,o.paint[u],{validate:!1});for(const u in o.layout)this.setLayoutProperty(u,o.layout[u],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ce(l.paint)}}getLayoutProperty(o){return"visibility"===o?this.visibility:this._unevaluatedLayout.getValue(o)}setLayoutProperty(o,l,u={}){null!=l&&this._validate(zo,`layers.${this.id}.layout.${o}`,o,l,u)||("visibility"!==o?this._unevaluatedLayout.setValue(o,l):this.visibility=l)}getPaintProperty(o){return dn(o,ka)?this._transitionablePaint.getTransition(o.slice(0,-11)):this._transitionablePaint.getValue(o)}setPaintProperty(o,l,u={}){if(null!=l&&this._validate(Gi,`layers.${this.id}.paint.${o}`,o,l,u))return!1;if(dn(o,ka))return this._transitionablePaint.setTransition(o.slice(0,-11),l||void 0),!1;{const f=this._transitionablePaint._values[o],b=f.value.isDataDriven(),v=f.value;this._transitionablePaint.setValue(o,l),this._handleSpecialPaintPropertyUpdate(o);const S=this._transitionablePaint._values[o].value,E=S.isDataDriven(),D=dn(o,"pattern")||"line-dasharray"===o;return E||b||D||this._handleOverridablePaintPropertyUpdate(o,v,S)}}_handleSpecialPaintPropertyUpdate(o){}getProgramIds(){return null}getProgramConfiguration(o){return null}_handleOverridablePaintPropertyUpdate(o,l,u){return!1}isHidden(o){return!!(this.minzoom&&o<this.minzoom)||!!(this.maxzoom&&o>=this.maxzoom)||"none"===this.visibility}updateTransitions(o){this._transitioningPaint=this._transitionablePaint.transitioned(o,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(o,l){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(o,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(o,void 0,l)}serialize(){const o={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(o.layout=o.layout||{},o.layout.visibility=this.visibility),Wi(o,(l,u)=>!(void 0===l||"layout"===u&&!Object.keys(l).length||"paint"===u&&!Object.keys(l).length))}_validate(o,l,u,f,b={}){return(!b||!1!==b.validate)&&ku(this,o.call(Vi,{key:l,layerType:this.type,objectKey:u,value:f,styleSpec:_t,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const o in this.paint._values){const l=this.paint.get(o);if(l instanceof se&&Ad(l.property.specification)&&("source"===l.value.kind||"composite"===l.value.kind)&&l.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Uh(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Gv=We([{name:"a_pos",components:2,type:"Int16"}],4),eg=We([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class to{constructor(o=[]){this.segments=o}prepareSegment(o,l,u,f){let b=this.segments[this.segments.length-1];return o>to.MAX_VERTEX_ARRAY_LENGTH&&ln(`Max vertices per segment is ${to.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${o}`),(!b||b.vertexLength+o>to.MAX_VERTEX_ARRAY_LENGTH||b.sortKey!==f)&&(b={vertexOffset:l.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},void 0!==f&&(b.sortKey=f),this.segments.push(b)),b}get(){return this.segments}destroy(){for(const o of this.segments)for(const l in o.vaos)o.vaos[l].destroy()}static simpleSegment(o,l,u,f){return new to([{vertexOffset:o,primitiveOffset:l,vertexLength:u,primitiveLength:f,vaos:{},sortKey:0}])}}to.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Mn(to,"SegmentVector");var Wn=8192;class Lu{constructor(o,l){o&&(l?this.setSouthWest(o).setNorthEast(l):4===o.length?this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]]):this.setSouthWest(o[0]).setNorthEast(o[1]))}setNorthEast(o){return this._ne=o instanceof Ir?new Ir(o.lng,o.lat):Ir.convert(o),this}setSouthWest(o){return this._sw=o instanceof Ir?new Ir(o.lng,o.lat):Ir.convert(o),this}extend(o){const l=this._sw,u=this._ne;let f,b;if(o instanceof Ir)f=o,b=o;else{if(!(o instanceof Lu))return Array.isArray(o)?4===o.length||o.every(Array.isArray)?this.extend(Lu.convert(o)):this.extend(Ir.convert(o)):"object"==typeof o&&null!==o&&o.hasOwnProperty("lat")&&(o.hasOwnProperty("lon")||o.hasOwnProperty("lng"))?this.extend(Ir.convert(o)):this;if(f=o._sw,b=o._ne,!f||!b)return this}return l||u?(l.lng=Math.min(f.lng,l.lng),l.lat=Math.min(f.lat,l.lat),u.lng=Math.max(b.lng,u.lng),u.lat=Math.max(b.lat,u.lat)):(this._sw=new Ir(f.lng,f.lat),this._ne=new Ir(b.lng,b.lat)),this}getCenter(){return new Ir((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Ir(this.getWest(),this.getNorth())}getSouthEast(){return new Ir(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(o){const{lng:l,lat:u}=Ir.convert(o);let f=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&f}static convert(o){return!o||o instanceof Lu?o:new Lu(o)}}var tg=1e-6,$a="undefined"!=typeof Float32Array?Float32Array:Array;function jS(){var a=new $a(9);return $a!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function g_(a,o,l){var u=o[0],f=o[1],b=o[2],v=o[3],S=o[4],E=o[5],D=o[6],k=o[7],O=o[8],F=l[0],V=l[1],U=l[2],G=l[3],J=l[4],ue=l[5],we=l[6],de=l[7],ve=l[8];return a[0]=F*u+V*v+U*D,a[1]=F*f+V*S+U*k,a[2]=F*b+V*E+U*O,a[3]=G*u+J*v+ue*D,a[4]=G*f+J*S+ue*k,a[5]=G*b+J*E+ue*O,a[6]=we*u+de*v+ve*D,a[7]=we*f+de*S+ve*k,a[8]=we*b+de*E+ve*O,a}function Do(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function mf(a,o){var l=o[0],u=o[1],f=o[2],b=o[3],v=o[4],S=o[5],E=o[6],D=o[7],k=o[8],O=o[9],F=o[10],V=o[11],U=o[12],G=o[13],J=o[14],ue=o[15],we=l*S-u*v,de=l*E-f*v,ve=l*D-b*v,Ae=u*E-f*S,ke=u*D-b*S,ct=f*D-b*E,st=k*G-O*U,yt=k*J-F*U,Ht=k*ue-V*U,dt=O*J-F*G,It=O*ue-V*G,Et=F*ue-V*J,Lt=we*Et-de*It+ve*dt+Ae*Ht-ke*yt+ct*st;return Lt?(a[0]=(S*Et-E*It+D*dt)*(Lt=1/Lt),a[1]=(f*It-u*Et-b*dt)*Lt,a[2]=(G*ct-J*ke+ue*Ae)*Lt,a[3]=(F*ke-O*ct-V*Ae)*Lt,a[4]=(E*Ht-v*Et-D*yt)*Lt,a[5]=(l*Et-f*Ht+b*yt)*Lt,a[6]=(J*ve-U*ct-ue*de)*Lt,a[7]=(k*ct-F*ve+V*de)*Lt,a[8]=(v*It-S*Ht+D*st)*Lt,a[9]=(u*Ht-l*It-b*st)*Lt,a[10]=(U*ke-G*ve+ue*we)*Lt,a[11]=(O*ve-k*ke-V*we)*Lt,a[12]=(S*yt-v*dt-E*st)*Lt,a[13]=(l*dt-u*yt+f*st)*Lt,a[14]=(G*de-U*Ae-J*we)*Lt,a[15]=(k*Ae-O*de+F*we)*Lt,a):null}function _l(a,o,l){var u=o[0],f=o[1],b=o[2],v=o[3],S=o[4],E=o[5],D=o[6],k=o[7],O=o[8],F=o[9],V=o[10],U=o[11],G=o[12],J=o[13],ue=o[14],we=o[15],de=l[0],ve=l[1],Ae=l[2],ke=l[3];return a[0]=de*u+ve*S+Ae*O+ke*G,a[1]=de*f+ve*E+Ae*F+ke*J,a[2]=de*b+ve*D+Ae*V+ke*ue,a[3]=de*v+ve*k+Ae*U+ke*we,a[4]=(de=l[4])*u+(ve=l[5])*S+(Ae=l[6])*O+(ke=l[7])*G,a[5]=de*f+ve*E+Ae*F+ke*J,a[6]=de*b+ve*D+Ae*V+ke*ue,a[7]=de*v+ve*k+Ae*U+ke*we,a[8]=(de=l[8])*u+(ve=l[9])*S+(Ae=l[10])*O+(ke=l[11])*G,a[9]=de*f+ve*E+Ae*F+ke*J,a[10]=de*b+ve*D+Ae*V+ke*ue,a[11]=de*v+ve*k+Ae*U+ke*we,a[12]=(de=l[12])*u+(ve=l[13])*S+(Ae=l[14])*O+(ke=l[15])*G,a[13]=de*f+ve*E+Ae*F+ke*J,a[14]=de*b+ve*D+Ae*V+ke*ue,a[15]=de*v+ve*k+Ae*U+ke*we,a}function ng(a,o,l){var u,f,b,v,S,E,D,k,O,F,V,U,G=l[0],J=l[1],ue=l[2];return o===a?(a[12]=o[0]*G+o[4]*J+o[8]*ue+o[12],a[13]=o[1]*G+o[5]*J+o[9]*ue+o[13],a[14]=o[2]*G+o[6]*J+o[10]*ue+o[14],a[15]=o[3]*G+o[7]*J+o[11]*ue+o[15]):(f=o[1],b=o[2],v=o[3],S=o[4],E=o[5],D=o[6],k=o[7],O=o[8],F=o[9],V=o[10],U=o[11],a[0]=u=o[0],a[1]=f,a[2]=b,a[3]=v,a[4]=S,a[5]=E,a[6]=D,a[7]=k,a[8]=O,a[9]=F,a[10]=V,a[11]=U,a[12]=u*G+S*J+O*ue+o[12],a[13]=f*G+E*J+F*ue+o[13],a[14]=b*G+D*J+V*ue+o[14],a[15]=v*G+k*J+U*ue+o[15]),a}function Fu(a,o,l){var u=l[0],f=l[1],b=l[2];return a[0]=o[0]*u,a[1]=o[1]*u,a[2]=o[2]*u,a[3]=o[3]*u,a[4]=o[4]*f,a[5]=o[5]*f,a[6]=o[6]*f,a[7]=o[7]*f,a[8]=o[8]*b,a[9]=o[9]*b,a[10]=o[10]*b,a[11]=o[11]*b,a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15],a}function b_(a,o,l){var u=Math.sin(l),f=Math.cos(l),b=o[4],v=o[5],S=o[6],E=o[7],D=o[8],k=o[9],O=o[10],F=o[11];return o!==a&&(a[0]=o[0],a[1]=o[1],a[2]=o[2],a[3]=o[3],a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15]),a[4]=b*f+D*u,a[5]=v*f+k*u,a[6]=S*f+O*u,a[7]=E*f+F*u,a[8]=D*f-b*u,a[9]=k*f-v*u,a[10]=O*f-S*u,a[11]=F*f-E*u,a}function ig(a,o,l){var u=Math.sin(l),f=Math.cos(l),b=o[0],v=o[1],S=o[2],E=o[3],D=o[8],k=o[9],O=o[10],F=o[11];return o!==a&&(a[4]=o[4],a[5]=o[5],a[6]=o[6],a[7]=o[7],a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15]),a[0]=b*f-D*u,a[1]=v*f-k*u,a[2]=S*f-O*u,a[3]=E*f-F*u,a[8]=b*u+D*f,a[9]=v*u+k*f,a[10]=S*u+O*f,a[11]=E*u+F*f,a}function Wv(a,o){return a[0]=o[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=o[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=o[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function Xv(a,o,l){var u,f,b,v=l[0],S=l[1],E=l[2],D=Math.hypot(v,S,E);return D<tg?null:(v*=D=1/D,S*=D,E*=D,u=Math.sin(o),f=Math.cos(o),a[0]=v*v*(b=1-f)+f,a[1]=S*v*b+E*u,a[2]=E*v*b-S*u,a[3]=0,a[4]=v*S*b-E*u,a[5]=S*S*b+f,a[6]=E*S*b+v*u,a[7]=0,a[8]=v*E*b+S*u,a[9]=S*E*b-v*u,a[10]=E*E*b+f,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a)}Math.hypot||(Math.hypot=function(){for(var a=0,o=arguments.length;o--;)a+=arguments[o]*arguments[o];return Math.sqrt(a)});var US=_l;function __(){var a=new $a(3);return $a!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function rg(a){var o=new $a(3);return o[0]=a[0],o[1]=a[1],o[2]=a[2],o}function Nu(a){return Math.hypot(a[0],a[1],a[2])}function gf(a,o,l){var u=new $a(3);return u[0]=a,u[1]=o,u[2]=l,u}function qa(a,o,l){return a[0]=o[0]+l[0],a[1]=o[1]+l[1],a[2]=o[2]+l[2],a}function bf(a,o,l){return a[0]=o[0]-l[0],a[1]=o[1]-l[1],a[2]=o[2]-l[2],a}function _f(a,o,l){return a[0]=o[0]*l[0],a[1]=o[1]*l[1],a[2]=o[2]*l[2],a}function yf(a,o,l){return a[0]=Math.min(o[0],l[0]),a[1]=Math.min(o[1],l[1]),a[2]=Math.min(o[2],l[2]),a}function vf(a,o,l){return a[0]=Math.max(o[0],l[0]),a[1]=Math.max(o[1],l[1]),a[2]=Math.max(o[2],l[2]),a}function Ga(a,o,l){return a[0]=o[0]*l,a[1]=o[1]*l,a[2]=o[2]*l,a}function Qh(a,o,l,u){return a[0]=o[0]+l[0]*u,a[1]=o[1]+l[1]*u,a[2]=o[2]+l[2]*u,a}function Zo(a,o){var l=o[0],u=o[1],f=o[2],b=l*l+u*u+f*f;return b>0&&(b=1/Math.sqrt(b)),a[0]=o[0]*b,a[1]=o[1]*b,a[2]=o[2]*b,a}function Ns(a,o){return a[0]*o[0]+a[1]*o[1]+a[2]*o[2]}function y_(a,o,l){var u=o[0],f=o[1],b=o[2],v=l[0],S=l[1],E=l[2];return a[0]=f*E-b*S,a[1]=b*v-u*E,a[2]=u*S-f*v,a}function Ue(a,o,l){var u=o[0],f=o[1],b=o[2],v=l[3]*u+l[7]*f+l[11]*b+l[15];return a[0]=(l[0]*u+l[4]*f+l[8]*b+l[12])/(v=v||1),a[1]=(l[1]*u+l[5]*f+l[9]*b+l[13])/v,a[2]=(l[2]*u+l[6]*f+l[10]*b+l[14])/v,a}function v_(a,o,l){var u=l[0],f=l[1],b=l[2],v=o[0],S=o[1],E=o[2],D=f*E-b*S,k=b*v-u*E,O=u*S-f*v,F=f*O-b*k,V=b*D-u*O,U=u*k-f*D,G=2*l[3];return k*=G,O*=G,V*=2,U*=2,a[0]=v+(D*=G)+(F*=2),a[1]=S+k+V,a[2]=E+O+U,a}var Wr,Wa=bf,xf=_f,HS=Nu;function Zv(a,o,l){return a[0]=o[0]*l,a[1]=o[1]*l,a[2]=o[2]*l,a[3]=o[3]*l,a}function Yv(a,o){var l=o[0],u=o[1],f=o[2],b=o[3],v=l*l+u*u+f*f+b*b;return v>0&&(v=1/Math.sqrt(v)),a[0]=l*v,a[1]=u*v,a[2]=f*v,a[3]=b*v,a}function Yc(a,o,l){var u=o[0],f=o[1],b=o[2],v=o[3];return a[0]=l[0]*u+l[4]*f+l[8]*b+l[12]*v,a[1]=l[1]*u+l[5]*f+l[9]*b+l[13]*v,a[2]=l[2]*u+l[6]*f+l[10]*b+l[14]*v,a[3]=l[3]*u+l[7]*f+l[11]*b+l[15]*v,a}function Jh(){var a=new $a(4);return $a!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function x_(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a}function ep(a,o,l){l*=.5;var u=o[0],f=o[1],b=o[2],v=o[3],S=Math.sin(l),E=Math.cos(l);return a[0]=u*E+v*S,a[1]=f*E+b*S,a[2]=b*E-f*S,a[3]=v*E-u*S,a}function Kv(a,o,l){l*=.5;var u=o[0],f=o[1],b=o[2],v=o[3],S=Math.sin(l),E=Math.cos(l);return a[0]=u*E-b*S,a[1]=f*E+v*S,a[2]=b*E+u*S,a[3]=v*E-f*S,a}__(),Wr=new $a(4),$a!=Float32Array&&(Wr[0]=0,Wr[1]=0,Wr[2]=0,Wr[3]=0);var Qv=Yv;__(),gf(1,0,0),gf(0,1,0),Jh(),Jh(),jS();const wf=We([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Sf}=wf,w_=We([{name:"a_pos_3",components:3,type:"Int16"}]);var Cf=We([{name:"a_pos",type:"Int16",components:2}]);class S_{constructor(o,l){this.pos=o,this.dir=l}intersectsPlane(o,l,u){const f=Ns(l,this.dir);if(Math.abs(f)<1e-6)return!1;const b=((o[0]-this.pos[0])*l[0]+(o[1]-this.pos[1])*l[1]+(o[2]-this.pos[2])*l[2])/f;return u[0]=this.pos[0]+this.dir[0]*b,u[1]=this.pos[1]+this.dir[1]*b,u[2]=this.pos[2]+this.dir[2]*b,!0}closestPointOnSphere(o,l,u){if(G=(V=this.pos)[0],J=V[1],ue=V[2],we=(U=o)[0],de=U[1],ve=U[2],Math.abs(G-we)<=tg*Math.max(1,Math.abs(G),Math.abs(we))&&Math.abs(J-de)<=tg*Math.max(1,Math.abs(J),Math.abs(de))&&Math.abs(ue-ve)<=tg*Math.max(1,Math.abs(ue),Math.abs(ve))||0===l)return u[0]=u[1]=u[2]=0,!1;var V,U,G,J,ue,we,de,ve;const[f,b,v]=this.dir,S=this.pos[0]-o[0],E=this.pos[1]-o[1],D=this.pos[2]-o[2],k=f*f+b*b+v*v,O=2*(S*f+E*b+D*v),F=O*O-4*k*(S*S+E*E+D*D-l*l);if(F<0){const V=Math.max(-O/2,0),U=S+f*V,G=E+b*V,J=D+v*V,ue=Math.hypot(U,G,J);return u[0]=U*l/ue,u[1]=G*l/ue,u[2]=J*l/ue,!1}{const V=(-O-Math.sqrt(F))/(2*k);if(V<0){const U=Math.hypot(S,E,D);return u[0]=S*l/U,u[1]=E*l/U,u[2]=D*l/U,!1}return u[0]=S+f*V,u[1]=E+b*V,u[2]=D+v*V,!0}}}class Bu{constructor(o,l,u,f,b){this.TL=o,this.TR=l,this.BR=u,this.BL=f,this.horizon=b}static fromInvProjectionMatrix(o,l,u){const f=[-1,1,1],b=[1,1,1],v=[1,-1,1],S=[-1,-1,1],E=Ue(f,f,o),D=Ue(b,b,o),k=Ue(v,v,o),O=Ue(S,S,o);return new Bu(E,D,k,O,l/u)}}class Hd{constructor(o,l){this.points=o,this.planes=l}static fromInvProjectionMatrix(o,l,u,f){const b=Math.pow(2,u),v=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(E=>{const D=Yc([],E,o),k=1/D[3]/l*b;return(O=D)[0]=(F=D)[0]*(V=[k,k,f?1/D[3]:k,k])[0],O[1]=F[1]*V[1],O[2]=F[2]*V[2],O[3]=F[3]*V[3],O;var O,F,V}),S=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(E=>{const D=Zo([],y_([],Wa([],v[E[0]],v[E[1]]),Wa([],v[E[2]],v[E[1]]))),k=-Ns(D,v[E[1]]);return D.concat(k)});return new Hd(v,S)}}class ea{static fromPoints(o){const l=[1/0,1/0,1/0],u=[-1/0,-1/0,-1/0];for(const f of o)yf(l,l,f),vf(u,u,f);return new ea(l,u)}static applyTransform(o,l){const u=o.getCorners();for(let f=0;f<u.length;++f)Ue(u[f],u[f],l);return ea.fromPoints(u)}constructor(o,l){this.min=o,this.max=l,this.center=Ga([],qa([],this.min,this.max),.5)}quadrant(o){const l=[o%2==0,o<2],u=rg(this.min),f=rg(this.max);for(let b=0;b<l.length;b++)u[b]=l[b]?this.min[b]:this.center[b],f[b]=l[b]?this.center[b]:this.max[b];return f[2]=this.max[2],new ea(u,f)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}distanceZ(o){return Math.max(Math.min(this.max[2],o[2]),this.min[2])-o[2]}getCorners(){const o=this.min,l=this.max;return[[o[0],o[1],o[2]],[l[0],o[1],o[2]],[l[0],l[1],o[2]],[o[0],l[1],o[2]],[o[0],o[1],l[2]],[l[0],o[1],l[2]],[l[0],l[1],l[2]],[o[0],l[1],l[2]]]}intersects(o){const l=this.getCorners();let u=!0;for(let f=0;f<o.planes.length;f++){const b=o.planes[f];let v=0;for(let S=0;S<l.length;S++)v+=Ns(b,l[S])+b[3]>=0;if(0===v)return 0;v!==l.length&&(u=!1)}if(u)return 2;for(let f=0;f<3;f++){let b=Number.MAX_VALUE,v=-Number.MAX_VALUE;for(let S=0;S<o.points.length;S++){const E=o.points[S][f]-this.min[f];b=Math.min(b,E),v=Math.max(v,E)}if(v<0||b>this.max[f]-this.min[f])return 0}return 1}}const fc=Wn/Math.PI/2,Tf=[64,32,16],yl=-fc,pa=fc,e0=[new ea([yl,yl,yl],[pa,pa,pa]),new ea([yl,yl,yl],[0,0,pa]),new ea([0,yl,yl],[pa,0,pa]),new ea([yl,0,yl],[0,pa,pa]),new ea([0,0,yl],[pa,pa,pa])];function og(a){return a*fc/Af}function T_(a,o,l,u=!0){const f=Ga([],a._camera.position,a.worldSize),b=[o,l,1,1];Yc(b,b,a.pixelMatrixInverse),Zv(b,b,1/b[3]);const v=Zo([],Wa([],b,f)),S=a.globeMatrix,E=[S[12],S[13],S[14]],D=Wa([],E,f),k=Nu(D),O=Zo([],D),F=a.worldSize/(2*Math.PI),V=Ns(O,v),U=Math.asin(F/k);if(U<Math.acos(V)){if(!u)return null;const Ht=[],dt=[];Ga(Ht,v,k/V),Zo(dt,Wa(dt,Ht,D)),Zo(v,qa(v,D,Ga(v,dt,Math.tan(U)*k)))}const G=[];new S_(f,v).closestPointOnSphere(E,F,G);const J=Zo([],Ur(S,0)),ue=Zo([],Ur(S,1)),we=Zo([],Ur(S,2)),de=Ns(J,G),ve=Ns(ue,G),Ae=Ns(we,G),ke=K(Math.asin(-ve/F));let ct=K(Math.atan2(de,Ae));ct=a.center.lng+function(Ht,dt){const It=(dt-Ht+180)%360-180;return It<-180?It+360:It}(a.center.lng,ct);const st=gc(ct),yt=lt(Ul(ke),0,1);return new Vo(st,yt)}class vI{constructor(o,l,u){this.a=Wa([],o,u),this.b=Wa([],l,u),this.center=u;const f=Zo([],this.a),b=Zo([],this.b);this.angle=Math.acos(Ns(f,b))}}function sg(a,o){if(0===a.angle)return null;let l;return l=0===a.a[o]?1/a.angle*.5*Math.PI:1/a.angle*Math.atan(a.b[o]/a.a[o]/Math.sin(a.angle)-1/Math.tan(a.angle)),l<0||l>1?null:function(u,f,b,v){const S=Math.sin(b);return u*(Math.sin((1-v)*b)/S)+f*(Math.sin(v*b)/S)}(a.a[o],a.b[o],a.angle,lt(l,0,1))+a.center[o]}function Kc(a){if(a.z<=1)return e0[a.z+2*a.y+a.x];const o=Ef(E_(a));return ea.fromPoints(o)}function qd(a,o,l){return Ga(a,a,1-l),Qh(a,a,o,l)}function t0(a,o){const l=Gd(o.zoom);if(0===l)return Kc(a);const u=E_(a),f=Ef(u),b=gc(u.getWest())*o.worldSize,v=gc(u.getEast())*o.worldSize,S=Ul(u.getNorth())*o.worldSize,E=Ul(u.getSouth())*o.worldSize,D=[b,S,0],k=[v,S,0],O=[b,E,0],F=[v,E,0],V=mf([],o.globeMatrix);return Ue(D,D,V),Ue(k,k,V),Ue(O,O,V),Ue(F,F,V),f[0]=qd(f[0],O,l),f[1]=qd(f[1],F,l),f[2]=qd(f[2],k,l),f[3]=qd(f[3],D,l),ea.fromPoints(f)}function ag(a,o,l){for(const u of a)Ue(u,u,o),Ga(u,u,l)}function E_({x:a,y:o,z:l}){const u=1/(1<<l),f=new Ir(Xa(a*u),Mr((o+1)*u)),b=new Ir(Xa((a+1)*u),Mr(o*u));return new Lu(f,b)}function Ef(a){const o=Be(a.getNorth()),l=Be(a.getSouth()),u=Math.cos(o),f=Math.cos(l),b=Math.sin(o),v=Math.sin(l),S=a.getWest(),E=a.getEast();return[Df(f,v,S),Df(f,v,E),Df(u,b,E),Df(u,b,S)]}function Df(a,o,l,u=fc){return l=Be(l),[a*Math.sin(l)*u,-o*u,a*Math.cos(l)*u]}function If(a,o,l){return Df(Math.cos(Be(a)),Math.sin(Be(a)),o,l)}function lg(a,o,l,u){const f=1<<l.z,b=(a/Wn+l.x)/f;return If(Mr((o/Wn+l.y)/f),Xa(b),u)}function D_({min:a,max:o}){return 16383/Math.max(o[0]-a[0],o[1]-a[1],o[2]-a[2])}const $S=new Float64Array(16);function Mf(a){const o=D_(a),l=Wv($S,[o,o,o]);return ng(l,l,((u=[])[0]=-(f=a.min)[0],u[1]=-f[1],u[2]=-f[2],u));var u,f}function cg(a){const o=(u=a.min,(l=$S)[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=u[0],l[13]=u[1],l[14]=u[2],l[15]=1,l);var l,u;const f=1/D_(a);return Fu(o,o,[f,f,f])}function ug(a,o,l,u,f){const b=function(E){const D=Wn/(2*Math.PI);return E/(2*Math.PI)/D}(l),v=[a,o,-l/(2*Math.PI)],S=Do(new Float64Array(16));return ng(S,S,v),Fu(S,S,[b,b,b]),b_(S,S,Be(-f)),ig(S,S,Be(-u)),S}function Gd(a){return cn(5,6,a)}function I_(a,o){const l=If(o.lat,o.lng);return v=(f=bf([],function(U){const G=If(U._center.lat,U._center.lng);let J=y_([],gf(0,1,0),G);const ue=Xv([],-U.angle,G);J=Ue(J,J,ue),Xv(ue,-U._pitch,J);const we=Zo([],G);return Ga(we,we,og(U.cameraToCenterDistance/U.pixelsPerMeter)),Ue(we,we,ue),qa([],G,we)}(a),l))[0],S=f[1],E=f[2],D=(b=l)[0],k=b[1],O=b[2],V=(F=Math.sqrt(v*v+S*S+E*E)*Math.sqrt(D*D+k*k+O*O))&&Ns(f,b)/F,Math.acos(Math.min(Math.max(V,-1),1));var f,b,v,S,E,D,k,O,F,V}function dg(a,o){return I_(a,o)>Math.PI/2*1.01}const fa=Be(85),qS=Math.cos(fa),GS=Math.sin(fa),Af=6371008.8,M_=2*Math.PI*Af;class mc{constructor(o,l){if(isNaN(o)||isNaN(l))throw new Error(`Invalid LngLat object: (${o}, ${l})`);if(this.lng=+o,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new mc(Mt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(o){const l=Math.PI/180,u=this.lat*l,f=o.lat*l,b=Math.sin(u)*Math.sin(f)+Math.cos(u)*Math.cos(f)*Math.cos((o.lng-this.lng)*l);return Af*Math.acos(Math.min(b,1))}toBounds(o=0){const l=360*o/40075017,u=l/Math.cos(Math.PI/180*this.lat);return new Lu(new mc(this.lng-u,this.lat-l),new mc(this.lng+u,this.lat+l))}toEcef(o){const l=og(o);return If(this.lat,this.lng,fc+l)}static convert(o){if(o instanceof mc)return o;if(Array.isArray(o)&&(2===o.length||3===o.length))return new mc(Number(o[0]),Number(o[1]));if(!Array.isArray(o)&&"object"==typeof o&&null!==o)return new mc(Number("lng"in o?o.lng:o.lon),Number(o.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var Ir=mc;function A_(a){return M_*Math.cos(a*Math.PI/180)}function gc(a){return(180+a)/360}function Ul(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function Hl(a,o){return a/A_(o)}function Xa(a){return 360*a-180}function Mr(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function hg(a,o){return a*A_(Mr(o))}const ls=85.051129;function pg(a){return 1/Math.cos(a*Math.PI/180)}class Vo{constructor(o,l,u=0){this.x=+o,this.y=+l,this.z=+u}static fromLngLat(o,l=0){const u=Ir.convert(o);return new Vo(gc(u.lng),Ul(u.lat),Hl(l,u.lat))}toLngLat(){return new Ir(Xa(this.x),Mr(this.y))}toAltitude(){return hg(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/M_*pg(Mr(this.y))}}function Wd(a,o,l,u,f,b,v,S,E){const D=(o+u)/2,k=(l+f)/2,O=new ge(D,k);S(O),function(F,V,U,G,J,ue){const we=U-J,de=G-ue;return Math.abs((G-V)*we-(U-F)*de)/Math.hypot(we,de)}(O.x,O.y,b.x,b.y,v.x,v.y)>=E?(Wd(a,o,l,D,k,b,O,S,E),Wd(a,D,k,u,f,O,v,S,E)):a.push(v)}function k_(a,o,l){let u=a[0],f=u.x,b=u.y;o(u);const v=[u];for(let S=1;S<a.length;S++){const E=a[S],{x:D,y:k}=E;o(E),Wd(v,f,b,D,k,u,E,o,l),f=D,b=k,u=E}return v}function R_(a,o,l,u){if(u(o,l)){const f=o.add(l)._mult(.5);R_(a,o,f,u),R_(a,f,l,u)}else a.push(l)}function WS(a,o){let l=a[0];const u=[l];for(let f=1;f<a.length;f++){const b=a[f];R_(u,l,b,o),l=b}return u}const fg=Math.pow(2,14)-1,n0=-fg-1;function r0(a,o){const l=Math.round(a.x*o),u=Math.round(a.y*o);return a.x=lt(l,n0,fg),a.y=lt(u,n0,fg),(l<a.x||l>a.x+1||u<a.y||u>a.y+1)&&ln("Geometry exceeds allowed extent, reduce your vector tile buffer size"),a}function Qc(a,o,l){const u=a.loadGeometry(),f=a.extent,b=Wn/f;if(o&&l&&l.projection.isReprojectedInTileSpace){const v=1<<o.z,{scale:S,x:E,y:D,projection:k}=l,O=F=>{const V=Xa((o.x+F.x/f)/v),U=Mr((o.y+F.y/f)/v),G=k.project(V,U);F.x=(G.x*S-E)*f,F.y=(G.y*S-D)*f};for(let F=0;F<u.length;F++)if(1!==a.type)u[F]=k_(u[F],O,1);else{const V=[];for(const U of u[F])U.x<0||U.x>=f||U.y<0||U.y>=f||(O(U),V.push(U));u[F]=V}}for(const v of u)for(const S of v)r0(S,b);return u}function zu(a,o){return{type:a.type,id:a.id,properties:a.properties,geometry:o?Qc(a):[]}}function mg(a,o,l,u,f){a.emplaceBack(2*o+(u+1)/2,2*l+(f+1)/2)}function gg(a,o,l){a.emplaceBack(o.x,o.y,o.z,16384*l[0],16384*l[1],16384*l[2])}class kf{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.id),this.index=o.index,this.hasPattern=!1,this.projection=o.projection,this.layoutVertexArray=new zt,this.indexArray=new Vn,this.segments=new to,this.programConfigurations=new Kh(o.layers,o.zoom),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(o,l,u,f){const b=this.layers[0],v=[];let S=null;"circle"===b.type&&(S=b.layout.get("circle-sort-key"));for(const{feature:D,id:k,index:O,sourceLayerIndex:F}of o){const V=this.layers[0]._featureFilter.needGeometry,U=zu(D,V);if(!this.layers[0]._featureFilter.filter(new P(this.zoom),U,u))continue;const G=S?S.evaluate(U,{},u):void 0,J={id:k,properties:D.properties,type:D.type,sourceLayerIndex:F,index:O,geometry:V?U.geometry:Qc(D,u,f),patterns:{},sortKey:G};v.push(J)}S&&v.sort((D,k)=>D.sortKey-k.sortKey);let E=null;"globe"===f.projection.name&&(this.globeExtVertexArray=new Ut,E=f.projection);for(const D of v){const{geometry:k,index:O,sourceLayerIndex:F}=D,V=o[O].feature;this.addFeature(D,k,O,l.availableImages,u,E),l.featureIndex.insert(V,k,O,F,this.index)}}update(o,l,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,l,this.stateDependentLayers,u,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Gv.members),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=o.createVertexBuffer(this.globeExtVertexArray,eg.members))),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(o,l,u,f,b,v){for(const S of l)for(const E of S){const D=E.x,k=E.y;if(D<0||D>=Wn||k<0||k>=Wn)continue;if(v){const V=v.projectTilePoint(D,k,b),U=v.upVector(b,D,k),G=this.globeExtVertexArray;gg(G,V,U),gg(G,V,U),gg(G,V,U),gg(G,V,U)}const O=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,o.sortKey),F=O.vertexLength;mg(this.layoutVertexArray,D,k,-1,-1),mg(this.layoutVertexArray,D,k,1,-1),mg(this.layoutVertexArray,D,k,1,1),mg(this.layoutVertexArray,D,k,-1,1),this.indexArray.emplaceBack(F,F+1,F+2),this.indexArray.emplaceBack(F,F+2,F+3),O.vertexLength+=4,O.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,u,{},f,b)}}function bg(a,o){for(let l=0;l<a.length;l++)if(Vu(o,a[l]))return!0;for(let l=0;l<o.length;l++)if(Vu(a,o[l]))return!0;return!!Xd(a,o)}function XS(a,o,l){return!!Vu(a,o)||!!O_(o,a,l)}function P_(a,o){if(1===a.length)return yg(o,a[0]);for(let l=0;l<o.length;l++){const u=o[l];for(let f=0;f<u.length;f++)if(Vu(a,u[f]))return!0}for(let l=0;l<a.length;l++)if(yg(o,a[l]))return!0;for(let l=0;l<o.length;l++)if(Xd(a,o[l]))return!0;return!1}function ZS(a,o,l){if(a.length>1){if(Xd(a,o))return!0;for(let u=0;u<o.length;u++)if(O_(o[u],a,l))return!0}for(let u=0;u<a.length;u++)if(O_(a[u],o,l))return!0;return!1}function Xd(a,o){if(0===a.length||0===o.length)return!1;for(let l=0;l<a.length-1;l++){const u=a[l],f=a[l+1];for(let b=0;b<o.length-1;b++)if(YS(u,f,o[b],o[b+1]))return!0}return!1}function YS(a,o,l,u){return Fo(a,l,u)!==Fo(o,l,u)&&Fo(a,o,l)!==Fo(a,o,u)}function O_(a,o,l){const u=l*l;if(1===o.length)return a.distSqr(o[0])<u;for(let f=1;f<o.length;f++)if(_g(a,o[f-1],o[f])<u)return!0;return!1}function _g(a,o,l){const u=o.distSqr(l);if(0===u)return a.distSqr(o);const f=((a.x-o.x)*(l.x-o.x)+(a.y-o.y)*(l.y-o.y))/u;return a.distSqr(f<0?o:f>1?l:l.sub(o)._mult(f)._add(o))}function yg(a,o){let l,u,f,b=!1;for(let v=0;v<a.length;v++){l=a[v];for(let S=0,E=l.length-1;S<l.length;E=S++)u=l[S],f=l[E],u.y>o.y!=f.y>o.y&&o.x<(f.x-u.x)*(o.y-u.y)/(f.y-u.y)+u.x&&(b=!b)}return b}function Vu(a,o){let l=!1;for(let u=0,f=a.length-1;u<a.length;f=u++){const b=a[u],v=a[f];b.y>o.y!=v.y>o.y&&o.x<(v.x-b.x)*(o.y-b.y)/(v.y-b.y)+b.x&&(l=!l)}return l}function KS(a,o,l,u,f){for(const v of a)if(o<=v.x&&l<=v.y&&u>=v.x&&f>=v.y)return!0;const b=[new ge(o,l),new ge(o,f),new ge(u,f),new ge(u,l)];if(a.length>2)for(const v of b)if(Vu(a,v))return!0;for(let v=0;v<a.length-1;v++)if(tp(a[v],a[v+1],b))return!0;return!1}function tp(a,o,l){const u=l[0],f=l[2];if(a.x<u.x&&o.x<u.x||a.x>f.x&&o.x>f.x||a.y<u.y&&o.y<u.y||a.y>f.y&&o.y>f.y)return!1;const b=Fo(a,o,l[0]);return b!==Fo(a,o,l[1])||b!==Fo(a,o,l[2])||b!==Fo(a,o,l[3])}function ju(a,o,l){const u=o.paint.get(a).value;return"constant"===u.kind?u.value:l.programConfigurations.get(o.id).getMaxValue(a)}function Rf(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function o0(a,o,l,u,f){if(!o[0]&&!o[1])return a;const b=ge.convert(o)._mult(f);"viewport"===l&&b._rotate(-u);const v=[];for(let S=0;S<a.length;S++)v.push(a[S].sub(b));return v}function vg(a,o,l,u){const f=ge.convert(a)._mult(u);return"viewport"===o&&f._rotate(-l),f}Mn(kf,"CircleBucket",{omit:["layers"]});const QS=new be({"circle-sort-key":new ie(_t.layout_circle["circle-sort-key"])});var JS={paint:new be({"circle-radius":new ie(_t.paint_circle["circle-radius"]),"circle-color":new ie(_t.paint_circle["circle-color"]),"circle-blur":new ie(_t.paint_circle["circle-blur"]),"circle-opacity":new ie(_t.paint_circle["circle-opacity"]),"circle-translate":new q(_t.paint_circle["circle-translate"]),"circle-translate-anchor":new q(_t.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new q(_t.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new q(_t.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ie(_t.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ie(_t.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ie(_t.paint_circle["circle-stroke-opacity"])}),layout:QS};function s0(a,o,l,u,f,b,v,S,E){if(b&&a.queryGeometry.isAboveHorizon)return!1;b&&(E*=a.pixelToTileUnitsFactor);const D=a.tileID.canonical,k=l.projection.upVectorScale(D,l.center.lat,l.worldSize).metersToTile;for(const O of o)for(const F of O){const V=F.add(S),U=f&&l.elevation?l.elevation.exaggeration()*f.getElevationAt(V.x,V.y,!0):0,G=l.projection.projectTilePoint(V.x,V.y,D);if(U>0){const de=l.projection.upVector(D,V.x,V.y);G.x+=de[0]*k*U,G.y+=de[1]*k*U,G.z+=de[2]*k*U}const J=b?V:e1(G.x,G.y,G.z,u),ue=b?a.tilespaceRays.map(de=>l0(de,U)):a.queryGeometry.screenGeometry,we=Yc([],[G.x,G.y,G.z,1],u);if(!v&&b?E*=we[3]/l.cameraToCenterDistance:v&&!b&&(E*=l.cameraToCenterDistance/we[3]),b){const de=Mr((F.y/Wn+D.y)/(1<<D.z));E/=l.projection.pixelsPerMeter(de,1)/Hl(1,de)}if(XS(ue,J,E))return!0}return!1}function e1(a,o,l,u){const f=Yc([],[a,o,l,1],u);return new ge(f[0]/f[3],f[1]/f[3])}const a0=gf(0,0,0),t1=gf(0,0,1);function l0(a,o){const l=__();return a0[2]=o,a.intersectsPlane(a0,t1,l),new ge(l[0],l[1])}class xg extends kf{}function L_(a,{width:o,height:l},u,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==o*l*u)throw new RangeError("mismatched image size")}else f=new Uint8Array(o*l*u);return a.width=o,a.height=l,a.data=f,a}function wg(a,o,l){const{width:u,height:f}=o;u===a.width&&f===a.height||(F_(a,o,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,u),height:Math.min(a.height,f)},l),a.width=u,a.height=f,a.data=o.data)}function F_(a,o,l,u,f,b){if(0===f.width||0===f.height)return o;if(f.width>a.width||f.height>a.height||l.x>a.width-f.width||l.y>a.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>o.width||f.height>o.height||u.x>o.width-f.width||u.y>o.height-f.height)throw new RangeError("out of range destination coordinates for image copy");const v=a.data,S=o.data;for(let E=0;E<f.height;E++){const D=((l.y+E)*a.width+l.x)*b,k=((u.y+E)*o.width+u.x)*b;for(let O=0;O<f.width*b;O++)S[k+O]=v[D+O]}return o}Mn(xg,"HeatmapBucket",{omit:["layers"]});class Jc{constructor(o,l){L_(this,o,1,l)}resize(o){wg(this,new Jc(o),1)}clone(){return new Jc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,l,u,f,b){F_(o,l,u,f,b,1)}}class ma{constructor(o,l){L_(this,o,4,l)}resize(o){wg(this,new ma(o),4)}replace(o,l){l?this.data.set(o):this.data=o instanceof Uint8ClampedArray?new Uint8Array(o.buffer):o}clone(){return new ma({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,l,u,f,b){F_(o,l,u,f,b,4)}}Mn(Jc,"AlphaImage"),Mn(ma,"RGBAImage");var c0={paint:new be({"heatmap-radius":new ie(_t.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ie(_t.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new q(_t.paint_heatmap["heatmap-intensity"]),"heatmap-color":new me(_t.paint_heatmap["heatmap-color"]),"heatmap-opacity":new q(_t.paint_heatmap["heatmap-opacity"])})};function eu(a){const o={},l=a.resolution||256,u=a.clips?a.clips.length:1,f=a.image||new ma({width:l,height:u}),b=(v,S,E)=>{o[a.evaluationKey]=E;const D=a.expression.evaluate(o);f.data[v+S+0]=Math.floor(255*D.r/D.a),f.data[v+S+1]=Math.floor(255*D.g/D.a),f.data[v+S+2]=Math.floor(255*D.b/D.a),f.data[v+S+3]=Math.floor(255*D.a)};if(a.clips)for(let v=0,S=0;v<u;++v,S+=4*l)for(let E=0,D=0;E<l;E++,D+=4){const k=E/(l-1),{start:O,end:F}=a.clips[v];b(S,D,O*(1-k)+F*k)}else for(let v=0,S=0;v<l;v++,S+=4)b(0,S,v/(l-1));return f}var u0={paint:new be({"hillshade-illumination-direction":new q(_t.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new q(_t.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new q(_t.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new q(_t.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new q(_t.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new q(_t.paint_hillshade["hillshade-accent-color"])})};const d0=We([{name:"a_pos",components:2,type:"Int16"}],4),{members:n1}=d0;var h0={exports:{}};function Zd(a,o,l){l=l||2;var u,f,b,v,S,E,D,k=o&&o.length,O=k?o[0]*l:a.length,F=p0(a,0,O,l,!0),V=[];if(!F||F.next===F.prev)return V;if(k&&(F=function(G,J,ue,we){var de,ve,Ae,ke=[];for(de=0,ve=J.length;de<ve;de++)(Ae=p0(G,J[de]*we,de<ve-1?J[de+1]*we:G.length,we,!1))===Ae.next&&(Ae.steiner=!0),ke.push(z_(Ae));for(ke.sort(Cg),de=0;de<ke.length;de++)ue=g0(ke[de],ue);return ue}(a,o,F,l)),a.length>80*l){u=b=a[0],f=v=a[1];for(var U=l;U<O;U+=l)(S=a[U])<u&&(u=S),(E=a[U+1])<f&&(f=E),S>b&&(b=S),E>v&&(v=E);D=0!==(D=Math.max(b-u,v-f))?32767/D:0}return np(F,V,l,u,f,D,0),V}function p0(a,o,l,u,f){var b,v;if(f===_0(a,o,l,u)>0)for(b=o;b<l;b+=u)v=$u(b,a[b],a[b+1],v);else for(b=l-u;b>=o;b-=u)v=$u(b,a[b],a[b+1],v);return v&&Tg(v,v.next)&&(Lf(v),v=v.next),v}function Uu(a,o){if(!a)return a;o||(o=a);var l,u=a;do{if(l=!1,u.steiner||!Tg(u,u.next)&&0!==vo(u.prev,u,u.next))u=u.next;else{if(Lf(u),(u=o=u.prev)===u.next)break;l=!0}}while(l||u!==o);return o}function np(a,o,l,u,f,b,v){if(a){!v&&b&&function(k,O,F,V){var U=k;do{0===U.z&&(U.z=Pf(U.x,U.y,O,F,V)),U.prevZ=U.prev,U.nextZ=U.next,U=U.next}while(U!==k);U.prevZ.nextZ=null,U.prevZ=null,function(G){var J,ue,we,de,ve,Ae,ke,ct,st=1;do{for(ue=G,G=null,ve=null,Ae=0;ue;){for(Ae++,we=ue,ke=0,J=0;J<st&&(ke++,we=we.nextZ);J++);for(ct=st;ke>0||ct>0&&we;)0!==ke&&(0===ct||!we||ue.z<=we.z)?(de=ue,ue=ue.nextZ,ke--):(de=we,we=we.nextZ,ct--),ve?ve.nextZ=de:G=de,de.prevZ=ve,ve=de;ue=we}ve.nextZ=null,st*=2}while(Ae>1)}(U)}(a,u,f,b);for(var S,E,D=a;a.prev!==a.next;)if(S=a.prev,E=a.next,b?N_(a,u,f,b):f0(a))o.push(S.i/l|0),o.push(a.i/l|0),o.push(E.i/l|0),Lf(a),a=E.next,D=E.next;else if((a=E)===D){v?1===v?np(a=m0(Uu(a),o,l),o,l,u,f,b,2):2===v&&Sg(a,o,l,u,f,b):np(Uu(a),o,l,u,f,b,1);break}}}function f0(a){var o=a.prev,l=a,u=a.next;if(vo(o,l,u)>=0)return!1;for(var f=o.x,b=l.x,v=u.x,S=o.y,E=l.y,D=u.y,k=f<b?f<v?f:v:b<v?b:v,O=S<E?S<D?S:D:E<D?E:D,F=f>b?f>v?f:v:b>v?b:v,V=S>E?S>D?S:D:E>D?E:D,U=u.next;U!==o;){if(U.x>=k&&U.x<=F&&U.y>=O&&U.y<=V&&bc(f,S,b,E,v,D,U.x,U.y)&&vo(U.prev,U,U.next)>=0)return!1;U=U.next}return!0}function N_(a,o,l,u){var f=a.prev,b=a,v=a.next;if(vo(f,b,v)>=0)return!1;for(var S=f.x,E=b.x,D=v.x,k=f.y,O=b.y,F=v.y,V=S<E?S<D?S:D:E<D?E:D,U=k<O?k<F?k:F:O<F?O:F,G=S>E?S>D?S:D:E>D?E:D,J=k>O?k>F?k:F:O>F?O:F,ue=Pf(V,U,o,l,u),we=Pf(G,J,o,l,u),de=a.prevZ,ve=a.nextZ;de&&de.z>=ue&&ve&&ve.z<=we;){if(de.x>=V&&de.x<=G&&de.y>=U&&de.y<=J&&de!==f&&de!==v&&bc(S,k,E,O,D,F,de.x,de.y)&&vo(de.prev,de,de.next)>=0||(de=de.prevZ,ve.x>=V&&ve.x<=G&&ve.y>=U&&ve.y<=J&&ve!==f&&ve!==v&&bc(S,k,E,O,D,F,ve.x,ve.y)&&vo(ve.prev,ve,ve.next)>=0))return!1;ve=ve.nextZ}for(;de&&de.z>=ue;){if(de.x>=V&&de.x<=G&&de.y>=U&&de.y<=J&&de!==f&&de!==v&&bc(S,k,E,O,D,F,de.x,de.y)&&vo(de.prev,de,de.next)>=0)return!1;de=de.prevZ}for(;ve&&ve.z<=we;){if(ve.x>=V&&ve.x<=G&&ve.y>=U&&ve.y<=J&&ve!==f&&ve!==v&&bc(S,k,E,O,D,F,ve.x,ve.y)&&vo(ve.prev,ve,ve.next)>=0)return!1;ve=ve.nextZ}return!0}function m0(a,o,l){var u=a;do{var f=u.prev,b=u.next.next;!Tg(f,b)&&b0(f,u,u.next,b)&&Hu(f,b)&&Hu(b,f)&&(o.push(f.i/l|0),o.push(u.i/l|0),o.push(b.i/l|0),Lf(u),Lf(u.next),u=a=b),u=u.next}while(u!==a);return Uu(u)}function Sg(a,o,l,u,f,b){var v=a;do{for(var S=v.next.next;S!==v.prev;){if(v.i!==S.i&&r1(v,S)){var E=Eg(v,S);return v=Uu(v,v.next),E=Uu(E,E.next),np(v,o,l,u,f,b,0),void np(E,o,l,u,f,b,0)}S=S.next}v=v.next}while(v!==a)}function Cg(a,o){return a.x-o.x}function g0(a,o){var l=function(f,b){var v,S=b,E=f.x,D=f.y,k=-1/0;do{if(D<=S.y&&D>=S.next.y&&S.next.y!==S.y){var O=S.x+(D-S.y)*(S.next.x-S.x)/(S.next.y-S.y);if(O<=E&&O>k&&(k=O,v=S.x<S.next.x?S:S.next,O===E))return v}S=S.next}while(S!==b);if(!v)return null;var F,V=v,U=v.x,G=v.y,J=1/0;S=v;do{E>=S.x&&S.x>=U&&E!==S.x&&bc(D<G?E:k,D,U,G,D<G?k:E,D,S.x,S.y)&&(F=Math.abs(D-S.y)/(E-S.x),Hu(S,f)&&(F<J||F===J&&(S.x>v.x||S.x===v.x&&B_(v,S)))&&(v=S,J=F)),S=S.next}while(S!==V);return v}(a,o);if(!l)return o;var u=Eg(l,a);return Uu(u,u.next),Uu(l,l.next)}function B_(a,o){return vo(a.prev,a,o.prev)<0&&vo(o.next,a,a.next)<0}function Pf(a,o,l,u,f){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-l)*f|0)|a<<8))|a<<4))|a<<2))|a<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-u)*f|0)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function z_(a){var o=a,l=a;do{(o.x<l.x||o.x===l.x&&o.y<l.y)&&(l=o),o=o.next}while(o!==a);return l}function bc(a,o,l,u,f,b,v,S){return(f-v)*(o-S)>=(a-v)*(b-S)&&(a-v)*(u-S)>=(l-v)*(o-S)&&(l-v)*(b-S)>=(f-v)*(u-S)}function r1(a,o){return a.next.i!==o.i&&a.prev.i!==o.i&&!function(l,u){var f=l;do{if(f.i!==l.i&&f.next.i!==l.i&&f.i!==u.i&&f.next.i!==u.i&&b0(f,f.next,l,u))return!0;f=f.next}while(f!==l);return!1}(a,o)&&(Hu(a,o)&&Hu(o,a)&&function(l,u){var f=l,b=!1,v=(l.x+u.x)/2,S=(l.y+u.y)/2;do{f.y>S!=f.next.y>S&&f.next.y!==f.y&&v<(f.next.x-f.x)*(S-f.y)/(f.next.y-f.y)+f.x&&(b=!b),f=f.next}while(f!==l);return b}(a,o)&&(vo(a.prev,a,o.prev)||vo(a,o.prev,o))||Tg(a,o)&&vo(a.prev,a,a.next)>0&&vo(o.prev,o,o.next)>0)}function vo(a,o,l){return(o.y-a.y)*(l.x-o.x)-(o.x-a.x)*(l.y-o.y)}function Tg(a,o){return a.x===o.x&&a.y===o.y}function b0(a,o,l,u){var f=ip(vo(a,o,l)),b=ip(vo(a,o,u)),v=ip(vo(l,u,a)),S=ip(vo(l,u,o));return f!==b&&v!==S||!(0!==f||!Of(a,l,o))||!(0!==b||!Of(a,u,o))||!(0!==v||!Of(l,a,u))||!(0!==S||!Of(l,o,u))}function Of(a,o,l){return o.x<=Math.max(a.x,l.x)&&o.x>=Math.min(a.x,l.x)&&o.y<=Math.max(a.y,l.y)&&o.y>=Math.min(a.y,l.y)}function ip(a){return a>0?1:a<0?-1:0}function Hu(a,o){return vo(a.prev,a,a.next)<0?vo(a,o,a.next)>=0&&vo(a,a.prev,o)>=0:vo(a,o,a.prev)<0||vo(a,a.next,o)<0}function Eg(a,o){var l=new V_(a.i,a.x,a.y),u=new V_(o.i,o.x,o.y),f=a.next,b=o.prev;return a.next=o,o.prev=a,l.next=f,f.prev=l,u.next=l,l.prev=u,b.next=u,u.prev=b,u}function $u(a,o,l,u){var f=new V_(a,o,l);return u?(f.next=u.next,f.prev=u,u.next.prev=f,u.next=f):(f.prev=f,f.next=f),f}function Lf(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function V_(a,o,l){this.i=a,this.x=o,this.y=l,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function _0(a,o,l,u){for(var f=0,b=o,v=l-u;b<l;b+=u)f+=(a[v]-a[b])*(a[b+1]+a[v+1]),v=b;return f}h0.exports=Zd,h0.exports.default=Zd,Zd.deviation=function(a,o,l,u){var f=o&&o.length,b=Math.abs(_0(a,0,f?o[0]*l:a.length,l));if(f)for(var v=0,S=o.length;v<S;v++)b-=Math.abs(_0(a,o[v]*l,v<S-1?o[v+1]*l:a.length,l));var E=0;for(v=0;v<u.length;v+=3){var D=u[v]*l,k=u[v+1]*l,O=u[v+2]*l;E+=Math.abs((a[D]-a[O])*(a[k+1]-a[D+1])-(a[D]-a[k])*(a[O+1]-a[D+1]))}return 0===b&&0===E?0:Math.abs((E-b)/b)},Zd.flatten=function(a){for(var o=a[0][0].length,l={vertices:[],holes:[],dimensions:o},u=0,f=0;f<a.length;f++){for(var b=0;b<a[f].length;b++)for(var v=0;v<o;v++)l.vertices.push(a[f][b][v]);f>0&&l.holes.push(u+=a[f-1].length)}return l};var j_=He(h0.exports);function U_(a,o,l,u,f){y0(a,o,l||0,u||a.length-1,f||Dg)}function y0(a,o,l,u,f){for(;u>l;){if(u-l>600){var b=u-l+1,v=o-l+1,S=Math.log(b),E=.5*Math.exp(2*S/3),D=.5*Math.sqrt(S*E*(b-E)/b)*(v-b/2<0?-1:1);y0(a,o,Math.max(l,Math.floor(o-v*E/b+D)),Math.min(u,Math.floor(o+(b-v)*E/b+D)),f)}var k=a[o],O=l,F=u;for(rp(a,l,o),f(a[u],k)>0&&rp(a,l,u);O<F;){for(rp(a,O,F),O++,F--;f(a[O],k)<0;)O++;for(;f(a[F],k)>0;)F--}0===f(a[l],k)?rp(a,l,F):rp(a,++F,u),F<=o&&(l=F+1),o<=F&&(u=F-1)}}function rp(a,o,l){var u=a[o];a[o]=a[l],a[l]=u}function Dg(a,o){return a<o?-1:a>o?1:0}function Ff(a,o){const l=a.length;if(l<=1)return[a];const u=[];let f,b;for(let v=0;v<l;v++){const S=zi(a[v]);0!==S&&(a[v].area=Math.abs(S),void 0===b&&(b=S<0),b===S<0?(f&&u.push(f),f=[a[v]]):f.push(a[v]))}if(f&&u.push(f),o>1)for(let v=0;v<u.length;v++)u[v].length<=o||(U_(u[v],o,1,u[v].length-1,v0),u[v]=u[v].slice(0,o));return u}function v0(a,o){return o.area-a.area}function Ig(a,o,l){const u=l.patternDependencies;let f=!1;for(const b of o){const v=b.paint.get(`${a}-pattern`);v.isConstant()||(f=!0);const S=v.constantOr(null);S&&(f=!0,u[S]=!0)}return f}function Mg(a,o,l,u,f){const b=f.patternDependencies;for(const v of o){const S=v.paint.get(`${a}-pattern`).value;if("constant"!==S.kind){let E=S.evaluate({zoom:u},l,{},f.availableImages);E=E&&E.name?E.name:E,b[E]=!0,l.patterns[v.id]=E}}return l}class _c{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.id),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new zt,this.indexArray=new Vn,this.indexArray2=new _o,this.programConfigurations=new Kh(o.layers,o.zoom),this.segments=new to,this.segments2=new to,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.projection=o.projection}populate(o,l,u,f){this.hasPattern=Ig("fill",this.layers,l);const b=this.layers[0].layout.get("fill-sort-key"),v=[];for(const{feature:S,id:E,index:D,sourceLayerIndex:k}of o){const O=this.layers[0]._featureFilter.needGeometry,F=zu(S,O);if(!this.layers[0]._featureFilter.filter(new P(this.zoom),F,u))continue;const V=b?b.evaluate(F,{},u,l.availableImages):void 0,U={id:E,properties:S.properties,type:S.type,sourceLayerIndex:k,index:D,geometry:O?F.geometry:Qc(S,u,f),patterns:{},sortKey:V};v.push(U)}b&&v.sort((S,E)=>S.sortKey-E.sortKey);for(const S of v){const{geometry:E,index:D,sourceLayerIndex:k}=S;if(this.hasPattern){const O=Mg("fill",this.layers,S,this.zoom,l);this.patternFeatures.push(O)}else this.addFeature(S,E,D,u,{},l.availableImages);l.featureIndex.insert(o[D].feature,E,D,k,this.index)}}update(o,l,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,l,this.stateDependentLayers,u,f)}addFeatures(o,l,u,f,b){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,l,u,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,n1),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.indexBuffer2=o.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(o,l,u,f,b,v=[]){for(const S of Ff(l,500)){let E=0;for(const U of S)E+=U.length;const D=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray),k=D.vertexLength,O=[],F=[];for(const U of S){if(0===U.length)continue;U!==S[0]&&F.push(O.length/2);const G=this.segments2.prepareSegment(U.length,this.layoutVertexArray,this.indexArray2),J=G.vertexLength;this.layoutVertexArray.emplaceBack(U[0].x,U[0].y),this.indexArray2.emplaceBack(J+U.length-1,J),O.push(U[0].x),O.push(U[0].y);for(let ue=1;ue<U.length;ue++)this.layoutVertexArray.emplaceBack(U[ue].x,U[ue].y),this.indexArray2.emplaceBack(J+ue-1,J+ue),O.push(U[ue].x),O.push(U[ue].y);G.vertexLength+=U.length,G.primitiveLength+=U.length}const V=j_(O,F);for(let U=0;U<V.length;U+=3)this.indexArray.emplaceBack(k+V[U],k+V[U+1],k+V[U+2]);D.vertexLength+=E,D.primitiveLength+=V.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,u,b,v,f)}}Mn(_c,"FillBucket",{omit:["layers","patternFeatures"]});const o1=new be({"fill-sort-key":new ie(_t.layout_fill["fill-sort-key"])});var s1={paint:new be({"fill-antialias":new q(_t.paint_fill["fill-antialias"]),"fill-opacity":new ie(_t.paint_fill["fill-opacity"]),"fill-color":new ie(_t.paint_fill["fill-color"]),"fill-outline-color":new ie(_t.paint_fill["fill-outline-color"]),"fill-translate":new q(_t.paint_fill["fill-translate"]),"fill-translate-anchor":new q(_t.paint_fill["fill-translate-anchor"]),"fill-pattern":new ie(_t.paint_fill["fill-pattern"])}),layout:o1};const a1=We([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),l1=We([{name:"a_centroid_pos",components:2,type:"Uint16"}]),c1=We([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Za}=a1;var Ya={},u1=Ie,x0=op;function op(a,o,l,u,f){this.properties={},this.extent=l,this.type=0,this._pbf=a,this._geometry=-1,this._keys=u,this._values=f,a.readFields(d1,this,o)}function d1(a,o,l){1==a?o.id=l.readVarint():2==a?function(u,f){for(var b=u.readVarint()+u.pos;u.pos<b;){var v=f._keys[u.readVarint()],S=f._values[u.readVarint()];f.properties[v]=S}}(l,o):3==a?o.type=l.readVarint():4==a&&(o._geometry=l.pos)}function h1(a){for(var o,l,u=0,f=0,b=a.length,v=b-1;f<b;v=f++)u+=((l=a[v]).x-(o=a[f]).x)*(o.y+l.y);return u}op.types=["Unknown","Point","LineString","Polygon"],op.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var o,l=a.readVarint()+a.pos,u=1,f=0,b=0,v=0,S=[];a.pos<l;){if(f<=0){var E=a.readVarint();u=7&E,f=E>>3}if(f--,1===u||2===u)b+=a.readSVarint(),v+=a.readSVarint(),1===u&&(o&&S.push(o),o=[]),o.push(new u1(b,v));else{if(7!==u)throw new Error("unknown command "+u);o&&o.push(o[0].clone())}}return o&&S.push(o),S},op.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var o=a.readVarint()+a.pos,l=1,u=0,f=0,b=0,v=1/0,S=-1/0,E=1/0,D=-1/0;a.pos<o;){if(u<=0){var k=a.readVarint();l=7&k,u=k>>3}if(u--,1===l||2===l)(f+=a.readSVarint())<v&&(v=f),f>S&&(S=f),(b+=a.readSVarint())<E&&(E=b),b>D&&(D=b);else if(7!==l)throw new Error("unknown command "+l)}return[v,E,S,D]},op.prototype.toGeoJSON=function(a,o,l){var u,f,b=this.extent*Math.pow(2,l),v=this.extent*a,S=this.extent*o,E=this.loadGeometry(),D=op.types[this.type];function k(V){for(var U=0;U<V.length;U++){var G=V[U];V[U]=[360*(G.x+v)/b-180,360/Math.PI*Math.atan(Math.exp((180-360*(G.y+S)/b)*Math.PI/180))-90]}}switch(this.type){case 1:var O=[];for(u=0;u<E.length;u++)O[u]=E[u][0];k(E=O);break;case 2:for(u=0;u<E.length;u++)k(E[u]);break;case 3:for(E=function(V){var U=V.length;if(U<=1)return[V];for(var G,J,ue=[],we=0;we<U;we++){var de=h1(V[we]);0!==de&&(void 0===J&&(J=de<0),J===de<0?(G&&ue.push(G),G=[V[we]]):G.push(V[we]))}return G&&ue.push(G),ue}(E),u=0;u<E.length;u++)for(f=0;f<E[u].length;f++)k(E[u][f])}1===E.length?E=E[0]:D="Multi"+D;var F={type:"Feature",geometry:{type:D,coordinates:E},properties:this.properties};return"id"in this&&(F.id=this.id),F};var p1=x0,H_=w0;function w0(a,o){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(f1,this,o),this.length=this._features.length}function f1(a,o,l){15===a?o.version=l.readVarint():1===a?o.name=l.readString():5===a?o.extent=l.readVarint():2===a?o._features.push(l.pos):3===a?o._keys.push(l.readString()):4===a&&o._values.push(function(u){for(var f=null,b=u.readVarint()+u.pos;u.pos<b;){var v=u.readVarint()>>3;f=1===v?u.readString():2===v?u.readFloat():3===v?u.readDouble():4===v?u.readVarint64():5===v?u.readVarint():6===v?u.readSVarint():7===v?u.readBoolean():null}return f}(l))}w0.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var o=this._pbf.readVarint()+this._pbf.pos;return new p1(this._pbf,o,this.extent,this._keys,this._values)};var m1=H_;function g1(a,o,l){if(3===a){var u=new m1(l,l.readVarint()+l.pos);u.length&&(o[u.name]=u)}}var sp=Ya.VectorTile=function(a,o){this.layers=a.readFields(g1,{},o)},vl=Ya.VectorTileFeature=x0;function qu(a,o,l,u){const f=[],b=0===u?(v,S,E,D,k,O)=>{v.push(new ge(O,E+(O-S)/(D-S)*(k-E)))}:(v,S,E,D,k,O)=>{v.push(new ge(S+(O-E)/(k-E)*(D-S),O))};for(const v of a){const S=[];for(const E of v){if(E.length<=2)continue;const D=[];for(let F=0;F<E.length-1;F++){const V=E[F].x,U=E[F].y,G=E[F+1].x,J=E[F+1].y,ue=0===u?V:U,we=0===u?G:J;ue<o?we>o&&b(D,V,U,G,J,o):ue>l?we<l&&b(D,V,U,G,J,l):D.push(E[F]),we<o&&ue>=o&&b(D,V,U,G,J,o),we>l&&ue<=l&&b(D,V,U,G,J,l)}let k=E[E.length-1];const O=0===u?k.x:k.y;O>=o&&O<=l&&D.push(k),D.length&&(k=D[D.length-1],D[0].x===k.x&&D[0].y===k.y||D.push(D[0]),S.push(D))}S.length&&f.push(S)}return f}Ya.VectorTileLayer=H_;const S0=vl.types,C0=Math.pow(2,13);function ap(a,o,l,u,f,b,v,S){a.emplaceBack((o<<1)+v,(l<<1)+b,(Math.floor(u*C0)<<1)+f,Math.round(S))}function Ag(a,o,l){a.emplaceBack(o.x,o.y,o.z,16384*l[0],16384*l[1],16384*l[2])}class b1{constructor(){this.acc=new ge(0,0),this.polyCount=[]}startRing(o){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new ge(o.x,o.y),this.max=new ge(o.x,o.y))}append(o,l){this.currentPolyCount.edges++,this.acc._add(o);const u=this.min,f=this.max;o.x<u.x?u.x=o.x:o.x>f.x&&(f.x=o.x),o.y<u.y?u.y=o.y:o.y>f.y&&(f.y=o.y),((0===o.x||o.x===Wn)&&o.x===l.x)!=((0===o.y||o.y===Wn)&&o.y===l.y)&&this.processBorderOverlap(o,l),l.x<0!=o.x<0&&this.addBorderIntersection(0,qi(l.y,o.y,(0-l.x)/(o.x-l.x))),l.x>Wn!=o.x>Wn&&this.addBorderIntersection(1,qi(l.y,o.y,(Wn-l.x)/(o.x-l.x))),l.y<0!=o.y<0&&this.addBorderIntersection(2,qi(l.x,o.x,(0-l.y)/(o.y-l.y))),l.y>Wn!=o.y>Wn&&this.addBorderIntersection(3,qi(l.x,o.x,(Wn-l.y)/(o.y-l.y)))}addBorderIntersection(o,l){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const u=this.borders[o];l<u[0]&&(u[0]=l),l>u[1]&&(u[1]=l)}processBorderOverlap(o,l){if(o.x===l.x){if(o.y===l.y)return;const u=0===o.x?0:1;this.addBorderIntersection(u,l.y),this.addBorderIntersection(u,o.y)}else{const u=0===o.y?2:3;this.addBorderIntersection(u,l.x),this.addBorderIntersection(u,o.x)}}centroid(){const o=this.polyCount.reduce((l,u)=>l+u.edges,0);return 0!==o?this.acc.div(o)._round():new ge(0,0)}span(){return new ge(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((o,l)=>o+ +(l[0]!==Number.MAX_VALUE),0)}}class kg{constructor(o){this.zoom=o.zoom,this.canonical=o.canonical,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.id),this.index=o.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=o.projection,this.layoutVertexArray=new Tt,this.centroidVertexArray=new Bl,this.indexArray=new Vn,this.programConfigurations=new Kh(o.layers,o.zoom),this.segments=new to,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.enableTerrain=o.enableTerrain}populate(o,l,u,f){this.features=[],this.hasPattern=Ig("fill-extrusion",this.layers,l),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(b){const v=Math.exp(Math.PI*(1-b.y/(1<<b.z)*2));return 80150034*v/(v*v+1)/Wn/(1<<b.z)}(u),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:b,id:v,index:S,sourceLayerIndex:E}of o){const D=this.layers[0]._featureFilter.needGeometry,k=zu(b,D);if(!this.layers[0]._featureFilter.filter(new P(this.zoom),k,u))continue;const O={id:v,sourceLayerIndex:E,index:S,geometry:D?k.geometry:Qc(b,u,f),properties:b.properties,type:b.type,patterns:{}},F=this.layoutVertexArray.length;this.hasPattern?this.features.push(Mg("fill-extrusion",this.layers,O,this.zoom,l)):this.addFeature(O,O.geometry,S,u,{},l.availableImages,f),l.featureIndex.insert(b,O.geometry,S,E,this.index,F)}this.sortBorders()}addFeatures(o,l,u,f,b){for(const v of this.features){const{geometry:S}=v;this.addFeature(v,S,v.index,l,u,f,b)}this.sortBorders()}update(o,l,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,l,this.stateDependentLayers,u,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Za),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=o.createVertexBuffer(this.layoutVertexExtArray,c1.members,!0))),this.programConfigurations.upload(o),this.uploaded=!0}uploadCentroid(o){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=o.createVertexBuffer(this.centroidVertexArray,l1.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(o,l,u,f,b,v,S){const E=[new ge(0,0),new ge(Wn,Wn)],D=S.projection,k="globe"===D.name,O=this.enableTerrain&&!k?new b1:null,F="Polygon"===S0[o.type];k&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Ut);const V=Ff(l,500);for(let ue=V.length-1;ue>=0;ue--){const we=V[ue];(0===we.length||(U=we[0]).every(de=>de.x<=0)||U.every(de=>de.x>=Wn)||U.every(de=>de.y<=0)||U.every(de=>de.y>=Wn))&&V.splice(ue,1)}var U;let G;if(k)G=D0(V,E,f);else{G=[];for(const ue of V)G.push({polygon:ue,bounds:E})}const J=F?this.edgeRadius:0;for(const{polygon:ue,bounds:we}of G){let de=0,ve=0;for(const ke of ue)F&&!ke[0].equals(ke[ke.length-1])&&ke.push(ke[0]),ve+=F?ke.length-1:ke.length;const Ae=this.segments.prepareSegment((F?5:4)*ve,this.layoutVertexArray,this.indexArray);if(F){const ke=[],ct=[];de=Ae.vertexLength;for(const yt of ue){let Ht,dt;yt.length&&yt!==ue[0]&&ct.push(ke.length/2),Ht=yt[1].sub(yt[0])._perp()._unit();for(let It=1;It<yt.length;It++){const Et=yt[It],Lt=yt[It===yt.length-1?1:It+1];let{x:Zt,y:mt}=Et;if(J){dt=Lt.sub(Et)._perp()._unit();const an=Ht.add(dt)._unit(),En=J*Math.min(4,1/(Ht.x*an.x+Ht.y*an.y));Zt+=En*an.x,mt+=En*an.y,Ht=dt}ap(this.layoutVertexArray,Zt,mt,0,0,1,1,0),Ae.vertexLength++,ke.push(Et.x,Et.y),k&&Ag(this.layoutVertexExtArray,D.projectTilePoint(Zt,mt,f),D.upVector(f,Zt,mt))}}const st=j_(ke,ct);for(let yt=0;yt<st.length;yt+=3)this.indexArray.emplaceBack(de+st[yt],de+st[yt+2],de+st[yt+1]),Ae.primitiveLength++}for(const ke of ue){O&&ke.length&&O.startRing(ke[0]);let ct,st,yt,Ht=ke.length>4&&q_(ke[ke.length-2],ke[0],ke[1]),dt=J?$_(ke[ke.length-2],ke[0],ke[1],J):0;st=ke[1].sub(ke[0])._perp()._unit();let It=!0;for(let Et=1,Lt=0;Et<ke.length;Et++){let Zt=ke[Et-1],mt=ke[Et];const an=ke[Et===ke.length-1?1:Et+1];if(O&&F&&O.currentPolyCount.top++,y1(mt,Zt,we)){J&&(st=an.sub(mt)._perp()._unit(),It=!It);continue}O&&O.append(mt,Zt);const En=mt.sub(Zt)._perp(),gn=En.x/(Math.abs(En.x)+Math.abs(En.y)),fi=En.y>0?1:0,Qt=Zt.dist(mt);if(Lt+Qt>32768&&(Lt=0),J){yt=an.sub(mt)._perp()._unit();let yi=_1(Zt,mt,an,Rg(st,yt),J);isNaN(yi)&&(yi=0);const Qn=mt.sub(Zt)._unit();Zt=Zt.add(Qn.mult(dt))._round(),mt=mt.add(Qn.mult(-yi))._round(),dt=yi,st=yt}const $n=Ae.vertexLength,_i=ke.length>4&&q_(Zt,mt,an);let Ki=T0(Lt,Ht,It);if(ap(this.layoutVertexArray,Zt.x,Zt.y,gn,fi,0,0,Ki),ap(this.layoutVertexArray,Zt.x,Zt.y,gn,fi,0,1,Ki),Lt+=Qt,Ki=T0(Lt,_i,!It),Ht=_i,ap(this.layoutVertexArray,mt.x,mt.y,gn,fi,0,0,Ki),ap(this.layoutVertexArray,mt.x,mt.y,gn,fi,0,1,Ki),Ae.vertexLength+=4,this.indexArray.emplaceBack($n+0,$n+1,$n+2),this.indexArray.emplaceBack($n+1,$n+3,$n+2),Ae.primitiveLength+=2,J){const yi=de+(1===Et?ke.length-2:Et-2),Qn=1===Et?de:yi+1;if(this.indexArray.emplaceBack($n+1,yi,$n+3),this.indexArray.emplaceBack(yi,Qn,$n+3),Ae.primitiveLength+=2,void 0===ct&&(ct=$n),!y1(an,ke[Et],we)){const er=Et===ke.length-1?ct:Ae.vertexLength;this.indexArray.emplaceBack($n+2,$n+3,er),this.indexArray.emplaceBack($n+3,er+1,er),this.indexArray.emplaceBack($n+3,Qn,er+1),Ae.primitiveLength+=3}It=!It}if(k){const yi=this.layoutVertexExtArray,Qn=D.projectTilePoint(Zt.x,Zt.y,f),er=D.projectTilePoint(mt.x,mt.y,f),mi=D.upVector(f,Zt.x,Zt.y),gi=D.upVector(f,mt.x,mt.y);Ag(yi,Qn,mi),Ag(yi,Qn,mi),Ag(yi,er,gi),Ag(yi,er,gi)}}F&&(de+=ke.length-1)}}if(O&&O.polyCount.length>0){if(O.borders){O.vertexArrayOffset=this.centroidVertexArray.length;const ue=O.borders,we=this.featuresOnBorder.push(O)-1;for(let de=0;de<4;de++)ue[de][0]!==Number.MAX_VALUE&&this.borders[de].push(we)}this.encodeCentroid(O.borders?void 0:O.centroid(),O)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,u,b,v,f)}sortBorders(){for(let o=0;o<4;o++)this.borders[o].sort((l,u)=>this.featuresOnBorder[l].borders[o][0]-this.featuresOnBorder[u].borders[o][0])}encodeCentroid(o,l,u=!0){let f,b;if(o)if(0!==o.y){const S=l.span()._mult(this.tileToMeter);f=(Math.max(o.x,1)<<3)+Math.min(7,Math.round(S.x/10)),b=(Math.max(o.y,1)<<3)+Math.min(7,Math.round(S.y/10))}else f=Math.ceil(7*(o.x+450)),b=0;else f=0,b=+u;let v=u?this.centroidVertexArray.length:l.vertexArrayOffset;for(const S of l.polyCount){u&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*S.edges+S.top);for(let E=0;E<S.top;E++)this.centroidVertexArray.emplace(v++,f,b);for(let E=0;E<2*S.edges;E++)this.centroidVertexArray.emplace(v++,0,b),this.centroidVertexArray.emplace(v++,f,b)}}}function Rg(a,o){const l=a.add(o)._unit();return a.x*l.x+a.y*l.y}function $_(a,o,l,u){const f=o.sub(a)._perp()._unit(),b=l.sub(o)._perp()._unit();return _1(a,o,l,Rg(f,b),u)}function _1(a,o,l,u,f){const b=Math.sqrt(1-u*u);return Math.min(a.dist(o)/3,o.dist(l)/3,f*b/u)}function y1(a,o,l){return a.x<l[0].x&&o.x<l[0].x||a.x>l[1].x&&o.x>l[1].x||a.y<l[0].y&&o.y<l[0].y||a.y>l[1].y&&o.y>l[1].y}function q_(a,o,l){if(a.x<0||a.x>=Wn||o.x<0||o.x>=Wn||l.x<0||l.x>=Wn)return!1;const u=l.sub(o),f=u.perp(),b=a.sub(o);return(u.x*b.x+u.y*b.y)/Math.sqrt((u.x*u.x+u.y*u.y)*(b.x*b.x+b.y*b.y))>-.866&&f.x*b.x+f.y*b.y<0}function T0(a,o,l){const u=o?2|a:-3&a;return l?1|u:-2&u}function E0(){const a=Math.PI/32,o=Math.tan(a),l=Af;return l*Math.sqrt(1+2*o*o)-l}function D0(a,o,l){const u=1<<l.z,f=Xa(l.x/u),b=Xa((l.x+1)/u),v=Mr(l.y/u),S=Mr((l.y+1)/u);return function(E,D,k,O,F=0,V){const U=[];if(!E.length||!k||!O)return U;const G=(ke,ct)=>{for(const st of ke)U.push({polygon:st,bounds:ct})},J=Math.ceil(Math.log2(k)),ue=Math.ceil(Math.log2(O)),we=J-ue,de=[];for(let ke=0;ke<Math.abs(we);ke++)de.push(we>0?0:1);for(let ke=0;ke<Math.min(J,ue);ke++)de.push(0),de.push(1);let ve=E;if(ve=qu(ve,D[0].y-F,D[1].y+F,1),ve=qu(ve,D[0].x-F,D[1].x+F,0),!ve.length)return U;const Ae=[];for(de.length?Ae.push({polygons:ve,bounds:D,depth:0}):G(ve,D);Ae.length;){const ke=Ae.pop(),ct=ke.depth,st=de[ct],yt=ke.bounds[0],Ht=ke.bounds[1],dt=0===st?yt.x:yt.y,It=0===st?Ht.x:Ht.y,Et=V?V(st,dt,It):.5*(dt+It),Lt=qu(ke.polygons,dt-F,Et+F,st),Zt=qu(ke.polygons,Et-F,It+F,st);if(Lt.length){const mt=[yt,new ge(0===st?Et:Ht.x,1===st?Et:Ht.y)];de.length>ct+1?Ae.push({polygons:Lt,bounds:mt,depth:ct+1}):G(Lt,mt)}if(Zt.length){const mt=[new ge(0===st?Et:yt.x,1===st?Et:yt.y),Ht];de.length>ct+1?Ae.push({polygons:Zt,bounds:mt,depth:ct+1}):G(Zt,mt)}}return U}(a,o,Math.ceil((b-f)/11.25),Math.ceil((v-S)/11.25),1,(E,D,k)=>{if(0===E)return.5*(D+k);{const O=Mr((l.y+D/Wn)/u);return(Ul(.5*(Mr((l.y+k/Wn)/u)+O))*u-l.y)*Wn}})}Mn(kg,"FillExtrusionBucket",{omit:["layers","features"]}),Mn(b1,"PartMetadata");const v1=new be({"fill-extrusion-edge-radius":new q(_t["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var I0={paint:new be({"fill-extrusion-opacity":new q(_t["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ie(_t["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new q(_t["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new q(_t["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ie(_t["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ie(_t["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ie(_t["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new q(_t["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new q(_t["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new q(_t["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new q(_t["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:v1};function Nf(a,o,l){var u=2*Math.PI*6378137/256/Math.pow(2,l);return[a*u-2*Math.PI*6378137/2,o*u-2*Math.PI*6378137/2]}class Bf{constructor(o,l,u){this.z=o,this.x=l,this.y=u,this.key=fr(0,o,o,l,u)}equals(o){return this.z===o.z&&this.x===o.x&&this.y===o.y}url(o,l){const u=(v=this.y,S=this.z,E=Nf(256*(b=this.x),256*(v=Math.pow(2,S)-v-1),S),D=Nf(256*(b+1),256*(v+1),S),E[0]+","+E[1]+","+D[0]+","+D[1]),f=function(b,v,S){let E,D="";for(let k=b;k>0;k--)E=1<<k-1,D+=(v&E?1:0)+(S&E?2:0);return D}(this.z,this.x,this.y);var b,v,S,E,D;return o[(this.x+this.y)%o.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===l?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",f).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Pg{constructor(o,l){this.wrap=o,this.canonical=l,this.key=fr(o,l.z,l.z,l.x,l.y)}}class ta{constructor(o,l,u,f,b){this.overscaledZ=o,this.wrap=l,this.canonical=new Bf(u,+f,+b),this.key=0===l&&o===u?this.canonical.key:fr(l,o,u,f,b)}equals(o){return this.overscaledZ===o.overscaledZ&&this.wrap===o.wrap&&this.canonical.equals(o.canonical)}scaledTo(o){const l=this.canonical.z-o;return o>this.canonical.z?new ta(o,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ta(o,this.wrap,o,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(o,l=!0){if(this.overscaledZ===o&&l)return this.key;if(o>this.canonical.z)return fr(this.wrap*+l,o,this.canonical.z,this.canonical.x,this.canonical.y);{const u=this.canonical.z-o;return fr(this.wrap*+l,o,o,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(o){if(o.wrap!==this.wrap)return!1;const l=this.canonical.z-o.canonical.z;return 0===o.overscaledZ||o.overscaledZ<this.overscaledZ&&o.canonical.x===this.canonical.x>>l&&o.canonical.y===this.canonical.y>>l}children(o){if(this.overscaledZ>=o)return[new ta(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,u=2*this.canonical.x,f=2*this.canonical.y;return[new ta(l,this.wrap,l,u,f),new ta(l,this.wrap,l,u+1,f),new ta(l,this.wrap,l,u,f+1),new ta(l,this.wrap,l,u+1,f+1)]}isLessThan(o){return this.wrap<o.wrap||!(this.wrap>o.wrap)&&(this.overscaledZ<o.overscaledZ||!(this.overscaledZ>o.overscaledZ)&&(this.canonical.x<o.canonical.x||!(this.canonical.x>o.canonical.x)&&this.canonical.y<o.canonical.y))}wrapped(){return new ta(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(o){return new ta(this.overscaledZ,o,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Pg(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function fr(a,o,l,u,f){const b=1<<Math.min(l,22);let v=b*(f%b)+u%b;return a&&l<22&&(v+=b*b*((a<0?-2*a-1:2*a)%(1<<2*(22-l)))),16*(32*v+l)+(o-l)}Mn(Bf,"CanonicalTileID"),Mn(ta,"OverscaledTileID",{omit:["projMatrix"]});class lp extends ge{constructor(o,l,u){super(o,l),this.z=u}}function zf(a,o){return a.x*o.x+a.y*o.y}function yc(a,o){if(1===a.length){let l=0;const u=o[l++];let f;for(;!f||u.equals(f);)if(f=o[l++],!f)return 1/0;for(;l<o.length;l++){const b=o[l],v=a[0],S=f.sub(u),E=b.sub(u),D=v.sub(u),k=zf(S,S),O=zf(S,E),F=zf(E,E),V=zf(D,S),U=zf(D,E),G=k*F-O*O,J=(F*V-O*U)/G,ue=(k*U-O*V)/G,we=u.z*(1-J-ue)+f.z*J+b.z*ue;if(isFinite(we))return we}return 1/0}{let l=1/0;for(const u of o)l=Math.min(l,u.z);return l}}function G_(a,o,l,u,f,b,v,S){const E=v*f.getElevationAt(a,o,!0,!0),D=0!==b[0],k=D?0===b[1]?v*(b[0]/7-450):v*function(O,F,V){const U=Math.floor(F[0]/8),G=Math.floor(F[1]/8),J=10*(F[0]-8*U),ue=10*(F[1]-8*G),we=O.getElevationAt(U,G,!0,!0),de=O.getMeterToDEM(V),ve=Math.floor(.5*(J*de-1)),Ae=Math.floor(.5*(ue*de-1)),ke=O.tileCoordToPixel(U,G),ct=2*ve+1,st=2*Ae+1,yt=(En=ct,gn=st,[(Zt=O).getElevationAtPixel(mt=ke.x-ve,an=ke.y-Ae,!0),Zt.getElevationAtPixel(mt+gn,an,!0),Zt.getElevationAtPixel(mt,an+gn,!0),Zt.getElevationAtPixel(mt+En,an+gn,!0)]),Ht=Math.abs(yt[0]-yt[1]),dt=Math.abs(yt[2]-yt[3]),It=Math.abs(yt[0]-yt[2])+Math.abs(yt[1]-yt[3]),Et=Math.min(.25,.5*de*(Ht+dt)/ct),Lt=Math.min(.25,.5*de*It/st);var Zt,mt,an,En,gn;return we+Math.max(Et*J,Lt*ue)}(f,b,S):E;return{base:E+(0===l)?-1:l,top:D?Math.max(k+u,E+l+2):E+u}}const x1=We([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:w1}=x1,S1=We([{name:"a_packed",components:4,type:"Float32"}]),{members:C1}=S1,T1=vl.types,wI=Math.cos(Math.PI/180*37.5);class W_{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.id),this.index=o.index,this.projection=o.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new ht,this.layoutVertexArray2=new Vt,this.indexArray=new Vn,this.programConfigurations=new Kh(o.layers,o.zoom),this.segments=new to,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(o,l,u,f){this.hasPattern=Ig("line",this.layers,l);const b=this.layers[0].layout.get("line-sort-key"),v=[];for(const{feature:k,id:O,index:F,sourceLayerIndex:V}of o){const U=this.layers[0]._featureFilter.needGeometry,G=zu(k,U);if(!this.layers[0]._featureFilter.filter(new P(this.zoom),G,u))continue;const J=b?b.evaluate(G,{},u):void 0,ue={id:O,properties:k.properties,type:k.type,sourceLayerIndex:V,index:F,geometry:U?G.geometry:Qc(k,u,f),patterns:{},sortKey:J};v.push(ue)}b&&v.sort((k,O)=>k.sortKey-O.sortKey);const{lineAtlas:S,featureIndex:E}=l,D=this.addConstantDashes(S);for(const k of v){const{geometry:O,index:F,sourceLayerIndex:V}=k;if(D&&this.addFeatureDashes(k,S),this.hasPattern){const U=Mg("line",this.layers,k,this.zoom,l);this.patternFeatures.push(U)}else this.addFeature(k,O,F,u,S.positions,l.availableImages);E.insert(o[F].feature,O,F,V,this.index)}}addConstantDashes(o){let l=!1;for(const u of this.layers){const f=u.paint.get("line-dasharray").value,b=u.layout.get("line-cap").value;if("constant"!==f.kind||"constant"!==b.kind)l=!0;else{const v=b.value,S=f.value;if(!S)continue;o.addDash(S,v)}}return l}addFeatureDashes(o,l){const u=this.zoom;for(const f of this.layers){const b=f.paint.get("line-dasharray").value,v=f.layout.get("line-cap").value;if("constant"===b.kind&&"constant"===v.kind)continue;let S,E;if("constant"===b.kind){if(S=b.value,!S)continue}else S=b.evaluate({zoom:u},o);E="constant"===v.kind?v.value:v.evaluate({zoom:u},o),l.addDash(S,E),o.patterns[f.id]=l.getKey(S,E)}}update(o,l,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,l,this.stateDependentLayers,u,f)}addFeatures(o,l,u,f,b){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,l,u,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=o.createVertexBuffer(this.layoutVertexArray2,C1)),this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,w1),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(o){if(o.properties&&o.properties.hasOwnProperty("mapbox_clip_start")&&o.properties.hasOwnProperty("mapbox_clip_end"))return{start:+o.properties.mapbox_clip_start,end:+o.properties.mapbox_clip_end}}addFeature(o,l,u,f,b,v){const S=this.layers[0].layout,E=S.get("line-join").evaluate(o,{}),D=S.get("line-cap").evaluate(o,{}),k=S.get("line-miter-limit"),O=S.get("line-round-limit");this.lineClips=this.lineFeatureClips(o);for(const F of l)this.addLine(F,o,E,D,k,O);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,u,b,v,f)}addLine(o,l,u,f,b,v){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ue=0;ue<o.length-1;ue++)this.totalDistance+=o[ue].dist(o[ue+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const S="Polygon"===T1[l.type];let E=o.length;for(;E>=2&&o[E-1].equals(o[E-2]);)E--;let D=0;for(;D<E-1&&o[D].equals(o[D+1]);)D++;if(E<(S?3:2))return;"bevel"===u&&(b=1.05);const k=this.overscaling<=16?15*Wn/(512*this.overscaling):0,O=this.segments.prepareSegment(10*E,this.layoutVertexArray,this.indexArray);let F,V,U,G,J;this.e1=this.e2=-1,S&&(F=o[E-2],J=o[D].sub(F)._unit()._perp());for(let ue=D;ue<E;ue++){if(U=ue===E-1?S?o[D+1]:void 0:o[ue+1],U&&o[ue].equals(U))continue;J&&(G=J),F&&(V=F),F=o[ue],J=U?U.sub(F)._unit()._perp():G,G=G||J;let we=G.add(J);0===we.x&&0===we.y||we._unit();const de=G.x*J.x+G.y*J.y,ve=we.x*J.x+we.y*J.y,Ae=0!==ve?1/ve:1/0,ke=2*Math.sqrt(2-2*ve),ct=ve<wI&&V&&U,st=G.x*J.y-G.y*J.x>0;if(ct&&ue>D){const dt=F.dist(V);if(dt>2*k){const It=F.sub(F.sub(V)._mult(k/dt)._round());this.updateDistance(V,It),this.addCurrentVertex(It,G,0,0,O),V=It}}const yt=V&&U;let Ht=yt?u:S?"butt":f;if(yt&&"round"===Ht&&(Ae<v?Ht="miter":Ae<=2&&(Ht="fakeround")),"miter"===Ht&&Ae>b&&(Ht="bevel"),"bevel"===Ht&&(Ae>2&&(Ht="flipbevel"),Ae<b&&(Ht="miter")),V&&this.updateDistance(V,F),"miter"===Ht)we._mult(Ae),this.addCurrentVertex(F,we,0,0,O);else if("flipbevel"===Ht){if(Ae>100)we=J.mult(-1);else{const dt=Ae*G.add(J).mag()/G.sub(J).mag();we._perp()._mult(dt*(st?-1:1))}this.addCurrentVertex(F,we,0,0,O),this.addCurrentVertex(F,we.mult(-1),0,0,O)}else if("bevel"===Ht||"fakeround"===Ht){const dt=-Math.sqrt(Ae*Ae-1),It=st?dt:0,Et=st?0:dt;if(V&&this.addCurrentVertex(F,G,It,Et,O),"fakeround"===Ht){const Lt=Math.round(180*ke/Math.PI/20);for(let Zt=1;Zt<Lt;Zt++){let mt=Zt/Lt;if(.5!==mt){const En=mt-.5;mt+=mt*En*(mt-1)*((1.0904+de*(de*(3.55645-1.43519*de)-3.2452))*En*En+(.848013+de*(.215638*de-1.06021)))}const an=J.sub(G)._mult(mt)._add(G)._unit()._mult(st?-1:1);this.addHalfVertex(F,an.x,an.y,!1,st,0,O)}}U&&this.addCurrentVertex(F,J,-It,-Et,O)}else if("butt"===Ht)this.addCurrentVertex(F,we,0,0,O);else if("square"===Ht){const dt=V?1:-1;V||this.addCurrentVertex(F,we,dt,dt,O),this.addCurrentVertex(F,we,0,0,O),V&&this.addCurrentVertex(F,we,dt,dt,O)}else"round"===Ht&&(V&&(this.addCurrentVertex(F,G,0,0,O),this.addCurrentVertex(F,G,1,1,O,!0)),U&&(this.addCurrentVertex(F,J,-1,-1,O,!0),this.addCurrentVertex(F,J,0,0,O)));if(ct&&ue<E-1){const dt=F.dist(U);if(dt>2*k){const It=F.add(U.sub(F)._mult(k/dt)._round());this.updateDistance(F,It),this.addCurrentVertex(It,J,0,0,O),F=It}}}}addCurrentVertex(o,l,u,f,b,v=!1){const S=l.y*f-l.x,E=-l.y-l.x*f;this.addHalfVertex(o,l.x+l.y*u,l.y-l.x*u,v,!1,u,b),this.addHalfVertex(o,S,E,v,!0,-f,b)}addHalfVertex({x:o,y:l},u,f,b,v,S,E){this.layoutVertexArray.emplaceBack((o<<1)+(b?1:0),(l<<1)+(v?1:0),Math.round(63*u)+128,Math.round(63*f)+128,1+(0===S?0:S<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const D=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),E.primitiveLength++),v?this.e2=D:this.e1=D}updateScaledDistance(){if(this.lineClips){const o=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=o*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(o,l){this.distance+=o.dist(l),this.updateScaledDistance()}}Mn(W_,"LineBucket",{omit:["layers","patternFeatures"]});const Vf=new be({"line-cap":new ie(_t.layout_line["line-cap"]),"line-join":new ie(_t.layout_line["line-join"]),"line-miter-limit":new q(_t.layout_line["line-miter-limit"]),"line-round-limit":new q(_t.layout_line["line-round-limit"]),"line-sort-key":new ie(_t.layout_line["line-sort-key"])});var Og={paint:new be({"line-opacity":new ie(_t.paint_line["line-opacity"]),"line-color":new ie(_t.paint_line["line-color"]),"line-translate":new q(_t.paint_line["line-translate"]),"line-translate-anchor":new q(_t.paint_line["line-translate-anchor"]),"line-width":new ie(_t.paint_line["line-width"]),"line-gap-width":new ie(_t.paint_line["line-gap-width"]),"line-offset":new ie(_t.paint_line["line-offset"]),"line-blur":new ie(_t.paint_line["line-blur"]),"line-dasharray":new ie(_t.paint_line["line-dasharray"]),"line-pattern":new ie(_t.paint_line["line-pattern"]),"line-gradient":new me(_t.paint_line["line-gradient"]),"line-trim-offset":new q(_t.paint_line["line-trim-offset"])}),layout:Vf};const X_=new class extends ie{possiblyEvaluate(a,o){return o=new P(Math.floor(o.zoom),{now:o.now,fadeDuration:o.fadeDuration,transition:o.transition}),super.possiblyEvaluate(a,o)}evaluate(a,o,l,u){return o=xn({},o,{zoom:Math.floor(o.zoom)}),super.evaluate(a,o,l,u)}}(Og.paint.properties["line-width"].specification);function Z_(a,o){return o>0?o+2*a:a}X_.useIntegerZoom=!0;const M0=We([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),E1=We([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),A0=We([{name:"a_projected_pos",components:4,type:"Float32"}],4);We([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const k0=We([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Y_=We([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);We([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const D1=We([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),I1=We([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);We([{name:"triangle",components:3,type:"Uint16"}]),We([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),We([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),We([{type:"Float32",name:"offsetX"}]),We([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);const xl=128;function Lg(a,o){const{expression:l}=o;if("constant"===l.kind)return{kind:"constant",layoutSize:l.evaluate(new P(a+1))};if("source"===l.kind)return{kind:"source"};{const{zoomStops:u,interpolationType:f}=l;let b=0;for(;b<u.length&&u[b]<=a;)b++;b=Math.max(0,b-1);let v=b;for(;v<u.length&&u[v]<a+1;)v++;v=Math.min(u.length-1,v);const S=u[b],E=u[v];return"composite"===l.kind?{kind:"composite",minZoom:S,maxZoom:E,interpolationType:f}:{kind:"camera",minZoom:S,maxZoom:E,minSize:l.evaluate(new P(S)),maxSize:l.evaluate(new P(E)),interpolationType:f}}}function vc(a,{uSize:o,uSizeT:l},{lowerSize:u,upperSize:f}){return"source"===a.kind?u/xl:"composite"===a.kind?qi(u/xl,f/xl,l):o}function cp(a,o){let l=0,u=0;if("constant"===a.kind)u=a.layoutSize;else if("source"!==a.kind){const{interpolationType:f,minZoom:b,maxZoom:v}=a,S=f?lt(bo.interpolationFactor(f,o,b,v),0,1):0;"camera"===a.kind?u=qi(a.minSize,a.maxSize,S):l=S}return{uSizeT:l,uSize:u}}var K_=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:xl,evaluateSizeForFeature:vc,evaluateSizeForZoom:cp,getSizeData:Lg});function Fg(a,o,l){return a.sections.forEach(u=>{u.text=function(f,b,v){const S=b.layout.get("text-transform").evaluate(v,{});return"uppercase"===S?f=f.toLocaleUpperCase():"lowercase"===S&&(f=f.toLocaleLowerCase()),A.applyArabicShaping&&(f=A.applyArabicShaping(f)),f}(u.text,o,l)}),a}const jf={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function Q_(a){return"\ufe36"===a||"\ufe48"===a||"\ufe38"===a||"\ufe44"===a||"\ufe42"===a||"\ufe3e"===a||"\ufe3c"===a||"\ufe3a"===a||"\ufe18"===a||"\ufe40"===a||"\ufe10"===a||"\ufe13"===a||"\ufe14"===a||"\uff40"===a||"\uffe3"===a||"\ufe11"===a||"\ufe12"===a}function Ng(a){return"\ufe35"===a||"\ufe47"===a||"\ufe37"===a||"\ufe43"===a||"\ufe41"===a||"\ufe3d"===a||"\ufe3b"===a||"\ufe39"===a||"\ufe17"===a||"\ufe3f"===a}var tu=Nr,J_=function(a,o,l,u,f){var b,v,S=8*f-u-1,E=(1<<S)-1,D=E>>1,k=-7,O=l?f-1:0,F=l?-1:1,V=a[o+O];for(O+=F,b=V&(1<<-k)-1,V>>=-k,k+=S;k>0;b=256*b+a[o+O],O+=F,k-=8);for(v=b&(1<<-k)-1,b>>=-k,k+=u;k>0;v=256*v+a[o+O],O+=F,k-=8);if(0===b)b=1-D;else{if(b===E)return v?NaN:1/0*(V?-1:1);v+=Math.pow(2,u),b-=D}return(V?-1:1)*v*Math.pow(2,b-u)},Bg=function(a,o,l,u,f,b){var v,S,E,D=8*b-f-1,k=(1<<D)-1,O=k>>1,F=23===f?Math.pow(2,-24)-Math.pow(2,-77):0,V=u?0:b-1,U=u?1:-1,G=o<0||0===o&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(S=isNaN(o)?1:0,v=k):(v=Math.floor(Math.log(o)/Math.LN2),o*(E=Math.pow(2,-v))<1&&(v--,E*=2),(o+=v+O>=1?F/E:F*Math.pow(2,1-O))*E>=2&&(v++,E/=2),v+O>=k?(S=0,v=k):v+O>=1?(S=(o*E-1)*Math.pow(2,f),v+=O):(S=o*Math.pow(2,O-1)*Math.pow(2,f),v=0));f>=8;a[l+V]=255&S,V+=U,S/=256,f-=8);for(v=v<<f|S,D+=f;D>0;a[l+V]=255&v,V+=U,v/=256,D-=8);a[l+V-U]|=128*G};function Nr(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}Nr.Varint=0,Nr.Fixed64=1,Nr.Bytes=2,Nr.Fixed32=5;var ey=4294967296,ty=1/ey,Yd="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function nu(a){return a.type===Nr.Bytes?a.readVarint()+a.pos:a.pos+1}function R0(a,o,l){var u=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));l.realloc(u);for(var f=l.pos-1;f>=a;f--)l.buf[f+u]=l.buf[f]}function M1(a,o){for(var l=0;l<a.length;l++)o.writeVarint(a[l])}function ny(a,o){for(var l=0;l<a.length;l++)o.writeSVarint(a[l])}function A1(a,o){for(var l=0;l<a.length;l++)o.writeFloat(a[l])}function P0(a,o){for(var l=0;l<a.length;l++)o.writeDouble(a[l])}function k1(a,o){for(var l=0;l<a.length;l++)o.writeBoolean(a[l])}function O0(a,o){for(var l=0;l<a.length;l++)o.writeFixed32(a[l])}function SI(a,o){for(var l=0;l<a.length;l++)o.writeSFixed32(a[l])}function R1(a,o){for(var l=0;l<a.length;l++)o.writeFixed64(a[l])}function Kd(a,o){for(var l=0;l<a.length;l++)o.writeSFixed64(a[l])}function zg(a,o){return(a[o]|a[o+1]<<8|a[o+2]<<16)+16777216*a[o+3]}function $l(a,o,l){a[l]=o,a[l+1]=o>>>8,a[l+2]=o>>>16,a[l+3]=o>>>24}function zn(a,o){return(a[o]|a[o+1]<<8|a[o+2]<<16)+(a[o+3]<<24)}Nr.prototype={destroy:function(){this.buf=null},readFields:function(a,o,l){for(l=l||this.length;this.pos<l;){var u=this.readVarint(),f=u>>3,b=this.pos;this.type=7&u,a(f,o,this),this.pos===b&&this.skip(u)}return o},readMessage:function(a,o){return this.readFields(a,o,this.readVarint()+this.pos)},readFixed32:function(){var a=zg(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=zn(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=zg(this.buf,this.pos)+zg(this.buf,this.pos+4)*ey;return this.pos+=8,a},readSFixed64:function(){var a=zg(this.buf,this.pos)+zn(this.buf,this.pos+4)*ey;return this.pos+=8,a},readFloat:function(){var a=J_(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=J_(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var o,l,u=this.buf;return o=127&(l=u[this.pos++]),l<128?o:(o|=(127&(l=u[this.pos++]))<<7,l<128?o:(o|=(127&(l=u[this.pos++]))<<14,l<128?o:(o|=(127&(l=u[this.pos++]))<<21,l<128?o:function(f,b,v){var S,E,D=v.buf;if(S=(112&(E=D[v.pos++]))>>4,E<128||(S|=(127&(E=D[v.pos++]))<<3,E<128)||(S|=(127&(E=D[v.pos++]))<<10,E<128)||(S|=(127&(E=D[v.pos++]))<<17,E<128)||(S|=(127&(E=D[v.pos++]))<<24,E<128)||(S|=(1&(E=D[v.pos++]))<<31,E<128))return function up(a,o,l){return l?4294967296*o+(a>>>0):4294967296*(o>>>0)+(a>>>0)}(f,S,b);throw new Error("Expected varint not more than 10 bytes")}(o|=(15&(l=u[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var a=this.readVarint()+this.pos,o=this.pos;return this.pos=a,a-o>=12&&Yd?Yd.decode(this.buf.subarray(o,a)):function(l,u,f){for(var b="",v=u;v<f;){var S,E,D,k=l[v],O=null,F=k>239?4:k>223?3:k>191?2:1;if(v+F>f)break;1===F?k<128&&(O=k):2===F?128==(192&(S=l[v+1]))&&(O=(31&k)<<6|63&S)<=127&&(O=null):3===F?(E=l[v+2],128==(192&(S=l[v+1]))&&128==(192&E)&&((O=(15&k)<<12|(63&S)<<6|63&E)<=2047||O>=55296&&O<=57343)&&(O=null)):4===F&&(E=l[v+2],D=l[v+3],128==(192&(S=l[v+1]))&&128==(192&E)&&128==(192&D)&&((O=(15&k)<<18|(63&S)<<12|(63&E)<<6|63&D)<=65535||O>=1114112)&&(O=null)),null===O?(O=65533,F=1):O>65535&&(O-=65536,b+=String.fromCharCode(O>>>10&1023|55296),O=56320|1023&O),b+=String.fromCharCode(O),v+=F}return b}(this.buf,o,a)},readBytes:function(){var a=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,a);return this.pos=a,o},readPackedVarint:function(a,o){if(this.type!==Nr.Bytes)return a.push(this.readVarint(o));var l=nu(this);for(a=a||[];this.pos<l;)a.push(this.readVarint(o));return a},readPackedSVarint:function(a){if(this.type!==Nr.Bytes)return a.push(this.readSVarint());var o=nu(this);for(a=a||[];this.pos<o;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==Nr.Bytes)return a.push(this.readBoolean());var o=nu(this);for(a=a||[];this.pos<o;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==Nr.Bytes)return a.push(this.readFloat());var o=nu(this);for(a=a||[];this.pos<o;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==Nr.Bytes)return a.push(this.readDouble());var o=nu(this);for(a=a||[];this.pos<o;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==Nr.Bytes)return a.push(this.readFixed32());var o=nu(this);for(a=a||[];this.pos<o;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==Nr.Bytes)return a.push(this.readSFixed32());var o=nu(this);for(a=a||[];this.pos<o;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==Nr.Bytes)return a.push(this.readFixed64());var o=nu(this);for(a=a||[];this.pos<o;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==Nr.Bytes)return a.push(this.readSFixed64());var o=nu(this);for(a=a||[];this.pos<o;)a.push(this.readSFixed64());return a},skip:function(a){var o=7&a;if(o===Nr.Varint)for(;this.buf[this.pos++]>127;);else if(o===Nr.Bytes)this.pos=this.readVarint()+this.pos;else if(o===Nr.Fixed32)this.pos+=4;else{if(o!==Nr.Fixed64)throw new Error("Unimplemented type: "+o);this.pos+=8}},writeTag:function(a,o){this.writeVarint(a<<3|o)},realloc:function(a){for(var o=this.length||16;o<this.pos+a;)o*=2;if(o!==this.length){var l=new Uint8Array(o);l.set(this.buf),this.buf=l,this.length=o}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),$l(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),$l(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),$l(this.buf,-1&a,this.pos),$l(this.buf,Math.floor(a*ty),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),$l(this.buf,-1&a,this.pos),$l(this.buf,Math.floor(a*ty),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(o,l){var u,f,b,S;if(o>=0?(u=o%4294967296|0,f=o/4294967296|0):(f=~(-o/4294967296),4294967295^(u=~(-o%4294967296))?u=u+1|0:(u=0,f=f+1|0)),o>=0x10000000000000000||o<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),b=u,(S=l).buf[S.pos++]=127&b|128,b>>>=7,S.buf[S.pos++]=127&b|128,b>>>=7,S.buf[S.pos++]=127&b|128,b>>>=7,S.buf[S.pos++]=127&b|128,S.buf[S.pos]=127&(b>>>=7),function(b,v){var S=(7&b)<<4;v.buf[v.pos++]|=S|((b>>>=3)?128:0),b&&(v.buf[v.pos++]=127&b|((b>>>=7)?128:0),b&&(v.buf[v.pos++]=127&b|((b>>>=7)?128:0),b&&(v.buf[v.pos++]=127&b|((b>>>=7)?128:0),b&&(v.buf[v.pos++]=127&b|((b>>>=7)?128:0),b&&(v.buf[v.pos++]=127&b)))))}(f,l)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(Boolean(a))},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var o=this.pos;this.pos=function(u,f,b){for(var v,S,E=0;E<f.length;E++){if((v=f.charCodeAt(E))>55295&&v<57344){if(!S){v>56319||E+1===f.length?(u[b++]=239,u[b++]=191,u[b++]=189):S=v;continue}if(v<56320){u[b++]=239,u[b++]=191,u[b++]=189,S=v;continue}v=S-55296<<10|v-56320|65536,S=null}else S&&(u[b++]=239,u[b++]=191,u[b++]=189,S=null);v<128?u[b++]=v:(v<2048?u[b++]=v>>6|192:(v<65536?u[b++]=v>>12|224:(u[b++]=v>>18|240,u[b++]=v>>12&63|128),u[b++]=v>>6&63|128),u[b++]=63&v|128)}return b}(this.buf,a,this.pos);var l=this.pos-o;l>=128&&R0(o,l,this),this.pos=o-1,this.writeVarint(l),this.pos+=l},writeFloat:function(a){this.realloc(4),Bg(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),Bg(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var o=a.length;this.writeVarint(o),this.realloc(o);for(var l=0;l<o;l++)this.buf[this.pos++]=a[l]},writeRawMessage:function(a,o){this.pos++;var l=this.pos;a(o,this);var u=this.pos-l;u>=128&&R0(l,u,this),this.pos=l-1,this.writeVarint(u),this.pos+=u},writeMessage:function(a,o,l){this.writeTag(a,Nr.Bytes),this.writeRawMessage(o,l)},writePackedVarint:function(a,o){o.length&&this.writeMessage(a,M1,o)},writePackedSVarint:function(a,o){o.length&&this.writeMessage(a,ny,o)},writePackedBoolean:function(a,o){o.length&&this.writeMessage(a,k1,o)},writePackedFloat:function(a,o){o.length&&this.writeMessage(a,A1,o)},writePackedDouble:function(a,o){o.length&&this.writeMessage(a,P0,o)},writePackedFixed32:function(a,o){o.length&&this.writeMessage(a,O0,o)},writePackedSFixed32:function(a,o){o.length&&this.writeMessage(a,SI,o)},writePackedFixed64:function(a,o){o.length&&this.writeMessage(a,R1,o)},writePackedSFixed64:function(a,o){o.length&&this.writeMessage(a,Kd,o)},writeBytesField:function(a,o){this.writeTag(a,Nr.Bytes),this.writeBytes(o)},writeFixed32Field:function(a,o){this.writeTag(a,Nr.Fixed32),this.writeFixed32(o)},writeSFixed32Field:function(a,o){this.writeTag(a,Nr.Fixed32),this.writeSFixed32(o)},writeFixed64Field:function(a,o){this.writeTag(a,Nr.Fixed64),this.writeFixed64(o)},writeSFixed64Field:function(a,o){this.writeTag(a,Nr.Fixed64),this.writeSFixed64(o)},writeVarintField:function(a,o){this.writeTag(a,Nr.Varint),this.writeVarint(o)},writeSVarintField:function(a,o){this.writeTag(a,Nr.Varint),this.writeSVarint(o)},writeStringField:function(a,o){this.writeTag(a,Nr.Bytes),this.writeString(o)},writeFloatField:function(a,o){this.writeTag(a,Nr.Fixed32),this.writeFloat(o)},writeDoubleField:function(a,o){this.writeTag(a,Nr.Fixed64),this.writeDouble(o)},writeBooleanField:function(a,o){this.writeVarintField(a,Boolean(o))}};var Vg=He(tu);function Uf(a,o,l){o.glyphs=[],1===a&&l.readMessage(xc,o)}function xc(a,o,l){if(3===a){const{id:u,bitmap:f,width:b,height:v,left:S,top:E,advance:D}=l.readMessage(P1,{});o.glyphs.push({id:u,bitmap:new Jc({width:b+6,height:v+6},f),metrics:{width:b,height:v,left:S,top:E,advance:D}})}else 4===a?o.ascender=l.readSVarint():5===a&&(o.descender=l.readSVarint())}function P1(a,o,l){1===a?o.id=l.readVarint():2===a?o.bitmap=l.readBytes():3===a?o.width=l.readVarint():4===a?o.height=l.readVarint():5===a?o.left=l.readSVarint():6===a?o.top=l.readSVarint():7===a&&(o.advance=l.readVarint())}function iu(a){let o=0,l=0;for(const v of a)o+=v.w*v.h,l=Math.max(l,v.w);a.sort((v,S)=>S.h-v.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),l),h:1/0}];let f=0,b=0;for(const v of a)for(let S=u.length-1;S>=0;S--){const E=u[S];if(!(v.w>E.w||v.h>E.h)){if(v.x=E.x,v.y=E.y,b=Math.max(b,v.y+v.h),f=Math.max(f,v.x+v.w),v.w===E.w&&v.h===E.h){const D=u.pop();S<u.length&&(u[S]=D)}else v.h===E.h?(E.x+=v.w,E.w-=v.w):v.w===E.w?(E.y+=v.h,E.h-=v.h):(u.push({x:E.x+v.w,y:E.y,w:E.w-v.w,h:v.h}),E.y+=v.h,E.h-=v.h);break}}return{w:f,h:b,fill:o/(f*b)||0}}class Hf{constructor(o,{pixelRatio:l,version:u,stretchX:f,stretchY:b,content:v}){this.paddedRect=o,this.pixelRatio=l,this.stretchX=f,this.stretchY=b,this.content=v,this.version=u}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class jg{constructor(o,l){const u={},f={};this.haveRenderCallbacks=[];const b=[];this.addImages(o,u,b),this.addImages(l,f,b);const{w:v,h:S}=iu(b),E=new ma({width:v||1,height:S||1});for(const D in o){const k=o[D],O=u[D].paddedRect;ma.copy(k.data,E,{x:0,y:0},{x:O.x+1,y:O.y+1},k.data)}for(const D in l){const k=l[D],O=f[D].paddedRect,F=O.x+1,V=O.y+1,U=k.data.width,G=k.data.height;ma.copy(k.data,E,{x:0,y:0},{x:F,y:V},k.data),ma.copy(k.data,E,{x:0,y:G-1},{x:F,y:V-1},{width:U,height:1}),ma.copy(k.data,E,{x:0,y:0},{x:F,y:V+G},{width:U,height:1}),ma.copy(k.data,E,{x:U-1,y:0},{x:F-1,y:V},{width:1,height:G}),ma.copy(k.data,E,{x:0,y:0},{x:F+U,y:V},{width:1,height:G})}this.image=E,this.iconPositions=u,this.patternPositions=f}addImages(o,l,u){for(const f in o){const b=o[f],v={x:0,y:0,w:b.data.width+2,h:b.data.height+2};u.push(v),l[f]=new Hf(v,b),b.hasRenderCallback&&this.haveRenderCallbacks.push(f)}}patchUpdatedImages(o,l){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(u=>o.hasImage(u)),o.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const u in o.updatedImages)this.patchUpdatedImage(this.iconPositions[u],o.getImage(u),l),this.patchUpdatedImage(this.patternPositions[u],o.getImage(u),l)}patchUpdatedImage(o,l,u){if(!o||!l||o.version===l.version)return;o.version=l.version;const[f,b]=o.tl;u.update(l.data,void 0,{x:f,y:b})}}Mn(Hf,"ImagePosition"),Mn(jg,"ImageAtlas");const Ka={horizontal:1,vertical:2,horizontalOnly:3};class wl{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(o,l){const u=new wl;return u.scale=o||1,u.fontStack=l,u}static forImage(o){const l=new wl;return l.imageName=o,l}}class dp{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(o,l){const u=new dp;for(let f=0;f<o.sections.length;f++){const b=o.sections[f];b.image?u.addImageSection(b):u.addTextSection(b,l)}return u}length(){return this.text.length}getSection(o){return this.sections[this.sectionIndex[o]]}getSections(){return this.sections}getSectionIndex(o){return this.sectionIndex[o]}getCharCode(o){return this.text.charCodeAt(o)}verticalizePunctuation(o){this.text=function(l,u){let f="";for(let b=0;b<l.length;b++){const v=l.charCodeAt(b+1)||null,S=l.charCodeAt(b-1)||null;f+=!u&&(v&&Ym(v)&&!jf[l[b+1]]||S&&Ym(S)&&!jf[l[b-1]])||!jf[l[b]]?l[b]:jf[l[b]]}return f}(this.text,o)}trim(){let o=0;for(let u=0;u<this.text.length&&Hg[this.text.charCodeAt(u)];u++)o++;let l=this.text.length;for(let u=this.text.length-1;u>=0&&u>=o&&Hg[this.text.charCodeAt(u)];u--)l--;this.text=this.text.substring(o,l),this.sectionIndex=this.sectionIndex.slice(o,l)}substring(o,l){const u=new dp;return u.text=this.text.substring(o,l),u.sectionIndex=this.sectionIndex.slice(o,l),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((o,l)=>Math.max(o,this.sections[l].scale),0)}addTextSection(o,l){this.text+=o.text,this.sections.push(wl.forText(o.scale,o.fontStack||l));const u=this.sections.length-1;for(let f=0;f<o.text.length;++f)this.sectionIndex.push(u)}addImageSection(o){const l=o.image?o.image.name:"";if(0===l.length)return void ln("Can't add FormattedSection with an empty image.");const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(wl.forImage(l)),this.sectionIndex.push(this.sections.length-1)):ln("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function iy(a,o,l,u,f,b,v,S,E,D,k,O,F,V,U){const G=dp.fromFeature(a,f);O===Ka.vertical&&G.verticalizePunctuation(F);let J=[];const ue=function(ke,ct,st,yt,Ht,dt){if(!ke)return[];const It=[],Et=function(an,En,gn,fi,Qt,$n){let _i=0;for(let Ki=0;Ki<an.length();Ki++){const yi=an.getSection(Ki);_i+=N0(an.getCharCode(Ki),yi,fi,Qt,En,$n)}return _i/Math.max(1,Math.ceil(_i/gn))}(ke,ct,st,yt,Ht,dt),Lt=ke.text.indexOf("\u200b")>=0;let Zt=0;for(let an=0;an<ke.length();an++){const En=ke.getSection(an),gn=ke.getCharCode(an);if(Hg[gn]||(Zt+=N0(gn,En,yt,Ht,ct,dt)),an<ke.length()-1){const fi=!((mt=gn)<11904||!(sn_Bopomofo_Extended(mt)||sn_Bopomofo(mt)||sn_CJK_Compatibility_Forms(mt)||sn_CJK_Compatibility_Ideographs(mt)||sn_CJK_Compatibility(mt)||sn_CJK_Radicals_Supplement(mt)||sn_CJK_Strokes(mt)||sn_CJK_Symbols_and_Punctuation(mt)||sn_CJK_Unified_Ideographs_Extension_A(mt)||sn_CJK_Unified_Ideographs(mt)||sn_Enclosed_CJK_Letters_and_Months(mt)||sn_Halfwidth_and_Fullwidth_Forms(mt)||sn_Hiragana(mt)||sn_Ideographic_Description_Characters(mt)||sn_Kangxi_Radicals(mt)||sn_Katakana_Phonetic_Extensions(mt)||sn_Katakana(mt)||sn_Vertical_Forms(mt)||sn_Yi_Radicals(mt)||sn_Yi_Syllables(mt)));(O1[gn]||fi||En.imageName)&&It.push(Qd(an+1,Zt,Et,It,L1(gn,ke.getCharCode(an+1),fi&&Lt),!1))}}var mt;return wc(Qd(ke.length(),Zt,Et,It,0,!0))}(G,D,b,o,u,V),{processBidirectionalText:we,processStyledBidirectionalText:de}=A;if(we&&1===G.sections.length){const ke=we(G.toString(),ue);for(const ct of ke){const st=new dp;st.text=ct,st.sections=G.sections;for(let yt=0;yt<ct.length;yt++)st.sectionIndex.push(0);J.push(st)}}else if(de){const ke=de(G.text,G.sectionIndex,ue);for(const ct of ke){const st=new dp;st.text=ct[0],st.sectionIndex=ct[1],st.sections=G.sections,J.push(st)}}else J=function(ke,ct){const st=[],yt=ke.text;let Ht=0;for(const dt of ct)st.push(ke.substring(Ht,dt)),Ht=dt;return Ht<yt.length&&st.push(ke.substring(Ht,yt.length)),st}(G,ue);const ve=[],Ae={positionedLines:ve,text:G.toString(),top:k[1],bottom:k[1],left:k[0],right:k[0],writingMode:O,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ke,ct,st,yt,Ht,dt,It,Et,Lt,Zt,mt,an){let En=0,gn=0,fi=0;const Qt="right"===Et?1:"left"===Et?0:.5;let $n=!1;for(const mi of Ht){const gi=mi.getSections();for(const dr of gi){if(dr.imageName)continue;const Br=ct[dr.fontStack];if(Br&&($n=void 0!==Br.ascender&&void 0!==Br.descender,!$n))break}if(!$n)break}let _i=0;for(const mi of Ht){mi.trim();const gi=mi.getMaxScale(),dr=24*(gi-1),Br={positionedGlyphs:[],lineOffset:0};ke.positionedLines[_i]=Br;const Sr=Br.positionedGlyphs;let Cr=0;if(!mi.length()){gn+=dt,++_i;continue}let no=0,co=0;for(let Ar=0;Ar<mi.length();Ar++){const Uo=mi.getSection(Ar),Io=mi.getSectionIndex(Ar),uo=mi.getCharCode(Ar);let sr=Uo.scale,Mo=null,zr=null,Bs=null,Yt=24,cs=0;const Lo=!(Lt===Ka.horizontal||!mt&&!cf(uo)||mt&&(Hg[uo]||(Ki=uo,sn_Arabic(Ki)||sn_Arabic_Supplement(Ki)||sn_Arabic_Extended_A(Ki)||sn_Arabic_Presentation_Forms_A(Ki)||sn_Arabic_Presentation_Forms_B(Ki))));if(Uo.imageName){const na=yt[Uo.imageName];if(!na)continue;Bs=Uo.imageName,ke.iconsInText=ke.iconsInText||!0,zr=na.paddedRect;const Yo=na.displaySize;sr=24*sr/an,Mo={width:Yo[0],height:Yo[1],left:1,top:-3,advance:Lo?Yo[1]:Yo[0],localGlyph:!1},cs=$n?-Mo.height*sr:24*gi-17-Yo[1]*sr,Yt=Mo.advance;const Xl=(Lo?Yo[0]:Yo[1])*sr-24*gi;Xl>0&&Xl>Cr&&(Cr=Xl)}else{const na=st[Uo.fontStack];if(!na)continue;na[uo]&&(zr=na[uo]);const Yo=ct[Uo.fontStack];if(!Yo)continue;const Xl=Yo.glyphs[uo];if(!Xl)continue;if(Mo=Xl.metrics,Yt=8203!==uo?24:0,$n){const vp=void 0!==Yo.ascender?Math.abs(Yo.ascender):0,Qf=void 0!==Yo.descender?Math.abs(Yo.descender):0,Jf=(vp+Qf)*sr;no<Jf&&(no=Jf,co=(vp-Qf)/2*sr),cs=-vp*sr}else cs=24*(gi-sr)-17}Lo?(ke.verticalizable=!0,Sr.push({glyph:uo,imageName:Bs,x:En,y:gn+cs,vertical:Lo,scale:sr,localGlyph:Mo.localGlyph,fontStack:Uo.fontStack,sectionIndex:Io,metrics:Mo,rect:zr}),En+=Yt*sr+Zt):(Sr.push({glyph:uo,imageName:Bs,x:En,y:gn+cs,vertical:Lo,scale:sr,localGlyph:Mo.localGlyph,fontStack:Uo.fontStack,sectionIndex:Io,metrics:Mo,rect:zr}),En+=Mo.advance*sr+Zt)}0!==Sr.length&&(fi=Math.max(En-Zt,fi),$n?z0(Sr,Qt,Cr,co,dt*gi/2):z0(Sr,Qt,Cr,0,dt/2)),En=0;const io=dt*gi+Cr;Br.lineOffset=Math.max(Cr,dr),gn+=io,++_i}var Ki;const yi=gn,{horizontalAlign:Qn,verticalAlign:er}=ry(It);(function(mi,gi,dr,Br,Sr,Cr){const no=(gi-dr)*Sr,co=-Cr*Br;for(const io of mi)for(const Ar of io.positionedGlyphs)Ar.x+=no,Ar.y+=co})(ke.positionedLines,Qt,Qn,er,fi,yi),ke.top+=-er*yi,ke.bottom=ke.top+yi,ke.left+=-Qn*fi,ke.right=ke.left+fi,ke.hasBaseline=$n}(Ae,o,l,u,J,v,S,E,O,D,F,U),!function(ke){for(const ct of ke)if(0!==ct.positionedGlyphs.length)return!1;return!0}(ve)&&Ae}const Hg={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},O1={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function N0(a,o,l,u,f,b){if(o.imageName){const v=u[o.imageName];return v?v.displaySize[0]*o.scale*24/b+f:0}{const v=l[o.fontStack],S=v&&v.glyphs[a];return S?S.metrics.advance*o.scale+f:0}}function B0(a,o,l,u){const f=Math.pow(a-o,2);return u?a<o?f/2:2*f:f+Math.abs(l)*l}function L1(a,o,l){let u=0;return 10===a&&(u-=1e4),l&&(u+=150),40!==a&&65288!==a||(u+=50),41!==o&&65289!==o||(u+=50),u}function Qd(a,o,l,u,f,b){let v=null,S=B0(o,l,f,b);for(const E of u){const D=B0(o-E.x,l,f,b)+E.badness;D<=S&&(v=E,S=D)}return{index:a,x:o,priorBreak:v,badness:S}}function wc(a){return a?wc(a.priorBreak).concat(a.index):[]}function ry(a){let o=.5,l=.5;switch(a){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:o,verticalAlign:l}}function z0(a,o,l,u,f){if(!(o||l||u||f))return;const b=a.length-1,v=a[b],S=(v.x+v.metrics.advance*v.scale)*o;for(let E=0;E<=b;E++)a[E].x-=S,a[E].y+=l+u+f}function CI(a,o,l){const{horizontalAlign:u,verticalAlign:f}=ry(l),b=o[0]-a.displaySize[0]*u,v=o[1]-a.displaySize[1]*f;return{image:a,top:v,bottom:v+a.displaySize[1],left:b,right:b+a.displaySize[0]}}function F1(a,o,l,u,f,b){const v=a.image;let S;if(v.content){const J=v.content,ue=v.pixelRatio||1;S=[J[0]/ue,J[1]/ue,v.displaySize[0]-J[2]/ue,v.displaySize[1]-J[3]/ue]}const E=o.left*b,D=o.right*b;let k,O,F,V;"width"===l||"both"===l?(V=f[0]+E-u[3],O=f[0]+D+u[1]):(V=f[0]+(E+D-v.displaySize[0])/2,O=V+v.displaySize[0]);const U=o.top*b,G=o.bottom*b;return"height"===l||"both"===l?(k=f[1]+U-u[0],F=f[1]+G+u[2]):(k=f[1]+(U+G-v.displaySize[1])/2,F=k+v.displaySize[1]),{image:v,top:k,right:O,bottom:F,left:V,collisionPadding:S}}class Sc extends ge{constructor(o,l,u,f,b){super(o,l),this.angle=f,this.z=u,void 0!==b&&(this.segment=b)}clone(){return new Sc(this.x,this.y,this.z,this.angle,this.segment)}}function N1(a,o,l,u,f){if(void 0===o.segment)return!0;let b=o,v=o.segment+1,S=0;for(;S>-l/2;){if(v--,v<0)return!1;S-=a[v].dist(b),b=a[v]}S+=a[v].dist(a[v+1]),v++;const E=[];let D=0;for(;S<l/2;){const k=a[v],O=a[v+1];if(!O)return!1;let F=a[v-1].angleTo(k)-k.angleTo(O);for(F=Math.abs((F+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:S,angleDelta:F}),D+=F;S-E[0].distance>u;)D-=E.shift().angleDelta;if(D>f)return!1;v++,S+=k.dist(O)}return!0}function oy(a){let o=0;for(let l=0;l<a.length-1;l++)o+=a[l].dist(a[l+1]);return o}function B1(a,o,l){return a?.6*o*l:0}function sy(a,o){return Math.max(a?a.right-a.left:0,o?o.right-o.left:0)}function z1(a,o,l,u,f,b){const v=B1(l,f,b),S=sy(l,u)*b;let E=0;const D=oy(a)/2;for(let k=0;k<a.length-1;k++){const O=a[k],F=a[k+1],V=O.dist(F);if(E+V>D){const U=(D-E)/V,G=qi(O.x,F.x,U),J=qi(O.y,F.y,U),ue=new Sc(G,J,0,F.angleTo(O),k);return!v||N1(a,ue,S,v,o)?ue:void 0}E+=V}}function V0(a,o,l,u,f,b,v,S,E){const D=B1(u,b,v),k=sy(u,f),O=k*v,F=0===a[0].x||a[0].x===E||0===a[0].y||a[0].y===E;return o-O<o/4&&(o=O+o/4),j0(a,F?o/2*S%o:(k/2+2*b)*v*S%o,o,D,l,O,F,!1,E)}function j0(a,o,l,u,f,b,v,S,E){const D=b/2,k=oy(a);let O=0,F=o-l,V=[];for(let U=0;U<a.length-1;U++){const G=a[U],J=a[U+1],ue=G.dist(J),we=J.angleTo(G);for(;F+l<O+ue;){F+=l;const de=(F-O)/ue,ve=qi(G.x,J.x,de),Ae=qi(G.y,J.y,de);if(ve>=0&&ve<E&&Ae>=0&&Ae<E&&F-D>=0&&F+D<=k){const ke=new Sc(ve,Ae,0,we,U);ke._round(),u&&!N1(a,ke,b,u,f)||V.push(ke)}}O+=ue}return S||V.length||v||(V=j0(a,O/2,l,u,f,b,v,!0,E)),V}function U0(a,o,l,u,f){const b=[];for(let v=0;v<a.length;v++){const S=a[v];let E;for(let D=0;D<S.length-1;D++){let k=S[D],O=S[D+1];k.x<o&&O.x<o||(k.x<o?k=new ge(o,k.y+(o-k.x)/(O.x-k.x)*(O.y-k.y))._round():O.x<o&&(O=new ge(o,k.y+(o-k.x)/(O.x-k.x)*(O.y-k.y))._round()),k.y<l&&O.y<l||(k.y<l?k=new ge(k.x+(l-k.y)/(O.y-k.y)*(O.x-k.x),l)._round():O.y<l&&(O=new ge(k.x+(l-k.y)/(O.y-k.y)*(O.x-k.x),l)._round()),k.x>=u&&O.x>=u||(k.x>=u?k=new ge(u,k.y+(u-k.x)/(O.x-k.x)*(O.y-k.y))._round():O.x>=u&&(O=new ge(u,k.y+(u-k.x)/(O.x-k.x)*(O.y-k.y))._round()),k.y>=f&&O.y>=f||(k.y>=f?k=new ge(k.x+(f-k.y)/(O.y-k.y)*(O.x-k.x),f)._round():O.y>=f&&(O=new ge(k.x+(f-k.y)/(O.y-k.y)*(O.x-k.x),f)._round()),E&&k.equals(E[E.length-1])||(E=[k],b.push(E)),E.push(O)))))}}return b}Mn(Sc,"Anchor");const ba=1e20;function H0(a,o,l,u,f,b,v,S,E){for(let D=o;D<o+u;D++)ay(a,l*b+D,b,f,v,S,E);for(let D=l;D<l+f;D++)ay(a,D*b+o,1,u,v,S,E)}function ay(a,o,l,u,f,b,v){b[0]=0,v[0]=-ba,v[1]=ba,f[0]=a[o];for(let S=1,E=0,D=0;S<u;S++){f[S]=a[o+S*l];const k=S*S;do{const O=b[E];D=(f[S]-f[O]+k-O*O)/(S-O)/2}while(D<=v[E]&&--E>-1);E++,b[E]=S,v[E]=D,v[E+1]=ba}for(let S=0,E=0;S<u;S++){for(;v[E+1]<S;)E++;const D=b[E],k=S-D;a[o+S*l]=f[D]+k*k}}const ly={none:0,ideographs:1,all:2};class hp{constructor(o,l,u){this.requestManager=o,this.localGlyphMode=l,this.localFontFamily=u,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(o){this.url=o}getGlyphs(o,l){const u=[];for(const f in o)for(const b of o[f])u.push({stack:f,id:b});xt(u,({stack:f,id:b},v)=>{let S=this.entries[f];S||(S=this.entries[f]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let E=S.glyphs[b];if(void 0!==E)return void v(null,{stack:f,id:b,glyph:E});if(E=this._tinySDF(S,f,b),E)return S.glyphs[b]=E,void v(null,{stack:f,id:b,glyph:E});const D=Math.floor(b/256);if(256*D>65535)return void v(new Error("glyphs > 65535 not supported"));if(S.ranges[D])return void v(null,{stack:f,id:b,glyph:E});let k=S.requests[D];k||(k=S.requests[D]=[],hp.loadGlyphRange(f,D,this.url,this.requestManager,(O,F)=>{if(F){S.ascender=F.ascender,S.descender=F.descender;for(const V in F.glyphs)this._doesCharSupportLocalGlyph(+V)||(S.glyphs[+V]=F.glyphs[+V]);S.ranges[D]=!0}for(const V of k)V(O,F);delete S.requests[D]})),k.push((O,F)=>{O?v(O):F&&v(null,{stack:f,id:b,glyph:F.glyphs[b]||null})})},(f,b)=>{if(f)l(f);else if(b){const v={};for(const{stack:S,id:E,glyph:D}of b)void 0===v[S]&&(v[S]={}),void 0===v[S].glyphs&&(v[S].glyphs={}),v[S].glyphs[E]=D&&{id:D.id,bitmap:D.bitmap.clone(),metrics:D.metrics},v[S].ascender=this.entries[S].ascender,v[S].descender=this.entries[S].descender;l(null,v)}})}_doesCharSupportLocalGlyph(o){return this.localGlyphMode!==ly.none&&(this.localGlyphMode===ly.all?!!this.localFontFamily:!!this.localFontFamily&&(sn_CJK_Unified_Ideographs(o)||sn_Hangul_Syllables(o)||sn_Hiragana(o)||sn_Katakana(o)||sn_CJK_Symbols_and_Punctuation(o)))}_tinySDF(o,l,u){const f=this.localFontFamily;if(!f||!this._doesCharSupportLocalGlyph(u))return;let b=o.tinySDF;if(!b){let G="400";/bold/i.test(l)?G="900":/medium/i.test(l)?G="500":/light/i.test(l)&&(G="200"),b=o.tinySDF=new hp.TinySDF({fontFamily:f,fontWeight:G,fontSize:48,buffer:6,radius:16}),b.fontWeight=G}if(this.localGlyphs[b.fontWeight][u])return this.localGlyphs[b.fontWeight][u];const v=String.fromCharCode(u),{data:S,width:E,height:D,glyphWidth:k,glyphHeight:O,glyphLeft:F,glyphTop:V,glyphAdvance:U}=b.draw(v);return this.localGlyphs[b.fontWeight][u]={id:u,bitmap:new Jc({width:E,height:D},S),metrics:{width:k/2,height:O/2,left:F/2,top:V/2-27,advance:U/2,localGlyph:!0}}}}hp.loadGlyphRange=function(a,o,l,u,f){const b=256*o,v=b+255,S=u.transformRequest(u.normalizeGlyphsURL(l).replace("{fontstack}",a).replace("{range}",`${b}-${v}`),hi.Glyphs);j(S,(E,D)=>{if(E)f(E);else if(D){const k={},O=new Vg(D).readFields(Uf,{});for(const F of O.glyphs)k[F.id]=F;f(null,{glyphs:k,ascender:O.ascender,descender:O.descender})}})},hp.TinySDF=class{constructor({fontSize:a=24,buffer:o=3,radius:l=8,cutoff:u=.25,fontFamily:f="sans-serif",fontWeight:b="normal",fontStyle:v="normal"}={}){this.buffer=o,this.cutoff=u,this.radius=l;const S=this.size=a+4*o,E=this._createCanvas(S),D=this.ctx=E.getContext("2d",{willReadFrequently:!0});D.font=`${v} ${b} ${a}px ${f}`,D.textBaseline="alphabetic",D.textAlign="left",D.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(a){const o=document.createElement("canvas");return o.width=o.height=a,o}draw(a){const{width:o,actualBoundingBoxAscent:l,actualBoundingBoxDescent:u,actualBoundingBoxLeft:f,actualBoundingBoxRight:b}=this.ctx.measureText(a),v=Math.ceil(l),S=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(b-f))),E=Math.min(this.size-this.buffer,v+Math.ceil(u)),D=S+2*this.buffer,k=E+2*this.buffer,O=Math.max(D*k,0),F=new Uint8ClampedArray(O),V={data:F,width:D,height:k,glyphWidth:S,glyphHeight:E,glyphTop:v,glyphLeft:0,glyphAdvance:o};if(0===S||0===E)return V;const{ctx:U,buffer:G,gridInner:J,gridOuter:ue}=this;U.clearRect(G,G,S,E),U.fillText(a,G,G+v);const we=U.getImageData(G,G,S,E);ue.fill(ba,0,O),J.fill(0,0,O);for(let de=0;de<E;de++)for(let ve=0;ve<S;ve++){const Ae=we.data[4*(de*S+ve)+3]/255;if(0===Ae)continue;const ke=(de+G)*D+ve+G;if(1===Ae)ue[ke]=0,J[ke]=ba;else{const ct=.5-Ae;ue[ke]=ct>0?ct*ct:0,J[ke]=ct<0?ct*ct:0}}H0(ue,0,0,D,k,D,this.f,this.v,this.z),H0(J,G,G,S,E,D,this.f,this.v,this.z);for(let de=0;de<O;de++){const ve=Math.sqrt(ue[de])-Math.sqrt(J[de]);F[de]=Math.round(255-255*(ve/this.radius+this.cutoff))}return V}};function cy(a,o,l,u){const f=[],b=a.image,v=b.pixelRatio,S=b.paddedRect.w-2,E=b.paddedRect.h-2,D=a.right-a.left,k=a.bottom-a.top,O=b.stretchX||[[0,S]],F=b.stretchY||[[0,E]],V=(dt,It)=>dt+It[1]-It[0],U=O.reduce(V,0),G=F.reduce(V,0),J=S-U,ue=E-G;let we=0,de=U,ve=0,Ae=G,ke=0,ct=J,st=0,yt=ue;if(b.content&&u){const dt=b.content;we=$g(O,0,dt[0]),ve=$g(F,0,dt[1]),de=$g(O,dt[0],dt[2]),Ae=$g(F,dt[1],dt[3]),ke=dt[0]-we,st=dt[1]-ve,ct=dt[2]-dt[0]-de,yt=dt[3]-dt[1]-Ae}const Ht=(dt,It,Et,Lt)=>{const Zt=qg(dt.stretch-we,de,D,a.left),mt=ki(dt.fixed-ke,ct,dt.stretch,U),an=qg(It.stretch-ve,Ae,k,a.top),En=ki(It.fixed-st,yt,It.stretch,G),gn=qg(Et.stretch-we,de,D,a.left),fi=ki(Et.fixed-ke,ct,Et.stretch,U),Qt=qg(Lt.stretch-ve,Ae,k,a.top),$n=ki(Lt.fixed-st,yt,Lt.stretch,G),_i=new ge(Zt,an),Ki=new ge(gn,an),yi=new ge(gn,Qt),Qn=new ge(Zt,Qt),er=new ge(mt/v,En/v),mi=new ge(fi/v,$n/v),gi=o*Math.PI/180;if(gi){const Sr=Math.sin(gi),Cr=Math.cos(gi),no=[Cr,-Sr,Sr,Cr];_i._matMult(no),Ki._matMult(no),Qn._matMult(no),yi._matMult(no)}const dr=dt.stretch+dt.fixed,Br=It.stretch+It.fixed;return{tl:_i,tr:Ki,bl:Qn,br:yi,tex:{x:b.paddedRect.x+1+dr,y:b.paddedRect.y+1+Br,w:Et.stretch+Et.fixed-dr,h:Lt.stretch+Lt.fixed-Br},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:er,pixelOffsetBR:mi,minFontScaleX:ct/v/D,minFontScaleY:yt/v/k,isSDF:l}};if(u&&(b.stretchX||b.stretchY)){const dt=$0(O,J,U),It=$0(F,ue,G);for(let Et=0;Et<dt.length-1;Et++){const Lt=dt[Et],Zt=dt[Et+1];for(let mt=0;mt<It.length-1;mt++)f.push(Ht(Lt,It[mt],Zt,It[mt+1]))}}else f.push(Ht({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:S+1},{fixed:0,stretch:E+1}));return f}function $g(a,o,l){let u=0;for(const f of a)u+=Math.max(o,Math.min(l,f[1]))-Math.max(o,Math.min(l,f[0]));return u}function $0(a,o,l){const u=[{fixed:-1,stretch:0}];for(const[f,b]of a){const v=u[u.length-1];u.push({fixed:f-v.stretch,stretch:v.stretch}),u.push({fixed:f-v.stretch,stretch:v.stretch+(b-f)})}return u.push({fixed:o+1,stretch:l}),u}function qg(a,o,l,u){return a/o*l+u}function ki(a,o,l,u){return a-o*l/u}function Fe(a,o,l,u){const f=o+a.positionedLines[u].lineOffset;return 0===u?l+f/2:l+(f+(o+a.positionedLines[u-1].lineOffset))/2}class q0{constructor(o=[],l=G0){if(this.data=o,this.length=this.data.length,this.compare=l,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(o){this.data.push(o),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const o=this.data[0],l=this.data.pop();return this.length--,this.length>0&&(this.data[0]=l,this._down(0)),o}peek(){return this.data[0]}_up(o){const{data:l,compare:u}=this,f=l[o];for(;o>0;){const b=o-1>>1,v=l[b];if(u(f,v)>=0)break;l[o]=v,o=b}l[o]=f}_down(o){const{data:l,compare:u}=this,f=this.length>>1,b=l[o];for(;o<f;){let v=1+(o<<1),S=l[v];const E=v+1;if(E<this.length&&u(l[E],S)<0&&(v=E,S=l[E]),u(S,b)>=0)break;l[o]=S,o=v}l[o]=b}}function G0(a,o){return a<o?-1:a>o?1:0}function V1(a,o=1,l=!1){let u=1/0,f=1/0,b=-1/0,v=-1/0;const S=a[0];for(let V=0;V<S.length;V++){const U=S[V];(!V||U.x<u)&&(u=U.x),(!V||U.y<f)&&(f=U.y),(!V||U.x>b)&&(b=U.x),(!V||U.y>v)&&(v=U.y)}const E=Math.min(b-u,v-f);let D=E/2;const k=new q0([],j1);if(0===E)return new ge(u,f);for(let V=u;V<b;V+=E)for(let U=f;U<v;U+=E)k.push(new Jd(V+D,U+D,D,a));let O=function(V){let U=0,G=0,J=0;const ue=V[0];for(let we=0,de=ue.length,ve=de-1;we<de;ve=we++){const Ae=ue[we],ke=ue[ve],ct=Ae.x*ke.y-ke.x*Ae.y;G+=(Ae.x+ke.x)*ct,J+=(Ae.y+ke.y)*ct,U+=3*ct}return new Jd(G/U,J/U,0,V)}(a),F=k.length;for(;k.length;){const V=k.pop();(V.d>O.d||!O.d)&&(O=V,l&&console.log("found best %d after %d probes",Math.round(1e4*V.d)/1e4,F)),V.max-O.d<=o||(D=V.h/2,k.push(new Jd(V.p.x-D,V.p.y-D,D,a)),k.push(new Jd(V.p.x+D,V.p.y-D,D,a)),k.push(new Jd(V.p.x-D,V.p.y+D,D,a)),k.push(new Jd(V.p.x+D,V.p.y+D,D,a)),F+=4)}return l&&(console.log(`num probes: ${F}`),console.log(`best distance: ${O.d}`)),O.p}function j1(a,o){return o.max-a.max}class Jd{constructor(o,l,u,f){this.p=new ge(o,l),this.h=u,this.d=function(b,v){let S=!1,E=1/0;for(let D=0;D<v.length;D++){const k=v[D];for(let O=0,F=k.length,V=F-1;O<F;V=O++){const U=k[O],G=k[V];U.y>b.y!=G.y>b.y&&b.x<(G.x-U.x)*(b.y-U.y)/(G.y-U.y)+U.x&&(S=!S),E=Math.min(E,_g(b,U,G))}}return(S?1:-1)*Math.sqrt(E)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}}const Gg=Number.POSITIVE_INFINITY,U1=Math.sqrt(2);function W0(a,[o,l]){let u=0,f=0;if(l===Gg){o<0&&(o=0);const b=o/U1;switch(a){case"top-right":case"top-left":f=b-7;break;case"bottom-right":case"bottom-left":f=7-b;break;case"bottom":f=7-o;break;case"top":f=o-7}switch(a){case"top-right":case"bottom-right":u=-b;break;case"top-left":case"bottom-left":u=b;break;case"left":u=o;break;case"right":u=-o}}else{switch(o=Math.abs(o),l=Math.abs(l),a){case"top-right":case"top-left":case"top":f=l-7;break;case"bottom-right":case"bottom-left":case"bottom":f=7-l}switch(a){case"top-right":case"bottom-right":case"right":u=-o;break;case"top-left":case"bottom-left":case"left":u=o}}return[u,f]}function TI(a,o,l,u,f,b,v,S,E,D){a.createArrays(),a.tilePixelRatio=Wn/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;const k=a.layers[0].layout,O=a.layers[0]._unevaluatedLayout._values,F={};if("composite"===a.textSizeData.kind){const{minZoom:G,maxZoom:J}=a.textSizeData;F.compositeTextSizes=[O["text-size"].possiblyEvaluate(new P(G),S),O["text-size"].possiblyEvaluate(new P(J),S)]}if("composite"===a.iconSizeData.kind){const{minZoom:G,maxZoom:J}=a.iconSizeData;F.compositeIconSizes=[O["icon-size"].possiblyEvaluate(new P(G),S),O["icon-size"].possiblyEvaluate(new P(J),S)]}F.layoutTextSize=O["text-size"].possiblyEvaluate(new P(E+1),S),F.layoutIconSize=O["icon-size"].possiblyEvaluate(new P(E+1),S),F.textMaxSize=O["text-size"].possiblyEvaluate(new P(18),S);const V="map"===k.get("text-rotation-alignment")&&"point"!==k.get("symbol-placement"),U=k.get("text-size");for(const G of a.features){const J=k.get("text-font").evaluate(G,{},S).join(","),ue=U.evaluate(G,{},S),we=F.layoutTextSize.evaluate(G,{},S),de=(F.layoutIconSize.evaluate(G,{},S),{horizontal:{},vertical:void 0}),ve=G.text;let Ae,ke=[0,0];if(ve){const yt=ve.toString(),Ht=24*k.get("text-letter-spacing").evaluate(G,{},S),dt=24*k.get("text-line-height").evaluate(G,{},S),It=f_(yt)?Ht:0,Et=k.get("text-anchor").evaluate(G,{},S),Lt=k.get("text-variable-anchor");if(!Lt){const gn=k.get("text-radial-offset").evaluate(G,{},S);ke=gn?W0(Et,[24*gn,Gg]):k.get("text-offset").evaluate(G,{},S).map(fi=>24*fi)}let Zt=V?"center":k.get("text-justify").evaluate(G,{},S);const mt="point"===k.get("symbol-placement"),an=mt?24*k.get("text-max-width").evaluate(G,{},S):1/0,En=gn=>{a.allowVerticalPlacement&&Ha(yt)&&(de.vertical=iy(ve,o,l,f,J,an,dt,Et,gn,It,ke,Ka.vertical,!0,we,ue))};if(!V&&Lt){const gn="auto"===Zt?Lt.map(Qt=>Wg(Qt)):[Zt];let fi=!1;for(let Qt=0;Qt<gn.length;Qt++){const $n=gn[Qt];if(!de.horizontal[$n])if(fi)de.horizontal[$n]=de.horizontal[0];else{const _i=iy(ve,o,l,f,J,an,dt,"center",$n,It,ke,Ka.horizontal,!1,we,ue);_i&&(de.horizontal[$n]=_i,fi=1===_i.positionedLines.length)}}En("left")}else{if("auto"===Zt&&(Zt=Wg(Et)),mt||k.get("text-writing-mode").indexOf("horizontal")>=0||!Ha(yt)){const gn=iy(ve,o,l,f,J,an,dt,Et,Zt,It,ke,Ka.horizontal,!1,we,ue);gn&&(de.horizontal[Zt]=gn)}En(mt?"left":Zt)}}let ct=!1;if(G.icon&&G.icon.name){const yt=u[G.icon.name];yt&&(Ae=CI(f[G.icon.name],k.get("icon-offset").evaluate(G,{},S),k.get("icon-anchor").evaluate(G,{},S)),ct=yt.sdf,void 0===a.sdfIcons?a.sdfIcons=yt.sdf:a.sdfIcons!==yt.sdf&&ln("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(yt.pixelRatio!==a.pixelRatio||0!==k.get("icon-rotate").constantOr(1))&&(a.iconsNeedLinear=!0))}const st=Zg(de.horizontal)||de.vertical;a.iconsInText||(a.iconsInText=!!st&&st.iconsInText),(st||Ae)&&X0(a,G,de,Ae,u,F,we,0,ke,ct,v,S,D)}b&&a.generateCollisionDebugBuffers(E,a.collisionBoxArray)}function Wg(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function X0(a,o,l,u,f,b,v,S,E,D,k,O,F){let V=b.textMaxSize.evaluate(o,{},O);void 0===V&&(V=v);const U=a.layers[0].layout,G=U.get("icon-offset").evaluate(o,{},O),J=Zg(l.horizontal)||l.vertical,ue="globe"===F.name,de=v/24,ve=a.tilePixelRatio*V/24,Ae=(Et=a.overscaling,a.zoom>18&&Et>2&&(Et>>=1),Math.max(Wn/(512*Et),1)*U.get("symbol-spacing")),ke=U.get("text-padding")*a.tilePixelRatio,ct=U.get("icon-padding")*a.tilePixelRatio,st=Be(U.get("text-max-angle")),yt="map"===U.get("text-rotation-alignment")&&"point"!==U.get("symbol-placement"),Ht="map"===U.get("icon-rotation-alignment")&&"point"!==U.get("symbol-placement"),dt=U.get("symbol-placement"),It=Ae/2;var Et;const Lt=U.get("icon-text-fit");let Zt;u&&"none"!==Lt&&(a.allowVerticalPlacement&&l.vertical&&(Zt=F1(u,l.vertical,Lt,U.get("icon-text-fit-padding"),G,de)),J&&(u=F1(u,J,Lt,U.get("icon-text-fit-padding"),G,de)));const mt=(an,En,gn)=>{if(En.x<0||En.x>=Wn||En.y<0||En.y>=Wn)return;let fi=null;if(ue){const{x:Qt,y:$n,z:_i}=F.projectTilePoint(En.x,En.y,gn);fi={anchor:new Sc(Qt,$n,_i,0,void 0),up:F.upVector(gn,En.x,En.y)}}!function(Qt,$n,_i,Ki,yi,Qn,er,mi,gi,dr,Br,Sr,Cr,no,co,io,Ar,Uo,Io,uo,sr,Mo,zr,Bs,Yt){const cs=Qt.addToLineVertexArray($n,Ki);let Lo,na,Yo,Xl,vp,Qf,Jf,em=0,Qu=0,oC=0,xp=0,Ey=-1,Dy=-1;const Cl={};let lx=os("");const ia=_i?_i.anchor:$n;let ah=0,Ss=0;if(void 0===gi._unevaluatedLayout.getValue("text-radial-offset")?[ah,Ss]=gi.layout.get("text-offset").evaluate(sr,{},Yt).map(Sn=>24*Sn):(ah=24*gi.layout.get("text-radial-offset").evaluate(sr,{},Yt),Ss=Gg),Qt.allowVerticalPlacement&&yi.vertical){const Sn=yi.vertical;if(co)Qf=Z0(Sn),mi&&(Jf=Z0(mi));else{const us=gi.layout.get("text-rotate").evaluate(sr,{},Yt)+90;Yo=Yg(dr,ia,$n,Br,Sr,Cr,Sn,no,us,io),mi&&(Xl=Yg(dr,ia,$n,Br,Sr,Cr,mi,Uo,us))}}if(Qn){const Sn=gi.layout.get("icon-rotate").evaluate(sr,{},Yt),us="none"!==gi.layout.get("icon-text-fit"),Ic=cy(Qn,Sn,zr,us),Ju=mi?cy(mi,Sn,zr,us):void 0;na=Yg(dr,ia,$n,Br,Sr,Cr,Qn,Uo,Sn),em=4*Ic.length;const lh=Qt.iconSizeData;let El=null;"source"===lh.kind?(El=[xl*gi.layout.get("icon-size").evaluate(sr,{},Yt)],El[0]>Gu&&ln(`${Qt.layerIds[0]}: Value for "icon-size" is >= ${Xr}. Reduce your "icon-size".`)):"composite"===lh.kind&&(El=[xl*Mo.compositeIconSizes[0].evaluate(sr,{},Yt),xl*Mo.compositeIconSizes[1].evaluate(sr,{},Yt)],(El[0]>Gu||El[1]>Gu)&&ln(`${Qt.layerIds[0]}: Value for "icon-size" is >= ${Xr}. Reduce your "icon-size".`)),Qt.addSymbols(Qt.icon,Ic,El,uo,Io,sr,!1,_i,$n,cs.lineStartIndex,cs.lineLength,-1,Bs,Yt),Ey=Qt.icon.placedSymbolArray.length-1,Ju&&(Qu=4*Ju.length,Qt.addSymbols(Qt.icon,Ju,El,uo,Io,sr,Ka.vertical,_i,$n,cs.lineStartIndex,cs.lineLength,-1,Bs,Yt),Dy=Qt.icon.placedSymbolArray.length-1)}for(const Sn in yi.horizontal){const us=yi.horizontal[Sn];Lo||(lx=os(us.text),co?vp=Z0(us):Lo=Yg(dr,ia,$n,Br,Sr,Cr,us,no,gi.layout.get("text-rotate").evaluate(sr,{},Yt),io));const Ic=1===us.positionedLines.length;if(oC+=Xg(Qt,_i,$n,us,er,gi,co,sr,io,cs,yi.vertical?Ka.horizontal:Ka.horizontalOnly,Ic?Object.keys(yi.horizontal):[Sn],Cl,Ey,Mo,Bs,Yt),Ic)break}yi.vertical&&(xp+=Xg(Qt,_i,$n,yi.vertical,er,gi,co,sr,io,cs,Ka.vertical,["vertical"],Cl,Dy,Mo,Bs,Yt));let Ra=-1;const wp=(Sn,us)=>Sn?Math.max(Sn,us):us;Ra=wp(vp,Ra),Ra=wp(Qf,Ra),Ra=wp(Jf,Ra);const Tl=Ra>-1?1:0;Qt.glyphOffsetArray.length>=Xu.MAX_GLYPHS&&ln("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==sr.sortKey&&Qt.addToSortKeyRanges(Qt.symbolInstances.length,sr.sortKey),Qt.symbolInstances.emplaceBack(ia.x,ia.y,ia.z,$n.x,$n.y,Cl.right>=0?Cl.right:-1,Cl.center>=0?Cl.center:-1,Cl.left>=0?Cl.left:-1,Cl.vertical>=0?Cl.vertical:-1,Ey,Dy,lx,void 0!==Lo?Lo:Qt.collisionBoxArray.length,void 0!==Lo?Lo+1:Qt.collisionBoxArray.length,void 0!==Yo?Yo:Qt.collisionBoxArray.length,void 0!==Yo?Yo+1:Qt.collisionBoxArray.length,void 0!==na?na:Qt.collisionBoxArray.length,void 0!==na?na+1:Qt.collisionBoxArray.length,Xl||Qt.collisionBoxArray.length,Xl?Xl+1:Qt.collisionBoxArray.length,Br,oC,xp,em,Qu,Tl,0,ah,Ss,Ra)}(a,En,fi,an,l,u,f,Zt,a.layers[0],a.collisionBoxArray,o.index,o.sourceLayerIndex,a.index,ke,yt,E,0,ct,Ht,G,o,b,D,k,O)};if("line"===dt)for(const an of U0(o.geometry,0,0,Wn,Wn)){const En=V0(an,Ae,st,l.vertical||J,u,24,ve,a.overscaling,Wn);for(const gn of En)J&&EI(a,J.text,It,gn)||mt(an,gn,O)}else if("line-center"===dt){for(const an of o.geometry)if(an.length>1){const En=z1(an,st,l.vertical||J,u,24,ve);En&&mt(an,En,O)}}else if("Polygon"===o.type)for(const an of Ff(o.geometry,0)){const En=V1(an,16);mt(an[0],new Sc(En.x,En.y,0,0,void 0),O)}else if("LineString"===o.type)for(const an of o.geometry)mt(an,new Sc(an[0].x,an[0].y,0,0,void 0),O);else if("Point"===o.type)for(const an of o.geometry)for(const En of an)mt([En],new Sc(En.x,En.y,0,0,void 0),O)}const Xr=255,Gu=Xr*xl;function Xg(a,o,l,u,f,b,v,S,E,D,k,O,F,V,U,G,J){const ue=function(ve,Ae,ke,ct,st,yt,Ht,dt){const It=[];if(0===Ae.positionedLines.length)return It;const Et=ct.layout.get("text-rotate").evaluate(yt,{})*Math.PI/180,Lt=function(gn){const fi=gn[0],Qt=gn[1],$n=fi*Qt;return $n>0?[fi,-Qt]:$n<0?[-fi,Qt]:0===fi?[Qt,fi]:[Qt,-fi]}(ke);let Zt=Math.abs(Ae.top-Ae.bottom);for(const gn of Ae.positionedLines)Zt-=gn.lineOffset;const mt=Ae.positionedLines.length,an=Zt/mt;let En=Ae.top-ke[1];for(let gn=0;gn<mt;++gn){const fi=Ae.positionedLines[gn];En=Fe(Ae,an,En,gn);for(const Qt of fi.positionedGlyphs){if(!Qt.rect)continue;const $n=Qt.rect||{};let _i=4,Ki=!0,yi=1,Qn=0;if(Qt.imageName){const zr=Ht[Qt.imageName];if(!zr)continue;if(zr.sdf){ln("SDF images are not supported in formatted text and will be ignored.");continue}Ki=!1,yi=zr.pixelRatio,_i=1/yi}const er=(st||dt)&&Qt.vertical,mi=Qt.metrics.advance*Qt.scale/2,gi=Qt.metrics,dr=Qt.rect;if(null===dr)continue;dt&&Ae.verticalizable&&(Qn=Qt.imageName?mi-Qt.metrics.width*Qt.scale/2:0);const Br=st?[Qt.x+mi,Qt.y]:[0,0];let Sr=[0,0],Cr=[0,0],no=!1;st||(er?(Cr=[Qt.x+mi+Lt[0],Qt.y+Lt[1]-Qn],no=!0):Sr=[Qt.x+mi+ke[0],Qt.y+ke[1]-Qn]);const co=dr.w*Qt.scale/(yi*(Qt.localGlyph?2:1)),io=dr.h*Qt.scale/(yi*(Qt.localGlyph?2:1));let Ar,Uo,Io,uo;if(er){const zr=Qt.y-En,Bs=new ge(-mi,mi-zr),Yt=-Math.PI/2,cs=new ge(...Cr);Ar=new ge(-mi+Sr[0],Sr[1]),Ar._rotateAround(Yt,Bs)._add(cs),Ar.x+=-zr+mi,Ar.y-=(gi.left-_i)*Qt.scale;const Lo=Qt.imageName?gi.advance*Qt.scale:24*Qt.scale,na=String.fromCharCode(Qt.glyph);Q_(na)?Ar.x+=(1-_i)*Qt.scale:Ng(na)?Ar.x+=Lo-gi.height*Qt.scale+(-_i-1)*Qt.scale:Ar.x+=Qt.imageName||gi.width+2*_i===dr.w&&gi.height+2*_i===dr.h?(Lo-io)/2:(Lo-(gi.height+2*_i)*Qt.scale)/2,Uo=new ge(Ar.x,Ar.y-co),Io=new ge(Ar.x+io,Ar.y),uo=new ge(Ar.x+io,Ar.y-co)}else{const zr=(gi.left-_i)*Qt.scale-mi+Sr[0],Bs=(-gi.top-_i)*Qt.scale+Sr[1],Yt=zr+co,cs=Bs+io;Ar=new ge(zr,Bs),Uo=new ge(Yt,Bs),Io=new ge(zr,cs),uo=new ge(Yt,cs)}if(Et){let zr;zr=st?new ge(0,0):no?new ge(Lt[0],Lt[1]):new ge(ke[0],ke[1]),Ar._rotateAround(Et,zr),Uo._rotateAround(Et,zr),Io._rotateAround(Et,zr),uo._rotateAround(Et,zr)}const sr=new ge(0,0),Mo=new ge(0,0);It.push({tl:Ar,tr:Uo,bl:Io,br:uo,tex:$n,writingMode:Ae.writingMode,glyphOffset:Br,sectionIndex:Qt.sectionIndex,isSDF:Ki,pixelOffsetTL:sr,pixelOffsetBR:Mo,minFontScaleX:0,minFontScaleY:0})}}return It}(0,u,E,b,v,S,f,a.allowVerticalPlacement),we=a.textSizeData;let de=null;"source"===we.kind?(de=[xl*b.layout.get("text-size").evaluate(S,{},J)],de[0]>Gu&&ln(`${a.layerIds[0]}: Value for "text-size" is >= ${Xr}. Reduce your "text-size".`)):"composite"===we.kind&&(de=[xl*U.compositeTextSizes[0].evaluate(S,{},J),xl*U.compositeTextSizes[1].evaluate(S,{},J)],(de[0]>Gu||de[1]>Gu)&&ln(`${a.layerIds[0]}: Value for "text-size" is >= ${Xr}. Reduce your "text-size".`)),a.addSymbols(a.text,ue,de,E,v,S,k,o,l,D.lineStartIndex,D.lineLength,V,G,J);for(const ve of O)F[ve]=a.text.placedSymbolArray.length-1;return 4*ue.length}function Zg(a){for(const o in a)return a[o];return null}function Yg(a,o,l,u,f,b,v,S,E,D){let k=v.top,O=v.bottom,F=v.left,V=v.right;const U=v.collisionPadding;if(U&&(F-=U[0],k-=U[1],V+=U[2],O+=U[3]),E){const G=new ge(F,k),J=new ge(V,k),ue=new ge(F,O),we=new ge(V,O),de=Be(E);let ve=new ge(0,0);D&&(ve=new ge(D[0],D[1])),G._rotateAround(de,ve),J._rotateAround(de,ve),ue._rotateAround(de,ve),we._rotateAround(de,ve),F=Math.min(G.x,J.x,ue.x,we.x),V=Math.max(G.x,J.x,ue.x,we.x),k=Math.min(G.y,J.y,ue.y,we.y),O=Math.max(G.y,J.y,ue.y,we.y)}return a.emplaceBack(o.x,o.y,o.z,l.x,l.y,F,k,V,O,S,u,f,b),a.length-1}function Z0(a){a.collisionPadding&&(a.top-=a.collisionPadding[1],a.bottom+=a.collisionPadding[3]);const o=a.bottom-a.top;return o>0?Math.max(10,o):null}function EI(a,o,l,u){const f=a.compareText;if(o in f){const b=f[o];for(let v=b.length-1;v>=0;v--)if(u.dist(b[v])<l)return!0}else f[o]=[];return f[o].push(u),!1}function H1(a,o){const l=a.fovAboveCenter,u=a.elevation?a.elevation.getMinElevationBelowMSL()*o:0,f=(a._camera.position[2]*a.worldSize-u)/Math.cos(a._pitch),b=Math.sin(l)*f/Math.sin(Math.max(Math.PI/2-a._pitch-l,.01)),v=Math.sin(a._pitch)*b+f;return Math.min(1.01*v,f*(1/a._horizonShift))}function eh(a,o){if(!o.isReprojectedInTileSpace)return{scale:1<<a.z,x:a.x,y:a.y,x2:a.x+1,y2:a.y+1,projection:o};const l=Math.pow(2,-a.z),u=a.x*l,f=(a.x+1)*l,b=a.y*l,v=(a.y+1)*l,S=Xa(u),E=Xa(f),D=Mr(b),k=Mr(v),O=o.project(S,D),F=o.project(E,D),V=o.project(E,k),U=o.project(S,k);let G=Math.min(O.x,F.x,V.x,U.x),J=Math.min(O.y,F.y,V.y,U.y),ue=Math.max(O.x,F.x,V.x,U.x),we=Math.max(O.y,F.y,V.y,U.y);const de=l/16;function ve(ke,ct,st,yt,Ht,dt){const It=(st+Ht)/2,Et=(yt+dt)/2,Lt=o.project(Xa(It),Mr(Et)),Zt=Math.max(0,G-Lt.x,J-Lt.y,Lt.x-ue,Lt.y-we);G=Math.min(G,Lt.x),ue=Math.max(ue,Lt.x),J=Math.min(J,Lt.y),we=Math.max(we,Lt.y),Zt>de&&(ve(ke,Lt,st,yt,It,Et),ve(Lt,ct,It,Et,Ht,dt))}ve(O,F,u,b,f,b),ve(F,V,f,b,f,v),ve(V,U,f,v,u,v),ve(U,O,u,v,u,b),G-=de,J-=de,ue+=de,we+=de;const Ae=1/Math.max(ue-G,we-J);return{scale:Ae,x:G*Ae,y:J*Ae,x2:ue*Ae,y2:we*Ae,projection:o}}const Y0=Do(new Float32Array(16));class th{constructor(o){this.spec=o,this.name=o.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(o,l){return{x:0,y:0,z:0}}unproject(o,l){return new Ir(0,0)}projectTilePoint(o,l,u){return{x:o,y:l,z:0}}locationPoint(o,l,u=!0){return o._coordinatePoint(o.locationCoordinate(l),u)}pixelsPerMeter(o,l){return Hl(1,o)*l}pixelSpaceConversion(o,l,u){return 1}farthestPixelDistance(o){return H1(o,o.pixelsPerMeter)}pointCoordinate(o,l,u,f){const b=o.horizonLineFromTop(!1),v=new ge(l,Math.max(b,u));return o.rayIntersectionCoordinate(o.pointRayIntersection(v,f))}pointCoordinate3D(o,l,u){const f=new ge(l,u);if(o.elevation)return o.elevation.pointCoordinate(f);{const b=this.pointCoordinate(o,f.x,f.y,0);return[b.x,b.y,b.z]}}isPointAboveHorizon(o,l){if(o.elevation)return!this.pointCoordinate3D(o,l.x,l.y);const u=o.horizonLineFromTop();return l.y<u}createInversionMatrix(o,l){return Y0}createTileMatrix(o,l,u){let f,b,v;const S=u.canonical,E=Do(new Float64Array(16));if(this.isReprojectedInTileSpace){const D=eh(S,this);f=1,b=D.x+u.wrap*D.scale,v=D.y,Fu(E,E,[f/D.scale,f/D.scale,o.pixelsPerMeter/l])}else f=l/o.zoomScale(S.z),b=(S.x+Math.pow(2,S.z)*u.wrap)*f,v=S.y*f;return ng(E,E,[b,v,0]),Fu(E,E,[f/Wn,f/Wn,1]),E}upVector(o,l,u){return[0,0,1]}upVectorScale(o,l,u){return{metersToTile:1}}}class $1 extends th{constructor(o){super(o),this.range=[4,7],this.center=o.center||[-96,37.5];const[l,u]=this.parallels=o.parallels||[29.5,45.5],f=Math.sin(Be(l));this.n=(f+Math.sin(Be(u)))/2,this.c=1+f*(2*this.n-f),this.r0=Math.sqrt(this.c)/this.n}project(o,l){const{n:u,c:f,r0:b}=this,v=Be(o-this.center[0]),S=Be(l),E=Math.sqrt(f-2*u*Math.sin(S))/u;return{x:E*Math.sin(v*u),y:E*Math.cos(v*u)-b,z:0}}unproject(o,l){const{n:u,c:f,r0:b}=this,v=b+l;let S=Math.atan2(o,Math.abs(v))*Math.sign(v);v*u<0&&(S-=Math.PI*Math.sign(o)*Math.sign(v));const E=Be(this.center[0])*u;S=Mt(S,-Math.PI-E,Math.PI-E);const D=lt(K(S/u)+this.center[0],-180,180),k=Math.asin(lt((f-(o*o+v*v)*u*u)/(2*u),-1,1)),O=lt(K(k),-ls,ls);return new Ir(D,O)}}const Cc=1.340264,$f=-.081106,mp=893e-6,Wu=.003796,Kg=Math.sqrt(3)/2;class K0 extends th{project(o,l){l=l/180*Math.PI,o=o/180*Math.PI;const u=Math.asin(Kg*Math.sin(l)),f=u*u,b=f*f*f;return{x:.5*(o*Math.cos(u)/(Kg*(Cc+3*$f*f+b*(7*mp+9*Wu*f)))/Math.PI+.5),y:1-.5*(u*(Cc+$f*f+b*(mp+Wu*f))/Math.PI+1),z:0}}unproject(o,l){o=(2*o-.5)*Math.PI;let u=l=(2*(1-l)-1)*Math.PI,f=u*u,b=f*f*f;for(let k,O,F,V=0;V<12&&(O=u*(Cc+$f*f+b*(mp+Wu*f))-l,F=Cc+3*$f*f+b*(7*mp+9*Wu*f),k=O/F,u=lt(u-k,-Math.PI/3,Math.PI/3),f=u*u,b=f*f*f,!(Math.abs(k)<1e-12));++V);const v=Kg*o*(Cc+3*$f*f+b*(7*mp+9*Wu*f))/Math.cos(u),S=Math.asin(Math.sin(u)/Kg),E=lt(180*v/Math.PI,-180,180),D=lt(180*S/Math.PI,-ls,ls);return new Ir(E,D)}}class q1 extends th{constructor(o){super(o),this.wrap=!0,this.supportsWorldCopies=!0}project(o,l){return{x:.5+o/360,y:.5-l/360,z:0}}unproject(o,l){const u=360*(o-.5),f=lt(360*(.5-l),-ls,ls);return new Ir(u,f)}}const gp=Math.PI/2;function Qg(a){return Math.tan((gp+a)/2)}class G1 extends th{constructor(o){super(o),this.center=o.center||[0,30];const[l,u]=this.parallels=o.parallels||[30,30];let f=Be(l),b=Be(u);this.southernCenter=f+b<0,this.southernCenter&&(f=-f,b=-b);const v=Math.cos(f),S=Qg(f);this.n=f===b?Math.sin(f):Math.log(v/Math.cos(b))/Math.log(Qg(b)/S),this.f=v*Math.pow(Qg(f),this.n)/this.n}project(o,l){l=Be(l),this.southernCenter&&(l=-l),o=Be(o-this.center[0]);const u=1e-6,{n:f,f:b}=this;b>0?l<-gp+u&&(l=-gp+u):l>gp-u&&(l=gp-u);const v=b/Math.pow(Qg(l),f);let S=v*Math.sin(f*o),E=b-v*Math.cos(f*o);return S=.5*(S/Math.PI+.5),E=.5*(E/Math.PI+.5),{x:S,y:this.southernCenter?E:1-E,z:0}}unproject(o,l){o=(2*o-.5)*Math.PI,this.southernCenter&&(l=1-l),l=(2*(1-l)-.5)*Math.PI;const{n:u,f}=this,b=f-l,v=Math.sign(b),S=Math.sign(u)*Math.sqrt(o*o+b*b);let E=Math.atan2(o,Math.abs(b))*v;b*u<0&&(E-=Math.PI*Math.sign(o)*v);const D=lt(K(E/u)+this.center[0],-180,180),k=lt(K(2*Math.atan(Math.pow(f/S,1/u))-gp),-ls,ls);return new Ir(D,this.southernCenter?-k:k)}}class Q0 extends th{constructor(o){super(o),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(o,l){return{x:gc(o),y:Ul(l),z:0}}unproject(o,l){const u=Xa(o),f=Mr(l);return new Ir(u,f)}}const uy=Be(ls);class W1 extends th{project(o,l){const u=(l=Be(l))*l,f=u*u;return{x:.5*((o=Be(o))*(.8707-.131979*u+f*(f*(.003971*u-.001529*f)-.013791))/Math.PI+.5),y:1-.5*(l*(1.007226+u*(.015085+f*(.028874*u-.044475-.005916*f)))/Math.PI+1),z:0}}unproject(o,l){o=(2*o-.5)*Math.PI;let u=l=(2*(1-l)-1)*Math.PI,f=25,b=0,v=u*u;do{v=u*u;const D=v*v;b=(u*(1.007226+v*(.015085+D*(.028874*v-.044475-.005916*D)))-l)/(1.007226+v*(.045255+D*(.259866*v-.311325-.005916*11*D))),u=lt(u-b,-uy,uy)}while(Math.abs(b)>1e-6&&--f>0);v=u*u;const S=lt(K(o/(.8707+v*(v*(v*v*v*(.003971-.001529*v)-.013791)-.131979))),-180,180),E=K(u);return new Ir(S,E)}}const dy=Be(ls);class J0 extends th{project(o,l){l=Be(l),o=Be(o);const u=Math.cos(l),f=2/Math.PI,b=Math.acos(u*Math.cos(o/2)),v=Math.sin(b)/b,S=.5*(o*f+2*u*Math.sin(o/2)/v)||0,E=.5*(l+Math.sin(l)/v)||0;return{x:.5*(S/Math.PI+.5),y:1-.5*(E/Math.PI+1),z:0}}unproject(o,l){let u=o=(2*o-.5)*Math.PI,f=l=(2*(1-l)-1)*Math.PI,b=25;const v=1e-6;let S=0,E=0;do{const D=Math.cos(f),k=Math.sin(f),O=2*k*D,F=k*k,V=D*D,U=Math.cos(u/2),G=Math.sin(u/2),J=2*U*G,ue=G*G,we=1-V*U*U,de=we?1/we:0,ve=we?Math.acos(D*U)*Math.sqrt(1/we):0,Ae=.5*(2*ve*D*G+2*u/Math.PI)-o,ke=.5*(ve*k+f)-l,ct=.5*de*(V*ue+ve*D*U*F)+1/Math.PI,st=de*(J*O/4-ve*k*G),yt=.125*de*(O*G-ve*k*V*J),Ht=.5*de*(F*U+ve*ue*D)+.5,dt=st*yt-Ht*ct;S=(ke*st-Ae*Ht)/dt,E=(Ae*yt-ke*ct)/dt,u=lt(u-S,-Math.PI,Math.PI),f=lt(f-E,-dy,dy)}while((Math.abs(S)>v||Math.abs(E)>v)&&--b>0);return new Ir(K(u),K(f))}}class Jg extends th{constructor(o){super(o),this.center=o.center||[0,0],this.parallels=o.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Be(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(o,l){const{scale:u,cosPhi:f}=this;return{x:Be(o)*f*u+.5,y:-Math.sin(Be(l))/f*u+.5,z:0}}unproject(o,l){const{scale:u,cosPhi:f}=this,b=-(l-.5)/u,v=lt(K((o-.5)/u)/f,-180,180),S=Math.asin(lt(b*f,-1,1)),E=lt(K(S),-ls,ls);return new Ir(v,E)}}class DI extends Q0{constructor(o){super(o),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(o,l,u){const f=lg(o,l,u);return Ue(f,f,Mf(Kc(u))),{x:f[0],y:f[1],z:f[2]}}locationPoint(o,l){const u=If(l.lat,l.lng),f=Zo([],u),b=o.elevation?o.elevation.getAtPointOrZero(o.locationCoordinate(l),o._centerAltitude):o._centerAltitude;Qh(u,u,f,Hl(1,0)*Wn*b);const v=Do(new Float64Array(16));return _l(v,o.pixelMatrix,o.globeMatrix),Ue(u,u,v),new ge(u[0],u[1])}pixelsPerMeter(o,l){return Hl(1,0)*l}pixelSpaceConversion(o,l,u){const f=Hl(1,o)*l,b=qi(Hl(1,45)*l,f,u);return this.pixelsPerMeter(o,l)/b}createTileMatrix(o,l,u){const f=cg(Kc(u.canonical));return _l(new Float64Array(16),o.globeMatrix,f)}createInversionMatrix(o,l){const{center:u}=o,f=Mf(Kc(l));return ig(f,f,Be(u.lng)),b_(f,f,Be(u.lat)),Fu(f,f,[o._pixelsPerMercatorPixel,o._pixelsPerMercatorPixel,1]),Float32Array.from(f)}pointCoordinate(o,l,u,f){return T_(o,l,u,!0)||new Vo(0,0)}pointCoordinate3D(o,l,u){const f=this.pointCoordinate(o,l,u,0);return[f.x,f.y,f.z]}isPointAboveHorizon(o,l){return!T_(o,l.x,l.y,!1)}farthestPixelDistance(o){const l=function(f,b){const v=f.cameraToCenterDistance,S=f._centerAltitude*b,E=f._camera,D=f._camera.forward(),k=qa([],Ga([],D,-v),[0,0,S]),O=f.worldSize/(2*Math.PI),F=[0,0,-O],V=f.width/f.height,U=Math.tan(f.fovAboveCenter),G=Ga([],E.up(),U),J=Ga([],E.right(),U*V),ue=Zo([],qa([],qa([],D,G),J)),we=[];let de;if(new S_(k,ue).closestPointOnSphere(F,O,we)){const ve=qa([],we,F),Ae=Wa([],ve,k);de=Math.cos(f.fovAboveCenter)*Nu(Ae)}else{const ve=Wa([],k,F),Ae=Wa([],F,k);Zo(Ae,Ae);const ke=Nu(ve)-O;de=Math.sqrt(ke*(ke+2*O));const ct=Math.acos(de/(O+ke))-Math.acos(Ns(D,Ae));de*=Math.cos(ct)}return 1.01*de}(o,this.pixelsPerMeter(o.center.lat,o.worldSize)),u=Gd(o.zoom);if(u>0){const f=H1(o,Hl(1,o.center.lat)*o.worldSize),b=o.worldSize/(2*Math.PI),v=Math.max(o.width,o.height)/o.worldSize*Math.PI;return qi(l,f+b*(1-Math.cos(v)),Math.pow(u,10))}return l}upVector(o,l,u){return lg(l,u,o,1)}upVectorScale(o){return{metersToTile:og(D_(Kc(o)))}}}function eb(a){const o=a.parallels,l=!!o&&Math.abs(o[0]+o[1])<.01;switch(a.name){case"mercator":return new Q0(a);case"equirectangular":return new q1(a);case"naturalEarth":return new W1(a);case"equalEarth":return new K0(a);case"winkelTripel":return new J0(a);case"albers":return l?new Jg(a):new $1(a);case"lambertConformalConic":return l?new Jg(a):new G1(a);case"globe":return new DI(a)}throw new Error(`Invalid projection name: ${a.name}`)}const X1=vl.types,II=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function X(a,o,l,u,f,b,v,S,E,D,k,O,F){const V=S?Math.min(Gu,Math.round(S[0])):0,U=S?Math.min(Gu,Math.round(S[1])):0;a.emplaceBack(o,l,Math.round(32*u),Math.round(32*f),b,v,(V<<1)+(E?1:0),U,16*D,16*k,256*O,256*F)}function ru(a,o,l,u,f,b,v){a.emplaceBack(o,l,u,f,b,v)}function qf(a,o,l,u,f){a.emplaceBack(o,l,u,f),a.emplaceBack(o,l,u,f),a.emplaceBack(o,l,u,f),a.emplaceBack(o,l,u,f)}function tb(a){for(const o of a.sections)if(Km(o.text))return!0;return!1}class Qa{constructor(o){this.layoutVertexArray=new At,this.indexArray=new Vn,this.programConfigurations=o,this.segments=new to,this.dynamicLayoutVertexArray=new Vt,this.opacityVertexArray=new Un,this.placedSymbolArray=new yo,this.globeExtVertexArray=new qt}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(o,l,u,f){this.isEmpty()||(u&&(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,M0.members),this.indexBuffer=o.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=o.createVertexBuffer(this.dynamicLayoutVertexArray,A0.members,!0),this.opacityVertexBuffer=o.createVertexBuffer(this.opacityVertexArray,II,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=o.createVertexBuffer(this.globeExtVertexArray,E1.members,!0)),this.opacityVertexBuffer.itemSize=1),(u||f)&&this.programConfigurations.upload(o))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Mn(Qa,"SymbolBuffers");class nb{constructor(o,l,u){this.layoutVertexArray=new o,this.layoutAttributes=l,this.indexArray=new u,this.segments=new to,this.collisionVertexArray=new Ai,this.collisionVertexArrayExt=new wi}upload(o){this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=o.createVertexBuffer(this.collisionVertexArray,k0.members,!0),this.collisionVertexBufferExt=o.createVertexBuffer(this.collisionVertexArrayExt,Y_.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Mn(nb,"CollisionBuffers");class Xu{constructor(o){this.collisionBoxArray=o.collisionBoxArray,this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(v=>v.id),this.index=o.index,this.pixelRatio=o.pixelRatio,this.sourceLayerIndex=o.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Do([]),this.placementViewportMatrix=Do([]);const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Lg(this.zoom,l["text-size"]),this.iconSizeData=Lg(this.zoom,l["icon-size"]);const u=this.layers[0].layout,f=u.get("symbol-sort-key"),b=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==b&&void 0!==f.constantOr(1),this.sortFeaturesByY=("viewport-y"===b||"auto"===b&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(v=>Ka[v]),this.stateDependentLayerIds=this.layers.filter(v=>v.isStateDependent()).map(v=>v.id),this.sourceID=o.sourceID,this.projection=o.projection}createArrays(){this.text=new Qa(new Kh(this.layers,this.zoom,o=>/^text/.test(o))),this.icon=new Qa(new Kh(this.layers,this.zoom,o=>/^icon/.test(o))),this.glyphOffsetArray=new Fs,this.lineVertexArray=new Yh,this.symbolInstances=new Hr}calculateGlyphDependencies(o,l,u,f,b){for(let v=0;v<o.length;v++)if(l[o.charCodeAt(v)]=!0,f&&b){const S=jf[o.charAt(v)];S&&(l[S.charCodeAt(0)]=!0)}}populate(o,l,u,f){const b=this.layers[0],v=b.layout,S="globe"===this.projection.name,E=v.get("text-font"),D=v.get("text-field"),k=v.get("icon-image"),O=("constant"!==D.value.kind||D.value.value instanceof la&&!D.value.value.isEmpty()||D.value.value.toString().length>0)&&("constant"!==E.value.kind||E.value.value.length>0),F="constant"!==k.value.kind||!!k.value.value||Object.keys(k.parameters).length>0,V=v.get("symbol-sort-key");if(this.features=[],!O&&!F)return;const U=l.iconDependencies,G=l.glyphDependencies,J=l.availableImages,ue=new P(this.zoom);for(const{feature:we,id:de,index:ve,sourceLayerIndex:Ae}of o){const ke=b._featureFilter.needGeometry,ct=zu(we,ke);if(!b._featureFilter.filter(ue,ct,u))continue;if(ke||(ct.geometry=Qc(we,u,f)),S&&1!==we.type&&u.z<=5){const dt=ct.geometry,It=.98078528056,Et=(Lt,Zt)=>Ns(lg(Lt.x,Lt.y,u,1),lg(Zt.x,Zt.y,u,1))<It;for(let Lt=0;Lt<dt.length;Lt++)dt[Lt]=WS(dt[Lt],Et)}let st,yt;if(O){const dt=b.getValueAndResolveTokens("text-field",ct,u,J),It=la.factory(dt);tb(It)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===C()||this.hasRTLText&&A.isParsed())&&(st=Fg(It,b,ct))}if(F){const dt=b.getValueAndResolveTokens("icon-image",ct,u,J);yt=dt instanceof Fa?dt:Fa.fromString(dt)}if(!st&&!yt)continue;const Ht=this.sortFeaturesByKey?V.evaluate(ct,{},u):void 0;if(this.features.push({id:de,text:st,icon:yt,index:ve,sourceLayerIndex:Ae,geometry:ct.geometry,properties:we.properties,type:X1[we.type],sortKey:Ht}),yt&&(U[yt.name]=!0),st){const dt=E.evaluate(ct,{},u).join(","),It="map"===v.get("text-rotation-alignment")&&"point"!==v.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ka.vertical)>=0;for(const Et of st.sections)if(Et.image)U[Et.image.name]=!0;else{const Lt=Ha(st.toString()),Zt=Et.fontStack||dt,mt=G[Zt]=G[Zt]||{};this.calculateGlyphDependencies(Et.text,mt,It,this.allowVerticalPlacement,Lt)}}}"line"===v.get("symbol-placement")&&(this.features=function(we){const de={},ve={},Ae=[];let ke=0;function ct(dt){Ae.push(we[dt]),ke++}function st(dt,It,Et){const Lt=ve[dt];return delete ve[dt],ve[It]=Lt,Ae[Lt].geometry[0].pop(),Ae[Lt].geometry[0]=Ae[Lt].geometry[0].concat(Et[0]),Lt}function yt(dt,It,Et){const Lt=de[It];return delete de[It],de[dt]=Lt,Ae[Lt].geometry[0].shift(),Ae[Lt].geometry[0]=Et[0].concat(Ae[Lt].geometry[0]),Lt}function Ht(dt,It,Et){const Lt=Et?It[0][It[0].length-1]:It[0][0];return`${dt}:${Lt.x}:${Lt.y}`}for(let dt=0;dt<we.length;dt++){const It=we[dt],Et=It.geometry,Lt=It.text?It.text.toString():null;if(!Lt){ct(dt);continue}const Zt=Ht(Lt,Et),mt=Ht(Lt,Et,!0);if(Zt in ve&&mt in de&&ve[Zt]!==de[mt]){const an=yt(Zt,mt,Et),En=st(Zt,mt,Ae[an].geometry);delete de[Zt],delete ve[mt],ve[Ht(Lt,Ae[En].geometry,!0)]=En,Ae[an].geometry=null}else Zt in ve?st(Zt,mt,Et):mt in de?yt(Zt,mt,Et):(ct(dt),de[Zt]=ke-1,ve[mt]=ke-1)}return Ae.filter(dt=>dt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((we,de)=>we.sortKey-de.sortKey)}update(o,l,u,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(o,l,this.layers,u,f),this.icon.programConfigurations.updatePaintArrays(o,l,this.layers,u,f))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(o){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(o),this.iconCollisionBox.upload(o)),this.text.upload(o,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(o,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=eb(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(o,l){const u=this.lineVertexArray.length;if(void 0!==o.segment)for(const{x:f,y:b}of l)this.lineVertexArray.emplaceBack(f,b);return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(o,l,u,f,b,v,S,E,D,k,O,F,V,U){const G=o.indexArray,J=o.layoutVertexArray,ue=o.globeExtVertexArray,we=o.segments.prepareSegment(4*l.length,J,G,this.canOverlap?v.sortKey:void 0),de=this.glyphOffsetArray.length,ve=we.vertexLength,Ae=this.allowVerticalPlacement&&S===Ka.vertical?Math.PI/2:0,ke=v.text&&v.text.sections;for(let st=0;st<l.length;st++){const{tl:yt,tr:Ht,bl:dt,br:It,tex:Et,pixelOffsetTL:Lt,pixelOffsetBR:Zt,minFontScaleX:mt,minFontScaleY:an,glyphOffset:En,isSDF:gn,sectionIndex:fi}=l[st],Qt=we.vertexLength,$n=En[1];if(X(J,D.x,D.y,yt.x,$n+yt.y,Et.x,Et.y,u,gn,Lt.x,Lt.y,mt,an),X(J,D.x,D.y,Ht.x,$n+Ht.y,Et.x+Et.w,Et.y,u,gn,Zt.x,Lt.y,mt,an),X(J,D.x,D.y,dt.x,$n+dt.y,Et.x,Et.y+Et.h,u,gn,Lt.x,Zt.y,mt,an),X(J,D.x,D.y,It.x,$n+It.y,Et.x+Et.w,Et.y+Et.h,u,gn,Zt.x,Zt.y,mt,an),E){const{x:_i,y:Ki,z:yi}=E.anchor,[Qn,er,mi]=E.up;ru(ue,_i,Ki,yi,Qn,er,mi),ru(ue,_i,Ki,yi,Qn,er,mi),ru(ue,_i,Ki,yi,Qn,er,mi),ru(ue,_i,Ki,yi,Qn,er,mi),qf(o.dynamicLayoutVertexArray,_i,Ki,yi,Ae)}else qf(o.dynamicLayoutVertexArray,D.x,D.y,D.z,Ae);G.emplaceBack(Qt,Qt+1,Qt+2),G.emplaceBack(Qt+1,Qt+2,Qt+3),we.vertexLength+=4,we.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(En[0]),st!==l.length-1&&fi===l[st+1].sectionIndex||o.programConfigurations.populatePaintArrays(J.length,v,v.index,{},V,U,ke&&ke[fi])}const ct=E?E.anchor:D;o.placedSymbolArray.emplaceBack(ct.x,ct.y,ct.z,D.x,D.y,de,this.glyphOffsetArray.length-de,ve,k,O,D.segment,u?u[0]:0,u?u[1]:0,f[0],f[1],S,0,!1,0,F,0)}_commitLayoutVertex(o,l,u,f,b,v,S){o.emplaceBack(l,u,f,b,v,Math.round(S.x),Math.round(S.y))}_addCollisionDebugVertices(o,l,u,f,b,v,S){const E=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),D=E.vertexLength,k=S.tileAnchorX,O=S.tileAnchorY;for(let V=0;V<4;V++)u.collisionVertexArray.emplaceBack(0,0,0,0);u.collisionVertexArrayExt.emplaceBack(l,-o.padding,-o.padding),u.collisionVertexArrayExt.emplaceBack(l,o.padding,-o.padding),u.collisionVertexArrayExt.emplaceBack(l,o.padding,o.padding),u.collisionVertexArrayExt.emplaceBack(l,-o.padding,o.padding),this._commitLayoutVertex(u.layoutVertexArray,f,b,v,k,O,new ge(o.x1,o.y1)),this._commitLayoutVertex(u.layoutVertexArray,f,b,v,k,O,new ge(o.x2,o.y1)),this._commitLayoutVertex(u.layoutVertexArray,f,b,v,k,O,new ge(o.x2,o.y2)),this._commitLayoutVertex(u.layoutVertexArray,f,b,v,k,O,new ge(o.x1,o.y2)),E.vertexLength+=4;const F=u.indexArray;F.emplaceBack(D,D+1),F.emplaceBack(D+1,D+2),F.emplaceBack(D+2,D+3),F.emplaceBack(D+3,D),E.primitiveLength+=4}_addTextDebugCollisionBoxes(o,l,u,f,b,v){for(let S=f;S<b;S++){const E=u.get(S),D=this.getSymbolInstanceTextSize(o,v,l,S);this._addCollisionDebugVertices(E,D,this.textCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,v)}}_addIconDebugCollisionBoxes(o,l,u,f,b,v){for(let S=f;S<b;S++){const E=u.get(S),D=this.getSymbolInstanceIconSize(o,l,v.placedIconSymbolIndex);this._addCollisionDebugVertices(E,D,this.iconCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,v)}}generateCollisionDebugBuffers(o,l){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new nb(An,D1.members,_o),this.iconCollisionBox=new nb(An,D1.members,_o);const u=cp(this.iconSizeData,o),f=cp(this.textSizeData,o);for(let b=0;b<this.symbolInstances.length;b++){const v=this.symbolInstances.get(b);this._addTextDebugCollisionBoxes(f,o,l,v.textBoxStartIndex,v.textBoxEndIndex,v),this._addTextDebugCollisionBoxes(f,o,l,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v),this._addIconDebugCollisionBoxes(u,o,l,v.iconBoxStartIndex,v.iconBoxEndIndex,v),this._addIconDebugCollisionBoxes(u,o,l,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex,v)}}getSymbolInstanceTextSize(o,l,u,f){const b=this.text.placedSymbolArray.get(l.rightJustifiedTextSymbolIndex>=0?l.rightJustifiedTextSymbolIndex:l.centerJustifiedTextSymbolIndex>=0?l.centerJustifiedTextSymbolIndex:l.leftJustifiedTextSymbolIndex>=0?l.leftJustifiedTextSymbolIndex:l.verticalPlacedTextSymbolIndex>=0?l.verticalPlacedTextSymbolIndex:f),v=vc(this.textSizeData,o,b)/24;return this.tilePixelRatio*v}getSymbolInstanceIconSize(o,l,u){const f=this.icon.placedSymbolArray.get(u),b=vc(this.iconSizeData,o,f);return this.tilePixelRatio*b}_commitDebugCollisionVertexUpdate(o,l,u){o.emplaceBack(l,-u,-u),o.emplaceBack(l,u,-u),o.emplaceBack(l,u,u),o.emplaceBack(l,-u,u)}_updateTextDebugCollisionBoxes(o,l,u,f,b,v){for(let S=f;S<b;S++){const E=u.get(S),D=this.getSymbolInstanceTextSize(o,v,l,S);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,D,E.padding)}}_updateIconDebugCollisionBoxes(o,l,u,f,b,v){for(let S=f;S<b;S++){const E=u.get(S),D=this.getSymbolInstanceIconSize(o,l,v);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,D,E.padding)}}updateCollisionDebugBuffers(o,l){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const u=cp(this.iconSizeData,o),f=cp(this.textSizeData,o);for(let b=0;b<this.symbolInstances.length;b++){const v=this.symbolInstances.get(b);this._updateTextDebugCollisionBoxes(f,o,l,v.textBoxStartIndex,v.textBoxEndIndex,v),this._updateTextDebugCollisionBoxes(f,o,l,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v),this._updateIconDebugCollisionBoxes(u,o,l,v.iconBoxStartIndex,v.iconBoxEndIndex,v.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(u,o,l,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex,v.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(o,l,u,f,b,v,S,E,D){const k={};if(l<u){const{x1:O,y1:F,x2:V,y2:U,padding:G,projectedAnchorX:J,projectedAnchorY:ue,projectedAnchorZ:we,tileAnchorX:de,tileAnchorY:ve,featureIndex:Ae}=o.get(l);k.textBox={x1:O,y1:F,x2:V,y2:U,padding:G,projectedAnchorX:J,projectedAnchorY:ue,projectedAnchorZ:we,tileAnchorX:de,tileAnchorY:ve},k.textFeatureIndex=Ae}if(f<b){const{x1:O,y1:F,x2:V,y2:U,padding:G,projectedAnchorX:J,projectedAnchorY:ue,projectedAnchorZ:we,tileAnchorX:de,tileAnchorY:ve,featureIndex:Ae}=o.get(f);k.verticalTextBox={x1:O,y1:F,x2:V,y2:U,padding:G,projectedAnchorX:J,projectedAnchorY:ue,projectedAnchorZ:we,tileAnchorX:de,tileAnchorY:ve},k.verticalTextFeatureIndex=Ae}if(v<S){const{x1:O,y1:F,x2:V,y2:U,padding:G,projectedAnchorX:J,projectedAnchorY:ue,projectedAnchorZ:we,tileAnchorX:de,tileAnchorY:ve,featureIndex:Ae}=o.get(v);k.iconBox={x1:O,y1:F,x2:V,y2:U,padding:G,projectedAnchorX:J,projectedAnchorY:ue,projectedAnchorZ:we,tileAnchorX:de,tileAnchorY:ve},k.iconFeatureIndex=Ae}if(E<D){const{x1:O,y1:F,x2:V,y2:U,padding:G,projectedAnchorX:J,projectedAnchorY:ue,projectedAnchorZ:we,tileAnchorX:de,tileAnchorY:ve,featureIndex:Ae}=o.get(E);k.verticalIconBox={x1:O,y1:F,x2:V,y2:U,padding:G,projectedAnchorX:J,projectedAnchorY:ue,projectedAnchorZ:we,tileAnchorX:de,tileAnchorY:ve},k.verticalIconFeatureIndex=Ae}return k}deserializeCollisionBoxes(o){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const u=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(o,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(o,l){const u=o.placedSymbolArray.get(l),f=u.vertexStartIndex+4*u.numGlyphs;for(let b=u.vertexStartIndex;b<f;b+=4)o.indexArray.emplaceBack(b,b+1,b+2),o.indexArray.emplaceBack(b+1,b+2,b+3)}getSortedSymbolIndexes(o){if(this.sortedAngle===o&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const l=Math.sin(o),u=Math.cos(o),f=[],b=[],v=[];for(let S=0;S<this.symbolInstances.length;++S){v.push(S);const E=this.symbolInstances.get(S);f.push(0|Math.round(l*E.tileAnchorX+u*E.tileAnchorY)),b.push(E.featureIndex)}return v.sort((S,E)=>f[S]-f[E]||b[E]-b[S]),v}addToSortKeyRanges(o,l){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===l?u.symbolInstanceEnd=o+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:o,symbolInstanceEnd:o+1})}sortFeatures(o){if(this.sortFeaturesByY&&this.sortedAngle!==o&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(o),this.sortedAngle=o,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const u=this.symbolInstances.get(l);this.featureSortOrder.push(u.featureIndex);const{rightJustifiedTextSymbolIndex:f,centerJustifiedTextSymbolIndex:b,leftJustifiedTextSymbolIndex:v,verticalPlacedTextSymbolIndex:S,placedIconSymbolIndex:E,verticalPlacedIconSymbolIndex:D}=u;f>=0&&this.addIndicesForPlacedSymbol(this.text,f),b>=0&&b!==f&&this.addIndicesForPlacedSymbol(this.text,b),v>=0&&v!==b&&v!==f&&this.addIndicesForPlacedSymbol(this.text,v),S>=0&&this.addIndicesForPlacedSymbol(this.text,S),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E),D>=0&&this.addIndicesForPlacedSymbol(this.icon,D)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Mn(Xu,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Xu.MAX_GLYPHS=65535,Xu.addDynamicAttributes=qf;const hy=new be({"symbol-placement":new q(_t.layout_symbol["symbol-placement"]),"symbol-spacing":new q(_t.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new q(_t.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ie(_t.layout_symbol["symbol-sort-key"]),"symbol-z-order":new q(_t.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new q(_t.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new q(_t.layout_symbol["icon-ignore-placement"]),"icon-optional":new q(_t.layout_symbol["icon-optional"]),"icon-rotation-alignment":new q(_t.layout_symbol["icon-rotation-alignment"]),"icon-size":new ie(_t.layout_symbol["icon-size"]),"icon-text-fit":new q(_t.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new q(_t.layout_symbol["icon-text-fit-padding"]),"icon-image":new ie(_t.layout_symbol["icon-image"]),"icon-rotate":new ie(_t.layout_symbol["icon-rotate"]),"icon-padding":new q(_t.layout_symbol["icon-padding"]),"icon-keep-upright":new q(_t.layout_symbol["icon-keep-upright"]),"icon-offset":new ie(_t.layout_symbol["icon-offset"]),"icon-anchor":new ie(_t.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new q(_t.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new q(_t.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new q(_t.layout_symbol["text-rotation-alignment"]),"text-field":new ie(_t.layout_symbol["text-field"]),"text-font":new ie(_t.layout_symbol["text-font"]),"text-size":new ie(_t.layout_symbol["text-size"]),"text-max-width":new ie(_t.layout_symbol["text-max-width"]),"text-line-height":new ie(_t.layout_symbol["text-line-height"]),"text-letter-spacing":new ie(_t.layout_symbol["text-letter-spacing"]),"text-justify":new ie(_t.layout_symbol["text-justify"]),"text-radial-offset":new ie(_t.layout_symbol["text-radial-offset"]),"text-variable-anchor":new q(_t.layout_symbol["text-variable-anchor"]),"text-anchor":new ie(_t.layout_symbol["text-anchor"]),"text-max-angle":new q(_t.layout_symbol["text-max-angle"]),"text-writing-mode":new q(_t.layout_symbol["text-writing-mode"]),"text-rotate":new ie(_t.layout_symbol["text-rotate"]),"text-padding":new q(_t.layout_symbol["text-padding"]),"text-keep-upright":new q(_t.layout_symbol["text-keep-upright"]),"text-transform":new ie(_t.layout_symbol["text-transform"]),"text-offset":new ie(_t.layout_symbol["text-offset"]),"text-allow-overlap":new q(_t.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new q(_t.layout_symbol["text-ignore-placement"]),"text-optional":new q(_t.layout_symbol["text-optional"])});var Gl={paint:new be({"icon-opacity":new ie(_t.paint_symbol["icon-opacity"]),"icon-color":new ie(_t.paint_symbol["icon-color"]),"icon-halo-color":new ie(_t.paint_symbol["icon-halo-color"]),"icon-halo-width":new ie(_t.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ie(_t.paint_symbol["icon-halo-blur"]),"icon-translate":new q(_t.paint_symbol["icon-translate"]),"icon-translate-anchor":new q(_t.paint_symbol["icon-translate-anchor"]),"text-opacity":new ie(_t.paint_symbol["text-opacity"]),"text-color":new ie(_t.paint_symbol["text-color"],{runtimeType:As,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new ie(_t.paint_symbol["text-halo-color"]),"text-halo-width":new ie(_t.paint_symbol["text-halo-width"]),"text-halo-blur":new ie(_t.paint_symbol["text-halo-blur"]),"text-translate":new q(_t.paint_symbol["text-translate"]),"text-translate-anchor":new q(_t.paint_symbol["text-translate-anchor"])}),layout:hy};class ib{constructor(o){this.type=o.property.overrides?o.property.overrides.runtimeType:Or,this.defaultValue=o}evaluate(o){if(o.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(o.formattedSection))return l.getOverride(o.formattedSection)}return o.feature&&o.featureState?this.defaultValue.evaluate(o.feature,o.featureState):this.defaultValue.property.specification.default}eachChild(o){this.defaultValue.isConstant()||o(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Mn(ib,"FormatSectionOverride",{omit:["defaultValue"]});class Gf extends as{constructor(o){super(o,Gl)}recalculate(o,l){super.recalculate(o,l),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const u=this.layout.get("text-writing-mode");if(u){const f=[];for(const b of u)f.indexOf(b)<0&&f.push(b);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(o,l,u,f){const b=this.layout.get(o).evaluate(l,{},u,f),v=this._unevaluatedLayout._values[o];return v.isDataDriven()||Pd(v.value)||!b?b:(S=l.properties,b.replace(/{([^{}]+)}/g,(D,k)=>k in S?String(S[k]):""));var S}createBucket(o){return new Xu(o)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const o of Gl.paint.overridableProperties){if(!Gf.hasPaintOverride(this.layout,o))continue;const l=this.paint.get(o),u=new ib(l),f=new rf(u,l.property.specification);let b=null;b="constant"===l.value.kind||"source"===l.value.kind?new sf("source",f):new _r("composite",f,l.value.zoomStops,l.value._interpolationType),this.paint._values[o]=new se(l.property,b,l.parameters)}}_handleOverridablePaintPropertyUpdate(o,l,u){return!(!this.layout||l.isDataDriven()||u.isDataDriven())&&Gf.hasPaintOverride(this.layout,o)}static hasPaintOverride(o,l){const u=o.get("text-field"),f=Gl.paint.properties[l];let b=!1;const v=S=>{for(const E of S)if(f.overrides&&f.overrides.hasOverride(E))return void(b=!0)};if("constant"===u.value.kind&&u.value.value instanceof la)v(u.value.value.sections);else if("source"===u.value.kind){const S=D=>{b||(D instanceof Bo&&go(D.value)===$i?v(D.value.sections):D instanceof tn?v(D.sections):D.eachChild(S))},E=u.value;E._styleExpression&&S(E._styleExpression.expression)}return b}getProgramConfiguration(o){return new Ud(this,o)}}var py={paint:new be({"background-color":new q(_t.paint_background["background-color"]),"background-pattern":new q(_t.paint_background["background-pattern"]),"background-opacity":new q(_t.paint_background["background-opacity"])})},MI={paint:new be({"raster-opacity":new q(_t.paint_raster["raster-opacity"]),"raster-hue-rotate":new q(_t.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new q(_t.paint_raster["raster-brightness-min"]),"raster-brightness-max":new q(_t.paint_raster["raster-brightness-max"]),"raster-saturation":new q(_t.paint_raster["raster-saturation"]),"raster-contrast":new q(_t.paint_raster["raster-contrast"]),"raster-resampling":new q(_t.paint_raster["raster-resampling"]),"raster-fade-duration":new q(_t.paint_raster["raster-fade-duration"])})};class ex extends as{constructor(o){super(o,{}),this.implementation=o}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(o){this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)}onRemove(o){this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)}}var AI={paint:new be({"sky-type":new q(_t.paint_sky["sky-type"]),"sky-atmosphere-sun":new q(_t.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new q(_t.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new q(_t.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new q(_t.paint_sky["sky-gradient-radius"]),"sky-gradient":new me(_t.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new q(_t.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new q(_t.paint_sky["sky-atmosphere-color"]),"sky-opacity":new q(_t.paint_sky["sky-opacity"])})};function bp(a,o,l){const u=[0,0,1],f=x_([]);return Kv(f,f,l?-Be(a)+Math.PI:Be(a)),ep(f,f,-Be(o)),v_(u,u,f),Zo(u,u)}const rb={circle:class extends as{constructor(a){super(a,JS)}createBucket(a){return new kf(a)}queryRadius(a){const o=a;return ju("circle-radius",this,o)+ju("circle-stroke-width",this,o)+Rf(this.paint.get("circle-translate"))}queryIntersectsFeature(a,o,l,u,f,b,v,S){const E=vg(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),b.angle,a.pixelToTileUnitsFactor),D=this.paint.get("circle-radius").evaluate(o,l)+this.paint.get("circle-stroke-width").evaluate(o,l);return s0(a,u,b,v,S,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),E,D)}getProgramIds(){return["circle"]}getProgramConfiguration(a){return new Ud(this,a)}},heatmap:class extends as{createBucket(a){return new xg(a)}constructor(a){super(a,c0),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){"heatmap-color"===a&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=eu({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(a){return ju("heatmap-radius",this,a)}queryIntersectsFeature(a,o,l,u,f,b,v,S){const E=this.paint.get("heatmap-radius").evaluate(o,l);return s0(a,u,b,v,S,!0,!0,new ge(0,0),E)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(a){return new Ud(this,a)}},hillshade:class extends as{constructor(a){super(a,u0)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends as{constructor(a){super(a,s1)}getProgramIds(){const a=this.paint.get("fill-pattern"),o=a&&a.constantOr(1),l=[o?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&l.push(o&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),l}getProgramConfiguration(a){return new Ud(this,a)}recalculate(a,o){super.recalculate(a,o);const l=this.paint._values["fill-outline-color"];"constant"===l.value.kind&&void 0===l.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new _c(a)}queryRadius(){return Rf(this.paint.get("fill-translate"))}queryIntersectsFeature(a,o,l,u,f,b){return!a.queryGeometry.isAboveHorizon&&P_(o0(a.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),b.angle,a.pixelToTileUnitsFactor),u)}isTileClipped(){return!0}},"fill-extrusion":class extends as{constructor(a){super(a,I0)}createBucket(a){return new kg(a)}queryRadius(){return Rf(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(a){return new Ud(this,a)}queryIntersectsFeature(a,o,l,u,f,b,v,S,E){const D=vg(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),b.angle,a.pixelToTileUnitsFactor),k=this.paint.get("fill-extrusion-height").evaluate(o,l),O=this.paint.get("fill-extrusion-base").evaluate(o,l),F=[0,0],V=S&&b.elevation,U=b.elevation?b.elevation.exaggeration():1,G=a.tile.getBucket(this);if(V&&G instanceof kg){const ve=G.centroidVertexArray,Ae=E+1;Ae<ve.length&&(F[0]=ve.geta_centroid_pos0(Ae),F[1]=ve.geta_centroid_pos1(Ae))}if(0===F[0]&&1===F[1])return!1;"globe"===b.projection.name&&(u=D0([u],[new ge(0,0),new ge(Wn,Wn)],a.tileID.canonical).map(ve=>ve.polygon).flat());const J=V?S:null,[ue,we]=(Ae=u,ke=O,ct=k,st=D,yt=v,Ht=J,dt=F,It=U,Et=b.center.lat,"globe"===(ve=b).projection.name?function(Zt,mt,an,En,gn,fi,Qt,$n,_i,Ki,yi){const Qn=[],er=[],mi=Zt.projection.upVectorScale(yi,Zt.center.lat,Zt.worldSize).metersToTile,gi=[0,0,0,1],dr=[0,0,0,1],Br=(Cr,no,co,io)=>{Cr[0]=no,Cr[1]=co,Cr[2]=io,Cr[3]=1},Sr=E0();an>0&&(an+=Sr),En+=Sr;for(const Cr of mt){const no=[],co=[];for(const io of Cr){const Ar=io.x+gn.x,Uo=io.y+gn.y,Io=Zt.projection.projectTilePoint(Ar,Uo,yi),uo=Zt.projection.upVector(yi,io.x,io.y);let sr=an,Mo=En;if(Qt){const zr=G_(Ar,Uo,an,En,Qt,$n,_i,Ki);sr+=zr.base,Mo+=zr.top}0!==an?Br(gi,Io.x+uo[0]*mi*sr,Io.y+uo[1]*mi*sr,Io.z+uo[2]*mi*sr):Br(gi,Io.x,Io.y,Io.z),Br(dr,Io.x+uo[0]*mi*Mo,Io.y+uo[1]*mi*Mo,Io.z+uo[2]*mi*Mo),Ue(gi,gi,fi),Ue(dr,dr,fi),no.push(new lp(gi[0],gi[1],gi[2])),co.push(new lp(dr[0],dr[1],dr[2]))}Qn.push(no),er.push(co)}return[Qn,er]}(ve,Ae,ke,ct,st,yt,Ht,dt,It,Et,a.tileID.canonical):Ht?function(Zt,mt,an,En,gn,fi,Qt,$n,_i){const Ki=[],yi=[],Qn=[0,0,0,1];for(const er of Zt){const mi=[],gi=[];for(const dr of er){const Br=dr.x+En.x,Sr=dr.y+En.y,Cr=G_(Br,Sr,mt,an,fi,Qt,$n,_i);Qn[0]=Br,Qn[1]=Sr,Qn[2]=Cr.base,Qn[3]=1,Yc(Qn,Qn,gn),Qn[3]=Math.max(Qn[3],1e-5);const no=new lp(Qn[0]/Qn[3],Qn[1]/Qn[3],Qn[2]/Qn[3]);Qn[0]=Br,Qn[1]=Sr,Qn[2]=Cr.top,Qn[3]=1,Yc(Qn,Qn,gn),Qn[3]=Math.max(Qn[3],1e-5);const co=new lp(Qn[0]/Qn[3],Qn[1]/Qn[3],Qn[2]/Qn[3]);mi.push(no),gi.push(co)}Ki.push(mi),yi.push(gi)}return[Ki,yi]}(Ae,ke,ct,st,yt,Ht,dt,It,Et):function(Zt,mt,an,En,gn){const fi=[],Qt=[],$n=gn[8]*mt,_i=gn[9]*mt,Ki=gn[10]*mt,yi=gn[11]*mt,Qn=gn[8]*an,er=gn[9]*an,mi=gn[10]*an,gi=gn[11]*an;for(const dr of Zt){const Br=[],Sr=[];for(const Cr of dr){const no=Cr.x+En.x,co=Cr.y+En.y,io=gn[0]*no+gn[4]*co+gn[12],Ar=gn[1]*no+gn[5]*co+gn[13],Uo=gn[2]*no+gn[6]*co+gn[14],Io=gn[3]*no+gn[7]*co+gn[15],uo=io+$n,sr=Ar+_i,Mo=Uo+Ki,zr=Math.max(Io+yi,1e-5),Bs=io+Qn,Yt=Ar+er,cs=Uo+mi,Lo=Math.max(Io+gi,1e-5);Br.push(new lp(uo/zr,sr/zr,Mo/zr)),Sr.push(new lp(Bs/Lo,Yt/Lo,cs/Lo))}fi.push(Br),Qt.push(Sr)}return[fi,Qt]}(Ae,ke,ct,st,yt)),de=a.queryGeometry;var ve,Ae,ke,ct,st,yt,Ht,dt,It,Et;return function(ve,Ae,ke){let ct=1/0;P_(ke,Ae)&&(ct=yc(ke,Ae[0]));for(let st=0;st<Ae.length;st++){const yt=Ae[st],Ht=ve[st];for(let dt=0;dt<yt.length-1;dt++){const It=yt[dt],Et=[It,yt[dt+1],Ht[dt+1],Ht[dt],It];bg(ke,Et)&&(ct=Math.min(ct,yc(ke,Et)))}}return ct!==1/0&&ct}(ue,we,de.isPointQuery()?de.screenBounds:de.screenGeometry)}},line:class extends as{constructor(a){super(a,Og),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(a){if("line-gradient"===a){const o=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=o._styleExpression&&o._styleExpression.expression instanceof Ph,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(a,o){super.recalculate(a,o),this.paint._values["line-floorwidth"]=X_.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new W_(a)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(a){return new Ud(this,a)}queryRadius(a){const o=a,l=Z_(ju("line-width",this,o),ju("line-gap-width",this,o)),u=ju("line-offset",this,o);return l/2+Math.abs(u)+Rf(this.paint.get("line-translate"))}queryIntersectsFeature(a,o,l,u,f,b){if(a.queryGeometry.isAboveHorizon)return!1;const v=o0(a.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),b.angle,a.pixelToTileUnitsFactor),S=a.pixelToTileUnitsFactor/2*Z_(this.paint.get("line-width").evaluate(o,l),this.paint.get("line-gap-width").evaluate(o,l)),E=this.paint.get("line-offset").evaluate(o,l);return E&&(u=function(D,k){const O=[],F=new ge(0,0);for(let V=0;V<D.length;V++){const U=D[V],G=[];for(let J=0;J<U.length;J++){const ue=U[J],we=U[J+1],de=0===J?F:ue.sub(U[J-1])._unit()._perp(),ve=J===U.length-1?F:we.sub(ue)._unit()._perp(),Ae=de._add(ve)._unit();Ae._mult(1/(Ae.x*ve.x+Ae.y*ve.y)),G.push(Ae._mult(k)._add(ue))}O.push(G)}return O}(u,E*a.pixelToTileUnitsFactor)),function(D,k,O){for(let F=0;F<k.length;F++){const V=k[F];if(D.length>=3)for(let U=0;U<V.length;U++)if(Vu(D,V[U]))return!0;if(ZS(D,V,O))return!0}return!1}(v,u,S)}isTileClipped(){return!0}},symbol:Gf,background:class extends as{constructor(a){super(a,py)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends as{constructor(a){super(a,MI)}getProgramIds(){return["raster"]}},sky:class extends as{constructor(a){super(a,AI),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){"sky-gradient"===a?this._updateColorRamp():"sky-atmosphere-sun"!==a&&"sky-atmosphere-halo-color"!==a&&"sky-atmosphere-color"!==a&&"sky-atmosphere-sun-intensity"!==a||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=eu({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(a){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const o=a.style.light.properties.get("position");return this._lightPosition.azimuthal!==o.azimuthal||this._lightPosition.polar!==o.polar}return!1}getCenter(a,o){if("atmosphere"===this.paint.get("sky-type")){const u=this.paint.get("sky-atmosphere-sun"),f=!u,b=a.style.light,v=b.properties.get("position");return f&&"viewport"===b.properties.get("anchor")&&ln("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),f?bp(v.azimuthal,90-v.polar,o):bp(u[0],90-u[1],o)}const l=this.paint.get("sky-gradient-center");return bp(l[0],90-l[1],o)}is3D(){return!1}isSky(){return!0}markSkyboxValid(a){this._skyboxInvalidated=!1,this._lightPosition=a.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const a=this.paint.get("sky-type");return"atmosphere"===a?["skyboxCapture","skybox"]:"gradient"===a?["skyboxGradient"]:null}}};class nh{constructor(o,l,u,f){this.context=o,this.format=u,this.texture=o.gl.createTexture(),this.update(l,f)}update(o,l,u){const{width:f,height:b}=o,{context:v}=this,{gl:S}=v,{HTMLImageElement:E,HTMLCanvasElement:D,HTMLVideoElement:k,ImageData:O,ImageBitmap:F}=he;if(S.bindTexture(S.TEXTURE_2D,this.texture),v.pixelStoreUnpackFlipY.set(!1),v.pixelStoreUnpack.set(1),v.pixelStoreUnpackPremultiplyAlpha.set(this.format===S.RGBA&&(!l||!1!==l.premultiply)),u||this.size&&this.size[0]===f&&this.size[1]===b){const{x:V,y:U}=u||{x:0,y:0};o instanceof E||o instanceof D||o instanceof k||o instanceof O||F&&o instanceof F?S.texSubImage2D(S.TEXTURE_2D,0,V,U,S.RGBA,S.UNSIGNED_BYTE,o):S.texSubImage2D(S.TEXTURE_2D,0,V,U,f,b,S.RGBA,S.UNSIGNED_BYTE,o.data)}else this.size=[f,b],o instanceof E||o instanceof D||o instanceof k||o instanceof O||F&&o instanceof F?S.texImage2D(S.TEXTURE_2D,0,this.format,this.format,S.UNSIGNED_BYTE,o):S.texImage2D(S.TEXTURE_2D,0,this.format,f,b,0,this.format,S.UNSIGNED_BYTE,o.data);this.useMipmap=Boolean(l&&l.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&S.generateMipmap(S.TEXTURE_2D)}bind(o,l){const{context:u}=this,{gl:f}=u;f.bindTexture(f.TEXTURE_2D,this.texture),o!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,o),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap?o===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_NEAREST:o),this.filter=o),l!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,l),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,l),this.wrap=l)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}class fy{constructor(o){this._callback=o,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class my{constructor(){this.tasks={},this.taskQueue=[],bt(["process"],this),this.invoker=new fy(this.process),this.nextId=0}add(o,l){const u=this.nextId++,f=function({type:b,isSymbolTile:v,zoom:S}){return S=S||0,"message"===b?0:"maybePrepare"!==b||v?"parseTile"!==b||v?"parseTile"===b&&v?300-S:"maybePrepare"===b&&v?400-S:500:200-S:100-S}(l);if(0===f){pn();try{o()}finally{}return{cancel:()=>{}}}return this.tasks[u]={fn:o,metadata:l,priority:f,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){pn();try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;const o=this.pick();if(null===o)return;const l=this.tasks[o];if(delete this.tasks[o],this.taskQueue.length&&this.invoker.trigger(),!l)return;l.fn()}finally{}}pick(){let o=null,l=1/0;for(let f=0;f<this.taskQueue.length;f++){const b=this.tasks[this.taskQueue[f]];b.priority<l&&(l=b.priority,o=f)}if(null===o)return null;const u=this.taskQueue[o];return this.taskQueue.splice(o,1),u}remove(){this.invoker.remove()}}class Z1{constructor(o){this._stringToNumber={},this._numberToString=[];for(let l=0;l<o.length;l++){const u=o[l];this._stringToNumber[u]=l,this._numberToString[l]=u}}encode(o){return this._stringToNumber[o]}decode(o){return this._numberToString[o]}}const Y1=["tile","layer","source","sourceLayer","state"];class tx{constructor(o,l,u,f,b){this.type="Feature",this._vectorTileFeature=o,this._z=l,this._x=u,this._y=f,this.properties=o.properties,this.id=b}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(o){this._geometry=o}toJSON(){const o={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(o.id=this.id);for(const l of Y1)void 0!==this[l]&&(o[l]=this[l]);return o}}const ou=new Uint16Array(8184);for(let a=0;a<2046;a++){let o=a+2,l=0,u=0,f=0,b=0,v=0,S=0;for(1&o?f=b=v=32:l=u=S=32;(o>>=1)>1;){const D=l+f>>1,k=u+b>>1;1&o?(f=l,b=u,l=v,u=S):(l=f,u=b,f=v,b=S),v=D,S=k}const E=4*a;ou[E+0]=l,ou[E+1]=u,ou[E+2]=f,ou[E+3]=b}const su=new Uint16Array(2178),Zu=new Uint8Array(1089),gy=new Uint16Array(1089);function by(a){return 0===a?-.03125:32===a?.03125:0}var _y=We([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const nx={type:2,extent:Wn,loadGeometry:()=>[[new ge(0,0),new ge(8193,0),new ge(8193,8193),new ge(0,8193),new ge(0,0)]]};class Wf{constructor(o,l,u,f,b){this.tileID=o,this.uid=Wt(),this.uses=0,this.tileSize=l,this.tileZoom=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=b,this.expiredRequestCount=0,this.state="loading",f&&f.transform&&(this.projection=f.transform.projection)}registerFadeDuration(o){const l=o+this.timeAdded;l<No.now()||this.fadeEndTime&&l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=eh(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(o,l,u){if(this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=function(f,b){const v={};if(!b)return v;for(const S of f){const E=S.layerIds.map(D=>b.getLayer(D)).filter(Boolean);if(0!==E.length){S.layers=E,S.stateDependentLayerIds&&(S.stateDependentLayers=S.stateDependentLayerIds.map(D=>E.filter(k=>k.id===D)[0]));for(const D of E)v[D.id]=S}}return v}(o.buckets,l.style),this.hasSymbolBuckets=!1;for(const f in this.buckets){const b=this.buckets[f];if(b instanceof Xu){if(this.hasSymbolBuckets=!0,!u)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const f in this.buckets){const b=this.buckets[f];if(b instanceof Xu&&b.hasRTLText){this.hasRTLText=!0,A.isLoading()||A.isLoaded()||"deferred"!==C()||I();break}}this.queryPadding=0;for(const f in this.buckets){const b=this.buckets[f];this.queryPadding=Math.max(this.queryPadding,l.style.getLayer(f).queryRadius(b))}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage),o.lineAtlas&&(this.lineAtlas=o.lineAtlas)}else this.collisionBoxArray=new pr}unloadVectorData(){if(this.hasData()){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(o){return this.buckets[o.id]}upload(o){for(const u in this.buckets){const f=this.buckets[u];f.uploadPending()&&f.upload(o)}const l=o.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new nh(o,this.imageAtlas.image,l.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new nh(o,this.glyphAtlasImage,l.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new nh(o,this.lineAtlas.image,l.ALPHA),this.lineAtlas.uploaded=!0)}prepare(o){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture)}queryRenderedFeatures(o,l,u,f,b,v,S,E){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:f,pixelPosMatrix:S,transform:v,params:b,tileTransform:this.tileTransform},o,l,u):{}}querySourceFeatures(o,l){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const f=u.loadVTLayers(),b=l?l.sourceLayer:"",v=f._geojsonTileLayer||f[b];if(!v)return;const S=Uh(l&&l.filter),{z:E,x:D,y:k}=this.tileID.canonical,O={z:E,x:D,y:k};for(let F=0;F<v.length;F++){const V=v.feature(F);if(S.needGeometry){const J=zu(V,!0);if(!S.filter(new P(this.tileID.overscaledZ),J,this.tileID.canonical))continue}else if(!S.filter(new P(this.tileID.overscaledZ),V))continue;const U=u.getId(V,b),G=new tx(V,E,D,k,U);G.tile=O,o.push(G)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(o){const l=this.expirationTime;if(o.cacheControl){const u=Xi(o.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const u=Date.now();let f=!1;if(this.expirationTime>u)f=!1;else if(l)if(this.expirationTime<l)f=!0;else{const b=this.expirationTime-l;b?this.expirationTime=u+Math.max(b,3e4):f=!0}else f=!0;f?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(o,l){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(o).length||!l)return;const u=this.latestFeatureIndex.loadVTLayers(),f=l.style.listImages();for(const b in this.buckets){if(!l.style.hasLayer(b))continue;const v=this.buckets[b],S=v.layers[0].sourceLayer||"_geojsonTileLayer",E=u[S],D=o[S];if(!E||!D||0===Object.keys(D).length)continue;if(v.update(D,E,f,this.imageAtlas&&this.imageAtlas.patternPositions||{}),v instanceof W_||v instanceof _c){const O=l.style._getSourceCache(v.layers[0].source);l._terrain&&l._terrain.enabled&&O&&v.programConfigurations.needsUpload&&l._terrain._clearRenderCacheForTile(O.id,this.tileID)}const k=l&&l.style&&l.style.getLayer(b);k&&(this.queryPadding=Math.max(this.queryPadding,k.queryRadius(v)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<No.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=No.now()+o}setTexture(o,l){const u=l.context,f=u.gl;this.texture=this.texture||l.getTileTexture(o.width),this.texture?this.texture.update(o,{useMipmap:!0}):(this.texture=new nh(u,o,f.RGBA,{useMipmap:!0}),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE))}setDependencies(o,l){const u={};for(const f of l)u[f]=!0;this.dependencies[o]=u}hasDependency(o,l){for(const u of o){const f=this.dependencies[u];if(f)for(const b of l)if(f[b])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(o,l){if(!l||"mercator"===l.name||this._tileDebugBuffer)return;const u=Qc(nx,this.tileID.canonical,this.tileTransform)[0],f=new zt,b=new Js;for(let v=0;v<u.length;v++){const{x:S,y:E}=u[v];f.emplaceBack(S,E),b.emplaceBack(v)}b.emplaceBack(0),this._tileDebugIndexBuffer=o.createIndexBuffer(b),this._tileDebugBuffer=o.createVertexBuffer(f,Cf.members),this._tileDebugSegments=to.simpleSegment(0,0,f.length,b.length)}_makeTileBoundsBuffers(o,l){if(this._tileBoundsBuffer||!l||"mercator"===l.name)return;const u=Qc(nx,this.tileID.canonical,this.tileTransform)[0];let f,b;if(this.isRaster){const v=function(S,E){const D=eh(S,E),k=Math.pow(2,S.z);for(let J=0;J<33;J++)for(let ue=0;ue<33;ue++){const we=Xa((S.x+(ue+by(ue))/32)/k),de=Mr((S.y+(J+by(J))/32)/k),ve=E.project(we,de),Ae=33*J+ue;su[2*Ae+0]=Math.round((ve.x*D.scale-D.x)*Wn),su[2*Ae+1]=Math.round((ve.y*D.scale-D.y)*Wn)}Zu.fill(0),gy.fill(0);for(let J=2045;J>=0;J--){const ue=4*J,we=ou[ue+0],de=ou[ue+1],ve=ou[ue+2],Ae=ou[ue+3],ke=we+ve>>1,ct=de+Ae>>1,st=ke+ct-de,yt=ct+we-ke,Ht=33*de+we,dt=33*Ae+ve,It=33*ct+ke,Et=Math.hypot((su[2*Ht+0]+su[2*dt+0])/2-su[2*It+0],(su[2*Ht+1]+su[2*dt+1])/2-su[2*It+1])>=16;Zu[It]=Zu[It]||(Et?1:0),J<1022&&(Zu[It]=Zu[It]||Zu[33*(de+yt>>1)+(we+st>>1)]||Zu[33*(Ae+yt>>1)+(ve+st>>1)])}const O=new Tt,F=new Vn;let V=0;function U(J,ue){const we=33*ue+J;return 0===gy[we]&&(O.emplaceBack(su[2*we+0],su[2*we+1],J*Wn/32,ue*Wn/32),gy[we]=++V),gy[we]-1}function G(J,ue,we,de,ve,Ae){const ke=J+we>>1,ct=ue+de>>1;if(Math.abs(J-ve)+Math.abs(ue-Ae)>1&&Zu[33*ct+ke])G(ve,Ae,J,ue,ke,ct),G(we,de,ve,Ae,ke,ct);else{const st=U(J,ue),yt=U(we,de),Ht=U(ve,Ae);F.emplaceBack(st,yt,Ht)}}return G(0,0,32,32,32,0),G(32,32,0,0,0,32),{vertices:O,indices:F}}(this.tileID.canonical,l);f=v.vertices,b=v.indices}else{f=new Tt,b=new Vn;for(const{x:S,y:E}of u)f.emplaceBack(S,E,0,0);const v=j_(f.int16,void 0,4);for(let S=0;S<v.length;S+=3)b.emplaceBack(v[S],v[S+1],v[S+2])}this._tileBoundsBuffer=o.createVertexBuffer(f,_y.members),this._tileBoundsIndexBuffer=o.createIndexBuffer(b),this._tileBoundsSegments=to.simpleSegment(0,0,f.length,b.length)}_makeGlobeTileDebugBuffers(o,l){const u=l.projection;if(!u||"globe"!==u.name||l.freezeTileCoverage)return;const f=this.tileID.canonical,b=Mf(t0(f,l)),v=Gd(l.zoom);let S;v>0&&(S=mf(new Float64Array(16),l.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(o,f,l,b,S,v),this._makeGlobeTileDebugTextBuffer(o,f,l,b,S,v)}_globePoint(o,l,u,f,b,v,S){let E=lg(o,l,u);if(v){const D=1<<u.z,k=gc(f.center.lng),O=Ul(f.center.lat),F=(u.x+.5)/D-k;let V=0;F>.5?V=-1:F<-.5&&(V=1);let U=(o/Wn+u.x)/D+V,G=(l/Wn+u.y)/D;U=(U-k)*f._pixelsPerMercatorPixel+k,G=(G-O)*f._pixelsPerMercatorPixel+O;const J=[U*f.worldSize,G*f.worldSize,0];Ue(J,J,v),E=qd(E,J,S)}return Ue(E,E,b)}_makeGlobeTileDebugBorderBuffer(o,l,u,f,b,v){const S=new zt,E=new Js,D=new it,k=(F,V,U,G,J)=>{const ue=(U-F)/(J-1),we=(G-V)/(J-1),de=S.length;for(let ve=0;ve<J;ve++){const Ae=F+ve*ue,ke=V+ve*we;S.emplaceBack(Ae,ke);const ct=this._globePoint(Ae,ke,l,u,f,b,v);D.emplaceBack(ct[0],ct[1],ct[2]),E.emplaceBack(de+ve)}},O=Wn;k(0,0,O,0,16),k(O,0,O,O,16),k(O,O,0,O,16),k(0,O,0,0,16),this._tileDebugIndexBuffer=o.createIndexBuffer(E),this._tileDebugBuffer=o.createVertexBuffer(S,Cf.members),this._globeTileDebugBorderBuffer=o.createVertexBuffer(D,w_.members),this._tileDebugSegments=to.simpleSegment(0,0,S.length,E.length)}_makeGlobeTileDebugTextBuffer(o,l,u,f,b,v){const E=new zt,D=new Vn,k=new it,O=25;D.reserve(32),E.reserve(O),k.reserve(O);const F=(V,U)=>O*V+U;for(let V=0;V<O;V++){const U=2048*V;for(let G=0;G<O;G++){const J=2048*G;E.emplaceBack(J,U);const ue=this._globePoint(J,U,l,u,f,b,v);k.emplaceBack(ue[0],ue[1],ue[2])}}for(let V=0;V<4;V++)for(let U=0;U<4;U++){const G=F(V,U),J=F(V,U+1),ue=F(V+1,U),we=F(V+1,U+1);D.emplaceBack(G,J,ue),D.emplaceBack(ue,J,we)}this._tileDebugTextIndexBuffer=o.createIndexBuffer(D),this._tileDebugTextBuffer=o.createVertexBuffer(E,Cf.members),this._globeTileDebugTextBuffer=o.createVertexBuffer(k,w_.members),this._tileDebugTextSegments=to.simpleSegment(0,0,O,32)}}class kI{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,l,u){const f=String(l);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][f]=this.stateChanges[o][f]||{},xn(this.stateChanges[o][f],u),null===this.deletedStates[o]){this.deletedStates[o]={};for(const b in this.state[o])b!==f&&(this.deletedStates[o][b]=null)}else if(this.deletedStates[o]&&null===this.deletedStates[o][f]){this.deletedStates[o][f]={};for(const b in this.state[o][f])u[b]||(this.deletedStates[o][f][b]=null)}else for(const b in u)this.deletedStates[o]&&this.deletedStates[o][f]&&null===this.deletedStates[o][f][b]&&delete this.deletedStates[o][f][b]}removeFeatureState(o,l,u){if(null===this.deletedStates[o])return;const f=String(l);if(this.deletedStates[o]=this.deletedStates[o]||{},u&&void 0!==l)null!==this.deletedStates[o][f]&&(this.deletedStates[o][f]=this.deletedStates[o][f]||{},this.deletedStates[o][f][u]=null);else if(void 0!==l)if(this.stateChanges[o]&&this.stateChanges[o][f])for(u in this.deletedStates[o][f]={},this.stateChanges[o][f])this.deletedStates[o][f][u]=null;else this.deletedStates[o][f]=null;else this.deletedStates[o]=null}getState(o,l){const u=String(l),f=xn({},(this.state[o]||{})[u],(this.stateChanges[o]||{})[u]);if(null===this.deletedStates[o])return{};if(this.deletedStates[o]){const b=this.deletedStates[o][l];if(null===b)return{};for(const v in b)delete f[v]}return f}initializeTileState(o,l){o.setFeatureState(this.state,l)}coalesceChanges(o,l){const u={};for(const f in this.stateChanges){this.state[f]=this.state[f]||{};const b={};for(const v in this.stateChanges[f])this.state[f][v]||(this.state[f][v]={}),xn(this.state[f][v],this.stateChanges[f][v]),b[v]=this.state[f][v];u[f]=b}for(const f in this.deletedStates){this.state[f]=this.state[f]||{};const b={};if(null===this.deletedStates[f])for(const v in this.state[f])b[v]={},this.state[f][v]={};else for(const v in this.deletedStates[f]){if(null===this.deletedStates[f][v])this.state[f][v]={};else if(this.state[f][v])for(const S of Object.keys(this.deletedStates[f][v]))delete this.state[f][v][S];b[v]=this.state[f][v]}u[f]=u[f]||{},xn(u[f],b)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(u).length)for(const f in o)o[f].setFeatureState(u,l)}}class K1{constructor(o){this.size=o,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(o,l){const u=this.toIdx(o,l);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(o,l){return this.leaves[this.toIdx(o,l)]}toIdx(o,l){return l*this.size+o}}function Q1(a,o,l,u){let f=0,b=Number.MAX_VALUE;for(let v=0;v<3;v++)if(Math.abs(u[v])<1e-15){if(l[v]<a[v]||l[v]>o[v])return null}else{const S=1/u[v];let E=(a[v]-l[v])*S,D=(o[v]-l[v])*S;if(E>D){const k=E;E=D,D=k}if(E>f&&(f=E),D<b&&(b=D),f>b)return null}return f}function J1(a,o,l,u,f,b,v,S,E,D,k){const O=u-a,F=f-o,V=b-l,U=v-a,G=S-o,J=E-l,ue=k[1]*J-k[2]*G,we=k[2]*U-k[0]*J,de=k[0]*G-k[1]*U,ve=O*ue+F*we+V*de;if(Math.abs(ve)<1e-15)return null;const Ae=1/ve,ke=D[0]-a,ct=D[1]-o,st=D[2]-l,yt=(ke*ue+ct*we+st*de)*Ae;if(yt<0||yt>1)return null;const Ht=ct*V-st*F,dt=st*O-ke*V,It=ke*F-ct*O,Et=(k[0]*Ht+k[1]*dt+k[2]*It)*Ae;return Et<0||yt+Et>1?null:(U*Ht+G*dt+J*It)*Ae}function eC(a,o,l){return(a-o)/(l-o)}function tC(a,o,l,u,f,b,v,S,E){const D=1<<l,k=b-u,O=v-f,F=(a+1)/D*k+u,V=(o+0)/D*O+f,U=(o+1)/D*O+f;S[0]=(a+0)/D*k+u,S[1]=V,E[0]=F,E[1]=U}class nC{constructor(o){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=o,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const l=function(b){const v=Math.ceil(Math.log2(b.dim/8)),S=[];let E=Math.ceil(Math.pow(2,v));const D=1/E,k=(V,U,G,J,ue)=>{const we=J?1:0,de=(V+1)*G-we,ve=U*G,Ae=(U+1)*G-we;ue[0]=V*G,ue[1]=ve,ue[2]=de,ue[3]=Ae};let O=new K1(E);const F=[];for(let V=0;V<E*E;V++){k(V%E,Math.floor(V/E),D,!1,F);const U=ih(F[0],F[1],b),G=ih(F[2],F[1],b),J=ih(F[2],F[3],b),ue=ih(F[0],F[3],b);O.minimums.push(Math.min(U,G,J,ue)),O.maximums.push(Math.max(U,G,J,ue)),O.leaves.push(1)}for(S.push(O),E/=2;E>=1;E/=2){const V=S[S.length-1];O=new K1(E);for(let U=0;U<E*E;U++){k(U%E,Math.floor(U/E),2,!0,F);const G=V.getElevation(F[0],F[1]),J=V.getElevation(F[2],F[1]),ue=V.getElevation(F[2],F[3]),we=V.getElevation(F[0],F[3]),de=V.isLeaf(F[0],F[1]),ve=V.isLeaf(F[2],F[1]),Ae=V.isLeaf(F[2],F[3]),ke=V.isLeaf(F[0],F[3]),ct=Math.min(G.min,J.min,ue.min,we.min),st=Math.max(G.max,J.max,ue.max,we.max),yt=de&&ve&&Ae&&ke;O.maximums.push(st),O.minimums.push(ct),O.leaves.push(st-ct<=5&&yt?1:0)}S.push(O)}return S}(this.dem),u=l.length-1,f=l[u];this._addNode(f.minimums[0],f.maximums[0],f.leaves[0]),this._construct(l,0,0,u,0)}raycastRoot(o,l,u,f,b,v,S=1){return Q1([o,l,-100],[u,f,this.maximums[0]*S],b,v)}raycast(o,l,u,f,b,v,S=1){if(!this.nodeCount)return null;const E=this.raycastRoot(o,l,u,f,b,v,S);if(null==E)return null;const D=[],k=[],O=[],F=[],V=[{idx:0,t:E,nodex:0,nodey:0,depth:0}];for(;V.length>0;){const{idx:U,t:G,nodex:J,nodey:ue,depth:we}=V.pop();if(this.leaves[U]){tC(J,ue,we,o,l,u,f,O,F);const ve=1<<we,Ae=(J+0)/ve,ke=(J+1)/ve,ct=(ue+0)/ve,st=(ue+1)/ve,yt=ih(Ae,ct,this.dem)*S,Ht=ih(ke,ct,this.dem)*S,dt=ih(ke,st,this.dem)*S,It=ih(Ae,st,this.dem)*S,Et=J1(O[0],O[1],yt,F[0],O[1],Ht,F[0],F[1],dt,b,v),Lt=J1(F[0],F[1],dt,O[0],F[1],It,O[0],O[1],yt,b,v),Zt=Math.min(null!==Et?Et:Number.MAX_VALUE,null!==Lt?Lt:Number.MAX_VALUE);if(Zt!==Number.MAX_VALUE)return Zt;{const mt=Qh([],b,v,G);if(iC(yt,Ht,It,dt,eC(mt[0],O[0],F[0]),eC(mt[1],O[1],F[1]))>=mt[2])return G}continue}let de=0;for(let ve=0;ve<this._siblingOffset.length;ve++){tC((J<<1)+this._siblingOffset[ve][0],(ue<<1)+this._siblingOffset[ve][1],we+1,o,l,u,f,O,F),O[2]=-100,F[2]=this.maximums[this.childOffsets[U]+ve]*S;const Ae=Q1(O,F,b,v);if(null!=Ae){const ke=Ae;D[ve]=ke;let ct=!1;for(let st=0;st<de&&!ct;st++)ke>=D[k[st]]&&(k.splice(st,0,ve),ct=!0);ct||(k[de]=ve),de++}}for(let ve=0;ve<de;ve++){const Ae=k[ve];V.push({idx:this.childOffsets[U]+Ae,t:D[Ae],nodex:(J<<1)+this._siblingOffset[Ae][0],nodey:(ue<<1)+this._siblingOffset[Ae][1],depth:we+1})}}return null}_addNode(o,l,u){return this.minimums.push(o),this.maximums.push(l),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(o,l,u,f,b){if(1===o[f].isLeaf(l,u))return;this.childOffsets[b]||(this.childOffsets[b]=this.nodeCount);const v=f-1,S=o[v];let E=0,D=0;for(let k=0;k<this._siblingOffset.length;k++){const O=2*l+this._siblingOffset[k][0],F=2*u+this._siblingOffset[k][1],V=S.getElevation(O,F),U=S.isLeaf(O,F),G=this._addNode(V.min,V.max,U);U&&(E|=1<<k),D||(D=G)}for(let k=0;k<this._siblingOffset.length;k++)E&1<<k||this._construct(o,2*l+this._siblingOffset[k][0],2*u+this._siblingOffset[k][1],v,D+k)}}function iC(a,o,l,u,f,b){return qi(qi(a,l,b),qi(o,u,b),f)}function ih(a,o,l){const u=l.dim,f=lt(a*u-.5,0,u-1),b=lt(o*u-.5,0,u-1),v=Math.floor(f),S=Math.floor(b),E=Math.min(v+1,u-1),D=Math.min(S+1,u-1);return iC(l.get(v,S),l.get(E,S),l.get(v,D),l.get(E,D),f-v,b-S)}const rC={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function Yu(a,o,l){return(256*a*256+256*o+l)/10-1e4}function yy(a,o,l){return 256*a+o+l/256-32768}class ob{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(o,l,u,f=!1,b=!1){if(this.uid=o,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(u&&"mapbox"!==u&&"terrarium"!==u)return ln(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=l.height;const v=this.dim=l.height-2,S=new Uint32Array(l.data.buffer);if(this.pixels=new Uint8Array(l.data.buffer),this.encoding=u||"mapbox",this.borderReady=f,!f){for(let E=0;E<v;E++)S[this._idx(-1,E)]=S[this._idx(0,E)],S[this._idx(v,E)]=S[this._idx(v-1,E)],S[this._idx(E,-1)]=S[this._idx(E,0)],S[this._idx(E,v)]=S[this._idx(E,v-1)];S[this._idx(-1,-1)]=S[this._idx(0,0)],S[this._idx(v,-1)]=S[this._idx(v-1,0)],S[this._idx(-1,v)]=S[this._idx(0,v-1)],S[this._idx(v,v)]=S[this._idx(v-1,v-1)],b&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new nC(this)}get(o,l,u=!1){u&&(o=lt(o,-1,this.dim),l=lt(l,-1,this.dim));const f=4*this._idx(o,l);return("terrarium"===this.encoding?yy:Yu)(this.pixels[f],this.pixels[f+1],this.pixels[f+2])}static getUnpackVector(o){return rC[o]}get unpackVector(){return rC[this.encoding]}_idx(o,l){if(o<-1||o>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(o+1)}static pack(o,l){const u=[0,0,0,0],f=ob.getUnpackVector(l);let b=Math.floor((o+f[3])/f[2]);return u[2]=b%256,b=Math.floor(b/256),u[1]=b%256,b=Math.floor(b/256),u[0]=b,u}getPixels(){return new ma({width:this.stride,height:this.stride},this.pixels)}backfillBorder(o,l,u){if(this.dim!==o.dim)throw new Error("dem dimension mismatch");let f=l*this.dim,b=l*this.dim+this.dim,v=u*this.dim,S=u*this.dim+this.dim;switch(l){case-1:f=b-1;break;case 1:b=f+1}switch(u){case-1:v=S-1;break;case 1:S=v+1}const E=-l*this.dim,D=-u*this.dim;for(let k=v;k<S;k++)for(let O=f;O<b;O++){const F=4*this._idx(O,k),V=4*this._idx(O+E,k+D);this.pixels[F+0]=o.pixels[V+0],this.pixels[F+1]=o.pixels[V+1],this.pixels[F+2]=o.pixels[V+2],this.pixels[F+3]=o.pixels[V+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Mn(ob,"DEMData"),Mn(nC,"DemMinMaxQuadTree",{omit:["dem"]});class ix{constructor(o,l){this.max=o,this.onRemove=l,this.reset()}reset(){for(const o in this.data)for(const l of this.data[o])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(o,l,u){const f=o.wrapped().key;void 0===this.data[f]&&(this.data[f]=[]);const b={value:l,timeout:void 0};if(void 0!==u&&(b.timeout=setTimeout(()=>{this.remove(o,b)},u)),this.data[f].push(b),this.order.push(f),this.order.length>this.max){const v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const l=this.data[o].shift();return l.timeout&&clearTimeout(l.timeout),0===this.data[o].length&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),l.value}getByKey(o){const l=this.data[o];return l?l[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,l){if(!this.has(o))return this;const u=o.wrapped().key,f=void 0===l?0:this.data[u].indexOf(l),b=this.data[u][f];return this.data[u].splice(f,1),b.timeout&&clearTimeout(b.timeout),0===this.data[u].length&&delete this.data[u],this.onRemove(b.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(o){const l=[];for(const u in this.data)for(const f of this.data[u])o(f.value)||l.push(f);for(const u of l)this.remove(u.value.tileID,u)}}class Ku{constructor(o,l,u){this.func=o,this.mask=l,this.range=u}}Ku.ReadOnly=!1,Ku.ReadWrite=!0,Ku.disabled=new Ku(519,Ku.ReadOnly,[0,1]);class Xf{constructor(o,l,u,f,b,v){this.test=o,this.ref=l,this.mask=u,this.fail=f,this.depthFail=b,this.pass=v}}Xf.disabled=new Xf({func:519,mask:0},0,0,7680,7680,7680);class Ec{constructor(o,l,u){this.blendFunction=o,this.blendColor=l,this.mask=u}}Ec.Replace=[1,0],Ec.disabled=new Ec(Ec.Replace,Eo.transparent,[!1,!1,!1,!1]),Ec.unblended=new Ec(Ec.Replace,Eo.transparent,[!0,!0,!0,!0]),Ec.alphaBlended=new Ec([1,771],Eo.transparent,[!0,!0,!0,!0]);class Wl{constructor(o,l,u){this.enable=o,this.mode=l,this.frontFace=u}}Wl.disabled=new Wl(!1,1029,2305),Wl.backCCW=new Wl(!0,1029,2305),Wl.backCW=new Wl(!0,1029,2304),Wl.frontCW=new Wl(!0,1028,2304),Wl.frontCCW=new Wl(!0,1028,2305);class rh extends Al{constructor(o,l,u){super(),this.id=o,this._onlySymbols=u,l.on("data",f=>{"source"===f.dataType&&"metadata"===f.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===f.dataType&&"content"===f.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),l.on("error",()=>{this._sourceErrored=!0}),this._source=l,this._tiles={},this._cache=new ix(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new kI,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(o){this.map=o,this._minTileCacheSize=void 0===this._minTileCacheSize&&o?o._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&o?o._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const o in this._tiles){const l=this._tiles[o];if("loaded"!==l.state&&"errored"!==l.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(o,l){return o.isSymbolTile=this._onlySymbols,this._source.loadTile(o,l)}_unloadTile(o){if(this._source.unloadTile)return this._source.unloadTile(o,()=>{})}_abortTile(o){if(this._source.abortTile)return this._source.abortTile(o,()=>{})}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const l in this._tiles){const u=this._tiles[l];u.upload(o),u.prepare(this.map.style.imageManager)}}getIds(){return vn(this._tiles).map(o=>o.tileID).sort(vy).map(o=>o.key)}getRenderableIds(o){const l=[];for(const u in this._tiles)this._isIdRenderable(+u,o)&&l.push(this._tiles[u]);return o?l.sort((u,f)=>{const b=u.tileID,v=f.tileID,S=new ge(b.canonical.x,b.canonical.y)._rotate(this.transform.angle),E=new ge(v.canonical.x,v.canonical.y)._rotate(this.transform.angle);return b.overscaledZ-v.overscaledZ||E.y-S.y||E.x-S.x}).map(u=>u.tileID.key):l.map(u=>u.tileID).sort(vy).map(u=>u.key)}hasRenderableParent(o){const l=this.findLoadedParent(o,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(o,l){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(l||!this._tiles[o].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)"errored"!==this._tiles[o].state&&this._reloadTile(+o,"reloading")}}_reloadTile(o,l){const u=this._tiles[o];u&&("loading"!==u.state&&(u.state=l),this._loadTile(u,this._tileLoaded.bind(this,u,o,l)))}_tileLoaded(o,l,u,f){if(f)if(o.state="errored",404!==f.status)this._source.fire(new ns(f,{tile:o}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const b=this.map.painter.terrain;this.update(this.transform,b.getScaledDemTileSize(),!0),b.resetTileLookupCache(this.id)}else this.update(this.transform);else o.timeAdded=No.now(),"expired"===u&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(l,o),"raster-dem"===this._source.type&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),this._source.fire(new ll("data",{dataType:"source",tile:o,coord:o.tileID,sourceCacheId:this.id}))}_backfillDEM(o){const l=this.getRenderableIds();for(let f=0;f<l.length;f++){const b=l[f];if(o.neighboringTiles&&o.neighboringTiles[b]){const v=this.getTileByID(b);u(o,v),u(v,o)}}function u(f,b){if(!f.dem||f.dem.borderReady)return;f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0;let v=b.tileID.canonical.x-f.tileID.canonical.x;const S=b.tileID.canonical.y-f.tileID.canonical.y,E=Math.pow(2,f.tileID.canonical.z),D=b.tileID.key;0===v&&0===S||Math.abs(S)>1||(Math.abs(v)>1&&(1===Math.abs(v+E)?v+=E:1===Math.abs(v-E)&&(v-=E)),b.dem&&f.dem&&(f.dem.backfillBorder(b.dem,v,S),f.neighboringTiles&&f.neighboringTiles[D]&&(f.neighboringTiles[D].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,l,u,f){for(const b in this._tiles){let v=this._tiles[b];if(f[b]||!v.hasData()||v.tileID.overscaledZ<=l||v.tileID.overscaledZ>u)continue;let S=v.tileID;for(;v&&v.tileID.overscaledZ>l+1;){const D=v.tileID.scaledTo(v.tileID.overscaledZ-1);v=this._tiles[D.key],v&&v.hasData()&&(S=D)}let E=S;for(;E.overscaledZ>l;)if(E=E.scaledTo(E.overscaledZ-1),o[E.key]){f[S.key]=S;break}}}findLoadedParent(o,l){if(o.key in this._loadedParentTiles){const u=this._loadedParentTiles[o.key];return u&&u.tileID.overscaledZ>=l?u:null}for(let u=o.overscaledZ-1;u>=l;u--){const f=o.scaledTo(u),b=this._getLoadedTile(f);if(b)return b}}_getLoadedTile(o){const l=this._tiles[o.key];return l&&l.hasData()?l:this._cache.getByKey(this._source.reparseOverscaled?o.wrapped().key:o.canonical.key)}updateCacheSize(o,l){l=l||this._source.tileSize;const u=Math.ceil(o.width/l)+1,f=Math.ceil(o.height/l)+1,b=Math.floor(u*f*5),v="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,b):b,S="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,v):v;this._cache.setMaxSize(S)}handleWrapJump(o){const l=Math.round((o-(void 0===this._prevLng?o:this._prevLng))/360);if(this._prevLng=o,l){const u={};for(const f in this._tiles){const b=this._tiles[f];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+l),u[b.tileID.key]=b}this._tiles=u;for(const f in this._timers)clearTimeout(this._timers[f]),delete this._timers[f];for(const f in this._tiles)this._setTileReloadTimer(+f,this._tiles[f])}}update(o,l,u){if(this.transform=o,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!u)return;let f;this.updateCacheSize(o,l),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?f=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(S=>new ta(S.canonical.z,S.wrap,S.canonical.z,S.canonical.x,S.canonical.y)):(f=o.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(f=f.filter(S=>this._source.hasTile(S)))):f=[];const b=this._updateRetainedTiles(f);if(rx(this._source.type)&&0!==f.length){const S={},E={},D=Object.keys(b);for(const O of D){const F=b[O],V=this._tiles[O];if(!V||V.fadeEndTime&&V.fadeEndTime<=No.now())continue;const U=this.findLoadedParent(F,Math.max(F.overscaledZ-rh.maxOverzooming,this._source.minzoom));U&&(this._addTile(U.tileID),S[U.tileID.key]=U.tileID),E[O]=F}const k=f[f.length-1].overscaledZ;for(const O in this._tiles){const F=this._tiles[O];if(b[O]||!F.hasData())continue;let V=F.tileID;for(;V.overscaledZ>k;){V=V.scaledTo(V.overscaledZ-1);const U=this._tiles[V.key];if(U&&U.hasData()&&E[V.key]){b[O]=F.tileID;break}}}for(const O in S)b[O]||(this._coveredTiles[O]=!0,b[O]=S[O])}for(const S in b)this._tiles[S].clearFadeHold();const v=function(S,E){const D=[];for(const k in S)k in E||D.push(k);return D}(this._tiles,b);for(const S of v){const E=this._tiles[S];E.hasSymbolBuckets&&!E.holdingForFade()?E.setHoldDuration(this.map._fadeDuration):E.hasSymbolBuckets&&!E.symbolFadeFinished()||this._removeTile(+S)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(+o)}_updateRetainedTiles(o){const l={};if(0===o.length)return l;const u={},f=o.reduce((D,k)=>Math.min(D,k.overscaledZ),1/0),b=o[0].overscaledZ,v=Math.max(b-rh.maxOverzooming,this._source.minzoom),S=Math.max(b+rh.maxUnderzooming,this._source.minzoom),E={};for(const D of o){const k=this._addTile(D);l[D.key]=D,k.hasData()||f<this._source.maxzoom&&(E[D.key]=D)}this._retainLoadedChildren(E,f,S,l);for(const D of o){let k=this._tiles[D.key];if(k.hasData())continue;if(D.canonical.z>=this._source.maxzoom){const F=D.children(this._source.maxzoom)[0],V=this.getTile(F);if(V&&V.hasData()){l[F.key]=F;continue}}else{const F=D.children(this._source.maxzoom);if(l[F[0].key]&&l[F[1].key]&&l[F[2].key]&&l[F[3].key])continue}let O=k.wasRequested();for(let F=D.overscaledZ-1;F>=v;--F){const V=D.scaledTo(F);if(u[V.key]||(u[V.key]=!0,k=this.getTile(V),!k&&O&&(k=this._addTile(V)),k&&(l[V.key]=V,O=k.wasRequested(),k.hasData())))break}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const l=[];let u,f=this._tiles[o].tileID;for(;f.overscaledZ>0;){if(f.key in this._loadedParentTiles){u=this._loadedParentTiles[f.key];break}l.push(f.key);const b=f.scaledTo(f.overscaledZ-1);if(u=this._getLoadedTile(b),u)break;f=b}for(const b of l)this._loadedParentTiles[b]=u}}_addTile(o){let l=this._tiles[o.key];if(l)return l;l=this._cache.getAndRemove(o),l&&(this._setTileReloadTimer(o.key,l),l.tileID=o,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,l)));const u=Boolean(l);if(!u){const f=this.map?this.map.painter:null;l=new Wf(o,this._source.tileSize*o.overscaleFactor(),this.transform.tileZoom,f,this._isRaster),this._loadTile(l,this._tileLoaded.bind(this,l,o.key,l.state))}return l?(l.uses++,this._tiles[o.key]=l,u||this._source.fire(new ll("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l):null}_setTileReloadTimer(o,l){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const u=l.getExpiryTimeout();u&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},u))}_removeTile(o){const l=this._tiles[o];l&&(l.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),l.uses>0||(l.hasData()&&"reloading"!==l.state?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(+o);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(o,l,u){const f=[],b=this.transform;if(!b)return f;const v="globe"===b.projection.name,S=gc(b.center.lng);for(const E in this._tiles){const D=this._tiles[E];if(u&&D.clearQueryDebugViz(),D.holdingForFade())continue;let k;if(v){const O=D.tileID.canonical;if(0===O.z){const F=[Math.abs(lt(S,...Zf(O,-1))-S),Math.abs(lt(S,...Zf(O,1))-S)];k=[0,2*F.indexOf(Math.min(...F))-1]}else{const F=[Math.abs(lt(S,...Zf(O,-1))-S),Math.abs(lt(S,...Zf(O,0))-S),Math.abs(lt(S,...Zf(O,1))-S)];k=[F.indexOf(Math.min(...F))-1]}}else k=[0];for(const O of k){const F=o.containsTile(D,b,l,O);F&&f.push(F)}}return f}getVisibleCoordinates(o){const l=this.getRenderableIds(o).map(u=>this._tiles[u].tileID);for(const u of l)u.projMatrix=this.transform.calculateProjMatrix(u.toUnwrapped());return l}hasTransition(){if(this._source.hasTransition())return!0;if(rx(this._source.type))for(const o in this._tiles){const l=this._tiles[o];if(void 0!==l.fadeEndTime&&l.fadeEndTime>=No.now())return!0}return!1}setFeatureState(o,l,u){this._state.updateState(o=o||"_geojsonTileLayer",l,u)}removeFeatureState(o,l,u){this._state.removeFeatureState(o=o||"_geojsonTileLayer",l,u)}getFeatureState(o,l){return this._state.getState(o=o||"_geojsonTileLayer",l)}setDependencies(o,l,u){const f=this._tiles[o];f&&f.setDependencies(l,u)}reloadTilesForDependencies(o,l){for(const u in this._tiles)this._tiles[u].hasDependency(o,l)&&this._reloadTile(+u,"reloading");this._cache.filter(u=>!u.hasDependency(o,l))}_preloadTiles(o,l){if(!this._sourceLoaded){const S=()=>{this._sourceLoaded&&(this._source.off("data",S),this._preloadTiles(o,l))};return void this._source.on("data",S)}const u=new Map,f=Array.isArray(o)?o:[o],b=this.map.painter.terrain,v=this.usedForTerrain&&b?b.getScaledDemTileSize():this._source.tileSize;for(const S of f){const E=S.coveringTiles({tileSize:v,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const D of E)u.set(D.key,D);this.usedForTerrain&&S.updateElevation(!1)}xt(Array.from(u.values()),(S,E)=>{const D=new Wf(S,this._source.tileSize*S.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(D,k=>{"raster-dem"===this._source.type&&D.dem&&this._backfillDEM(D),E(k,D)})},l)}}function vy(a,o){const l=Math.abs(2*a.wrap)-+(a.wrap<0),u=Math.abs(2*o.wrap)-+(o.wrap<0);return a.overscaledZ-o.overscaledZ||u-l||o.canonical.y-a.canonical.y||o.canonical.x-a.canonical.x}function rx(a){return"raster"===a||"image"===a||"video"===a||"custom"===a}function Zf(a,o){const l=1<<a.z;return[a.x/l+o,(a.x+1)/l+o]}rh.maxOverzooming=10,rh.maxUnderzooming=3;class oh{constructor(o,l,u){this._demTile=o,this._dem=this._demTile.dem,this._scale=l,this._offset=u}static create(o,l,u){const f=u||o.findDEMTileFor(l);if(!f||!f.dem)return;const b=f.dem,v=f.tileID,S=1<<l.canonical.z-v.canonical.z;return new oh(f,f.tileSize/Wn/S,[(l.canonical.x/S-v.canonical.x)*b.dim,(l.canonical.y/S-v.canonical.y)*b.dim])}tileCoordToPixel(o,l){const u=l*this._scale+this._offset[1],f=Math.floor(o*this._scale+this._offset[0]),b=Math.floor(u);return new ge(f,b)}getElevationAt(o,l,u,f){const b=o*this._scale+this._offset[0],v=l*this._scale+this._offset[1],S=Math.floor(b),E=Math.floor(v),D=this._dem;return f=!!f,u?qi(qi(D.get(S,E,f),D.get(S,E+1,f),v-E),qi(D.get(S+1,E,f),D.get(S+1,E+1,f),v-E),b-S):D.get(S,E,f)}getElevationAtPixel(o,l,u){return this._dem.get(o,l,!!u)}getMeterToDEM(o){return(1<<this._demTile.tileID.canonical.z)*Hl(1,o)*this._dem.stride}}class sh{constructor(o,l){this.tileID=o,this.x=o.canonical.x,this.y=o.canonical.y,this.z=o.canonical.z,this.grid=new Ru(Wn,16,0),this.featureIndexArray=new Nl,this.promoteId=l}insert(o,l,u,f,b,v=0){const S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,f,b,v);const E=this.grid;for(let D=0;D<l.length;D++){const k=l[D],O=[1/0,1/0,-1/0,-1/0];for(let F=0;F<k.length;F++){const V=k[F];O[0]=Math.min(O[0],V.x),O[1]=Math.min(O[1],V.y),O[2]=Math.max(O[2],V.x),O[3]=Math.max(O[3],V.y)}O[0]<Wn&&O[1]<Wn&&O[2]>=0&&O[3]>=0&&E.insert(S,O[0],O[1],O[2],O[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new sp(new Vg(this.rawTileData)).layers,this.sourceLayerCoder=new Z1(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const o in this.vtLayers)this.vtFeatures[o]=[]}return this.vtLayers}query(o,l,u,f){this.loadVTLayers();const b=o.params||{},v=Uh(b.filter),S=o.tileResult,E=o.transform,D=S.bufferedTilespaceBounds,k=this.grid.query(D.min.x,D.min.y,D.max.x,D.max.y,(U,G,J,ue)=>KS(S.bufferedTilespaceGeometry,U,G,J,ue));k.sort(_p);let O=null;E.elevation&&k.length>0&&(O=oh.create(E.elevation,this.tileID));const F={};let V;for(let U=0;U<k.length;U++){const G=k[U];if(G===V)continue;V=G;const J=this.featureIndexArray.get(G);let ue=null;this.loadMatchingFeature(F,J,v,b.layers,b.availableImages,l,u,f,(we,de,ve,Ae=0)=>(ue||(ue=Qc(we,this.tileID.canonical,o.tileTransform)),de.queryIntersectsFeature(S,we,ve,ue,this.z,o.transform,o.pixelPosMatrix,O,Ae)))}return F}loadMatchingFeature(o,l,u,f,b,v,S,E,D){const{featureIndex:k,bucketIndex:O,sourceLayerIndex:F,layoutVertexArrayOffset:V}=l,U=this.bucketLayerIDs[O];if(f&&!function(we,de){for(let ve=0;ve<we.length;ve++)if(de.indexOf(we[ve])>=0)return!0;return!1}(f,U))return;const G=this.sourceLayerCoder.decode(F),J=this.vtLayers[G].feature(k);if(u.needGeometry){const we=zu(J,!0);if(!u.filter(new P(this.tileID.overscaledZ),we,this.tileID.canonical))return}else if(!u.filter(new P(this.tileID.overscaledZ),J))return;const ue=this.getId(J,G);for(let we=0;we<U.length;we++){const de=U[we];if(f&&f.indexOf(de)<0)continue;const ve=v[de];if(!ve)continue;let Ae={};void 0!==ue&&E&&(Ae=E.getState(ve.sourceLayer||"_geojsonTileLayer",ue));const ke=xn({},S[de]);ke.paint=lb(ke.paint,ve.paint,J,Ae,b),ke.layout=lb(ke.layout,ve.layout,J,Ae,b);const ct=!D||D(J,ve,Ae,V);if(!ct)continue;const st=new tx(J,this.z,this.x,this.y,ue);st.layer=ke;let yt=o[de];void 0===yt&&(yt=o[de]=[]),yt.push({featureIndex:k,feature:st,intersectionZ:ct})}}lookupSymbolFeatures(o,l,u,f,b,v,S,E){const D={};this.loadVTLayers();const k=Uh(b);for(const O of o)this.loadMatchingFeature(D,{bucketIndex:u,sourceLayerIndex:f,featureIndex:O,layoutVertexArrayOffset:0},k,v,S,E,l);return D}loadFeature(o){const{featureIndex:l,sourceLayerIndex:u}=o;this.loadVTLayers();const f=this.sourceLayerCoder.decode(u),b=this.vtFeatures[f];if(b[l])return b[l];const v=this.vtLayers[f].feature(l);return b[l]=v,v}hasLayer(o){for(const l of this.bucketLayerIDs)for(const u of l)if(o===u)return!0;return!1}getId(o,l){let u=o.id;if(this.promoteId){const f="string"==typeof this.promoteId?this.promoteId:this.promoteId[l];null!=f&&(u=o.properties[f]),"boolean"==typeof u&&(u=Number(u))}return u}}function lb(a,o,l,u,f){return $t(a,(b,v)=>{const S=o instanceof ce?o.get(v):null;return S&&S.evaluate?S.evaluate(l,u,f):S})}function _p(a,o){return o-a}Mn(sh,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class cb{constructor(o,l){this.width=o,this.height=l,this.nextRow=0,this.image=new Jc({width:o,height:l}),this.positions={},this.uploaded=!1}getDash(o,l){const u=this.getKey(o,l);return this.positions[u]}trim(){const o=this.width,l=this.height=wo(this.nextRow);this.image.resize({width:o,height:l})}getKey(o,l){return o.join(",")+l}getDashRanges(o,l,u){const f=[];let b=o.length%2==1?-o[o.length-1]*u:0,v=o[0]*u,S=!0;f.push({left:b,right:v,isDash:S,zeroLength:0===o[0]});let E=o[0];for(let D=1;D<o.length;D++){S=!S;const k=o[D];b=E*u,E+=k,v=E*u,f.push({left:b,right:v,isDash:S,zeroLength:0===k})}return f}addRoundDash(o,l,u){const f=l/2;for(let b=-u;b<=u;b++){const v=this.width*(this.nextRow+u+b);let S=0,E=o[S];for(let D=0;D<this.width;D++){D/E.right>1&&(E=o[++S]);const k=Math.abs(D-E.left),O=Math.abs(D-E.right),F=Math.min(k,O);let V;const U=b/u*(f+1);if(E.isDash){const G=f-Math.abs(U);V=Math.sqrt(F*F+G*G)}else V=f-Math.sqrt(F*F+U*U);this.image.data[v+D]=Math.max(0,Math.min(255,V+128))}}}addRegularDash(o,l){for(let E=o.length-1;E>=0;--E){const D=o[E],k=o[E+1];D.zeroLength?o.splice(E,1):k&&k.isDash===D.isDash&&(k.left=D.left,o.splice(E,1))}const u=o[0],f=o[o.length-1];u.isDash===f.isDash&&(u.left=f.left-this.width,f.right=u.right+this.width);const b=this.width*this.nextRow;let v=0,S=o[v];for(let E=0;E<this.width;E++){E/S.right>1&&(S=o[++v]);const D=Math.abs(E-S.left),k=Math.abs(E-S.right),O=Math.min(D,k);this.image.data[b+E]=Math.max(0,Math.min(255,(S.isDash?O:-O)+l+128))}}addDash(o,l){const u=this.getKey(o,l);if(this.positions[u])return this.positions[u];const f="round"===l,b=f?7:0,v=2*b+1;if(this.nextRow+v>this.height)return ln("LineAtlas out of space"),null;0===o.length&&o.push(1);let S=0;for(let k=0;k<o.length;k++)o[k]<0&&(ln("Negative value is found in line dasharray, replacing values with 0"),o[k]=0),S+=o[k];if(0!==S){const k=this.width/S,O=this.getDashRanges(o,this.width,k);f?this.addRoundDash(O,k,b):this.addRegularDash(O,"square"===l?.5*k:0)}const E=this.nextRow+b;this.nextRow+=v;const D={tl:[E,b],br:[S,0]};return this.positions[u]=D,D}}Mn(cb,"LineAtlas");class xy{constructor(o){const l={},u=[];for(const S in o){const E=o[S],D=l[S]={};for(const k in E.glyphs){const O=E.glyphs[+k];if(!O||0===O.bitmap.width||0===O.bitmap.height)continue;const F=O.metrics.localGlyph?2:1,V={x:0,y:0,w:O.bitmap.width+2*F,h:O.bitmap.height+2*F};u.push(V),D[k]=V}}const{w:f,h:b}=iu(u),v=new Jc({width:f||1,height:b||1});for(const S in o){const E=o[S];for(const D in E.glyphs){const k=E.glyphs[+D];if(!k||0===k.bitmap.width||0===k.bitmap.height)continue;const O=l[S][D],F=k.metrics.localGlyph?2:1;Jc.copy(k.bitmap,v,{x:0,y:0},{x:O.x+F,y:O.y+F},k.bitmap)}}this.image=v,this.positions=l}}Mn(xy,"GlyphAtlas");class ox{constructor(o){this.tileID=new ta(o.tileID.overscaledZ,o.tileID.wrap,o.tileID.canonical.z,o.tileID.canonical.x,o.tileID.canonical.y),this.tileZoom=o.tileZoom,this.uid=o.uid,this.zoom=o.zoom,this.canonical=o.tileID.canonical,this.pixelRatio=o.pixelRatio,this.tileSize=o.tileSize,this.source=o.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=o.showCollisionBoxes,this.collectResourceTiming=!!o.collectResourceTiming,this.returnDependencies=!!o.returnDependencies,this.promoteId=o.promoteId,this.enableTerrain=!!o.enableTerrain,this.isSymbolTile=o.isSymbolTile,this.tileTransform=eh(o.tileID.canonical,o.projection),this.projection=o.projection}parse(o,l,u,f,b){this.status="parsing",this.data=o,this.collisionBoxArray=new pr;const v=new Z1(Object.keys(o.layers).sort()),S=new sh(this.tileID,this.promoteId);S.bucketLayerIDs=[];const E={},D=new cb(256,256),k={featureIndex:S,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:D,availableImages:u},O=l.familiesBySource[this.source];for(const Ae in O){const ke=o.layers[Ae];if(!ke)continue;let ct=!1,st=!1;for(const dt of O[Ae])"symbol"===dt[0].type?ct=!0:st=!0;if(!0===this.isSymbolTile&&!ct||!1===this.isSymbolTile&&!st)continue;1===ke.version&&ln(`Vector tile source "${this.source}" layer "${Ae}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const yt=v.encode(Ae),Ht=[];for(let dt=0;dt<ke.length;dt++){const It=ke.feature(dt),Et=S.getId(It,Ae);Ht.push({feature:It,id:Et,index:dt,sourceLayerIndex:yt})}for(const dt of O[Ae]){const It=dt[0];void 0!==this.isSymbolTile&&"symbol"===It.type!==this.isSymbolTile||It.minzoom&&this.zoom<Math.floor(It.minzoom)||It.maxzoom&&this.zoom>=It.maxzoom||"none"!==It.visibility&&(Kf(dt,this.zoom,u),(E[It.id]=It.createBucket({index:S.bucketLayerIDs.length,layers:dt,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:yt,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:u})).populate(Ht,k,this.tileID.canonical,this.tileTransform),S.bucketLayerIDs.push(dt.map(Et=>Et.id)))}}let F,V,U,G;D.trim();const J={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ue=()=>{if(F)return b(F);if(V&&U&&G){const Ae=new xy(V),ke=new jg(U,G);for(const ct in E){const st=E[ct];st instanceof Xu?(Kf(st.layers,this.zoom,u),TI(st,V,Ae.positions,U,ke.iconPositions,this.showCollisionBoxes,u,this.tileID.canonical,this.tileZoom,this.projection)):st.hasPattern&&(st instanceof W_||st instanceof _c||st instanceof kg)&&(Kf(st.layers,this.zoom,u),st.addFeatures(k,this.tileID.canonical,ke.patternPositions,u,this.tileTransform))}this.status="done",b(null,{buckets:vn(E).filter(ct=>!ct.isEmpty()),featureIndex:S,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ae.image,lineAtlas:D,imageAtlas:ke,glyphMap:this.returnDependencies?V:null,iconMap:this.returnDependencies?U:null,glyphPositions:this.returnDependencies?Ae.positions:null})}},we=$t(k.glyphDependencies,Ae=>Object.keys(Ae).map(Number));Object.keys(we).length?f.send("getGlyphs",{uid:this.uid,stacks:we},(Ae,ke)=>{F||(F=Ae,V=ke,ue())},void 0,!1,J):V={};const de=Object.keys(k.iconDependencies);de.length?f.send("getImages",{icons:de,source:this.source,tileID:this.tileID,type:"icons"},(Ae,ke)=>{F||(F=Ae,U=ke,ue())},void 0,!1,J):U={};const ve=Object.keys(k.patternDependencies);ve.length?f.send("getImages",{icons:ve,source:this.source,tileID:this.tileID,type:"patterns"},(Ae,ke)=>{F||(F=Ae,G=ke,ue())},void 0,!1,J):G={},ue()}}function Kf(a,o,l){const u=new P(o);for(const f of a)f.recalculate(u,l)}class ub{constructor(o){this.entries={},this.scheduler=o}request(o,l,u,f){const b=this.entries[o]=this.entries[o]||{callbacks:[]};if(b.result){const[v,S]=b.result;return this.scheduler?this.scheduler.add(()=>{f(v,S)},l):f(v,S),()=>{}}return b.callbacks.push(f),b.cancel||(b.cancel=u((v,S)=>{b.result=[v,S];for(const E of b.callbacks)this.scheduler?this.scheduler.add(()=>{E(v,S)},l):E(v,S);setTimeout(()=>delete this.entries[o],3e3)})),()=>{b.result||(b.callbacks=b.callbacks.filter(v=>v!==f),b.callbacks.length||(b.cancel(),delete this.entries[o]))}}}function wy(a,o,l){const u=JSON.stringify(a.request);return a.data&&(this.deduped.entries[u]={result:[null,a.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom},f=>{const b=j(a.request,(v,S,E,D)=>{v?f(v):S&&f(null,{vectorTile:l?void 0:new sp(new Vg(S)),rawData:S,cacheControl:E,expires:D})});return()=>{b.cancel(),f()}},o)}const db=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Sy{static from(o){if(!(o instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[l,u]=new Uint8Array(o,0,2);if(219!==l)throw new Error("Data does not appear to be in a KDBush format.");const f=u>>4;if(1!==f)throw new Error(`Got v${f} data when expected v1.`);const b=db[15&u];if(!b)throw new Error("Unrecognized array type.");const[v]=new Uint16Array(o,2,1),[S]=new Uint32Array(o,4,1);return new Sy(S,v,b,o)}constructor(o,l=64,u=Float64Array,f){if(isNaN(o)||o<0)throw new Error(`Unpexpected numItems value: ${o}.`);this.numItems=+o,this.nodeSize=Math.min(Math.max(+l,2),65535),this.ArrayType=u,this.IndexArrayType=o<65536?Uint16Array:Uint32Array;const b=db.indexOf(this.ArrayType),v=2*o*this.ArrayType.BYTES_PER_ELEMENT,S=o*this.IndexArrayType.BYTES_PER_ELEMENT,E=(8-S%8)%8;if(b<0)throw new Error(`Unexpected typed array class: ${u}.`);f&&f instanceof ArrayBuffer?(this.data=f,this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+S+E,2*o),this._pos=2*o,this._finished=!0):(this.data=new ArrayBuffer(8+v+S+E),this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+S+E,2*o),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+b]),new Uint16Array(this.data,2,1)[0]=l,new Uint32Array(this.data,4,1)[0]=o)}add(o,l){const u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=o,this.coords[this._pos++]=l,u}finish(){const o=this._pos>>1;if(o!==this.numItems)throw new Error(`Added ${o} items when expected ${this.numItems}.`);return sx(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(o,l,u,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:b,coords:v,nodeSize:S}=this,E=[0,b.length-1,0],D=[];for(;E.length;){const k=E.pop()||0,O=E.pop()||0,F=E.pop()||0;if(O-F<=S){for(let J=F;J<=O;J++){const ue=v[2*J],we=v[2*J+1];ue>=o&&ue<=u&&we>=l&&we<=f&&D.push(b[J])}continue}const V=F+O>>1,U=v[2*V],G=v[2*V+1];U>=o&&U<=u&&G>=l&&G<=f&&D.push(b[V]),(0===k?o<=U:l<=G)&&(E.push(F),E.push(V-1),E.push(1-k)),(0===k?u>=U:f>=G)&&(E.push(V+1),E.push(O),E.push(1-k))}return D}within(o,l,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:b,nodeSize:v}=this,S=[0,f.length-1,0],E=[],D=u*u;for(;S.length;){const k=S.pop()||0,O=S.pop()||0,F=S.pop()||0;if(O-F<=v){for(let J=F;J<=O;J++)Ty(b[2*J],b[2*J+1],o,l)<=D&&E.push(f[J]);continue}const V=F+O>>1,U=b[2*V],G=b[2*V+1];Ty(U,G,o,l)<=D&&E.push(f[V]),(0===k?o-u<=U:l-u<=G)&&(S.push(F),S.push(V-1),S.push(1-k)),(0===k?o+u>=U:l+u>=G)&&(S.push(V+1),S.push(O),S.push(1-k))}return E}}function sx(a,o,l,u,f,b){if(f-u<=l)return;const v=u+f>>1;ax(a,o,v,u,f,b),sx(a,o,l,u,v-1,1-b),sx(a,o,l,v+1,f,1-b)}function ax(a,o,l,u,f,b){for(;f>u;){if(f-u>600){const D=f-u+1,k=l-u+1,O=Math.log(D),F=.5*Math.exp(2*O/3),V=.5*Math.sqrt(O*F*(D-F)/D)*(k-D/2<0?-1:1);ax(a,o,l,Math.max(u,Math.floor(l-k*F/D+V)),Math.min(f,Math.floor(l+(D-k)*F/D+V)),b)}const v=o[2*l+b];let S=u,E=f;for(yp(a,o,u,l),o[2*f+b]>v&&yp(a,o,u,f);S<E;){for(yp(a,o,S,E),S++,E--;o[2*S+b]<v;)S++;for(;o[2*E+b]>v;)E--}o[2*u+b]===v?yp(a,o,u,E):(E++,yp(a,o,E,f)),E<=l&&(u=E+1),l<=E&&(f=E-1)}}function yp(a,o,l,u){Cy(a,l,u),Cy(o,2*l,2*u),Cy(o,2*l+1,2*u+1)}function Cy(a,o,l){const u=a[o];a[o]=a[l],a[l]=u}function Ty(a,o,l,u){const f=a-l,b=o-u;return f*f+b*b}p.ARRAY_TYPE=$a,p.AUTH_ERR_MSG=_e,p.Aabb=ea,p.Actor=class{constructor(a,o,l){this.target=a,this.parent=o,this.mapId=l,this.callbacks={},this.cancelCallbacks={},bt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=pn()?a:he,this.scheduler=new my}send(a,o,l,u,f=!1,b){const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(l.metadata=b,this.callbacks[v]=l);const S=Tn(this.globalScope)?void 0:[];return this.target.postMessage({id:v,type:a,hasCallback:!!l,targetMapId:u,mustQueue:f,sourceMapId:this.mapId,data:Qs(o,S)},S),{cancel:()=>{l&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(a){const o=a.data,l=o.id;if(l&&(!o.targetMapId||this.mapId===o.targetMapId))if("<cancel>"===o.type){const u=this.cancelCallbacks[l];delete this.cancelCallbacks[l],u&&u.cancel()}else if(o.mustQueue||pn()){const u=this.callbacks[l];this.cancelCallbacks[l]=this.scheduler.add(()=>this.processTask(l,o),u&&u.metadata||{type:"message"})}else this.processTask(l,o)}processTask(a,o){if("<response>"===o.type){const l=this.callbacks[a];delete this.callbacks[a],l&&(o.error?l(uc(o.error)):l(null,uc(o.data)))}else{const l=Tn(this.globalScope)?void 0:[],u=o.hasCallback?(b,v)=>{delete this.cancelCallbacks[a],this.target.postMessage({id:a,type:"<response>",sourceMapId:this.mapId,error:b?Qs(b):null,data:Qs(v,l)},l)}:b=>{},f=uc(o.data);if(this.parent[o.type])this.parent[o.type](o.sourceMapId,f,u);else if(this.parent.getWorkerSource){const b=o.type.split(".");this.parent.getWorkerSource(o.sourceMapId,b[0],f.source)[b[1]](f,u)}else u(new Error(`Could not find function ${o.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},p.CanonicalTileID=Bf,p.Color=Eo,p.ColorMode=Ec,p.CullFaceMode=Wl,p.DEMData=ob,p.DataConstantProperty=q,p.DedupedRequest=ub,p.DepthMode=Ku,p.EXTENT=Wn,p.Elevation=class{isDataAvailableAtPoint(a){const o=this._source();if(this.isUsingMockSource()||!o||a.y<0||a.y>1)return!1;const l=o.getSource().maxzoom,u=1<<l,f=Math.floor(a.x),b=Math.floor((a.x-f)*u),v=Math.floor(a.y*u),S=this.findDEMTileFor(new ta(l,f,l,b,v));return!(!S||!S.dem)}getAtPointOrZero(a,o=0){return this.getAtPoint(a,o)||0}getAtPoint(a,o,l=!0){if(this.isUsingMockSource())return null;null==o&&(o=null);const u=this._source();if(!u||a.y<0||a.y>1)return o;const f=u.getSource().maxzoom,b=1<<f,v=Math.floor(a.x),S=a.x-v,E=new ta(f,v,f,Math.floor(S*b),Math.floor(a.y*b)),D=this.findDEMTileFor(E);if(!D||!D.dem)return o;const k=D.dem,O=1<<D.tileID.canonical.z,F=(S*O-D.tileID.canonical.x)*k.dim,V=(a.y*O-D.tileID.canonical.y)*k.dim,U=Math.floor(F),G=Math.floor(V);return(l?this.exaggeration():1)*qi(qi(k.get(U,G),k.get(U,G+1),V-G),qi(k.get(U+1,G),k.get(U+1,G+1),V-G),F-U)}getAtTileOffset(a,o,l){const u=1<<a.canonical.z;return this.getAtPointOrZero(new Vo(a.wrap+(a.canonical.x+o/Wn)/u,(a.canonical.y+l/Wn)/u))}getAtTileOffsetFunc(a,o,l,u){return f=>{const b=this.getAtTileOffset(a,f.x,f.y),v=u.upVector(a.canonical,f.x,f.y);return Ga(v,v,b*u.upVectorScale(a.canonical,o,l).metersToTile),v}}getForTilePoints(a,o,l,u){if(this.isUsingMockSource())return!1;const f=oh.create(this,a,u);return!!f&&(o.forEach(b=>{b[2]=this.exaggeration()*f.getElevationAt(b[0],b[1],l)}),!0)}getMinMaxForTile(a){if(this.isUsingMockSource())return null;const o=this.findDEMTileFor(a);if(!o||!o.dem)return null;const l=o.dem.tree,u=o.tileID,f=1<<a.canonical.z-u.canonical.z;let b=a.canonical.x/f-u.canonical.x,v=a.canonical.y/f-u.canonical.y,S=0;for(let E=0;E<a.canonical.z-u.canonical.z&&!l.leaves[S];E++){b*=2,v*=2;const D=2*Math.floor(v)+Math.floor(b);S=l.childOffsets[S]+D,b%=1,v%=1}return{min:this.exaggeration()*l.minimums[S],max:this.exaggeration()*l.maximums[S]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(a,o,l){throw new Error("Pure virtual method called.")}pointCoordinate(a){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(a){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},p.ErrorEvent=ns,p.EvaluationParameters=P,p.Event=ll,p.Evented=Al,p.FillExtrusionBucket=kg,p.Frustum=Hd,p.FrustumCorners=Bu,p.GLOBE_RADIUS=fc,p.GLOBE_SCALE_MATCH_LATITUDE=45,p.GLOBE_ZOOM_THRESHOLD_MAX=6,p.GLOBE_ZOOM_THRESHOLD_MIN=5,p.GlobeSharedBuffers=class{constructor(a){this._createGrid(a),this._createPoles(a)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const a of this._poleSegments)a.destroy();for(const a of this._gridSegments)a.withSkirts.destroy(),a.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const a of this._wireframeSegments)a.destroy()}}_fillGridMeshWithLods(a,o){const l=new zt,u=new Vn,f=[],b=a+1+2,v=o[0]+1,S=o[0]+1+(1+o.length),E=(D,k,O)=>{let F=D===b-1?D-2:0===D?D:D-1;return F+=O?24575:0,[F,k]};for(let D=0;D<b;++D)l.emplaceBack(...E(D,0,!0));for(let D=0;D<v;++D)for(let k=0;k<b;++k)l.emplaceBack(...E(k,D,(0===k||k===b-1)&&!0));for(let D=0;D<o.length;++D){const k=o[D];for(let O=0;O<b;++O)l.emplaceBack(...E(O,k,!0))}for(let D=0;D<o.length;++D){const k=u.length,O=o[D]+1+2,F=new Vn;for(let G=0;G<O-1;G++){const J=G===O-2,ue=J?b*(S-o.length+D-G):b;for(let we=0;we<b-1;we++){const de=G*b+we;0===G||J||0===we||we===b-2?(F.emplaceBack(de+1,de,de+ue),F.emplaceBack(de+ue,de+ue+1,de+1)):(u.emplaceBack(de+1,de,de+ue),u.emplaceBack(de+ue,de+ue+1,de+1))}}const V=to.simpleSegment(0,k,l.length,u.length-k);for(let G=0;G<F.uint16.length;G+=3)u.emplaceBack(F.uint16[G],F.uint16[G+1],F.uint16[G+2]);const U=to.simpleSegment(0,k,l.length,u.length-k);f.push({withoutSkirts:V,withSkirts:U})}return{vertices:l,indices:u,segments:f}}_createGrid(a){const o=this._fillGridMeshWithLods(64,Tf);this._gridSegments=o.segments,this._gridBuffer=a.createVertexBuffer(o.vertices,Cf.members),this._gridIndexBuffer=a.createIndexBuffer(o.indices,!0)}_createPoles(a){const o=new Vn;for(let f=0;f<=64;f++)o.emplaceBack(0,f+1,f+2);this._poleIndexBuffer=a.createIndexBuffer(o,!0);const l=new ji,u=new ji;this._poleSegments=[];for(let f=0,b=0;f<5;f++){const v=360/(1<<f);l.emplaceBack(0,-fc,0,.5,0),u.emplaceBack(0,-fc,0,.5,1);for(let S=0;S<=64;S++){const E=S/64,D=qi(0,v,E),[k,O,F]=Df(qS,GS,D,fc);l.emplaceBack(k,O,F,E,0),u.emplaceBack(k,O,F,E,1)}this._poleSegments.push(to.simpleSegment(b,0,66,64)),b+=66}this._poleNorthVertexBuffer=a.createVertexBuffer(l,Sf,!1),this._poleSouthVertexBuffer=a.createVertexBuffer(u,Sf,!1)}getGridBuffers(a,o){return[this._gridBuffer,this._gridIndexBuffer,o?this._gridSegments[a].withSkirts:this._gridSegments[a].withoutSkirts]}getPoleBuffers(a){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[a]]}getWirefameBuffers(a,o){if(!this._wireframeSegments){const l=new _o,u=64,f=u+1+2,b=1;this._wireframeSegments=[];for(let v=0,S=0;v<Tf.length;v++){const E=Tf[v];for(let k=b;k<E+b;k++)for(let O=b;O<u+b;O++){const F=k*f+O;l.emplaceBack(F,F+1),l.emplaceBack(F,F+f),l.emplaceBack(F,F+f+1)}const D=E*u*3;this._wireframeSegments.push(to.simpleSegment(0,S,(E+1)*f,D)),S+=D}this._wireframeIndexBuffer=a.createIndexBuffer(l)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[o]]}},p.GlyphManager=hp,p.ImagePosition=Hf,p.KDBush=Sy,p.LivePerformanceUtils=oo,p.LngLat=Ir,p.LngLatBounds=Lu,p.LocalGlyphMode=ly,p.MAX_MERCATOR_LATITUDE=ls,p.MercatorCoordinate=Vo,p.ONE_EM=24,p.OverscaledTileID=ta,p.PerformanceMarkers=br,p.Point=ge,p.Properties=be,p.RGBAImage=ma,p.Ray=S_,p.RequestManager=class{constructor(a,o,l){this._transformRequestFn=a,this._customAccessToken=o,this._silenceAuthErrors=!!l,this._createSkuToken()}_createSkuToken(){const a=function(){let o="";for(let l=0;l<10;l++)o+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",_n,o].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=a.token,this._skuTokenExpiresAt=a.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(a,o){return this._transformRequestFn&&this._transformRequestFn(a,o)||{url:a}}normalizeStyleURL(a,o){if(!Te(a))return a;const l=Xt(a);return l.path=`/styles/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||o)}normalizeGlyphsURL(a,o){if(!Te(a))return a;const l=Xt(a);return l.path=`/fonts/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||o)}normalizeSourceURL(a,o,l,u){if(!Te(a))return a;const f=Xt(a);return f.path=`/v4/${f.authority}.json`,f.params.push("secure"),l&&f.params.push(`language=${l}`),u&&f.params.push(`worldview=${u}`),this._makeAPIURL(f,this._customAccessToken||o)}normalizeSpriteURL(a,o,l,u){const f=Xt(a);return Te(a)?(f.path=`/styles/v1${f.path}/sprite${o}${l}`,this._makeAPIURL(f,this._customAccessToken||u)):(f.path+=`${o}${l}`,Bt(f))}normalizeTileURL(a,o,l){if(this._isSkuTokenExpired()&&this._createSkuToken(),a&&!Te(a))return a;const u=Xt(a);u.path=u.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${o||l&&"raster"!==u.authority&&512===l?"@2x":""}${Qe.supported?".webp":"$1"}`),"raster"===u.authority?u.path=`/${Xe.RASTER_URL_PREFIX}${u.path}`:(u.path=u.path.replace(/^.+\/v4\//,"/"),u.path=`/${Xe.TILE_URL_VERSION}${u.path}`);const f=this._customAccessToken||function(b){for(const v of b){const S=v.match(/^access_token=(.*)$/);if(S)return S[1]}return null}(u.params)||Xe.ACCESS_TOKEN;return Xe.REQUIRE_ACCESS_TOKEN&&f&&this._skuToken&&u.params.push(`sku=${this._skuToken}`),this._makeAPIURL(u,f)}canonicalizeTileURL(a,o){const l=Xt(a);if(!l.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!l.path.match(/\.[\w]+$/))return a;let u="mapbox://";l.path.match(/^\/raster\/v1\//)?u+=`raster/${l.path.replace(`/${Xe.RASTER_URL_PREFIX}/`,"")}`:u+=`tiles/${l.path.replace(`/${Xe.TILE_URL_VERSION}/`,"")}`;let f=l.params;return o&&(f=f.filter(b=>!b.match(/^access_token=/))),f.length&&(u+=`?${f.join("&")}`),u}canonicalizeTileset(a,o){const l=!!o&&Te(o),u=[];for(const f of a.tiles||[])Ee(f)?u.push(this.canonicalizeTileURL(f,l)):u.push(f);return u}_makeAPIURL(a,o){const l="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",u=Xt(Xe.API_URL);if(a.protocol=u.protocol,a.authority=u.authority,"http"===a.protocol){const f=a.params.indexOf("secure");f>=0&&a.params.splice(f,1)}if("/"!==u.path&&(a.path=`${u.path}${a.path}`),!Xe.REQUIRE_ACCESS_TOKEN)return Bt(a);if(o=o||Xe.ACCESS_TOKEN,!this._silenceAuthErrors){if(!o)throw new Error(`An API access token is required to use Mapbox GL. ${l}`);if("s"===o[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${l}`)}return a.params=a.params.filter(f=>-1===f.indexOf("access_token")),a.params.push(`access_token=${o||""}`),Bt(a)}},p.ResourceType=hi,p.SegmentVector=to,p.SourceCache=rh,p.StencilMode=Xf,p.StructArrayLayout1ui2=Js,p.StructArrayLayout2f1f2i16=Hn,p.StructArrayLayout2i4=zt,p.StructArrayLayout2ui4=_o,p.StructArrayLayout3f12=wi,p.StructArrayLayout3ui6=Vn,p.StructArrayLayout4i8=Tt,p.StructArrayLayout5f20=ji,p.Texture=nh,p.Tile=Wf,p.Transitionable=$,p.Uniform1f=Zc,p.Uniform1i=class extends jl{constructor(a){super(a),this.current=0}set(a,o,l){this.fetchUniformLocation(a,o)&&this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}},p.Uniform2f=class extends jl{constructor(a){super(a),this.current=[0,0]}set(a,o,l){this.fetchUniformLocation(a,o)&&(l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1])))}},p.Uniform3f=class extends jl{constructor(a){super(a),this.current=[0,0,0]}set(a,o,l){this.fetchUniformLocation(a,o)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2])))}},p.Uniform4f=VS,p.UniformColor=Hv,p.UniformMatrix2f=class extends jl{constructor(a){super(a),this.current=bI}set(a,o,l){if(this.fetchUniformLocation(a,o))for(let u=0;u<4;u++)if(l[u]!==this.current[u]){this.current=l,this.gl.uniformMatrix2fv(this.location,!1,l);break}}},p.UniformMatrix3f=class extends jl{constructor(a){super(a),this.current=gI}set(a,o,l){if(this.fetchUniformLocation(a,o))for(let u=0;u<9;u++)if(l[u]!==this.current[u]){this.current=l,this.gl.uniformMatrix3fv(this.location,!1,l);break}}},p.UniformMatrix4f=class extends jl{constructor(a){super(a),this.current=Dt}set(a,o,l){if(this.fetchUniformLocation(a,o)){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let u=1;u<16;u++)if(l[u]!==this.current[u]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}}},p.UnwrappedTileID=Pg,p.ValidationError=yn,p.VectorTileFeature=vl,p.VectorTileWorkerSource=class extends Al{constructor(a,o,l,u,f){super(),this.actor=a,this.layerIndex=o,this.availableImages=l,this.loadVectorData=f||wy,this.loading={},this.loaded={},this.deduped=new ub(a.scheduler),this.isSpriteLoaded=u,this.scheduler=a.scheduler}loadTile(a,o){const l=a.uid,u=a&&a.request,f=u&&u.collectResourceTiming,b=this.loading[l]=new ox(a);b.abort=this.loadVectorData(a,(v,S)=>{const E=!this.loading[l];if(delete this.loading[l],E||v||!S)return b.status="done",E||(this.loaded[l]=b),o(v);const D=S.rawData,k={};S.expires&&(k.expires=S.expires),S.cacheControl&&(k.cacheControl=S.cacheControl),b.vectorTile=S.vectorTile||new sp(new Vg(D));const O=()=>{b.parse(b.vectorTile,this.layerIndex,this.availableImages,this.actor,(F,V)=>{if(F||!V)return o(F);const U={};if(f){const G=Wo(u);G.length>0&&(U.resourceTiming=JSON.parse(JSON.stringify(G)))}o(null,xn({rawTileData:D.slice(0)},V,k,U))})};this.isSpriteLoaded?O():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(O,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom}):O()}),this.loaded=this.loaded||{},this.loaded[l]=b})}reloadTile(a,o){const l=this.loaded,u=a.uid,f=this;if(l&&l[u]){const b=l[u];b.showCollisionBoxes=a.showCollisionBoxes,b.enableTerrain=!!a.enableTerrain,b.projection=a.projection,b.tileTransform=eh(a.tileID.canonical,a.projection);const v=(S,E)=>{const D=b.reloadCallback;D&&(delete b.reloadCallback,b.parse(b.vectorTile,f.layerIndex,this.availableImages,f.actor,D)),o(S,E)};"parsing"===b.status?b.reloadCallback=v:"done"===b.status&&(b.vectorTile?b.parse(b.vectorTile,this.layerIndex,this.availableImages,this.actor,v):v())}}abortTile(a,o){const l=a.uid,u=this.loading[l];u&&(u.abort&&u.abort(),delete this.loading[l]),o()}removeTile(a,o){const l=this.loaded,u=a.uid;l&&l[u]&&delete l[u],o()}},p.WritingMode=Ka,p.ZoomDependentExpression=_r,p.add=qa,p.addDynamicAttributes=qf,p.adjoint=function(a,o){var l=o[0],u=o[1],f=o[2],b=o[3],v=o[4],S=o[5],E=o[6],D=o[7],k=o[8];return a[0]=v*k-S*D,a[1]=f*D-u*k,a[2]=u*S-f*v,a[3]=S*E-b*k,a[4]=l*k-f*E,a[5]=f*b-l*S,a[6]=b*D-v*E,a[7]=u*E-l*D,a[8]=l*v-u*b,a},p.asyncAll=xt,p.bezier=Se,p.bindAll=bt,p.boundsAttributes=_y,p.bufferConvexPolygon=function(a,o){const l=[];for(let u=0;u<a.length;u++){const f=Mt(u-1,-1,a.length-1),b=Mt(u+1,-1,a.length-1),v=a[u],S=a[b],E=a[f].sub(v).unit(),D=S.sub(v).unit(),k=D.angleWithSep(E.x,E.y),O=E.add(D).unit().mult(-1*o/Math.sin(k/2));l.push(v.add(O))}return l},p.cacheEntryPossiblyAdded=function(a){Co++,Co>Pr&&(a.getActor().send("enforceCacheSizeLimit",Oi),Co=0)},p.calculateGlobeLabelMatrix=function(a,o){const{x:l,y:u}=a.point,f=ug(l,u,a.worldSize/a._pixelsPerMercatorPixel,0,0);return _l(f,f,cg(Kc(o)))},p.calculateGlobeMatrix=function(a){const{x:o,y:l}=a.point,{lng:u,lat:f}=a._center;return ug(o,l,a.worldSize,u,f)},p.calculateGlobeMercatorMatrix=function(a){const o=a.pixelsPerMeter,l=o/Hl(1,a.center.lat),u=Do(new Float64Array(16));return ng(u,u,[a.point.x,a.point.y,0]),Fu(u,u,[l,l,o]),Float32Array.from(u)},p.circumferenceAtLatitude=A_,p.clamp=lt,p.clearTileCache=function(a){if(!Ro())return;const o=he.caches.delete(So);a&&o.catch(a).then(()=>a())},p.clipLine=U0,p.clone=function(a){var o=new $a(16);return o[0]=a[0],o[1]=a[1],o[2]=a[2],o[3]=a[3],o[4]=a[4],o[5]=a[5],o[6]=a[6],o[7]=a[7],o[8]=a[8],o[9]=a[9],o[10]=a[10],o[11]=a[11],o[12]=a[12],o[13]=a[13],o[14]=a[14],o[15]=a[15],o},p.clone$1=vi,p.collisionCircleLayout=I1,p.config=Xe,p.conjugate=function(a,o){return a[0]=-o[0],a[1]=-o[1],a[2]=-o[2],a[3]=o[3],a},p.create=function(){var a=new $a(16);return $a!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},p.create$1=jS,p.createExpression=Da,p.createLayout=We,p.createStyleLayer=function(a){return"custom"===a.type?new ex(a):new rb[a.type](a)},p.cross=y_,p.degToRad=Be,p.distance=function(a,o){return Math.hypot(o[0]-a[0],o[1]-a[1],o[2]-a[2])},p.div=function(a,o,l){return a[0]=o[0]/l[0],a[1]=o[1]/l[1],a[2]=o[2]/l[2],a},p.dot=Ns,p.earthRadius=Af,p.ease=Je,p.easeCubicInOut=$e,p.ecefToLatLng=function([a,o,l]){const u=Math.hypot(a,o,l),f=Math.atan2(a,l),b=.5*Math.PI-Math.acos(-o/u);return new Ir(K(f),K(b))},p.emitValidationErrors=ku,p.endsWith=dn,p.enforceCacheSizeLimit=function(a){po(),wn&&wn.then(o=>{o.keys().then(l=>{for(let u=0;u<l.length-a;u++)o.delete(l[u])})})},p.evaluateSizeForFeature=vc,p.evaluateSizeForZoom=cp,p.evaluateVariableOffset=W0,p.evented=w,p.exactEquals=function(a,o){return a[0]===o[0]&&a[1]===o[1]&&a[2]===o[2]&&a[3]===o[3]},p.exactEquals$1=function(a,o){return a[0]===o[0]&&a[1]===o[1]&&a[2]===o[2]},p.exported=No,p.exported$1=Qe,p.extend=xn,p.extend$1=kl,p.fillExtrusionHeightLift=E0,p.filterObject=Wi,p.fromMat4=function(a,o){return a[0]=o[0],a[1]=o[1],a[2]=o[2],a[3]=o[4],a[4]=o[5],a[5]=o[6],a[6]=o[8],a[7]=o[9],a[8]=o[10],a},p.fromQuat=function(a,o){var l=o[0],u=o[1],f=o[2],b=o[3],v=l+l,S=u+u,E=f+f,D=l*v,k=u*v,O=u*S,F=f*v,V=f*S,U=f*E,G=b*v,J=b*S,ue=b*E;return a[0]=1-O-U,a[1]=k+ue,a[2]=F-J,a[3]=0,a[4]=k-ue,a[5]=1-D-U,a[6]=V+G,a[7]=0,a[8]=F+J,a[9]=V-G,a[10]=1-D-O,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},p.fromRotation=function(a,o){var l=Math.sin(o),u=Math.cos(o);return a[0]=u,a[1]=l,a[2]=0,a[3]=-l,a[4]=u,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},p.fromScaling=Wv,p.furthestTileCorner=function(a){const o=Math.round((a+45+360)%360/90)%4;return Me[o]},p.getAABBPointSquareDist=function(a,o,l){let u=0;for(let f=0;f<2;++f){const b=l?l[f]:0;a[f]>b&&(u+=(a[f]-b)*(a[f]-b)),o[f]<b&&(u+=(b-o[f])*(b-o[f]))}return u},p.getAnchorAlignment=ry,p.getAnchorJustification=Wg,p.getBounds=function(a){let o=1/0,l=1/0,u=-1/0,f=-1/0;for(const b of a)o=Math.min(o,b.x),l=Math.min(l,b.y),u=Math.max(u,b.x),f=Math.max(f,b.y);return{min:new ge(o,l),max:new ge(u,f)}},p.getColumn=Ur,p.getDefaultExportFromCjs=He,p.getGridMatrix=function(a,o,l,u){const f=o.getNorth(),b=o.getSouth(),v=o.getWest(),S=o.getEast(),E=1<<a.z,D=S-v,k=f-b,O=D/64,F=-k/Tf[l],V=[0,O,0,F,0,0,f,v,0];if(a.z>0){const U=180/u;g_(V,V,[U/D+1,0,0,0,U/k+1,0,-.5*U/O,.5*U/F,1])}return V[2]=E,V[5]=a.x,V[8]=a.y,V},p.getImage=ne,p.getJSON=function(a,o){return x(xn(a,{type:"json"}),o)},p.getLatitudinalLod=function(a){const o=ls-5;a=lt(a,-o,o)/o*90;const l=Math.pow(Math.abs(Math.sin(Be(a))),3);return Math.round(l*(Tf.length-1))},p.getMapSessionAPI=Kt,p.getPerformanceMeasurement=Wo,p.getProjection=eb,p.getRTLTextPluginStatus=C,p.getReferrer=bs,p.getTilePoint=function(a,{x:o,y:l},u=0){return new ge(((o-u)*a.scale-a.x)*Wn,(l*a.scale-a.y)*Wn)},p.getTileVec3=function(a,o,l=0){return gf(((o.x-l)*a.scale-a.x)*Wn,(o.y*a.scale-a.y)*Wn,hg(o.z,o.y))},p.getVideo=function(a,o){const l=he.document.createElement("video");l.muted=!0,l.onloadstart=function(){o(null,l)};for(let u=0;u<a.length;u++){const f=he.document.createElement("source");fe(a[u])||(l.crossOrigin="Anonymous"),f.src=a[u],l.appendChild(f)}return{cancel:()=>{}}},p.globeCenterToScreenPoint=function(a){const o=[0,0,0],l=Do(new Float64Array(16));return _l(l,a.pixelMatrix,a.globeMatrix),Ue(o,o,l),new ge(o[0],o[1])},p.globeDenormalizeECEF=cg,p.globeECEFOrigin=function(a,o){const l=[0,0,0];return Ue(l,l,Mf(Kc(o.canonical))),Ue(l,l,a),l},p.globeMetersToEcef=og,p.globeNormalizeECEF=Mf,p.globePixelsToTileUnits=function(a,o){return Wn/(512*Math.pow(2,a))*D_(Kc(o))},p.globePoleMatrixForTile=function(a,o,l){const u=Do(new Float64Array(16)),f=(o/(1<<a)-.5)*Math.PI*2;return ig(u,l.globeMatrix,f),Float32Array.from(u)},p.globeTileBounds=Kc,p.globeTiltAtLngLat=I_,p.globeToMercatorTransition=Gd,p.globeUseCustomAntiAliasing=function(a,o,l){const u=Gd(l.zoom),f=a.style.map._antialias,b=!!o.extStandardDerivatives,v=o.extStandardDerivativesForceOff||a.terrain&&a.terrain.exaggeration()>0;return 0===u&&!f&&!v&&b},p.identity=Do,p.identity$1=x_,p.invert=mf,p.isFullscreen=function(){return!!he.document.fullscreenElement||!!he.document.webkitFullscreenElement},p.isLngLatBehindGlobe=dg,p.isMapAuthenticated=function(a){return Zn.has(a)},p.isMapboxURL=Te,p.isSafariWithAntialiasingBug=function(a){const o=a.navigator?a.navigator.userAgent:null;return!!Tn(a)&&o&&(o.match("Version/15.4")||o.match("Version/15.5")||o.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},p.latFromMercatorY=Mr,p.latLngToECEF=If,p.len=HS,p.length=Nu,p.length$1=function(a){return Math.hypot(a[0],a[1],a[2],a[3])},p.lngFromMercatorX=Xa,p.loadVectorTile=wy,p.makeRequest=x,p.mapValue=function(a,o,l,u,f){return lt((a-o)/(l-o)*(f-u)+u,u,f)},p.mercatorScale=pg,p.mercatorXfromLng=gc,p.mercatorYfromLat=Ul,p.mercatorZfromAltitude=Hl,p.mul=US,p.mul$1=xf,p.multiply=_l,p.multiply$1=g_,p.multiply$2=_f,p.nextPowerOfTwo=wo,p.normalize=Zo,p.normalize$1=Qv,p.normalize$2=Yv,p.number=qi,p.ortho=function(a,o,l,u,f,b,v){var S=1/(o-l),E=1/(u-f),D=1/(b-v);return a[0]=-2*S,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*E,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*D,a[11]=0,a[12]=(o+l)*S,a[13]=(f+u)*E,a[14]=(v+b)*D,a[15]=1,a},p.pbf=tu,p.perspective=function(a,o,l,u,f){var b,v=1/Math.tan(o/2);return a[0]=v/l,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=v,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,null!=f&&f!==1/0?(a[10]=(f+u)*(b=1/(u-f)),a[14]=2*f*u*b):(a[10]=-1,a[14]=-2*u),a},p.pick=function(a,o){const l={};for(let u=0;u<o.length;u++){const f=o[u];f in a&&(l[f]=a[f])}return l},p.plugin=A,p.pointGeometry=Ie,p.polesInViewport=function(a){const o=Do(new Float64Array(16));_l(o,a.pixelMatrix,a.globeMatrix);const l=[0,yl,0],u=[0,pa,0];return Ue(l,l,o),Ue(u,u,o),[l[0]>0&&l[0]<=a.width&&l[1]>0&&l[1]<=a.height&&!dg(a,new Ir(a.center.lat,90)),u[0]>0&&u[0]<=a.width&&u[1]>0&&u[1]<=a.height&&!dg(a,new Ir(a.center.lat,-90))]},p.polygonContainsPoint=Vu,p.polygonIntersectsBox=KS,p.polygonIntersectsPolygon=bg,p.polygonizeBounds=function(a,o,l=0,u=!0){const f=new ge(l,l),b=a.sub(f),v=o.add(f),S=[b,new ge(v.x,b.y),v,new ge(b.x,v.y)];return u&&S.push(b.clone()),S},p.posAttributes=Cf,p.postMapLoadEvent=Y,p.postPerformanceEvent=De,p.postTurnstileEvent=Ti,p.potpack=iu,p.prevPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.floor(Math.log(a)/Math.LN2))},p.radToDeg=K,p.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],p.registerForPluginStateChange=function(a){return a({pluginStatus:g,pluginURL:c}),w.on("pluginStateChange",a),a},p.removeAuthState=function(a){Zn.delete(a)},p.renderColorRamp=eu,p.resample=k_,p.rotateX=b_,p.rotateX$1=ep,p.rotateY=ig,p.rotateY$1=Kv,p.rotateZ=function(a,o,l){var u=Math.sin(l),f=Math.cos(l),b=o[0],v=o[1],S=o[2],E=o[3],D=o[4],k=o[5],O=o[6],F=o[7];return o!==a&&(a[8]=o[8],a[9]=o[9],a[10]=o[10],a[11]=o[11],a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15]),a[0]=b*f+D*u,a[1]=v*f+k*u,a[2]=S*f+O*u,a[3]=E*f+F*u,a[4]=D*f-b*u,a[5]=k*f-v*u,a[6]=O*f-S*u,a[7]=F*f-E*u,a},p.rotateZ$1=function(a,o,l){l*=.5;var u=o[0],f=o[1],b=o[2],v=o[3],S=Math.sin(l),E=Math.cos(l);return a[0]=u*E+f*S,a[1]=f*E-u*S,a[2]=b*E+v*S,a[3]=v*E-b*S,a},p.scale=Fu,p.scale$1=Zv,p.scale$2=Ga,p.scaleAndAdd=Qh,p.set=function(a,o,l,u){return a[0]=o,a[1]=l,a[2]=u,a},p.setCacheLimits=function(a,o){Oi=a,Pr=o},p.setColumn=function(a,o,l){a[4*o+0]=l[0],a[4*o+1]=l[1],a[4*o+2]=l[2],a[4*o+3]=l[3]},p.setRTLTextPlugin=function(a,o,l=!1){if(g===zd||g===df||g===Zh)throw new Error("setRTLTextPlugin cannot be called multiple times.");c=No.resolveURL(a),g=zd,dc=o,_(),l||I()},p.smoothstep=cn,p.spec=_t,p.squaredLength=function(a){var o=a[0],l=a[1],u=a[2];return o*o+l*l+u*u},p.storeAuthState=function(a,o){o?Zn.add(a):Zn.delete(a)},p.sub=Wa,p.subtract=bf,p.symbolSize=K_,p.tileAABB=function(a,o,l,u,f,b,v,S,E){if("globe"===E.name)return function xI(a,o,l){const u=o/a.worldSize,f=a.globeMatrix;if(l.z<=1){const st=Kc(l).getCorners();return ag(st,f,u),ea.fromPoints(st)}const b=E_(l),v=Ef(b);ag(v,f,u);const S=Number.MAX_VALUE,E=[-S,-S,-S],D=[S,S,S];if(b.contains(a.center)){for(const Ht of v)yf(D,D,Ht),vf(E,E,Ht);E[2]=0;const st=a.point,yt=[st.x*u,st.y*u,0];return yf(D,D,yt),vf(E,E,yt),new ea(D,E)}const k=[f[12]*u,f[13]*u,f[14]*u],O=b.getCenter(),F=lt(a.center.lat,-ls,ls),V=lt(O.lat,-ls,ls),U=gc(a.center.lng),G=Ul(F);let J=U-gc(O.lng);const ue=G-Ul(V);J>.5?J-=1:J<-.5&&(J+=1);let we=0;Math.abs(J)>Math.abs(ue)?we=J>=0?1:3:(we=ue>=0?0:2,Qh(k,k,[f[4]*u,f[5]*u,f[6]*u],-Math.sin(Be(ue>=0?b.getSouth():b.getNorth()))*fc));const de=v[we],ve=v[(we+1)%4],Ae=new vI(de,ve,k),ke=[sg(Ae,0)||de[0],sg(Ae,1)||de[1],sg(Ae,2)||de[2]],ct=Gd(a.zoom);if(ct>0){const st=function({x:Ht,y:dt,z:It},Et,Lt,Zt,mt){const an=1/(1<<It);let En=Ht*an,gn=En+an,fi=dt*an,Qt=fi+an,$n=0;const _i=(En+gn)/2-Zt;return _i>.5?$n=-1:_i<-.5&&($n=1),En=((En+$n)*Et-(Zt*=Et))*Lt+Zt,gn=((gn+$n)*Et-Zt)*Lt+Zt,fi=(fi*Et-(mt*=Et))*Lt+mt,Qt=(Qt*Et-mt)*Lt+mt,[[En,Qt,0],[gn,Qt,0],[gn,fi,0],[En,fi,0]]}(l,o,a._pixelsPerMercatorPixel,U,G);for(let Ht=0;Ht<v.length;Ht++)qd(v[Ht],st[Ht],ct);const yt=qa([],st[we],st[(we+1)%4]);Ga(yt,yt,.5),qd(ke,yt,ct)}for(const st of v)yf(D,D,st),vf(E,E,st);return D[2]=Math.min(de[2],ve[2]),yf(D,D,ke),vf(E,E,ke),new ea(D,E)}(a,o,new Bf(l,u,f));const D=eh({z:l,x:u,y:f},E);return new ea([(b+D.x/D.scale)*o,o*(D.y/D.scale),v],[(b+D.x2/D.scale)*o,o*(D.y2/D.scale),S])},p.tileCornersToBounds=E_,p.tileTransform=eh,p.transformMat3=function(a,o,l){var u=o[0],f=o[1],b=o[2];return a[0]=u*l[0]+f*l[3]+b*l[6],a[1]=u*l[1]+f*l[4]+b*l[7],a[2]=u*l[2]+f*l[5]+b*l[8],a},p.transformMat4=Ue,p.transformMat4$1=Yc,p.transformQuat=v_,p.transitionTileAABBinECEF=t0,p.translate=ng,p.transpose=function(a,o){if(a===o){var l=o[1],u=o[2],f=o[5];a[1]=o[3],a[2]=o[6],a[3]=l,a[5]=o[7],a[6]=u,a[7]=f}else a[0]=o[0],a[1]=o[3],a[2]=o[6],a[3]=o[1],a[4]=o[4],a[5]=o[7],a[6]=o[2],a[7]=o[5],a[8]=o[8];return a},p.triggerPluginCompletionEvent=h,p.uniqueId=Wt,p.updateGlobeVertexNormal=function(a,o,l,u,f){const b=5*o+2;a.float32[b+0]=l,a.float32[b+1]=u,a.float32[b+2]=f},p.validateCustomStyleLayer=function(a){const o=[],l=a.id;return void 0===l&&o.push({message:`layers.${l}: missing required property "id"`}),void 0===a.render&&o.push({message:`layers.${l}: missing required method "render"`}),a.renderingMode&&"2d"!==a.renderingMode&&"3d"!==a.renderingMode&&o.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),o},p.validateFilter=a=>da(cc(a)),p.validateFog=a=>da(Xm(a)),p.validateLayer=a=>da(Ii(a)),p.validateLight=a=>da(Wm(a)),p.validateSource=a=>da(Gm(a)),p.validateStyle=Vi,p.validateTerrain=a=>da(qh(a)),p.values=vn,p.vectorTile=Ya,p.version=ft,p.warnOnce=ln,p.window=he,p.wrap=Mt}),je(0,function(p){function he(W){if("number"==typeof W||"boolean"==typeof W||"string"==typeof W||null==W)return JSON.stringify(W);if(Array.isArray(W)){let L="[";for(const ne of W)L+=`${he(ne)},`;return`${L}]`}let z="{";for(const L of Object.keys(W).sort())z+=`${L}:${he(W[L])},`;return`${z}}`}function ft(W){let z="";for(const L of p.refProperties)z+=`/${he(W[L])}`;return z}class qe{constructor(z){this.keyCache={},z&&this.replace(z)}replace(z){this._layerConfigs={},this._layers={},this.update(z,[])}update(z,L){for(const _e of z)this._layerConfigs[_e.id]=_e,(this._layers[_e.id]=p.createStyleLayer(_e)).compileFilter(),this.keyCache[_e.id]&&delete this.keyCache[_e.id];for(const _e of L)delete this.keyCache[_e],delete this._layerConfigs[_e],delete this._layers[_e];this.familiesBySource={};const ne=function(_e,Te){const Ee={};for(let Re=0;Re<_e.length;Re++){const nt=Te&&Te[_e[Re].id]||ft(_e[Re]);Te&&(Te[_e[Re].id]=nt);let vt=Ee[nt];vt||(vt=Ee[nt]=[]),vt.push(_e[Re])}const Ne=[];for(const Re in Ee)Ne.push(Ee[Re]);return Ne}(p.values(this._layerConfigs),this.keyCache);for(const _e of ne){const Te=_e.map(Xt=>this._layers[Xt.id]),Ee=Te[0];if("none"===Ee.visibility)continue;const Ne=Ee.source||"";let Re=this.familiesBySource[Ne];Re||(Re=this.familiesBySource[Ne]={});const nt=Ee.sourceLayer||"_geojsonTileLayer";let vt=Re[nt];vt||(vt=Re[nt]=[]),vt.push(Te)}}}class Xe{loadTile(z,L){const{uid:ne,encoding:_e,rawImageData:Te,padding:Ee,buildQuadTree:Ne}=z,Re=p.window.ImageBitmap&&Te instanceof p.window.ImageBitmap?this.getImageData(Te,Ee):Te;L(null,new p.DEMData(ne,Re,_e,Ee<1,Ne))}getImageData(z,L){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(z.width,z.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=z.width,this.offscreenCanvas.height=z.height,this.offscreenCanvasContext.drawImage(z,0,0,z.width,z.height);const ne=this.offscreenCanvasContext.getImageData(-L,-L,z.width+2*L,z.height+2*L);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ne}}function Qe(W,z){if(0!==W.length){St(W[0],z);for(var L=1;L<W.length;L++)St(W[L],!z)}}function St(W,z){for(var L=0,ne=0,_e=0,Te=W.length,Ee=Te-1;_e<Te;Ee=_e++){var Ne=(W[_e][0]-W[Ee][0])*(W[Ee][1]+W[_e][1]),Re=L+Ne;ne+=Math.abs(L)>=Math.abs(Ne)?L-Re+Ne:Ne-Re+L,L=Re}L+ne>=0!=!!z&&W.reverse()}var Ct=p.getDefaultExportFromCjs(function W(z,L){var ne,_e=z&&z.type;if("FeatureCollection"===_e)for(ne=0;ne<z.features.length;ne++)W(z.features[ne],L);else if("GeometryCollection"===_e)for(ne=0;ne<z.geometries.length;ne++)W(z.geometries[ne],L);else if("Feature"===_e)W(z.geometry,L);else if("Polygon"===_e)Qe(z.coordinates,L);else if("MultiPolygon"===_e)for(ne=0;ne<z.coordinates.length;ne++)Qe(z.coordinates[ne],L);return z});const Ze=p.VectorTileFeature.prototype.toGeoJSON;var ut={exports:{}},jt=p.pointGeometry,_n=p.vectorTile.VectorTileFeature,He=Fn;function Fn(W,z){this.options=z||{},this.features=W,this.length=W.length}function Rt(W,z){this.id="number"==typeof W.id?W.id:void 0,this.type=W.type,this.rawGeometry=1===W.type?[W.geometry]:W.geometry,this.properties=W.tags,this.extent=z||4096}Fn.prototype.feature=function(W){return new Rt(this.features[W],this.options.extent)},Rt.prototype.loadGeometry=function(){var W=this.rawGeometry;this.geometry=[];for(var z=0;z<W.length;z++){for(var L=W[z],ne=[],_e=0;_e<L.length;_e++)ne.push(new jt(L[_e][0],L[_e][1]));this.geometry.push(ne)}return this.geometry},Rt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var W=this.geometry,z=1/0,L=-1/0,ne=1/0,_e=-1/0,Te=0;Te<W.length;Te++)for(var Ee=W[Te],Ne=0;Ne<Ee.length;Ne++){var Re=Ee[Ne];z=Math.min(z,Re.x),L=Math.max(L,Re.x),ne=Math.min(ne,Re.y),_e=Math.max(_e,Re.y)}return[z,ne,L,_e]},Rt.prototype.toGeoJSON=_n.prototype.toGeoJSON;var Dn=p.pbf,Ie=He;function ye(W){var z=new Dn;return function(L,ne){for(var _e in L.layers)ne.writeMessage(3,ge,L.layers[_e])}(W,z),z.finish()}function ge(W,z){var L;z.writeVarintField(15,W.version||1),z.writeStringField(1,W.name||""),z.writeVarintField(5,W.extent||4096);var ne={keys:[],values:[],keycache:{},valuecache:{}};for(L=0;L<W.length;L++)ne.feature=W.feature(L),z.writeMessage(2,oe,ne);var _e=ne.keys;for(L=0;L<_e.length;L++)z.writeStringField(3,_e[L]);var Te=ne.values;for(L=0;L<Te.length;L++)z.writeMessage(4,$e,Te[L])}function oe(W,z){var L=W.feature;void 0!==L.id&&z.writeVarintField(1,L.id),z.writeMessage(2,Ge,W),z.writeVarintField(3,L.type),z.writeMessage(4,Me,L)}function Ge(W,z){var L=W.feature,ne=W.keys,_e=W.values,Te=W.keycache,Ee=W.valuecache;for(var Ne in L.properties){var Re=L.properties[Ne],nt=Te[Ne];if(null!==Re){void 0===nt&&(ne.push(Ne),Te[Ne]=nt=ne.length-1),z.writeVarint(nt);var vt=typeof Re;"string"!==vt&&"boolean"!==vt&&"number"!==vt&&(Re=JSON.stringify(Re));var Xt=vt+":"+Re,Bt=Ee[Xt];void 0===Bt&&(_e.push(Re),Ee[Xt]=Bt=_e.length-1),z.writeVarint(Bt)}}}function Be(W,z){return(z<<3)+(7&W)}function K(W){return W<<1^W>>31}function Me(W,z){for(var L=W.loadGeometry(),ne=W.type,_e=0,Te=0,Ee=L.length,Ne=0;Ne<Ee;Ne++){var Re=L[Ne],nt=1;1===ne&&(nt=Re.length),z.writeVarint(Be(1,nt));for(var vt=3===ne?Re.length-1:Re.length,Xt=0;Xt<vt;Xt++){1===Xt&&1!==ne&&z.writeVarint(Be(2,vt-1));var Bt=Re[Xt].x-_e,oi=Re[Xt].y-Te;z.writeVarint(K(Bt)),z.writeVarint(K(oi)),_e+=Bt,Te+=oi}3===ne&&z.writeVarint(Be(7,1))}}function $e(W,z){var L=typeof W;"string"===L?z.writeStringField(1,W):"boolean"===L?z.writeBooleanField(7,W):"number"===L&&(W%1!=0?z.writeDoubleField(3,W):W<0?z.writeSVarintField(6,W):z.writeVarintField(5,W))}ut.exports=ye,ut.exports.fromVectorTileJs=ye,ut.exports.fromGeojsonVt=function(W,z){z=z||{};var L={};for(var ne in W)L[ne]=new Ie(W[ne].features,z),L[ne].name=ne,L[ne].version=z.version,L[ne].extent=z.extent;return ye({layers:L})},ut.exports.GeoJSONWrapper=Ie;var Se=p.getDefaultExportFromCjs(ut.exports);const Je={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:W=>W},lt=Math.fround||(cn=new Float32Array(1),W=>(cn[0]=+W,cn[0]));var cn;class xn{constructor(z){this.options=Object.assign(Object.create(Je),z),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(z){const{log:L,minZoom:ne,maxZoom:_e}=this.options;L&&console.time("total time");const Te=`prepare ${z.length} points`;L&&console.time(Te),this.points=z;const Ee=[];for(let Re=0;Re<z.length;Re++){const nt=z[Re];if(!nt.geometry)continue;const[vt,Xt]=nt.geometry.coordinates,Bt=lt(Er(vt)),oi=lt(wo(Xt));Ee.push(Bt,oi,1/0,Re,-1,1),this.options.reduce&&Ee.push(0)}let Ne=this.trees[_e+1]=this._createTree(Ee);L&&console.timeEnd(Te);for(let Re=_e;Re>=ne;Re--){const nt=+Date.now();Ne=this.trees[Re]=this._createTree(this._cluster(Ne,Re)),L&&console.log("z%d: %d clusters in %dms",Re,Ne.numItems,+Date.now()-nt)}return L&&console.timeEnd("total time"),this}getClusters(z,L){let ne=((z[0]+180)%360+360)%360-180;const _e=Math.max(-90,Math.min(90,z[1]));let Te=180===z[2]?180:((z[2]+180)%360+360)%360-180;const Ee=Math.max(-90,Math.min(90,z[3]));if(z[2]-z[0]>=360)ne=-180,Te=180;else if(ne>Te){const Xt=this.getClusters([ne,_e,180,Ee],L),Bt=this.getClusters([-180,_e,Te,Ee],L);return Xt.concat(Bt)}const Ne=this.trees[this._limitZoom(L)],Re=Ne.range(Er(ne),wo(Ee),Er(Te),wo(_e)),nt=Ne.data,vt=[];for(const Xt of Re){const Bt=this.stride*Xt;vt.push(nt[Bt+5]>1?Rn(nt,Bt,this.clusterProps):this.points[nt[Bt+3]])}return vt}getChildren(z){const L=this._getOriginId(z),ne=this._getOriginZoom(z),_e="No cluster with the specified id.",Te=this.trees[ne];if(!Te)throw new Error(_e);const Ee=Te.data;if(L*this.stride>=Ee.length)throw new Error(_e);const Ne=this.options.radius/(this.options.extent*Math.pow(2,ne-1)),Re=Te.within(Ee[L*this.stride],Ee[L*this.stride+1],Ne),nt=[];for(const vt of Re){const Xt=vt*this.stride;Ee[Xt+4]===z&&nt.push(Ee[Xt+5]>1?Rn(Ee,Xt,this.clusterProps):this.points[Ee[Xt+3]])}if(0===nt.length)throw new Error(_e);return nt}getLeaves(z,L,ne){const _e=[];return this._appendLeaves(_e,z,L=L||10,ne=ne||0,0),_e}getTile(z,L,ne){const _e=this.trees[this._limitZoom(z)],Te=Math.pow(2,z),{extent:Ee,radius:Ne}=this.options,Re=Ne/Ee,nt=(ne-Re)/Te,vt=(ne+1+Re)/Te,Xt={features:[]};return this._addTileFeatures(_e.range((L-Re)/Te,nt,(L+1+Re)/Te,vt),_e.data,L,ne,Te,Xt),0===L&&this._addTileFeatures(_e.range(1-Re/Te,nt,1,vt),_e.data,Te,ne,Te,Xt),L===Te-1&&this._addTileFeatures(_e.range(0,nt,Re/Te,vt),_e.data,-1,ne,Te,Xt),Xt.features.length?Xt:null}getClusterExpansionZoom(z){let L=this._getOriginZoom(z)-1;for(;L<=this.options.maxZoom;){const ne=this.getChildren(z);if(L++,1!==ne.length)break;z=ne[0].properties.cluster_id}return L}_appendLeaves(z,L,ne,_e,Te){const Ee=this.getChildren(L);for(const Ne of Ee){const Re=Ne.properties;if(Re&&Re.cluster?Te+Re.point_count<=_e?Te+=Re.point_count:Te=this._appendLeaves(z,Re.cluster_id,ne,_e,Te):Te<_e?Te++:z.push(Ne),z.length===ne)break}return Te}_createTree(z){const L=new p.KDBush(z.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ne=0;ne<z.length;ne+=this.stride)L.add(z[ne],z[ne+1]);return L.finish(),L.data=z,L}_addTileFeatures(z,L,ne,_e,Te,Ee){for(const Ne of z){const Re=Ne*this.stride,nt=L[Re+5]>1;let vt,Xt,Bt;if(nt)vt=Wt(L,Re,this.clusterProps),Xt=L[Re],Bt=L[Re+1];else{const li=this.points[L[Re+3]];vt=li.properties;const[pi,Ti]=li.geometry.coordinates;Xt=Er(pi),Bt=wo(Ti)}const oi={type:1,geometry:[[Math.round(this.options.extent*(Xt*Te-ne)),Math.round(this.options.extent*(Bt*Te-_e))]],tags:vt};let ai;ai=nt||this.options.generateId?L[Re+3]:this.points[L[Re+3]].id,void 0!==ai&&(oi.id=ai),Ee.features.push(oi)}}_limitZoom(z){return Math.max(this.options.minZoom,Math.min(Math.floor(+z),this.options.maxZoom+1))}_cluster(z,L){const{radius:ne,extent:_e,reduce:Te,minPoints:Ee}=this.options,Ne=ne/(_e*Math.pow(2,L)),Re=z.data,nt=[],vt=this.stride;for(let Xt=0;Xt<Re.length;Xt+=vt){if(Re[Xt+2]<=L)continue;Re[Xt+2]=L;const Bt=Re[Xt],oi=Re[Xt+1],ai=z.within(Re[Xt],Re[Xt+1],Ne),li=Re[Xt+5];let pi=li;for(const Ti of ai){const Pt=Ti*vt;Re[Pt+2]>L&&(pi+=Re[Pt+5])}if(pi>li&&pi>=Ee){let Ti,Pt=Bt*li,Y=oi*li,ee=-1;const De=((Xt/vt|0)<<5)+(L+1)+this.points.length;for(const gt of ai){const Kt=gt*vt;if(Re[Kt+2]<=L)continue;Re[Kt+2]=L;const Zn=Re[Kt+5];Pt+=Re[Kt]*Zn,Y+=Re[Kt+1]*Zn,Re[Kt+4]=De,Te&&(Ti||(Ti=this._map(Re,Xt,!0),ee=this.clusterProps.length,this.clusterProps.push(Ti)),Te(Ti,this._map(Re,Kt)))}Re[Xt+4]=De,nt.push(Pt/pi,Y/pi,1/0,De,-1,pi),Te&&nt.push(ee)}else{for(let Ti=0;Ti<vt;Ti++)nt.push(Re[Xt+Ti]);if(pi>1)for(const Ti of ai){const Pt=Ti*vt;if(!(Re[Pt+2]<=L)){Re[Pt+2]=L;for(let Y=0;Y<vt;Y++)nt.push(Re[Pt+Y])}}}}return nt}_getOriginId(z){return z-this.points.length>>5}_getOriginZoom(z){return(z-this.points.length)%32}_map(z,L,ne){if(z[L+5]>1){const Ee=this.clusterProps[z[L+6]];return ne?Object.assign({},Ee):Ee}const _e=this.points[z[L+3]].properties,Te=this.options.map(_e);return ne&&Te===_e?Object.assign({},Te):Te}}function Rn(W,z,L){return{type:"Feature",id:W[z+3],properties:Wt(W,z,L),geometry:{type:"Point",coordinates:[(ne=W[z],360*(ne-.5)),Cn(W[z+1])]}};var ne}function Wt(W,z,L){const ne=W[z+5],_e=ne>=1e4?`${Math.round(ne/1e3)}k`:ne>=1e3?Math.round(ne/100)/10+"k":ne,Te=W[z+6],Ee=-1===Te?{}:Object.assign({},L[Te]);return Object.assign(Ee,{cluster:!0,cluster_id:W[z+3],point_count:ne,point_count_abbreviated:_e})}function Er(W){return W/360+.5}function wo(W){const z=Math.sin(W*Math.PI/180),L=.5-.25*Math.log((1+z)/(1-z))/Math.PI;return L<0?0:L>1?1:L}function Cn(W){const z=(180-360*W)*Math.PI/180;return 360*Math.atan(Math.exp(z))/Math.PI-90}function bt(W,z,L,ne){for(var _e,Te=ne,Ee=L-z>>1,Ne=L-z,Re=W[z],nt=W[z+1],vt=W[L],Xt=W[L+1],Bt=z+3;Bt<L;Bt+=3){var oi=dn(W[Bt],W[Bt+1],Re,nt,vt,Xt);if(oi>Te)_e=Bt,Te=oi;else if(oi===Te){var ai=Math.abs(Bt-Ee);ai<Ne&&(_e=Bt,Ne=ai)}}Te>ne&&(_e-z>3&&bt(W,z,_e,ne),W[_e+2]=Te,L-_e>3&&bt(W,_e,L,ne))}function dn(W,z,L,ne,_e,Te){var Ee=_e-L,Ne=Te-ne;if(0!==Ee||0!==Ne){var Re=((W-L)*Ee+(z-ne)*Ne)/(Ee*Ee+Ne*Ne);Re>1?(L=_e,ne=Te):Re>0&&(L+=Ee*Re,ne+=Ne*Re)}return(Ee=W-L)*Ee+(Ne=z-ne)*Ne}function $t(W,z,L,ne){var _e={id:void 0===W?null:W,type:z,geometry:L,tags:ne,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Te){var Ee=Te.geometry,Ne=Te.type;if("Point"===Ne||"MultiPoint"===Ne||"LineString"===Ne)Wi(Te,Ee);else if("Polygon"===Ne||"MultiLineString"===Ne)for(var Re=0;Re<Ee.length;Re++)Wi(Te,Ee[Re]);else if("MultiPolygon"===Ne)for(Re=0;Re<Ee.length;Re++)for(var nt=0;nt<Ee[Re].length;nt++)Wi(Te,Ee[Re][nt])}(_e),_e}function Wi(W,z){for(var L=0;L<z.length;L+=3)W.minX=Math.min(W.minX,z[L]),W.minY=Math.min(W.minY,z[L+1]),W.maxX=Math.max(W.maxX,z[L]),W.maxY=Math.max(W.maxY,z[L+1])}function vi(W,z,L,ne){if(z.geometry){var _e=z.geometry.coordinates,Te=z.geometry.type,Ee=Math.pow(L.tolerance/((1<<L.maxZoom)*L.extent),2),Ne=[],Re=z.id;if(L.promoteId?Re=z.properties[L.promoteId]:L.generateId&&(Re=ne||0),"Point"===Te)Pn(_e,Ne);else if("MultiPoint"===Te)for(var nt=0;nt<_e.length;nt++)Pn(_e[nt],Ne);else if("LineString"===Te)ln(_e,Ne,Ee,!1);else if("MultiLineString"===Te){if(L.lineMetrics){for(nt=0;nt<_e.length;nt++)ln(_e[nt],Ne=[],Ee,!1),W.push($t(Re,"LineString",Ne,z.properties));return}Fo(_e,Ne,Ee,!1)}else if("Polygon"===Te)Fo(_e,Ne,Ee,!0);else{if("MultiPolygon"!==Te){if("GeometryCollection"===Te){for(nt=0;nt<z.geometry.geometries.length;nt++)vi(W,{id:Re,geometry:z.geometry.geometries[nt],properties:z.properties},L,ne);return}throw new Error("Input data is not a valid GeoJSON object.")}for(nt=0;nt<_e.length;nt++){var vt=[];Fo(_e[nt],vt,Ee,!0),Ne.push(vt)}}W.push($t(Re,Te,Ne,z.properties))}}function Pn(W,z){z.push(zi(W[0])),z.push(pn(W[1])),z.push(0)}function ln(W,z,L,ne){for(var _e,Te,Ee=0,Ne=0;Ne<W.length;Ne++){var Re=zi(W[Ne][0]),nt=pn(W[Ne][1]);z.push(Re),z.push(nt),z.push(0),Ne>0&&(Ee+=ne?(_e*nt-Re*Te)/2:Math.sqrt(Math.pow(Re-_e,2)+Math.pow(nt-Te,2))),_e=Re,Te=nt}var vt=z.length-3;z[2]=1,bt(z,0,vt,L),z[vt+2]=1,z.size=Math.abs(Ee),z.start=0,z.end=z.size}function Fo(W,z,L,ne){for(var _e=0;_e<W.length;_e++){var Te=[];ln(W[_e],Te,L,ne),z.push(Te)}}function zi(W){return W/360+.5}function pn(W){var z=Math.sin(W*Math.PI/180),L=.5-.25*Math.log((1+z)/(1-z))/Math.PI;return L<0?0:L>1?1:L}function Xi(W,z,L,ne,_e,Te,Ee,Ne){if(ne/=z,Te>=(L/=z)&&Ee<ne)return W;if(Ee<L||Te>=ne)return null;for(var Re=[],nt=0;nt<W.length;nt++){var vt=W[nt],Xt=vt.geometry,Bt=vt.type,oi=0===_e?vt.minX:vt.minY,ai=0===_e?vt.maxX:vt.maxY;if(oi>=L&&ai<ne)Re.push(vt);else if(!(ai<L||oi>=ne)){var li=[];if("Point"===Bt||"MultiPoint"===Bt)jr(Xt,li,L,ne,_e);else if("LineString"===Bt)Tn(Xt,li,L,ne,_e,!1,Ne.lineMetrics);else if("MultiLineString"===Bt)Ur(Xt,li,L,ne,_e,!1);else if("Polygon"===Bt)Ur(Xt,li,L,ne,_e,!0);else if("MultiPolygon"===Bt)for(var pi=0;pi<Xt.length;pi++){var Ti=[];Ur(Xt[pi],Ti,L,ne,_e,!0),Ti.length&&li.push(Ti)}if(li.length){if(Ne.lineMetrics&&"LineString"===Bt){for(pi=0;pi<li.length;pi++)Re.push($t(vt.id,Bt,li[pi],vt.tags));continue}"LineString"!==Bt&&"MultiLineString"!==Bt||(1===li.length?(Bt="LineString",li=li[0]):Bt="MultiLineString"),"Point"!==Bt&&"MultiPoint"!==Bt||(Bt=3===li.length?"Point":"MultiPoint"),Re.push($t(vt.id,Bt,li,vt.tags))}}}return Re.length?Re:null}function jr(W,z,L,ne,_e){for(var Te=0;Te<W.length;Te+=3){var Ee=W[Te+_e];Ee>=L&&Ee<=ne&&(z.push(W[Te]),z.push(W[Te+1]),z.push(W[Te+2]))}}function Tn(W,z,L,ne,_e,Te,Ee){for(var Ne,Re,nt=ko(W),vt=0===_e?Oi:Pr,Xt=W.start,Bt=0;Bt<W.length-3;Bt+=3){var oi=W[Bt],ai=W[Bt+1],li=W[Bt+2],pi=W[Bt+3],Ti=W[Bt+4],Pt=0===_e?oi:ai,Y=0===_e?pi:Ti,ee=!1;Ee&&(Ne=Math.sqrt(Math.pow(oi-pi,2)+Math.pow(ai-Ti,2))),Pt<L?Y>L&&(Re=vt(nt,oi,ai,pi,Ti,L),Ee&&(nt.start=Xt+Ne*Re)):Pt>ne?Y<ne&&(Re=vt(nt,oi,ai,pi,Ti,ne),Ee&&(nt.start=Xt+Ne*Re)):So(nt,oi,ai,li),Y<L&&Pt>=L&&(Re=vt(nt,oi,ai,pi,Ti,L),ee=!0),Y>ne&&Pt<=ne&&(Re=vt(nt,oi,ai,pi,Ti,ne),ee=!0),!Te&&ee&&(Ee&&(nt.end=Xt+Ne*Re),z.push(nt),nt=ko(W)),Ee&&(Xt+=Ne)}var De=W.length-3;oi=W[De],ai=W[De+1],li=W[De+2],(Pt=0===_e?oi:ai)>=L&&Pt<=ne&&So(nt,oi,ai,li),De=nt.length-3,Te&&De>=3&&(nt[De]!==nt[0]||nt[De+1]!==nt[1])&&So(nt,nt[0],nt[1],nt[2]),nt.length&&z.push(nt)}function ko(W){var z=[];return z.size=W.size,z.start=W.start,z.end=W.end,z}function Ur(W,z,L,ne,_e,Te){for(var Ee=0;Ee<W.length;Ee++)Tn(W[Ee],z,L,ne,_e,Te,!1)}function So(W,z,L,ne){W.push(z),W.push(L),W.push(ne)}function Oi(W,z,L,ne,_e,Te){var Ee=(Te-z)/(ne-z);return W.push(Te),W.push(L+(_e-L)*Ee),W.push(1),Ee}function Pr(W,z,L,ne,_e,Te){var Ee=(Te-L)/(_e-L);return W.push(z+(ne-z)*Ee),W.push(Te),W.push(1),Ee}function wn(W,z){for(var L=[],ne=0;ne<W.length;ne++){var _e,Te=W[ne],Ee=Te.type;if("Point"===Ee||"MultiPoint"===Ee||"LineString"===Ee)_e=hn(Te.geometry,z);else if("MultiLineString"===Ee||"Polygon"===Ee){_e=[];for(var Ne=0;Ne<Te.geometry.length;Ne++)_e.push(hn(Te.geometry[Ne],z))}else if("MultiPolygon"===Ee)for(_e=[],Ne=0;Ne<Te.geometry.length;Ne++){for(var Re=[],nt=0;nt<Te.geometry[Ne].length;nt++)Re.push(hn(Te.geometry[Ne][nt],z));_e.push(Re)}L.push($t(Te.id,Ee,_e,Te.tags))}return L}function hn(W,z){var L=[];L.size=W.size,void 0!==W.start&&(L.start=W.start,L.end=W.end);for(var ne=0;ne<W.length;ne+=3)L.push(W[ne]+z,W[ne+1],W[ne+2]);return L}function Ro(W,z){if(W.transformed)return W;var L,ne,_e,Te=1<<W.z,Ee=W.x,Ne=W.y;for(L=0;L<W.features.length;L++){var Re=W.features[L],nt=Re.geometry,vt=Re.type;if(Re.geometry=[],1===vt)for(ne=0;ne<nt.length;ne+=2)Re.geometry.push(po(nt[ne],nt[ne+1],z,Te,Ee,Ne));else for(ne=0;ne<nt.length;ne++){var Xt=[];for(_e=0;_e<nt[ne].length;_e+=2)Xt.push(po(nt[ne][_e],nt[ne][_e+1],z,Te,Ee,Ne));Re.geometry.push(Xt)}}return W.transformed=!0,W}function po(W,z,L,ne,_e,Te){return[Math.round(L*(W*ne-_e)),Math.round(L*(z*ne-Te))]}function gs(W,z,L,ne,_e){for(var Te=z===_e.maxZoom?0:_e.tolerance/((1<<z)*_e.extent),Ee={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:L,y:ne,z,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ne=0;Ne<W.length;Ne++){Ee.numFeatures++,Co(Ee,W[Ne],Te,_e);var Re=W[Ne].minX,nt=W[Ne].minY,vt=W[Ne].maxX,Xt=W[Ne].maxY;Re<Ee.minX&&(Ee.minX=Re),nt<Ee.minY&&(Ee.minY=nt),vt>Ee.maxX&&(Ee.maxX=vt),Xt>Ee.maxY&&(Ee.maxY=Xt)}return Ee}function Co(W,z,L,ne){var _e=z.geometry,Te=z.type,Ee=[];if("Point"===Te||"MultiPoint"===Te)for(var Ne=0;Ne<_e.length;Ne+=3)Ee.push(_e[Ne]),Ee.push(_e[Ne+1]),W.numPoints++,W.numSimplified++;else if("LineString"===Te)hi(Ee,_e,W,L,!1,!1);else if("MultiLineString"===Te||"Polygon"===Te)for(Ne=0;Ne<_e.length;Ne++)hi(Ee,_e[Ne],W,L,"Polygon"===Te,0===Ne);else if("MultiPolygon"===Te)for(var Re=0;Re<_e.length;Re++){var nt=_e[Re];for(Ne=0;Ne<nt.length;Ne++)hi(Ee,nt[Ne],W,L,!0,0===Ne)}if(Ee.length){var vt=z.tags||null;if("LineString"===Te&&ne.lineMetrics){for(var Xt in vt={},z.tags)vt[Xt]=z.tags[Xt];vt.mapbox_clip_start=_e.start/_e.size,vt.mapbox_clip_end=_e.end/_e.size}var Bt={geometry:Ee,type:"Polygon"===Te||"MultiPolygon"===Te?3:"LineString"===Te||"MultiLineString"===Te?2:1,tags:vt};null!==z.id&&(Bt.id=z.id),W.features.push(Bt)}}function hi(W,z,L,ne,_e,Te){var Ee=ne*ne;if(ne>0&&z.size<(_e?Ee:ne))L.numPoints+=z.length/3;else{for(var Ne=[],Re=0;Re<z.length;Re+=3)(0===ne||z[Re+2]>Ee)&&(L.numSimplified++,Ne.push(z[Re]),Ne.push(z[Re+1])),L.numPoints++;_e&&function(nt,vt){for(var Xt=0,Bt=0,oi=nt.length,ai=oi-2;Bt<oi;ai=Bt,Bt+=2)Xt+=(nt[Bt]-nt[ai])*(nt[Bt+1]+nt[ai+1]);if(Xt>0===vt)for(Bt=0,oi=nt.length;Bt<oi/2;Bt+=2){var li=nt[Bt],pi=nt[Bt+1];nt[Bt]=nt[oi-2-Bt],nt[Bt+1]=nt[oi-1-Bt],nt[oi-2-Bt]=li,nt[oi-1-Bt]=pi}}(Ne,Te),W.push(Ne)}}function qs(W,z){var L=(z=this.options=function(_e,Te){for(var Ee in Te)_e[Ee]=Te[Ee];return _e}(Object.create(this.options),z)).debug;if(L&&console.time("preprocess data"),z.maxZoom<0||z.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(z.promoteId&&z.generateId)throw new Error("promoteId and generateId cannot be used together.");var _e,Te,Ee,Ne,Re,nt,ne=function(_e,Te){var Ee=[];if("FeatureCollection"===_e.type)for(var Ne=0;Ne<_e.features.length;Ne++)vi(Ee,_e.features[Ne],Te,Ne);else vi(Ee,"Feature"===_e.type?_e:{geometry:_e},Te);return Ee}(W,z);this.tiles={},this.tileCoords=[],L&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",z.indexMaxZoom,z.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ne=_e=ne,Re=Xi(_e,1,-1-(Ee=(Te=z).buffer/Te.extent),Ee,0,-1,2,Te),nt=Xi(_e,1,1-Ee,2+Ee,0,-1,2,Te),(Re||nt)&&(Ne=Xi(_e,1,-Ee,1+Ee,0,-1,2,Te)||[],Re&&(Ne=wn(Re,1).concat(Ne)),nt&&(Ne=Ne.concat(wn(nt,-1)))),(ne=Ne).length&&this.splitTile(ne,0,0,0),L&&(ne.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function bs(W,z,L){return 32*((1<<W)*L+z)+W}function x(W,z){const L=W.tileID.canonical;if(!this._geoJSONIndex)return z(null,null);const ne=this._geoJSONIndex.getTile(L.z,L.x,L.y);if(!ne)return z(null,null);const _e=new class{constructor(Ee){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=p.EXTENT,this.length=Ee.length,this._features=Ee}feature(Ee){return new class{constructor(Ne){this._feature=Ne,this.extent=p.EXTENT,this.type=Ne.type,this.properties=Ne.tags,"id"in Ne&&!isNaN(Ne.id)&&(this.id=parseInt(Ne.id,10))}loadGeometry(){if(1===this._feature.type){const Ne=[];for(const Re of this._feature.geometry)Ne.push([new p.Point(Re[0],Re[1])]);return Ne}{const Ne=[];for(const Re of this._feature.geometry){const nt=[];for(const vt of Re)nt.push(new p.Point(vt[0],vt[1]));Ne.push(nt)}return Ne}}toGeoJSON(Ne,Re,nt){return Ze.call(this,Ne,Re,nt)}}(this._features[Ee])}}(ne.features);let Te=Se(_e);0===Te.byteOffset&&Te.byteLength===Te.buffer.byteLength||(Te=new Uint8Array(Te)),z(null,{vectorTile:_e,rawData:Te.buffer})}qs.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},qs.prototype.splitTile=function(W,z,L,ne,_e,Te,Ee){for(var Ne=[W,z,L,ne],Re=this.options,nt=Re.debug;Ne.length;){ne=Ne.pop(),L=Ne.pop(),z=Ne.pop(),W=Ne.pop();var vt=1<<z,Xt=bs(z,L,ne),Bt=this.tiles[Xt];if(!Bt&&(nt>1&&console.time("creation"),Bt=this.tiles[Xt]=gs(W,z,L,ne,Re),this.tileCoords.push({z,x:L,y:ne}),nt)){nt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",z,L,ne,Bt.numFeatures,Bt.numPoints,Bt.numSimplified),console.timeEnd("creation"));var oi="z"+z;this.stats[oi]=(this.stats[oi]||0)+1,this.total++}if(Bt.source=W,_e){if(z===Re.maxZoom||z===_e)continue;var ai=1<<_e-z;if(L!==Math.floor(Te/ai)||ne!==Math.floor(Ee/ai))continue}else if(z===Re.indexMaxZoom||Bt.numPoints<=Re.indexMaxPoints)continue;if(Bt.source=null,0!==W.length){nt>1&&console.time("clipping");var li,pi,Ti,Pt,Y,ee,De=.5*Re.buffer/Re.extent,gt=.5-De,Kt=.5+De,Zn=1+De;li=pi=Ti=Pt=null,Y=Xi(W,vt,L-De,L+Kt,0,Bt.minX,Bt.maxX,Re),ee=Xi(W,vt,L+gt,L+Zn,0,Bt.minX,Bt.maxX,Re),W=null,Y&&(li=Xi(Y,vt,ne-De,ne+Kt,1,Bt.minY,Bt.maxY,Re),pi=Xi(Y,vt,ne+gt,ne+Zn,1,Bt.minY,Bt.maxY,Re),Y=null),ee&&(Ti=Xi(ee,vt,ne-De,ne+Kt,1,Bt.minY,Bt.maxY,Re),Pt=Xi(ee,vt,ne+gt,ne+Zn,1,Bt.minY,Bt.maxY,Re),ee=null),nt>1&&console.timeEnd("clipping"),Ne.push(li||[],z+1,2*L,2*ne),Ne.push(pi||[],z+1,2*L,2*ne+1),Ne.push(Ti||[],z+1,2*L+1,2*ne),Ne.push(Pt||[],z+1,2*L+1,2*ne+1)}}},qs.prototype.getTile=function(W,z,L){var ne=this.options,_e=ne.extent,Te=ne.debug;if(W<0||W>24)return null;var Ee=1<<W,Ne=bs(W,z=(z%Ee+Ee)%Ee,L);if(this.tiles[Ne])return Ro(this.tiles[Ne],_e);Te>1&&console.log("drilling down to z%d-%d-%d",W,z,L);for(var Re,nt=W,vt=z,Xt=L;!Re&&nt>0;)nt--,vt=Math.floor(vt/2),Xt=Math.floor(Xt/2),Re=this.tiles[bs(nt,vt,Xt)];return Re&&Re.source?(Te>1&&console.log("found parent tile z%d-%d-%d",nt,vt,Xt),Te>1&&console.time("drilling down"),this.splitTile(Re.source,nt,vt,Xt,W,z,L),Te>1&&console.timeEnd("drilling down"),this.tiles[Ne]?Ro(this.tiles[Ne],_e):null):null};class j extends p.VectorTileWorkerSource{constructor(z,L,ne,_e,Te){super(z,L,ne,_e,x),Te&&(this.loadGeoJSON=Te)}loadData(z,L){const ne=z&&z.request,_e=ne&&ne.collectResourceTiming;this.loadGeoJSON(z,(Te,Ee)=>{if(Te||!Ee)return L(Te);if("object"!=typeof Ee)return L(new Error(`Input data given to '${z.source}' is not a valid GeoJSON object.`));{Ct(Ee,!0);try{if(z.filter){const Re=p.createExpression(z.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===Re.result)throw new Error(Re.value.map(vt=>`${vt.key}: ${vt.message}`).join(", "));const nt=Ee.features.filter(vt=>Re.value.evaluate({zoom:0},vt));Ee={type:"FeatureCollection",features:nt}}this._geoJSONIndex=z.cluster?new xn(function({superclusterOptions:Re,clusterProperties:nt}){if(!nt||!Re)return Re;const vt={},Xt={},Bt={accumulated:null,zoom:0},oi={properties:null},ai=Object.keys(nt);for(const li of ai){const[pi,Ti]=nt[li],Pt=p.createExpression(Ti),Y=p.createExpression("string"==typeof pi?[pi,["accumulated"],["get",li]]:pi);vt[li]=Pt.value,Xt[li]=Y.value}return Re.map=li=>{oi.properties=li;const pi={};for(const Ti of ai)pi[Ti]=vt[Ti].evaluate(Bt,oi);return pi},Re.reduce=(li,pi)=>{oi.properties=pi;for(const Ti of ai)Bt.accumulated=li[Ti],li[Ti]=Xt[Ti].evaluate(Bt,oi)},Re}(z)).load(Ee.features):new qs(Re=Ee,z.geojsonVtOptions)}catch(Re){return L(Re)}this.loaded={};const Ne={};if(_e){const Re=p.getPerformanceMeasurement(ne);Re&&(Ne.resourceTiming={},Ne.resourceTiming[z.source]=JSON.parse(JSON.stringify(Re)))}L(null,Ne)}var Re})}reloadTile(z,L){const ne=this.loaded;return ne&&ne[z.uid]?super.reloadTile(z,L):this.loadTile(z,L)}loadGeoJSON(z,L){if(z.request)p.getJSON(z.request,L);else{if("string"!=typeof z.data)return L(new Error(`Input data given to '${z.source}' is not a valid GeoJSON object.`));try{return L(null,JSON.parse(z.data))}catch(ne){return L(new Error(`Input data given to '${z.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(z,L){try{L(null,this._geoJSONIndex.getClusterExpansionZoom(z.clusterId))}catch(ne){L(ne)}}getClusterChildren(z,L){try{L(null,this._geoJSONIndex.getChildren(z.clusterId))}catch(ne){L(ne)}}getClusterLeaves(z,L){try{L(null,this._geoJSONIndex.getLeaves(z.clusterId,z.limit,z.offset))}catch(ne){L(ne)}}}class fe{constructor(z){this.self=z,this.actor=new p.Actor(z,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=p.getProjection({name:"mercator"}),this.workerSourceTypes={vector:p.VectorTileWorkerSource,geojson:j},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(L,ne)=>{if(this.workerSourceTypes[L])throw new Error(`Worker source with name "${L}" already registered.`);this.workerSourceTypes[L]=ne},this.self.registerRTLTextPlugin=L=>{if(p.plugin.isParsed())throw new Error("RTL text plugin already registered.");p.plugin.applyArabicShaping=L.applyArabicShaping,p.plugin.processBidirectionalText=L.processBidirectionalText,p.plugin.processStyledBidirectionalText=L.processStyledBidirectionalText}}clearCaches(z,L,ne){delete this.layerIndexes[z],delete this.availableImages[z],delete this.workerSources[z],delete this.demWorkerSources[z],ne()}checkIfReady(z,L,ne){ne()}setReferrer(z,L){this.referrer=L}spriteLoaded(z,L){this.isSpriteLoaded[z]=L;for(const ne in this.workerSources[z]){const _e=this.workerSources[z][ne];for(const Te in _e)_e[Te]instanceof p.VectorTileWorkerSource&&(_e[Te].isSpriteLoaded=L,_e[Te].fire(new p.Event("isSpriteLoaded")))}}setImages(z,L,ne){this.availableImages[z]=L;for(const _e in this.workerSources[z]){const Te=this.workerSources[z][_e];for(const Ee in Te)Te[Ee].availableImages=L}ne()}enableTerrain(z,L,ne){this.terrain=L,ne()}setProjection(z,L){this.projections[z]=p.getProjection(L)}setLayers(z,L,ne){this.getLayerIndex(z).replace(L),ne()}updateLayers(z,L,ne){this.getLayerIndex(z).update(L.layers,L.removedIds),ne()}loadTile(z,L,ne){const _e=this.enableTerrain?p.extend({enableTerrain:this.terrain},L):L;_e.projection=this.projections[z]||this.defaultProjection,this.getWorkerSource(z,L.type,L.source).loadTile(_e,ne)}loadDEMTile(z,L,ne){const _e=this.enableTerrain?p.extend({buildQuadTree:this.terrain},L):L;this.getDEMWorkerSource(z,L.source).loadTile(_e,ne)}reloadTile(z,L,ne){const _e=this.enableTerrain?p.extend({enableTerrain:this.terrain},L):L;_e.projection=this.projections[z]||this.defaultProjection,this.getWorkerSource(z,L.type,L.source).reloadTile(_e,ne)}abortTile(z,L,ne){this.getWorkerSource(z,L.type,L.source).abortTile(L,ne)}removeTile(z,L,ne){this.getWorkerSource(z,L.type,L.source).removeTile(L,ne)}removeSource(z,L,ne){if(!this.workerSources[z]||!this.workerSources[z][L.type]||!this.workerSources[z][L.type][L.source])return;const _e=this.workerSources[z][L.type][L.source];delete this.workerSources[z][L.type][L.source],void 0!==_e.removeSource?_e.removeSource(L,ne):ne()}loadWorkerSource(z,L,ne){try{this.self.importScripts(L.url),ne()}catch(_e){ne(_e.toString())}}syncRTLPluginState(z,L,ne){try{p.plugin.setState(L);const _e=p.plugin.getPluginURL();if(p.plugin.isLoaded()&&!p.plugin.isParsed()&&null!=_e){this.self.importScripts(_e);const Te=p.plugin.isParsed();ne(Te?void 0:new Error(`RTL Text Plugin failed to import scripts from ${_e}`),Te)}}catch(_e){ne(_e.toString())}}getAvailableImages(z){let L=this.availableImages[z];return L||(L=[]),L}getLayerIndex(z){let L=this.layerIndexes[z];return L||(L=this.layerIndexes[z]=new qe),L}getWorkerSource(z,L,ne){return this.workerSources[z]||(this.workerSources[z]={}),this.workerSources[z][L]||(this.workerSources[z][L]={}),this.workerSources[z][L][ne]||(this.workerSources[z][L][ne]=new this.workerSourceTypes[L]({send:(Te,Ee,Ne,Re,nt,vt)=>{this.actor.send(Te,Ee,Ne,z,nt,vt)},scheduler:this.actor.scheduler},this.getLayerIndex(z),this.getAvailableImages(z),this.isSpriteLoaded[z])),this.workerSources[z][L][ne]}getDEMWorkerSource(z,L){return this.demWorkerSources[z]||(this.demWorkerSources[z]={}),this.demWorkerSources[z][L]||(this.demWorkerSources[z][L]=new Xe),this.demWorkerSources[z][L]}enforceCacheSizeLimit(z,L){p.enforceCacheSizeLimit(L)}getWorkerPerformanceMetrics(z,L,ne){ne(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new fe(self)),fe}),je(0,function(p){function he(g,c){if(Array.isArray(g)){if(!Array.isArray(c)||g.length!==c.length)return!1;for(let h=0;h<g.length;h++)if(!he(g[h],c[h]))return!1;return!0}if("object"==typeof g&&null!==g&&null!==c){if("object"!=typeof c||Object.keys(g).length!==Object.keys(c).length)return!1;for(const h in g)if(!he(g[h],c[h]))return!1;return!0}return g===c}var ft=qe;function qe(g){return c=g,!("undefined"==typeof window||"undefined"==typeof document||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var _,w,C=new Blob([""],{type:"text/javascript"}),I=URL.createObjectURL(C);try{w=new Worker(I),_=!0}catch(A){_=!1}return w&&w.terminate(),URL.revokeObjectURL(I),_}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var _=document.createElement("canvas");_.width=_.height=1;var w=_.getContext("2d");if(!w)return!1;var C=w.getImageData(0,0,1,1);return C&&C.width===_.width}()||(void 0===Xe[h=c&&c.failIfMajorPerformanceCaveat]&&(Xe[h]=function(_){var w,I,A,P,C=(I=_,A=document.createElement("canvas"),(P=Object.create(qe.webGLContextAttributes)).failIfMajorPerformanceCaveat=I,A.getContext("webgl",P)||A.getContext("experimental-webgl",P));if(!C)return!1;try{w=C.createShader(C.VERTEX_SHADER)}catch(I){return!1}return!(!w||C.isContextLost())&&(C.shaderSource(w,"void main() {}"),C.compileShader(w),!0===C.getShaderParameter(w,C.COMPILE_STATUS))}(h)),!Xe[h]||document.documentMode));var c,h}var Xe={};function Qe(g,c,h){const _=p.window.document.createElement(g);return void 0!==c&&(_.className=c),h&&h.appendChild(_),_}function St(g,c,h){const _=p.window.document.createElementNS("http://www.w3.org/2000/svg",g);for(const w of Object.keys(c))_.setAttributeNS(null,w,c[w]);return h&&h.appendChild(_),_}qe.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Ct=p.window.document&&p.window.document.documentElement.style,Ze=Ct&&void 0!==Ct.userSelect?"userSelect":"WebkitUserSelect";let ut;function jt(){Ct&&Ze&&(ut=Ct[Ze],Ct[Ze]="none")}function _n(){Ct&&Ze&&(Ct[Ze]=ut)}function He(g){g.preventDefault(),g.stopPropagation(),p.window.removeEventListener("click",He,!0)}function Fn(){p.window.addEventListener("click",He,!0),p.window.setTimeout(()=>{p.window.removeEventListener("click",He,!0)},0)}function Rt(g,c){const h=g.getBoundingClientRect();return ye(g,h,c)}function Dn(g,c){const h=g.getBoundingClientRect(),_=[];for(let w=0;w<c.length;w++)_.push(ye(g,h,c[w]));return _}function Ie(g){return void 0!==p.window.InstallTrigger&&2===g.button&&g.ctrlKey&&p.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:g.button}function ye(g,c,h){const _=g.offsetWidth===c.width?1:g.offsetWidth/c.width;return new p.Point((h.clientX-c.left)*_,(h.clientY-c.top)*_)}function ge(g,c){var h=c[0],_=c[1],w=c[2],C=c[3],I=h*C-w*_;return I?(g[0]=C*(I=1/I),g[1]=-_*I,g[2]=-w*I,g[3]=h*I,g):null}function oe(g){const{userImage:c}=g;return!!(c&&c.render&&c.render())&&(g.data.replace(new Uint8Array(c.data.buffer)),!0)}class Ge extends p.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new p.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(c){if(this.loaded!==c&&(this.loaded=c,c)){for(const{ids:h,callback:_}of this.requestors)this._notify(h,_);this.requestors=[]}}hasImage(c){return!!this.getImage(c)}getImage(c){return this.images[c]}addImage(c,h){this._validate(c,h)&&(this.images[c]=h)}_validate(c,h){let _=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new p.ErrorEvent(new Error(`Image "${c}" has invalid "stretchX" value`))),_=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new p.ErrorEvent(new Error(`Image "${c}" has invalid "stretchY" value`))),_=!1),this._validateContent(h.content,h)||(this.fire(new p.ErrorEvent(new Error(`Image "${c}" has invalid "content" value`))),_=!1),_}_validateStretch(c,h){if(!c)return!0;let _=0;for(const w of c){if(w[0]<_||w[1]<w[0]||h<w[1])return!1;_=w[1]}return!0}_validateContent(c,h){return!(c&&(4!==c.length||c[0]<0||h.data.width<c[0]||c[1]<0||h.data.height<c[1]||c[2]<0||h.data.width<c[2]||c[3]<0||h.data.height<c[3]||c[2]<c[0]||c[3]<c[1]))}updateImage(c,h){h.version=this.images[c].version+1,this.images[c]=h,this.updatedImages[c]=!0}removeImage(c){const h=this.images[c];delete this.images[c],delete this.patterns[c],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(c,h){let _=!0;if(!this.isLoaded())for(const w of c)this.images[w]||(_=!1);this.isLoaded()||_?this._notify(c,h):this.requestors.push({ids:c,callback:h})}_notify(c,h){const _={};for(const w of c){this.images[w]||this.fire(new p.Event("styleimagemissing",{id:w}));const C=this.images[w];C?_[w]={data:C.data.clone(),pixelRatio:C.pixelRatio,sdf:C.sdf,version:C.version,stretchX:C.stretchX,stretchY:C.stretchY,content:C.content,hasRenderCallback:Boolean(C.userImage&&C.userImage.render)}:p.warnOnce(`Image "${w}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}h(null,_)}getPixelSize(){const{width:c,height:h}=this.atlasImage;return{width:c,height:h}}getPattern(c){const h=this.patterns[c],_=this.getImage(c);if(!_)return null;if(h&&h.position.version===_.version)return h.position;if(h)h.position.version=_.version;else{const w={w:_.data.width+2,h:_.data.height+2,x:0,y:0},C=new p.ImagePosition(w,_);this.patterns[c]={bin:w,position:C}}return this._updatePatternAtlas(),this.patterns[c].position}bind(c){const h=c.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new p.Texture(c,this.atlasImage,h.RGBA),this.atlasTexture&&this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const c=[];for(const C in this.patterns)c.push(this.patterns[C].bin);const{w:h,h:_}=p.potpack(c),w=this.atlasImage;w.resize({width:h||1,height:_||1});for(const C in this.patterns){const{bin:I}=this.patterns[C],A=I.x+1,P=I.y+1,N=this.images[C].data,B=N.width,$=N.height;p.RGBAImage.copy(N,w,{x:0,y:0},{x:A,y:P},{width:B,height:$}),p.RGBAImage.copy(N,w,{x:0,y:$-1},{x:A,y:P-1},{width:B,height:1}),p.RGBAImage.copy(N,w,{x:0,y:0},{x:A,y:P+$},{width:B,height:1}),p.RGBAImage.copy(N,w,{x:B-1,y:0},{x:A-1,y:P},{width:1,height:$}),p.RGBAImage.copy(N,w,{x:0,y:0},{x:A+B,y:P},{width:1,height:$})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(c){for(const h of c){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const _=this.images[h];oe(_)&&this.updateImage(h,_)}}}const Be=new p.Properties({anchor:new p.DataConstantProperty(p.spec.light.anchor),position:new class{constructor(){this.specification=p.spec.light.position}possiblyEvaluate(g,c){return function([h,_,w]){const C=p.degToRad(_+90),I=p.degToRad(w);return{x:h*Math.cos(C)*Math.sin(I),y:h*Math.sin(C)*Math.sin(I),z:h*Math.cos(I),azimuthal:_,polar:w}}(g.expression.evaluate(c))}interpolate(g,c,h){return{x:p.number(g.x,c.x,h),y:p.number(g.y,c.y,h),z:p.number(g.z,c.z,h),azimuthal:p.number(g.azimuthal,c.azimuthal,h),polar:p.number(g.polar,c.polar,h)}}},color:new p.DataConstantProperty(p.spec.light.color),intensity:new p.DataConstantProperty(p.spec.light.intensity)});class K extends p.Evented{constructor(c){super(),this._transitionable=new p.Transitionable(Be),this.setLight(c),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(c,h={}){if(!this._validate(p.validateLight,c,h))for(const _ in c){const w=c[_];p.endsWith(_,"-transition")?this._transitionable.setTransition(_.slice(0,-11),w):this._transitionable.setValue(_,w)}}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,h,_){return(!_||!1!==_.validate)&&p.emitValidationErrors(this,c.call(p.validateStyle,p.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:p.spec})))}}const Me=new p.Properties({source:new p.DataConstantProperty(p.spec.terrain.source),exaggeration:new p.DataConstantProperty(p.spec.terrain.exaggeration)});let $e=class extends p.Evented{constructor(g,c){super(),this._transitionable=new p.Transitionable(Me),this.set(g),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=c}get(){return this._transitionable.serialize()}set(g){for(const c in g){const h=g[c];p.endsWith(c,"-transition")?this._transitionable.setTransition(c.slice(0,-11),h):this._transitionable.setValue(c,h)}}updateTransitions(g){this._transitioning=this._transitionable.transitioned(g,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(g){this.properties=this._transitioning.possiblyEvaluate(g)}};function Se(g,c,h,_){const w=p.smoothstep(45,65,h),[C,I]=Je(g,_),A=p.length(c);let P=1-Math.min(1,Math.exp((A-C)/(I-C)*-6));return P*=P*P,P=Math.min(1,1.00747*P),P*w*g.alpha}function Je(g,c){const h=.5/Math.tan(.5*c);return[g.range[0]+h,g.range[1]+h]}const lt=new p.Properties({range:new p.DataConstantProperty(p.spec.fog.range),color:new p.DataConstantProperty(p.spec.fog.color),"high-color":new p.DataConstantProperty(p.spec.fog["high-color"]),"space-color":new p.DataConstantProperty(p.spec.fog["space-color"]),"horizon-blend":new p.DataConstantProperty(p.spec.fog["horizon-blend"]),"star-intensity":new p.DataConstantProperty(p.spec.fog["star-intensity"])});class cn extends p.Evented{constructor(c,h){super(),this._transitionable=new p.Transitionable(lt),this.set(c),this._transitioning=this._transitionable.untransitioned(),this._transform=h}get state(){const c=this._transform,h="globe"===c.projection.name,_=p.globeToMercatorTransition(c.zoom),w=this.properties.get("range"),C=[.5,3];return{range:h?[p.number(C[0],w[0],_),p.number(C[1],w[1],_)]:w,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(c,h={}){if(!this._validate(p.validateFog,c,h)){for(const _ of Object.keys(p.spec.fog))c&&void 0===c[_]&&(c[_]=p.spec.fog[_].default);for(const _ in c){const w=c[_];p.endsWith(_,"-transition")?this._transitionable.setTransition(_.slice(0,-11),w):this._transitionable.setValue(_,w)}}}getOpacity(c){if(!this._transform.projection.supportsFog)return 0;const h=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:p.smoothstep(45,65,c))*h.a}getOpacityAtLatLng(c,h){return this._transform.projection.supportsFog?function(_,w,C){const I=p.MercatorCoordinate.fromLngLat(w),A=C.elevation?C.elevation.getAtPointOrZero(I):0,P=[I.x,I.y,A];return p.transformMat4(P,P,C.mercatorFogMatrix),Se(_,P,C.pitch,C._fov)}(this.state,c,h):0}getFovAdjustedRange(c){return this._transform.projection.supportsFog?Je(this.state,c):[0,1]}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,h,_){return(!_||!1!==_.validate)&&p.emitValidationErrors(this,c.call(p.validateStyle,p.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:p.spec})))}}class Mt{constructor(c,h){this.workerPool=c,this.actors=[],this.currentActor=0,this.id=p.uniqueId();const _=this.workerPool.acquire(this.id);for(let w=0;w<_.length;w++){const C=new Mt.Actor(_[w],h,this.id);C.name=`Worker ${w}`,this.actors.push(C)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(c,h,_){p.asyncAll(this.actors,(w,C)=>{w.send(c,h,C)},_=_||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(c=>{c.remove()}),this.actors=[],this.workerPool.release(this.id)}}function xt(g,c,h){return c*(p.EXTENT/(g.tileSize*Math.pow(2,h-g.tileID.overscaledZ)))}Mt.Actor=p.Actor;class vn{constructor(c,h,_,w){this.screenBounds=c,this.cameraPoint=h,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=_,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,w)}static createFromScreenPoints(c,h){let _,w;if(c instanceof p.Point||"number"==typeof c[0]){const C=p.Point.convert(c);_=[C],w=h.isPointAboveHorizon(C)}else{const C=p.Point.convert(c[0]),I=p.Point.convert(c[1]);_=[C,I],w=p.polygonizeBounds(C,I).every(A=>h.isPointAboveHorizon(A))}return new vn(_,h.getCameraPoint(),w,h)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(c){return p.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],c)}bufferedCameraGeometry(c){const h=this.screenBounds[0],_=1===this.screenBounds.length?this.screenBounds[0].add(new p.Point(1,1)):this.screenBounds[1],w=p.polygonizeBounds(h,_,0,!1);return this.cameraPoint.y>_.y&&(this.cameraPoint.x>h.x&&this.cameraPoint.x<_.x?w.splice(3,0,this.cameraPoint):this.cameraPoint.x>=_.x?w[2]=this.cameraPoint:this.cameraPoint.x<=h.x&&(w[3]=this.cameraPoint)),p.bufferConvexPolygon(w,c)}bufferedCameraGeometryGlobe(c){const h=this.screenBounds[0],_=1===this.screenBounds.length?this.screenBounds[0].add(new p.Point(1,1)):this.screenBounds[1],w=p.polygonizeBounds(h,_,c),C=this.cameraPoint.clone();switch(3*((C.y>h.y)+(C.y>_.y))+((C.x>h.x)+(C.x>_.x))){case 0:w[0]=C,w[4]=C.clone();break;case 1:w.splice(1,0,C);break;case 2:w[1]=C;break;case 3:w.splice(4,0,C);break;case 5:w.splice(2,0,C);break;case 6:w[3]=C;break;case 7:w.splice(3,0,C);break;case 8:w[2]=C}return w}containsTile(c,h,_,w=0){const C=c.queryPadding/h._pixelsPerMercatorPixel+1,I=_?this._bufferedCameraMercator(C,h):this._bufferedScreenMercator(C,h);let A=c.tileID.wrap+(I.unwrapped?w:0);const P=I.polygon.map(ce=>p.getTilePoint(c.tileTransform,ce,A));if(!p.polygonIntersectsBox(P,0,0,p.EXTENT,p.EXTENT))return;A=c.tileID.wrap+(this.screenGeometryMercator.unwrapped?w:0);const N=this.screenGeometryMercator.polygon.map(ce=>p.getTileVec3(c.tileTransform,ce,A)),B=N.map(ce=>new p.Point(ce[0],ce[1])),$=h.getFreeCameraOptions().position||new p.MercatorCoordinate(0,0,0),Q=p.getTileVec3(c.tileTransform,$,A),re=N.map(ce=>{const q=p.sub(ce,ce,Q);return p.normalize(q,q),new p.Ray(Q,q)}),ae=xt(c,1,h.zoom)*h._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:B,tilespaceRays:re,bufferedTilespaceGeometry:P,bufferedTilespaceBounds:(se=p.getBounds(P),se.min.x=p.clamp(se.min.x,0,p.EXTENT),se.min.y=p.clamp(se.min.y,0,p.EXTENT),se.max.x=p.clamp(se.max.x,0,p.EXTENT),se.max.y=p.clamp(se.max.y,0,p.EXTENT),se),tile:c,tileID:c.tileID,pixelToTileUnitsFactor:ae};var se}_bufferedScreenMercator(c,h){const _=Wt(c);if(this._screenRaycastCache[_])return this._screenRaycastCache[_];{let w;return w="globe"===h.projection.name?this._projectAndResample(this.bufferedScreenGeometry(c),h):{polygon:this.bufferedScreenGeometry(c).map(C=>h.pointCoordinate3D(C)),unwrapped:!0},this._screenRaycastCache[_]=w,w}}_bufferedCameraMercator(c,h){const _=Wt(c);if(this._cameraRaycastCache[_])return this._cameraRaycastCache[_];{let w;return w="globe"===h.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(c),h):{polygon:this.bufferedCameraGeometry(c).map(C=>h.pointCoordinate3D(C)),unwrapped:!0},this._cameraRaycastCache[_]=w,w}}_projectAndResample(c,h){const _=function(C,I){const A=p.multiply([],I.pixelMatrix,I.globeMatrix),P=[0,-p.GLOBE_RADIUS,0,1],N=[0,p.GLOBE_RADIUS,0,1],B=[0,0,0,1];p.transformMat4$1(P,P,A),p.transformMat4$1(N,N,A),p.transformMat4$1(B,B,A);const $=new p.Point(P[0]/P[3],P[1]/P[3]),Q=new p.Point(N[0]/N[3],N[1]/N[3]),re=p.polygonContainsPoint(C,$)&&P[3]<B[3],ae=p.polygonContainsPoint(C,Q)&&N[3]<B[3];if(!re&&!ae)return null;const se=function(Oe,Ke,We){for(let at=1;at<Oe.length;at++){const zt=Rn(Ke.pointCoordinate3D(Oe[at-1]).x),it=Rn(Ke.pointCoordinate3D(Oe[at]).x);if(We<0){if(zt<it)return{idx:at,t:-zt/(it-1-zt)}}else if(it<zt)return{idx:at,t:(1-zt)/(it+1-zt)}}return null}(C,I,re?-1:1);if(!se)return null;const{idx:ce,t:q}=se;let ie=ce>1?xn(C.slice(0,ce),I):[],me=ce<C.length?xn(C.slice(ce),I):[];ie=ie.map(Oe=>new p.Point(Rn(Oe.x),Oe.y)),me=me.map(Oe=>new p.Point(Rn(Oe.x),Oe.y));const be=[...ie];0===be.length&&be.push(me[me.length-1]);const Le=p.number(be[be.length-1].y,(0===me.length?ie[0]:me[0]).y,q);let Pe;return Pe=re?[new p.Point(0,Le),new p.Point(0,0),new p.Point(1,0),new p.Point(1,Le)]:[new p.Point(1,Le),new p.Point(1,1),new p.Point(0,1),new p.Point(0,Le)],be.push(...Pe),0===me.length?be.push(ie[0]):be.push(...me),{polygon:be.map(Oe=>new p.MercatorCoordinate(Oe.x,Oe.y)),unwrapped:!1}}(c,h);if(_)return _;const w=function(C,I){let A=!1,P=-1/0,N=0;for(let $=0;$<C.length-1;$++)C[$].x>P&&(P=C[$].x,N=$);for(let $=0;$<C.length-1;$++){const Q=(N+$)%(C.length-1),re=C[Q],ae=C[Q+1];Math.abs(re.x-ae.x)>.5&&(re.x<ae.x?(re.x+=1,0===Q&&(C[C.length-1].x+=1)):(ae.x+=1,Q+1===C.length-1&&(C[0].x+=1)),A=!0)}const B=p.mercatorXfromLng(I.center.lng);return A&&B<Math.abs(B-1)&&C.forEach($=>{$.x-=1}),{polygon:C,unwrapped:A}}(xn(c,h).map(C=>new p.Point(Rn(C.x),C.y)),h);return{polygon:w.polygon.map(C=>new p.MercatorCoordinate(C.x,C.y)),unwrapped:w.unwrapped}}}function xn(g,c){return p.resample(g,h=>{const _=c.pointCoordinate3D(h);h.x=_.x,h.y=_.y},1/256)}function Rn(g){return g<0?1+g%1:g%1}function Wt(g){return 100*g|0}function Er(g,c,h,_,w){const C=function(I,A){if(I)return w(I);if(A){g.url&&A.tiles&&g.tiles&&delete g.tiles;const P=p.pick(p.extend(A,g),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);A.vector_layers&&(P.vectorLayers=A.vector_layers,P.vectorLayerIds=P.vectorLayers.map(N=>N.id)),P.tiles=c.canonicalizeTileset(P,g.url),w(null,P)}};return g.url?p.getJSON(c.transformRequest(c.normalizeSourceURL(g.url,null,h,_),p.ResourceType.Source),C):p.exported.frame(()=>C(null,g))}class wo{constructor(c,h,_){this.bounds=p.LngLatBounds.convert(this.validateBounds(c)),this.minzoom=h||0,this.maxzoom=_||24}validateBounds(c){return Array.isArray(c)&&4===c.length?[Math.max(-180,c[0]),Math.max(-90,c[1]),Math.min(180,c[2]),Math.min(90,c[3])]:[-180,-90,180,90]}contains(c){const h=Math.pow(2,c.z),_=Math.floor(p.mercatorXfromLng(this.bounds.getWest())*h),w=Math.floor(p.mercatorYfromLat(this.bounds.getNorth())*h),C=Math.ceil(p.mercatorXfromLng(this.bounds.getEast())*h),I=Math.ceil(p.mercatorYfromLat(this.bounds.getSouth())*h);return c.x>=_&&c.x<C&&c.y>=w&&c.y<I}}class Cn{constructor(c,h,_){this.context=c;const w=c.gl;this.buffer=w.createBuffer(),this.dynamicDraw=Boolean(_),this.context.unbindVAO(),c.bindElementBuffer.set(this.buffer),w.bufferData(w.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||h.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(c){const h=this.context.gl;this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,c.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const bt={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class dn{constructor(c,h,_,w){this.length=h.length,this.attributes=_,this.itemSize=h.bytesPerElement,this.dynamicDraw=w,this.context=c;const C=c.gl;this.buffer=C.createBuffer(),c.bindVertexBuffer.set(this.buffer),C.bufferData(C.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||h.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(c){const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,c.arrayBuffer)}enableAttributes(c,h){for(let _=0;_<this.attributes.length;_++){const w=h.attributes[this.attributes[_].name];void 0!==w&&c.enableVertexAttribArray(w)}}setVertexAttribPointers(c,h,_){for(let w=0;w<this.attributes.length;w++){const C=this.attributes[w],I=h.attributes[C.name];void 0!==I&&c.vertexAttribPointer(I,C.components,c[bt[C.type]],!1,this.itemSize,C.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class $t{constructor(c){this.gl=c.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(c){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Wi extends $t{getDefault(){return p.Color.transparent}set(c){const h=this.current;(c.r!==h.r||c.g!==h.g||c.b!==h.b||c.a!==h.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class vi extends $t{getDefault(){return 1}set(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)}}class Pn extends $t{getDefault(){return 0}set(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)}}class ln extends $t{getDefault(){return[!0,!0,!0,!0]}set(c){const h=this.current;(c[0]!==h[0]||c[1]!==h[1]||c[2]!==h[2]||c[3]!==h[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class Fo extends $t{getDefault(){return!0}set(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)}}class zi extends $t{getDefault(){return 255}set(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)}}class pn extends $t{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(c){const h=this.current;(c.func!==h.func||c.ref!==h.ref||c.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)}}class Xi extends $t{getDefault(){const c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]}set(c){const h=this.current;(c[0]!==h[0]||c[1]!==h[1]||c[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)}}class jr extends $t{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;c?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=c,this.dirty=!1}}class Tn extends $t{getDefault(){return[0,1]}set(c){const h=this.current;(c[0]!==h[0]||c[1]!==h[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)}}class ko extends $t{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;c?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=c,this.dirty=!1}}class Ur extends $t{getDefault(){return this.gl.LESS}set(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)}}class So extends $t{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;c?h.enable(h.BLEND):h.disable(h.BLEND),this.current=c,this.dirty=!1}}class Oi extends $t{getDefault(){const c=this.gl;return[c.ONE,c.ZERO]}set(c){const h=this.current;(c[0]!==h[0]||c[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(c[0],c[1]),this.current=c,this.dirty=!1)}}class Pr extends $t{getDefault(){return p.Color.transparent}set(c){const h=this.current;(c.r!==h.r||c.g!==h.g||c.b!==h.b||c.a!==h.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class wn extends $t{getDefault(){return this.gl.FUNC_ADD}set(c){(c!==this.current||this.dirty)&&(this.gl.blendEquation(c),this.current=c,this.dirty=!1)}}class hn extends $t{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;c?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=c,this.dirty=!1}}class Ro extends $t{getDefault(){return this.gl.BACK}set(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)}}class po extends $t{getDefault(){return this.gl.CCW}set(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)}}let gs,Co=class extends $t{getDefault(){return null}set(g){(g!==this.current||this.dirty)&&(this.gl.useProgram(g),this.current=g,this.dirty=!1)}};class hi extends $t{getDefault(){return this.gl.TEXTURE0}set(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)}}class qs extends $t{getDefault(){const c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]}set(c){const h=this.current;(c[0]!==h[0]||c[1]!==h[1]||c[2]!==h[2]||c[3]!==h[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class bs extends $t{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,c),this.current=c,this.dirty=!1}}class x extends $t{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class j extends $t{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,c),this.current=c,this.dirty=!1}}class fe extends $t{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class W extends $t{getDefault(){return null}set(c){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class z extends $t{constructor(c){super(c),this.vao=c.extVertexArrayObject}getDefault(){return null}set(c){this.vao&&(c!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(c),this.current=c,this.dirty=!1)}}class L extends $t{getDefault(){return 4}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}}class ne extends $t{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}}class _e extends $t{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}}class Te extends $t{constructor(c,h){super(c),this.context=c,this.parent=h}getDefault(){return null}}class Ee extends Te{setDirty(){this.dirty=!0}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}}class Ne extends Te{attachment(){return this.gl.DEPTH_ATTACHMENT}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,this.attachment(),h.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class Re extends Ne{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class nt{constructor(c,h,_,w){this.context=c,this.width=h,this.height=_;const C=this.framebuffer=c.gl.createFramebuffer();this.colorAttachment=new Ee(c,C),w&&(this.depthAttachment=new Ne(c,C))}destroy(){const c=this.context.gl,h=this.colorAttachment.get();if(h&&c.deleteTexture(h),this.depthAttachment){const _=this.depthAttachment.get();_&&c.deleteRenderbuffer(_)}c.deleteFramebuffer(this.framebuffer)}}class vt{constructor(c,h=!1){if(this.gl=c,this.isWebGL2=h,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),h){const _=c;this.extVertexArrayObject={createVertexArrayOES:_.createVertexArray.bind(c),deleteVertexArrayOES:_.deleteVertexArray.bind(c),bindVertexArrayOES:_.bindVertexArray.bind(c)}}this.clearColor=new Wi(this),this.clearDepth=new vi(this),this.clearStencil=new Pn(this),this.colorMask=new ln(this),this.depthMask=new Fo(this),this.stencilMask=new zi(this),this.stencilFunc=new pn(this),this.stencilOp=new Xi(this),this.stencilTest=new jr(this),this.depthRange=new Tn(this),this.depthTest=new ko(this),this.depthFunc=new Ur(this),this.blend=new So(this),this.blendFunc=new Oi(this),this.blendColor=new Pr(this),this.blendEquation=new wn(this),this.cullFace=new hn(this),this.cullFaceSide=new Ro(this),this.frontFace=new po(this),this.program=new Co(this),this.activeTexture=new hi(this),this.viewport=new qs(this),this.bindFramebuffer=new bs(this),this.bindRenderbuffer=new x(this),this.bindTexture=new j(this),this.bindVertexBuffer=new fe(this),this.bindElementBuffer=new W(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new z(this),this.pixelStoreUnpack=new L(this),this.pixelStoreUnpackPremultiplyAlpha=new ne(this),this.pixelStoreUnpackFlipY=new _e(this),this.extTextureFilterAnisotropic=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=c.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=c.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=c.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=c.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),h||(this.extTextureHalfFloat=c.getExtension("OES_texture_half_float")),(h||this.extTextureHalfFloat&&c.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=c.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=h||c.getExtension("OES_standard_derivatives"),this.extTimerQuery=c.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=c.getParameter(c.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(c,h){return new Cn(this,c,h)}createVertexBuffer(c,h,_){return new dn(this,c,h,_)}createRenderbuffer(c,h,_){const w=this.gl,C=w.createRenderbuffer();return this.bindRenderbuffer.set(C),w.renderbufferStorage(w.RENDERBUFFER,c,h,_),this.bindRenderbuffer.set(null),C}createFramebuffer(c,h,_){return new nt(this,c,h,_)}clear({color:c,depth:h,stencil:_}){const w=this.gl;let C=0;c&&(C|=w.COLOR_BUFFER_BIT,this.clearColor.set(c),this.colorMask.set([!0,!0,!0,!0])),void 0!==h&&(C|=w.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),void 0!==_&&(C|=w.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),w.clear(C)}setCullFace(c){!1===c.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(c.mode),this.frontFace.set(c.frontFace))}setDepthMode(c){c.func!==this.gl.ALWAYS||c.mask?(this.depthTest.set(!0),this.depthFunc.set(c.func),this.depthMask.set(c.mask),this.depthRange.set(c.range)):this.depthTest.set(!1)}setStencilMode(c){c.test.func!==this.gl.ALWAYS||c.mask?(this.stencilTest.set(!0),this.stencilMask.set(c.mask),this.stencilOp.set([c.fail,c.depthFail,c.pass]),this.stencilFunc.set({func:c.test.func,ref:c.ref,mask:c.test.mask})):this.stencilTest.set(!1)}setColorMode(c){he(c.blendFunction,p.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(c.blendFunction),this.blendColor.set(c.blendColor)),this.colorMask.set(c.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Xt extends p.Evented{constructor(c,h,_,w){if(super(),this.id=c,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,p.extend(this,p.pick(h,["url","scheme","tileSize","promoteId"])),this._options=p.extend({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(w),this._tileWorkers={},this._deduped=new p.DedupedRequest}load(c){this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"}));const h=Array.isArray(this.map._language)?this.map._language.join():this.map._language,_=this.map._worldview;this._tileJSONRequest=Er(this._options,this.map._requestManager,h,_,(w,C)=>{this._tileJSONRequest=null,this._loaded=!0,w?(h&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${h}`),_&&2!==_.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${_}`),this.fire(new p.ErrorEvent(w))):C&&(p.extend(this,C),C.bounds&&(this.tileBounds=new wo(C.bounds,this.minzoom,this.maxzoom)),p.postTurnstileEvent(C.tiles,this.map._requestManager._customAccessToken),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))),c&&c(w)})}loaded(){return this._loaded}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}onAdd(c){this.map=c,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(c){return this._options.tiles=c,this.reload(),this}setUrl(c){return this.url=c,this._options.url=c,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return p.extend({},this._options)}loadTile(c,h){const _=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),w={request:this.map._requestManager.transformRequest(_,p.ResourceType.Tile),data:void 0,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:p.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:c.isSymbolTile};if(w.request.collectResourceTiming=this._collectResourceTiming,c.actor&&"expired"!==c.state)"loading"===c.state?c.reloadCallback=h:c.request=c.actor.send("reloadTile",w,C.bind(this));else if(c.actor=this._tileWorkers[_]=this._tileWorkers[_]||this.dispatcher.getActor(),this.dispatcher.ready)c.request=c.actor.send("loadTile",w,C.bind(this),void 0,!0);else{const I=p.loadVectorTile.call({deduped:this._deduped},w,(A,P)=>{A||!P?C.call(this,A):(w.data={cacheControl:P.cacheControl,expires:P.expires,rawData:P.rawData.slice(0)},c.actor&&c.actor.send("loadTile",w,C.bind(this),void 0,!0))},!0);c.request={cancel:I}}function C(I,A){return delete c.request,c.aborted?h(null):I&&404!==I.status?h(I):(A&&A.resourceTiming&&(c.resourceTiming=A.resourceTiming),this.map._refreshExpiredTiles&&A&&c.setExpiryData(A),c.loadVectorData(A,this.map.painter),p.cacheEntryPossiblyAdded(this.dispatcher),h(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id})}unloadTile(c){c.unloadVectorData(),c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Bt extends p.Evented{constructor(c,h,_,w){super(),this.id=c,this.dispatcher=_,this.setEventedParent(w),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=p.extend({type:"raster"},h),p.extend(this,p.pick(h,["url","scheme","tileSize"]))}load(c){this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Er(this._options,this.map._requestManager,null,null,(h,_)=>{this._tileJSONRequest=null,this._loaded=!0,h?this.fire(new p.ErrorEvent(h)):_&&(p.extend(this,_),_.bounds&&(this.tileBounds=new wo(_.bounds,this.minzoom,this.maxzoom)),p.postTurnstileEvent(_.tiles),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))),c&&c(h)})}loaded(){return this._loaded}onAdd(c){this.map=c,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(c){return this._options.tiles=c,this.reload(),this}setUrl(c){return this.url=c,this._options.url=c,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return p.extend({},this._options)}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}loadTile(c,h){const _=p.exported.devicePixelRatio>=2,w=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),_,this.tileSize);c.request=p.getImage(this.map._requestManager.transformRequest(w,p.ResourceType.Tile),(C,I,A,P)=>(delete c.request,c.aborted?(c.state="unloaded",h(null)):C?(c.state="errored",h(C)):I?(this.map._refreshExpiredTiles&&c.setExpiryData({cacheControl:A,expires:P}),c.setTexture(I,this.map.painter),c.state="loaded",p.cacheEntryPossiblyAdded(this.dispatcher),void h(null)):h(null)))}static loadTileData(c,h,_){c.setTexture(h,_)}static unloadTileData(c,h){c.texture&&h.saveTileTexture(c.texture)}abortTile(c,h){c.request&&(c.request.cancel(),delete c.request),h()}unloadTile(c,h){c.texture&&this.map.painter.saveTileTexture(c.texture),h()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function oi(g,c,h,_,w,C,I,A){const P=[g,h,w,c,_,C,1,1,1],N=[I,A,1],B=p.adjoint([],P),[$,Q,re]=p.transformMat3(N,N,p.transpose(B,B));return p.multiply$1(P,[$,0,0,0,Q,0,0,0,re],P)}class ai extends p.Evented{constructor(c,h,_,w){super(),this.id=c,this.dispatcher=_,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(w),this.options=h,this._dirty=!1}load(c,h){this._loaded=h||!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=p.getImage(this.map._requestManager.transformRequest(this.url,p.ResourceType.Image),(_,w)=>{if(this._imageRequest=null,this._loaded=!0,_)this.fire(new p.ErrorEvent(_));else if(w){const{HTMLImageElement:C}=p.window;this.image=w instanceof C?p.exported.getImageData(w):w,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,c&&(this.coordinates=c),this._finishLoading()}})}loaded(){return this._loaded}updateImage(c){return this.image&&c.url?(this._imageRequest&&c.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=c.url,this.load(c.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(c){this.map=c,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(c){this.coordinates=c,this._boundsArray=void 0;const h=c.map(p.MercatorCoordinate.fromLngLat);return this.tileID=function(_){let w=1/0,C=1/0,I=-1/0,A=-1/0;for(const $ of _)w=Math.min(w,$.x),C=Math.min(C,$.y),I=Math.max(I,$.x),A=Math.max(A,$.y);const P=Math.max(I-w,A-C),N=Math.max(0,Math.floor(-Math.log(P)/Math.LN2)),B=Math.pow(2,N);return new p.CanonicalTileID(N,Math.floor((w+I)/2*B),Math.floor((C+A)/2*B))}(h),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(c){for(const P in this.tiles){const N=this.tiles[P];"loaded"!==N.state&&(N.state="loaded",N.texture=this.texture)}if(this._boundsArray)return;const h=p.tileTransform(this.tileID,this.map.transform.projection),[_,w,C,I]=this.coordinates.map(P=>{const N=h.projection.project(P[0],P[1]);return p.getTilePoint(h,N)._round()});this.perspectiveTransform=function(P,N,B,$,Q,re,ae,se,ce,q){const ie=oi(0,0,P,0,0,N,P,N),me=oi(B,$,Q,re,ae,se,ce,q);return p.multiply$1(me,p.adjoint(ie,ie),me),[me[6]/me[8]*P/p.EXTENT,me[7]/me[8]*N/p.EXTENT]}(this.width,this.height,_.x,_.y,w.x,w.y,I.x,I.y,C.x,C.y);const A=this._boundsArray=new p.StructArrayLayout4i8;A.emplaceBack(_.x,_.y,0,0),A.emplaceBack(w.x,w.y,p.EXTENT,0),A.emplaceBack(I.x,I.y,0,p.EXTENT),A.emplaceBack(C.x,C.y,p.EXTENT,p.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=c.createVertexBuffer(A,p.boundsAttributes.members),this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const c=this.map.painter.context,h=c.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new p.Texture(c,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(c)}loadTile(c,h){this.tileID&&this.tileID.equals(c.tileID.canonical)?(this.tiles[String(c.tileID.wrap)]=c,c.buckets={},h(null)):(c.state="errored",h(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const li={vector:Xt,raster:Bt,"raster-dem":class extends Bt{constructor(g,c,h,_){super(g,c,h,_),this.type="raster-dem",this.maxzoom=22,this._options=p.extend({type:"raster-dem"},c),this.encoding=c.encoding||"mapbox"}loadTile(g,c){const h=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function _(w,C){w&&(g.state="errored",c(w)),C&&(g.dem=C,g.dem.onDeserialize(),g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0,g.state="loaded",c(null))}g.request=p.getImage(this.map._requestManager.transformRequest(h,p.ResourceType.Tile),function(w,C,I,A){if(delete g.request,g.aborted)g.state="unloaded",c(null);else if(w)g.state="errored",c(w);else if(C){this.map._refreshExpiredTiles&&g.setExpiryData({cacheControl:I,expires:A});const P=p.window.ImageBitmap&&C instanceof p.window.ImageBitmap&&(null==gs&&(gs=p.window.OffscreenCanvas&&new p.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof p.window.createImageBitmap),gs),N=1-(C.width-p.prevPowerOfTwo(C.width))/2;N<1||g.neighboringTiles||(g.neighboringTiles=this._getNeighboringTiles(g.tileID));const B=P?C:p.exported.getImageData(C,N),$={uid:g.uid,coord:g.tileID,source:this.id,rawImageData:B,encoding:this.encoding,padding:N};g.actor&&"expired"!==g.state||(g.actor=this.dispatcher.getActor(),g.actor.send("loadDEMTile",$,_.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(g){const c=g.canonical,h=Math.pow(2,c.z),_=(c.x-1+h)%h,w=0===c.x?g.wrap-1:g.wrap,C=(c.x+1+h)%h,I=c.x+1===h?g.wrap+1:g.wrap,A={};return A[new p.OverscaledTileID(g.overscaledZ,w,c.z,_,c.y).key]={backfilled:!1},A[new p.OverscaledTileID(g.overscaledZ,I,c.z,C,c.y).key]={backfilled:!1},c.y>0&&(A[new p.OverscaledTileID(g.overscaledZ,w,c.z,_,c.y-1).key]={backfilled:!1},A[new p.OverscaledTileID(g.overscaledZ,g.wrap,c.z,c.x,c.y-1).key]={backfilled:!1},A[new p.OverscaledTileID(g.overscaledZ,I,c.z,C,c.y-1).key]={backfilled:!1}),c.y+1<h&&(A[new p.OverscaledTileID(g.overscaledZ,w,c.z,_,c.y+1).key]={backfilled:!1},A[new p.OverscaledTileID(g.overscaledZ,g.wrap,c.z,c.x,c.y+1).key]={backfilled:!1},A[new p.OverscaledTileID(g.overscaledZ,I,c.z,C,c.y+1).key]={backfilled:!1}),A}unloadTile(g){g.demTexture&&this.map.painter.saveTileTexture(g.demTexture),g.fbo&&(g.fbo.destroy(),delete g.fbo),g.dem&&delete g.dem,delete g.neighboringTiles,g.state="unloaded"}},geojson:class extends p.Evented{constructor(g,c,h,_){super(),this.id=g,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=h.getActor(),this.setEventedParent(_),this._data=c.data,this._options=p.extend({},c),this._collectResourceTiming=c.collectResourceTiming,void 0!==c.maxzoom&&(this.maxzoom=c.maxzoom),c.type&&(this.type=c.type),c.attribution&&(this.attribution=c.attribution),this.promoteId=c.promoteId;const w=p.EXTENT/this.tileSize;this.workerOptions=p.extend({source:this.id,cluster:c.cluster||!1,geojsonVtOptions:{buffer:(void 0!==c.buffer?c.buffer:128)*w,tolerance:(void 0!==c.tolerance?c.tolerance:.375)*w,extent:p.EXTENT,maxZoom:this.maxzoom,lineMetrics:c.lineMetrics||!1,generateId:c.generateId||!1},superclusterOptions:{maxZoom:void 0!==c.clusterMaxZoom?c.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,c.clusterMinPoints||2),extent:p.EXTENT,radius:(void 0!==c.clusterRadius?c.clusterRadius:50)*w,log:!1,generateId:c.generateId||!1},clusterProperties:c.clusterProperties,filter:c.filter},c.workerOptions)}onAdd(g){this.map=g,this.setData(this._data)}setData(g){return this._data=g,this._updateWorkerData(),this}getClusterExpansionZoom(g,c){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:g,source:this.id},c),this}getClusterChildren(g,c){return this.actor.send("geojson.getClusterChildren",{clusterId:g,source:this.id},c),this}getClusterLeaves(g,c,h,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:g,limit:c,offset:h},_),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new p.Event("dataloading",{dataType:"source"})),this._loaded=!1;const g=p.extend({},this.workerOptions),c=this._data;"string"==typeof c?(g.request=this.map._requestManager.transformRequest(p.exported.resolveURL(c),p.ResourceType.Source),g.request.collectResourceTiming=this._collectResourceTiming):g.data=JSON.stringify(c),this._pendingLoad=this.actor.send(`${this.type}.loadData`,g,(h,_)=>{if(this._loaded=!0,this._pendingLoad=null,h)this.fire(new p.ErrorEvent(h));else{const w={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(w.resourceTiming=_.resourceTiming[this.id]),this.fire(new p.Event("data",w)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(g,c){const h=g.actor?"reloadTile":"loadTile";g.actor=this.actor,g.request=this.actor.send(h,{type:this.type,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:p.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(_,w)=>(delete g.request,g.unloadVectorData(),g.aborted?c(null):_?c(_):(g.loadVectorData(w,this.map.painter,"reloadTile"===h),c(null))),void 0,"loadTile"===h)}abortTile(g){g.request&&(g.request.cancel(),delete g.request),g.aborted=!0}unloadTile(g){g.unloadVectorData(),this.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return p.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends ai{constructor(g,c,h,_){super(g,c,h,_),this.roundZoom=!0,this.type="video",this.options=c}load(){this._loaded=!1;const g=this.options;this.urls=[];for(const c of g.urls)this.urls.push(this.map._requestManager.transformRequest(c,p.ResourceType.Source).url);p.getVideo(this.urls,(c,h)=>{this._loaded=!0,c?this.fire(new p.ErrorEvent(c)):h&&(this.video=h,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(g){if(this.video){const c=this.video.seekable;g<c.start(0)||g>c.end(0)?this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${c.start(0)} and ${c.end(0)}-second mark.`))):this.video.currentTime=g}}getVideo(){return this.video}onAdd(g){this.map||(this.map=g,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const g=this.map.painter.context,c=g.gl;this.texture?this.video.paused||(this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),c.texSubImage2D(c.TEXTURE_2D,0,0,0,c.RGBA,c.UNSIGNED_BYTE,this.video)):(this.texture=new p.Texture(g,this.video,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(g)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:ai,canvas:class extends ai{constructor(g,c,h,_){super(g,c,h,_),c.coordinates?Array.isArray(c.coordinates)&&4===c.coordinates.length&&!c.coordinates.some(w=>!Array.isArray(w)||2!==w.length||w.some(C=>"number"!=typeof C))||this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${g}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${g}`,null,'missing required property "coordinates"'))),c.animate&&"boolean"!=typeof c.animate&&this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${g}`,null,'optional "animate" property must be a boolean value'))),c.canvas?"string"==typeof c.canvas||c.canvas instanceof p.window.HTMLCanvasElement||this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${g}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${g}`,null,'missing required property "canvas"'))),this.options=c,this.animate=void 0===c.animate||c.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof p.window.HTMLCanvasElement?this.options.canvas:p.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new p.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(g){this.map=g,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let g=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,g=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,g=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const c=this.map.painter.context;this.texture?(g||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new p.Texture(c,this.canvas,c.gl.RGBA,{premultiply:!0}),this._prepareData(c)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const g of[this.canvas.width,this.canvas.height])if(isNaN(g)||g<=0)return!0;return!1}},custom:class extends p.Evented{constructor(g,c,h,_){super(),this.id=g,this.type="custom",this._dataType="raster",this._dispatcher=h,this._implementation=c,this.setEventedParent(_),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new p.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new p.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new wo(this._implementation.bounds,this.minzoom,this.maxzoom)),c.update=this._update.bind(this),c.clearTiles=this._clearTiles.bind(this),c.coveringTiles=this._coveringTiles.bind(this),p.extend(this,p.pick(c,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return p.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(g){this._map=g,this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(g),this.load()}onRemove(g){this._implementation.onRemove&&this._implementation.onRemove(g)}hasTile(g){if(this._implementation.hasTile){const{x:c,y:h,z:_}=g.canonical;return this._implementation.hasTile({x:c,y:h,z:_})}return!this.tileBounds||this.tileBounds.contains(g.canonical)}loadTile(g,c){const{x:h,y:_,z:w}=g.tileID.canonical,C=new p.window.AbortController;g.request=Promise.resolve(this._implementation.loadTile({x:h,y:_,z:w},{signal:C.signal})).then(function(I){return delete g.request,g.aborted?(g.state="unloaded",c(null)):void 0===I?(g.state="errored",c(null)):null===I?(this.loadTileData(g,{width:this.tileSize,height:this.tileSize,data:null}),g.state="loaded",c(null)):(A=I)instanceof p.window.ImageData||A instanceof p.window.HTMLCanvasElement||A instanceof p.window.ImageBitmap||A instanceof p.window.HTMLImageElement?(this.loadTileData(g,I),g.state="loaded",void c(null)):(g.state="errored",c(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var A}.bind(this)).catch(I=>{20!==I.code&&(g.state="errored",c(I))}),g.request.cancel=()=>C.abort()}loadTileData(g,c){Bt.loadTileData(g,c,this._map.painter)}unloadTileData(g){Bt.unloadTileData(g,this._map.painter)}unloadTile(g,c){if(this.unloadTileData(g),this._implementation.unloadTile){const{x:h,y:_,z:w}=g.tileID.canonical;this._implementation.unloadTile({x:h,y:_,z:w})}c()}abortTile(g,c){g.request&&g.request.cancel&&(g.request.cancel(),delete g.request),c()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(g=>({x:g.canonical.x,y:g.canonical.y,z:g.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))}}},pi=function(g,c,h,_){const w=new li[c.type](g,c,h,_);if(w.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${w.id}`);return p.bindAll(["load","abort","unload","serialize","prepare"],w),w};function Ti(g,c){const h=p.identity([]);return p.scale(h,h,[.5*g.width,.5*-g.height,1]),p.translate(h,h,[1,-1,0]),p.multiply(h,h,g.calculateProjMatrix(c.toUnwrapped())),Float32Array.from(h)}function Pt(g,c,h,_,w,C,I,A=!1){const P=g.tilesIn(_,I,A);P.sort(ee);const N=[];for(const $ of P)N.push({wrappedTileID:$.tile.tileID.wrapped().key,queryResults:$.tile.queryRenderedFeatures(c,h,g._state,$,w,C,Ti(g.transform,$.tile.tileID),A)});const B=function($){const Q={},re={};for(const ae of $){const se=ae.queryResults,ce=ae.wrappedTileID,q=re[ce]=re[ce]||{};for(const ie in se){const me=se[ie],be=q[ie]=q[ie]||{},Le=Q[ie]=Q[ie]||[];for(const Pe of me)be[Pe.featureIndex]||(be[Pe.featureIndex]=!0,Le.push(Pe))}}return Q}(N);for(const $ in B)B[$].forEach(Q=>{const re=Q.feature,ae=re.layer;ae&&"background"!==ae.type&&"sky"!==ae.type&&(re.source=ae.source,ae["source-layer"]&&(re.sourceLayer=ae["source-layer"]),re.state=void 0!==re.id?g.getFeatureState(ae["source-layer"],re.id):{})});return B}function Y(g,c){const h=g.getRenderableIds().map(C=>g.getTileByID(C)),_=[],w={};for(let C=0;C<h.length;C++){const I=h[C],A=I.tileID.canonical.key;w[A]||(w[A]=!0,I.querySourceFeatures(_,c))}return _}function ee(g,c){const h=g.tileID,_=c.tileID;return h.overscaledZ-_.overscaledZ||h.canonical.y-_.canonical.y||h.wrap-_.wrap||h.canonical.x-_.canonical.x}function De(){return null!=dc.workerClass?new dc.workerClass:new p.window.Worker(dc.workerUrl)}const gt="mapboxgl_preloaded_worker_pool";class Kt{constructor(){this.active={}}acquire(c){if(!this.workers)for(this.workers=[];this.workers.length<Kt.workerCount;)this.workers.push(new De);return this.active[c]=!0,this.workers.slice()}release(c){delete this.active[c],0===this.numActive()&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[gt]}numActive(){return Object.keys(this.active).length}}let Zn;function br(){return Zn||(Zn=new Kt),Zn}function oo(g,c){const h={};for(const _ in g)"ref"!==_&&(h[_]=g[_]);return p.refProperties.forEach(_=>{_ in c&&(h[_]=c[_])}),h}function Sa(g){g=g.slice();const c=Object.create(null);for(let h=0;h<g.length;h++)c[g[h].id]=g[h];for(let h=0;h<g.length;h++)"ref"in g[h]&&(g[h]=oo(g[h],c[g[h].ref]));return g}Kt.workerCount=2;const Gn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Wo(g,c,h){h.push({command:Gn.addSource,args:[g,c[g]]})}function so(g,c,h){c.push({command:Gn.removeSource,args:[g]}),h[g]=!0}function sl(g,c,h,_){so(g,h,_),Wo(g,c,h)}function Ca(g,c,h){let _;for(_ in g[h])if(g[h].hasOwnProperty(_)&&"data"!==_&&!he(g[h][_],c[h][_]))return!1;for(_ in c[h])if(c[h].hasOwnProperty(_)&&"data"!==_&&!he(g[h][_],c[h][_]))return!1;return!0}function fo(g,c,h,_,w,C){let I;for(I in c=c||{},g=g||{})g.hasOwnProperty(I)&&(he(g[I],c[I])||h.push({command:C,args:[_,I,c[I],w]}));for(I in c)c.hasOwnProperty(I)&&!g.hasOwnProperty(I)&&(he(g[I],c[I])||h.push({command:C,args:[_,I,c[I],w]}))}function No(g){return g.id}function al(g,c){return g[c.id]=c,g}class ro{constructor(c,h){this.reset(c,h)}reset(c,h){this.points=c||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(c){if(1===this.points.length)return this.points[0];c=p.clamp(c,0,1);let h=1,_=this._distances[h];const w=c*this.paddedLength+this.padding;for(;_<w&&h<this._distances.length;)_=this._distances[++h];const C=h-1,I=this._distances[C],A=_-I,P=A>0?(w-I)/A:0;return this.points[C].mult(1-P).add(this.points[h].mult(P))}}class ll{constructor(c,h,_){const w=this.boxCells=[],C=this.circleCells=[];this.xCellCount=Math.ceil(c/_),this.yCellCount=Math.ceil(h/_);for(let I=0;I<this.xCellCount*this.yCellCount;I++)w.push([]),C.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=c,this.height=h,this.xScale=this.xCellCount/c,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(c,h,_,w,C){this._forEachCell(h,_,w,C,this._insertBoxCell,this.boxUid++),this.boxKeys.push(c),this.bboxes.push(h),this.bboxes.push(_),this.bboxes.push(w),this.bboxes.push(C)}insertCircle(c,h,_,w){this._forEachCell(h-w,_-w,h+w,_+w,this._insertCircleCell,this.circleUid++),this.circleKeys.push(c),this.circles.push(h),this.circles.push(_),this.circles.push(w)}_insertBoxCell(c,h,_,w,C,I){this.boxCells[C].push(I)}_insertCircleCell(c,h,_,w,C,I){this.circleCells[C].push(I)}_query(c,h,_,w,C,I){if(_<0||c>this.width||w<0||h>this.height)return!C&&[];const A=[];if(c<=0&&h<=0&&this.width<=_&&this.height<=w){if(C)return!0;for(let P=0;P<this.boxKeys.length;P++)A.push({key:this.boxKeys[P],x1:this.bboxes[4*P],y1:this.bboxes[4*P+1],x2:this.bboxes[4*P+2],y2:this.bboxes[4*P+3]});for(let P=0;P<this.circleKeys.length;P++){const N=this.circles[3*P],B=this.circles[3*P+1],$=this.circles[3*P+2];A.push({key:this.circleKeys[P],x1:N-$,y1:B-$,x2:N+$,y2:B+$})}return I?A.filter(I):A}return this._forEachCell(c,h,_,w,this._queryCell,A,{hitTest:C,seenUids:{box:{},circle:{}}},I),C?A.length>0:A}_queryCircle(c,h,_,w,C){const I=c-_,A=c+_,P=h-_,N=h+_;if(A<0||I>this.width||N<0||P>this.height)return!w&&[];const B=[];return this._forEachCell(I,P,A,N,this._queryCellCircle,B,{hitTest:w,circle:{x:c,y:h,radius:_},seenUids:{box:{},circle:{}}},C),w?B.length>0:B}query(c,h,_,w,C){return this._query(c,h,_,w,!1,C)}hitTest(c,h,_,w,C){return this._query(c,h,_,w,!0,C)}hitTestCircle(c,h,_,w){return this._queryCircle(c,h,_,!0,w)}_queryCell(c,h,_,w,C,I,A,P){const N=A.seenUids,B=this.boxCells[C];if(null!==B){const Q=this.bboxes;for(const re of B)if(!N.box[re]){N.box[re]=!0;const ae=4*re;if(c<=Q[ae+2]&&h<=Q[ae+3]&&_>=Q[ae+0]&&w>=Q[ae+1]&&(!P||P(this.boxKeys[re]))){if(A.hitTest)return I.push(!0),!0;I.push({key:this.boxKeys[re],x1:Q[ae],y1:Q[ae+1],x2:Q[ae+2],y2:Q[ae+3]})}}}const $=this.circleCells[C];if(null!==$){const Q=this.circles;for(const re of $)if(!N.circle[re]){N.circle[re]=!0;const ae=3*re;if(this._circleAndRectCollide(Q[ae],Q[ae+1],Q[ae+2],c,h,_,w)&&(!P||P(this.circleKeys[re]))){if(A.hitTest)return I.push(!0),!0;{const se=Q[ae],ce=Q[ae+1],q=Q[ae+2];I.push({key:this.circleKeys[re],x1:se-q,y1:ce-q,x2:se+q,y2:ce+q})}}}}}_queryCellCircle(c,h,_,w,C,I,A,P){const N=A.circle,B=A.seenUids,$=this.boxCells[C];if(null!==$){const re=this.bboxes;for(const ae of $)if(!B.box[ae]){B.box[ae]=!0;const se=4*ae;if(this._circleAndRectCollide(N.x,N.y,N.radius,re[se+0],re[se+1],re[se+2],re[se+3])&&(!P||P(this.boxKeys[ae])))return I.push(!0),!0}}const Q=this.circleCells[C];if(null!==Q){const re=this.circles;for(const ae of Q)if(!B.circle[ae]){B.circle[ae]=!0;const se=3*ae;if(this._circlesCollide(re[se],re[se+1],re[se+2],N.x,N.y,N.radius)&&(!P||P(this.circleKeys[ae])))return I.push(!0),!0}}}_forEachCell(c,h,_,w,C,I,A,P){const N=this._convertToXCellCoord(c),B=this._convertToYCellCoord(h),$=this._convertToXCellCoord(_),Q=this._convertToYCellCoord(w);for(let re=N;re<=$;re++)for(let ae=B;ae<=Q;ae++)if(C.call(this,c,h,_,w,this.xCellCount*ae+re,I,A,P))return}_convertToXCellCoord(c){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(c*this.xScale)))}_convertToYCellCoord(c){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(c*this.yScale)))}_circlesCollide(c,h,_,w,C,I){const A=w-c,P=C-h,N=_+I;return N*N>A*A+P*P}_circleAndRectCollide(c,h,_,w,C,I,A){const P=(I-w)/2,N=Math.abs(c-(w+P));if(N>P+_)return!1;const B=(A-C)/2,$=Math.abs(h-(C+B));if($>B+_)return!1;if(N<=P||$<=B)return!0;const Q=N-P,re=$-B;return Q*Q+re*re<=_*_}}const ns_unknown=0,ns_flipRequired=1,ns_flipNotRequired=2,Al=Math.tan(85*Math.PI/180);function _t(g,c,h,_,w,C,I){const A=p.create();if(h)if("globe"===C.name){const P=p.calculateGlobeLabelMatrix(w,c);p.multiply(A,A,P)}else{const P=ge([],I);A[0]=P[0],A[1]=P[1],A[4]=P[2],A[5]=P[3],_||p.rotateZ(A,A,w.angle)}else p.multiply(A,w.labelPlaneMatrix,g);return A}function kl(g,c,h,_,w,C,I){const A=_t(g,c,h,_,w,C,I);return"globe"===C.name&&h||(A[2]=A[6]=A[10]=A[14]=0),A}function To(g,c,h,_,w,C,I){if(h){if("globe"===C.name){const A=_t(g,c,h,_,w,C,I);return p.invert(A,A),p.multiply(A,g,A),A}{const A=p.clone(g),P=p.identity([]);return P[0]=I[0],P[1]=I[1],P[4]=I[2],P[5]=I[3],p.multiply(A,A,P),_||p.rotateZ(A,A,-w.angle),A}}return w.glCoordMatrix}function Xo(g,c,h,_){const w=[g,c,h,1];h?p.transformMat4$1(w,w,_):Mi(w,w,_);const C=w[3];return w[0]/=C,w[1]/=C,w[2]/=C,w}function qp(g,c){return Math.min(.5+g/c*.5,1.5)}function cl(g,c){const h=g[0]/g[3],_=g[1]/g[3];return h>=-c[0]&&h<=c[0]&&_>=-c[1]&&_<=c[1]}function Gp(g,c,h,_,w,C,I,A,P,N){const B=h.transform,$=_?g.textSizeData:g.iconSizeData,Q=p.evaluateSizeForZoom($,h.transform.zoom),re="globe"===B.projection.name,ae=[256/h.width*2+1,256/h.height*2+1],se=_?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;se.clear();let ce=null;re&&(ce=_?g.text.globeExtVertexArray:g.icon.globeExtVertexArray);const q=g.lineVertexArray,ie=_?g.text.placedSymbolArray:g.icon.placedSymbolArray,me=h.transform.width/h.transform.height;let be,Le=!1;for(let Pe=0;Pe<ie.length;Pe++){const Oe=ie.get(Pe),{numGlyphs:Ke,writingMode:We}=Oe;if(We!==p.WritingMode.vertical||Le||be===p.WritingMode.horizontal||(Le=!0),be=We,(Oe.hidden||We===p.WritingMode.vertical)&&!Le){Zi(Ke,se);continue}Le=!1;const at=new p.Point(Oe.tileAnchorX,Oe.tileAnchorY);let{x:zt,y:it,z:Tt}=B.projection.projectTilePoint(at.x,at.y,N.canonical);if(P){const[ti,An,Hn]=P(at);zt+=ti,it+=An,Tt+=Hn}const ht=[zt,it,Tt,1];if(p.transformMat4$1(ht,ht,c),!cl(ht,ae)){Zi(Ke,se);continue}const Vt=qp(h.transform.cameraToCenterDistance,ht[3]),ot=p.evaluateSizeForFeature($,Q,Oe),wt=I?ot/Vt:ot*Vt,Ut=Xo(zt,it,Tt,w);if(Ut[3]<=0){Zi(Ke,se);continue}let At={};const qt=I?null:P,Un=mn(Oe,wt,!1,A,c,w,C,g.glyphOffsetArray,q,se,ce,Ut,at,At,me,qt,B.projection,N,I);Le=Un.useVertical,qt&&Un.needsFlipping&&(At={}),(Un.notEnoughRoom||Le||Un.needsFlipping&&mn(Oe,wt,!0,A,c,w,C,g.glyphOffsetArray,q,se,ce,Ut,at,At,me,qt,B.projection,N,I).notEnoughRoom)&&Zi(Ke,se)}_?(g.text.dynamicLayoutVertexBuffer.updateData(se),ce&&g.text.globeExtVertexBuffer.updateData(ce)):(g.icon.dynamicLayoutVertexBuffer.updateData(se),ce&&g.icon.globeExtVertexBuffer.updateData(ce))}function mo(g,c,h,_,w,C,I,A,P,N,B,$,Q,re,ae,se){const{lineStartIndex:ce,glyphStartIndex:q,segment:ie}=A,me=q+A.numGlyphs,be=ce+A.lineLength,Le=c.getoffsetX(q),Pe=c.getoffsetX(me-1),Oe=As(g*Le,h,_,w,C,I,ie,ce,be,P,N,B,$,Q,!0,re,ae,se);if(!Oe)return null;const Ke=As(g*Pe,h,_,w,C,I,ie,ce,be,P,N,B,$,Q,!0,re,ae,se);return Ke?{first:Oe,last:Ke}:null}function Or(g,c,h,_){return g===p.WritingMode.horizontal&&Math.abs(_)>Math.abs(h)?{useVertical:!0}:g===p.WritingMode.vertical?_>0?{needsFlipping:!0}:null:c!==ns_unknown&&(0===(w=h)||Math.abs(_/w)>Al)?c===ns_flipRequired?{needsFlipping:!0}:null:h<0?{needsFlipping:!0}:null;var w}function mn(g,c,h,_,w,C,I,A,P,N,B,$,Q,re,ae,se,ce,q,ie){const me=c/24,be=g.lineOffsetX*me,Le=g.lineOffsetY*me,{lineStartIndex:Pe,glyphStartIndex:Oe,numGlyphs:Ke,segment:We,writingMode:at,flipState:zt}=g,it=Pe+g.lineLength,Tt=ht=>{if(B){const[Ut,At,qt]=ht.up,Un=N.length;p.updateGlobeVertexNormal(B,Un+0,Ut,At,qt),p.updateGlobeVertexNormal(B,Un+1,Ut,At,qt),p.updateGlobeVertexNormal(B,Un+2,Ut,At,qt),p.updateGlobeVertexNormal(B,Un+3,Ut,At,qt)}const[Vt,ot,wt]=ht.point;p.addDynamicAttributes(N,Vt,ot,wt,ht.angle)};if(Ke>1){const ht=mo(me,A,be,Le,h,$,Q,g,P,C,re,se,!1,ce,q,ie);if(!ht)return{notEnoughRoom:!0};if(_&&!h){let[Vt,ot,wt]=ht.first.point,[Ut,At,qt]=ht.last.point;[Vt,ot]=Xo(Vt,ot,wt,I),[Ut,At]=Xo(Ut,At,qt,I);const Un=Or(at,zt,(Ut-Vt)*ae,At-ot);if(g.flipState=Un&&Un.needsFlipping?ns_flipRequired:ns_flipNotRequired,Un)return Un}Tt(ht.first);for(let Vt=Oe+1;Vt<Oe+Ke-1;Vt++){const ot=As(me*A.getoffsetX(Vt),be,Le,h,$,Q,We,Pe,it,P,C,re,se,!1,!1,ce,q,ie);if(!ot)return N.length-=4*(Vt-Oe),{notEnoughRoom:!0};Tt(ot)}Tt(ht.last)}else{if(_&&!h){const Vt=Xo(Q.x,Q.y,0,w),ot=Pe+We+1,wt=new p.Point(P.getx(ot),P.gety(ot)),Ut=Xo(wt.x,wt.y,0,w),At=Ut[3]>0?Ut:Bn(Q,wt,Vt,1,w,void 0,ce,q.canonical),qt=Or(at,zt,(At[0]-Vt[0])*ae,At[1]-Vt[1]);if(g.flipState=qt&&qt.needsFlipping?ns_flipRequired:ns_flipNotRequired,qt)return qt}const ht=As(me*A.getoffsetX(Oe),be,Le,h,$,Q,We,Pe,it,P,C,re,se,!1,!1,ce,q,ie);if(!ht)return{notEnoughRoom:!0};Tt(ht)}return{}}function Li(g,c,h,_,w){const{x:C,y:I,z:A}=_.projectTilePoint(g.x,g.y,c);if(!w)return Xo(C,I,A,h);const[P,N,B]=w(g);return Xo(C+P,I+N,A+B,h)}function Bn(g,c,h,_,w,C,I,A){const P=Li(g.sub(c)._unit()._add(g),A,w,I,C);return p.sub(P,h,P),p.normalize(P,P),p.scaleAndAdd(P,h,P,_)}function As(g,c,h,_,w,C,I,A,P,N,B,$,Q,re,ae,se,ce,q){const ie=_?g-c:g+c;let me=ie>0?1:-1,be=0;_&&(me*=-1,be=Math.PI),me<0&&(be+=Math.PI);let Le=A+I+(me>0?0:1)|0,Pe=w,Oe=w,Ke=0,We=0;const at=Math.abs(ie),zt=[],it=[];let Tt=C,ht=Tt;const Vt=()=>Bn(ht,Tt,Oe,at-Ke+1,B,Q,se,ce.canonical);for(;Ke+We<=at;){if(Le+=me,Le<A||Le>=P)return null;if(Oe=Pe,ht=Tt,zt.push(Oe),re&&it.push(ht),Tt=new p.Point(N.getx(Le),N.gety(Le)),Pe=$[Le],!Pe){const Hn=Li(Tt,ce.canonical,B,se,Q);Pe=Hn[3]>0?$[Le]=Hn:Vt()}Ke+=We,We=p.distance(Oe,Pe)}ae&&Q&&($[Le]&&(Pe=Vt(),We=p.distance(Oe,Pe)),$[Le]=Pe);const ot=(at-Ke)/We,wt=Tt.sub(ht)._mult(ot)._add(ht),Ut=p.sub([],Pe,Oe),At=p.scaleAndAdd([],Oe,Ut,ot);let qt=[0,0,1],Un=Ut[0],ti=Ut[1];if(q&&(qt=se.upVector(ce.canonical,wt.x,wt.y),0!==qt[0]||0!==qt[1]||1!==qt[2])){const Hn=[qt[2],0,-qt[0]],Ai=p.cross([],qt,Hn);p.normalize(Hn,Hn),p.normalize(Ai,Ai),Un=p.dot(Ut,Hn),ti=p.dot(Ut,Ai)}if(h){const Hn=p.cross([],qt,Ut);p.normalize(Hn,Hn),p.scaleAndAdd(At,At,Hn,h*me)}const An=be+Math.atan2(ti,Un);return zt.push(At),re&&it.push(wt),{point:At,angle:An,path:zt,tilePath:it,up:qt}}function Zi(g,c){const h=c.length,_=h+4*g;c.resize(_),c.float32.fill(-1/0,4*h,4*_)}function Mi(g,c,h){const _=c[0],w=c[1];return g[0]=h[0]*_+h[4]*w+h[12],g[1]=h[1]*_+h[5]*w+h[13],g[3]=h[3]*_+h[7]*w+h[15],g}const aa=100;class $i{constructor(c,h,_=new ll(c.width+200,c.height+200,25),w=new ll(c.width+200,c.height+200,25)){this.transform=c,this.grid=_,this.ignoredGrid=w,this.pitchfactor=Math.cos(c._pitch)*c.cameraToCenterDistance,this.screenRightBoundary=c.width+aa,this.screenBottomBoundary=c.height+aa,this.gridRightBoundary=c.width+200,this.gridBottomBoundary=c.height+200,this.fogState=h}placeCollisionBox(c,h,_,w,C,I,A,P){let N=_.projectedAnchorX,B=_.projectedAnchorY,$=_.projectedAnchorZ;const Q=_.elevation,re=_.tileID,ae=c.getProjection();if(Q&&re){const[Pe,Oe,Ke]=ae.upVector(re.canonical,_.tileAnchorX,_.tileAnchorY),We=ae.upVectorScale(re.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;N+=Pe*Q*We,B+=Oe*Q*We,$+=Ke*Q*We}const se=this.projectAndGetPerspectiveRatio(A,N,B,$,_.tileID,"globe"===ae.name||!!Q||this.transform.pitch>0,ae),ce=I*se.perspectiveRatio,q=(_.x1*h+w.x-_.padding)*ce+se.point.x,ie=(_.y1*h+w.y-_.padding)*ce+se.point.y,me=(_.x2*h+w.x+_.padding)*ce+se.point.x,be=(_.y2*h+w.y+_.padding)*ce+se.point.y,Le=se.perspectiveRatio<=.55||se.occluded;return!this.isInsideGrid(q,ie,me,be)||!C&&this.grid.hitTest(q,ie,me,be,P)||Le?{box:[],offscreen:!1,occluded:se.occluded}:{box:[q,ie,me,be],offscreen:this.isOffscreen(q,ie,me,be),occluded:!1}}placeCollisionCircles(c,h,_,w,C,I,A,P,N,B,$,Q,re,ae,se){const ce=[],q=this.transform.elevation,ie=c.getProjection(),me=q?q.getAtTileOffsetFunc(se,this.transform.center.lat,this.transform.worldSize,ie):null,be=new p.Point(_.tileAnchorX,_.tileAnchorY);let{x:Le,y:Pe,z:Oe}=ie.projectTilePoint(be.x,be.y,se.canonical);if(me){const[wt,Ut,At]=me(be);Le+=wt,Pe+=Ut,Oe+=At}const Ke="globe"===ie.name,We=this.projectAndGetPerspectiveRatio(A,Le,Pe,Oe,se,Ke||!!q||this.transform.pitch>0,ie),{perspectiveRatio:at}=We,zt=($?I/at:I*at)/p.ONE_EM,it=Xo(Le,Pe,Oe,P),Tt=We.signedDistanceFromCamera>0?mo(zt,C,_.lineOffsetX*zt,_.lineOffsetY*zt,!1,it,be,_,w,P,{},q&&!$?me:null,$&&!!q,ie,se,$):null;let ht=!1,Vt=!1,ot=!0;if(Tt&&!We.occluded){const wt=.5*re*at+ae,Ut=new p.Point(-100,-100),At=new p.Point(this.screenRightBoundary,this.screenBottomBoundary),qt=new ro,{first:Un,last:ti}=Tt,An=Un.path.length;let Hn=[];for(let Vn=An-1;Vn>=1;Vn--)Hn.push(Un.path[Vn]);for(let Vn=1;Vn<ti.path.length;Vn++)Hn.push(ti.path[Vn]);const Ai=2.5*wt;N&&(Hn=Hn.map(([Vn,ur,wr],Dr)=>(me&&!Ke&&(wr=me(Dr<An-1?Un.tilePath[An-1-Dr]:ti.tilePath[Dr-An+2])[2]),Xo(Vn,ur,wr,N))),Hn.some(Vn=>Vn[3]<=0)&&(Hn=[]));let wi=[];if(Hn.length>0){let Vn=1/0,ur=-1/0,wr=1/0,Dr=-1/0;for(const ji of Hn)Vn=Math.min(Vn,ji[0]),wr=Math.min(wr,ji[1]),ur=Math.max(ur,ji[0]),Dr=Math.max(Dr,ji[1]);ur>=Ut.x&&Vn<=At.x&&Dr>=Ut.y&&wr<=At.y&&(wi=[Hn.map(ji=>new p.Point(ji[0],ji[1]))],(Vn<Ut.x||ur>At.x||wr<Ut.y||Dr>At.y)&&(wi=p.clipLine(wi,Ut.x,Ut.y,At.x,At.y)))}for(const Vn of wi){qt.reset(Vn,.25*wt);let ur=0;ur=qt.length<=.5*wt?1:Math.ceil(qt.paddedLength/Ai)+1;for(let wr=0;wr<ur;wr++){const Dr=wr/Math.max(ur-1,1),ji=qt.lerp(Dr),xs=ji.x+aa,_o=ji.y+aa;ce.push(xs,_o,wt,0);const Js=xs-wt,Aa=_o-wt,Fr=xs+wt,pr=_o+wt;if(ot=ot&&this.isOffscreen(Js,Aa,Fr,pr),Vt=Vt||this.isInsideGrid(Js,Aa,Fr,pr),!h&&this.grid.hitTestCircle(xs,_o,wt,Q)&&(ht=!0,!B))return{circles:[],offscreen:!1,collisionDetected:ht,occluded:!1}}}}return{circles:!B&&ht||!Vt?[]:ce,offscreen:ot,collisionDetected:ht,occluded:We.occluded}}queryRenderedSymbols(c){if(0===c.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const h=[];let _=1/0,w=1/0,C=-1/0,I=-1/0;for(const B of c){const $=new p.Point(B.x+aa,B.y+aa);_=Math.min(_,$.x),w=Math.min(w,$.y),C=Math.max(C,$.x),I=Math.max(I,$.y),h.push($)}const A=this.grid.query(_,w,C,I).concat(this.ignoredGrid.query(_,w,C,I)),P={},N={};for(const B of A){const $=B.key;if(void 0===P[$.bucketInstanceId]&&(P[$.bucketInstanceId]={}),P[$.bucketInstanceId][$.featureIndex])continue;const Q=[new p.Point(B.x1,B.y1),new p.Point(B.x2,B.y1),new p.Point(B.x2,B.y2),new p.Point(B.x1,B.y2)];p.polygonIntersectsPolygon(h,Q)&&(P[$.bucketInstanceId][$.featureIndex]=!0,void 0===N[$.bucketInstanceId]&&(N[$.bucketInstanceId]=[]),N[$.bucketInstanceId].push($.featureIndex))}return N}insertCollisionBox(c,h,_,w,C){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:w,collisionGroupID:C},c[0],c[1],c[2],c[3])}insertCollisionCircles(c,h,_,w,C){const I=h?this.ignoredGrid:this.grid,A={bucketInstanceId:_,featureIndex:w,collisionGroupID:C};for(let P=0;P<c.length;P+=4)I.insertCircle(A,c[P],c[P+1],c[P+2])}projectAndGetPerspectiveRatio(c,h,_,w,C,I,A){const P=[h,_,w,1];let N=!1;w||this.transform.pitch>0?(p.transformMat4$1(P,P,c),this.fogState&&C&&"globe"!==A.name&&(N=function(Q,re,ae,se,ce,q){const ie=q.calculateFogTileMatrix(ce),me=[re,ae,se];return p.transformMat4(me,me,ie),Se(Q,me,q.pitch,q._fov)}(this.fogState,h,_,w,C.toUnwrapped(),this.transform)>.9)):Mi(P,P,c);const B=P[3];return{point:new p.Point((P[0]/B+1)/2*this.transform.width+aa,(-P[1]/B+1)/2*this.transform.height+aa),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(A)/B*.5,1.5),signedDistanceFromCamera:B,occluded:I&&P[2]>B||N}}isOffscreen(c,h,_,w){return _<aa||c>=this.screenRightBoundary||w<aa||h>this.screenBottomBoundary}isInsideGrid(c,h,_,w){return _>=0&&c<this.gridRightBoundary&&w>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const c=p.identity([]);return p.translate(c,c,[-100,-100,0]),c}}function ci(g,c,h){const _=c.createTileMatrix(g,g.worldSize,h.toUnwrapped());return p.multiply(new Float32Array(16),g.projMatrix,_)}function Gs(g,c,h){if(c.projection.name===h.projection.name)return g.projMatrix;const _=h.clone();return _.setProjection(c.projection),ci(_,c.getProjection(),g)}function eo(g,c,h){return c.name===h.projection.name?g.projMatrix:ci(h,c,g)}class Nt{constructor(c,h,_,w){this.opacity=c?Math.max(0,Math.min(1,c.opacity+(c.placed?h:-h))):w&&_?1:0,this.placed=_}isHidden(){return 0===this.opacity&&!this.placed}}class Ta{constructor(c,h,_,w,C,I=!1){this.text=new Nt(c?c.text:null,h,_,C),this.icon=new Nt(c?c.icon:null,h,w,C),this.clipped=I}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class xi{constructor(c,h,_,w=!1){this.text=c,this.icon=h,this.skipFade=_,this.clipped=w}}class ir{constructor(){this.invProjMatrix=p.create(),this.viewportMatrix=p.create(),this.circles=[]}}class Wp{constructor(c,h,_,w,C){this.bucketInstanceId=c,this.featureIndex=h,this.sourceLayerIndex=_,this.bucketIndex=w,this.tileID=C}}class n_{constructor(c){this.crossSourceCollisions=c,this.maxGroupID=0,this.collisionGroups={}}get(c){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[c]){const h=++this.maxGroupID;this.collisionGroups[c]={ID:h,predicate:_=>_.collisionGroupID===h}}return this.collisionGroups[c]}}function bd(g,c,h,_,w){const{horizontalAlign:C,verticalAlign:I}=p.getAnchorAlignment(g),A=-(C-.5)*c,P=-(I-.5)*h,N=p.evaluateVariableOffset(g,_);return new p.Point(A+N[0]*w,P+N[1]*w)}function ic(g,c,h,_,w){const C=new p.Point(g,c);return h&&C._rotate(_?w:-w),C}class _s{constructor(c,h,_,w,C){this.transform=c.clone(),this.projection=c.projection.name,this.collisionIndex=new $i(this.transform,C),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new n_(_),this.collisionCircleArrays={},this.prevPlacement=w,w&&(w.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(c,h,_,w){const C=_.getBucket(h),I=_.latestFeatureIndex;if(!C||!I||h.id!==C.layerIds[0])return;const A=C.layers[0].layout,P=_.collisionBoxArray,N=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),B=_.tileSize/p.EXTENT,$=_.tileID.toUnwrapped();this.transform.setProjection(C.projection);const Q=(re=_.tileID,ae=C.getProjection(),se=this.transform,ae.name===this.projection?se.calculateProjMatrix(re.toUnwrapped()):ci(se,ae,re));var re,ae,se;const ce="map"===A.get("text-pitch-alignment"),q="map"===A.get("text-rotation-alignment");h.compileFilter();const ie=h.dynamicFilter(),me=h.dynamicFilterNeedsFeature(),be=this.transform.calculatePixelsToTileUnitsMatrix(_),Le=kl(Q,_.tileID.canonical,ce,q,this.transform,C.getProjection(),be);let Pe=null;if(ce){const We=To(Q,_.tileID.canonical,ce,q,this.transform,C.getProjection(),be);Pe=p.multiply([],this.transform.labelPlaneMatrix,We)}let Oe=null;ie&&_.latestFeatureIndex&&(Oe={unwrappedTileID:$,dynamicFilter:ie,dynamicFilterNeedsFeature:me,featureIndex:_.latestFeatureIndex}),this.retainedQueryData[C.bucketInstanceId]=new Wp(C.bucketInstanceId,I,C.sourceLayerIndex,C.index,_.tileID);const Ke={bucket:C,layout:A,posMatrix:Q,textLabelPlaneMatrix:Le,labelToScreenMatrix:Pe,clippingData:Oe,scale:N,textPixelRatio:B,holdingForFade:_.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:p.evaluateSizeForZoom(C.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:p.evaluateSizeForZoom(C.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(C.sourceID)};if(w)for(const We of C.sortKeyRanges){const{sortKey:at,symbolInstanceStart:zt,symbolInstanceEnd:it}=We;c.push({sortKey:at,symbolInstanceStart:zt,symbolInstanceEnd:it,parameters:Ke})}else c.push({symbolInstanceStart:0,symbolInstanceEnd:C.symbolInstances.length,parameters:Ke})}attemptAnchorPlacement(c,h,_,w,C,I,A,P,N,B,$,Q,re,ae,se,ce,q,ie){const{textOffset0:me,textOffset1:be,crossTileID:Le}=Q,Pe=[me,be],Oe=bd(c,_,w,Pe,C),Ke=this.collisionIndex.placeCollisionBox(ae,C,h,ic(Oe.x,Oe.y,I,A,this.transform.angle),$,P,N,B.predicate);if(ce){const We=ae.getSymbolInstanceIconSize(ie,this.transform.zoom,Q.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(ae,We,ce,ic(Oe.x,Oe.y,I,A,this.transform.angle),$,P,N,B.predicate).box.length)return}if(Ke.box.length>0){let We;return this.prevPlacement&&this.prevPlacement.variableOffsets[Le]&&this.prevPlacement.placements[Le]&&this.prevPlacement.placements[Le].text&&(We=this.prevPlacement.variableOffsets[Le].anchor),this.variableOffsets[Le]={textOffset:Pe,width:_,height:w,anchor:c,textScale:C,prevAnchor:We},this.markUsedJustification(ae,c,Q,se),ae.allowVerticalPlacement&&(this.markUsedOrientation(ae,se,Q),this.placedOrientations[Le]=se),{shift:Oe,placedGlyphBoxes:Ke}}}placeLayerBucketPart(c,h,_,w){const{bucket:C,layout:I,posMatrix:A,textLabelPlaneMatrix:P,labelToScreenMatrix:N,clippingData:B,textPixelRatio:$,holdingForFade:Q,collisionBoxArray:re,partiallyEvaluatedTextSize:ae,partiallyEvaluatedIconSize:se,collisionGroup:ce}=c.parameters,q=I.get("text-optional"),ie=I.get("icon-optional"),me=I.get("text-allow-overlap"),be=I.get("icon-allow-overlap"),Le="map"===I.get("text-rotation-alignment"),Pe="map"===I.get("text-pitch-alignment"),Oe="none"!==I.get("icon-text-fit"),Ke="viewport-y"===I.get("symbol-z-order");this.transform.setProjection(C.projection);let We=me&&(be||!C.hasIconData()||ie),at=be&&(me||!C.hasTextData()||q);!C.collisionArrays&&re&&C.deserializeCollisionBoxes(re),_&&w&&C.updateCollisionDebugBuffers(this.transform.zoom,re);const zt=(it,Tt,ht)=>{const{crossTileID:Vt,numVerticalGlyphVertices:ot}=it;if(B){const Fr={zoom:this.transform.zoom,pitch:this.transform.pitch};let pr=null;if(B.dynamicFilterNeedsFeature){const or=this.retainedQueryData[C.bucketInstanceId];pr=B.featureIndex.loadFeature({featureIndex:it.featureIndex,bucketIndex:or.bucketIndex,sourceLayerIndex:or.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,B.dynamicFilter)(Fr,pr,this.retainedQueryData[C.bucketInstanceId].tileID.canonical,new p.Point(it.tileAnchorX,it.tileAnchorY),this.transform.calculateDistanceTileData(B.unwrappedTileID)))return this.placements[Vt]=new xi(!1,!1,!1,!0),void h.add(Vt)}if(h.has(Vt))return;if(Q)return void(this.placements[Vt]=new xi(!1,!1,!1));let wt=!1,Ut=!1,At=!0,qt=!1,Un=!1,ti=null,An={box:null,offscreen:null,occluded:null},Hn={box:null,offscreen:null,occluded:null},Ai=null,wi=null,Vn=null,ur=0,wr=0,Dr=0;ht.textFeatureIndex?ur=ht.textFeatureIndex:it.useRuntimeCollisionCircles&&(ur=it.featureIndex),ht.verticalTextFeatureIndex&&(wr=ht.verticalTextFeatureIndex);const ji=Fr=>{Fr.tileID=this.retainedQueryData[C.bucketInstanceId].tileID;const pr=this.transform.elevation;(pr||Fr.elevation)&&(Fr.elevation=pr?pr.getAtTileOffset(Fr.tileID,Fr.tileAnchorX,Fr.tileAnchorY):0)},xs=ht.textBox;if(xs){ji(xs);const Fr=or=>{let yo=p.WritingMode.horizontal;if(C.allowVerticalPlacement&&!or&&this.prevPlacement){const ws=this.prevPlacement.placedOrientations[Vt];ws&&(this.placedOrientations[Vt]=ws,yo=ws,this.markUsedOrientation(C,yo,it))}return yo},pr=(or,yo)=>{if(C.allowVerticalPlacement&&ot>0&&ht.verticalTextBox){for(const ws of C.writingModes)if(ws===p.WritingMode.vertical?(An=yo(),Hn=An):An=or(),An&&An.box&&An.box.length)break}else An=or()};if(I.get("text-variable-anchor")){let or=I.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Vt]){const Hr=this.prevPlacement.variableOffsets[Vt];or.indexOf(Hr.anchor)>0&&(or=or.filter(Fs=>Fs!==Hr.anchor),or.unshift(Hr.anchor))}const yo=(Hr,Fs,Yh)=>{const gl=C.getSymbolInstanceTextSize(ae,it,this.transform.zoom,Tt),Nl=(Hr.x2-Hr.x1)*gl+2*Hr.padding,Bl=(Hr.y2-Hr.y1)*gl+2*Hr.padding,zl=Oe&&!be?Fs:null;zl&&ji(zl);let hc={box:[],offscreen:!1,occluded:!1};const Vl=me?2*or.length:or.length;for(let Vd=0;Vd<Vl;++Vd){const Yi=this.attemptAnchorPlacement(or[Vd%or.length],Hr,Nl,Bl,gl,Le,Pe,$,A,ce,Vd>=or.length,it,Tt,C,Yh,zl,ae,se);if(Yi&&(hc=Yi.placedGlyphBoxes,hc&&hc.box&&hc.box.length)){wt=!0,ti=Yi.shift;break}}return hc};pr(()=>yo(xs,ht.iconBox,p.WritingMode.horizontal),()=>{const Hr=ht.verticalTextBox;return Hr&&ji(Hr),C.allowVerticalPlacement&&!(An&&An.box&&An.box.length)&&ot>0&&Hr?yo(Hr,ht.verticalIconBox,p.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),An&&(wt=An.box,At=An.offscreen,qt=An.occluded);const ws=Fr(!(!An||!An.box));if(!wt&&this.prevPlacement){const Hr=this.prevPlacement.variableOffsets[Vt];Hr&&(this.variableOffsets[Vt]=Hr,this.markUsedJustification(C,Hr.anchor,it,ws))}}else{const or=(yo,ws)=>{const Hr=C.getSymbolInstanceTextSize(ae,it,this.transform.zoom,Tt),Fs=this.collisionIndex.placeCollisionBox(C,Hr,yo,new p.Point(0,0),me,$,A,ce.predicate);return Fs&&Fs.box&&Fs.box.length&&(this.markUsedOrientation(C,ws,it),this.placedOrientations[Vt]=ws),Fs};pr(()=>or(xs,p.WritingMode.horizontal),()=>{const yo=ht.verticalTextBox;return C.allowVerticalPlacement&&ot>0&&yo?(ji(yo),or(yo,p.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Fr(!!(An&&An.box&&An.box.length))}}if(Ai=An,wt=Ai&&Ai.box&&Ai.box.length>0,At=Ai&&Ai.offscreen,qt=Ai&&Ai.occluded,it.useRuntimeCollisionCircles){const Fr=C.text.placedSymbolArray.get(it.centerJustifiedTextSymbolIndex>=0?it.centerJustifiedTextSymbolIndex:it.verticalPlacedTextSymbolIndex),pr=p.evaluateSizeForFeature(C.textSizeData,ae,Fr),or=I.get("text-padding");wi=this.collisionIndex.placeCollisionCircles(C,me,Fr,C.lineVertexArray,C.glyphOffsetArray,pr,A,P,N,_,Pe,ce.predicate,it.collisionCircleDiameter*pr/p.ONE_EM,or,this.retainedQueryData[C.bucketInstanceId].tileID),wt=me||wi.circles.length>0&&!wi.collisionDetected,At=At&&wi.offscreen,qt=wi.occluded}if(ht.iconFeatureIndex&&(Dr=ht.iconFeatureIndex),ht.iconBox){const Fr=pr=>{ji(pr);const or=Oe&&ti?ic(ti.x,ti.y,Le,Pe,this.transform.angle):new p.Point(0,0),yo=C.getSymbolInstanceIconSize(se,this.transform.zoom,it.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(C,yo,pr,or,be,$,A,ce.predicate)};Hn&&Hn.box&&Hn.box.length&&ht.verticalIconBox?(Vn=Fr(ht.verticalIconBox),Ut=Vn.box.length>0):(Vn=Fr(ht.iconBox),Ut=Vn.box.length>0),At=At&&Vn.offscreen,Un=Vn.occluded}const _o=q||0===it.numHorizontalGlyphVertices&&0===ot,Js=ie||0===it.numIconVertices;if(_o||Js?Js?_o||(Ut=Ut&&wt):wt=Ut&&wt:Ut=wt=Ut&&wt,wt&&Ai&&Ai.box&&this.collisionIndex.insertCollisionBox(Ai.box,I.get("text-ignore-placement"),C.bucketInstanceId,Hn&&Hn.box&&wr?wr:ur,ce.ID),Ut&&Vn&&this.collisionIndex.insertCollisionBox(Vn.box,I.get("icon-ignore-placement"),C.bucketInstanceId,Dr,ce.ID),wi&&(wt&&this.collisionIndex.insertCollisionCircles(wi.circles,I.get("text-ignore-placement"),C.bucketInstanceId,ur,ce.ID),_)){const Fr=C.bucketInstanceId;let pr=this.collisionCircleArrays[Fr];void 0===pr&&(pr=this.collisionCircleArrays[Fr]=new ir);for(let or=0;or<wi.circles.length;or+=4)pr.circles.push(wi.circles[or+0]),pr.circles.push(wi.circles[or+1]),pr.circles.push(wi.circles[or+2]),pr.circles.push(wi.collisionDetected?1:0)}const Aa="globe"!==C.projection.name;We=We&&(Aa||!qt),at=at&&(Aa||!Un),this.placements[Vt]=new xi(wt||We,Ut||at,At||C.justReloaded),h.add(Vt)};if(Ke){const it=C.getSortedSymbolIndexes(this.transform.angle);for(let Tt=it.length-1;Tt>=0;--Tt){const ht=it[Tt];zt(C.symbolInstances.get(ht),ht,C.collisionArrays[ht])}}else for(let it=c.symbolInstanceStart;it<c.symbolInstanceEnd;it++)zt(C.symbolInstances.get(it),it,C.collisionArrays[it]);if(_&&C.bucketInstanceId in this.collisionCircleArrays){const it=this.collisionCircleArrays[C.bucketInstanceId];p.invert(it.invProjMatrix,A),it.viewportMatrix=this.collisionIndex.getViewportMatrix()}C.justReloaded=!1}markUsedJustification(c,h,_,w){const{leftJustifiedTextSymbolIndex:C,centerJustifiedTextSymbolIndex:I,rightJustifiedTextSymbolIndex:A,verticalPlacedTextSymbolIndex:P,crossTileID:N}=_,B=p.getAnchorJustification(h),$=w===p.WritingMode.vertical?P:"left"===B?C:"center"===B?I:"right"===B?A:-1;C>=0&&(c.text.placedSymbolArray.get(C).crossTileID=$>=0&&C!==$?0:N),I>=0&&(c.text.placedSymbolArray.get(I).crossTileID=$>=0&&I!==$?0:N),A>=0&&(c.text.placedSymbolArray.get(A).crossTileID=$>=0&&A!==$?0:N),P>=0&&(c.text.placedSymbolArray.get(P).crossTileID=$>=0&&P!==$?0:N)}markUsedOrientation(c,h,_){const w=h===p.WritingMode.horizontal||h===p.WritingMode.horizontalOnly?h:0,C=h===p.WritingMode.vertical?h:0,{leftJustifiedTextSymbolIndex:I,centerJustifiedTextSymbolIndex:A,rightJustifiedTextSymbolIndex:P,verticalPlacedTextSymbolIndex:N}=_,B=c.text.placedSymbolArray;I>=0&&(B.get(I).placedOrientation=w),A>=0&&(B.get(A).placedOrientation=w),P>=0&&(B.get(P).placedOrientation=w),N>=0&&(B.get(N).placedOrientation=C)}commit(c){this.commitTime=c,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let _=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const w=h?h.symbolFadeChange(c):1,C=h?h.opacities:{},I=h?h.variableOffsets:{},A=h?h.placedOrientations:{};for(const P in this.placements){const N=this.placements[P],B=C[P];B?(this.opacities[P]=new Ta(B,w,N.text,N.icon,null,N.clipped),_=_||N.text!==B.text.placed||N.icon!==B.icon.placed):(this.opacities[P]=new Ta(null,w,N.text,N.icon,N.skipFade,N.clipped),_=_||N.text||N.icon)}for(const P in C){const N=C[P];if(!this.opacities[P]){const B=new Ta(N,w,!1,!1);B.isHidden()||(this.opacities[P]=B,_=_||N.text.placed||N.icon.placed)}}for(const P in I)this.variableOffsets[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.variableOffsets[P]=I[P]);for(const P in A)this.placedOrientations[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.placedOrientations[P]=A[P]);_?this.lastPlacementChangeTime=c:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:c)}updateLayerOpacities(c,h){const _=new Set;for(const w of h){const C=w.getBucket(c);C&&w.latestFeatureIndex&&c.id===C.layerIds[0]&&this.updateBucketOpacities(C,_,w.collisionBoxArray)}}updateBucketOpacities(c,h,_){c.hasTextData()&&c.text.opacityVertexArray.clear(),c.hasIconData()&&c.icon.opacityVertexArray.clear(),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexArray.clear(),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexArray.clear();const w=c.layers[0].layout,C=!!c.layers[0].dynamicFilter(),I=new Ta(null,0,!1,!1,!0),A=w.get("text-allow-overlap"),P=w.get("icon-allow-overlap"),N=w.get("text-variable-anchor"),B="map"===w.get("text-rotation-alignment"),$="map"===w.get("text-pitch-alignment"),Q="none"!==w.get("icon-text-fit"),re=new Ta(null,0,A&&(P||!c.hasIconData()||w.get("icon-optional")),P&&(A||!c.hasTextData()||w.get("text-optional")),!0);!c.collisionArrays&&_&&(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData())&&c.deserializeCollisionBoxes(_);const ae=(ce,q,ie)=>{for(let me=0;me<q/4;me++)ce.opacityVertexArray.emplaceBack(ie)};let se=0;for(let ce=0;ce<c.symbolInstances.length;ce++){const q=c.symbolInstances.get(ce),{numHorizontalGlyphVertices:ie,numVerticalGlyphVertices:me,crossTileID:be,numIconVertices:Le}=q,Pe=h.has(be);let Oe=this.opacities[be];Pe?Oe=I:Oe||(Oe=re,this.opacities[be]=Oe),h.add(be);const Ke=ie>0||me>0,We=Le>0,at=this.placedOrientations[be],zt=at===p.WritingMode.vertical,it=at===p.WritingMode.horizontal||at===p.WritingMode.horizontalOnly;if(!Ke&&!We||Oe.isHidden()||se++,Ke){const Tt=yd(Oe.text);ae(c.text,ie,zt?go:Tt),ae(c.text,me,it?go:Tt);const ht=Oe.text.isHidden(),{leftJustifiedTextSymbolIndex:Vt,centerJustifiedTextSymbolIndex:ot,rightJustifiedTextSymbolIndex:wt,verticalPlacedTextSymbolIndex:Ut}=q,At=c.text.placedSymbolArray,qt=ht||zt?1:0;Vt>=0&&(At.get(Vt).hidden=qt),ot>=0&&(At.get(ot).hidden=qt),wt>=0&&(At.get(wt).hidden=qt),Ut>=0&&(At.get(Ut).hidden=ht||it?1:0);const Un=this.variableOffsets[be];Un&&this.markUsedJustification(c,Un.anchor,q,at);const ti=this.placedOrientations[be];ti&&(this.markUsedJustification(c,"left",q,ti),this.markUsedOrientation(c,ti,q))}if(We){const Tt=yd(Oe.icon),{placedIconSymbolIndex:ht,verticalPlacedIconSymbolIndex:Vt}=q,ot=c.icon.placedSymbolArray,wt=Oe.icon.isHidden()?1:0;ht>=0&&(ae(c.icon,Le,zt?go:Tt),ot.get(ht).hidden=wt),Vt>=0&&(ae(c.icon,q.numVerticalIconVertices,it?go:Tt),ot.get(Vt).hidden=wt)}if(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData()){const Tt=c.collisionArrays[ce];if(Tt){let ht=new p.Point(0,0),Vt=!0;if(Tt.textBox||Tt.verticalTextBox){if(N){const wt=this.variableOffsets[be];wt?(ht=bd(wt.anchor,wt.width,wt.height,wt.textOffset,wt.textScale),B&&ht._rotate($?this.transform.angle:-this.transform.angle)):Vt=!1}C&&(Vt=!Oe.clipped),Tt.textBox&&_d(c.textCollisionBox.collisionVertexArray,Oe.text.placed,!Vt||zt,ht.x,ht.y),Tt.verticalTextBox&&_d(c.textCollisionBox.collisionVertexArray,Oe.text.placed,!Vt||it,ht.x,ht.y)}const ot=Vt&&Boolean(!it&&Tt.verticalIconBox);Tt.iconBox&&_d(c.iconCollisionBox.collisionVertexArray,Oe.icon.placed,ot,Q?ht.x:0,Q?ht.y:0),Tt.verticalIconBox&&_d(c.iconCollisionBox.collisionVertexArray,Oe.icon.placed,!ot,Q?ht.x:0,Q?ht.y:0)}}}if(c.fullyClipped=0===se,c.sortFeatures(this.transform.angle),this.retainedQueryData[c.bucketInstanceId]&&(this.retainedQueryData[c.bucketInstanceId].featureSortOrder=c.featureSortOrder),c.hasTextData()&&c.text.opacityVertexBuffer&&c.text.opacityVertexBuffer.updateData(c.text.opacityVertexArray),c.hasIconData()&&c.icon.opacityVertexBuffer&&c.icon.opacityVertexBuffer.updateData(c.icon.opacityVertexArray),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexBuffer&&c.iconCollisionBox.collisionVertexBuffer.updateData(c.iconCollisionBox.collisionVertexArray),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexBuffer&&c.textCollisionBox.collisionVertexBuffer.updateData(c.textCollisionBox.collisionVertexArray),c.bucketInstanceId in this.collisionCircleArrays){const ce=this.collisionCircleArrays[c.bucketInstanceId];c.placementInvProjMatrix=ce.invProjMatrix,c.placementViewportMatrix=ce.viewportMatrix,c.collisionCircleArray=ce.circles,delete this.collisionCircleArrays[c.bucketInstanceId]}}symbolFadeChange(c){return 0===this.fadeDuration?1:(c-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(c){return Math.max(0,(this.transform.zoom-c)/1.5)}hasTransitions(c){return this.stale||c-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(c,h){const _=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*_>c}setStale(){this.stale=!0}}function _d(g,c,h,_,w){g.emplaceBack(c?1:0,h?1:0,_||0,w||0),g.emplaceBack(c?1:0,h?1:0,_||0,w||0),g.emplaceBack(c?1:0,h?1:0,_||0,w||0),g.emplaceBack(c?1:0,h?1:0,_||0,w||0)}const Ws=Math.pow(2,25),Eo=Math.pow(2,24),La=Math.pow(2,17),Fm=Math.pow(2,16),la=Math.pow(2,9),Fa=Math.pow(2,8),i_=Math.pow(2,1);function yd(g){if(0===g.opacity&&!g.placed)return 0;if(1===g.opacity&&g.placed)return 4294967295;const c=g.placed?1:0,h=Math.floor(127*g.opacity);return h*Ws+c*Eo+h*La+c*Fm+h*la+c*Fa+h*i_+c}const go=0;class vd{constructor(c){this._sortAcrossTiles="viewport-y"!==c.layout.get("symbol-z-order")&&void 0!==c.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(c,h,_,w,C){const I=this._bucketParts;for(;this._currentTileIndex<c.length;)if(h.getBucketParts(I,w,c[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,C())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((A,P)=>A.sortKey-P.sortKey));this._currentPartIndex<I.length;){const A=I[this._currentPartIndex];if(h.placeLayerBucketPart(A,this._seenCrossTileIDs,_,0===A.symbolInstanceStart),this._currentPartIndex++,C())return!0}return!1}}class Nm{constructor(c,h,_,w,C,I,A,P){this.placement=new _s(c,C,I,A,P),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=w,this._done=!1}isDone(){return this._done}continuePlacement(c,h,_){const w=p.exported.now(),C=()=>{const I=p.exported.now()-w;return!this._forceFullPlacement&&I>2};for(;this._currentPlacementIndex>=0;){const I=h[c[this._currentPlacementIndex]],A=this.placement.collisionIndex.transform.zoom;if("symbol"===I.type&&(!I.minzoom||I.minzoom<=A)&&(!I.maxzoom||I.maxzoom>A)){if(this._inProgressLayer||(this._inProgressLayer=new vd(I)),this._inProgressLayer.continuePlacement(_[I.source],this.placement,this._showCollisionBoxes,I,C))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(c){return this.placement.commit(c),this.placement}}const Bo=512/p.EXTENT/2;class Ei{constructor(c,h,_){this.tileID=c,this.bucketInstanceId=_,this.index=new p.KDBush(h.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const w=c.canonical.x*p.EXTENT,C=c.canonical.y*p.EXTENT;for(let I=0;I<h.length;I++){const{key:A,crossTileID:P,tileAnchorX:N,tileAnchorY:B}=h.get(I),$=Math.floor((w+N)*Bo),Q=Math.floor((C+B)*Bo);this.index.add($,Q),this.keys.push(A),this.crossTileIDs.push(P)}this.index.finish()}findMatches(c,h,_){const w=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z),C=Bo/Math.pow(2,h.canonical.z-this.tileID.canonical.z),I=h.canonical.x*p.EXTENT,A=h.canonical.y*p.EXTENT;for(let P=0;P<c.length;P++){const N=c.get(P);if(N.crossTileID)continue;const{key:B,tileAnchorX:$,tileAnchorY:Q}=N,re=Math.floor((I+$)*C),ae=Math.floor((A+Q)*C),se=this.index.range(re-w,ae-w,re+w,ae+w);for(const ce of se){const q=this.crossTileIDs[ce];if(this.keys[ce]===B&&!_.has(q)){_.add(q),N.crossTileID=q;break}}}}}class Bm{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class zm{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(c){const h=Math.round((c-this.lng)/360);if(0!==h)for(const _ in this.indexes){const w=this.indexes[_],C={};for(const I in w){const A=w[I];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+h),C[A.tileID.key]=A}this.indexes[_]=C}this.lng=c}addBucket(c,h,_){if(this.indexes[c.overscaledZ]&&this.indexes[c.overscaledZ][c.key]){if(this.indexes[c.overscaledZ][c.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(c.overscaledZ,this.indexes[c.overscaledZ][c.key])}for(let C=0;C<h.symbolInstances.length;C++)h.symbolInstances.get(C).crossTileID=0;this.usedCrossTileIDs[c.overscaledZ]||(this.usedCrossTileIDs[c.overscaledZ]=new Set);const w=this.usedCrossTileIDs[c.overscaledZ];for(const C in this.indexes){const I=this.indexes[C];if(Number(C)>c.overscaledZ)for(const A in I){const P=I[A];P.tileID.isChildOf(c)&&P.findMatches(h.symbolInstances,c,w)}else{const A=I[c.scaledTo(Number(C)).key];A&&A.findMatches(h.symbolInstances,c,w)}}for(let C=0;C<h.symbolInstances.length;C++){const I=h.symbolInstances.get(C);I.crossTileID||(I.crossTileID=_.generate(),w.add(I.crossTileID))}return void 0===this.indexes[c.overscaledZ]&&(this.indexes[c.overscaledZ]={}),this.indexes[c.overscaledZ][c.key]=new Ei(c,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(c,h){for(const _ of h.crossTileIDs)this.usedCrossTileIDs[c].delete(_)}removeStaleBuckets(c){let h=!1;for(const _ in this.indexes){const w=this.indexes[_];for(const C in w)c[w[C].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,w[C]),delete w[C],h=!0)}return h}}class rc{constructor(){this.layerIndexes={},this.crossTileIDs=new Bm,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(c,h,_,w){let C=this.layerIndexes[c.id];void 0===C&&(C=this.layerIndexes[c.id]=new zm);let I=!1;const A={};"globe"!==w.name&&C.handleWrapJump(_);for(const P of h){const N=P.getBucket(c);N&&c.id===N.layerIds[0]&&(N.bucketInstanceId||(N.bucketInstanceId=++this.maxBucketInstanceId),C.addBucket(P.tileID,N,this.crossTileIDs)&&(I=!0),A[N.bucketInstanceId]=!0)}return C.removeStaleBuckets(A)&&(I=!0),I}pruneUnusedLayers(c){const h={};c.forEach(_=>{h[_]=!0});for(const _ in this.layerIndexes)h[_]||delete this.layerIndexes[_]}}const tn=(g,c)=>p.emitValidationErrors(g,c&&c.filter(h=>"source.canvas"!==h.identifier)),Xp=p.pick(Gn,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Nn=p.pick(Gn,["setCenter","setZoom","setBearing","setPitch"]),yu={version:8,layers:[],sources:{}},vu={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Na extends p.Evented{constructor(c,h={}){super(),this.map=c,this.dispatcher=new Mt(br(),this),this.imageManager=new Ge,this.imageManager.setEventedParent(this),this.glyphManager=new p.GlyphManager(c._requestManager,h.localFontFamily?p.LocalGlyphMode.all:h.localIdeographFontFamily?p.LocalGlyphMode.ideographs:p.LocalGlyphMode.none,h.localFontFamily||h.localIdeographFontFamily),this.crossTileSymbolIndex=new rc,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",p.getReferrer());const _=this;this._rtlTextPluginCallback=Na.registerForPluginStateChange(w=>{_.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:w.pluginStatus,pluginURL:w.pluginURL},(C,I)=>{if(p.triggerPluginCompletionEvent(C),I&&I.every(A=>A))for(const A in _._sourceCaches){const P=_._sourceCaches[A],N=P.getSource().type;"vector"!==N&&"geojson"!==N||P.reload()}})}),this.on("data",w=>{if("source"!==w.dataType||"metadata"!==w.sourceDataType)return;const C=this.getSource(w.sourceId);if(C&&C.vectorLayerIds)for(const I in this._layers){const A=this._layers[I];A.source===C.id&&this._validateLayer(A)}})}loadURL(c,h={}){this.fire(new p.Event("dataloading",{dataType:"style"}));const _="boolean"==typeof h.validate?h.validate:!p.isMapboxURL(c);c=this.map._requestManager.normalizeStyleURL(c,h.accessToken);const w=this.map._requestManager.transformRequest(c,p.ResourceType.Style);this._request=p.getJSON(w,(C,I)=>{this._request=null,C?this.fire(new p.ErrorEvent(C)):I&&this._load(I,_)})}loadJSON(c,h={}){this.fire(new p.Event("dataloading",{dataType:"style"})),this._request=p.exported.frame(()=>{this._request=null,this._load(c,!1!==h.validate)})}loadEmpty(){this.fire(new p.Event("dataloading",{dataType:"style"})),this._load(yu,!1)}_updateLayerCount(c,h){const _=h?1:-1;c.is3D()&&(this._num3DLayers+=_),"circle"===c.type&&(this._numCircleLayers+=_),"symbol"===c.type&&(this._numSymbolLayers+=_)}_load(c,h){if(h&&tn(this,p.validateStyle(c)))return;this._loaded=!0,this.stylesheet=p.clone$1(c),this._updateMapProjection();for(const w in c.sources)this.addSource(w,c.sources[w],{validate:!1});this._changed=!1,c.sprite?this._loadSprite(c.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(c.glyphs);const _=Sa(this.stylesheet.layers);this._order=_.map(w=>w.id),this._layers={},this._serializedLayers={};for(const w of _){const C=p.createStyleLayer(w);C.setEventedParent(this,{layer:{id:C.id}}),this._layers[C.id]=C,this._serializedLayers[C.id]=C.serialize(),this._updateLayerCount(C,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new K(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new p.Event("data",{dataType:"style"})),this.fire(new p.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(c){c?this.stylesheet.projection=c:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(c){this._spriteRequest=function(h,_,w){let C,I,A;const P=p.exported.devicePixelRatio>1?"@2x":"";let N=p.getJSON(_.transformRequest(_.normalizeSpriteURL(h,P,".json"),p.ResourceType.SpriteJSON),(Q,re)=>{N=null,A||(A=Q,C=re,$())}),B=p.getImage(_.transformRequest(_.normalizeSpriteURL(h,P,".png"),p.ResourceType.SpriteImage),(Q,re)=>{B=null,A||(A=Q,I=re,$())});function $(){if(A)w(A);else if(C&&I){const Q=p.exported.getImageData(I),re={};for(const ae in C){const{width:se,height:ce,x:q,y:ie,sdf:me,pixelRatio:be,stretchX:Le,stretchY:Pe,content:Oe}=C[ae],Ke=new p.RGBAImage({width:se,height:ce});p.RGBAImage.copy(Q,Ke,{x:q,y:ie},{x:0,y:0},{width:se,height:ce}),re[ae]={data:Ke,pixelRatio:be,sdf:me,stretchX:Le,stretchY:Pe,content:Oe}}w(null,re)}}return{cancel(){N&&(N.cancel(),N=null),B&&(B.cancel(),B=null)}}}(c,this.map._requestManager,(h,_)=>{if(this._spriteRequest=null,h)this.fire(new p.ErrorEvent(h));else if(_)for(const w in _)this.imageManager.addImage(w,_[w]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new p.Event("data",{dataType:"style"}))})}_validateLayer(c){const h=this.getSource(c.source);if(!h)return;const _=c.sourceLayer;_&&("geojson"===h.type||h.vectorLayerIds&&-1===h.vectorLayerIds.indexOf(_))&&this.fire(new p.ErrorEvent(new Error(`Source layer "${_}" does not exist on source "${h.id}" as specified by style layer "${c.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const c in this._sourceCaches)if(!this._sourceCaches[c].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(c){const h=[];for(const _ of c){const w=this._layers[_];"custom"!==w.type&&h.push(w.serialize())}return h}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const c in this._sourceCaches)if(this._sourceCaches[c].hasTransition())return!0;for(const c in this._layers)if(this._layers[c].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(c){return!!this.terrain&&("function"==typeof c.isLayerDraped?c.isLayerDraped():vu[c.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(c){if(!this._loaded)return;const h=this._changed;if(this._changed){const w=Object.keys(this._updatedLayers),C=Object.keys(this._removedLayers);(w.length||C.length)&&this._updateWorkerLayers(w,C);for(const I in this._updatedSources){const A=this._updatedSources[I];"reload"===A?this._reloadSource(I):"clear"===A&&this._clearSource(I)}this._updateTilesForChangedImages();for(const I in this._updatedPaintProps)this._layers[I].updateTransitions(c);this.light.updateTransitions(c),this.fog&&this.fog.updateTransitions(c),this._resetUpdates()}const _={};for(const w in this._sourceCaches){const C=this._sourceCaches[w];_[w]=C.used,C.used=!1}for(const w of this._order){const C=this._layers[w];if(C.recalculate(c,this._availableImages),!C.isHidden(c.zoom)){const A=this._getLayerSourceCache(C);A&&(A.used=!0)}const I=this.map.painter;if(I){const A=C.getProgramIds();if(!A)continue;const P=C.getProgramConfiguration(c.zoom);for(const N of A)I.useProgram(N,P)}}for(const w in _){const C=this._sourceCaches[w];_[w]!==C.used&&C.getSource().fire(new p.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:C.getSource().id}))}this.light.recalculate(c),this.terrain&&this.terrain.recalculate(c),this.fog&&this.fog.recalculate(c),this.z=c.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),h&&this.fire(new p.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const c=Object.keys(this._changedImages);if(c.length){for(const h in this._sourceCaches)this._sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],c);this._changedImages={}}}_updateWorkerLayers(c,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(c),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(c){if(this._checkLoaded(),tn(this,p.validateStyle(c)))return!1;(c=p.clone$1(c)).layers=Sa(c.layers);const h=function(w,C){if(!w)return[{command:Gn.setStyle,args:[C]}];let I=[];try{if(!he(w.version,C.version))return[{command:Gn.setStyle,args:[C]}];he(w.center,C.center)||I.push({command:Gn.setCenter,args:[C.center]}),he(w.zoom,C.zoom)||I.push({command:Gn.setZoom,args:[C.zoom]}),he(w.bearing,C.bearing)||I.push({command:Gn.setBearing,args:[C.bearing]}),he(w.pitch,C.pitch)||I.push({command:Gn.setPitch,args:[C.pitch]}),he(w.sprite,C.sprite)||I.push({command:Gn.setSprite,args:[C.sprite]}),he(w.glyphs,C.glyphs)||I.push({command:Gn.setGlyphs,args:[C.glyphs]}),he(w.transition,C.transition)||I.push({command:Gn.setTransition,args:[C.transition]}),he(w.light,C.light)||I.push({command:Gn.setLight,args:[C.light]}),he(w.fog,C.fog)||I.push({command:Gn.setFog,args:[C.fog]}),he(w.projection,C.projection)||I.push({command:Gn.setProjection,args:[C.projection]});const A={},P=[];!function($,Q,re,ae){let se;for(se in Q=Q||{},$=$||{})$.hasOwnProperty(se)&&(Q.hasOwnProperty(se)||so(se,re,ae));for(se in Q){if(!Q.hasOwnProperty(se))continue;const ce=Q[se];$.hasOwnProperty(se)?he($[se],ce)||("geojson"===$[se].type&&"geojson"===ce.type&&Ca($,Q,se)?re.push({command:Gn.setGeoJSONSourceData,args:[se,ce.data]}):sl(se,Q,re,ae)):Wo(se,Q,re)}}(w.sources,C.sources,P,A);const N=[];w.layers&&w.layers.forEach($=>{$.source&&A[$.source]?I.push({command:Gn.removeLayer,args:[$.id]}):N.push($)});let B=w.terrain;B&&A[B.source]&&(I.push({command:Gn.setTerrain,args:[void 0]}),B=void 0),I=I.concat(P),he(B,C.terrain)||I.push({command:Gn.setTerrain,args:[C.terrain]}),function($,Q,re){Q=Q||[];const ae=($=$||[]).map(No),se=Q.map(No),ce=$.reduce(al,{}),q=Q.reduce(al,{}),ie=ae.slice(),me=Object.create(null);let be,Le,Pe,Oe,Ke,We,at;for(be=0,Le=0;be<ae.length;be++)Pe=ae[be],q.hasOwnProperty(Pe)?Le++:(re.push({command:Gn.removeLayer,args:[Pe]}),ie.splice(ie.indexOf(Pe,Le),1));for(be=0,Le=0;be<se.length;be++)Pe=se[se.length-1-be],ie[ie.length-1-be]!==Pe&&(ce.hasOwnProperty(Pe)?(re.push({command:Gn.removeLayer,args:[Pe]}),ie.splice(ie.lastIndexOf(Pe,ie.length-Le),1)):Le++,We=ie[ie.length-be],re.push({command:Gn.addLayer,args:[q[Pe],We]}),ie.splice(ie.length-be,0,Pe),me[Pe]=!0);for(be=0;be<se.length;be++)if(Pe=se[be],Oe=ce[Pe],Ke=q[Pe],!me[Pe]&&!he(Oe,Ke))if(he(Oe.source,Ke.source)&&he(Oe["source-layer"],Ke["source-layer"])&&he(Oe.type,Ke.type)){for(at in fo(Oe.layout,Ke.layout,re,Pe,null,Gn.setLayoutProperty),fo(Oe.paint,Ke.paint,re,Pe,null,Gn.setPaintProperty),he(Oe.filter,Ke.filter)||re.push({command:Gn.setFilter,args:[Pe,Ke.filter]}),he(Oe.minzoom,Ke.minzoom)&&he(Oe.maxzoom,Ke.maxzoom)||re.push({command:Gn.setLayerZoomRange,args:[Pe,Ke.minzoom,Ke.maxzoom]}),Oe)Oe.hasOwnProperty(at)&&"layout"!==at&&"paint"!==at&&"filter"!==at&&"metadata"!==at&&"minzoom"!==at&&"maxzoom"!==at&&(0===at.indexOf("paint.")?fo(Oe[at],Ke[at],re,Pe,at.slice(6),Gn.setPaintProperty):he(Oe[at],Ke[at])||re.push({command:Gn.setLayerProperty,args:[Pe,at,Ke[at]]}));for(at in Ke)Ke.hasOwnProperty(at)&&!Oe.hasOwnProperty(at)&&"layout"!==at&&"paint"!==at&&"filter"!==at&&"metadata"!==at&&"minzoom"!==at&&"maxzoom"!==at&&(0===at.indexOf("paint.")?fo(Oe[at],Ke[at],re,Pe,at.slice(6),Gn.setPaintProperty):he(Oe[at],Ke[at])||re.push({command:Gn.setLayerProperty,args:[Pe,at,Ke[at]]}))}else re.push({command:Gn.removeLayer,args:[Pe]}),We=ie[ie.lastIndexOf(Pe)+1],re.push({command:Gn.addLayer,args:[Ke,We]})}(N,C.layers,I)}catch(A){console.warn("Unable to compute style diff:",A),I=[{command:Gn.setStyle,args:[C]}]}return I}(this.serialize(),c).filter(w=>!(w.command in Nn));if(0===h.length)return!1;const _=h.filter(w=>!(w.command in Xp));if(_.length>0)throw new Error(`Unimplemented: ${_.map(w=>w.command).join(", ")}.`);return h.forEach(w=>{"setTransition"!==w.command&&"setProjection"!==w.command&&this[w.command].apply(this,w.args)}),this.stylesheet=c,this._updateMapProjection(),!0}addImage(c,h){return this.getImage(c)?this.fire(new p.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(c,h),this._afterImageUpdated(c),this)}updateImage(c,h){this.imageManager.updateImage(c,h)}getImage(c){return this.imageManager.getImage(c)}removeImage(c){return this.getImage(c)?(this.imageManager.removeImage(c),this._afterImageUpdated(c),this):this.fire(new p.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(c){this._availableImages=this.imageManager.listImages(),this._changedImages[c]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new p.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(c,h,_={}){if(this._checkLoaded(),void 0!==this.getSource(c))throw new Error("There is already a source with this ID");if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(p.validateSource,`sources.${c}`,h,null,_))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const w=pi(c,h,this.dispatcher,this);w.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(c),source:w.serialize(),sourceId:c}));const C=I=>{const A=(I?"symbol:":"other:")+c,P=this._sourceCaches[A]=new p.SourceCache(A,w,I);(I?this._symbolSourceCaches:this._otherSourceCaches)[c]=P,P.style=this,P.onAdd(this.map)};C(!1),"vector"!==h.type&&"geojson"!==h.type||C(!0),w.onAdd&&w.onAdd(this.map),this._changed=!0}removeSource(c){this._checkLoaded();const h=this.getSource(c);if(!h)throw new Error("There is no source with this ID");for(const w in this._layers)if(this._layers[w].source===c)return this.fire(new p.ErrorEvent(new Error(`Source "${c}" cannot be removed while layer "${w}" is using it.`)));if(this.terrain&&this.terrain.get().source===c)return this.fire(new p.ErrorEvent(new Error(`Source "${c}" cannot be removed while terrain is using it.`)));const _=this._getSourceCaches(c);for(const w of _)delete this._sourceCaches[w.id],delete this._updatedSources[w.id],w.fire(new p.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:w.getSource().id})),w.setEventedParent(null),w.clearTiles();return delete this._otherSourceCaches[c],delete this._symbolSourceCaches[c],h.setEventedParent(null),h.onRemove&&h.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(c,h){this._checkLoaded(),this.getSource(c).setData(h),this._changed=!0}getSource(c){const h=this._getSourceCache(c);return h&&h.getSource()}_getSources(){const c=[];for(const h in this._otherSourceCaches){const _=this._getSourceCache(h);_&&c.push(_.getSource())}return c}addLayer(c,h,_={}){this._checkLoaded();const w=c.id;if(this.getLayer(w))return void this.fire(new p.ErrorEvent(new Error(`Layer with id "${w}" already exists on this map`)));let C;if("custom"===c.type){if(tn(this,p.validateCustomStyleLayer(c)))return;C=p.createStyleLayer(c)}else{if("object"==typeof c.source&&(this.addSource(w,c.source),c=p.clone$1(c),c=p.extend(c,{source:w})),this._validate(p.validateLayer,`layers.${w}`,c,{arrayIndex:-1},_))return;C=p.createStyleLayer(c),this._validateLayer(C),C.setEventedParent(this,{layer:{id:w}}),this._serializedLayers[C.id]=C.serialize(),this._updateLayerCount(C,!0)}const I=h?this._order.indexOf(h):this._order.length;if(h&&-1===I)return void this.fire(new p.ErrorEvent(new Error(`Layer with id "${h}" does not exist on this map.`)));this._order.splice(I,0,w),this._layerOrderChanged=!0,this._layers[w]=C;const A=this._getLayerSourceCache(C);if(this._removedLayers[w]&&C.source&&A&&"custom"!==C.type){const P=this._removedLayers[w];delete this._removedLayers[w],P.type!==C.type?this._updatedSources[C.source]="clear":(this._updatedSources[C.source]="reload",A.pause())}this._updateLayer(C),C.onAdd&&C.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(c,h){if(this._checkLoaded(),this._changed=!0,!this._layers[c])return void this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be moved.`)));if(c===h)return;const _=this._order.indexOf(c);this._order.splice(_,1);const w=h?this._order.indexOf(h):this._order.length;h&&-1===w?this.fire(new p.ErrorEvent(new Error(`Layer with id "${h}" does not exist on this map.`))):(this._order.splice(w,0,c),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(c){this._checkLoaded();const h=this._layers[c];if(!h)return void this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be removed.`)));h.setEventedParent(null),this._updateLayerCount(h,!1);const _=this._order.indexOf(c);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[c]=h,delete this._layers[c],delete this._serializedLayers[c],delete this._updatedLayers[c],delete this._updatedPaintProps[c],h.onRemove&&h.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(c){return this._layers[c]}hasLayer(c){return c in this._layers}hasLayerType(c){for(const h in this._layers)if(this._layers[h].type===c)return!0;return!1}setLayerZoomRange(c,h,_){this._checkLoaded();const w=this.getLayer(c);w?w.minzoom===h&&w.maxzoom===_||(null!=h&&(w.minzoom=h),null!=_&&(w.maxzoom=_),this._updateLayer(w)):this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(c,h,_={}){this._checkLoaded();const w=this.getLayer(c);if(w){if(!he(w.filter,h))return null==h?(w.filter=void 0,void this._updateLayer(w)):void(this._validate(p.validateFilter,`layers.${w.id}.filter`,h,{layerType:w.type},_)||(w.filter=p.clone$1(h),this._updateLayer(w)))}else this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be filtered.`)))}getFilter(c){const h=this.getLayer(c);return h&&p.clone$1(h.filter)}setLayoutProperty(c,h,_,w={}){this._checkLoaded();const C=this.getLayer(c);C?he(C.getLayoutProperty(h),_)||(C.setLayoutProperty(h,_,w),this._updateLayer(C)):this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(c,h){const _=this.getLayer(c);if(_)return _.getLayoutProperty(h);this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style.`)))}setPaintProperty(c,h,_,w={}){this._checkLoaded();const C=this.getLayer(c);C?he(C.getPaintProperty(h),_)||(C.setPaintProperty(h,_,w)&&this._updateLayer(C),this._changed=!0,this._updatedPaintProps[c]=!0):this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(c,h){const _=this.getLayer(c);return _&&_.getPaintProperty(h)}setFeatureState(c,h){this._checkLoaded();const _=c.source,w=c.sourceLayer,C=this.getSource(_);if(!C)return void this.fire(new p.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const I=C.type;if("geojson"===I&&w)return void this.fire(new p.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===I&&!w)return void this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===c.id&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided.")));const A=this._getSourceCaches(_);for(const P of A)P.setFeatureState(w,c.id,h)}removeFeatureState(c,h){this._checkLoaded();const _=c.source,w=this.getSource(_);if(!w)return void this.fire(new p.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const C=w.type,I="vector"===C?c.sourceLayer:void 0;if("vector"===C&&!I)return void this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(h&&"string"!=typeof c.id&&"number"!=typeof c.id)return void this.fire(new p.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const A=this._getSourceCaches(_);for(const P of A)P.removeFeatureState(I,c.id,h)}getFeatureState(c){this._checkLoaded();const h=c.source,_=c.sourceLayer,w=this.getSource(h);if(w){if("vector"!==w.type||_)return void 0===c.id&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(h)[0].getFeatureState(_,c.id);this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return p.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const c={};for(const h in this._sourceCaches){const _=this._sourceCaches[h].getSource();c[_.id]||(c[_.id]=_.serialize())}return p.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:c,layers:this._serializeLayers(this._order)},h=>void 0!==h)}_updateLayer(c){this._updatedLayers[c.id]=!0;const h=this._getLayerSourceCache(c);c.source&&!this._updatedSources[c.source]&&h&&"raster"!==h.getSource().type&&(this._updatedSources[c.source]="reload",h.pause()),this._changed=!0,c.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(c){const h=I=>"fill-extrusion"===this._layers[I].type,_={},w=[];for(let I=this._order.length-1;I>=0;I--){const A=this._order[I];if(h(A)){_[A]=I;for(const P of c){const N=P[A];if(N)for(const B of N)w.push(B)}}}w.sort((I,A)=>A.intersectionZ-I.intersectionZ);const C=[];for(let I=this._order.length-1;I>=0;I--){const A=this._order[I];if(h(A))for(let P=w.length-1;P>=0;P--){const N=w[P].feature;if(_[N.layer.id]<I)break;C.push(N),w.pop()}else for(const P of c){const N=P[A];if(N)for(const B of N)C.push(B.feature)}}return C}queryRenderedFeatures(c,h,_){h&&h.filter&&this._validate(p.validateFilter,"queryRenderedFeatures.filter",h.filter,null,h);const w={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new p.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const P of h.layers){const N=this._layers[P];if(!N)return this.fire(new p.ErrorEvent(new Error(`The layer '${P}' does not exist in the map's style and cannot be queried for features.`))),[];w[N.source]=!0}}const C=[];h.availableImages=this._availableImages;const I=h&&h.layers?h.layers.some(P=>{const N=this.getLayer(P);return N&&N.is3D()}):this.has3DLayers(),A=vn.createFromScreenPoints(c,_);for(const P in this._sourceCaches){const N=this._sourceCaches[P].getSource().id;h.layers&&!w[N]||C.push(Pt(this._sourceCaches[P],this._layers,this._serializedLayers,A,h,_,I,!!this.map._showQueryGeometry))}return this.placement&&C.push(function(P,N,B,$,Q,re,ae){const se={},ce=re.queryRenderedSymbols($),q=[];for(const ie of Object.keys(ce).map(Number))q.push(ae[ie]);q.sort(ee);for(const ie of q){const me=ie.featureIndex.lookupSymbolFeatures(ce[ie.bucketInstanceId],N,ie.bucketIndex,ie.sourceLayerIndex,Q.filter,Q.layers,Q.availableImages,P);for(const be in me){const Le=se[be]=se[be]||[],Pe=me[be];Pe.sort((Oe,Ke)=>{const We=ie.featureSortOrder;if(We){const at=We.indexOf(Oe.featureIndex);return We.indexOf(Ke.featureIndex)-at}return Ke.featureIndex-Oe.featureIndex});for(const Oe of Pe)Le.push(Oe)}}for(const ie in se)se[ie].forEach(me=>{const be=me.feature,Le=B(P[ie]);if(!Le)return;const Pe=Le.getFeatureState(be.layer["source-layer"],be.id);be.source=be.layer.source,be.layer["source-layer"]&&(be.sourceLayer=be.layer["source-layer"]),be.state=Pe});return se}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),A.screenGeometry,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(C)}querySourceFeatures(c,h){h&&h.filter&&this._validate(p.validateFilter,"querySourceFeatures.filter",h.filter,null,h);const _=this._getSourceCaches(c);let w=[];for(const C of _)w=w.concat(Y(C,h));return w}addSourceType(c,h,_){return Na.getSourceType(c)?_(new Error(`A source type called "${c}" already exists.`)):(Na.setSourceType(c,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:c,url:h.workerSourceURL},_):_(null,null))}getLight(){return this.light.getLight()}setLight(c,h={}){this._checkLoaded();const _=this.light.getLight();let w=!1;for(const I in c)if(!he(c[I],_[I])){w=!0;break}if(!w)return;const C=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(c,h),this.light.updateTransitions(C)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(c,h=1){if(this._checkLoaded(),!c)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let _=c;if(1===h){if("object"==typeof _.source){const w="terrain-dem-src";this.addSource(w,_.source),_=p.clone$1(_),_=p.extend(_,{source:w})}if(this._validate(p.validateTerrain,"terrain",_))return}if(!this.terrain||this.terrain&&h!==this.terrain.drapeRenderMode){if(!_)return;this._createTerrain(_,h)}else{const w=this.terrain,C=w.get();for(const I of Object.keys(p.spec.terrain))!_.hasOwnProperty(I)&&p.spec.terrain[I].default&&(_[I]=p.spec.terrain[I].default);for(const I in _)if(!he(_[I],C[I])){w.set(_),this.stylesheet.terrain=_;const A=this._setTransitionParameters({duration:0});w.updateTransitions(A);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(c){const h=this.fog=new cn(c,this.map.transform);this.stylesheet.fog=c;const _=this._setTransitionParameters({duration:0});h.updateTransitions(_)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const c of this.map._markers)c._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(c){if(this._checkLoaded(),!c)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const h=this.fog,_=h.get();0===Object.keys(c).length&&h.set(c);for(const w in c)if(!he(c[w],_[w])){h.set(c),this.stylesheet.fog=c;const C=this._setTransitionParameters({duration:0});h.updateTransitions(C);break}}else this._createFog(c);this._markersNeedUpdate=!0}_setTransitionParameters(c){return{now:p.exported.now(),transition:p.extend(c,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const c=this._order.filter(_=>this.isLayerDraped(this._layers[_])),h=this._order.filter(_=>!this.isLayerDraped(this._layers[_]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...c),this._drapedFirstOrder.push(...h)}_createTerrain(c,h){const _=this.terrain=new $e(c,h);this.stylesheet.terrain=c,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const w=this._setTransitionParameters({duration:0});_.updateTransitions(w)}_force3DLayerUpdate(){for(const c in this._layers){const h=this._layers[c];"fill-extrusion"===h.type&&this._updateLayer(h)}}_forceSymbolLayerUpdate(){for(const c in this._layers){const h=this._layers[c];"symbol"===h.type&&this._updateLayer(h)}}_validate(c,h,_,w,C={}){return(!C||!1!==C.validate)&&tn(this,c.call(p.validateStyle,p.extend({key:h,style:this.serialize(),value:_,styleSpec:p.spec},w)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),p.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const c in this._layers)this._layers[c].setEventedParent(null);for(const c in this._sourceCaches)this._sourceCaches[c].clearTiles(),this._sourceCaches[c].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(c){const h=this._getSourceCaches(c);for(const _ of h)_.clearTiles()}_reloadSource(c){const h=this._getSourceCaches(c);for(const _ of h)_.resume(),_.reload()}_reloadSources(){for(const c of this._getSources())c.reload&&c.reload()}_updateSources(c){for(const h in this._sourceCaches)this._sourceCaches[h].update(c)}_generateCollisionBoxes(){for(const c in this._sourceCaches){const h=this._sourceCaches[c];h.resume(),h.reload()}}_updatePlacement(c,h,_,w,C=!1){let I=!1,A=!1;const P={};for(const N of this._order){const B=this._layers[N];if("symbol"!==B.type)continue;if(!P[B.source]){const Q=this._getLayerSourceCache(B);if(!Q)continue;P[B.source]=Q.getRenderableIds(!0).map(re=>Q.getTileByID(re)).sort((re,ae)=>ae.tileID.overscaledZ-re.tileID.overscaledZ||(re.tileID.isLessThan(ae.tileID)?-1:1))}const $=this.crossTileSymbolIndex.addLayer(B,P[B.source],c.center.lng,c.projection);I=I||$}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),C=C||this._layerOrderChanged||0===_,this._layerOrderChanged&&this.fire(new p.Event("neworder")),(C||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(p.exported.now(),c.zoom))&&(this.pauseablePlacement=new Nm(c,this._order,C,h,_,w,this.placement,this.fog&&c.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,P),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(p.exported.now()),A=!0),I&&this.pauseablePlacement.placement.setStale()),A||I)for(const N of this._order){const B=this._layers[N];"symbol"===B.type&&this.placement.updateLayerOpacities(B,P[B.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(p.exported.now())}_releaseSymbolFadeTiles(){for(const c in this._sourceCaches)this._sourceCaches[c].releaseSymbolFadeTiles()}getImages(c,h,_){this.imageManager.getImages(h.icons,_),this._updateTilesForChangedImages();const w=C=>{C&&C.setDependencies(h.tileID.key,h.type,h.icons)};w(this._otherSourceCaches[h.source]),w(this._symbolSourceCaches[h.source])}getGlyphs(c,h,_){this.glyphManager.getGlyphs(h.stacks,_)}getResource(c,h,_){return p.makeRequest(h,_)}_getSourceCache(c){return this._otherSourceCaches[c]}_getLayerSourceCache(c){return"symbol"===c.type?this._symbolSourceCaches[c.source]:this._otherSourceCaches[c.source]}_getSourceCaches(c){const h=[];return this._otherSourceCaches[c]&&h.push(this._otherSourceCaches[c]),this._symbolSourceCaches[c]&&h.push(this._symbolSourceCaches[c]),h}_isSourceCacheLoaded(c){const h=this._getSourceCaches(c);return 0===h.length?(this.fire(new p.ErrorEvent(new Error(`There is no source with ID '${c}'`))),!1):h.every(_=>_.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Na.getSourceType=function(g){return li[g]},Na.setSourceType=function(g,c){li[g]=c},Na.registerForPluginStateChange=p.registerForPluginStateChange;var Zp="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",zc="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",ul="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\nconst float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",oc="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",Ba="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let xd={},xu={};const ri=[];wd(Zp,ri),wd(ul,ri),wd(oc,ri),wd(Ba,ri),xd=Bi("",ul),xu=Bi(Ba,oc);const Mh=Bi("\n#if __VERSION__ >=300\n#define varying in\n#define gl_FragColor glFragColor\n#define texture2D texture\n#define textureCube texture\nout vec4 glFragColor;\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\n#if __VERSION__ >=300\n#define attribute in\n#define varying out\n#define texture2D texture\n#endif\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),Ah=Zp,Xs="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var kh={background:Bi("uniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nvarying vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform vec4 u_color;varying vec4 v_color;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(u_color);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:Bi("uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:Bi("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:Bi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Bi("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:Bi("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Bi("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Bi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Bi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:Bi("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:Bi("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:Bi("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:Bi("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:Bi("varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\nvoid main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvec3 normal=v_normal;\n#endif\nfloat z;vec4 color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);\n#else\ncolor=v_color;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef ZERO_ROOF_RADIUS\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#endif\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(color,NdotL);\n#else\nv_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_color*=u_opacity;\n#ifdef ZERO_ROOF_RADIUS\nv_roof_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef LIGHTING_3D_MODE\nv_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));\n#else\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:Bi("uniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,v_NdotL)*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_NdotL=NdotL;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:Bi("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Bi("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\ngl_FragColor=apply_lighting(gl_FragColor);\n#endif\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:Bi("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nuniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);\n#ifdef RENDER_LINE_BORDER_AUTO\nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}\n#else\nout_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);\n#endif\n}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:Bi("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:Bi("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:Bi("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:Bi("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:Bi("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:Bi("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=wireframeOffset;\n#endif\nv_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:Bi("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Bi("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",zc),skyboxGradient:Bi("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",zc),skyboxCapture:Bi("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Bi("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\ncolor=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:Bi("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function wd(g,c){const h=g.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let _ of h)if(_=_.trim(),"#"===_[0]&&_.includes("if")&&!_.includes("endif")){_=_.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const w=_.split(" ");for(const C of w)c.includes(C)||c.push(C)}}function Bi(g,c){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,_=c.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),w={},C=[...ri];return wd(g,C),wd(c,C),{fragmentSource:g=g.replace(h,(I,A,P,N,B)=>(w[B]=!0,"define"===A?`\n#ifndef HAS_UNIFORM_u_${B}\nvarying ${P} ${N} ${B};\n#else\nuniform ${P} ${N} u_${B};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${B}\n    ${P} ${N} ${B} = u_${B};\n#endif\n`)),vertexSource:c=c.replace(h,(I,A,P,N,B)=>{const $="float"===N?"vec2":"vec4",Q=B.match(/color/)?"color":$;return w[B]?"define"===A?`\n#ifndef HAS_UNIFORM_u_${B}\nuniform lowp float u_${B}_t;\nattribute ${P} ${$} a_${B};\nvarying ${P} ${N} ${B};\n#else\nuniform ${P} ${N} u_${B};\n#endif\n`:"vec4"===Q?`\n#ifndef HAS_UNIFORM_u_${B}\n    ${B} = a_${B};\n#else\n    ${P} ${N} ${B} = u_${B};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${B}\n    ${B} = unpack_mix_${Q}(a_${B}, u_${B}_t);\n#else\n    ${P} ${N} ${B} = u_${B};\n#endif\n`:"define"===A?`\n#ifndef HAS_UNIFORM_u_${B}\nuniform lowp float u_${B}_t;\nattribute ${P} ${$} a_${B};\n#else\nuniform ${P} ${N} u_${B};\n#endif\n`:"vec4"===Q?`\n#ifndef HAS_UNIFORM_u_${B}\n    ${P} ${N} ${B} = a_${B};\n#else\n    ${P} ${N} ${B} = u_${B};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${B}\n    ${P} ${N} ${B} = unpack_mix_${Q}(a_${B}, u_${B}_t);\n#else\n    ${P} ${N} ${B} = u_${B};\n#endif\n`}),staticAttributes:_,usedDefines:C}}class za{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(c,h,_,w,C,I,A){this.context=c;let P=this.boundPaintVertexBuffers.length!==w.length;for(let B=0;!P&&B<w.length;B++)this.boundPaintVertexBuffers[B]!==w[B]&&(P=!0);let N=this.boundDynamicVertexBuffers.length!==A.length;for(let B=0;!N&&B<A.length;B++)this.boundDynamicVertexBuffers[B]!==A[B]&&(N=!0);if(!c.extVertexArrayObject||!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==_||P||N||this.boundIndexBuffer!==C||this.boundVertexOffset!==I)this.freshBind(h,_,w,C,I,A);else{c.bindVertexArrayOES.set(this.vao);for(const B of A)B&&B.bind();C&&C.dynamicDraw&&C.bind()}}freshBind(c,h,_,w,C,I){let A;const P=c.numAttributes,N=this.context,B=N.gl;if(N.extVertexArrayObject)this.vao&&this.destroy(),this.vao=N.extVertexArrayObject.createVertexArrayOES(),N.bindVertexArrayOES.set(this.vao),A=0,this.boundProgram=c,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=w,this.boundVertexOffset=C,this.boundDynamicVertexBuffers=I;else{A=N.currentNumAttributes||0;for(let $=P;$<A;$++)B.disableVertexAttribArray($)}h.enableAttributes(B,c),h.bind(),h.setVertexAttribPointers(B,c,C);for(const $ of _)$.enableAttributes(B,c),$.bind(),$.setVertexAttribPointers(B,c,C);for(const $ of I)$&&($.enableAttributes(B,c),$.bind(),$.setVertexAttribPointers(B,c,C));w&&w.bind(),N.currentNumAttributes=P}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Vm(g,c){const h=Math.pow(2,c.canonical.z),_=c.canonical.y;return[new p.MercatorCoordinate(0,_/h).toLngLat().lat,new p.MercatorCoordinate(0,(_+1)/h).toLngLat().lat]}function r_(g,c,h,_,w,C,I){const A=g.context,P=A.gl,N=h.fbo;if(!N)return;g.prepareDrawTile();const B=g.useProgram("hillshade");A.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,N.colorAttachment.get());const $=((se,ce,q,ie)=>{const me=q.paint.get("hillshade-shadow-color"),be=q.paint.get("hillshade-highlight-color"),Le=q.paint.get("hillshade-accent-color");let Pe=q.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===q.paint.get("hillshade-illumination-anchor")&&(Pe-=se.transform.angle);const Oe=!se.options.moving;return{u_matrix:ie||se.transform.calculateProjMatrix(ce.tileID.toUnwrapped(),Oe),u_image:0,u_latrange:Vm(0,ce.tileID),u_light:[q.paint.get("hillshade-exaggeration"),Pe],u_shadow:me,u_highlight:be,u_accent:Le}})(g,h,_,g.terrain?c.projMatrix:null);g.prepareDrawProgram(A,B,c.toUnwrapped());const{tileBoundsBuffer:Q,tileBoundsIndexBuffer:re,tileBoundsSegments:ae}=g.getTileBoundsBuffers(h);B.draw(A,P.TRIANGLES,w,C,I,p.CullFaceMode.disabled,$,_.id,Q,re,ae)}function ca(g,c,h){if(!c.needsDEMTextureUpload)return;const _=g.context,w=_.gl;_.pixelStoreUnpackPremultiplyAlpha.set(!1),c.demTexture=c.demTexture||g.getTileTexture(h.stride);const C=h.getPixels();c.demTexture?c.demTexture.update(C,{premultiply:!1}):c.demTexture=new p.Texture(_,C,w.RGBA,{premultiply:!1}),c.needsDEMTextureUpload=!1}function qr(g,c,h,_,w,C){const I=g.context,A=I.gl;if(!c.dem)return;const P=c.dem;if(I.activeTexture.set(A.TEXTURE1),ca(g,c,P),!c.demTexture)return;c.demTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE);const N=P.dim;I.activeTexture.set(A.TEXTURE0);let B=c.fbo;if(!B){const ae=new p.Texture(I,{width:N,height:N,data:null},A.RGBA);ae.bind(A.LINEAR,A.CLAMP_TO_EDGE),B=c.fbo=I.createFramebuffer(N,N,!0),B.colorAttachment.set(ae.texture)}I.bindFramebuffer.set(B.framebuffer),I.viewport.set([0,0,N,N]);const{tileBoundsBuffer:$,tileBoundsIndexBuffer:Q,tileBoundsSegments:re}=g.getMercatorTileBoundsBuffers();g.useProgram("hillshadePrepare").draw(I,A.TRIANGLES,_,w,C,p.CullFaceMode.disabled,((ae,se)=>{const ce=se.stride,q=p.create();return p.ortho(q,0,p.EXTENT,-p.EXTENT,0,0,1),p.translate(q,q,[0,-p.EXTENT,0]),{u_matrix:q,u_image:1,u_dimension:[ce,ce],u_zoom:ae.overscaledZ,u_unpack:se.unpackVector}})(c.tileID,P),h.id,$,Q,re),c.needsHillshadePrepare=!1}const jm=g=>({u_matrix:new p.UniformMatrix4f(g),u_image0:new p.Uniform1i(g),u_skirt_height:new p.Uniform1f(g)}),Sd=(g,c)=>({u_matrix:g,u_image0:0,u_skirt_height:c}),Rl=(g,c,h,_,w,C,I,A,P,N,B,$,Q,re,ae)=>({u_proj_matrix:Float32Array.from(g),u_globe_matrix:c,u_normalize_matrix:Float32Array.from(_),u_merc_matrix:h,u_zoom_transition:w,u_merc_center:C,u_image0:0,u_frustum_tl:I,u_frustum_tr:A,u_frustum_br:P,u_frustum_bl:N,u_globe_pos:B,u_globe_radius:$,u_viewport:Q,u_grid_matrix:ae?Float32Array.from(ae):new Float32Array(9),u_skirt_height:re});function Ji(g,c){return null!=g&&null!=c&&!(!g.hasData()||!c.hasData())&&null!=g.demTexture&&null!=c.demTexture&&g.tileID.key!==c.tileID.key}const Ea=new class{constructor(){this.operations={}}newMorphing(g,c,h,_,w){if(g in this.operations){const C=this.operations[g];C.to.tileID.key!==h.tileID.key&&(C.queued=h)}else this.operations[g]={startTime:_,phase:0,duration:w,from:c,to:h,queued:null}}getMorphValuesForProxy(g){if(!(g in this.operations))return null;const c=this.operations[g];return{from:c.from,to:c.to,phase:c.phase}}update(g){for(const c in this.operations){const h=this.operations[c];for(h.phase=(g-h.startTime)/h.duration;h.phase>=1||!this._validOp(h);)if(!this._nextOp(h,g)){delete this.operations[c];break}}}_nextOp(g,c){return!!g.queued&&(g.from=g.to,g.to=g.queued,g.queued=null,g.phase=0,g.startTime=c,!0)}_validOp(g){return g.from.hasData()&&g.to.hasData()}},Pl={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function wu(g){return 6*Math.pow(1.5,22-g)}function Yp(g,c){const h=1<<g.z;return!c&&(0===g.x||g.x===h-1)||0===g.y||g.y===h-1}const ua=g=>({u_matrix:g});function Vc(g,c,h,_,w){if(w>0){const C=p.exported.now(),I=(C-g.timeAdded)/w,A=c?(C-c.timeAdded)/w:-1,P=h.getSource(),N=_.coveringZoomLevel({tileSize:P.tileSize,roundZoom:P.roundZoom}),B=!c||Math.abs(c.tileID.overscaledZ-N)>Math.abs(g.tileID.overscaledZ-N),$=B&&g.refreshedUponExpiration?1:p.clamp(B?I:1-A,0,1);return g.refreshedUponExpiration&&I>=1&&(g.refreshedUponExpiration=!1),c?{opacity:1,mix:1-$}:{opacity:$,mix:0}}return{opacity:1,mix:0}}class Kp extends p.SourceCache{constructor(c){const h={type:"raster-dem",maxzoom:c.transform.maxZoom},_=new Mt(br(),null),w=pi("mock-dem",h,_,c.style);super("mock-dem",w,!1),w.setEventedParent(this),this._sourceLoaded=!0}_loadTile(c,h){c.state="loaded",h(null)}}class On extends p.SourceCache{constructor(c){const h=pi("proxy",{type:"geojson",maxzoom:c.transform.maxZoom},new Mt(br(),null),c.style);super("proxy",h,!1),h.setEventedParent(this),this.map=this.getSource().map=c,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(c,h,_){if(c.freezeTileCoverage)return;this.transform=c;const w=c.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((C,I)=>{if(C[I.key]="",!this._tiles[I.key]){const A=new p.Tile(I,this._source.tileSize*I.overscaleFactor(),c.tileZoom);A.state="loaded",this._tiles[I.key]=A}return C},{});for(const C in this._tiles)C in w||(this.freeFBO(C),this._tiles[C].unloadVectorData(),delete this._tiles[C])}freeFBO(c){const h=this.proxyCachedFBO[c];if(void 0!==h){const _=Object.values(h);this.renderCachePool.push(..._),delete this.proxyCachedFBO[c]}}deallocRenderCache(){this.renderCache.forEach(c=>c.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Rh extends p.OverscaledTileID{constructor(c,h,_){super(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,c.canonical.y),this.proxyTileKey=h,this.projMatrix=_}}class Ph extends p.Elevation{constructor(c,h){super(),this.painter=c,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[_,w,C]=function(P){const N=new p.StructArrayLayout2i4,B=new p.StructArrayLayout3ui6,$=131;N.reserve(17161),B.reserve(33800);const Q=p.EXTENT/128,re=p.EXTENT+Q/2,ae=re+Q;for(let ce=-Q;ce<ae;ce+=Q)for(let q=-Q;q<ae;q+=Q){const ie=q<0||q>re||ce<0||ce>re?24575:0,me=p.clamp(Math.round(q),0,p.EXTENT),be=p.clamp(Math.round(ce),0,p.EXTENT);N.emplaceBack(me+ie,be)}const se=(ce,q)=>{const ie=q*$+ce;B.emplaceBack(ie+1,ie,ie+$),B.emplaceBack(ie+$,ie+$+1,ie+1)};for(let ce=1;ce<129;ce++)for(let q=1;q<129;q++)se(q,ce);return[0,129].forEach(ce=>{for(let q=0;q<130;q++)se(q,ce),se(ce,q)}),[N,B,32768]}(),I=c.context;this.gridBuffer=I.createVertexBuffer(_,p.posAttributes.members),this.gridIndexBuffer=I.createIndexBuffer(w),this.gridSegments=p.SegmentVector.simpleSegment(0,0,_.length,w.length),this.gridNoSkirtSegments=p.SegmentVector.simpleSegment(0,0,_.length,C),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new On(h.map),this.orthoMatrix=p.create(),p.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,p.EXTENT,0,p.EXTENT,0,1);const A=I.gl;this._overlapStencilMode=new p.StencilMode({func:A.GEQUAL,mask:255},0,255,A.KEEP,A.KEEP,A.REPLACE),this._previousZoom=c.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=h,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Kp(h.map)}set style(c){c.on("data",this._onStyleDataEvent.bind(this)),c.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=c,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(c,h,_){if(c&&c.terrain){this._style!==c&&(this.style=c),this.enabled=!0;const w=c.terrain.properties;this.sourceCache=0===c.terrain.drapeRenderMode?this._mockSourceCache:c._getSourceCache(w.get("source")),this._exaggeration=w.get("exaggeration");const C=()=>{this.sourceCache.used&&p.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const I=this.getScaledDemTileSize();this.sourceCache.update(h,I,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,C(),this._initializing=!0),C(),h.updateElevation(!0,_),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(h),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(c){this._findCoveringTileCache[c]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const c=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==c.efficiency&&p.warnOnce(`Terrain render cache efficiency is not optimal (${c.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${c.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(c){c.coord&&"source"===c.dataType?this._clearRenderCacheForTile(c.sourceCacheId,c.coord):"style"===c.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const c in this._style._sourceCaches)this._style._sourceCaches[c].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(c=>c.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const c=2*this.proxySourceCache.getSource().tileSize;return[c,c]}set useVertexMorphing(c){this._useVertexMorphing=c}updateTileBinding(c){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const h=this.proxySourceCache,_=this.painter.transform;this._initializing&&(this._initializing=0===_._centerAltitude&&-1===this.getAtPointOrZero(p.MercatorCoordinate.fromLngLat(_.center),-1),this._emptyDEMTextureDirty=!this._initializing);const w=this.proxyCoords=h.getIds().map(P=>{const N=h.getTileByID(P).tileID;return N.projMatrix=_.calculateProjMatrix(N.toUnwrapped()),N});(function(P,N){const B=N.transform.pointCoordinate(N.transform.getCameraPoint()),$=new p.Point(B.x,B.y);P.sort((Q,re)=>{if(re.overscaledZ-Q.overscaledZ)return re.overscaledZ-Q.overscaledZ;const ae=new p.Point(Q.canonical.x+(1<<Q.canonical.z)*Q.wrap,Q.canonical.y),se=new p.Point(re.canonical.x+(1<<re.canonical.z)*re.wrap,re.canonical.y),ce=$.mult(1<<Q.canonical.z);return ce.x-=.5,ce.y-=.5,ce.distSqr(ae)-ce.distSqr(se)})})(w,this.painter),this._previousZoom=_.zoom;const C=this.proxyToSource||{};this.proxyToSource={},w.forEach(P=>{this.proxyToSource[P.key]={}}),this.terrainTileForTile={};const I=this._style._sourceCaches;for(const P in I){const N=I[P];if(!N.used||(N!==this.sourceCache&&this.resetTileLookupCache(N.id),this._setupProxiedCoordsForOrtho(N,c[P],C),N.usedForTerrain))continue;const B=c[P];N.getSource().reparseOverscaled&&this._assignTerrainTiles(B)}this.proxiedCoords[h.id]=w.map(P=>new Rh(P,P.key,this.orthoMatrix)),this._assignTerrainTiles(w),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(C),this.renderingToTexture=!1,this._updateTimestamp=p.exported.now();const A={};this._visibleDemTiles=[];for(const P of this.proxyCoords){const N=this.terrainTileForTile[P.key];if(!N)continue;const B=N.tileID.key;B in A||(this._visibleDemTiles.push(N),A[B]=B)}}_assignTerrainTiles(c){this._initializing||c.forEach(h=>{if(this.terrainTileForTile[h.key])return;const _=this._findTileCoveringTileID(h,this.sourceCache);_&&(this.terrainTileForTile[h.key]=_)})}_prepareDEMTextures(){const c=this.painter.context,h=c.gl;for(const _ in this.terrainTileForTile){const w=this.terrainTileForTile[_],C=w.dem;!C||w.demTexture&&!w.needsDEMTextureUpload||(c.activeTexture.set(h.TEXTURE1),ca(this.painter,w,C))}}_prepareDemTileUniforms(c,h,_,w){if(!h||null==h.demTexture)return!1;const C=c.tileID.canonical,I=Math.pow(2,h.tileID.canonical.z-C.z),A=w||"";return _[`u_dem_tl${A}`]=[C.x*I%1,C.y*I%1],_[`u_dem_scale${A}`]=I,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const c=this.painter.context,h=c.gl;if(!this._emptyDepthBufferTexture){const _=new p.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new p.Texture(c,_,h.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let c=0;const h=this._visibleDemTiles.reduce((_,w)=>{if(!w.dem)return _;const C=w.dem.tree.minimums[0];return C>0&&c++,_+C},0);return c?h/c:0}_updateEmptyDEMTexture(){const c=this.painter.context,h=c.gl;c.activeTexture.set(h.TEXTURE2);const _=this._getLoadedAreaMinimum(),w=new p.RGBAImage({width:1,height:1},new Uint8Array(p.DEMData.pack(_,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let C=this._emptyDEMTexture;return C?C.update(w,{premultiply:!1}):C=this._emptyDEMTexture=new p.Texture(c,w,h.RGBA,{premultiply:!1}),C}setupElevationDraw(c,h,_){const w=this.painter.context,C=w.gl,I=(A=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:p.DEMData.getUnpackVector(A),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var A;I.u_dem_size=this.sourceCache.getSource().tileSize,I.u_exaggeration=this.exaggeration();let P=null,N=null,B=1;if(_&&_.morphing&&this._useVertexMorphing){const $=_.morphing.srcDemTile,Q=_.morphing.dstDemTile;B=_.morphing.phase,$&&Q&&(this._prepareDemTileUniforms(c,$,I,"_prev")&&(N=$),this._prepareDemTileUniforms(c,Q,I)&&(P=Q))}if(N&&P?(w.activeTexture.set(C.TEXTURE2),P.demTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE,C.NEAREST),w.activeTexture.set(C.TEXTURE4),N.demTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE,C.NEAREST),I.u_dem_lerp=B):(P=this.terrainTileForTile[c.tileID.key],w.activeTexture.set(C.TEXTURE2),(this._prepareDemTileUniforms(c,P,I)?P.demTexture:this.emptyDEMTexture).bind(C.NEAREST,C.CLAMP_TO_EDGE)),w.activeTexture.set(C.TEXTURE3),_&&_.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE),this._depthFBO&&(I.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE),I.u_depth_size_inv=[1,1]),_&&_.useMeterToDem&&P){const $=(1<<P.tileID.canonical.z)*p.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;I.u_meter_to_dem=$}if(_&&_.labelPlaneMatrixInv&&(I.u_label_plane_matrix_inv=_.labelPlaneMatrixInv),h.setTerrainUniformValues(w,I),"globe"===this.painter.transform.projection.name){const $=this.globeUniformValues(this.painter.transform,c.tileID.canonical,_&&_.useDenormalizedUpVectorScale);h.setGlobeUniformValues(w,$)}}globeUniformValues(c,h,_){const w=c.projection;return{u_tile_tl_up:w.upVector(h,0,0),u_tile_tr_up:w.upVector(h,p.EXTENT,0),u_tile_br_up:w.upVector(h,p.EXTENT,p.EXTENT),u_tile_bl_up:w.upVector(h,0,p.EXTENT),u_tile_up_scale:_?p.globeMetersToEcef(1):w.upVectorScale(h,c.center.lat,c.worldSize).metersToTile}}renderToBackBuffer(c){const h=this.painter,_=this.painter.context;0!==c.length&&(_.bindFramebuffer.set(null),_.viewport.set([0,0,h.width,h.height]),h.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(w,C,I,A,P){if("globe"===w.transform.projection.name)!function(N,B,$,Q,re){const ae=N.context,se=ae.gl;let ce,q;const ie=N.options.showTerrainWireframe?2:0,me=N.transform,be=p.globeUseCustomAntiAliasing(N,ae,me),Le=(Vt,ot)=>{if(q===Vt)return;const wt=[Pl[Vt],"PROJECTION_GLOBE_VIEW"];be&&wt.push("CUSTOM_ANTIALIASING"),ot&&wt.push(Pl[ie]),ce=N.useProgram("globeRaster",null,wt),q=Vt},Pe=N.colorModeForRenderPass(),Oe=new p.DepthMode(se.LEQUAL,p.DepthMode.ReadWrite,N.depthRangeFor3D);Ea.update(re);const Ke=p.calculateGlobeMercatorMatrix(me),We=[p.mercatorXfromLng(me.center.lng),p.mercatorYfromLat(me.center.lat)],at=ie?[!1,!0]:[!1],zt=N.globeSharedBuffers,it=[me.width*p.exported.devicePixelRatio,me.height*p.exported.devicePixelRatio],Tt=Float32Array.from(me.globeMatrix),ht={useDenormalizedUpVectorScale:!0};if(at.forEach(Vt=>{const ot=N.transform,wt=wu(ot.zoom)*B.exaggeration();q=-1;const Ut=Vt?se.LINES:se.TRIANGLES;for(const At of Q){const qt=$.getTile(At),Un=p.StencilMode.disabled,ti=B.prevTerrainTileForTile[At.key],An=B.terrainTileForTile[At.key];Ji(ti,An)&&Ea.newMorphing(At.key,ti,An,re,250),ae.activeTexture.set(se.TEXTURE0),qt.texture.bind(se.LINEAR,se.CLAMP_TO_EDGE);const Hn=Ea.getMorphValuesForProxy(At.key),Ai=Hn?1:0;Hn&&p.extend$1(ht,{morphing:{srcDemTile:Hn.from,dstDemTile:Hn.to,phase:p.easeCubicInOut(Hn.phase)}});const wi=p.tileCornersToBounds(At.canonical),Vn=p.getLatitudinalLod(wi.getCenter().lat),ur=p.getGridMatrix(At.canonical,wi,Vn,ot.worldSize/ot._pixelsPerMercatorPixel),wr=p.globeNormalizeECEF(p.globeTileBounds(At.canonical)),Dr=Rl(ot.projMatrix,Tt,Ke,wr,p.globeToMercatorTransition(ot.zoom),We,ot.frustumCorners.TL,ot.frustumCorners.TR,ot.frustumCorners.BR,ot.frustumCorners.BL,ot.globeCenterInViewSpace,ot.globeRadius,it,wt,ur);if(Le(Ai,Vt),B.setupElevationDraw(qt,ce,ht),N.prepareDrawProgram(ae,ce,At.toUnwrapped()),zt){const[ji,xs,_o]=Vt?zt.getWirefameBuffers(N.context,Vn):zt.getGridBuffers(Vn,0!==wt);ce.draw(ae,Ut,Oe,Un,Pe,p.CullFaceMode.backCCW,Dr,"globe_raster",ji,xs,_o)}}}),zt){const Vt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];be&&Vt.push("CUSTOM_ANTIALIASING"),ce=N.useProgram("globeRaster",null,Vt);for(const ot of Q){const{x:wt,y:Ut,z:At}=ot.canonical,qt=0===Ut,Un=Ut===(1<<At)-1,[ti,An,Hn,Ai]=zt.getPoleBuffers(At);if(Ai&&(qt||Un)){const wi=$.getTile(ot);ae.activeTexture.set(se.TEXTURE0),wi.texture.bind(se.LINEAR,se.CLAMP_TO_EDGE);let Vn=p.globePoleMatrixForTile(At,wt,me);const ur=p.globeNormalizeECEF(p.globeTileBounds(ot.canonical)),wr=(Dr,ji)=>Dr.draw(ae,se.TRIANGLES,Oe,p.StencilMode.disabled,Pe,p.CullFaceMode.disabled,Rl(me.projMatrix,Vn,Vn,ur,0,We,me.frustumCorners.TL,me.frustumCorners.TR,me.frustumCorners.BR,me.frustumCorners.BL,me.globeCenterInViewSpace,me.globeRadius,it,0),"globe_pole_raster",ji,Hn,Ai);B.setupElevationDraw(wi,ce,ht),N.prepareDrawProgram(ae,ce,ot.toUnwrapped()),qt&&wr(ce,ti),Un&&(Vn=p.scale(p.create(),Vn,[1,-1,1]),wr(ce,An))}}}}(w,C,I,A,P);else{const N=w.context,B=N.gl;let $,Q;const re=w.options.showTerrainWireframe?2:0,ae=(me,be)=>{if(Q===me)return;const Le=[Pl[me]];be&&Le.push(Pl[re]),$=w.useProgram("terrainRaster",null,Le),Q=me},se=w.colorModeForRenderPass(),ce=new p.DepthMode(B.LEQUAL,p.DepthMode.ReadWrite,w.depthRangeFor3D);Ea.update(P);const q=w.transform,ie=wu(q.zoom)*C.exaggeration();(re?[!1,!0]:[!1]).forEach(me=>{Q=-1;const be=me?B.LINES:B.TRIANGLES,[Le,Pe]=me?C.getWirefameBuffer():[C.gridIndexBuffer,C.gridSegments];for(const Oe of A){const Ke=I.getTile(Oe),We=p.StencilMode.disabled,at=C.prevTerrainTileForTile[Oe.key],zt=C.terrainTileForTile[Oe.key];Ji(at,zt)&&Ea.newMorphing(Oe.key,at,zt,P,250),N.activeTexture.set(B.TEXTURE0),Ke.texture.bind(B.LINEAR,B.CLAMP_TO_EDGE,B.LINEAR_MIPMAP_NEAREST);const it=Ea.getMorphValuesForProxy(Oe.key),Tt=it?1:0;let ht;it&&(ht={morphing:{srcDemTile:it.from,dstDemTile:it.to,phase:p.easeCubicInOut(it.phase)}});const Vt=Sd(Oe.projMatrix,Yp(Oe.canonical,q.renderWorldCopies)?ie/10:ie);ae(Tt,me),C.setupElevationDraw(Ke,$,ht),w.prepareDrawProgram(N,$,Oe.toUnwrapped()),$.draw(N,be,ce,We,se,p.CullFaceMode.backCCW,Vt,"terrain_raster",C.gridBuffer,Le,Pe)}})}}(h,this,this.proxySourceCache,c,this._updateTimestamp),this.renderingToTexture=!0,h.gpuTimingDeferredRenderEnd(),c.splice(0,c.length))}renderBatch(c){if(0===this._drapedRenderBatches.length)return c+1;this.renderingToTexture=!0;const h=this.painter,_=this.painter.context,w=this.proxySourceCache,C=this.proxiedCoords[w.id],I=this._drapedRenderBatches.shift(),A=[],P=h.style.order;let N=0;for(const B of C){const $=w.getTileByID(B.proxyTileKey),Q=w.proxyCachedFBO[B.key]?w.proxyCachedFBO[B.key][c]:void 0,re=void 0!==Q?w.renderCache[Q]:this.pool[N++],ae=void 0!==Q;if($.texture=re.tex,ae&&!re.dirty){A.push($.tileID);continue}let se;_.bindFramebuffer.set(re.fb.framebuffer),this.renderedToTile=!1,re.dirty&&(_.clear({color:p.Color.transparent,stencil:0}),re.dirty=!1);for(let ce=I.start;ce<=I.end;++ce){const q=h.style._layers[P[ce]];if(q.isHidden(h.transform.zoom))continue;const ie=h.style._getLayerSourceCache(q),me=ie?this.proxyToSource[B.key][ie.id]:[B];if(!me)continue;const be=me;_.viewport.set([0,0,re.fb.width,re.fb.height]),se!==(ie?ie.id:null)&&(this._setupStencil(re,me,q,ie),se=ie?ie.id:null),h.renderLayer(h,ie,q,be)}this.renderedToTile?(re.dirty=!0,A.push($.tileID)):ae||--N,5===N&&(N=0,this.renderToBackBuffer(A))}return this.renderToBackBuffer(A),this.renderingToTexture=!1,_.bindFramebuffer.set(null),_.viewport.set([0,0,h.width,h.height]),I.end+1}postRender(){}renderCacheEfficiency(c){const h=c.order.length;if(0===h)return{efficiency:100};let _,w=0,C=0,I=!1;for(let A=0;A<h;++A){const P=c._layers[c.order[A]];this._style.isLayerDraped(P)?(I&&++w,++C):I||(I=!0,_=P.id)}return 0===C?{efficiency:100}:{efficiency:100*(1-w/C),firstUndrapedLayer:_}}getMinElevationBelowMSL(){let c=0;return this._visibleDemTiles.filter(h=>h.dem).forEach(h=>{c=Math.min(c,h.dem.tree.minimums[0])}),0===c?c:(c-30)*this._exaggeration}raycast(c,h,_){if(!this._visibleDemTiles)return null;const w=this._visibleDemTiles.filter(C=>C.dem).map(C=>{const I=C.tileID,A=1<<I.overscaledZ,{x:P,y:N}=I.canonical,B=P/A,$=(P+1)/A,Q=N/A,re=(N+1)/A;return{minx:B,miny:Q,maxx:$,maxy:re,t:C.dem.tree.raycastRoot(B,Q,$,re,c,h,_),tile:C}});w.sort((C,I)=>(null!==C.t?C.t:Number.MAX_VALUE)-(null!==I.t?I.t:Number.MAX_VALUE));for(const C of w){if(null==C.t)return null;const I=C.tile.dem.tree.raycast(C.minx,C.miny,C.maxx,C.maxy,c,h,_);if(null!=I)return I}return null}_createFBO(){const c=this.painter.context,h=c.gl,_=this.drapeBufferSize;c.activeTexture.set(h.TEXTURE0);const w=new p.Texture(c,{width:_[0],height:_[1],data:null},h.RGBA);w.bind(h.LINEAR,h.CLAMP_TO_EDGE);const C=c.createFramebuffer(_[0],_[1],!1);return C.colorAttachment.set(w.texture),C.depthAttachment=new Re(c,C.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=c.createRenderbuffer(c.gl.DEPTH_STENCIL,_[0],_[1]),this._stencilRef=0,C.depthAttachment.set(this._sharedDepthStencil),c.clear({stencil:0})):C.depthAttachment.set(this._sharedDepthStencil),c.extTextureFilterAnisotropic&&!c.extTextureFilterAnisotropicForceOff&&h.texParameterf(h.TEXTURE_2D,c.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c.extTextureFilterAnisotropicMax),{fb:C,tex:w,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const c in this._style._sourceCaches)if(this._style._sourceCaches[c].hasTransition())return!0;return this._style.order.some(c=>{const h=this._style._layers[c],_=h.isHidden(this.painter.transform.zoom);return"custom"===h.type?!_&&h.shouldRedrape():!_&&h.hasTransition()})}_clearLineLayersFromRenderCache(){let c=!1;for(const _ of this._style._getSources())if(_ instanceof Xt){c=!0;break}if(!c)return;const h={};for(let _=0;_<this._style.order.length;++_){const w=this._style._layers[this._style.order[_]],C=this._style._getLayerSourceCache(w);if(C&&!h[C.id]&&!w.isHidden(this.painter.transform.zoom)&&"line"===w.type&&w.widthExpression()instanceof p.ZoomDependentExpression){h[C.id]=!0;for(const I of this.proxyCoords){const A=this.proxyToSource[I.key][C.id];if(A)for(const P of A)this._clearRenderCacheForTile(C.id,P)}}}}_clearRasterLayersFromRenderCache(){let c=!1;for(const _ in this._style._sourceCaches)if(this._style._sourceCaches[_]._source instanceof Bt){c=!0;break}if(!c)return;const h={};for(let _=0;_<this._style.order.length;++_){const w=this._style._layers[this._style.order[_]],C=this._style._getLayerSourceCache(w);if(!C||h[C.id]||w.isHidden(this.painter.transform.zoom)||"raster"!==w.type)continue;const I=w.paint.get("raster-fade-duration");for(const A of this.proxyCoords){const P=this.proxyToSource[A.key][C.id];if(P)for(const N of P){const B=Vc(C.getTile(N),C.findLoadedParent(N,0),C,this.painter.transform,I);(1!==B.opacity||0!==B.mix)&&this._clearRenderCacheForTile(C.id,N)}}}}_setupDrapedRenderBatches(){const c=this._style.order,h=c.length;if(0===h)return;const _=[];let w,C=0,I=this._style._layers[c[C]];for(;!this._style.isLayerDraped(I)&&I.isHidden(this.painter.transform.zoom)&&++C<h;)I=this._style._layers[c[C]];for(;C<h;++C){const A=this._style._layers[c[C]];A.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(A)?void 0===w&&(w=C):void 0!==w&&(_.push({start:w,end:C-1}),w=void 0))}void 0!==w&&_.push({start:w,end:C-1}),this._drapedRenderBatches=_}_setupRenderCache(c){const h=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,h.renderCache.length>h.renderCachePool.length){const I=Object.values(h.proxyCachedFBO);h.proxyCachedFBO={};for(let A=0;A<I.length;++A){const P=Object.values(I[A]);h.renderCachePool.push(...P)}}return}this._clearRasterLayersFromRenderCache();const _=this.proxyCoords,w=this._tilesDirty;for(let I=_.length-1;I>=0;I--){const A=_[I];if(h.getTileByID(A.key),void 0!==h.proxyCachedFBO[A.key]){const P=c[A.key],N=this.proxyToSource[A.key];let B=0;for(const $ in N){const Q=N[$],re=P[$];if(!re||re.length!==Q.length||Q.some((ae,se)=>ae!==re[se]||w[$]&&w[$].hasOwnProperty(ae.key))){B=-1;break}++B}for(const $ in h.proxyCachedFBO[A.key])h.renderCache[h.proxyCachedFBO[A.key][$]].dirty=B<0||B!==Object.values(P).length}}const C=[...this._drapedRenderBatches];C.sort((I,A)=>A.end-A.start-(I.end-I.start));for(const I of C)for(const A of _){if(h.proxyCachedFBO[A.key])continue;let P=h.renderCachePool.pop();void 0===P&&h.renderCache.length<50&&(P=h.renderCache.length,h.renderCache.push(this._createFBO())),void 0!==P&&(h.proxyCachedFBO[A.key]={},h.proxyCachedFBO[A.key][I.start]=P,h.renderCache[P].dirty=!0)}this._tilesDirty={}}_setupStencil(c,h,_,w){if(!w||!this._sourceTilesOverlap[w.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const C=this.painter.context,I=C.gl;if(h.length<=1)return void(this._overlapStencilType=!1);let A;if(_.isTileClipped())A=h.length,this._overlapStencilMode.test={func:I.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(h[0].overscaledZ>h[h.length-1].overscaledZ))return void(this._overlapStencilType=!1);A=1,this._overlapStencilMode.test={func:I.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+A>255&&(C.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=A,this._overlapStencilMode.ref=this._stencilRef,_.isTileClipped()&&this._renderTileClippingMasks(h,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(c){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[c.key]),this._overlapStencilMode):p.StencilMode.disabled}_renderTileClippingMasks(c,h){const _=this.painter,w=this.painter.context,C=w.gl;_._tileClippingMaskIDs={},w.setColorMode(p.ColorMode.disabled),w.setDepthMode(p.DepthMode.disabled);const I=_.useProgram("clippingMask");for(const A of c){const P=_._tileClippingMaskIDs[A.key]=--h;I.draw(w,C.TRIANGLES,p.DepthMode.disabled,new p.StencilMode({func:C.ALWAYS,mask:0},P,255,C.KEEP,C.KEEP,C.REPLACE),p.ColorMode.disabled,p.CullFaceMode.disabled,ua(A.projMatrix),"$clipping",_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}}pointCoordinate(c){const h=this.painter.transform;if(c.x<0||c.x>h.width||c.y<0||c.y>h.height)return null;const _=[c.x,c.y,1,1];p.transformMat4$1(_,_,h.pixelMatrixInverse),p.scale$1(_,_,1/_[3]),_[0]/=h.worldSize,_[1]/=h.worldSize;const w=h._camera.position,C=p.mercatorZfromAltitude(1,h.center.lat),I=[w[0],w[1],w[2]/C,0],A=p.subtract([],_.slice(0,3),I);p.normalize(A,A);const P=this.raycast(I,A,this._exaggeration);return null!==P&&P?(p.scaleAndAdd(I,I,A,P),I[3]=I[2],I[2]*=C,I):null}drawDepth(){const c=this.painter,h=c.context,_=this.proxySourceCache,w=Math.ceil(c.width),C=Math.ceil(c.height);if(!this._depthFBO||this._depthFBO.width===w&&this._depthFBO.height===C||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const I=h.gl,A=h.createFramebuffer(w,C,!0);h.activeTexture.set(I.TEXTURE0);const P=new p.Texture(h,{width:w,height:C,data:null},I.RGBA);P.bind(I.NEAREST,I.CLAMP_TO_EDGE),A.colorAttachment.set(P.texture);const N=h.createRenderbuffer(h.gl.DEPTH_COMPONENT16,w,C);A.depthAttachment.set(N),this._depthFBO=A,this._depthTexture=P}h.bindFramebuffer.set(this._depthFBO.framebuffer),h.viewport.set([0,0,w,C]),function(I,A,P,N){if("globe"===I.transform.projection.name)return;const B=I.context,$=B.gl;B.clear({depth:1});const Q=I.useProgram("terrainDepth"),re=new p.DepthMode($.LESS,p.DepthMode.ReadWrite,I.depthRangeFor3D);for(const ae of N){const se=P.getTile(ae),ce=Sd(ae.projMatrix,0);A.setupElevationDraw(se,Q),Q.draw(B,$.TRIANGLES,re,p.StencilMode.disabled,p.ColorMode.unblended,p.CullFaceMode.backCCW,ce,"terrain_depth",A.gridBuffer,A.gridIndexBuffer,A.gridNoSkirtSegments)}}(c,this,_,this.proxyCoords)}_setupProxiedCoordsForOrtho(c,h,_){if(c.getSource()instanceof ai)return this._setupProxiedCoordsForImageSource(c,h,_);this._findCoveringTileCache[c.id]=this._findCoveringTileCache[c.id]||{};const w=this.proxiedCoords[c.id]=[],C=this.proxyCoords;for(let A=0;A<C.length;A++){const P=C[A],N=this._findTileCoveringTileID(P,c);if(N){const B=this._createProxiedId(P,N,_[P.key]&&_[P.key][c.id]);w.push(B),this.proxyToSource[P.key][c.id]=[B]}}let I=!1;for(let A=0;A<h.length;A++){const P=c.getTile(h[A]);if(!P||!P.hasData())continue;const N=this._findTileCoveringTileID(P.tileID,this.proxySourceCache);if(N&&N.tileID.canonical.z!==P.tileID.canonical.z){const B=this.proxyToSource[N.tileID.key][c.id],$=this._createProxiedId(N.tileID,P,_[N.tileID.key]&&_[N.tileID.key][c.id]);B?B.splice(B.length-1,0,$):this.proxyToSource[N.tileID.key][c.id]=[$],w.push($),I=!0}}this._sourceTilesOverlap[c.id]=I}_setupProxiedCoordsForImageSource(c,h,_){if(!c.getSource().loaded())return;const w=this.proxiedCoords[c.id]=[],C=this.proxyCoords,I=c.getSource(),A=new p.Point(I.tileID.x,I.tileID.y)._div(1<<I.tileID.z),P=I.coordinates.map(p.MercatorCoordinate.fromLngLat).reduce((B,$)=>(B.min.x=Math.min(B.min.x,$.x-A.x),B.min.y=Math.min(B.min.y,$.y-A.y),B.max.x=Math.max(B.max.x,$.x-A.x),B.max.y=Math.max(B.max.y,$.y-A.y),B),{min:new p.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new p.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),N=(B,$)=>{const Q=B.wrap+B.canonical.x/(1<<B.canonical.z),re=B.canonical.y/(1<<B.canonical.z),ae=p.EXTENT/(1<<B.canonical.z),se=$.wrap+$.canonical.x/(1<<$.canonical.z),ce=$.canonical.y/(1<<$.canonical.z);return Q+ae<se+P.min.x||Q>se+P.max.x||re+ae<ce+P.min.y||re>ce+P.max.y};for(let B=0;B<C.length;B++){const $=C[B];for(let Q=0;Q<h.length;Q++){const re=c.getTile(h[Q]);if(!re||!re.hasData()||N($,re.tileID))continue;const ae=this._createProxiedId($,re,_[$.key]&&_[$.key][c.id]),se=this.proxyToSource[$.key][c.id];se?se.push(ae):this.proxyToSource[$.key][c.id]=[ae],w.push(ae)}}}_createProxiedId(c,h,_){let w=this.orthoMatrix;if(_){const C=_.find(I=>I.key===h.tileID.key);if(C)return C}if(h.tileID.key!==c.key){const C=c.canonical.z-h.tileID.canonical.z;let I,A,P;w=p.create();const N=h.tileID.wrap-c.wrap<<c.overscaledZ;C>0?(I=p.EXTENT>>C,A=I*((h.tileID.canonical.x<<C)-c.canonical.x+N),P=I*((h.tileID.canonical.y<<C)-c.canonical.y)):(I=p.EXTENT<<-C,A=p.EXTENT*(h.tileID.canonical.x-(c.canonical.x+N<<-C)),P=p.EXTENT*(h.tileID.canonical.y-(c.canonical.y<<-C))),p.ortho(w,0,I,0,I,0,1),p.translate(w,w,[A,P,0])}return new Rh(h.tileID,c.key,w)}_findTileCoveringTileID(c,h){let _=h.getTile(c);if(_&&_.hasData())return _;const w=this._findCoveringTileCache[h.id],C=w[c.key];if(_=C?h.getTileByID(C):null,_&&_.hasData()||null===C)return _;let I=_?_.tileID:c,A=I.overscaledZ;const P=h.getSource().minzoom,N=[];if(!C){const $=h.getSource().maxzoom;if(c.canonical.z>=$){const Q=c.canonical.z-$;h.getSource().reparseOverscaled?(A=Math.max(c.canonical.z+2,h.transform.tileZoom),I=new p.OverscaledTileID(A,c.wrap,$,c.canonical.x>>Q,c.canonical.y>>Q)):0!==Q&&(A=$,I=new p.OverscaledTileID(A,c.wrap,$,c.canonical.x>>Q,c.canonical.y>>Q))}I.key!==c.key&&(N.push(I.key),_=h.getTile(I))}const B=$=>{N.forEach(Q=>{w[Q]=$}),N.length=0};for(A-=1;A>=P&&(!_||!_.hasData());A--){_&&B(_.tileID.key);const $=I.calculateScaledKey(A);if(_=h.getTileByID($),_&&_.hasData())break;const Q=w[$];if(null===Q)break;void 0===Q?N.push($):_=h.getTileByID(Q)}return B(_?_.tileID.key:null),_&&_.hasData()?_:null}findDEMTileFor(c){return this.enabled?this._findTileCoveringTileID(c,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(c,h){let _=this._tilesDirty[c];_||(_=this._tilesDirty[c]={}),_[h.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const c=function(h){let _=0;const w=new p.StructArrayLayout2ui4,C=131;for(let I=1;I<129;I++){for(let A=1;A<129;A++)_=I*C+A,w.emplaceBack(_,_+1),w.emplaceBack(_,_+C),w.emplaceBack(_+1,_+C),128===I&&w.emplaceBack(_+C,_+C+1);w.emplaceBack(_+1,_+1+C)}return w}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(c),this.wireframeSegments=p.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,c.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class qi{static cacheKey(c,h,_,w){let C=`${h}${w?w.cacheKey:""}`;for(const I of _)c.usedDefines.includes(I)&&(C+=`/${I}`);return C}constructor(c,h,_,w,C,I){const A=c.gl;this.program=A.createProgram();const P=function(q){const ie=[];for(let me=0;me<q.length;me++){if(null===q[me])continue;const be=q[me].split(" ");ie.push(be.pop())}return ie}(_.staticAttributes),N=w?w.getBinderAttributes():[],B=P.concat(N);let $=w?w.defines():[];$=$.concat(I.map(q=>`#define ${q}`));const Q=c.isWebGL2?"#version 300 es\n":"",re=Q+$.concat(c.extStandardDerivatives&&0===Q.length?"#extension GL_OES_standard_derivatives : enable\n".concat(Xs):Xs,Xs,Ah,Mh.fragmentSource,xu.fragmentSource,_.fragmentSource).join("\n"),ae=Q+$.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Ah,Mh.vertexSource,xu.vertexSource,xd.vertexSource,_.vertexSource).join("\n"),se=A.createShader(A.FRAGMENT_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);A.shaderSource(se,re),A.compileShader(se),A.attachShader(this.program,se);const ce=A.createShader(A.VERTEX_SHADER);if(A.isContextLost())this.failedToCreate=!0;else{A.shaderSource(ce,ae),A.compileShader(ce),A.attachShader(this.program,ce),this.attributes={},this.numAttributes=B.length;for(let q=0;q<this.numAttributes;q++)B[q]&&(A.bindAttribLocation(this.program,q,B[q]),this.attributes[B[q]]=q);A.linkProgram(this.program),A.deleteShader(ce),A.deleteShader(se),this.fixedUniforms=C(c),this.binderUniforms=w?w.getUniforms(c):[],I.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new p.Uniform1i(q=c),u_dem_prev:new p.Uniform1i(q),u_dem_unpack:new p.Uniform4f(q),u_dem_tl:new p.Uniform2f(q),u_dem_scale:new p.Uniform1f(q),u_dem_tl_prev:new p.Uniform2f(q),u_dem_scale_prev:new p.Uniform1f(q),u_dem_size:new p.Uniform1f(q),u_dem_lerp:new p.Uniform1f(q),u_exaggeration:new p.Uniform1f(q),u_depth:new p.Uniform1i(q),u_depth_size_inv:new p.Uniform2f(q),u_meter_to_dem:new p.Uniform1f(q),u_label_plane_matrix_inv:new p.UniformMatrix4f(q)}),I.includes("GLOBE")&&(this.globeUniforms=(q=>({u_tile_tl_up:new p.Uniform3f(q),u_tile_tr_up:new p.Uniform3f(q),u_tile_br_up:new p.Uniform3f(q),u_tile_bl_up:new p.Uniform3f(q),u_tile_up_scale:new p.Uniform1f(q)}))(c)),I.includes("FOG")&&(this.fogUniforms=(q=>({u_fog_matrix:new p.UniformMatrix4f(q),u_fog_range:new p.Uniform2f(q),u_fog_color:new p.Uniform4f(q),u_fog_horizon_blend:new p.Uniform1f(q),u_fog_temporal_offset:new p.Uniform1f(q),u_frustum_tl:new p.Uniform3f(q),u_frustum_tr:new p.Uniform3f(q),u_frustum_br:new p.Uniform3f(q),u_frustum_bl:new p.Uniform3f(q),u_globe_pos:new p.Uniform3f(q),u_globe_radius:new p.Uniform1f(q),u_globe_transition:new p.Uniform1f(q),u_is_globe:new p.Uniform1i(q),u_viewport:new p.Uniform2f(q)}))(c))}var q}setTerrainUniformValues(c,h){if(!this.terrainUniforms)return;const _=this.terrainUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const w in h)_[w]&&_[w].set(this.program,w,h[w])}}setGlobeUniformValues(c,h){if(!this.globeUniforms)return;const _=this.globeUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const w in h)_[w]&&_[w].set(this.program,w,h[w])}}setFogUniformValues(c,h){if(!this.fogUniforms)return;const _=this.fogUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const w in h)_[w].set(this.program,w,h[w])}}draw(c,h,_,w,C,I,A,P,N,B,$,Q,re,ae,se){const ce=c.gl;if(this.failedToCreate)return;c.program.set(this.program),c.setDepthMode(_),c.setStencilMode(w),c.setColorMode(C),c.setCullFace(I);for(const ie of Object.keys(this.fixedUniforms))this.fixedUniforms[ie].set(this.program,ie,A[ie]);ae&&ae.setUniforms(this.program,c,this.binderUniforms,Q,{zoom:re});const q={[ce.LINES]:2,[ce.TRIANGLES]:3,[ce.LINE_STRIP]:1}[h];for(const ie of $.get()){const me=ie.vaos||(ie.vaos={});(me[P]||(me[P]=new za)).bind(c,this,N,ae?ae.getPaintVertexBuffers():[],B,ie.vertexOffset,se||[]),ce.drawElements(h,ie.primitiveLength*q,ce.UNSIGNED_SHORT,ie.primitiveOffset*q*2)}}}function Ln(g,c){const h=Math.pow(2,c.tileID.overscaledZ),_=c.tileSize*Math.pow(2,g.transform.tileZoom)/h,w=_*(c.tileID.canonical.x+c.tileID.wrap*h),C=_*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_tile_units_to_pixels:1/xt(c,1,g.transform.tileZoom),u_pixel_coord_upper:[w>>16,C>>16],u_pixel_coord_lower:[65535&w,65535&C]}}const Um=p.create(),Oh=(g,c,h,_,w,C,I,A,P,N,B)=>{const $=c.style.light,Q=$.properties.get("position"),re=[Q.x,Q.y,Q.z],ae=p.create$1();"viewport"===$.properties.get("anchor")&&(p.fromRotation(ae,-c.transform.angle),p.transformMat3(re,re,ae));const se=$.properties.get("color"),ce=c.transform,q={u_matrix:g,u_lightpos:re,u_lightintensity:$.properties.get("intensity"),u_lightcolor:[se.r,se.g,se.b],u_vertical_gradient:+h,u_opacity:_,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Um,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:w,u_edge_radius:C};return"globe"===ce.projection.name&&(q.u_tile_id=[I.canonical.x,I.canonical.y,1<<I.canonical.z],q.u_zoom_transition=P,q.u_inv_rot_matrix=B,q.u_merc_center=N,q.u_up_dir=ce.projection.upVector(new p.CanonicalTileID(0,0,0),N[0]*p.EXTENT,N[1]*p.EXTENT),q.u_height_lift=A),q},Ft=(g,c,h,_,w,C,I,A,P,N,B,$)=>{const Q=Oh(g,c,h,_,w,C,I,P,N,B,$),re={u_height_factor:-Math.pow(2,I.overscaledZ)/A.tileSize/8};return p.extend(Q,Ln(c,A),re)},Po=g=>({u_matrix:g}),xr=(g,c,h)=>p.extend(Po(g),Ln(c,h)),ks=(g,c)=>({u_matrix:g,u_world:c}),Rs=(g,c,h,_)=>p.extend(xr(g,c,h),{u_world:_}),Su=p.create(),Ps=(g,c,h,_,w,C)=>{const I=g.transform,A="globe"===I.projection.name;let P;if("map"===C.paint.get("circle-pitch-alignment"))if(A){const B=p.globePixelsToTileUnits(I.zoom,c.canonical)*I._pixelsPerMercatorPixel;P=Float32Array.from([B,0,0,B])}else P=I.calculatePixelsToTileUnitsMatrix(h);else P=new Float32Array([I.pixelsToGLUnits[0],0,0,I.pixelsToGLUnits[1]]);const N={u_camera_to_center_distance:I.cameraToCenterDistance,u_matrix:g.translatePosMatrix(c.projMatrix,h,C.paint.get("circle-translate"),C.paint.get("circle-translate-anchor")),u_device_pixel_ratio:p.exported.devicePixelRatio,u_extrude_scale:P,u_inv_rot_matrix:Su,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(A){N.u_inv_rot_matrix=_,N.u_merc_center=w,N.u_tile_id=[c.canonical.x,c.canonical.y,1<<c.canonical.z],N.u_zoom_transition=p.globeToMercatorTransition(I.zoom);const B=w[0]*p.EXTENT,$=w[1]*p.EXTENT;N.u_up_dir=I.projection.upVector(new p.CanonicalTileID(0,0,0),B,$)}return N},Cu=g=>{const c=[];return"map"===g.paint.get("circle-pitch-alignment")&&c.push("PITCH_WITH_MAP"),"map"===g.paint.get("circle-pitch-scale")&&c.push("SCALE_WITH_MAP"),c},Cd=(g,c,h,_)=>{const w=p.EXTENT/h.tileSize;return{u_matrix:g,u_camera_to_center_distance:c.getCameraToCenterDistance(_),u_extrude_scale:[c.pixelsToGLUnits[0]/w,c.pixelsToGLUnits[1]/w]}},sc=(g,c,h=1)=>({u_matrix:g,u_color:c,u_overlay:0,u_overlay_scale:h}),Td=p.create(),ac=(g,c,h,_,w,C,I)=>{const A=g.transform,P="globe"===A.projection.name,N=P?p.globePixelsToTileUnits(A.zoom,c.canonical)*A._pixelsPerMercatorPixel:xt(h,1,C),B={u_matrix:c.projMatrix,u_extrude_scale:N,u_intensity:I,u_inv_rot_matrix:Td,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(P){B.u_inv_rot_matrix=_,B.u_merc_center=w,B.u_tile_id=[c.canonical.x,c.canonical.y,1<<c.canonical.z],B.u_zoom_transition=p.globeToMercatorTransition(A.zoom);const $=w[0]*p.EXTENT,Q=w[1]*p.EXTENT;B.u_up_dir=A.projection.upVector(new p.CanonicalTileID(0,0,0),$,Q)}return B},ys=(g,c,h,_,w,C,I)=>{const A=g.transform,P=A.calculatePixelsToTileUnitsMatrix(c);return{u_matrix:kn(g,c,h,_),u_pixels_to_tile_units:P,u_device_pixel_ratio:C,u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:w,u_texsize:Di(h)?c.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:is(c,g.transform),u_alpha_discard_threshold:0,u_trim_offset:I}},Ed=(g,c,h,_,w)=>{const C=g.transform;return{u_matrix:kn(g,c,h,_),u_texsize:c.imageAtlasTexture.size,u_pixels_to_tile_units:C.calculatePixelsToTileUnitsMatrix(c),u_device_pixel_ratio:w,u_image:0,u_tile_units_to_pixels:is(c,C),u_units_to_pixels:[1/C.pixelsToGLUnits[0],1/C.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function is(g,c){return 1/xt(g,1,c.tileZoom)}function kn(g,c,h,_){return g.translatePosMatrix(_||c.tileID.projMatrix,c,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}function Di(g){const c=g.paint.get("line-dasharray").value;return c.value||"constant"!==c.kind}const Yr=(g,c,h,_,w,C)=>{return{u_matrix:g,u_tl_parent:c,u_scale_parent:h,u_fade_t:_.mix,u_opacity:_.opacity*w.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:w.paint.get("raster-brightness-min"),u_brightness_high:w.paint.get("raster-brightness-max"),u_saturation_factor:(A=w.paint.get("raster-saturation"),A>0?1-1/(1.001-A):-A),u_contrast_factor:(I=w.paint.get("raster-contrast"),I>0?1/(1-I):1+I),u_spin_weights:bo(w.paint.get("raster-hue-rotate")),u_perspective_transform:C};var I,A};function bo(g){g*=Math.PI/180;const c=Math.sin(g),h=Math.cos(g);return[(2*h+1)/3,(-Math.sqrt(3)*c-h+1)/3,(Math.sqrt(3)*c-h+1)/3]}const dl=p.create(),Oo=(g,c,h,_,w,C,I,A,P,N,B,$,Q,re,ae,se)=>{const ce=w.transform,q={u_is_size_zoom_constant:+("constant"===g||"source"===g),u_is_size_feature_constant:+("constant"===g||"camera"===g),u_size_t:c?c.uSizeT:0,u_size:c?c.uSize:0,u_camera_to_center_distance:ce.cameraToCenterDistance,u_rotate_symbol:+h,u_aspect_ratio:ce.width/ce.height,u_fade_change:w.options.fadeDuration?w.symbolFadeChange:1,u_matrix:C,u_label_plane_matrix:I,u_coord_matrix:A,u_is_text:+P,u_pitch_with_map:+_,u_texsize:N,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:dl,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:dl,u_up_vector:[0,-1,0]};return"globe"===se.name&&(q.u_tile_id=[B.canonical.x,B.canonical.y,1<<B.canonical.z],q.u_zoom_transition=$,q.u_inv_rot_matrix=re,q.u_merc_center=Q,q.u_camera_forward=ce._camera.forward(),q.u_ecef_origin=p.globeECEFOrigin(ce.globeMatrix,B.toUnwrapped()),q.u_tile_matrix=Float32Array.from(ce.globeMatrix),q.u_up_vector=ae),q},hl=(g,c,h,_,w,C,I,A,P,N,B,$,Q,re,ae,se,ce)=>p.extend(Oo(g,c,h,_,w,C,I,A,P,N,$,Q,re,ae,se,ce),{u_gamma_scale:_?w.transform.cameraToCenterDistance*Math.cos(w.terrain?0:w.transform._pitch):1,u_device_pixel_ratio:p.exported.devicePixelRatio,u_is_halo:+B}),ao=(g,c,h,_,w,C,I,A,P,N,B,$,Q,re,ae,se)=>p.extend(hl(g,c,h,_,w,C,I,A,!0,P,!0,B,$,Q,re,ae,se),{u_texsize_icon:N,u_texture_icon:1}),jc=(g,c,h)=>({u_matrix:g,u_opacity:c,u_color:h}),Dd=(g,c,h,_,w)=>p.extend(function(C,I,A){const P=I.imageManager.getPattern(C.toString()),{width:N,height:B}=I.imageManager.getPixelSize(),$=Math.pow(2,A.tileID.overscaledZ),Q=A.tileSize*Math.pow(2,I.transform.tileZoom)/$,re=Q*(A.tileID.canonical.x+A.tileID.wrap*$),ae=Q*A.tileID.canonical.y;return{u_image:0,u_pattern_tl:P.tl,u_pattern_br:P.br,u_texsize:[N,B],u_pattern_size:P.displaySize,u_tile_units_to_pixels:1/xt(A,1,I.transform.tileZoom),u_pixel_coord_upper:[re>>16,ae>>16],u_pixel_coord_lower:[65535&re,65535&ae]}}(_,h,w),{u_matrix:g,u_opacity:c}),Fi={fillExtrusion:g=>({u_matrix:new p.UniformMatrix4f(g),u_lightpos:new p.Uniform3f(g),u_lightintensity:new p.Uniform1f(g),u_lightcolor:new p.Uniform3f(g),u_vertical_gradient:new p.Uniform1f(g),u_opacity:new p.Uniform1f(g),u_edge_radius:new p.Uniform1f(g),u_ao:new p.Uniform2f(g),u_tile_id:new p.Uniform3f(g),u_zoom_transition:new p.Uniform1f(g),u_inv_rot_matrix:new p.UniformMatrix4f(g),u_merc_center:new p.Uniform2f(g),u_up_dir:new p.Uniform3f(g),u_height_lift:new p.Uniform1f(g)}),fillExtrusionPattern:g=>({u_matrix:new p.UniformMatrix4f(g),u_lightpos:new p.Uniform3f(g),u_lightintensity:new p.Uniform1f(g),u_lightcolor:new p.Uniform3f(g),u_vertical_gradient:new p.Uniform1f(g),u_height_factor:new p.Uniform1f(g),u_edge_radius:new p.Uniform1f(g),u_ao:new p.Uniform2f(g),u_tile_id:new p.Uniform3f(g),u_zoom_transition:new p.Uniform1f(g),u_inv_rot_matrix:new p.UniformMatrix4f(g),u_merc_center:new p.Uniform2f(g),u_up_dir:new p.Uniform3f(g),u_height_lift:new p.Uniform1f(g),u_image:new p.Uniform1i(g),u_texsize:new p.Uniform2f(g),u_pixel_coord_upper:new p.Uniform2f(g),u_pixel_coord_lower:new p.Uniform2f(g),u_tile_units_to_pixels:new p.Uniform1f(g),u_opacity:new p.Uniform1f(g)}),fill:g=>({u_matrix:new p.UniformMatrix4f(g)}),fillPattern:g=>({u_matrix:new p.UniformMatrix4f(g),u_image:new p.Uniform1i(g),u_texsize:new p.Uniform2f(g),u_pixel_coord_upper:new p.Uniform2f(g),u_pixel_coord_lower:new p.Uniform2f(g),u_tile_units_to_pixels:new p.Uniform1f(g)}),fillOutline:g=>({u_matrix:new p.UniformMatrix4f(g),u_world:new p.Uniform2f(g)}),fillOutlinePattern:g=>({u_matrix:new p.UniformMatrix4f(g),u_world:new p.Uniform2f(g),u_image:new p.Uniform1i(g),u_texsize:new p.Uniform2f(g),u_pixel_coord_upper:new p.Uniform2f(g),u_pixel_coord_lower:new p.Uniform2f(g),u_tile_units_to_pixels:new p.Uniform1f(g)}),circle:g=>({u_camera_to_center_distance:new p.Uniform1f(g),u_extrude_scale:new p.UniformMatrix2f(g),u_device_pixel_ratio:new p.Uniform1f(g),u_matrix:new p.UniformMatrix4f(g),u_inv_rot_matrix:new p.UniformMatrix4f(g),u_merc_center:new p.Uniform2f(g),u_tile_id:new p.Uniform3f(g),u_zoom_transition:new p.Uniform1f(g),u_up_dir:new p.Uniform3f(g)}),collisionBox:g=>({u_matrix:new p.UniformMatrix4f(g),u_camera_to_center_distance:new p.Uniform1f(g),u_extrude_scale:new p.Uniform2f(g)}),collisionCircle:g=>({u_matrix:new p.UniformMatrix4f(g),u_inv_matrix:new p.UniformMatrix4f(g),u_camera_to_center_distance:new p.Uniform1f(g),u_viewport_size:new p.Uniform2f(g)}),debug:g=>({u_color:new p.UniformColor(g),u_matrix:new p.UniformMatrix4f(g),u_overlay:new p.Uniform1i(g),u_overlay_scale:new p.Uniform1f(g)}),clippingMask:g=>({u_matrix:new p.UniformMatrix4f(g)}),heatmap:g=>({u_extrude_scale:new p.Uniform1f(g),u_intensity:new p.Uniform1f(g),u_matrix:new p.UniformMatrix4f(g),u_inv_rot_matrix:new p.UniformMatrix4f(g),u_merc_center:new p.Uniform2f(g),u_tile_id:new p.Uniform3f(g),u_zoom_transition:new p.Uniform1f(g),u_up_dir:new p.Uniform3f(g)}),heatmapTexture:g=>({u_image:new p.Uniform1i(g),u_color_ramp:new p.Uniform1i(g),u_opacity:new p.Uniform1f(g)}),hillshade:g=>({u_matrix:new p.UniformMatrix4f(g),u_image:new p.Uniform1i(g),u_latrange:new p.Uniform2f(g),u_light:new p.Uniform2f(g),u_shadow:new p.UniformColor(g),u_highlight:new p.UniformColor(g),u_accent:new p.UniformColor(g)}),hillshadePrepare:g=>({u_matrix:new p.UniformMatrix4f(g),u_image:new p.Uniform1i(g),u_dimension:new p.Uniform2f(g),u_zoom:new p.Uniform1f(g),u_unpack:new p.Uniform4f(g)}),line:g=>({u_matrix:new p.UniformMatrix4f(g),u_pixels_to_tile_units:new p.UniformMatrix2f(g),u_device_pixel_ratio:new p.Uniform1f(g),u_units_to_pixels:new p.Uniform2f(g),u_dash_image:new p.Uniform1i(g),u_gradient_image:new p.Uniform1i(g),u_image_height:new p.Uniform1f(g),u_texsize:new p.Uniform2f(g),u_tile_units_to_pixels:new p.Uniform1f(g),u_alpha_discard_threshold:new p.Uniform1f(g),u_trim_offset:new p.Uniform2f(g)}),linePattern:g=>({u_matrix:new p.UniformMatrix4f(g),u_texsize:new p.Uniform2f(g),u_pixels_to_tile_units:new p.UniformMatrix2f(g),u_device_pixel_ratio:new p.Uniform1f(g),u_image:new p.Uniform1i(g),u_units_to_pixels:new p.Uniform2f(g),u_tile_units_to_pixels:new p.Uniform1f(g),u_alpha_discard_threshold:new p.Uniform1f(g)}),raster:g=>({u_matrix:new p.UniformMatrix4f(g),u_tl_parent:new p.Uniform2f(g),u_scale_parent:new p.Uniform1f(g),u_fade_t:new p.Uniform1f(g),u_opacity:new p.Uniform1f(g),u_image0:new p.Uniform1i(g),u_image1:new p.Uniform1i(g),u_brightness_low:new p.Uniform1f(g),u_brightness_high:new p.Uniform1f(g),u_saturation_factor:new p.Uniform1f(g),u_contrast_factor:new p.Uniform1f(g),u_spin_weights:new p.Uniform3f(g),u_perspective_transform:new p.Uniform2f(g)}),symbolIcon:g=>({u_is_size_zoom_constant:new p.Uniform1i(g),u_is_size_feature_constant:new p.Uniform1i(g),u_size_t:new p.Uniform1f(g),u_size:new p.Uniform1f(g),u_camera_to_center_distance:new p.Uniform1f(g),u_rotate_symbol:new p.Uniform1i(g),u_aspect_ratio:new p.Uniform1f(g),u_fade_change:new p.Uniform1f(g),u_matrix:new p.UniformMatrix4f(g),u_label_plane_matrix:new p.UniformMatrix4f(g),u_coord_matrix:new p.UniformMatrix4f(g),u_is_text:new p.Uniform1i(g),u_pitch_with_map:new p.Uniform1i(g),u_texsize:new p.Uniform2f(g),u_tile_id:new p.Uniform3f(g),u_zoom_transition:new p.Uniform1f(g),u_inv_rot_matrix:new p.UniformMatrix4f(g),u_merc_center:new p.Uniform2f(g),u_camera_forward:new p.Uniform3f(g),u_tile_matrix:new p.UniformMatrix4f(g),u_up_vector:new p.Uniform3f(g),u_ecef_origin:new p.Uniform3f(g),u_texture:new p.Uniform1i(g)}),symbolSDF:g=>({u_is_size_zoom_constant:new p.Uniform1i(g),u_is_size_feature_constant:new p.Uniform1i(g),u_size_t:new p.Uniform1f(g),u_size:new p.Uniform1f(g),u_camera_to_center_distance:new p.Uniform1f(g),u_rotate_symbol:new p.Uniform1i(g),u_aspect_ratio:new p.Uniform1f(g),u_fade_change:new p.Uniform1f(g),u_matrix:new p.UniformMatrix4f(g),u_label_plane_matrix:new p.UniformMatrix4f(g),u_coord_matrix:new p.UniformMatrix4f(g),u_is_text:new p.Uniform1i(g),u_pitch_with_map:new p.Uniform1i(g),u_texsize:new p.Uniform2f(g),u_texture:new p.Uniform1i(g),u_gamma_scale:new p.Uniform1f(g),u_device_pixel_ratio:new p.Uniform1f(g),u_tile_id:new p.Uniform3f(g),u_zoom_transition:new p.Uniform1f(g),u_inv_rot_matrix:new p.UniformMatrix4f(g),u_merc_center:new p.Uniform2f(g),u_camera_forward:new p.Uniform3f(g),u_tile_matrix:new p.UniformMatrix4f(g),u_up_vector:new p.Uniform3f(g),u_ecef_origin:new p.Uniform3f(g),u_is_halo:new p.Uniform1i(g)}),symbolTextAndIcon:g=>({u_is_size_zoom_constant:new p.Uniform1i(g),u_is_size_feature_constant:new p.Uniform1i(g),u_size_t:new p.Uniform1f(g),u_size:new p.Uniform1f(g),u_camera_to_center_distance:new p.Uniform1f(g),u_rotate_symbol:new p.Uniform1i(g),u_aspect_ratio:new p.Uniform1f(g),u_fade_change:new p.Uniform1f(g),u_matrix:new p.UniformMatrix4f(g),u_label_plane_matrix:new p.UniformMatrix4f(g),u_coord_matrix:new p.UniformMatrix4f(g),u_is_text:new p.Uniform1i(g),u_pitch_with_map:new p.Uniform1i(g),u_texsize:new p.Uniform2f(g),u_texsize_icon:new p.Uniform2f(g),u_texture:new p.Uniform1i(g),u_texture_icon:new p.Uniform1i(g),u_gamma_scale:new p.Uniform1f(g),u_device_pixel_ratio:new p.Uniform1f(g),u_is_halo:new p.Uniform1i(g)}),background:g=>({u_matrix:new p.UniformMatrix4f(g),u_opacity:new p.Uniform1f(g),u_color:new p.UniformColor(g)}),backgroundPattern:g=>({u_matrix:new p.UniformMatrix4f(g),u_opacity:new p.Uniform1f(g),u_image:new p.Uniform1i(g),u_pattern_tl:new p.Uniform2f(g),u_pattern_br:new p.Uniform2f(g),u_texsize:new p.Uniform2f(g),u_pattern_size:new p.Uniform2f(g),u_pixel_coord_upper:new p.Uniform2f(g),u_pixel_coord_lower:new p.Uniform2f(g),u_tile_units_to_pixels:new p.Uniform1f(g)}),terrainRaster:jm,terrainDepth:jm,skybox:g=>({u_matrix:new p.UniformMatrix4f(g),u_sun_direction:new p.Uniform3f(g),u_cubemap:new p.Uniform1i(g),u_opacity:new p.Uniform1f(g),u_temporal_offset:new p.Uniform1f(g)}),skyboxGradient:g=>({u_matrix:new p.UniformMatrix4f(g),u_color_ramp:new p.Uniform1i(g),u_center_direction:new p.Uniform3f(g),u_radius:new p.Uniform1f(g),u_opacity:new p.Uniform1f(g),u_temporal_offset:new p.Uniform1f(g)}),skyboxCapture:g=>({u_matrix_3f:new p.UniformMatrix3f(g),u_sun_direction:new p.Uniform3f(g),u_sun_intensity:new p.Uniform1f(g),u_color_tint_r:new p.Uniform4f(g),u_color_tint_m:new p.Uniform4f(g),u_luminance:new p.Uniform1f(g)}),globeRaster:g=>({u_proj_matrix:new p.UniformMatrix4f(g),u_globe_matrix:new p.UniformMatrix4f(g),u_normalize_matrix:new p.UniformMatrix4f(g),u_merc_matrix:new p.UniformMatrix4f(g),u_zoom_transition:new p.Uniform1f(g),u_merc_center:new p.Uniform2f(g),u_image0:new p.Uniform1i(g),u_grid_matrix:new p.UniformMatrix3f(g),u_skirt_height:new p.Uniform1f(g),u_frustum_tl:new p.Uniform3f(g),u_frustum_tr:new p.Uniform3f(g),u_frustum_br:new p.Uniform3f(g),u_frustum_bl:new p.Uniform3f(g),u_globe_pos:new p.Uniform3f(g),u_globe_radius:new p.Uniform1f(g),u_viewport:new p.Uniform2f(g)}),globeAtmosphere:g=>({u_frustum_tl:new p.Uniform3f(g),u_frustum_tr:new p.Uniform3f(g),u_frustum_br:new p.Uniform3f(g),u_frustum_bl:new p.Uniform3f(g),u_horizon:new p.Uniform1f(g),u_transition:new p.Uniform1f(g),u_fadeout_range:new p.Uniform1f(g),u_color:new p.Uniform4f(g),u_high_color:new p.Uniform4f(g),u_space_color:new p.Uniform4f(g),u_star_intensity:new p.Uniform1f(g),u_star_density:new p.Uniform1f(g),u_star_size:new p.Uniform1f(g),u_temporal_offset:new p.Uniform1f(g),u_horizon_angle:new p.Uniform1f(g),u_rotation_matrix:new p.UniformMatrix4f(g)})};let Uc;function pl(g,c,h,_,w,C,I){const A=g.context,P=A.gl,N=g.transform,B=g.useProgram("collisionBox"),$=[];let Q=0,re=0;for(let be=0;be<_.length;be++){const Le=_[be],Pe=c.getTile(Le),Oe=Pe.getBucket(h);if(!Oe)continue;const Ke=Gs(Le,Oe,N);let We=Ke;0===w[0]&&0===w[1]||(We=g.translatePosMatrix(Ke,Pe,w,C));const at=I?Oe.textCollisionBox:Oe.iconCollisionBox,zt=Oe.collisionCircleArray;if(zt.length>0){const it=p.create(),Tt=We;p.mul(it,Oe.placementInvProjMatrix,N.glCoordMatrix),p.mul(it,it,Oe.placementViewportMatrix),$.push({circleArray:zt,circleOffset:re,transform:Tt,invTransform:it,projection:Oe.getProjection()}),Q+=zt.length/4,re=Q}at&&(g.terrain&&g.terrain.setupElevationDraw(Pe,B),B.draw(A,P.LINES,p.DepthMode.disabled,p.StencilMode.disabled,g.colorModeForRenderPass(),p.CullFaceMode.disabled,Cd(We,N,Pe,Oe.getProjection()),h.id,at.layoutVertexBuffer,at.indexBuffer,at.segments,null,N.zoom,null,[at.collisionVertexBuffer,at.collisionVertexBufferExt]))}if(!I||!$.length)return;const ae=g.useProgram("collisionCircle"),se=new p.StructArrayLayout2f1f2i16;se.resize(4*Q),se._trim();let ce=0;for(const be of $)for(let Le=0;Le<be.circleArray.length/4;Le++){const Pe=4*Le,Oe=be.circleArray[Pe+0],Ke=be.circleArray[Pe+1],We=be.circleArray[Pe+2],at=be.circleArray[Pe+3];se.emplace(ce++,Oe,Ke,We,at,0),se.emplace(ce++,Oe,Ke,We,at,1),se.emplace(ce++,Oe,Ke,We,at,2),se.emplace(ce++,Oe,Ke,We,at,3)}(!Uc||Uc.length<2*Q)&&(Uc=function(be){const Le=2*be,Pe=new p.StructArrayLayout3ui6;Pe.resize(Le),Pe._trim();for(let Oe=0;Oe<Le;Oe++){const Ke=6*Oe;Pe.uint16[Ke+0]=4*Oe+0,Pe.uint16[Ke+1]=4*Oe+1,Pe.uint16[Ke+2]=4*Oe+2,Pe.uint16[Ke+3]=4*Oe+2,Pe.uint16[Ke+4]=4*Oe+3,Pe.uint16[Ke+5]=4*Oe+0}return Pe}(Q));const q=A.createIndexBuffer(Uc,!0),ie=A.createVertexBuffer(se,p.collisionCircleLayout.members,!0);for(const be of $){const Le={u_matrix:be.transform,u_inv_matrix:be.invTransform,u_camera_to_center_distance:(me=N).getCameraToCenterDistance(be.projection),u_viewport_size:[me.width,me.height]};ae.draw(A,P.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,g.colorModeForRenderPass(),p.CullFaceMode.disabled,Le,h.id,ie,q,p.SegmentVector.simpleSegment(0,2*be.circleOffset,be.circleArray.length,be.circleArray.length/2),null,N.zoom)}var me;ie.destroy(),q.destroy()}const Lh=p.create();function Ol({width:g,height:c,anchor:h,textOffset:_,textScale:w},C){const{horizontalAlign:I,verticalAlign:A}=p.getAnchorAlignment(h),P=-(I-.5)*g,N=-(A-.5)*c,B=p.evaluateVariableOffset(h,_);return new p.Point((P/w+B[0])*C,(N/w+B[1])*C)}function vs(g,c,h,_,w,C,I,A,P,N,B){const $=g.text.placedSymbolArray,Q=g.text.dynamicLayoutVertexArray,re=g.icon.dynamicLayoutVertexArray,ae={},se=g.getProjection(),ce=eo(A,se,C),q=C.elevation,ie=se.upVectorScale(A.canonical,C.center.lat,C.worldSize).metersToTile;Q.clear();for(let me=0;me<$.length;me++){const be=$.get(me),{tileAnchorX:Le,tileAnchorY:Pe,numGlyphs:Oe}=be,Ke=be.hidden||!be.crossTileID||g.allowVerticalPlacement&&!be.placedOrientation?null:_[be.crossTileID];if(Ke){let We=0,at=0,zt=0;if(q){const qt=q?q.getAtTileOffset(A,Le,Pe):0,[Un,ti,An]=se.upVector(A.canonical,Le,Pe);We=qt*Un*ie,at=qt*ti*ie,zt=qt*An*ie}let[it,Tt,ht,Vt]=Xo(be.projectedAnchorX+We,be.projectedAnchorY+at,be.projectedAnchorZ+zt,h?ce:I);const ot=qp(C.getCameraToCenterDistance(se),Vt);let wt=w.evaluateSizeForFeature(g.textSizeData,N,be)*ot/p.ONE_EM;h&&(wt*=g.tilePixelRatio/P);const Ut=Ol(Ke,wt);h?(({x:it,y:Tt,z:ht}=se.projectTilePoint(Le+Ut.x,Pe+Ut.y,A.canonical)),[it,Tt,ht]=Xo(it+We,Tt+at,ht+zt,I)):(c&&Ut._rotate(-C.angle),it+=Ut.x,Tt+=Ut.y,ht=0);const At=g.allowVerticalPlacement&&be.placedOrientation===p.WritingMode.vertical?Math.PI/2:0;for(let qt=0;qt<Oe;qt++)p.addDynamicAttributes(Q,it,Tt,ht,At);B&&be.associatedIconIndex>=0&&(ae[be.associatedIconIndex]={x:it,y:Tt,z:ht,angle:At})}else Zi(Oe,Q)}if(B){re.clear();const me=g.icon.placedSymbolArray;for(let be=0;be<me.length;be++){const Le=me.get(be),{numGlyphs:Pe}=Le,Oe=ae[be];if(Le.hidden||!Oe)Zi(Pe,re);else{const{x:Ke,y:We,z:at,angle:zt}=Oe;for(let it=0;it<Pe;it++)p.addDynamicAttributes(re,Ke,We,at,zt)}}g.icon.dynamicLayoutVertexBuffer.updateData(re)}g.text.dynamicLayoutVertexBuffer.updateData(Q)}function Hc(g,c,h){return h.iconsInText&&c?"symbolTextAndIcon":g?"symbolSDF":"symbolIcon"}function $c(g,c,h,_,w,C,I,A,P,N,B,$){const Q=g.context,re=Q.gl,ae=g.transform,se="map"===A,ce="map"===P,q=se&&"point"!==h.layout.get("symbol-placement"),ie=se&&!ce&&!q,me=void 0!==h.layout.get("symbol-sort-key").constantOr(1);let be=!1;const Le=g.depthModeForSublayer(0,p.DepthMode.ReadOnly),Pe=[p.mercatorXfromLng(ae.center.lng),p.mercatorYfromLat(ae.center.lat)],Oe=h.layout.get("text-variable-anchor"),Ke="globe"===ae.projection.name,We=[],at=[0,-1,0];let zt=at;!Ke&&!ae.mercatorFromTransition||se||(zt=function(it){const Tt=it._camera.getWorldToCamera(it.worldSize,1),ht=p.multiply([],Tt,it.globeMatrix);p.invert(ht,ht);const Vt=[0,0,0],ot=[0,1,0,0];return p.transformMat4$1(ot,ot,ht),Vt[0]=ot[0],Vt[1]=ot[1],Vt[2]=ot[2],p.normalize(Vt,Vt),Vt}(ae));for(const it of _){const Tt=c.getTile(it),ht=Tt.getBucket(h);if(!ht||"mercator"===ht.projection.name&&Ke)continue;const Vt=w?ht.text:ht.icon;if(!Vt||ht.fullyClipped||!Vt.segments.get().length)continue;const ot=Vt.programConfigurations.get(h.id),wt=w||ht.sdfIcons,Ut=w?ht.textSizeData:ht.iconSizeData,At=ce||0!==ae.pitch,qt=p.evaluateSizeForZoom(Ut,ae.zoom);let Un,ti,An,Hn,Ai=[0,0],wi=null;if(w)ti=Tt.glyphAtlasTexture,An=re.LINEAR,Un=Tt.glyphAtlasTexture.size,ht.iconsInText&&(Ai=Tt.imageAtlasTexture.size,wi=Tt.imageAtlasTexture,Hn=At||g.options.rotating||g.options.zooming||"composite"===Ut.kind||"camera"===Ut.kind?re.LINEAR:re.NEAREST);else{const Bl=1!==h.layout.get("icon-size").constantOr(0)||ht.iconsNeedLinear;ti=Tt.imageAtlasTexture,An=wt||g.options.rotating||g.options.zooming||Bl||At?re.LINEAR:re.NEAREST,Un=Tt.imageAtlasTexture.size}const Vn="globe"===ht.projection.name,ur=Vn?zt:at,wr=Vn?p.globeToMercatorTransition(ae.zoom):0,Dr=eo(it,ht.getProjection(),ae),ji=ae.calculatePixelsToTileUnitsMatrix(Tt),xs=_t(Dr,Tt.tileID.canonical,ce,se,ae,ht.getProjection(),ji),_o=g.terrain&&ce&&q?p.invert(p.create(),xs):Lh,Js=To(Dr,Tt.tileID.canonical,ce,se,ae,ht.getProjection(),ji),Aa=Oe&&ht.hasTextData(),Fr="none"!==h.layout.get("icon-text-fit")&&Aa&&ht.hasIconData();if(q){const Bl=ae.elevation,zl=Bl?Bl.getAtTileOffsetFunc(it,ae.center.lat,ae.worldSize,ht.getProjection()):null,hc=kl(Dr,Tt.tileID.canonical,ce,se,ae,ht.getProjection(),ji);Gp(ht,Dr,g,w,hc,Js,ce,N,zl,it)}const pr=q||w&&Oe||Fr,or=g.translatePosMatrix(Dr,Tt,C,I),yo=pr?Lh:xs,ws=g.translatePosMatrix(Js,Tt,C,I,!0),Hr=ht.getProjection().createInversionMatrix(ae,it.canonical),Fs=[];g.terrainRenderModeElevated()&&ce&&Fs.push("PITCH_WITH_MAP_TERRAIN"),Vn&&Fs.push("PROJECTION_GLOBE_VIEW"),pr&&Fs.push("PROJECTED_POS_ON_VIEWPORT");const Yh=wt&&0!==h.paint.get(w?"text-halo-width":"icon-halo-width").constantOr(1);let gl;gl=wt?ht.iconsInText?ao(Ut.kind,qt,ie,ce,g,or,yo,ws,Un,Ai,it,wr,Pe,Hr,ur,ht.getProjection()):hl(Ut.kind,qt,ie,ce,g,or,yo,ws,w,Un,!0,it,wr,Pe,Hr,ur,ht.getProjection()):Oo(Ut.kind,qt,ie,ce,g,or,yo,ws,w,Un,it,wr,Pe,Hr,ur,ht.getProjection());const Nl={program:g.useProgram(Hc(wt,w,ht),ot,Fs),buffers:Vt,uniformValues:gl,atlasTexture:ti,atlasTextureIcon:wi,atlasInterpolation:An,atlasInterpolationIcon:Hn,isSDF:wt,hasHalo:Yh,tile:Tt,labelPlaneMatrixInv:_o};if(me&&ht.canOverlap){be=!0;const Bl=Vt.segments.get();for(const zl of Bl)We.push({segments:new p.SegmentVector([zl]),sortKey:zl.sortKey,state:Nl})}else We.push({segments:Vt.segments,sortKey:0,state:Nl})}be&&We.sort((it,Tt)=>it.sortKey-Tt.sortKey);for(const it of We){const Tt=it.state;if(g.terrain&&g.terrain.setupElevationDraw(Tt.tile,Tt.program,{useDepthForOcclusion:!Ke,labelPlaneMatrixInv:Tt.labelPlaneMatrixInv}),Q.activeTexture.set(re.TEXTURE0),Tt.atlasTexture.bind(Tt.atlasInterpolation,re.CLAMP_TO_EDGE),Tt.atlasTextureIcon&&(Q.activeTexture.set(re.TEXTURE1),Tt.atlasTextureIcon&&Tt.atlasTextureIcon.bind(Tt.atlasInterpolationIcon,re.CLAMP_TO_EDGE)),Tt.isSDF){const ht=Tt.uniformValues;Tt.hasHalo&&(ht.u_is_halo=1,Os(Tt.buffers,it.segments,h,g,Tt.program,Le,B,$,ht)),ht.u_is_halo=0}Os(Tt.buffers,it.segments,h,g,Tt.program,Le,B,$,Tt.uniformValues)}}function Os(g,c,h,_,w,C,I,A,P){const N=_.context,B=[g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer,g.globeExtVertexBuffer];w.draw(N,N.gl.TRIANGLES,C,I,A,p.CullFaceMode.disabled,P,h.id,g.layoutVertexBuffer,g.indexBuffer,c,h.paint,_.transform.zoom,g.programConfigurations.get(h.id),B)}function qc(g,c,h,_,w,C,I){const A=g.context.gl,P=h.paint.get("fill-pattern"),N=P&&P.constantOr(1);let B,$,Q,re,ae;I?($=N&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=A.LINES):($=N?"fillPattern":"fill",B=A.TRIANGLES);for(const se of _){const ce=c.getTile(se);if(N&&!ce.patternsLoaded())continue;const q=ce.getBucket(h);if(!q)continue;g.prepareDrawTile();const ie=q.programConfigurations.get(h.id),me=g.useProgram($,ie);N&&(g.context.activeTexture.set(A.TEXTURE0),ce.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),ie.updatePaintBuffers());const be=P.constantOr(null);if(be&&ce.imageAtlas){const Pe=ce.imageAtlas.patternPositions[be.toString()];Pe&&ie.setConstantPatternPositions(Pe)}const Le=g.translatePosMatrix(se.projMatrix,ce,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(I){re=q.indexBuffer2,ae=q.segments2;const Pe=g.terrain&&g.terrain.renderingToTexture?g.terrain.drapeBufferSize:[A.drawingBufferWidth,A.drawingBufferHeight];Q="fillOutlinePattern"===$&&N?Rs(Le,g,ce,Pe):ks(Le,Pe)}else re=q.indexBuffer,ae=q.segments,Q=N?xr(Le,g,ce):Po(Le);g.prepareDrawProgram(g.context,me,se.toUnwrapped()),me.draw(g.context,B,w,g.stencilModeForClipping(se),C,p.CullFaceMode.disabled,Q,h.id,q.layoutVertexBuffer,re,ae,h.paint,g.transform.zoom,ie)}}function Id(g,c,h,_,w,C,I){const A=g.context,P=A.gl,N=g.transform,B=h.paint.get("fill-extrusion-pattern"),$=B.constantOr(1),Q=h.paint.get("fill-extrusion-opacity"),re=[h.paint.get("fill-extrusion-ambient-occlusion-intensity"),h.paint.get("fill-extrusion-ambient-occlusion-radius")],ae=h.layout.get("fill-extrusion-edge-radius"),se=ae>0&&!h.paint.get("fill-extrusion-rounded-roof"),ce=se?0:ae,q="globe"===N.projection.name?p.fillExtrusionHeightLift():0,ie="globe"===N.projection.name,me=ie?p.globeToMercatorTransition(N.zoom):0,be=[p.mercatorXfromLng(N.center.lng),p.mercatorYfromLat(N.center.lat)],Le=[];ie&&Le.push("PROJECTION_GLOBE_VIEW"),re[0]>0&&Le.push("FAUX_AO"),se&&Le.push("ZERO_ROOF_RADIUS");for(const Pe of _){const Oe=c.getTile(Pe),Ke=Oe.getBucket(h);if(!Ke||Ke.projection.name!==N.projection.name)continue;const We=Ke.programConfigurations.get(h.id),at=g.useProgram($?"fillExtrusionPattern":"fillExtrusion",We,Le);if(g.terrain){const wt=g.terrain;if(g.style.terrainSetForDrapingOnly())wt.setupElevationDraw(Oe,at,{useMeterToDem:!0});else{if(!Ke.enableTerrain)continue;if(wt.setupElevationDraw(Oe,at,{useMeterToDem:!0}),Gr(A,c,Pe,Ke,h,wt),!Ke.centroidVertexBuffer){const Ut=at.attributes.a_centroid_pos;void 0!==Ut&&P.vertexAttrib2f(Ut,0,0)}}}$&&(g.context.activeTexture.set(P.TEXTURE0),Oe.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),We.updatePaintBuffers());const zt=B.constantOr(null);if(zt&&Oe.imageAtlas){const wt=Oe.imageAtlas.patternPositions[zt.toString()];wt&&We.setConstantPatternPositions(wt)}const it=g.translatePosMatrix(Pe.projMatrix,Oe,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Tt=N.projection.createInversionMatrix(N,Pe.canonical),ht=h.paint.get("fill-extrusion-vertical-gradient"),Vt=$?Ft(it,g,ht,Q,re,ce,Pe,Oe,q,me,be,Tt):Oh(it,g,ht,Q,re,ce,Pe,q,me,be,Tt);g.prepareDrawProgram(A,at,Pe.toUnwrapped());const ot=[];g.terrain&&ot.push(Ke.centroidVertexBuffer),ie&&ot.push(Ke.layoutVertexExtBuffer),at.draw(A,A.gl.TRIANGLES,w,C,I,p.CullFaceMode.backCCW,Vt,h.id,Ke.layoutVertexBuffer,Ke.indexBuffer,Ke.segments,h.paint,g.transform.zoom,We,ot)}}function Gr(g,c,h,_,w,C){const I=[q=>{let ie=q.canonical.x-1,me=q.wrap;return ie<0&&(ie=(1<<q.canonical.z)-1,me--),new p.OverscaledTileID(q.overscaledZ,me,q.canonical.z,ie,q.canonical.y)},q=>{let ie=q.canonical.x+1,me=q.wrap;return ie===1<<q.canonical.z&&(ie=0,me++),new p.OverscaledTileID(q.overscaledZ,me,q.canonical.z,ie,q.canonical.y)},q=>new p.OverscaledTileID(q.overscaledZ,q.wrap,q.canonical.z,q.canonical.x,(0===q.canonical.y?1<<q.canonical.z:q.canonical.y)-1),q=>new p.OverscaledTileID(q.overscaledZ,q.wrap,q.canonical.z,q.canonical.x,q.canonical.y===(1<<q.canonical.z)-1?0:q.canonical.y+1)],A=q=>{const ie=c.getSource().minzoom,me=Le=>{const Pe=c.getTileByID(Le);if(Pe&&Pe.hasData())return Pe.getBucket(w)},be=[0,-1,1];for(const Le of be){if(q.overscaledZ+Le<ie)continue;const Pe=me(q.calculateScaledKey(q.overscaledZ+Le));if(Pe)return Pe}},P=[0,0,0],N=(q,ie)=>(P[0]=Math.min(q.min.y,ie.min.y),P[1]=Math.max(q.max.y,ie.max.y),P[2]=p.EXTENT-ie.min.x>q.max.x?ie.min.x-p.EXTENT:q.max.x,P),B=(q,ie)=>(P[0]=Math.min(q.min.x,ie.min.x),P[1]=Math.max(q.max.x,ie.max.x),P[2]=p.EXTENT-ie.min.y>q.max.y?ie.min.y-p.EXTENT:q.max.y,P),$=[(q,ie)=>N(q,ie),(q,ie)=>N(ie,q),(q,ie)=>B(q,ie),(q,ie)=>B(ie,q)],Q=new p.Point(0,0);let re,ae,se;const ce=(q,ie,me,be,Le)=>{const Pe=[[be?me:q,be?q:me,0],[be?me:ie,be?ie:me,0]],Oe=Le<0?p.EXTENT+Le:Le,Ke=[be?Oe:(q+ie)/2,be?(q+ie)/2:Oe,0];return 0===me&&Le<0||0!==me&&Le>0?C.getForTilePoints(se,[Ke],!0,ae):Pe.push(Ke),C.getForTilePoints(h,Pe,!0,re),Math.max(Pe[0][2],Pe[1][2],Ke[2])/C.exaggeration()};for(let q=0;q<4;q++){const ie=(q<2?1:5)-q,me=_.borders[q];if(0===me.length)continue;const be=se=I[q](h),Le=A(be);if(!(Le&&Le instanceof p.FillExtrusionBucket&&Le.enableTerrain)||_.borderDoneWithNeighborZ[q]===Le.canonical.z&&Le.borderDoneWithNeighborZ[ie]===_.canonical.z||(ae=C.findDEMTileFor(be),!ae||!ae.dem))continue;if(!re){const We=C.findDEMTileFor(h);if(!We||!We.dem)return;re=We}const Pe=Le.borders[ie];let Oe=0;const Ke=Le.borderDoneWithNeighborZ[ie]!==_.canonical.z;if(_.canonical.z===Le.canonical.z){for(let We=0;We<me.length;We++){const at=_.featuresOnBorder[me[We]],zt=at.borders[q];let it;for(;Oe<Pe.length&&(it=Le.featuresOnBorder[Pe[Oe]],!(it.borders[ie][1]>zt[0]+3));)Ke&&Le.encodeCentroid(void 0,it,!1),Oe++;if(it&&Oe<Pe.length){const Tt=Oe;let ht=0;for(;!(it.borders[ie][0]>zt[1]-3)&&(ht++,++Oe!==Pe.length);)it=Le.featuresOnBorder[Pe[Oe]];if(it=Le.featuresOnBorder[Pe[Tt]],at.intersectsCount()>1||it.intersectsCount()>1||1!==ht){1!==ht&&(Oe=Tt),_.encodeCentroid(void 0,at,!1),Ke&&Le.encodeCentroid(void 0,it,!1);continue}const Vt=$[q](at,it),ot=q%2?p.EXTENT-1:0;Q.x=ce(Vt[0],Math.min(p.EXTENT-1,Vt[1]),ot,q<2,Vt[2]),Q.y=0,_.encodeCentroid(Q,at,!1),Ke&&Le.encodeCentroid(Q,it,!1)}else _.encodeCentroid(void 0,at,!1)}_.borderDoneWithNeighborZ[q]=Le.canonical.z,_.needsCentroidUpdate=!0,Ke&&(Le.borderDoneWithNeighborZ[ie]=_.canonical.z,Le.needsCentroidUpdate=!0)}else{for(const We of me)_.encodeCentroid(void 0,_.featuresOnBorder[We],!1);if(Ke){for(const We of Pe)Le.encodeCentroid(void 0,Le.featuresOnBorder[We],!1);Le.borderDoneWithNeighborZ[ie]=_.canonical.z,Le.needsCentroidUpdate=!0}_.borderDoneWithNeighborZ[q]=Le.canonical.z,_.needsCentroidUpdate=!0}}(_.needsCentroidUpdate||!_.centroidVertexBuffer&&0!==_.centroidVertexArray.length)&&_.uploadCentroid(g)}const Tu=new p.Color(1,0,0,1),o_=new p.Color(0,1,0,1),Zs=new p.Color(0,0,1,1),Va=new p.Color(1,0,1,1),Qp=new p.Color(0,1,1,1);function Fh(g,c,h){const _=g.context,w=g.transform,C=_.gl,I="globe"===w.projection.name,A=I?["PROJECTION_GLOBE_VIEW"]:null;let P=h.projMatrix;if(I&&p.globeToMercatorTransition(w.zoom)>0){const at=p.transitionTileAABBinECEF(h.canonical,w),zt=p.globeDenormalizeECEF(at);P=p.multiply(new Float32Array(16),w.globeMatrix,zt),p.multiply(P,w.projMatrix,P)}const N=g.useProgram("debug",null,A),B=c.getTileByID(h.key);g.terrain&&g.terrain.setupElevationDraw(B,N);const $=p.DepthMode.disabled,Q=p.StencilMode.disabled,re=g.colorModeForRenderPass();_.activeTexture.set(C.TEXTURE0),g.emptyTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),I?B._makeGlobeTileDebugBuffers(g.context,w):B._makeDebugTileBoundsBuffers(g.context,w.projection);const se=B._tileDebugBuffer||g.debugBuffer,ce=B._tileDebugIndexBuffer||g.debugIndexBuffer,q=B._tileDebugSegments||g.debugSegments;N.draw(_,C.LINE_STRIP,$,Q,re,p.CullFaceMode.disabled,sc(P,p.Color.red),"$debug",se,ce,q,null,null,null,[B._globeTileDebugBorderBuffer]);const ie=B.latestRawTileData,me=Math.floor((ie&&ie.byteLength||0)/1024),be=c.getTile(h).tileSize,Le=512/Math.min(be,512)*(h.overscaledZ/w.zoom)*.5;let Pe=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(Pe+=` => ${h.overscaledZ}`),Pe+=` ${me}kb`,function(at,zt){at.initDebugOverlayCanvas();const it=at.debugOverlayCanvas,Tt=at.context.gl,ht=at.debugOverlayCanvas.getContext("2d");ht.clearRect(0,0,it.width,it.height),ht.shadowColor="white",ht.shadowBlur=2,ht.lineWidth=1.5,ht.strokeStyle="white",ht.textBaseline="top",ht.font="bold 36px Open Sans, sans-serif",ht.fillText(zt,5,5),ht.strokeText(zt,5,5),at.debugOverlayTexture.update(it),at.debugOverlayTexture.bind(Tt.LINEAR,Tt.CLAMP_TO_EDGE)}(g,Pe);const Oe=B._tileDebugTextBuffer||g.debugBuffer,Ke=B._tileDebugTextIndexBuffer||g.quadTriangleIndexBuffer,We=B._tileDebugTextSegments||g.debugSegments;N.draw(_,C.TRIANGLES,$,Q,p.ColorMode.alphaBlended,p.CullFaceMode.disabled,sc(P,p.Color.transparent,Le),"$debug",Oe,Ke,We,null,null,null,[B._globeTileDebugTextBuffer])}function Md(g,c,h,_){Eu(g,0,c+h/2,g.transform.width,h,_)}function Ys(g,c,h,_){Eu(g,c-h/2,0,h,g.transform.height,_)}function Eu(g,c,h,_,w,C){const I=g.context,A=I.gl;A.enable(A.SCISSOR_TEST),A.scissor(c*p.exported.devicePixelRatio,h*p.exported.devicePixelRatio,_*p.exported.devicePixelRatio,w*p.exported.devicePixelRatio),I.clear({color:C}),A.disable(A.SCISSOR_TEST)}const s_=p.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Hm}=s_;function Ll(g,c,h,_){g.emplaceBack(c,h,_)}class Jp{constructor(c){this.vertexArray=new p.StructArrayLayout3f12,this.indices=new p.StructArrayLayout3ui6,Ll(this.vertexArray,-1,-1,1),Ll(this.vertexArray,1,-1,1),Ll(this.vertexArray,-1,1,1),Ll(this.vertexArray,1,1,1),Ll(this.vertexArray,-1,-1,-1),Ll(this.vertexArray,1,-1,-1),Ll(this.vertexArray,-1,1,-1),Ll(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=c.createVertexBuffer(this.vertexArray,Hm),this.indexBuffer=c.createIndexBuffer(this.indices),this.segment=p.SegmentVector.simpleSegment(0,0,36,12)}}function ja(g,c,h,_,w,C){const I=g.gl,A=c.paint.get("sky-atmosphere-color"),P=c.paint.get("sky-atmosphere-halo-color"),N=c.paint.get("sky-atmosphere-sun-intensity"),B={u_matrix_3f:p.fromMat4(p.create$1(),_),u_sun_direction:w,u_sun_intensity:N,u_color_tint_r:[(ae=A).r,ae.g,ae.b,ae.a],u_color_tint_m:[(se=P).r,se.g,se.b,se.a],u_luminance:5e-5};var ae,se;I.framebufferTexture2D(I.FRAMEBUFFER,I.COLOR_ATTACHMENT0,I.TEXTURE_CUBE_MAP_POSITIVE_X+C,c.skyboxTexture,0),h.draw(g,I.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,p.ColorMode.unblended,p.CullFaceMode.frontCW,B,"skyboxCapture",c.skyboxGeometry.vertexBuffer,c.skyboxGeometry.indexBuffer,c.skyboxGeometry.segment)}const Nh=p.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class a_{constructor(c){const h=new p.StructArrayLayout5f20;h.emplaceBack(-1,1,1,0,0),h.emplaceBack(1,1,1,1,0),h.emplaceBack(1,-1,1,1,1),h.emplaceBack(-1,-1,1,0,1);const _=new p.StructArrayLayout3ui6;_.emplaceBack(0,1,2),_.emplaceBack(2,3,0),this.vertexBuffer=c.createVertexBuffer(h,Nh.members),this.indexBuffer=c.createIndexBuffer(_),this.segments=p.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Du={symbol:function(g,c,h,_,w){if("translucent"!==g.renderPass)return;const C=p.StencilMode.disabled,I=g.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(A,P,N,B,$,Q,re){const ae=P.transform,se="map"===$,ce="map"===Q;for(const q of A){const ie=B.getTile(q),me=ie.getBucket(N);if(!me||!me.text||!me.text.segments.get().length)continue;const be=p.evaluateSizeForZoom(me.textSizeData,ae.zoom),Le=eo(q,me.getProjection(),ae),Pe=ae.calculatePixelsToTileUnitsMatrix(ie),Oe=_t(Le,ie.tileID.canonical,ce,se,ae,me.getProjection(),Pe),Ke="none"!==N.layout.get("icon-text-fit")&&me.hasIconData();if(be){const We=Math.pow(2,ae.zoom-ie.tileID.overscaledZ);vs(me,se,ce,re,p.symbolSize,ae,Oe,q,We,be,Ke)}}}(_,g,h,c,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),w),0!==h.paint.get("icon-opacity").constantOr(1)&&$c(g,c,h,_,!1,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),h.layout.get("icon-rotation-alignment"),h.layout.get("icon-pitch-alignment"),h.layout.get("icon-keep-upright"),C,I),0!==h.paint.get("text-opacity").constantOr(1)&&$c(g,c,h,_,!0,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),h.layout.get("text-keep-upright"),C,I),c.map.showCollisionBoxes&&(pl(g,c,h,_,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),pl(g,c,h,_,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(g,c,h,_){if("translucent"!==g.renderPass)return;const w=h.paint.get("circle-opacity"),C=h.paint.get("circle-stroke-width"),I=h.paint.get("circle-stroke-opacity"),A=void 0!==h.layout.get("circle-sort-key").constantOr(1);if(0===w.constantOr(1)&&(0===C.constantOr(1)||0===I.constantOr(1)))return;const P=g.context,N=P.gl,B=g.transform,$=g.depthModeForSublayer(0,p.DepthMode.ReadOnly),Q=p.StencilMode.disabled,re=g.colorModeForRenderPass(),ae="globe"===B.projection.name,se=[p.mercatorXfromLng(B.center.lng),p.mercatorYfromLat(B.center.lat)],ce=[];for(let ie=0;ie<_.length;ie++){const me=_[ie],be=c.getTile(me),Le=be.getBucket(h);if(!Le||Le.projection.name!==B.projection.name)continue;const Pe=Le.programConfigurations.get(h.id),Oe=Cu(h);ae&&Oe.push("PROJECTION_GLOBE_VIEW");const Ke=g.useProgram("circle",Pe,Oe),We=Le.layoutVertexBuffer,at=Le.globeExtVertexBuffer,zt=Le.indexBuffer,it=B.projection.createInversionMatrix(B,me.canonical),Tt={programConfiguration:Pe,program:Ke,layoutVertexBuffer:We,globeExtVertexBuffer:at,indexBuffer:zt,uniformValues:Ps(g,me,be,it,se,h),tile:be};if(A){const ht=Le.segments.get();for(const Vt of ht)ce.push({segments:new p.SegmentVector([Vt]),sortKey:Vt.sortKey,state:Tt})}else ce.push({segments:Le.segments,sortKey:0,state:Tt})}A&&ce.sort((ie,me)=>ie.sortKey-me.sortKey);const q={useDepthForOcclusion:!ae};for(const ie of ce){const{programConfiguration:me,program:be,layoutVertexBuffer:Le,globeExtVertexBuffer:Pe,indexBuffer:Oe,uniformValues:Ke,tile:We}=ie.state,at=ie.segments;g.terrain&&g.terrain.setupElevationDraw(We,be,q),g.prepareDrawProgram(P,be,We.tileID.toUnwrapped()),be.draw(P,N.TRIANGLES,$,Q,re,p.CullFaceMode.disabled,Ke,h.id,Le,Oe,at,h.paint,B.zoom,me,[Pe])}},heatmap:function(g,c,h,_){if(0!==h.paint.get("heatmap-opacity"))if("offscreen"===g.renderPass){const w=g.context,C=w.gl,I=p.StencilMode.disabled,A=new p.ColorMode([C.ONE,C.ONE],p.Color.transparent,[!0,!0,!0,!0]);(function(re,ae,se,ce){const q=re.gl,ie=ae.width*ce,me=ae.height*ce;re.activeTexture.set(q.TEXTURE1),re.viewport.set([0,0,ie,me]);let be=se.heatmapFbo;if(!be||be&&(be.width!==ie||be.height!==me)){be&&be.destroy();const Le=q.createTexture();q.bindTexture(q.TEXTURE_2D,Le),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MIN_FILTER,q.LINEAR),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MAG_FILTER,q.LINEAR),be=se.heatmapFbo=re.createFramebuffer(ie,me,!1),function(Pe,Oe,Ke,We,at,zt){const it=Pe.gl;it.texImage2D(it.TEXTURE_2D,0,Pe.isWebGL2&&Pe.extRenderToTextureHalfFloat?it.RGBA16F:it.RGBA,at,zt,0,it.RGBA,Pe.extRenderToTextureHalfFloat?Pe.isWebGL2?it.HALF_FLOAT:Pe.extTextureHalfFloat.HALF_FLOAT_OES:it.UNSIGNED_BYTE,null),We.colorAttachment.set(Ke)}(re,0,Le,be,ie,me)}else q.bindTexture(q.TEXTURE_2D,be.colorAttachment.get()),re.bindFramebuffer.set(be.framebuffer)})(w,g,h,"globe"===g.transform.projection.name?.5:.25),w.clear({color:p.Color.transparent});const P=g.transform,N="globe"===P.projection.name,B=N?["PROJECTION_GLOBE_VIEW"]:null,$=N?p.CullFaceMode.frontCCW:p.CullFaceMode.disabled,Q=[p.mercatorXfromLng(P.center.lng),p.mercatorYfromLat(P.center.lat)];for(let re=0;re<_.length;re++){const ae=_[re];if(c.hasRenderableParent(ae))continue;const se=c.getTile(ae),ce=se.getBucket(h);if(!ce||ce.projection.name!==P.projection.name)continue;const q=ce.programConfigurations.get(h.id),ie=g.useProgram("heatmap",q,B),{zoom:me}=g.transform;g.terrain&&g.terrain.setupElevationDraw(se,ie),g.prepareDrawProgram(w,ie,ae.toUnwrapped());const be=P.projection.createInversionMatrix(P,ae.canonical);ie.draw(w,C.TRIANGLES,p.DepthMode.disabled,I,A,$,ac(g,ae,se,be,Q,me,h.paint.get("heatmap-intensity")),h.id,ce.layoutVertexBuffer,ce.indexBuffer,ce.segments,h.paint,g.transform.zoom,q,N?[ce.globeExtVertexBuffer]:null)}w.viewport.set([0,0,g.width,g.height])}else"translucent"===g.renderPass&&(g.context.setColorMode(g.colorModeForRenderPass()),function(w,C){const I=w.context,A=I.gl,P=C.heatmapFbo;if(!P)return;I.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,P.colorAttachment.get()),I.activeTexture.set(A.TEXTURE1);let N=C.colorRampTexture;N||(N=C.colorRampTexture=new p.Texture(I,C.colorRamp,A.RGBA)),N.bind(A.LINEAR,A.CLAMP_TO_EDGE),w.useProgram("heatmapTexture").draw(I,A.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,w.colorModeForRenderPass(),p.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:C.paint.get("heatmap-opacity")},C.id,w.viewportBuffer,w.quadTriangleIndexBuffer,w.viewportSegments,C.paint,w.transform.zoom)}(g,h))},line:function(g,c,h,_){if("translucent"!==g.renderPass)return;const w=h.paint.get("line-opacity"),C=h.paint.get("line-width");if(0===w.constantOr(1)||0===C.constantOr(1))return;const I=g.depthModeForSublayer(0,p.DepthMode.ReadOnly),A=g.colorModeForRenderPass(),P=g.terrain&&g.terrain.renderingToTexture?1:p.exported.devicePixelRatio,N=h.paint.get("line-dasharray"),B=N.constantOr(1),$=h.layout.get("line-cap"),Q=h.paint.get("line-pattern"),re=Q.constantOr(1),ae=h.paint.get("line-gradient"),se=re?"linePattern":"line",ce=g.context,q=ce.gl,ie=(be=>{const Le=[];Di(be)&&Le.push("RENDER_LINE_DASH"),be.paint.get("line-gradient")&&Le.push("RENDER_LINE_GRADIENT");const Pe=be.paint.get("line-trim-offset");0===Pe[0]&&0===Pe[1]||Le.push("RENDER_LINE_TRIM_OFFSET");const Oe=be.paint.get("line-pattern").constantOr(1),Ke=1!==be.paint.get("line-opacity").constantOr(1);return!Oe&&Ke&&Le.push("RENDER_LINE_ALPHA_DISCARD"),Le})(h);let me=ie.includes("RENDER_LINE_ALPHA_DISCARD");g.terrain&&g.terrain.clipOrMaskOverlapStencilType()&&(me=!1);for(const be of _){const Le=c.getTile(be);if(re&&!Le.patternsLoaded())continue;const Pe=Le.getBucket(h);if(!Pe)continue;g.prepareDrawTile();const Oe=Pe.programConfigurations.get(h.id),Ke=g.useProgram(se,Oe,ie),We=Q.constantOr(null);if(We&&Le.imageAtlas){const wt=Le.imageAtlas.patternPositions[We.toString()];wt&&Oe.setConstantPatternPositions(wt)}const at=N.constantOr(null),zt=$.constantOr(null);if(!re&&at&&zt&&Le.lineAtlas){const wt=Le.lineAtlas.getDash(at,zt);wt&&Oe.setConstantPatternPositions(wt)}let[it,Tt]=h.paint.get("line-trim-offset");("round"===zt||"square"===zt)&&it!==Tt&&(0===it&&(it-=1),1===Tt&&(Tt+=1));const ht=g.terrain?be.projMatrix:null,Vt=re?Ed(g,Le,h,ht,P):ys(g,Le,h,ht,Pe.lineClipsArray.length,P,[it,Tt]);if(ae){const wt=Pe.gradients[h.id];let Ut=wt.texture;if(h.gradientVersion!==wt.version){let At=256;if(h.stepInterpolant){const qt=c.getSource().maxzoom,Un=be.canonical.z===qt?Math.ceil(1<<g.transform.maxZoom-be.canonical.z):1;At=p.clamp(p.nextPowerOfTwo(Pe.maxLineLength/p.EXTENT*1024*Un),256,ce.maxTextureSize)}wt.gradient=p.renderColorRamp({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:At,image:wt.gradient||void 0,clips:Pe.lineClipsArray}),wt.texture?wt.texture.update(wt.gradient):wt.texture=new p.Texture(ce,wt.gradient,q.RGBA),wt.version=h.gradientVersion,Ut=wt.texture}ce.activeTexture.set(q.TEXTURE1),Ut.bind(h.stepInterpolant?q.NEAREST:q.LINEAR,q.CLAMP_TO_EDGE)}B&&(ce.activeTexture.set(q.TEXTURE0),Le.lineAtlasTexture.bind(q.LINEAR,q.REPEAT),Oe.updatePaintBuffers()),re&&(ce.activeTexture.set(q.TEXTURE0),Le.imageAtlasTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE),Oe.updatePaintBuffers()),g.prepareDrawProgram(ce,Ke,be.toUnwrapped());const ot=wt=>{Ke.draw(ce,q.TRIANGLES,I,wt,A,p.CullFaceMode.disabled,Vt,h.id,Pe.layoutVertexBuffer,Pe.indexBuffer,Pe.segments,h.paint,g.transform.zoom,Oe,[Pe.layoutVertexBuffer2])};if(me){const wt=g.stencilModeForClipping(be).ref;0===wt&&g.terrain&&ce.clear({stencil:0});const Ut={func:q.EQUAL,mask:255};Vt.u_alpha_discard_threshold=.8,ot(new p.StencilMode(Ut,wt,255,q.KEEP,q.KEEP,q.INVERT)),Vt.u_alpha_discard_threshold=0,ot(new p.StencilMode(Ut,wt,255,q.KEEP,q.KEEP,q.KEEP))}else ot(g.stencilModeForClipping(be))}me&&(g.resetStencilClippingMasks(),g.terrain&&ce.clear({stencil:0}))},fill:function(g,c,h,_){const w=h.paint.get("fill-color"),C=h.paint.get("fill-opacity");if(0===C.constantOr(1))return;const I=g.colorModeForRenderPass(),A=h.paint.get("fill-pattern"),P=g.opaquePassEnabledForLayer()&&!A.constantOr(1)&&1===w.constantOr(p.Color.transparent).a&&1===C.constantOr(0)?"opaque":"translucent";if(g.renderPass===P){const N=g.depthModeForSublayer(1,"opaque"===g.renderPass?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly);qc(g,c,h,_,N,I,!1)}if("translucent"===g.renderPass&&h.paint.get("fill-antialias")){const N=g.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,p.DepthMode.ReadOnly);qc(g,c,h,_,N,I,!0)}},"fill-extrusion":function(g,c,h,_){const w=h.paint.get("fill-extrusion-opacity");if(0!==w&&"translucent"===g.renderPass){const C=new p.DepthMode(g.context.gl.LEQUAL,p.DepthMode.ReadWrite,g.depthRangeFor3D);if(1!==w||h.paint.get("fill-extrusion-pattern").constantOr(1))Id(g,c,h,_,C,p.StencilMode.disabled,p.ColorMode.disabled),Id(g,c,h,_,C,g.stencilModeFor3D(),g.colorModeForRenderPass()),g.resetStencilClippingMasks();else{const I=g.colorModeForRenderPass();Id(g,c,h,_,C,p.StencilMode.disabled,I)}}},hillshade:function(g,c,h,_){if("offscreen"!==g.renderPass&&"translucent"!==g.renderPass)return;const w=g.context,C=g.depthModeForSublayer(0,p.DepthMode.ReadOnly),I=g.colorModeForRenderPass(),A=g.terrain&&g.terrain.renderingToTexture,[P,N]="translucent"!==g.renderPass||A?[{},_]:g.stencilConfigForOverlap(_);for(const B of N){const $=c.getTile(B);if($.needsHillshadePrepare&&"offscreen"===g.renderPass)qr(g,$,h,C,p.StencilMode.disabled,I);else if("translucent"===g.renderPass){const Q=A&&g.terrain?g.terrain.stencilModeForRTTOverlap(B):P[B.overscaledZ];r_(g,B,$,h,C,Q,I)}}w.viewport.set([0,0,g.width,g.height]),g.resetStencilClippingMasks()},raster:function(g,c,h,_,w,C){if("translucent"!==g.renderPass||0===h.paint.get("raster-opacity")||!_.length)return;const I=g.context,A=I.gl,P=c.getSource(),N=g.useProgram("raster"),B=g.colorModeForRenderPass(),$=g.terrain&&g.terrain.renderingToTexture,[Q,re]=P instanceof ai||$?[{},_]:g.stencilConfigForOverlap(_),ae=re[re.length-1].overscaledZ,se=!g.options.moving;for(const ce of re){const q=$?p.DepthMode.disabled:g.depthModeForSublayer(ce.overscaledZ-ae,1===h.paint.get("raster-opacity")?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly,A.LESS),ie=ce.toUnwrapped(),me=c.getTile(ce);if($&&(!me||!me.hasData()))continue;const be=$?ce.projMatrix:g.transform.calculateProjMatrix(ie,se),Le=g.terrain&&$?g.terrain.stencilModeForRTTOverlap(ce):Q[ce.overscaledZ],Pe=C?0:h.paint.get("raster-fade-duration");me.registerFadeDuration(Pe);const Oe=c.findLoadedParent(ce,0),Ke=Vc(me,Oe,c,g.transform,Pe);let We,at;g.terrain&&g.terrain.prepareDrawTile();const zt="nearest"===h.paint.get("raster-resampling")?A.NEAREST:A.LINEAR;I.activeTexture.set(A.TEXTURE0),me.texture.bind(zt,A.CLAMP_TO_EDGE),I.activeTexture.set(A.TEXTURE1),Oe?(Oe.texture.bind(zt,A.CLAMP_TO_EDGE),We=Math.pow(2,Oe.tileID.overscaledZ-me.tileID.overscaledZ),at=[me.tileID.canonical.x*We%1,me.tileID.canonical.y*We%1]):me.texture.bind(zt,A.CLAMP_TO_EDGE),me.texture.useMipmap&&I.extTextureFilterAnisotropic&&g.transform.pitch>20&&A.texParameterf(A.TEXTURE_2D,I.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,I.extTextureFilterAnisotropicMax);const it=Yr(be,at||[0,0],We||1,Ke,h,P instanceof ai?P.perspectiveTransform:[0,0]);if(g.prepareDrawProgram(I,N,ie),P instanceof ai)P.boundsBuffer&&P.boundsSegments&&N.draw(I,A.TRIANGLES,q,p.StencilMode.disabled,B,p.CullFaceMode.disabled,it,h.id,P.boundsBuffer,g.quadTriangleIndexBuffer,P.boundsSegments);else{const{tileBoundsBuffer:Tt,tileBoundsIndexBuffer:ht,tileBoundsSegments:Vt}=g.getTileBoundsBuffers(me);N.draw(I,A.TRIANGLES,q,Le,B,p.CullFaceMode.disabled,it,h.id,Tt,ht,Vt)}}g.resetStencilClippingMasks()},background:function(g,c,h,_){const w=h.paint.get("background-color"),C=h.paint.get("background-opacity");if(0===C)return;const I=g.context,A=I.gl,P=g.transform,N=P.tileSize,B=h.paint.get("background-pattern");if(g.isPatternMissing(B))return;const $=!B&&1===w.a&&1===C&&g.opaquePassEnabledForLayer()?"opaque":"translucent";if(g.renderPass!==$)return;const Q=p.StencilMode.disabled,re=g.depthModeForSublayer(0,"opaque"===$?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly),ae=g.colorModeForRenderPass(),se=g.useProgram(B?"backgroundPattern":"background");let ce,q=_;q||(ce=g.getBackgroundTiles(),q=Object.values(ce).map(ie=>ie.tileID)),B&&(I.activeTexture.set(A.TEXTURE0),g.imageManager.bind(g.context));for(const ie of q){const me=ie.toUnwrapped(),be=_?ie.projMatrix:g.transform.calculateProjMatrix(me);g.prepareDrawTile();const Le=c?c.getTile(ie):ce?ce[ie.key]:new p.Tile(ie,N,P.zoom,g),Pe=B?Dd(be,C,g,B,{tileID:ie,tileSize:N}):jc(be,C,w);g.prepareDrawProgram(I,se,me);const{tileBoundsBuffer:Oe,tileBoundsIndexBuffer:Ke,tileBoundsSegments:We}=g.getTileBoundsBuffers(Le);se.draw(I,A.TRIANGLES,re,Q,ae,p.CullFaceMode.disabled,Pe,h.id,Oe,Ke,We)}},sky:function(g,c,h){const _=g.transform,w="mercator"===_.projection.name||"globe"===_.projection.name?1:p.smoothstep(7,8,_.zoom),C=h.paint.get("sky-opacity")*w;if(0===C)return;const I=g.context,A=h.paint.get("sky-type"),P=new p.DepthMode(I.gl.LEQUAL,p.DepthMode.ReadOnly,[0,1]),N=g.frameCounter/1e3%1;"atmosphere"===A?"offscreen"===g.renderPass?h.needsSkyboxCapture(g)&&(function(B,$,Q,re){const ae=B.context,se=ae.gl;let ce=$.skyboxFbo;if(!ce){ce=$.skyboxFbo=ae.createFramebuffer(32,32,!1),$.skyboxGeometry=new Jp(ae),$.skyboxTexture=ae.gl.createTexture(),se.bindTexture(se.TEXTURE_CUBE_MAP,$.skyboxTexture),se.texParameteri(se.TEXTURE_CUBE_MAP,se.TEXTURE_WRAP_S,se.CLAMP_TO_EDGE),se.texParameteri(se.TEXTURE_CUBE_MAP,se.TEXTURE_WRAP_T,se.CLAMP_TO_EDGE),se.texParameteri(se.TEXTURE_CUBE_MAP,se.TEXTURE_MIN_FILTER,se.LINEAR),se.texParameteri(se.TEXTURE_CUBE_MAP,se.TEXTURE_MAG_FILTER,se.LINEAR);for(let be=0;be<6;++be)se.texImage2D(se.TEXTURE_CUBE_MAP_POSITIVE_X+be,0,se.RGBA,32,32,0,se.RGBA,se.UNSIGNED_BYTE,null)}ae.bindFramebuffer.set(ce.framebuffer),ae.viewport.set([0,0,32,32]);const q=$.getCenter(B,!0),ie=B.useProgram("skyboxCapture"),me=new Float64Array(16);p.identity(me),p.rotateY(me,me,.5*-Math.PI),ja(ae,$,ie,me,q,0),p.identity(me),p.rotateY(me,me,.5*Math.PI),ja(ae,$,ie,me,q,1),p.identity(me),p.rotateX(me,me,.5*-Math.PI),ja(ae,$,ie,me,q,2),p.identity(me),p.rotateX(me,me,.5*Math.PI),ja(ae,$,ie,me,q,3),p.identity(me),ja(ae,$,ie,me,q,4),p.identity(me),p.rotateY(me,me,Math.PI),ja(ae,$,ie,me,q,5),ae.viewport.set([0,0,B.width,B.height])}(g,h),h.markSkyboxValid(g)):"sky"===g.renderPass&&function(B,$,Q,re,ae){const se=B.context,ce=se.gl,q=B.transform,ie=B.useProgram("skybox");se.activeTexture.set(ce.TEXTURE0),ce.bindTexture(ce.TEXTURE_CUBE_MAP,$.skyboxTexture);const me={u_matrix:q.skyboxMatrix,u_sun_direction:$.getCenter(B,!1),u_cubemap:0,u_opacity:re,u_temporal_offset:ae};B.prepareDrawProgram(se,ie),ie.draw(se,ce.TRIANGLES,Q,p.StencilMode.disabled,B.colorModeForRenderPass(),p.CullFaceMode.backCW,me,"skybox",$.skyboxGeometry.vertexBuffer,$.skyboxGeometry.indexBuffer,$.skyboxGeometry.segment)}(g,h,P,C,N):"gradient"===A&&"sky"===g.renderPass&&function(B,$,Q,re,ae){const se=B.context,ce=se.gl,q=B.transform,ie=B.useProgram("skyboxGradient");$.skyboxGeometry||($.skyboxGeometry=new Jp(se)),se.activeTexture.set(ce.TEXTURE0);let me=$.colorRampTexture;me||(me=$.colorRampTexture=new p.Texture(se,$.colorRamp,ce.RGBA)),me.bind(ce.LINEAR,ce.CLAMP_TO_EDGE);const be=(Le=q.skyboxMatrix,Pe=$.getCenter(B,!1),Oe=$.paint.get("sky-gradient-radius"),Ke=re,We=ae,{u_matrix:Le,u_color_ramp:0,u_center_direction:Pe,u_radius:p.degToRad(Oe),u_opacity:Ke,u_temporal_offset:We});var Le,Pe,Oe,Ke,We;B.prepareDrawProgram(se,ie),ie.draw(se,ce.TRIANGLES,Q,p.StencilMode.disabled,B.colorModeForRenderPass(),p.CullFaceMode.backCW,be,"skyboxGradient",$.skyboxGeometry.vertexBuffer,$.skyboxGeometry.indexBuffer,$.skyboxGeometry.segment)}(g,h,P,C,N)},debug:function(g,c,h){for(let _=0;_<h.length;_++)Fh(g,c,h[_])},custom:function(g,c,h,_){const w=g.context,C=h.implementation;if(!g.transform.projection.unsupportedLayers||!g.transform.projection.unsupportedLayers.includes("custom")||g.terrain&&(g.terrain.renderingToTexture||"offscreen"===g.renderPass)&&h.isLayerDraped()){if("offscreen"===g.renderPass){const I=C.prerender;if(I){if(g.setCustomLayerDefaults(),w.setColorMode(g.colorModeForRenderPass()),"globe"===g.transform.projection.name){const A=g.transform.pointMerc;I.call(C,w.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),p.globeToMercatorTransition(g.transform.zoom),[A.x,A.y],g.transform.pixelsPerMeterRatio)}else I.call(C,w.gl,g.transform.customLayerMatrix());w.setDirty(),g.setBaseState()}}else if("translucent"===g.renderPass){if(g.terrain&&g.terrain.renderingToTexture){const A=C.renderToTile;if(A){const P=_[0].canonical,N=new p.MercatorCoordinate(P.x+_[0].wrap*(1<<P.z),P.y,P.z);w.setDepthMode(p.DepthMode.disabled),w.setStencilMode(p.StencilMode.disabled),w.setColorMode(g.colorModeForRenderPass()),g.setCustomLayerDefaults(),A.call(C,w.gl,N),w.setDirty(),g.setBaseState()}return}g.setCustomLayerDefaults(),w.setColorMode(g.colorModeForRenderPass()),w.setStencilMode(p.StencilMode.disabled);const I="3d"===C.renderingMode?new p.DepthMode(g.context.gl.LEQUAL,p.DepthMode.ReadWrite,g.depthRangeFor3D):g.depthModeForSublayer(0,p.DepthMode.ReadOnly);if(w.setDepthMode(I),"globe"===g.transform.projection.name){const A=g.transform.pointMerc;C.render(w.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),p.globeToMercatorTransition(g.transform.zoom),[A.x,A.y],g.transform.pixelsPerMeterRatio)}else C.render(w.gl,g.transform.customLayerMatrix());w.setDirty(),g.setBaseState(),w.bindFramebuffer.set(null)}}else p.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class Ad{constructor(c,h,_=!1){this.context=new vt(c,_),this.transform=h,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=p.SourceCache.maxUnderzooming+p.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(c,h){const _=!!c&&!!c.terrain&&this.transform.projection.supportsTerrain;if(!(_||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Ph(this,c));const w=this._terrain;this.transform.elevation=_?w:null,w.update(c,this.transform,h)}_updateFog(c){const h=c.fog;if(!h||"globe"===this.transform.projection.name||h.getOpacity(this.transform.pitch)<1||h.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[_,w]=h.getFovAdjustedRange(this.transform._fov);if(_>w)return void(this.transform.fogCullDistSq=null);const C=_+.78*(w-_);this.transform.fogCullDistSq=C*C}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(c,h){if(this.width=c*p.exported.devicePixelRatio,this.height=h*p.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style.order)this.style._layers[_].resize()}setup(){const c=this.context,h=new p.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(p.EXTENT,0),h.emplaceBack(0,p.EXTENT),h.emplaceBack(p.EXTENT,p.EXTENT),this.tileExtentBuffer=c.createVertexBuffer(h,p.posAttributes.members),this.tileExtentSegments=p.SegmentVector.simpleSegment(0,0,4,2);const _=new p.StructArrayLayout2i4;_.emplaceBack(0,0),_.emplaceBack(p.EXTENT,0),_.emplaceBack(0,p.EXTENT),_.emplaceBack(p.EXTENT,p.EXTENT),this.debugBuffer=c.createVertexBuffer(_,p.posAttributes.members),this.debugSegments=p.SegmentVector.simpleSegment(0,0,4,5);const w=new p.StructArrayLayout2i4;w.emplaceBack(-1,-1),w.emplaceBack(1,-1),w.emplaceBack(-1,1),w.emplaceBack(1,1),this.viewportBuffer=c.createVertexBuffer(w,p.posAttributes.members),this.viewportSegments=p.SegmentVector.simpleSegment(0,0,4,2);const C=new p.StructArrayLayout4i8;C.emplaceBack(0,0,0,0),C.emplaceBack(p.EXTENT,0,p.EXTENT,0),C.emplaceBack(0,p.EXTENT,0,p.EXTENT),C.emplaceBack(p.EXTENT,p.EXTENT,p.EXTENT,p.EXTENT),this.mercatorBoundsBuffer=c.createVertexBuffer(C,p.boundsAttributes.members),this.mercatorBoundsSegments=p.SegmentVector.simpleSegment(0,0,4,2);const I=new p.StructArrayLayout3ui6;I.emplaceBack(0,1,2),I.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=c.createIndexBuffer(I);const A=new p.StructArrayLayout1ui2;for(const N of[0,1,3,2,0])A.emplaceBack(N);this.debugIndexBuffer=c.createIndexBuffer(A),this.emptyTexture=new p.Texture(c,new p.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),c.gl.RGBA),this.identityMat=p.create();const P=this.context.gl;this.stencilClearMode=new p.StencilMode({func:P.ALWAYS,mask:0},0,255,P.ZERO,P.ZERO,P.ZERO),this.loadTimeStamps.push(p.window.performance.now()),this.atmosphereBuffer=new a_(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(c){return c._makeTileBoundsBuffers(this.context,this.transform.projection),c._tileBoundsBuffer?{tileBoundsBuffer:c._tileBoundsBuffer,tileBoundsIndexBuffer:c._tileBoundsIndexBuffer,tileBoundsSegments:c._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const c=this.context,h=c.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(c,h.TRIANGLES,p.DepthMode.disabled,this.stencilClearMode,p.ColorMode.disabled,p.CullFaceMode.disabled,ua(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(c,h,_){if(!h||this.currentStencilSource===h.id||!c.isTileClipped()||!_||0===_.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let A=!1;for(const P of _)if(void 0===this._tileClippingMaskIDs[P.key]){A=!0;break}if(!A)return}this.currentStencilSource=h.id;const w=this.context,C=w.gl;this.nextStencilID+_.length>256&&this.clearStencil(),w.setColorMode(p.ColorMode.disabled),w.setDepthMode(p.DepthMode.disabled);const I=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const A of _){const P=h.getTile(A),N=this._tileClippingMaskIDs[A.key]=this.nextStencilID++,{tileBoundsBuffer:B,tileBoundsIndexBuffer:$,tileBoundsSegments:Q}=this.getTileBoundsBuffers(P);I.draw(w,C.TRIANGLES,p.DepthMode.disabled,new p.StencilMode({func:C.ALWAYS,mask:0},N,255,C.KEEP,C.KEEP,C.REPLACE),p.ColorMode.disabled,p.CullFaceMode.disabled,ua(A.projMatrix),"$clipping",B,$,Q)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const c=this.nextStencilID++,h=this.context.gl;return new p.StencilMode({func:h.NOTEQUAL,mask:255},c,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(c){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(c);const h=this.context.gl;return new p.StencilMode({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[c.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(c){const h=this.context.gl,_=c.sort((I,A)=>A.overscaledZ-I.overscaledZ),w=_[_.length-1].overscaledZ,C=_[0].overscaledZ-w+1;if(C>1){this.currentStencilSource=void 0,this.nextStencilID+C>256&&this.clearStencil();const I={};for(let A=0;A<C;A++)I[A+w]=new p.StencilMode({func:h.GEQUAL,mask:255},A+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=C,[I,_]}return[{[w]:p.StencilMode.disabled},_]}colorModeForRenderPass(){const c=this.context.gl;return this._showOverdrawInspector?new p.ColorMode([c.CONSTANT_COLOR,c.ONE],new p.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?p.ColorMode.unblended:p.ColorMode.alphaBlended}depthModeForSublayer(c,h,_){if(!this.opaquePassEnabledForLayer())return p.DepthMode.disabled;const w=1-((1+this.currentLayer)*this.numSublayers+c)*this.depthEpsilon;return new p.DepthMode(_||this.context.gl.LEQUAL,h,[w,w])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(c,h){this.style=c,this.options=h,this.imageManager=c.imageManager,this.glyphManager=c.glyphManager,this.symbolFadeChange=c.placement.symbolFadeChange(p.exported.now()),this.imageManager.beginFrame();const _=this.style.order,w=this.style._sourceCaches;for(const N in w){const B=w[N];B.used&&B.prepare(this.context)}const C={},I={},A={};for(const N in w){const B=w[N];C[N]=B.getVisibleCoordinates(),I[N]=C[N].slice().reverse(),A[N]=B.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let N=0;N<_.length;N++)if(this.style._layers[_[N]].is3D()){this.opaquePassCutoff=N;break}if(this.terrain&&(this.terrain.updateTileBinding(A),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new p.GlobeSharedBuffers(this.context)),!p.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const N of _){const B=this.style._layers[N],$=c._getLayerSourceCache(B);if(!B.hasOffscreenPass()||B.isHidden(this.transform.zoom))continue;const Q=$?I[$.id]:void 0;("custom"===B.type||B.isSky()||Q&&Q.length)&&this.renderLayer(this,$,B,Q)}this.depthRangeFor3D=[0,1-(c.order.length+2)*this.numSublayers*this.depthEpsilon];const P=this.terrain;if(P&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&P.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:h.showOverdrawInspector?p.Color.black:p.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const N=this.style._layers[_[this.currentLayer]],B=c._getLayerSourceCache(N);if(N.isSky())continue;const $=B?I[B.id]:void 0;this._renderTileClippingMasks(N,B,$),this.renderLayer(this,B,N,$)}if(this.style.fog&&this.transform.projection.supportsFog&&function(N,B){const $=N.context,Q=$.gl,re=N.transform,ae=new p.DepthMode(Q.LEQUAL,p.DepthMode.ReadOnly,[0,1]),se=N.useProgram("globeAtmosphere",null,"globe"===re.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),ce=p.globeToMercatorTransition(re.zoom),q=B.properties.get("color").toArray01(),ie=B.properties.get("high-color").toArray01(),me=B.properties.get("space-color").toArray01PremultipliedAlpha(),be=p.identity$1([]);p.rotateY$1(be,be,-p.degToRad(re._center.lng)),p.rotateX$1(be,be,p.degToRad(re._center.lat)),p.rotateZ$1(be,be,re.angle),p.rotateX$1(be,be,-re._pitch);const Le=p.fromQuat(new Float32Array(16),be),Pe=p.mapValue(B.properties.get("star-intensity"),0,1,0,.25),Ke=p.mapValue(B.properties.get("horizon-blend"),0,1,5e-4,.25),We=p.globeUseCustomAntiAliasing(N,$,re)&&5e-4===Ke?re.worldSize/(2*Math.PI*1.025)-1:re.globeRadius,at=N.frameCounter/1e3%1,zt=p.length(re.globeCenterInViewSpace),it=Math.sqrt(Math.pow(zt,2)-Math.pow(We,2)),Tt=Math.acos(it/zt),ht={u_frustum_tl:re.frustumCorners.TL,u_frustum_tr:re.frustumCorners.TR,u_frustum_br:re.frustumCorners.BR,u_frustum_bl:re.frustumCorners.BL,u_horizon:re.frustumCorners.horizon,u_transition:ce,u_fadeout_range:Ke,u_color:q,u_high_color:ie,u_space_color:me,u_star_intensity:Pe,u_star_size:5*p.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:at,u_horizon_angle:Tt,u_rotation_matrix:Le};N.prepareDrawProgram($,se);const Vt=N.atmosphereBuffer;Vt&&se.draw($,Q.TRIANGLES,ae,p.StencilMode.disabled,p.ColorMode.alphaBlended,p.CullFaceMode.backCW,ht,"skybox",Vt.vertexBuffer,Vt.indexBuffer,Vt.segments)}(this,this.style.fog),this.renderPass="sky",(p.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const N=this.style._layers[_[this.currentLayer]],B=c._getLayerSourceCache(N);N.isSky()&&this.renderLayer(this,B,N,B?I[B.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<_.length;){const N=this.style._layers[_[this.currentLayer]],B=c._getLayerSourceCache(N);if(N.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(N)){if(N.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const $=B?("symbol"===N.type?A:I)[B.id]:void 0;this._renderTileClippingMasks(N,B,B?C[B.id]:void 0),this.renderLayer(this,B,N,$),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let N=null;p.values(this.style._layers).forEach(B=>{const $=c._getLayerSourceCache(B);$&&!B.isHidden(this.transform.zoom)&&(!N||N.getSource().maxzoom<$.getSource().maxzoom)&&(N=$)}),N&&this.options.showTileBoundaries&&Du.debug(this,N,N.getVisibleCoordinates())}this.options.showPadding&&function(N){const B=N.transform.padding;Md(N,N.transform.height-(B.top||0),3,Tu),Md(N,B.bottom||0,3,o_),Ys(N,B.left||0,3,Zs),Ys(N,N.transform.width-(B.right||0),3,Va);const $=N.transform.centerPoint;var Q,re,ae,se;Eu(Q=N,(re=$.x)-1,(ae=N.transform.height-$.y)-10,2,20,se=Qp),Eu(Q,re-10,ae-1,20,2,se)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(p.window.performance.now()),this.saveCanvasCopy())}renderLayer(c,h,_,w){_.isHidden(this.transform.zoom)||("background"===_.type||"sky"===_.type||"custom"===_.type||w&&w.length)&&(this.id=_.id,this.gpuTimingStart(_),(!c.transform.projection.unsupportedLayers||!c.transform.projection.unsupportedLayers.includes(_.type)||c.terrain&&"custom"===_.type)&&Du[_.type](c,h,_,w,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(c){if(!this.options.gpuTiming)return;const h=this.context.extTimerQuery;let _=this.gpuTimers[c.id];_||(_=this.gpuTimers[c.id]={calls:0,cpuTime:0,query:h.createQueryEXT()}),_.calls++,h.beginQueryEXT(h.TIME_ELAPSED_EXT,_.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const c=this.context.extTimerQuery,h=c.createQueryEXT();this.deferredRenderGpuTimeQueries.push(h),c.beginQueryEXT(c.TIME_ELAPSED_EXT,h)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const c=this.context.extTimerQuery;c.endQueryEXT(c.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery;c.endQueryEXT(c.TIME_ELAPSED_EXT)}collectGpuTimers(){const c=this.gpuTimers;return this.gpuTimers={},c}collectDeferredRenderGpuQueries(){const c=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],c}queryGpuTimers(c){const h={};for(const _ in c){const w=c[_],C=this.context.extTimerQuery,I=C.getQueryObjectEXT(w.query,C.QUERY_RESULT_EXT)/1e6;C.deleteQueryEXT(w.query),h[_]=I}return h}queryGpuTimeDeferredRender(c){if(!this.options.gpuTimingDeferredRender)return 0;const h=this.context.extTimerQuery;let _=0;for(const w of c)_+=h.getQueryObjectEXT(w,h.QUERY_RESULT_EXT)/1e6,h.deleteQueryEXT(w);return _}translatePosMatrix(c,h,_,w,C){if(!_[0]&&!_[1])return c;const I=C?"map"===w?this.transform.angle:0:"viewport"===w?-this.transform.angle:0;if(I){const N=Math.sin(I),B=Math.cos(I);_=[_[0]*B-_[1]*N,_[0]*N+_[1]*B]}const A=[C?_[0]:xt(h,_[0],this.transform.zoom),C?_[1]:xt(h,_[1],this.transform.zoom),0],P=new Float32Array(16);return p.translate(P,c,A),P}saveTileTexture(c){const h=this._tileTextures[c.size[0]];h?h.push(c):this._tileTextures[c.size[0]]=[c]}getTileTexture(c){const h=this._tileTextures[c];return h&&h.length>0?h.pop():null}isPatternMissing(c){return null===c||void 0!==c&&!this.imageManager.getPattern(c.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const c=this.terrain&&this.terrain.renderingToTexture,h=this.terrain&&0===this.terrain.exaggeration(),_=this.style&&this.style.fog,w=[];return this.terrainRenderModeElevated()&&w.push("TERRAIN"),"globe"===this.transform.projection.name&&w.push("GLOBE"),h&&w.push("ZERO_EXAGGERATION"),_&&!c&&0!==_.getOpacity(this.transform.pitch)&&w.push("FOG"),c&&w.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&w.push("OVERDRAW_INSPECTOR"),w}useProgram(c,h,_){this.cache=this.cache||{};const w=_||[],C=this.currentGlobalDefines().concat(w),I=qi.cacheKey(kh[c],c,C,h);return this.cache[I]||(this.cache[I]=new qi(this.context,c,kh[c],h,Fi[c],C)),this.cache[I]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const c=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(c.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=p.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new p.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(c,h,_){if(this.terrain&&this.terrain.renderingToTexture)return;const w=this.style.fog;if(w){const C=w.getOpacity(this.transform.pitch),I=((A,P,N,B,$,Q,re,ae,se,ce,q)=>{const ie=A.transform,me=P.properties.get("color").toArray01();me[3]=B;const be=A.frameCounter/1e3%1;return{u_fog_matrix:N?ie.calculateFogTileMatrix(N):A.identityMat,u_fog_range:P.getFovAdjustedRange(ie._fov),u_fog_color:me,u_fog_horizon_blend:P.properties.get("horizon-blend"),u_fog_temporal_offset:be,u_frustum_tl:$,u_frustum_tr:Q,u_frustum_br:re,u_frustum_bl:ae,u_globe_pos:se,u_globe_radius:ce,u_viewport:q,u_globe_transition:p.globeToMercatorTransition(ie.zoom),u_is_globe:+("globe"===ie.projection.name)}})(this,w,_,C,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*p.exported.devicePixelRatio,this.transform.height*p.exported.devicePixelRatio]);h.setFogUniformValues(c,I)}}setTileLoadedFlag(c){this.tileLoaded=c}saveCanvasCopy(){const c=this.canvasCopy();c&&(this.frameCopies.push(c),this.tileLoaded=!1)}canvasCopy(){const c=this.context.gl,h=c.createTexture();return c.bindTexture(c.TEXTURE_2D,h),c.copyTexImage2D(c.TEXTURE_2D,0,c.RGBA,0,0,c.drawingBufferWidth,c.drawingBufferHeight,0),h}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const c=this.style&&this.style.fog;return!!c&&0!==c.getOpacity(this.transform.pitch)}getBackgroundTiles(){const c=this._backgroundTiles,h=this._backgroundTiles={},_=this.transform.coveringTiles({tileSize:512});for(const w of _)h[w.key]=c[w.key]||new p.Tile(w,512,this.transform.tileZoom,this);return h}clearBackgroundTiles(){this._backgroundTiles={}}}class ef{constructor(c=0,h=0,_=0,w=0){if(isNaN(c)||c<0||isNaN(h)||h<0||isNaN(_)||_<0||isNaN(w)||w<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=c,this.bottom=h,this.left=_,this.right=w}interpolate(c,h,_){return null!=h.top&&null!=c.top&&(this.top=p.number(c.top,h.top,_)),null!=h.bottom&&null!=c.bottom&&(this.bottom=p.number(c.bottom,h.bottom,_)),null!=h.left&&null!=c.left&&(this.left=p.number(c.left,h.left,_)),null!=h.right&&null!=c.right&&(this.right=p.number(c.right,h.right,_)),this}getCenter(c,h){const _=p.clamp((this.left+c-this.right)/2,0,c),w=p.clamp((this.top+h-this.bottom)/2,0,h);return new p.Point(_,w)}equals(c){return this.top===c.top&&this.bottom===c.bottom&&this.left===c.left&&this.right===c.right}clone(){return new ef(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function tf(g,c){const h=p.getColumn(g,3);p.fromQuat(g,c),p.setColumn(g,3,h)}function rr(g,c){const h=p.identity$1([]);return p.rotateZ$1(h,h,-c),p.rotateX$1(h,h,-g),h}function Bh(g,c){const h=[g[0],g[1],0],_=[c[0],c[1],0];if(p.length(h)>=1e-15){const I=p.normalize([],h);p.scale$2(_,I,p.dot(_,I)),c[0]=_[0],c[1]=_[1]}const w=p.cross([],c,g);if(p.len(w)<1e-15)return null;const C=Math.atan2(-w[1],w[0]);return rr(Math.atan2(Math.sqrt(g[0]*g[0]+g[1]*g[1]),-g[2]),C)}class l_{constructor(c,h){this.position=c,this.orientation=h}get position(){return this._position}set position(c){if(c){const h=c instanceof p.MercatorCoordinate?c:new p.MercatorCoordinate(c[0],c[1],c[2]);this._renderWorldCopies&&(h.x=p.wrap(h.x,0,1)),this._position=h}else this._position=null}lookAtPoint(c,h){if(this.orientation=null,!this.position)return;const _=this.position,w=this._elevation?this._elevation.getAtPointOrZero(p.MercatorCoordinate.fromLngLat(c)):0,C=p.MercatorCoordinate.fromLngLat(c,w),I=[C.x-_.x,C.y-_.y,C.z-_.z];h||(h=[0,0,1]),h[2]=Math.abs(h[2]),this.orientation=Bh(I,h)}setPitchBearing(c,h){this.orientation=rr(p.degToRad(c),p.degToRad(-h))}}class nf{constructor(c,h){this._transform=p.identity([]),this.orientation=h,this.position=c}get mercatorPosition(){const c=this.position;return new p.MercatorCoordinate(c[0],c[1],c[2])}get position(){const c=p.getColumn(this._transform,3);return[c[0],c[1],c[2]]}set position(c){var h;c&&p.setColumn(this._transform,3,[(h=c)[0],h[1],h[2],1])}get orientation(){return this._orientation}set orientation(c){this._orientation=c||p.identity$1([]),c&&tf(this._transform,this._orientation)}getPitchBearing(){const c=this.forward(),h=this.right();return{bearing:Math.atan2(-h[1],h[0]),pitch:Math.atan2(Math.sqrt(c[0]*c[0]+c[1]*c[1]),-c[2])}}setPitchBearing(c,h){this._orientation=rr(c,h),tf(this._transform,this._orientation)}forward(){const c=p.getColumn(this._transform,2);return[-c[0],-c[1],-c[2]]}up(){const c=p.getColumn(this._transform,1);return[-c[0],-c[1],-c[2]]}right(){const c=p.getColumn(this._transform,0);return[c[0],c[1],c[2]]}getCameraToWorld(c,h){const _=new Float64Array(16);return p.invert(_,this.getWorldToCamera(c,h)),_}getWorldToCameraPosition(c,h,_){const w=this.position;p.scale$2(w,w,-c);const C=new Float64Array(16);return p.fromScaling(C,[_,_,_]),p.translate(C,C,w),C[10]*=h,C}getWorldToCamera(c,h){const _=new Float64Array(16),w=new Float64Array(4),C=this.position;return p.conjugate(w,this._orientation),p.scale$2(C,C,-c),p.fromQuat(_,w),p.translate(_,_,C),_[1]*=-1,_[5]*=-1,_[9]*=-1,_[13]*=-1,_[8]*=h,_[9]*=h,_[10]*=h,_[11]*=h,_}getCameraToClipPerspective(c,h,_,w){const C=new Float64Array(16);return p.perspective(C,c,h,_,w),C}getDistanceToElevation(c,h=!1){const _=0===c?0:p.mercatorZfromAltitude(c,h?p.latFromMercatorY(this.position[1]):this.position[1]),w=this.forward();return(_-this.position[2])/w[2]}clone(){return new nf([...this.position],[...this.orientation])}}function kd(g,c){const h=Rd(g.projection,g.zoom,g.width,g.height),_=function(C,I,A,P,N){const B=new p.LngLat(A.lng-180*Ua,A.lat),$=new p.LngLat(A.lng+180*Ua,A.lat),Q=C.project(B.lng,B.lat),re=C.project($.lng,$.lat),ae=-Math.atan2(re.y-Q.y,re.x-Q.x),se=p.MercatorCoordinate.fromLngLat(A);se.y=p.clamp(se.y,-1+Ua,1-Ua);const ce=se.toLngLat(),q=C.project(ce.lng,ce.lat),ie=p.MercatorCoordinate.fromLngLat(ce);ie.x+=Ua;const me=ie.toLngLat(),be=C.project(me.lng,me.lat),Le=rf(be.x-q.x,be.y-q.y,ae),Pe=p.MercatorCoordinate.fromLngLat(ce);Pe.y+=Ua;const Oe=Pe.toLngLat(),Ke=C.project(Oe.lng,Oe.lat),We=rf(Ke.x-q.x,Ke.y-q.y,ae),at=Math.abs(Le.x)/Math.abs(We.y),zt=p.identity([]);p.rotateZ(zt,zt,-ae*(1-(N?0:P)));const it=p.identity([]);return p.scale(it,it,[1,1-(1-at)*P,1]),it[4]=-We.x/We.y*P,p.rotateZ(it,it,ae),p.multiply(it,zt,it),it}(g.projection,0,g.center,h,c),w=c_(g);return p.scale(_,_,[w,w,1]),_}function c_(g){const c=g.projection,h=Rd(g.projection,g.zoom,g.width,g.height),_=u_(c,g.center),w=u_(c,p.LngLat.convert(c.center));return Math.pow(2,_*h+(1-h)*w)}function Rd(g,c,h,_,w=1/0){const C=g.range;if(!C)return 0;const I=Math.min(w,Math.max(h,_)),A=Math.log(I/1024)/Math.LN2;return p.smoothstep(C[0]+A,C[1]+A,c)}const Ua=1/4e4;function u_(g,c){const h=p.clamp(c.lat,-p.MAX_MERCATOR_LATITUDE,p.MAX_MERCATOR_LATITUDE),_=new p.LngLat(c.lng-180*Ua,h),w=new p.LngLat(c.lng+180*Ua,h),C=g.project(_.lng,h),I=g.project(w.lng,h),A=p.MercatorCoordinate.fromLngLat(_),P=p.MercatorCoordinate.fromLngLat(w),N=I.x-C.x,B=I.y-C.y,$=P.x-A.x,Q=P.y-A.y,re=Math.sqrt(($*$+Q*Q)/(N*N+B*B));return Math.log(re)/Math.LN2}function rf(g,c,h){const _=Math.cos(h),w=Math.sin(h);return{x:g*_-c*w,y:g*w+c*_}}class Pd{constructor(c,h,_,w,C,I,A){this.tileSize=512,this._renderWorldCopies=void 0===C||C,this._minZoom=c||0,this._maxZoom=h||22,this._minPitch=null==_?0:_,this._maxPitch=null==w?60:w,this.setProjection(I),this.setMaxBounds(A),this.width=0,this.height=0,this._center=new p.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ef,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new nf,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const c=new Pd(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return c._elevation=this._elevation,c._centerAltitude=this._centerAltitude,c._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,c.tileSize=this.tileSize,c.mercatorFromTransition=this.mercatorFromTransition,c.width=this.width,c.height=this.height,c.cameraElevationReference=this.cameraElevationReference,c._center=this._center,c._setZoom(this.zoom),c._seaLevelZoom=this._seaLevelZoom,c.angle=this.angle,c._fov=this._fov,c._pitch=this._pitch,c._nearZ=this._nearZ,c._farZ=this._farZ,c._averageElevation=this._averageElevation,c._unmodified=this._unmodified,c._edgeInsets=this._edgeInsets.clone(),c._camera=this._camera.clone(),c._calcMatrices(),c.freezeTileCoverage=this.freezeTileCoverage,c.frustumCorners=this.frustumCorners,c}get elevation(){return this._elevation}set elevation(c){this._elevation!==c&&(this._elevation=c,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(c,h=!1){const _=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||_)&&this._updateCameraOnTerrain(),(c||_)&&this._constrainCamera(h),this._calcMatrices()}getProjection(){return p.pick(this.projection,["name","center","parallels"])}setProjection(c){this.projectionOptions=c||{name:"mercator"};const h=this.projection?this.getProjection():void 0;this.projection=p.getProjection(this.projectionOptions);const _=!he(h,this.getProjection());return _&&this._calcMatrices(),this.mercatorFromTransition=!1,_}setMercatorFromTransition(){const c=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=p.getProjection({name:"mercator"});const h=c!==this.projection.name;return h&&this._calcMatrices(),h}get minZoom(){return this._minZoom}set minZoom(c){this._minZoom!==c&&(this._minZoom=c,this.zoom=Math.max(this.zoom,c))}get maxZoom(){return this._maxZoom}set maxZoom(c){this._maxZoom!==c&&(this._maxZoom=c,this.zoom=Math.min(this.zoom,c))}get minPitch(){return this._minPitch}set minPitch(c){this._minPitch!==c&&(this._minPitch=c,this.pitch=Math.max(this.pitch,c))}get maxPitch(){return this._maxPitch}set maxPitch(c){this._maxPitch!==c&&(this._maxPitch=c,this.pitch=Math.min(this.pitch,c))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(c){void 0===c?c=!0:null===c&&(c=!1),this._renderWorldCopies=c}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const c=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(c))}get cameraWorldSize(){const c=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(c))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return p.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new p.Point(this.width,this.height)}get bearing(){return p.wrap(this.rotation,-180,180)}set bearing(c){this.rotation=c}get rotation(){return-this.angle/Math.PI*180}set rotation(c){const h=-c*Math.PI/180;var _,w,C,I,A,P,N,B,$,Q;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=(_=new p.ARRAY_TYPE(4),p.ARRAY_TYPE!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_),w=this.rotationMatrix,I=this.angle,A=(C=this.rotationMatrix)[0],P=C[1],N=C[2],B=C[3],$=Math.sin(I),Q=Math.cos(I),w[0]=A*Q+N*$,w[1]=P*Q+B*$,w[2]=A*-$+N*Q,w[3]=P*-$+B*Q)}get pitch(){return this._pitch/Math.PI*180}set pitch(c){const h=p.clamp(c,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const c=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/c)}set fov(c){c=Math.max(.01,Math.min(60,c)),this._fov!==c&&(this._unmodified=!1,this._fov=p.degToRad(c),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(c){this._averageElevation=c,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(c){const h=Math.min(Math.max(c,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._setZoom(h),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(c){this._zoom=c,this.scale=this.zoomScale(c),this.tileZoom=Math.floor(c),this.zoomFraction=c-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const c=this._elevation;this._centerAltitude=c.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=c.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const c=this._elevation,h=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],_=this.horizonLineFromTop();let w=0,C=0;for(let I=0;I<h.length;I++){const A=new p.Point(h[I][0]*this.width,_+h[I][1]*(this.height-_)),P=c.pointCoordinate(A);if(!P)continue;const N=1/Math.hypot(P[0]-this._camera.position[0],P[1]-this._camera.position[1]);w+=P[3]*N,C+=N}return 0===C?NaN:w/C}get center(){return this._center}set center(c){c.lat===this._center.lat&&c.lng===this._center.lng||(this._unmodified=!1,this._center=c,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const c=this._seaLevelZoom,h=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),_=this.pixelsPerMeter/this.worldSize*h,w=this._mercatorZfromZoom(c),C=this._mercatorZfromZoom(this._maxZoom),I=Math.max(w-_,C);this._setZoom(this._zoomFromMercatorZ(I))}get padding(){return this._edgeInsets.toJSON()}set padding(c){this._edgeInsets.equals(c)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,c,1),this._calcMatrices())}computeZoomRelativeTo(c){const h=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,c.toAltitude()));let _;_=c.z<this._camera.position[2]?[h.x,h.y,h.z]:[c.x,c.y,c.z];const w=p.length(p.sub([],this._camera.position,_));return p.clamp(this._zoomFromMercatorZ(w),this._minZoom,this._maxZoom)}setFreeCameraOptions(c){if(!this.height||!c.position&&!c.orientation)return;this._updateCameraState();let h=!1;if(c.orientation&&!p.exactEquals(c.orientation,this._camera.orientation)&&(h=this._setCameraOrientation(c.orientation)),c.position){const _=[c.position.x,c.position.y,c.position.z];p.exactEquals$1(_,this._camera.position)||(this._setCameraPosition(_),h=!0)}h&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const c=this._camera.position,h=new l_;return h.position=new p.MercatorCoordinate(c[0],c[1],c[2]),h.orientation=this._camera.orientation,h._elevation=this.elevation,h._renderWorldCopies=this.renderWorldCopies,h}_setCameraOrientation(c){if(!p.length$1(c))return!1;p.normalize$1(c,c);const h=p.transformQuat([],[0,0,-1],c),_=p.transformQuat([],[0,-1,0],c);if(_[2]<0)return!1;const w=Bh(h,_);return!!w&&(this._camera.orientation=w,!0)}_setCameraPosition(c){const h=this.zoomScale(this.minZoom)*this.tileSize,_=this.zoomScale(this.maxZoom)*this.tileSize,w=this.cameraToCenterDistance;c[2]=p.clamp(c[2],w/_,w/h),this._camera.position=c}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(c){return this._edgeInsets.equals(c)}interpolatePadding(c,h,_){this._unmodified=!1,this._edgeInsets.interpolate(c,h,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(c){const h=(c.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/c.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(c){const h=[new p.UnwrappedTileID(0,c)];if(this.renderWorldCopies){const _=this.pointCoordinate(new p.Point(0,0)),w=this.pointCoordinate(new p.Point(this.width,0)),C=this.pointCoordinate(new p.Point(this.width,this.height)),I=this.pointCoordinate(new p.Point(0,this.height)),A=Math.floor(Math.min(_.x,w.x,C.x,I.x)),P=Math.floor(Math.max(_.x,w.x,C.x,I.x)),N=1;for(let B=A-N;B<=P+N;B++)0!==B&&h.push(new p.UnwrappedTileID(B,c))}return h}coveringTiles(c){let h=this.coveringZoomLevel(c);const _=h,w=this.elevation&&!c.isTerrainDEM,C="mercator"===this.projection.name;if(void 0!==c.minzoom&&h<c.minzoom)return[];void 0!==c.maxzoom&&h>c.maxzoom&&(h=c.maxzoom);const I=this.locationCoordinate(this.center),A=this.center.lat,P=1<<h,N=[P*I.x,P*I.y,0],B="globe"===this.projection.name,$=!B,Q=p.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h,$),re=B?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ae=P*p.mercatorZfromAltitude(1,this.center.lat),se=this._camera.position[2]/p.mercatorZfromAltitude(1,this.center.lat),ce=[P*re.x,P*re.y,se*($?1:ae)],q=this.cameraToCenterDistance/c.tileSize*(c.roundZoom?1:.502),ie=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?h:0,me=c.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,be=c.isTerrainDEM?-me:this._elevation?this._elevation.getMinElevationBelowMSL():0,Le=this.projection.isReprojectedInTileSpace?c_(this):1,Pe=ot=>{const Ut=new p.MercatorCoordinate(ot.x+25e-6,ot.y,ot.z),At=new p.MercatorCoordinate(ot.x,ot.y+25e-6,ot.z),qt=ot.toLngLat(),Un=Ut.toLngLat(),ti=At.toLngLat(),An=this.locationCoordinate(qt),Hn=this.locationCoordinate(Un),Ai=this.locationCoordinate(ti),wi=Math.hypot(Hn.x-An.x,Hn.y-An.y),Vn=Math.hypot(Ai.x-An.x,Ai.y-An.y);return Math.sqrt(wi*Vn)*Le/25e-6},Oe=ot=>{const wt=me,Ut=be;return{aabb:p.tileAABB(this,P,0,0,0,ot,Ut,wt,this.projection),zoom:0,x:0,y:0,minZ:Ut,maxZ:wt,wrap:ot,fullyVisible:!1}},Ke=[];let We=[];const at=h,zt=c.reparseOverscaled?_:h,it=ot=>ot*ot,Tt=it((se-this._centerAltitude)*ae),ht=ot=>{if(!this._elevation||!ot.tileID||!C)return;const wt=this._elevation.getMinMaxForTile(ot.tileID),Ut=ot.aabb;wt?(Ut.min[2]=wt.min,Ut.max[2]=wt.max,Ut.center[2]=(Ut.min[2]+Ut.max[2])/2):(ot.shouldSplit=Vt(ot),ot.shouldSplit||(Ut.min[2]=Ut.max[2]=Ut.center[2]=this._centerAltitude))},Vt=ot=>{if(ot.zoom<ie)return!0;if(ot.zoom===at)return!1;if(null!=ot.shouldSplit)return ot.shouldSplit;const wt=ot.aabb.distanceX(ce),Ut=ot.aabb.distanceY(ce);let At=Tt,qt=1;if(B){At=it(ot.aabb.distanceZ(ce));const An=Math.pow(2,ot.zoom),Hn=p.latFromMercatorY((ot.y+1)/An),Ai=p.latFromMercatorY(ot.y/An),wi=Math.min(Math.max(A,Hn),Ai),Vn=p.circumferenceAtLatitude(wi)/p.circumferenceAtLatitude(A);if(qt=wi===A?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Vn/this._mercatorScaleRatio),this.zoom<=p.GLOBE_ZOOM_THRESHOLD_MIN&&ot.zoom===at-1&&Vn>=.9)return!0}else if(w&&(At=it(ot.aabb.distanceZ(ce)*ae)),this.projection.isReprojectedInTileSpace&&_<=5){const An=Math.pow(2,ot.zoom),Hn=Pe(new p.MercatorCoordinate((ot.x+.5)/An,(ot.y+.5)/An));qt=Hn>.85?1:Hn}const Un=wt*wt+Ut*Ut+At;return Un<it((1<<at-ot.zoom)*q*qt*((An,Hn)=>{if(Hn*it(.707)<An)return 1;const Ai=Math.sqrt(Hn/An);return Ai/(1.4144271570014144+(Math.pow(1.1,Ai-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(At,Tt),Un))};if(this.renderWorldCopies)for(let ot=1;ot<=3;ot++)Ke.push(Oe(-ot)),Ke.push(Oe(ot));for(Ke.push(Oe(0));Ke.length>0;){const ot=Ke.pop(),wt=ot.x,Ut=ot.y;let At=ot.fullyVisible;if(!At){const qt=ot.aabb.intersects(Q);if(0===qt)continue;At=2===qt}if(ot.zoom!==at&&Vt(ot))for(let qt=0;qt<4;qt++){const Un=(wt<<1)+qt%2,ti=(Ut<<1)+(qt>>1),An={aabb:C?ot.aabb.quadrant(qt):p.tileAABB(this,P,ot.zoom+1,Un,ti,ot.wrap,ot.minZ,ot.maxZ,this.projection),zoom:ot.zoom+1,x:Un,y:ti,wrap:ot.wrap,fullyVisible:At,tileID:void 0,shouldSplit:void 0,minZ:ot.minZ,maxZ:ot.maxZ};w&&!B&&(An.tileID=new p.OverscaledTileID(ot.zoom+1===at?zt:ot.zoom+1,ot.wrap,ot.zoom+1,Un,ti),ht(An)),Ke.push(An)}else{const qt=ot.zoom===at?zt:ot.zoom;if(c.minzoom&&c.minzoom>qt)continue;const Un=N[0]-(.5+wt+(ot.wrap<<ot.zoom))*(1<<h-ot.zoom),ti=N[1]-.5-Ut,An=ot.tileID?ot.tileID:new p.OverscaledTileID(qt,ot.wrap,ot.zoom,wt,Ut);We.push({tileID:An,distanceSq:Un*Un+ti*ti})}}if(this.fogCullDistSq){const ot=this.fogCullDistSq,wt=this.horizonLineFromTop();We=We.filter(Ut=>{const At=[0,0,0,1],qt=[p.EXTENT,p.EXTENT,0,1],Un=this.calculateFogTileMatrix(Ut.tileID.toUnwrapped());p.transformMat4$1(At,At,Un),p.transformMat4$1(qt,qt,Un);const ti=p.getAABBPointSquareDist(At,qt);if(0===ti)return!0;let An=!1;const Hn=this._elevation;if(Hn&&ti>ot&&0!==wt){const Ai=this.calculateProjMatrix(Ut.tileID.toUnwrapped());let wi;c.isTerrainDEM||(wi=Hn.getMinMaxForTile(Ut.tileID)),wi||(wi={min:be,max:me});const Vn=p.furthestTileCorner(this.rotation),ur=[Vn[0]*p.EXTENT,Vn[1]*p.EXTENT,wi.max];p.transformMat4(ur,ur,Ai),An=(1-ur[1])*this.height*.5<wt}return ti<ot||An})}return We.sort((ot,wt)=>ot.distanceSq-wt.distanceSq).map(ot=>ot.tileID)}resize(c,h){this.width=c,this.height=h,this.pixelsToGLUnits=[2/c,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(c){return Math.pow(2,c)}scaleZoom(c){return Math.log(c)/Math.LN2}project(c){const h=p.clamp(c.lat,-p.MAX_MERCATOR_LATITUDE,p.MAX_MERCATOR_LATITUDE),_=this.projection.project(c.lng,h);return new p.Point(_.x*this.worldSize,_.y*this.worldSize)}unproject(c){return this.projection.unproject(c.x/this.worldSize,c.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/p.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(c,h){let _,w;const C=this.centerPoint;if("globe"===this.projection.name){const A=this.worldSize;_=(h.x-C.x)/A,w=(h.y-C.y)/A}else{const A=this.pointCoordinate(h),P=this.pointCoordinate(C);_=A.x-P.x,w=A.y-P.y}const I=this.locationCoordinate(c);this.setLocation(new p.MercatorCoordinate(I.x-_,I.y-w))}setLocation(c){this.center=this.coordinateLocation(c),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(c){return this.projection.locationPoint(this,c)}locationPoint3D(c){return this.projection.locationPoint(this,c,!0)}pointLocation(c){return this.coordinateLocation(this.pointCoordinate(c))}pointLocation3D(c){return this.coordinateLocation(this.pointCoordinate3D(c))}locationCoordinate(c,h){const _=h?p.mercatorZfromAltitude(h,c.lat):void 0,w=this.projection.project(c.lng,c.lat);return new p.MercatorCoordinate(w.x,w.y,_)}coordinateLocation(c){return this.projection.unproject(c.x,c.y)}pointRayIntersection(c,h){const _=null!=h?h:this._centerAltitude,w=[c.x,c.y,0,1],C=[c.x,c.y,1,1];p.transformMat4$1(w,w,this.pixelMatrixInverse),p.transformMat4$1(C,C,this.pixelMatrixInverse);const I=C[3];p.scale$1(w,w,1/w[3]),p.scale$1(C,C,1/I);const A=w[2],P=C[2];return{p0:w,p1:C,t:A===P?0:(_-A)/(P-A)}}screenPointToMercatorRay(c){const h=[c.x,c.y,0,1],_=[c.x,c.y,1,1];return p.transformMat4$1(h,h,this.pixelMatrixInverse),p.transformMat4$1(_,_,this.pixelMatrixInverse),p.scale$1(h,h,1/h[3]),p.scale$1(_,_,1/_[3]),h[2]=p.mercatorZfromAltitude(h[2],this._center.lat)*this.worldSize,_[2]=p.mercatorZfromAltitude(_[2],this._center.lat)*this.worldSize,p.scale$1(h,h,1/this.worldSize),p.scale$1(_,_,1/this.worldSize),new p.Ray([h[0],h[1],h[2]],p.normalize([],p.sub([],_,h)))}rayIntersectionCoordinate(c){const{p0:h,p1:_,t:w}=c,C=p.mercatorZfromAltitude(h[2],this._center.lat),I=p.mercatorZfromAltitude(_[2],this._center.lat);return new p.MercatorCoordinate(p.number(h[0],_[0],w)/this.worldSize,p.number(h[1],_[1],w)/this.worldSize,p.number(C,I,w))}pointCoordinate(c,h=this._centerAltitude){return this.projection.pointCoordinate(this,c.x,c.y,h)}pointCoordinate3D(c){if(!this.elevation)return this.pointCoordinate(c);let h=this.projection.pointCoordinate3D(this,c.x,c.y);if(h)return new p.MercatorCoordinate(h[0],h[1],h[2]);let _=0,w=this.horizonLineFromTop();if(c.y>w)return this.pointCoordinate(c);const C=.02*w,I=c.clone();for(let A=0;A<10&&w-_>C;A++){I.y=p.number(_,w,.66);const P=this.projection.pointCoordinate3D(this,I.x,I.y);P?(w=I.y,h=P):_=I.y}return h?new p.MercatorCoordinate(h[0],h[1],h[2]):this.pointCoordinate(c)}isPointAboveHorizon(c){return this.projection.isPointAboveHorizon(this,c)}isPointOnSurface(c){if(c.y<0||c.y>this.height||c.x<0||c.x>this.width)return!1;if(this.elevation||this.zoom>=p.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(c);const h=this.pointCoordinate(c);return h.y>=0&&h.y<=1}_coordinatePoint(c,h){const _=h&&this.elevation?this.elevation.getAtPointOrZero(c,this._centerAltitude):this._centerAltitude,w=[c.x*this.worldSize,c.y*this.worldSize,_+c.toAltitude(),1];return p.transformMat4$1(w,w,this.pixelMatrix),w[3]>0?new p.Point(w[0]/w[3],w[1]/w[3]):new p.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:c,left:h}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,w=this.width-this._edgeInsets.right,C=this.pointLocation3D(new p.Point(h,c)),I=this.pointLocation3D(new p.Point(w,c)),A=this.pointLocation3D(new p.Point(w,_)),P=this.pointLocation3D(new p.Point(h,_));let N=Math.min(C.lng,I.lng,A.lng,P.lng),B=Math.max(C.lng,I.lng,A.lng,P.lng),$=Math.min(C.lat,I.lat,A.lat,P.lat),Q=Math.max(C.lat,I.lat,A.lat,P.lat);const re=Math.pow(2,-this.zoom)/16*270,ae="globe"===this.projection.name?1:4,se=(ce,q,ie,me,be)=>{const Le=(ce+ie)/2,Pe=(q+me)/2,Oe=new p.Point(Le,Pe),{lng:Ke,lat:We}=this.pointLocation3D(Oe),at=Math.max(0,N-Ke,$-We,Ke-B,We-Q);N=Math.min(N,Ke),B=Math.max(B,Ke),$=Math.min($,We),Q=Math.max(Q,We),(be<ae||at>re)&&(se(ce,q,Le,Pe,be+1),se(Le,Pe,ie,me,be+1))};if(se(h,c,w,c,1),se(w,c,w,_,1),se(w,_,h,_,1),se(h,_,h,c,1),"globe"===this.projection.name){const[ce,q]=p.polesInViewport(this);ce?(Q=90,B=180,N=-180):q&&($=-90,B=180,N=-180)}return new p.LngLatBounds(new p.LngLat(N,$),new p.LngLat(B,Q))}_getBoundsRectangular(c,h){const{top:_,left:w}=this._edgeInsets,C=this.height-this._edgeInsets.bottom,I=this.width-this._edgeInsets.right,A=new p.Point(w,_),P=new p.Point(I,_),N=new p.Point(I,C),B=new p.Point(w,C);let $=this.pointCoordinate(A,c),Q=this.pointCoordinate(P,c);const re=this.pointCoordinate(N,h),ae=this.pointCoordinate(B,h),se=(ce,q)=>(q.y-ce.y)/(q.x-ce.x);return $.y>1&&Q.y>=0?$=new p.MercatorCoordinate((1-ae.y)/se(ae,$)+ae.x,1):$.y<0&&Q.y<=1&&($=new p.MercatorCoordinate(-ae.y/se(ae,$)+ae.x,0)),Q.y>1&&$.y>=0?Q=new p.MercatorCoordinate((1-re.y)/se(re,Q)+re.x,1):Q.y<0&&$.y<=1&&(Q=new p.MercatorCoordinate(-re.y/se(re,Q)+re.x,0)),(new p.LngLatBounds).extend(this.coordinateLocation($)).extend(this.coordinateLocation(Q)).extend(this.coordinateLocation(ae)).extend(this.coordinateLocation(re))}_getBoundsRectangularTerrain(){const c=this.elevation;if(!c.visibleDemTiles.length||c.isUsingMockSource())return this._getBoundsRectangular(0,0);const h=c.visibleDemTiles.reduce((_,w)=>{if(w.dem){const C=w.dem.tree;_.min=Math.min(_.min,C.minimums[0]),_.max=Math.max(_.max,C.maximums[0])}return _},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(h.min*c.exaggeration(),h.max*c.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(c=!0){const h=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,_=this.height/2-h*(1-this._horizonShift);return c?Math.max(0,_):_}getMaxBounds(){return this.maxBounds}setMaxBounds(c){this.maxBounds=c,this.minLat=-p.MAX_MERCATOR_LATITUDE,this.maxLat=p.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,c&&(this.minLat=c.getSouth(),this.maxLat=c.getNorth(),this.minLng=c.getWest(),this.maxLng=c.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=p.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=p.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=p.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=p.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(c,h){return this.projection.createTileMatrix(this,h,c)}calculateDistanceTileData(c){const h=c.key,_=this._distanceTileDataCache;if(_[h])return _[h];const w=c.canonical,C=1/this.height,I=this.cameraWorldSize,A=I/this.zoomScale(w.z),P=(w.x+Math.pow(2,w.z)*c.wrap)*A,N=w.y*A,B=this.point;B.x*=I/this.worldSize,B.y*=I/this.worldSize;const $=this.angle,Q=Math.sin(-$),re=-Math.cos(-$);return _[h]={bearing:[Q,re],center:[(B.x-P)*C,(B.y-N)*C],scale:A/p.EXTENT*C},_[h]}calculateFogTileMatrix(c){const h=c.key,_=this._fogTileMatrixCache;if(_[h])return _[h];const w=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,c);return p.multiply(w,this.worldToFogMatrix,w),_[h]=new Float32Array(w),_[h]}calculateProjMatrix(c,h=!1){const _=c.key,w=h?this._alignedProjMatrixCache:this._projMatrixCache;if(w[_])return w[_];const C=this.calculatePosMatrix(c,this.worldSize);return p.multiply(C,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:h?this.alignedProjMatrix:this.projMatrix,C),w[_]=new Float32Array(C),w[_]}calculatePixelsToTileUnitsMatrix(c){const h=c.tileID.key,_=this._pixelsToTileUnitsCache;if(_[h])return _[h];const w=function(C,I){const{scale:A}=C.tileTransform,P=A*p.EXTENT/(C.tileSize*Math.pow(2,I.zoom-C.tileID.overscaledZ+C.tileID.canonical.z));return N=new Float32Array(4),Q=(B=I.inverseAdjustmentMatrix)[1],re=B[2],ae=B[3],ce=($=[P,P])[1],N[0]=B[0]*(se=$[0]),N[1]=Q*se,N[2]=re*ce,N[3]=ae*ce,N;var N,B,$,Q,re,ae,se,ce}(c,this);return _[h]=w,_[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const c=1/this.worldSize,h=p.fromScaling([],[c,c,c]);return p.multiply(h,h,this.globeMatrix),h}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const c=this._elevation;this._updateCameraState();const h=p.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(h),w=this._camera.forward(),C=p.mercatorZfromAltitude(1,this._center.lat);_[2]/=C,w[2]/=C,p.normalize(w,w);const I=c.raycast(_,w,c.exaggeration());if(I){const A=p.scaleAndAdd([],_,w,I),P=new p.MercatorCoordinate(A[0],A[1],p.mercatorZfromAltitude(A[2],p.latFromMercatorY(A[1]))),N=(P.z+p.length([P.x-_[0],P.y-_[1],P.z-_[2]*C]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(N),this._centerAltitude=P.toAltitude(),this._center=this.coordinateLocation(P),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(c=!1){if(!this._elevation)return;const h=this._elevation,_=p.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,w=this._computeCameraPosition(_),C=h.getAtPointOrZero(new p.MercatorCoordinate(...w)),I=this.pixelsPerMeter/this.worldSize*C,A=this._minimumHeightOverTerrain(),P=w[2]-I;if(P<=A)if(P<0||c){const N=this.locationCoordinate(this._center,this._centerAltitude),B=[w[0],w[1],N.z-w[2]],$=p.length(B);B[2]-=(A-P)/this._pixelsPerMercatorPixel;const Q=p.length(B);if(0===Q)return;p.scale$2(B,B,$/Q*this._pixelsPerMercatorPixel),this._camera.position=[w[0],w[1],N.z*this._pixelsPerMercatorPixel-B[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const c="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||c){const Q=this.center;return Q.lat=p.clamp(Q.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!c)&&(Q.lng=p.clamp(Q.lng,this.minLng,this.maxLng)),this.center=Q,void(this._constraining=!1)}const h=this._unmodified,{x:_,y:w}=this.point;let C=0,I=_,A=w;const P=this.width/2,N=this.height/2,B=this.worldMinY*this.scale,$=this.worldMaxY*this.scale;if(w-N<B&&(A=B+N),w+N>$&&(A=$-N),$-B<this.height&&(C=Math.max(C,this.height/($-B)),A=($+B)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const Q=this.worldMinX*this.scale,re=this.worldMaxX*this.scale,ae=this.worldSize/2-(Q+re)/2;I=(_+ae+this.worldSize)%this.worldSize-ae,I-P<Q&&(I=Q+P),I+P>re&&(I=re-P),re-Q<this.width&&(C=Math.max(C,this.width/(re-Q)),I=(re+Q)/2)}I===_&&A===w||(this.center=this.unproject(new p.Point(I,A))),C&&(this.zoom+=this.scaleZoom(C)),this._constrainCamera(),this._unmodified=h,this._constraining=!1}_minZoomForBounds(){let c=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(c=Math.max(c,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),c}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const c=this.centerOffset,h=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=p.mercatorZfromAltitude(1,this.center.lat)/p.mercatorZfromAltitude(1,p.GLOBE_SCALE_MATCH_LATITUDE));const _=Rd(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,_),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const w="meters"===this.projection.zAxisUnit?h:1,C=this._camera.getWorldToCamera(this.worldSize,w),I=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);I[8]=2*-c.x/this.width,I[9]=2*c.y/this.height;let A=p.mul([],I,C);if(this.projection.isReprojectedInTileSpace){const Pe=this.locationCoordinate(this.center),Oe=p.identity([]);p.translate(Oe,Oe,[Pe.x*this.worldSize,Pe.y*this.worldSize,0]),p.multiply(Oe,Oe,kd(this)),p.translate(Oe,Oe,[-Pe.x*this.worldSize,-Pe.y*this.worldSize,0]),p.multiply(A,A,Oe),this.inverseAdjustmentMatrix=function(Ke){const We=kd(Ke,!0);return ge([],[We[0],We[1],We[4],We[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=p.scale([],A,[this.worldSize,this.worldSize,this.worldSize/w,1]),this.projMatrix=A,this.invProjMatrix=p.invert(new Float64Array(16),this.projMatrix);const P=p.invert([],I);this.frustumCorners=p.FrustumCorners.fromInvProjectionMatrix(P,this.horizonLineFromTop(),this.height);const N=new Float32Array(16);p.identity(N),p.scale(N,N,[1,-1,1]),p.rotateX(N,N,this._pitch),p.rotateZ(N,N,this.angle);const B=p.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),$=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;B[8]=2*-c.x/this.width,B[9]=2*(c.y+$)/this.height,this.skyboxMatrix=p.multiply(N,B,N);const Q=this.point,re=Q.x,ae=Q.y,se=this.width%2/2,ce=this.height%2/2,q=Math.cos(this.angle),ie=Math.sin(this.angle),me=re-Math.round(re)+q*se+ie*ce,be=ae-Math.round(ae)+q*ce+ie*se,Le=new Float64Array(A);if(p.translate(Le,Le,[me>.5?me-1:me,be>.5?be-1:be,0]),this.alignedProjMatrix=Le,A=p.create(),p.scale(A,A,[this.width/2,-this.height/2,1]),p.translate(A,A,[1,-1,0]),this.labelPlaneMatrix=A,A=p.create(),p.scale(A,A,[1,-1,1]),p.translate(A,A,[-1,-1,0]),p.scale(A,A,[2/this.width,2/this.height,1]),this.glCoordMatrix=A,this.pixelMatrix=p.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},A=p.invert(new Float64Array(16),this.pixelMatrix),!A)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=A,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=p.calculateGlobeMatrix(this);const Pe=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=p.transformMat4(Pe,Pe,C),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=A;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const c=this.cameraWorldSizeForFog,h=this.cameraPixelsPerMeter,_=this._camera.position,w=1/this.height/this._pixelsPerMercatorPixel,C=[c,c,h];p.scale$2(C,C,w),p.scale$2(_,_,-1),p.multiply$2(_,_,C);const I=p.create();p.translate(I,I,_),p.scale(I,I,C),this.mercatorFogMatrix=I,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(c,h,w)}_computeCameraPosition(c){const h=(c=c||this.pixelsPerMeter)/this.pixelsPerMeter,_=this._camera.forward(),w=this.point,C=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*h-c/this.worldSize*this._centerAltitude;return[w.x/this.worldSize-_[0]*C,w.y/this.worldSize-_[1]*C,c/this.worldSize*this._centerAltitude-_[2]*C]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(c){const h=this._maxCameraBoundsDistance()*Math.cos(this._pitch),_=this._camera.position[2],w=c[2];let C=1;this.projection.wrap&&(this.center=this.center.wrap()),w>0&&(C=Math.min((h-_)/w,1)),this._camera.position=p.scaleAndAdd([],this._camera.position,c,C),this._updateStateFromCamera()}_updateStateFromCamera(){const c=this._camera.position,h=this._camera.forward(),{pitch:_,bearing:w}=this._camera.getPitchBearing(),C=p.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,I=this._mercatorZfromZoom(this._maxZoom)*Math.cos(p.degToRad(this._maxPitch)),A=Math.max((c[2]-C)/Math.cos(_),I),P=this._zoomFromMercatorZ(A);p.scaleAndAdd(c,c,h,A),this._pitch=p.clamp(_,p.degToRad(this.minPitch),p.degToRad(this.maxPitch)),this.angle=p.wrap(w,-Math.PI,Math.PI),this._setZoom(p.clamp(P,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new p.MercatorCoordinate(c[0],c[1],c[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(c){return Math.pow(2,c)*this.tileSize}_mercatorZfromZoom(c){return this.cameraToCenterDistance/this._worldSizeFromZoom(c)}_minimumHeightOverTerrain(){const c=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(c)}_zoomFromMercatorZ(c){return this.scaleZoom(this.cameraToCenterDistance/(c*this.tileSize))}zoomFromMercatorZAdjusted(c){let h=0,_=p.GLOBE_ZOOM_THRESHOLD_MAX,w=0,C=1/0;for(;_-h>1e-6&&_>h;){const I=h+.5*(_-h),A=this.tileSize*Math.pow(2,I),P=this.getCameraToCenterDistance(this.projection,I,A),N=this.scaleZoom(P/(c*this.tileSize)),B=Math.abs(I-N);B<C&&(C=B,w=I),I<N?h=I:_=I}return w}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(p.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(c,h){const _=Math.min(c.x,h.x),w=Math.max(c.x,h.x),C=Math.min(c.y,h.y),I=Math.max(c.y,h.y);if(C<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const A=[new p.Point(_,C),new p.Point(w,I),new p.Point(_,I),new p.Point(w,C)],P=this.renderWorldCopies?-3:0,N=this.renderWorldCopies?4:1;for(const B of A){const $=this.pointRayIntersection(B);if($.t<0)return!0;const Q=this.rayIntersectionCoordinate($);if(Q.x<P||Q.y<0||Q.x>N||Q.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+p.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new p.Point(0,0),new p.Point(this.width,this.height))}zoomDeltaToMovement(c,h){const _=p.length(p.sub([],this._camera.position,c)),w=this._zoomFromMercatorZ(_)+h;return _-this._mercatorZfromZoom(w)}getCameraPoint(){if("globe"===this.projection.name){const c=function([h,_,w],C){const I=[h,_,w,1];p.transformMat4$1(I,I,C);const A=I[3]=Math.max(I[3],1e-6);return I[0]/=A,I[1]/=A,I[2]/=A,I}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new p.Point(c[0],c[1])}{const c=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new p.Point(0,c))}}getCameraToCenterDistance(c,h=this.zoom,_=this.worldSize){const w=Rd(c,h,this.width,this.height,1024),C=c.pixelSpaceConversion(this.center.lat,_,w);return.5/Math.tan(.5*this._fov)*this.height*C}getWorldToCameraMatrix(){const c=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&p.multiply(c,c,this.globeMatrix),c}}function Da(g,c){let h=!1,_=null;const w=()=>{_=null,h&&(g(),_=setTimeout(w,c),h=!1)};return()=>(h=!0,_||w(),_)}class sf{constructor(c){this._hashName=c&&encodeURIComponent(c),p.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Da(this._updateHashUnthrottled.bind(this),300)}addTo(c){return this._map=c,p.window.addEventListener("hashchange",this._onHashChange,!1),c.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),p.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const c=this._map;if(!c)return"";const h=_r(c);if(this._hashName){const _=this._hashName;let w=!1;const C=p.window.location.hash.slice(1).split("&").map(I=>{const A=I.split("=")[0];return A===_?(w=!0,`${A}=${h}`):I}).filter(I=>I);return w||C.push(`${_}=${h}`),`#${C.join("&")}`}return`#${h}`}_getCurrentHash(){const c=p.window.location.hash.replace("#","");if(this._hashName){let h;return c.split("&").map(_=>_.split("=")).forEach(_=>{_[0]===this._hashName&&(h=_)}),(h&&h[1]||"").split("/")}return c.split("/")}_onHashChange(){const c=this._map;if(!c)return!1;const h=this._getCurrentHash();if(h.length>=3&&!h.some(_=>isNaN(_))){const _=c.dragRotate.isEnabled()&&c.touchZoomRotate.isEnabled()?+(h[3]||0):c.getBearing();return c.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:_,pitch:+(h[4]||0)}),!0}return!1}_updateHashUnthrottled(){const c=p.window.location.href.replace(/(#.+)?$/,this.getHashString());p.window.history.replaceState(p.window.history.state,null,c)}}function _r(g,c){const h=g.getCenter(),_=Math.round(100*g.getZoom())/100,w=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),C=Math.pow(10,w),I=Math.round(h.lng*C)/C,A=Math.round(h.lat*C)/C,P=g.getBearing(),N=g.getPitch();let B=c?`/${I}/${A}/${_}`:`${_}/${A}/${I}`;return(P||N)&&(B+="/"+Math.round(10*P)/10),N&&(B+=`/${Math.round(N)}`),B}const Iu={linearity:.3,easing:p.bezier(0,0,.3,1)},zh=p.extend({deceleration:2500,maxSpeed:1400},Iu),Vh=p.extend({deceleration:20,maxSpeed:1400},Iu),yn=p.extend({deceleration:1e3,maxSpeed:360},Iu),Ia=p.extend({deceleration:1e3,maxSpeed:90},Iu);class $m{constructor(c){this._map=c,this.clear()}clear(){this._inertiaBuffer=[]}record(c){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:p.exported.now(),settings:c})}_drainInertiaBuffer(){const c=this._inertiaBuffer,h=p.exported.now();for(;c.length>0&&h-c[0].time>160;)c.shift()}_onMoveEnd(c){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const h={zoom:0,bearing:0,pitch:0,pan:new p.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:C}of this._inertiaBuffer)h.zoom+=C.zoomDelta||0,h.bearing+=C.bearingDelta||0,h.pitch+=C.pitchDelta||0,C.panDelta&&h.pan._add(C.panDelta),C.around&&(h.around=C.around),C.pinchAround&&(h.pinchAround=C.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,w={};if(h.pan.mag()){const C=Od(h.pan.mag(),_,p.extend({},zh,c||{}));w.offset=h.pan.mult(C.amount/h.pan.mag()),w.center=this._map.transform.center,Gc(w,C)}if(h.zoom){const C=Od(h.zoom,_,Vh);w.zoom=this._map.transform.zoom+C.amount,Gc(w,C)}if(h.bearing){const C=Od(h.bearing,_,yn);w.bearing=this._map.transform.bearing+p.clamp(C.amount,-179,179),Gc(w,C)}if(h.pitch){const C=Od(h.pitch,_,Ia);w.pitch=this._map.transform.pitch+C.amount,Gc(w,C)}if(w.zoom||w.bearing){const C=void 0===h.pinchAround?h.around:h.pinchAround;w.around=C?this._map.unproject(C):this._map.getCenter()}return this.clear(),w.noMoveStart=!0,w}}function Gc(g,c){(!g.duration||g.duration<c.duration)&&(g.duration=c.duration,g.easing=c.easing)}function Od(g,c,h){const{maxSpeed:_,linearity:w,deceleration:C}=h,I=p.clamp(g*w/(c/1e3),-_,_),A=Math.abs(I)/(C*w);return{easing:h.easing,duration:1e3*A,amount:I*(A/2)}}class Lr extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,h,_,w={}){const C=Rt(h.getCanvasContainer(),_),I=h.unproject(C);super(c,p.extend({point:C,lngLat:I,originalEvent:_},w)),this._defaultPrevented=!1,this.target=h}}class Wc extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,h,_){const w="touchend"===c?_.changedTouches:_.touches,C=Dn(h.getCanvasContainer(),w),I=C.map(P=>h.unproject(P)),A=C.reduce((P,N,B,$)=>P.add(N.div($.length)),new p.Point(0,0));super(c,{points:C,point:A,lngLats:I,lngLat:h.unproject(A),originalEvent:_}),this._defaultPrevented=!1}}class jh extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,h,_){super(c,{originalEvent:_}),this._defaultPrevented=!1}}class Ld{constructor(c,h){this._map=c,this._clickTolerance=h.clickTolerance}reset(){this._mousedownPos=void 0}wheel(c){return this._firePreventable(new jh(c.type,this._map,c))}mousedown(c,h){return this._mousedownPos=h,this._firePreventable(new Lr(c.type,this._map,c))}mouseup(c){this._map.fire(new Lr(c.type,this._map,c))}preclick(c){const h=p.extend({},c);h.type="preclick",this._map.fire(new Lr(h.type,this._map,h))}click(c,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||(this.preclick(c),this._map.fire(new Lr(c.type,this._map,c)))}dblclick(c){return this._firePreventable(new Lr(c.type,this._map,c))}mouseover(c){this._map.fire(new Lr(c.type,this._map,c))}mouseout(c){this._map.fire(new Lr(c.type,this._map,c))}touchstart(c){return this._firePreventable(new Wc(c.type,this._map,c))}touchmove(c){this._map.fire(new Wc(c.type,this._map,c))}touchend(c){this._map.fire(new Wc(c.type,this._map,c))}touchcancel(c){this._map.fire(new Wc(c.type,this._map,c))}_firePreventable(c){if(this._map.fire(c),c.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Uh{constructor(c){this._map=c}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(c){this._map.fire(new Lr(c.type,this._map,c))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Lr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(c){this._delayContextMenu?this._contextMenuEvent=c:this._map.fire(new Lr(c.type,this._map,c)),this._map.listens("contextmenu")&&c.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class d_{constructor(c,h){this._map=c,this._el=c.getCanvasContainer(),this._container=c.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(c,h){this.isEnabled()&&c.shiftKey&&0===c.button&&(jt(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(c,h){if(!this._active)return;const _=h,w=this._startPos,C=this._lastPos;if(!w||!C||C.equals(_)||!this._box&&_.dist(w)<this._clickTolerance)return;this._lastPos=_,this._box||(this._box=Qe("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",c));const I=Math.min(w.x,_.x),A=Math.max(w.x,_.x),P=Math.min(w.y,_.y),N=Math.max(w.y,_.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${I}px,${P}px)`,this._box.style.width=A-I+"px",this._box.style.height=N-P+"px")})}mouseupWindow(c,h){if(!this._active)return;const _=this._startPos,w=h;if(_&&0===c.button){if(this.reset(),Fn(),_.x!==w.x||_.y!==w.y)return this._map.fire(new p.Event("boxzoomend",{originalEvent:c})),{cameraAnimation:C=>C.fitScreenCoordinates(_,w,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",c)}}keydown(c){this._active&&27===c.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",c))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),_n(),delete this._startPos,delete this._lastPos}_fireEvent(c,h){return this._map.fire(new p.Event(c,{originalEvent:h}))}}function lo(g,c){const h={};for(let _=0;_<g.length;_++)h[g[_].identifier]=c[_];return h}class Mu{constructor(c){this.reset(),this.numTouches=c.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(c,h,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=c.timeStamp),_.length===this.numTouches&&(this.centroid=function(w){const C=new p.Point(0,0);for(const I of w)C._add(I);return C.div(w.length)}(h),this.touches=lo(_,h)))}touchmove(c,h,_){if(this.aborted||!this.centroid)return;const w=lo(_,h);for(const C in this.touches){const I=w[C];(!I||I.dist(this.touches[C])>30)&&(this.aborted=!0)}}touchend(c,h,_){if((!this.centroid||c.timeStamp-this.startTime>500)&&(this.aborted=!0),0===_.length){const w=!this.aborted&&this.centroid;if(this.reset(),w)return w}}}class qm{constructor(c){this.singleTap=new Mu(c),this.numTaps=c.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(c,h,_){this.singleTap.touchstart(c,h,_)}touchmove(c,h,_){this.singleTap.touchmove(c,h,_)}touchend(c,h,_){const w=this.singleTap.touchend(c,h,_);if(w){const C=c.timeStamp-this.lastTime<500,I=!this.lastTap||this.lastTap.dist(w)<30;if(C&&I||this.reset(),this.count++,this.lastTime=c.timeStamp,this.lastTap=w,this.count===this.numTaps)return this.reset(),w}}}class Hh{constructor(){this._zoomIn=new qm({numTouches:1,numTaps:2}),this._zoomOut=new qm({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(c,h,_){this._zoomIn.touchstart(c,h,_),this._zoomOut.touchstart(c,h,_)}touchmove(c,h,_){this._zoomIn.touchmove(c,h,_),this._zoomOut.touchmove(c,h,_)}touchend(c,h,_){const w=this._zoomIn.touchend(c,h,_),C=this._zoomOut.touchend(c,h,_);return w?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:I.getZoom()+1,around:I.unproject(w)},{originalEvent:c})}):C?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:I.getZoom()-1,around:I.unproject(C)},{originalEvent:c})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Ks={0:1,2:2};class Au{constructor(c){this.reset(),this._clickTolerance=c.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(c,h){return!1}_move(c,h){return{}}mousedown(c,h){if(this._lastPoint)return;const _=Ie(c);this._correctButton(c,_)&&(this._lastPoint=h,this._eventButton=_)}mousemoveWindow(c,h){const _=this._lastPoint;if(_)if(c.preventDefault(),null!=this._eventButton&&function(w,C){const I=Ks[C];return void 0===w.buttons||(w.buttons&I)!==I}(c,this._eventButton))this.reset();else if(this._moved||!(h.dist(_)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(_,h)}mouseupWindow(c){this._lastPoint&&Ie(c)===this._eventButton&&(this._moved&&Fn(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Fd extends Au{mousedown(c,h){super.mousedown(c,h),this._lastPoint&&(this._active=!0)}_correctButton(c,h){return 0===h&&!c.ctrlKey}_move(c,h){return{around:h,panDelta:h.sub(c)}}}class lc extends Au{_correctButton(c,h){return 0===h&&c.ctrlKey||2===h}_move(c,h){const _=.8*(h.x-c.x);if(_)return this._active=!0,{bearingDelta:_}}contextmenu(c){c.preventDefault()}}class Ls extends Au{_correctButton(c,h){return 0===h&&c.ctrlKey||2===h}_move(c,h){const _=-.5*(h.y-c.y);if(_)return this._active=!0,{pitchDelta:_}}contextmenu(c){c.preventDefault()}}class $h{constructor(c,h){this._map=c,this._el=c.getCanvasContainer(),this._minTouches=1,this._clickTolerance=h.clickTolerance||1,this.reset(),p.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new p.Point(0,0)}touchstart(c,h,_){return this._calculateTransform(c,h,_)}touchmove(c,h,_){if(this._active&&!(_.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===_.length&&!p.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return c.cancelable&&c.preventDefault(),this._calculateTransform(c,h,_)}}touchend(c,h,_){this._calculateTransform(c,h,_),this._active&&_.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(c,h,_){_.length>0&&(this._active=!0);const w=lo(_,h),C=new p.Point(0,0),I=new p.Point(0,0);let A=0;for(const N in w){const B=w[N],$=this._touches[N];$&&(C._add(B),I._add(B.sub($)),A++,w[N]=B)}if(this._touches=w,A<this._minTouches||!I.mag())return;const P=I.div(A);return this._sum._add(P),this._sum.mag()<this._clickTolerance?void 0:{around:C.div(A),panDelta:P}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Qe("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class cc{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(c){}_move(c,h,_){return{}}touchstart(c,h,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([h[0],h[1]]))}touchmove(c,h,_){const w=this._firstTwoTouches;if(!w)return;c.preventDefault();const[C,I]=w,A=Nd(_,h,C),P=Nd(_,h,I);if(!A||!P)return;const N=this._aroundCenter?null:A.add(P).div(2);return this._move([A,P],N,c)}touchend(c,h,_){if(!this._firstTwoTouches)return;const[w,C]=this._firstTwoTouches,I=Nd(_,h,w),A=Nd(_,h,C);I&&A||(this._active&&Fn(),this.reset())}touchcancel(){this.reset()}enable(c){this._enabled=!0,this._aroundCenter=!!c&&"center"===c.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Nd(g,c,h){for(let _=0;_<g.length;_++)if(g[_].identifier===h)return c[_]}function fl(g,c){return Math.log(g/c)/Math.LN2}class af extends cc{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(c){this._startDistance=this._distance=c[0].dist(c[1])}_move(c,h){const _=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(fl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:fl(this._distance,_),pinchAround:h}}}function Bd(g,c){return 180*g.angleWith(c)/Math.PI}class Ii extends cc{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])}_move(c,h){const _=this._vector;if(this._vector=c[0].sub(c[1]),_&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Bd(this._vector,_),pinchAround:h}}_isBelowThreshold(c){this._minDiameter=Math.min(this._minDiameter,c.mag());const h=25/(Math.PI*this._minDiameter)*360,_=this._startVector;if(!_)return!1;const w=Bd(c,_);return Math.abs(w)<h}}function Fl(g){return Math.abs(g.y)>Math.abs(g.x)}class h_ extends cc{constructor(c){super(),this._map=c}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(c){this._lastPoints=c,Fl(c[0].sub(c[1]))&&(this._valid=!1)}_move(c,h,_){const w=this._lastPoints;if(!w)return;const C=c[0].sub(w[0]),I=c[1].sub(w[1]);return this._map._cooperativeGestures&&!p.isFullscreen()&&_.touches.length<3||(this._valid=this.gestureBeginsVertically(C,I,_.timeStamp),!this._valid)?void 0:(this._lastPoints=c,this._active=!0,{pitchDelta:(C.y+I.y)/2*-.5})}gestureBeginsVertically(c,h,_){if(void 0!==this._valid)return this._valid;const w=c.mag()>=2,C=h.mag()>=2;if(!w&&!C)return;if(!w||!C)return null==this._firstMove&&(this._firstMove=_),_-this._firstMove<100&&void 0;const I=c.y>0==h.y>0;return Fl(c)&&Fl(h)&&I}}const Gm={panStep:100,bearingStep:15,pitchStep:10};class p_{constructor(){const c=Gm;this._panStep=c.panStep,this._bearingStep=c.bearingStep,this._pitchStep=c.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(c){if(c.altKey||c.ctrlKey||c.metaKey)return;let h=0,_=0,w=0,C=0,I=0;switch(c.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:c.shiftKey?_=-1:(c.preventDefault(),C=-1);break;case 39:c.shiftKey?_=1:(c.preventDefault(),C=1);break;case 38:c.shiftKey?w=1:(c.preventDefault(),I=-1);break;case 40:c.shiftKey?w=-1:(c.preventDefault(),I=1);break;default:return}return this._rotationDisabled&&(_=0,w=0),{cameraAnimation:A=>{const P=A.getZoom();A.easeTo({duration:300,easeId:"keyboardHandler",easing:Wm,zoom:h?Math.round(P)+h*(c.shiftKey?2:1):P,bearing:A.getBearing()+_*this._bearingStep,pitch:A.getPitch()+w*this._pitchStep,offset:[-C*this._panStep,-I*this._panStep],center:A.getCenter()},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Wm(g){return g*(2-g)}const qh=4.000244140625;class Xm{constructor(c,h){this._map=c,this._el=c.getCanvasContainer(),this._handler=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,p.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(c){this._defaultZoomRate=c}setWheelZoomRate(c){this._wheelZoomRate=c}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(c){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!c&&"center"===c.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(c){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(c.ctrlKey||c.metaKey||this.isZooming()||p.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let h=c.deltaMode===p.window.WheelEvent.DOM_DELTA_LINE?40*c.deltaY:c.deltaY;const _=p.exported.now(),w=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,0!==h&&h%qh==0?this._type="wheel":0!==h&&Math.abs(h)<4?this._type="trackpad":w>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,c)):this._type||(this._type=Math.abs(w*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),c.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=c,this._delta-=h,this._active||this._start(c)),c.preventDefault()}_onTimeout(c){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)}_start(c){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=Rt(this._el,c);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:h,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const c=this._map.transform;"wheel"===this._type&&c.projection.wrap&&(c._center.lng>=180||c._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const h=()=>c._terrainEnabled()&&this._aroundCoord?c.computeZoomRelativeTo(this._aroundCoord):c.zoom;if(0!==this._delta){const P="wheel"===this._type&&Math.abs(this._delta)>qh?this._wheelZoomRate:this._defaultZoomRate;let N=2/(1+Math.exp(-Math.abs(this._delta*P)));this._delta<0&&0!==N&&(N=1/N);const B=h(),$=Math.pow(2,B),Q="number"==typeof this._targetZoom?c.zoomScale(this._targetZoom):$;this._targetZoom=Math.min(c.maxZoom,Math.max(c.minZoom,c.scaleZoom(Q*N))),"wheel"===this._type&&(this._startZoom=B,this._easing=this._smoothOutEasing(200)),this._delta=0}const _="number"==typeof this._targetZoom?this._targetZoom:h(),w=this._startZoom,C=this._easing;let I,A=!1;if("wheel"===this._type&&w&&C){const P=Math.min((p.exported.now()-this._lastWheelEventTime)/200,1),N=C(P);I=p.number(w,_,N),P<1?this._frameId||(this._frameId=!0):A=!0}else I=_,A=!0;return this._active=!0,A&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!A,zoomDelta:I-h(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(c){let h=p.ease;if(this._prevEase){const _=this._prevEase,w=(p.exported.now()-_.start)/_.duration,C=_.easing(w+.01)-_.easing(w),I=.27/Math.sqrt(C*C+1e-4)*.01,A=Math.sqrt(.0729-I*I);h=p.bezier(I,A,.25,1)}return this._prevEase={start:p.exported.now(),duration:c,easing:h},h}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Qe("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(p.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class Zm{constructor(c,h){this._clickZoom=c,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ot{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(c,h){return c.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:_.getZoom()+(c.shiftKey?-1:1),around:_.unproject(h)},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class cr{constructor(){this._tap=new qm({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(c,h,_){this._swipePoint||(this._tapTime&&c.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?_.length>0&&(this._swipePoint=h[0],this._swipeTouch=_[0].identifier):this._tap.touchstart(c,h,_))}touchmove(c,h,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const w=h[0],C=w.y-this._swipePoint.y;return this._swipePoint=w,c.preventDefault(),this._active=!0,{zoomDelta:C/128}}}else this._tap.touchmove(c,h,_)}touchend(c,h,_){this._tapTime?this._swipePoint&&0===_.length&&this.reset():this._tap.touchend(c,h,_)&&(this._tapTime=c.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Vi{constructor(c,h,_){this._el=c,this._mousePan=h,this._touchPan=_}enable(c){this._inertiaOptions=c||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Gi{constructor(c,h,_){this._pitchWithRotate=c.pitchWithRotate,this._mouseRotate=h,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class zo{constructor(c,h,_,w){this._el=c,this._touchZoom=h,this._touchRotate=_,this._tapDragZoom=w,this._rotationDisabled=!1,this._enabled=!0}enable(c){this._touchZoom.enable(c),this._rotationDisabled||this._touchRotate.enable(c),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const da=g=>g.zoom||g.drag||g.pitch||g.rotate;class ku extends p.Event{}class ml{constructor(){this.constants=[1,1,.01],this.radius=0}setup(c,h){const _=p.sub([],h,c);this.radius=p.length(_[2]<0?p.div([],_,this.constants):[_[0],_[1],0])}projectRay(c){p.div(c,c,this.constants),p.normalize(c,c),p.mul$1(c,c,this.constants);const h=p.scale$2([],c,this.radius);if(h[2]>0){const _=p.scale$2([],[0,0,1],p.dot(h,[0,0,1])),w=p.scale$2([],p.normalize([],[h[0],h[1],0]),this.radius),C=p.add([],h,p.scale$2([],p.sub([],p.add([],w,_),h),2));h[0]=C[0],h[1]=C[1]}return h}}function ha(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta}class Ma{constructor(c,h){this._map=c,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new $m(c),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new ml,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(h),p.bindAll(["handleEvent","handleWindowEvent"],this);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[p.window.document,"mousemove",{capture:!0}],[p.window.document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[p.window,"blur",void 0]];for(const[w,C,I]of this._listeners)w.addEventListener(C,w===p.window.document?this.handleWindowEvent:this.handleEvent,I)}destroy(){for(const[c,h,_]of this._listeners)c.removeEventListener(h,c===p.window.document?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(c){const h=this._map,_=h.getCanvasContainer();this._add("mapEvent",new Ld(h,c));const w=h.boxZoom=new d_(h,c);this._add("boxZoom",w);const C=new Hh,I=new Ot;h.doubleClickZoom=new Zm(I,C),this._add("tapZoom",C),this._add("clickZoom",I);const A=new cr;this._add("tapDragZoom",A);const P=h.touchPitch=new h_(h);this._add("touchPitch",P);const N=new lc(c),B=new Ls(c);h.dragRotate=new Gi(c,N,B),this._add("mouseRotate",N,["mousePitch"]),this._add("mousePitch",B,["mouseRotate"]);const $=new Fd(c),Q=new $h(h,c);h.dragPan=new Vi(_,$,Q),this._add("mousePan",$),this._add("touchPan",Q,["touchZoom","touchRotate"]);const re=new Ii,ae=new af;h.touchZoomRotate=new zo(_,ae,re,A),this._add("touchRotate",re,["touchPan","touchZoom"]),this._add("touchZoom",ae,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Uh(h));const se=h.scrollZoom=new Xm(h,this);this._add("scrollZoom",se,["mousePan"]);const ce=h.keyboard=new p_;this._add("keyboard",ce);for(const q of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])c.interactive&&c[q]&&h[q].enable(c[q])}_add(c,h,_){this._handlers.push({handlerName:c,handler:h,allowed:_}),this._handlersById[c]=h}stop(c){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},c),this._changes=[]}}isActive(){for(const{handler:c}of this._handlers)if(c.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!da(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(c,h,_){for(const w in c)if(w!==_&&(!h||h.indexOf(w)<0))return!0;return!1}handleWindowEvent(c){this.handleEvent(c,`${c.type}Window`)}_getMapTouches(c){const h=[];for(const _ of c)this._el.contains(_.target)&&h.push(_);return h}handleEvent(c,h){this._updatingCamera=!0;const _="renderFrame"===c.type,w=_?void 0:c,C={needsRenderFrame:!1},I={},A={},P=c.touches?this._getMapTouches(c.touches):void 0,N=P?Dn(this._el,P):_?void 0:Rt(this._el,c);for(const{handlerName:Q,handler:re,allowed:ae}of this._handlers){if(!re.isEnabled())continue;let se;this._blockedByActive(A,ae,Q)?re.reset():re[h||c.type]&&(se=re[h||c.type](c,N,P),this.mergeHandlerResult(C,I,se,Q,w),se&&se.needsRenderFrame&&this._triggerRenderFrame()),(se||re.isActive())&&(A[Q]=re)}const B={};for(const Q in this._previousActiveHandlers)A[Q]||(B[Q]=w);this._previousActiveHandlers=A,(Object.keys(B).length||ha(C))&&(this._changes.push([C,I,B]),this._triggerRenderFrame()),(Object.keys(A).length||ha(C))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:$}=C;$&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],$(this._map))}mergeHandlerResult(c,h,_,w,C){if(!_)return;p.extend(c,_);const I={handlerName:w,originalEvent:_.originalEvent||C};void 0!==_.zoomDelta&&(h.zoom=I),void 0!==_.panDelta&&(h.drag=I),void 0!==_.pitchDelta&&(h.pitch=I),void 0!==_.bearingDelta&&(h.rotate=I)}_applyChanges(){const c={},h={},_={};for(const[w,C,I]of this._changes)w.panDelta&&(c.panDelta=(c.panDelta||new p.Point(0,0))._add(w.panDelta)),w.zoomDelta&&(c.zoomDelta=(c.zoomDelta||0)+w.zoomDelta),w.bearingDelta&&(c.bearingDelta=(c.bearingDelta||0)+w.bearingDelta),w.pitchDelta&&(c.pitchDelta=(c.pitchDelta||0)+w.pitchDelta),void 0!==w.around&&(c.around=w.around),void 0!==w.aroundCoord&&(c.aroundCoord=w.aroundCoord),void 0!==w.pinchAround&&(c.pinchAround=w.pinchAround),w.noInertia&&(c.noInertia=w.noInertia),p.extend(h,C),p.extend(_,I);this._updateMapTransform(c,h,_),this._changes=[]}_updateMapTransform(c,h,_){const w=this._map,C=w.transform,I=ie=>[ie.x,ie.y,ie.z];if((ie=>{const me=this._eventsInProgress.drag;return me&&!this._handlersById[me.handlerName].isActive()})()&&!ha(c)){const ie=C.zoom;C.cameraElevationReference="sea",C.recenterOnTerrain(),C.cameraElevationReference="ground",ie!==C.zoom&&this._map._update(!0)}if(C._isCameraConstrained&&w._stop(!0),!ha(c))return void this._fireEvents(h,_,!0);let{panDelta:A,zoomDelta:P,bearingDelta:N,pitchDelta:B,around:$,aroundCoord:Q,pinchAround:re}=c;C._isCameraConstrained&&(P>0&&(P=0),C._isCameraConstrained=!1),void 0!==re&&($=re),(P||(ie=>h.drag&&!this._eventsInProgress.drag)())&&$&&(this._dragOrigin=I(C.pointCoordinate3D($)),this._trackingEllipsoid.setup(C._camera.position,this._dragOrigin)),C.cameraElevationReference="sea",w._stop(!0),$=$||w.transform.centerPoint,N&&(C.bearing+=N),B&&(C.pitch+=B),C._updateCameraState();const ae=[0,0,0];if(A)if("mercator"===C.projection.name){const ie=this._trackingEllipsoid.projectRay(C.screenPointToMercatorRay($).dir),me=this._trackingEllipsoid.projectRay(C.screenPointToMercatorRay($.sub(A)).dir);ae[0]=me[0]-ie[0],ae[1]=me[1]-ie[1]}else{const ie=C.pointCoordinate($);if("globe"===C.projection.name){A=A.rotate(-C.angle);const me=C._pixelsPerMercatorPixel/C.worldSize;ae[0]=-A.x*p.mercatorScale(p.latFromMercatorY(ie.y))*me,ae[1]=-A.y*p.mercatorScale(C.center.lat)*me}else{const me=C.pointCoordinate($.sub(A));ie&&me&&(ae[0]=me.x-ie.x,ae[1]=me.y-ie.y)}}const se=C.zoom,ce=[0,0,0];if(P){const ie=I(Q||C.pointCoordinate3D($)),me={dir:p.normalize([],p.sub([],ie,C._camera.position))};if(me.dir[2]<0){const be=C.zoomDeltaToMovement(ie,P);p.scale$2(ce,me.dir,be)}}const q=p.add(ae,ae,ce);C._translateCameraConstrained(q),P&&Math.abs(C.zoom-se)>1e-4&&C.recenterOnTerrain(),C.cameraElevationReference="ground",this._map._update(),c.noInertia||this._inertia.record(c),this._fireEvents(h,_,!0)}_fireEvents(c,h,_){const w=da(this._eventsInProgress),C=da(c),I={};for(const B in c){const{originalEvent:$}=c[B];this._eventsInProgress[B]||(I[`${B}start`]=$),this._eventsInProgress[B]=c[B]}!w&&C&&this._fireEvent("movestart",C.originalEvent);for(const B in I)this._fireEvent(B,I[B]);C&&this._fireEvent("move",C.originalEvent);for(const B in c){const{originalEvent:$}=c[B];this._fireEvent(B,$)}const A={};let P;for(const B in this._eventsInProgress){const{handlerName:$,originalEvent:Q}=this._eventsInProgress[B];this._handlersById[$].isActive()||(delete this._eventsInProgress[B],P=h[$]||Q,A[`${B}end`]=P)}for(const B in A)this._fireEvent(B,A[B]);const N=da(this._eventsInProgress);if(_&&(w||C)&&!N){this._updatingCamera=!0;const B=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),$=Q=>0!==Q&&-this._bearingSnap<Q&&Q<this._bearingSnap;B?($(B.bearing||this._map.getBearing())&&(B.bearing=0),this._map.easeTo(B,{originalEvent:P})):(this._map.fire(new p.Event("moveend",{originalEvent:P})),$(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(c,h){this._map.fire(new p.Event(c,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(c=>{this._frameId=void 0,this.handleEvent(new ku("renderFrame",{timeStamp:c})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Ru="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Gh extends p.Evented{constructor(c,h){super(),this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=h.bearingSnap,this._respectPrefersReducedMotion=!1!==h.respectPrefersReducedMotion,p.bindAll(["_renderFrameCallback"],this)}getCenter(){return new p.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(c,h){return this.jumpTo({center:c},h)}panBy(c,h,_){return c=p.Point.convert(c).mult(-1),this.panTo(this.transform.center,p.extend({offset:c},h),_)}panTo(c,h,_){return this.easeTo(p.extend({center:c},h),_)}getZoom(){return this.transform.zoom}setZoom(c,h){return this.jumpTo({zoom:c},h),this}zoomTo(c,h,_){return this.easeTo(p.extend({zoom:c},h),_)}zoomIn(c,h){return this.zoomTo(this.getZoom()+1,c,h),this}zoomOut(c,h){return this.zoomTo(this.getZoom()-1,c,h),this}getBearing(){return this.transform.bearing}setBearing(c,h){return this.jumpTo({bearing:c},h),this}getPadding(){return this.transform.padding}setPadding(c,h){return this.jumpTo({padding:c},h),this}rotateTo(c,h,_){return this.easeTo(p.extend({bearing:c},h),_)}resetNorth(c,h){return this.rotateTo(0,p.extend({duration:1e3},c),h),this}resetNorthPitch(c,h){return this.easeTo(p.extend({bearing:0,pitch:0,duration:1e3},c),h),this}snapToNorth(c,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,h):this}getPitch(){return this.transform.pitch}setPitch(c,h){return this.jumpTo({pitch:c},h),this}cameraForBounds(c,h){c=p.LngLatBounds.convert(c);const _=h&&h.bearing||0,w=h&&h.pitch||0,C=c.getNorthWest(),I=c.getSouthEast();return this._cameraForBounds(this.transform,C,I,_,w,h)}_extendCameraOptions(c){const h={top:0,bottom:0,right:0,left:0};if("number"==typeof(c=p.extend({padding:h,offset:[0,0],maxZoom:this.transform.maxZoom},c)).padding){const _=c.padding;c.padding={top:_,bottom:_,right:_,left:_}}return c.padding=p.extend(h,c.padding),c}_minimumAABBFrustumDistance(c,h){const _=h.max[0]-h.min[0],w=h.max[1]-h.min[1];return _/w>c.aspect?_/(2*Math.tan(.5*c.fovX)*c.aspect):w/(2*Math.tan(.5*c.fovY)*c.aspect)}_cameraForBoundsOnGlobe(c,h,_,w,C,I){const A=c.clone(),P=this._extendCameraOptions(I);A.bearing=w,A.pitch=C;const N=p.LngLat.convert(h),B=p.LngLat.convert(_),$=.5*(N.lat+B.lat),Q=.5*(N.lng+B.lng),re=p.latLngToECEF($,Q),ae=p.normalize([],re),se=p.normalize([],p.cross([],ae,[0,1,0])),ce=p.cross([],se,ae),q=[se[0],se[1],se[2],0,ce[0],ce[1],ce[2],0,ae[0],ae[1],ae[2],0,0,0,0,1],ie=[re,p.latLngToECEF(N.lat,N.lng),p.latLngToECEF(B.lat,N.lng),p.latLngToECEF(B.lat,B.lng),p.latLngToECEF(N.lat,B.lng),p.latLngToECEF($,N.lng),p.latLngToECEF($,B.lng),p.latLngToECEF(N.lat,Q),p.latLngToECEF(B.lat,Q)];let me=p.Aabb.fromPoints(ie.map(At=>[p.dot(se,At),p.dot(ce,At),p.dot(ae,At)]));const be=p.transformMat4([],me.center,q);0===p.squaredLength(be)&&p.set(be,0,0,1),p.normalize(be,be),p.scale$2(be,be,p.GLOBE_RADIUS),A.center=p.ecefToLatLng(be);const Le=A.getWorldToCameraMatrix(),Pe=p.invert(new Float64Array(16),Le);me=p.Aabb.applyTransform(me,p.multiply([],Le,q)),p.transformMat4(be,be,Le);const Oe=.5*(me.max[2]-me.min[2]),Ke=this._minimumAABBFrustumDistance(A,me),We=p.scale$2([],[0,0,1],Oe),at=p.add(We,be,We),zt=Ke+(0===A.pitch?0:p.distance(be,at)),it=A.globeCenterInViewSpace,Tt=p.sub([],be,[it[0],it[1],it[2]]);p.normalize(Tt,Tt),p.scale$2(Tt,Tt,zt);const ht=p.add([],be,Tt);p.transformMat4(ht,ht,Pe);const Vt=p.earthRadius/p.GLOBE_RADIUS,ot=p.length(ht),wt=p.mercatorZfromAltitude(Math.max(ot*Vt-p.earthRadius,Number.EPSILON),0),Ut=Math.min(A.zoomFromMercatorZAdjusted(wt),P.maxZoom);return Ut>.5*(p.GLOBE_ZOOM_THRESHOLD_MIN+p.GLOBE_ZOOM_THRESHOLD_MAX)?(A.setProjection({name:"mercator"}),A.zoom=Ut,this._cameraForBounds(A,h,_,w,C,I)):{center:A.center,zoom:Ut,bearing:w,pitch:C}}queryTerrainElevation(c,h){const _=this.transform.elevation;return _?(h=p.extend({},{exaggerated:!0},h),_.getAtPoint(p.MercatorCoordinate.fromLngLat(c),null,h.exaggerated)):null}_cameraForBounds(c,h,_,w,C,I){if("globe"===c.projection.name)return this._cameraForBoundsOnGlobe(c,h,_,w,C,I);const A=c.clone(),P=this._extendCameraOptions(I),N=A.padding;A.bearing=w,A.pitch=C;const B=p.LngLat.convert(h),$=p.LngLat.convert(_),Q=new p.LngLat(B.lng,$.lat),re=new p.LngLat($.lng,B.lat),ae=A.project(B),se=A.project($),ce=this.queryTerrainElevation(B),q=this.queryTerrainElevation($),ie=this.queryTerrainElevation(Q),me=this.queryTerrainElevation(re),be=[[ae.x,ae.y,Math.min(ce||0,q||0,ie||0,me||0)],[se.x,se.y,Math.max(ce||0,q||0,ie||0,me||0)]];let Le=p.Aabb.fromPoints(be);const Pe=A.getWorldToCameraMatrix(),Oe=p.invert(new Float64Array(16),Pe);Le=p.Aabb.applyTransform(Le,Pe);const Ke=p.sub([],Le.max,Le.min),We=N.left||0,at=N.right||0,zt=N.bottom||0,it=N.top||0,{left:Tt,right:ht,top:Vt,bottom:ot}=P.padding,wt=.5*(We+at),Ut=.5*(it+zt),At=Math.min(A.scaleZoom(A.scale*Math.min((A.width-(We+at+Tt+ht))/Ke[0],(A.height-(zt+it+ot+Vt))/Ke[1])),P.maxZoom),qt=A.scale/A.zoomScale(At);Le=new p.Aabb([Le.min[0]-(Tt+wt)*qt,Le.min[1]-(ot+Ut)*qt,Le.min[2]],[Le.max[0]+(ht+wt)*qt,Le.max[1]+(Vt+Ut)*qt,Le.max[2]]);const Un=.5*Ke[2],ti=this._minimumAABBFrustumDistance(A,Le),An=[0,0,1,0];p.transformMat4$1(An,An,Pe),p.normalize$2(An,An);const Hn=p.scale$2([],An,ti+Un),Ai=p.add([],Le.center,Hn),wi=("number"==typeof P.offset.x&&"number"==typeof P.offset.y?new p.Point(P.offset.x,P.offset.y):p.Point.convert(P.offset)).rotate(-p.degToRad(w));Le.center[0]-=wi.x*qt,Le.center[1]+=wi.y*qt,p.transformMat4(Le.center,Le.center,Oe),p.transformMat4(Ai,Ai,Oe);const Vn=[Le.center[0],Le.center[1],Ai[2]*A.pixelsPerMeter];p.scale$2(Vn,Vn,1/A.worldSize);const ur=p.lngFromMercatorX(Vn[0]),wr=p.latFromMercatorY(Vn[1]),Dr=Math.min(A._zoomFromMercatorZ(Vn[2]),P.maxZoom),ji=new p.LngLat(ur,wr);return A.mercatorFromTransition&&Dr<.5*(p.GLOBE_ZOOM_THRESHOLD_MIN+p.GLOBE_ZOOM_THRESHOLD_MAX)?(A.setProjection({name:"globe"}),A.zoom=Dr,this._cameraForBounds(A,h,_,w,C,I)):{center:ji,zoom:Dr,bearing:w,pitch:C}}fitBounds(c,h,_){const w=this.cameraForBounds(c,h);return this._fitInternal(w,h,_)}fitScreenCoordinates(c,h,_,w,C){const I=p.Point.convert(c),A=p.Point.convert(h),P=new p.Point(Math.min(I.x,A.x),Math.min(I.y,A.y)),N=new p.Point(Math.max(I.x,A.x),Math.max(I.y,A.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(I,A))return this;const B=this.transform.pointLocation3D(P),$=this.transform.pointLocation3D(N),Q=this.transform.pointLocation3D(new p.Point(P.x,N.y)),re=this.transform.pointLocation3D(new p.Point(N.x,P.y)),ae=[Math.min(B.lng,$.lng,Q.lng,re.lng),Math.min(B.lat,$.lat,Q.lat,re.lat)],se=[Math.max(B.lng,$.lng,Q.lng,re.lng),Math.max(B.lat,$.lat,Q.lat,re.lat)],ce=w&&w.pitch?w.pitch:this.getPitch(),q=this._cameraForBounds(this.transform,ae,se,_,ce,w);return this._fitInternal(q,w,C)}_fitInternal(c,h,_){return c?(delete(h=p.extend(c,h)).padding,h.linear?this.easeTo(h,_):this.flyTo(h,_)):this}jumpTo(c,h){this.stop();const _=c.preloadOnly?this.transform.clone():this.transform;let w=!1,C=!1,I=!1;return"zoom"in c&&_.zoom!==+c.zoom&&(w=!0,_.zoom=+c.zoom),void 0!==c.center&&(_.center=p.LngLat.convert(c.center)),"bearing"in c&&_.bearing!==+c.bearing&&(C=!0,_.bearing=+c.bearing),"pitch"in c&&_.pitch!==+c.pitch&&(I=!0,_.pitch=+c.pitch),null==c.padding||_.isPaddingEqual(c.padding)||(_.padding=c.padding),c.preloadOnly?(this._preloadTiles(_),this):(this.fire(new p.Event("movestart",h)).fire(new p.Event("move",h)),w&&this.fire(new p.Event("zoomstart",h)).fire(new p.Event("zoom",h)).fire(new p.Event("zoomend",h)),C&&this.fire(new p.Event("rotatestart",h)).fire(new p.Event("rotate",h)).fire(new p.Event("rotateend",h)),I&&this.fire(new p.Event("pitchstart",h)).fire(new p.Event("pitch",h)).fire(new p.Event("pitchend",h)),this.fire(new p.Event("moveend",h)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||p.warnOnce(Ru),this.transform.getFreeCameraOptions()}setFreeCameraOptions(c,h){const _=this.transform;if(!_.projection.supportsFreeCamera)return p.warnOnce(Ru),this;this.stop();const w=_.zoom,C=_.pitch,I=_.bearing;_.setFreeCameraOptions(c);const A=w!==_.zoom,P=C!==_.pitch,N=I!==_.bearing;return this.fire(new p.Event("movestart",h)).fire(new p.Event("move",h)),A&&this.fire(new p.Event("zoomstart",h)).fire(new p.Event("zoom",h)).fire(new p.Event("zoomend",h)),N&&this.fire(new p.Event("rotatestart",h)).fire(new p.Event("rotate",h)).fire(new p.Event("rotateend",h)),P&&this.fire(new p.Event("pitchstart",h)).fire(new p.Event("pitch",h)).fire(new p.Event("pitchend",h)),this.fire(new p.Event("moveend",h)),this}easeTo(c,h){this._stop(!1,c.easeId),(!1===(c=p.extend({offset:[0,0],duration:500,easing:p.ease},c)).animate||this._prefersReducedMotion(c))&&(c.duration=0);const _=this.transform,w=this.getZoom(),C=this.getBearing(),I=this.getPitch(),A=this.getPadding(),P="zoom"in c?+c.zoom:w,N="bearing"in c?this._normalizeBearing(c.bearing,C):C,B="pitch"in c?+c.pitch:I,$="padding"in c?c.padding:_.padding,Q=p.Point.convert(c.offset);let re,ae,se;if("globe"===_.projection.name){const We=p.MercatorCoordinate.fromLngLat(_.center),at=Q.rotate(-_.angle);We.x+=at.x/_.worldSize,We.y+=at.y/_.worldSize;const zt=We.toLngLat(),it=p.LngLat.convert(c.center||zt);this._normalizeCenter(it),re=_.centerPoint.add(at),ae=new p.Point(We.x,We.y).mult(_.worldSize),se=new p.Point(p.mercatorXfromLng(it.lng),p.mercatorYfromLat(it.lat)).mult(_.worldSize).sub(ae)}else{re=_.centerPoint.add(Q);const We=_.pointLocation(re),at=p.LngLat.convert(c.center||We);this._normalizeCenter(at),ae=_.project(We),se=_.project(at).sub(ae)}const ce=_.zoomScale(P-w);let q,ie;c.around&&(q=p.LngLat.convert(c.around),ie=_.locationPoint(q));const me=this._zooming||P!==w,be=this._rotating||C!==N,Le=this._pitching||B!==I,Pe=!_.isPaddingEqual($),Oe=We=>at=>{if(me&&(We.zoom=p.number(w,P,at)),be&&(We.bearing=p.number(C,N,at)),Le&&(We.pitch=p.number(I,B,at)),Pe&&(We.interpolatePadding(A,$,at),re=We.centerPoint.add(Q)),q)We.setLocationAtPoint(q,ie);else{const zt=We.zoomScale(We.zoom-w),it=P>w?Math.min(2,ce):Math.max(.5,ce),Tt=Math.pow(it,1-at),ht=We.unproject(ae.add(se.mult(at*Tt)).mult(zt));We.setLocationAtPoint(We.renderWorldCopies?ht.wrap():ht,re)}return c.preloadOnly||this._fireMoveEvents(h),We};if(c.preloadOnly){const We=this._emulate(Oe,c.duration,_);return this._preloadTiles(We),this}const Ke={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=me,this._rotating=be,this._pitching=Le,this._padding=Pe,this._easeId=c.easeId,this._prepareEase(h,c.noMoveStart,Ke),this._ease(Oe(_),We=>{_.recenterOnTerrain(),this._afterEase(h,We)},c),this}_prepareEase(c,h,_={}){this._moving=!0,this.transform.cameraElevationReference="sea",h||_.moving||this.fire(new p.Event("movestart",c)),this._zooming&&!_.zooming&&this.fire(new p.Event("zoomstart",c)),this._rotating&&!_.rotating&&this.fire(new p.Event("rotatestart",c)),this._pitching&&!_.pitching&&this.fire(new p.Event("pitchstart",c))}_fireMoveEvents(c){this.fire(new p.Event("move",c)),this._zooming&&this.fire(new p.Event("zoom",c)),this._rotating&&this.fire(new p.Event("rotate",c)),this._pitching&&this.fire(new p.Event("pitch",c))}_afterEase(c,h){if(this._easeId&&h&&this._easeId===h)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const _=this._zooming,w=this._rotating,C=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new p.Event("zoomend",c)),w&&this.fire(new p.Event("rotateend",c)),C&&this.fire(new p.Event("pitchend",c)),this.fire(new p.Event("moveend",c))}flyTo(c,h){if(this._prefersReducedMotion(c)){const At=p.pick(c,["center","zoom","bearing","pitch","around"]);return this.jumpTo(At,h)}this.stop(),c=p.extend({offset:[0,0],speed:1.2,curve:1.42,easing:p.ease},c);const _=this.transform,w=this.getZoom(),C=this.getBearing(),I=this.getPitch(),A=this.getPadding(),P="zoom"in c?p.clamp(+c.zoom,_.minZoom,_.maxZoom):w,N="bearing"in c?this._normalizeBearing(c.bearing,C):C,B="pitch"in c?+c.pitch:I,$="padding"in c?c.padding:_.padding,Q=_.zoomScale(P-w),re=p.Point.convert(c.offset);let ae=_.centerPoint.add(re);const se=_.pointLocation(ae),ce=p.LngLat.convert(c.center||se);this._normalizeCenter(ce);const q=_.project(se),ie=_.project(ce).sub(q);let me=c.curve;const be=Math.max(_.width,_.height),Le=be/Q,Pe=ie.mag();if("minZoom"in c){const At=p.clamp(Math.min(c.minZoom,w,P),_.minZoom,_.maxZoom),qt=be/_.zoomScale(At-w);me=Math.sqrt(qt/Pe*2)}const Oe=me*me;function Ke(At){const qt=(Le*Le-be*be+(At?-1:1)*Oe*Oe*Pe*Pe)/(2*(At?Le:be)*Oe*Pe);return Math.log(Math.sqrt(qt*qt+1)-qt)}function We(At){return(Math.exp(At)-Math.exp(-At))/2}function at(At){return(Math.exp(At)+Math.exp(-At))/2}const zt=Ke(0);let it=function(At){return at(zt)/at(zt+me*At)},Tt=function(At){return be*((at(zt)*(We(qt=zt+me*At)/at(qt))-We(zt))/Oe)/Pe;var qt},ht=(Ke(1)-zt)/me;if(Math.abs(Pe)<1e-6||!isFinite(ht)){if(Math.abs(be-Le)<1e-6)return this.easeTo(c,h);const At=Le<be?-1:1;ht=Math.abs(Math.log(Le/be))/me,Tt=function(){return 0},it=function(qt){return Math.exp(At*me*qt)}}c.duration="duration"in c?+c.duration:1e3*ht/("screenSpeed"in c?+c.screenSpeed/me:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0);const Vt=C!==N,ot=B!==I,wt=!_.isPaddingEqual($),Ut=At=>qt=>{const Un=qt*ht,ti=1/it(Un);At.zoom=1===qt?P:w+At.scaleZoom(ti),Vt&&(At.bearing=p.number(C,N,qt)),ot&&(At.pitch=p.number(I,B,qt)),wt&&(At.interpolatePadding(A,$,qt),ae=At.centerPoint.add(re));const An=1===qt?ce:At.unproject(q.add(ie.mult(Tt(Un))).mult(ti));return At.setLocationAtPoint(At.renderWorldCopies?An.wrap():An,ae),At._updateCameraOnTerrain(),c.preloadOnly||this._fireMoveEvents(h),At};if(c.preloadOnly){const At=this._emulate(Ut,c.duration,_);return this._preloadTiles(At),this}return this._zooming=!0,this._rotating=Vt,this._pitching=ot,this._padding=wt,this._prepareEase(h,!1),this._ease(Ut(_),()=>this._afterEase(h),c),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(c,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const _=this._onEaseEnd;this._onEaseEnd=void 0,_.call(this,h)}if(!c){const _=this.handlers;_&&_.stop(!1)}return this}_ease(c,h,_){!1===_.animate||0===_.duration?(c(1),h()):(this._easeStart=p.exported.now(),this._easeOptions=_,this._onEaseFrame=c,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const c=Math.min((p.exported.now()-this._easeStart)/this._easeOptions.duration,1),h=this._onEaseFrame;h&&h(this._easeOptions.easing(c)),c<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(c,h){c=p.wrap(c,-180,180);const _=Math.abs(c-h);return Math.abs(c-360-h)<_&&(c-=360),Math.abs(c+360-h)<_&&(c+=360),c}_normalizeCenter(c){const h=this.transform;if(!h.renderWorldCopies||h.maxBounds)return;const _=c.lng-h.center.lng;c.lng+=_>180?-360:_<-180?360:0}_prefersReducedMotion(c){return this._respectPrefersReducedMotion&&p.exported.prefersReducedMotion&&!(c&&c.essential)}_emulate(c,h,_){const w=Math.ceil(15*h/1e3),C=[],I=c(_.clone());for(let A=0;A<=w;A++){const P=I(A/w);C.push(P.clone())}return C}}class Mn{constructor(c={}){this.options=c,p.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(c){const h=this.options&&this.options.compact;return this._map=c,this._container=Qe("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Qe("button","mapboxgl-ctrl-attrib-button",this._container),Qe("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Qe("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===h&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(c,h){const _=this._map._getUIString(`AttributionControl.${h}`);c.setAttribute("aria-label",_),c.removeAttribute("title"),c.firstElementChild&&c.firstElementChild.setAttribute("title",_)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let c=this._editLink;c||(c=this._editLink=this._container.querySelector(".mapbox-improve-map"));const h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||p.config.ACCESS_TOKEN}];if(c){const _=h.reduce((w,C,I)=>(C.value&&(w+=`${C.key}=${C.value}${I<h.length-1?"&":""}`),w),"?");c.href=`${p.config.FEEDBACK_URL}/${_}#${_r(this._map,!0)}`,c.rel="noopener nofollow",this._setElementTitle(c,"MapFeedback")}}_updateData(c){!c||"metadata"!==c.sourceDataType&&"visibility"!==c.sourceDataType&&"style"!==c.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let c=[];if(this._map.style.stylesheet){const w=this._map.style.stylesheet;this.styleOwner=w.owner,this.styleId=w.id}const h=this._map.style._sourceCaches;for(const w in h){const C=h[w];if(C.used){const I=C.getSource();I.attribution&&c.indexOf(I.attribution)<0&&c.push(I.attribution)}}c.sort((w,C)=>w.length-C.length),c=c.filter((w,C)=>{for(let I=C+1;I<c.length;I++)if(c[I].indexOf(w)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?c=[...this.options.customAttribution,...c]:c.unshift(this.options.customAttribution));const _=c.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,c.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Wh{constructor(){p.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(c){this._map=c,this._container=Qe("div","mapboxgl-ctrl");const h=Qe("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(c){c&&"metadata"!==c.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const c=this._map.style._sourceCaches;if(0===Object.entries(c).length)return!0;for(const h in c){const _=c[h].getSource();if(_.hasOwnProperty("mapbox_logo")&&!_.mapbox_logo)return!1}return!0}_updateCompact(){const c=this._container.children;if(c.length){const h=c[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}}}class rs{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(c){const h=++this._id;return this._queue.push({callback:c,id:h,cancelled:!1}),h}remove(c){const h=this._currentlyRunning,_=h?this._queue.concat(h):this._queue;for(const w of _)if(w.id===c)return void(w.cancelled=!0)}run(c=0){const h=this._currentlyRunning=this._queue;this._queue=[];for(const _ of h)if(!_.cancelled&&(_.callback(c),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Qs(g,c,h){if(g=new p.LngLat(g.lng,g.lat),c){const _=new p.LngLat(g.lng-360,g.lat),w=new p.LngLat(g.lng+360,g.lat),C=360*Math.ceil(Math.abs(g.lng-h.center.lng)/360),I=h.locationPoint(g).distSqr(c),A=c.x<0||c.y<0||c.x>h.width||c.y>h.height;h.locationPoint(_).distSqr(c)<I&&(A||Math.abs(_.lng-h.center.lng)<C)?g=_:h.locationPoint(w).distSqr(c)<I&&(A||Math.abs(w.lng-h.center.lng)<C)&&(g=w)}for(;Math.abs(g.lng-h.center.lng)>180;){const _=h.locationPoint(g);if(_.x>=0&&_.y>=0&&_.x<=h.width&&_.y<=h.height)break;g.lng>h.center.lng?g.lng-=360:g.lng+=360}return g}const uc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class sn extends p.Evented{constructor(c,h){if(super(),(c instanceof p.window.HTMLElement||h)&&(c=p.extend({element:c},h)),p.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=c&&c.occludedOpacity||.2,c&&c.element)this._element=c.element,this._offset=p.Point.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=Qe("div");const w=41,C=27,I=St("svg",{display:"block",height:w*this._scale+"px",width:C*this._scale+"px",viewBox:`0 0 ${C} ${w}`},this._element),A=St("radialGradient",{id:"shadowGradient"},St("defs",{},I));St("stop",{offset:"10%","stop-opacity":.4},A),St("stop",{offset:"100%","stop-opacity":.05},A),St("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},I),St("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},I),St("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},I),St("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},I),this._offset=p.Point.convert(c&&c.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",w=>{w.preventDefault()}),this._element.addEventListener("mousedown",w=>{w.preventDefault()});const _=this._element.classList;for(const w in uc)_.remove(`mapboxgl-marker-anchor-${w}`);_.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(c){return c===this._map||(this.remove(),this._map=c,c.getCanvasContainer().appendChild(this._element),c.on("move",this._updateMoving),c.on("moveend",this._update),c.on("remove",this._clearFadeTimer),c._addMarker(this),this.setDraggable(this._draggable),this._update(),c.on("click",this._onMapClick)),this}remove(){const c=this._map;return c&&(c.off("click",this._onMapClick),c.off("move",this._updateMoving),c.off("moveend",this._update),c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler),c.off("mouseup",this._onUp),c.off("touchend",this._onUp),c.off("mousemove",this._onMove),c.off("touchmove",this._onMove),c.off("remove",this._clearFadeTimer),c._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(c){return this._lngLat=p.LngLat.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){const w=Math.sqrt(Math.pow(13.5,2)/2);c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[w,-1*(24.6+w)],"bottom-right":[-w,-1*(24.6+w)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=c,c._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(c){const h=c.code,_=c.charCode||c.keyCode;"Space"!==h&&"Enter"!==h&&32!==_&&13!==_||this.togglePopup()}_onMapClick(c){const h=c.originalEvent.target,_=this._element;this._popup&&(h===_||_.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const c=this._popup;return c?(c.isOpen()?(c.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(c.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const c=this._map,h=this._pos;if(!c||!h)return!1;const _=c.unproject(h),w=c.getFreeCameraOptions();if(!w.position)return!1;const C=w.position.toLngLat();return C.distanceTo(_)<.9*C.distanceTo(this._lngLat)}_evaluateOpacity(){const c=this._map;if(!c)return;const h=this._pos;if(!h||h.x<0||h.x>c.transform.width||h.y<0||h.y>c.transform.height)return void this._clearFadeTimer();const _=c.unproject(h);let w;c._showingGlobe()&&p.isLngLatBehindGlobe(c.transform,this._lngLat)?w=0:(w=1-c._queryFogOpacity(_),c.transform._terrainEnabled()&&c.getTerrain()&&this._behindTerrain()&&(w*=this._occludedOpacity)),this._element.style.opacity=`${w}`,this._element.style.pointerEvents=w>0?"auto":"none",this._popup&&this._popup._setOpacity(w),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const c=this._pos;if(!c||!this._map)return;const h=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${c.x}px,${c.y}px)\n            ${uc[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${h.x}px,${h.y}px)\n        `}_calculateXYTransform(){const c=this._pos,h=this._map,_=this.getPitchAlignment();if(!h||!c||"map"!==_)return"";if(!h._showingGlobe()){const P=h.getPitch();return P?`rotateX(${P}deg)`:""}const w=p.radToDeg(p.globeTiltAtLngLat(h.transform,this._lngLat)),C=c.sub(p.globeCenterToScreenPoint(h.transform)),I=Math.abs(C.x)+Math.abs(C.y);if(0===I)return"";const A=w/I;return`rotateX(${-C.y*A}deg) rotateY(${C.x*A}deg)`}_calculateZTransform(){const c=this._pos,h=this._map;if(!h||!c)return"";let _=0;const w=this.getRotationAlignment();if("map"===w)if(h._showingGlobe()){const C=h.project(new p.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),I=h.project(new p.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(C);_=p.radToDeg(Math.atan2(I.y,I.x))-90}else _=-h.getBearing();else if("horizon"===w){const C=p.smoothstep(4,6,h.getZoom()),I=p.globeCenterToScreenPoint(h.transform);I.y+=C*h.transform.height;const A=c.sub(I),P=p.radToDeg(Math.atan2(A.y,A.x));_=(P>90?P-270:P+90)*(1-C)}return _+=this._rotation,_?`rotateZ(${_}deg)`:""}_update(c){p.window.cancelAnimationFrame(this._updateFrameId);const h=this._map;h&&(h.transform.renderWorldCopies&&(this._lngLat=Qs(this._lngLat,this._pos,h.transform)),this._pos=h.project(this._lngLat),!0===c?this._updateFrameId=p.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),h._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(h._showingGlobe()||h.getTerrain()||h.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(c){return this._offset=p.Point.convert(c),this._update(),this}_onMove(c){const h=this._map;if(!h)return;const _=this._pointerdownPos,w=this._positionDelta;if(_&&w){if(!this._isDragging){const C=this._clickTolerance||h._clickTolerance;if(c.point.dist(_)<C)return;this._isDragging=!0}this._pos=c.point.sub(w),this._lngLat=h.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new p.Event("dragstart"))),this.fire(new p.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const c=this._map;c&&(c.off("mousemove",this._onMove),c.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new p.Event("dragend")),this._state="inactive"}_addDragHandler(c){const h=this._map,_=this._pos;h&&_&&this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(_),this._pointerdownPos=c.point,this._state="pending",h.on("mousemove",this._onMove),h.on("touchmove",this._onMove),h.once("mouseup",this._onUp),h.once("touchend",this._onUp))}setDraggable(c){this._draggable=!!c;const h=this._map;return h&&(c?(h.on("mousedown",this._addDragHandler),h.on("touchstart",this._addDragHandler)):(h.off("mousedown",this._addDragHandler),h.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(c){return this._rotation=c||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(c){return this._rotationAlignment=c||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(c){return this._pitchAlignment=c||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(c){return this._occludedOpacity=c||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Ha={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},f_=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function lf(g=new p.Point(0,0),c="bottom"){if("number"==typeof g){const h=Math.round(Math.sqrt(.5*Math.pow(g,2)));switch(c){case"top":return new p.Point(0,g);case"top-left":return new p.Point(h,h);case"top-right":return new p.Point(-h,h);case"bottom":return new p.Point(0,-g);case"bottom-left":return new p.Point(h,-h);case"bottom-right":return new p.Point(-h,-h);case"left":return new p.Point(g,0);case"right":return new p.Point(-g,0)}return new p.Point(0,0)}return g instanceof p.Point||Array.isArray(g)?p.Point.convert(g):p.Point.convert(g[c]||[0,0])}class cf{constructor(c){this.jumpTo(c)}getValue(c){if(c<=this._startTime)return this._start;if(c>=this._endTime)return this._end;const h=p.easeCubicInOut((c-this._startTime)/(this._endTime-this._startTime));return this._start*(1-h)+this._end*h}isEasing(c){return c>=this._startTime&&c<=this._endTime}jumpTo(c){this._startTime=-1/0,this._endTime=-1/0,this._start=c,this._end=c}easeTo(c,h,_){this._start=this.getValue(h),this._end=c,this._startTime=h,this._endTime=h+_}}const Ym={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Xh={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},uf={showCompass:!0,showZoom:!0,visualizePitch:!1};class Km{constructor(c,h,_=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new lc({clickTolerance:c.dragRotate._mouseRotate._clickTolerance}),this.map=c,_&&(this.mousePitch=new Ls({clickTolerance:c.dragRotate._mousePitch._clickTolerance})),p.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),h.addEventListener("mousedown",this.mousedown),h.addEventListener("touchstart",this.touchstart,{passive:!1}),h.addEventListener("touchmove",this.touchmove),h.addEventListener("touchend",this.touchend),h.addEventListener("touchcancel",this.reset)}down(c,h){this.mouseRotate.mousedown(c,h),this.mousePitch&&this.mousePitch.mousedown(c,h),jt()}move(c,h){const _=this.map,w=this.mouseRotate.mousemoveWindow(c,h),C=w&&w.bearingDelta;if(C&&_.setBearing(_.getBearing()+C),this.mousePitch){const I=this.mousePitch.mousemoveWindow(c,h),A=I&&I.pitchDelta;A&&_.setPitch(_.getPitch()+A)}}off(){const c=this.element;c.removeEventListener("mousedown",this.mousedown),c.removeEventListener("touchstart",this.touchstart,{passive:!1}),c.removeEventListener("touchmove",this.touchmove),c.removeEventListener("touchend",this.touchend),c.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){_n(),p.window.removeEventListener("mousemove",this.mousemove),p.window.removeEventListener("mouseup",this.mouseup)}mousedown(c){this.down(p.extend({},c,{ctrlKey:!0,preventDefault:()=>c.preventDefault()}),Rt(this.element,c)),p.window.addEventListener("mousemove",this.mousemove),p.window.addEventListener("mouseup",this.mouseup)}mousemove(c){this.move(c,Rt(this.element,c))}mouseup(c){this.mouseRotate.mouseupWindow(c),this.mousePitch&&this.mousePitch.mouseupWindow(c),this.offTemp()}touchstart(c){1!==c.targetTouches.length?this.reset():(this._startPos=this._lastPos=Dn(this.element,c.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>c.preventDefault()},this._startPos))}touchmove(c){1!==c.targetTouches.length?this.reset():(this._lastPos=Dn(this.element,c.targetTouches)[0],this.move({preventDefault:()=>c.preventDefault()},this._lastPos))}touchend(c){0===c.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const zd={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},df={maxWidth:100,unit:"metric"},Zh={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},dc={version:p.version,supported:ft,setRTLTextPlugin:p.setRTLTextPlugin,getRTLTextPluginStatus:p.getRTLTextPluginStatus,Map:class extends Gh{constructor(g){if(p.LivePerformanceUtils.mark(p.PerformanceMarkers.create),null!=(g=p.extend({},Xh,g)).minZoom&&null!=g.maxZoom&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=g.minPitch&&null!=g.maxPitch&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=g.minPitch&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=g.maxPitch&&g.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(g.antialias&&p.isSafariWithAntialiasingBug(p.window)&&(g.antialias=!1,p.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Pd(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies),g),this._interactive=g.interactive,this._minTileCacheSize=g.minTileCacheSize,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._useWebGL2=g.useWebGL2,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=g.crossSourceCollisions,this._collectResourceTiming=g.collectResourceTiming,this._optimizeForTerrain=g.optimizeForTerrain,this._language=this._parseLanguage(g.language),this._worldview=g.worldview,this._renderTaskQueue=new rs,this._domRenderTaskQueue=new rs,this._controls=[],this._markers=[],this._popups=[],this._mapId=p.uniqueId(),this._locale=p.extend({},Ym,g.locale),this._clickTolerance=g.clickTolerance,this._cooperativeGestures=g.cooperativeGestures,this._performanceMetricsCollection=g.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new cf(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new p.RequestManager(g.transformRequest,g.accessToken,g.testMode),this._silenceAuthErrors=!!g.testMode,"string"==typeof g.container){if(this._container=p.window.document.getElementById(g.container),!this._container)throw new Error(`Container '${g.container}' not found.`)}else{if(!(g.container instanceof p.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(this._container.childNodes.length>0&&p.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),g.maxBounds&&this.setMaxBounds(g.maxBounds),p.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==p.window&&(p.window.addEventListener("online",this._onWindowOnline,!1),p.window.addEventListener("resize",this._onWindowResize,!1),p.window.addEventListener("orientationchange",this._onWindowResize,!1),p.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),p.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new Ma(this,g),this._localFontFamily=g.localFontFamily,this._localIdeographFontFamily=g.localIdeographFontFamily,g.style&&this.setStyle(g.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),g.projection&&this.setProjection(g.projection),this._hash=g.hash&&new sf("string"==typeof g.hash&&g.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch}),g.bounds&&(this.resize(),this.fitBounds(g.bounds,p.extend({},g.fitBoundsOptions,{duration:0})))),this.resize(),g.attributionControl&&this.addControl(new Mn({customAttribution:g.customAttribution})),this._logoControl=new Wh,this.addControl(this._logoControl,g.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",c=>{this._update("style"===c.dataType),this.fire(new p.Event(`${c.dataType}data`,c))}),this.on("dataloading",c=>{this.fire(new p.Event(`${c.dataType}dataloading`,c))})}_getMapId(){return this._mapId}addControl(g,c){if(void 0===c&&(c=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=g.onAdd(this);this._controls.push(g);const _=this._controlPositions[c];return-1!==c.indexOf("bottom")?_.insertBefore(h,_.firstChild):_.appendChild(h),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const c=this._controls.indexOf(g);return c>-1&&this._controls.splice(c,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(g){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const c=!this._moving;return c&&this.fire(new p.Event("movestart",g)).fire(new p.Event("move",g)),this.fire(new p.Event("resize",g)),c&&this.fire(new p.Event("moveend",g)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(g){return this.transform.setMaxBounds(p.LngLatBounds.convert(g)),this._update()}setMinZoom(g){if((g=null==g?-2:g)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g?this.setZoom(g):this.fire(new p.Event("zoomstart")).fire(new p.Event("zoom")).fire(new p.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=null==g?22:g)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g?this.setZoom(g):this.fire(new p.Event("zoomstart")).fire(new p.Event("zoom")).fire(new p.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=null==g?0:g)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g?this.setPitch(g):this.fire(new p.Event("pitchstart")).fire(new p.Event("pitch")).fire(new p.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=null==g?85:g)>85)throw new Error("maxPitch must be less than or equal to 85");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g?this.setPitch(g):this.fire(new p.Event("pitchstart")).fire(new p.Event("pitch")).fire(new p.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.renderWorldCopies=g,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(g){return"auto"===g?p.window.navigator.language:Array.isArray(g)?0===g.length?void 0:g.map(c=>"auto"===c?p.window.navigator.language:c):g}setLanguage(g){const c=this._parseLanguage(g);if(!this.style||c===this._language)return this;this._language=c,this.style._reloadSources();for(const h of this._controls)h._setLanguage&&h._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(g){return this.style&&g!==this._worldview?(this._worldview=g,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(g){return this._lazyInitEmptyStyle(),g?"string"==typeof g&&(g={name:g}):g=null,this._useExplicitProjection=!!g,this._prioritizeAndUpdateProjection(g,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const g=this.transform,c=g.projection.name;let h;"globe"===c&&g.zoom>=p.GLOBE_ZOOM_THRESHOLD_MAX?(g.setMercatorFromTransition(),h=!0):"mercator"===c&&g.zoom<p.GLOBE_ZOOM_THRESHOLD_MAX&&(g.setProjection({name:"globe"}),h=!0),h&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(g,c){return this._updateProjection(g||c||{name:"mercator"})}_updateProjection(g){let c;if(c="globe"===g.name&&this.transform.zoom>=p.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(g),this.style.applyProjectionUpdate(),c){this.painter.clearBackgroundTiles();for(const h in this.style._sourceCaches)this.style._sourceCaches[h].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(g){return this.transform.locationPoint3D(p.LngLat.convert(g))}unproject(g){return this.transform.pointLocation3D(p.Point.convert(g))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(g,c,h){if("mouseenter"===g||"mouseover"===g){let _=!1;const w=I=>{const A=c.filter(N=>this.getLayer(N)),P=A.length?this.queryRenderedFeatures(I.point,{layers:A}):[];P.length?_||(_=!0,h.call(this,new Lr(g,this,I.originalEvent,{features:P}))):_=!1},C=()=>{_=!1};return{layers:new Set(c),listener:h,delegates:{mousemove:w,mouseout:C}}}if("mouseleave"===g||"mouseout"===g){let _=!1;const w=I=>{const A=c.filter(P=>this.getLayer(P));(A.length?this.queryRenderedFeatures(I.point,{layers:A}):[]).length?_=!0:_&&(_=!1,h.call(this,new Lr(g,this,I.originalEvent)))},C=I=>{_&&(_=!1,h.call(this,new Lr(g,this,I.originalEvent)))};return{layers:new Set(c),listener:h,delegates:{mousemove:w,mouseout:C}}}{const _=w=>{const C=c.filter(A=>this.getLayer(A)),I=C.length?this.queryRenderedFeatures(w.point,{layers:C}):[];I.length&&(w.features=I,h.call(this,w),delete w.features)};return{layers:new Set(c),listener:h,delegates:{[g]:_}}}}on(g,c,h){if(void 0===h)return super.on(g,c);Array.isArray(c)||(c=[c]);const _=this._createDelegatedListener(g,c,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(_);for(const w in _.delegates)this.on(w,_.delegates[w]);return this}once(g,c,h){if(void 0===h)return super.once(g,c);Array.isArray(c)||(c=[c]);const _=this._createDelegatedListener(g,c,h);for(const w in _.delegates)this.once(w,_.delegates[w]);return this}off(g,c,h){if(void 0===h)return super.off(g,c);c=new Set(Array.isArray(c)?c:[c]);const _=(C,I)=>{if(C.size!==I.size)return!1;for(const A of C)if(!I.has(A))return!1;return!0},w=this._delegatedListeners?this._delegatedListeners[g]:void 0;return w&&(C=>{for(let I=0;I<C.length;I++){const A=C[I];if(A.listener===h&&_(A.layers,c)){for(const P in A.delegates)this.off(P,A.delegates[P]);return C.splice(I,1),this}}})(w),this}queryRenderedFeatures(g,c){return this.style?(void 0!==c||void 0===g||g instanceof p.Point||Array.isArray(g)||(c=g,g=void 0),this.style.queryRenderedFeatures(g=g||[[0,0],[this.transform.width,this.transform.height]],c=c||{},this.transform)):[]}querySourceFeatures(g,c){return this.style.querySourceFeatures(g,c)}isPointOnSurface(g){const{name:c}=this.transform.projection;return"globe"!==c&&"mercator"!==c&&p.warnOnce(`${c} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(p.Point.convert(g))}setStyle(g,c){return!1!==(c=p.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},c)).diff&&c.localIdeographFontFamily===this._localIdeographFontFamily&&c.localFontFamily===this._localFontFamily&&this.style&&g?(this._diffStyle(g,c),this):(this._localIdeographFontFamily=c.localIdeographFontFamily,this._localFontFamily=c.localFontFamily,this._updateStyle(g,c))}_getUIString(g){const c=this._locale[g];if(null==c)throw new Error(`Missing UI string '${g}'`);return c}_updateStyle(g,c){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),g&&(this.style=new Na(this,c||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof g?this.style.loadURL(g):this.style.loadJSON(g)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Na(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(g,c){if("string"==typeof g){const h=this._requestManager.normalizeStyleURL(g),_=this._requestManager.transformRequest(h,p.ResourceType.Style);p.getJSON(_,(w,C)=>{w?this.fire(new p.ErrorEvent(w)):C&&this._updateDiff(C,c)})}else"object"==typeof g&&this._updateDiff(g,c)}_updateDiff(g,c){try{this.style.setState(g)&&this._update(!0)}catch(h){p.warnOnce(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(g,c)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(p.warnOnce("There is no style added to the map."),!1)}addSource(g,c){return this._lazyInitEmptyStyle(),this.style.addSource(g,c),this._update(!0)}isSourceLoaded(g){return!!this.style&&this.style._isSourceCacheLoaded(g)}areTilesLoaded(){const g=this.style&&this.style._sourceCaches;for(const c in g){const h=g[c]._tiles;for(const _ in h){const w=h[_];if("loaded"!==w.state&&"errored"!==w.state)return!1}}return!0}addSourceType(g,c,h){this._lazyInitEmptyStyle(),this.style.addSourceType(g,c,h)}removeSource(g){return this.style.removeSource(g),this._updateTerrain(),this._update(!0)}getSource(g){return this.style.getSource(g)}addImage(g,c,{pixelRatio:h=1,sdf:_=!1,stretchX:w,stretchY:C,content:I}={}){if(this._lazyInitEmptyStyle(),c instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&c instanceof p.window.ImageBitmap){const{width:A,height:P,data:N}=p.exported.getImageData(c);this.style.addImage(g,{data:new p.RGBAImage({width:A,height:P},N),pixelRatio:h,stretchX:w,stretchY:C,content:I,sdf:_,version:0})}else if(void 0===c.width||void 0===c.height)this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:A,height:P}=c,N=c;this.style.addImage(g,{data:new p.RGBAImage({width:A,height:P},new Uint8Array(N.data)),pixelRatio:h,stretchX:w,stretchY:C,content:I,sdf:_,version:0,userImage:N}),N.onAdd&&N.onAdd(this,g)}}updateImage(g,c){const h=this.style.getImage(g);if(!h)return void this.fire(new p.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=c instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&c instanceof p.window.ImageBitmap?p.exported.getImageData(c):c,{width:w,height:C}=_;void 0!==w&&void 0!==C?w===h.data.width&&C===h.data.height?(h.data.replace(_.data,!(c instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&c instanceof p.window.ImageBitmap)),this.style.updateImage(g,h)):this.fire(new p.ErrorEvent(new Error(`The width and height of the updated image (${w}, ${C})\n                must be that same as the previous version of the image\n                (${h.data.width}, ${h.data.height})`))):this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(g){return g?!!this.style.getImage(g):(this.fire(new p.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(g)}loadImage(g,c){p.getImage(this._requestManager.transformRequest(g,p.ResourceType.Image),(h,_)=>{c(h,_ instanceof p.window.HTMLImageElement?p.exported.getImageData(_):_)})}listImages(){return this.style.listImages()}addLayer(g,c){return this._lazyInitEmptyStyle(),this.style.addLayer(g,c),this._update(!0)}moveLayer(g,c){return this.style.moveLayer(g,c),this._update(!0)}removeLayer(g){return this.style.removeLayer(g),this._update(!0)}getLayer(g){return this.style.getLayer(g)}setLayerZoomRange(g,c,h){return this.style.setLayerZoomRange(g,c,h),this._update(!0)}setFilter(g,c,h={}){return this.style.setFilter(g,c,h),this._update(!0)}getFilter(g){return this.style.getFilter(g)}setPaintProperty(g,c,h,_={}){return this.style.setPaintProperty(g,c,h,_),this._update(!0)}getPaintProperty(g,c){return this.style.getPaintProperty(g,c)}setLayoutProperty(g,c,h,_={}){return this.style.setLayoutProperty(g,c,h,_),this._update(!0)}getLayoutProperty(g,c){return this.style.getLayoutProperty(g,c)}setLight(g,c={}){return this._lazyInitEmptyStyle(),this.style.setLight(g,c),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(g){return this._lazyInitEmptyStyle(),!g&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(g),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(g){return this._lazyInitEmptyStyle(),this.style.setFog(g),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(g){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(p.LngLat.convert(g),this.transform):0}setFeatureState(g,c){return this.style.setFeatureState(g,c),this._update()}removeFeatureState(g,c){return this.style.removeFeatureState(g,c),this._update()}getFeatureState(g){return this.style.getFeatureState(g)}_updateContainerDimensions(){if(!this._container)return;const g=this._container.getBoundingClientRect().width||400,c=this._container.getBoundingClientRect().height||300;let h,_,w,C=this._container;for(;C&&(!_||!w);){const I=p.window.getComputedStyle(C).transform;I&&"none"!==I&&(h=I.match(/matrix.*\((.+)\)/)[1].split(", "),h[0]&&"0"!==h[0]&&"1"!==h[0]&&(_=h[0]),h[3]&&"0"!==h[3]&&"1"!==h[3]&&(w=h[3])),C=C.parentElement}this._containerWidth=_?Math.abs(g/_):g,this._containerHeight=w?Math.abs(c/w):c}_detectMissingCSS(){"rgb(250, 128, 114)"!==p.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&p.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=Qe("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();const c=this._canvasContainer=Qe("div","mapboxgl-canvas-container",g);this._interactive&&c.classList.add("mapboxgl-interactive"),this._canvas=Qe("canvas","mapboxgl-canvas",c),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const h=this._controlContainer=Qe("div","mapboxgl-control-container",g),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(w=>{_[w]=Qe("div",`mapboxgl-ctrl-${w}`,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,c){const h=p.exported.devicePixelRatio||1;this._canvas.width=h*Math.ceil(g),this._canvas.height=h*Math.ceil(c),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${c}px`}_addMarker(g){this._markers.push(g)}_removeMarker(g){const c=this._markers.indexOf(g);-1!==c&&this._markers.splice(c,1)}_addPopup(g){this._popups.push(g)}_removePopup(g){const c=this._popups.indexOf(g);-1!==c&&this._popups.splice(c,1)}_setupPainter(){const g=p.extend({},ft.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),c=this._useWebGL2&&this._canvas.getContext("webgl2",g),h=c||this._canvas.getContext("webgl",g)||this._canvas.getContext("experimental-webgl",g);h?(this._useWebGL2&&!c&&p.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),p.storeAuthState(h,!0),this.painter=new Ad(h,this.transform,!!c),this.on("data",_=>{"source"===_.dataType&&this.painter.setTileLoadedFlag(!0)}),p.exported$1.testSupport(h)):this.fire(new p.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new p.Event("webglcontextlost",{originalEvent:g}))}_contextRestored(g){this._setupPainter(),this.resize(),this._update(),this.fire(new p.Event("webglcontextrestored",{originalEvent:g}))}_onMapScroll(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_requestDomTask(g){!this.loaded()||this.loaded()&&!this.isMoving()?g():this._domRenderTaskQueue.add(g)}_render(g){let c;const h=this.painter.context.extTimerQuery,_=p.exported.now();if(this.listens("gpu-timing-frame")&&(c=h.createQueryEXT(),h.beginQueryEXT(h.TIME_ELAPSED_EXT,c)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],p.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],p.window.performance.now())),this._renderTaskQueue.run(g),this._domRenderTaskQueue.run(g),this._removed)return;this._updateProjectionTransition();const w=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const A=this.transform.zoom,P=this.transform.pitch,N=p.exported.now(),B=new p.EvaluationParameters(A,{now:N,fadeDuration:w,pitch:P,transition:this.style.getTransition()});this.style.update(B)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let C=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),C=this._updateAverageElevation(_),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):C=this._updateAverageElevation(_),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,w,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:w,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new p.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new p.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),c){const A=p.exported.now()-_;h.endQueryEXT(h.TIME_ELAPSED_EXT,c),setTimeout(()=>{const P=h.getQueryObjectEXT(c,h.QUERY_RESULT_EXT)/1e6;h.deleteQueryEXT(c),this.fire(new p.Event("gpu-timing-frame",{cpuTime:A,gpuTime:P})),p.window.performance.mark("frame-gpu",{startTime:_,detail:{gpuTime:P}})},50)}if(this.listens("gpu-timing-layer")){const A=this.painter.collectGpuTimers();setTimeout(()=>{const P=this.painter.queryGpuTimers(A);this.fire(new p.Event("gpu-timing-layer",{layerTimes:P}))},50)}if(this.listens("gpu-timing-deferred-render")){const A=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const P=this.painter.queryGpuTimeDeferredRender(A);this.fire(new p.Event("gpu-timing-deferred-render",{gpuTime:P}))},50)}const I=this._sourcesDirty||this._styleDirty||this._placementDirty||C;if(I||this._repaint)this.triggerRepaint();else{const A=!this.isMoving()&&this.loaded();if(A&&(C=this._updateAverageElevation(_,!0)),C)this.triggerRepaint();else if(this._triggerFrame(!1),A&&(this.fire(new p.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const P=this._calculateSpeedIndex();this.fire(new p.Event("speedindexcompleted",{speedIndex:P})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||I||(this._fullyLoaded=!0,p.LivePerformanceUtils.mark(p.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&p.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(g){for(const c of this._markers)g&&!this.getRenderWorldCopies()&&(c._lngLat=c._lngLat.wrap()),c._update();for(const c of this._popups)!g||this.getRenderWorldCopies()||c._trackPointer||(c._lngLat=c._lngLat.wrap()),c._update()}_updateAverageElevation(g,c=!1){const h=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&h(0);if((c||g-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(g)){const _=this.transform.averageElevation;let w=this.transform.sampleAverageElevation(),C=!1;this.transform.elevation&&(C=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(w)?w=0:this._averageElevationLastSampledAt=g;const I=Math.abs(_-w);if(I>1){if(this._isInitialLoad||C)return this._averageElevation.jumpTo(w),h(w);this._averageElevation.easeTo(w,g,300)}else if(I>1e-4)return this._averageElevation.jumpTo(w),h(w)}return!!this._averageElevation.isEasing(g)&&h(this._averageElevation.getValue(g))}_authenticate(){p.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,g=>{if(g&&(g.message===p.AUTH_ERR_MSG||401===g.status)){const c=this.painter.context.gl;p.storeAuthState(c,!1),this._logoControl instanceof Wh&&this._logoControl._updateLogo(),c&&c.clear(c.DEPTH_BUFFER_BIT|c.COLOR_BUFFER_BIT|c.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new p.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),p.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const g=this._isDragging();this.painter.updateTerrain(this.style,g)}_calculateSpeedIndex(){const g=this.painter.canvasCopy(),c=this.painter.getCanvasCopiesAndTimestamps();c.timeStamps.push(performance.now());const h=this.painter.context.gl,_=h.createFramebuffer();function w(C){h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,C,0);const I=new Uint8Array(h.drawingBufferWidth*h.drawingBufferHeight*4);return h.readPixels(0,0,h.drawingBufferWidth,h.drawingBufferHeight,h.RGBA,h.UNSIGNED_BYTE,I),I}return h.bindFramebuffer(h.FRAMEBUFFER,_),this._canvasPixelComparison(w(g),c.canvasCopies.map(w),c.timeStamps)}_canvasPixelComparison(g,c,h){let _=h[1]-h[0];const w=g.length/4;for(let C=0;C<c.length;C++){const I=c[C];let A=0;for(let P=0;P<I.length;P+=4)I[P]===g[P]&&I[P+1]===g[P+1]&&I[P+2]===g[P+2]&&I[P+3]===g[P+3]&&(A+=1);_+=(h[C+2]-h[C+1])*(1-A/w)}return _}remove(){this._hash&&this._hash.remove();for(const c of this._controls)c.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==p.window&&(p.window.removeEventListener("resize",this._onWindowResize,!1),p.window.removeEventListener("orientationchange",this._onWindowResize,!1),p.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),p.window.removeEventListener("online",this._onWindowOnline,!1),p.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const g=this.painter.context.gl.getExtension("WEBGL_lose_context");g&&g.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),p.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new p.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(g){this._renderNextFrame=this._renderNextFrame||g,this.style&&!this._frame&&(this._frame=p.exported.frame(c=>{const h=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,h&&this._render(c)}))}_preloadTiles(g){const c=this.style?Object.values(this.style._sourceCaches):[];return p.asyncAll(c,(h,_)=>h._preloadTiles(g,_),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(g){this._trackResize&&this.resize({originalEvent:g})._update()}_onVisibilityChange(){"hidden"===p.window.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(g){this._showTerrainWireframe!==g&&(this._showTerrainWireframe=g,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(g){this._speedIndexTiming!==g&&(this._speedIndexTiming=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(g){this._showTileAABBs!==g&&(this._showTileAABBs=g,g&&this._update())}_setCacheLimits(g,c){p.setCacheLimits(g,c)}get version(){return p.version}},NavigationControl:class{constructor(g){this.options=p.extend({},uf,g),this._container=Qe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",c=>c.preventDefault()),this.options.showZoom&&(p.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",c=>{this._map&&this._map.zoomIn({},{originalEvent:c})}),Qe("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",c=>{this._map&&this._map.zoomOut({},{originalEvent:c})}),Qe("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(p.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",c=>{const h=this._map;h&&(this.options.visualizePitch?h.resetNorthPitch({},{originalEvent:c}):h.resetNorth({},{originalEvent:c}))}),this._compassIcon=Qe("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const g=this._map;if(!g)return;const c=g.getZoom(),h=c===g.getMaxZoom(),_=c===g.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())}_rotateCompassArrow(){const g=this._map;if(!g)return;const c=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(g.transform.pitch*(Math.PI/180)),.5)}) rotateX(${g.transform.pitch}deg) rotateZ(${g.transform.angle*(180/Math.PI)}deg)`:`rotate(${g.transform.angle*(180/Math.PI)}deg)`;g._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=c)})}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),g.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&g.on("pitch",this._rotateCompassArrow),g.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Km(g,this._compass,this.options.visualizePitch)),this._container}onRemove(){const g=this._map;g&&(this._container.remove(),this.options.showZoom&&g.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&g.off("pitch",this._rotateCompassArrow),g.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(g,c){const h=Qe("button",g,this._container);return h.type="button",h.addEventListener("click",c),h}_setButtonTitle(g,c){if(!this._map)return;const h=this._map._getUIString(`NavigationControl.${c}`);g.setAttribute("aria-label",h),g.firstElementChild&&g.firstElementChild.setAttribute("title",h)}},GeolocateControl:class extends p.Evented{constructor(g){super(),this.options=p.extend({geolocation:p.window.navigator.geolocation},zd,g),p.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Da(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(g){return this._map=g,this._container=Qe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(g){const c=(h=!!this.options.geolocation)=>{this._supportsGeolocation=h,g(h)};void 0!==this._supportsGeolocation?g(this._supportsGeolocation):void 0!==p.window.navigator.permissions?p.window.navigator.permissions.query({name:"geolocation"}).then(h=>c("denied"!==h.state)).catch(()=>c()):c()}_isOutOfMapMaxBounds(g){const c=this._map.getMaxBounds(),h=g.coords;return!!c&&(h.longitude<c.getWest()||h.longitude>c.getEast()||h.latitude<c.getSouth()||h.latitude>c.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(g){if(this._map){if(this._isOutOfMapMaxBounds(g))return this._setErrorState(),this.fire(new p.Event("outofmaxbounds",g)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=g,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(g),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(g),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("geolocate",g)),this._finish()}}_updateCamera(g){const c=new p.LngLat(g.coords.longitude,g.coords.latitude),h=g.coords.accuracy,_=this._map.getBearing(),w=p.extend({bearing:_},this.options.fitBoundsOptions);this._map.fitBounds(c.toBounds(h),w,{geolocateSource:!0})}_updateMarker(g){if(g){const c=new p.LngLat(g.coords.longitude,g.coords.latitude);this._accuracyCircleMarker.setLngLat(c).addTo(this._map),this._userLocationDotMarker.setLngLat(c).addTo(this._map),this._accuracy=g.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const g=this._map.transform,c=p.mercatorZfromAltitude(1,g._center.lat)*g.worldSize,h=Math.ceil(2*this._accuracy*c);this._circleElement.style.width=`${h}px`,this._circleElement.style.height=`${h}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(g){if(this._map){if(this.options.trackUserLocation)if(1===g.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===g.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("error",g)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(g){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",c=>c.preventDefault()),this._geolocateButton=Qe("button","mapboxgl-ctrl-geolocate",this._container),Qe("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===g){p.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c)}else{const c=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Qe("div","mapboxgl-user-location"),this._dotElement.appendChild(Qe("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Qe("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new sn({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Qe("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new sn({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",c=>{c.geolocateSource||"ACTIVE_LOCK"!==this._watchState||c.originalEvent&&"resize"===c.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new p.Event("trackuserlocationend")))})}}_onDeviceOrientation(g){this._userLocationDotMarker&&(g.webkitCompassHeading?this._heading=g.webkitCompassHeading:!0===g.absolute&&(this._heading=-1*g.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return p.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new p.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new p.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new p.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let g;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(g={maximumAge:6e5,timeout:0},this._noTimeout=!0):(g=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,g),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const g=()=>{p.window.addEventListener("ondeviceorientationabsolute"in p.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==p.window.DeviceMotionEvent&&"function"==typeof p.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(c=>{"granted"===c&&g()}).catch(console.error):g()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),p.window.removeEventListener("deviceorientation",this._onDeviceOrientation),p.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Mn,ScaleControl:class{constructor(g){this.options=p.extend({},df,g),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch(c){return!1}}(),p.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const g=this.options.maxWidth||100,c=this._map,h=c._containerHeight/2,_=c._containerWidth/2-g/2,w=c.unproject([_,h]),C=c.unproject([_+g,h]),I=w.distanceTo(C);if("imperial"===this.options.unit){const A=3.2808*I;A>5280?this._setScale(g,A/5280,"mile"):this._setScale(g,A,"foot")}else"nautical"===this.options.unit?this._setScale(g,I/1852,"nautical-mile"):I>=1e3?this._setScale(g,I/1e3,"kilometer"):this._setScale(g,I,"meter")}_setScale(g,c,h){this._map._requestDomTask(()=>{const _=function(C){const I=Math.pow(10,`${Math.floor(C)}`.length-1);let A=C/I;return A=A>=10?10:A>=5?5:A>=3?3:A>=2?2:A>=1?1:function(P){const N=Math.pow(10,Math.ceil(-Math.log(P)/Math.LN10));return Math.round(P*N)/N}(A),I*A}(c),w=_/c;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==h?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:h}).format(_):`${_}&nbsp;${Zh[h]}`,this._container.style.width=g*w+"px"})}onAdd(g){return this._map=g,this._language=g.getLanguage(),this._container=Qe("div","mapboxgl-ctrl mapboxgl-ctrl-scale",g.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(g){this._language=g,this._update()}setUnit(g){this.options.unit=g,this._update()}},FullscreenControl:class{constructor(g){this._fullscreen=!1,g&&g.container&&(g.container instanceof p.window.HTMLElement?this._container=g.container:p.warnOnce("Full screen control 'container' must be a DOM element.")),p.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in p.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in p.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=Qe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",p.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,p.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!p.window.document.fullscreenEnabled&&!p.window.document.webkitFullscreenEnabled)}_setupUI(){const g=this._fullscreenButton=Qe("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Qe("span","mapboxgl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),p.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",g)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(p.window.document.fullscreenElement||p.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?p.window.document.exitFullscreen?p.window.document.exitFullscreen():p.window.document.webkitCancelFullScreen&&p.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends p.Evented{constructor(g){super(),this.options=p.extend(Object.create(Ha),g),p.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(g&&g.className?g.className.trim().split(/\s+/):[])}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&g.on("preclick",this._onClose),this.options.closeOnMove&&g.on("move",this._onClose),g.on("remove",this.remove),this._update(),g._addPopup(this),this._focusFirstElement(),this._trackPointer?(g.on("mousemove",this._onMouseEvent),g.on("mouseup",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")):g.on("move",this._update),this.fire(new p.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const g=this._map;return g&&(g.off("move",this._update),g.off("move",this._onClose),g.off("preclick",this._onClose),g.off("click",this._onClose),g.off("remove",this.remove),g.off("mousemove",this._onMouseEvent),g.off("mouseup",this._onMouseEvent),g.off("drag",this._onMouseEvent),g._canvasContainer&&g._canvasContainer.classList.remove("mapboxgl-track-pointer"),g._removePopup(this),this._map=void 0),this.fire(new p.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(g){this._lngLat=p.LngLat.convert(g),this._pos=null,this._trackPointer=!1,this._update();const c=this._map;return c&&(c.on("move",this._update),c.off("mousemove",this._onMouseEvent),c._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const g=this._map;return g&&(g.off("move",this._update),g.on("mousemove",this._onMouseEvent),g.on("drag",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(p.window.document.createTextNode(g))}setHTML(g){const c=p.window.document.createDocumentFragment(),h=p.window.document.createElement("body");let _;for(h.innerHTML=g;_=h.firstChild,_;)c.appendChild(_);return this.setDOMContent(c)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){let c=this._content;if(c)for(;c.hasChildNodes();)c.firstChild&&c.removeChild(c.firstChild);else c=this._content=Qe("div","mapboxgl-popup-content",this._container||void 0);if(c.appendChild(g),this.options.closeButton){const h=this._closeButton=Qe("button","mapboxgl-popup-close-button",c);h.type="button",h.setAttribute("aria-label","Close popup"),h.setAttribute("aria-hidden","true"),h.innerHTML="&#215;",h.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(g){return this._classList.add(g),this._updateClassList(),this}removeClassName(g){return this._classList.delete(g),this._updateClassList(),this}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){let c;return this._classList.delete(g)?c=!1:(this._classList.add(g),c=!0),this._updateClassList(),c}_onMouseEvent(g){this._update(g.point)}_getAnchor(g){if(this.options.anchor)return this.options.anchor;const c=this._map,h=this._container,_=this._pos;if(!c||!h||!_)return"bottom";const w=h.offsetWidth,C=h.offsetHeight,I=_.x<w/2,A=_.x>c.transform.width-w/2;if(_.y+g<C)return I?"top-left":A?"top-right":"top";if(_.y>c.transform.height-C){if(I)return"bottom-left";if(A)return"bottom-right"}return I?"left":A?"right":"bottom"}_updateClassList(){const g=this._container;if(!g)return;const c=[...this._classList];c.push("mapboxgl-popup"),this._anchor&&c.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&c.push("mapboxgl-popup-track-pointer"),g.className=c.join(" ")}_update(g){const c=this._map,h=this._content;if(!c||!this._lngLat&&!this._trackPointer||!h)return;let _=this._container;if(_||(_=this._container=Qe("div","mapboxgl-popup",c.getContainer()),this._tip=Qe("div","mapboxgl-popup-tip",_),_.appendChild(h)),this.options.maxWidth&&_.style.maxWidth!==this.options.maxWidth&&(_.style.maxWidth=this.options.maxWidth),c.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Qs(this._lngLat,this._pos,c.transform)),!this._trackPointer||g){const w=this._pos=this._trackPointer&&g?g:c.project(this._lngLat),C=lf(this.options.offset),I=this._anchor=this._getAnchor(C.y),A=lf(this.options.offset,I),P=w.add(A).round();c._requestDomTask(()=>{this._container&&I&&(this._container.style.transform=`${uc[I]} translate(${P.x}px,${P.y}px)`)})}if(!this._marker&&c._showingGlobe()){const w=p.isLngLatBehindGlobe(c.transform,this._lngLat)?0:1;this._setOpacity(w)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(f_);g&&g.focus()}_onClose(){this.remove()}_setOpacity(g){this._container&&(this._container.style.opacity=`${g}`),this._content&&(this._content.style.pointerEvents=g?"auto":"none")}},Marker:sn,Style:Na,LngLat:p.LngLat,LngLatBounds:p.LngLatBounds,Point:p.Point,MercatorCoordinate:p.MercatorCoordinate,FreeCameraOptions:l_,Evented:p.Evented,config:p.config,prewarm:function(){br().acquire(gt)},clearPrewarmedResources:function(){const g=Zn;g&&(g.isPreloaded()&&1===g.numActive()?(g.release(gt),Zn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return p.config.ACCESS_TOKEN},set accessToken(g){p.config.ACCESS_TOKEN=g},get baseApiUrl(){return p.config.API_URL},set baseApiUrl(g){p.config.API_URL=g},get workerCount(){return Kt.workerCount},set workerCount(g){Kt.workerCount=g},get maxParallelImageRequests(){return p.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(g){p.config.MAX_PARALLEL_IMAGE_REQUESTS=g},clearStorage(g){p.clearTileCache(g)},workerUrl:"",workerClass:null,setNow:p.exported.setNow,restoreNow:p.exported.restoreNow};return dc}),ze}()},599:function(un){(function(){un.exports={Disconnected:1,Preceding:2,Following:4,Contains:8,ContainedBy:16,ImplementationSpecific:32}}).call(this)},269:function(un){(function(){un.exports={Element:1,Attribute:2,Text:3,CData:4,EntityReference:5,EntityDeclaration:6,ProcessingInstruction:7,Comment:8,Document:9,DocType:10,DocumentFragment:11,NotationDeclaration:12,Declaration:201,Raw:202,AttributeDeclaration:203,ElementDeclaration:204,Dummy:205}}).call(this)},452:function(un){(function(){var In,tt,ze,je,Ve,p,he,ft={}.hasOwnProperty;In=function(qe,...Xe){var Qe,St,Ct,Ze;if(Ve(Object.assign))Object.assign.apply(null,arguments);else for(Qe=0,Ct=Xe.length;Qe<Ct;Qe++)if(null!=(Ze=Xe[Qe]))for(St in Ze)!ft.call(Ze,St)||(qe[St]=Ze[St]);return qe},Ve=function(qe){return!!qe&&"[object Function]"===Object.prototype.toString.call(qe)},p=function(qe){var Xe;return!!qe&&("function"==(Xe=typeof qe)||"object"===Xe)},ze=function(qe){return Ve(Array.isArray)?Array.isArray(qe):"[object Array]"===Object.prototype.toString.call(qe)},je=function(qe){var Xe;if(ze(qe))return!qe.length;for(Xe in qe)if(ft.call(qe,Xe))return!1;return!0},he=function(qe){var Xe,Qe;return p(qe)&&(Qe=Object.getPrototypeOf(qe))&&(Xe=Qe.constructor)&&"function"==typeof Xe&&Xe instanceof Xe&&Function.prototype.toString.call(Xe)===Function.prototype.toString.call(Object)},tt=function(qe){return Ve(qe.valueOf)?qe.valueOf():qe},un.exports.assign=In,un.exports.isFunction=Ve,un.exports.isObject=p,un.exports.isArray=ze,un.exports.isEmpty=je,un.exports.isPlainObject=he,un.exports.getValue=tt}).call(this)},316:function(un){(function(){un.exports={None:0,OpenTag:1,InsideTag:2,CloseTag:3}}).call(this)},968:function(un,In,tt){(function(){var ze;ze=tt(269),tt(563),un.exports=function(){class p{constructor(ft,qe,Xe){if(this.parent=ft,this.parent&&(this.options=this.parent.options,this.stringify=this.parent.stringify),null==qe)throw new Error("Missing attribute name. "+this.debugInfo(qe));this.name=this.stringify.name(qe),this.value=this.stringify.attValue(Xe),this.type=ze.Attribute,this.isId=!1,this.schemaTypeInfo=null}clone(){return Object.create(this)}toString(ft){return this.options.writer.attribute(this,this.options.writer.filterOptions(ft))}debugInfo(ft){return null==(ft=ft||this.name)?"parent: <"+this.parent.name+">":"attribute: {"+ft+"}, parent: <"+this.parent.name+">"}isEqualNode(ft){return!(ft.namespaceURI!==this.namespaceURI||ft.prefix!==this.prefix||ft.localName!==this.localName||ft.value!==this.value)}}return Object.defineProperty(p.prototype,"nodeType",{get:function(){return this.type}}),Object.defineProperty(p.prototype,"ownerElement",{get:function(){return this.parent}}),Object.defineProperty(p.prototype,"textContent",{get:function(){return this.value},set:function(he){return this.value=he||""}}),Object.defineProperty(p.prototype,"namespaceURI",{get:function(){return""}}),Object.defineProperty(p.prototype,"prefix",{get:function(){return""}}),Object.defineProperty(p.prototype,"localName",{get:function(){return this.name}}),Object.defineProperty(p.prototype,"specified",{get:function(){return!0}}),p}.call(this)}).call(this)},361:function(un,In,tt){(function(){var ze,Ve;ze=tt(269),Ve=tt(182),un.exports=class extends Ve{constructor(he,ft){if(super(he),null==ft)throw new Error("Missing CDATA text. "+this.debugInfo());this.name="#cdata-section",this.type=ze.CData,this.value=this.stringify.cdata(ft)}clone(){return Object.create(this)}toString(he){return this.options.writer.cdata(this,this.options.writer.filterOptions(he))}}}).call(this)},182:function(un,In,tt){(function(){var je;je=tt(563),un.exports=function(){class Ve extends je{constructor(he){super(he),this.value=""}clone(){return Object.create(this)}substringData(he,ft){throw new Error("This DOM method is not implemented."+this.debugInfo())}appendData(he){throw new Error("This DOM method is not implemented."+this.debugInfo())}insertData(he,ft){throw new Error("This DOM method is not implemented."+this.debugInfo())}deleteData(he,ft){throw new Error("This DOM method is not implemented."+this.debugInfo())}replaceData(he,ft,qe){throw new Error("This DOM method is not implemented."+this.debugInfo())}isEqualNode(he){return!(!super.isEqualNode(he)||he.data!==this.data)}}return Object.defineProperty(Ve.prototype,"data",{get:function(){return this.value},set:function(p){return this.value=p||""}}),Object.defineProperty(Ve.prototype,"length",{get:function(){return this.value.length}}),Object.defineProperty(Ve.prototype,"textContent",{get:function(){return this.value},set:function(p){return this.value=p||""}}),Ve}.call(this)}).call(this)},516:function(un,In,tt){(function(){var ze,je;ze=tt(269),je=tt(182),un.exports=class extends je{constructor(he,ft){if(super(he),null==ft)throw new Error("Missing comment text. "+this.debugInfo());this.name="#comment",this.type=ze.Comment,this.value=this.stringify.comment(ft)}clone(){return Object.create(this)}toString(he){return this.options.writer.comment(this,this.options.writer.filterOptions(he))}}}).call(this)},806:function(un,In,tt){(function(){var je,Ve;je=tt(276),Ve=tt(735),un.exports=function(){class p{constructor(){this.defaultParams={"canonical-form":!1,"cdata-sections":!1,comments:!1,"datatype-normalization":!1,"element-content-whitespace":!0,entities:!0,"error-handler":new je,infoset:!0,"validate-if-schema":!1,namespaces:!0,"namespace-declarations":!0,"normalize-characters":!1,"schema-location":"","schema-type":"","split-cdata-sections":!0,validate:!1,"well-formed":!0},this.params=Object.create(this.defaultParams)}getParameter(ft){return this.params.hasOwnProperty(ft)?this.params[ft]:null}canSetParameter(ft,qe){return!0}setParameter(ft,qe){return null!=qe?this.params[ft]=qe:delete this.params[ft]}}return Object.defineProperty(p.prototype,"parameterNames",{get:function(){return new Ve(Object.keys(this.defaultParams))}}),p}.call(this)}).call(this)},276:function(un){(function(){un.exports=class{constructor(){}handleError(ze){throw new Error(ze)}}}).call(this)},906:function(un){(function(){un.exports=class{hasFeature(ze,je){return!0}createDocumentType(ze,je,Ve){throw new Error("This DOM method is not implemented.")}createDocument(ze,je,Ve){throw new Error("This DOM method is not implemented.")}createHTMLDocument(ze){throw new Error("This DOM method is not implemented.")}getFeature(ze,je){throw new Error("This DOM method is not implemented.")}}}).call(this)},735:function(un){(function(){un.exports=function(){class tt{constructor(je){this.arr=je||[]}item(je){return this.arr[je]||null}contains(je){return-1!==this.arr.indexOf(je)}}return Object.defineProperty(tt.prototype,"length",{get:function(){return this.arr.length}}),tt}.call(this)}).call(this)},274:function(un,In,tt){(function(){var ze,Ve;Ve=tt(563),ze=tt(269),un.exports=class extends Ve{constructor(he,ft,qe,Xe,Qe,St){if(super(he),null==ft)throw new Error("Missing DTD element name. "+this.debugInfo());if(null==qe)throw new Error("Missing DTD attribute name. "+this.debugInfo(ft));if(!Xe)throw new Error("Missing DTD attribute type. "+this.debugInfo(ft));if(!Qe)throw new Error("Missing DTD attribute default. "+this.debugInfo(ft));if(0!==Qe.indexOf("#")&&(Qe="#"+Qe),!Qe.match(/^(#REQUIRED|#IMPLIED|#FIXED|#DEFAULT)$/))throw new Error("Invalid default value type; expected: #REQUIRED, #IMPLIED, #FIXED or #DEFAULT. "+this.debugInfo(ft));if(St&&!Qe.match(/^(#FIXED|#DEFAULT)$/))throw new Error("Default value only applies to #FIXED or #DEFAULT. "+this.debugInfo(ft));this.elementName=this.stringify.name(ft),this.type=ze.AttributeDeclaration,this.attributeName=this.stringify.name(qe),this.attributeType=this.stringify.dtdAttType(Xe),St&&(this.defaultValue=this.stringify.dtdAttDefault(St)),this.defaultValueType=Qe}toString(he){return this.options.writer.dtdAttList(this,this.options.writer.filterOptions(he))}}}).call(this)},68:function(un,In,tt){(function(){var ze,Ve;Ve=tt(563),ze=tt(269),un.exports=class extends Ve{constructor(he,ft,qe){if(super(he),null==ft)throw new Error("Missing DTD element name. "+this.debugInfo());qe||(qe="(#PCDATA)"),Array.isArray(qe)&&(qe="("+qe.join(",")+")"),this.name=this.stringify.name(ft),this.type=ze.ElementDeclaration,this.value=this.stringify.dtdElementValue(qe)}toString(he){return this.options.writer.dtdElement(this,this.options.writer.filterOptions(he))}}}).call(this)},349:function(un,In,tt){(function(){var ze,Ve,p;({isObject:p}=tt(452)),Ve=tt(563),ze=tt(269),un.exports=function(){class he extends Ve{constructor(qe,Xe,Qe,St){if(super(qe),null==Qe)throw new Error("Missing DTD entity name. "+this.debugInfo(Qe));if(null==St)throw new Error("Missing DTD entity value. "+this.debugInfo(Qe));if(this.pe=!!Xe,this.name=this.stringify.name(Qe),this.type=ze.EntityDeclaration,p(St)){if(!St.pubID&&!St.sysID)throw new Error("Public and/or system identifiers are required for an external entity. "+this.debugInfo(Qe));if(St.pubID&&!St.sysID)throw new Error("System identifier is required for a public external entity. "+this.debugInfo(Qe));if(this.internal=!1,null!=St.pubID&&(this.pubID=this.stringify.dtdPubID(St.pubID)),null!=St.sysID&&(this.sysID=this.stringify.dtdSysID(St.sysID)),null!=St.nData&&(this.nData=this.stringify.dtdNData(St.nData)),this.pe&&this.nData)throw new Error("Notation declaration is not allowed in a parameter entity. "+this.debugInfo(Qe))}else this.value=this.stringify.dtdEntityValue(St),this.internal=!0}toString(qe){return this.options.writer.dtdEntity(this,this.options.writer.filterOptions(qe))}}return Object.defineProperty(he.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(he.prototype,"systemId",{get:function(){return this.sysID}}),Object.defineProperty(he.prototype,"notationName",{get:function(){return this.nData||null}}),Object.defineProperty(he.prototype,"inputEncoding",{get:function(){return null}}),Object.defineProperty(he.prototype,"xmlEncoding",{get:function(){return null}}),Object.defineProperty(he.prototype,"xmlVersion",{get:function(){return null}}),he}.call(this)}).call(this)},87:function(un,In,tt){(function(){var ze,Ve;Ve=tt(563),ze=tt(269),un.exports=function(){class p extends Ve{constructor(ft,qe,Xe){if(super(ft),null==qe)throw new Error("Missing DTD notation name. "+this.debugInfo(qe));if(!Xe.pubID&&!Xe.sysID)throw new Error("Public or system identifiers are required for an external entity. "+this.debugInfo(qe));this.name=this.stringify.name(qe),this.type=ze.NotationDeclaration,null!=Xe.pubID&&(this.pubID=this.stringify.dtdPubID(Xe.pubID)),null!=Xe.sysID&&(this.sysID=this.stringify.dtdSysID(Xe.sysID))}toString(ft){return this.options.writer.dtdNotation(this,this.options.writer.filterOptions(ft))}}return Object.defineProperty(p.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(p.prototype,"systemId",{get:function(){return this.sysID}}),p}.call(this)}).call(this)},789:function(un,In,tt){(function(){var ze,Ve,p;({isObject:p}=tt(452)),Ve=tt(563),ze=tt(269),un.exports=class extends Ve{constructor(ft,qe,Xe,Qe){super(ft),p(qe)&&({version:qe,encoding:Xe,standalone:Qe}=qe),qe||(qe="1.0"),this.type=ze.Declaration,this.version=this.stringify.xmlVersion(qe),null!=Xe&&(this.encoding=this.stringify.xmlEncoding(Xe)),null!=Qe&&(this.standalone=this.stringify.xmlStandalone(Qe))}toString(ft){return this.options.writer.declaration(this,this.options.writer.filterOptions(ft))}}}).call(this)},195:function(un,In,tt){(function(){var ze,je,Ve,p,he,qe,Xe,Qe;({isObject:Qe}=tt(452)),Xe=tt(563),ze=tt(269),je=tt(274),p=tt(349),Ve=tt(68),he=tt(87),qe=tt(264),un.exports=function(){class St extends Xe{constructor(Ze,ut,jt){var _n,He,Fn,Rt;if(super(Ze),this.type=ze.DocType,Ze.children)for(He=0,Fn=(Rt=Ze.children).length;He<Fn;He++)if((_n=Rt[He]).type===ze.Element){this.name=_n.name;break}this.documentObject=Ze,Qe(ut)&&({pubID:ut,sysID:jt}=ut),null==jt&&([jt,ut]=[ut,jt]),null!=ut&&(this.pubID=this.stringify.dtdPubID(ut)),null!=jt&&(this.sysID=this.stringify.dtdSysID(jt))}element(Ze,ut){var jt;return jt=new Ve(this,Ze,ut),this.children.push(jt),this}attList(Ze,ut,jt,_n,He){var Fn;return Fn=new je(this,Ze,ut,jt,_n,He),this.children.push(Fn),this}entity(Ze,ut){var jt;return jt=new p(this,!1,Ze,ut),this.children.push(jt),this}pEntity(Ze,ut){var jt;return jt=new p(this,!0,Ze,ut),this.children.push(jt),this}notation(Ze,ut){var jt;return jt=new he(this,Ze,ut),this.children.push(jt),this}toString(Ze){return this.options.writer.docType(this,this.options.writer.filterOptions(Ze))}ele(Ze,ut){return this.element(Ze,ut)}att(Ze,ut,jt,_n,He){return this.attList(Ze,ut,jt,_n,He)}ent(Ze,ut){return this.entity(Ze,ut)}pent(Ze,ut){return this.pEntity(Ze,ut)}not(Ze,ut){return this.notation(Ze,ut)}up(){return this.root()||this.documentObject}isEqualNode(Ze){return!(!super.isEqualNode(Ze)||Ze.name!==this.name||Ze.publicId!==this.publicId||Ze.systemId!==this.systemId)}}return Object.defineProperty(St.prototype,"entities",{get:function(){var Ct,Ze,ut,jt,_n;for(jt={},Ze=0,ut=(_n=this.children).length;Ze<ut;Ze++)(Ct=_n[Ze]).type===ze.EntityDeclaration&&!Ct.pe&&(jt[Ct.name]=Ct);return new qe(jt)}}),Object.defineProperty(St.prototype,"notations",{get:function(){var Ct,Ze,ut,jt,_n;for(jt={},Ze=0,ut=(_n=this.children).length;Ze<ut;Ze++)(Ct=_n[Ze]).type===ze.NotationDeclaration&&(jt[Ct.name]=Ct);return new qe(jt)}}),Object.defineProperty(St.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(St.prototype,"systemId",{get:function(){return this.sysID}}),Object.defineProperty(St.prototype,"internalSubset",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),St}.call(this)}).call(this)},519:function(un,In,tt){(function(){var ze,je,Ve,he,ft,qe,Xe;({isPlainObject:Xe}=tt(452)),Ve=tt(906),je=tt(806),he=tt(563),ze=tt(269),qe=tt(41),ft=tt(354),un.exports=function(){class Qe extends he{constructor(Ct){super(null),this.name="#document",this.type=ze.Document,this.documentURI=null,this.domConfig=new je,Ct||(Ct={}),Ct.writer||(Ct.writer=new ft),this.options=Ct,this.stringify=new qe(Ct)}end(Ct){var Ze;return Ze={},Ct?Xe(Ct)&&(Ze=Ct,Ct=this.options.writer):Ct=this.options.writer,Ct.document(this,Ct.filterOptions(Ze))}toString(Ct){return this.options.writer.document(this,this.options.writer.filterOptions(Ct))}createElement(Ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}createDocumentFragment(){throw new Error("This DOM method is not implemented."+this.debugInfo())}createTextNode(Ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}createComment(Ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}createCDATASection(Ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}createProcessingInstruction(Ct,Ze){throw new Error("This DOM method is not implemented."+this.debugInfo())}createAttribute(Ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}createEntityReference(Ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagName(Ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}importNode(Ct,Ze){throw new Error("This DOM method is not implemented."+this.debugInfo())}createElementNS(Ct,Ze){throw new Error("This DOM method is not implemented."+this.debugInfo())}createAttributeNS(Ct,Ze){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagNameNS(Ct,Ze){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementById(Ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}adoptNode(Ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}normalizeDocument(){throw new Error("This DOM method is not implemented."+this.debugInfo())}renameNode(Ct,Ze,ut){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByClassName(Ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}createEvent(Ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}createRange(){throw new Error("This DOM method is not implemented."+this.debugInfo())}createNodeIterator(Ct,Ze,ut){throw new Error("This DOM method is not implemented."+this.debugInfo())}createTreeWalker(Ct,Ze,ut){throw new Error("This DOM method is not implemented."+this.debugInfo())}}return Object.defineProperty(Qe.prototype,"implementation",{value:new Ve}),Object.defineProperty(Qe.prototype,"doctype",{get:function(){var St,Ct,Ze,ut;for(Ct=0,Ze=(ut=this.children).length;Ct<Ze;Ct++)if((St=ut[Ct]).type===ze.DocType)return St;return null}}),Object.defineProperty(Qe.prototype,"documentElement",{get:function(){return this.rootObject||null}}),Object.defineProperty(Qe.prototype,"inputEncoding",{get:function(){return null}}),Object.defineProperty(Qe.prototype,"strictErrorChecking",{get:function(){return!1}}),Object.defineProperty(Qe.prototype,"xmlEncoding",{get:function(){return 0!==this.children.length&&this.children[0].type===ze.Declaration?this.children[0].encoding:null}}),Object.defineProperty(Qe.prototype,"xmlStandalone",{get:function(){return 0!==this.children.length&&this.children[0].type===ze.Declaration&&"yes"===this.children[0].standalone}}),Object.defineProperty(Qe.prototype,"xmlVersion",{get:function(){return 0!==this.children.length&&this.children[0].type===ze.Declaration?this.children[0].version:"1.0"}}),Object.defineProperty(Qe.prototype,"URL",{get:function(){return this.documentURI}}),Object.defineProperty(Qe.prototype,"origin",{get:function(){return null}}),Object.defineProperty(Qe.prototype,"compatMode",{get:function(){return null}}),Object.defineProperty(Qe.prototype,"characterSet",{get:function(){return null}}),Object.defineProperty(Qe.prototype,"contentType",{get:function(){return null}}),Qe}.call(this)}).call(this)},105:function(un,In,tt){(function(){var ze,je,Ve,p,he,ft,qe,Xe,Qe,St,Ct,Ze,jt,_n,He,Fn,Rt,Dn,Ie,ye,ge,oe,Ge={}.hasOwnProperty;({isObject:ge,isFunction:ye,isPlainObject:oe,getValue:Ie}=tt(452)),ze=tt(269),Ze=tt(519),jt=tt(352),p=tt(361),he=tt(516),He=tt(942),Dn=tt(474),_n=tt(666),St=tt(789),Ct=tt(195),ft=tt(274),Xe=tt(349),qe=tt(68),Qe=tt(87),Ve=tt(968),Rt=tt(41),Fn=tt(354),je=tt(316),un.exports=class{constructor(K,Me,$e){var Se;this.name="?xml",this.type=ze.Document,K||(K={}),Se={},K.writer?oe(K.writer)&&(Se=K.writer,K.writer=new Fn):K.writer=new Fn,this.options=K,this.writer=K.writer,this.writerOptions=this.writer.filterOptions(Se),this.stringify=new Rt(K),this.onDataCallback=Me||function(){},this.onEndCallback=$e||function(){},this.currentNode=null,this.currentLevel=-1,this.openTags={},this.documentStarted=!1,this.documentCompleted=!1,this.root=null}createChildNode(K){var $e,Se,Je,lt,cn,Mt,xt;switch(K.type){case ze.CData:this.cdata(K.value);break;case ze.Comment:this.comment(K.value);break;case ze.Element:for($e in Se={},Mt=K.attribs)!Ge.call(Mt,$e)||(Se[$e]=Mt[$e].value);this.node(K.name,Se);break;case ze.Dummy:this.dummy();break;case ze.Raw:this.raw(K.value);break;case ze.Text:this.text(K.value);break;case ze.ProcessingInstruction:this.instruction(K.target,K.value);break;default:throw new Error("This XML node type is not supported in a JS object: "+K.constructor.name)}for(lt=0,cn=(xt=K.children).length;lt<cn;lt++)this.createChildNode(Je=xt[lt]),Je.type===ze.Element&&this.up();return this}dummy(){return this}node(K,Me,$e){if(null==K)throw new Error("Missing node name.");if(this.root&&-1===this.currentLevel)throw new Error("Document can only have one root node. "+this.debugInfo(K));return this.openCurrent(),K=Ie(K),null==Me&&(Me={}),Me=Ie(Me),ge(Me)||([$e,Me]=[Me,$e]),this.currentNode=new jt(this,K,Me),this.currentNode.children=!1,this.currentLevel++,this.openTags[this.currentLevel]=this.currentNode,null!=$e&&this.text($e),this}element(K,Me,$e){var Se,Je,lt,cn,Mt,xt;if(this.currentNode&&this.currentNode.type===ze.DocType)this.dtdElement(...arguments);else if(Array.isArray(K)||ge(K)||ye(K))for(cn=this.options.noValidation,this.options.noValidation=!0,(xt=new Ze(this.options).element("TEMP_ROOT")).element(K),this.options.noValidation=cn,Je=0,lt=(Mt=xt.children).length;Je<lt;Je++)this.createChildNode(Se=Mt[Je]),Se.type===ze.Element&&this.up();else this.node(K,Me,$e);return this}attribute(K,Me){var $e;if(!this.currentNode||this.currentNode.children)throw new Error("att() can only be used immediately after an ele() call in callback mode. "+this.debugInfo(K));if(null!=K&&(K=Ie(K)),ge(K))for($e in K)!Ge.call(K,$e)||this.attribute($e,K[$e]);else ye(Me)&&(Me=Me.apply()),this.options.keepNullAttributes&&null==Me?this.currentNode.attribs[K]=new Ve(this,K,""):null!=Me&&(this.currentNode.attribs[K]=new Ve(this,K,Me));return this}text(K){var Me;return this.openCurrent(),Me=new Dn(this,K),this.onData(this.writer.text(Me,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}cdata(K){var Me;return this.openCurrent(),Me=new p(this,K),this.onData(this.writer.cdata(Me,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}comment(K){var Me;return this.openCurrent(),Me=new he(this,K),this.onData(this.writer.comment(Me,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}raw(K){var Me;return this.openCurrent(),Me=new He(this,K),this.onData(this.writer.raw(Me,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}instruction(K,Me){var $e,Se,lt,cn;if(this.openCurrent(),null!=K&&(K=Ie(K)),null!=Me&&(Me=Ie(Me)),Array.isArray(K))for($e=0,lt=K.length;$e<lt;$e++)this.instruction(Se=K[$e]);else if(ge(K))for(Se in K)!Ge.call(K,Se)||this.instruction(Se,K[Se]);else ye(Me)&&(Me=Me.apply()),cn=new _n(this,K,Me),this.onData(this.writer.processingInstruction(cn,this.writerOptions,this.currentLevel+1),this.currentLevel+1);return this}declaration(K,Me,$e){var Se;if(this.openCurrent(),this.documentStarted)throw new Error("declaration() must be the first node.");return Se=new St(this,K,Me,$e),this.onData(this.writer.declaration(Se,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}doctype(K,Me,$e){if(this.openCurrent(),null==K)throw new Error("Missing root node name.");if(this.root)throw new Error("dtd() must come before the root node.");return this.currentNode=new Ct(this,Me,$e),this.currentNode.rootNodeName=K,this.currentNode.children=!1,this.currentLevel++,this.openTags[this.currentLevel]=this.currentNode,this}dtdElement(K,Me){var $e;return this.openCurrent(),$e=new qe(this,K,Me),this.onData(this.writer.dtdElement($e,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}attList(K,Me,$e,Se,Je){var lt;return this.openCurrent(),lt=new ft(this,K,Me,$e,Se,Je),this.onData(this.writer.dtdAttList(lt,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}entity(K,Me){var $e;return this.openCurrent(),$e=new Xe(this,!1,K,Me),this.onData(this.writer.dtdEntity($e,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}pEntity(K,Me){var $e;return this.openCurrent(),$e=new Xe(this,!0,K,Me),this.onData(this.writer.dtdEntity($e,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}notation(K,Me){var $e;return this.openCurrent(),$e=new Qe(this,K,Me),this.onData(this.writer.dtdNotation($e,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}up(){if(this.currentLevel<0)throw new Error("The document node has no parent.");return this.currentNode?(this.currentNode.children?this.closeNode(this.currentNode):this.openNode(this.currentNode),this.currentNode=null):this.closeNode(this.openTags[this.currentLevel]),delete this.openTags[this.currentLevel],this.currentLevel--,this}end(){for(;this.currentLevel>=0;)this.up();return this.onEnd()}openCurrent(){if(this.currentNode)return this.currentNode.children=!0,this.openNode(this.currentNode)}openNode(K){var $e,Se,Je;if(!K.isOpen){if(!this.root&&0===this.currentLevel&&K.type===ze.Element&&(this.root=K),$e="",K.type===ze.Element){for(Se in this.writerOptions.state=je.OpenTag,$e=this.writer.indent(K,this.writerOptions,this.currentLevel)+"<"+K.name,Je=K.attribs)!Ge.call(Je,Se)||($e+=this.writer.attribute(Je[Se],this.writerOptions,this.currentLevel));$e+=(K.children?">":"/>")+this.writer.endline(K,this.writerOptions,this.currentLevel),this.writerOptions.state=je.InsideTag}else this.writerOptions.state=je.OpenTag,$e=this.writer.indent(K,this.writerOptions,this.currentLevel)+"<!DOCTYPE "+K.rootNodeName,K.pubID&&K.sysID?$e+=' PUBLIC "'+K.pubID+'" "'+K.sysID+'"':K.sysID&&($e+=' SYSTEM "'+K.sysID+'"'),K.children?($e+=" [",this.writerOptions.state=je.InsideTag):(this.writerOptions.state=je.CloseTag,$e+=">"),$e+=this.writer.endline(K,this.writerOptions,this.currentLevel);return this.onData($e,this.currentLevel),K.isOpen=!0}}closeNode(K){var Me;if(!K.isClosed)return"",this.writerOptions.state=je.CloseTag,Me=K.type===ze.Element?this.writer.indent(K,this.writerOptions,this.currentLevel)+"</"+K.name+">"+this.writer.endline(K,this.writerOptions,this.currentLevel):this.writer.indent(K,this.writerOptions,this.currentLevel)+"]>"+this.writer.endline(K,this.writerOptions,this.currentLevel),this.writerOptions.state=je.None,this.onData(Me,this.currentLevel),K.isClosed=!0}onData(K,Me){return this.documentStarted=!0,this.onDataCallback(K,Me+1)}onEnd(){return this.documentCompleted=!0,this.onEndCallback()}debugInfo(K){return null==K?"":"node: <"+K+">"}ele(){return this.element(...arguments)}nod(K,Me,$e){return this.node(K,Me,$e)}txt(K){return this.text(K)}dat(K){return this.cdata(K)}com(K){return this.comment(K)}ins(K,Me){return this.instruction(K,Me)}dec(K,Me,$e){return this.declaration(K,Me,$e)}dtd(K,Me,$e){return this.doctype(K,Me,$e)}e(K,Me,$e){return this.element(K,Me,$e)}n(K,Me,$e){return this.node(K,Me,$e)}t(K){return this.text(K)}d(K){return this.cdata(K)}c(K){return this.comment(K)}r(K){return this.raw(K)}i(K,Me){return this.instruction(K,Me)}att(){return this.currentNode&&this.currentNode.type===ze.DocType?this.attList(...arguments):this.attribute(...arguments)}a(){return this.currentNode&&this.currentNode.type===ze.DocType?this.attList(...arguments):this.attribute(...arguments)}ent(K,Me){return this.entity(K,Me)}pent(K,Me){return this.pEntity(K,Me)}not(K,Me){return this.notation(K,Me)}}}).call(this)},173:function(un,In,tt){(function(){var ze,Ve;Ve=tt(563),ze=tt(269),un.exports=class extends Ve{constructor(he){super(he),this.type=ze.Dummy}clone(){return Object.create(this)}toString(he){return""}}}).call(this)},352:function(un,In,tt){(function(){var ze,je,p,he,ft,qe,Xe,Qe={}.hasOwnProperty;({isObject:Xe,isFunction:qe,getValue:ft}=tt(452)),he=tt(563),ze=tt(269),je=tt(968),p=tt(264),un.exports=function(){class St extends he{constructor(Ze,ut,jt){var _n,He,Fn,Rt;if(super(Ze),null==ut)throw new Error("Missing element name. "+this.debugInfo());if(this.name=this.stringify.name(ut),this.type=ze.Element,this.attribs={},this.schemaTypeInfo=null,null!=jt&&this.attribute(jt),Ze.type===ze.Document&&(this.isRoot=!0,this.documentObject=Ze,Ze.rootObject=this,Ze.children))for(He=0,Fn=(Rt=Ze.children).length;He<Fn;He++)if((_n=Rt[He]).type===ze.DocType){_n.name=this.name;break}}clone(){var ut,jt,_n;for(ut in(jt=Object.create(this)).isRoot&&(jt.documentObject=null),jt.attribs={},_n=this.attribs)!Qe.call(_n,ut)||(jt.attribs[ut]=_n[ut].clone());return jt.children=[],this.children.forEach(function(He){var Fn;return(Fn=He.clone()).parent=jt,jt.children.push(Fn)}),jt}attribute(Ze,ut){var jt;if(null!=Ze&&(Ze=ft(Ze)),Xe(Ze))for(jt in Ze)!Qe.call(Ze,jt)||this.attribute(jt,Ze[jt]);else qe(ut)&&(ut=ut.apply()),this.options.keepNullAttributes&&null==ut?this.attribs[Ze]=new je(this,Ze,""):null!=ut&&(this.attribs[Ze]=new je(this,Ze,ut));return this}removeAttribute(Ze){var jt,_n;if(null==Ze)throw new Error("Missing attribute name. "+this.debugInfo());if(Ze=ft(Ze),Array.isArray(Ze))for(jt=0,_n=Ze.length;jt<_n;jt++)delete this.attribs[Ze[jt]];else delete this.attribs[Ze];return this}toString(Ze){return this.options.writer.element(this,this.options.writer.filterOptions(Ze))}att(Ze,ut){return this.attribute(Ze,ut)}a(Ze,ut){return this.attribute(Ze,ut)}getAttribute(Ze){return this.attribs.hasOwnProperty(Ze)?this.attribs[Ze].value:null}setAttribute(Ze,ut){throw new Error("This DOM method is not implemented."+this.debugInfo())}getAttributeNode(Ze){return this.attribs.hasOwnProperty(Ze)?this.attribs[Ze]:null}setAttributeNode(Ze){throw new Error("This DOM method is not implemented."+this.debugInfo())}removeAttributeNode(Ze){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagName(Ze){throw new Error("This DOM method is not implemented."+this.debugInfo())}getAttributeNS(Ze,ut){throw new Error("This DOM method is not implemented."+this.debugInfo())}setAttributeNS(Ze,ut,jt){throw new Error("This DOM method is not implemented."+this.debugInfo())}removeAttributeNS(Ze,ut){throw new Error("This DOM method is not implemented."+this.debugInfo())}getAttributeNodeNS(Ze,ut){throw new Error("This DOM method is not implemented."+this.debugInfo())}setAttributeNodeNS(Ze){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagNameNS(Ze,ut){throw new Error("This DOM method is not implemented."+this.debugInfo())}hasAttribute(Ze){return this.attribs.hasOwnProperty(Ze)}hasAttributeNS(Ze,ut){throw new Error("This DOM method is not implemented."+this.debugInfo())}setIdAttribute(Ze,ut){return this.attribs.hasOwnProperty(Ze)?this.attribs[Ze].isId:ut}setIdAttributeNS(Ze,ut,jt){throw new Error("This DOM method is not implemented."+this.debugInfo())}setIdAttributeNode(Ze,ut){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagName(Ze){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagNameNS(Ze,ut){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByClassName(Ze){throw new Error("This DOM method is not implemented."+this.debugInfo())}isEqualNode(Ze){var ut,jt,_n;if(!super.isEqualNode(Ze)||Ze.namespaceURI!==this.namespaceURI||Ze.prefix!==this.prefix||Ze.localName!==this.localName||Ze.attribs.length!==this.attribs.length)return!1;for(ut=jt=0,_n=this.attribs.length-1;0<=_n?jt<=_n:jt>=_n;ut=0<=_n?++jt:--jt)if(!this.attribs[ut].isEqualNode(Ze.attribs[ut]))return!1;return!0}}return Object.defineProperty(St.prototype,"tagName",{get:function(){return this.name}}),Object.defineProperty(St.prototype,"namespaceURI",{get:function(){return""}}),Object.defineProperty(St.prototype,"prefix",{get:function(){return""}}),Object.defineProperty(St.prototype,"localName",{get:function(){return this.name}}),Object.defineProperty(St.prototype,"id",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(St.prototype,"className",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(St.prototype,"classList",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(St.prototype,"attributes",{get:function(){return(!this.attributeMap||!this.attributeMap.nodes)&&(this.attributeMap=new p(this.attribs)),this.attributeMap}}),St}.call(this)}).call(this)},264:function(un){(function(){un.exports=function(){class tt{constructor(je){this.nodes=je}clone(){return this.nodes=null}getNamedItem(je){return this.nodes[je]}setNamedItem(je){var Ve;return Ve=this.nodes[je.nodeName],this.nodes[je.nodeName]=je,Ve||null}removeNamedItem(je){var Ve;return Ve=this.nodes[je],delete this.nodes[je],Ve||null}item(je){return this.nodes[Object.keys(this.nodes)[je]]||null}getNamedItemNS(je,Ve){throw new Error("This DOM method is not implemented.")}setNamedItemNS(je){throw new Error("This DOM method is not implemented.")}removeNamedItemNS(je,Ve){throw new Error("This DOM method is not implemented.")}}return Object.defineProperty(tt.prototype,"length",{get:function(){return Object.keys(this.nodes).length||0}}),tt}.call(this)}).call(this)},563:function(un,In,tt){(function(){var ze,je,Ve,p,he,ft,qe,Xe,Ct,Ze,ut,jt,_n,He,Fn,Rt,Dn={}.hasOwnProperty,Ie=[].splice;({isObject:Rt,isFunction:Fn,isEmpty:He,getValue:_n}=tt(452)),Xe=null,Ve=null,p=null,he=null,ft=null,ut=null,jt=null,Ze=null,qe=null,je=null,Ct=null,ze=null,un.exports=function(){class ye{constructor(oe){this.parent=oe,this.parent&&(this.options=this.parent.options,this.stringify=this.parent.stringify),this.value=null,this.children=[],this.baseURI=null,Xe||(Xe=tt(352),Ve=tt(361),p=tt(516),he=tt(789),ft=tt(195),ut=tt(942),jt=tt(474),Ze=tt(666),qe=tt(173),je=tt(269),Ct=tt(112),tt(264),ze=tt(599))}setParent(oe){var Be,K,Me,$e;for(this.parent=oe,oe&&(this.options=oe.options,this.stringify=oe.stringify),$e=[],Be=0,K=(Me=this.children).length;Be<K;Be++)$e.push(Me[Be].setParent(this));return $e}element(oe,Ge,Be){var K,$e,Se,Je,lt,cn,Mt,xt;if(lt=null,null===Ge&&null==Be&&([Ge,Be]=[{},null]),null==Ge&&(Ge={}),Ge=_n(Ge),Rt(Ge)||([Be,Ge]=[Ge,Be]),null!=oe&&(oe=_n(oe)),Array.isArray(oe))for($e=0,cn=oe.length;$e<cn;$e++)lt=this.element(oe[$e]);else if(Fn(oe))lt=this.element(oe.apply());else if(Rt(oe)){for(Je in oe)if(Dn.call(oe,Je))if(Fn(xt=oe[Je])&&(xt=xt.apply()),!this.options.ignoreDecorators&&this.stringify.convertAttKey&&0===Je.indexOf(this.stringify.convertAttKey))lt=this.attribute(Je.substr(this.stringify.convertAttKey.length),xt);else if(!this.options.separateArrayItems&&Array.isArray(xt)&&He(xt))lt=this.dummy();else if(Rt(xt)&&He(xt))lt=this.element(Je);else if(this.options.keepNullNodes||null!=xt)if(!this.options.separateArrayItems&&Array.isArray(xt))for(Se=0,Mt=xt.length;Se<Mt;Se++)(K={})[Je]=xt[Se],lt=this.element(K);else Rt(xt)?!this.options.ignoreDecorators&&this.stringify.convertTextKey&&0===Je.indexOf(this.stringify.convertTextKey)?lt=this.element(xt):(lt=this.element(Je)).element(xt):lt=this.element(Je,xt);else lt=this.dummy()}else lt=this.options.keepNullNodes||null!==Be?!this.options.ignoreDecorators&&this.stringify.convertTextKey&&0===oe.indexOf(this.stringify.convertTextKey)?this.text(Be):!this.options.ignoreDecorators&&this.stringify.convertCDataKey&&0===oe.indexOf(this.stringify.convertCDataKey)?this.cdata(Be):!this.options.ignoreDecorators&&this.stringify.convertCommentKey&&0===oe.indexOf(this.stringify.convertCommentKey)?this.comment(Be):!this.options.ignoreDecorators&&this.stringify.convertRawKey&&0===oe.indexOf(this.stringify.convertRawKey)?this.raw(Be):!this.options.ignoreDecorators&&this.stringify.convertPIKey&&0===oe.indexOf(this.stringify.convertPIKey)?this.instruction(oe.substr(this.stringify.convertPIKey.length),Be):this.node(oe,Ge,Be):this.dummy();if(null==lt)throw new Error("Could not create any elements with: "+oe+". "+this.debugInfo());return lt}insertBefore(oe,Ge,Be){var K,Me,$e,Se,Je;if(null!=oe&&oe.type)return Se=Ge,($e=oe).setParent(this),Se?(Me=children.indexOf(Se),Je=children.splice(Me),children.push($e),Array.prototype.push.apply(children,Je)):children.push($e),$e;if(this.isRoot)throw new Error("Cannot insert elements at root level. "+this.debugInfo(oe));return Me=this.parent.children.indexOf(this),Je=this.parent.children.splice(Me),K=this.parent.element(oe,Ge,Be),Array.prototype.push.apply(this.parent.children,Je),K}insertAfter(oe,Ge,Be){var K,Me,$e;if(this.isRoot)throw new Error("Cannot insert elements at root level. "+this.debugInfo(oe));return Me=this.parent.children.indexOf(this),$e=this.parent.children.splice(Me+1),K=this.parent.element(oe,Ge,Be),Array.prototype.push.apply(this.parent.children,$e),K}remove(){var oe;if(this.isRoot)throw new Error("Cannot remove the root element. "+this.debugInfo());return oe=this.parent.children.indexOf(this),Ie.apply(this.parent.children,[oe,oe-oe+1].concat([])),this.parent}node(oe,Ge,Be){var K;return null!=oe&&(oe=_n(oe)),Ge||(Ge={}),Ge=_n(Ge),Rt(Ge)||([Be,Ge]=[Ge,Be]),K=new Xe(this,oe,Ge),null!=Be&&K.text(Be),this.children.push(K),K}text(oe){var Ge;return Rt(oe)&&this.element(oe),Ge=new jt(this,oe),this.children.push(Ge),this}cdata(oe){var Ge;return Ge=new Ve(this,oe),this.children.push(Ge),this}comment(oe){var Ge;return Ge=new p(this,oe),this.children.push(Ge),this}commentBefore(oe){var Be,K;return Be=this.parent.children.indexOf(this),K=this.parent.children.splice(Be),this.parent.comment(oe),Array.prototype.push.apply(this.parent.children,K),this}commentAfter(oe){var Be,K;return Be=this.parent.children.indexOf(this),K=this.parent.children.splice(Be+1),this.parent.comment(oe),Array.prototype.push.apply(this.parent.children,K),this}raw(oe){var Ge;return Ge=new ut(this,oe),this.children.push(Ge),this}dummy(){return new qe(this)}instruction(oe,Ge){var Be,Me,$e,Se;if(null!=oe&&(oe=_n(oe)),null!=Ge&&(Ge=_n(Ge)),Array.isArray(oe))for($e=0,Se=oe.length;$e<Se;$e++)this.instruction(Be=oe[$e]);else if(Rt(oe))for(Be in oe)!Dn.call(oe,Be)||this.instruction(Be,oe[Be]);else Fn(Ge)&&(Ge=Ge.apply()),Me=new Ze(this,oe,Ge),this.children.push(Me);return this}instructionBefore(oe,Ge){var K,Me;return K=this.parent.children.indexOf(this),Me=this.parent.children.splice(K),this.parent.instruction(oe,Ge),Array.prototype.push.apply(this.parent.children,Me),this}instructionAfter(oe,Ge){var K,Me;return K=this.parent.children.indexOf(this),Me=this.parent.children.splice(K+1),this.parent.instruction(oe,Ge),Array.prototype.push.apply(this.parent.children,Me),this}declaration(oe,Ge,Be){var K,Me;return K=this.document(),Me=new he(K,oe,Ge,Be),0===K.children.length?K.children.unshift(Me):K.children[0].type===je.Declaration?K.children[0]=Me:K.children.unshift(Me),K.root()||K}dtd(oe,Ge){var K,Me,$e,Se,Je,lt,cn,Mt,xt;for(K=this.document(),Me=new ft(K,oe,Ge),$e=Se=0,lt=(Mt=K.children).length;Se<lt;$e=++Se)if(Mt[$e].type===je.DocType)return K.children[$e]=Me,Me;for($e=Je=0,cn=(xt=K.children).length;Je<cn;$e=++Je)if(xt[$e].isRoot)return K.children.splice($e,0,Me),Me;return K.children.push(Me),Me}up(){if(this.isRoot)throw new Error("The root node has no parent. Use doc() if you need to get the document object.");return this.parent}root(){var oe;for(oe=this;oe;){if(oe.type===je.Document)return oe.rootObject;if(oe.isRoot)return oe;oe=oe.parent}}document(){var oe;for(oe=this;oe;){if(oe.type===je.Document)return oe;oe=oe.parent}}end(oe){return this.document().end(oe)}prev(){var oe;if((oe=this.parent.children.indexOf(this))<1)throw new Error("Already at the first node. "+this.debugInfo());return this.parent.children[oe-1]}next(){var oe;if(-1===(oe=this.parent.children.indexOf(this))||oe===this.parent.children.length-1)throw new Error("Already at the last node. "+this.debugInfo());return this.parent.children[oe+1]}importDocument(oe){var Ge,Be,K,Me,$e;if((Be=oe.root().clone()).parent=this,Be.isRoot=!1,this.children.push(Be),this.type===je.Document&&(Be.isRoot=!0,Be.documentObject=this,this.rootObject=Be,this.children))for(K=0,Me=($e=this.children).length;K<Me;K++)if((Ge=$e[K]).type===je.DocType){Ge.name=Be.name;break}return this}debugInfo(oe){var Ge,Be;return null!=(oe=oe||this.name)||null!=(Ge=this.parent)&&Ge.name?null==oe?"parent: <"+this.parent.name+">":null!=(Be=this.parent)&&Be.name?"node: <"+oe+">, parent: <"+this.parent.name+">":"node: <"+oe+">":""}ele(oe,Ge,Be){return this.element(oe,Ge,Be)}nod(oe,Ge,Be){return this.node(oe,Ge,Be)}txt(oe){return this.text(oe)}dat(oe){return this.cdata(oe)}com(oe){return this.comment(oe)}ins(oe,Ge){return this.instruction(oe,Ge)}doc(){return this.document()}dec(oe,Ge,Be){return this.declaration(oe,Ge,Be)}e(oe,Ge,Be){return this.element(oe,Ge,Be)}n(oe,Ge,Be){return this.node(oe,Ge,Be)}t(oe){return this.text(oe)}d(oe){return this.cdata(oe)}c(oe){return this.comment(oe)}r(oe){return this.raw(oe)}i(oe,Ge){return this.instruction(oe,Ge)}u(){return this.up()}importXMLBuilder(oe){return this.importDocument(oe)}attribute(oe,Ge){throw new Error("attribute() applies to element nodes only.")}att(oe,Ge){return this.attribute(oe,Ge)}a(oe,Ge){return this.attribute(oe,Ge)}removeAttribute(oe){throw new Error("attribute() applies to element nodes only.")}replaceChild(oe,Ge){throw new Error("This DOM method is not implemented."+this.debugInfo())}removeChild(oe){throw new Error("This DOM method is not implemented."+this.debugInfo())}appendChild(oe){throw new Error("This DOM method is not implemented."+this.debugInfo())}hasChildNodes(){return 0!==this.children.length}cloneNode(oe){throw new Error("This DOM method is not implemented."+this.debugInfo())}normalize(){throw new Error("This DOM method is not implemented."+this.debugInfo())}isSupported(oe,Ge){return!0}hasAttributes(){return 0!==this.attribs.length}compareDocumentPosition(oe){var Be;return this===oe?0:this.document()!==oe.document()?(Be=ze.Disconnected|ze.ImplementationSpecific,Math.random()<.5?Be|=ze.Preceding:Be|=ze.Following,Be):this.isAncestor(oe)?ze.Contains|ze.Preceding:this.isDescendant(oe)?ze.Contains|ze.Following:this.isPreceding(oe)?ze.Preceding:ze.Following}isSameNode(oe){throw new Error("This DOM method is not implemented."+this.debugInfo())}lookupPrefix(oe){throw new Error("This DOM method is not implemented."+this.debugInfo())}isDefaultNamespace(oe){throw new Error("This DOM method is not implemented."+this.debugInfo())}lookupNamespaceURI(oe){throw new Error("This DOM method is not implemented."+this.debugInfo())}isEqualNode(oe){var Ge,Be,K;if(oe.nodeType!==this.nodeType||oe.children.length!==this.children.length)return!1;for(Ge=Be=0,K=this.children.length-1;0<=K?Be<=K:Be>=K;Ge=0<=K?++Be:--Be)if(!this.children[Ge].isEqualNode(oe.children[Ge]))return!1;return!0}getFeature(oe,Ge){throw new Error("This DOM method is not implemented."+this.debugInfo())}setUserData(oe,Ge,Be){throw new Error("This DOM method is not implemented."+this.debugInfo())}getUserData(oe){throw new Error("This DOM method is not implemented."+this.debugInfo())}contains(oe){return!!oe&&(oe===this||this.isDescendant(oe))}isDescendant(oe){var Ge,K,Me,$e;for(K=0,Me=($e=this.children).length;K<Me;K++)if(oe===(Ge=$e[K])||Ge.isDescendant(oe))return!0;return!1}isAncestor(oe){return oe.isDescendant(this)}isPreceding(oe){var Ge,Be;return Ge=this.treePosition(oe),Be=this.treePosition(this),-1!==Ge&&-1!==Be&&Ge<Be}isFollowing(oe){var Ge,Be;return Ge=this.treePosition(oe),Be=this.treePosition(this),-1!==Ge&&-1!==Be&&Ge>Be}treePosition(oe){var Ge,Be;return Be=0,Ge=!1,this.foreachTreeNode(this.document(),function(K){if(Be++,!Ge&&K===oe)return Ge=!0}),Ge?Be:-1}foreachTreeNode(oe,Ge){var Be,K,Me,$e,Se;for(oe||(oe=this.document()),K=0,Me=($e=oe.children).length;K<Me;K++){if(Se=Ge(Be=$e[K]))return Se;if(Se=this.foreachTreeNode(Be,Ge))return Se}}}return Object.defineProperty(ye.prototype,"nodeName",{get:function(){return this.name}}),Object.defineProperty(ye.prototype,"nodeType",{get:function(){return this.type}}),Object.defineProperty(ye.prototype,"nodeValue",{get:function(){return this.value}}),Object.defineProperty(ye.prototype,"parentNode",{get:function(){return this.parent}}),Object.defineProperty(ye.prototype,"childNodes",{get:function(){return(!this.childNodeList||!this.childNodeList.nodes)&&(this.childNodeList=new Ct(this.children)),this.childNodeList}}),Object.defineProperty(ye.prototype,"firstChild",{get:function(){return this.children[0]||null}}),Object.defineProperty(ye.prototype,"lastChild",{get:function(){return this.children[this.children.length-1]||null}}),Object.defineProperty(ye.prototype,"previousSibling",{get:function(){var ge;return ge=this.parent.children.indexOf(this),this.parent.children[ge-1]||null}}),Object.defineProperty(ye.prototype,"nextSibling",{get:function(){var ge;return ge=this.parent.children.indexOf(this),this.parent.children[ge+1]||null}}),Object.defineProperty(ye.prototype,"ownerDocument",{get:function(){return this.document()||null}}),Object.defineProperty(ye.prototype,"textContent",{get:function(){var ge,oe,Ge,Be,K;if(this.nodeType===je.Element||this.nodeType===je.DocumentFragment){for(K="",oe=0,Ge=(Be=this.children).length;oe<Ge;oe++)(ge=Be[oe]).textContent&&(K+=ge.textContent);return K}return null},set:function(ge){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),ye}.call(this)}).call(this)},112:function(un){(function(){un.exports=function(){class tt{constructor(je){this.nodes=je}clone(){return this.nodes=null}item(je){return this.nodes[je]||null}}return Object.defineProperty(tt.prototype,"length",{get:function(){return this.nodes.length||0}}),tt}.call(this)}).call(this)},666:function(un,In,tt){(function(){var ze,je;ze=tt(269),je=tt(182),un.exports=class extends je{constructor(he,ft,qe){if(super(he),null==ft)throw new Error("Missing instruction target. "+this.debugInfo());this.type=ze.ProcessingInstruction,this.target=this.stringify.insTarget(ft),this.name=this.target,qe&&(this.value=this.stringify.insValue(qe))}clone(){return Object.create(this)}toString(he){return this.options.writer.processingInstruction(this,this.options.writer.filterOptions(he))}isEqualNode(he){return!(!super.isEqualNode(he)||he.target!==this.target)}}}).call(this)},942:function(un,In,tt){(function(){var ze,je;ze=tt(269),je=tt(563),un.exports=class extends je{constructor(he,ft){if(super(he),null==ft)throw new Error("Missing raw text. "+this.debugInfo());this.type=ze.Raw,this.value=this.stringify.raw(ft)}clone(){return Object.create(this)}toString(he){return this.options.writer.raw(this,this.options.writer.filterOptions(he))}}}).call(this)},647:function(un,In,tt){(function(){var ze,je,p,he={}.hasOwnProperty;ze=tt(269),p=tt(576),je=tt(316),un.exports=class extends p{constructor(qe,Xe){super(Xe),this.stream=qe}endline(qe,Xe,Qe){return qe.isLastRootNode&&Xe.state===je.CloseTag?"":super.endline(qe,Xe,Qe)}document(qe,Xe){var St,Ct,Ze,ut,jt,_n,He,Fn;for(St=Ct=0,ut=(_n=qe.children).length;Ct<ut;St=++Ct)_n[St].isLastRootNode=St===qe.children.length-1;for(Xe=this.filterOptions(Xe),Fn=[],Ze=0,jt=(He=qe.children).length;Ze<jt;Ze++)Fn.push(this.writeChildNode(He[Ze],Xe,0));return Fn}cdata(qe,Xe,Qe){return this.stream.write(super.cdata(qe,Xe,Qe))}comment(qe,Xe,Qe){return this.stream.write(super.comment(qe,Xe,Qe))}declaration(qe,Xe,Qe){return this.stream.write(super.declaration(qe,Xe,Qe))}docType(qe,Xe,Qe){var Ct,Ze,ut;if(Qe||(Qe=0),this.openNode(qe,Xe,Qe),Xe.state=je.OpenTag,this.stream.write(this.indent(qe,Xe,Qe)),this.stream.write("<!DOCTYPE "+qe.root().name),qe.pubID&&qe.sysID?this.stream.write(' PUBLIC "'+qe.pubID+'" "'+qe.sysID+'"'):qe.sysID&&this.stream.write(' SYSTEM "'+qe.sysID+'"'),qe.children.length>0){for(this.stream.write(" ["),this.stream.write(this.endline(qe,Xe,Qe)),Xe.state=je.InsideTag,Ct=0,Ze=(ut=qe.children).length;Ct<Ze;Ct++)this.writeChildNode(ut[Ct],Xe,Qe+1);Xe.state=je.CloseTag,this.stream.write("]")}return Xe.state=je.CloseTag,this.stream.write(Xe.spaceBeforeSlash+">"),this.stream.write(this.endline(qe,Xe,Qe)),Xe.state=je.None,this.closeNode(qe,Xe,Qe)}element(qe,Xe,Qe){var ut,jt,_n,He,Fn,Rt,Ie,ye,ge,oe,Ge,Be;if(Qe||(Qe=0),this.openNode(qe,Xe,Qe),Xe.state=je.OpenTag,Ie=this.indent(qe,Xe,Qe)+"<"+qe.name,Xe.pretty&&Xe.width>0)for(Rt in He=Ie.length,ge=qe.attribs)!he.call(ge,Rt)||(He+(ye=this.attribute(ge[Rt],Xe,Qe)).length>Xe.width?(Be=this.indent(qe,Xe,Qe+1)+ye,Ie+=this.endline(qe,Xe,Qe)+Be,He=Be.length):(Ie+=Be=" "+ye,He+=Be.length));else for(Rt in oe=qe.attribs)!he.call(oe,Rt)||(Ie+=this.attribute(oe[Rt],Xe,Qe));if(this.stream.write(Ie),jt=0===(ut=qe.children.length)?null:qe.children[0],0===ut||qe.children.every(function(K){return(K.type===ze.Text||K.type===ze.Raw||K.type===ze.CData)&&""===K.value}))Xe.allowEmpty?(this.stream.write(">"),Xe.state=je.CloseTag,this.stream.write("</"+qe.name+">")):(Xe.state=je.CloseTag,this.stream.write(Xe.spaceBeforeSlash+"/>"));else if(!Xe.pretty||1!==ut||jt.type!==ze.Text&&jt.type!==ze.Raw&&jt.type!==ze.CData||null==jt.value){for(this.stream.write(">"+this.endline(qe,Xe,Qe)),Xe.state=je.InsideTag,_n=0,Fn=(Ge=qe.children).length;_n<Fn;_n++)this.writeChildNode(Ge[_n],Xe,Qe+1);Xe.state=je.CloseTag,this.stream.write(this.indent(qe,Xe,Qe)+"</"+qe.name+">")}else this.stream.write(">"),Xe.state=je.InsideTag,Xe.suppressPrettyCount++,this.writeChildNode(jt,Xe,Qe+1),Xe.suppressPrettyCount--,Xe.state=je.CloseTag,this.stream.write("</"+qe.name+">");return this.stream.write(this.endline(qe,Xe,Qe)),Xe.state=je.None,this.closeNode(qe,Xe,Qe)}processingInstruction(qe,Xe,Qe){return this.stream.write(super.processingInstruction(qe,Xe,Qe))}raw(qe,Xe,Qe){return this.stream.write(super.raw(qe,Xe,Qe))}text(qe,Xe,Qe){return this.stream.write(super.text(qe,Xe,Qe))}dtdAttList(qe,Xe,Qe){return this.stream.write(super.dtdAttList(qe,Xe,Qe))}dtdElement(qe,Xe,Qe){return this.stream.write(super.dtdElement(qe,Xe,Qe))}dtdEntity(qe,Xe,Qe){return this.stream.write(super.dtdEntity(qe,Xe,Qe))}dtdNotation(qe,Xe,Qe){return this.stream.write(super.dtdNotation(qe,Xe,Qe))}}}).call(this)},354:function(un,In,tt){(function(){var je;je=tt(576),un.exports=class extends je{constructor(p){super(p)}document(p,he){var qe,Xe,Qe,St;for(he=this.filterOptions(he),Qe="",qe=0,Xe=(St=p.children).length;qe<Xe;qe++)Qe+=this.writeChildNode(St[qe],he,0);return he.pretty&&Qe.slice(-he.newline.length)===he.newline&&(Qe=Qe.slice(0,-he.newline.length)),Qe}}}).call(this)},41:function(un){(function(){var tt={}.hasOwnProperty;un.exports=function(){class ze{constructor(Ve){var p,he;for(p in this.assertLegalChar=this.assertLegalChar.bind(this),this.assertLegalName=this.assertLegalName.bind(this),Ve||(Ve={}),this.options=Ve,this.options.version||(this.options.version="1.0"),he=Ve.stringify||{})!tt.call(he,p)||(this[p]=he[p])}name(Ve){return this.options.noValidation?Ve:this.assertLegalName(""+Ve||"")}text(Ve){return this.options.noValidation?Ve:this.assertLegalChar(this.textEscape(""+Ve||""))}cdata(Ve){return this.options.noValidation?Ve:(Ve=(Ve=""+Ve||"").replace("]]>","]]]]><![CDATA[>"),this.assertLegalChar(Ve))}comment(Ve){if(this.options.noValidation)return Ve;if((Ve=""+Ve||"").match(/--/))throw new Error("Comment text cannot contain double-hypen: "+Ve);return this.assertLegalChar(Ve)}raw(Ve){return this.options.noValidation?Ve:""+Ve||""}attValue(Ve){return this.options.noValidation?Ve:this.assertLegalChar(this.attEscape(Ve=""+Ve||""))}insTarget(Ve){return this.options.noValidation?Ve:this.assertLegalChar(""+Ve||"")}insValue(Ve){if(this.options.noValidation)return Ve;if((Ve=""+Ve||"").match(/\?>/))throw new Error("Invalid processing instruction value: "+Ve);return this.assertLegalChar(Ve)}xmlVersion(Ve){if(this.options.noValidation)return Ve;if(!(Ve=""+Ve||"").match(/1\.[0-9]+/))throw new Error("Invalid version number: "+Ve);return Ve}xmlEncoding(Ve){if(this.options.noValidation)return Ve;if(!(Ve=""+Ve||"").match(/^[A-Za-z](?:[A-Za-z0-9._-])*$/))throw new Error("Invalid encoding: "+Ve);return this.assertLegalChar(Ve)}xmlStandalone(Ve){return this.options.noValidation?Ve:Ve?"yes":"no"}dtdPubID(Ve){return this.options.noValidation?Ve:this.assertLegalChar(""+Ve||"")}dtdSysID(Ve){return this.options.noValidation?Ve:this.assertLegalChar(""+Ve||"")}dtdElementValue(Ve){return this.options.noValidation?Ve:this.assertLegalChar(""+Ve||"")}dtdAttType(Ve){return this.options.noValidation?Ve:this.assertLegalChar(""+Ve||"")}dtdAttDefault(Ve){return this.options.noValidation?Ve:this.assertLegalChar(""+Ve||"")}dtdEntityValue(Ve){return this.options.noValidation?Ve:this.assertLegalChar(""+Ve||"")}dtdNData(Ve){return this.options.noValidation?Ve:this.assertLegalChar(""+Ve||"")}assertLegalChar(Ve){var p,he;if(this.options.noValidation)return Ve;if("1.0"===this.options.version){if(p=/[\0-\x08\x0B\f\x0E-\x1F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/g,void 0!==this.options.invalidCharReplacement)Ve=Ve.replace(p,this.options.invalidCharReplacement);else if(he=Ve.match(p))throw new Error(`Invalid character in string: ${Ve} at index ${he.index}`)}else if("1.1"===this.options.version)if(p=/[\0\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/g,void 0!==this.options.invalidCharReplacement)Ve=Ve.replace(p,this.options.invalidCharReplacement);else if(he=Ve.match(p))throw new Error(`Invalid character in string: ${Ve} at index ${he.index}`);return Ve}assertLegalName(Ve){if(this.options.noValidation)return Ve;if(!(Ve=this.assertLegalChar(Ve)).match(/^([:A-Z_a-z\xC0-\xD6\xD8-\xF6\xF8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])([\x2D\.0-:A-Z_a-z\xB7\xC0-\xD6\xD8-\xF6\xF8-\u037D\u037F-\u1FFF\u200C\u200D\u203F\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])*$/))throw new Error(`Invalid character in name: ${Ve}`);return Ve}textEscape(Ve){return this.options.noValidation?Ve:Ve.replace(this.options.noDoubleEncoding?/(?!&(lt|gt|amp|apos|quot);)&/g:/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r/g,"&#xD;")}attEscape(Ve){return this.options.noValidation?Ve:Ve.replace(this.options.noDoubleEncoding?/(?!&(lt|gt|amp|apos|quot);)&/g:/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;")}}return ze.prototype.convertAttKey="@",ze.prototype.convertPIKey="?",ze.prototype.convertTextKey="#text",ze.prototype.convertCDataKey="#cdata",ze.prototype.convertCommentKey="#comment",ze.prototype.convertRawKey="#raw",ze}.call(this)}).call(this)},474:function(un,In,tt){(function(){var ze,je;ze=tt(269),je=tt(182),un.exports=function(){class p extends je{constructor(ft,qe){if(super(ft),null==qe)throw new Error("Missing element text. "+this.debugInfo());this.name="#text",this.type=ze.Text,this.value=this.stringify.text(qe)}clone(){return Object.create(this)}toString(ft){return this.options.writer.text(this,this.options.writer.filterOptions(ft))}splitText(ft){throw new Error("This DOM method is not implemented."+this.debugInfo())}replaceWholeText(ft){throw new Error("This DOM method is not implemented."+this.debugInfo())}}return Object.defineProperty(p.prototype,"isElementContentWhitespace",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(p.prototype,"wholeText",{get:function(){var he,ft,qe;for(qe="",ft=this.previousSibling;ft;)qe=ft.data+qe,ft=ft.previousSibling;for(qe+=this.data,he=this.nextSibling;he;)qe+=he.data,he=he.nextSibling;return qe}}),p}.call(this)}).call(this)},576:function(un,In,tt){(function(){var ze,je,Fn,Rt={}.hasOwnProperty;({assign:Fn}=tt(452)),ze=tt(269),tt(789),tt(195),tt(361),tt(516),tt(352),tt(942),tt(474),tt(666),tt(173),tt(274),tt(68),tt(349),tt(87),je=tt(316),un.exports=class{constructor(Ie){var ye,ge,oe;for(ye in Ie||(Ie={}),this.options=Ie,ge=Ie.writer||{})!Rt.call(ge,ye)||(oe=ge[ye],this["_"+ye]=this[ye],this[ye]=oe)}filterOptions(Ie){var ye,ge,oe,Ge,Be,K,Me,$e,Se;return Ie||(Ie={}),Ie=Fn({},this.options,Ie),(ye={writer:this}).pretty=Ie.pretty||!1,ye.allowEmpty=Ie.allowEmpty||!1,ye.indent=null!=(ge=Ie.indent)?ge:"  ",ye.newline=null!=(oe=Ie.newline)?oe:"\n",ye.offset=null!=(Ge=Ie.offset)?Ge:0,ye.width=null!=(Be=Ie.width)?Be:0,ye.dontPrettyTextNodes=null!=(K=null!=(Me=Ie.dontPrettyTextNodes)?Me:Ie.dontprettytextnodes)?K:0,ye.spaceBeforeSlash=null!=($e=null!=(Se=Ie.spaceBeforeSlash)?Se:Ie.spacebeforeslash)?$e:"",!0===ye.spaceBeforeSlash&&(ye.spaceBeforeSlash=" "),ye.suppressPrettyCount=0,ye.user={},ye.state=je.None,ye}indent(Ie,ye,ge){var oe;return!ye.pretty||ye.suppressPrettyCount?"":ye.pretty&&(oe=(ge||0)+ye.offset+1)>0?new Array(oe).join(ye.indent):""}endline(Ie,ye,ge){return!ye.pretty||ye.suppressPrettyCount?"":ye.newline}attribute(Ie,ye,ge){var oe;return this.openAttribute(Ie,ye,ge),oe=ye.pretty&&ye.width>0?Ie.name+'="'+Ie.value+'"':" "+Ie.name+'="'+Ie.value+'"',this.closeAttribute(Ie,ye,ge),oe}cdata(Ie,ye,ge){var oe;return this.openNode(Ie,ye,ge),ye.state=je.OpenTag,oe=this.indent(Ie,ye,ge)+"<![CDATA[",ye.state=je.InsideTag,oe+=Ie.value,ye.state=je.CloseTag,oe+="]]>"+this.endline(Ie,ye,ge),ye.state=je.None,this.closeNode(Ie,ye,ge),oe}comment(Ie,ye,ge){var oe;return this.openNode(Ie,ye,ge),ye.state=je.OpenTag,oe=this.indent(Ie,ye,ge)+"\x3c!-- ",ye.state=je.InsideTag,oe+=Ie.value,ye.state=je.CloseTag,oe+=" --\x3e"+this.endline(Ie,ye,ge),ye.state=je.None,this.closeNode(Ie,ye,ge),oe}declaration(Ie,ye,ge){var oe;return this.openNode(Ie,ye,ge),ye.state=je.OpenTag,oe=this.indent(Ie,ye,ge)+"<?xml",ye.state=je.InsideTag,oe+=' version="'+Ie.version+'"',null!=Ie.encoding&&(oe+=' encoding="'+Ie.encoding+'"'),null!=Ie.standalone&&(oe+=' standalone="'+Ie.standalone+'"'),ye.state=je.CloseTag,oe+=ye.spaceBeforeSlash+"?>",oe+=this.endline(Ie,ye,ge),ye.state=je.None,this.closeNode(Ie,ye,ge),oe}docType(Ie,ye,ge){var Ge,Be,K,Me;if(ge||(ge=0),this.openNode(Ie,ye,ge),ye.state=je.OpenTag,K=this.indent(Ie,ye,ge),K+="<!DOCTYPE "+Ie.root().name,Ie.pubID&&Ie.sysID?K+=' PUBLIC "'+Ie.pubID+'" "'+Ie.sysID+'"':Ie.sysID&&(K+=' SYSTEM "'+Ie.sysID+'"'),Ie.children.length>0){for(K+=" [",K+=this.endline(Ie,ye,ge),ye.state=je.InsideTag,Ge=0,Be=(Me=Ie.children).length;Ge<Be;Ge++)K+=this.writeChildNode(Me[Ge],ye,ge+1);ye.state=je.CloseTag,K+="]"}return ye.state=je.CloseTag,K+=ye.spaceBeforeSlash+">",K+=this.endline(Ie,ye,ge),ye.state=je.None,this.closeNode(Ie,ye,ge),K}element(Ie,ye,ge){var Be,K,Me,$e,Se,Je,lt,cn,Mt,xt,vn,xn,Rn,Wt,Er,wo,Cn;if(ge||(ge=0),xt=!1,this.openNode(Ie,ye,ge),ye.state=je.OpenTag,vn=this.indent(Ie,ye,ge)+"<"+Ie.name,ye.pretty&&ye.width>0)for(Mt in Je=vn.length,Rn=Ie.attribs)!Rt.call(Rn,Mt)||(Je+(xn=this.attribute(Rn[Mt],ye,ge)).length>ye.width?(Cn=this.indent(Ie,ye,ge+1)+xn,vn+=this.endline(Ie,ye,ge)+Cn,Je=Cn.length):(vn+=Cn=" "+xn,Je+=Cn.length));else for(Mt in Wt=Ie.attribs)!Rt.call(Wt,Mt)||(vn+=this.attribute(Wt[Mt],ye,ge));if(Me=0===(K=Ie.children.length)?null:Ie.children[0],0===K||Ie.children.every(function(bt){return(bt.type===ze.Text||bt.type===ze.Raw||bt.type===ze.CData)&&""===bt.value}))ye.allowEmpty?(vn+=">",ye.state=je.CloseTag,vn+="</"+Ie.name+">"+this.endline(Ie,ye,ge)):(ye.state=je.CloseTag,vn+=ye.spaceBeforeSlash+"/>"+this.endline(Ie,ye,ge));else if(!ye.pretty||1!==K||Me.type!==ze.Text&&Me.type!==ze.Raw&&Me.type!==ze.CData||null==Me.value){if(ye.dontPrettyTextNodes)for($e=0,lt=(Er=Ie.children).length;$e<lt;$e++)if(((Be=Er[$e]).type===ze.Text||Be.type===ze.Raw||Be.type===ze.CData)&&null!=Be.value){ye.suppressPrettyCount++,xt=!0;break}for(vn+=">"+this.endline(Ie,ye,ge),ye.state=je.InsideTag,Se=0,cn=(wo=Ie.children).length;Se<cn;Se++)vn+=this.writeChildNode(Be=wo[Se],ye,ge+1);ye.state=je.CloseTag,vn+=this.indent(Ie,ye,ge)+"</"+Ie.name+">",xt&&ye.suppressPrettyCount--,vn+=this.endline(Ie,ye,ge),ye.state=je.None}else vn+=">",ye.state=je.InsideTag,ye.suppressPrettyCount++,xt=!0,vn+=this.writeChildNode(Me,ye,ge+1),ye.suppressPrettyCount--,xt=!1,ye.state=je.CloseTag,vn+="</"+Ie.name+">"+this.endline(Ie,ye,ge);return this.closeNode(Ie,ye,ge),vn}writeChildNode(Ie,ye,ge){switch(Ie.type){case ze.CData:return this.cdata(Ie,ye,ge);case ze.Comment:return this.comment(Ie,ye,ge);case ze.Element:return this.element(Ie,ye,ge);case ze.Raw:return this.raw(Ie,ye,ge);case ze.Text:return this.text(Ie,ye,ge);case ze.ProcessingInstruction:return this.processingInstruction(Ie,ye,ge);case ze.Dummy:return"";case ze.Declaration:return this.declaration(Ie,ye,ge);case ze.DocType:return this.docType(Ie,ye,ge);case ze.AttributeDeclaration:return this.dtdAttList(Ie,ye,ge);case ze.ElementDeclaration:return this.dtdElement(Ie,ye,ge);case ze.EntityDeclaration:return this.dtdEntity(Ie,ye,ge);case ze.NotationDeclaration:return this.dtdNotation(Ie,ye,ge);default:throw new Error("Unknown XML node type: "+Ie.constructor.name)}}processingInstruction(Ie,ye,ge){var oe;return this.openNode(Ie,ye,ge),ye.state=je.OpenTag,oe=this.indent(Ie,ye,ge)+"<?",ye.state=je.InsideTag,oe+=Ie.target,Ie.value&&(oe+=" "+Ie.value),ye.state=je.CloseTag,oe+=ye.spaceBeforeSlash+"?>",oe+=this.endline(Ie,ye,ge),ye.state=je.None,this.closeNode(Ie,ye,ge),oe}raw(Ie,ye,ge){var oe;return this.openNode(Ie,ye,ge),ye.state=je.OpenTag,oe=this.indent(Ie,ye,ge),ye.state=je.InsideTag,oe+=Ie.value,ye.state=je.CloseTag,oe+=this.endline(Ie,ye,ge),ye.state=je.None,this.closeNode(Ie,ye,ge),oe}text(Ie,ye,ge){var oe;return this.openNode(Ie,ye,ge),ye.state=je.OpenTag,oe=this.indent(Ie,ye,ge),ye.state=je.InsideTag,oe+=Ie.value,ye.state=je.CloseTag,oe+=this.endline(Ie,ye,ge),ye.state=je.None,this.closeNode(Ie,ye,ge),oe}dtdAttList(Ie,ye,ge){var oe;return this.openNode(Ie,ye,ge),ye.state=je.OpenTag,oe=this.indent(Ie,ye,ge)+"<!ATTLIST",ye.state=je.InsideTag,oe+=" "+Ie.elementName+" "+Ie.attributeName+" "+Ie.attributeType,"#DEFAULT"!==Ie.defaultValueType&&(oe+=" "+Ie.defaultValueType),Ie.defaultValue&&(oe+=' "'+Ie.defaultValue+'"'),ye.state=je.CloseTag,oe+=ye.spaceBeforeSlash+">"+this.endline(Ie,ye,ge),ye.state=je.None,this.closeNode(Ie,ye,ge),oe}dtdElement(Ie,ye,ge){var oe;return this.openNode(Ie,ye,ge),ye.state=je.OpenTag,oe=this.indent(Ie,ye,ge)+"<!ELEMENT",ye.state=je.InsideTag,oe+=" "+Ie.name+" "+Ie.value,ye.state=je.CloseTag,oe+=ye.spaceBeforeSlash+">"+this.endline(Ie,ye,ge),ye.state=je.None,this.closeNode(Ie,ye,ge),oe}dtdEntity(Ie,ye,ge){var oe;return this.openNode(Ie,ye,ge),ye.state=je.OpenTag,oe=this.indent(Ie,ye,ge)+"<!ENTITY",ye.state=je.InsideTag,Ie.pe&&(oe+=" %"),oe+=" "+Ie.name,Ie.value?oe+=' "'+Ie.value+'"':(Ie.pubID&&Ie.sysID?oe+=' PUBLIC "'+Ie.pubID+'" "'+Ie.sysID+'"':Ie.sysID&&(oe+=' SYSTEM "'+Ie.sysID+'"'),Ie.nData&&(oe+=" NDATA "+Ie.nData)),ye.state=je.CloseTag,oe+=ye.spaceBeforeSlash+">"+this.endline(Ie,ye,ge),ye.state=je.None,this.closeNode(Ie,ye,ge),oe}dtdNotation(Ie,ye,ge){var oe;return this.openNode(Ie,ye,ge),ye.state=je.OpenTag,oe=this.indent(Ie,ye,ge)+"<!NOTATION",ye.state=je.InsideTag,oe+=" "+Ie.name,Ie.pubID&&Ie.sysID?oe+=' PUBLIC "'+Ie.pubID+'" "'+Ie.sysID+'"':Ie.pubID?oe+=' PUBLIC "'+Ie.pubID+'"':Ie.sysID&&(oe+=' SYSTEM "'+Ie.sysID+'"'),ye.state=je.CloseTag,oe+=ye.spaceBeforeSlash+">"+this.endline(Ie,ye,ge),ye.state=je.None,this.closeNode(Ie,ye,ge),oe}openNode(Ie,ye,ge){}closeNode(Ie,ye,ge){}openAttribute(Ie,ye,ge){}closeAttribute(Ie,ye,ge){}}}).call(this)},904:function(un,In,tt){(function(){var ze,je,Ve,p,he,ft,qe,Xe,Qe;({assign:Xe,isFunction:Qe}=tt(452)),Ve=tt(906),p=tt(519),he=tt(105),qe=tt(354),ft=tt(647),ze=tt(269),je=tt(316),un.exports.create=function(St,Ct,Ze,ut){var jt,_n;if(null==St)throw new Error("Root element needs a name.");return ut=Xe({},Ct,Ze,ut),_n=(jt=new p(ut)).element(St),ut.headless||(jt.declaration(ut),(null!=ut.pubID||null!=ut.sysID)&&jt.dtd(ut)),_n},un.exports.begin=function(St,Ct,Ze){return Qe(St)&&([Ct,Ze]=[St,Ct],St={}),Ct?new he(St,Ct,Ze):new p(St)},un.exports.stringWriter=function(St){return new qe(St)},un.exports.streamWriter=function(St,Ct){return new ft(St,Ct)},un.exports.implementation=new Ve,un.exports.nodeType=ze,un.exports.writerState=je}).call(this)},823:(un,In)=>{!function(ze){"use strict";var Ve=function(x,j){for(var fe=0;fe<j.length;fe+=1)x(j[fe],fe,j)},p=function(x,j,fe){var W=j;return Ve(function(z,L){W=x(W,z,L)},fe),W},he=function(x,j){var fe=new Array(j.length);return Ve(function(W,z){fe[z]=x(W)},j),fe};function Xe(x){return function(){return x}}function Qe(x){return x.toString()}var St=function(x,j){return j.join(x)},Ct=function(x,j,fe){return x+fe+j},Ze=Array.prototype.concat;function _n(x,j){for(var fe=Object(x),W=1;W<arguments.length;W++){var z=arguments[W];if(null!=z)for(var L in z)Object.prototype.hasOwnProperty.call(z,L)&&(fe[L]=z[L])}return fe}function He(){this.init()}function Fn(x){this.expression=x}function Rt(x,j,fe){j in x||(x[j]=fe)}function Dn(){}function Ie(x){arguments.length>0&&this.init(x)}function ye(x){arguments.length>0&&this.init(x)}function ge(x,j){arguments.length>0&&this.init(x,j)}function oe(x,j){arguments.length>0&&this.init(x,j)}function Ge(x,j){arguments.length>0&&this.init(x,j)}function Be(x,j){arguments.length>0&&this.init(x,j)}function K(x,j){arguments.length>0&&this.init(x,j)}function Me(x,j){arguments.length>0&&this.init(x,j)}function $e(x,j){arguments.length>0&&this.init(x,j)}function Se(x,j){arguments.length>0&&this.init(x,j)}function Je(x,j){arguments.length>0&&this.init(x,j)}function lt(x,j){arguments.length>0&&this.init(x,j)}function cn(x,j){arguments.length>0&&this.init(x,j)}function Mt(x,j){arguments.length>0&&this.init(x,j)}function xt(x,j){arguments.length>0&&this.init(x,j)}function vn(x,j){arguments.length>0&&this.init(x,j)}function xn(x,j){arguments.length>0&&this.init(x,j)}function Rn(x,j,fe){arguments.length>0&&this.init(x,j,fe)}function Wt(x){for(;x&&x.parentNode;)x=x.parentNode;return x}function Er(x,j,fe){return Rn.applyPredicates(x.predicates,j,Rn.applyStep(x,j,fe))}function wo(x,j,fe){return function jt(x){for(var j=[],fe=0;fe<x.length;fe+=32767){var W=x.slice(fe,fe+32767);j=Ze.apply(j,W)}return j}(he(Er.bind(null,fe,x),j))}function Cn(x,j){arguments.length>0&&this.init(x,j)}function bt(x,j,fe){arguments.length>0&&this.init(x,j,fe)}function dn(x,j){arguments.length>0&&this.init(x,j)}function $t(x){arguments.length>0&&this.init(x)}function Wi(x,j){arguments.length>0&&this.init(x,j)}(He.prototype=new Object).constructor=He,He.superclass=Object.prototype,He.prototype.init=function(){this.reduceActions=[],this.reduceActions[3]=function(x){return new oe(x[0],x[2])},this.reduceActions[5]=function(x){return new Ge(x[0],x[2])},this.reduceActions[7]=function(x){return new Be(x[0],x[2])},this.reduceActions[8]=function(x){return new K(x[0],x[2])},this.reduceActions[10]=function(x){return new Me(x[0],x[2])},this.reduceActions[11]=function(x){return new $e(x[0],x[2])},this.reduceActions[12]=function(x){return new Se(x[0],x[2])},this.reduceActions[13]=function(x){return new Je(x[0],x[2])},this.reduceActions[15]=function(x){return new lt(x[0],x[2])},this.reduceActions[16]=function(x){return new cn(x[0],x[2])},this.reduceActions[18]=function(x){return new Mt(x[0],x[2])},this.reduceActions[19]=function(x){return new xt(x[0],x[2])},this.reduceActions[20]=function(x){return new vn(x[0],x[2])},this.reduceActions[22]=function(x){return new ye(x[1])},this.reduceActions[24]=function(x){return new xn(x[0],x[2])},this.reduceActions[25]=function(x){return new Rn(void 0,void 0,x[0])},this.reduceActions[27]=function(x){return x[0].locationPath=x[2],x[0]},this.reduceActions[28]=function(x){return x[0].locationPath=x[2],x[0].locationPath.steps.unshift(new bt(bt.DESCENDANTORSELF,dn.nodeTest,[])),x[0]},this.reduceActions[29]=function(x){return new Rn(x[0],[],void 0)},this.reduceActions[30]=function(x){return hn.instance_of(x[0],Rn)?(null==x[0].filterPredicates&&(x[0].filterPredicates=[]),x[0].filterPredicates.push(x[1]),x[0]):new Rn(x[0],[x[1]],void 0)},this.reduceActions[32]=function(x){return x[1]},this.reduceActions[33]=function(x){return new Pn(x[0])},this.reduceActions[34]=function(x){return new ln(x[0])},this.reduceActions[36]=function(x){return new Wi(x[0],[])},this.reduceActions[37]=function(x){return new Wi(x[0],x[2])},this.reduceActions[38]=function(x){return[x[0]]},this.reduceActions[39]=function(x){return x[2].unshift(x[0]),x[2]},this.reduceActions[43]=function(x){return new Cn(!0,[])},this.reduceActions[44]=function(x){return x[1].absolute=!0,x[1]},this.reduceActions[46]=function(x){return new Cn(!1,[x[0]])},this.reduceActions[47]=function(x){return x[0].steps.push(x[2]),x[0]},this.reduceActions[49]=function(x){return new bt(x[0],x[1],[])},this.reduceActions[50]=function(x){return new bt(bt.CHILD,x[0],[])},this.reduceActions[51]=function(x){return new bt(x[0],x[1],x[2])},this.reduceActions[52]=function(x){return new bt(bt.CHILD,x[0],x[1])},this.reduceActions[54]=function(x){return[x[0]]},this.reduceActions[55]=function(x){return x[1].unshift(x[0]),x[1]},this.reduceActions[56]=function(x){return"ancestor"==x[0]?bt.ANCESTOR:"ancestor-or-self"==x[0]?bt.ANCESTORORSELF:"attribute"==x[0]?bt.ATTRIBUTE:"child"==x[0]?bt.CHILD:"descendant"==x[0]?bt.DESCENDANT:"descendant-or-self"==x[0]?bt.DESCENDANTORSELF:"following"==x[0]?bt.FOLLOWING:"following-sibling"==x[0]?bt.FOLLOWINGSIBLING:"namespace"==x[0]?bt.NAMESPACE:"parent"==x[0]?bt.PARENT:"preceding"==x[0]?bt.PRECEDING:"preceding-sibling"==x[0]?bt.PRECEDINGSIBLING:"self"==x[0]?bt.SELF:-1},this.reduceActions[57]=function(x){return bt.ATTRIBUTE},this.reduceActions[59]=function(x){return"comment"==x[0]?dn.commentTest:"text"==x[0]?dn.textTest:"processing-instruction"==x[0]?dn.anyPiTest:"node"==x[0]?dn.nodeTest:new dn(-1,void 0)},this.reduceActions[60]=function(x){return new dn.PITest(x[2])},this.reduceActions[61]=function(x){return x[1]},this.reduceActions[63]=function(x){return x[1].absolute=!0,x[1].steps.unshift(new bt(bt.DESCENDANTORSELF,dn.nodeTest,[])),x[1]},this.reduceActions[64]=function(x){return x[0].steps.push(new bt(bt.DESCENDANTORSELF,dn.nodeTest,[])),x[0].steps.push(x[2]),x[0]},this.reduceActions[65]=function(x){return new bt(bt.SELF,dn.nodeTest,[])},this.reduceActions[66]=function(x){return new bt(bt.PARENT,dn.nodeTest,[])},this.reduceActions[67]=function(x){return new $t(x[1])},this.reduceActions[68]=function(x){return dn.nameTestAny},this.reduceActions[69]=function(x){return new dn.NameTestPrefixAny(x[0].split(":")[0])},this.reduceActions[70]=function(x){return new dn.NameTestQName(x[0])}},He.actionTable=[" s s        sssssssss    s ss  s  ss","                 s                  ","r  rrrrrrrrr         rrrrrrr rr  r  ","                rrrrr               "," s s        sssssssss    s ss  s  ss","rs  rrrrrrrr s  sssssrrrrrr  rrs rs "," s s        sssssssss    s ss  s  ss","                            s       ","                            s       ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","  s                                 ","                            s       "," s           s  sssss          s  s ","r  rrrrrrrrr         rrrrrrr rr  r  ","a                                   ","r       s                    rr  r  ","r      sr                    rr  r  ","r   s  rr            s       rr  r  ","r   rssrr            rss     rr  r  ","r   rrrrr            rrrss   rr  r  ","r   rrrrrsss         rrrrr   rr  r  ","r   rrrrrrrr         rrrrr   rr  r  ","r   rrrrrrrr         rrrrrs  rr  r  ","r   rrrrrrrr         rrrrrr  rr  r  ","r   rrrrrrrr         rrrrrr  rr  r  ","r  srrrrrrrr         rrrrrrs rr sr  ","r  srrrrrrrr         rrrrrrs rr  r  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r   rrrrrrrr         rrrrrr  rr  r  ","r   rrrrrrrr         rrrrrr  rr  r  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr  r  ","                sssss               ","r  rrrrrrrrr         rrrrrrr rr sr  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","                             s      ","r  srrrrrrrr         rrrrrrs rr  r  ","r   rrrrrrrr         rrrrr   rr  r  ","              s                     ","                             s      ","                rrrrr               "," s s        sssssssss    s sss s  ss","r  srrrrrrrr         rrrrrrs rr  r  "," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss      ss  s  ss"," s s        sssssssss    s ss  s  ss"," s           s  sssss          s  s "," s           s  sssss          s  s ","r  rrrrrrrrr         rrrrrrr rr rr  "," s           s  sssss          s  s "," s           s  sssss          s  s ","r  rrrrrrrrr         rrrrrrr rr sr  ","r  rrrrrrrrr         rrrrrrr rr sr  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr rr  ","                             s      ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","                             rr     ","                             s      ","                             rs     ","r      sr                    rr  r  ","r   s  rr            s       rr  r  ","r   rssrr            rss     rr  r  ","r   rssrr            rss     rr  r  ","r   rrrrr            rrrss   rr  r  ","r   rrrrr            rrrss   rr  r  ","r   rrrrr            rrrss   rr  r  ","r   rrrrr            rrrss   rr  r  ","r   rrrrrsss         rrrrr   rr  r  ","r   rrrrrsss         rrrrr   rr  r  ","r   rrrrrrrr         rrrrr   rr  r  ","r   rrrrrrrr         rrrrr   rr  r  ","r   rrrrrrrr         rrrrr   rr  r  ","r   rrrrrrrr         rrrrrr  rr  r  ","                                 r  ","                                 s  ","r  srrrrrrrr         rrrrrrs rr  r  ","r  srrrrrrrr         rrrrrrs rr  r  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  "," s s        sssssssss    s ss  s  ss","r  rrrrrrrrr         rrrrrrr rr rr  ","                             r      "],He.actionTableNumber=[" 1 0        /.-,+*)('    & %$  #  \"!","                 J                  ","a  aaaaaaaaa         aaaaaaa aa  a  ","                YYYYY               "," 1 0        /.-,+*)('    & %$  #  \"!","K1  KKKKKKKK .  +*)('KKKKKK  KK# K\" "," 1 0        /.-,+*)('    & %$  #  \"!","                            N       ","                            O       ","e  eeeeeeeee         eeeeeee ee ee  ","f  fffffffff         fffffff ff ff  ","d  ddddddddd         ddddddd dd dd  ","B  BBBBBBBBB         BBBBBBB BB BB  ","A  AAAAAAAAA         AAAAAAA AA AA  ","  P                                 ","                            Q       "," 1           .  +*)('          #  \" ","b  bbbbbbbbb         bbbbbbb bb  b  ","                                    ","!       S                    !!  !  ",'"      T"                    ""  "  ',"$   V  $$            U       $$  $  ","&   &ZY&&            &XW     &&  &  ",")   )))))            )))\\[   ))  )  ",".   ....._^]         .....   ..  .  ","1   11111111         11111   11  1  ","5   55555555         55555`  55  5  ","7   77777777         777777  77  7  ","9   99999999         999999  99  9  ",":  c::::::::         ::::::b :: a:  ","I  fIIIIIIII         IIIIIIe II  I  ","=  =========         ======= == ==  ","?  ?????????         ??????? ?? ??  ","C  CCCCCCCCC         CCCCCCC CC CC  ","J   JJJJJJJJ         JJJJJJ  JJ  J  ","M   MMMMMMMM         MMMMMM  MM  M  ","N  NNNNNNNNN         NNNNNNN NN  N  ","P  PPPPPPPPP         PPPPPPP PP  P  ","                +*)('               ","R  RRRRRRRRR         RRRRRRR RR aR  ","U  UUUUUUUUU         UUUUUUU UU  U  ","Z  ZZZZZZZZZ         ZZZZZZZ ZZ ZZ  ","c  ccccccccc         ccccccc cc cc  ","                             j      ","L  fLLLLLLLL         LLLLLLe LL  L  ","6   66666666         66666   66  6  ","              k                     ","                             l      ","                XXXXX               "," 1 0        /.-,+*)('    & %$m #  \"!","_  f________         ______e __  _  "," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('      %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1           .  +*)('          #  \" "," 1           .  +*)('          #  \" ",">  >>>>>>>>>         >>>>>>> >> >>  "," 1           .  +*)('          #  \" "," 1           .  +*)('          #  \" ","Q  QQQQQQQQQ         QQQQQQQ QQ aQ  ","V  VVVVVVVVV         VVVVVVV VV aV  ","T  TTTTTTTTT         TTTTTTT TT  T  ","@  @@@@@@@@@         @@@@@@@ @@ @@  ","                             \x87      ","[  [[[[[[[[[         [[[[[[[ [[ [[  ","D  DDDDDDDDD         DDDDDDD DD DD  ","                             HH     ","                             \x88      ","                             F\x89     ","#      T#                    ##  #  ","%   V  %%            U       %%  %  ","'   'ZY''            'XW     ''  '  ","(   (ZY((            (XW     ((  (  ","+   +++++            +++\\[   ++  +  ","*   *****            ***\\[   **  *  ","-   -----            ---\\[   --  -  ",",   ,,,,,            ,,,\\[   ,,  ,  ","0   00000_^]         00000   00  0  ","/   /////_^]         /////   //  /  ","2   22222222         22222   22  2  ","3   33333333         33333   33  3  ","4   44444444         44444   44  4  ","8   88888888         888888  88  8  ","                                 ^  ","                                 \x8a  ",";  f;;;;;;;;         ;;;;;;e ;;  ;  ","<  f<<<<<<<<         <<<<<<e <<  <  ","O  OOOOOOOOO         OOOOOOO OO  O  ","`  `````````         ``````` ``  `  ","S  SSSSSSSSS         SSSSSSS SS  S  ","W  WWWWWWWWW         WWWWWWW WW  W  ","\\  \\\\\\\\\\\\\\\\\\         \\\\\\\\\\\\\\ \\\\ \\\\  ","E  EEEEEEEEE         EEEEEEE EE EE  "," 1 0        /.-,+*)('    & %$  #  \"!","]  ]]]]]]]]]         ]]]]]]] ]] ]]  ","                             G      "],He.gotoTable=["3456789:;<=>?@ AB  CDEFGH IJ ","                             ","                             ","                             ","L456789:;<=>?@ AB  CDEFGH IJ ","            M        EFGH IJ ","       N;<=>?@ AB  CDEFGH IJ ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","            S        EFGH IJ ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","              e              ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                        h  J ","              i          j   ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","o456789:;<=>?@ ABpqCDEFGH IJ ","                             ","  r6789:;<=>?@ AB  CDEFGH IJ ","   s789:;<=>?@ AB  CDEFGH IJ ","    t89:;<=>?@ AB  CDEFGH IJ ","    u89:;<=>?@ AB  CDEFGH IJ ","     v9:;<=>?@ AB  CDEFGH IJ ","     w9:;<=>?@ AB  CDEFGH IJ ","     x9:;<=>?@ AB  CDEFGH IJ ","     y9:;<=>?@ AB  CDEFGH IJ ","      z:;<=>?@ AB  CDEFGH IJ ","      {:;<=>?@ AB  CDEFGH IJ ","       |;<=>?@ AB  CDEFGH IJ ","       };<=>?@ AB  CDEFGH IJ ","       ~;<=>?@ AB  CDEFGH IJ ","         \x7f=>?@ AB  CDEFGH IJ ","\x80456789:;<=>?@ AB  CDEFGH IJ\x81","            \x82        EFGH IJ ","            \x83        EFGH IJ ","                             ","                     \x84 GH IJ ","                     \x85 GH IJ ","              i          \x86   ","              i          \x87   ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","o456789:;<=>?@ AB\x8cqCDEFGH IJ ","                             ","                             "],He.productions=[[1,1,2],[2,1,3],[3,1,4],[3,3,3,-9,4],[4,1,5],[4,3,4,-8,5],[5,1,6],[5,3,5,-22,6],[5,3,5,-5,6],[6,1,7],[6,3,6,-23,7],[6,3,6,-24,7],[6,3,6,-6,7],[6,3,6,-7,7],[7,1,8],[7,3,7,-25,8],[7,3,7,-26,8],[8,1,9],[8,3,8,-12,9],[8,3,8,-11,9],[8,3,8,-10,9],[9,1,10],[9,2,-26,9],[10,1,11],[10,3,10,-27,11],[11,1,12],[11,1,13],[11,3,13,-28,14],[11,3,13,-4,14],[13,1,15],[13,2,13,16],[15,1,17],[15,3,-29,2,-30],[15,1,-15],[15,1,-16],[15,1,18],[18,3,-13,-29,-30],[18,4,-13,-29,19,-30],[19,1,20],[19,3,20,-31,19],[20,1,2],[12,1,14],[12,1,21],[21,1,-28],[21,2,-28,14],[21,1,22],[14,1,23],[14,3,14,-28,23],[14,1,24],[23,2,25,26],[23,1,26],[23,3,25,26,27],[23,2,26,27],[23,1,28],[27,1,16],[27,2,16,27],[25,2,-14,-3],[25,1,-32],[26,1,29],[26,3,-20,-29,-30],[26,4,-21,-29,-15,-30],[16,3,-33,30,-34],[30,1,2],[22,2,-4,14],[24,3,14,-4,23],[28,1,-35],[28,1,-2],[17,2,-36,-18],[29,1,-17],[29,1,-19],[29,1,-18]],He.DOUBLEDOT=2,He.DOUBLECOLON=3,He.DOUBLESLASH=4,He.NOTEQUAL=5,He.LESSTHANOREQUAL=6,He.GREATERTHANOREQUAL=7,He.AND=8,He.OR=9,He.MOD=10,He.DIV=11,He.MULTIPLYOPERATOR=12,He.FUNCTIONNAME=13,He.AXISNAME=14,He.LITERAL=15,He.NUMBER=16,He.ASTERISKNAMETEST=17,He.QNAME=18,He.NCNAMECOLONASTERISK=19,He.NODETYPE=20,He.PROCESSINGINSTRUCTIONWITHLITERAL=21,He.EQUALS=22,He.LESSTHAN=23,He.GREATERTHAN=24,He.PLUS=25,He.MINUS=26,He.BAR=27,He.SLASH=28,He.LEFTPARENTHESIS=29,He.RIGHTPARENTHESIS=30,He.COMMA=31,He.AT=32,He.LEFTBRACKET=33,He.RIGHTBRACKET=34,He.DOT=35,He.DOLLAR=36,He.prototype.tokenize=function(x){for(var j=[],fe=[],W=x+"\0",z=0,L=W.charAt(z++);;){for(;" "==L||"\t"==L||"\r"==L||"\n"==L;)L=W.charAt(z++);if("\0"==L||z>=W.length)break;if("("!=L)if(")"!=L)if("["!=L)if("]"!=L)if("@"!=L)if(","!=L)if("|"!=L)if("+"!=L)if("-"!=L)if("="!=L)if("$"!=L)if("."!=L)if("'"!=L&&'"'!=L)if(L>="0"&&L<="9"){for(ne=L,L=W.charAt(z++);L>="0"&&L<="9";)ne+=L,L=W.charAt(z++);if("."==L&&W.charAt(z)>="0"&&W.charAt(z)<="9")for(ne+=L,ne+=W.charAt(z++),L=W.charAt(z++);L>="0"&&L<="9";)ne+=L,L=W.charAt(z++);j.push(He.NUMBER),fe.push(ne)}else if("*"!=L)if(":"!=L||":"!=W.charAt(z))if("/"!=L)if("!"!=L||"="!=W.charAt(z))if("<"!=L)if(">"!=L){if("_"!=L&&!hn.isLetter(L.charCodeAt(0)))throw new Error("Unexpected character "+L);var Ne=L;for(L=W.charAt(z++);hn.isNCNameChar(L.charCodeAt(0));)Ne+=L,L=W.charAt(z++);if(j.length>0&&(Ee=j[j.length-1])!=He.AT&&Ee!=He.DOUBLECOLON&&Ee!=He.LEFTPARENTHESIS&&Ee!=He.LEFTBRACKET&&Ee!=He.AND&&Ee!=He.OR&&Ee!=He.MOD&&Ee!=He.DIV&&Ee!=He.MULTIPLYOPERATOR&&Ee!=He.SLASH&&Ee!=He.DOUBLESLASH&&Ee!=He.BAR&&Ee!=He.PLUS&&Ee!=He.MINUS&&Ee!=He.EQUALS&&Ee!=He.NOTEQUAL&&Ee!=He.LESSTHAN&&Ee!=He.LESSTHANOREQUAL&&Ee!=He.GREATERTHAN&&Ee!=He.GREATERTHANOREQUAL){if("and"==Ne){j.push(He.AND),fe.push(Ne);continue}if("or"==Ne){j.push(He.OR),fe.push(Ne);continue}if("mod"==Ne){j.push(He.MOD),fe.push(Ne);continue}if("div"==Ne){j.push(He.DIV),fe.push(Ne);continue}}if(":"==L){if("*"==W.charAt(z)){j.push(He.NCNAMECOLONASTERISK),fe.push(Ne+":*"),z++,L=W.charAt(z++);continue}if("_"==W.charAt(z)||hn.isLetter(W.charCodeAt(z))){for(Ne+=":",L=W.charAt(z++);hn.isNCNameChar(L.charCodeAt(0));)Ne+=L,L=W.charAt(z++);if("("==L){j.push(He.FUNCTIONNAME),fe.push(Ne);continue}j.push(He.QNAME),fe.push(Ne);continue}if(":"==W.charAt(z)){j.push(He.AXISNAME),fe.push(Ne);continue}}if("("==L){if("comment"==Ne||"text"==Ne||"node"==Ne){j.push(He.NODETYPE),fe.push(Ne);continue}if("processing-instruction"==Ne){")"==W.charAt(z)?j.push(He.NODETYPE):j.push(He.PROCESSINGINSTRUCTIONWITHLITERAL),fe.push(Ne);continue}j.push(He.FUNCTIONNAME),fe.push(Ne);continue}j.push(He.QNAME),fe.push(Ne)}else{if("="==W.charAt(z)){j.push(He.GREATERTHANOREQUAL),fe.push(">="),z++,L=W.charAt(z++);continue}j.push(He.GREATERTHAN),fe.push(">"),L=W.charAt(z++)}else{if("="==W.charAt(z)){j.push(He.LESSTHANOREQUAL),fe.push("<="),z++,L=W.charAt(z++);continue}j.push(He.LESSTHAN),fe.push("<"),L=W.charAt(z++)}else j.push(He.NOTEQUAL),fe.push("!="),z++,L=W.charAt(z++);else{if("/"==(L=W.charAt(z++))){j.push(He.DOUBLESLASH),fe.push("//"),L=W.charAt(z++);continue}j.push(He.SLASH),fe.push("/")}else j.push(He.DOUBLECOLON),fe.push("::"),z++,L=W.charAt(z++);else{var Ee;if(j.length>0&&(Ee=j[j.length-1])!=He.AT&&Ee!=He.DOUBLECOLON&&Ee!=He.LEFTPARENTHESIS&&Ee!=He.LEFTBRACKET&&Ee!=He.AND&&Ee!=He.OR&&Ee!=He.MOD&&Ee!=He.DIV&&Ee!=He.MULTIPLYOPERATOR&&Ee!=He.SLASH&&Ee!=He.DOUBLESLASH&&Ee!=He.BAR&&Ee!=He.PLUS&&Ee!=He.MINUS&&Ee!=He.EQUALS&&Ee!=He.NOTEQUAL&&Ee!=He.LESSTHAN&&Ee!=He.LESSTHANOREQUAL&&Ee!=He.GREATERTHAN&&Ee!=He.GREATERTHANOREQUAL){j.push(He.MULTIPLYOPERATOR),fe.push(L),L=W.charAt(z++);continue}j.push(He.ASTERISKNAMETEST),fe.push(L),L=W.charAt(z++)}else{for(var _e=L,Te="";z<W.length&&(L=W.charAt(z))!==_e;)Te+=L,z+=1;if(L!==_e)throw Ro.fromMessage("Unterminated string literal: "+_e+Te);z+=1,j.push(He.LITERAL),fe.push(Te),L=W.charAt(z++)}else{if("."==(L=W.charAt(z++))){j.push(He.DOUBLEDOT),fe.push(".."),L=W.charAt(z++);continue}if(L>="0"&&L<="9"){var ne="."+L;for(L=W.charAt(z++);L>="0"&&L<="9";)ne+=L,L=W.charAt(z++);j.push(He.NUMBER),fe.push(ne);continue}j.push(He.DOT),fe.push(".")}else j.push(He.DOLLAR),fe.push(L),L=W.charAt(z++);else j.push(He.EQUALS),fe.push(L),L=W.charAt(z++);else j.push(He.MINUS),fe.push(L),L=W.charAt(z++);else j.push(He.PLUS),fe.push(L),L=W.charAt(z++);else j.push(He.BAR),fe.push(L),L=W.charAt(z++);else j.push(He.COMMA),fe.push(L),L=W.charAt(z++);else j.push(He.AT),fe.push(L),L=W.charAt(z++);else j.push(He.RIGHTBRACKET),fe.push(L),L=W.charAt(z++);else j.push(He.LEFTBRACKET),fe.push(L),L=W.charAt(z++);else j.push(He.RIGHTPARENTHESIS),fe.push(L),L=W.charAt(z++);else j.push(He.LEFTPARENTHESIS),fe.push(L),L=W.charAt(z++)}return j.push(1),fe.push("[EOF]"),[j,fe]},He.SHIFT="s",He.REDUCE="r",He.ACCEPT="a",He.prototype.parse=function(Te){var j,fe,W=this.tokenize(Te);if(null!=W){j=W[0],fe=W[1];var Ee,Ne,z=0,L=[],ne=[],_e=[];for(L.push(0),ne.push(1),_e.push("_S"),Ee=j[z],Ne=fe[z++];;)switch(Te=L[L.length-1],He.actionTable[Te].charAt(Ee-1)){case He.SHIFT:ne.push(-Ee),_e.push(Ne),L.push(He.actionTableNumber[Te].charCodeAt(Ee-1)-32),Ee=j[z],Ne=fe[z++];break;case He.REDUCE:for(var Re=He.productions[He.actionTableNumber[Te].charCodeAt(Ee-1)-32][1],nt=[],vt=0;vt<Re;vt++)ne.pop(),nt.unshift(_e.pop()),L.pop();var Xt=L[L.length-1];ne.push(He.productions[He.actionTableNumber[Te].charCodeAt(Ee-1)-32][0]),null==this.reduceActions[He.actionTableNumber[Te].charCodeAt(Ee-1)-32]?_e.push(nt[0]):_e.push(this.reduceActions[He.actionTableNumber[Te].charCodeAt(Ee-1)-32](nt)),L.push(He.gotoTable[Xt].charCodeAt(He.productions[He.actionTableNumber[Te].charCodeAt(Ee-1)-32][0]-2)-33);break;case He.ACCEPT:return new Fn(_e.pop());default:throw new Error("XPath parse error")}}},(Fn.prototype=new Object).constructor=Fn,Fn.superclass=Object.prototype,Fn.prototype.toString=function(){return this.expression.toString()},Fn.prototype.evaluate=function(x){return x.contextNode=x.expressionContextNode,x.contextSize=1,x.contextPosition=1,x.isHtml&&(Rt(x,"caseInsensitive",!0),Rt(x,"allowAnyNamespaceForNoPrefix",!0)),Rt(x,"caseInsensitive",!1),this.expression.evaluate(x)},Fn.XML_NAMESPACE_URI="http://www.w3.org/XML/1998/namespace",Fn.XMLNS_NAMESPACE_URI="http://www.w3.org/2000/xmlns/",(Dn.prototype=new Object).constructor=Dn,Dn.superclass=Object.prototype,Dn.prototype.init=function(){},Dn.prototype.toString=function(){return"<Expression>"},Dn.prototype.evaluate=function(x){throw new Error("Could not evaluate expression.")},(Ie.prototype=new Dn).constructor=Ie,Ie.superclass=Dn.prototype,Ie.prototype.init=function(x){this.rhs=x},(ye.prototype=new Ie).constructor=ye,ye.superclass=Ie.prototype,ye.prototype.init=function(x){ye.superclass.init.call(this,x)},ye.prototype.evaluate=function(x){return this.rhs.evaluate(x).number().negate()},ye.prototype.toString=function(){return"-"+this.rhs.toString()},(ge.prototype=new Dn).constructor=ge,ge.superclass=Dn.prototype,ge.prototype.init=function(x,j){this.lhs=x,this.rhs=j},(oe.prototype=new ge).constructor=oe,oe.superclass=ge.prototype,oe.prototype.init=function(x,j){oe.superclass.init.call(this,x,j)},oe.prototype.toString=function(){return"("+this.lhs.toString()+" or "+this.rhs.toString()+")"},oe.prototype.evaluate=function(x){var j=this.lhs.evaluate(x).bool();return j.booleanValue()?j:this.rhs.evaluate(x).bool()},(Ge.prototype=new ge).constructor=Ge,Ge.superclass=ge.prototype,Ge.prototype.init=function(x,j){Ge.superclass.init.call(this,x,j)},Ge.prototype.toString=function(){return"("+this.lhs.toString()+" and "+this.rhs.toString()+")"},Ge.prototype.evaluate=function(x){var j=this.lhs.evaluate(x).bool();return j.booleanValue()?this.rhs.evaluate(x).bool():j},(Be.prototype=new ge).constructor=Be,Be.superclass=ge.prototype,Be.prototype.init=function(x,j){Be.superclass.init.call(this,x,j)},Be.prototype.toString=function(){return"("+this.lhs.toString()+" = "+this.rhs.toString()+")"},Be.prototype.evaluate=function(x){return this.lhs.evaluate(x).equals(this.rhs.evaluate(x))},(K.prototype=new ge).constructor=K,K.superclass=ge.prototype,K.prototype.init=function(x,j){K.superclass.init.call(this,x,j)},K.prototype.toString=function(){return"("+this.lhs.toString()+" != "+this.rhs.toString()+")"},K.prototype.evaluate=function(x){return this.lhs.evaluate(x).notequal(this.rhs.evaluate(x))},(Me.prototype=new ge).constructor=Me,Me.superclass=ge.prototype,Me.prototype.init=function(x,j){Me.superclass.init.call(this,x,j)},Me.prototype.evaluate=function(x){return this.lhs.evaluate(x).lessthan(this.rhs.evaluate(x))},Me.prototype.toString=function(){return"("+this.lhs.toString()+" < "+this.rhs.toString()+")"},($e.prototype=new ge).constructor=$e,$e.superclass=ge.prototype,$e.prototype.init=function(x,j){$e.superclass.init.call(this,x,j)},$e.prototype.evaluate=function(x){return this.lhs.evaluate(x).greaterthan(this.rhs.evaluate(x))},$e.prototype.toString=function(){return"("+this.lhs.toString()+" > "+this.rhs.toString()+")"},(Se.prototype=new ge).constructor=Se,Se.superclass=ge.prototype,Se.prototype.init=function(x,j){Se.superclass.init.call(this,x,j)},Se.prototype.evaluate=function(x){return this.lhs.evaluate(x).lessthanorequal(this.rhs.evaluate(x))},Se.prototype.toString=function(){return"("+this.lhs.toString()+" <= "+this.rhs.toString()+")"},(Je.prototype=new ge).constructor=Je,Je.superclass=ge.prototype,Je.prototype.init=function(x,j){Je.superclass.init.call(this,x,j)},Je.prototype.evaluate=function(x){return this.lhs.evaluate(x).greaterthanorequal(this.rhs.evaluate(x))},Je.prototype.toString=function(){return"("+this.lhs.toString()+" >= "+this.rhs.toString()+")"},(lt.prototype=new ge).constructor=lt,lt.superclass=ge.prototype,lt.prototype.init=function(x,j){lt.superclass.init.call(this,x,j)},lt.prototype.evaluate=function(x){return this.lhs.evaluate(x).number().plus(this.rhs.evaluate(x).number())},lt.prototype.toString=function(){return"("+this.lhs.toString()+" + "+this.rhs.toString()+")"},(cn.prototype=new ge).constructor=cn,cn.superclass=ge.prototype,cn.prototype.init=function(x,j){cn.superclass.init.call(this,x,j)},cn.prototype.evaluate=function(x){return this.lhs.evaluate(x).number().minus(this.rhs.evaluate(x).number())},cn.prototype.toString=function(){return"("+this.lhs.toString()+" - "+this.rhs.toString()+")"},(Mt.prototype=new ge).constructor=Mt,Mt.superclass=ge.prototype,Mt.prototype.init=function(x,j){Mt.superclass.init.call(this,x,j)},Mt.prototype.evaluate=function(x){return this.lhs.evaluate(x).number().multiply(this.rhs.evaluate(x).number())},Mt.prototype.toString=function(){return"("+this.lhs.toString()+" * "+this.rhs.toString()+")"},(xt.prototype=new ge).constructor=xt,xt.superclass=ge.prototype,xt.prototype.init=function(x,j){xt.superclass.init.call(this,x,j)},xt.prototype.evaluate=function(x){return this.lhs.evaluate(x).number().div(this.rhs.evaluate(x).number())},xt.prototype.toString=function(){return"("+this.lhs.toString()+" div "+this.rhs.toString()+")"},(vn.prototype=new ge).constructor=vn,vn.superclass=ge.prototype,vn.prototype.init=function(x,j){vn.superclass.init.call(this,x,j)},vn.prototype.evaluate=function(x){return this.lhs.evaluate(x).number().mod(this.rhs.evaluate(x).number())},vn.prototype.toString=function(){return"("+this.lhs.toString()+" mod "+this.rhs.toString()+")"},(xn.prototype=new ge).constructor=xn,xn.superclass=ge.prototype,xn.prototype.init=function(x,j){xn.superclass.init.call(this,x,j)},xn.prototype.evaluate=function(x){return this.lhs.evaluate(x).nodeset().union(this.rhs.evaluate(x).nodeset())},xn.prototype.toString=function(){return he(Qe,[this.lhs,this.rhs]).join(" | ")},(Rn.prototype=new Dn).constructor=Rn,Rn.superclass=Dn.prototype,Rn.prototype.init=function(x,j,fe){Rn.superclass.init.call(this),this.filter=x,this.filterPredicates=j,this.locationPath=fe},Rn.applyPredicates=function(x,j,fe){if(0===x.length)return fe;var W=j.extend({});return p(function(z,L){return W.contextSize=z.length,function(x,j){var fe=[];return Ve(function(W,z){x(W,z)&&fe.push(W)},j),fe}(function(ne,_e){return W.contextNode=ne,W.contextPosition=_e+1,Rn.predicateMatches(L,W)},z)},fe,x)},Rn.getRoot=function(x,j){var fe=j[0];if(9===fe.nodeType)return fe;if(x.virtualRoot)return x.virtualRoot;var W=fe.ownerDocument;if(W)return W;for(var z=fe;null!=z.parentNode;)z=z.parentNode;return z},Rn.applyStep=function(x,j,fe){var z=[];switch(j.contextNode=fe,x.axis){case bt.ANCESTOR:if(j.contextNode===j.virtualRoot)break;for(L=2==j.contextNode.nodeType?Rn.getOwnerElement(j.contextNode):j.contextNode.parentNode;null!=L&&(x.nodeTest.matches(L,j)&&z.push(L),L!==j.virtualRoot);)L=L.parentNode;break;case bt.ANCESTORORSELF:for(var L=j.contextNode;null!=L&&(x.nodeTest.matches(L,j)&&z.push(L),L!==j.virtualRoot);L=2==L.nodeType?Rn.getOwnerElement(L):L.parentNode);break;case bt.ATTRIBUTE:var ne=j.contextNode.attributes;if(null!=ne)for(var _e=0;_e<ne.length;_e++)L=ne.item(_e),x.nodeTest.matches(L,j)&&z.push(L);break;case bt.CHILD:for(L=j.contextNode.firstChild;null!=L;L=L.nextSibling)x.nodeTest.matches(L,j)&&z.push(L);break;case bt.DESCENDANT:for(var vt=[j.contextNode.firstChild];vt.length>0;)for(L=vt.pop();null!=L;)x.nodeTest.matches(L,j)&&z.push(L),null!=L.firstChild?(vt.push(L.nextSibling),L=L.firstChild):L=L.nextSibling;break;case bt.DESCENDANTORSELF:for(x.nodeTest.matches(j.contextNode,j)&&z.push(j.contextNode),vt=[j.contextNode.firstChild];vt.length>0;)for(L=vt.pop();null!=L;)x.nodeTest.matches(L,j)&&z.push(L),null!=L.firstChild?(vt.push(L.nextSibling),L=L.firstChild):L=L.nextSibling;break;case bt.FOLLOWING:if(j.contextNode===j.virtualRoot)break;for((vt=[]).unshift(null!=j.contextNode.firstChild?j.contextNode.firstChild:j.contextNode.nextSibling),L=j.contextNode.parentNode;null!=L&&9!=L.nodeType&&L!==j.virtualRoot;L=L.parentNode)vt.unshift(L.nextSibling);do{for(L=vt.pop();null!=L;)x.nodeTest.matches(L,j)&&z.push(L),null!=L.firstChild?(vt.push(L.nextSibling),L=L.firstChild):L=L.nextSibling}while(vt.length>0);break;case bt.FOLLOWINGSIBLING:if(j.contextNode===j.virtualRoot)break;for(L=j.contextNode.nextSibling;null!=L;L=L.nextSibling)x.nodeTest.matches(L,j)&&z.push(L);break;case bt.NAMESPACE:var Te={};if(1==j.contextNode.nodeType){for(Te.xml=Fn.XML_NAMESPACE_URI,Te.xmlns=Fn.XMLNS_NAMESPACE_URI,L=j.contextNode;null!=L&&1==L.nodeType;L=L.parentNode)for(_e=0;_e<L.attributes.length;_e++){var Ee=L.attributes.item(_e),Ne=String(Ee.name);"xmlns"==Ne?null==Te[""]&&(Te[""]=Ee.value):Ne.length>6&&"xmlns:"==Ne.substring(0,6)&&null==Te[Re=Ne.substring(6,Ne.length)]&&(Te[Re]=Ee.value)}for(var Re in Te){var nt=new ko(Re,Te[Re],j.contextNode);x.nodeTest.matches(nt,j)&&z.push(nt)}}break;case bt.PARENT:L=null,j.contextNode!==j.virtualRoot&&(L=2==j.contextNode.nodeType?Rn.getOwnerElement(j.contextNode):j.contextNode.parentNode),null!=L&&x.nodeTest.matches(L,j)&&z.push(L);break;case bt.PRECEDING:vt=null!=j.virtualRoot?[j.virtualRoot]:[Wt(j.contextNode)];e:for(;vt.length>0;)for(L=vt.pop();null!=L;){if(L==j.contextNode)break e;x.nodeTest.matches(L,j)&&z.unshift(L),null!=L.firstChild?(vt.push(L.nextSibling),L=L.firstChild):L=L.nextSibling}break;case bt.PRECEDINGSIBLING:if(j.contextNode===j.virtualRoot)break;for(L=j.contextNode.previousSibling;null!=L;L=L.previousSibling)x.nodeTest.matches(L,j)&&z.push(L);break;case bt.SELF:x.nodeTest.matches(j.contextNode,j)&&z.push(j.contextNode)}return z},Rn.applySteps=function(x,j,fe){return p(wo.bind(null,j),fe,x)},Rn.prototype.applyFilter=function(x,j){if(!this.filter)return{nodes:[x.contextNode]};var fe=this.filter.evaluate(x);if(!hn.instance_of(fe,Tn)){if(null!=this.filterPredicates&&this.filterPredicates.length>0||null!=this.locationPath)throw new Error("Path expression filter must evaluate to a nodeset if predicates or location path are used");return{nonNodes:fe}}return{nodes:Rn.applyPredicates(this.filterPredicates||[],j,fe.toUnsortedArray())}},Rn.applyLocationPath=function(x,j,fe){if(!x)return fe;var W=x.absolute?[Rn.getRoot(j,fe)]:fe;return Rn.applySteps(x.steps,j,W)},Rn.prototype.evaluate=function(x){var j=_n(new Ur,x),fe=this.applyFilter(x,j);if("nonNodes"in fe)return fe.nonNodes;var W=new Tn;return W.addArray(Rn.applyLocationPath(this.locationPath,j,fe.nodes)),W},Rn.predicateMatches=function(x,j){var fe=x.evaluate(j);return hn.instance_of(fe,ln)?j.contextPosition===fe.numberValue():fe.booleanValue()},Rn.predicateString=function(x){return Ct("[","]",x.toString())},Rn.predicatesString=function(x){return St("",he(Rn.predicateString,x))},Rn.prototype.toString=function(){if(null!=this.filter){var x=Qe(this.filter);return hn.instance_of(this.filter,Pn)?Ct("'","'",x):null!=this.filterPredicates&&this.filterPredicates.length?Ct("(",")",x)+Rn.predicatesString(this.filterPredicates):null!=this.locationPath?x+(this.locationPath.absolute?"":"/")+Qe(this.locationPath):x}return Qe(this.locationPath)},Rn.getOwnerElement=function(x){if(x.ownerElement)return x.ownerElement;try{if(x.selectSingleNode)return x.selectSingleNode("..")}catch(Te){}for(var fe=(9==x.nodeType?x:x.ownerDocument).getElementsByTagName("*"),W=0;W<fe.length;W++)for(var z=fe.item(W),L=z.attributes,ne=0;ne<L.length;ne++)if(L.item(ne)===x)return z;return null},(Cn.prototype=new Object).constructor=Cn,Cn.superclass=Object.prototype,Cn.prototype.init=function(x,j){this.absolute=x,this.steps=j},Cn.prototype.toString=function(){return(this.absolute?"/":"")+he(Qe,this.steps).join("/")},(bt.prototype=new Object).constructor=bt,bt.superclass=Object.prototype,bt.prototype.init=function(x,j,fe){this.axis=x,this.nodeTest=j,this.predicates=fe},bt.prototype.toString=function(){return bt.STEPNAMES[this.axis]+"::"+this.nodeTest.toString()+Rn.predicatesString(this.predicates)},bt.STEPNAMES=p(function(x,j){return x[j[0]]=j[1],x},{},[[bt.ANCESTOR=0,"ancestor"],[bt.ANCESTORORSELF=1,"ancestor-or-self"],[bt.ATTRIBUTE=2,"attribute"],[bt.CHILD=3,"child"],[bt.DESCENDANT=4,"descendant"],[bt.DESCENDANTORSELF=5,"descendant-or-self"],[bt.FOLLOWING=6,"following"],[bt.FOLLOWINGSIBLING=7,"following-sibling"],[bt.NAMESPACE=8,"namespace"],[bt.PARENT=9,"parent"],[bt.PRECEDING=10,"preceding"],[bt.PRECEDINGSIBLING=11,"preceding-sibling"],[bt.SELF=12,"self"]]),(dn.prototype=new Object).constructor=dn,dn.superclass=Object.prototype,dn.prototype.init=function(x,j){this.type=x,this.value=j},dn.prototype.toString=function(){return"<unknown nodetest type>"},dn.prototype.matches=function(x,j){console.warn("unknown node test type")},dn.NAMETESTANY=0,dn.NAMETESTPREFIXANY=1,dn.NAMETESTQNAME=2,dn.COMMENT=3,dn.TEXT=4,dn.PI=5,dn.NODE=6,dn.isNodeType=function(x){return function(j){return function(x,j){for(var fe=0;fe<x.length;fe+=1)if(x[fe]===j)return!0;return!1}(x,j.nodeType)}},dn.makeNodeTestType=function(x,j,fe){var W=fe||function(){};return W.prototype=new dn(x),W.prototype.constructor=W,_n(W.prototype,j),W},dn.makeNodeTypeTest=function(x,j,fe){return new(dn.makeNodeTestType(x,{matches:dn.isNodeType(j),toString:Xe(fe)}))},dn.hasPrefix=function(x){return x.prefix||-1!==(x.nodeName||x.tagName).indexOf(":")},dn.isElementOrAttribute=dn.isNodeType([1,2]),dn.nameSpaceMatches=function(x,j,fe){var W=fe.namespaceURI||"";if(!x)return!W||j.allowAnyNamespaceForNoPrefix&&!dn.hasPrefix(fe);var z=j.namespaceResolver.getNamespace(x,j.expressionContextNode);if(null==z)throw new Error("Cannot resolve QName "+x);return z===W},dn.localNameMatches=function(x,j,fe){var W=fe.localName||fe.nodeName;return j.caseInsensitive?x.toLowerCase()===W.toLowerCase():x===W},dn.NameTestPrefixAny=dn.makeNodeTestType(dn.NAMETESTPREFIXANY,{matches:function(x,j){return dn.isElementOrAttribute(x)&&dn.nameSpaceMatches(this.prefix,j,x)},toString:function(){return this.prefix+":*"}},function(j){this.prefix=j}),dn.NameTestQName=dn.makeNodeTestType(dn.NAMETESTQNAME,{matches:function(x,j){return dn.isNodeType([1,2,ko.XPATH_NAMESPACE_NODE])(x)&&dn.nameSpaceMatches(this.prefix,j,x)&&dn.localNameMatches(this.localName,j,x)},toString:function(){return this.name}},function(j){var fe=j.split(":");this.name=j,this.prefix=fe.length>1?fe[0]:null,this.localName=fe[fe.length>1?1:0]}),dn.PITest=dn.makeNodeTestType(dn.PI,{matches:function(x,j){return dn.isNodeType([7])(x)&&(x.target||x.nodeName)===this.name},toString:function(){return Ct('processing-instruction("','")',this.name)}},function(x){this.name=x}),dn.nameTestAny=dn.makeNodeTypeTest(dn.NAMETESTANY,[1,2,ko.XPATH_NAMESPACE_NODE],"*"),dn.textTest=dn.makeNodeTypeTest(dn.TEXT,[3,4],"text()"),dn.commentTest=dn.makeNodeTypeTest(dn.COMMENT,[8],"comment()"),dn.nodeTest=dn.makeNodeTypeTest(dn.NODE,[1,2,3,4,7,8,9],"node()"),dn.anyPiTest=dn.makeNodeTypeTest(dn.PI,[7],"processing-instruction()"),($t.prototype=new Dn).constructor=$t,$t.superclass=Dn.prototype,$t.prototype.init=function(x){this.variable=x},$t.prototype.toString=function(){return"$"+this.variable},$t.prototype.evaluate=function(x){var j=hn.resolveQName(this.variable,x.namespaceResolver,x.contextNode,!1);if(null==j[0])throw new Error("Cannot resolve QName "+fn);var fe=x.variableResolver.getVariable(j[1],j[0]);if(!fe)throw Ro.fromMessage("Undeclared variable: "+this.toString());return fe},(Wi.prototype=new Dn).constructor=Wi,Wi.superclass=Dn.prototype,Wi.prototype.init=function(x,j){this.functionName=x,this.arguments=j},Wi.prototype.toString=function(){for(var x=this.functionName+"(",j=0;j<this.arguments.length;j++)j>0&&(x+=", "),x+=this.arguments[j].toString();return x+")"},Wi.prototype.evaluate=function(x){var j=Oi.getFunctionFromContext(this.functionName,x);if(!j)throw new Error("Unknown function "+this.functionName);var fe=[x].concat(this.arguments);return j.apply(x.functionResolver.thisArg,fe)};var vi=new Object;function Pn(x){arguments.length>0&&this.init(x)}function ln(x){arguments.length>0&&this.init(x)}function pn(x){arguments.length>0&&this.init(x)}function Xi(x){this.init(x)}function Tn(){this.init()}function ko(x,j,fe){this.isXPathNamespace=!0,this.ownerDocument=fe.ownerDocument,this.nodeName="#namespace",this.prefix=x,this.localName=x,this.namespaceURI=j,this.nodeValue=j,this.ownerElement=fe,this.nodeType=ko.XPATH_NAMESPACE_NODE}function Ur(x,j,fe){this.variableResolver=null!=x?x:new So,this.namespaceResolver=null!=j?j:new Pr,this.functionResolver=null!=fe?fe:new Oi}function So(){}function Oi(x){this.thisArg=null!=x?x:wn,this.functions=new Object,this.addStandardFunctions()}function Pr(){}vi.equals=function(x,j){return x.equals(j)},vi.notequal=function(x,j){return x.notequal(j)},vi.lessthan=function(x,j){return x.lessthan(j)},vi.greaterthan=function(x,j){return x.greaterthan(j)},vi.lessthanorequal=function(x,j){return x.lessthanorequal(j)},vi.greaterthanorequal=function(x,j){return x.greaterthanorequal(j)},(Pn.prototype=new Dn).constructor=Pn,Pn.superclass=Dn.prototype,Pn.prototype.init=function(x){this.str=String(x)},Pn.prototype.toString=function(){return this.str},Pn.prototype.evaluate=function(x){return this},Pn.prototype.string=function(){return this},Pn.prototype.number=function(){return new ln(this.str)},Pn.prototype.bool=function(){return new pn(this.str)},Pn.prototype.nodeset=function(){throw new Error("Cannot convert string to nodeset")},Pn.prototype.stringValue=function(){return this.str},Pn.prototype.numberValue=function(){return this.number().numberValue()},Pn.prototype.booleanValue=function(){return this.bool().booleanValue()},Pn.prototype.equals=function(x){return hn.instance_of(x,pn)?this.bool().equals(x):hn.instance_of(x,ln)?this.number().equals(x):hn.instance_of(x,Tn)?x.compareWithString(this,vi.equals):new pn(this.str==x.str)},Pn.prototype.notequal=function(x){return hn.instance_of(x,pn)?this.bool().notequal(x):hn.instance_of(x,ln)?this.number().notequal(x):hn.instance_of(x,Tn)?x.compareWithString(this,vi.notequal):new pn(this.str!=x.str)},Pn.prototype.lessthan=function(x){return this.number().lessthan(x)},Pn.prototype.greaterthan=function(x){return this.number().greaterthan(x)},Pn.prototype.lessthanorequal=function(x){return this.number().lessthanorequal(x)},Pn.prototype.greaterthanorequal=function(x){return this.number().greaterthanorequal(x)},(ln.prototype=new Dn).constructor=ln,ln.superclass=Dn.prototype,ln.prototype.init=function(x){this.num="string"==typeof x?this.parse(x):Number(x)},ln.prototype.numberFormat=/^\s*-?[0-9]*\.?[0-9]+\s*$/,ln.prototype.parse=function(x){return this.numberFormat.test(x)?parseFloat(x):Number.NaN},ln.prototype.toString=function(){var x=this.num.toString();return-1!==x.indexOf("e-")?function Fo(x){for(var j=x.split("e-"),fe=j[0].replace(".",""),W=Number(j[1]),z=0;z<W-1;z+=1)fe="0"+fe;return"0."+fe}(x):-1!==x.indexOf("e")?function zi(x){for(var j=x.split("e"),fe=j[0].replace(".",""),z=Number(j[1])+1-fe.length,L=0;L<z;L+=1)fe+="0";return fe}(x):x},ln.prototype.evaluate=function(x){return this},ln.prototype.string=function(){return new Pn(this.toString())},ln.prototype.number=function(){return this},ln.prototype.bool=function(){return new pn(this.num)},ln.prototype.nodeset=function(){throw new Error("Cannot convert number to nodeset")},ln.prototype.stringValue=function(){return this.string().stringValue()},ln.prototype.numberValue=function(){return this.num},ln.prototype.booleanValue=function(){return this.bool().booleanValue()},ln.prototype.negate=function(){return new ln(-this.num)},ln.prototype.equals=function(x){return hn.instance_of(x,pn)?this.bool().equals(x):hn.instance_of(x,Pn)?this.equals(x.number()):hn.instance_of(x,Tn)?x.compareWithNumber(this,vi.equals):new pn(this.num==x.num)},ln.prototype.notequal=function(x){return hn.instance_of(x,pn)?this.bool().notequal(x):hn.instance_of(x,Pn)?this.notequal(x.number()):hn.instance_of(x,Tn)?x.compareWithNumber(this,vi.notequal):new pn(this.num!=x.num)},ln.prototype.lessthan=function(x){return hn.instance_of(x,Tn)?x.compareWithNumber(this,vi.greaterthan):hn.instance_of(x,pn)||hn.instance_of(x,Pn)?this.lessthan(x.number()):new pn(this.num<x.num)},ln.prototype.greaterthan=function(x){return hn.instance_of(x,Tn)?x.compareWithNumber(this,vi.lessthan):hn.instance_of(x,pn)||hn.instance_of(x,Pn)?this.greaterthan(x.number()):new pn(this.num>x.num)},ln.prototype.lessthanorequal=function(x){return hn.instance_of(x,Tn)?x.compareWithNumber(this,vi.greaterthanorequal):hn.instance_of(x,pn)||hn.instance_of(x,Pn)?this.lessthanorequal(x.number()):new pn(this.num<=x.num)},ln.prototype.greaterthanorequal=function(x){return hn.instance_of(x,Tn)?x.compareWithNumber(this,vi.lessthanorequal):hn.instance_of(x,pn)||hn.instance_of(x,Pn)?this.greaterthanorequal(x.number()):new pn(this.num>=x.num)},ln.prototype.plus=function(x){return new ln(this.num+x.num)},ln.prototype.minus=function(x){return new ln(this.num-x.num)},ln.prototype.multiply=function(x){return new ln(this.num*x.num)},ln.prototype.div=function(x){return new ln(this.num/x.num)},ln.prototype.mod=function(x){return new ln(this.num%x.num)},(pn.prototype=new Dn).constructor=pn,pn.superclass=Dn.prototype,pn.prototype.init=function(x){this.b=Boolean(x)},pn.prototype.toString=function(){return this.b.toString()},pn.prototype.evaluate=function(x){return this},pn.prototype.string=function(){return new Pn(this.b)},pn.prototype.number=function(){return new ln(this.b)},pn.prototype.bool=function(){return this},pn.prototype.nodeset=function(){throw new Error("Cannot convert boolean to nodeset")},pn.prototype.stringValue=function(){return this.string().stringValue()},pn.prototype.numberValue=function(){return this.number().numberValue()},pn.prototype.booleanValue=function(){return this.b},pn.prototype.not=function(){return new pn(!this.b)},pn.prototype.equals=function(x){return hn.instance_of(x,Pn)||hn.instance_of(x,ln)?this.equals(x.bool()):hn.instance_of(x,Tn)?x.compareWithBoolean(this,vi.equals):new pn(this.b==x.b)},pn.prototype.notequal=function(x){return hn.instance_of(x,Pn)||hn.instance_of(x,ln)?this.notequal(x.bool()):hn.instance_of(x,Tn)?x.compareWithBoolean(this,vi.notequal):new pn(this.b!=x.b)},pn.prototype.lessthan=function(x){return this.number().lessthan(x)},pn.prototype.greaterthan=function(x){return this.number().greaterthan(x)},pn.prototype.lessthanorequal=function(x){return this.number().lessthanorequal(x)},pn.prototype.greaterthanorequal=function(x){return this.number().greaterthanorequal(x)},pn.true_=new pn(!0),pn.false_=new pn(!1),(Xi.prototype=new Object).constructor=Xi,Xi.superclass=Object.prototype,Xi.prototype.init=function(x){this.left=null,this.right=null,this.node=x,this.depth=1},Xi.prototype.balance=function(){var x=null==this.left?0:this.left.depth,j=null==this.right?0:this.right.depth;x>j+1?((null==this.left.left?0:this.left.left.depth)<(null==this.left.right?0:this.left.right.depth)&&this.left.rotateRR(),this.rotateLL()):x+1<j&&((null==this.right.left?0:this.right.left.depth)>(null==this.right.right?0:this.right.right.depth)&&this.right.rotateLL(),this.rotateRR())},Xi.prototype.rotateLL=function(){var x=this.node,j=this.right;this.node=this.left.node,this.right=this.left,this.left=this.left.left,this.right.left=this.right.right,this.right.right=j,this.right.node=x,this.right.updateInNewLocation(),this.updateInNewLocation()},Xi.prototype.rotateRR=function(){var x=this.node,j=this.left;this.node=this.right.node,this.left=this.right,this.right=this.right.right,this.left.right=this.left.left,this.left.left=j,this.left.node=x,this.left.updateInNewLocation(),this.updateInNewLocation()},Xi.prototype.updateInNewLocation=function(){this.getDepthFromChildren()},Xi.prototype.getDepthFromChildren=function(){this.depth=null==this.node?0:1,null!=this.left&&(this.depth=this.left.depth+1),null!=this.right&&this.depth<=this.right.depth&&(this.depth=this.right.depth+1)},Xi.prototype.add=function(x){if(x===this.node)return!1;var j=function jr(x,j){if(x===j)return 0;if(x.compareDocumentPosition){var fe=x.compareDocumentPosition(j);return 1&fe||10&fe?1:20&fe?-1:0}for(var W=0,z=0,L=x;null!=L;L=L.parentNode||L.ownerElement)W++;for(var ne=j;null!=ne;ne=ne.parentNode||ne.ownerElement)z++;if(W>z){for(;W>z;)x=x.parentNode||x.ownerElement,W--;if(x===j)return 1}else if(z>W){for(;z>W;)j=j.parentNode||j.ownerElement,z--;if(x===j)return-1}for(var _e=x.parentNode||x.ownerElement,Te=j.parentNode||j.ownerElement;_e!==Te;)_e=(x=_e).parentNode||x.ownerElement,Te=(j=Te).parentNode||j.ownerElement;var Ee=hn.isAttribute(x),Ne=hn.isAttribute(j);if(Ee&&!Ne)return-1;if(!Ee&&Ne)return 1;if(_e)for(var Re=Ee?_e.attributes:_e.childNodes,nt=Re.length,vt=0;vt<nt;vt+=1){var Xt=Re[vt];if(Xt===x)return-1;if(Xt===j)return 1}throw new Error("Unexpected: could not determine node order")}(x,this.node),fe=!1;return-1==j?null==this.left?(this.left=new Xi(x),fe=!0):(fe=this.left.add(x))&&this.balance():1==j&&(null==this.right?(this.right=new Xi(x),fe=!0):(fe=this.right.add(x))&&this.balance()),fe&&this.getDepthFromChildren(),fe},(Tn.prototype=new Dn).constructor=Tn,Tn.superclass=Dn.prototype,Tn.prototype.init=function(){this.tree=null,this.nodes=[],this.size=0},Tn.prototype.toString=function(){var x=this.first();return null==x?"":this.stringForNode(x)},Tn.prototype.evaluate=function(x){return this},Tn.prototype.string=function(){return new Pn(this.toString())},Tn.prototype.stringValue=function(){return this.toString()},Tn.prototype.number=function(){return new ln(this.string())},Tn.prototype.numberValue=function(){return Number(this.string())},Tn.prototype.bool=function(){return new pn(this.booleanValue())},Tn.prototype.booleanValue=function(){return!!this.size},Tn.prototype.nodeset=function(){return this},Tn.prototype.stringForNode=function(x){return 9==x.nodeType||1==x.nodeType||11===x.nodeType?this.stringForContainerNode(x):2===x.nodeType?x.value||x.nodeValue:x.isNamespaceNode?x.namespace:x.nodeValue},Tn.prototype.stringForContainerNode=function(x){for(var j="",fe=x.firstChild;null!=fe;fe=fe.nextSibling){var W=fe.nodeType;(1===W||3===W||4===W||9===W||11===W)&&(j+=this.stringForNode(fe))}return j},Tn.prototype.buildTree=function(){if(!this.tree&&this.nodes.length){this.tree=new Xi(this.nodes[0]);for(var x=1;x<this.nodes.length;x+=1)this.tree.add(this.nodes[x])}return this.tree},Tn.prototype.first=function(){var x=this.buildTree();if(null==x)return null;for(;null!=x.left;)x=x.left;return x.node},Tn.prototype.add=function(x){for(var j=0;j<this.nodes.length;j+=1)if(x===this.nodes[j])return;this.tree=null,this.nodes.push(x),this.size+=1},Tn.prototype.addArray=function(x){var j=this;Ve(function(fe){j.add(fe)},x)},Tn.prototype.toArray=function(){var x=[];return this.toArrayRec(this.buildTree(),x),x},Tn.prototype.toArrayRec=function(x,j){null!=x&&(this.toArrayRec(x.left,j),j.push(x.node),this.toArrayRec(x.right,j))},Tn.prototype.toUnsortedArray=function(){return this.nodes.slice()},Tn.prototype.compareWithString=function(x,j){for(var fe=this.toUnsortedArray(),W=0;W<fe.length;W++){var ne=j(new Pn(this.stringForNode(fe[W])),x);if(ne.booleanValue())return ne}return new pn(!1)},Tn.prototype.compareWithNumber=function(x,j){for(var fe=this.toUnsortedArray(),W=0;W<fe.length;W++){var ne=j(new ln(this.stringForNode(fe[W])),x);if(ne.booleanValue())return ne}return new pn(!1)},Tn.prototype.compareWithBoolean=function(x,j){return j(this.bool(),x)},Tn.prototype.compareWithNodeSet=function(x,j){for(var fe=this.toUnsortedArray(),W=function(_e,Te){return j(Te,_e)},z=0;z<fe.length;z++){var L=new Pn(this.stringForNode(fe[z])),ne=x.compareWithString(L,W);if(ne.booleanValue())return ne}return new pn(!1)},Tn.compareWith=function je(x){var j=Array.prototype.slice,fe=x.length,W=function(L,ne){return function(){return ne.apply(this,L.concat(j.call(arguments)))}},z=function(){var L=j.call(arguments);return L.length<fe?W(L,z):x.apply(this,j.apply(arguments,[0,fe]))};return z}(function(x,j){return hn.instance_of(j,Pn)?this.compareWithString(j,x):hn.instance_of(j,ln)?this.compareWithNumber(j,x):hn.instance_of(j,pn)?this.compareWithBoolean(j,x):this.compareWithNodeSet(j,x)}),Tn.prototype.equals=Tn.compareWith(vi.equals),Tn.prototype.notequal=Tn.compareWith(vi.notequal),Tn.prototype.lessthan=Tn.compareWith(vi.lessthan),Tn.prototype.greaterthan=Tn.compareWith(vi.greaterthan),Tn.prototype.lessthanorequal=Tn.compareWith(vi.lessthanorequal),Tn.prototype.greaterthanorequal=Tn.compareWith(vi.greaterthanorequal),Tn.prototype.union=function(x){var j=new Tn;return j.addArray(this.toUnsortedArray()),j.addArray(x.toUnsortedArray()),j},(ko.prototype=new Object).constructor=ko,ko.superclass=Object.prototype,ko.prototype.toString=function(){return'{ "'+this.prefix+'", "'+this.namespaceURI+'" }'},(Ur.prototype=new Object).constructor=Ur,Ur.superclass=Object.prototype,Ur.prototype.extend=function(x){return _n(new Ur,this,x)},(So.prototype=new Object).constructor=So,So.superclass=Object.prototype,So.prototype.getVariable=function(x,j){return null},(Oi.prototype=new Object).constructor=Oi,Oi.superclass=Object.prototype,Oi.prototype.addStandardFunctions=function(){this.functions["{}last"]=wn.last,this.functions["{}position"]=wn.position,this.functions["{}count"]=wn.count,this.functions["{}id"]=wn.id,this.functions["{}local-name"]=wn.localName,this.functions["{}namespace-uri"]=wn.namespaceURI,this.functions["{}name"]=wn.name,this.functions["{}string"]=wn.string,this.functions["{}concat"]=wn.concat,this.functions["{}starts-with"]=wn.startsWith,this.functions["{}contains"]=wn.contains,this.functions["{}substring-before"]=wn.substringBefore,this.functions["{}substring-after"]=wn.substringAfter,this.functions["{}substring"]=wn.substring,this.functions["{}string-length"]=wn.stringLength,this.functions["{}normalize-space"]=wn.normalizeSpace,this.functions["{}translate"]=wn.translate,this.functions["{}boolean"]=wn.boolean_,this.functions["{}not"]=wn.not,this.functions["{}true"]=wn.true_,this.functions["{}false"]=wn.false_,this.functions["{}lang"]=wn.lang,this.functions["{}number"]=wn.number,this.functions["{}sum"]=wn.sum,this.functions["{}floor"]=wn.floor,this.functions["{}ceiling"]=wn.ceiling,this.functions["{}round"]=wn.round},Oi.prototype.addFunction=function(x,j,fe){this.functions["{"+x+"}"+j]=fe},Oi.getFunctionFromContext=function(x,j){var fe=hn.resolveQName(x,j.namespaceResolver,j.contextNode,!1);if(null===fe[0])throw new Error("Cannot resolve QName "+name);return j.functionResolver.getFunction(fe[1],fe[0])},Oi.prototype.getFunction=function(x,j){return this.functions["{"+j+"}"+x]},(Pr.prototype=new Object).constructor=Pr,Pr.superclass=Object.prototype,Pr.prototype.getNamespace=function(x,j){if("xml"==x)return Fn.XML_NAMESPACE_URI;if("xmlns"==x)return Fn.XMLNS_NAMESPACE_URI;for(9==j.nodeType?j=j.documentElement:2==j.nodeType?j=Rn.getOwnerElement(j):1!=j.nodeType&&(j=j.parentNode);null!=j&&1==j.nodeType;){for(var fe=j.attributes,W=0;W<fe.length;W++){var z=fe.item(W),L=z.name||z.nodeName;if("xmlns"===L&&""===x||L==="xmlns:"+x)return String(z.value||z.nodeValue)}j=j.parentNode}return null};var wn=new Object;wn.last=function(x){if(1!=arguments.length)throw new Error("Function last expects ()");return new ln(x.contextSize)},wn.position=function(x){if(1!=arguments.length)throw new Error("Function position expects ()");return new ln(x.contextPosition)},wn.count=function(){var j,x=arguments[0];if(2!=arguments.length||!hn.instance_of(j=arguments[1].evaluate(x),Tn))throw new Error("Function count expects (node-set)");return new ln(j.size)},wn.id=function(){var j,x=arguments[0];if(2!=arguments.length)throw new Error("Function id expects (object)");j=arguments[1].evaluate(x);for(var fe=(j=hn.instance_of(j,Tn)?j.toArray().join(" "):j.stringValue()).split(/[\x0d\x0a\x09\x20]+/),z=new Tn,L=9==x.contextNode.nodeType?x.contextNode:x.contextNode.ownerDocument,ne=0;ne<fe.length;ne++){var _e;null!=(_e=L.getElementById?L.getElementById(fe[ne]):hn.getElementById(L,fe[ne]))&&z.add(_e)}return z},wn.localName=function(x,j){var fe;if(1==arguments.length)fe=x.contextNode;else{if(2!=arguments.length)throw new Error("Function local-name expects (node-set?)");fe=j.evaluate(x).first()}return new Pn(null==fe?"":fe.localName||fe.baseName||fe.target||fe.nodeName||"")},wn.namespaceURI=function(){var j,x=arguments[0];if(1==arguments.length)j=x.contextNode;else{if(2!=arguments.length)throw new Error("Function namespace-uri expects (node-set?)");j=arguments[1].evaluate(x).first()}return new Pn(null==j?"":j.namespaceURI)},wn.name=function(){var j,x=arguments[0];if(1==arguments.length)j=x.contextNode;else{if(2!=arguments.length)throw new Error("Function name expects (node-set?)");j=arguments[1].evaluate(x).first()}return new Pn(null==j?"":1==j.nodeType?j.nodeName:2==j.nodeType?j.name||j.nodeName:7===j.nodeType?j.target||j.nodeName:null==j.localName?"":j.localName)},wn.string=function(){var x=arguments[0];if(1==arguments.length)return new Pn(Tn.prototype.stringForNode(x.contextNode));if(2==arguments.length)return arguments[1].evaluate(x).string();throw new Error("Function string expects (object?)")},wn.concat=function(x){if(arguments.length<3)throw new Error("Function concat expects (string, string[, string]*)");for(var j="",fe=1;fe<arguments.length;fe++)j+=arguments[fe].evaluate(x).stringValue();return new Pn(j)},wn.startsWith=function(){var x=arguments[0];if(3!=arguments.length)throw new Error("Function startsWith expects (string, string)");var j=arguments[1].evaluate(x).stringValue(),fe=arguments[2].evaluate(x).stringValue();return new pn(j.substring(0,fe.length)==fe)},wn.contains=function(){var x=arguments[0];if(3!=arguments.length)throw new Error("Function contains expects (string, string)");var j=arguments[1].evaluate(x).stringValue(),fe=arguments[2].evaluate(x).stringValue();return new pn(-1!==j.indexOf(fe))},wn.substringBefore=function(){var x=arguments[0];if(3!=arguments.length)throw new Error("Function substring-before expects (string, string)");var j=arguments[1].evaluate(x).stringValue(),fe=arguments[2].evaluate(x).stringValue();return new Pn(j.substring(0,j.indexOf(fe)))},wn.substringAfter=function(){var x=arguments[0];if(3!=arguments.length)throw new Error("Function substring-after expects (string, string)");var j=arguments[1].evaluate(x).stringValue(),fe=arguments[2].evaluate(x).stringValue();if(0==fe.length)return new Pn(j);var W=j.indexOf(fe);return new Pn(-1==W?"":j.substring(W+fe.length))},wn.substring=function(){var x=arguments[0];if(3!=arguments.length&&4!=arguments.length)throw new Error("Function substring expects (string, number, number?)");var j=arguments[1].evaluate(x).stringValue(),fe=Math.round(arguments[2].evaluate(x).numberValue())-1,W=4==arguments.length?fe+Math.round(arguments[3].evaluate(x).numberValue()):void 0;return new Pn(j.substring(fe,W))},wn.stringLength=function(){var j,x=arguments[0];if(1==arguments.length)j=Tn.prototype.stringForNode(x.contextNode);else{if(2!=arguments.length)throw new Error("Function string-length expects (string?)");j=arguments[1].evaluate(x).stringValue()}return new ln(j.length)},wn.normalizeSpace=function(){var j,x=arguments[0];if(1==arguments.length)j=Tn.prototype.stringForNode(x.contextNode);else{if(2!=arguments.length)throw new Error("Function normalize-space expects (string?)");j=arguments[1].evaluate(x).stringValue()}for(var fe=0,W=j.length-1;hn.isSpace(j.charCodeAt(W));)W--;for(var z="";fe<=W&&hn.isSpace(j.charCodeAt(fe));)fe++;for(;fe<=W;)if(hn.isSpace(j.charCodeAt(fe)))for(z+=" ";fe<=W&&hn.isSpace(j.charCodeAt(fe));)fe++;else z+=j.charAt(fe),fe++;return new Pn(z)},wn.translate=function(x,j,fe,W){if(4!=arguments.length)throw new Error("Function translate expects (string, string, string)");var z=j.evaluate(x).stringValue(),L=fe.evaluate(x).stringValue(),ne=W.evaluate(x).stringValue(),_e=p(function(Ee,Ne,Re){return Ne in Ee||(Ee[Ne]=Re>ne.length?"":ne[Re]),Ee},{},L),Te=St("",he(function(Ee){return Ee in _e?_e[Ee]:Ee},z));return new Pn(Te)},wn.boolean_=function(){var x=arguments[0];if(2!=arguments.length)throw new Error("Function boolean expects (object)");return arguments[1].evaluate(x).bool()},wn.not=function(x,j){if(2!=arguments.length)throw new Error("Function not expects (object)");return j.evaluate(x).bool().not()},wn.true_=function(){if(1!=arguments.length)throw new Error("Function true expects ()");return pn.true_},wn.false_=function(){if(1!=arguments.length)throw new Error("Function false expects ()");return pn.false_},wn.lang=function(){var x=arguments[0];if(2!=arguments.length)throw new Error("Function lang expects (string)");for(var j,fe=x.contextNode;null!=fe&&9!=fe.nodeType;fe=fe.parentNode){var W=fe.getAttributeNS(Fn.XML_NAMESPACE_URI,"lang");if(null!=W){j=String(W);break}}if(null==j)return pn.false_;var z=arguments[1].evaluate(x).stringValue();return new pn(j.substring(0,z.length)==z&&(j.length==z.length||"-"==j.charAt(z.length)))},wn.number=function(){var x=arguments[0];if(1!=arguments.length&&2!=arguments.length)throw new Error("Function number expects (object?)");return 1==arguments.length?new ln(Tn.prototype.stringForNode(x.contextNode)):arguments[1].evaluate(x).number()},wn.sum=function(){var j,x=arguments[0];if(2!=arguments.length||!hn.instance_of(j=arguments[1].evaluate(x),Tn))throw new Error("Function sum expects (node-set)");j=j.toUnsortedArray();for(var fe=0,W=0;W<j.length;W++)fe+=new ln(Tn.prototype.stringForNode(j[W])).numberValue();return new ln(fe)},wn.floor=function(){var x=arguments[0];if(2!=arguments.length)throw new Error("Function floor expects (number)");return new ln(Math.floor(arguments[1].evaluate(x).numberValue()))},wn.ceiling=function(){var x=arguments[0];if(2!=arguments.length)throw new Error("Function ceiling expects (number)");return new ln(Math.ceil(arguments[1].evaluate(x).numberValue()))},wn.round=function(){var x=arguments[0];if(2!=arguments.length)throw new Error("Function round expects (number)");return new ln(Math.round(arguments[1].evaluate(x).numberValue()))};var hn=new Object;hn.isAttribute=function(x){return x&&(2===x.nodeType||x.ownerElement)},hn.splitQName=function(x){var j=x.indexOf(":");return-1==j?[null,x]:[x.substring(0,j),x.substring(j+1)]},hn.resolveQName=function(x,j,fe,W){var z=hn.splitQName(x);return null!=z[0]?z[0]=j.getNamespace(z[0],fe):W?(z[0]=j.getNamespace("",fe),null==z[0]&&(z[0]="")):z[0]="",z},hn.isSpace=function(x){return 9==x||13==x||10==x||32==x},hn.isLetter=function(x){return x>=65&&x<=90||x>=97&&x<=122||x>=192&&x<=214||x>=216&&x<=246||x>=248&&x<=255||x>=256&&x<=305||x>=308&&x<=318||x>=321&&x<=328||x>=330&&x<=382||x>=384&&x<=451||x>=461&&x<=496||x>=500&&x<=501||x>=506&&x<=535||x>=592&&x<=680||x>=699&&x<=705||902==x||x>=904&&x<=906||908==x||x>=910&&x<=929||x>=931&&x<=974||x>=976&&x<=982||986==x||988==x||990==x||992==x||x>=994&&x<=1011||x>=1025&&x<=1036||x>=1038&&x<=1103||x>=1105&&x<=1116||x>=1118&&x<=1153||x>=1168&&x<=1220||x>=1223&&x<=1224||x>=1227&&x<=1228||x>=1232&&x<=1259||x>=1262&&x<=1269||x>=1272&&x<=1273||x>=1329&&x<=1366||1369==x||x>=1377&&x<=1414||x>=1488&&x<=1514||x>=1520&&x<=1522||x>=1569&&x<=1594||x>=1601&&x<=1610||x>=1649&&x<=1719||x>=1722&&x<=1726||x>=1728&&x<=1742||x>=1744&&x<=1747||1749==x||x>=1765&&x<=1766||x>=2309&&x<=2361||2365==x||x>=2392&&x<=2401||x>=2437&&x<=2444||x>=2447&&x<=2448||x>=2451&&x<=2472||x>=2474&&x<=2480||2482==x||x>=2486&&x<=2489||x>=2524&&x<=2525||x>=2527&&x<=2529||x>=2544&&x<=2545||x>=2565&&x<=2570||x>=2575&&x<=2576||x>=2579&&x<=2600||x>=2602&&x<=2608||x>=2610&&x<=2611||x>=2613&&x<=2614||x>=2616&&x<=2617||x>=2649&&x<=2652||2654==x||x>=2674&&x<=2676||x>=2693&&x<=2699||2701==x||x>=2703&&x<=2705||x>=2707&&x<=2728||x>=2730&&x<=2736||x>=2738&&x<=2739||x>=2741&&x<=2745||2749==x||2784==x||x>=2821&&x<=2828||x>=2831&&x<=2832||x>=2835&&x<=2856||x>=2858&&x<=2864||x>=2866&&x<=2867||x>=2870&&x<=2873||2877==x||x>=2908&&x<=2909||x>=2911&&x<=2913||x>=2949&&x<=2954||x>=2958&&x<=2960||x>=2962&&x<=2965||x>=2969&&x<=2970||2972==x||x>=2974&&x<=2975||x>=2979&&x<=2980||x>=2984&&x<=2986||x>=2990&&x<=2997||x>=2999&&x<=3001||x>=3077&&x<=3084||x>=3086&&x<=3088||x>=3090&&x<=3112||x>=3114&&x<=3123||x>=3125&&x<=3129||x>=3168&&x<=3169||x>=3205&&x<=3212||x>=3214&&x<=3216||x>=3218&&x<=3240||x>=3242&&x<=3251||x>=3253&&x<=3257||3294==x||x>=3296&&x<=3297||x>=3333&&x<=3340||x>=3342&&x<=3344||x>=3346&&x<=3368||x>=3370&&x<=3385||x>=3424&&x<=3425||x>=3585&&x<=3630||3632==x||x>=3634&&x<=3635||x>=3648&&x<=3653||x>=3713&&x<=3714||3716==x||x>=3719&&x<=3720||3722==x||3725==x||x>=3732&&x<=3735||x>=3737&&x<=3743||x>=3745&&x<=3747||3749==x||3751==x||x>=3754&&x<=3755||x>=3757&&x<=3758||3760==x||x>=3762&&x<=3763||3773==x||x>=3776&&x<=3780||x>=3904&&x<=3911||x>=3913&&x<=3945||x>=4256&&x<=4293||x>=4304&&x<=4342||4352==x||x>=4354&&x<=4355||x>=4357&&x<=4359||4361==x||x>=4363&&x<=4364||x>=4366&&x<=4370||4412==x||4414==x||4416==x||4428==x||4430==x||4432==x||x>=4436&&x<=4437||4441==x||x>=4447&&x<=4449||4451==x||4453==x||4455==x||4457==x||x>=4461&&x<=4462||x>=4466&&x<=4467||4469==x||4510==x||4520==x||4523==x||x>=4526&&x<=4527||x>=4535&&x<=4536||4538==x||x>=4540&&x<=4546||4587==x||4592==x||4601==x||x>=7680&&x<=7835||x>=7840&&x<=7929||x>=7936&&x<=7957||x>=7960&&x<=7965||x>=7968&&x<=8005||x>=8008&&x<=8013||x>=8016&&x<=8023||8025==x||8027==x||8029==x||x>=8031&&x<=8061||x>=8064&&x<=8116||x>=8118&&x<=8124||8126==x||x>=8130&&x<=8132||x>=8134&&x<=8140||x>=8144&&x<=8147||x>=8150&&x<=8155||x>=8160&&x<=8172||x>=8178&&x<=8180||x>=8182&&x<=8188||8486==x||x>=8490&&x<=8491||8494==x||x>=8576&&x<=8578||x>=12353&&x<=12436||x>=12449&&x<=12538||x>=12549&&x<=12588||x>=44032&&x<=55203||x>=19968&&x<=40869||12295==x||x>=12321&&x<=12329},hn.isNCNameChar=function(x){return x>=48&&x<=57||x>=1632&&x<=1641||x>=1776&&x<=1785||x>=2406&&x<=2415||x>=2534&&x<=2543||x>=2662&&x<=2671||x>=2790&&x<=2799||x>=2918&&x<=2927||x>=3047&&x<=3055||x>=3174&&x<=3183||x>=3302&&x<=3311||x>=3430&&x<=3439||x>=3664&&x<=3673||x>=3792&&x<=3801||x>=3872&&x<=3881||46==x||45==x||95==x||hn.isLetter(x)||x>=768&&x<=837||x>=864&&x<=865||x>=1155&&x<=1158||x>=1425&&x<=1441||x>=1443&&x<=1465||x>=1467&&x<=1469||1471==x||x>=1473&&x<=1474||1476==x||x>=1611&&x<=1618||1648==x||x>=1750&&x<=1756||x>=1757&&x<=1759||x>=1760&&x<=1764||x>=1767&&x<=1768||x>=1770&&x<=1773||x>=2305&&x<=2307||2364==x||x>=2366&&x<=2380||2381==x||x>=2385&&x<=2388||x>=2402&&x<=2403||x>=2433&&x<=2435||2492==x||2494==x||2495==x||x>=2496&&x<=2500||x>=2503&&x<=2504||x>=2507&&x<=2509||2519==x||x>=2530&&x<=2531||2562==x||2620==x||2622==x||2623==x||x>=2624&&x<=2626||x>=2631&&x<=2632||x>=2635&&x<=2637||x>=2672&&x<=2673||x>=2689&&x<=2691||2748==x||x>=2750&&x<=2757||x>=2759&&x<=2761||x>=2763&&x<=2765||x>=2817&&x<=2819||2876==x||x>=2878&&x<=2883||x>=2887&&x<=2888||x>=2891&&x<=2893||x>=2902&&x<=2903||x>=2946&&x<=2947||x>=3006&&x<=3010||x>=3014&&x<=3016||x>=3018&&x<=3021||3031==x||x>=3073&&x<=3075||x>=3134&&x<=3140||x>=3142&&x<=3144||x>=3146&&x<=3149||x>=3157&&x<=3158||x>=3202&&x<=3203||x>=3262&&x<=3268||x>=3270&&x<=3272||x>=3274&&x<=3277||x>=3285&&x<=3286||x>=3330&&x<=3331||x>=3390&&x<=3395||x>=3398&&x<=3400||x>=3402&&x<=3405||3415==x||3633==x||x>=3636&&x<=3642||x>=3655&&x<=3662||3761==x||x>=3764&&x<=3769||x>=3771&&x<=3772||x>=3784&&x<=3789||x>=3864&&x<=3865||3893==x||3895==x||3897==x||3902==x||3903==x||x>=3953&&x<=3972||x>=3974&&x<=3979||x>=3984&&x<=3989||3991==x||x>=3993&&x<=4013||x>=4017&&x<=4023||4025==x||x>=8400&&x<=8412||8417==x||x>=12330&&x<=12335||12441==x||12442==x||183==x||720==x||721==x||903==x||1600==x||3654==x||3782==x||12293==x||x>=12337&&x<=12341||x>=12445&&x<=12446||x>=12540&&x<=12542},hn.coalesceText=function(x){for(var j=x.firstChild;null!=j;j=j.nextSibling)if(3==j.nodeType||4==j.nodeType){var fe=j.nodeValue,W=j;for(j=j.nextSibling;null!=j&&(3==j.nodeType||4==j.nodeType);){fe+=j.nodeValue;var z=j;j=j.nextSibling,z.parentNode.removeChild(z)}if(4==W.nodeType){var L=W.parentNode;if(null==W.nextSibling)L.removeChild(W),L.appendChild(L.ownerDocument.createTextNode(fe));else{var ne=W.nextSibling;L.removeChild(W),L.insertBefore(L.ownerDocument.createTextNode(fe),ne)}}else W.nodeValue=fe;if(null==j)break}else 1==j.nodeType&&hn.coalesceText(j)},hn.instance_of=function(x,j){for(;null!=x;){if(x.constructor===j)return!0;if(x===Object)return!1;x=x.constructor.superclass}return!1},hn.getElementById=function(x,j){if(1==x.nodeType&&(x.getAttribute("id")==j||x.getAttributeNS(null,"id")==j))return x;for(var fe=x.firstChild;null!=fe;fe=fe.nextSibling){var W=hn.getElementById(fe,j);if(null!=W)return W}return null};var Ro=function(){function j(fe,W,z){var L=Error.call(this,function x(fe,W){var z=W?": "+W.toString():"";switch(fe){case j.INVALID_EXPRESSION_ERR:return"Invalid expression"+z;case j.TYPE_ERR:return"Type error"+z}return null}(fe,W)||z);return L.code=fe,L.exception=W,L}return(j.prototype=Object.create(Error.prototype)).constructor=j,j.superclass=Error,j.prototype.toString=function(){return this.message},j.fromMessage=function(fe,W){return new j(null,W,fe)},j.INVALID_EXPRESSION_ERR=51,j.TYPE_ERR=52,j}();function po(x,j,fe){this.xpath=fe.parse(x),this.context=new Ur,this.context.namespaceResolver=new gs(j)}function gs(x){this.xpathNSResolver=x}function Co(x){this.node=x,this.namespaceResolver=new Pr}function hi(x,j){switch(j==hi.ANY_TYPE&&(x.constructor===Pn?j=hi.STRING_TYPE:x.constructor===ln?j=hi.NUMBER_TYPE:x.constructor===pn?j=hi.BOOLEAN_TYPE:x.constructor===Tn&&(j=hi.UNORDERED_NODE_ITERATOR_TYPE)),this.resultType=j,j){case hi.NUMBER_TYPE:return void(this.numberValue=x.numberValue());case hi.STRING_TYPE:return void(this.stringValue=x.stringValue());case hi.BOOLEAN_TYPE:return void(this.booleanValue=x.booleanValue());case hi.ANY_UNORDERED_NODE_TYPE:case hi.FIRST_ORDERED_NODE_TYPE:if(x.constructor===Tn)return void(this.singleNodeValue=x.first());break;case hi.UNORDERED_NODE_ITERATOR_TYPE:case hi.ORDERED_NODE_ITERATOR_TYPE:if(x.constructor===Tn)return this.invalidIteratorState=!1,this.nodes=x.toArray(),void(this.iteratorIndex=0);break;case hi.UNORDERED_NODE_SNAPSHOT_TYPE:case hi.ORDERED_NODE_SNAPSHOT_TYPE:if(x.constructor===Tn)return this.nodes=x.toArray(),void(this.snapshotLength=this.nodes.length)}throw new Ro(Ro.TYPE_ERR)}function qs(x,j){x.createExpression=function(fe,W){try{return new po(fe,W,j)}catch(z){throw new Ro(Ro.INVALID_EXPRESSION_ERR,z)}},x.createNSResolver=function(fe){return new Co(fe)},x.evaluate=function(fe,W,z,L,ne){if(L<0||L>9)throw{code:0,toString:function(){return"Request type not supported"}};return x.createExpression(fe,z,j).evaluate(W,L,ne)}}(po.prototype={}).constructor=po,po.superclass=Object.prototype,po.getOwnerDocument=function(x){return 9===x.nodeType?x:x.ownerDocument},po.detectHtmlDom=function(x){if(!x)return!1;var j=po.getOwnerDocument(x);try{return j.implementation.hasFeature("HTML","2.0")}catch(fe){return!0}},po.prototype.evaluate=function(x,j,fe){return this.context.expressionContextNode=x,this.context.caseInsensitive=po.detectHtmlDom(x),new hi(this.xpath.evaluate(this.context),j)},(gs.prototype={}).constructor=gs,gs.superclass=Object.prototype,gs.prototype.getNamespace=function(x,j){return null==this.xpathNSResolver?null:this.xpathNSResolver.lookupNamespaceURI(x)},(Co.prototype={}).constructor=Co,Co.superclass=Object.prototype,Co.prototype.lookupNamespaceURI=function(x){return this.namespaceResolver.getNamespace(x,this.node)},(hi.prototype={}).constructor=hi,hi.superclass=Object.prototype,hi.prototype.iterateNext=function(){if(this.resultType!=hi.UNORDERED_NODE_ITERATOR_TYPE&&this.resultType!=hi.ORDERED_NODE_ITERATOR_TYPE)throw new Ro(Ro.TYPE_ERR);return this.nodes[this.iteratorIndex++]},hi.prototype.snapshotItem=function(x){if(this.resultType!=hi.UNORDERED_NODE_SNAPSHOT_TYPE&&this.resultType!=hi.ORDERED_NODE_SNAPSHOT_TYPE)throw new Ro(Ro.TYPE_ERR);return this.nodes[x]},hi.ANY_TYPE=0,hi.NUMBER_TYPE=1,hi.STRING_TYPE=2,hi.BOOLEAN_TYPE=3,hi.UNORDERED_NODE_ITERATOR_TYPE=4,hi.ORDERED_NODE_ITERATOR_TYPE=5,hi.UNORDERED_NODE_SNAPSHOT_TYPE=6,hi.ORDERED_NODE_SNAPSHOT_TYPE=7,hi.ANY_UNORDERED_NODE_TYPE=8,hi.FIRST_ORDERED_NODE_TYPE=9;try{var bs=!0;try{document.implementation&&document.implementation.hasFeature&&document.implementation.hasFeature("XPath",null)&&(bs=!1)}catch(x){}bs&&qs(document,new He)}catch(x){}qs(ze,new He),function(){var x=new He,j=new Pr,fe=new Oi,W=new So;function z(Pt){return{getNamespace:function(Y,ee){return Pt(Y,ee)||j.getNamespace(Y,ee)}}}function Te(Pt){if(null==Pt||Pt instanceof Pn||Pt instanceof pn||Pt instanceof ln||Pt instanceof Tn)return Pt;switch(typeof Pt){case"string":return new Pn(Pt);case"boolean":return new pn(Pt);case"number":return new ln(Pt)}var Y=new Tn;return Y.addArray([].concat(Pt)),Y}function Ne(Pt){return{getFunction:function(Y,ee){var De=Pt(Y,ee);return De?function Ee(Pt){return function(Y){var ee=Array.prototype.slice.call(arguments,1).map(function(gt){return gt.evaluate(Y)});return Te(Pt.apply(this,[].concat(Y,ee)))}}(De):fe.getFunction(Y,ee)}}}function Xt(Pt){return{getVariable:function(Y,ee){return Te(Pt(Y,ee))}}}function oi(Pt,Y,ee){Pt in ee&&(Y[Pt]=ee[Pt])}function ai(Pt){var Y=new Ur;return Pt?(Y.namespaceResolver=function _e(Pt){return Pt&&"function"==typeof Pt.getNamespace?function L(Pt){return z(Pt.getNamespace.bind(Pt))}(Pt):"function"==typeof Pt?z(Pt):"object"==typeof Pt?function ne(Pt){return z(function(Y){return Pt[Y]})}(Pt):j}(Pt.namespaces),Y.functionResolver=function vt(Pt){return Pt&&"function"==typeof Pt.getFunction?function Re(Pt){return Ne(Pt.getFunction.bind(Pt))}(Pt):"function"==typeof Pt?Ne(Pt):"object"==typeof Pt?function nt(Pt){return Ne(function(Y){return Pt[Y]})}(Pt):fe}(Pt.functions),Y.variableResolver=function Bt(Pt){if(Pt){if("function"==typeof Pt.getVariable)return Xt(Pt.getVariable.bind(Pt));if("function"==typeof Pt)return Xt(Pt);if("object"==typeof Pt)return Xt(function(Y){return Pt[Y]})}return W}(Pt.variables),Y.expressionContextNode=Pt.node,oi("allowAnyNamespaceForNoPrefix",Y,Pt),oi("isHtml",Y,Pt)):Y.namespaceResolver=j,Y}var pi={evaluate:function(Pt){return function li(Pt,Y){var ee=ai(Y);return Pt.evaluate(ee)}(this.expression,Pt)},evaluateNumber:function(Pt){return this.evaluate(Pt).numberValue()},evaluateString:function(Pt){return this.evaluate(Pt).stringValue()},evaluateBoolean:function(Pt){return this.evaluate(Pt).booleanValue()},evaluateNodeSet:function(Pt){return this.evaluate(Pt).nodeset()},select:function(Pt){return this.evaluateNodeSet(Pt).toArray()},select1:function(Pt){return this.select(Pt)[0]}};ze.parse=function Ti(Pt){var Y=x.parse(Pt);return Object.create(pi,{expression:{value:Y}})}}(),_n(ze,{XPath:Fn,XPathParser:He,XPathResult:hi,Step:bt,PathExpr:Rn,NodeTest:dn,LocationPath:Cn,OrOperation:oe,AndOperation:Ge,BarOperation:xn,EqualsOperation:Be,NotEqualOperation:K,LessThanOperation:Me,GreaterThanOperation:$e,LessThanOrEqualOperation:Se,GreaterThanOrEqualOperation:Je,PlusOperation:lt,MinusOperation:cn,MultiplyOperation:Mt,DivOperation:xt,ModOperation:vn,UnaryMinusOperation:ye,FunctionCall:Wi,VariableReference:$t,XPathContext:Ur,XNodeSet:Tn,XBoolean:pn,XString:Pn,XNumber:ln,NamespaceResolver:Pr,FunctionResolver:Oi,VariableResolver:So,Utilities:hn}),ze.select=function(x,j,fe){return ze.selectWithResolver(x,j,null,fe)},ze.useNamespaces=function(x){var j={mappings:x||{},lookupNamespaceURI:function(fe){return this.mappings[fe]}};return function(fe,W,z){return ze.selectWithResolver(fe,W,j,z)}},ze.selectWithResolver=function(x,j,fe,W){var ne=new po(x,fe,new He).evaluate(j,hi.ANY_TYPE,null);return ne.resultType==hi.STRING_TYPE?ne=ne.stringValue:ne.resultType==hi.NUMBER_TYPE?ne=ne.numberValue:ne.resultType==hi.BOOLEAN_TYPE?ne=ne.booleanValue:(ne=ne.nodes,W&&(ne=ne[0])),ne},ze.select1=function(x,j){return ze.select(x,j,!0)}}(In)}},un=>{un(un.s=235)}]);