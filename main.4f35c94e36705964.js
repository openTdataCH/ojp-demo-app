(self.webpackChunkojp_demo_app=self.webpackChunkojp_demo_app||[]).push([[179],{2241:(rn,hn,qe)=>{"use strict";function be(n){return"function"==typeof n}function Me(n){const e=n(i=>{Error.call(i),i.stack=(new Error).stack});return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}const Te=Me(n=>function(e){n(this),this.message=e?`${e.length} errors occurred during unsubscription:\n${e.map((i,r)=>`${r+1}) ${i.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=e});function p(n,t){if(n){const e=n.indexOf(t);0<=e&&n.splice(e,1)}}class te{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;const{_parentage:e}=this;if(e)if(this._parentage=null,Array.isArray(e))for(const s of e)s.remove(this);else e.remove(this);const{initialTeardown:i}=this;if(be(i))try{i()}catch(s){t=s instanceof Te?s.errors:[s]}const{_finalizers:r}=this;if(r){this._finalizers=null;for(const s of r)try{Ve(s)}catch(d){t=null!=t?t:[],d instanceof Te?t=[...t,...d.errors]:t.push(d)}}if(t)throw new Te(t)}}add(t){var e;if(t&&t!==this)if(this.closed)Ve(t);else{if(t instanceof te){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(e=this._finalizers)&&void 0!==e?e:[]).push(t)}}_hasParent(t){const{_parentage:e}=this;return e===t||Array.isArray(e)&&e.includes(t)}_addParent(t){const{_parentage:e}=this;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t}_removeParent(t){const{_parentage:e}=this;e===t?this._parentage=null:Array.isArray(e)&&p(e,t)}remove(t){const{_finalizers:e}=this;e&&p(e,t),t instanceof te&&t._removeParent(this)}}te.EMPTY=(()=>{const n=new te;return n.closed=!0,n})();const Ye=te.EMPTY;function ne(n){return n instanceof te||n&&"closed"in n&&be(n.remove)&&be(n.add)&&be(n.unsubscribe)}function Ve(n){be(n)?n():n.unsubscribe()}const Xe={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},gt={setTimeout(n,t,...e){const{delegate:i}=gt;return null!=i&&i.setTimeout?i.setTimeout(n,t,...e):setTimeout(n,t,...e)},clearTimeout(n){const{delegate:t}=gt;return((null==t?void 0:t.clearTimeout)||clearTimeout)(n)},delegate:void 0};function wt(n){gt.setTimeout(()=>{const{onUnhandledError:t}=Xe;if(!t)throw n;t(n)})}function Ue(){}const Ge=_n("C",void 0,void 0);function _n(n,t,e){return{kind:n,value:t,error:e}}let Sn=null;function st(n){if(Xe.useDeprecatedSynchronousErrorHandling){const t=!Sn;if(t&&(Sn={errorThrown:!1,error:null}),n(),t){const{errorThrown:e,error:i}=Sn;if(Sn=null,e)throw i}}else n()}class we extends te{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,ne(t)&&t.add(this)):this.destination=mt}static create(t,e,i){return new dt(t,e,i)}next(t){this.isStopped?lt(function Kt(n){return _n("N",n,void 0)}(t),this):this._next(t)}error(t){this.isStopped?lt(function xt(n){return _n("E",void 0,n)}(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?lt(Ge,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const ye=Function.prototype.bind;function Ie(n,t){return ye.call(n,t)}class ae{constructor(t){this.partialObserver=t}next(t){const{partialObserver:e}=this;if(e.next)try{e.next(t)}catch(i){re(i)}}error(t){const{partialObserver:e}=this;if(e.error)try{e.error(t)}catch(i){re(i)}else re(t)}complete(){const{partialObserver:t}=this;if(t.complete)try{t.complete()}catch(e){re(e)}}}class dt extends we{constructor(t,e,i){let r;if(super(),be(t)||!t)r={next:null!=t?t:void 0,error:null!=e?e:void 0,complete:null!=i?i:void 0};else{let s;this&&Xe.useDeprecatedNextContext?(s=Object.create(t),s.unsubscribe=()=>this.unsubscribe(),r={next:t.next&&Ie(t.next,s),error:t.error&&Ie(t.error,s),complete:t.complete&&Ie(t.complete,s)}):r=t}this.destination=new ae(r)}}function re(n){Xe.useDeprecatedSynchronousErrorHandling?function an(n){Xe.useDeprecatedSynchronousErrorHandling&&Sn&&(Sn.errorThrown=!0,Sn.error=n)}(n):wt(n)}function lt(n,t){const{onStoppedNotification:e}=Xe;e&&gt.setTimeout(()=>e(n,t))}const mt={closed:!0,next:Ue,error:function me(n){throw n},complete:Ue},je="function"==typeof Symbol&&Symbol.observable||"@@observable";function yt(n){return n}function ri(n){return 0===n.length?yt:1===n.length?n[0]:function(e){return n.reduce((i,r)=>r(i),e)}}let kt=(()=>{class n{constructor(e){e&&(this._subscribe=e)}lift(e){const i=new n;return i.source=this,i.operator=e,i}subscribe(e,i,r){const s=function Li(n){return n&&n instanceof we||function Hi(n){return n&&be(n.next)&&be(n.error)&&be(n.complete)}(n)&&ne(n)}(e)?e:new dt(e,i,r);return st(()=>{const{operator:d,source:m}=this;s.add(d?d.call(s,m):m?this._subscribe(s):this._trySubscribe(s))}),s}_trySubscribe(e){try{return this._subscribe(e)}catch(i){e.error(i)}}forEach(e,i){return new(i=cn(i))((r,s)=>{const d=new dt({next:m=>{try{e(m)}catch(y){s(y),d.unsubscribe()}},error:s,complete:r});this.subscribe(d)})}_subscribe(e){var i;return null===(i=this.source)||void 0===i?void 0:i.subscribe(e)}[je](){return this}pipe(...e){return ri(e)(this)}toPromise(e){return new(e=cn(e))((i,r)=>{let s;this.subscribe(d=>s=d,d=>r(d),()=>i(s))})}}return n.create=t=>new n(t),n})();function cn(n){var t;return null!==(t=null!=n?n:Xe.Promise)&&void 0!==t?t:Promise}const yi=Me(n=>function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let Zt=(()=>{class n extends kt{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(e){const i=new xo(this,this);return i.operator=e,i}_throwIfClosed(){if(this.closed)throw new yi}next(e){st(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const i of this.currentObservers)i.next(e)}})}error(e){st(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=e;const{observers:i}=this;for(;i.length;)i.shift().error(e)}})}complete(){st(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:e}=this;for(;e.length;)e.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0}_trySubscribe(e){return this._throwIfClosed(),super._trySubscribe(e)}_subscribe(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)}_innerSubscribe(e){const{hasError:i,isStopped:r,observers:s}=this;return i||r?Ye:(this.currentObservers=null,s.push(e),new te(()=>{this.currentObservers=null,p(s,e)}))}_checkFinalizedStatuses(e){const{hasError:i,thrownError:r,isStopped:s}=this;i?e.error(r):s&&e.complete()}asObservable(){const e=new kt;return e.source=this,e}}return n.create=(t,e)=>new xo(t,e),n})();class xo extends Zt{constructor(t,e){super(),this.destination=t,this.source=e}next(t){var e,i;null===(i=null===(e=this.destination)||void 0===e?void 0:e.next)||void 0===i||i.call(e,t)}error(t){var e,i;null===(i=null===(e=this.destination)||void 0===e?void 0:e.error)||void 0===i||i.call(e,t)}complete(){var t,e;null===(e=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===e||e.call(t)}_subscribe(t){var e,i;return null!==(i=null===(e=this.source)||void 0===e?void 0:e.subscribe(t))&&void 0!==i?i:Ye}}function go(n){return be(null==n?void 0:n.lift)}function Di(n){return t=>{if(go(t))return t.lift(function(e){try{return n(e,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function Ci(n,t,e,i,r){return new fe(n,t,e,i,r)}class fe extends we{constructor(t,e,i,r,s,d){super(t),this.onFinalize=s,this.shouldUnsubscribe=d,this._next=e?function(m){try{e(m)}catch(y){t.error(y)}}:super._next,this._error=r?function(m){try{r(m)}catch(y){t.error(y)}finally{this.unsubscribe()}}:super._error,this._complete=i?function(){try{i()}catch(m){t.error(m)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:e}=this;super.unsubscribe(),!e&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}}}function W(n,t){return Di((e,i)=>{let r=0;e.subscribe(Ci(i,s=>{i.next(n.call(t,s,r++))}))})}function Ke(n,t,e,i){return new(e||(e=Promise))(function(s,d){function m(M){try{C(i.next(M))}catch(k){d(k)}}function y(M){try{C(i.throw(M))}catch(k){d(k)}}function C(M){M.done?s(M.value):function r(s){return s instanceof e?s:new e(function(d){d(s)})}(M.value).then(m,y)}C((i=i.apply(n,t||[])).next())})}function ds(n){return this instanceof ds?(this.v=n,this):new ds(n)}function _a(n,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=e.apply(n,t||[]),s=[];return r={},d("next"),d("throw"),d("return"),r[Symbol.asyncIterator]=function(){return this},r;function d(z){i[z]&&(r[z]=function(q){return new Promise(function(Q,xe){s.push([z,q,Q,xe])>1||m(z,q)})})}function m(z,q){try{!function y(z){z.value instanceof ds?Promise.resolve(z.value.v).then(C,M):k(s[0][2],z)}(i[z](q))}catch(Q){k(s[0][3],Q)}}function C(z){m("next",z)}function M(z){m("throw",z)}function k(z,q){z(q),s.shift(),s.length&&m(s[0][0],s[0][1])}}function Wl(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,t=n[Symbol.asyncIterator];return t?t.call(n):(n=function Si(n){var t="function"==typeof Symbol&&Symbol.iterator,e=t&&n[t],i=0;if(e)return e.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(n),e={},i("next"),i("throw"),i("return"),e[Symbol.asyncIterator]=function(){return this},e);function i(s){e[s]=n[s]&&function(d){return new Promise(function(m,y){!function r(s,d,m,y){Promise.resolve(y).then(function(C){s({value:C,done:m})},d)}(m,y,(d=n[s](d)).done,d.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const Ne=n=>n&&"number"==typeof n.length&&"function"!=typeof n;function ct(n){return be(null==n?void 0:n.then)}function Wt(n){return be(n[je])}function tn(n){return Symbol.asyncIterator&&be(null==n?void 0:n[Symbol.asyncIterator])}function Ut(n){return new TypeError(`You provided ${null!==n&&"object"==typeof n?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const pi=function ni(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function ti(n){return be(null==n?void 0:n[pi])}function fi(n){return _a(this,arguments,function*(){const e=n.getReader();try{for(;;){const{value:i,done:r}=yield ds(e.read());if(r)return yield ds(void 0);yield yield ds(i)}}finally{e.releaseLock()}})}function Ti(n){return be(null==n?void 0:n.getReader)}function Fi(n){if(n instanceof kt)return n;if(null!=n){if(Wt(n))return function lo(n){return new kt(t=>{const e=n[je]();if(be(e.subscribe))return e.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(n);if(Ne(n))return function Qo(n){return new kt(t=>{for(let e=0;e<n.length&&!t.closed;e++)t.next(n[e]);t.complete()})}(n);if(ct(n))return function bo(n){return new kt(t=>{n.then(e=>{t.closed||(t.next(e),t.complete())},e=>t.error(e)).then(null,wt)})}(n);if(tn(n))return wo(n);if(ti(n))return function Xa(n){return new kt(t=>{for(const e of n)if(t.next(e),t.closed)return;t.complete()})}(n);if(Ti(n))return function hs(n){return wo(fi(n))}(n)}throw Ut(n)}function wo(n){return new kt(t=>{(function hu(n,t){var e,i,r,s;return Ke(this,void 0,void 0,function*(){try{for(e=Wl(n);!(i=yield e.next()).done;)if(t.next(i.value),t.closed)return}catch(d){r={error:d}}finally{try{i&&!i.done&&(s=e.return)&&(yield s.call(e))}finally{if(r)throw r.error}}t.complete()})})(n,t).catch(e=>t.error(e))})}function _l(n,t,e,i=0,r=!1){const s=t.schedule(function(){e(),r?n.add(this.schedule(null,i)):this.unsubscribe()},i);if(n.add(s),!r)return s}function Gn(n,t,e=1/0){return be(t)?Gn((i,r)=>W((s,d)=>t(i,s,r,d))(Fi(n(i,r))),e):("number"==typeof t&&(e=t),Di((i,r)=>function Lm(n,t,e,i,r,s,d,m){const y=[];let C=0,M=0,k=!1;const z=()=>{k&&!y.length&&!C&&t.complete()},q=xe=>C<i?Q(xe):y.push(xe),Q=xe=>{s&&t.next(xe),C++;let De=!1;Fi(e(xe,M++)).subscribe(Ci(t,Ze=>{null==r||r(Ze),s?q(Ze):t.next(Ze)},()=>{De=!0},void 0,()=>{if(De)try{for(C--;y.length&&C<i;){const Ze=y.shift();d?_l(t,d,()=>Q(Ze)):Q(Ze)}z()}catch(Ze){t.error(Ze)}}))};return n.subscribe(Ci(t,q,()=>{k=!0,z()})),()=>{null==m||m()}}(i,r,n,e)))}function Xl(n=1/0){return Gn(yt,n)}const ps=new kt(n=>n.complete());function ya(n){return n&&be(n.schedule)}function va(n){return n[n.length-1]}function Eh(n){return be(va(n))?n.pop():void 0}function kc(n){return ya(va(n))?n.pop():void 0}function Za(n,t=0){return Di((e,i)=>{e.subscribe(Ci(i,r=>_l(i,n,()=>i.next(r),t),()=>_l(i,n,()=>i.complete(),t),r=>_l(i,n,()=>i.error(r),t)))})}function pu(n,t=0){return Di((e,i)=>{i.add(n.schedule(()=>e.subscribe(i),t))})}function $p(n,t){if(!n)throw new Error("Iterable cannot be null");return new kt(e=>{_l(e,t,()=>{const i=n[Symbol.asyncIterator]();_l(e,t,()=>{i.next().then(r=>{r.done?e.complete():e.next(r.value)})},0,!0)})})}function eo(n,t){return t?function Gp(n,t){if(null!=n){if(Wt(n))return function bt(n,t){return Fi(n).pipe(pu(t),Za(t))}(n,t);if(Ne(n))return function co(n,t){return new kt(e=>{let i=0;return t.schedule(function(){i===n.length?e.complete():(e.next(n[i++]),e.closed||this.schedule())})})}(n,t);if(ct(n))return function yl(n,t){return Fi(n).pipe(pu(t),Za(t))}(n,t);if(tn(n))return $p(n,t);if(ti(n))return function Ro(n,t){return new kt(e=>{let i;return _l(e,t,()=>{i=n[pi](),_l(e,t,()=>{let r,s;try{({value:r,done:s}=i.next())}catch(d){return void e.error(d)}s?e.complete():e.next(r)},0,!0)}),()=>be(null==i?void 0:i.return)&&i.return()})}(n,t);if(Ti(n))return function Ya(n,t){return $p(fi(n),t)}(n,t)}throw Ut(n)}(n,t):Fi(n)}function Er(...n){const t=kc(n),e=function Rc(n,t){return"number"==typeof va(n)?n.pop():t}(n,1/0),i=n;return i.length?1===i.length?Fi(i[0]):Xl(e)(eo(i,t)):ps}function un(n={}){const{connector:t=(()=>new Zt),resetOnError:e=!0,resetOnComplete:i=!0,resetOnRefCountZero:r=!0}=n;return s=>{let d,m,y,C=0,M=!1,k=!1;const z=()=>{null==m||m.unsubscribe(),m=void 0},q=()=>{z(),d=y=void 0,M=k=!1},Q=()=>{const xe=d;q(),null==xe||xe.unsubscribe()};return Di((xe,De)=>{C++,!k&&!M&&z();const Ze=y=null!=y?y:t();De.add(()=>{C--,0===C&&!k&&!M&&(m=xi(Q,r))}),Ze.subscribe(De),!d&&C>0&&(d=new dt({next:It=>Ze.next(It),error:It=>{k=!0,z(),m=xi(q,e,It),Ze.error(It)},complete:()=>{M=!0,z(),m=xi(q,i),Ze.complete()}}),Fi(xe).subscribe(d))})(s)}}function xi(n,t,...e){if(!0===t)return void n();if(!1===t)return;const i=new dt({next:()=>{i.unsubscribe(),n()}});return t(...e).subscribe(i)}function Cn(n){for(let t in n)if(n[t]===Cn)return t;throw Error("Could not find renamed property on target object.")}function fs(n,t){for(const e in t)t.hasOwnProperty(e)&&!n.hasOwnProperty(e)&&(n[e]=t[e])}function zi(n){if("string"==typeof n)return n;if(Array.isArray(n))return"["+n.map(zi).join(", ")+"]";if(null==n)return""+n;if(n.overriddenName)return`${n.overriddenName}`;if(n.name)return`${n.name}`;const t=n.toString();if(null==t)return""+t;const e=t.indexOf("\n");return-1===e?t:t.substring(0,e)}function mi(n,t){return null==n||""===n?null===t?"":t:null==t||""===t?n:n+" "+t}const $s=Cn({__forward_ref__:Cn});function Ni(n){return n.__forward_ref__=Ni,n.toString=function(){return zi(this())},n}function Hn(n){return As(n)?n():n}function As(n){return"function"==typeof n&&n.hasOwnProperty($s)&&n.__forward_ref__===Ni}class Ot extends Error{constructor(t,e){super(function sa(n,t){return`NG0${Math.abs(n)}${t?": "+t.trim():""}`}(t,e)),this.code=t}}function ii(n){return"string"==typeof n?n:null==n?"":String(n)}function Zl(n,t){throw new Ot(-201,!1)}function So(n,t){null==n&&function ci(n,t,e,i){throw new Error(`ASSERTION ERROR: ${n}`+(null==i?"":` [Expected=> ${e} ${i} ${t} <=Actual]`))}(t,n,null,"!=")}function Jt(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function wn(n){return{providers:n.providers||[],imports:n.imports||[]}}function fu(n){return Sa(n,Kl)||Sa(n,md)}function Sa(n,t){return n.hasOwnProperty(t)?n[t]:null}function Ka(n){return n&&(n.hasOwnProperty(Ca)||n.hasOwnProperty(gu))?n[Ca]:null}const Kl=Cn({\u0275prov:Cn}),Ca=Cn({\u0275inj:Cn}),md=Cn({ngInjectableDef:Cn}),gu=Cn({ngInjectorDef:Cn});var Un=(()=>((Un=Un||{})[Un.Default=0]="Default",Un[Un.Host=1]="Host",Un[Un.Self=2]="Self",Un[Un.SkipSelf=4]="SkipSelf",Un[Un.Optional=8]="Optional",Un))();let Dh;function Rs(n){const t=Dh;return Dh=n,t}function Mh(n,t,e){const i=fu(n);return i&&"root"==i.providedIn?void 0===i.value?i.value=i.factory():i.value:e&Un.Optional?null:void 0!==t?t:void Zl(zi(n))}function Ei(n){return{toString:n}.toString()}var Ta=(()=>((Ta=Ta||{})[Ta.OnPush=0]="OnPush",Ta[Ta.Default=1]="Default",Ta))(),qs=(()=>{return(n=qs||(qs={}))[n.Emulated=0]="Emulated",n[n.None=2]="None",n[n.ShadowDom=3]="ShadowDom",qs;var n})();const Lr=(()=>"undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof global&&global||"undefined"!=typeof window&&window||"undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self)(),vl={},$i=[],aa=Cn({\u0275cmp:Cn}),xl=Cn({\u0275dir:Cn}),bu=Cn({\u0275pipe:Cn}),Zp=Cn({\u0275mod:Cn}),Ws=Cn({\u0275fac:Cn}),Lc=Cn({__NG_ELEMENT_ID__:Cn});let Yp=0;function vn(n){return Ei(()=>{const e=!0===n.standalone,i={},r={type:n.type,providersResolver:null,decls:n.decls,vars:n.vars,factory:null,template:n.template||null,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:i,inputs:null,outputs:null,exportAs:n.exportAs||null,onPush:n.changeDetection===Ta.OnPush,directiveDefs:null,pipeDefs:null,standalone:e,dependencies:e&&n.dependencies||null,getStandaloneInjector:null,selectors:n.selectors||$i,viewQuery:n.viewQuery||null,features:n.features||null,data:n.data||{},encapsulation:n.encapsulation||qs.Emulated,id:"c"+Yp++,styles:n.styles||$i,_:null,setInput:null,schemas:n.schemas||null,tView:null},s=n.dependencies,d=n.features;return r.inputs=Rh(n.inputs,i),r.outputs=Rh(n.outputs),d&&d.forEach(m=>m(r)),r.directiveDefs=s?()=>("function"==typeof s?s():s).map(kh).filter(Bi):null,r.pipeDefs=s?()=>("function"==typeof s?s():s).map(gs).filter(Bi):null,r})}function kh(n){return hr(n)||ms(n)}function Bi(n){return null!==n}function xn(n){return Ei(()=>({type:n.type,bootstrap:n.bootstrap||$i,declarations:n.declarations||$i,imports:n.imports||$i,exports:n.exports||$i,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null}))}function Rh(n,t){if(null==n)return vl;const e={};for(const i in n)if(n.hasOwnProperty(i)){let r=n[i],s=r;Array.isArray(r)&&(s=r[1],r=r[0]),e[r]=i,t&&(t[r]=s)}return e}const Lt=vn;function _o(n){return{type:n.type,name:n.name,factory:null,pure:!1!==n.pure,standalone:!0===n.standalone,onDestroy:n.type.prototype.ngOnDestroy||null}}function hr(n){return n[aa]||null}function ms(n){return n[xl]||null}function gs(n){return n[bu]||null}function bs(n,t){const e=n[Zp]||null;if(!e&&!0===t)throw new Error(`Type ${zi(n)} does not have '\u0275mod' property.`);return e}function Ps(n){return Array.isArray(n)&&"object"==typeof n[1]}function Ea(n){return Array.isArray(n)&&!0===n[1]}function Kp(n){return 0!=(8&n.flags)}function Lh(n){return 2==(2&n.flags)}function Sd(n){return 1==(1&n.flags)}function Ls(n){return null!==n.template}function xu(n){return 0!=(256&n[2])}function la(n,t){return n.hasOwnProperty(Ws)?n[Ws]:null}class rf{constructor(t,e,i){this.previousValue=t,this.currentValue=e,this.firstChange=i}isFirstChange(){return this.firstChange}}function cr(){return Su}function Su(n){return n.type.prototype.ngOnChanges&&(n.setInput=Bh),Nh}function Nh(){const n=ca(this),t=null==n?void 0:n.current;if(t){const e=n.previous;if(e===vl)n.previous=t;else for(let i in t)e[i]=t[i];n.current=null,this.ngOnChanges(t)}}function Bh(n,t,e,i){const r=ca(n)||function $m(n,t){return n[pn]=t}(n,{previous:vl,current:null}),s=r.current||(r.current={}),d=r.previous,m=this.declaredInputs[e],y=d[m];s[m]=new rf(y&&y.currentValue,t,d===vl),n[i]=t}cr.ngInherit=!0;const pn="__ngSimpleChanges__";function ca(n){return n[pn]||null}function Zr(n){for(;Array.isArray(n);)n=n[0];return n}function jh(n,t){return Zr(t[n])}function Os(n,t){return Zr(t[n.index])}function Ad(n,t){return n.data[t]}function ec(n,t){return n[t]}function ys(n,t){const e=t[n];return Ps(e)?e:e[0]}function tc(n){return 64==(64&n[2])}function tl(n,t){return null==t?null:n[t]}function sf(n){n[18]=0}function Rd(n,t){n[5]+=t;let e=n,i=n[3];for(;null!==i&&(1===t&&1===e[5]||-1===t&&0===e[5]);)i[5]+=t,e=i,i=i[3]}const di={lFrame:c(null),bindingsEnabled:!0};function Hh(){return di.bindingsEnabled}function At(){return di.lFrame.lView}function tr(){return di.lFrame.tView}function Mi(n){return di.lFrame.contextLView=n,n[8]}function Ai(n){return di.lFrame.contextLView=null,n}function Co(){let n=Xs();for(;null!==n&&64===n.type;)n=n.parent;return n}function Xs(){return di.lFrame.currentTNode}function nl(n,t){const e=di.lFrame;e.currentTNode=n,e.isParent=t}function Zs(){return di.lFrame.isParent}function ua(){di.lFrame.isParent=!1}function jo(){const n=di.lFrame;let t=n.bindingRootIndex;return-1===t&&(t=n.bindingRootIndex=n.tView.bindingStartIndex),t}function on(){return di.lFrame.bindingIndex++}function Ma(n){const t=di.lFrame,e=t.bindingIndex;return t.bindingIndex=t.bindingIndex+n,e}function lf(n,t){const e=di.lFrame;e.bindingIndex=e.bindingRootIndex=n,qh(t)}function qh(n){di.lFrame.currentDirectiveIndex=n}function cf(n){const t=di.lFrame.currentDirectiveIndex;return-1===t?null:n[t]}function Km(){return di.lFrame.currentQueryIndex}function Pd(n){di.lFrame.currentQueryIndex=n}function uf(n){const t=n[1];return 2===t.type?t.declTNode:1===t.type?n[6]:null}function Wh(n,t,e){if(e&Un.SkipSelf){let r=t,s=n;for(;!(r=r.parent,null!==r||e&Un.Host||(r=uf(s),null===r||(s=s[15],10&r.type))););if(null===r)return!1;t=r,n=s}const i=di.lFrame=g();return i.currentTNode=t,i.lView=n,!0}function ic(n){const t=g(),e=n[1];di.lFrame=t,t.currentTNode=e.firstChild,t.lView=n,t.tView=e,t.contextLView=n,t.bindingIndex=e.bindingStartIndex,t.inI18n=!1}function g(){const n=di.lFrame,t=null===n?null:n.child;return null===t?c(n):t}function c(n){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return null!==n&&(n.child=t),t}function h(){const n=di.lFrame;return di.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}const _=h;function x(){const n=h();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function I(){return di.lFrame.selectedIndex}function R(n){di.lFrame.selectedIndex=n}function O(){const n=di.lFrame;return Ad(n.tView,n.selectedIndex)}function F(){di.lFrame.currentNamespace="svg"}function Y(){!function ee(){di.lFrame.currentNamespace=null}()}function le(n,t){for(let e=t.directiveStart,i=t.directiveEnd;e<i;e++){const s=n.data[e].type.prototype,{ngAfterContentInit:d,ngAfterContentChecked:m,ngAfterViewInit:y,ngAfterViewChecked:C,ngOnDestroy:M}=s;d&&(n.contentHooks||(n.contentHooks=[])).push(-e,d),m&&((n.contentHooks||(n.contentHooks=[])).push(e,m),(n.contentCheckHooks||(n.contentCheckHooks=[])).push(e,m)),y&&(n.viewHooks||(n.viewHooks=[])).push(-e,y),C&&((n.viewHooks||(n.viewHooks=[])).push(e,C),(n.viewCheckHooks||(n.viewCheckHooks=[])).push(e,C)),null!=M&&(n.destroyHooks||(n.destroyHooks=[])).push(e,M)}}function U(n,t,e){ge(n,t,3,e)}function J(n,t,e,i){(3&n[2])===e&&ge(n,t,e,i)}function pe(n,t){let e=n[2];(3&e)===t&&(e&=2047,e+=1,n[2]=e)}function ge(n,t,e,i){const s=null!=i?i:-1,d=t.length-1;let m=0;for(let y=void 0!==i?65535&n[18]:0;y<d;y++)if("number"==typeof t[y+1]){if(m=t[y],null!=i&&m>=i)break}else t[y]<0&&(n[18]+=65536),(m<s||-1==s)&&(Fe(n,e,t,y),n[18]=(4294901760&n[18])+y+2),y++}function Fe(n,t,e,i){const r=e[i]<0,s=e[i+1],m=n[r?-e[i]:e[i]];if(r){if(n[2]>>11<n[18]>>16&&(3&n[2])===t){n[2]+=2048;try{s.call(m)}finally{}}}else try{s.call(m)}finally{}}class Oe{constructor(t,e,i){this.factory=t,this.resolving=!1,this.canSeeViewProviders=e,this.injectImpl=i}}function it(n,t,e){let i=0;for(;i<e.length;){const r=e[i];if("number"==typeof r){if(0!==r)break;i++;const s=e[i++],d=e[i++],m=e[i++];n.setAttribute(t,d,m,s)}else{const s=r,d=e[++i];Bt(s)?n.setProperty(t,s,d):n.setAttribute(t,s,d),i++}}return i}function vt(n){return 3===n||4===n||6===n}function Bt(n){return 64===n.charCodeAt(0)}function Mt(n,t){if(null!==t&&0!==t.length)if(null===n||0===n.length)n=t.slice();else{let e=-1;for(let i=0;i<t.length;i++){const r=t[i];"number"==typeof r?e=r:0===e||Vt(n,e,r,null,-1===e||2===e?t[++i]:null)}}return n}function Vt(n,t,e,i,r){let s=0,d=n.length;if(-1===t)d=-1;else for(;s<n.length;){const m=n[s++];if("number"==typeof m){if(m===t){d=-1;break}if(m>t){d=s-1;break}}}for(;s<n.length;){const m=n[s];if("number"==typeof m)break;if(m===e){if(null===i)return void(null!==r&&(n[s+1]=r));if(i===n[s+1])return void(n[s+2]=r)}s++,null!==i&&s++,null!==r&&s++}-1!==d&&(n.splice(d,0,t),s=d+1),n.splice(s++,0,e),null!==i&&n.splice(s++,0,i),null!==r&&n.splice(s++,0,r)}function In(n){return-1!==n}function zn(n){return 32767&n}function An(n,t){let e=function bn(n){return n>>16}(n),i=t;for(;e>0;)i=i[15],e--;return i}let gi=!0;function oi(n){const t=gi;return gi=n,t}let _r=0;const ki={};function io(n,t){const e=da(n,t);if(-1!==e)return e;const i=t[1];i.firstCreatePass&&(n.injectorIndex=t.length,Ns(i.data,n),Ns(t,null),Ns(i.blueprint,null));const r=Ir(n,t),s=n.injectorIndex;if(In(r)){const d=zn(r),m=An(r,t),y=m[1].data;for(let C=0;C<8;C++)t[s+C]=m[d+C]|y[d+C]}return t[s+8]=r,s}function Ns(n,t){n.push(0,0,0,0,0,0,0,0,t)}function da(n,t){return-1===n.injectorIndex||n.parent&&n.parent.injectorIndex===n.injectorIndex||null===t[n.injectorIndex+8]?-1:n.injectorIndex}function Ir(n,t){if(n.parent&&-1!==n.parent.injectorIndex)return n.parent.injectorIndex;let e=0,i=null,r=t;for(;null!==r;){if(i=Hv(r),null===i)return-1;if(e++,r=r[15],-1!==i.injectorIndex)return i.injectorIndex|e<<16}return-1}function or(n,t,e){!function ns(n,t,e){let i;"string"==typeof e?i=e.charCodeAt(0)||0:e.hasOwnProperty(Lc)&&(i=e[Lc]),null==i&&(i=e[Lc]=_r++);const r=255&i;t.data[n+(r>>5)]|=1<<r}(n,t,e)}function ro(n,t,e){if(e&Un.Optional||void 0!==n)return n;Zl()}function is(n,t,e,i){if(e&Un.Optional&&void 0===i&&(i=null),0==(e&(Un.Self|Un.Host))){const r=n[9],s=Rs(void 0);try{return r?r.get(t,i,e&Un.Optional):Mh(t,i,e&Un.Optional)}finally{Rs(s)}}return ro(i,0,e)}function Rr(n,t,e,i=Un.Default,r){if(null!==n){if(1024&t[2]){const d=function Uv(n,t,e,i,r){let s=n,d=t;for(;null!==s&&null!==d&&1024&d[2]&&!(256&d[2]);){const m=vs(s,d,e,i|Un.Self,ki);if(m!==ki)return m;let y=s.parent;if(!y){const C=d[21];if(C){const M=C.get(e,ki,i);if(M!==ki)return M}y=Hv(d),d=d[15]}s=y}return r}(n,t,e,i,ki);if(d!==ki)return d}const s=vs(n,t,e,i,ki);if(s!==ki)return s}return is(t,e,i,r)}function vs(n,t,e,i,r){const s=function El(n){if("string"==typeof n)return n.charCodeAt(0)||0;const t=n.hasOwnProperty(Lc)?n[Lc]:void 0;return"number"==typeof t?t>=0?255&t:Ld:t}(e);if("function"==typeof s){if(!Wh(t,n,i))return i&Un.Host?ro(r,0,i):is(t,e,i,r);try{const d=s(i);if(null!=d||i&Un.Optional)return d;Zl()}finally{_()}}else if("number"==typeof s){let d=null,m=da(n,t),y=-1,C=i&Un.Host?t[16][6]:null;for((-1===m||i&Un.SkipSelf)&&(y=-1===m?Ir(n,t):t[m+8],-1!==y&&rc(i,!1)?(d=t[1],m=zn(y),t=An(y,t)):m=-1);-1!==m;){const M=t[1];if(Dl(s,m,M.data)){const k=Xh(m,t,e,d,i,C);if(k!==ki)return k}y=t[m+8],-1!==y&&rc(i,t[1].data[m+8]===C)&&Dl(s,m,t)?(d=M,m=zn(y),t=An(y,t)):m=-1}}return r}function Xh(n,t,e,i,r,s){const d=t[1],m=d.data[n+8],M=il(m,d,e,null==i?Lh(m)&&gi:i!=d&&0!=(3&m.type),r&Un.Host&&s===m);return null!==M?Tl(t,d,M,m):ki}function il(n,t,e,i,r){const s=n.providerIndexes,d=t.data,m=1048575&s,y=n.directiveStart,M=s>>20,z=r?m+M:n.directiveEnd;for(let q=i?m:m+M;q<z;q++){const Q=d[q];if(q<y&&e===Q||q>=y&&Q.type===e)return q}if(r){const q=d[y];if(q&&Ls(q)&&q.type===e)return y}return null}function Tl(n,t,e,i){let r=n[e];const s=t.data;if(function We(n){return n instanceof Oe}(r)){const d=r;d.resolving&&function qp(n,t){const e=t?`. Dependency path: ${t.join(" > ")} > ${n}`:"";throw new Ot(-200,`Circular dependency in DI detected for ${n}${e}`)}(function Xi(n){return"function"==typeof n?n.name||n.toString():"object"==typeof n&&null!=n&&"function"==typeof n.type?n.type.name||n.type.toString():ii(n)}(s[e]));const m=oi(d.canSeeViewProviders);d.resolving=!0;const y=d.injectImpl?Rs(d.injectImpl):null;Wh(n,i,Un.Default);try{r=n[e]=d.factory(void 0,s,n,i),t.firstCreatePass&&e>=i.directiveStart&&function ie(n,t,e){const{ngOnChanges:i,ngOnInit:r,ngDoCheck:s}=t.type.prototype;if(i){const d=Su(t);(e.preOrderHooks||(e.preOrderHooks=[])).push(n,d),(e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(n,d)}r&&(e.preOrderHooks||(e.preOrderHooks=[])).push(0-n,r),s&&((e.preOrderHooks||(e.preOrderHooks=[])).push(n,s),(e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(n,s))}(e,s[e],t)}finally{null!==y&&Rs(y),oi(m),d.resolving=!1,_()}}return r}function Dl(n,t,e){return!!(e[t+(n>>5)]&1<<n)}function rc(n,t){return!(n&Un.Self||n&Un.Host&&t)}class Il{constructor(t,e){this._tNode=t,this._lView=e}get(t,e,i){return Rr(this._tNode,this._lView,t,i,e)}}function Ld(){return new Il(Co(),At())}function Vi(n){return Ei(()=>{const t=n.prototype.constructor,e=t[Ws]||Qm(t),i=Object.prototype;let r=Object.getPrototypeOf(n.prototype).constructor;for(;r&&r!==i;){const s=r[Ws]||Qm(r);if(s&&s!==e)return s;r=Object.getPrototypeOf(r)}return s=>new s})}function Qm(n){return As(n)?()=>{const t=Qm(Hn(n));return t&&t()}:la(n)}function Hv(n){const t=n[1],e=t.type;return 2===e?t.declTNode:1===e?n[6]:null}function Uo(n){return function Yi(n,t){if("class"===t)return n.classes;if("style"===t)return n.styles;const e=n.attrs;if(e){const i=e.length;let r=0;for(;r<i;){const s=e[r];if(vt(s))break;if(0===s)r+=2;else if("number"==typeof s)for(r++;r<i&&"string"==typeof e[r];)r++;else{if(s===t)return e[r+1];r+=2}}}return null}(Co(),n)}const Od="__parameters__";function Hc(n,t,e){return Ei(()=>{const i=function Ml(n){return function(...e){if(n){const i=n(...e);for(const r in i)this[r]=i[r]}}}(t);function r(...s){if(this instanceof r)return i.apply(this,s),this;const d=new r(...s);return m.annotation=d,m;function m(y,C,M){const k=y.hasOwnProperty(Od)?y[Od]:Object.defineProperty(y,Od,{value:[]})[Od];for(;k.length<=M;)k.push(null);return(k[M]=k[M]||[]).push(d),y}}return e&&(r.prototype=Object.create(e.prototype)),r.prototype.ngMetadataName=n,r.annotationCls=r,r})}class Et{constructor(t,e){this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof e?this.__NG_ELEMENT_ID__=e:void 0!==e&&(this.\u0275prov=Jt({token:this,providedIn:e.providedIn||"root",factory:e.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function ha(n,t){void 0===t&&(t=n);for(let e=0;e<n.length;e++){let i=n[e];Array.isArray(i)?(t===n&&(t=n.slice(0,e)),ha(i,t)):t!==n&&t.push(i)}return t}function $o(n,t){n.forEach(e=>Array.isArray(e)?$o(e,t):t(e))}function Wv(n,t,e){t>=n.length?n.push(e):n.splice(t,0,e)}function eg(n,t){return t>=n.length-1?n.pop():n.splice(t,1)[0]}function Hr(n,t){const e=[];for(let i=0;i<n;i++)e.push(t);return e}function ho(n,t,e){let i=ol(n,t);return i>=0?n[1|i]=e:(i=~i,function tg(n,t,e,i){let r=n.length;if(r==t)n.push(e,i);else if(1===r)n.push(i,n[0]),n[0]=e;else{for(r--,n.push(n[r-1],n[r]);r>t;)n[r]=n[r-2],r--;n[t]=e,n[t+1]=i}}(n,i,t,e)),i}function ff(n,t){const e=ol(n,t);if(e>=0)return n[1|e]}function ol(n,t){return function ku(n,t,e){let i=0,r=n.length>>e;for(;r!==i;){const s=i+(r-i>>1),d=n[s<<e];if(t===d)return s<<e;d>t?r=s:i=s+1}return~(r<<e)}(n,t,1)}const ka={},gf="__NG_DI_FLAG__",bf="ngTempTokenPath",yf=/\n/gm,Yh="__source";let Po;function xs(n){const t=Po;return Po=n,t}function __(n,t=Un.Default){if(void 0===Po)throw new Ot(-203,!1);return null===Po?Mh(n,void 0,t):Po.get(n,t&Un.Optional?null:void 0,t)}function ze(n,t=Un.Default){return(function Ih(){return Dh}()||__)(Hn(n),t)}function Fr(n,t=Un.Default){return"number"!=typeof t&&(t=0|(t.optional&&8)|(t.host&&1)|(t.self&&2)|(t.skipSelf&&4)),ze(n,t)}function Pa(n){const t=[];for(let e=0;e<n.length;e++){const i=Hn(n[e]);if(Array.isArray(i)){if(0===i.length)throw new Ot(900,!1);let r,s=Un.Default;for(let d=0;d<i.length;d++){const m=i[d],y=qS(m);"number"==typeof y?-1===y?r=m.token:s|=y:r=m}t.push(ze(r,s))}else t.push(ze(i))}return t}function vf(n,t){return n[gf]=t,n.prototype[gf]=t,n}function qS(n){return n[gf]}const Kh=vf(Hc("Optional"),8),Qh=vf(Hc("SkipSelf"),4);var Ks=(()=>((Ks=Ks||{})[Ks.Important=1]="Important",Ks[Ks.DashCase=2]="DashCase",Ks))();const ac=new Map;let yr=0;const pg="__ngContext__";function To(n,t){Ps(t)?(n[pg]=t[20],function lc(n){ac.set(n[20],n)}(t)):n[pg]=t}function bg(n,t){return undefined(n,t)}function Ud(n){const t=n[3];return Ea(t)?t[3]:t}function _g(n){return Ou(n[13])}function yg(n){return Ou(n[4])}function Ou(n){for(;null!==n&&!Ea(n);)n=n[4];return n}function Jh(n,t,e,i,r){if(null!=i){let s,d=!1;Ea(i)?s=i:Ps(i)&&(d=!0,i=i[0]);const m=Zr(i);0===n&&null!==e?null==r?d0(t,e,m):Xc(t,e,m,r||null,!0):1===n&&null!==e?Xc(t,e,m,r||null,!0):2===n?function Rf(n,t,e){const i=Hd(n,t);i&&function s1(n,t,e,i){n.removeChild(t,e,i)}(n,i,t,e)}(t,m,d):3===n&&t.destroyNode(m),null!=s&&function Tg(n,t,e,i,r){const s=e[7];s!==Zr(e)&&Jh(t,n,i,s,r);for(let m=10;m<e.length;m++){const y=e[m];cc(y[1],y,n,t,i,s)}}(t,n,s,e,r)}}function vg(n,t,e){return n.createElement(t,e)}function c0(n,t){const e=n[9],i=e.indexOf(t),r=t[3];512&t[2]&&(t[2]&=-513,Rd(r,-1)),e.splice(i,1)}function xg(n,t){if(n.length<=10)return;const e=10+t,i=n[e];if(i){const r=i[17];null!==r&&r!==n&&c0(r,i),t>0&&(n[e-1][4]=i[4]);const s=eg(n,10+t);!function t1(n,t){cc(n,t,t[11],2,null,null),t[0]=null,t[6]=null}(i[1],i);const d=s[19];null!==d&&d.detachView(s[1]),i[3]=null,i[4]=null,i[2]&=-65}return i}function L_(n,t){if(!(128&t[2])){const e=t[11];e.destroyNode&&cc(n,t,e,3,null,null),function r1(n){let t=n[13];if(!t)return wg(n[1],n);for(;t;){let e=null;if(Ps(t))e=t[13];else{const i=t[10];i&&(e=i)}if(!e){for(;t&&!t[4]&&t!==n;)Ps(t)&&wg(t[1],t),t=t[3];null===t&&(t=n),Ps(t)&&wg(t[1],t),e=t&&t[4]}t=e}}(t)}}function wg(n,t){if(!(128&t[2])){t[2]&=-65,t[2]|=128,function Wc(n,t){let e;if(null!=n&&null!=(e=n.destroyHooks))for(let i=0;i<e.length;i+=2){const r=t[e[i]];if(!(r instanceof Oe)){const s=e[i+1];if(Array.isArray(s))for(let d=0;d<s.length;d+=2){const m=r[s[d]],y=s[d+1];try{y.call(m)}finally{}}else try{s.call(r)}finally{}}}}(n,t),function O_(n,t){const e=n.cleanup,i=t[7];let r=-1;if(null!==e)for(let s=0;s<e.length-1;s+=2)if("string"==typeof e[s]){const d=e[s+1],m="function"==typeof d?d(t):Zr(t[d]),y=i[r=e[s+2]],C=e[s+3];"boolean"==typeof C?m.removeEventListener(e[s],y,C):C>=0?i[r=C]():i[r=-C].unsubscribe(),s+=2}else{const d=i[r=e[s+1]];e[s].call(d)}if(null!==i){for(let s=r+1;s<i.length;s++)(0,i[s])();t[7]=null}}(n,t),1===t[1].type&&t[11].destroy();const e=t[17];if(null!==e&&Ea(t[3])){e!==t[3]&&c0(e,t);const i=t[19];null!==i&&i.detachView(n)}!function kl(n){ac.delete(n[20])}(t)}}function Qs(n,t,e){return function u0(n,t,e){let i=t;for(;null!==i&&40&i.type;)i=(t=i).parent;if(null===i)return e[0];if(2&i.flags){const r=n.data[i.directiveStart].encapsulation;if(r===qs.None||r===qs.Emulated)return null}return Os(i,e)}(n,t.parent,e)}function Xc(n,t,e,i,r){n.insertBefore(t,e,i,r)}function d0(n,t,e){n.appendChild(t,e)}function h0(n,t,e,i,r){null!==i?Xc(n,t,e,i,r):d0(n,t,e)}function Hd(n,t){return n.parentNode(t)}function Nu(n,t,e){return m0(n,t,e)}let Bu,j_,m0=function ep(n,t,e){return 40&n.type?Os(n,e):null};function Sg(n,t,e,i){const r=Qs(n,i,t),s=t[11],m=Nu(i.parent||t[6],i,t);if(null!=r)if(Array.isArray(e))for(let y=0;y<e.length;y++)h0(s,r,e[y],m,!1);else h0(s,r,e,m,!1)}function Cg(n,t){if(null!==t){const e=t.type;if(3&e)return Os(t,n);if(4&e)return N_(-1,n[t.index]);if(8&e){const i=t.child;if(null!==i)return Cg(n,i);{const r=n[t.index];return Ea(r)?N_(-1,r):Zr(r)}}if(32&e)return bg(t,n)()||Zr(n[t.index]);{const i=b0(n,t);return null!==i?Array.isArray(i)?i[0]:Cg(Ud(n[16]),i):Cg(n,t.next)}}return null}function b0(n,t){return null!==t?n[16][6].projection[t.projection]:null}function N_(n,t){const e=10+n+1;if(e<t.length){const i=t[e],r=i[1].firstChild;if(null!==r)return Cg(i,r)}return t[7]}function B_(n,t,e,i,r,s,d){for(;null!=e;){const m=i[e.index],y=e.type;if(d&&0===t&&(m&&To(Zr(m),i),e.flags|=4),64!=(64&e.flags))if(8&y)B_(n,t,e.child,i,r,s,!1),Jh(t,n,r,m,s);else if(32&y){const C=bg(e,i);let M;for(;M=C();)Jh(t,n,r,M,s);Jh(t,n,r,m,s)}else 16&y?oo(n,t,i,e,r,s):Jh(t,n,r,m,s);e=d?e.projectionNext:e.next}}function cc(n,t,e,i,r,s){B_(e,i,n.firstChild,t,r,s,!1)}function oo(n,t,e,i,r,s){const d=e[16],y=d[6].projection[i.projection];if(Array.isArray(y))for(let C=0;C<y.length;C++)Jh(t,n,r,y[C],s);else B_(n,t,y,d[3],r,s,!0)}function Pf(n,t,e){n.setAttribute(t,"style",e)}function tp(n,t,e){""===e?n.removeAttribute(t,"class"):n.setAttribute(t,"class",e)}function zu(n){var t;return(null===(t=function Eg(){if(void 0===Bu&&(Bu=null,Lr.trustedTypes))try{Bu=Lr.trustedTypes.createPolicy("angular",{createHTML:n=>n,createScript:n=>n,createScriptURL:n=>n})}catch(n){}return Bu}())||void 0===t?void 0:t.createHTML(n))||n}class uc{constructor(t){this.changingThisBreaksApplicationSecurity=t}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}class l1 extends uc{getTypeName(){return"HTML"}}class c1 extends uc{getTypeName(){return"Style"}}class u1 extends uc{getTypeName(){return"Script"}}class d1 extends uc{getTypeName(){return"URL"}}class h1 extends uc{getTypeName(){return"ResourceURL"}}function Oa(n){return n instanceof uc?n.changingThisBreaksApplicationSecurity:n}function Fa(n,t){const e=function p1(n){return n instanceof uc&&n.getTypeName()||null}(n);if(null!=e&&e!==t){if("ResourceURL"===e&&"URL"===t)return!0;throw new Error(`Required a safe ${t}, got a ${e} (see https://g.co/ng/security#xss)`)}return e===t}class S0{constructor(t){this.inertDocumentHelper=t}getInertBodyElement(t){t="<body><remove></remove>"+t;try{const e=(new window.DOMParser).parseFromString(zu(t),"text/html").body;return null===e?this.inertDocumentHelper.getInertBodyElement(t):(e.removeChild(e.firstChild),e)}catch(e){return null}}}class b1{constructor(t){if(this.defaultDoc=t,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert"),null==this.inertDocument.body){const e=this.inertDocument.createElement("html");this.inertDocument.appendChild(e);const i=this.inertDocument.createElement("body");e.appendChild(i)}}getInertBodyElement(t){const e=this.inertDocument.createElement("template");if("content"in e)return e.innerHTML=zu(t),e;const i=this.inertDocument.createElement("body");return i.innerHTML=zu(t),this.defaultDoc.documentMode&&this.stripCustomNsAttrs(i),i}stripCustomNsAttrs(t){const e=t.attributes;for(let r=e.length-1;0<r;r--){const d=e.item(r).name;("xmlns:ns1"===d||0===d.indexOf("ns1:"))&&t.removeAttribute(d)}let i=t.firstChild;for(;i;)i.nodeType===Node.ELEMENT_NODE&&this.stripCustomNsAttrs(i),i=i.nextSibling}}const y1=/^(?:(?:https?|mailto|data|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi;function rp(n){return(n=String(n)).match(y1)?n:"unsafe:"+n}function al(n){const t={};for(const e of n.split(","))t[e]=!0;return t}function Vu(...n){const t={};for(const e of n)for(const i in e)e.hasOwnProperty(i)&&(t[i]=!0);return t}const C0=al("area,br,col,hr,img,wbr"),T0=al("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),op=al("rp,rt"),Rg=Vu(C0,Vu(T0,al("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),Vu(op,al("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),Vu(op,T0)),H_=al("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),$_=Vu(H_,al("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,srcset,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),al("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),E0=al("script,style,template");class D0{constructor(){this.sanitizedSomething=!1,this.buf=[]}sanitizeChildren(t){let e=t.firstChild,i=!0;for(;e;)if(e.nodeType===Node.ELEMENT_NODE?i=this.startElement(e):e.nodeType===Node.TEXT_NODE?this.chars(e.nodeValue):this.sanitizedSomething=!0,i&&e.firstChild)e=e.firstChild;else for(;e;){e.nodeType===Node.ELEMENT_NODE&&this.endElement(e);let r=this.checkClobberedElement(e,e.nextSibling);if(r){e=r;break}e=this.checkClobberedElement(e,e.parentNode)}return this.buf.join("")}startElement(t){const e=t.nodeName.toLowerCase();if(!Rg.hasOwnProperty(e))return this.sanitizedSomething=!0,!E0.hasOwnProperty(e);this.buf.push("<"),this.buf.push(e);const i=t.attributes;for(let r=0;r<i.length;r++){const s=i.item(r),d=s.name,m=d.toLowerCase();if(!$_.hasOwnProperty(m)){this.sanitizedSomething=!0;continue}let y=s.value;H_[m]&&(y=rp(y)),this.buf.push(" ",d,'="',M0(y),'"')}return this.buf.push(">"),!0}endElement(t){const e=t.nodeName.toLowerCase();Rg.hasOwnProperty(e)&&!C0.hasOwnProperty(e)&&(this.buf.push("</"),this.buf.push(e),this.buf.push(">"))}chars(t){this.buf.push(M0(t))}checkClobberedElement(t,e){if(e&&(t.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error(`Failed to sanitize html because the element is clobbered: ${t.outerHTML}`);return e}}const I0=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,S1=/([^\#-~ |!])/g;function M0(n){return n.replace(/&/g,"&amp;").replace(I0,function(t){return"&#"+(1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320)+65536)+";"}).replace(S1,function(t){return"&#"+t.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}let Ff;function Nf(n,t){let e=null;try{Ff=Ff||function U_(n){const t=new b1(n);return function _1(){try{return!!(new window.DOMParser).parseFromString(zu(""),"text/html")}catch(n){return!1}}()?new S0(t):t}(n);let i=t?String(t):"";e=Ff.getInertBodyElement(i);let r=5,s=i;do{if(0===r)throw new Error("Failed to sanitize html because the input is unstable");r--,i=s,s=e.innerHTML,e=Ff.getInertBodyElement(i)}while(i!==s);return zu((new D0).sanitizeChildren(Pg(e)||e))}finally{if(e){const i=Pg(e)||e;for(;i.firstChild;)i.removeChild(i.firstChild)}}}function Pg(n){return"content"in n&&function zs(n){return n.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===n.nodeName}(n)?n.content:null}var sr=(()=>((sr=sr||{})[sr.NONE=0]="NONE",sr[sr.HTML=1]="HTML",sr[sr.STYLE=2]="STYLE",sr[sr.SCRIPT=3]="SCRIPT",sr[sr.URL=4]="URL",sr[sr.RESOURCE_URL=5]="RESOURCE_URL",sr))();function ll(n){const t=function zf(){const n=At();return n&&n[12]}();return t?t.sanitize(sr.URL,n)||"":Fa(n,"URL")?Oa(n):rp(ii(n))}const Lg=new Et("ENVIRONMENT_INITIALIZER"),W_=new Et("INJECTOR",-1),X_=new Et("INJECTOR_DEF_TYPES");class A0{get(t,e=ka){if(e===ka){const i=new Error(`NullInjectorError: No provider for ${zi(t)}!`);throw i.name="NullInjectorError",i}return e}}function M1(...n){return{\u0275providers:k0(0,n)}}function k0(n,...t){const e=[],i=new Set;let r;return $o(t,s=>{const d=s;Z_(d,e,[],i)&&(r||(r=[]),r.push(d))}),void 0!==r&&R0(r,e),e}function R0(n,t){for(let e=0;e<n.length;e++){const{providers:r}=n[e];$o(r,s=>{t.push(s)})}}function Z_(n,t,e,i){if(!(n=Hn(n)))return!1;let r=null,s=Ka(n);const d=!s&&hr(n);if(s||d){if(d&&!d.standalone)return!1;r=n}else{const y=n.ngModule;if(s=Ka(y),!s)return!1;r=y}const m=i.has(r);if(d){if(m)return!1;if(i.add(r),d.dependencies){const y="function"==typeof d.dependencies?d.dependencies():d.dependencies;for(const C of y)Z_(C,t,e,i)}}else{if(!s)return!1;{if(null!=s.imports&&!m){let C;i.add(r);try{$o(s.imports,M=>{Z_(M,t,e,i)&&(C||(C=[]),C.push(M))})}finally{}void 0!==C&&R0(C,t)}if(!m){const C=la(r)||(()=>new r);t.push({provide:r,useFactory:C,deps:$i},{provide:X_,useValue:r,multi:!0},{provide:Lg,useValue:()=>ze(r),multi:!0})}const y=s.providers;null==y||m||$o(y,M=>{t.push(M)})}}return r!==n&&void 0!==n.providers}const k1=Cn({provide:String,useValue:Cn});function Eo(n){return null!==n&&"object"==typeof n&&k1 in n}function dc(n){return"function"==typeof n}const Y_=new Et("Set Injector scope."),Fg={},Vf={};let K_;function Ng(){return void 0===K_&&(K_=new A0),K_}class Zc{}class Q_ extends Zc{constructor(t,e,i,r){super(),this.parent=e,this.source=i,this.scopes=r,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,ty(t,d=>this.processProvider(d)),this.records.set(W_,$d(void 0,this)),r.has("environment")&&this.records.set(Zc,$d(void 0,this));const s=this.records.get(Y_);null!=s&&"string"==typeof s.value&&this.scopes.add(s.value),this.injectorDefTypes=new Set(this.get(X_.multi,$i,Un.Self))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const t of this._ngOnDestroyHooks)t.ngOnDestroy();for(const t of this._onDestroyHooks)t()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),this._onDestroyHooks.length=0}}onDestroy(t){this._onDestroyHooks.push(t)}runInContext(t){this.assertNotDestroyed();const e=xs(this),i=Rs(void 0);try{return t()}finally{xs(e),Rs(i)}}get(t,e=ka,i=Un.Default){this.assertNotDestroyed();const r=xs(this),s=Rs(void 0);try{if(!(i&Un.SkipSelf)){let m=this.records.get(t);if(void 0===m){const y=function P0(n){return"function"==typeof n||"object"==typeof n&&n instanceof Et}(t)&&fu(t);m=y&&this.injectableDefInScope(y)?$d(Bg(t),Fg):null,this.records.set(t,m)}if(null!=m)return this.hydrate(t,m)}return(i&Un.Self?Ng():this.parent).get(t,e=i&Un.Optional&&e===ka?null:e)}catch(d){if("NullInjectorError"===d.name){if((d[bf]=d[bf]||[]).unshift(zi(t)),r)throw d;return function Yv(n,t,e,i){const r=n[bf];throw t[Yh]&&r.unshift(t[Yh]),n.message=function Kv(n,t,e,i=null){n=n&&"\n"===n.charAt(0)&&"\u0275"==n.charAt(1)?n.slice(2):n;let r=zi(t);if(Array.isArray(t))r=t.map(zi).join(" -> ");else if("object"==typeof t){let s=[];for(let d in t)if(t.hasOwnProperty(d)){let m=t[d];s.push(d+":"+("string"==typeof m?JSON.stringify(m):zi(m)))}r=`{${s.join(", ")}}`}return`${e}${i?"("+i+")":""}[${r}]: ${n.replace(yf,"\n  ")}`}("\n"+n.message,r,e,i),n.ngTokenPath=r,n[bf]=null,n}(d,t,"R3InjectorError",this.source)}throw d}finally{Rs(s),xs(r)}}resolveInjectorInitializers(){const t=xs(this),e=Rs(void 0);try{const i=this.get(Lg.multi,$i,Un.Self);for(const r of i)r()}finally{xs(t),Rs(e)}}toString(){const t=[],e=this.records;for(const i of e.keys())t.push(zi(i));return`R3Injector[${t.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Ot(205,!1)}processProvider(t){let e=dc(t=Hn(t))?t:Hn(t&&t.provide);const i=function J_(n){return Eo(n)?$d(void 0,n.useValue):$d(ey(n),Fg)}(t);if(dc(t)||!0!==t.multi)this.records.get(e);else{let r=this.records.get(e);r||(r=$d(void 0,Fg,!0),r.factory=()=>Pa(r.multi),this.records.set(e,r)),e=t,r.multi.push(t)}this.records.set(e,i)}hydrate(t,e){return e.value===Fg&&(e.value=Vf,e.value=e.factory()),"object"==typeof e.value&&e.value&&function lp(n){return null!==n&&"object"==typeof n&&"function"==typeof n.ngOnDestroy}(e.value)&&this._ngOnDestroyHooks.add(e.value),e.value}injectableDefInScope(t){if(!t.providedIn)return!1;const e=Hn(t.providedIn);return"string"==typeof e?"any"===e||this.scopes.has(e):this.injectorDefTypes.has(e)}}function Bg(n){const t=fu(n),e=null!==t?t.factory:la(n);if(null!==e)return e;if(n instanceof Et)throw new Ot(204,!1);if(n instanceof Function)return function Mr(n){const t=n.length;if(t>0)throw Hr(t,"?"),new Ot(204,!1);const e=function Xp(n){const t=n&&(n[Kl]||n[md]);if(t){const e=function Pc(n){if(n.hasOwnProperty("name"))return n.name;const t=(""+n).match(/^function\s*([^\s(]+)/);return null===t?"":t[1]}(n);return console.warn(`DEPRECATED: DI is instantiating a token "${e}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${e}" class.`),t}return null}(n);return null!==e?()=>e.factory(n):()=>new n}(n);throw new Ot(204,!1)}function ey(n,t,e){let i;if(dc(n)){const r=Hn(n);return la(r)||Bg(r)}if(Eo(n))i=()=>Hn(n.useValue);else if(function Og(n){return!(!n||!n.useFactory)}(n))i=()=>n.useFactory(...Pa(n.deps||[]));else if(function cl(n){return!(!n||!n.useExisting)}(n))i=()=>ze(Hn(n.useExisting));else{const r=Hn(n&&(n.useClass||n.provide));if(!function Yc(n){return!!n.deps}(n))return la(r)||Bg(r);i=()=>new r(...Pa(n.deps))}return i}function $d(n,t,e=!1){return{factory:n,value:t,multi:e?[]:void 0}}function R1(n){return!!n.\u0275providers}function ty(n,t){for(const e of n)Array.isArray(e)?ty(e,t):R1(e)?ty(e.\u0275providers,t):t(e)}class L0{}class O1{resolveComponentFactory(t){throw function L1(n){const t=Error(`No component factory found for ${zi(n)}. Did you add it to @NgModule.entryComponents?`);return t.ngComponent=n,t}(t)}}let Gd=(()=>{class n{}return n.NULL=new O1,n})();function zg(){return Rl(Co(),At())}function Rl(n,t){return new Tn(Os(n,t))}let Tn=(()=>{class n{constructor(e){this.nativeElement=e}}return n.__NG_ELEMENT_ID__=zg,n})();function Vg(n){return n instanceof Tn?n.nativeElement:n}class jf{}let hc=(()=>{class n{}return n.__NG_ELEMENT_ID__=()=>function F1(){const n=At(),e=ys(Co().index,n);return(Ps(e)?e:n)[11]}(),n})(),N0=(()=>{class n{}return n.\u0275prov=Jt({token:n,providedIn:"root",factory:()=>null}),n})();class Kc{constructor(t){this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}}const Js=new Kc("14.3.0"),Uf={};function Ug(n){return n.ngOriginalError}class ul{constructor(){this._console=console}handleError(t){const e=this._findOriginalError(t);this._console.error("ERROR",t),e&&this._console.error("ORIGINAL ERROR",e)}_findOriginalError(t){let e=t&&Ug(t);for(;e&&Ug(e);)e=Ug(e);return e||null}}function pc(n){return n instanceof Function?n():n}function ry(n,t,e){let i=n.length;for(;;){const r=n.indexOf(t,e);if(-1===r)return r;if(0===r||n.charCodeAt(r-1)<=32){const s=t.length;if(r+s===i||n.charCodeAt(r+s)<=32)return r}e=r+1}}const oy="ng-template";function U1(n,t,e){let i=0;for(;i<n.length;){let r=n[i++];if(e&&"class"===r){if(r=n[i],-1!==ry(r.toLowerCase(),t,0))return!0}else if(1===r){for(;i<n.length&&"string"==typeof(r=n[i++]);)if(r.toLowerCase()===t)return!0;return!1}}return!1}function j0(n){return 4===n.type&&n.value!==oy}function U0(n,t,e){return t===(4!==n.type||e?n.value:oy)}function H0(n,t,e){let i=4;const r=n.attrs||[],s=function ay(n){for(let t=0;t<n.length;t++)if(vt(n[t]))return t;return n.length}(r);let d=!1;for(let m=0;m<t.length;m++){const y=t[m];if("number"!=typeof y){if(!d)if(4&i){if(i=2|1&i,""!==y&&!U0(n,y,e)||""===y&&1===t.length){if(ea(i))return!1;d=!0}}else{const C=8&i?y:t[++m];if(8&i&&null!==n.attrs){if(!U1(n.attrs,C,e)){if(ea(i))return!1;d=!0}continue}const k=$0(8&i?"class":y,r,j0(n),e);if(-1===k){if(ea(i))return!1;d=!0;continue}if(""!==C){let z;z=k>s?"":r[k+1].toLowerCase();const q=8&i?z:null;if(q&&-1!==ry(q,C,0)||2&i&&C!==z){if(ea(i))return!1;d=!0}}}}else{if(!d&&!ea(i)&&!ea(y))return!1;if(d&&ea(y))continue;d=!1,i=y|1&i}}return ea(i)||d}function ea(n){return 0==(1&n)}function $0(n,t,e,i){if(null===t)return-1;let r=0;if(i||!e){let s=!1;for(;r<t.length;){const d=t[r];if(d===n)return r;if(3===d||6===d)s=!0;else{if(1===d||2===d){let m=t[++r];for(;"string"==typeof m;)m=t[++r];continue}if(4===d)break;if(0===d){r+=4;continue}}r+=s?1:2}return-1}return function up(n,t){let e=n.indexOf(4);if(e>-1)for(e++;e<n.length;){const i=n[e];if("number"==typeof i)return-1;if(i===t)return e;e++}return-1}(t,n)}function sy(n,t,e=!1){for(let i=0;i<t.length;i++)if(H0(n,t[i],e))return!0;return!1}function dp(n,t){e:for(let e=0;e<t.length;e++){const i=t[e];if(n.length===i.length){for(let r=0;r<n.length;r++)if(n[r]!==i[r])continue e;return!0}}return!1}function ly(n,t){return n?":not("+t.trim()+")":t}function $g(n){let t=n[0],e=1,i=2,r="",s=!1;for(;e<n.length;){let d=n[e];if("string"==typeof d)if(2&i){const m=n[++e];r+="["+d+(m.length>0?'="'+m+'"':"")+"]"}else 8&i?r+="."+d:4&i&&(r+=" "+d);else""!==r&&!ea(d)&&(t+=ly(s,r),r=""),i=d,s=s||!ea(i);e++}return""!==r&&(t+=ly(s,r)),t}const bi={};function Le(n){q0(tr(),At(),I()+n,!1)}function q0(n,t,e,i){if(!i)if(3==(3&t[2])){const s=n.preOrderCheckHooks;null!==s&&U(t,s,e)}else{const s=n.preOrderHooks;null!==s&&J(t,s,0,e)}R(e)}function Wg(n,t=null,e=null,i){const r=Z0(n,t,e,i);return r.resolveInjectorInitializers(),r}function Z0(n,t=null,e=null,i,r=new Set){const s=[e||$i,M1(n)];return i=i||("object"==typeof n?void 0:zi(n)),new Q_(s,t||Ng(),i||null,r)}let Nr=(()=>{class n{static create(e,i){var r;if(Array.isArray(e))return Wg({name:""},i,e,"");{const s=null!==(r=e.name)&&void 0!==r?r:"";return Wg({name:s},e.parent,e.providers,s)}}}return n.THROW_IF_NOT_FOUND=ka,n.NULL=new A0,n.\u0275prov=Jt({token:n,providedIn:"any",factory:()=>ze(W_)}),n.__NG_ELEMENT_ID__=-1,n})();function G(n,t=Un.Default){const e=At();return null===e?ze(n,t):Rr(Co(),e,Hn(n),t)}function Qc(){throw new Error("invalid")}function tb(n,t){return n<<17|t<<2}function Ba(n){return n>>17&32767}function dy(n){return 2|n}function Ll(n){return(131068&n)>>2}function ib(n,t){return-131069&n|t<<2}function hy(n){return 1|n}function yy(n,t){const e=n.contentQueries;if(null!==e)for(let i=0;i<e.length;i+=2){const r=e[i],s=e[i+1];if(-1!==s){const d=n.data[s];Pd(r),d.contentQueries(2,t[s],s)}}}function Jd(n,t,e,i,r,s,d,m,y,C,M){const k=t.blueprint.slice();return k[0]=r,k[2]=76|i,(null!==M||n&&1024&n[2])&&(k[2]|=1024),sf(k),k[3]=k[15]=n,k[8]=e,k[10]=d||n&&n[10],k[11]=m||n&&n[11],k[12]=y||n&&n[12]||null,k[9]=C||n&&n[9]||null,k[6]=s,k[20]=function M_(){return yr++}(),k[21]=M,k[16]=2==t.type?n[16]:k,k}function eh(n,t,e,i,r){let s=n.data[t];if(null===s)s=function lb(n,t,e,i,r){const s=Xs(),d=Zs(),y=n.data[t]=function Sy(n,t,e,i,r,s){return{type:e,index:i,insertBeforeIndex:null,injectorIndex:t?t.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:r,attrs:s,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,d?s:s&&s.parent,e,t,i,r);return null===n.firstChild&&(n.firstChild=y),null!==s&&(d?null==s.child&&null!==y.parent&&(s.child=y):null===s.next&&(s.next=y)),y}(n,t,e,i,r),function p_(){return di.lFrame.inI18n}()&&(s.flags|=64);else if(64&s.type){s.type=e,s.value=i,s.attrs=r;const d=function Eu(){const n=di.lFrame,t=n.currentTNode;return n.isParent?t:t.parent}();s.injectorIndex=null===d?-1:d.injectorIndex}return nl(s,!0),s}function gp(n,t,e,i){if(0===e)return-1;const r=t.length;for(let s=0;s<e;s++)t.push(i),n.blueprint.push(i),n.data.push(null);return r}function cb(n,t,e){ic(t);try{const i=n.viewQuery;null!==i&&Wn(1,i,e);const r=n.template;null!==r&&vy(n,t,r,1,e),n.firstCreatePass&&(n.firstCreatePass=!1),n.staticContentQueries&&yy(n,t),n.staticViewQueries&&Wn(2,n.viewQuery,e);const s=n.components;null!==s&&function Xf(n,t){for(let e=0;e<t.length;e++)Rt(n,t[e])}(t,s)}catch(i){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),i}finally{t[2]&=-5,x()}}function Zf(n,t,e,i){const r=t[2];if(128!=(128&r)){ic(t);try{sf(t),function nc(n){return di.lFrame.bindingIndex=n}(n.bindingStartIndex),null!==e&&vy(n,t,e,2,i);const d=3==(3&r);if(d){const C=n.preOrderCheckHooks;null!==C&&U(t,C,null)}else{const C=n.preOrderHooks;null!==C&&J(t,C,0,null),pe(t,0)}if(function ht(n){for(let t=_g(n);null!==t;t=yg(t)){if(!t[2])continue;const e=t[9];for(let i=0;i<e.length;i++){const r=e[i],s=r[3];0==(512&r[2])&&Rd(s,1),r[2]|=512}}}(t),function zt(n){for(let t=_g(n);null!==t;t=yg(t))for(let e=10;e<t.length;e++){const i=t[e],r=i[1];tc(i)&&Zf(r,i,r.template,i[8])}}(t),null!==n.contentQueries&&yy(n,t),d){const C=n.contentCheckHooks;null!==C&&U(t,C)}else{const C=n.contentHooks;null!==C&&J(t,C,1),pe(t,1)}!function Qd(n,t){const e=n.hostBindingOpCodes;if(null!==e)try{for(let i=0;i<e.length;i++){const r=e[i];if(r<0)R(~r);else{const s=r,d=e[++i],m=e[++i];lf(d,s),m(2,t[s])}}}finally{R(-1)}}(n,t);const m=n.components;null!==m&&function ox(n,t){for(let e=0;e<t.length;e++)Dt(n,t[e])}(t,m);const y=n.viewQuery;if(null!==y&&Wn(2,y,i),d){const C=n.viewCheckHooks;null!==C&&U(t,C)}else{const C=n.viewHooks;null!==C&&J(t,C,2),pe(t,2)}!0===n.firstUpdatePass&&(n.firstUpdatePass=!1),t[2]&=-41,512&t[2]&&(t[2]&=-513,Rd(t[3],-1))}finally{x()}}}function vy(n,t,e,i,r){const s=I(),d=2&i;try{R(-1),d&&t.length>22&&q0(n,t,22,!1),e(i,r)}finally{R(s)}}function sx(n,t,e){if(Kp(t)){const r=t.directiveEnd;for(let s=t.directiveStart;s<r;s++){const d=n.data[s];d.contentQueries&&d.contentQueries(1,e[s],s)}}}function Yf(n,t,e){!Hh()||(function A(n,t,e,i){const r=e.directiveStart,s=e.directiveEnd;n.firstCreatePass||io(e,t),To(i,t);const d=e.initialInputs;for(let m=r;m<s;m++){const y=n.data[m],C=Ls(y);C&&ue(t,e,y);const M=Tl(t,n,m,e);To(M,t),null!==d&&ke(0,m-r,M,y,0,d),C&&(ys(e.index,t)[8]=M)}}(n,t,e,Os(e,t)),128==(128&e.flags)&&function P(n,t,e){const i=e.directiveStart,r=e.directiveEnd,s=e.index,d=function Ym(){return di.lFrame.currentDirectiveIndex}();try{R(s);for(let m=i;m<r;m++){const y=n.data[m],C=t[m];qh(m),(null!==y.hostBindings||0!==y.hostVars||null!==y.hostAttrs)&&L(y,C)}}finally{R(-1),qh(d)}}(n,t,e))}function ub(n,t,e=Os){const i=t.localNames;if(null!==i){let r=t.index+1;for(let s=0;s<i.length;s+=2){const d=i[s+1],m=-1===d?e(t,n):n[d];n[r++]=m}}}function xy(n){const t=n.tView;return null===t||t.incompleteFirstPass?n.tView=db(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts):t}function db(n,t,e,i,r,s,d,m,y,C){const M=22+i,k=M+r,z=function wy(n,t){const e=[];for(let i=0;i<t;i++)e.push(i<n?null:bi);return e}(M,k),q="function"==typeof C?C():C;return z[1]={type:n,blueprint:z,template:e,queries:null,viewQuery:m,declTNode:t,data:z.slice().fill(null,M),bindingStartIndex:M,expandoStartIndex:k,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof s?s():s,pipeRegistry:"function"==typeof d?d():d,firstChild:null,schemas:y,consts:q,incompleteFirstPass:!1}}function bp(n,t,e,i){const r=kn(t);null===e?r.push(i):(r.push(e),n.firstCreatePass&&Jn(n).push(i,r.length-1))}function Cy(n,t,e){for(let i in n)if(n.hasOwnProperty(i)){const r=n[i];(e=null===e?{}:e).hasOwnProperty(i)?e[i].push(t,r):e[i]=[t,r]}return e}function a(n,t){const i=t.directiveEnd,r=n.data,s=t.attrs,d=[];let m=null,y=null;for(let C=t.directiveStart;C<i;C++){const M=r[C],k=M.inputs,z=null===s||j0(t)?null:at(k,s);d.push(z),m=Cy(k,C,m),y=Cy(M.outputs,C,y)}null!==m&&(m.hasOwnProperty("class")&&(t.flags|=16),m.hasOwnProperty("style")&&(t.flags|=32)),t.initialInputs=d,t.inputs=m,t.outputs=y}function l(n,t,e,i,r,s,d,m){const y=Os(t,e);let M,C=t.inputs;!m&&null!=C&&(M=C[i])?(Fn(n,e,M,i,r),Lh(t)&&u(e,t.index)):3&t.type&&(i=function o(n){return"class"===n?"className":"for"===n?"htmlFor":"formaction"===n?"formAction":"innerHtml"===n?"innerHTML":"readonly"===n?"readOnly":"tabindex"===n?"tabIndex":n}(i),r=null!=d?d(r,t.value||"",i):r,s.setProperty(y,i,r))}function u(n,t){const e=ys(t,n);16&e[2]||(e[2]|=32)}function w(n,t,e,i){let r=!1;if(Hh()){const s=function N(n,t,e){const i=n.directiveRegistry;let r=null;if(i)for(let s=0;s<i.length;s++){const d=i[s];sy(e,d.selectors,!1)&&(r||(r=[]),or(io(e,t),n,d.type),Ls(d)?(B(n,e),r.unshift(d)):r.push(d))}return r}(n,t,e),d=null===i?null:{"":-1};if(null!==s){r=!0,ce(e,n.data.length,s.length);for(let M=0;M<s.length;M++){const k=s[M];k.providersResolver&&k.providersResolver(k)}let m=!1,y=!1,C=gp(n,t,s.length,null);for(let M=0;M<s.length;M++){const k=s[M];e.mergedAttrs=Mt(e.mergedAttrs,k.hostAttrs),Ce(n,e,t,C,k),K(C,k,d),null!==k.contentQueries&&(e.flags|=8),(null!==k.hostBindings||null!==k.hostAttrs||0!==k.hostVars)&&(e.flags|=128);const z=k.type.prototype;!m&&(z.ngOnChanges||z.ngOnInit||z.ngDoCheck)&&((n.preOrderHooks||(n.preOrderHooks=[])).push(e.index),m=!0),!y&&(z.ngOnChanges||z.ngDoCheck)&&((n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e.index),y=!0),C++}a(n,e)}d&&function $(n,t,e){if(t){const i=n.localNames=[];for(let r=0;r<t.length;r+=2){const s=e[t[r+1]];if(null==s)throw new Ot(-301,!1);i.push(t[r],s)}}}(e,i,d)}return e.mergedAttrs=Mt(e.mergedAttrs,e.attrs),r}function T(n,t,e,i,r,s){const d=s.hostBindings;if(d){let m=n.hostBindingOpCodes;null===m&&(m=n.hostBindingOpCodes=[]);const y=~t.index;(function E(n){let t=n.length;for(;t>0;){const e=n[--t];if("number"==typeof e&&e<0)return e}return 0})(m)!=y&&m.push(y),m.push(i,r,d)}}function L(n,t){null!==n.hostBindings&&n.hostBindings(1,t)}function B(n,t){t.flags|=2,(n.components||(n.components=[])).push(t.index)}function K(n,t,e){if(e){if(t.exportAs)for(let i=0;i<t.exportAs.length;i++)e[t.exportAs[i]]=n;Ls(t)&&(e[""]=n)}}function ce(n,t,e){n.flags|=1,n.directiveStart=t,n.directiveEnd=t+e,n.providerIndexes=t}function Ce(n,t,e,i,r){n.data[i]=r;const s=r.factory||(r.factory=la(r.type)),d=new Oe(s,Ls(r),G);n.blueprint[i]=d,e[i]=d,T(n,t,0,i,gp(n,e,r.hostVars,bi),r)}function ue(n,t,e){const i=Os(t,n),r=xy(e),s=n[10],d=ft(n,Jd(n,r,null,e.onPush?32:16,i,t,s,s.createRenderer(i,e),null,null,null));n[t.index]=d}function ve(n,t,e,i,r,s){const d=Os(n,t);!function Ae(n,t,e,i,r,s,d){if(null==s)n.removeAttribute(t,r,e);else{const m=null==d?ii(s):d(s,i||"",r);n.setAttribute(t,r,m,e)}}(t[11],d,s,n.value,e,i,r)}function ke(n,t,e,i,r,s){const d=s[t];if(null!==d){const m=i.setInput;for(let y=0;y<d.length;){const C=d[y++],M=d[y++],k=d[y++];null!==m?i.setInput(e,k,C,M):e[M]=k}}}function at(n,t){let e=null,i=0;for(;i<t.length;){const r=t[i];if(0!==r)if(5!==r){if("number"==typeof r)break;n.hasOwnProperty(r)&&(null===e&&(e=[]),e.push(r,n[r],t[i+1])),i+=2}else i+=2;else i+=4}return e}function _t(n,t,e,i){return new Array(n,!0,!1,t,null,0,i,e,null,null)}function Dt(n,t){const e=ys(t,n);if(tc(e)){const i=e[1];48&e[2]?Zf(i,e,i.template,e[8]):e[5]>0&&Ct(e)}}function Ct(n){for(let i=_g(n);null!==i;i=yg(i))for(let r=10;r<i.length;r++){const s=i[r];if(tc(s))if(512&s[2]){const d=s[1];Zf(d,s,d.template,s[8])}else s[5]>0&&Ct(s)}const e=n[1].components;if(null!==e)for(let i=0;i<e.length;i++){const r=ys(e[i],n);tc(r)&&r[5]>0&&Ct(r)}}function Rt(n,t){const e=ys(t,n),i=e[1];(function Gt(n,t){for(let e=t.length;e<n.blueprint.length;e++)t.push(n.blueprint[e])})(i,e),cb(i,e,e[8])}function ft(n,t){return n[13]?n[14][4]=t:n[13]=t,n[14]=t,t}function sn(n){for(;n;){n[2]|=32;const t=Ud(n);if(xu(n)&&!t)return n;n=t}return null}function mn(n,t,e,i=!0){const r=t[10];r.begin&&r.begin();try{Zf(n,t,n.template,e)}catch(d){throw i&&ei(t,d),d}finally{r.end&&r.end()}}function Wn(n,t,e){Pd(0),t(n,e)}function kn(n){return n[7]||(n[7]=[])}function Jn(n){return n.cleanup||(n.cleanup=[])}function ji(n,t,e){return(null===n||Ls(n))&&(e=function Cu(n){for(;Array.isArray(n);){if("object"==typeof n[1])return n;n=n[0]}return null}(e[t.index])),e[11]}function ei(n,t){const e=n[9],i=e?e.get(ul,null):null;i&&i.handleError(t)}function Fn(n,t,e,i,r){for(let s=0;s<e.length;){const d=e[s++],m=e[s++],y=t[d],C=n.data[d];null!==C.setInput?C.setInput(y,r,i,m):y[m]=r}}function Gi(n,t,e){const i=jh(t,n);!function kf(n,t,e){n.setValue(t,e)}(n[11],i,e)}function Xn(n,t,e){let i=e?n.styles:null,r=e?n.classes:null,s=0;if(null!==t)for(let d=0;d<t.length;d++){const m=t[d];"number"==typeof m?s=m:1==s?r=mi(r,m):2==s&&(i=mi(i,m+": "+t[++d]+";"))}e?n.styles=i:n.stylesWithoutHost=i,e?n.classes=r:n.classesWithoutHost=r}function Zn(n,t,e,i,r=!1){for(;null!==e;){const s=t[e.index];if(null!==s&&i.push(Zr(s)),Ea(s))for(let m=10;m<s.length;m++){const y=s[m],C=y[1].firstChild;null!==C&&Zn(y[1],y,C,i)}const d=e.type;if(8&d)Zn(n,t,e.child,i);else if(32&d){const m=bg(e,t);let y;for(;y=m();)i.push(y)}else if(16&d){const m=b0(t,e);if(Array.isArray(m))i.push(...m);else{const y=Ud(t[16]);Zn(y[1],y,m,i,!0)}}e=r?e.projectionNext:e.next}return i}class ir{constructor(t,e){this._lView=t,this._cdRefInjectingView=e,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const t=this._lView,e=t[1];return Zn(e,t,e.firstChild,[])}get context(){return this._lView[8]}set context(t){this._lView[8]=t}get destroyed(){return 128==(128&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const t=this._lView[3];if(Ea(t)){const e=t[8],i=e?e.indexOf(this):-1;i>-1&&(xg(t,i),eg(e,i))}this._attachedToViewContainer=!1}L_(this._lView[1],this._lView)}onDestroy(t){bp(this._lView[1],this._lView,null,t)}markForCheck(){sn(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-65}reattach(){this._lView[2]|=64}detectChanges(){mn(this._lView[1],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Ot(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function a0(n,t){cc(n,t,t[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new Ot(902,!1);this._appRef=t}}class Ar extends ir{constructor(t){super(t),this._view=t}detectChanges(){const t=this._view;mn(t[1],t,t[8],!1)}checkNoChanges(){}get context(){return null}}class fr extends Gd{constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){const e=hr(t);return new Gr(e,this.ngModule)}}function mr(n){const t=[];for(let e in n)n.hasOwnProperty(e)&&t.push({propName:n[e],templateName:e});return t}class Yr{constructor(t,e){this.injector=t,this.parentInjector=e}get(t,e,i){const r=this.injector.get(t,Uf,i);return r!==Uf||e===Uf?r:this.parentInjector.get(t,e,i)}}class Gr extends L0{constructor(t,e){super(),this.componentDef=t,this.ngModule=e,this.componentType=t.type,this.selector=function G0(n){return n.map($g).join(",")}(t.selectors),this.ngContentSelectors=t.ngContentSelectors?t.ngContentSelectors:[],this.isBoundToModule=!!e}get inputs(){return mr(this.componentDef.inputs)}get outputs(){return mr(this.componentDef.outputs)}create(t,e,i,r){let s=(r=r||this.ngModule)instanceof Zc?r:null==r?void 0:r.injector;s&&null!==this.componentDef.getStandaloneInjector&&(s=this.componentDef.getStandaloneInjector(s)||s);const d=s?new Yr(t,s):t,m=d.get(jf,null);if(null===m)throw new Ot(407,!1);const y=d.get(N0,null),C=m.createRenderer(null,this.componentDef),M=this.componentDef.selectors[0][0]||"div",k=i?function lx(n,t,e){return n.selectRootElement(t,e===qs.ShadowDom)}(C,i,this.componentDef.encapsulation):vg(C,M,function $r(n){const t=n.toLowerCase();return"svg"===t?"svg":"math"===t?"math":null}(M)),z=this.componentDef.onPush?288:272,q=db(0,null,null,1,0,null,null,null,null,null),Q=Jd(null,q,null,z,null,null,m,C,y,d,null);let xe,De;ic(Q);try{const Ze=function Ki(n,t,e,i,r,s){const d=e[1];e[22]=n;const y=eh(d,22,2,"#host",null),C=y.mergedAttrs=t.hostAttrs;null!==C&&(Xn(y,C,!0),null!==n&&(it(r,n,C),null!==y.classes&&tp(r,n,y.classes),null!==y.styles&&Pf(r,n,y.styles)));const M=i.createRenderer(n,t),k=Jd(e,xy(t),null,t.onPush?32:16,e[22],y,i,M,s||null,null,null);return d.firstCreatePass&&(or(io(y,e),d,t.type),B(d,y),ce(y,e.length,1)),ft(e,k),e[22]=k}(k,this.componentDef,Q,m,C);if(k)if(i)it(C,k,["ng-version",Js.full]);else{const{attrs:It,classes:ut}=function Gg(n){const t=[],e=[];let i=1,r=2;for(;i<n.length;){let s=n[i];if("string"==typeof s)2===r?""!==s&&t.push(s,n[++i]):8===r&&e.push(s);else{if(!ea(r))break;r=s}i++}return{attrs:t,classes:e}}(this.componentDef.selectors[0]);It&&it(C,k,It),ut&&ut.length>0&&tp(C,k,ut.join(" "))}if(De=Ad(q,22),void 0!==e){const It=De.projection=[];for(let ut=0;ut<this.ngContentSelectors.length;ut++){const Ht=e[ut];It.push(null!=Ht?Array.from(Ht):null)}}xe=function fo(n,t,e,i){const r=e[1],s=function v(n,t,e){const i=Co();n.firstCreatePass&&(e.providersResolver&&e.providersResolver(e),Ce(n,i,t,gp(n,t,1,null),e),a(n,i));const r=Tl(t,n,i.directiveStart,i);To(r,t);const s=Os(i,t);return s&&To(s,t),r}(r,e,t);if(n[8]=e[8]=s,null!==i)for(const m of i)m(s,t);if(t.contentQueries){const m=Co();t.contentQueries(1,s,m.directiveStart)}const d=Co();return!r.firstCreatePass||null===t.hostBindings&&null===t.hostAttrs||(R(d.index),T(e[1],d,0,d.directiveStart,d.directiveEnd,t),L(t,s)),s}(Ze,this.componentDef,Q,[kr]),cb(q,Q,null)}finally{x()}return new po(this.componentType,xe,Rl(De,Q),Q,De)}}class po extends class P1{}{constructor(t,e,i,r,s){super(),this.location=i,this._rootLView=r,this._tNode=s,this.instance=e,this.hostView=this.changeDetectorRef=new Ar(r),this.componentType=t}setInput(t,e){const i=this._tNode.inputs;let r;if(null!==i&&(r=i[t])){const s=this._rootLView;Fn(s[1],s,r,t,e),u(s,this._tNode.index)}}get injector(){return new Il(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}}function kr(){const n=Co();le(At()[1],n)}function qt(n){let t=function ws(n){return Object.getPrototypeOf(n.prototype).constructor}(n.type),e=!0;const i=[n];for(;t;){let r;if(Ls(n))r=t.\u0275cmp||t.\u0275dir;else{if(t.\u0275cmp)throw new Ot(903,!1);r=t.\u0275dir}if(r){if(e){i.push(r);const d=n;d.inputs=vo(n.inputs),d.declaredInputs=vo(n.declaredInputs),d.outputs=vo(n.outputs);const m=r.hostBindings;m&&Fl(n,m);const y=r.viewQuery,C=r.contentQueries;if(y&&Vs(n,y),C&&Lo(n,C),fs(n.inputs,r.inputs),fs(n.declaredInputs,r.declaredInputs),fs(n.outputs,r.outputs),Ls(r)&&r.data.animation){const M=n.data;M.animation=(M.animation||[]).concat(r.data.animation)}}const s=r.features;if(s)for(let d=0;d<s.length;d++){const m=s[d];m&&m.ngInherit&&m(n),m===qt&&(e=!1)}}t=Object.getPrototypeOf(t)}!function qo(n){let t=0,e=null;for(let i=n.length-1;i>=0;i--){const r=n[i];r.hostVars=t+=r.hostVars,r.hostAttrs=Mt(r.hostAttrs,e=Mt(e,r.hostAttrs))}}(i)}function vo(n){return n===vl?{}:n===$i?[]:n}function Vs(n,t){const e=n.viewQuery;n.viewQuery=e?(i,r)=>{t(i,r),e(i,r)}:t}function Lo(n,t){const e=n.contentQueries;n.contentQueries=e?(i,r,s)=>{t(i,r,s),e(i,r,s)}:t}function Fl(n,t){const e=n.hostBindings;n.hostBindings=e?(i,r)=>{t(i,r),e(i,r)}:t}let Jf=null;function Wu(){if(!Jf){const n=Lr.Symbol;if(n&&n.iterator)Jf=n.iterator;else{const t=Object.getOwnPropertyNames(Map.prototype);for(let e=0;e<t.length;++e){const i=t[e];"entries"!==i&&"size"!==i&&Map.prototype[i]===Map.prototype.entries&&(Jf=i)}}}return Jf}function yp(n){return!!hl(n)&&(Array.isArray(n)||!(n instanceof Map)&&Wu()in n)}function hl(n){return null!==n&&("function"==typeof n||"object"==typeof n)}function rs(n,t,e){return!Object.is(n[t],e)&&(n[t]=e,!0)}function fn(n,t,e,i){const r=At();return rs(r,on(),t)&&(tr(),ve(O(),r,n,t,e,i)),fn}function yc(n,t,e,i){return rs(n,on(),e)?t+ii(e)+i:bi}function Xu(n,t,e,i,r,s){const m=function pa(n,t,e,i){const r=rs(n,t,e);return rs(n,t+1,i)||r}(n,function Fs(){return di.lFrame.bindingIndex}(),e,r);return Ma(2),m?t+ii(e)+i+ii(r)+s:bi}function $t(n,t,e,i,r,s,d,m){const y=At(),C=tr(),M=n+22,k=C.firstCreatePass?function iB(n,t,e,i,r,s,d,m,y){const C=t.consts,M=eh(t,n,4,d||null,tl(C,m));w(t,e,M,tl(C,y)),le(t,M);const k=M.tViews=db(2,M,i,r,s,t.directiveRegistry,t.pipeRegistry,null,t.schemas,C);return null!==t.queries&&(t.queries.template(t,M),k.queries=t.queries.embeddedTView(M)),M}(M,C,y,t,e,i,r,s,d):C.data[M];nl(k,!1);const z=y[11].createComment("");Sg(C,y,z,k),To(z,y),ft(y,y[M]=_t(z,y,z,k)),Sd(k)&&Yf(C,y,k),null!=d&&ub(y,k,m)}function Nl(n){return ec(function $h(){return di.lFrame.contextLView}(),22+n)}function Je(n,t,e){const i=At();return rs(i,on(),t)&&l(tr(),O(),i,n,t,i[11],e,!1),Je}function cC(n,t,e,i,r){const d=r?"class":"style";Fn(n,e,t.inputs[d],d,i)}function oe(n,t,e,i){const r=At(),s=tr(),d=22+n,m=r[11],y=r[d]=vg(m,t,function se(){return di.lFrame.currentNamespace}()),C=s.firstCreatePass?function oB(n,t,e,i,r,s,d){const m=t.consts,C=eh(t,n,2,r,tl(m,s));return w(t,e,C,tl(m,d)),null!==C.attrs&&Xn(C,C.attrs,!1),null!==C.mergedAttrs&&Xn(C,C.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,C),C}(d,s,r,0,t,e,i):s.data[d];nl(C,!0);const M=C.mergedAttrs;null!==M&&it(m,y,M);const k=C.classes;null!==k&&tp(m,y,k);const z=C.styles;return null!==z&&Pf(m,y,z),64!=(64&C.flags)&&Sg(s,r,y,C),0===function qm(){return di.lFrame.elementDepthCount}()&&To(y,r),function h_(){di.lFrame.elementDepthCount++}(),Sd(C)&&(Yf(s,r,C),sx(s,C,r)),null!==i&&ub(r,C),oe}function de(){let n=Co();Zs()?ua():(n=n.parent,nl(n,!1));const t=n;!function Wm(){di.lFrame.elementDepthCount--}();const e=tr();return e.firstCreatePass&&(le(e,n),Kp(n)&&e.queries.elementEnd(n)),null!=t.classesWithoutHost&&function nt(n){return 0!=(16&n.flags)}(t)&&cC(e,t,At(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function St(n){return 0!=(32&n.flags)}(t)&&cC(e,t,At(),t.stylesWithoutHost,!1),de}function ln(n,t,e,i){return oe(n,t,e,i),de(),ln}function Bl(n,t,e){const i=At(),r=tr(),s=n+22,d=r.firstCreatePass?function sB(n,t,e,i,r){const s=t.consts,d=tl(s,i),m=eh(t,n,8,"ng-container",d);return null!==d&&Xn(m,d,!0),w(t,e,m,tl(s,r)),null!==t.queries&&t.queries.elementStart(t,m),m}(s,r,i,t,e):r.data[s];nl(d,!0);const m=i[s]=i[11].createComment("");return Sg(r,i,m,d),To(m,i),Sd(d)&&(Yf(r,i,d),sx(r,d,i)),null!=e&&ub(i,d),Bl}function zl(){let n=Co();const t=tr();return Zs()?ua():(n=n.parent,nl(n,!1)),t.firstCreatePass&&(le(t,n),Kp(n)&&t.queries.elementEnd(n)),zl}function za(n,t,e){return Bl(n,t,e),zl(),za}function Io(){return At()}function Dy(n){return!!n&&"function"==typeof n.then}function ZI(n){return!!n&&"function"==typeof n.subscribe}const uC=ZI;function Qt(n,t,e,i){const r=At(),s=tr(),d=Co();return YI(s,r,r[11],d,n,t,0,i),Qt}function Iy(n,t){const e=Co(),i=At(),r=tr();return YI(r,i,ji(cf(r.data),e,i),e,n,t),Iy}function YI(n,t,e,i,r,s,d,m){const y=Sd(i),M=n.firstCreatePass&&Jn(n),k=t[8],z=kn(t);let q=!0;if(3&i.type||m){const De=Os(i,t),Ze=m?m(De):De,It=z.length,ut=m?Mn=>m(Zr(Mn[i.index])):i.index;let Ht=null;if(!m&&y&&(Ht=function aB(n,t,e,i){const r=n.cleanup;if(null!=r)for(let s=0;s<r.length-1;s+=2){const d=r[s];if(d===e&&r[s+1]===i){const m=t[7],y=r[s+2];return m.length>y?m[y]:null}"string"==typeof d&&(s+=2)}return null}(n,t,r,i.index)),null!==Ht)(Ht.__ngLastListenerFn__||Ht).__ngNextListenerFn__=s,Ht.__ngLastListenerFn__=s,q=!1;else{s=QI(i,t,k,s,!1);const Mn=e.listen(Ze,r,s);z.push(s,Mn),M&&M.push(r,ut,It,It+1)}}else s=QI(i,t,k,s,!1);const Q=i.outputs;let xe;if(q&&null!==Q&&(xe=Q[r])){const De=xe.length;if(De)for(let Ze=0;Ze<De;Ze+=2){const Yn=t[xe[Ze]][xe[Ze+1]].subscribe(s),ai=z.length;z.push(s,Yn),M&&M.push(r,i.index,ai,-(ai+1))}}}function KI(n,t,e,i){try{return!1!==e(i)}catch(r){return ei(n,r),!1}}function QI(n,t,e,i,r){return function s(d){if(d===Function)return i;sn(2&n.flags?ys(n.index,t):t);let y=KI(t,0,i,d),C=s.__ngNextListenerFn__;for(;C;)y=KI(t,0,C,d)&&y,C=C.__ngNextListenerFn__;return r&&!1===y&&(d.preventDefault(),d.returnValue=!1),y}}function Yt(n=1){return function S(n){return(di.lFrame.contextLView=function D(n,t){for(;n>0;)t=t[15],n--;return t}(n,di.lFrame.contextLView))[8]}(n)}function lB(n,t){let e=null;const i=function Pl(n){const t=n.attrs;if(null!=t){const e=t.indexOf(5);if(0==(1&e))return t[e+1]}return null}(n);for(let r=0;r<t.length;r++){const s=t[r];if("*"!==s){if(null===i?sy(n,s,!0):dp(i,s))return r}else e=r}return e}function Mo(n){const t=At()[16][6];if(!t.projection){const i=t.projection=Hr(n?n.length:1,null),r=i.slice();let s=t.child;for(;null!==s;){const d=n?lB(s,n):0;null!==d&&(r[d]?r[d].projectionNext=s:i[d]=s,r[d]=s),s=s.next}}}function Pr(n,t=0,e){const i=At(),r=tr(),s=eh(r,22+n,16,null,e||null);null===s.projection&&(s.projection=t),ua(),64!=(64&s.flags)&&function a1(n,t,e){oo(t[11],0,t,e,Qs(n,e,t),Nu(e.parent||t[6],e,t))}(r,i,s)}function Va(n,t,e){return dC(n,"",t,"",e),Va}function dC(n,t,e,i,r){const s=At(),d=yc(s,t,e,i);return d!==bi&&l(tr(),O(),s,n,d,s[11],r,!1),dC}function aM(n,t,e,i,r){const s=n[e+1],d=null===t;let m=i?Ba(s):Ll(s),y=!1;for(;0!==m&&(!1===y||d);){const M=n[m+1];dB(n[m],t)&&(y=!0,n[m+1]=i?hy(M):dy(M)),m=i?Ba(M):Ll(M)}y&&(n[e+1]=i?dy(s):hy(s))}function dB(n,t){return null===n||null==t||(Array.isArray(n)?n[1]:n)===t||!(!Array.isArray(n)||"string"!=typeof t)&&ol(n,t)>=0}function Zu(n,t,e){return tu(n,t,e,!1),Zu}function Ri(n,t){return tu(n,t,null,!0),Ri}function tu(n,t,e,i){const r=At(),s=tr(),d=Ma(2);s.firstUpdatePass&&function mM(n,t,e,i){const r=n.data;if(null===r[e+1]){const s=r[I()],d=function fM(n,t){return t>=n.expandoStartIndex}(n,e);(function yM(n,t){return 0!=(n.flags&(t?16:32))})(s,i)&&null===t&&!d&&(t=!1),t=function vB(n,t,e,i){const r=cf(n);let s=i?t.residualClasses:t.residualStyles;if(null===r)0===(i?t.classBindings:t.styleBindings)&&(e=My(e=hC(null,n,t,e,i),t.attrs,i),s=null);else{const d=t.directiveStylingLast;if(-1===d||n[d]!==r)if(e=hC(r,n,t,e,i),null===s){let y=function xB(n,t,e){const i=e?t.classBindings:t.styleBindings;if(0!==Ll(i))return n[Ba(i)]}(n,t,i);void 0!==y&&Array.isArray(y)&&(y=hC(null,n,t,y[1],i),y=My(y,t.attrs,i),function wB(n,t,e,i){n[Ba(e?t.classBindings:t.styleBindings)]=i}(n,t,i,y))}else s=function SB(n,t,e){let i;const r=t.directiveEnd;for(let s=1+t.directiveStylingLast;s<r;s++)i=My(i,n[s].hostAttrs,e);return My(i,t.attrs,e)}(n,t,i)}return void 0!==s&&(i?t.residualClasses=s:t.residualStyles=s),e}(r,s,t,i),function cB(n,t,e,i,r,s){let d=s?t.classBindings:t.styleBindings,m=Ba(d),y=Ll(d);n[i]=e;let M,C=!1;if(Array.isArray(e)){const k=e;M=k[1],(null===M||ol(k,M)>0)&&(C=!0)}else M=e;if(r)if(0!==y){const z=Ba(n[m+1]);n[i+1]=tb(z,m),0!==z&&(n[z+1]=ib(n[z+1],i)),n[m+1]=function Hu(n,t){return 131071&n|t<<17}(n[m+1],i)}else n[i+1]=tb(m,0),0!==m&&(n[m+1]=ib(n[m+1],i)),m=i;else n[i+1]=tb(y,0),0===m?m=i:n[y+1]=ib(n[y+1],i),y=i;C&&(n[i+1]=dy(n[i+1])),aM(n,M,i,!0),aM(n,M,i,!1),function uB(n,t,e,i,r){const s=r?n.residualClasses:n.residualStyles;null!=s&&"string"==typeof t&&ol(s,t)>=0&&(e[i+1]=hy(e[i+1]))}(t,M,n,i,s),d=tb(m,y),s?t.classBindings=d:t.styleBindings=d}(r,s,t,e,d,i)}}(s,n,d,i),t!==bi&&rs(r,d,t)&&function bM(n,t,e,i,r,s,d,m){if(!(3&t.type))return;const y=n.data,C=y[m+1];ux(function Gf(n){return 1==(1&n)}(C)?_M(y,t,e,r,Ll(C),d):void 0)||(ux(s)||function nb(n){return 2==(2&n)}(C)&&(s=_M(y,null,e,r,m,d)),function _0(n,t,e,i,r){if(t)r?n.addClass(e,i):n.removeClass(e,i);else{let s=-1===i.indexOf("-")?void 0:Ks.DashCase;null==r?n.removeStyle(e,i,s):("string"==typeof r&&r.endsWith("!important")&&(r=r.slice(0,-10),s|=Ks.Important),n.setStyle(e,i,r,s))}}(i,d,jh(I(),e),r,s))}(s,s.data[I()],r,r[11],n,r[d+1]=function EB(n,t){return null==n||("string"==typeof t?n+=t:"object"==typeof n&&(n=zi(Oa(n)))),n}(t,e),i,d)}function hC(n,t,e,i,r){let s=null;const d=e.directiveEnd;let m=e.directiveStylingLast;for(-1===m?m=e.directiveStart:m++;m<d&&(s=t[m],i=My(i,s.hostAttrs,r),s!==n);)m++;return null!==n&&(e.directiveStylingLast=m),i}function My(n,t,e){const i=e?1:2;let r=-1;if(null!==t)for(let s=0;s<t.length;s++){const d=t[s];"number"==typeof d?r=d:r===i&&(Array.isArray(n)||(n=void 0===n?[]:["",n]),ho(n,d,!!e||t[++s]))}return void 0===n?null:n}function _M(n,t,e,i,r,s){const d=null===t;let m;for(;r>0;){const y=n[r],C=Array.isArray(y),M=C?y[1]:y,k=null===M;let z=e[r+1];z===bi&&(z=k?$i:void 0);let q=k?ff(z,i):M===i?z:void 0;if(C&&!ux(q)&&(q=ff(y,i)),ux(q)&&(m=q,d))return m;const Q=n[r+1];r=d?Ba(Q):Ll(Q)}if(null!==t){let y=s?t.residualClasses:t.residualStyles;null!=y&&(m=ff(y,i))}return m}function ux(n){return void 0!==n}function $e(n,t=""){const e=At(),i=tr(),r=n+22,s=i.firstCreatePass?eh(i,r,1,t,null):i.data[r],d=e[r]=function Fu(n,t){return n.createText(t)}(e[11],t);Sg(i,e,d,s),nl(s,!1)}function hi(n){return wr("",n,""),hi}function wr(n,t,e){const i=At(),r=yc(i,n,t,e);return r!==bi&&Gi(i,I(),r),wr}function dx(n,t,e,i,r){const s=At(),d=Xu(s,n,t,e,i,r);return d!==bi&&Gi(s,I(),d),dx}function vc(n,t,e){const i=At();return rs(i,on(),t)&&l(tr(),O(),i,n,t,i[11],e,!0),vc}function Ay(n,t,e){const i=At();if(rs(i,on(),t)){const s=tr(),d=O();l(s,d,i,n,t,ji(cf(s.data),d,i),e,!0)}return Ay}const em=void 0;var qB=["en",[["a","p"],["AM","PM"],em],[["AM","PM"],em,em],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],em,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],em,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",em,"{1} 'at' {0}",em],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function GB(n){const e=Math.floor(Math.abs(n)),i=n.toString().replace(/^[^.]*\.?/,"").length;return 1===e&&0===i?1:5}];let bb={};function ja(n){const t=function WB(n){return n.toLowerCase().replace(/_/g,"-")}(n);let e=NM(t);if(e)return e;const i=t.split("-")[0];if(e=NM(i),e)return e;if("en"===i)return qB;throw new Ot(701,!1)}function NM(n){return n in bb||(bb[n]=Lr.ng&&Lr.ng.common&&Lr.ng.common.locales&&Lr.ng.common.locales[n]),bb[n]}var Dn=(()=>((Dn=Dn||{})[Dn.LocaleId=0]="LocaleId",Dn[Dn.DayPeriodsFormat=1]="DayPeriodsFormat",Dn[Dn.DayPeriodsStandalone=2]="DayPeriodsStandalone",Dn[Dn.DaysFormat=3]="DaysFormat",Dn[Dn.DaysStandalone=4]="DaysStandalone",Dn[Dn.MonthsFormat=5]="MonthsFormat",Dn[Dn.MonthsStandalone=6]="MonthsStandalone",Dn[Dn.Eras=7]="Eras",Dn[Dn.FirstDayOfWeek=8]="FirstDayOfWeek",Dn[Dn.WeekendRange=9]="WeekendRange",Dn[Dn.DateFormat=10]="DateFormat",Dn[Dn.TimeFormat=11]="TimeFormat",Dn[Dn.DateTimeFormat=12]="DateTimeFormat",Dn[Dn.NumberSymbols=13]="NumberSymbols",Dn[Dn.NumberFormats=14]="NumberFormats",Dn[Dn.CurrencyCode=15]="CurrencyCode",Dn[Dn.CurrencySymbol=16]="CurrencySymbol",Dn[Dn.CurrencyName=17]="CurrencyName",Dn[Dn.Currencies=18]="Currencies",Dn[Dn.Directionality=19]="Directionality",Dn[Dn.PluralCase=20]="PluralCase",Dn[Dn.ExtraData=21]="ExtraData",Dn))();const _b="en-US";let BM=_b;function mC(n,t,e,i,r){if(n=Hn(n),Array.isArray(n))for(let s=0;s<n.length;s++)mC(n[s],t,e,i,r);else{const s=tr(),d=At();let m=dc(n)?n:Hn(n.provide),y=ey(n);const C=Co(),M=1048575&C.providerIndexes,k=C.directiveStart,z=C.providerIndexes>>20;if(dc(n)||!n.multi){const q=new Oe(y,r,G),Q=bC(m,t,r?M:M+z,k);-1===Q?(or(io(C,d),s,m),gC(s,n,t.length),t.push(m),C.directiveStart++,C.directiveEnd++,r&&(C.providerIndexes+=1048576),e.push(q),d.push(q)):(e[Q]=q,d[Q]=q)}else{const q=bC(m,t,M+z,k),Q=bC(m,t,M,M+z),xe=q>=0&&e[q],De=Q>=0&&e[Q];if(r&&!De||!r&&!xe){or(io(C,d),s,m);const Ze=function G3(n,t,e,i,r){const s=new Oe(n,e,G);return s.multi=[],s.index=t,s.componentProviders=0,cA(s,r,i&&!e),s}(r?$3:H3,e.length,r,i,y);!r&&De&&(e[Q].providerFactory=Ze),gC(s,n,t.length,0),t.push(m),C.directiveStart++,C.directiveEnd++,r&&(C.providerIndexes+=1048576),e.push(Ze),d.push(Ze)}else gC(s,n,q>-1?q:Q,cA(e[r?Q:q],y,!r&&i));!r&&i&&De&&e[Q].componentProviders++}}}function gC(n,t,e,i){const r=dc(t),s=function ap(n){return!!n.useClass}(t);if(r||s){const y=(s?Hn(t.useClass):t).prototype.ngOnDestroy;if(y){const C=n.destroyHooks||(n.destroyHooks=[]);if(!r&&t.multi){const M=C.indexOf(e);-1===M?C.push(e,[i,y]):C[M+1].push(i,y)}else C.push(e,y)}}}function cA(n,t,e){return e&&n.componentProviders++,n.multi.push(t)-1}function bC(n,t,e,i){for(let r=e;r<i;r++)if(t[r]===n)return r;return-1}function H3(n,t,e,i){return _C(this.multi,[])}function $3(n,t,e,i){const r=this.multi;let s;if(this.providerFactory){const d=this.providerFactory.componentProviders,m=Tl(e,e[1],this.providerFactory.index,i);s=m.slice(0,d),_C(r,s);for(let y=d;y<m.length;y++)s.push(m[y])}else s=[],_C(r,s);return s}function _C(n,t){for(let e=0;e<n.length;e++)t.push((0,n[e])());return t}function Vn(n,t=[]){return e=>{e.providersResolver=(i,r)=>function U3(n,t,e){const i=tr();if(i.firstCreatePass){const r=Ls(n);mC(e,i.data,i.blueprint,r,!0),mC(t,i.data,i.blueprint,r,!1)}}(i,r?r(n):n,t)}}class tm{}class uA{}class dA extends tm{constructor(t,e){super(),this._parent=e,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new fr(this);const i=bs(t);this._bootstrapComponents=pc(i.bootstrap),this._r3Injector=Z0(t,e,[{provide:tm,useValue:this},{provide:Gd,useValue:this.componentFactoryResolver}],zi(t),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(t)}get injector(){return this._r3Injector}destroy(){const t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(e=>e()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}}class yC extends uA{constructor(t){super(),this.moduleType=t}create(t){return new dA(this.moduleType,t)}}class W3 extends tm{constructor(t,e,i){super(),this.componentFactoryResolver=new fr(this),this.instance=null;const r=new Q_([...t,{provide:tm,useValue:this},{provide:Gd,useValue:this.componentFactoryResolver}],e||Ng(),i,new Set(["environment"]));this.injector=r,r.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(t){this.injector.onDestroy(t)}}function gx(n,t,e=null){return new W3(n,t,e).injector}let X3=(()=>{class n{constructor(e){this._injector=e,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(e){if(!e.standalone)return null;if(!this.cachedInjectors.has(e.id)){const i=k0(0,e.type),r=i.length>0?gx([i],this._injector,`Standalone[${e.type.name}]`):null;this.cachedInjectors.set(e.id,r)}return this.cachedInjectors.get(e.id)}ngOnDestroy(){try{for(const e of this.cachedInjectors.values())null!==e&&e.destroy()}finally{this.cachedInjectors.clear()}}}return n.\u0275prov=Jt({token:n,providedIn:"environment",factory:()=>new n(ze(Zc))}),n})();function hA(n){n.getStandaloneInjector=t=>t.get(X3).getOrCreateStandaloneInjector(n)}function xC(n,t,e,i){return yA(At(),jo(),n,t,e,i)}function yA(n,t,e,i,r,s){const d=t+e;return rs(n,d,r)?function js(n,t,e){return n[t]=e}(n,d+1,s?i.call(s,r):i(r)):function Fy(n,t){const e=n[t];return e===bi?void 0:e}(n,d+1)}function yb(n,t){const e=tr();let i;const r=n+22;e.firstCreatePass?(i=function hz(n,t){if(t)for(let e=t.length-1;e>=0;e--){const i=t[e];if(n===i.name)return i}}(t,e.pipeRegistry),e.data[r]=i,i.onDestroy&&(e.destroyHooks||(e.destroyHooks=[])).push(r,i.onDestroy)):i=e.data[r];const s=i.factory||(i.factory=la(i.type)),d=Rs(G);try{const m=oi(!1),y=s();return oi(m),function rB(n,t,e,i){e>=n.data.length&&(n.data[e]=null,n.blueprint[e]=null),t[e]=i}(e,At(),r,y),y}finally{Rs(d)}}function vb(n,t,e){const i=n+22,r=At(),s=ec(r,i);return function Ny(n,t){return n[1].data[t].pure}(r,i)?yA(r,jo(),t,s.transform,e,s):s.transform(e)}function wC(n){return t=>{setTimeout(n,void 0,t)}}const nn=class bz extends Zt{constructor(t=!1){super(),this.__isAsync=t}emit(t){super.next(t)}subscribe(t,e,i){var r,s,d;let m=t,y=e||(()=>null),C=i;if(t&&"object"==typeof t){const k=t;m=null===(r=k.next)||void 0===r?void 0:r.bind(k),y=null===(s=k.error)||void 0===s?void 0:s.bind(k),C=null===(d=k.complete)||void 0===d?void 0:d.bind(k)}this.__isAsync&&(y=wC(y),m&&(m=wC(m)),C&&(C=wC(C)));const M=super.subscribe({next:m,error:y,complete:C});return t instanceof te&&t.add(M),M}};function _z(){return this._results[Wu()]()}class nm{constructor(t=!1){this._emitDistinctChangesOnly=t,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const e=Wu(),i=nm.prototype;i[e]||(i[e]=_z)}get changes(){return this._changes||(this._changes=new nn)}get(t){return this._results[t]}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,e){return this._results.reduce(t,e)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(t,e){const i=this;i.dirty=!1;const r=ha(t);(this._changesDetected=!function qv(n,t,e){if(n.length!==t.length)return!1;for(let i=0;i<n.length;i++){let r=n[i],s=t[i];if(e&&(r=e(r),s=e(s)),s!==r)return!1}return!0}(i._results,r,e))&&(i._results=r,i.length=r.length,i.last=r[this.length-1],i.first=r[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let Qr=(()=>{class n{}return n.__NG_ELEMENT_ID__=xz,n})();const yz=Qr,vz=class extends yz{constructor(t,e,i){super(),this._declarationLView=t,this._declarationTContainer=e,this.elementRef=i}createEmbeddedView(t,e){const i=this._declarationTContainer.tViews,r=Jd(this._declarationLView,i,t,16,null,i.declTNode,null,null,null,null,e||null);r[17]=this._declarationLView[this._declarationTContainer.index];const d=this._declarationLView[19];return null!==d&&(r[19]=d.createEmbeddedView(i)),cb(i,r,t),new ir(r)}};function xz(){return bx(Co(),At())}function bx(n,t){return 4&n.type?new vz(t,n,Rl(n,t)):null}let Fo=(()=>{class n{}return n.__NG_ELEMENT_ID__=wz,n})();function wz(){return EA(Co(),At())}const Sz=Fo,CA=class extends Sz{constructor(t,e,i){super(),this._lContainer=t,this._hostTNode=e,this._hostLView=i}get element(){return Rl(this._hostTNode,this._hostLView)}get injector(){return new Il(this._hostTNode,this._hostLView)}get parentInjector(){const t=Ir(this._hostTNode,this._hostLView);if(In(t)){const e=An(t,this._hostLView),i=zn(t);return new Il(e[1].data[i+8],e)}return new Il(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){const e=TA(this._lContainer);return null!==e&&e[t]||null}get length(){return this._lContainer.length-10}createEmbeddedView(t,e,i){let r,s;"number"==typeof i?r=i:null!=i&&(r=i.index,s=i.injector);const d=t.createEmbeddedView(e||{},s);return this.insert(d,r),d}createComponent(t,e,i,r,s){const d=t&&!function pf(n){return"function"==typeof n}(t);let m;if(d)m=e;else{const k=e||{};m=k.index,i=k.injector,r=k.projectableNodes,s=k.environmentInjector||k.ngModuleRef}const y=d?t:new Gr(hr(t)),C=i||this.parentInjector;if(!s&&null==y.ngModule){const z=(d?C:this.parentInjector).get(Zc,null);z&&(s=z)}const M=y.create(C,r,void 0,s);return this.insert(M.hostView,m),M}insert(t,e){const i=t._lView,r=i[1];if(function kd(n){return Ea(n[3])}(i)){const M=this.indexOf(t);if(-1!==M)this.detach(M);else{const k=i[3],z=new CA(k,k[6],k[3]);z.detach(z.indexOf(t))}}const s=this._adjustIndex(e),d=this._lContainer;!function l0(n,t,e,i){const r=10+i,s=e.length;i>0&&(e[r-1][4]=t),i<s-10?(t[4]=e[r],Wv(e,10+i,t)):(e.push(t),t[4]=null),t[3]=e;const d=t[17];null!==d&&e!==d&&function o1(n,t){const e=n[9];t[16]!==t[3][3][16]&&(n[2]=!0),null===e?n[9]=[t]:e.push(t)}(d,t);const m=t[19];null!==m&&m.insertView(n),t[2]|=64}(r,i,d,s);const m=N_(s,d),y=i[11],C=Hd(y,d[7]);return null!==C&&function n1(n,t,e,i,r,s){i[0]=r,i[6]=t,cc(n,i,e,1,r,s)}(r,d[6],y,i,C,m),t.attachToViewContainerRef(),Wv(SC(d),s,t),t}move(t,e){return this.insert(t,e)}indexOf(t){const e=TA(this._lContainer);return null!==e?e.indexOf(t):-1}remove(t){const e=this._adjustIndex(t,-1),i=xg(this._lContainer,e);i&&(eg(SC(this._lContainer),e),L_(i[1],i))}detach(t){const e=this._adjustIndex(t,-1),i=xg(this._lContainer,e);return i&&null!=eg(SC(this._lContainer),e)?new ir(i):null}_adjustIndex(t,e=0){return null==t?this.length+e:t}};function TA(n){return n[8]}function SC(n){return n[8]||(n[8]=[])}function EA(n,t){let e;const i=t[n.index];if(Ea(i))e=i;else{let r;if(8&n.type)r=Zr(i);else{const s=t[11];r=s.createComment("");const d=Os(n,t);Xc(s,Hd(s,d),r,function f0(n,t){return n.nextSibling(t)}(s,d),!1)}t[n.index]=e=_t(i,t,r,n),ft(t,e)}return new CA(e,n,t)}class CC{constructor(t){this.queryList=t,this.matches=null}clone(){return new CC(this.queryList)}setDirty(){this.queryList.setDirty()}}class TC{constructor(t=[]){this.queries=t}createEmbeddedView(t){const e=t.queries;if(null!==e){const i=null!==t.contentQueries?t.contentQueries[0]:e.length,r=[];for(let s=0;s<i;s++){const d=e.getByIndex(s);r.push(this.queries[d.indexInDeclarationView].clone())}return new TC(r)}return null}insertView(t){this.dirtyQueriesWithMatches(t)}detachView(t){this.dirtyQueriesWithMatches(t)}dirtyQueriesWithMatches(t){for(let e=0;e<this.queries.length;e++)null!==kA(t,e).matches&&this.queries[e].setDirty()}}class DA{constructor(t,e,i=null){this.predicate=t,this.flags=e,this.read=i}}class EC{constructor(t=[]){this.queries=t}elementStart(t,e){for(let i=0;i<this.queries.length;i++)this.queries[i].elementStart(t,e)}elementEnd(t){for(let e=0;e<this.queries.length;e++)this.queries[e].elementEnd(t)}embeddedTView(t){let e=null;for(let i=0;i<this.length;i++){const r=null!==e?e.length:0,s=this.getByIndex(i).embeddedTView(t,r);s&&(s.indexInDeclarationView=i,null!==e?e.push(s):e=[s])}return null!==e?new EC(e):null}template(t,e){for(let i=0;i<this.queries.length;i++)this.queries[i].template(t,e)}getByIndex(t){return this.queries[t]}get length(){return this.queries.length}track(t){this.queries.push(t)}}class DC{constructor(t,e=-1){this.metadata=t,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=e}elementStart(t,e){this.isApplyingToNode(e)&&this.matchTNode(t,e)}elementEnd(t){this._declarationNodeIndex===t.index&&(this._appliesToNextNode=!1)}template(t,e){this.elementStart(t,e)}embeddedTView(t,e){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,e),new DC(this.metadata)):null}isApplyingToNode(t){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const e=this._declarationNodeIndex;let i=t.parent;for(;null!==i&&8&i.type&&i.index!==e;)i=i.parent;return e===(null!==i?i.index:-1)}return this._appliesToNextNode}matchTNode(t,e){const i=this.metadata.predicate;if(Array.isArray(i))for(let r=0;r<i.length;r++){const s=i[r];this.matchTNodeWithReadOption(t,e,Ez(e,s)),this.matchTNodeWithReadOption(t,e,il(e,t,s,!1,!1))}else i===Qr?4&e.type&&this.matchTNodeWithReadOption(t,e,-1):this.matchTNodeWithReadOption(t,e,il(e,t,i,!1,!1))}matchTNodeWithReadOption(t,e,i){if(null!==i){const r=this.metadata.read;if(null!==r)if(r===Tn||r===Fo||r===Qr&&4&e.type)this.addMatch(e.index,-2);else{const s=il(e,t,r,!1,!1);null!==s&&this.addMatch(e.index,s)}else this.addMatch(e.index,i)}}addMatch(t,e){null===this.matches?this.matches=[t,e]:this.matches.push(t,e)}}function Ez(n,t){const e=n.localNames;if(null!==e)for(let i=0;i<e.length;i+=2)if(e[i]===t)return e[i+1];return null}function Iz(n,t,e,i){return-1===e?function Dz(n,t){return 11&n.type?Rl(n,t):4&n.type?bx(n,t):null}(t,n):-2===e?function Mz(n,t,e){return e===Tn?Rl(t,n):e===Qr?bx(t,n):e===Fo?EA(t,n):void 0}(n,t,i):Tl(n,n[1],e,t)}function IA(n,t,e,i){const r=t[19].queries[i];if(null===r.matches){const s=n.data,d=e.matches,m=[];for(let y=0;y<d.length;y+=2){const C=d[y];m.push(C<0?null:Iz(t,s[C],d[y+1],e.metadata.read))}r.matches=m}return r.matches}function IC(n,t,e,i){const r=n.queries.getByIndex(e),s=r.matches;if(null!==s){const d=IA(n,t,r,e);for(let m=0;m<s.length;m+=2){const y=s[m];if(y>0)i.push(d[m/2]);else{const C=s[m+1],M=t[-y];for(let k=10;k<M.length;k++){const z=M[k];z[17]===z[3]&&IC(z[1],z,C,i)}if(null!==M[9]){const k=M[9];for(let z=0;z<k.length;z++){const q=k[z];IC(q[1],q,C,i)}}}}}return i}function Nn(n){const t=At(),e=tr(),i=Km();Pd(i+1);const r=kA(e,i);if(n.dirty&&function Uh(n){return 4==(4&n[2])}(t)===(2==(2&r.metadata.flags))){if(null===r.matches)n.reset([]);else{const s=r.crossesNgTemplate?IC(e,t,i,[]):IA(e,t,r,i);n.reset(s,Vg),n.notifyOnChanges()}return!0}return!1}function ur(n,t,e){const i=tr();i.firstCreatePass&&(AA(i,new DA(n,t,e),-1),2==(2&t)&&(i.staticViewQueries=!0)),MA(i,At(),t)}function zr(n,t,e,i){const r=tr();if(r.firstCreatePass){const s=Co();AA(r,new DA(t,e,i),s.index),function kz(n,t){const e=n.contentQueries||(n.contentQueries=[]);t!==(e.length?e[e.length-1]:-1)&&e.push(n.queries.length-1,t)}(r,n),2==(2&e)&&(r.staticContentQueries=!0)}MA(r,At(),e)}function Bn(){return function Az(n,t){return n[19].queries[t].queryList}(At(),Km())}function MA(n,t,e){const i=new nm(4==(4&e));bp(n,t,i,i.destroy),null===t[19]&&(t[19]=new TC),t[19].queries.push(new CC(i))}function AA(n,t,e){null===n.queries&&(n.queries=new EC),n.queries.track(new DC(t,e))}function kA(n,t){return n.queries.getByIndex(t)}function im(n,t){return bx(n,t)}function yx(...n){}const vx=new Et("Application Initializer");let xx=(()=>{class n{constructor(e){this.appInits=e,this.resolve=yx,this.reject=yx,this.initialized=!1,this.done=!1,this.donePromise=new Promise((i,r)=>{this.resolve=i,this.reject=r})}runInitializers(){if(this.initialized)return;const e=[],i=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let r=0;r<this.appInits.length;r++){const s=this.appInits[r]();if(Dy(s))e.push(s);else if(uC(s)){const d=new Promise((m,y)=>{s.subscribe({complete:m,error:y})});e.push(d)}}Promise.all(e).then(()=>{i()}).catch(r=>{this.reject(r)}),0===e.length&&i(),this.initialized=!0}}return n.\u0275fac=function(e){return new(e||n)(ze(vx,8))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const Sb=new Et("AppId",{providedIn:"root",factory:function YA(){return`${PC()}${PC()}${PC()}`}});function PC(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const KA=new Et("Platform Initializer"),wx=new Et("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),QA=new Et("appBootstrapListener"),Qu=new Et("AnimationModuleType");let Kz=(()=>{class n{log(e){console.log(e)}warn(e){console.warn(e)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})();const Vl=new Et("LocaleId",{providedIn:"root",factory:()=>Fr(Vl,Un.Optional|Un.SkipSelf)||function Qz(){return"undefined"!=typeof $localize&&$localize.locale||_b}()});class eV{constructor(t,e){this.ngModuleFactory=t,this.componentFactories=e}}let LC=(()=>{class n{compileModuleSync(e){return new yC(e)}compileModuleAsync(e){return Promise.resolve(this.compileModuleSync(e))}compileModuleAndAllComponentsSync(e){const i=this.compileModuleSync(e),s=pc(bs(e).declarations).reduce((d,m)=>{const y=hr(m);return y&&d.push(new Gr(y)),d},[]);return new eV(i,s)}compileModuleAndAllComponentsAsync(e){return Promise.resolve(this.compileModuleAndAllComponentsSync(e))}clearCache(){}clearCacheFor(e){}getModuleId(e){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const iV=(()=>Promise.resolve(0))();function OC(n){"undefined"==typeof Zone?iV.then(()=>{n&&n.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",n)}class qn{constructor({enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:e=!1,shouldCoalesceRunChangeDetection:i=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new nn(!1),this.onMicrotaskEmpty=new nn(!1),this.onStable=new nn(!1),this.onError=new nn(!1),"undefined"==typeof Zone)throw new Ot(908,!1);Zone.assertZonePatched();const r=this;if(r._nesting=0,r._outer=r._inner=Zone.current,Zone.AsyncStackTaggingZoneSpec){const s=Zone.AsyncStackTaggingZoneSpec;r._inner=r._inner.fork(new s("Angular"))}Zone.TaskTrackingZoneSpec&&(r._inner=r._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(r._inner=r._inner.fork(Zone.longStackTraceZoneSpec)),r.shouldCoalesceEventChangeDetection=!i&&e,r.shouldCoalesceRunChangeDetection=i,r.lastRequestAnimationFrameId=-1,r.nativeRequestAnimationFrame=function rV(){let n=Lr.requestAnimationFrame,t=Lr.cancelAnimationFrame;if("undefined"!=typeof Zone&&n&&t){const e=n[Zone.__symbol__("OriginalDelegate")];e&&(n=e);const i=t[Zone.__symbol__("OriginalDelegate")];i&&(t=i)}return{nativeRequestAnimationFrame:n,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function aV(n){const t=()=>{!function sV(n){n.isCheckStableRunning||-1!==n.lastRequestAnimationFrameId||(n.lastRequestAnimationFrameId=n.nativeRequestAnimationFrame.call(Lr,()=>{n.fakeTopEventTask||(n.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{n.lastRequestAnimationFrameId=-1,NC(n),n.isCheckStableRunning=!0,FC(n),n.isCheckStableRunning=!1},void 0,()=>{},()=>{})),n.fakeTopEventTask.invoke()}),NC(n))}(n)};n._inner=n._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(e,i,r,s,d,m)=>{try{return tk(n),e.invokeTask(r,s,d,m)}finally{(n.shouldCoalesceEventChangeDetection&&"eventTask"===s.type||n.shouldCoalesceRunChangeDetection)&&t(),nk(n)}},onInvoke:(e,i,r,s,d,m,y)=>{try{return tk(n),e.invoke(r,s,d,m,y)}finally{n.shouldCoalesceRunChangeDetection&&t(),nk(n)}},onHasTask:(e,i,r,s)=>{e.hasTask(r,s),i===r&&("microTask"==s.change?(n._hasPendingMicrotasks=s.microTask,NC(n),FC(n)):"macroTask"==s.change&&(n.hasPendingMacrotasks=s.macroTask))},onHandleError:(e,i,r,s)=>(e.handleError(r,s),n.runOutsideAngular(()=>n.onError.emit(s)),!1)})}(r)}static isInAngularZone(){return"undefined"!=typeof Zone&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!qn.isInAngularZone())throw new Ot(909,!1)}static assertNotInAngularZone(){if(qn.isInAngularZone())throw new Ot(909,!1)}run(t,e,i){return this._inner.run(t,e,i)}runTask(t,e,i,r){const s=this._inner,d=s.scheduleEventTask("NgZoneEvent: "+r,t,oV,yx,yx);try{return s.runTask(d,e,i)}finally{s.cancelTask(d)}}runGuarded(t,e,i){return this._inner.runGuarded(t,e,i)}runOutsideAngular(t){return this._outer.run(t)}}const oV={};function FC(n){if(0==n._nesting&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function NC(n){n.hasPendingMicrotasks=!!(n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&-1!==n.lastRequestAnimationFrameId)}function tk(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function nk(n){n._nesting--,FC(n)}class lV{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new nn,this.onMicrotaskEmpty=new nn,this.onStable=new nn,this.onError=new nn}run(t,e,i){return t.apply(e,i)}runGuarded(t,e,i){return t.apply(e,i)}runOutsideAngular(t){return t()}runTask(t,e,i,r){return t.apply(e,i)}}const ik=new Et(""),Sx=new Et("");let zy,BC=(()=>{class n{constructor(e,i,r){this._ngZone=e,this.registry=i,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,zy||(function cV(n){zy=n}(r),r.addToWindow(i)),this._watchAngularEvents(),e.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{qn.assertNotInAngularZone(),OC(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())OC(()=>{for(;0!==this._callbacks.length;){let e=this._callbacks.pop();clearTimeout(e.timeoutId),e.doneCb(this._didWork)}this._didWork=!1});else{let e=this.getPendingTasks();this._callbacks=this._callbacks.filter(i=>!i.updateCb||!i.updateCb(e)||(clearTimeout(i.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(e=>({source:e.source,creationLocation:e.creationLocation,data:e.data})):[]}addCallback(e,i,r){let s=-1;i&&i>0&&(s=setTimeout(()=>{this._callbacks=this._callbacks.filter(d=>d.timeoutId!==s),e(this._didWork,this.getPendingTasks())},i)),this._callbacks.push({doneCb:e,timeoutId:s,updateCb:r})}whenStable(e,i,r){if(r&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(e,i,r),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(e){this.registry.registerApplication(e,this)}unregisterApplication(e){this.registry.unregisterApplication(e)}findProviders(e,i,r){return[]}}return n.\u0275fac=function(e){return new(e||n)(ze(qn),ze(zC),ze(Sx))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})(),zC=(()=>{class n{constructor(){this._applications=new Map}registerApplication(e,i){this._applications.set(e,i)}unregisterApplication(e){this._applications.delete(e)}unregisterAllApplications(){this._applications.clear()}getTestability(e){return this._applications.get(e)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(e,i=!0){var r;return null!==(r=null==zy?void 0:zy.findTestabilityInTree(this,e,i))&&void 0!==r?r:null}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})(),Ju=null;const rk=new Et("AllowMultipleToken"),VC=new Et("PlatformDestroyListeners");class ok{constructor(t,e){this.name=t,this.token=e}}function ak(n,t,e=[]){const i=`Platform: ${t}`,r=new Et(i);return(s=[])=>{let d=jC();if(!d||d.injector.get(rk,!1)){const m=[...e,...s,{provide:r,useValue:!0}];n?n(m):function hV(n){if(Ju&&!Ju.get(rk,!1))throw new Ot(400,!1);Ju=n;const t=n.get(ck);(function sk(n){const t=n.get(KA,null);t&&t.forEach(e=>e())})(n)}(function lk(n=[],t){return Nr.create({name:t,providers:[{provide:Y_,useValue:"platform"},{provide:VC,useValue:new Set([()=>Ju=null])},...n]})}(m,i))}return function fV(n){const t=jC();if(!t)throw new Ot(401,!1);return t}()}}function jC(){var n;return null!==(n=null==Ju?void 0:Ju.get(ck))&&void 0!==n?n:null}let ck=(()=>{class n{constructor(e){this._injector=e,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(e,i){const r=function dk(n,t){let e;return e="noop"===n?new lV:("zone.js"===n?void 0:n)||new qn(t),e}(null==i?void 0:i.ngZone,function uk(n){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!(!n||!n.ngZoneEventCoalescing)||!1,shouldCoalesceRunChangeDetection:!(!n||!n.ngZoneRunCoalescing)||!1}}(i)),s=[{provide:qn,useValue:r}];return r.run(()=>{const d=Nr.create({providers:s,parent:this.injector,name:e.moduleType.name}),m=e.create(d),y=m.injector.get(ul,null);if(!y)throw new Ot(402,!1);return r.runOutsideAngular(()=>{const C=r.onError.subscribe({next:M=>{y.handleError(M)}});m.onDestroy(()=>{Cx(this._modules,m),C.unsubscribe()})}),function hk(n,t,e){try{const i=e();return Dy(i)?i.catch(r=>{throw t.runOutsideAngular(()=>n.handleError(r)),r}):i}catch(i){throw t.runOutsideAngular(()=>n.handleError(i)),i}}(y,r,()=>{const C=m.injector.get(xx);return C.runInitializers(),C.donePromise.then(()=>(function zM(n){So(n,"Expected localeId to be defined"),"string"==typeof n&&(BM=n.toLowerCase().replace(/_/g,"-"))}(m.injector.get(Vl,_b)||_b),this._moduleDoBootstrap(m),m))})})}bootstrapModule(e,i=[]){const r=pk({},i);return function uV(n,t,e){const i=new yC(e);return Promise.resolve(i)}(0,0,e).then(s=>this.bootstrapModuleFactory(s,r))}_moduleDoBootstrap(e){const i=e.injector.get(Cb);if(e._bootstrapComponents.length>0)e._bootstrapComponents.forEach(r=>i.bootstrap(r));else{if(!e.instance.ngDoBootstrap)throw new Ot(403,!1);e.instance.ngDoBootstrap(i)}this._modules.push(e)}onDestroy(e){this._destroyListeners.push(e)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Ot(404,!1);this._modules.slice().forEach(i=>i.destroy()),this._destroyListeners.forEach(i=>i());const e=this._injector.get(VC,null);e&&(e.forEach(i=>i()),e.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return n.\u0275fac=function(e){return new(e||n)(ze(Nr))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})();function pk(n,t){return Array.isArray(t)?t.reduce(pk,n):Object.assign(Object.assign({},n),t)}let Cb=(()=>{class n{constructor(e,i,r){this._zone=e,this._injector=i,this._exceptionHandler=r,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this._destroyed=!1,this._destroyListeners=[],this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const s=new kt(m=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{m.next(this._stable),m.complete()})}),d=new kt(m=>{let y;this._zone.runOutsideAngular(()=>{y=this._zone.onStable.subscribe(()=>{qn.assertNotInAngularZone(),OC(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,m.next(!0))})})});const C=this._zone.onUnstable.subscribe(()=>{qn.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{m.next(!1)}))});return()=>{y.unsubscribe(),C.unsubscribe()}});this.isStable=Er(s,d.pipe(un()))}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(e,i){const r=e instanceof L0;if(!this._injector.get(xx).done)throw!r&&function _u(n){const t=hr(n)||ms(n)||gs(n);return null!==t&&t.standalone}(e),new Ot(405,false);let d;d=r?e:this._injector.get(Gd).resolveComponentFactory(e),this.componentTypes.push(d.componentType);const m=function dV(n){return n.isBoundToModule}(d)?void 0:this._injector.get(tm),C=d.create(Nr.NULL,[],i||d.selector,m),M=C.location.nativeElement,k=C.injector.get(ik,null);return null==k||k.registerApplication(M),C.onDestroy(()=>{this.detachView(C.hostView),Cx(this.components,C),null==k||k.unregisterApplication(M)}),this._loadComponent(C),C}tick(){if(this._runningTick)throw new Ot(101,!1);try{this._runningTick=!0;for(let e of this._views)e.detectChanges()}catch(e){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(e))}finally{this._runningTick=!1}}attachView(e){const i=e;this._views.push(i),i.attachToAppRef(this)}detachView(e){const i=e;Cx(this._views,i),i.detachFromAppRef()}_loadComponent(e){this.attachView(e.hostView),this.tick(),this.components.push(e),this._injector.get(QA,[]).concat(this._bootstrapListeners).forEach(r=>r(e))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(e=>e()),this._views.slice().forEach(e=>e.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(e){return this._destroyListeners.push(e),()=>Cx(this._destroyListeners,e)}destroy(){if(this._destroyed)throw new Ot(406,!1);const e=this._injector;e.destroy&&!e.destroyed&&e.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return n.\u0275fac=function(e){return new(e||n)(ze(qn),ze(Zc),ze(ul))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function Cx(n,t){const e=n.indexOf(t);e>-1&&n.splice(e,1)}let mk=!0,Sr=(()=>{class n{}return n.__NG_ELEMENT_ID__=bV,n})();function bV(n){return function _V(n,t,e){if(Lh(n)&&!e){const i=ys(n.index,t);return new ir(i,i)}return 47&n.type?new ir(t[16],t):null}(Co(),At(),16==(16&n))}class vk{constructor(){}supports(t){return yp(t)}create(t){return new CV(t)}}const SV=(n,t)=>t;class CV{constructor(t){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||SV}forEachItem(t){let e;for(e=this._itHead;null!==e;e=e._next)t(e)}forEachOperation(t){let e=this._itHead,i=this._removalsHead,r=0,s=null;for(;e||i;){const d=!i||e&&e.currentIndex<wk(i,r,s)?e:i,m=wk(d,r,s),y=d.currentIndex;if(d===i)r--,i=i._nextRemoved;else if(e=e._next,null==d.previousIndex)r++;else{s||(s=[]);const C=m-r,M=y-r;if(C!=M){for(let z=0;z<C;z++){const q=z<s.length?s[z]:s[z]=0,Q=q+z;M<=Q&&Q<C&&(s[z]=q+1)}s[d.previousIndex]=M-C}}m!==y&&t(d,m,y)}}forEachPreviousItem(t){let e;for(e=this._previousItHead;null!==e;e=e._nextPrevious)t(e)}forEachAddedItem(t){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)}forEachMovedItem(t){let e;for(e=this._movesHead;null!==e;e=e._nextMoved)t(e)}forEachRemovedItem(t){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)}forEachIdentityChange(t){let e;for(e=this._identityChangesHead;null!==e;e=e._nextIdentityChange)t(e)}diff(t){if(null==t&&(t=[]),!yp(t))throw new Ot(900,!1);return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let r,s,d,e=this._itHead,i=!1;if(Array.isArray(t)){this.length=t.length;for(let m=0;m<this.length;m++)s=t[m],d=this._trackByFn(m,s),null!==e&&Object.is(e.trackById,d)?(i&&(e=this._verifyReinsertion(e,s,d,m)),Object.is(e.item,s)||this._addIdentityChange(e,s)):(e=this._mismatch(e,s,d,m),i=!0),e=e._next}else r=0,function Ey(n,t){if(Array.isArray(n))for(let e=0;e<n.length;e++)t(n[e]);else{const e=n[Wu()]();let i;for(;!(i=e.next()).done;)t(i.value)}}(t,m=>{d=this._trackByFn(r,m),null!==e&&Object.is(e.trackById,d)?(i&&(e=this._verifyReinsertion(e,m,d,r)),Object.is(e.item,m)||this._addIdentityChange(e,m)):(e=this._mismatch(e,m,d,r),i=!0),e=e._next,r++}),this.length=r;return this._truncate(e),this.collection=t,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let t;for(t=this._previousItHead=this._itHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;null!==t;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;null!==t;t=t._nextMoved)t.previousIndex=t.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(t,e,i,r){let s;return null===t?s=this._itTail:(s=t._prev,this._remove(t)),null!==(t=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null))?(Object.is(t.item,e)||this._addIdentityChange(t,e),this._reinsertAfter(t,s,r)):null!==(t=null===this._linkedRecords?null:this._linkedRecords.get(i,r))?(Object.is(t.item,e)||this._addIdentityChange(t,e),this._moveAfter(t,s,r)):t=this._addAfter(new TV(e,i),s,r),t}_verifyReinsertion(t,e,i,r){let s=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null);return null!==s?t=this._reinsertAfter(s,t._prev,r):t.currentIndex!=r&&(t.currentIndex=r,this._addToMoves(t,r)),t}_truncate(t){for(;null!==t;){const e=t._next;this._addToRemovals(this._unlink(t)),t=e}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(t,e,i){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(t);const r=t._prevRemoved,s=t._nextRemoved;return null===r?this._removalsHead=s:r._nextRemoved=s,null===s?this._removalsTail=r:s._prevRemoved=r,this._insertAfter(t,e,i),this._addToMoves(t,i),t}_moveAfter(t,e,i){return this._unlink(t),this._insertAfter(t,e,i),this._addToMoves(t,i),t}_addAfter(t,e,i){return this._insertAfter(t,e,i),this._additionsTail=null===this._additionsTail?this._additionsHead=t:this._additionsTail._nextAdded=t,t}_insertAfter(t,e,i){const r=null===e?this._itHead:e._next;return t._next=r,t._prev=e,null===r?this._itTail=t:r._prev=t,null===e?this._itHead=t:e._next=t,null===this._linkedRecords&&(this._linkedRecords=new xk),this._linkedRecords.put(t),t.currentIndex=i,t}_remove(t){return this._addToRemovals(this._unlink(t))}_unlink(t){null!==this._linkedRecords&&this._linkedRecords.remove(t);const e=t._prev,i=t._next;return null===e?this._itHead=i:e._next=i,null===i?this._itTail=e:i._prev=e,t}_addToMoves(t,e){return t.previousIndex===e||(this._movesTail=null===this._movesTail?this._movesHead=t:this._movesTail._nextMoved=t),t}_addToRemovals(t){return null===this._unlinkedRecords&&(this._unlinkedRecords=new xk),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}_addIdentityChange(t,e){return t.item=e,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=t:this._identityChangesTail._nextIdentityChange=t,t}}class TV{constructor(t,e){this.item=t,this.trackById=e,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class EV{constructor(){this._head=null,this._tail=null}add(t){null===this._head?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}get(t,e){let i;for(i=this._head;null!==i;i=i._nextDup)if((null===e||e<=i.currentIndex)&&Object.is(i.trackById,t))return i;return null}remove(t){const e=t._prevDup,i=t._nextDup;return null===e?this._head=i:e._nextDup=i,null===i?this._tail=e:i._prevDup=e,null===this._head}}class xk{constructor(){this.map=new Map}put(t){const e=t.trackById;let i=this.map.get(e);i||(i=new EV,this.map.set(e,i)),i.add(t)}get(t,e){const r=this.map.get(t);return r?r.get(t,e):null}remove(t){const e=t.trackById;return this.map.get(e).remove(t)&&this.map.delete(e),t}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function wk(n,t,e){const i=n.previousIndex;if(null===i)return i;let r=0;return e&&i<e.length&&(r=e[i]),i+t+r}class Sk{constructor(){}supports(t){return t instanceof Map||hl(t)}create(){return new DV}}class DV{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(t){let e;for(e=this._mapHead;null!==e;e=e._next)t(e)}forEachPreviousItem(t){let e;for(e=this._previousMapHead;null!==e;e=e._nextPrevious)t(e)}forEachChangedItem(t){let e;for(e=this._changesHead;null!==e;e=e._nextChanged)t(e)}forEachAddedItem(t){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)}forEachRemovedItem(t){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)}diff(t){if(t){if(!(t instanceof Map||hl(t)))throw new Ot(900,!1)}else t=new Map;return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let e=this._mapHead;if(this._appendAfter=null,this._forEach(t,(i,r)=>{if(e&&e.key===r)this._maybeAddToChanges(e,i),this._appendAfter=e,e=e._next;else{const s=this._getOrCreateRecordForKey(r,i);e=this._insertBeforeOrAppend(e,s)}}),e){e._prev&&(e._prev._next=null),this._removalsHead=e;for(let i=e;null!==i;i=i._nextRemoved)i===this._mapHead&&(this._mapHead=null),this._records.delete(i.key),i._nextRemoved=i._next,i.previousValue=i.currentValue,i.currentValue=null,i._prev=null,i._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(t,e){if(t){const i=t._prev;return e._next=t,e._prev=i,t._prev=e,i&&(i._next=e),t===this._mapHead&&(this._mapHead=e),this._appendAfter=t,t}return this._appendAfter?(this._appendAfter._next=e,e._prev=this._appendAfter):this._mapHead=e,this._appendAfter=e,null}_getOrCreateRecordForKey(t,e){if(this._records.has(t)){const r=this._records.get(t);this._maybeAddToChanges(r,e);const s=r._prev,d=r._next;return s&&(s._next=d),d&&(d._prev=s),r._next=null,r._prev=null,r}const i=new IV(t);return this._records.set(t,i),i.currentValue=e,this._addToAdditions(i),i}_reset(){if(this.isDirty){let t;for(this._previousMapHead=this._mapHead,t=this._previousMapHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._changesHead;null!==t;t=t._nextChanged)t.previousValue=t.currentValue;for(t=this._additionsHead;null!=t;t=t._nextAdded)t.previousValue=t.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(t,e){Object.is(e,t.currentValue)||(t.previousValue=t.currentValue,t.currentValue=e,this._addToChanges(t))}_addToAdditions(t){null===this._additionsHead?this._additionsHead=this._additionsTail=t:(this._additionsTail._nextAdded=t,this._additionsTail=t)}_addToChanges(t){null===this._changesHead?this._changesHead=this._changesTail=t:(this._changesTail._nextChanged=t,this._changesTail=t)}_forEach(t,e){t instanceof Map?t.forEach(e):Object.keys(t).forEach(i=>e(t[i],i))}}class IV{constructor(t){this.key=t,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function Ck(){return new ed([new vk])}let ed=(()=>{class n{constructor(e){this.factories=e}static create(e,i){if(null!=i){const r=i.factories.slice();e=e.concat(r)}return new n(e)}static extend(e){return{provide:n,useFactory:i=>n.create(e,i||Ck()),deps:[[n,new Qh,new Kh]]}}find(e){const i=this.factories.find(r=>r.supports(e));if(null!=i)return i;throw new Ot(901,!1)}}return n.\u0275prov=Jt({token:n,providedIn:"root",factory:Ck}),n})();function Tk(){return new Vy([new Sk])}let Vy=(()=>{class n{constructor(e){this.factories=e}static create(e,i){if(i){const r=i.factories.slice();e=e.concat(r)}return new n(e)}static extend(e){return{provide:n,useFactory:i=>n.create(e,i||Tk()),deps:[[n,new Qh,new Kh]]}}find(e){const i=this.factories.find(r=>r.supports(e));if(i)return i;throw new Ot(901,!1)}}return n.\u0275prov=Jt({token:n,providedIn:"root",factory:Tk}),n})();const kV=ak(null,"core",[]);let RV=(()=>{class n{constructor(e){}}return n.\u0275fac=function(e){return new(e||n)(ze(Cb))},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({}),n})();function rh(n){return"boolean"==typeof n?n:null!=n&&"false"!==n}let Dx=null;function td(){return Dx}const $n=new Et("DocumentToken");let qC=(()=>{class n{historyGo(e){throw new Error("Not implemented")}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Jt({token:n,factory:function(){return function FV(){return ze(Ek)}()},providedIn:"platform"}),n})();const NV=new Et("Location Initialized");let Ek=(()=>{class n extends qC{constructor(e){super(),this._doc=e,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return td().getBaseHref(this._doc)}onPopState(e){const i=td().getGlobalEventTarget(this._doc,"window");return i.addEventListener("popstate",e,!1),()=>i.removeEventListener("popstate",e)}onHashChange(e){const i=td().getGlobalEventTarget(this._doc,"window");return i.addEventListener("hashchange",e,!1),()=>i.removeEventListener("hashchange",e)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(e){this.location.pathname=e}pushState(e,i,r){Dk()?this._history.pushState(e,i,r):this.location.hash=r}replaceState(e,i,r){Dk()?this._history.replaceState(e,i,r):this.location.hash=r}forward(){this._history.forward()}back(){this._history.back()}historyGo(e=0){this._history.go(e)}getState(){return this._history.state}}return n.\u0275fac=function(e){return new(e||n)(ze($n))},n.\u0275prov=Jt({token:n,factory:function(){return function BV(){return new Ek(ze($n))}()},providedIn:"platform"}),n})();function Dk(){return!!window.history.pushState}function WC(n,t){if(0==n.length)return t;if(0==t.length)return n;let e=0;return n.endsWith("/")&&e++,t.startsWith("/")&&e++,2==e?n+t.substring(1):1==e?n+t:n+"/"+t}function Ik(n){const t=n.match(/#|\?|$/),e=t&&t.index||n.length;return n.slice(0,e-("/"===n[e-1]?1:0))+n.slice(e)}function oh(n){return n&&"?"!==n[0]?"?"+n:n}let om=(()=>{class n{historyGo(e){throw new Error("Not implemented")}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Jt({token:n,factory:function(){return Fr(Ak)},providedIn:"root"}),n})();const Mk=new Et("appBaseHref");let Ak=(()=>{class n extends om{constructor(e,i){var r,s,d;super(),this._platformLocation=e,this._removeListenerFns=[],this._baseHref=null!==(d=null!==(r=null!=i?i:this._platformLocation.getBaseHrefFromDOM())&&void 0!==r?r:null===(s=Fr($n).location)||void 0===s?void 0:s.origin)&&void 0!==d?d:""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}prepareExternalUrl(e){return WC(this._baseHref,e)}path(e=!1){const i=this._platformLocation.pathname+oh(this._platformLocation.search),r=this._platformLocation.hash;return r&&e?`${i}${r}`:i}pushState(e,i,r,s){const d=this.prepareExternalUrl(r+oh(s));this._platformLocation.pushState(e,i,d)}replaceState(e,i,r,s){const d=this.prepareExternalUrl(r+oh(s));this._platformLocation.replaceState(e,i,d)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){var i,r;null===(r=(i=this._platformLocation).historyGo)||void 0===r||r.call(i,e)}}return n.\u0275fac=function(e){return new(e||n)(ze(qC),ze(Mk,8))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),zV=(()=>{class n extends om{constructor(e,i){super(),this._platformLocation=e,this._baseHref="",this._removeListenerFns=[],null!=i&&(this._baseHref=i)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}path(e=!1){let i=this._platformLocation.hash;return null==i&&(i="#"),i.length>0?i.substring(1):i}prepareExternalUrl(e){const i=WC(this._baseHref,e);return i.length>0?"#"+i:i}pushState(e,i,r,s){let d=this.prepareExternalUrl(r+oh(s));0==d.length&&(d=this._platformLocation.pathname),this._platformLocation.pushState(e,i,d)}replaceState(e,i,r,s){let d=this.prepareExternalUrl(r+oh(s));0==d.length&&(d=this._platformLocation.pathname),this._platformLocation.replaceState(e,i,d)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){var i,r;null===(r=(i=this._platformLocation).historyGo)||void 0===r||r.call(i,e)}}return n.\u0275fac=function(e){return new(e||n)(ze(qC),ze(Mk,8))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})(),Ix=(()=>{class n{constructor(e){this._subject=new nn,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=e;const i=this._locationStrategy.getBaseHref();this._baseHref=Ik(kk(i)),this._locationStrategy.onPopState(r=>{this._subject.emit({url:this.path(!0),pop:!0,state:r.state,type:r.type})})}ngOnDestroy(){var e;null===(e=this._urlChangeSubscription)||void 0===e||e.unsubscribe(),this._urlChangeListeners=[]}path(e=!1){return this.normalize(this._locationStrategy.path(e))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(e,i=""){return this.path()==this.normalize(e+oh(i))}normalize(e){return n.stripTrailingSlash(function jV(n,t){return n&&t.startsWith(n)?t.substring(n.length):t}(this._baseHref,kk(e)))}prepareExternalUrl(e){return e&&"/"!==e[0]&&(e="/"+e),this._locationStrategy.prepareExternalUrl(e)}go(e,i="",r=null){this._locationStrategy.pushState(r,"",e,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+oh(i)),r)}replaceState(e,i="",r=null){this._locationStrategy.replaceState(r,"",e,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+oh(i)),r)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(e=0){var i,r;null===(r=(i=this._locationStrategy).historyGo)||void 0===r||r.call(i,e)}onUrlChange(e){return this._urlChangeListeners.push(e),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(i=>{this._notifyUrlChangeListeners(i.url,i.state)})),()=>{var i;const r=this._urlChangeListeners.indexOf(e);this._urlChangeListeners.splice(r,1),0===this._urlChangeListeners.length&&(null===(i=this._urlChangeSubscription)||void 0===i||i.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(e="",i){this._urlChangeListeners.forEach(r=>r(e,i))}subscribe(e,i,r){return this._subject.subscribe({next:e,error:i,complete:r})}}return n.normalizeQueryParams=oh,n.joinWithSlash=WC,n.stripTrailingSlash=Ik,n.\u0275fac=function(e){return new(e||n)(ze(om))},n.\u0275prov=Jt({token:n,factory:function(){return function VV(){return new Ix(ze(om))}()},providedIn:"root"}),n})();function kk(n){return n.replace(/\/index.html$/,"")}var Xo=(()=>((Xo=Xo||{})[Xo.Format=0]="Format",Xo[Xo.Standalone=1]="Standalone",Xo))(),ar=(()=>((ar=ar||{})[ar.Narrow=0]="Narrow",ar[ar.Abbreviated=1]="Abbreviated",ar[ar.Wide=2]="Wide",ar[ar.Short=3]="Short",ar))(),Ao=(()=>((Ao=Ao||{})[Ao.Short=0]="Short",Ao[Ao.Medium=1]="Medium",Ao[Ao.Long=2]="Long",Ao[Ao.Full=3]="Full",Ao))(),si=(()=>((si=si||{})[si.Decimal=0]="Decimal",si[si.Group=1]="Group",si[si.List=2]="List",si[si.PercentSign=3]="PercentSign",si[si.PlusSign=4]="PlusSign",si[si.MinusSign=5]="MinusSign",si[si.Exponential=6]="Exponential",si[si.SuperscriptingExponent=7]="SuperscriptingExponent",si[si.PerMille=8]="PerMille",si[si.Infinity=9]="Infinity",si[si.NaN=10]="NaN",si[si.TimeSeparator=11]="TimeSeparator",si[si.CurrencyDecimal=12]="CurrencyDecimal",si[si.CurrencyGroup=13]="CurrencyGroup",si))();function Mx(n,t){return wc(ja(n)[Dn.DateFormat],t)}function Ax(n,t){return wc(ja(n)[Dn.TimeFormat],t)}function kx(n,t){return wc(ja(n)[Dn.DateTimeFormat],t)}function xc(n,t){const e=ja(n),i=e[Dn.NumberSymbols][t];if(void 0===i){if(t===si.CurrencyDecimal)return e[Dn.NumberSymbols][si.Decimal];if(t===si.CurrencyGroup)return e[Dn.NumberSymbols][si.Group]}return i}function Pk(n){if(!n[Dn.ExtraData])throw new Error(`Missing extra locale data for the locale "${n[Dn.LocaleId]}". Use "registerLocaleData" to load new data. See the "I18n guide" on angular.io to know more.`)}function wc(n,t){for(let e=t;e>-1;e--)if(void 0!==n[e])return n[e];throw new Error("Locale data API: locale data undefined")}function ZC(n){const[t,e]=n.split(":");return{hours:+t,minutes:+e}}const e6=/^(\d{4,})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,jy={},t6=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;var Cs=(()=>((Cs=Cs||{})[Cs.Short=0]="Short",Cs[Cs.ShortGMT=1]="ShortGMT",Cs[Cs.Long=2]="Long",Cs[Cs.Extended=3]="Extended",Cs))(),_i=(()=>((_i=_i||{})[_i.FullYear=0]="FullYear",_i[_i.Month=1]="Month",_i[_i.Date=2]="Date",_i[_i.Hours=3]="Hours",_i[_i.Minutes=4]="Minutes",_i[_i.Seconds=5]="Seconds",_i[_i.FractionalSeconds=6]="FractionalSeconds",_i[_i.Day=7]="Day",_i))(),Ui=(()=>((Ui=Ui||{})[Ui.DayPeriods=0]="DayPeriods",Ui[Ui.Days=1]="Days",Ui[Ui.Months=2]="Months",Ui[Ui.Eras=3]="Eras",Ui))();function n6(n,t,e,i){let r=function d6(n){if(Fk(n))return n;if("number"==typeof n&&!isNaN(n))return new Date(n);if("string"==typeof n){if(n=n.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(n)){const[r,s=1,d=1]=n.split("-").map(m=>+m);return Rx(r,s-1,d)}const e=parseFloat(n);if(!isNaN(n-e))return new Date(e);let i;if(i=n.match(e6))return function h6(n){const t=new Date(0);let e=0,i=0;const r=n[8]?t.setUTCFullYear:t.setFullYear,s=n[8]?t.setUTCHours:t.setHours;n[9]&&(e=Number(n[9]+n[10]),i=Number(n[9]+n[11])),r.call(t,Number(n[1]),Number(n[2])-1,Number(n[3]));const d=Number(n[4]||0)-e,m=Number(n[5]||0)-i,y=Number(n[6]||0),C=Math.floor(1e3*parseFloat("0."+(n[7]||0)));return s.call(t,d,m,y,C),t}(i)}const t=new Date(n);if(!Fk(t))throw new Error(`Unable to convert "${n}" into a date`);return t}(n);t=sh(e,t)||t;let m,d=[];for(;t;){if(m=t6.exec(t),!m){d.push(t);break}{d=d.concat(m.slice(1));const M=d.pop();if(!M)break;t=M}}let y=r.getTimezoneOffset();i&&(y=Ok(i,y),r=function u6(n,t,e){const i=e?-1:1,r=n.getTimezoneOffset();return function c6(n,t){return(n=new Date(n.getTime())).setMinutes(n.getMinutes()+t),n}(n,i*(Ok(t,r)-r))}(r,i,!0));let C="";return d.forEach(M=>{const k=function l6(n){if(KC[n])return KC[n];let t;switch(n){case"G":case"GG":case"GGG":t=so(Ui.Eras,ar.Abbreviated);break;case"GGGG":t=so(Ui.Eras,ar.Wide);break;case"GGGGG":t=so(Ui.Eras,ar.Narrow);break;case"y":t=ss(_i.FullYear,1,0,!1,!0);break;case"yy":t=ss(_i.FullYear,2,0,!0,!0);break;case"yyy":t=ss(_i.FullYear,3,0,!1,!0);break;case"yyyy":t=ss(_i.FullYear,4,0,!1,!0);break;case"Y":t=Fx(1);break;case"YY":t=Fx(2,!0);break;case"YYY":t=Fx(3);break;case"YYYY":t=Fx(4);break;case"M":case"L":t=ss(_i.Month,1,1);break;case"MM":case"LL":t=ss(_i.Month,2,1);break;case"MMM":t=so(Ui.Months,ar.Abbreviated);break;case"MMMM":t=so(Ui.Months,ar.Wide);break;case"MMMMM":t=so(Ui.Months,ar.Narrow);break;case"LLL":t=so(Ui.Months,ar.Abbreviated,Xo.Standalone);break;case"LLLL":t=so(Ui.Months,ar.Wide,Xo.Standalone);break;case"LLLLL":t=so(Ui.Months,ar.Narrow,Xo.Standalone);break;case"w":t=YC(1);break;case"ww":t=YC(2);break;case"W":t=YC(1,!0);break;case"d":t=ss(_i.Date,1);break;case"dd":t=ss(_i.Date,2);break;case"c":case"cc":t=ss(_i.Day,1);break;case"ccc":t=so(Ui.Days,ar.Abbreviated,Xo.Standalone);break;case"cccc":t=so(Ui.Days,ar.Wide,Xo.Standalone);break;case"ccccc":t=so(Ui.Days,ar.Narrow,Xo.Standalone);break;case"cccccc":t=so(Ui.Days,ar.Short,Xo.Standalone);break;case"E":case"EE":case"EEE":t=so(Ui.Days,ar.Abbreviated);break;case"EEEE":t=so(Ui.Days,ar.Wide);break;case"EEEEE":t=so(Ui.Days,ar.Narrow);break;case"EEEEEE":t=so(Ui.Days,ar.Short);break;case"a":case"aa":case"aaa":t=so(Ui.DayPeriods,ar.Abbreviated);break;case"aaaa":t=so(Ui.DayPeriods,ar.Wide);break;case"aaaaa":t=so(Ui.DayPeriods,ar.Narrow);break;case"b":case"bb":case"bbb":t=so(Ui.DayPeriods,ar.Abbreviated,Xo.Standalone,!0);break;case"bbbb":t=so(Ui.DayPeriods,ar.Wide,Xo.Standalone,!0);break;case"bbbbb":t=so(Ui.DayPeriods,ar.Narrow,Xo.Standalone,!0);break;case"B":case"BB":case"BBB":t=so(Ui.DayPeriods,ar.Abbreviated,Xo.Format,!0);break;case"BBBB":t=so(Ui.DayPeriods,ar.Wide,Xo.Format,!0);break;case"BBBBB":t=so(Ui.DayPeriods,ar.Narrow,Xo.Format,!0);break;case"h":t=ss(_i.Hours,1,-12);break;case"hh":t=ss(_i.Hours,2,-12);break;case"H":t=ss(_i.Hours,1);break;case"HH":t=ss(_i.Hours,2);break;case"m":t=ss(_i.Minutes,1);break;case"mm":t=ss(_i.Minutes,2);break;case"s":t=ss(_i.Seconds,1);break;case"ss":t=ss(_i.Seconds,2);break;case"S":t=ss(_i.FractionalSeconds,1);break;case"SS":t=ss(_i.FractionalSeconds,2);break;case"SSS":t=ss(_i.FractionalSeconds,3);break;case"Z":case"ZZ":case"ZZZ":t=Lx(Cs.Short);break;case"ZZZZZ":t=Lx(Cs.Extended);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":t=Lx(Cs.ShortGMT);break;case"OOOO":case"ZZZZ":case"zzzz":t=Lx(Cs.Long);break;default:return null}return KC[n]=t,t}(M);C+=k?k(r,e,y):"''"===M?"'":M.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),C}function Rx(n,t,e){const i=new Date(0);return i.setFullYear(n,t,e),i.setHours(0,0,0),i}function sh(n,t){const e=function UV(n){return ja(n)[Dn.LocaleId]}(n);if(jy[e]=jy[e]||{},jy[e][t])return jy[e][t];let i="";switch(t){case"shortDate":i=Mx(n,Ao.Short);break;case"mediumDate":i=Mx(n,Ao.Medium);break;case"longDate":i=Mx(n,Ao.Long);break;case"fullDate":i=Mx(n,Ao.Full);break;case"shortTime":i=Ax(n,Ao.Short);break;case"mediumTime":i=Ax(n,Ao.Medium);break;case"longTime":i=Ax(n,Ao.Long);break;case"fullTime":i=Ax(n,Ao.Full);break;case"short":const r=sh(n,"shortTime"),s=sh(n,"shortDate");i=Px(kx(n,Ao.Short),[r,s]);break;case"medium":const d=sh(n,"mediumTime"),m=sh(n,"mediumDate");i=Px(kx(n,Ao.Medium),[d,m]);break;case"long":const y=sh(n,"longTime"),C=sh(n,"longDate");i=Px(kx(n,Ao.Long),[y,C]);break;case"full":const M=sh(n,"fullTime"),k=sh(n,"fullDate");i=Px(kx(n,Ao.Full),[M,k])}return i&&(jy[e][t]=i),i}function Px(n,t){return t&&(n=n.replace(/\{([^}]+)}/g,function(e,i){return null!=t&&i in t?t[i]:e})),n}function ru(n,t,e="-",i,r){let s="";(n<0||r&&n<=0)&&(r?n=1-n:(n=-n,s=e));let d=String(n);for(;d.length<t;)d="0"+d;return i&&(d=d.slice(d.length-t)),s+d}function ss(n,t,e=0,i=!1,r=!1){return function(s,d){let m=function r6(n,t){switch(n){case _i.FullYear:return t.getFullYear();case _i.Month:return t.getMonth();case _i.Date:return t.getDate();case _i.Hours:return t.getHours();case _i.Minutes:return t.getMinutes();case _i.Seconds:return t.getSeconds();case _i.FractionalSeconds:return t.getMilliseconds();case _i.Day:return t.getDay();default:throw new Error(`Unknown DateType value "${n}".`)}}(n,s);if((e>0||m>-e)&&(m+=e),n===_i.Hours)0===m&&-12===e&&(m=12);else if(n===_i.FractionalSeconds)return function i6(n,t){return ru(n,3).substring(0,t)}(m,t);const y=xc(d,si.MinusSign);return ru(m,t,y,i,r)}}function so(n,t,e=Xo.Format,i=!1){return function(r,s){return function o6(n,t,e,i,r,s){switch(e){case Ui.Months:return function GV(n,t,e){const i=ja(n),s=wc([i[Dn.MonthsFormat],i[Dn.MonthsStandalone]],t);return wc(s,e)}(t,r,i)[n.getMonth()];case Ui.Days:return function $V(n,t,e){const i=ja(n),s=wc([i[Dn.DaysFormat],i[Dn.DaysStandalone]],t);return wc(s,e)}(t,r,i)[n.getDay()];case Ui.DayPeriods:const d=n.getHours(),m=n.getMinutes();if(s){const C=function ZV(n){const t=ja(n);return Pk(t),(t[Dn.ExtraData][2]||[]).map(i=>"string"==typeof i?ZC(i):[ZC(i[0]),ZC(i[1])])}(t),M=function YV(n,t,e){const i=ja(n);Pk(i);const s=wc([i[Dn.ExtraData][0],i[Dn.ExtraData][1]],t)||[];return wc(s,e)||[]}(t,r,i),k=C.findIndex(z=>{if(Array.isArray(z)){const[q,Q]=z,xe=d>=q.hours&&m>=q.minutes,De=d<Q.hours||d===Q.hours&&m<Q.minutes;if(q.hours<Q.hours){if(xe&&De)return!0}else if(xe||De)return!0}else if(z.hours===d&&z.minutes===m)return!0;return!1});if(-1!==k)return M[k]}return function HV(n,t,e){const i=ja(n),s=wc([i[Dn.DayPeriodsFormat],i[Dn.DayPeriodsStandalone]],t);return wc(s,e)}(t,r,i)[d<12?0:1];case Ui.Eras:return function qV(n,t){return wc(ja(n)[Dn.Eras],t)}(t,i)[n.getFullYear()<=0?0:1];default:throw new Error(`unexpected translation type ${e}`)}}(r,s,n,t,e,i)}}function Lx(n){return function(t,e,i){const r=-1*i,s=xc(e,si.MinusSign),d=r>0?Math.floor(r/60):Math.ceil(r/60);switch(n){case Cs.Short:return(r>=0?"+":"")+ru(d,2,s)+ru(Math.abs(r%60),2,s);case Cs.ShortGMT:return"GMT"+(r>=0?"+":"")+ru(d,1,s);case Cs.Long:return"GMT"+(r>=0?"+":"")+ru(d,2,s)+":"+ru(Math.abs(r%60),2,s);case Cs.Extended:return 0===i?"Z":(r>=0?"+":"")+ru(d,2,s)+":"+ru(Math.abs(r%60),2,s);default:throw new Error(`Unknown zone width "${n}"`)}}}function Lk(n){return Rx(n.getFullYear(),n.getMonth(),n.getDate()+(4-n.getDay()))}function YC(n,t=!1){return function(e,i){let r;if(t){const s=new Date(e.getFullYear(),e.getMonth(),1).getDay()-1,d=e.getDate();r=1+Math.floor((d+s)/7)}else{const s=Lk(e),d=function a6(n){const t=Rx(n,0,1).getDay();return Rx(n,0,1+(t<=4?4:11)-t)}(s.getFullYear()),m=s.getTime()-d.getTime();r=1+Math.round(m/6048e5)}return ru(r,n,xc(i,si.MinusSign))}}function Fx(n,t=!1){return function(e,i){return ru(Lk(e).getFullYear(),n,xc(i,si.MinusSign),t)}}const KC={};function Ok(n,t){n=n.replace(/:/g,"");const e=Date.parse("Jan 01, 1970 00:00:00 "+n)/6e4;return isNaN(e)?t:e}function Fk(n){return n instanceof Date&&!isNaN(n.valueOf())}function Vk(n,t){t=encodeURIComponent(t);for(const e of n.split(";")){const i=e.indexOf("="),[r,s]=-1==i?[e,""]:[e.slice(0,i),e.slice(i+1)];if(r.trim()===t)return decodeURIComponent(s)}return null}let Tb=(()=>{class n{constructor(e,i,r,s){this._iterableDiffers=e,this._keyValueDiffers=i,this._ngEl=r,this._renderer=s,this._iterableDiffer=null,this._keyValueDiffer=null,this._initialClasses=[],this._rawClass=null}set klass(e){this._removeClasses(this._initialClasses),this._initialClasses="string"==typeof e?e.split(/\s+/):[],this._applyClasses(this._initialClasses),this._applyClasses(this._rawClass)}set ngClass(e){this._removeClasses(this._rawClass),this._applyClasses(this._initialClasses),this._iterableDiffer=null,this._keyValueDiffer=null,this._rawClass="string"==typeof e?e.split(/\s+/):e,this._rawClass&&(yp(this._rawClass)?this._iterableDiffer=this._iterableDiffers.find(this._rawClass).create():this._keyValueDiffer=this._keyValueDiffers.find(this._rawClass).create())}ngDoCheck(){if(this._iterableDiffer){const e=this._iterableDiffer.diff(this._rawClass);e&&this._applyIterableChanges(e)}else if(this._keyValueDiffer){const e=this._keyValueDiffer.diff(this._rawClass);e&&this._applyKeyValueChanges(e)}}_applyKeyValueChanges(e){e.forEachAddedItem(i=>this._toggleClass(i.key,i.currentValue)),e.forEachChangedItem(i=>this._toggleClass(i.key,i.currentValue)),e.forEachRemovedItem(i=>{i.previousValue&&this._toggleClass(i.key,!1)})}_applyIterableChanges(e){e.forEachAddedItem(i=>{if("string"!=typeof i.item)throw new Error(`NgClass can only toggle CSS classes expressed as strings, got ${zi(i.item)}`);this._toggleClass(i.item,!0)}),e.forEachRemovedItem(i=>this._toggleClass(i.item,!1))}_applyClasses(e){e&&(Array.isArray(e)||e instanceof Set?e.forEach(i=>this._toggleClass(i,!0)):Object.keys(e).forEach(i=>this._toggleClass(i,!!e[i])))}_removeClasses(e){e&&(Array.isArray(e)||e instanceof Set?e.forEach(i=>this._toggleClass(i,!1)):Object.keys(e).forEach(i=>this._toggleClass(i,!1)))}_toggleClass(e,i){(e=e.trim())&&e.split(/\s+/g).forEach(r=>{i?this._renderer.addClass(this._ngEl.nativeElement,r):this._renderer.removeClass(this._ngEl.nativeElement,r)})}}return n.\u0275fac=function(e){return new(e||n)(G(ed),G(Vy),G(Tn),G(hc))},n.\u0275dir=Lt({type:n,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"},standalone:!0}),n})();class T6{constructor(t,e,i,r){this.$implicit=t,this.ngForOf=e,this.index=i,this.count=r}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let Sc=(()=>{class n{constructor(e,i,r){this._viewContainer=e,this._template=i,this._differs=r,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(e){this._ngForOf=e,this._ngForOfDirty=!0}set ngForTrackBy(e){this._trackByFn=e}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(e){e&&(this._template=e)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const e=this._ngForOf;!this._differ&&e&&(this._differ=this._differs.find(e).create(this.ngForTrackBy))}if(this._differ){const e=this._differ.diff(this._ngForOf);e&&this._applyChanges(e)}}_applyChanges(e){const i=this._viewContainer;e.forEachOperation((r,s,d)=>{if(null==r.previousIndex)i.createEmbeddedView(this._template,new T6(r.item,this._ngForOf,-1,-1),null===d?void 0:d);else if(null==d)i.remove(null===s?void 0:s);else if(null!==s){const m=i.get(s);i.move(m,d),Hk(m,r)}});for(let r=0,s=i.length;r<s;r++){const m=i.get(r).context;m.index=r,m.count=s,m.ngForOf=this._ngForOf}e.forEachIdentityChange(r=>{Hk(i.get(r.currentIndex),r)})}static ngTemplateContextGuard(e,i){return!0}}return n.\u0275fac=function(e){return new(e||n)(G(Fo),G(Qr),G(ed))},n.\u0275dir=Lt({type:n,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0}),n})();function Hk(n,t){n.context.$implicit=t.item}let Ts=(()=>{class n{constructor(e,i){this._viewContainer=e,this._context=new D6,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=i}set ngIf(e){this._context.$implicit=this._context.ngIf=e,this._updateView()}set ngIfThen(e){$k("ngIfThen",e),this._thenTemplateRef=e,this._thenViewRef=null,this._updateView()}set ngIfElse(e){$k("ngIfElse",e),this._elseTemplateRef=e,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(e,i){return!0}}return n.\u0275fac=function(e){return new(e||n)(G(Fo),G(Qr))},n.\u0275dir=Lt({type:n,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0}),n})();class D6{constructor(){this.$implicit=null,this.ngIf=null}}function $k(n,t){if(t&&!t.createEmbeddedView)throw new Error(`${n} must be a TemplateRef, but received '${zi(t)}'.`)}class iT{constructor(t,e){this._viewContainerRef=t,this._templateRef=e,this._created=!1}create(){this._created=!0,this._viewContainerRef.createEmbeddedView(this._templateRef)}destroy(){this._created=!1,this._viewContainerRef.clear()}enforceState(t){t&&!this._created?this.create():!t&&this._created&&this.destroy()}}let Eb=(()=>{class n{constructor(){this._defaultUsed=!1,this._caseCount=0,this._lastCaseCheckIndex=0,this._lastCasesMatched=!1}set ngSwitch(e){this._ngSwitch=e,0===this._caseCount&&this._updateDefaultCases(!0)}_addCase(){return this._caseCount++}_addDefault(e){this._defaultViews||(this._defaultViews=[]),this._defaultViews.push(e)}_matchCase(e){const i=e==this._ngSwitch;return this._lastCasesMatched=this._lastCasesMatched||i,this._lastCaseCheckIndex++,this._lastCaseCheckIndex===this._caseCount&&(this._updateDefaultCases(!this._lastCasesMatched),this._lastCaseCheckIndex=0,this._lastCasesMatched=!1),i}_updateDefaultCases(e){if(this._defaultViews&&e!==this._defaultUsed){this._defaultUsed=e;for(let i=0;i<this._defaultViews.length;i++)this._defaultViews[i].enforceState(e)}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=Lt({type:n,selectors:[["","ngSwitch",""]],inputs:{ngSwitch:"ngSwitch"},standalone:!0}),n})(),Bx=(()=>{class n{constructor(e,i,r){this.ngSwitch=r,r._addCase(),this._view=new iT(e,i)}ngDoCheck(){this._view.enforceState(this.ngSwitch._matchCase(this.ngSwitchCase))}}return n.\u0275fac=function(e){return new(e||n)(G(Fo),G(Qr),G(Eb,9))},n.\u0275dir=Lt({type:n,selectors:[["","ngSwitchCase",""]],inputs:{ngSwitchCase:"ngSwitchCase"},standalone:!0}),n})(),qk=(()=>{class n{constructor(e,i,r){this._ngEl=e,this._differs=i,this._renderer=r,this._ngStyle=null,this._differ=null}set ngStyle(e){this._ngStyle=e,!this._differ&&e&&(this._differ=this._differs.find(e).create())}ngDoCheck(){if(this._differ){const e=this._differ.diff(this._ngStyle);e&&this._applyChanges(e)}}_setStyle(e,i){const[r,s]=e.split("."),d=-1===r.indexOf("-")?void 0:Ks.DashCase;null!=i?this._renderer.setStyle(this._ngEl.nativeElement,r,s?`${i}${s}`:i,d):this._renderer.removeStyle(this._ngEl.nativeElement,r,d)}_applyChanges(e){e.forEachRemovedItem(i=>this._setStyle(i.key,null)),e.forEachAddedItem(i=>this._setStyle(i.key,i.currentValue)),e.forEachChangedItem(i=>this._setStyle(i.key,i.currentValue))}}return n.\u0275fac=function(e){return new(e||n)(G(Tn),G(Vy),G(hc))},n.\u0275dir=Lt({type:n,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"},standalone:!0}),n})(),rT=(()=>{class n{constructor(e){this._viewContainerRef=e,this._viewRef=null,this.ngTemplateOutletContext=null,this.ngTemplateOutlet=null,this.ngTemplateOutletInjector=null}ngOnChanges(e){if(e.ngTemplateOutlet||e.ngTemplateOutletInjector){const i=this._viewContainerRef;if(this._viewRef&&i.remove(i.indexOf(this._viewRef)),this.ngTemplateOutlet){const{ngTemplateOutlet:r,ngTemplateOutletContext:s,ngTemplateOutletInjector:d}=this;this._viewRef=i.createEmbeddedView(r,s,d?{injector:d}:void 0)}else this._viewRef=null}else this._viewRef&&e.ngTemplateOutletContext&&this.ngTemplateOutletContext&&(this._viewRef.context=this.ngTemplateOutletContext)}}return n.\u0275fac=function(e){return new(e||n)(G(Fo))},n.\u0275dir=Lt({type:n,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet",ngTemplateOutletInjector:"ngTemplateOutletInjector"},standalone:!0,features:[cr]}),n})();function ou(n,t){return new Ot(2100,!1)}class A6{createSubscription(t,e){return t.subscribe({next:e,error:i=>{throw i}})}dispose(t){t.unsubscribe()}}class k6{createSubscription(t,e){return t.then(e,i=>{throw i})}dispose(t){}}const R6=new k6,P6=new A6;let Hy=(()=>{class n{constructor(e){this._latestValue=null,this._subscription=null,this._obj=null,this._strategy=null,this._ref=e}ngOnDestroy(){this._subscription&&this._dispose(),this._ref=null}transform(e){return this._obj?e!==this._obj?(this._dispose(),this.transform(e)):this._latestValue:(e&&this._subscribe(e),this._latestValue)}_subscribe(e){this._obj=e,this._strategy=this._selectStrategy(e),this._subscription=this._strategy.createSubscription(e,i=>this._updateLatestValue(e,i))}_selectStrategy(e){if(Dy(e))return R6;if(ZI(e))return P6;throw ou()}_dispose(){this._strategy.dispose(this._subscription),this._latestValue=null,this._subscription=null,this._obj=null}_updateLatestValue(e,i){e===this._obj&&(this._latestValue=i,this._ref.markForCheck())}}return n.\u0275fac=function(e){return new(e||n)(G(Sr,16))},n.\u0275pipe=_o({name:"async",type:n,pure:!1,standalone:!0}),n})();const O6=/(?:[0-9A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u0870-\u0887\u0889-\u088E\u08A0-\u08C9\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C5D\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u1711\u171F-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4C\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7CA\uA7D0\uA7D1\uA7D3\uA7D5-\uA7D9\uA7F2-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF40\uDF42-\uDF49\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67\uDF80-\uDF85\uDF87-\uDFB0\uDFB2-\uDFBA]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDE80-\uDEA9\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDF70-\uDF81\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC71\uDC72\uDC75\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A\uDF40-\uDF46]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEB0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDEE0-\uDEF2\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC80-\uDD43]|\uD80B[\uDF90-\uDFF0]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE70-\uDEBE\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD837[\uDF00-\uDF1E]|\uD838[\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDE90-\uDEAD\uDEC0-\uDEEB]|\uD839[\uDFE0-\uDFE6\uDFE8-\uDFEB\uDFED\uDFEE\uDFF0-\uDFFE]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF38\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])\S*/g;let Wk=(()=>{class n{transform(e){if(null==e)return null;if("string"!=typeof e)throw ou();return e.replace(O6,i=>i[0].toUpperCase()+i.slice(1).toLowerCase())}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275pipe=_o({name:"titlecase",type:n,pure:!0,standalone:!0}),n})();const N6=new Et("DATE_PIPE_DEFAULT_TIMEZONE");let Xk=(()=>{class n{constructor(e,i){this.locale=e,this.defaultTimezone=i}transform(e,i="mediumDate",r,s){var d;if(null==e||""===e||e!=e)return null;try{return n6(e,i,s||this.locale,null!==(d=null!=r?r:this.defaultTimezone)&&void 0!==d?d:void 0)}catch(m){throw ou()}}}return n.\u0275fac=function(e){return new(e||n)(G(Vl,16),G(N6,24))},n.\u0275pipe=_o({name:"date",type:n,pure:!0,standalone:!0}),n})(),gr=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({}),n})();const Yk="browser";let Q6=(()=>{class n{}return n.\u0275prov=Jt({token:n,providedIn:"root",factory:()=>new J6(ze($n),window)}),n})();class J6{constructor(t,e){this.document=t,this.window=e,this.offset=()=>[0,0]}setOffset(t){this.offset=Array.isArray(t)?()=>t:t}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(t){this.supportsScrolling()&&this.window.scrollTo(t[0],t[1])}scrollToAnchor(t){if(!this.supportsScrolling())return;const e=function ej(n,t){const e=n.getElementById(t)||n.getElementsByName(t)[0];if(e)return e;if("function"==typeof n.createTreeWalker&&n.body&&(n.body.createShadowRoot||n.body.attachShadow)){const i=n.createTreeWalker(n.body,NodeFilter.SHOW_ELEMENT);let r=i.currentNode;for(;r;){const s=r.shadowRoot;if(s){const d=s.getElementById(t)||s.querySelector(`[name="${t}"]`);if(d)return d}r=i.nextNode()}}return null}(this.document,t);e&&(this.scrollToElement(e),e.focus())}setHistoryScrollRestoration(t){if(this.supportScrollRestoration()){const e=this.window.history;e&&e.scrollRestoration&&(e.scrollRestoration=t)}}scrollToElement(t){const e=t.getBoundingClientRect(),i=e.left+this.window.pageXOffset,r=e.top+this.window.pageYOffset,s=this.offset();this.window.scrollTo(i-s[0],r-s[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const t=Kk(this.window.history)||Kk(Object.getPrototypeOf(this.window.history));return!(!t||!t.writable&&!t.set)}catch(t){return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch(t){return!1}}}function Kk(n){return Object.getOwnPropertyDescriptor(n,"scrollRestoration")}class Qk{}class cT extends class Dj extends class OV{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function LV(n){Dx||(Dx=n)}(new cT)}onAndCancel(t,e,i){return t.addEventListener(e,i,!1),()=>{t.removeEventListener(e,i,!1)}}dispatchEvent(t,e){t.dispatchEvent(e)}remove(t){t.parentNode&&t.parentNode.removeChild(t)}createElement(t,e){return(e=e||this.getDefaultDocument()).createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,e){return"window"===e?window:"document"===e?t:"body"===e?t.body:null}getBaseHref(t){const e=function Ij(){return Gy=Gy||document.querySelector("base"),Gy?Gy.getAttribute("href"):null}();return null==e?null:function Mj(n){jx=jx||document.createElement("a"),jx.setAttribute("href",n);const t=jx.pathname;return"/"===t.charAt(0)?t:`/${t}`}(e)}resetBaseElement(){Gy=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return Vk(document.cookie,t)}}let jx,Gy=null;const iR=new Et("TRANSITION_ID"),kj=[{provide:vx,useFactory:function Aj(n,t,e){return()=>{e.get(xx).donePromise.then(()=>{const i=td(),r=t.querySelectorAll(`style[ng-transition="${n}"]`);for(let s=0;s<r.length;s++)i.remove(r[s])})}},deps:[iR,$n,Nr],multi:!0}];let Pj=(()=>{class n{build(){return new XMLHttpRequest}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})();const Ux=new Et("EventManagerPlugins");let Hx=(()=>{class n{constructor(e,i){this._zone=i,this._eventNameToPlugin=new Map,e.forEach(r=>r.manager=this),this._plugins=e.slice().reverse()}addEventListener(e,i,r){return this._findPluginFor(i).addEventListener(e,i,r)}addGlobalEventListener(e,i,r){return this._findPluginFor(i).addGlobalEventListener(e,i,r)}getZone(){return this._zone}_findPluginFor(e){const i=this._eventNameToPlugin.get(e);if(i)return i;const r=this._plugins;for(let s=0;s<r.length;s++){const d=r[s];if(d.supports(e))return this._eventNameToPlugin.set(e,d),d}throw new Error(`No event manager plugin found for event ${e}`)}}return n.\u0275fac=function(e){return new(e||n)(ze(Ux),ze(qn))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})();class rR{constructor(t){this._doc=t}addGlobalEventListener(t,e,i){const r=td().getGlobalEventTarget(this._doc,t);if(!r)throw new Error(`Unsupported event target ${r} for event ${e}`);return this.addEventListener(r,e,i)}}let oR=(()=>{class n{constructor(){this._stylesSet=new Set}addStyles(e){const i=new Set;e.forEach(r=>{this._stylesSet.has(r)||(this._stylesSet.add(r),i.add(r))}),this.onStylesAdded(i)}onStylesAdded(e){}getAllStyles(){return Array.from(this._stylesSet)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})(),qy=(()=>{class n extends oR{constructor(e){super(),this._doc=e,this._hostNodes=new Map,this._hostNodes.set(e.head,[])}_addStylesToHost(e,i,r){e.forEach(s=>{const d=this._doc.createElement("style");d.textContent=s,r.push(i.appendChild(d))})}addHost(e){const i=[];this._addStylesToHost(this._stylesSet,e,i),this._hostNodes.set(e,i)}removeHost(e){const i=this._hostNodes.get(e);i&&i.forEach(sR),this._hostNodes.delete(e)}onStylesAdded(e){this._hostNodes.forEach((i,r)=>{this._addStylesToHost(e,r,i)})}ngOnDestroy(){this._hostNodes.forEach(e=>e.forEach(sR))}}return n.\u0275fac=function(e){return new(e||n)(ze($n))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})();function sR(n){td().remove(n)}const uT={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},dT=/%COMP%/g;function $x(n,t,e){for(let i=0;i<t.length;i++){let r=t[i];Array.isArray(r)?$x(n,r,e):(r=r.replace(dT,n),e.push(r))}return e}function cR(n){return t=>{if("__ngUnwrap__"===t)return n;!1===n(t)&&(t.preventDefault(),t.returnValue=!1)}}let Gx=(()=>{class n{constructor(e,i,r){this.eventManager=e,this.sharedStylesHost=i,this.appId=r,this.rendererByCompId=new Map,this.defaultRenderer=new hT(e)}createRenderer(e,i){if(!e||!i)return this.defaultRenderer;switch(i.encapsulation){case qs.Emulated:{let r=this.rendererByCompId.get(i.id);return r||(r=new zj(this.eventManager,this.sharedStylesHost,i,this.appId),this.rendererByCompId.set(i.id,r)),r.applyToHost(e),r}case 1:case qs.ShadowDom:return new Vj(this.eventManager,this.sharedStylesHost,e,i);default:if(!this.rendererByCompId.has(i.id)){const r=$x(i.id,i.styles,[]);this.sharedStylesHost.addStyles(r),this.rendererByCompId.set(i.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return n.\u0275fac=function(e){return new(e||n)(ze(Hx),ze(qy),ze(Sb))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})();class hT{constructor(t){this.eventManager=t,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(t,e){return e?document.createElementNS(uT[e]||e,t):document.createElement(t)}createComment(t){return document.createComment(t)}createText(t){return document.createTextNode(t)}appendChild(t,e){(dR(t)?t.content:t).appendChild(e)}insertBefore(t,e,i){t&&(dR(t)?t.content:t).insertBefore(e,i)}removeChild(t,e){t&&t.removeChild(e)}selectRootElement(t,e){let i="string"==typeof t?document.querySelector(t):t;if(!i)throw new Error(`The selector "${t}" did not match any elements`);return e||(i.textContent=""),i}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,e,i,r){if(r){e=r+":"+e;const s=uT[r];s?t.setAttributeNS(s,e,i):t.setAttribute(e,i)}else t.setAttribute(e,i)}removeAttribute(t,e,i){if(i){const r=uT[i];r?t.removeAttributeNS(r,e):t.removeAttribute(`${i}:${e}`)}else t.removeAttribute(e)}addClass(t,e){t.classList.add(e)}removeClass(t,e){t.classList.remove(e)}setStyle(t,e,i,r){r&(Ks.DashCase|Ks.Important)?t.style.setProperty(e,i,r&Ks.Important?"important":""):t.style[e]=i}removeStyle(t,e,i){i&Ks.DashCase?t.style.removeProperty(e):t.style[e]=""}setProperty(t,e,i){t[e]=i}setValue(t,e){t.nodeValue=e}listen(t,e,i){return"string"==typeof t?this.eventManager.addGlobalEventListener(t,e,cR(i)):this.eventManager.addEventListener(t,e,cR(i))}}function dR(n){return"TEMPLATE"===n.tagName&&void 0!==n.content}class zj extends hT{constructor(t,e,i,r){super(t),this.component=i;const s=$x(r+"-"+i.id,i.styles,[]);e.addStyles(s),this.contentAttr=function Fj(n){return"_ngcontent-%COMP%".replace(dT,n)}(r+"-"+i.id),this.hostAttr=function Nj(n){return"_nghost-%COMP%".replace(dT,n)}(r+"-"+i.id)}applyToHost(t){super.setAttribute(t,this.hostAttr,"")}createElement(t,e){const i=super.createElement(t,e);return super.setAttribute(i,this.contentAttr,""),i}}class Vj extends hT{constructor(t,e,i,r){super(t),this.sharedStylesHost=e,this.hostEl=i,this.shadowRoot=i.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const s=$x(r.id,r.styles,[]);for(let d=0;d<s.length;d++){const m=document.createElement("style");m.textContent=s[d],this.shadowRoot.appendChild(m)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(t,e){return super.appendChild(this.nodeOrShadowRoot(t),e)}insertBefore(t,e,i){return super.insertBefore(this.nodeOrShadowRoot(t),e,i)}removeChild(t,e){return super.removeChild(this.nodeOrShadowRoot(t),e)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}}let jj=(()=>{class n extends rR{constructor(e){super(e)}supports(e){return!0}addEventListener(e,i,r){return e.addEventListener(i,r,!1),()=>this.removeEventListener(e,i,r)}removeEventListener(e,i,r){return e.removeEventListener(i,r)}}return n.\u0275fac=function(e){return new(e||n)(ze($n))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})();const hR=["alt","control","meta","shift"],Uj={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Hj={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey};let $j=(()=>{class n extends rR{constructor(e){super(e)}supports(e){return null!=n.parseEventName(e)}addEventListener(e,i,r){const s=n.parseEventName(i),d=n.eventCallback(s.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>td().onAndCancel(e,s.domEventName,d))}static parseEventName(e){const i=e.toLowerCase().split("."),r=i.shift();if(0===i.length||"keydown"!==r&&"keyup"!==r)return null;const s=n._normalizeKey(i.pop());let d="",m=i.indexOf("code");if(m>-1&&(i.splice(m,1),d="code."),hR.forEach(C=>{const M=i.indexOf(C);M>-1&&(i.splice(M,1),d+=C+".")}),d+=s,0!=i.length||0===s.length)return null;const y={};return y.domEventName=r,y.fullKey=d,y}static matchEventFullKeyCode(e,i){let r=Uj[e.key]||e.key,s="";return i.indexOf("code.")>-1&&(r=e.code,s="code."),!(null==r||!r)&&(r=r.toLowerCase()," "===r?r="space":"."===r&&(r="dot"),hR.forEach(d=>{d!==r&&(0,Hj[d])(e)&&(s+=d+".")}),s+=r,s===i)}static eventCallback(e,i,r){return s=>{n.matchEventFullKeyCode(s,e)&&r.runGuarded(()=>i(s))}}static _normalizeKey(e){return"esc"===e?"escape":e}}return n.\u0275fac=function(e){return new(e||n)(ze($n))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})();const Xj=ak(kV,"browser",[{provide:wx,useValue:Yk},{provide:KA,useValue:function Gj(){cT.makeCurrent()},multi:!0},{provide:$n,useFactory:function Wj(){return function v0(n){j_=n}(document),document},deps:[]}]),mR=new Et(""),gR=[{provide:Sx,useClass:class Rj{addToWindow(t){Lr.getAngularTestability=(i,r=!0)=>{const s=t.findTestabilityInTree(i,r);if(null==s)throw new Error("Could not find testability for element.");return s},Lr.getAllAngularTestabilities=()=>t.getAllTestabilities(),Lr.getAllAngularRootElements=()=>t.getAllRootElements(),Lr.frameworkStabilizers||(Lr.frameworkStabilizers=[]),Lr.frameworkStabilizers.push(i=>{const r=Lr.getAllAngularTestabilities();let s=r.length,d=!1;const m=function(y){d=d||y,s--,0==s&&i(d)};r.forEach(function(y){y.whenStable(m)})})}findTestabilityInTree(t,e,i){if(null==e)return null;const r=t.getTestability(e);return null!=r?r:i?td().isShadowRoot(e)?this.findTestabilityInTree(t,e.host,!0):this.findTestabilityInTree(t,e.parentElement,!0):null}},deps:[]},{provide:ik,useClass:BC,deps:[qn,zC,Sx]},{provide:BC,useClass:BC,deps:[qn,zC,Sx]}],bR=[{provide:Y_,useValue:"root"},{provide:ul,useFactory:function qj(){return new ul},deps:[]},{provide:Ux,useClass:jj,multi:!0,deps:[$n,qn,wx]},{provide:Ux,useClass:$j,multi:!0,deps:[$n]},{provide:Gx,useClass:Gx,deps:[Hx,qy,Sb]},{provide:jf,useExisting:Gx},{provide:oR,useExisting:qy},{provide:qy,useClass:qy,deps:[$n]},{provide:Hx,useClass:Hx,deps:[Ux,qn]},{provide:Qk,useClass:Pj,deps:[]},[]];let _R=(()=>{class n{constructor(e){}static withServerTransition(e){return{ngModule:n,providers:[{provide:Sb,useValue:e.appId},{provide:iR,useExisting:Sb},kj]}}}return n.\u0275fac=function(e){return new(e||n)(ze(mR,12))},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({providers:[...bR,...gR],imports:[gr,RV]}),n})(),yR=(()=>{class n{constructor(e){this._doc=e}getTitle(){return this._doc.title}setTitle(e){this._doc.title=e||""}}return n.\u0275fac=function(e){return new(e||n)(ze($n))},n.\u0275prov=Jt({token:n,factory:function(e){let i=null;return i=e?new e:function Yj(){return new yR(ze($n))}(),i},providedIn:"root"}),n})();"undefined"!=typeof window&&window;let wR=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Jt({token:n,factory:function(e){let i=null;return i=e?new(e||n):ze(SR),i},providedIn:"root"}),n})(),SR=(()=>{class n extends wR{constructor(e){super(),this._doc=e}sanitize(e,i){if(null==i)return null;switch(e){case sr.NONE:return i;case sr.HTML:return Fa(i,"HTML")?Oa(i):Nf(this._doc,String(i)).toString();case sr.STYLE:return Fa(i,"Style")?Oa(i):i;case sr.SCRIPT:if(Fa(i,"Script"))return Oa(i);throw new Error("unsafe value used in a script context");case sr.URL:return Fa(i,"URL")?Oa(i):rp(String(i));case sr.RESOURCE_URL:if(Fa(i,"ResourceURL"))return Oa(i);throw new Error("unsafe value used in a resource URL context (see https://g.co/ng/security#xss)");default:throw new Error(`Unexpected SecurityContext ${e} (see https://g.co/ng/security#xss)`)}}bypassSecurityTrustHtml(e){return function w0(n){return new l1(n)}(e)}bypassSecurityTrustStyle(e){return function ip(n){return new c1(n)}(e)}bypassSecurityTrustScript(e){return function f1(n){return new u1(n)}(e)}bypassSecurityTrustUrl(e){return function m1(n){return new d1(n)}(e)}bypassSecurityTrustResourceUrl(e){return function g1(n){return new h1(n)}(e)}}return n.\u0275fac=function(e){return new(e||n)(ze($n))},n.\u0275prov=Jt({token:n,factory:function(e){let i=null;return i=e?new e:function r4(n){return new SR(n.get($n))}(ze(Nr)),i},providedIn:"root"}),n})();class CR{}const ah="*";function Es(n,t){return{type:7,name:n,definitions:t,options:{}}}function Qi(n,t=null){return{type:4,styles:t,timings:n}}function TR(n,t=null){return{type:3,steps:n,options:t}}function ER(n,t=null){return{type:2,steps:n,options:t}}function Ln(n){return{type:6,styles:n,offset:null}}function dr(n,t,e){return{type:0,name:n,styles:t,options:e}}function Wy(n){return{type:5,steps:n}}function qi(n,t,e=null){return{type:1,expr:n,animation:t,options:e}}function mT(n=null){return{type:9,options:n}}function gT(n,t,e=null){return{type:11,selector:n,animation:t,options:e}}function DR(n){Promise.resolve().then(n)}class Xy{constructor(t=0,e=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=t+e}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}onStart(t){this._originalOnStartFns.push(t),this._onStartFns.push(t)}onDone(t){this._originalOnDoneFns.push(t),this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){DR(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(t=>t()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(t){this._position=this.totalTime?t*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(t){const e="start"==t?this._onStartFns:this._onDoneFns;e.forEach(i=>i()),e.length=0}}class IR{constructor(t){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=t;let e=0,i=0,r=0;const s=this.players.length;0==s?DR(()=>this._onFinish()):this.players.forEach(d=>{d.onDone(()=>{++e==s&&this._onFinish()}),d.onDestroy(()=>{++i==s&&this._onDestroy()}),d.onStart(()=>{++r==s&&this._onStart()})}),this.totalTime=this.players.reduce((d,m)=>Math.max(d,m.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this.players.forEach(t=>t.init())}onStart(t){this._onStartFns.push(t)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(t=>t()),this._onStartFns=[])}onDone(t){this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(t=>t.play())}pause(){this.players.forEach(t=>t.pause())}restart(){this.players.forEach(t=>t.restart())}finish(){this._onFinish(),this.players.forEach(t=>t.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(t=>t.destroy()),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}reset(){this.players.forEach(t=>t.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(t){const e=t*this.totalTime;this.players.forEach(i=>{const r=i.totalTime?Math.min(1,e/i.totalTime):1;i.setPosition(r)})}getPosition(){const t=this.players.reduce((e,i)=>null===e||i.totalTime>e.totalTime?i:e,null);return null!=t?t.getPosition():0}beforeDestroy(){this.players.forEach(t=>{t.beforeDestroy&&t.beforeDestroy()})}triggerCallback(t){const e="start"==t?this._onStartFns:this._onDoneFns;e.forEach(i=>i()),e.length=0}}function MR(n){return new Ot(3e3,!1)}function V4(){return"undefined"!=typeof window&&void 0!==window.document}function _T(){return"undefined"!=typeof process&&"[object process]"==={}.toString.call(process)}function wp(n){switch(n.length){case 0:return new Xy;case 1:return n[0];default:return new IR(n)}}function AR(n,t,e,i,r=new Map,s=new Map){const d=[],m=[];let y=-1,C=null;if(i.forEach(M=>{const k=M.get("offset"),z=k==y,q=z&&C||new Map;M.forEach((Q,xe)=>{let De=xe,Ze=Q;if("offset"!==xe)switch(De=t.normalizePropertyName(De,d),Ze){case"!":Ze=r.get(xe);break;case ah:Ze=s.get(xe);break;default:Ze=t.normalizeStyleValue(xe,De,Ze,d)}q.set(De,Ze)}),z||m.push(q),C=q,y=k}),d.length)throw function I4(n){return new Ot(3502,!1)}();return m}function yT(n,t,e,i){switch(t){case"start":n.onStart(()=>i(e&&vT(e,"start",n)));break;case"done":n.onDone(()=>i(e&&vT(e,"done",n)));break;case"destroy":n.onDestroy(()=>i(e&&vT(e,"destroy",n)))}}function vT(n,t,e){const i=e.totalTime,s=xT(n.element,n.triggerName,n.fromState,n.toState,t||n.phaseName,null==i?n.totalTime:i,!!e.disabled),d=n._data;return null!=d&&(s._data=d),s}function xT(n,t,e,i,r="",s=0,d){return{element:n,triggerName:t,fromState:e,toState:i,phaseName:r,totalTime:s,disabled:!!d}}function jl(n,t,e){let i=n.get(t);return i||n.set(t,i=e),i}function kR(n){const t=n.indexOf(":");return[n.substring(1,t),n.slice(t+1)]}let wT=(n,t)=>!1,RR=(n,t,e)=>[],PR=null;function ST(n){const t=n.parentNode||n.host;return t===PR?null:t}(_T()||"undefined"!=typeof Element)&&(V4()?(PR=(()=>document.documentElement)(),wT=(n,t)=>{for(;t;){if(t===n)return!0;t=ST(t)}return!1}):wT=(n,t)=>n.contains(t),RR=(n,t,e)=>{if(e)return Array.from(n.querySelectorAll(t));const i=n.querySelector(t);return i?[i]:[]});let sm=null,LR=!1;const OR=wT,FR=RR;let NR=(()=>{class n{validateStyleProperty(e){return function U4(n){sm||(sm=function H4(){return"undefined"!=typeof document?document.body:null}()||{},LR=!!sm.style&&"WebkitAppearance"in sm.style);let t=!0;return sm.style&&!function j4(n){return"ebkit"==n.substring(1,6)}(n)&&(t=n in sm.style,!t&&LR&&(t="Webkit"+n.charAt(0).toUpperCase()+n.slice(1)in sm.style)),t}(e)}matchesElement(e,i){return!1}containsElement(e,i){return OR(e,i)}getParentElement(e){return ST(e)}query(e,i,r){return FR(e,i,r)}computeStyle(e,i,r){return r||""}animate(e,i,r,s,d,m=[],y){return new Xy(r,s)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})(),CT=(()=>{class n{}return n.NOOP=new NR,n})();const TT="ng-enter",qx="ng-leave",Wx="ng-trigger",Xx=".ng-trigger",zR="ng-animating",ET=".ng-animating";function lh(n){if("number"==typeof n)return n;const t=n.match(/^(-?[\.\d]+)(m?s)/);return!t||t.length<2?0:DT(parseFloat(t[1]),t[2])}function DT(n,t){return"s"===t?1e3*n:n}function Zx(n,t,e){return n.hasOwnProperty("duration")?n:function q4(n,t,e){let r,s=0,d="";if("string"==typeof n){const m=n.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===m)return t.push(MR()),{duration:0,delay:0,easing:""};r=DT(parseFloat(m[1]),m[2]);const y=m[3];null!=y&&(s=DT(parseFloat(y),m[4]));const C=m[5];C&&(d=C)}else r=n;if(!e){let m=!1,y=t.length;r<0&&(t.push(function s4(){return new Ot(3100,!1)}()),m=!0),s<0&&(t.push(function a4(){return new Ot(3101,!1)}()),m=!0),m&&t.splice(y,0,MR())}return{duration:r,delay:s,easing:d}}(n,t,e)}function Zy(n,t={}){return Object.keys(n).forEach(e=>{t[e]=n[e]}),t}function VR(n){const t=new Map;return Object.keys(n).forEach(e=>{t.set(e,n[e])}),t}function Sp(n,t=new Map,e){if(e)for(let[i,r]of e)t.set(i,r);for(let[i,r]of n)t.set(i,r);return t}function UR(n,t,e){return e?t+":"+e+";":""}function HR(n){let t="";for(let e=0;e<n.style.length;e++){const i=n.style.item(e);t+=UR(0,i,n.style.getPropertyValue(i))}for(const e in n.style)n.style.hasOwnProperty(e)&&!e.startsWith("_")&&(t+=UR(0,Y4(e),n.style[e]));n.setAttribute("style",t)}function nd(n,t,e){n.style&&(t.forEach((i,r)=>{const s=MT(r);e&&!e.has(r)&&e.set(r,n.style[s]),n.style[s]=i}),_T()&&HR(n))}function am(n,t){n.style&&(t.forEach((e,i)=>{const r=MT(i);n.style[r]=""}),_T()&&HR(n))}function Yy(n){return Array.isArray(n)?1==n.length?n[0]:ER(n):n}const IT=new RegExp("{{\\s*(.+?)\\s*}}","g");function $R(n){let t=[];if("string"==typeof n){let e;for(;e=IT.exec(n);)t.push(e[1]);IT.lastIndex=0}return t}function Ky(n,t,e){const i=n.toString(),r=i.replace(IT,(s,d)=>{let m=t[d];return null==m&&(e.push(function c4(n){return new Ot(3003,!1)}()),m=""),m.toString()});return r==i?n:r}function Yx(n){const t=[];let e=n.next();for(;!e.done;)t.push(e.value),e=n.next();return t}const Z4=/-+([a-z0-9])/g;function MT(n){return n.replace(Z4,(...t)=>t[1].toUpperCase())}function Y4(n){return n.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function Ul(n,t,e){switch(t.type){case 7:return n.visitTrigger(t,e);case 0:return n.visitState(t,e);case 1:return n.visitTransition(t,e);case 2:return n.visitSequence(t,e);case 3:return n.visitGroup(t,e);case 4:return n.visitAnimate(t,e);case 5:return n.visitKeyframes(t,e);case 6:return n.visitStyle(t,e);case 8:return n.visitReference(t,e);case 9:return n.visitAnimateChild(t,e);case 10:return n.visitAnimateRef(t,e);case 11:return n.visitQuery(t,e);case 12:return n.visitStagger(t,e);default:throw function u4(n){return new Ot(3004,!1)}()}}function GR(n,t){return window.getComputedStyle(n)[t]}function n5(n,t){const e=[];return"string"==typeof n?n.split(/\s*,\s*/).forEach(i=>function r5(n,t,e){if(":"==n[0]){const y=function o5(n,t){switch(n){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(e,i)=>parseFloat(i)>parseFloat(e);case":decrement":return(e,i)=>parseFloat(i)<parseFloat(e);default:return t.push(function C4(n){return new Ot(3016,!1)}()),"* => *"}}(n,e);if("function"==typeof y)return void t.push(y);n=y}const i=n.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==i||i.length<4)return e.push(function S4(n){return new Ot(3015,!1)}()),t;const r=i[1],s=i[2],d=i[3];t.push(qR(r,d));"<"==s[0]&&!("*"==r&&"*"==d)&&t.push(qR(d,r))}(i,e,t)):e.push(n),e}const ew=new Set(["true","1"]),tw=new Set(["false","0"]);function qR(n,t){const e=ew.has(n)||tw.has(n),i=ew.has(t)||tw.has(t);return(r,s)=>{let d="*"==n||n==r,m="*"==t||t==s;return!d&&e&&"boolean"==typeof r&&(d=r?ew.has(n):tw.has(n)),!m&&i&&"boolean"==typeof s&&(m=s?ew.has(t):tw.has(t)),d&&m}}const s5=new RegExp("s*:selfs*,?","g");function AT(n,t,e,i){return new a5(n).build(t,e,i)}class a5{constructor(t){this._driver=t}build(t,e,i){const r=new u5(e);return this._resetContextStyleTimingState(r),Ul(this,Yy(t),r)}_resetContextStyleTimingState(t){t.currentQuerySelector="",t.collectedStyles=new Map,t.collectedStyles.set("",new Map),t.currentTime=0}visitTrigger(t,e){let i=e.queryCount=0,r=e.depCount=0;const s=[],d=[];return"@"==t.name.charAt(0)&&e.errors.push(function h4(){return new Ot(3006,!1)}()),t.definitions.forEach(m=>{if(this._resetContextStyleTimingState(e),0==m.type){const y=m,C=y.name;C.toString().split(/\s*,\s*/).forEach(M=>{y.name=M,s.push(this.visitState(y,e))}),y.name=C}else if(1==m.type){const y=this.visitTransition(m,e);i+=y.queryCount,r+=y.depCount,d.push(y)}else e.errors.push(function p4(){return new Ot(3007,!1)}())}),{type:7,name:t.name,states:s,transitions:d,queryCount:i,depCount:r,options:null}}visitState(t,e){const i=this.visitStyle(t.styles,e),r=t.options&&t.options.params||null;if(i.containsDynamicStyles){const s=new Set,d=r||{};i.styles.forEach(m=>{m instanceof Map&&m.forEach(y=>{$R(y).forEach(C=>{d.hasOwnProperty(C)||s.add(C)})})}),s.size&&(Yx(s.values()),e.errors.push(function f4(n,t){return new Ot(3008,!1)}()))}return{type:0,name:t.name,style:i,options:r?{params:r}:null}}visitTransition(t,e){e.queryCount=0,e.depCount=0;const i=Ul(this,Yy(t.animation),e);return{type:1,matchers:n5(t.expr,e.errors),animation:i,queryCount:e.queryCount,depCount:e.depCount,options:lm(t.options)}}visitSequence(t,e){return{type:2,steps:t.steps.map(i=>Ul(this,i,e)),options:lm(t.options)}}visitGroup(t,e){const i=e.currentTime;let r=0;const s=t.steps.map(d=>{e.currentTime=i;const m=Ul(this,d,e);return r=Math.max(r,e.currentTime),m});return e.currentTime=r,{type:3,steps:s,options:lm(t.options)}}visitAnimate(t,e){const i=function h5(n,t){if(n.hasOwnProperty("duration"))return n;if("number"==typeof n)return kT(Zx(n,t).duration,0,"");const e=n;if(e.split(/\s+/).some(s=>"{"==s.charAt(0)&&"{"==s.charAt(1))){const s=kT(0,0,"");return s.dynamic=!0,s.strValue=e,s}const r=Zx(e,t);return kT(r.duration,r.delay,r.easing)}(t.timings,e.errors);e.currentAnimateTimings=i;let r,s=t.styles?t.styles:Ln({});if(5==s.type)r=this.visitKeyframes(s,e);else{let d=t.styles,m=!1;if(!d){m=!0;const C={};i.easing&&(C.easing=i.easing),d=Ln(C)}e.currentTime+=i.duration+i.delay;const y=this.visitStyle(d,e);y.isEmptyStep=m,r=y}return e.currentAnimateTimings=null,{type:4,timings:i,style:r,options:null}}visitStyle(t,e){const i=this._makeStyleAst(t,e);return this._validateStyleAst(i,e),i}_makeStyleAst(t,e){const i=[],r=Array.isArray(t.styles)?t.styles:[t.styles];for(let m of r)"string"==typeof m?m===ah?i.push(m):e.errors.push(new Ot(3002,!1)):i.push(VR(m));let s=!1,d=null;return i.forEach(m=>{if(m instanceof Map&&(m.has("easing")&&(d=m.get("easing"),m.delete("easing")),!s))for(let y of m.values())if(y.toString().indexOf("{{")>=0){s=!0;break}}),{type:6,styles:i,easing:d,offset:t.offset,containsDynamicStyles:s,options:null}}_validateStyleAst(t,e){const i=e.currentAnimateTimings;let r=e.currentTime,s=e.currentTime;i&&s>0&&(s-=i.duration+i.delay),t.styles.forEach(d=>{"string"!=typeof d&&d.forEach((m,y)=>{const C=e.collectedStyles.get(e.currentQuerySelector),M=C.get(y);let k=!0;M&&(s!=r&&s>=M.startTime&&r<=M.endTime&&(e.errors.push(function g4(n,t,e,i,r){return new Ot(3010,!1)}()),k=!1),s=M.startTime),k&&C.set(y,{startTime:s,endTime:r}),e.options&&function X4(n,t,e){const i=t.params||{},r=$R(n);r.length&&r.forEach(s=>{i.hasOwnProperty(s)||e.push(function l4(n){return new Ot(3001,!1)}())})}(m,e.options,e.errors)})})}visitKeyframes(t,e){const i={type:5,styles:[],options:null};if(!e.currentAnimateTimings)return e.errors.push(function b4(){return new Ot(3011,!1)}()),i;let s=0;const d=[];let m=!1,y=!1,C=0;const M=t.steps.map(Ze=>{const It=this._makeStyleAst(Ze,e);let ut=null!=It.offset?It.offset:function d5(n){if("string"==typeof n)return null;let t=null;if(Array.isArray(n))n.forEach(e=>{if(e instanceof Map&&e.has("offset")){const i=e;t=parseFloat(i.get("offset")),i.delete("offset")}});else if(n instanceof Map&&n.has("offset")){const e=n;t=parseFloat(e.get("offset")),e.delete("offset")}return t}(It.styles),Ht=0;return null!=ut&&(s++,Ht=It.offset=ut),y=y||Ht<0||Ht>1,m=m||Ht<C,C=Ht,d.push(Ht),It});y&&e.errors.push(function _4(){return new Ot(3012,!1)}()),m&&e.errors.push(function y4(){return new Ot(3200,!1)}());const k=t.steps.length;let z=0;s>0&&s<k?e.errors.push(function v4(){return new Ot(3202,!1)}()):0==s&&(z=1/(k-1));const q=k-1,Q=e.currentTime,xe=e.currentAnimateTimings,De=xe.duration;return M.forEach((Ze,It)=>{const ut=z>0?It==q?1:z*It:d[It],Ht=ut*De;e.currentTime=Q+xe.delay+Ht,xe.duration=Ht,this._validateStyleAst(Ze,e),Ze.offset=ut,i.styles.push(Ze)}),i}visitReference(t,e){return{type:8,animation:Ul(this,Yy(t.animation),e),options:lm(t.options)}}visitAnimateChild(t,e){return e.depCount++,{type:9,options:lm(t.options)}}visitAnimateRef(t,e){return{type:10,animation:this.visitReference(t.animation,e),options:lm(t.options)}}visitQuery(t,e){const i=e.currentQuerySelector,r=t.options||{};e.queryCount++,e.currentQuery=t;const[s,d]=function l5(n){const t=!!n.split(/\s*,\s*/).find(e=>":self"==e);return t&&(n=n.replace(s5,"")),n=n.replace(/@\*/g,Xx).replace(/@\w+/g,e=>Xx+"-"+e.slice(1)).replace(/:animating/g,ET),[n,t]}(t.selector);e.currentQuerySelector=i.length?i+" "+s:s,jl(e.collectedStyles,e.currentQuerySelector,new Map);const m=Ul(this,Yy(t.animation),e);return e.currentQuery=null,e.currentQuerySelector=i,{type:11,selector:s,limit:r.limit||0,optional:!!r.optional,includeSelf:d,animation:m,originalSelector:t.selector,options:lm(t.options)}}visitStagger(t,e){e.currentQuery||e.errors.push(function x4(){return new Ot(3013,!1)}());const i="full"===t.timings?{duration:0,delay:0,easing:"full"}:Zx(t.timings,e.errors,!0);return{type:12,animation:Ul(this,Yy(t.animation),e),timings:i,options:null}}}class u5{constructor(t){this.errors=t,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}}function lm(n){return n?(n=Zy(n)).params&&(n.params=function c5(n){return n?Zy(n):null}(n.params)):n={},n}function kT(n,t,e){return{duration:n,delay:t,easing:e}}function RT(n,t,e,i,r,s,d=null,m=!1){return{type:1,element:n,keyframes:t,preStyleProps:e,postStyleProps:i,duration:r,delay:s,totalTime:r+s,easing:d,subTimeline:m}}class nw{constructor(){this._map=new Map}get(t){return this._map.get(t)||[]}append(t,e){let i=this._map.get(t);i||this._map.set(t,i=[]),i.push(...e)}has(t){return this._map.has(t)}clear(){this._map.clear()}}const m5=new RegExp(":enter","g"),b5=new RegExp(":leave","g");function PT(n,t,e,i,r,s=new Map,d=new Map,m,y,C=[]){return(new _5).buildKeyframes(n,t,e,i,r,s,d,m,y,C)}class _5{buildKeyframes(t,e,i,r,s,d,m,y,C,M=[]){C=C||new nw;const k=new LT(t,e,C,r,s,M,[]);k.options=y;const z=y.delay?lh(y.delay):0;k.currentTimeline.delayNextStep(z),k.currentTimeline.setStyles([d],null,k.errors,y),Ul(this,i,k);const q=k.timelines.filter(Q=>Q.containsAnimation());if(q.length&&m.size){let Q;for(let xe=q.length-1;xe>=0;xe--){const De=q[xe];if(De.element===e){Q=De;break}}Q&&!Q.allowOnlyTimelineStyles()&&Q.setStyles([m],null,k.errors,y)}return q.length?q.map(Q=>Q.buildKeyframes()):[RT(e,[],[],[],0,z,"",!1)]}visitTrigger(t,e){}visitState(t,e){}visitTransition(t,e){}visitAnimateChild(t,e){const i=e.subInstructions.get(e.element);if(i){const r=e.createSubContext(t.options),s=e.currentTimeline.currentTime,d=this._visitSubInstructions(i,r,r.options);s!=d&&e.transformIntoNewTimeline(d)}e.previousNode=t}visitAnimateRef(t,e){const i=e.createSubContext(t.options);i.transformIntoNewTimeline(),this._applyAnimationRefDelays([t.options,t.animation.options],e,i),this.visitReference(t.animation,i),e.transformIntoNewTimeline(i.currentTimeline.currentTime),e.previousNode=t}_applyAnimationRefDelays(t,e,i){var r;for(const s of t){const d=null==s?void 0:s.delay;if(d){const m="number"==typeof d?d:lh(Ky(d,null!==(r=null==s?void 0:s.params)&&void 0!==r?r:{},e.errors));i.delayNextStep(m)}}}_visitSubInstructions(t,e,i){let s=e.currentTimeline.currentTime;const d=null!=i.duration?lh(i.duration):null,m=null!=i.delay?lh(i.delay):null;return 0!==d&&t.forEach(y=>{const C=e.appendInstructionToTimeline(y,d,m);s=Math.max(s,C.duration+C.delay)}),s}visitReference(t,e){e.updateOptions(t.options,!0),Ul(this,t.animation,e),e.previousNode=t}visitSequence(t,e){const i=e.subContextCount;let r=e;const s=t.options;if(s&&(s.params||s.delay)&&(r=e.createSubContext(s),r.transformIntoNewTimeline(),null!=s.delay)){6==r.previousNode.type&&(r.currentTimeline.snapshotCurrentStyles(),r.previousNode=iw);const d=lh(s.delay);r.delayNextStep(d)}t.steps.length&&(t.steps.forEach(d=>Ul(this,d,r)),r.currentTimeline.applyStylesToKeyframe(),r.subContextCount>i&&r.transformIntoNewTimeline()),e.previousNode=t}visitGroup(t,e){const i=[];let r=e.currentTimeline.currentTime;const s=t.options&&t.options.delay?lh(t.options.delay):0;t.steps.forEach(d=>{const m=e.createSubContext(t.options);s&&m.delayNextStep(s),Ul(this,d,m),r=Math.max(r,m.currentTimeline.currentTime),i.push(m.currentTimeline)}),i.forEach(d=>e.currentTimeline.mergeTimelineCollectedStyles(d)),e.transformIntoNewTimeline(r),e.previousNode=t}_visitTiming(t,e){if(t.dynamic){const i=t.strValue;return Zx(e.params?Ky(i,e.params,e.errors):i,e.errors)}return{duration:t.duration,delay:t.delay,easing:t.easing}}visitAnimate(t,e){const i=e.currentAnimateTimings=this._visitTiming(t.timings,e),r=e.currentTimeline;i.delay&&(e.incrementTime(i.delay),r.snapshotCurrentStyles());const s=t.style;5==s.type?this.visitKeyframes(s,e):(e.incrementTime(i.duration),this.visitStyle(s,e),r.applyStylesToKeyframe()),e.currentAnimateTimings=null,e.previousNode=t}visitStyle(t,e){const i=e.currentTimeline,r=e.currentAnimateTimings;!r&&i.hasCurrentStyleProperties()&&i.forwardFrame();const s=r&&r.easing||t.easing;t.isEmptyStep?i.applyEmptyStep(s):i.setStyles(t.styles,s,e.errors,e.options),e.previousNode=t}visitKeyframes(t,e){const i=e.currentAnimateTimings,r=e.currentTimeline.duration,s=i.duration,m=e.createSubContext().currentTimeline;m.easing=i.easing,t.styles.forEach(y=>{m.forwardTime((y.offset||0)*s),m.setStyles(y.styles,y.easing,e.errors,e.options),m.applyStylesToKeyframe()}),e.currentTimeline.mergeTimelineCollectedStyles(m),e.transformIntoNewTimeline(r+s),e.previousNode=t}visitQuery(t,e){const i=e.currentTimeline.currentTime,r=t.options||{},s=r.delay?lh(r.delay):0;s&&(6===e.previousNode.type||0==i&&e.currentTimeline.hasCurrentStyleProperties())&&(e.currentTimeline.snapshotCurrentStyles(),e.previousNode=iw);let d=i;const m=e.invokeQuery(t.selector,t.originalSelector,t.limit,t.includeSelf,!!r.optional,e.errors);e.currentQueryTotal=m.length;let y=null;m.forEach((C,M)=>{e.currentQueryIndex=M;const k=e.createSubContext(t.options,C);s&&k.delayNextStep(s),C===e.element&&(y=k.currentTimeline),Ul(this,t.animation,k),k.currentTimeline.applyStylesToKeyframe(),d=Math.max(d,k.currentTimeline.currentTime)}),e.currentQueryIndex=0,e.currentQueryTotal=0,e.transformIntoNewTimeline(d),y&&(e.currentTimeline.mergeTimelineCollectedStyles(y),e.currentTimeline.snapshotCurrentStyles()),e.previousNode=t}visitStagger(t,e){const i=e.parentContext,r=e.currentTimeline,s=t.timings,d=Math.abs(s.duration),m=d*(e.currentQueryTotal-1);let y=d*e.currentQueryIndex;switch(s.duration<0?"reverse":s.easing){case"reverse":y=m-y;break;case"full":y=i.currentStaggerTime}const M=e.currentTimeline;y&&M.delayNextStep(y);const k=M.currentTime;Ul(this,t.animation,e),e.previousNode=t,i.currentStaggerTime=r.currentTime-k+(r.startTime-i.currentTimeline.startTime)}}const iw={};class LT{constructor(t,e,i,r,s,d,m,y){this._driver=t,this.element=e,this.subInstructions=i,this._enterClassName=r,this._leaveClassName=s,this.errors=d,this.timelines=m,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=iw,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=y||new rw(this._driver,e,0),m.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(t,e){if(!t)return;const i=t;let r=this.options;null!=i.duration&&(r.duration=lh(i.duration)),null!=i.delay&&(r.delay=lh(i.delay));const s=i.params;if(s){let d=r.params;d||(d=this.options.params={}),Object.keys(s).forEach(m=>{(!e||!d.hasOwnProperty(m))&&(d[m]=Ky(s[m],d,this.errors))})}}_copyOptions(){const t={};if(this.options){const e=this.options.params;if(e){const i=t.params={};Object.keys(e).forEach(r=>{i[r]=e[r]})}}return t}createSubContext(t=null,e,i){const r=e||this.element,s=new LT(this._driver,r,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(r,i||0));return s.previousNode=this.previousNode,s.currentAnimateTimings=this.currentAnimateTimings,s.options=this._copyOptions(),s.updateOptions(t),s.currentQueryIndex=this.currentQueryIndex,s.currentQueryTotal=this.currentQueryTotal,s.parentContext=this,this.subContextCount++,s}transformIntoNewTimeline(t){return this.previousNode=iw,this.currentTimeline=this.currentTimeline.fork(this.element,t),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(t,e,i){const r={duration:null!=e?e:t.duration,delay:this.currentTimeline.currentTime+(null!=i?i:0)+t.delay,easing:""},s=new y5(this._driver,t.element,t.keyframes,t.preStyleProps,t.postStyleProps,r,t.stretchStartingKeyframe);return this.timelines.push(s),r}incrementTime(t){this.currentTimeline.forwardTime(this.currentTimeline.duration+t)}delayNextStep(t){t>0&&this.currentTimeline.delayNextStep(t)}invokeQuery(t,e,i,r,s,d){let m=[];if(r&&m.push(this.element),t.length>0){t=(t=t.replace(m5,"."+this._enterClassName)).replace(b5,"."+this._leaveClassName);let C=this._driver.query(this.element,t,1!=i);0!==i&&(C=i<0?C.slice(C.length+i,C.length):C.slice(0,i)),m.push(...C)}return!s&&0==m.length&&d.push(function w4(n){return new Ot(3014,!1)}()),m}}class rw{constructor(t,e,i,r){this._driver=t,this.element=e,this.startTime=i,this._elementTimelineStylesLookup=r,this.duration=0,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(e),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(e,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(t){const e=1===this._keyframes.size&&this._pendingStyles.size;this.duration||e?(this.forwardTime(this.currentTime+t),e&&this.snapshotCurrentStyles()):this.startTime+=t}fork(t,e){return this.applyStylesToKeyframe(),new rw(this._driver,t,e||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(t){this.applyStylesToKeyframe(),this.duration=t,this._loadKeyframe()}_updateStyle(t,e){this._localTimelineStyles.set(t,e),this._globalTimelineStyles.set(t,e),this._styleSummary.set(t,{time:this.currentTime,value:e})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(t){t&&this._previousKeyframe.set("easing",t);for(let[e,i]of this._globalTimelineStyles)this._backFill.set(e,i||ah),this._currentKeyframe.set(e,ah);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(t,e,i,r){var s;e&&this._previousKeyframe.set("easing",e);const d=r&&r.params||{},m=function v5(n,t){const e=new Map;let i;return n.forEach(r=>{if("*"===r){i=i||t.keys();for(let s of i)e.set(s,ah)}else Sp(r,e)}),e}(t,this._globalTimelineStyles);for(let[y,C]of m){const M=Ky(C,d,i);this._pendingStyles.set(y,M),this._localTimelineStyles.has(y)||this._backFill.set(y,null!==(s=this._globalTimelineStyles.get(y))&&void 0!==s?s:ah),this._updateStyle(y,M)}}applyStylesToKeyframe(){0!=this._pendingStyles.size&&(this._pendingStyles.forEach((t,e)=>{this._currentKeyframe.set(e,t)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((t,e)=>{this._currentKeyframe.has(e)||this._currentKeyframe.set(e,t)}))}snapshotCurrentStyles(){for(let[t,e]of this._localTimelineStyles)this._pendingStyles.set(t,e),this._updateStyle(t,e)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const t=[];for(let e in this._currentKeyframe)t.push(e);return t}mergeTimelineCollectedStyles(t){t._styleSummary.forEach((e,i)=>{const r=this._styleSummary.get(i);(!r||e.time>r.time)&&this._updateStyle(i,e.value)})}buildKeyframes(){this.applyStylesToKeyframe();const t=new Set,e=new Set,i=1===this._keyframes.size&&0===this.duration;let r=[];this._keyframes.forEach((m,y)=>{const C=Sp(m,new Map,this._backFill);C.forEach((M,k)=>{"!"===M?t.add(k):M===ah&&e.add(k)}),i||C.set("offset",y/this.duration),r.push(C)});const s=t.size?Yx(t.values()):[],d=e.size?Yx(e.values()):[];if(i){const m=r[0],y=new Map(m);m.set("offset",0),y.set("offset",1),r=[m,y]}return RT(this.element,r,s,d,this.duration,this.startTime,this.easing,!1)}}class y5 extends rw{constructor(t,e,i,r,s,d,m=!1){super(t,e,d.delay),this.keyframes=i,this.preStyleProps=r,this.postStyleProps=s,this._stretchStartingKeyframe=m,this.timings={duration:d.duration,delay:d.delay,easing:d.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let t=this.keyframes,{delay:e,duration:i,easing:r}=this.timings;if(this._stretchStartingKeyframe&&e){const s=[],d=i+e,m=e/d,y=Sp(t[0]);y.set("offset",0),s.push(y);const C=Sp(t[0]);C.set("offset",ZR(m)),s.push(C);const M=t.length-1;for(let k=1;k<=M;k++){let z=Sp(t[k]);const q=z.get("offset");z.set("offset",ZR((e+q*i)/d)),s.push(z)}i=d,e=0,r="",t=s}return RT(this.element,t,this.preStyleProps,this.postStyleProps,i,e,r,!0)}}function ZR(n,t=3){const e=Math.pow(10,t-1);return Math.round(n*e)/e}class OT{}const x5=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]);class w5 extends OT{normalizePropertyName(t,e){return MT(t)}normalizeStyleValue(t,e,i,r){let s="";const d=i.toString().trim();if(x5.has(e)&&0!==i&&"0"!==i)if("number"==typeof i)s="px";else{const m=i.match(/^[+-]?[\d\.]+([a-z]*)$/);m&&0==m[1].length&&r.push(function d4(n,t){return new Ot(3005,!1)}())}return d+s}}function YR(n,t,e,i,r,s,d,m,y,C,M,k,z){return{type:0,element:n,triggerName:t,isRemovalTransition:r,fromState:e,fromStyles:s,toState:i,toStyles:d,timelines:m,queriedElements:y,preStyleProps:C,postStyleProps:M,totalTime:k,errors:z}}const FT={};class KR{constructor(t,e,i){this._triggerName=t,this.ast=e,this._stateStyles=i}match(t,e,i,r){return function S5(n,t,e,i,r){return n.some(s=>s(t,e,i,r))}(this.ast.matchers,t,e,i,r)}buildStyles(t,e,i){let r=this._stateStyles.get("*");return void 0!==t&&(r=this._stateStyles.get(null==t?void 0:t.toString())||r),r?r.buildStyles(e,i):new Map}build(t,e,i,r,s,d,m,y,C,M){var k;const z=[],q=this.ast.options&&this.ast.options.params||FT,xe=this.buildStyles(i,m&&m.params||FT,z),De=y&&y.params||FT,Ze=this.buildStyles(r,De,z),It=new Set,ut=new Map,Ht=new Map,Mn="void"===r,Yn={params:C5(De,q),delay:null===(k=this.ast.options)||void 0===k?void 0:k.delay},ai=M?[]:PT(t,e,this.ast.animation,s,d,xe,Ze,Yn,C,z);let Tr=0;if(ai.forEach(Hs=>{Tr=Math.max(Hs.duration+Hs.delay,Tr)}),z.length)return YR(e,this._triggerName,i,r,Mn,xe,Ze,[],[],ut,Ht,Tr,z);ai.forEach(Hs=>{const xh=Hs.element,wh=jl(ut,xh,new Set);Hs.preStyleProps.forEach(cd=>wh.add(cd));const Sh=jl(Ht,xh,new Set);Hs.postStyleProps.forEach(cd=>Sh.add(cd)),xh!==e&&It.add(xh)});const ma=Yx(It.values());return YR(e,this._triggerName,i,r,Mn,xe,Ze,ai,ma,ut,Ht,Tr)}}function C5(n,t){const e=Zy(t);for(const i in n)n.hasOwnProperty(i)&&null!=n[i]&&(e[i]=n[i]);return e}class T5{constructor(t,e,i){this.styles=t,this.defaultParams=e,this.normalizer=i}buildStyles(t,e){const i=new Map,r=Zy(this.defaultParams);return Object.keys(t).forEach(s=>{const d=t[s];null!==d&&(r[s]=d)}),this.styles.styles.forEach(s=>{"string"!=typeof s&&s.forEach((d,m)=>{d&&(d=Ky(d,r,e));const y=this.normalizer.normalizePropertyName(m,e);d=this.normalizer.normalizeStyleValue(m,y,d,e),i.set(y,d)})}),i}}class D5{constructor(t,e,i){this.name=t,this.ast=e,this._normalizer=i,this.transitionFactories=[],this.states=new Map,e.states.forEach(r=>{this.states.set(r.name,new T5(r.style,r.options&&r.options.params||{},i))}),QR(this.states,"true","1"),QR(this.states,"false","0"),e.transitions.forEach(r=>{this.transitionFactories.push(new KR(t,r,this.states))}),this.fallbackTransition=function I5(n,t,e){return new KR(n,{type:1,animation:{type:2,steps:[],options:null},matchers:[(d,m)=>!0],options:null,queryCount:0,depCount:0},t)}(t,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(t,e,i,r){return this.transitionFactories.find(d=>d.match(t,e,i,r))||null}matchStyles(t,e,i){return this.fallbackTransition.buildStyles(t,e,i)}}function QR(n,t,e){n.has(t)?n.has(e)||n.set(e,n.get(t)):n.has(e)&&n.set(t,n.get(e))}const M5=new nw;class A5{constructor(t,e,i){this.bodyNode=t,this._driver=e,this._normalizer=i,this._animations=new Map,this._playersById=new Map,this.players=[]}register(t,e){const i=[],s=AT(this._driver,e,i,[]);if(i.length)throw function M4(n){return new Ot(3503,!1)}();this._animations.set(t,s)}_buildPlayer(t,e,i){const r=t.element,s=AR(0,this._normalizer,0,t.keyframes,e,i);return this._driver.animate(r,s,t.duration,t.delay,t.easing,[],!0)}create(t,e,i={}){const r=[],s=this._animations.get(t);let d;const m=new Map;if(s?(d=PT(this._driver,e,s,TT,qx,new Map,new Map,i,M5,r),d.forEach(M=>{const k=jl(m,M.element,new Map);M.postStyleProps.forEach(z=>k.set(z,null))})):(r.push(function A4(){return new Ot(3300,!1)}()),d=[]),r.length)throw function k4(n){return new Ot(3504,!1)}();m.forEach((M,k)=>{M.forEach((z,q)=>{M.set(q,this._driver.computeStyle(k,q,ah))})});const C=wp(d.map(M=>{const k=m.get(M.element);return this._buildPlayer(M,new Map,k)}));return this._playersById.set(t,C),C.onDestroy(()=>this.destroy(t)),this.players.push(C),C}destroy(t){const e=this._getPlayer(t);e.destroy(),this._playersById.delete(t);const i=this.players.indexOf(e);i>=0&&this.players.splice(i,1)}_getPlayer(t){const e=this._playersById.get(t);if(!e)throw function R4(n){return new Ot(3301,!1)}();return e}listen(t,e,i,r){const s=xT(e,"","","");return yT(this._getPlayer(t),i,s,r),()=>{}}command(t,e,i,r){if("register"==i)return void this.register(t,r[0]);if("create"==i)return void this.create(t,e,r[0]||{});const s=this._getPlayer(t);switch(i){case"play":s.play();break;case"pause":s.pause();break;case"reset":s.reset();break;case"restart":s.restart();break;case"finish":s.finish();break;case"init":s.init();break;case"setPosition":s.setPosition(parseFloat(r[0]));break;case"destroy":this.destroy(t)}}}const JR="ng-animate-queued",NT="ng-animate-disabled",O5=[],eP={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},F5={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},Cc="__ng_removed";class BT{constructor(t,e=""){this.namespaceId=e;const i=t&&t.hasOwnProperty("value");if(this.value=function V5(n){return null!=n?n:null}(i?t.value:t),i){const s=Zy(t);delete s.value,this.options=s}else this.options={};this.options.params||(this.options.params={})}get params(){return this.options.params}absorbOptions(t){const e=t.params;if(e){const i=this.options.params;Object.keys(e).forEach(r=>{null==i[r]&&(i[r]=e[r])})}}}const Qy="void",zT=new BT(Qy);class N5{constructor(t,e,i){this.id=t,this.hostElement=e,this._engine=i,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+t,Tc(e,this._hostClassName)}listen(t,e,i,r){if(!this._triggers.has(e))throw function P4(n,t){return new Ot(3302,!1)}();if(null==i||0==i.length)throw function L4(n){return new Ot(3303,!1)}();if(!function j5(n){return"start"==n||"done"==n}(i))throw function O4(n,t){return new Ot(3400,!1)}();const s=jl(this._elementListeners,t,[]),d={name:e,phase:i,callback:r};s.push(d);const m=jl(this._engine.statesByElement,t,new Map);return m.has(e)||(Tc(t,Wx),Tc(t,Wx+"-"+e),m.set(e,zT)),()=>{this._engine.afterFlush(()=>{const y=s.indexOf(d);y>=0&&s.splice(y,1),this._triggers.has(e)||m.delete(e)})}}register(t,e){return!this._triggers.has(t)&&(this._triggers.set(t,e),!0)}_getTrigger(t){const e=this._triggers.get(t);if(!e)throw function F4(n){return new Ot(3401,!1)}();return e}trigger(t,e,i,r=!0){const s=this._getTrigger(e),d=new VT(this.id,e,t);let m=this._engine.statesByElement.get(t);m||(Tc(t,Wx),Tc(t,Wx+"-"+e),this._engine.statesByElement.set(t,m=new Map));let y=m.get(e);const C=new BT(i,this.id);if(!(i&&i.hasOwnProperty("value"))&&y&&C.absorbOptions(y.options),m.set(e,C),y||(y=zT),C.value!==Qy&&y.value===C.value){if(!function $5(n,t){const e=Object.keys(n),i=Object.keys(t);if(e.length!=i.length)return!1;for(let r=0;r<e.length;r++){const s=e[r];if(!t.hasOwnProperty(s)||n[s]!==t[s])return!1}return!0}(y.params,C.params)){const xe=[],De=s.matchStyles(y.value,y.params,xe),Ze=s.matchStyles(C.value,C.params,xe);xe.length?this._engine.reportError(xe):this._engine.afterFlush(()=>{am(t,De),nd(t,Ze)})}return}const z=jl(this._engine.playersByElement,t,[]);z.forEach(xe=>{xe.namespaceId==this.id&&xe.triggerName==e&&xe.queued&&xe.destroy()});let q=s.matchTransition(y.value,C.value,t,C.params),Q=!1;if(!q){if(!r)return;q=s.fallbackTransition,Q=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:e,transition:q,fromState:y,toState:C,player:d,isFallbackTransition:Q}),Q||(Tc(t,JR),d.onStart(()=>{Db(t,JR)})),d.onDone(()=>{let xe=this.players.indexOf(d);xe>=0&&this.players.splice(xe,1);const De=this._engine.playersByElement.get(t);if(De){let Ze=De.indexOf(d);Ze>=0&&De.splice(Ze,1)}}),this.players.push(d),z.push(d),d}deregister(t){this._triggers.delete(t),this._engine.statesByElement.forEach(e=>e.delete(t)),this._elementListeners.forEach((e,i)=>{this._elementListeners.set(i,e.filter(r=>r.name!=t))})}clearElementCache(t){this._engine.statesByElement.delete(t),this._elementListeners.delete(t);const e=this._engine.playersByElement.get(t);e&&(e.forEach(i=>i.destroy()),this._engine.playersByElement.delete(t))}_signalRemovalForInnerTriggers(t,e){const i=this._engine.driver.query(t,Xx,!0);i.forEach(r=>{if(r[Cc])return;const s=this._engine.fetchNamespacesByElement(r);s.size?s.forEach(d=>d.triggerLeaveAnimation(r,e,!1,!0)):this.clearElementCache(r)}),this._engine.afterFlushAnimationsDone(()=>i.forEach(r=>this.clearElementCache(r)))}triggerLeaveAnimation(t,e,i,r){const s=this._engine.statesByElement.get(t),d=new Map;if(s){const m=[];if(s.forEach((y,C)=>{if(d.set(C,y.value),this._triggers.has(C)){const M=this.trigger(t,C,Qy,r);M&&m.push(M)}}),m.length)return this._engine.markElementAsRemoved(this.id,t,!0,e,d),i&&wp(m).onDone(()=>this._engine.processLeaveNode(t)),!0}return!1}prepareLeaveAnimationListeners(t){const e=this._elementListeners.get(t),i=this._engine.statesByElement.get(t);if(e&&i){const r=new Set;e.forEach(s=>{const d=s.name;if(r.has(d))return;r.add(d);const y=this._triggers.get(d).fallbackTransition,C=i.get(d)||zT,M=new BT(Qy),k=new VT(this.id,d,t);this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:d,transition:y,fromState:C,toState:M,player:k,isFallbackTransition:!0})})}}removeNode(t,e){const i=this._engine;if(t.childElementCount&&this._signalRemovalForInnerTriggers(t,e),this.triggerLeaveAnimation(t,e,!0))return;let r=!1;if(i.totalAnimations){const s=i.players.length?i.playersByQueriedElement.get(t):[];if(s&&s.length)r=!0;else{let d=t;for(;d=d.parentNode;)if(i.statesByElement.get(d)){r=!0;break}}}if(this.prepareLeaveAnimationListeners(t),r)i.markElementAsRemoved(this.id,t,!1,e);else{const s=t[Cc];(!s||s===eP)&&(i.afterFlush(()=>this.clearElementCache(t)),i.destroyInnerAnimations(t),i._onRemovalComplete(t,e))}}insertNode(t,e){Tc(t,this._hostClassName)}drainQueuedTransitions(t){const e=[];return this._queue.forEach(i=>{const r=i.player;if(r.destroyed)return;const s=i.element,d=this._elementListeners.get(s);d&&d.forEach(m=>{if(m.name==i.triggerName){const y=xT(s,i.triggerName,i.fromState.value,i.toState.value);y._data=t,yT(i.player,m.phase,y,m.callback)}}),r.markedForDestroy?this._engine.afterFlush(()=>{r.destroy()}):e.push(i)}),this._queue=[],e.sort((i,r)=>{const s=i.transition.ast.depCount,d=r.transition.ast.depCount;return 0==s||0==d?s-d:this._engine.driver.containsElement(i.element,r.element)?1:-1})}destroy(t){this.players.forEach(e=>e.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,t)}elementContainsData(t){let e=!1;return this._elementListeners.has(t)&&(e=!0),e=!!this._queue.find(i=>i.element===t)||e,e}}class B5{constructor(t,e,i){this.bodyNode=t,this.driver=e,this._normalizer=i,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(r,s)=>{}}_onRemovalComplete(t,e){this.onRemovalComplete(t,e)}get queuedPlayers(){const t=[];return this._namespaceList.forEach(e=>{e.players.forEach(i=>{i.queued&&t.push(i)})}),t}createNamespace(t,e){const i=new N5(t,e,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,e)?this._balanceNamespaceList(i,e):(this.newHostElements.set(e,i),this.collectEnterElement(e)),this._namespaceLookup[t]=i}_balanceNamespaceList(t,e){const i=this._namespaceList,r=this.namespacesByHostElement;if(i.length-1>=0){let d=!1,m=this.driver.getParentElement(e);for(;m;){const y=r.get(m);if(y){const C=i.indexOf(y);i.splice(C+1,0,t),d=!0;break}m=this.driver.getParentElement(m)}d||i.unshift(t)}else i.push(t);return r.set(e,t),t}register(t,e){let i=this._namespaceLookup[t];return i||(i=this.createNamespace(t,e)),i}registerTrigger(t,e,i){let r=this._namespaceLookup[t];r&&r.register(e,i)&&this.totalAnimations++}destroy(t,e){if(!t)return;const i=this._fetchNamespace(t);this.afterFlush(()=>{this.namespacesByHostElement.delete(i.hostElement),delete this._namespaceLookup[t];const r=this._namespaceList.indexOf(i);r>=0&&this._namespaceList.splice(r,1)}),this.afterFlushAnimationsDone(()=>i.destroy(e))}_fetchNamespace(t){return this._namespaceLookup[t]}fetchNamespacesByElement(t){const e=new Set,i=this.statesByElement.get(t);if(i)for(let r of i.values())if(r.namespaceId){const s=this._fetchNamespace(r.namespaceId);s&&e.add(s)}return e}trigger(t,e,i,r){if(ow(e)){const s=this._fetchNamespace(t);if(s)return s.trigger(e,i,r),!0}return!1}insertNode(t,e,i,r){if(!ow(e))return;const s=e[Cc];if(s&&s.setForRemoval){s.setForRemoval=!1,s.setForMove=!0;const d=this.collectedLeaveElements.indexOf(e);d>=0&&this.collectedLeaveElements.splice(d,1)}if(t){const d=this._fetchNamespace(t);d&&d.insertNode(e,i)}r&&this.collectEnterElement(e)}collectEnterElement(t){this.collectedEnterElements.push(t)}markElementAsDisabled(t,e){e?this.disabledNodes.has(t)||(this.disabledNodes.add(t),Tc(t,NT)):this.disabledNodes.has(t)&&(this.disabledNodes.delete(t),Db(t,NT))}removeNode(t,e,i,r){if(ow(e)){const s=t?this._fetchNamespace(t):null;if(s?s.removeNode(e,r):this.markElementAsRemoved(t,e,!1,r),i){const d=this.namespacesByHostElement.get(e);d&&d.id!==t&&d.removeNode(e,r)}}else this._onRemovalComplete(e,r)}markElementAsRemoved(t,e,i,r,s){this.collectedLeaveElements.push(e),e[Cc]={namespaceId:t,setForRemoval:r,hasAnimation:i,removedBeforeQueried:!1,previousTriggersValues:s}}listen(t,e,i,r,s){return ow(e)?this._fetchNamespace(t).listen(e,i,r,s):()=>{}}_buildInstruction(t,e,i,r,s){return t.transition.build(this.driver,t.element,t.fromState.value,t.toState.value,i,r,t.fromState.options,t.toState.options,e,s)}destroyInnerAnimations(t){let e=this.driver.query(t,Xx,!0);e.forEach(i=>this.destroyActiveAnimationsForElement(i)),0!=this.playersByQueriedElement.size&&(e=this.driver.query(t,ET,!0),e.forEach(i=>this.finishActiveQueriedAnimationOnElement(i)))}destroyActiveAnimationsForElement(t){const e=this.playersByElement.get(t);e&&e.forEach(i=>{i.queued?i.markedForDestroy=!0:i.destroy()})}finishActiveQueriedAnimationOnElement(t){const e=this.playersByQueriedElement.get(t);e&&e.forEach(i=>i.finish())}whenRenderingDone(){return new Promise(t=>{if(this.players.length)return wp(this.players).onDone(()=>t());t()})}processLeaveNode(t){var e;const i=t[Cc];if(i&&i.setForRemoval){if(t[Cc]=eP,i.namespaceId){this.destroyInnerAnimations(t);const r=this._fetchNamespace(i.namespaceId);r&&r.clearElementCache(t)}this._onRemovalComplete(t,i.setForRemoval)}!(null===(e=t.classList)||void 0===e)&&e.contains(NT)&&this.markElementAsDisabled(t,!1),this.driver.query(t,".ng-animate-disabled",!0).forEach(r=>{this.markElementAsDisabled(r,!1)})}flush(t=-1){let e=[];if(this.newHostElements.size&&(this.newHostElements.forEach((i,r)=>this._balanceNamespaceList(i,r)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let i=0;i<this.collectedEnterElements.length;i++)Tc(this.collectedEnterElements[i],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const i=[];try{e=this._flushAnimations(i,t)}finally{for(let r=0;r<i.length;r++)i[r]()}}else for(let i=0;i<this.collectedLeaveElements.length;i++)this.processLeaveNode(this.collectedLeaveElements[i]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(i=>i()),this._flushFns=[],this._whenQuietFns.length){const i=this._whenQuietFns;this._whenQuietFns=[],e.length?wp(e).onDone(()=>{i.forEach(r=>r())}):i.forEach(r=>r())}}reportError(t){throw function N4(n){return new Ot(3402,!1)}()}_flushAnimations(t,e){const i=new nw,r=[],s=new Map,d=[],m=new Map,y=new Map,C=new Map,M=new Set;this.disabledNodes.forEach(On=>{M.add(On);const Kn=this.driver.query(On,".ng-animate-queued",!0);for(let li=0;li<Kn.length;li++)M.add(Kn[li])});const k=this.bodyNode,z=Array.from(this.statesByElement.keys()),q=iP(z,this.collectedEnterElements),Q=new Map;let xe=0;q.forEach((On,Kn)=>{const li=TT+xe++;Q.set(Kn,li),On.forEach(lr=>Tc(lr,li))});const De=[],Ze=new Set,It=new Set;for(let On=0;On<this.collectedLeaveElements.length;On++){const Kn=this.collectedLeaveElements[On],li=Kn[Cc];li&&li.setForRemoval&&(De.push(Kn),Ze.add(Kn),li.hasAnimation?this.driver.query(Kn,".ng-star-inserted",!0).forEach(lr=>Ze.add(lr)):It.add(Kn))}const ut=new Map,Ht=iP(z,Array.from(Ze));Ht.forEach((On,Kn)=>{const li=qx+xe++;ut.set(Kn,li),On.forEach(lr=>Tc(lr,li))}),t.push(()=>{q.forEach((On,Kn)=>{const li=Q.get(Kn);On.forEach(lr=>Db(lr,li))}),Ht.forEach((On,Kn)=>{const li=ut.get(Kn);On.forEach(lr=>Db(lr,li))}),De.forEach(On=>{this.processLeaveNode(On)})});const Mn=[],Yn=[];for(let On=this._namespaceList.length-1;On>=0;On--)this._namespaceList[On].drainQueuedTransitions(e).forEach(li=>{const lr=li.player,zo=li.element;if(Mn.push(lr),this.collectedEnterElements.length){const ga=zo[Cc];if(ga&&ga.setForMove){if(ga.previousTriggersValues&&ga.previousTriggersValues.has(li.triggerName)){const Pm=ga.previousTriggersValues.get(li.triggerName),Mc=this.statesByElement.get(li.element);if(Mc&&Mc.has(li.triggerName)){const US=Mc.get(li.triggerName);US.value=Pm,Mc.set(li.triggerName,US)}}return void lr.destroy()}}const ud=!k||!this.driver.containsElement(k,zo),Gl=ut.get(zo),Hp=Q.get(zo),ko=this._buildInstruction(li,i,Hp,Gl,ud);if(ko.errors&&ko.errors.length)return void Yn.push(ko);if(ud)return lr.onStart(()=>am(zo,ko.fromStyles)),lr.onDestroy(()=>nd(zo,ko.toStyles)),void r.push(lr);if(li.isFallbackTransition)return lr.onStart(()=>am(zo,ko.fromStyles)),lr.onDestroy(()=>nd(zo,ko.toStyles)),void r.push(lr);const eB=[];ko.timelines.forEach(ga=>{ga.stretchStartingKeyframe=!0,this.disabledNodes.has(ga.element)||eB.push(ga)}),ko.timelines=eB,i.append(zo,ko.timelines),d.push({instruction:ko,player:lr,element:zo}),ko.queriedElements.forEach(ga=>jl(m,ga,[]).push(lr)),ko.preStyleProps.forEach((ga,Pm)=>{if(ga.size){let Mc=y.get(Pm);Mc||y.set(Pm,Mc=new Set),ga.forEach((US,SI)=>Mc.add(SI))}}),ko.postStyleProps.forEach((ga,Pm)=>{let Mc=C.get(Pm);Mc||C.set(Pm,Mc=new Set),ga.forEach((US,SI)=>Mc.add(SI))})});if(Yn.length){const On=[];Yn.forEach(Kn=>{On.push(function B4(n,t){return new Ot(3505,!1)}())}),Mn.forEach(Kn=>Kn.destroy()),this.reportError(On)}const ai=new Map,Tr=new Map;d.forEach(On=>{const Kn=On.element;i.has(Kn)&&(Tr.set(Kn,Kn),this._beforeAnimationBuild(On.player.namespaceId,On.instruction,ai))}),r.forEach(On=>{const Kn=On.element;this._getPreviousPlayers(Kn,!1,On.namespaceId,On.triggerName,null).forEach(lr=>{jl(ai,Kn,[]).push(lr),lr.destroy()})});const ma=De.filter(On=>oP(On,y,C)),Hs=new Map;nP(Hs,this.driver,It,C,ah).forEach(On=>{oP(On,y,C)&&ma.push(On)});const wh=new Map;q.forEach((On,Kn)=>{nP(wh,this.driver,new Set(On),y,"!")}),ma.forEach(On=>{var Kn,li;const lr=Hs.get(On),zo=wh.get(On);Hs.set(On,new Map([...Array.from(null!==(Kn=null==lr?void 0:lr.entries())&&void 0!==Kn?Kn:[]),...Array.from(null!==(li=null==zo?void 0:zo.entries())&&void 0!==li?li:[])]))});const Sh=[],cd=[],e_={};d.forEach(On=>{const{element:Kn,player:li,instruction:lr}=On;if(i.has(Kn)){if(M.has(Kn))return li.onDestroy(()=>nd(Kn,lr.toStyles)),li.disabled=!0,li.overrideTotalTime(lr.totalTime),void r.push(li);let zo=e_;if(Tr.size>1){let Gl=Kn;const Hp=[];for(;Gl=Gl.parentNode;){const ko=Tr.get(Gl);if(ko){zo=ko;break}Hp.push(Gl)}Hp.forEach(ko=>Tr.set(ko,zo))}const ud=this._buildAnimation(li.namespaceId,lr,ai,s,wh,Hs);if(li.setRealPlayer(ud),zo===e_)Sh.push(li);else{const Gl=this.playersByElement.get(zo);Gl&&Gl.length&&(li.parentPlayer=wp(Gl)),r.push(li)}}else am(Kn,lr.fromStyles),li.onDestroy(()=>nd(Kn,lr.toStyles)),cd.push(li),M.has(Kn)&&r.push(li)}),cd.forEach(On=>{const Kn=s.get(On.element);if(Kn&&Kn.length){const li=wp(Kn);On.setRealPlayer(li)}}),r.forEach(On=>{On.parentPlayer?On.syncPlayerEvents(On.parentPlayer):On.destroy()});for(let On=0;On<De.length;On++){const Kn=De[On],li=Kn[Cc];if(Db(Kn,qx),li&&li.hasAnimation)continue;let lr=[];if(m.size){let ud=m.get(Kn);ud&&ud.length&&lr.push(...ud);let Gl=this.driver.query(Kn,ET,!0);for(let Hp=0;Hp<Gl.length;Hp++){let ko=m.get(Gl[Hp]);ko&&ko.length&&lr.push(...ko)}}const zo=lr.filter(ud=>!ud.destroyed);zo.length?U5(this,Kn,zo):this.processLeaveNode(Kn)}return De.length=0,Sh.forEach(On=>{this.players.push(On),On.onDone(()=>{On.destroy();const Kn=this.players.indexOf(On);this.players.splice(Kn,1)}),On.play()}),Sh}elementContainsData(t,e){let i=!1;const r=e[Cc];return r&&r.setForRemoval&&(i=!0),this.playersByElement.has(e)&&(i=!0),this.playersByQueriedElement.has(e)&&(i=!0),this.statesByElement.has(e)&&(i=!0),this._fetchNamespace(t).elementContainsData(e)||i}afterFlush(t){this._flushFns.push(t)}afterFlushAnimationsDone(t){this._whenQuietFns.push(t)}_getPreviousPlayers(t,e,i,r,s){let d=[];if(e){const m=this.playersByQueriedElement.get(t);m&&(d=m)}else{const m=this.playersByElement.get(t);if(m){const y=!s||s==Qy;m.forEach(C=>{C.queued||!y&&C.triggerName!=r||d.push(C)})}}return(i||r)&&(d=d.filter(m=>!(i&&i!=m.namespaceId||r&&r!=m.triggerName))),d}_beforeAnimationBuild(t,e,i){const s=e.element,d=e.isRemovalTransition?void 0:t,m=e.isRemovalTransition?void 0:e.triggerName;for(const y of e.timelines){const C=y.element,M=C!==s,k=jl(i,C,[]);this._getPreviousPlayers(C,M,d,m,e.toState).forEach(q=>{const Q=q.getRealPlayer();Q.beforeDestroy&&Q.beforeDestroy(),q.destroy(),k.push(q)})}am(s,e.fromStyles)}_buildAnimation(t,e,i,r,s,d){const m=e.triggerName,y=e.element,C=[],M=new Set,k=new Set,z=e.timelines.map(Q=>{const xe=Q.element;M.add(xe);const De=xe[Cc];if(De&&De.removedBeforeQueried)return new Xy(Q.duration,Q.delay);const Ze=xe!==y,It=function H5(n){const t=[];return rP(n,t),t}((i.get(xe)||O5).map(ai=>ai.getRealPlayer())).filter(ai=>!!ai.element&&ai.element===xe),ut=s.get(xe),Ht=d.get(xe),Mn=AR(0,this._normalizer,0,Q.keyframes,ut,Ht),Yn=this._buildPlayer(Q,Mn,It);if(Q.subTimeline&&r&&k.add(xe),Ze){const ai=new VT(t,m,xe);ai.setRealPlayer(Yn),C.push(ai)}return Yn});C.forEach(Q=>{jl(this.playersByQueriedElement,Q.element,[]).push(Q),Q.onDone(()=>function z5(n,t,e){let i=n.get(t);if(i){if(i.length){const r=i.indexOf(e);i.splice(r,1)}0==i.length&&n.delete(t)}return i}(this.playersByQueriedElement,Q.element,Q))}),M.forEach(Q=>Tc(Q,zR));const q=wp(z);return q.onDestroy(()=>{M.forEach(Q=>Db(Q,zR)),nd(y,e.toStyles)}),k.forEach(Q=>{jl(r,Q,[]).push(q)}),q}_buildPlayer(t,e,i){return e.length>0?this.driver.animate(t.element,e,t.duration,t.delay,t.easing,i):new Xy(t.duration,t.delay)}}class VT{constructor(t,e,i){this.namespaceId=t,this.triggerName=e,this.element=i,this._player=new Xy,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(t){this._containsRealPlayer||(this._player=t,this._queuedCallbacks.forEach((e,i)=>{e.forEach(r=>yT(t,i,void 0,r))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(t.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(t){this.totalTime=t}syncPlayerEvents(t){const e=this._player;e.triggerCallback&&t.onStart(()=>e.triggerCallback("start")),t.onDone(()=>this.finish()),t.onDestroy(()=>this.destroy())}_queueEvent(t,e){jl(this._queuedCallbacks,t,[]).push(e)}onDone(t){this.queued&&this._queueEvent("done",t),this._player.onDone(t)}onStart(t){this.queued&&this._queueEvent("start",t),this._player.onStart(t)}onDestroy(t){this.queued&&this._queueEvent("destroy",t),this._player.onDestroy(t)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(t){this.queued||this._player.setPosition(t)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(t){const e=this._player;e.triggerCallback&&e.triggerCallback(t)}}function ow(n){return n&&1===n.nodeType}function tP(n,t){const e=n.style.display;return n.style.display=null!=t?t:"none",e}function nP(n,t,e,i,r){const s=[];e.forEach(y=>s.push(tP(y)));const d=[];i.forEach((y,C)=>{const M=new Map;y.forEach(k=>{const z=t.computeStyle(C,k,r);M.set(k,z),(!z||0==z.length)&&(C[Cc]=F5,d.push(C))}),n.set(C,M)});let m=0;return e.forEach(y=>tP(y,s[m++])),d}function iP(n,t){const e=new Map;if(n.forEach(m=>e.set(m,[])),0==t.length)return e;const r=new Set(t),s=new Map;function d(m){if(!m)return 1;let y=s.get(m);if(y)return y;const C=m.parentNode;return y=e.has(C)?C:r.has(C)?1:d(C),s.set(m,y),y}return t.forEach(m=>{const y=d(m);1!==y&&e.get(y).push(m)}),e}function Tc(n,t){var e;null===(e=n.classList)||void 0===e||e.add(t)}function Db(n,t){var e;null===(e=n.classList)||void 0===e||e.remove(t)}function U5(n,t,e){wp(e).onDone(()=>n.processLeaveNode(t))}function rP(n,t){for(let e=0;e<n.length;e++){const i=n[e];i instanceof IR?rP(i.players,t):t.push(i)}}function oP(n,t,e){const i=e.get(n);if(!i)return!1;let r=t.get(n);return r?i.forEach(s=>r.add(s)):t.set(n,i),e.delete(n),!0}class sw{constructor(t,e,i){this.bodyNode=t,this._driver=e,this._normalizer=i,this._triggerCache={},this.onRemovalComplete=(r,s)=>{},this._transitionEngine=new B5(t,e,i),this._timelineEngine=new A5(t,e,i),this._transitionEngine.onRemovalComplete=(r,s)=>this.onRemovalComplete(r,s)}registerTrigger(t,e,i,r,s){const d=t+"-"+r;let m=this._triggerCache[d];if(!m){const y=[],M=AT(this._driver,s,y,[]);if(y.length)throw function D4(n,t){return new Ot(3404,!1)}();m=function E5(n,t,e){return new D5(n,t,e)}(r,M,this._normalizer),this._triggerCache[d]=m}this._transitionEngine.registerTrigger(e,r,m)}register(t,e){this._transitionEngine.register(t,e)}destroy(t,e){this._transitionEngine.destroy(t,e)}onInsert(t,e,i,r){this._transitionEngine.insertNode(t,e,i,r)}onRemove(t,e,i,r){this._transitionEngine.removeNode(t,e,r||!1,i)}disableAnimations(t,e){this._transitionEngine.markElementAsDisabled(t,e)}process(t,e,i,r){if("@"==i.charAt(0)){const[s,d]=kR(i);this._timelineEngine.command(s,e,d,r)}else this._transitionEngine.trigger(t,e,i,r)}listen(t,e,i,r,s){if("@"==i.charAt(0)){const[d,m]=kR(i);return this._timelineEngine.listen(d,e,m,s)}return this._transitionEngine.listen(t,e,i,r,s)}flush(t=-1){this._transitionEngine.flush(t)}get players(){return this._transitionEngine.players.concat(this._timelineEngine.players)}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}}let q5=(()=>{class n{constructor(e,i,r){this._element=e,this._startStyles=i,this._endStyles=r,this._state=0;let s=n.initialStylesByElement.get(e);s||n.initialStylesByElement.set(e,s=new Map),this._initialStyles=s}start(){this._state<1&&(this._startStyles&&nd(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(nd(this._element,this._initialStyles),this._endStyles&&(nd(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(n.initialStylesByElement.delete(this._element),this._startStyles&&(am(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(am(this._element,this._endStyles),this._endStyles=null),nd(this._element,this._initialStyles),this._state=3)}}return n.initialStylesByElement=new WeakMap,n})();function jT(n){let t=null;return n.forEach((e,i)=>{(function W5(n){return"display"===n||"position"===n})(i)&&(t=t||new Map,t.set(i,e))}),t}class sP{constructor(t,e,i,r){this.element=t,this.keyframes=e,this.options=i,this._specialStyles=r,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=i.duration,this._delay=i.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const t=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,t,this.options),this._finalKeyframe=t.length?t[t.length-1]:new Map,this.domPlayer.addEventListener("finish",()=>this._onFinish())}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(t){const e=[];return t.forEach(i=>{e.push(Object.fromEntries(i))}),e}_triggerWebAnimation(t,e,i){return t.animate(this._convertKeyframesToObject(e),i)}onStart(t){this._originalOnStartFns.push(t),this._onStartFns.push(t)}onDone(t){this._originalOnDoneFns.push(t),this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(t=>t()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}setPosition(t){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=t*this.time}getPosition(){return this.domPlayer.currentTime/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const t=new Map;this.hasStarted()&&this._finalKeyframe.forEach((i,r)=>{"offset"!==r&&t.set(r,this._finished?i:GR(this.element,r))}),this.currentSnapshot=t}triggerCallback(t){const e="start"===t?this._onStartFns:this._onDoneFns;e.forEach(i=>i()),e.length=0}}class X5{validateStyleProperty(t){return!0}validateAnimatableStyleProperty(t){return!0}matchesElement(t,e){return!1}containsElement(t,e){return OR(t,e)}getParentElement(t){return ST(t)}query(t,e,i){return FR(t,e,i)}computeStyle(t,e,i){return window.getComputedStyle(t)[e]}animate(t,e,i,r,s,d=[]){const y={duration:i,delay:r,fill:0==r?"both":"forwards"};s&&(y.easing=s);const C=new Map,M=d.filter(q=>q instanceof sP);(function K4(n,t){return 0===n||0===t})(i,r)&&M.forEach(q=>{q.currentSnapshot.forEach((Q,xe)=>C.set(xe,Q))});let k=function W4(n){return n.length?n[0]instanceof Map?n:n.map(t=>VR(t)):[]}(e).map(q=>Sp(q));k=function Q4(n,t,e){if(e.size&&t.length){let i=t[0],r=[];if(e.forEach((s,d)=>{i.has(d)||r.push(d),i.set(d,s)}),r.length)for(let s=1;s<t.length;s++){let d=t[s];r.forEach(m=>d.set(m,GR(n,m)))}}return t}(t,k,C);const z=function G5(n,t){let e=null,i=null;return Array.isArray(t)&&t.length?(e=jT(t[0]),t.length>1&&(i=jT(t[t.length-1]))):t instanceof Map&&(e=jT(t)),e||i?new q5(n,e,i):null}(t,k);return new sP(t,k,y,z)}}let Z5=(()=>{class n extends CR{constructor(e,i){super(),this._nextAnimationId=0,this._renderer=e.createRenderer(i.body,{id:"0",encapsulation:qs.None,styles:[],data:{animation:[]}})}build(e){const i=this._nextAnimationId.toString();this._nextAnimationId++;const r=Array.isArray(e)?ER(e):e;return aP(this._renderer,null,i,"register",[r]),new Y5(i,this._renderer)}}return n.\u0275fac=function(e){return new(e||n)(ze(jf),ze($n))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})();class Y5 extends class o4{}{constructor(t,e){super(),this._id=t,this._renderer=e}create(t,e){return new K5(this._id,t,e||{},this._renderer)}}class K5{constructor(t,e,i,r){this.id=t,this.element=e,this._renderer=r,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",i)}_listen(t,e){return this._renderer.listen(this.element,`@@${this.id}:${t}`,e)}_command(t,...e){return aP(this._renderer,this.element,this.id,t,e)}onDone(t){this._listen("done",t)}onStart(t){this._listen("start",t)}onDestroy(t){this._listen("destroy",t)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset"),this._started=!1}setPosition(t){this._command("setPosition",t)}getPosition(){var t,e;return null!==(e=null===(t=this._renderer.engine.players[+this.id])||void 0===t?void 0:t.getPosition())&&void 0!==e?e:0}}function aP(n,t,e,i,r){return n.setProperty(t,`@@${e}:${i}`,r)}const lP="@.disabled";let Q5=(()=>{class n{constructor(e,i,r){this.delegate=e,this.engine=i,this._zone=r,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,this.promise=Promise.resolve(0),i.onRemovalComplete=(s,d)=>{const m=null==d?void 0:d.parentNode(s);m&&d.removeChild(m,s)}}createRenderer(e,i){const s=this.delegate.createRenderer(e,i);if(!(e&&i&&i.data&&i.data.animation)){let M=this._rendererCache.get(s);return M||(M=new cP("",s,this.engine,()=>this._rendererCache.delete(s)),this._rendererCache.set(s,M)),M}const d=i.id,m=i.id+"-"+this._currentId;this._currentId++,this.engine.register(m,e);const y=M=>{Array.isArray(M)?M.forEach(y):this.engine.registerTrigger(d,m,e,M.name,M)};return i.data.animation.forEach(y),new J5(this,m,s,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){this.promise.then(()=>{this._microtaskId++})}scheduleListenerCallback(e,i,r){e>=0&&e<this._microtaskId?this._zone.run(()=>i(r)):(0==this._animationCallbacksBuffer.length&&Promise.resolve(null).then(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(s=>{const[d,m]=s;d(m)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([i,r]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}return n.\u0275fac=function(e){return new(e||n)(ze(jf),ze(sw),ze(qn))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})();class cP{constructor(t,e,i,r){this.namespaceId=t,this.delegate=e,this.engine=i,this._onDestroy=r,this.destroyNode=this.delegate.destroyNode?s=>e.destroyNode(s):null}get data(){return this.delegate.data}destroy(){var t;this.engine.destroy(this.namespaceId,this.delegate),this.delegate.destroy(),null===(t=this._onDestroy)||void 0===t||t.call(this)}createElement(t,e){return this.delegate.createElement(t,e)}createComment(t){return this.delegate.createComment(t)}createText(t){return this.delegate.createText(t)}appendChild(t,e){this.delegate.appendChild(t,e),this.engine.onInsert(this.namespaceId,e,t,!1)}insertBefore(t,e,i,r=!0){this.delegate.insertBefore(t,e,i),this.engine.onInsert(this.namespaceId,e,t,r)}removeChild(t,e,i){this.engine.onRemove(this.namespaceId,e,this.delegate,i)}selectRootElement(t,e){return this.delegate.selectRootElement(t,e)}parentNode(t){return this.delegate.parentNode(t)}nextSibling(t){return this.delegate.nextSibling(t)}setAttribute(t,e,i,r){this.delegate.setAttribute(t,e,i,r)}removeAttribute(t,e,i){this.delegate.removeAttribute(t,e,i)}addClass(t,e){this.delegate.addClass(t,e)}removeClass(t,e){this.delegate.removeClass(t,e)}setStyle(t,e,i,r){this.delegate.setStyle(t,e,i,r)}removeStyle(t,e,i){this.delegate.removeStyle(t,e,i)}setProperty(t,e,i){"@"==e.charAt(0)&&e==lP?this.disableAnimations(t,!!i):this.delegate.setProperty(t,e,i)}setValue(t,e){this.delegate.setValue(t,e)}listen(t,e,i){return this.delegate.listen(t,e,i)}disableAnimations(t,e){this.engine.disableAnimations(t,e)}}class J5 extends cP{constructor(t,e,i,r,s){super(e,i,r,s),this.factory=t,this.namespaceId=e}setProperty(t,e,i){"@"==e.charAt(0)?"."==e.charAt(1)&&e==lP?this.disableAnimations(t,i=void 0===i||!!i):this.engine.process(this.namespaceId,t,e.slice(1),i):this.delegate.setProperty(t,e,i)}listen(t,e,i){if("@"==e.charAt(0)){const r=function eU(n){switch(n){case"body":return document.body;case"document":return document;case"window":return window;default:return n}}(t);let s=e.slice(1),d="";return"@"!=s.charAt(0)&&([s,d]=function tU(n){const t=n.indexOf(".");return[n.substring(0,t),n.slice(t+1)]}(s)),this.engine.listen(this.namespaceId,r,s,d,m=>{this.factory.scheduleListenerCallback(m._data||-1,i,m)})}return this.delegate.listen(t,e,i)}}const uP=[{provide:CR,useClass:Z5},{provide:OT,useFactory:function iU(){return new w5}},{provide:sw,useClass:(()=>{class n extends sw{constructor(e,i,r,s){super(e.body,i,r)}ngOnDestroy(){this.flush()}}return n.\u0275fac=function(e){return new(e||n)(ze($n),ze(CT),ze(OT),ze(Cb))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})()},{provide:jf,useFactory:function rU(n,t,e){return new Q5(n,t,e)},deps:[Gx,sw,qn]}],UT=[{provide:CT,useFactory:()=>new X5},{provide:Qu,useValue:"BrowserAnimations"},...uP],dP=[{provide:CT,useClass:NR},{provide:Qu,useValue:"NoopAnimations"},...uP];let oU=(()=>{class n{static withConfig(e){return{ngModule:n,providers:e.disableAnimations?dP:UT}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({providers:UT,imports:[_R]}),n})();function Rn(...n){return eo(n,kc(n))}function Cp(n,t){return be(t)?Gn(n,t,1):Gn(n,1)}function Cr(n,t){return Di((e,i)=>{let r=0;e.subscribe(Ci(i,s=>n.call(t,s,r++)&&i.next(s)))})}class hP{}class pP{}class ch{constructor(t){this.normalizedNames=new Map,this.lazyUpdate=null,t?this.lazyInit="string"==typeof t?()=>{this.headers=new Map,t.split("\n").forEach(e=>{const i=e.indexOf(":");if(i>0){const r=e.slice(0,i),s=r.toLowerCase(),d=e.slice(i+1).trim();this.maybeSetNormalizedName(r,s),this.headers.has(s)?this.headers.get(s).push(d):this.headers.set(s,[d])}})}:()=>{this.headers=new Map,Object.keys(t).forEach(e=>{let i=t[e];const r=e.toLowerCase();"string"==typeof i&&(i=[i]),i.length>0&&(this.headers.set(r,i),this.maybeSetNormalizedName(e,r))})}:this.headers=new Map}has(t){return this.init(),this.headers.has(t.toLowerCase())}get(t){this.init();const e=this.headers.get(t.toLowerCase());return e&&e.length>0?e[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(t){return this.init(),this.headers.get(t.toLowerCase())||null}append(t,e){return this.clone({name:t,value:e,op:"a"})}set(t,e){return this.clone({name:t,value:e,op:"s"})}delete(t,e){return this.clone({name:t,value:e,op:"d"})}maybeSetNormalizedName(t,e){this.normalizedNames.has(e)||this.normalizedNames.set(e,t)}init(){this.lazyInit&&(this.lazyInit instanceof ch?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(t=>this.applyUpdate(t)),this.lazyUpdate=null))}copyFrom(t){t.init(),Array.from(t.headers.keys()).forEach(e=>{this.headers.set(e,t.headers.get(e)),this.normalizedNames.set(e,t.normalizedNames.get(e))})}clone(t){const e=new ch;return e.lazyInit=this.lazyInit&&this.lazyInit instanceof ch?this.lazyInit:this,e.lazyUpdate=(this.lazyUpdate||[]).concat([t]),e}applyUpdate(t){const e=t.name.toLowerCase();switch(t.op){case"a":case"s":let i=t.value;if("string"==typeof i&&(i=[i]),0===i.length)return;this.maybeSetNormalizedName(t.name,e);const r=("a"===t.op?this.headers.get(e):void 0)||[];r.push(...i),this.headers.set(e,r);break;case"d":const s=t.value;if(s){let d=this.headers.get(e);if(!d)return;d=d.filter(m=>-1===s.indexOf(m)),0===d.length?(this.headers.delete(e),this.normalizedNames.delete(e)):this.headers.set(e,d)}else this.headers.delete(e),this.normalizedNames.delete(e)}}forEach(t){this.init(),Array.from(this.normalizedNames.keys()).forEach(e=>t(this.normalizedNames.get(e),this.headers.get(e)))}}class sU{encodeKey(t){return fP(t)}encodeValue(t){return fP(t)}decodeKey(t){return decodeURIComponent(t)}decodeValue(t){return decodeURIComponent(t)}}const lU=/%(\d[a-f0-9])/gi,cU={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function fP(n){return encodeURIComponent(n).replace(lU,(t,e)=>{var i;return null!==(i=cU[e])&&void 0!==i?i:t})}function lw(n){return`${n}`}class Tp{constructor(t={}){if(this.updates=null,this.cloneFrom=null,this.encoder=t.encoder||new sU,t.fromString){if(t.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function aU(n,t){const e=new Map;return n.length>0&&n.replace(/^\?/,"").split("&").forEach(r=>{const s=r.indexOf("="),[d,m]=-1==s?[t.decodeKey(r),""]:[t.decodeKey(r.slice(0,s)),t.decodeValue(r.slice(s+1))],y=e.get(d)||[];y.push(m),e.set(d,y)}),e}(t.fromString,this.encoder)}else t.fromObject?(this.map=new Map,Object.keys(t.fromObject).forEach(e=>{const i=t.fromObject[e],r=Array.isArray(i)?i.map(lw):[lw(i)];this.map.set(e,r)})):this.map=null}has(t){return this.init(),this.map.has(t)}get(t){this.init();const e=this.map.get(t);return e?e[0]:null}getAll(t){return this.init(),this.map.get(t)||null}keys(){return this.init(),Array.from(this.map.keys())}append(t,e){return this.clone({param:t,value:e,op:"a"})}appendAll(t){const e=[];return Object.keys(t).forEach(i=>{const r=t[i];Array.isArray(r)?r.forEach(s=>{e.push({param:i,value:s,op:"a"})}):e.push({param:i,value:r,op:"a"})}),this.clone(e)}set(t,e){return this.clone({param:t,value:e,op:"s"})}delete(t,e){return this.clone({param:t,value:e,op:"d"})}toString(){return this.init(),this.keys().map(t=>{const e=this.encoder.encodeKey(t);return this.map.get(t).map(i=>e+"="+this.encoder.encodeValue(i)).join("&")}).filter(t=>""!==t).join("&")}clone(t){const e=new Tp({encoder:this.encoder});return e.cloneFrom=this.cloneFrom||this,e.updates=(this.updates||[]).concat(t),e}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(t=>this.map.set(t,this.cloneFrom.map.get(t))),this.updates.forEach(t=>{switch(t.op){case"a":case"s":const e=("a"===t.op?this.map.get(t.param):void 0)||[];e.push(lw(t.value)),this.map.set(t.param,e);break;case"d":if(void 0===t.value){this.map.delete(t.param);break}{let i=this.map.get(t.param)||[];const r=i.indexOf(lw(t.value));-1!==r&&i.splice(r,1),i.length>0?this.map.set(t.param,i):this.map.delete(t.param)}}}),this.cloneFrom=this.updates=null)}}class uU{constructor(){this.map=new Map}set(t,e){return this.map.set(t,e),this}get(t){return this.map.has(t)||this.map.set(t,t.defaultValue()),this.map.get(t)}delete(t){return this.map.delete(t),this}has(t){return this.map.has(t)}keys(){return this.map.keys()}}function mP(n){return"undefined"!=typeof ArrayBuffer&&n instanceof ArrayBuffer}function gP(n){return"undefined"!=typeof Blob&&n instanceof Blob}function bP(n){return"undefined"!=typeof FormData&&n instanceof FormData}class Jy{constructor(t,e,i,r){let s;if(this.url=e,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=t.toUpperCase(),function dU(n){switch(n){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||r?(this.body=void 0!==i?i:null,s=r):s=i,s&&(this.reportProgress=!!s.reportProgress,this.withCredentials=!!s.withCredentials,s.responseType&&(this.responseType=s.responseType),s.headers&&(this.headers=s.headers),s.context&&(this.context=s.context),s.params&&(this.params=s.params)),this.headers||(this.headers=new ch),this.context||(this.context=new uU),this.params){const d=this.params.toString();if(0===d.length)this.urlWithParams=e;else{const m=e.indexOf("?");this.urlWithParams=e+(-1===m?"?":m<e.length-1?"&":"")+d}}else this.params=new Tp,this.urlWithParams=e}serializeBody(){return null===this.body?null:mP(this.body)||gP(this.body)||bP(this.body)||function hU(n){return"undefined"!=typeof URLSearchParams&&n instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof Tp?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||bP(this.body)?null:gP(this.body)?this.body.type||null:mP(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Tp?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(t={}){var e;const i=t.method||this.method,r=t.url||this.url,s=t.responseType||this.responseType,d=void 0!==t.body?t.body:this.body,m=void 0!==t.withCredentials?t.withCredentials:this.withCredentials,y=void 0!==t.reportProgress?t.reportProgress:this.reportProgress;let C=t.headers||this.headers,M=t.params||this.params;const k=null!==(e=t.context)&&void 0!==e?e:this.context;return void 0!==t.setHeaders&&(C=Object.keys(t.setHeaders).reduce((z,q)=>z.set(q,t.setHeaders[q]),C)),t.setParams&&(M=Object.keys(t.setParams).reduce((z,q)=>z.set(q,t.setParams[q]),M)),new Jy(i,r,d,{params:M,headers:C,context:k,reportProgress:y,responseType:s,withCredentials:m})}}var as=(()=>((as=as||{})[as.Sent=0]="Sent",as[as.UploadProgress=1]="UploadProgress",as[as.ResponseHeader=2]="ResponseHeader",as[as.DownloadProgress=3]="DownloadProgress",as[as.Response=4]="Response",as[as.User=5]="User",as))();class HT{constructor(t,e=200,i="OK"){this.headers=t.headers||new ch,this.status=void 0!==t.status?t.status:e,this.statusText=t.statusText||i,this.url=t.url||null,this.ok=this.status>=200&&this.status<300}}class $T extends HT{constructor(t={}){super(t),this.type=as.ResponseHeader}clone(t={}){return new $T({headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class cw extends HT{constructor(t={}){super(t),this.type=as.Response,this.body=void 0!==t.body?t.body:null}clone(t={}){return new cw({body:void 0!==t.body?t.body:this.body,headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class _P extends HT{constructor(t){super(t,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${t.url||"(unknown url)"}`:`Http failure response for ${t.url||"(unknown url)"}: ${t.status} ${t.statusText}`,this.error=t.error||null}}function GT(n,t){return{body:t,headers:n.headers,context:n.context,observe:n.observe,params:n.params,reportProgress:n.reportProgress,responseType:n.responseType,withCredentials:n.withCredentials}}let yP=(()=>{class n{constructor(e){this.handler=e}request(e,i,r={}){let s;if(e instanceof Jy)s=e;else{let y,C;y=r.headers instanceof ch?r.headers:new ch(r.headers),r.params&&(C=r.params instanceof Tp?r.params:new Tp({fromObject:r.params})),s=new Jy(e,i,void 0!==r.body?r.body:null,{headers:y,context:r.context,params:C,reportProgress:r.reportProgress,responseType:r.responseType||"json",withCredentials:r.withCredentials})}const d=Rn(s).pipe(Cp(y=>this.handler.handle(y)));if(e instanceof Jy||"events"===r.observe)return d;const m=d.pipe(Cr(y=>y instanceof cw));switch(r.observe||"body"){case"body":switch(s.responseType){case"arraybuffer":return m.pipe(W(y=>{if(null!==y.body&&!(y.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return y.body}));case"blob":return m.pipe(W(y=>{if(null!==y.body&&!(y.body instanceof Blob))throw new Error("Response is not a Blob.");return y.body}));case"text":return m.pipe(W(y=>{if(null!==y.body&&"string"!=typeof y.body)throw new Error("Response is not a string.");return y.body}));default:return m.pipe(W(y=>y.body))}case"response":return m;default:throw new Error(`Unreachable: unhandled observe type ${r.observe}}`)}}delete(e,i={}){return this.request("DELETE",e,i)}get(e,i={}){return this.request("GET",e,i)}head(e,i={}){return this.request("HEAD",e,i)}jsonp(e,i){return this.request("JSONP",e,{params:(new Tp).append(i,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(e,i={}){return this.request("OPTIONS",e,i)}patch(e,i,r={}){return this.request("PATCH",e,GT(r,i))}post(e,i,r={}){return this.request("POST",e,GT(r,i))}put(e,i,r={}){return this.request("PUT",e,GT(r,i))}}return n.\u0275fac=function(e){return new(e||n)(ze(hP))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})();class vP{constructor(t,e){this.next=t,this.interceptor=e}handle(t){return this.interceptor.intercept(t,this.next)}}const xP=new Et("HTTP_INTERCEPTORS");let pU=(()=>{class n{intercept(e,i){return i.handle(e)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})();const fU=/^\)\]\}',?\n/;let wP=(()=>{class n{constructor(e){this.xhrFactory=e}handle(e){if("JSONP"===e.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new kt(i=>{const r=this.xhrFactory.build();if(r.open(e.method,e.urlWithParams),e.withCredentials&&(r.withCredentials=!0),e.headers.forEach((q,Q)=>r.setRequestHeader(q,Q.join(","))),e.headers.has("Accept")||r.setRequestHeader("Accept","application/json, text/plain, */*"),!e.headers.has("Content-Type")){const q=e.detectContentTypeHeader();null!==q&&r.setRequestHeader("Content-Type",q)}if(e.responseType){const q=e.responseType.toLowerCase();r.responseType="json"!==q?q:"text"}const s=e.serializeBody();let d=null;const m=()=>{if(null!==d)return d;const q=r.statusText||"OK",Q=new ch(r.getAllResponseHeaders()),xe=function mU(n){return"responseURL"in n&&n.responseURL?n.responseURL:/^X-Request-URL:/m.test(n.getAllResponseHeaders())?n.getResponseHeader("X-Request-URL"):null}(r)||e.url;return d=new $T({headers:Q,status:r.status,statusText:q,url:xe}),d},y=()=>{let{headers:q,status:Q,statusText:xe,url:De}=m(),Ze=null;204!==Q&&(Ze=void 0===r.response?r.responseText:r.response),0===Q&&(Q=Ze?200:0);let It=Q>=200&&Q<300;if("json"===e.responseType&&"string"==typeof Ze){const ut=Ze;Ze=Ze.replace(fU,"");try{Ze=""!==Ze?JSON.parse(Ze):null}catch(Ht){Ze=ut,It&&(It=!1,Ze={error:Ht,text:Ze})}}It?(i.next(new cw({body:Ze,headers:q,status:Q,statusText:xe,url:De||void 0})),i.complete()):i.error(new _P({error:Ze,headers:q,status:Q,statusText:xe,url:De||void 0}))},C=q=>{const{url:Q}=m(),xe=new _P({error:q,status:r.status||0,statusText:r.statusText||"Unknown Error",url:Q||void 0});i.error(xe)};let M=!1;const k=q=>{M||(i.next(m()),M=!0);let Q={type:as.DownloadProgress,loaded:q.loaded};q.lengthComputable&&(Q.total=q.total),"text"===e.responseType&&!!r.responseText&&(Q.partialText=r.responseText),i.next(Q)},z=q=>{let Q={type:as.UploadProgress,loaded:q.loaded};q.lengthComputable&&(Q.total=q.total),i.next(Q)};return r.addEventListener("load",y),r.addEventListener("error",C),r.addEventListener("timeout",C),r.addEventListener("abort",C),e.reportProgress&&(r.addEventListener("progress",k),null!==s&&r.upload&&r.upload.addEventListener("progress",z)),r.send(s),i.next({type:as.Sent}),()=>{r.removeEventListener("error",C),r.removeEventListener("abort",C),r.removeEventListener("load",y),r.removeEventListener("timeout",C),e.reportProgress&&(r.removeEventListener("progress",k),null!==s&&r.upload&&r.upload.removeEventListener("progress",z)),r.readyState!==r.DONE&&r.abort()}})}}return n.\u0275fac=function(e){return new(e||n)(ze(Qk))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})();const qT=new Et("XSRF_COOKIE_NAME"),WT=new Et("XSRF_HEADER_NAME");class SP{}let gU=(()=>{class n{constructor(e,i,r){this.doc=e,this.platform=i,this.cookieName=r,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const e=this.doc.cookie||"";return e!==this.lastCookieString&&(this.parseCount++,this.lastToken=Vk(e,this.cookieName),this.lastCookieString=e),this.lastToken}}return n.\u0275fac=function(e){return new(e||n)(ze($n),ze(wx),ze(qT))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})(),XT=(()=>{class n{constructor(e,i){this.tokenService=e,this.headerName=i}intercept(e,i){const r=e.url.toLowerCase();if("GET"===e.method||"HEAD"===e.method||r.startsWith("http://")||r.startsWith("https://"))return i.handle(e);const s=this.tokenService.getToken();return null!==s&&!e.headers.has(this.headerName)&&(e=e.clone({headers:e.headers.set(this.headerName,s)})),i.handle(e)}}return n.\u0275fac=function(e){return new(e||n)(ze(SP),ze(WT))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})(),bU=(()=>{class n{constructor(e,i){this.backend=e,this.injector=i,this.chain=null}handle(e){if(null===this.chain){const i=this.injector.get(xP,[]);this.chain=i.reduceRight((r,s)=>new vP(r,s),this.backend)}return this.chain.handle(e)}}return n.\u0275fac=function(e){return new(e||n)(ze(pP),ze(Nr))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})(),_U=(()=>{class n{static disable(){return{ngModule:n,providers:[{provide:XT,useClass:pU}]}}static withOptions(e={}){return{ngModule:n,providers:[e.cookieName?{provide:qT,useValue:e.cookieName}:[],e.headerName?{provide:WT,useValue:e.headerName}:[]]}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({providers:[XT,{provide:xP,useExisting:XT,multi:!0},{provide:SP,useClass:gU},{provide:qT,useValue:"XSRF-TOKEN"},{provide:WT,useValue:"X-XSRF-TOKEN"}]}),n})(),yU=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({providers:[yP,{provide:hP,useClass:bU},wP,{provide:pP,useExisting:wP}],imports:[_U.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]}),n})();const{isArray:vU}=Array,{getPrototypeOf:xU,prototype:wU,keys:SU}=Object;function CP(n){if(1===n.length){const t=n[0];if(vU(t))return{args:t,keys:null};if(function CU(n){return n&&"object"==typeof n&&xU(n)===wU}(t)){const e=SU(t);return{args:e.map(i=>t[i]),keys:e}}}return{args:n,keys:null}}const{isArray:TU}=Array;function ZT(n){return W(t=>function EU(n,t){return TU(t)?n(...t):n(t)}(n,t))}function TP(n,t){return n.reduce((e,i,r)=>(e[i]=t[r],e),{})}function EP(...n){const t=Eh(n),{args:e,keys:i}=CP(n),r=new kt(s=>{const{length:d}=e;if(!d)return void s.complete();const m=new Array(d);let y=d,C=d;for(let M=0;M<d;M++){let k=!1;Fi(e[M]).subscribe(Ci(s,z=>{k||(k=!0,C--),m[M]=z},()=>y--,void 0,()=>{(!y||!k)&&(C||s.next(i?TP(i,m):m),s.complete())}))}});return t?r.pipe(ZT(t)):r}let DP=(()=>{class n{constructor(e,i){this._renderer=e,this._elementRef=i,this.onChange=r=>{},this.onTouched=()=>{}}setProperty(e,i){this._renderer.setProperty(this._elementRef.nativeElement,e,i)}registerOnTouched(e){this.onTouched=e}registerOnChange(e){this.onChange=e}setDisabledState(e){this.setProperty("disabled",e)}}return n.\u0275fac=function(e){return new(e||n)(G(hc),G(Tn))},n.\u0275dir=Lt({type:n}),n})(),cm=(()=>{class n extends DP{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Vi(n)))(i||n)}}(),n.\u0275dir=Lt({type:n,features:[qt]}),n})();const Ha=new Et("NgValueAccessor"),IU={provide:Ha,useExisting:Ni(()=>id),multi:!0},AU=new Et("CompositionEventMode");let id=(()=>{class n extends DP{constructor(e,i,r){super(e,i),this._compositionMode=r,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function MU(){const n=td()?td().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}())}writeValue(e){this.setProperty("value",null==e?"":e)}_handleInput(e){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(e)}_compositionStart(){this._composing=!0}_compositionEnd(e){this._composing=!1,this._compositionMode&&this.onChange(e)}}return n.\u0275fac=function(e){return new(e||n)(G(hc),G(Tn),G(AU,8))},n.\u0275dir=Lt({type:n,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(e,i){1&e&&Qt("input",function(s){return i._handleInput(s.target.value)})("blur",function(){return i.onTouched()})("compositionstart",function(){return i._compositionStart()})("compositionend",function(s){return i._compositionEnd(s.target.value)})},features:[Vn([IU]),qt]}),n})();function Ep(n){return null==n||("string"==typeof n||Array.isArray(n))&&0===n.length}function MP(n){return null!=n&&"number"==typeof n.length}const Us=new Et("NgValidators"),Dp=new Et("NgAsyncValidators"),RU=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class YT{static min(t){return function AP(n){return t=>{if(Ep(t.value)||Ep(n))return null;const e=parseFloat(t.value);return!isNaN(e)&&e<n?{min:{min:n,actual:t.value}}:null}}(t)}static max(t){return function kP(n){return t=>{if(Ep(t.value)||Ep(n))return null;const e=parseFloat(t.value);return!isNaN(e)&&e>n?{max:{max:n,actual:t.value}}:null}}(t)}static required(t){return RP(t)}static requiredTrue(t){return PP(t)}static email(t){return function LP(n){return Ep(n.value)||RU.test(n.value)?null:{email:!0}}(t)}static minLength(t){return function OP(n){return t=>Ep(t.value)||!MP(t.value)?null:t.value.length<n?{minlength:{requiredLength:n,actualLength:t.value.length}}:null}(t)}static maxLength(t){return function FP(n){return t=>MP(t.value)&&t.value.length>n?{maxlength:{requiredLength:n,actualLength:t.value.length}}:null}(t)}static pattern(t){return function NP(n){if(!n)return uw;let t,e;return"string"==typeof n?(e="","^"!==n.charAt(0)&&(e+="^"),e+=n,"$"!==n.charAt(n.length-1)&&(e+="$"),t=new RegExp(e)):(e=n.toString(),t=n),i=>{if(Ep(i.value))return null;const r=i.value;return t.test(r)?null:{pattern:{requiredPattern:e,actualValue:r}}}}(t)}static nullValidator(t){return null}static compose(t){return HP(t)}static composeAsync(t){return $P(t)}}function RP(n){return Ep(n.value)?{required:!0}:null}function PP(n){return!0===n.value?null:{required:!0}}function uw(n){return null}function BP(n){return null!=n}function zP(n){return Dy(n)?eo(n):n}function VP(n){let t={};return n.forEach(e=>{t=null!=e?Object.assign(Object.assign({},t),e):t}),0===Object.keys(t).length?null:t}function jP(n,t){return t.map(e=>e(n))}function UP(n){return n.map(t=>function PU(n){return!n.validate}(t)?t:e=>t.validate(e))}function HP(n){if(!n)return null;const t=n.filter(BP);return 0==t.length?null:function(e){return VP(jP(e,t))}}function KT(n){return null!=n?HP(UP(n)):null}function $P(n){if(!n)return null;const t=n.filter(BP);return 0==t.length?null:function(e){return EP(jP(e,t).map(zP)).pipe(W(VP))}}function QT(n){return null!=n?$P(UP(n)):null}function GP(n,t){return null===n?[t]:Array.isArray(n)?[...n,t]:[n,t]}function qP(n){return n._rawValidators}function WP(n){return n._rawAsyncValidators}function JT(n){return n?Array.isArray(n)?n:[n]:[]}function dw(n,t){return Array.isArray(n)?n.includes(t):n===t}function XP(n,t){const e=JT(t);return JT(n).forEach(r=>{dw(e,r)||e.push(r)}),e}function ZP(n,t){return JT(t).filter(e=>!dw(n,e))}class YP{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(t){this._rawValidators=t||[],this._composedValidatorFn=KT(this._rawValidators)}_setAsyncValidators(t){this._rawAsyncValidators=t||[],this._composedAsyncValidatorFn=QT(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(t){this._onDestroyCallbacks.push(t)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(t=>t()),this._onDestroyCallbacks=[]}reset(t){this.control&&this.control.reset(t)}hasError(t,e){return!!this.control&&this.control.hasError(t,e)}getError(t,e){return this.control?this.control.getError(t,e):null}}class Hl extends YP{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class $a extends YP{get formDirective(){return null}get path(){return null}}let uh=(()=>{class n extends class KP{constructor(t){this._cd=t}get isTouched(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.touched)}get isUntouched(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.untouched)}get isPristine(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.pristine)}get isDirty(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.dirty)}get isValid(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.valid)}get isInvalid(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.invalid)}get isPending(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.pending)}get isSubmitted(){var t;return!(null===(t=this._cd)||void 0===t||!t.submitted)}}{constructor(e){super(e)}}return n.\u0275fac=function(e){return new(e||n)(G(Hl,2))},n.\u0275dir=Lt({type:n,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(e,i){2&e&&Ri("ng-untouched",i.isUntouched)("ng-touched",i.isTouched)("ng-pristine",i.isPristine)("ng-dirty",i.isDirty)("ng-valid",i.isValid)("ng-invalid",i.isInvalid)("ng-pending",i.isPending)},features:[qt]}),n})();const ev="VALID",pw="INVALID",Ib="PENDING",tv="DISABLED";function iE(n){return(fw(n)?n.validators:n)||null}function JP(n){return Array.isArray(n)?KT(n):n||null}function rE(n,t){return(fw(t)?t.asyncValidators:n)||null}function e2(n){return Array.isArray(n)?QT(n):n||null}function fw(n){return null!=n&&!Array.isArray(n)&&"object"==typeof n}class r2{constructor(t,e){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=t,this._rawAsyncValidators=e,this._composedValidatorFn=JP(this._rawValidators),this._composedAsyncValidatorFn=e2(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(t){this._rawValidators=this._composedValidatorFn=t}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(t){this._rawAsyncValidators=this._composedAsyncValidatorFn=t}get parent(){return this._parent}get valid(){return this.status===ev}get invalid(){return this.status===pw}get pending(){return this.status==Ib}get disabled(){return this.status===tv}get enabled(){return this.status!==tv}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(t){this._rawValidators=t,this._composedValidatorFn=JP(t)}setAsyncValidators(t){this._rawAsyncValidators=t,this._composedAsyncValidatorFn=e2(t)}addValidators(t){this.setValidators(XP(t,this._rawValidators))}addAsyncValidators(t){this.setAsyncValidators(XP(t,this._rawAsyncValidators))}removeValidators(t){this.setValidators(ZP(t,this._rawValidators))}removeAsyncValidators(t){this.setAsyncValidators(ZP(t,this._rawAsyncValidators))}hasValidator(t){return dw(this._rawValidators,t)}hasAsyncValidator(t){return dw(this._rawAsyncValidators,t)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(t={}){this.touched=!0,this._parent&&!t.onlySelf&&this._parent.markAsTouched(t)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(t=>t.markAllAsTouched())}markAsUntouched(t={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(e=>{e.markAsUntouched({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}markAsDirty(t={}){this.pristine=!1,this._parent&&!t.onlySelf&&this._parent.markAsDirty(t)}markAsPristine(t={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(e=>{e.markAsPristine({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}markAsPending(t={}){this.status=Ib,!1!==t.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!t.onlySelf&&this._parent.markAsPending(t)}disable(t={}){const e=this._parentMarkedDirty(t.onlySelf);this.status=tv,this.errors=null,this._forEachChild(i=>{i.disable(Object.assign(Object.assign({},t),{onlySelf:!0}))}),this._updateValue(),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Object.assign(Object.assign({},t),{skipPristineCheck:e})),this._onDisabledChange.forEach(i=>i(!0))}enable(t={}){const e=this._parentMarkedDirty(t.onlySelf);this.status=ev,this._forEachChild(i=>{i.enable(Object.assign(Object.assign({},t),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent}),this._updateAncestors(Object.assign(Object.assign({},t),{skipPristineCheck:e})),this._onDisabledChange.forEach(i=>i(!1))}_updateAncestors(t){this._parent&&!t.onlySelf&&(this._parent.updateValueAndValidity(t),t.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(t){this._parent=t}getRawValue(){return this.value}updateValueAndValidity(t={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===ev||this.status===Ib)&&this._runAsyncValidator(t.emitEvent)),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!t.onlySelf&&this._parent.updateValueAndValidity(t)}_updateTreeValidity(t={emitEvent:!0}){this._forEachChild(e=>e._updateTreeValidity(t)),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?tv:ev}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(t){if(this.asyncValidator){this.status=Ib,this._hasOwnPendingAsyncValidator=!0;const e=zP(this.asyncValidator(this));this._asyncValidationSubscription=e.subscribe(i=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(i,{emitEvent:t})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(t,e={}){this.errors=t,this._updateControlsErrors(!1!==e.emitEvent)}get(t){let e=t;return null==e||(Array.isArray(e)||(e=e.split(".")),0===e.length)?null:e.reduce((i,r)=>i&&i._find(r),this)}getError(t,e){const i=e?this.get(e):this;return i&&i.errors?i.errors[t]:null}hasError(t,e){return!!this.getError(t,e)}get root(){let t=this;for(;t._parent;)t=t._parent;return t}_updateControlsErrors(t){this.status=this._calculateStatus(),t&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(t)}_initObservables(){this.valueChanges=new nn,this.statusChanges=new nn}_calculateStatus(){return this._allControlsDisabled()?tv:this.errors?pw:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Ib)?Ib:this._anyControlsHaveStatus(pw)?pw:ev}_anyControlsHaveStatus(t){return this._anyControls(e=>e.status===t)}_anyControlsDirty(){return this._anyControls(t=>t.dirty)}_anyControlsTouched(){return this._anyControls(t=>t.touched)}_updatePristine(t={}){this.pristine=!this._anyControlsDirty(),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}_updateTouched(t={}){this.touched=this._anyControlsTouched(),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}_registerOnCollectionChange(t){this._onCollectionChange=t}_setUpdateStrategy(t){fw(t)&&null!=t.updateOn&&(this._updateOn=t.updateOn)}_parentMarkedDirty(t){return!t&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(t){return null}}class oE extends r2{constructor(t,e,i){super(iE(e),rE(i,e)),this.controls=t,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(t,e){return this.controls[t]?this.controls[t]:(this.controls[t]=e,e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange),e)}addControl(t,e,i={}){this.registerControl(t,e),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}removeControl(t,e={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}setControl(t,e,i={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],e&&this.registerControl(t,e),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}contains(t){return this.controls.hasOwnProperty(t)&&this.controls[t].enabled}setValue(t,e={}){(function n2(n,t,e){n._forEachChild((i,r)=>{if(void 0===e[r])throw new Ot(1002,"")})})(this,0,t),Object.keys(t).forEach(i=>{(function t2(n,t,e){const i=n.controls;if(!(t?Object.keys(i):i).length)throw new Ot(1e3,"");if(!i[e])throw new Ot(1001,"")})(this,!0,i),this.controls[i].setValue(t[i],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(t,e={}){null!=t&&(Object.keys(t).forEach(i=>{const r=this.controls[i];r&&r.patchValue(t[i],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(t={},e={}){this._forEachChild((i,r)=>{i.reset(t[r],{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e),this._updateTouched(e),this.updateValueAndValidity(e)}getRawValue(){return this._reduceChildren({},(t,e,i)=>(t[i]=e.getRawValue(),t))}_syncPendingControls(){let t=this._reduceChildren(!1,(e,i)=>!!i._syncPendingControls()||e);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_forEachChild(t){Object.keys(this.controls).forEach(e=>{const i=this.controls[e];i&&t(i,e)})}_setUpControls(){this._forEachChild(t=>{t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(t){for(const[e,i]of Object.entries(this.controls))if(this.contains(e)&&t(i))return!0;return!1}_reduceValue(){return this._reduceChildren({},(e,i,r)=>((i.enabled||this.disabled)&&(e[r]=i.value),e))}_reduceChildren(t,e){let i=t;return this._forEachChild((r,s)=>{i=e(i,r,s)}),i}_allControlsDisabled(){for(const t of Object.keys(this.controls))if(this.controls[t].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(t){return this.controls.hasOwnProperty(t)?this.controls[t]:null}}function nv(n,t){var e,i;sE(n,t),t.valueAccessor.writeValue(n.value),n.disabled&&(null===(i=(e=t.valueAccessor).setDisabledState)||void 0===i||i.call(e,!0)),function HU(n,t){t.valueAccessor.registerOnChange(e=>{n._pendingValue=e,n._pendingChange=!0,n._pendingDirty=!0,"change"===n.updateOn&&o2(n,t)})}(n,t),function GU(n,t){const e=(i,r)=>{t.valueAccessor.writeValue(i),r&&t.viewToModelUpdate(i)};n.registerOnChange(e),t._registerOnDestroy(()=>{n._unregisterOnChange(e)})}(n,t),function $U(n,t){t.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,"blur"===n.updateOn&&n._pendingChange&&o2(n,t),"submit"!==n.updateOn&&n.markAsTouched()})}(n,t),function UU(n,t){if(t.valueAccessor.setDisabledState){const e=i=>{t.valueAccessor.setDisabledState(i)};n.registerOnDisabledChange(e),t._registerOnDestroy(()=>{n._unregisterOnDisabledChange(e)})}}(n,t)}function gw(n,t,e=!0){const i=()=>{};t.valueAccessor&&(t.valueAccessor.registerOnChange(i),t.valueAccessor.registerOnTouched(i)),_w(n,t),n&&(t._invokeOnDestroyCallbacks(),n._registerOnCollectionChange(()=>{}))}function bw(n,t){n.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(t)})}function sE(n,t){const e=qP(n);null!==t.validator?n.setValidators(GP(e,t.validator)):"function"==typeof e&&n.setValidators([e]);const i=WP(n);null!==t.asyncValidator?n.setAsyncValidators(GP(i,t.asyncValidator)):"function"==typeof i&&n.setAsyncValidators([i]);const r=()=>n.updateValueAndValidity();bw(t._rawValidators,r),bw(t._rawAsyncValidators,r)}function _w(n,t){let e=!1;if(null!==n){if(null!==t.validator){const r=qP(n);if(Array.isArray(r)&&r.length>0){const s=r.filter(d=>d!==t.validator);s.length!==r.length&&(e=!0,n.setValidators(s))}}if(null!==t.asyncValidator){const r=WP(n);if(Array.isArray(r)&&r.length>0){const s=r.filter(d=>d!==t.asyncValidator);s.length!==r.length&&(e=!0,n.setAsyncValidators(s))}}}const i=()=>{};return bw(t._rawValidators,i),bw(t._rawAsyncValidators,i),e}function o2(n,t){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),t.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function s2(n,t){sE(n,t)}function aE(n,t){if(!n.hasOwnProperty("model"))return!1;const e=n.model;return!!e.isFirstChange()||!Object.is(t,e.currentValue)}function l2(n,t){n._syncPendingControls(),t.forEach(e=>{const i=e.control;"submit"===i.updateOn&&i._pendingChange&&(e.viewToModelUpdate(i._pendingValue),i._pendingChange=!1)})}function lE(n,t){if(!t)return null;let e,i,r;return Array.isArray(t),t.forEach(s=>{s.constructor===id?e=s:function XU(n){return Object.getPrototypeOf(n.constructor)===cm}(s)?i=s:r=s}),r||i||e||null}const YU={provide:$a,useExisting:Ni(()=>Mb)},iv=(()=>Promise.resolve())();let Mb=(()=>{class n extends $a{constructor(e,i){super(),this.submitted=!1,this._directives=new Set,this.ngSubmit=new nn,this.form=new oE({},KT(e),QT(i))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(e){iv.then(()=>{const i=this._findContainer(e.path);e.control=i.registerControl(e.name,e.control),nv(e.control,e),e.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(e)})}getControl(e){return this.form.get(e.path)}removeControl(e){iv.then(()=>{const i=this._findContainer(e.path);i&&i.removeControl(e.name),this._directives.delete(e)})}addFormGroup(e){iv.then(()=>{const i=this._findContainer(e.path),r=new oE({});s2(r,e),i.registerControl(e.name,r),r.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(e){iv.then(()=>{const i=this._findContainer(e.path);i&&i.removeControl(e.name)})}getFormGroup(e){return this.form.get(e.path)}updateModel(e,i){iv.then(()=>{this.form.get(e.path).setValue(i)})}setValue(e){this.control.setValue(e)}onSubmit(e){var i;return this.submitted=!0,l2(this.form,this._directives),this.ngSubmit.emit(e),"dialog"===(null===(i=null==e?void 0:e.target)||void 0===i?void 0:i.method)}onReset(){this.resetForm()}resetForm(e){this.form.reset(e),this.submitted=!1}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(e){return e.pop(),e.length?this.form.get(e):this.form}}return n.\u0275fac=function(e){return new(e||n)(G(Us,10),G(Dp,10))},n.\u0275dir=Lt({type:n,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(e,i){1&e&&Qt("submit",function(s){return i.onSubmit(s)})("reset",function(){return i.onReset()})},inputs:{options:["ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Vn([YU]),qt]}),n})();function c2(n,t){const e=n.indexOf(t);e>-1&&n.splice(e,1)}function u2(n){return"object"==typeof n&&null!==n&&2===Object.keys(n).length&&"value"in n&&"disabled"in n}const yw=class extends r2{constructor(t=null,e,i){super(iE(e),rE(i,e)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(t),this._setUpdateStrategy(e),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),fw(e)&&(e.nonNullable||e.initialValueIsDefault)&&(this.defaultValue=u2(t)?t.value:t)}setValue(t,e={}){this.value=this._pendingValue=t,this._onChange.length&&!1!==e.emitModelToViewChange&&this._onChange.forEach(i=>i(this.value,!1!==e.emitViewToModelChange)),this.updateValueAndValidity(e)}patchValue(t,e={}){this.setValue(t,e)}reset(t=this.defaultValue,e={}){this._applyFormState(t),this.markAsPristine(e),this.markAsUntouched(e),this.setValue(this.value,e),this._pendingChange=!1}_updateValue(){}_anyControls(t){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(t){this._onChange.push(t)}_unregisterOnChange(t){c2(this._onChange,t)}registerOnDisabledChange(t){this._onDisabledChange.push(t)}_unregisterOnDisabledChange(t){c2(this._onDisabledChange,t)}_forEachChild(t){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(t){u2(t)?(this.value=this._pendingValue=t.value,t.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=t}},JU={provide:Hl,useExisting:Ni(()=>Ip)},p2=(()=>Promise.resolve())();let Ip=(()=>{class n extends Hl{constructor(e,i,r,s,d){super(),this._changeDetectorRef=d,this.control=new yw,this._registered=!1,this.update=new nn,this._parent=e,this._setValidators(i),this._setAsyncValidators(r),this.valueAccessor=lE(0,s)}ngOnChanges(e){if(this._checkForErrors(),!this._registered||"name"in e){if(this._registered&&(this._checkName(),this.formDirective)){const i=e.name.previousValue;this.formDirective.removeControl({name:i,path:this._getPath(i)})}this._setUpControl()}"isDisabled"in e&&this._updateDisabled(e),aE(e,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){nv(this.control,this),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(e){p2.then(()=>{var i;this.control.setValue(e,{emitViewToModelChange:!1}),null===(i=this._changeDetectorRef)||void 0===i||i.markForCheck()})}_updateDisabled(e){const i=e.isDisabled.currentValue,r=0!==i&&rh(i);p2.then(()=>{var s;r&&!this.control.disabled?this.control.disable():!r&&this.control.disabled&&this.control.enable(),null===(s=this._changeDetectorRef)||void 0===s||s.markForCheck()})}_getPath(e){return this._parent?function mw(n,t){return[...t.path,n]}(e,this._parent):[e]}}return n.\u0275fac=function(e){return new(e||n)(G($a,9),G(Us,10),G(Dp,10),G(Ha,10),G(Sr,8))},n.\u0275dir=Lt({type:n,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[Vn([JU]),qt,cr]}),n})(),m2=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({}),n})();const cE=new Et("NgModelWithFormControlWarning"),oH={provide:Hl,useExisting:Ni(()=>vw)};let vw=(()=>{class n extends Hl{constructor(e,i,r,s){super(),this._ngModelWarningConfig=s,this.update=new nn,this._ngModelWarningSent=!1,this._setValidators(e),this._setAsyncValidators(i),this.valueAccessor=lE(0,r)}set isDisabled(e){}ngOnChanges(e){if(this._isControlChanged(e)){const i=e.form.previousValue;i&&gw(i,this,!1),nv(this.form,this),this.form.updateValueAndValidity({emitEvent:!1})}aE(e,this.viewModel)&&(this.form.setValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.form&&gw(this.form,this,!1)}get path(){return[]}get control(){return this.form}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_isControlChanged(e){return e.hasOwnProperty("form")}}return n._ngModelWarningSentOnce=!1,n.\u0275fac=function(e){return new(e||n)(G(Us,10),G(Dp,10),G(Ha,10),G(cE,8))},n.\u0275dir=Lt({type:n,selectors:[["","formControl",""]],inputs:{form:["formControl","form"],isDisabled:["disabled","isDisabled"],model:["ngModel","model"]},outputs:{update:"ngModelChange"},exportAs:["ngForm"],features:[Vn([oH]),qt,cr]}),n})();const sH={provide:$a,useExisting:Ni(()=>Ab)};let Ab=(()=>{class n extends $a{constructor(e,i){super(),this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new nn,this._setValidators(e),this._setAsyncValidators(i)}ngOnChanges(e){this._checkFormPresent(),e.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(_w(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(e){const i=this.form.get(e.path);return nv(i,e),i.updateValueAndValidity({emitEvent:!1}),this.directives.push(e),i}getControl(e){return this.form.get(e.path)}removeControl(e){gw(e.control||null,e,!1),function ZU(n,t){const e=n.indexOf(t);e>-1&&n.splice(e,1)}(this.directives,e)}addFormGroup(e){this._setUpFormContainer(e)}removeFormGroup(e){this._cleanUpFormContainer(e)}getFormGroup(e){return this.form.get(e.path)}addFormArray(e){this._setUpFormContainer(e)}removeFormArray(e){this._cleanUpFormContainer(e)}getFormArray(e){return this.form.get(e.path)}updateModel(e,i){this.form.get(e.path).setValue(i)}onSubmit(e){var i;return this.submitted=!0,l2(this.form,this.directives),this.ngSubmit.emit(e),"dialog"===(null===(i=null==e?void 0:e.target)||void 0===i?void 0:i.method)}onReset(){this.resetForm()}resetForm(e){this.form.reset(e),this.submitted=!1}_updateDomValue(){this.directives.forEach(e=>{const i=e.control,r=this.form.get(e.path);i!==r&&(gw(i||null,e),(n=>n instanceof yw)(r)&&(nv(r,e),e.control=r))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(e){const i=this.form.get(e.path);s2(i,e),i.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(e){if(this.form){const i=this.form.get(e.path);i&&function qU(n,t){return _w(n,t)}(i,e)&&i.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){sE(this.form,this),this._oldForm&&_w(this._oldForm,this)}_checkFormPresent(){}}return n.\u0275fac=function(e){return new(e||n)(G(Us,10),G(Dp,10))},n.\u0275dir=Lt({type:n,selectors:[["","formGroup",""]],hostBindings:function(e,i){1&e&&Qt("submit",function(s){return i.onSubmit(s)})("reset",function(){return i.onReset()})},inputs:{form:["formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Vn([sH]),qt,cr]}),n})(),um=(()=>{class n{constructor(){this._validator=uw}ngOnChanges(e){if(this.inputName in e){const i=this.normalizeInput(e[this.inputName].currentValue);this._enabled=this.enabled(i),this._validator=this._enabled?this.createValidator(i):uw,this._onChange&&this._onChange()}}validate(e){return this._validator(e)}registerOnValidatorChange(e){this._onChange=e}enabled(e){return null!=e}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=Lt({type:n,features:[cr]}),n})();const _H={provide:Us,useExisting:Ni(()=>fE),multi:!0},yH={provide:Us,useExisting:Ni(()=>mE),multi:!0};let fE=(()=>{class n extends um{constructor(){super(...arguments),this.inputName="required",this.normalizeInput=rh,this.createValidator=e=>RP}enabled(e){return e}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Vi(n)))(i||n)}}(),n.\u0275dir=Lt({type:n,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(e,i){2&e&&fn("required",i._enabled?"":null)},inputs:{required:"required"},features:[Vn([_H]),qt]}),n})(),mE=(()=>{class n extends fE{constructor(){super(...arguments),this.createValidator=e=>PP}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Vi(n)))(i||n)}}(),n.\u0275dir=Lt({type:n,selectors:[["input","type","checkbox","required","","formControlName",""],["input","type","checkbox","required","","formControl",""],["input","type","checkbox","required","","ngModel",""]],hostVars:1,hostBindings:function(e,i){2&e&&fn("required",i._enabled?"":null)},features:[Vn([yH]),qt]}),n})(),A2=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({imports:[m2]}),n})(),CH=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({imports:[A2]}),n})(),TH=(()=>{class n{static withConfig(e){return{ngModule:n,providers:[{provide:cE,useValue:e.warnOnNgModelWithFormControl}]}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({imports:[A2]}),n})();class ta extends Zt{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){const e=super._subscribe(t);return!e.closed&&t.next(this._value),e}getValue(){const{hasError:t,thrownError:e,_value:i}=this;if(t)throw e;return this._throwIfClosed(),i}next(t){super.next(this._value=t)}}const xw=Me(n=>function(){n(this),this.name="EmptyError",this.message="no elements in sequence"});function dm(...n){const t=kc(n),e=Eh(n),{args:i,keys:r}=CP(n);if(0===i.length)return eo([],t);const s=new kt(function DH(n,t,e=yt){return i=>{k2(t,()=>{const{length:r}=n,s=new Array(r);let d=r,m=r;for(let y=0;y<r;y++)k2(t,()=>{const C=eo(n[y],t);let M=!1;C.subscribe(Ci(i,k=>{s[y]=k,M||(M=!0,m--),m||i.next(e(s.slice()))},()=>{--d||i.complete()}))},i)},i)}}(i,t,r?d=>TP(r,d):yt));return e?s.pipe(ZT(e)):s}function k2(n,t,e){n?_l(e,n,t):t()}function rv(...n){return function IH(){return Xl(1)}()(eo(n,kc(n)))}function hm(n){return new kt(t=>{Fi(n()).subscribe(t)})}function kb(n,t){const e=be(n)?n:()=>n,i=r=>r.error(e());return new kt(t?r=>t.schedule(i,0,r):i)}function gE(){return Di((n,t)=>{let e=null;n._refCount++;const i=Ci(t,void 0,void 0,void 0,()=>{if(!n||n._refCount<=0||0<--n._refCount)return void(e=null);const r=n._connection,s=e;e=null,r&&(!s||r===s)&&r.unsubscribe(),t.unsubscribe()});n.subscribe(i),i.closed||(e=n.connect())})}class bE extends kt{constructor(t,e){super(),this.source=t,this.subjectFactory=e,this._subject=null,this._refCount=0,this._connection=null,go(t)&&(this.lift=t.lift)}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){const t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:t}=this;this._subject=this._connection=null,null==t||t.unsubscribe()}connect(){let t=this._connection;if(!t){t=this._connection=new te;const e=this.getSubject();t.add(this.source.subscribe(Ci(e,void 0,()=>{this._teardown(),e.complete()},i=>{this._teardown(),e.error(i)},()=>this._teardown()))),t.closed&&(this._connection=null,t=te.EMPTY)}return t}refCount(){return gE()(this)}}function na(n,t){return Di((e,i)=>{let r=null,s=0,d=!1;const m=()=>d&&!r&&i.complete();e.subscribe(Ci(i,y=>{null==r||r.unsubscribe();let C=0;const M=s++;Fi(n(y,M)).subscribe(r=Ci(i,k=>i.next(t?t(y,k,M,C++):k),()=>{r=null,m()}))},()=>{d=!0,m()}))})}function Vr(n){return n<=0?()=>ps:Di((t,e)=>{let i=0;t.subscribe(Ci(e,r=>{++i<=n&&(e.next(r),n<=i&&e.complete())}))})}function Ds(...n){const t=kc(n);return Di((e,i)=>{(t?rv(n,e,t):rv(n,e)).subscribe(i)})}function ww(n){return Di((t,e)=>{let i=!1;t.subscribe(Ci(e,r=>{i=!0,e.next(r)},()=>{i||e.next(n),e.complete()}))})}function R2(n=MH){return Di((t,e)=>{let i=!1;t.subscribe(Ci(e,r=>{i=!0,e.next(r)},()=>i?e.complete():e.error(n())))})}function MH(){return new xw}function Mp(n,t){const e=arguments.length>=2;return i=>i.pipe(n?Cr((r,s)=>n(r,s,i)):yt,Vr(1),e?ww(t):R2(()=>new xw))}function No(n,t,e){const i=be(n)||t||e?{next:n,error:t,complete:e}:n;return i?Di((r,s)=>{var d;null===(d=i.subscribe)||void 0===d||d.call(i);let m=!0;r.subscribe(Ci(s,y=>{var C;null===(C=i.next)||void 0===C||C.call(i,y),s.next(y)},()=>{var y;m=!1,null===(y=i.complete)||void 0===y||y.call(i),s.complete()},y=>{var C;m=!1,null===(C=i.error)||void 0===C||C.call(i,y),s.error(y)},()=>{var y,C;m&&(null===(y=i.unsubscribe)||void 0===y||y.call(i)),null===(C=i.finalize)||void 0===C||C.call(i)}))}):yt}function dh(n){return Di((t,e)=>{let s,i=null,r=!1;i=t.subscribe(Ci(e,void 0,void 0,d=>{s=Fi(n(d,dh(n)(t))),i?(i.unsubscribe(),i=null,s.subscribe(e)):r=!0})),r&&(i.unsubscribe(),i=null,s.subscribe(e))})}function AH(n,t,e,i,r){return(s,d)=>{let m=e,y=t,C=0;s.subscribe(Ci(d,M=>{const k=C++;y=m?n(y,M,k):(m=!0,M),i&&d.next(y)},r&&(()=>{m&&d.next(y),d.complete()})))}}function P2(n,t){return Di(AH(n,t,arguments.length>=2,!0))}function _E(n){return n<=0?()=>ps:Di((t,e)=>{let i=[];t.subscribe(Ci(e,r=>{i.push(r),n<i.length&&i.shift()},()=>{for(const r of i)e.next(r);e.complete()},void 0,()=>{i=null}))})}function L2(n,t){const e=arguments.length>=2;return i=>i.pipe(n?Cr((r,s)=>n(r,s,i)):yt,_E(1),e?ww(t):R2(()=>new xw))}function O2(n,t=!1){return Di((e,i)=>{let r=0;e.subscribe(Ci(i,s=>{const d=n(s,r++);(d||t)&&i.next(s),!d&&i.complete()}))})}function ov(n){return W(()=>n)}function Sw(n){return Di((t,e)=>{try{t.subscribe(e)}finally{e.add(n)}})}const Ji="primary",sv=Symbol("RouteTitle");class kH{constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){const e=this.params[t];return Array.isArray(e)?e[0]:e}return null}getAll(t){if(this.has(t)){const e=this.params[t];return Array.isArray(e)?e:[e]}return[]}get keys(){return Object.keys(this.params)}}function Rb(n){return new kH(n)}function RH(n,t,e){const i=e.path.split("/");if(i.length>n.length||"full"===e.pathMatch&&(t.hasChildren()||i.length<n.length))return null;const r={};for(let s=0;s<i.length;s++){const d=i[s],m=n[s];if(d.startsWith(":"))r[d.substring(1)]=m;else if(d!==m.path)return null}return{consumed:n.slice(0,i.length),posParams:r}}function rd(n,t){const e=n?Object.keys(n):void 0,i=t?Object.keys(t):void 0;if(!e||!i||e.length!=i.length)return!1;let r;for(let s=0;s<e.length;s++)if(r=e[s],!F2(n[r],t[r]))return!1;return!0}function F2(n,t){if(Array.isArray(n)&&Array.isArray(t)){if(n.length!==t.length)return!1;const e=[...n].sort(),i=[...t].sort();return e.every((r,s)=>i[s]===r)}return n===t}function N2(n){return Array.prototype.concat.apply([],n)}function B2(n){return n.length>0?n[n.length-1]:null}function ia(n,t){for(const e in n)n.hasOwnProperty(e)&&t(n[e],e)}function Ap(n){return uC(n)?n:Dy(n)?eo(Promise.resolve(n)):Rn(n)}const OH={exact:function j2(n,t,e){if(!fm(n.segments,t.segments)||!Cw(n.segments,t.segments,e)||n.numberOfChildren!==t.numberOfChildren)return!1;for(const i in t.children)if(!n.children[i]||!j2(n.children[i],t.children[i],e))return!1;return!0},subset:U2},z2={exact:function FH(n,t){return rd(n,t)},subset:function NH(n,t){return Object.keys(t).length<=Object.keys(n).length&&Object.keys(t).every(e=>F2(n[e],t[e]))},ignored:()=>!0};function V2(n,t,e){return OH[e.paths](n.root,t.root,e.matrixParams)&&z2[e.queryParams](n.queryParams,t.queryParams)&&!("exact"===e.fragment&&n.fragment!==t.fragment)}function U2(n,t,e){return H2(n,t,t.segments,e)}function H2(n,t,e,i){if(n.segments.length>e.length){const r=n.segments.slice(0,e.length);return!(!fm(r,e)||t.hasChildren()||!Cw(r,e,i))}if(n.segments.length===e.length){if(!fm(n.segments,e)||!Cw(n.segments,e,i))return!1;for(const r in t.children)if(!n.children[r]||!U2(n.children[r],t.children[r],i))return!1;return!0}{const r=e.slice(0,n.segments.length),s=e.slice(n.segments.length);return!!(fm(n.segments,r)&&Cw(n.segments,r,i)&&n.children[Ji])&&H2(n.children[Ji],t,s,i)}}function Cw(n,t,e){return t.every((i,r)=>z2[e](n[r].parameters,i.parameters))}class pm{constructor(t,e,i){this.root=t,this.queryParams=e,this.fragment=i}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Rb(this.queryParams)),this._queryParamMap}toString(){return VH.serialize(this)}}class rr{constructor(t,e){this.segments=t,this.children=e,this.parent=null,ia(e,(i,r)=>i.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Tw(this)}}class av{constructor(t,e){this.path=t,this.parameters=e}get parameterMap(){return this._parameterMap||(this._parameterMap=Rb(this.parameters)),this._parameterMap}toString(){return W2(this)}}function fm(n,t){return n.length===t.length&&n.every((e,i)=>e.path===t[i].path)}let $2=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Jt({token:n,factory:function(){return new vE},providedIn:"root"}),n})();class vE{parse(t){const e=new ZH(t);return new pm(e.parseRootSegment(),e.parseQueryParams(),e.parseFragment())}serialize(t){const e=`/${lv(t.root,!0)}`,i=function HH(n){const t=Object.keys(n).map(e=>{const i=n[e];return Array.isArray(i)?i.map(r=>`${Ew(e)}=${Ew(r)}`).join("&"):`${Ew(e)}=${Ew(i)}`}).filter(e=>!!e);return t.length?`?${t.join("&")}`:""}(t.queryParams);return`${e}${i}${"string"==typeof t.fragment?`#${function jH(n){return encodeURI(n)}(t.fragment)}`:""}`}}const VH=new vE;function Tw(n){return n.segments.map(t=>W2(t)).join("/")}function lv(n,t){if(!n.hasChildren())return Tw(n);if(t){const e=n.children[Ji]?lv(n.children[Ji],!1):"",i=[];return ia(n.children,(r,s)=>{s!==Ji&&i.push(`${s}:${lv(r,!1)}`)}),i.length>0?`${e}(${i.join("//")})`:e}{const e=function zH(n,t){let e=[];return ia(n.children,(i,r)=>{r===Ji&&(e=e.concat(t(i,r)))}),ia(n.children,(i,r)=>{r!==Ji&&(e=e.concat(t(i,r)))}),e}(n,(i,r)=>r===Ji?[lv(n.children[Ji],!1)]:[`${r}:${lv(i,!1)}`]);return 1===Object.keys(n.children).length&&null!=n.children[Ji]?`${Tw(n)}/${e[0]}`:`${Tw(n)}/(${e.join("//")})`}}function G2(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Ew(n){return G2(n).replace(/%3B/gi,";")}function xE(n){return G2(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Dw(n){return decodeURIComponent(n)}function q2(n){return Dw(n.replace(/\+/g,"%20"))}function W2(n){return`${xE(n.path)}${function UH(n){return Object.keys(n).map(t=>`;${xE(t)}=${xE(n[t])}`).join("")}(n.parameters)}`}const $H=/^[^\/()?;=#]+/;function Iw(n){const t=n.match($H);return t?t[0]:""}const GH=/^[^=?&#]+/,WH=/^[^&#]+/;class ZH{constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new rr([],{}):new rr([],this.parseChildren())}parseQueryParams(){const t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let e={};this.peekStartsWith("/(")&&(this.capture("/"),e=this.parseParens(!0));let i={};return this.peekStartsWith("(")&&(i=this.parseParens(!1)),(t.length>0||Object.keys(e).length>0)&&(i[Ji]=new rr(t,e)),i}parseSegment(){const t=Iw(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new Ot(4009,!1);return this.capture(t),new av(Dw(t),this.parseMatrixParams())}parseMatrixParams(){const t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){const e=Iw(this.remaining);if(!e)return;this.capture(e);let i="";if(this.consumeOptional("=")){const r=Iw(this.remaining);r&&(i=r,this.capture(i))}t[Dw(e)]=Dw(i)}parseQueryParam(t){const e=function qH(n){const t=n.match(GH);return t?t[0]:""}(this.remaining);if(!e)return;this.capture(e);let i="";if(this.consumeOptional("=")){const d=function XH(n){const t=n.match(WH);return t?t[0]:""}(this.remaining);d&&(i=d,this.capture(i))}const r=q2(e),s=q2(i);if(t.hasOwnProperty(r)){let d=t[r];Array.isArray(d)||(d=[d],t[r]=d),d.push(s)}else t[r]=s}parseParens(t){const e={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const i=Iw(this.remaining),r=this.remaining[i.length];if("/"!==r&&")"!==r&&";"!==r)throw new Ot(4010,!1);let s;i.indexOf(":")>-1?(s=i.slice(0,i.indexOf(":")),this.capture(s),this.capture(":")):t&&(s=Ji);const d=this.parseChildren();e[s]=1===Object.keys(d).length?d[Ji]:new rr([],d),this.consumeOptional("//")}return e}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)}capture(t){if(!this.consumeOptional(t))throw new Ot(4011,!1)}}function wE(n){return n.segments.length>0?new rr([],{[Ji]:n}):n}function Mw(n){const t={};for(const i of Object.keys(n.children)){const s=Mw(n.children[i]);(s.segments.length>0||s.hasChildren())&&(t[i]=s)}return function YH(n){if(1===n.numberOfChildren&&n.children[Ji]){const t=n.children[Ji];return new rr(n.segments.concat(t.segments),t.children)}return n}(new rr(n.segments,t))}function mm(n){return n instanceof pm}function JH(n,t,e,i,r){var s;if(0===e.length)return Pb(t.root,t.root,t.root,i,r);const m=function Y2(n){if("string"==typeof n[0]&&1===n.length&&"/"===n[0])return new Z2(!0,0,n);let t=0,e=!1;const i=n.reduce((r,s,d)=>{if("object"==typeof s&&null!=s){if(s.outlets){const m={};return ia(s.outlets,(y,C)=>{m[C]="string"==typeof y?y.split("/"):y}),[...r,{outlets:m}]}if(s.segmentPath)return[...r,s.segmentPath]}return"string"!=typeof s?[...r,s]:0===d?(s.split("/").forEach((m,y)=>{0==y&&"."===m||(0==y&&""===m?e=!0:".."===m?t++:""!=m&&r.push(m))}),r):[...r,s]},[]);return new Z2(e,t,i)}(e);return m.toRoot()?Pb(t.root,t.root,new rr([],{}),i,r):function y(M){var k;const z=function t8(n,t,e,i){if(n.isAbsolute)return new Lb(t.root,!0,0);if(-1===i)return new Lb(e,e===t.root,0);return function K2(n,t,e){let i=n,r=t,s=e;for(;s>r;){if(s-=r,i=i.parent,!i)throw new Ot(4005,!1);r=i.segments.length}return new Lb(i,!1,r-s)}(e,i+(cv(n.commands[0])?0:1),n.numberOfDoubleDots)}(m,t,null===(k=n.snapshot)||void 0===k?void 0:k._urlSegment,M),q=z.processChildren?dv(z.segmentGroup,z.index,m.commands):CE(z.segmentGroup,z.index,m.commands);return Pb(t.root,z.segmentGroup,q,i,r)}(null===(s=n.snapshot)||void 0===s?void 0:s._lastPathIndex)}function cv(n){return"object"==typeof n&&null!=n&&!n.outlets&&!n.segmentPath}function uv(n){return"object"==typeof n&&null!=n&&n.outlets}function Pb(n,t,e,i,r){let d,s={};i&&ia(i,(y,C)=>{s[C]=Array.isArray(y)?y.map(M=>`${M}`):`${y}`}),d=n===t?e:X2(n,t,e);const m=wE(Mw(d));return new pm(m,s,r)}function X2(n,t,e){const i={};return ia(n.children,(r,s)=>{i[s]=r===t?e:X2(r,t,e)}),new rr(n.segments,i)}class Z2{constructor(t,e,i){if(this.isAbsolute=t,this.numberOfDoubleDots=e,this.commands=i,t&&i.length>0&&cv(i[0]))throw new Ot(4003,!1);const r=i.find(uv);if(r&&r!==B2(i))throw new Ot(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Lb{constructor(t,e,i){this.segmentGroup=t,this.processChildren=e,this.index=i}}function CE(n,t,e){if(n||(n=new rr([],{})),0===n.segments.length&&n.hasChildren())return dv(n,t,e);const i=function i8(n,t,e){let i=0,r=t;const s={match:!1,pathIndex:0,commandIndex:0};for(;r<n.segments.length;){if(i>=e.length)return s;const d=n.segments[r],m=e[i];if(uv(m))break;const y=`${m}`,C=i<e.length-1?e[i+1]:null;if(r>0&&void 0===y)break;if(y&&C&&"object"==typeof C&&void 0===C.outlets){if(!J2(y,C,d))return s;i+=2}else{if(!J2(y,{},d))return s;i++}r++}return{match:!0,pathIndex:r,commandIndex:i}}(n,t,e),r=e.slice(i.commandIndex);if(i.match&&i.pathIndex<n.segments.length){const s=new rr(n.segments.slice(0,i.pathIndex),{});return s.children[Ji]=new rr(n.segments.slice(i.pathIndex),n.children),dv(s,0,r)}return i.match&&0===r.length?new rr(n.segments,{}):i.match&&!n.hasChildren()?TE(n,t,e):i.match?dv(n,0,r):TE(n,t,e)}function dv(n,t,e){if(0===e.length)return new rr(n.segments,{});{const i=function n8(n){return uv(n[0])?n[0].outlets:{[Ji]:n}}(e),r={};return ia(i,(s,d)=>{"string"==typeof s&&(s=[s]),null!==s&&(r[d]=CE(n.children[d],t,s))}),ia(n.children,(s,d)=>{void 0===i[d]&&(r[d]=s)}),new rr(n.segments,r)}}function TE(n,t,e){const i=n.segments.slice(0,t);let r=0;for(;r<e.length;){const s=e[r];if(uv(s)){const y=r8(s.outlets);return new rr(i,y)}if(0===r&&cv(e[0])){i.push(new av(n.segments[t].path,Q2(e[0]))),r++;continue}const d=uv(s)?s.outlets[Ji]:`${s}`,m=r<e.length-1?e[r+1]:null;d&&m&&cv(m)?(i.push(new av(d,Q2(m))),r+=2):(i.push(new av(d,{})),r++)}return new rr(i,{})}function r8(n){const t={};return ia(n,(e,i)=>{"string"==typeof e&&(e=[e]),null!==e&&(t[i]=TE(new rr([],{}),0,e))}),t}function Q2(n){const t={};return ia(n,(e,i)=>t[i]=`${e}`),t}function J2(n,t,e){return n==e.path&&rd(t,e.parameters)}class hh{constructor(t,e){this.id=t,this.url=e}}class EE extends hh{constructor(t,e,i="imperative",r=null){super(t,e),this.type=0,this.navigationTrigger=i,this.restoredState=r}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class gm extends hh{constructor(t,e,i){super(t,e),this.urlAfterRedirects=i,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class Aw extends hh{constructor(t,e,i,r){super(t,e),this.reason=i,this.code=r,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class eL extends hh{constructor(t,e,i,r){super(t,e),this.error=i,this.target=r,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class o8 extends hh{constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class s8 extends hh{constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class a8 extends hh{constructor(t,e,i,r,s){super(t,e),this.urlAfterRedirects=i,this.state=r,this.shouldActivate=s,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class l8 extends hh{constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class c8 extends hh{constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class u8{constructor(t){this.route=t,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class d8{constructor(t){this.route=t,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class h8{constructor(t){this.snapshot=t,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class p8{constructor(t){this.snapshot=t,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class f8{constructor(t){this.snapshot=t,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class m8{constructor(t){this.snapshot=t,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class tL{constructor(t,e,i){this.routerEvent=t,this.position=e,this.anchor=i,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class nL{constructor(t){this._root=t}get root(){return this._root.value}parent(t){const e=this.pathFromRoot(t);return e.length>1?e[e.length-2]:null}children(t){const e=DE(t,this._root);return e?e.children.map(i=>i.value):[]}firstChild(t){const e=DE(t,this._root);return e&&e.children.length>0?e.children[0].value:null}siblings(t){const e=IE(t,this._root);return e.length<2?[]:e[e.length-2].children.map(r=>r.value).filter(r=>r!==t)}pathFromRoot(t){return IE(t,this._root).map(e=>e.value)}}function DE(n,t){if(n===t.value)return t;for(const e of t.children){const i=DE(n,e);if(i)return i}return null}function IE(n,t){if(n===t.value)return[t];for(const e of t.children){const i=IE(n,e);if(i.length)return i.unshift(t),i}return[]}class ph{constructor(t,e){this.value=t,this.children=e}toString(){return`TreeNode(${this.value})`}}function Ob(n){const t={};return n&&n.children.forEach(e=>t[e.value.outlet]=e),t}class iL extends nL{constructor(t,e){super(t),this.snapshot=e,ME(this,t)}toString(){return this.snapshot.toString()}}function rL(n,t){const e=function b8(n,t){const d=new kw([],{},{},"",{},Ji,t,null,n.root,-1,{});return new sL("",new ph(d,[]))}(n,t),i=new ta([new av("",{})]),r=new ta({}),s=new ta({}),d=new ta({}),m=new ta(""),y=new bm(i,r,d,m,s,Ji,t,e.root);return y.snapshot=e.root,new iL(new ph(y,[]),e)}class bm{constructor(t,e,i,r,s,d,m,y){var C,M;this.url=t,this.params=e,this.queryParams=i,this.fragment=r,this.data=s,this.outlet=d,this.component=m,this.title=null!==(M=null===(C=this.data)||void 0===C?void 0:C.pipe(W(k=>k[sv])))&&void 0!==M?M:Rn(void 0),this._futureSnapshot=y}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(W(t=>Rb(t)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(W(t=>Rb(t)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function oL(n,t="emptyOnly"){const e=n.pathFromRoot;let i=0;if("always"!==t)for(i=e.length-1;i>=1;){const r=e[i],s=e[i-1];if(r.routeConfig&&""===r.routeConfig.path)i--;else{if(s.component)break;i--}}return function _8(n){return n.reduce((t,e)=>{var i;return{params:Object.assign(Object.assign({},t.params),e.params),data:Object.assign(Object.assign({},t.data),e.data),resolve:Object.assign(Object.assign(Object.assign(Object.assign({},e.data),t.resolve),null===(i=e.routeConfig)||void 0===i?void 0:i.data),e._resolvedData)}},{params:{},data:{},resolve:{}})}(e.slice(i))}class kw{constructor(t,e,i,r,s,d,m,y,C,M,k,z){var q;this.url=t,this.params=e,this.queryParams=i,this.fragment=r,this.data=s,this.outlet=d,this.component=m,this.title=null===(q=this.data)||void 0===q?void 0:q[sv],this.routeConfig=y,this._urlSegment=C,this._lastPathIndex=M,this._correctedLastPathIndex=null!=z?z:M,this._resolve=k}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Rb(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Rb(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(i=>i.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class sL extends nL{constructor(t,e){super(e),this.url=t,ME(this,e)}toString(){return aL(this._root)}}function ME(n,t){t.value._routerState=n,t.children.forEach(e=>ME(n,e))}function aL(n){const t=n.children.length>0?` { ${n.children.map(aL).join(", ")} } `:"";return`${n.value}${t}`}function AE(n){if(n.snapshot){const t=n.snapshot,e=n._futureSnapshot;n.snapshot=e,rd(t.queryParams,e.queryParams)||n.queryParams.next(e.queryParams),t.fragment!==e.fragment&&n.fragment.next(e.fragment),rd(t.params,e.params)||n.params.next(e.params),function PH(n,t){if(n.length!==t.length)return!1;for(let e=0;e<n.length;++e)if(!rd(n[e],t[e]))return!1;return!0}(t.url,e.url)||n.url.next(e.url),rd(t.data,e.data)||n.data.next(e.data)}else n.snapshot=n._futureSnapshot,n.data.next(n._futureSnapshot.data)}function kE(n,t){const e=rd(n.params,t.params)&&function BH(n,t){return fm(n,t)&&n.every((e,i)=>rd(e.parameters,t[i].parameters))}(n.url,t.url);return e&&!(!n.parent!=!t.parent)&&(!n.parent||kE(n.parent,t.parent))}function hv(n,t,e){if(e&&n.shouldReuseRoute(t.value,e.value.snapshot)){const i=e.value;i._futureSnapshot=t.value;const r=function v8(n,t,e){return t.children.map(i=>{for(const r of e.children)if(n.shouldReuseRoute(i.value,r.value.snapshot))return hv(n,i,r);return hv(n,i)})}(n,t,e);return new ph(i,r)}{if(n.shouldAttach(t.value)){const s=n.retrieve(t.value);if(null!==s){const d=s.route;return d.value._futureSnapshot=t.value,d.children=t.children.map(m=>hv(n,m)),d}}const i=function x8(n){return new bm(new ta(n.url),new ta(n.params),new ta(n.queryParams),new ta(n.fragment),new ta(n.data),n.outlet,n.component,n)}(t.value),r=t.children.map(s=>hv(n,s));return new ph(i,r)}}const RE="ngNavigationCancelingError";function lL(n,t){const{redirectTo:e,navigationBehaviorOptions:i}=mm(t)?{redirectTo:t,navigationBehaviorOptions:void 0}:t,r=cL(!1,0,t);return r.url=e,r.navigationBehaviorOptions=i,r}function cL(n,t,e){const i=new Error("NavigationCancelingError: "+(n||""));return i[RE]=!0,i.cancellationCode=t,e&&(i.url=e),i}function uL(n){return dL(n)&&mm(n.url)}function dL(n){return n&&n[RE]}class w8{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.injector=null,this.children=new pv,this.attachRef=null}}let pv=(()=>{class n{constructor(){this.contexts=new Map}onChildOutletCreated(e,i){const r=this.getOrCreateContext(e);r.outlet=i,this.contexts.set(e,r)}onChildOutletDestroyed(e){const i=this.getContext(e);i&&(i.outlet=null,i.attachRef=null)}onOutletDeactivated(){const e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let i=this.getContext(e);return i||(i=new w8,this.contexts.set(e,i)),i}getContext(e){return this.contexts.get(e)||null}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const Rw=!1;let PE=(()=>{class n{constructor(e,i,r,s,d){this.parentContexts=e,this.location=i,this.changeDetector=s,this.environmentInjector=d,this.activated=null,this._activatedRoute=null,this.activateEvents=new nn,this.deactivateEvents=new nn,this.attachEvents=new nn,this.detachEvents=new nn,this.name=r||Ji,e.onChildOutletCreated(this.name,this)}ngOnDestroy(){var e;(null===(e=this.parentContexts.getContext(this.name))||void 0===e?void 0:e.outlet)===this&&this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const e=this.parentContexts.getContext(this.name);e&&e.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.injector))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Ot(4012,Rw);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Ot(4012,Rw);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Ot(4012,Rw);this.location.detach();const e=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(e.instance),e}attach(e,i){this.activated=e,this._activatedRoute=i,this.location.insert(e.hostView),this.attachEvents.emit(e.instance)}deactivate(){if(this.activated){const e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}activateWith(e,i){if(this.isActivated)throw new Ot(4013,Rw);this._activatedRoute=e;const r=this.location,d=e._futureSnapshot.component,m=this.parentContexts.getOrCreateContext(this.name).children,y=new S8(e,m,r.injector);if(i&&function C8(n){return!!n.resolveComponentFactory}(i)){const C=i.resolveComponentFactory(d);this.activated=r.createComponent(C,r.length,y)}else this.activated=r.createComponent(d,{index:r.length,injector:y,environmentInjector:null!=i?i:this.environmentInjector});this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return n.\u0275fac=function(e){return new(e||n)(G(pv),G(Fo),Uo("name"),G(Sr),G(Zc))},n.\u0275dir=Lt({type:n,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0}),n})();class S8{constructor(t,e,i){this.route=t,this.childContexts=e,this.parent=i}get(t,e){return t===bm?this.route:t===pv?this.childContexts:this.parent.get(t,e)}}let LE=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=vn({type:n,selectors:[["ng-component"]],standalone:!0,features:[hA],decls:1,vars:0,template:function(e,i){1&e&&ln(0,"router-outlet")},dependencies:[PE],encapsulation:2}),n})();function hL(n,t){var e;return n.providers&&!n._injector&&(n._injector=gx(n.providers,t,`Route: ${n.path}`)),null!==(e=n._injector)&&void 0!==e?e:t}function FE(n){const t=n.children&&n.children.map(FE),e=t?Object.assign(Object.assign({},n),{children:t}):Object.assign({},n);return!e.component&&!e.loadComponent&&(t||e.loadChildren)&&e.outlet&&e.outlet!==Ji&&(e.component=LE),e}function Ec(n){return n.outlet||Ji}function pL(n,t){const e=n.filter(i=>Ec(i)===t);return e.push(...n.filter(i=>Ec(i)!==t)),e}function fv(n){var t;if(!n)return null;if(null!==(t=n.routeConfig)&&void 0!==t&&t._injector)return n.routeConfig._injector;for(let e=n.parent;e;e=e.parent){const i=e.routeConfig;if(null!=i&&i._loadedInjector)return i._loadedInjector;if(null!=i&&i._injector)return i._injector}return null}class M8{constructor(t,e,i,r){this.routeReuseStrategy=t,this.futureState=e,this.currState=i,this.forwardEvent=r}activate(t){const e=this.futureState._root,i=this.currState?this.currState._root:null;this.deactivateChildRoutes(e,i,t),AE(this.futureState.root),this.activateChildRoutes(e,i,t)}deactivateChildRoutes(t,e,i){const r=Ob(e);t.children.forEach(s=>{const d=s.value.outlet;this.deactivateRoutes(s,r[d],i),delete r[d]}),ia(r,(s,d)=>{this.deactivateRouteAndItsChildren(s,i)})}deactivateRoutes(t,e,i){const r=t.value,s=e?e.value:null;if(r===s)if(r.component){const d=i.getContext(r.outlet);d&&this.deactivateChildRoutes(t,e,d.children)}else this.deactivateChildRoutes(t,e,i);else s&&this.deactivateRouteAndItsChildren(e,i)}deactivateRouteAndItsChildren(t,e){t.value.component&&this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,e):this.deactivateRouteAndOutlet(t,e)}detachAndStoreRouteSubtree(t,e){const i=e.getContext(t.value.outlet),r=i&&t.value.component?i.children:e,s=Ob(t);for(const d of Object.keys(s))this.deactivateRouteAndItsChildren(s[d],r);if(i&&i.outlet){const d=i.outlet.detach(),m=i.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:d,route:t,contexts:m})}}deactivateRouteAndOutlet(t,e){const i=e.getContext(t.value.outlet),r=i&&t.value.component?i.children:e,s=Ob(t);for(const d of Object.keys(s))this.deactivateRouteAndItsChildren(s[d],r);i&&i.outlet&&(i.outlet.deactivate(),i.children.onOutletDeactivated(),i.attachRef=null,i.resolver=null,i.route=null)}activateChildRoutes(t,e,i){const r=Ob(e);t.children.forEach(s=>{this.activateRoutes(s,r[s.value.outlet],i),this.forwardEvent(new m8(s.value.snapshot))}),t.children.length&&this.forwardEvent(new p8(t.value.snapshot))}activateRoutes(t,e,i){var r;const s=t.value,d=e?e.value:null;if(AE(s),s===d)if(s.component){const m=i.getOrCreateContext(s.outlet);this.activateChildRoutes(t,e,m.children)}else this.activateChildRoutes(t,e,i);else if(s.component){const m=i.getOrCreateContext(s.outlet);if(this.routeReuseStrategy.shouldAttach(s.snapshot)){const y=this.routeReuseStrategy.retrieve(s.snapshot);this.routeReuseStrategy.store(s.snapshot,null),m.children.onOutletReAttached(y.contexts),m.attachRef=y.componentRef,m.route=y.route.value,m.outlet&&m.outlet.attach(y.componentRef,y.route.value),AE(y.route.value),this.activateChildRoutes(t,null,m.children)}else{const y=fv(s.snapshot),C=null!==(r=null==y?void 0:y.get(Gd))&&void 0!==r?r:null;m.attachRef=null,m.route=s,m.resolver=C,m.injector=y,m.outlet&&m.outlet.activateWith(s,m.injector),this.activateChildRoutes(t,null,m.children)}}else this.activateChildRoutes(t,null,i)}}class fL{constructor(t){this.path=t,this.route=this.path[this.path.length-1]}}class Pw{constructor(t,e){this.component=t,this.route=e}}function A8(n,t,e){const i=n._root;return mv(i,t?t._root:null,e,[i.value])}function Fb(n,t){const e=Symbol(),i=t.get(n,e);return i===e?"function"!=typeof n||function mu(n){return null!==fu(n)}(n)?t.get(n):n:i}function mv(n,t,e,i,r={canDeactivateChecks:[],canActivateChecks:[]}){const s=Ob(t);return n.children.forEach(d=>{(function R8(n,t,e,i,r={canDeactivateChecks:[],canActivateChecks:[]}){const s=n.value,d=t?t.value:null,m=e?e.getContext(n.value.outlet):null;if(d&&s.routeConfig===d.routeConfig){const y=function P8(n,t,e){if("function"==typeof e)return e(n,t);switch(e){case"pathParamsChange":return!fm(n.url,t.url);case"pathParamsOrQueryParamsChange":return!fm(n.url,t.url)||!rd(n.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!kE(n,t)||!rd(n.queryParams,t.queryParams);default:return!kE(n,t)}}(d,s,s.routeConfig.runGuardsAndResolvers);y?r.canActivateChecks.push(new fL(i)):(s.data=d.data,s._resolvedData=d._resolvedData),mv(n,t,s.component?m?m.children:null:e,i,r),y&&m&&m.outlet&&m.outlet.isActivated&&r.canDeactivateChecks.push(new Pw(m.outlet.component,d))}else d&&gv(t,m,r),r.canActivateChecks.push(new fL(i)),mv(n,null,s.component?m?m.children:null:e,i,r)})(d,s[d.value.outlet],e,i.concat([d.value]),r),delete s[d.value.outlet]}),ia(s,(d,m)=>gv(d,e.getContext(m),r)),r}function gv(n,t,e){const i=Ob(n),r=n.value;ia(i,(s,d)=>{gv(s,r.component?t?t.children.getContext(d):null:t,e)}),e.canDeactivateChecks.push(new Pw(r.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,r))}function bv(n){return"function"==typeof n}function NE(n){return n instanceof xw||"EmptyError"===(null==n?void 0:n.name)}const Lw=Symbol("INITIAL_VALUE");function Nb(){return na(n=>dm(n.map(t=>t.pipe(Vr(1),Ds(Lw)))).pipe(W(t=>{for(const e of t)if(!0!==e){if(e===Lw)return Lw;if(!1===e||e instanceof pm)return e}return!0}),Cr(t=>t!==Lw),Vr(1)))}function mL(n){return function Tt(...n){return ri(n)}(No(t=>{if(mm(t))throw lL(0,t)}),W(t=>!0===t))}const BE={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function gL(n,t,e,i,r){const s=zE(n,t,e);return s.matched?function Y8(n,t,e,i){const r=t.canMatch;return r&&0!==r.length?Rn(r.map(d=>{const m=Fb(d,n);return Ap(function z8(n){return n&&bv(n.canMatch)}(m)?m.canMatch(t,e):n.runInContext(()=>m(t,e)))})).pipe(Nb(),mL()):Rn(!0)}(i=hL(t,i),t,e).pipe(W(d=>!0===d?s:Object.assign({},BE))):Rn(s)}function zE(n,t,e){var i;if(""===t.path)return"full"===t.pathMatch&&(n.hasChildren()||e.length>0)?Object.assign({},BE):{matched:!0,consumedSegments:[],remainingSegments:e,parameters:{},positionalParamSegments:{}};const s=(t.matcher||RH)(e,n,t);if(!s)return Object.assign({},BE);const d={};ia(s.posParams,(y,C)=>{d[C]=y.path});const m=s.consumed.length>0?Object.assign(Object.assign({},d),s.consumed[s.consumed.length-1].parameters):d;return{matched:!0,consumedSegments:s.consumed,remainingSegments:e.slice(s.consumed.length),parameters:m,positionalParamSegments:null!==(i=s.posParams)&&void 0!==i?i:{}}}function Ow(n,t,e,i,r="corrected"){if(e.length>0&&function J8(n,t,e){return e.some(i=>Fw(n,t,i)&&Ec(i)!==Ji)}(n,e,i)){const d=new rr(t,function Q8(n,t,e,i){const r={};r[Ji]=i,i._sourceSegment=n,i._segmentIndexShift=t.length;for(const s of e)if(""===s.path&&Ec(s)!==Ji){const d=new rr([],{});d._sourceSegment=n,d._segmentIndexShift=t.length,r[Ec(s)]=d}return r}(n,t,i,new rr(e,n.children)));return d._sourceSegment=n,d._segmentIndexShift=t.length,{segmentGroup:d,slicedSegments:[]}}if(0===e.length&&function e$(n,t,e){return e.some(i=>Fw(n,t,i))}(n,e,i)){const d=new rr(n.segments,function K8(n,t,e,i,r,s){const d={};for(const m of i)if(Fw(n,e,m)&&!r[Ec(m)]){const y=new rr([],{});y._sourceSegment=n,y._segmentIndexShift="legacy"===s?n.segments.length:t.length,d[Ec(m)]=y}return Object.assign(Object.assign({},r),d)}(n,t,e,i,n.children,r));return d._sourceSegment=n,d._segmentIndexShift=t.length,{segmentGroup:d,slicedSegments:e}}const s=new rr(n.segments,n.children);return s._sourceSegment=n,s._segmentIndexShift=t.length,{segmentGroup:s,slicedSegments:e}}function Fw(n,t,e){return(!(n.hasChildren()||t.length>0)||"full"!==e.pathMatch)&&""===e.path}function bL(n,t,e,i){return!!(Ec(n)===i||i!==Ji&&Fw(t,e,n))&&("**"===n.path||zE(t,n,e).matched)}function _L(n,t,e){return 0===t.length&&!n.children[e]}const Nw=!1;class Bw{constructor(t){this.segmentGroup=t||null}}class yL{constructor(t){this.urlTree=t}}function _v(n){return kb(new Bw(n))}function vL(n){return kb(new yL(n))}class r${constructor(t,e,i,r,s){this.injector=t,this.configLoader=e,this.urlSerializer=i,this.urlTree=r,this.config=s,this.allowRedirects=!0}apply(){const t=Ow(this.urlTree.root,[],[],this.config).segmentGroup,e=new rr(t.segments,t.children);return this.expandSegmentGroup(this.injector,this.config,e,Ji).pipe(W(s=>this.createUrlTree(Mw(s),this.urlTree.queryParams,this.urlTree.fragment))).pipe(dh(s=>{if(s instanceof yL)return this.allowRedirects=!1,this.match(s.urlTree);throw s instanceof Bw?this.noMatchError(s):s}))}match(t){return this.expandSegmentGroup(this.injector,this.config,t.root,Ji).pipe(W(r=>this.createUrlTree(Mw(r),t.queryParams,t.fragment))).pipe(dh(r=>{throw r instanceof Bw?this.noMatchError(r):r}))}noMatchError(t){return new Ot(4002,Nw)}createUrlTree(t,e,i){const r=wE(t);return new pm(r,e,i)}expandSegmentGroup(t,e,i,r){return 0===i.segments.length&&i.hasChildren()?this.expandChildren(t,e,i).pipe(W(s=>new rr([],s))):this.expandSegment(t,i,e,i.segments,r,!0)}expandChildren(t,e,i){const r=[];for(const s of Object.keys(i.children))"primary"===s?r.unshift(s):r.push(s);return eo(r).pipe(Cp(s=>{const d=i.children[s],m=pL(e,s);return this.expandSegmentGroup(t,m,d,s).pipe(W(y=>({segment:y,outlet:s})))}),P2((s,d)=>(s[d.outlet]=d.segment,s),{}),L2())}expandSegment(t,e,i,r,s,d){return eo(i).pipe(Cp(m=>this.expandSegmentAgainstRoute(t,e,i,m,r,s,d).pipe(dh(C=>{if(C instanceof Bw)return Rn(null);throw C}))),Mp(m=>!!m),dh((m,y)=>{if(NE(m))return _L(e,r,s)?Rn(new rr([],{})):_v(e);throw m}))}expandSegmentAgainstRoute(t,e,i,r,s,d,m){return bL(r,e,s,d)?void 0===r.redirectTo?this.matchSegmentAgainstRoute(t,e,r,s,d):m&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(t,e,i,r,s,d):_v(e):_v(e)}expandSegmentAgainstRouteUsingRedirect(t,e,i,r,s,d){return"**"===r.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(t,i,r,d):this.expandRegularSegmentAgainstRouteUsingRedirect(t,e,i,r,s,d)}expandWildCardWithParamsAgainstRouteUsingRedirect(t,e,i,r){const s=this.applyRedirectCommands([],i.redirectTo,{});return i.redirectTo.startsWith("/")?vL(s):this.lineralizeSegments(i,s).pipe(Gn(d=>{const m=new rr(d,{});return this.expandSegment(t,m,e,d,r,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(t,e,i,r,s,d){const{matched:m,consumedSegments:y,remainingSegments:C,positionalParamSegments:M}=zE(e,r,s);if(!m)return _v(e);const k=this.applyRedirectCommands(y,r.redirectTo,M);return r.redirectTo.startsWith("/")?vL(k):this.lineralizeSegments(r,k).pipe(Gn(z=>this.expandSegment(t,e,i,z.concat(C),d,!1)))}matchSegmentAgainstRoute(t,e,i,r,s){return"**"===i.path?(t=hL(i,t),i.loadChildren?(i._loadedRoutes?Rn({routes:i._loadedRoutes,injector:i._loadedInjector}):this.configLoader.loadChildren(t,i)).pipe(W(m=>(i._loadedRoutes=m.routes,i._loadedInjector=m.injector,new rr(r,{})))):Rn(new rr(r,{}))):gL(e,i,r,t).pipe(na(({matched:d,consumedSegments:m,remainingSegments:y})=>{var C;return d?(t=null!==(C=i._injector)&&void 0!==C?C:t,this.getChildConfig(t,i,r).pipe(Gn(k=>{var z;const q=null!==(z=k.injector)&&void 0!==z?z:t,Q=k.routes,{segmentGroup:xe,slicedSegments:De}=Ow(e,m,y,Q),Ze=new rr(xe.segments,xe.children);if(0===De.length&&Ze.hasChildren())return this.expandChildren(q,Q,Ze).pipe(W(Mn=>new rr(m,Mn)));if(0===Q.length&&0===De.length)return Rn(new rr(m,{}));const It=Ec(i)===s;return this.expandSegment(q,Ze,Q,De,It?Ji:s,!0).pipe(W(Ht=>new rr(m.concat(Ht.segments),Ht.children)))}))):_v(e)}))}getChildConfig(t,e,i){return e.children?Rn({routes:e.children,injector:t}):e.loadChildren?void 0!==e._loadedRoutes?Rn({routes:e._loadedRoutes,injector:e._loadedInjector}):function Z8(n,t,e,i){const r=t.canLoad;return void 0===r||0===r.length?Rn(!0):Rn(r.map(d=>{const m=Fb(d,n);return Ap(function O8(n){return n&&bv(n.canLoad)}(m)?m.canLoad(t,e):n.runInContext(()=>m(t,e)))})).pipe(Nb(),mL())}(t,e,i).pipe(Gn(r=>r?this.configLoader.loadChildren(t,e).pipe(No(s=>{e._loadedRoutes=s.routes,e._loadedInjector=s.injector})):function n$(n){return kb(cL(Nw,3))}())):Rn({routes:[],injector:t})}lineralizeSegments(t,e){let i=[],r=e.root;for(;;){if(i=i.concat(r.segments),0===r.numberOfChildren)return Rn(i);if(r.numberOfChildren>1||!r.children[Ji])return kb(new Ot(4e3,Nw));r=r.children[Ji]}}applyRedirectCommands(t,e,i){return this.applyRedirectCreateUrlTree(e,this.urlSerializer.parse(e),t,i)}applyRedirectCreateUrlTree(t,e,i,r){const s=this.createSegmentGroup(t,e.root,i,r);return new pm(s,this.createQueryParams(e.queryParams,this.urlTree.queryParams),e.fragment)}createQueryParams(t,e){const i={};return ia(t,(r,s)=>{if("string"==typeof r&&r.startsWith(":")){const m=r.substring(1);i[s]=e[m]}else i[s]=r}),i}createSegmentGroup(t,e,i,r){const s=this.createSegments(t,e.segments,i,r);let d={};return ia(e.children,(m,y)=>{d[y]=this.createSegmentGroup(t,m,i,r)}),new rr(s,d)}createSegments(t,e,i,r){return e.map(s=>s.path.startsWith(":")?this.findPosParam(t,s,r):this.findOrReturn(s,i))}findPosParam(t,e,i){const r=i[e.path.substring(1)];if(!r)throw new Ot(4001,Nw);return r}findOrReturn(t,e){let i=0;for(const r of e){if(r.path===t.path)return e.splice(i),r;i++}return t}}class s${}class c${constructor(t,e,i,r,s,d,m,y){this.injector=t,this.rootComponentType=e,this.config=i,this.urlTree=r,this.url=s,this.paramsInheritanceStrategy=d,this.relativeLinkResolution=m,this.urlSerializer=y}recognize(){const t=Ow(this.urlTree.root,[],[],this.config.filter(e=>void 0===e.redirectTo),this.relativeLinkResolution).segmentGroup;return this.processSegmentGroup(this.injector,this.config,t,Ji).pipe(W(e=>{if(null===e)return null;const i=new kw([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},Ji,this.rootComponentType,null,this.urlTree.root,-1,{}),r=new ph(i,e),s=new sL(this.url,r);return this.inheritParamsAndData(s._root),s}))}inheritParamsAndData(t){const e=t.value,i=oL(e,this.paramsInheritanceStrategy);e.params=Object.freeze(i.params),e.data=Object.freeze(i.data),t.children.forEach(r=>this.inheritParamsAndData(r))}processSegmentGroup(t,e,i,r){return 0===i.segments.length&&i.hasChildren()?this.processChildren(t,e,i):this.processSegment(t,e,i,i.segments,r)}processChildren(t,e,i){return eo(Object.keys(i.children)).pipe(Cp(r=>{const s=i.children[r],d=pL(e,r);return this.processSegmentGroup(t,d,s,r)}),P2((r,s)=>r&&s?(r.push(...s),r):null),O2(r=>null!==r),ww(null),L2(),W(r=>{if(null===r)return null;const s=xL(r);return function u$(n){n.sort((t,e)=>t.value.outlet===Ji?-1:e.value.outlet===Ji?1:t.value.outlet.localeCompare(e.value.outlet))}(s),s}))}processSegment(t,e,i,r,s){return eo(e).pipe(Cp(d=>{var m;return this.processSegmentAgainstRoute(null!==(m=d._injector)&&void 0!==m?m:t,d,i,r,s)}),Mp(d=>!!d),dh(d=>{if(NE(d))return _L(i,r,s)?Rn([]):Rn(null);throw d}))}processSegmentAgainstRoute(t,e,i,r,s){var d,m;if(e.redirectTo||!bL(e,i,r,s))return Rn(null);let y;if("**"===e.path){const C=r.length>0?B2(r).parameters:{},M=SL(i)+r.length;y=Rn({snapshot:new kw(r,C,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,TL(e),Ec(e),null!==(m=null!==(d=e.component)&&void 0!==d?d:e._loadedComponent)&&void 0!==m?m:null,e,wL(i),M,EL(e),M),consumedSegments:[],remainingSegments:[]})}else y=gL(i,e,r,t).pipe(W(({matched:C,consumedSegments:M,remainingSegments:k,parameters:z})=>{var q,Q;if(!C)return null;const xe=SL(i)+M.length;return{snapshot:new kw(M,z,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,TL(e),Ec(e),null!==(Q=null!==(q=e.component)&&void 0!==q?q:e._loadedComponent)&&void 0!==Q?Q:null,e,wL(i),xe,EL(e),xe),consumedSegments:M,remainingSegments:k}}));return y.pipe(na(C=>{var M,k;if(null===C)return Rn(null);const{snapshot:z,consumedSegments:q,remainingSegments:Q}=C;t=null!==(M=e._injector)&&void 0!==M?M:t;const xe=null!==(k=e._loadedInjector)&&void 0!==k?k:t,De=function d$(n){return n.children?n.children:n.loadChildren?n._loadedRoutes:[]}(e),{segmentGroup:Ze,slicedSegments:It}=Ow(i,q,Q,De.filter(Ht=>void 0===Ht.redirectTo),this.relativeLinkResolution);if(0===It.length&&Ze.hasChildren())return this.processChildren(xe,De,Ze).pipe(W(Ht=>null===Ht?null:[new ph(z,Ht)]));if(0===De.length&&0===It.length)return Rn([new ph(z,[])]);const ut=Ec(e)===s;return this.processSegment(xe,De,Ze,It,ut?Ji:s).pipe(W(Ht=>null===Ht?null:[new ph(z,Ht)]))}))}}function h$(n){const t=n.value.routeConfig;return t&&""===t.path&&void 0===t.redirectTo}function xL(n){const t=[],e=new Set;for(const i of n){if(!h$(i)){t.push(i);continue}const r=t.find(s=>i.value.routeConfig===s.value.routeConfig);void 0!==r?(r.children.push(...i.children),e.add(r)):t.push(i)}for(const i of e){const r=xL(i.children);t.push(new ph(i.value,r))}return t.filter(i=>!e.has(i))}function wL(n){let t=n;for(;t._sourceSegment;)t=t._sourceSegment;return t}function SL(n){var t,e;let i=n,r=null!==(t=i._segmentIndexShift)&&void 0!==t?t:0;for(;i._sourceSegment;)i=i._sourceSegment,r+=null!==(e=i._segmentIndexShift)&&void 0!==e?e:0;return r-1}function TL(n){return n.data||{}}function EL(n){return n.resolve||{}}function DL(n){return"string"==typeof n.title||null===n.title}function VE(n){return na(t=>{const e=n(t);return e?eo(e).pipe(W(()=>t)):Rn(t)})}let IL=(()=>{class n{buildTitle(e){var i;let r,s=e.root;for(;void 0!==s;)r=null!==(i=this.getResolvedTitleForRoute(s))&&void 0!==i?i:r,s=s.children.find(d=>d.outlet===Ji);return r}getResolvedTitleForRoute(e){return e.data[sv]}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Jt({token:n,factory:function(){return Fr(ML)},providedIn:"root"}),n})(),ML=(()=>{class n extends IL{constructor(e){super(),this.title=e}updateTitle(e){const i=this.buildTitle(e);void 0!==i&&this.title.setTitle(i)}}return n.\u0275fac=function(e){return new(e||n)(ze(yR))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class v${}class w$ extends class x${shouldDetach(t){return!1}store(t,e){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,e){return t.routeConfig===e.routeConfig}}{}const Vw=new Et("",{providedIn:"root",factory:()=>({})}),jE=new Et("ROUTES");let UE=(()=>{class n{constructor(e,i){this.injector=e,this.compiler=i,this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap}loadComponent(e){if(this.componentLoaders.get(e))return this.componentLoaders.get(e);if(e._loadedComponent)return Rn(e._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(e);const i=Ap(e.loadComponent()).pipe(No(s=>{this.onLoadEndListener&&this.onLoadEndListener(e),e._loadedComponent=s}),Sw(()=>{this.componentLoaders.delete(e)})),r=new bE(i,()=>new Zt).pipe(gE());return this.componentLoaders.set(e,r),r}loadChildren(e,i){if(this.childrenLoaders.get(i))return this.childrenLoaders.get(i);if(i._loadedRoutes)return Rn({routes:i._loadedRoutes,injector:i._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(i);const s=this.loadModuleFactoryOrRoutes(i.loadChildren).pipe(W(m=>{this.onLoadEndListener&&this.onLoadEndListener(i);let y,C,M=!1;Array.isArray(m)?C=m:(y=m.create(e).injector,C=N2(y.get(jE,[],Un.Self|Un.Optional)));return{routes:C.map(FE),injector:y}}),Sw(()=>{this.childrenLoaders.delete(i)})),d=new bE(s,()=>new Zt).pipe(gE());return this.childrenLoaders.set(i,d),d}loadModuleFactoryOrRoutes(e){return Ap(e()).pipe(Gn(i=>i instanceof uA||Array.isArray(i)?Rn(i):eo(this.compiler.compileModuleAsync(i))))}}return n.\u0275fac=function(e){return new(e||n)(ze(Nr),ze(LC))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class C${}class T${shouldProcessUrl(t){return!0}extract(t){return t}merge(t,e){return t}}function E$(n){throw n}function D$(n,t,e){return t.parse("/")}const I$={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},M$={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};function kL(){var n,t;const e=Fr($2),i=Fr(pv),r=Fr(Ix),s=Fr(Nr),d=Fr(LC),m=null!==(n=Fr(jE,{optional:!0}))&&void 0!==n?n:[],y=null!==(t=Fr(Vw,{optional:!0}))&&void 0!==t?t:{},C=Fr(ML),M=Fr(IL,{optional:!0}),k=Fr(C$,{optional:!0}),z=Fr(v$,{optional:!0}),q=new ls(null,e,i,r,s,d,N2(m));return k&&(q.urlHandlingStrategy=k),z&&(q.routeReuseStrategy=z),q.titleStrategy=null!=M?M:C,function A$(n,t){n.errorHandler&&(t.errorHandler=n.errorHandler),n.malformedUriErrorHandler&&(t.malformedUriErrorHandler=n.malformedUriErrorHandler),n.onSameUrlNavigation&&(t.onSameUrlNavigation=n.onSameUrlNavigation),n.paramsInheritanceStrategy&&(t.paramsInheritanceStrategy=n.paramsInheritanceStrategy),n.relativeLinkResolution&&(t.relativeLinkResolution=n.relativeLinkResolution),n.urlUpdateStrategy&&(t.urlUpdateStrategy=n.urlUpdateStrategy),n.canceledNavigationResolution&&(t.canceledNavigationResolution=n.canceledNavigationResolution)}(y,q),q}let ls=(()=>{class n{constructor(e,i,r,s,d,m,y){this.rootComponentType=e,this.urlSerializer=i,this.rootContexts=r,this.location=s,this.config=y,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new Zt,this.errorHandler=E$,this.malformedUriErrorHandler=D$,this.navigated=!1,this.lastSuccessfulId=-1,this.afterPreactivation=()=>Rn(void 0),this.urlHandlingStrategy=new T$,this.routeReuseStrategy=new w$,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.configLoader=d.get(UE),this.configLoader.onLoadEndListener=z=>this.triggerEvent(new d8(z)),this.configLoader.onLoadStartListener=z=>this.triggerEvent(new u8(z)),this.ngModule=d.get(tm),this.console=d.get(Kz);const k=d.get(qn);this.isNgZoneEnabled=k instanceof qn&&qn.isInAngularZone(),this.resetConfig(y),this.currentUrlTree=function LH(){return new pm(new rr([],{}),{},null)}(),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=rL(this.currentUrlTree,this.rootComponentType),this.transitions=new ta({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){var e;return null===(e=this.location.getState())||void 0===e?void 0:e.\u0275routerPageId}setupNavigations(e){const i=this.events;return e.pipe(Cr(r=>0!==r.id),W(r=>Object.assign(Object.assign({},r),{extractedUrl:this.urlHandlingStrategy.extract(r.rawUrl)})),na(r=>{let s=!1,d=!1;return Rn(r).pipe(No(m=>{this.currentNavigation={id:m.id,initialUrl:m.rawUrl,extractedUrl:m.extractedUrl,trigger:m.source,extras:m.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),na(m=>{const y=this.browserUrlTree.toString(),C=!this.navigated||m.extractedUrl.toString()!==y||y!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||C)&&this.urlHandlingStrategy.shouldProcessUrl(m.rawUrl))return RL(m.source)&&(this.browserUrlTree=m.extractedUrl),Rn(m).pipe(na(k=>{const z=this.transitions.getValue();return i.next(new EE(k.id,this.serializeUrl(k.extractedUrl),k.source,k.restoredState)),z!==this.transitions.getValue()?ps:Promise.resolve(k)}),function o$(n,t,e,i){return na(r=>function i$(n,t,e,i,r){return new r$(n,t,e,i,r).apply()}(n,t,e,r.extractedUrl,i).pipe(W(s=>Object.assign(Object.assign({},r),{urlAfterRedirects:s}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),No(k=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:k.urlAfterRedirects}),r.urlAfterRedirects=k.urlAfterRedirects}),function f$(n,t,e,i,r,s){return Gn(d=>function l$(n,t,e,i,r,s,d="emptyOnly",m="legacy"){return new c$(n,t,e,i,r,d,m,s).recognize().pipe(na(y=>null===y?function a$(n){return new kt(t=>t.error(n))}(new s$):Rn(y)))}(n,t,e,d.urlAfterRedirects,i.serialize(d.urlAfterRedirects),i,r,s).pipe(W(m=>Object.assign(Object.assign({},d),{targetSnapshot:m}))))}(this.ngModule.injector,this.rootComponentType,this.config,this.urlSerializer,this.paramsInheritanceStrategy,this.relativeLinkResolution),No(k=>{if(r.targetSnapshot=k.targetSnapshot,"eager"===this.urlUpdateStrategy){if(!k.extras.skipLocationChange){const q=this.urlHandlingStrategy.merge(k.urlAfterRedirects,k.rawUrl);this.setBrowserUrl(q,k)}this.browserUrlTree=k.urlAfterRedirects}const z=new o8(k.id,this.serializeUrl(k.extractedUrl),this.serializeUrl(k.urlAfterRedirects),k.targetSnapshot);i.next(z)}));if(C&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:z,extractedUrl:q,source:Q,restoredState:xe,extras:De}=m,Ze=new EE(z,this.serializeUrl(q),Q,xe);i.next(Ze);const It=rL(q,this.rootComponentType).snapshot;return Rn(r=Object.assign(Object.assign({},m),{targetSnapshot:It,urlAfterRedirects:q,extras:Object.assign(Object.assign({},De),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=m.rawUrl,m.resolve(null),ps}),No(m=>{const y=new s8(m.id,this.serializeUrl(m.extractedUrl),this.serializeUrl(m.urlAfterRedirects),m.targetSnapshot);this.triggerEvent(y)}),W(m=>r=Object.assign(Object.assign({},m),{guards:A8(m.targetSnapshot,m.currentSnapshot,this.rootContexts)})),function j8(n,t){return Gn(e=>{const{targetSnapshot:i,currentSnapshot:r,guards:{canActivateChecks:s,canDeactivateChecks:d}}=e;return 0===d.length&&0===s.length?Rn(Object.assign(Object.assign({},e),{guardsResult:!0})):function U8(n,t,e,i){return eo(n).pipe(Gn(r=>function X8(n,t,e,i,r){const s=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return s&&0!==s.length?Rn(s.map(m=>{var y;const C=null!==(y=fv(t))&&void 0!==y?y:r,M=Fb(m,C);return Ap(function B8(n){return n&&bv(n.canDeactivate)}(M)?M.canDeactivate(n,t,e,i):C.runInContext(()=>M(n,t,e,i))).pipe(Mp())})).pipe(Nb()):Rn(!0)}(r.component,r.route,e,t,i)),Mp(r=>!0!==r,!0))}(d,i,r,n).pipe(Gn(m=>m&&function L8(n){return"boolean"==typeof n}(m)?function H8(n,t,e,i){return eo(t).pipe(Cp(r=>rv(function G8(n,t){return null!==n&&t&&t(new h8(n)),Rn(!0)}(r.route.parent,i),function $8(n,t){return null!==n&&t&&t(new f8(n)),Rn(!0)}(r.route,i),function W8(n,t,e){const i=t[t.length-1],s=t.slice(0,t.length-1).reverse().map(d=>function k8(n){const t=n.routeConfig?n.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:n,guards:t}:null}(d)).filter(d=>null!==d).map(d=>hm(()=>Rn(d.guards.map(y=>{var C;const M=null!==(C=fv(d.node))&&void 0!==C?C:e,k=Fb(y,M);return Ap(function N8(n){return n&&bv(n.canActivateChild)}(k)?k.canActivateChild(i,n):M.runInContext(()=>k(i,n))).pipe(Mp())})).pipe(Nb())));return Rn(s).pipe(Nb())}(n,r.path,e),function q8(n,t,e){const i=t.routeConfig?t.routeConfig.canActivate:null;if(!i||0===i.length)return Rn(!0);const r=i.map(s=>hm(()=>{var d;const m=null!==(d=fv(t))&&void 0!==d?d:e,y=Fb(s,m);return Ap(function F8(n){return n&&bv(n.canActivate)}(y)?y.canActivate(t,n):m.runInContext(()=>y(t,n))).pipe(Mp())}));return Rn(r).pipe(Nb())}(n,r.route,e))),Mp(r=>!0!==r,!0))}(i,s,n,t):Rn(m)),W(m=>Object.assign(Object.assign({},e),{guardsResult:m})))})}(this.ngModule.injector,m=>this.triggerEvent(m)),No(m=>{if(r.guardsResult=m.guardsResult,mm(m.guardsResult))throw lL(0,m.guardsResult);const y=new a8(m.id,this.serializeUrl(m.extractedUrl),this.serializeUrl(m.urlAfterRedirects),m.targetSnapshot,!!m.guardsResult);this.triggerEvent(y)}),Cr(m=>!!m.guardsResult||(this.restoreHistory(m),this.cancelNavigationTransition(m,"",3),!1)),VE(m=>{if(m.guards.canActivateChecks.length)return Rn(m).pipe(No(y=>{const C=new l8(y.id,this.serializeUrl(y.extractedUrl),this.serializeUrl(y.urlAfterRedirects),y.targetSnapshot);this.triggerEvent(C)}),na(y=>{let C=!1;return Rn(y).pipe(function m$(n,t){return Gn(e=>{const{targetSnapshot:i,guards:{canActivateChecks:r}}=e;if(!r.length)return Rn(e);let s=0;return eo(r).pipe(Cp(d=>function g$(n,t,e,i){const r=n.routeConfig,s=n._resolve;return void 0!==(null==r?void 0:r.title)&&!DL(r)&&(s[sv]=r.title),function b$(n,t,e,i){const r=function _$(n){return[...Object.keys(n),...Object.getOwnPropertySymbols(n)]}(n);if(0===r.length)return Rn({});const s={};return eo(r).pipe(Gn(d=>function y$(n,t,e,i){var r;const s=null!==(r=fv(t))&&void 0!==r?r:i,d=Fb(n,s);return Ap(d.resolve?d.resolve(t,e):s.runInContext(()=>d(t,e)))}(n[d],t,e,i).pipe(Mp(),No(m=>{s[d]=m}))),_E(1),ov(s),dh(d=>NE(d)?ps:kb(d)))}(s,n,t,i).pipe(W(d=>(n._resolvedData=d,n.data=oL(n,e).resolve,r&&DL(r)&&(n.data[sv]=r.title),null)))}(d.route,i,n,t)),No(()=>s++),_E(1),Gn(d=>s===r.length?Rn(e):ps))})}(this.paramsInheritanceStrategy,this.ngModule.injector),No({next:()=>C=!0,complete:()=>{C||(this.restoreHistory(y),this.cancelNavigationTransition(y,"",2))}}))}),No(y=>{const C=new c8(y.id,this.serializeUrl(y.extractedUrl),this.serializeUrl(y.urlAfterRedirects),y.targetSnapshot);this.triggerEvent(C)}))}),VE(m=>{const y=C=>{var M;const k=[];(null===(M=C.routeConfig)||void 0===M?void 0:M.loadComponent)&&!C.routeConfig._loadedComponent&&k.push(this.configLoader.loadComponent(C.routeConfig).pipe(No(z=>{C.component=z}),W(()=>{})));for(const z of C.children)k.push(...y(z));return k};return dm(y(m.targetSnapshot.root)).pipe(ww(),Vr(1))}),VE(()=>this.afterPreactivation()),W(m=>{const y=function y8(n,t,e){const i=hv(n,t._root,e?e._root:void 0);return new iL(i,t)}(this.routeReuseStrategy,m.targetSnapshot,m.currentRouterState);return r=Object.assign(Object.assign({},m),{targetRouterState:y})}),No(m=>{this.currentUrlTree=m.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(m.urlAfterRedirects,m.rawUrl),this.routerState=m.targetRouterState,"deferred"===this.urlUpdateStrategy&&(m.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,m),this.browserUrlTree=m.urlAfterRedirects)}),((n,t,e)=>W(i=>(new M8(t,i.targetRouterState,i.currentRouterState,e).activate(n),i)))(this.rootContexts,this.routeReuseStrategy,m=>this.triggerEvent(m)),No({next(){s=!0},complete(){s=!0}}),Sw(()=>{var m;s||d||this.cancelNavigationTransition(r,"",1),(null===(m=this.currentNavigation)||void 0===m?void 0:m.id)===r.id&&(this.currentNavigation=null)}),dh(m=>{var y;if(d=!0,dL(m)){uL(m)||(this.navigated=!0,this.restoreHistory(r,!0));const C=new Aw(r.id,this.serializeUrl(r.extractedUrl),m.message,m.cancellationCode);if(i.next(C),uL(m)){const M=this.urlHandlingStrategy.merge(m.url,this.rawUrlTree),k={skipLocationChange:r.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||RL(r.source)};this.scheduleNavigation(M,"imperative",null,k,{resolve:r.resolve,reject:r.reject,promise:r.promise})}else r.resolve(!1)}else{this.restoreHistory(r,!0);const C=new eL(r.id,this.serializeUrl(r.extractedUrl),m,null!==(y=r.targetSnapshot)&&void 0!==y?y:void 0);i.next(C);try{r.resolve(this.errorHandler(m))}catch(M){r.reject(M)}}return ps}))}))}resetRootComponentType(e){this.rootComponentType=e,this.routerState.root.component=this.rootComponentType}setTransition(e){this.transitions.next(Object.assign(Object.assign({},this.transitions.value),e))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(e=>{const i="popstate"===e.type?"popstate":"hashchange";"popstate"===i&&setTimeout(()=>{var r;const s={replaceUrl:!0},d=null!==(r=e.state)&&void 0!==r&&r.navigationId?e.state:null;if(d){const y=Object.assign({},d);delete y.navigationId,delete y.\u0275routerPageId,0!==Object.keys(y).length&&(s.state=y)}const m=this.parseUrl(e.url);this.scheduleNavigation(m,i,d,s)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(e){this.events.next(e)}resetConfig(e){this.config=e.map(FE),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(e,i={}){const{relativeTo:r,queryParams:s,fragment:d,queryParamsHandling:m,preserveFragment:y}=i,C=r||this.routerState.root,M=y?this.currentUrlTree.fragment:d;let k=null;switch(m){case"merge":k=Object.assign(Object.assign({},this.currentUrlTree.queryParams),s);break;case"preserve":k=this.currentUrlTree.queryParams;break;default:k=s||null}return null!==k&&(k=this.removeEmptyProps(k)),JH(C,this.currentUrlTree,e,k,null!=M?M:null)}navigateByUrl(e,i={skipLocationChange:!1}){const r=mm(e)?e:this.parseUrl(e),s=this.urlHandlingStrategy.merge(r,this.rawUrlTree);return this.scheduleNavigation(s,"imperative",null,i)}navigate(e,i={skipLocationChange:!1}){return function k$(n){for(let t=0;t<n.length;t++){if(null==n[t])throw new Ot(4008,false)}}(e),this.navigateByUrl(this.createUrlTree(e,i),i)}serializeUrl(e){return this.urlSerializer.serialize(e)}parseUrl(e){let i;try{i=this.urlSerializer.parse(e)}catch(r){i=this.malformedUriErrorHandler(r,this.urlSerializer,e)}return i}isActive(e,i){let r;if(r=!0===i?Object.assign({},I$):!1===i?Object.assign({},M$):i,mm(e))return V2(this.currentUrlTree,e,r);const s=this.parseUrl(e);return V2(this.currentUrlTree,s,r)}removeEmptyProps(e){return Object.keys(e).reduce((i,r)=>{const s=e[r];return null!=s&&(i[r]=s),i},{})}processNavigations(){this.navigations.subscribe(e=>{var i;this.navigated=!0,this.lastSuccessfulId=e.id,this.currentPageId=e.targetPageId,this.events.next(new gm(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,null===(i=this.titleStrategy)||void 0===i||i.updateTitle(this.routerState.snapshot),e.resolve(!0)},e=>{this.console.warn(`Unhandled Navigation Error: ${e}`)})}scheduleNavigation(e,i,r,s,d){var m,y;if(this.disposed)return Promise.resolve(!1);let C,M,k;d?(C=d.resolve,M=d.reject,k=d.promise):k=new Promise((Q,xe)=>{C=Q,M=xe});const z=++this.navigationId;let q;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(r=this.location.getState()),q=r&&r.\u0275routerPageId?r.\u0275routerPageId:s.replaceUrl||s.skipLocationChange?null!==(m=this.browserPageId)&&void 0!==m?m:0:(null!==(y=this.browserPageId)&&void 0!==y?y:0)+1):q=0,this.setTransition({id:z,targetPageId:q,source:i,restoredState:r,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:e,extras:s,resolve:C,reject:M,promise:k,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),k.catch(Q=>Promise.reject(Q))}setBrowserUrl(e,i){const r=this.urlSerializer.serialize(e),s=Object.assign(Object.assign({},i.extras.state),this.generateNgRouterState(i.id,i.targetPageId));this.location.isCurrentPathEqualTo(r)||i.extras.replaceUrl?this.location.replaceState(r,"",s):this.location.go(r,"",s)}restoreHistory(e,i=!1){var r,s;if("computed"===this.canceledNavigationResolution){const d=this.currentPageId-e.targetPageId;"popstate"!==e.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null===(r=this.currentNavigation)||void 0===r?void 0:r.finalUrl)||0===d?this.currentUrlTree===(null===(s=this.currentNavigation)||void 0===s?void 0:s.finalUrl)&&0===d&&(this.resetState(e),this.browserUrlTree=e.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(d)}else"replace"===this.canceledNavigationResolution&&(i&&this.resetState(e),this.resetUrlToCurrentUrlTree())}resetState(e){this.routerState=e.currentRouterState,this.currentUrlTree=e.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,e.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(e,i,r){const s=new Aw(e.id,this.serializeUrl(e.extractedUrl),i,r);this.triggerEvent(s),e.resolve(!1)}generateNgRouterState(e,i){return"computed"===this.canceledNavigationResolution?{navigationId:e,\u0275routerPageId:i}:{navigationId:e}}}return n.\u0275fac=function(e){Qc()},n.\u0275prov=Jt({token:n,factory:function(){return kL()},providedIn:"root"}),n})();function RL(n){return"imperative"!==n}let yv=(()=>{class n{constructor(e,i,r){this.router=e,this.route=i,this.locationStrategy=r,this._preserveFragment=!1,this._skipLocationChange=!1,this._replaceUrl=!1,this.commands=null,this.href=null,this.onChanges=new Zt,this.subscription=e.events.subscribe(s=>{s instanceof gm&&this.updateTargetUrlAndHref()})}set preserveFragment(e){this._preserveFragment=rh(e)}get preserveFragment(){return this._preserveFragment}set skipLocationChange(e){this._skipLocationChange=rh(e)}get skipLocationChange(){return this._skipLocationChange}set replaceUrl(e){this._replaceUrl=rh(e)}get replaceUrl(){return this._replaceUrl}set routerLink(e){this.commands=null!=e?Array.isArray(e)?e:[e]:null}ngOnChanges(e){this.updateTargetUrlAndHref(),this.onChanges.next(this)}ngOnDestroy(){this.subscription.unsubscribe()}onClick(e,i,r,s,d){return!!(0!==e||i||r||s||d||"string"==typeof this.target&&"_self"!=this.target||null===this.urlTree)||(this.router.navigateByUrl(this.urlTree,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state}),!1)}updateTargetUrlAndHref(){this.href=null!==this.urlTree?this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}}return n.\u0275fac=function(e){return new(e||n)(G(ls),G(bm),G(om))},n.\u0275dir=Lt({type:n,selectors:[["a","routerLink",""],["area","routerLink",""]],hostVars:2,hostBindings:function(e,i){1&e&&Qt("click",function(s){return i.onClick(s.button,s.ctrlKey,s.shiftKey,s.altKey,s.metaKey)}),2&e&&fn("target",i.target)("href",i.href,ll)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",relativeTo:"relativeTo",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",routerLink:"routerLink"},standalone:!0,features:[cr]}),n})();class PL{}let L$=(()=>{class n{constructor(e,i,r,s,d){this.router=e,this.injector=r,this.preloadingStrategy=s,this.loader=d}setUpPreloading(){this.subscription=this.router.events.pipe(Cr(e=>e instanceof gm),Cp(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(e,i){var r,s,d;const m=[];for(const y of i){y.providers&&!y._injector&&(y._injector=gx(y.providers,e,`Route: ${y.path}`));const C=null!==(r=y._injector)&&void 0!==r?r:e,M=null!==(s=y._loadedInjector)&&void 0!==s?s:C;y.loadChildren&&!y._loadedRoutes&&void 0===y.canLoad||y.loadComponent&&!y._loadedComponent?m.push(this.preloadConfig(C,y)):(y.children||y._loadedRoutes)&&m.push(this.processRoutes(M,null!==(d=y.children)&&void 0!==d?d:y._loadedRoutes))}return eo(m).pipe(Xl())}preloadConfig(e,i){return this.preloadingStrategy.preload(i,()=>{let r;r=i.loadChildren&&void 0===i.canLoad?this.loader.loadChildren(e,i):Rn(null);const s=r.pipe(Gn(d=>{var m;return null===d?Rn(void 0):(i._loadedRoutes=d.routes,i._loadedInjector=d.injector,this.processRoutes(null!==(m=d.injector)&&void 0!==m?m:e,d.routes))}));return i.loadComponent&&!i._loadedComponent?eo([s,this.loader.loadComponent(i)]).pipe(Xl()):s})}}return n.\u0275fac=function(e){return new(e||n)(ze(ls),ze(LC),ze(Zc),ze(PL),ze(UE))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const $E=new Et("");let LL=(()=>{class n{constructor(e,i,r={}){this.router=e,this.viewportScroller=i,this.options=r,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},r.scrollPositionRestoration=r.scrollPositionRestoration||"disabled",r.anchorScrolling=r.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(e=>{e instanceof EE?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=e.navigationTrigger,this.restoredId=e.restoredState?e.restoredState.navigationId:0):e instanceof gm&&(this.lastId=e.id,this.scheduleScrollEvent(e,this.router.parseUrl(e.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(e=>{e instanceof tL&&(e.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(e.position):e.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(e.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(e,i){this.router.triggerEvent(new tL(e,"popstate"===this.lastSource?this.store[this.restoredId]:null,i))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return n.\u0275fac=function(e){Qc()},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})();function Bb(n,t){return{\u0275kind:n,\u0275providers:t}}function GE(n){return[{provide:jE,multi:!0,useValue:n}]}function FL(){const n=Fr(Nr);return t=>{var e,i;const r=n.get(Cb);if(t!==r.components[0])return;const s=n.get(ls),d=n.get(NL);1===n.get(qE)&&s.initialNavigation(),null===(e=n.get(BL,null,Un.Optional))||void 0===e||e.setUpPreloading(),null===(i=n.get($E,null,Un.Optional))||void 0===i||i.init(),s.resetRootComponentType(r.componentTypes[0]),d.closed||(d.next(),d.unsubscribe())}}const NL=new Et("",{factory:()=>new Zt}),qE=new Et("",{providedIn:"root",factory:()=>1});const BL=new Et("");function B$(n){return Bb(0,[{provide:BL,useExisting:L$},{provide:PL,useExisting:n}])}const zL=new Et("ROUTER_FORROOT_GUARD"),z$=[Ix,{provide:$2,useClass:vE},{provide:ls,useFactory:kL},pv,{provide:bm,useFactory:function OL(n){return n.routerState.root},deps:[ls]},UE];function V$(){return new ok("Router",ls)}let $w=(()=>{class n{constructor(e){}static forRoot(e,i){return{ngModule:n,providers:[z$,[],GE(e),{provide:zL,useFactory:$$,deps:[[ls,new Kh,new Qh]]},{provide:Vw,useValue:i||{}},null!=i&&i.useHash?{provide:om,useClass:zV}:{provide:om,useClass:Ak},{provide:$E,useFactory:()=>{const n=Fr(ls),t=Fr(Q6),e=Fr(Vw);return e.scrollOffset&&t.setOffset(e.scrollOffset),new LL(n,t,e)}},null!=i&&i.preloadingStrategy?B$(i.preloadingStrategy).\u0275providers:[],{provide:ok,multi:!0,useFactory:V$},null!=i&&i.initialNavigation?G$(i):[],[{provide:VL,useFactory:FL},{provide:QA,multi:!0,useExisting:VL}]]}}static forChild(e){return{ngModule:n,providers:[GE(e)]}}}return n.\u0275fac=function(e){return new(e||n)(ze(zL,8))},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({imports:[LE]}),n})();function $$(n){return"guarded"}function G$(n){return["disabled"===n.initialNavigation?Bb(3,[{provide:vx,multi:!0,useFactory:()=>{const t=Fr(ls);return()=>{t.setUpLocationChangeListener()}}},{provide:qE,useValue:2}]).\u0275providers:[],"enabledBlocking"===n.initialNavigation?Bb(2,[{provide:qE,useValue:0},{provide:vx,multi:!0,deps:[Nr],useFactory:t=>{const e=t.get(NV,Promise.resolve());let i=!1;return()=>e.then(()=>new Promise(s=>{const d=t.get(ls),m=t.get(NL);(function r(s){t.get(ls).events.pipe(Cr(m=>m instanceof gm||m instanceof Aw||m instanceof eL),W(m=>m instanceof gm||m instanceof Aw&&(0===m.code||1===m.code)&&null),Cr(m=>null!==m),Vr(1)).subscribe(()=>{s()})})(()=>{s(!0),i=!0}),d.afterPreactivation=()=>(s(!0),i||m.closed?Rn(void 0):m),d.initialNavigation()}))}}]).\u0275providers:[]]}const VL=new Et("");let WE;try{WE="undefined"!=typeof Intl&&Intl.v8BreakIterator}catch(n){WE=!1}let zb,cs=(()=>{class n{constructor(e){this._platformId=e,this.isBrowser=this._platformId?function K6(n){return n===Yk}(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!WE)&&"undefined"!=typeof CSS&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}}return n.\u0275fac=function(e){return new(e||n)(ze(wx))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const jL=["color","button","checkbox","date","datetime-local","email","file","hidden","image","month","number","password","radio","range","reset","search","submit","tel","text","time","url","week"];function UL(){if(zb)return zb;if("object"!=typeof document||!document)return zb=new Set(jL),zb;let n=document.createElement("input");return zb=new Set(jL.filter(t=>(n.setAttribute("type",t),n.type===t))),zb}let vv,_m,XE;function kp(n){return function W$(){if(null==vv&&"undefined"!=typeof window)try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>vv=!0}))}finally{vv=vv||!1}return vv}()?n:!!n.capture}function X$(){if(null==_m){if("object"!=typeof document||!document||"function"!=typeof Element||!Element)return _m=!1,_m;if("scrollBehavior"in document.documentElement.style)_m=!0;else{const n=Element.prototype.scrollTo;_m=!!n&&!/\{\s*\[native code\]\s*\}/.test(n.toString())}}return _m}function su(){let n="undefined"!=typeof document&&document?document.activeElement:null;for(;n&&n.shadowRoot;){const t=n.shadowRoot.activeElement;if(t===n)break;n=t}return n}function Rp(n){return n.composedPath?n.composedPath()[0]:n.target}function ZE(){return"undefined"!=typeof __karma__&&!!__karma__||"undefined"!=typeof jasmine&&!!jasmine||"undefined"!=typeof jest&&!!jest||"undefined"!=typeof Mocha&&!!Mocha}function ra(n,...t){return t.length?t.some(e=>n[e]):n.altKey||n.shiftKey||n.ctrlKey||n.metaKey}class lG extends te{constructor(t,e){super()}schedule(t,e=0){return this}}const qw={setInterval(n,t,...e){const{delegate:i}=qw;return null!=i&&i.setInterval?i.setInterval(n,t,...e):setInterval(n,t,...e)},clearInterval(n){const{delegate:t}=qw;return((null==t?void 0:t.clearInterval)||clearInterval)(n)},delegate:void 0};class eD extends lG{constructor(t,e){super(t,e),this.scheduler=t,this.work=e,this.pending=!1}schedule(t,e=0){var i;if(this.closed)return this;this.state=t;const r=this.id,s=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(s,r,e)),this.pending=!0,this.delay=e,this.id=null!==(i=this.id)&&void 0!==i?i:this.requestAsyncId(s,this.id,e),this}requestAsyncId(t,e,i=0){return qw.setInterval(t.flush.bind(t,this),i)}recycleAsyncId(t,e,i=0){if(null!=i&&this.delay===i&&!1===this.pending)return e;null!=e&&qw.clearInterval(e)}execute(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const i=this._execute(t,e);if(i)return i;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,e){let r,i=!1;try{this.work(t)}catch(s){i=!0,r=s||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),r}unsubscribe(){if(!this.closed){const{id:t,scheduler:e}=this,{actions:i}=e;this.work=this.state=this.scheduler=null,this.pending=!1,p(i,this),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null,super.unsubscribe()}}}const qL={now:()=>(qL.delegate||Date).now(),delegate:void 0};class xv{constructor(t,e=xv.now){this.schedulerActionCtor=t,this.now=e}schedule(t,e=0,i){return new this.schedulerActionCtor(this,t).schedule(i,e)}}xv.now=qL.now;class tD extends xv{constructor(t,e=xv.now){super(t,e),this.actions=[],this._active=!1}flush(t){const{actions:e}=this;if(this._active)return void e.push(t);let i;this._active=!0;do{if(i=t.execute(t.state,t.delay))break}while(t=e.shift());if(this._active=!1,i){for(;t=e.shift();)t.unsubscribe();throw i}}}const Ww=new tD(eD),cG=Ww;function wv(n,t=Ww){return Di((e,i)=>{let r=null,s=null,d=null;const m=()=>{if(r){r.unsubscribe(),r=null;const C=s;s=null,i.next(C)}};function y(){const C=d+n,M=t.now();if(M<C)return r=this.schedule(void 0,C-M),void i.add(r);m()}e.subscribe(Ci(i,C=>{s=C,d=t.now(),r||(r=t.schedule(y,n),i.add(r))},()=>{m(),i.complete()},void 0,()=>{s=r=null}))})}function WL(n){return Cr((t,e)=>n<=e)}function Pp(n,t=yt){return n=null!=n?n:uG,Di((e,i)=>{let r,s=!0;e.subscribe(Ci(i,d=>{const m=t(d);(s||!n(r,m))&&(s=!1,r=m,i.next(d))}))})}function uG(n,t){return n===t}function Pi(n){return Di((t,e)=>{Fi(n).subscribe(Ci(e,()=>e.complete(),Ue)),!e.closed&&t.subscribe(e)})}function jn(n){return null!=n&&"false"!=`${n}`}function gh(n,t=0){return function dG(n){return!isNaN(parseFloat(n))&&!isNaN(Number(n))}(n)?Number(n):t}function Xw(n){return Array.isArray(n)?n:[n]}function us(n){return null==n?"":"string"==typeof n?n:`${n}px`}function xm(n){return n instanceof Tn?n.nativeElement:n}function nD(n,t=/\s+/){const e=[];if(null!=n){const i=Array.isArray(n)?n:`${n}`.split(t);for(const r of i){const s=`${r}`.trim();s&&e.push(s)}}return e}let XL=(()=>{class n{create(e){return"undefined"==typeof MutationObserver?null:new MutationObserver(e)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),ZL=(()=>{class n{constructor(e){this._mutationObserverFactory=e,this._observedElements=new Map}ngOnDestroy(){this._observedElements.forEach((e,i)=>this._cleanupObserver(i))}observe(e){const i=xm(e);return new kt(r=>{const d=this._observeElement(i).subscribe(r);return()=>{d.unsubscribe(),this._unobserveElement(i)}})}_observeElement(e){if(this._observedElements.has(e))this._observedElements.get(e).count++;else{const i=new Zt,r=this._mutationObserverFactory.create(s=>i.next(s));r&&r.observe(e,{characterData:!0,childList:!0,subtree:!0}),this._observedElements.set(e,{observer:r,stream:i,count:1})}return this._observedElements.get(e).stream}_unobserveElement(e){this._observedElements.has(e)&&(this._observedElements.get(e).count--,this._observedElements.get(e).count||this._cleanupObserver(e))}_cleanupObserver(e){if(this._observedElements.has(e)){const{observer:i,stream:r}=this._observedElements.get(e);i&&i.disconnect(),r.complete(),this._observedElements.delete(e)}}}return n.\u0275fac=function(e){return new(e||n)(ze(XL))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),YL=(()=>{class n{constructor(e,i,r){this._contentObserver=e,this._elementRef=i,this._ngZone=r,this.event=new nn,this._disabled=!1,this._currentSubscription=null}get disabled(){return this._disabled}set disabled(e){this._disabled=jn(e),this._disabled?this._unsubscribe():this._subscribe()}get debounce(){return this._debounce}set debounce(e){this._debounce=gh(e),this._subscribe()}ngAfterContentInit(){!this._currentSubscription&&!this.disabled&&this._subscribe()}ngOnDestroy(){this._unsubscribe()}_subscribe(){this._unsubscribe();const e=this._contentObserver.observe(this._elementRef);this._ngZone.runOutsideAngular(()=>{this._currentSubscription=(this.debounce?e.pipe(wv(this.debounce)):e).subscribe(this.event)})}_unsubscribe(){var e;null===(e=this._currentSubscription)||void 0===e||e.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)(G(ZL),G(Tn),G(qn))},n.\u0275dir=Lt({type:n,selectors:[["","cdkObserveContent",""]],inputs:{disabled:["cdkObserveContentDisabled","disabled"],debounce:"debounce"},outputs:{event:"cdkObserveContent"},exportAs:["cdkObserveContent"]}),n})(),Zw=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({providers:[XL]}),n})();const KL=new Set;let jb,hG=(()=>{class n{constructor(e){this._platform=e,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):fG}matchMedia(e){return(this._platform.WEBKIT||this._platform.BLINK)&&function pG(n){if(!KL.has(n))try{jb||(jb=document.createElement("style"),jb.setAttribute("type","text/css"),document.head.appendChild(jb)),jb.sheet&&(jb.sheet.insertRule(`@media ${n} {body{ }}`,0),KL.add(n))}catch(t){console.error(t)}}(e),this._matchMedia(e)}}return n.\u0275fac=function(e){return new(e||n)(ze(cs))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function fG(n){return{matches:"all"===n||""===n,media:n,addListener:()=>{},removeListener:()=>{}}}let iD=(()=>{class n{constructor(e,i){this._mediaMatcher=e,this._zone=i,this._queries=new Map,this._destroySubject=new Zt}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(e){return QL(Xw(e)).some(r=>this._registerQuery(r).mql.matches)}observe(e){let s=dm(QL(Xw(e)).map(d=>this._registerQuery(d).observable));return s=rv(s.pipe(Vr(1)),s.pipe(WL(1),wv(0))),s.pipe(W(d=>{const m={matches:!1,breakpoints:{}};return d.forEach(({matches:y,query:C})=>{m.matches=m.matches||y,m.breakpoints[C]=y}),m}))}_registerQuery(e){if(this._queries.has(e))return this._queries.get(e);const i=this._mediaMatcher.matchMedia(e),s={observable:new kt(d=>{const m=y=>this._zone.run(()=>d.next(y));return i.addListener(m),()=>{i.removeListener(m)}}).pipe(Ds(i),W(({matches:d})=>({query:e,matches:d})),Pi(this._destroySubject)),mql:i};return this._queries.set(e,s),s}}return n.\u0275fac=function(e){return new(e||n)(ze(hG),ze(qn))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function QL(n){return n.map(t=>t.split(",")).reduce((t,e)=>t.concat(e)).map(t=>t.trim())}function Yw(n,t){return(n.getAttribute(t)||"").match(/\S+/g)||[]}const eO="cdk-describedby-message",Kw="cdk-describedby-host";let rD=0,tO=(()=>{class n{constructor(e,i){this._platform=i,this._messageRegistry=new Map,this._messagesContainer=null,this._id=""+rD++,this._document=e,this._id=Fr(Sb)+"-"+rD++}describe(e,i,r){if(!this._canBeDescribed(e,i))return;const s=oD(i,r);"string"!=typeof i?(nO(i,this._id),this._messageRegistry.set(s,{messageElement:i,referenceCount:0})):this._messageRegistry.has(s)||this._createMessageElement(i,r),this._isElementDescribedByMessage(e,s)||this._addMessageReference(e,s)}removeDescription(e,i,r){var s;if(!i||!this._isElementNode(e))return;const d=oD(i,r);if(this._isElementDescribedByMessage(e,d)&&this._removeMessageReference(e,d),"string"==typeof i){const m=this._messageRegistry.get(d);m&&0===m.referenceCount&&this._deleteMessageElement(d)}0===(null===(s=this._messagesContainer)||void 0===s?void 0:s.childNodes.length)&&(this._messagesContainer.remove(),this._messagesContainer=null)}ngOnDestroy(){var e;const i=this._document.querySelectorAll(`[${Kw}="${this._id}"]`);for(let r=0;r<i.length;r++)this._removeCdkDescribedByReferenceIds(i[r]),i[r].removeAttribute(Kw);null===(e=this._messagesContainer)||void 0===e||e.remove(),this._messagesContainer=null,this._messageRegistry.clear()}_createMessageElement(e,i){const r=this._document.createElement("div");nO(r,this._id),r.textContent=e,i&&r.setAttribute("role",i),this._createMessagesContainer(),this._messagesContainer.appendChild(r),this._messageRegistry.set(oD(e,i),{messageElement:r,referenceCount:0})}_deleteMessageElement(e){var i,r;null===(r=null===(i=this._messageRegistry.get(e))||void 0===i?void 0:i.messageElement)||void 0===r||r.remove(),this._messageRegistry.delete(e)}_createMessagesContainer(){if(this._messagesContainer)return;const e="cdk-describedby-message-container",i=this._document.querySelectorAll(`.${e}[platform="server"]`);for(let s=0;s<i.length;s++)i[s].remove();const r=this._document.createElement("div");r.style.visibility="hidden",r.classList.add(e),r.classList.add("cdk-visually-hidden"),this._platform&&!this._platform.isBrowser&&r.setAttribute("platform","server"),this._document.body.appendChild(r),this._messagesContainer=r}_removeCdkDescribedByReferenceIds(e){const i=Yw(e,"aria-describedby").filter(r=>0!=r.indexOf(eO));e.setAttribute("aria-describedby",i.join(" "))}_addMessageReference(e,i){const r=this._messageRegistry.get(i);(function mG(n,t,e){const i=Yw(n,t);i.some(r=>r.trim()==e.trim())||(i.push(e.trim()),n.setAttribute(t,i.join(" ")))})(e,"aria-describedby",r.messageElement.id),e.setAttribute(Kw,this._id),r.referenceCount++}_removeMessageReference(e,i){const r=this._messageRegistry.get(i);r.referenceCount--,function gG(n,t,e){const r=Yw(n,t).filter(s=>s!=e.trim());r.length?n.setAttribute(t,r.join(" ")):n.removeAttribute(t)}(e,"aria-describedby",r.messageElement.id),e.removeAttribute(Kw)}_isElementDescribedByMessage(e,i){const r=Yw(e,"aria-describedby"),s=this._messageRegistry.get(i),d=s&&s.messageElement.id;return!!d&&-1!=r.indexOf(d)}_canBeDescribed(e,i){if(!this._isElementNode(e))return!1;if(i&&"object"==typeof i)return!0;const r=null==i?"":`${i}`.trim(),s=e.getAttribute("aria-label");return!(!r||s&&s.trim()===r)}_isElementNode(e){return e.nodeType===this._document.ELEMENT_NODE}}return n.\u0275fac=function(e){return new(e||n)(ze($n),ze(cs))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function oD(n,t){return"string"==typeof n?`${t||""}/${n}`:n}function nO(n,t){n.id||(n.id=`${eO}-${t}-${rD++}`)}class iO{constructor(t){this._items=t,this._activeItemIndex=-1,this._activeItem=null,this._wrap=!1,this._letterKeyStream=new Zt,this._typeaheadSubscription=te.EMPTY,this._vertical=!0,this._allowedModifierKeys=[],this._homeAndEnd=!1,this._skipPredicateFn=e=>e.disabled,this._pressedLetters=[],this.tabOut=new Zt,this.change=new Zt,t instanceof nm&&t.changes.subscribe(e=>{if(this._activeItem){const r=e.toArray().indexOf(this._activeItem);r>-1&&r!==this._activeItemIndex&&(this._activeItemIndex=r)}})}skipPredicate(t){return this._skipPredicateFn=t,this}withWrap(t=!0){return this._wrap=t,this}withVerticalOrientation(t=!0){return this._vertical=t,this}withHorizontalOrientation(t){return this._horizontal=t,this}withAllowedModifierKeys(t){return this._allowedModifierKeys=t,this}withTypeAhead(t=200){return this._typeaheadSubscription.unsubscribe(),this._typeaheadSubscription=this._letterKeyStream.pipe(No(e=>this._pressedLetters.push(e)),wv(t),Cr(()=>this._pressedLetters.length>0),W(()=>this._pressedLetters.join(""))).subscribe(e=>{const i=this._getItemsArray();for(let r=1;r<i.length+1;r++){const s=(this._activeItemIndex+r)%i.length,d=i[s];if(!this._skipPredicateFn(d)&&0===d.getLabel().toUpperCase().trim().indexOf(e)){this.setActiveItem(s);break}}this._pressedLetters=[]}),this}withHomeAndEnd(t=!0){return this._homeAndEnd=t,this}setActiveItem(t){const e=this._activeItem;this.updateActiveItem(t),this._activeItem!==e&&this.change.next(this._activeItemIndex)}onKeydown(t){const e=t.keyCode,r=["altKey","ctrlKey","metaKey","shiftKey"].every(s=>!t[s]||this._allowedModifierKeys.indexOf(s)>-1);switch(e){case 9:return void this.tabOut.next();case 40:if(this._vertical&&r){this.setNextItemActive();break}return;case 38:if(this._vertical&&r){this.setPreviousItemActive();break}return;case 39:if(this._horizontal&&r){"rtl"===this._horizontal?this.setPreviousItemActive():this.setNextItemActive();break}return;case 37:if(this._horizontal&&r){"rtl"===this._horizontal?this.setNextItemActive():this.setPreviousItemActive();break}return;case 36:if(this._homeAndEnd&&r){this.setFirstItemActive();break}return;case 35:if(this._homeAndEnd&&r){this.setLastItemActive();break}return;default:return void((r||ra(t,"shiftKey"))&&(t.key&&1===t.key.length?this._letterKeyStream.next(t.key.toLocaleUpperCase()):(e>=65&&e<=90||e>=48&&e<=57)&&this._letterKeyStream.next(String.fromCharCode(e))))}this._pressedLetters=[],t.preventDefault()}get activeItemIndex(){return this._activeItemIndex}get activeItem(){return this._activeItem}isTyping(){return this._pressedLetters.length>0}setFirstItemActive(){this._setActiveItemByIndex(0,1)}setLastItemActive(){this._setActiveItemByIndex(this._items.length-1,-1)}setNextItemActive(){this._activeItemIndex<0?this.setFirstItemActive():this._setActiveItemByDelta(1)}setPreviousItemActive(){this._activeItemIndex<0&&this._wrap?this.setLastItemActive():this._setActiveItemByDelta(-1)}updateActiveItem(t){const e=this._getItemsArray(),i="number"==typeof t?t:e.indexOf(t),r=e[i];this._activeItem=null==r?null:r,this._activeItemIndex=i}_setActiveItemByDelta(t){this._wrap?this._setActiveInWrapMode(t):this._setActiveInDefaultMode(t)}_setActiveInWrapMode(t){const e=this._getItemsArray();for(let i=1;i<=e.length;i++){const r=(this._activeItemIndex+t*i+e.length)%e.length;if(!this._skipPredicateFn(e[r]))return void this.setActiveItem(r)}}_setActiveInDefaultMode(t){this._setActiveItemByIndex(this._activeItemIndex+t,t)}_setActiveItemByIndex(t,e){const i=this._getItemsArray();if(i[t]){for(;this._skipPredicateFn(i[t]);)if(!i[t+=e])return;this.setActiveItem(t)}}_getItemsArray(){return this._items instanceof nm?this._items.toArray():this._items}}class rO extends iO{setActiveItem(t){this.activeItem&&this.activeItem.setInactiveStyles(),super.setActiveItem(t),this.activeItem&&this.activeItem.setActiveStyles()}}class sD extends iO{constructor(){super(...arguments),this._origin="program"}setFocusOrigin(t){return this._origin=t,this}setActiveItem(t){super.setActiveItem(t),this.activeItem&&this.activeItem.focus(this._origin)}}let wm=(()=>{class n{constructor(e){this._platform=e}isDisabled(e){return e.hasAttribute("disabled")}isVisible(e){return function _G(n){return!!(n.offsetWidth||n.offsetHeight||"function"==typeof n.getClientRects&&n.getClientRects().length)}(e)&&"visible"===getComputedStyle(e).visibility}isTabbable(e){if(!this._platform.isBrowser)return!1;const i=function bG(n){try{return n.frameElement}catch(t){return null}}(function EG(n){return n.ownerDocument&&n.ownerDocument.defaultView||window}(e));if(i&&(-1===sO(i)||!this.isVisible(i)))return!1;let r=e.nodeName.toLowerCase(),s=sO(e);return e.hasAttribute("contenteditable")?-1!==s:!("iframe"===r||"object"===r||this._platform.WEBKIT&&this._platform.IOS&&!function CG(n){let t=n.nodeName.toLowerCase(),e="input"===t&&n.type;return"text"===e||"password"===e||"select"===t||"textarea"===t}(e))&&("audio"===r?!!e.hasAttribute("controls")&&-1!==s:"video"===r?-1!==s&&(null!==s||this._platform.FIREFOX||e.hasAttribute("controls")):e.tabIndex>=0)}isFocusable(e,i){return function TG(n){return!function vG(n){return function wG(n){return"input"==n.nodeName.toLowerCase()}(n)&&"hidden"==n.type}(n)&&(function yG(n){let t=n.nodeName.toLowerCase();return"input"===t||"select"===t||"button"===t||"textarea"===t}(n)||function xG(n){return function SG(n){return"a"==n.nodeName.toLowerCase()}(n)&&n.hasAttribute("href")}(n)||n.hasAttribute("contenteditable")||oO(n))}(e)&&!this.isDisabled(e)&&((null==i?void 0:i.ignoreVisibility)||this.isVisible(e))}}return n.\u0275fac=function(e){return new(e||n)(ze(cs))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function oO(n){if(!n.hasAttribute("tabindex")||void 0===n.tabIndex)return!1;let t=n.getAttribute("tabindex");return!(!t||isNaN(parseInt(t,10)))}function sO(n){if(!oO(n))return null;const t=parseInt(n.getAttribute("tabindex")||"",10);return isNaN(t)?-1:t}class aO{constructor(t,e,i,r,s=!1){this._element=t,this._checker=e,this._ngZone=i,this._document=r,this._hasAttached=!1,this.startAnchorListener=()=>this.focusLastTabbableElement(),this.endAnchorListener=()=>this.focusFirstTabbableElement(),this._enabled=!0,s||this.attachAnchors()}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(t,this._startAnchor),this._toggleAnchorTabIndex(t,this._endAnchor))}destroy(){const t=this._startAnchor,e=this._endAnchor;t&&(t.removeEventListener("focus",this.startAnchorListener),t.remove()),e&&(e.removeEventListener("focus",this.endAnchorListener),e.remove()),this._startAnchor=this._endAnchor=null,this._hasAttached=!1}attachAnchors(){return!!this._hasAttached||(this._ngZone.runOutsideAngular(()=>{this._startAnchor||(this._startAnchor=this._createAnchor(),this._startAnchor.addEventListener("focus",this.startAnchorListener)),this._endAnchor||(this._endAnchor=this._createAnchor(),this._endAnchor.addEventListener("focus",this.endAnchorListener))}),this._element.parentNode&&(this._element.parentNode.insertBefore(this._startAnchor,this._element),this._element.parentNode.insertBefore(this._endAnchor,this._element.nextSibling),this._hasAttached=!0),this._hasAttached)}focusInitialElementWhenReady(t){return new Promise(e=>{this._executeOnStable(()=>e(this.focusInitialElement(t)))})}focusFirstTabbableElementWhenReady(t){return new Promise(e=>{this._executeOnStable(()=>e(this.focusFirstTabbableElement(t)))})}focusLastTabbableElementWhenReady(t){return new Promise(e=>{this._executeOnStable(()=>e(this.focusLastTabbableElement(t)))})}_getRegionBoundary(t){const e=this._element.querySelectorAll(`[cdk-focus-region-${t}], [cdkFocusRegion${t}], [cdk-focus-${t}]`);return"start"==t?e.length?e[0]:this._getFirstTabbableElement(this._element):e.length?e[e.length-1]:this._getLastTabbableElement(this._element)}focusInitialElement(t){const e=this._element.querySelector("[cdk-focus-initial], [cdkFocusInitial]");if(e){if(!this._checker.isFocusable(e)){const i=this._getFirstTabbableElement(e);return null==i||i.focus(t),!!i}return e.focus(t),!0}return this.focusFirstTabbableElement(t)}focusFirstTabbableElement(t){const e=this._getRegionBoundary("start");return e&&e.focus(t),!!e}focusLastTabbableElement(t){const e=this._getRegionBoundary("end");return e&&e.focus(t),!!e}hasAttached(){return this._hasAttached}_getFirstTabbableElement(t){if(this._checker.isFocusable(t)&&this._checker.isTabbable(t))return t;const e=t.children;for(let i=0;i<e.length;i++){const r=e[i].nodeType===this._document.ELEMENT_NODE?this._getFirstTabbableElement(e[i]):null;if(r)return r}return null}_getLastTabbableElement(t){if(this._checker.isFocusable(t)&&this._checker.isTabbable(t))return t;const e=t.children;for(let i=e.length-1;i>=0;i--){const r=e[i].nodeType===this._document.ELEMENT_NODE?this._getLastTabbableElement(e[i]):null;if(r)return r}return null}_createAnchor(){const t=this._document.createElement("div");return this._toggleAnchorTabIndex(this._enabled,t),t.classList.add("cdk-visually-hidden"),t.classList.add("cdk-focus-trap-anchor"),t.setAttribute("aria-hidden","true"),t}_toggleAnchorTabIndex(t,e){t?e.setAttribute("tabindex","0"):e.removeAttribute("tabindex")}toggleAnchors(t){this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(t,this._startAnchor),this._toggleAnchorTabIndex(t,this._endAnchor))}_executeOnStable(t){this._ngZone.isStable?t():this._ngZone.onStable.pipe(Vr(1)).subscribe(t)}}let Ub=(()=>{class n{constructor(e,i,r){this._checker=e,this._ngZone=i,this._document=r}create(e,i=!1){return new aO(e,this._checker,this._ngZone,this._document,i)}}return n.\u0275fac=function(e){return new(e||n)(ze(wm),ze(qn),ze($n))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),DG=(()=>{class n{constructor(e,i,r){this._elementRef=e,this._focusTrapFactory=i,this._previouslyFocusedElement=null,this.focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement,!0)}get enabled(){return this.focusTrap.enabled}set enabled(e){this.focusTrap.enabled=jn(e)}get autoCapture(){return this._autoCapture}set autoCapture(e){this._autoCapture=jn(e)}ngOnDestroy(){this.focusTrap.destroy(),this._previouslyFocusedElement&&(this._previouslyFocusedElement.focus(),this._previouslyFocusedElement=null)}ngAfterContentInit(){this.focusTrap.attachAnchors(),this.autoCapture&&this._captureFocus()}ngDoCheck(){this.focusTrap.hasAttached()||this.focusTrap.attachAnchors()}ngOnChanges(e){const i=e.autoCapture;i&&!i.firstChange&&this.autoCapture&&this.focusTrap.hasAttached()&&this._captureFocus()}_captureFocus(){this._previouslyFocusedElement=su(),this.focusTrap.focusInitialElementWhenReady()}}return n.\u0275fac=function(e){return new(e||n)(G(Tn),G(Ub),G($n))},n.\u0275dir=Lt({type:n,selectors:[["","cdkTrapFocus",""]],inputs:{enabled:["cdkTrapFocus","enabled"],autoCapture:["cdkTrapFocusAutoCapture","autoCapture"]},exportAs:["cdkTrapFocus"],features:[cr]}),n})();class IG extends aO{constructor(t,e,i,r,s,d,m){super(t,e,i,r,m.defer),this._focusTrapManager=s,this._inertStrategy=d,this._focusTrapManager.register(this)}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this._enabled?this._focusTrapManager.register(this):this._focusTrapManager.deregister(this)}destroy(){this._focusTrapManager.deregister(this),super.destroy()}_enable(){this._inertStrategy.preventFocus(this),this.toggleAnchors(!0)}_disable(){this._inertStrategy.allowFocus(this),this.toggleAnchors(!1)}}const MG=new Et("FOCUS_TRAP_INERT_STRATEGY");class AG{constructor(){this._listener=null}preventFocus(t){this._listener&&t._document.removeEventListener("focus",this._listener,!0),this._listener=e=>this._trapFocus(t,e),t._ngZone.runOutsideAngular(()=>{t._document.addEventListener("focus",this._listener,!0)})}allowFocus(t){!this._listener||(t._document.removeEventListener("focus",this._listener,!0),this._listener=null)}_trapFocus(t,e){var i;const r=e.target,s=t._element;r&&!s.contains(r)&&(null===(i=r.closest)||void 0===i||!i.call(r,"div.cdk-overlay-pane"))&&setTimeout(()=>{t.enabled&&!s.contains(t._document.activeElement)&&t.focusFirstTabbableElement()})}}let kG=(()=>{class n{constructor(){this._focusTrapStack=[]}register(e){this._focusTrapStack=this._focusTrapStack.filter(r=>r!==e);let i=this._focusTrapStack;i.length&&i[i.length-1]._disable(),i.push(e),e._enable()}deregister(e){e._disable();const i=this._focusTrapStack,r=i.indexOf(e);-1!==r&&(i.splice(r,1),i.length&&i[i.length-1]._enable())}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),lO=(()=>{class n{constructor(e,i,r,s,d){this._checker=e,this._ngZone=i,this._focusTrapManager=r,this._document=s,this._inertStrategy=d||new AG}create(e,i={defer:!1}){let r;return r="boolean"==typeof i?{defer:i}:i,new IG(e,this._checker,this._ngZone,this._document,this._focusTrapManager,this._inertStrategy,r)}}return n.\u0275fac=function(e){return new(e||n)(ze(wm),ze(qn),ze(kG),ze($n),ze(MG,8))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const LG=new Et("cdk-input-modality-detector-options"),OG={ignoreKeys:[18,17,224,91,16]},Hb=kp({passive:!0,capture:!0});let FG=(()=>{class n{constructor(e,i,r,s){this._platform=e,this._mostRecentTarget=null,this._modality=new ta(null),this._lastTouchMs=0,this._onKeydown=d=>{var m,y;null!==(y=null===(m=this._options)||void 0===m?void 0:m.ignoreKeys)&&void 0!==y&&y.some(C=>C===d.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=Rp(d))},this._onMousedown=d=>{Date.now()-this._lastTouchMs<650||(this._modality.next(function RG(n){return 0===n.buttons||0===n.offsetX&&0===n.offsetY}(d)?"keyboard":"mouse"),this._mostRecentTarget=Rp(d))},this._onTouchstart=d=>{!function PG(n){const t=n.touches&&n.touches[0]||n.changedTouches&&n.changedTouches[0];return!(!t||-1!==t.identifier||null!=t.radiusX&&1!==t.radiusX||null!=t.radiusY&&1!==t.radiusY)}(d)?(this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=Rp(d)):this._modality.next("keyboard")},this._options=Object.assign(Object.assign({},OG),s),this.modalityDetected=this._modality.pipe(WL(1)),this.modalityChanged=this.modalityDetected.pipe(Pp()),e.isBrowser&&i.runOutsideAngular(()=>{r.addEventListener("keydown",this._onKeydown,Hb),r.addEventListener("mousedown",this._onMousedown,Hb),r.addEventListener("touchstart",this._onTouchstart,Hb)})}get mostRecentModality(){return this._modality.value}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,Hb),document.removeEventListener("mousedown",this._onMousedown,Hb),document.removeEventListener("touchstart",this._onTouchstart,Hb))}}return n.\u0275fac=function(e){return new(e||n)(ze(cs),ze(qn),ze($n),ze(LG,8))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const NG=new Et("liveAnnouncerElement",{providedIn:"root",factory:function BG(){return null}}),zG=new Et("LIVE_ANNOUNCER_DEFAULT_OPTIONS");let uO=(()=>{class n{constructor(e,i,r,s){this._ngZone=i,this._defaultOptions=s,this._document=r,this._liveElement=e||this._createLiveElement()}announce(e,...i){const r=this._defaultOptions;let s,d;return 1===i.length&&"number"==typeof i[0]?d=i[0]:[s,d]=i,this.clear(),clearTimeout(this._previousTimeout),s||(s=r&&r.politeness?r.politeness:"polite"),null==d&&r&&(d=r.duration),this._liveElement.setAttribute("aria-live",s),this._ngZone.runOutsideAngular(()=>(this._currentPromise||(this._currentPromise=new Promise(m=>this._currentResolve=m)),clearTimeout(this._previousTimeout),this._previousTimeout=setTimeout(()=>{this._liveElement.textContent=e,"number"==typeof d&&(this._previousTimeout=setTimeout(()=>this.clear(),d)),this._currentResolve(),this._currentPromise=this._currentResolve=void 0},100),this._currentPromise))}clear(){this._liveElement&&(this._liveElement.textContent="")}ngOnDestroy(){var e,i;clearTimeout(this._previousTimeout),null===(e=this._liveElement)||void 0===e||e.remove(),this._liveElement=null,null===(i=this._currentResolve)||void 0===i||i.call(this),this._currentPromise=this._currentResolve=void 0}_createLiveElement(){const e="cdk-live-announcer-element",i=this._document.getElementsByClassName(e),r=this._document.createElement("div");for(let s=0;s<i.length;s++)i[s].remove();return r.classList.add(e),r.classList.add("cdk-visually-hidden"),r.setAttribute("aria-atomic","true"),r.setAttribute("aria-live","polite"),this._document.body.appendChild(r),r}}return n.\u0275fac=function(e){return new(e||n)(ze(NG,8),ze(qn),ze($n),ze(zG,8))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const VG=new Et("cdk-focus-monitor-default-options"),Qw=kp({passive:!0,capture:!0});let fa=(()=>{class n{constructor(e,i,r,s,d){this._ngZone=e,this._platform=i,this._inputModalityDetector=r,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=window.setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new Zt,this._rootNodeFocusAndBlurListener=m=>{for(let C=Rp(m);C;C=C.parentElement)"focus"===m.type?this._onFocus(m,C):this._onBlur(m,C)},this._document=s,this._detectionMode=(null==d?void 0:d.detectionMode)||0}monitor(e,i=!1){const r=xm(e);if(!this._platform.isBrowser||1!==r.nodeType)return Rn(null);const s=function Y$(n){if(function Z$(){if(null==XE){const n="undefined"!=typeof document?document.head:null;XE=!(!n||!n.createShadowRoot&&!n.attachShadow)}return XE}()){const t=n.getRootNode?n.getRootNode():null;if("undefined"!=typeof ShadowRoot&&ShadowRoot&&t instanceof ShadowRoot)return t}return null}(r)||this._getDocument(),d=this._elementInfo.get(r);if(d)return i&&(d.checkChildren=!0),d.subject;const m={checkChildren:i,subject:new Zt,rootNode:s};return this._elementInfo.set(r,m),this._registerGlobalListeners(m),m.subject}stopMonitoring(e){const i=xm(e),r=this._elementInfo.get(i);r&&(r.subject.complete(),this._setClasses(i),this._elementInfo.delete(i),this._removeGlobalListeners(r))}focusVia(e,i,r){const s=xm(e);s===this._getDocument().activeElement?this._getClosestElementsInfo(s).forEach(([m,y])=>this._originChanged(m,i,y)):(this._setOrigin(i),"function"==typeof s.focus&&s.focus(r))}ngOnDestroy(){this._elementInfo.forEach((e,i)=>this.stopMonitoring(i))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(e){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(e)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:e&&this._isLastInteractionFromInputLabel(e)?"mouse":"program"}_shouldBeAttributedToTouch(e){return 1===this._detectionMode||!(null==e||!e.contains(this._inputModalityDetector._mostRecentTarget))}_setClasses(e,i){e.classList.toggle("cdk-focused",!!i),e.classList.toggle("cdk-touch-focused","touch"===i),e.classList.toggle("cdk-keyboard-focused","keyboard"===i),e.classList.toggle("cdk-mouse-focused","mouse"===i),e.classList.toggle("cdk-program-focused","program"===i)}_setOrigin(e,i=!1){this._ngZone.runOutsideAngular(()=>{this._origin=e,this._originFromTouchInteraction="touch"===e&&i,0===this._detectionMode&&(clearTimeout(this._originTimeoutId),this._originTimeoutId=setTimeout(()=>this._origin=null,this._originFromTouchInteraction?650:1))})}_onFocus(e,i){const r=this._elementInfo.get(i),s=Rp(e);!r||!r.checkChildren&&i!==s||this._originChanged(i,this._getFocusOrigin(s),r)}_onBlur(e,i){const r=this._elementInfo.get(i);!r||r.checkChildren&&e.relatedTarget instanceof Node&&i.contains(e.relatedTarget)||(this._setClasses(i),this._emitOrigin(r,null))}_emitOrigin(e,i){e.subject.observers.length&&this._ngZone.run(()=>e.subject.next(i))}_registerGlobalListeners(e){if(!this._platform.isBrowser)return;const i=e.rootNode,r=this._rootNodeFocusListenerCount.get(i)||0;r||this._ngZone.runOutsideAngular(()=>{i.addEventListener("focus",this._rootNodeFocusAndBlurListener,Qw),i.addEventListener("blur",this._rootNodeFocusAndBlurListener,Qw)}),this._rootNodeFocusListenerCount.set(i,r+1),1==++this._monitoredElementCount&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(Pi(this._stopInputModalityDetector)).subscribe(s=>{this._setOrigin(s,!0)}))}_removeGlobalListeners(e){const i=e.rootNode;if(this._rootNodeFocusListenerCount.has(i)){const r=this._rootNodeFocusListenerCount.get(i);r>1?this._rootNodeFocusListenerCount.set(i,r-1):(i.removeEventListener("focus",this._rootNodeFocusAndBlurListener,Qw),i.removeEventListener("blur",this._rootNodeFocusAndBlurListener,Qw),this._rootNodeFocusListenerCount.delete(i))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(e,i,r){this._setClasses(e,i),this._emitOrigin(r,i),this._lastFocusOrigin=i}_getClosestElementsInfo(e){const i=[];return this._elementInfo.forEach((r,s)=>{(s===e||r.checkChildren&&s.contains(e))&&i.push([s,r])}),i}_isLastInteractionFromInputLabel(e){const{_mostRecentTarget:i,mostRecentModality:r}=this._inputModalityDetector;if("mouse"!==r||!i||i===e||"INPUT"!==e.nodeName&&"TEXTAREA"!==e.nodeName||e.disabled)return!1;const s=e.labels;if(s)for(let d=0;d<s.length;d++)if(s[d].contains(i))return!0;return!1}}return n.\u0275fac=function(e){return new(e||n)(ze(qn),ze(cs),ze(FG),ze($n,8),ze(VG,8))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),jG=(()=>{class n{constructor(e,i){this._elementRef=e,this._focusMonitor=i,this._focusOrigin=null,this.cdkFocusChange=new nn}get focusOrigin(){return this._focusOrigin}ngAfterViewInit(){const e=this._elementRef.nativeElement;this._monitorSubscription=this._focusMonitor.monitor(e,1===e.nodeType&&e.hasAttribute("cdkMonitorSubtreeFocus")).subscribe(i=>{this._focusOrigin=i,this.cdkFocusChange.emit(i)})}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._monitorSubscription&&this._monitorSubscription.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)(G(Tn),G(fa))},n.\u0275dir=Lt({type:n,selectors:[["","cdkMonitorElementFocus",""],["","cdkMonitorSubtreeFocus",""]],outputs:{cdkFocusChange:"cdkFocusChange"},exportAs:["cdkMonitorFocus"]}),n})();const dO="cdk-high-contrast-black-on-white",hO="cdk-high-contrast-white-on-black",aD="cdk-high-contrast-active";let pO=(()=>{class n{constructor(e,i){this._platform=e,this._document=i,this._breakpointSubscription=Fr(iD).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return 0;const e=this._document.createElement("div");e.style.backgroundColor="rgb(1,2,3)",e.style.position="absolute",this._document.body.appendChild(e);const i=this._document.defaultView||window,r=i&&i.getComputedStyle?i.getComputedStyle(e):null,s=(r&&r.backgroundColor||"").replace(/ /g,"");switch(e.remove(),s){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return 2;case"rgb(255,255,255)":case"rgb(255,250,239)":return 1}return 0}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const e=this._document.body.classList;e.remove(aD,dO,hO),this._hasCheckedHighContrastMode=!0;const i=this.getHighContrastMode();1===i?e.add(aD,dO):2===i&&e.add(aD,hO)}}}return n.\u0275fac=function(e){return new(e||n)(ze(cs),ze($n))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),Sm=(()=>{class n{constructor(e){e._applyBodyHighContrastModeCssClasses()}}return n.\u0275fac=function(e){return new(e||n)(ze(pO))},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({imports:[Zw]}),n})();class lD{attach(t){return this._attachedHost=t,t.attach(this)}detach(){let t=this._attachedHost;null!=t&&(this._attachedHost=null,t.detach())}get isAttached(){return null!=this._attachedHost}setAttachedHost(t){this._attachedHost=t}}class od extends lD{constructor(t,e,i,r){super(),this.component=t,this.viewContainerRef=e,this.injector=i,this.componentFactoryResolver=r}}class Cm extends lD{constructor(t,e,i,r){super(),this.templateRef=t,this.viewContainerRef=e,this.context=i,this.injector=r}get origin(){return this.templateRef.elementRef}attach(t,e=this.context){return this.context=e,super.attach(t)}detach(){return this.context=void 0,super.detach()}}class UG extends lD{constructor(t){super(),this.element=t instanceof Tn?t.nativeElement:t}}class Sv{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(t){return t instanceof od?(this._attachedPortal=t,this.attachComponentPortal(t)):t instanceof Cm?(this._attachedPortal=t,this.attachTemplatePortal(t)):this.attachDomPortal&&t instanceof UG?(this._attachedPortal=t,this.attachDomPortal(t)):void 0}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(t){this._disposeFn=t}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}}class HG extends Sv{constructor(t,e,i,r,s){super(),this.outletElement=t,this._componentFactoryResolver=e,this._appRef=i,this._defaultInjector=r,this.attachDomPortal=d=>{const m=d.element,y=this._document.createComment("dom-portal");m.parentNode.insertBefore(y,m),this.outletElement.appendChild(m),this._attachedPortal=d,super.setDisposeFn(()=>{y.parentNode&&y.parentNode.replaceChild(m,y)})},this._document=s}attachComponentPortal(t){const i=(t.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(t.component);let r;return t.viewContainerRef?(r=t.viewContainerRef.createComponent(i,t.viewContainerRef.length,t.injector||t.viewContainerRef.injector),this.setDisposeFn(()=>r.destroy())):(r=i.create(t.injector||this._defaultInjector||Nr.NULL),this._appRef.attachView(r.hostView),this.setDisposeFn(()=>{this._appRef.viewCount>0&&this._appRef.detachView(r.hostView),r.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(r)),this._attachedPortal=t,r}attachTemplatePortal(t){let e=t.viewContainerRef,i=e.createEmbeddedView(t.templateRef,t.context,{injector:t.injector});return i.rootNodes.forEach(r=>this.outletElement.appendChild(r)),i.detectChanges(),this.setDisposeFn(()=>{let r=e.indexOf(i);-1!==r&&e.remove(r)}),this._attachedPortal=t,i}dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(t){return t.hostView.rootNodes[0]}}let sd=(()=>{class n extends Sv{constructor(e,i,r){super(),this._componentFactoryResolver=e,this._viewContainerRef=i,this._isInitialized=!1,this.attached=new nn,this.attachDomPortal=s=>{const d=s.element,m=this._document.createComment("dom-portal");s.setAttachedHost(this),d.parentNode.insertBefore(m,d),this._getRootNode().appendChild(d),this._attachedPortal=s,super.setDisposeFn(()=>{m.parentNode&&m.parentNode.replaceChild(d,m)})},this._document=r}get portal(){return this._attachedPortal}set portal(e){this.hasAttached()&&!e&&!this._isInitialized||(this.hasAttached()&&super.detach(),e&&super.attach(e),this._attachedPortal=e||null)}get attachedRef(){return this._attachedRef}ngOnInit(){this._isInitialized=!0}ngOnDestroy(){super.dispose(),this._attachedPortal=null,this._attachedRef=null}attachComponentPortal(e){e.setAttachedHost(this);const i=null!=e.viewContainerRef?e.viewContainerRef:this._viewContainerRef,s=(e.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(e.component),d=i.createComponent(s,i.length,e.injector||i.injector);return i!==this._viewContainerRef&&this._getRootNode().appendChild(d.hostView.rootNodes[0]),super.setDisposeFn(()=>d.destroy()),this._attachedPortal=e,this._attachedRef=d,this.attached.emit(d),d}attachTemplatePortal(e){e.setAttachedHost(this);const i=this._viewContainerRef.createEmbeddedView(e.templateRef,e.context,{injector:e.injector});return super.setDisposeFn(()=>this._viewContainerRef.clear()),this._attachedPortal=e,this._attachedRef=i,this.attached.emit(i),i}_getRootNode(){const e=this._viewContainerRef.element.nativeElement;return e.nodeType===e.ELEMENT_NODE?e:e.parentNode}}return n.\u0275fac=function(e){return new(e||n)(G(Gd),G(Fo),G($n))},n.\u0275dir=Lt({type:n,selectors:[["","cdkPortalOutlet",""]],inputs:{portal:["cdkPortalOutlet","portal"]},outputs:{attached:"attached"},exportAs:["cdkPortalOutlet"],features:[qt]}),n})(),oa=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({}),n})();class fO{constructor(t,e){this._parentInjector=t,this._customTokens=e}get(t,e){const i=this._customTokens.get(t);return void 0!==i?i:this._parentInjector.get(t,e)}}const $G=["addListener","removeListener"],GG=["addEventListener","removeEventListener"],qG=["on","off"];function au(n,t,e,i){if(be(e)&&(i=e,e=void 0),i)return au(n,t,e).pipe(ZT(i));const[r,s]=function ZG(n){return be(n.addEventListener)&&be(n.removeEventListener)}(n)?GG.map(d=>m=>n[d](t,m,e)):function WG(n){return be(n.addListener)&&be(n.removeListener)}(n)?$G.map(mO(n,t)):function XG(n){return be(n.on)&&be(n.off)}(n)?qG.map(mO(n,t)):[];if(!r&&Ne(n))return Gn(d=>au(d,t,e))(Fi(n));if(!r)throw new TypeError("Invalid event target");return new kt(d=>{const m=(...y)=>d.next(1<y.length?y:y[0]);return r(m),()=>s(m)})}function mO(n,t){return e=>i=>n[e](t,i)}const Cv={schedule(n){let t=requestAnimationFrame,e=cancelAnimationFrame;const{delegate:i}=Cv;i&&(t=i.requestAnimationFrame,e=i.cancelAnimationFrame);const r=t(s=>{e=void 0,n(s)});return new te(()=>null==e?void 0:e(r))},requestAnimationFrame(...n){const{delegate:t}=Cv;return((null==t?void 0:t.requestAnimationFrame)||requestAnimationFrame)(...n)},cancelAnimationFrame(...n){const{delegate:t}=Cv;return((null==t?void 0:t.cancelAnimationFrame)||cancelAnimationFrame)(...n)},delegate:void 0};new class KG extends tD{flush(t){this._active=!0;const e=this._scheduled;this._scheduled=void 0;const{actions:i}=this;let r;t=t||i.shift();do{if(r=t.execute(t.state,t.delay))break}while((t=i[0])&&t.id===e&&i.shift());if(this._active=!1,r){for(;(t=i[0])&&t.id===e&&i.shift();)t.unsubscribe();throw r}}}(class YG extends eD{constructor(t,e){super(t,e),this.scheduler=t,this.work=e}requestAsyncId(t,e,i=0){return null!==i&&i>0?super.requestAsyncId(t,e,i):(t.actions.push(this),t._scheduled||(t._scheduled=Cv.requestAnimationFrame(()=>t.flush(void 0))))}recycleAsyncId(t,e,i=0){var r;if(null!=i?i>0:this.delay>0)return super.recycleAsyncId(t,e,i);const{actions:s}=t;null!=e&&(null===(r=s[s.length-1])||void 0===r?void 0:r.id)!==e&&(Cv.cancelAnimationFrame(e),t._scheduled=void 0)}});let cD,JG=1;const Jw={};function gO(n){return n in Jw&&(delete Jw[n],!0)}const eq={setImmediate(n){const t=JG++;return Jw[t]=!0,cD||(cD=Promise.resolve()),cD.then(()=>gO(t)&&n()),t},clearImmediate(n){gO(n)}},{setImmediate:tq,clearImmediate:nq}=eq,eS={setImmediate(...n){const{delegate:t}=eS;return((null==t?void 0:t.setImmediate)||tq)(...n)},clearImmediate(n){const{delegate:t}=eS;return((null==t?void 0:t.clearImmediate)||nq)(n)},delegate:void 0};new class rq extends tD{flush(t){this._active=!0;const e=this._scheduled;this._scheduled=void 0;const{actions:i}=this;let r;t=t||i.shift();do{if(r=t.execute(t.state,t.delay))break}while((t=i[0])&&t.id===e&&i.shift());if(this._active=!1,r){for(;(t=i[0])&&t.id===e&&i.shift();)t.unsubscribe();throw r}}}(class iq extends eD{constructor(t,e){super(t,e),this.scheduler=t,this.work=e}requestAsyncId(t,e,i=0){return null!==i&&i>0?super.requestAsyncId(t,e,i):(t.actions.push(this),t._scheduled||(t._scheduled=eS.setImmediate(t.flush.bind(t,void 0))))}recycleAsyncId(t,e,i=0){var r;if(null!=i?i>0:this.delay>0)return super.recycleAsyncId(t,e,i);const{actions:s}=t;null!=e&&(null===(r=s[s.length-1])||void 0===r?void 0:r.id)!==e&&(eS.clearImmediate(e),t._scheduled=void 0)}});function uD(n=0,t,e=cG){let i=-1;return null!=t&&(ya(t)?e=t:i=t),new kt(r=>{let s=function aq(n){return n instanceof Date&&!isNaN(n)}(n)?+n-e.now():n;s<0&&(s=0);let d=0;return e.schedule(function(){r.closed||(r.next(d++),0<=i?this.schedule(void 0,i):r.complete())},s)})}function bO(n,t=Ww){return function sq(n){return Di((t,e)=>{let i=!1,r=null,s=null,d=!1;const m=()=>{if(null==s||s.unsubscribe(),s=null,i){i=!1;const C=r;r=null,e.next(C)}d&&e.complete()},y=()=>{s=null,d&&e.complete()};t.subscribe(Ci(e,C=>{i=!0,r=C,s||Fi(n(C)).subscribe(s=Ci(e,m,y))},()=>{d=!0,(!i||!s||s.closed)&&e.complete()}))})}(()=>uD(n,t))}const lq=new Et("cdk-dir-doc",{providedIn:"root",factory:function cq(){return Fr($n)}}),uq=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;let Lp=(()=>{class n{constructor(e){if(this.value="ltr",this.change=new nn,e){const r=e.documentElement?e.documentElement.dir:null;this.value=function dq(n){const t=(null==n?void 0:n.toLowerCase())||"";return"auto"===t&&"undefined"!=typeof navigator&&(null==navigator?void 0:navigator.language)?uq.test(navigator.language)?"rtl":"ltr":"rtl"===t?"rtl":"ltr"}((e.body?e.body.dir:null)||r||"ltr")}}ngOnDestroy(){this.change.complete()}}return n.\u0275fac=function(e){return new(e||n)(ze(lq,8))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),tS=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({}),n})(),_O=(()=>{class n{constructor(e,i,r){this._ngZone=e,this._platform=i,this._scrolled=new Zt,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=r}register(e){this.scrollContainers.has(e)||this.scrollContainers.set(e,e.elementScrolled().subscribe(()=>this._scrolled.next(e)))}deregister(e){const i=this.scrollContainers.get(e);i&&(i.unsubscribe(),this.scrollContainers.delete(e))}scrolled(e=20){return this._platform.isBrowser?new kt(i=>{this._globalSubscription||this._addGlobalListener();const r=e>0?this._scrolled.pipe(bO(e)).subscribe(i):this._scrolled.subscribe(i);return this._scrolledCount++,()=>{r.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):Rn()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((e,i)=>this.deregister(i)),this._scrolled.complete()}ancestorScrolled(e,i){const r=this.getAncestorScrollContainers(e);return this.scrolled(i).pipe(Cr(s=>!s||r.indexOf(s)>-1))}getAncestorScrollContainers(e){const i=[];return this.scrollContainers.forEach((r,s)=>{this._scrollableContainsElement(s,e)&&i.push(s)}),i}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(e,i){let r=xm(i),s=e.getElementRef().nativeElement;do{if(r==s)return!0}while(r=r.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>au(this._getWindow().document,"scroll").subscribe(()=>this._scrolled.next()))}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}}return n.\u0275fac=function(e){return new(e||n)(ze(qn),ze(cs),ze($n,8))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),lu=(()=>{class n{constructor(e,i,r){this._platform=e,this._change=new Zt,this._changeListener=s=>{this._change.next(s)},this._document=r,i.runOutsideAngular(()=>{if(e.isBrowser){const s=this._getWindow();s.addEventListener("resize",this._changeListener),s.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){const e=this._getWindow();e.removeEventListener("resize",this._changeListener),e.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();const e={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),e}getViewportRect(){const e=this.getViewportScrollPosition(),{width:i,height:r}=this.getViewportSize();return{top:e.top,left:e.left,bottom:e.top+r,right:e.left+i,height:r,width:i}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};const e=this._document,i=this._getWindow(),r=e.documentElement,s=r.getBoundingClientRect();return{top:-s.top||e.body.scrollTop||i.scrollY||r.scrollTop||0,left:-s.left||e.body.scrollLeft||i.scrollX||r.scrollLeft||0}}change(e=20){return e>0?this._change.pipe(bO(e)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){const e=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:e.innerWidth,height:e.innerHeight}:{width:0,height:0}}}return n.\u0275fac=function(e){return new(e||n)(ze(cs),ze(qn),ze($n,8))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),Tm=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({}),n})(),dD=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({imports:[tS,Tm,tS,Tm]}),n})();const fq=["*",[["sbb-option"],["ng-container"],["sbb-option-hint"],["sbb-autocomplete-hint"]]],mq=["*","sbb-option, ng-container, sbb-option-hint, sbb-autocomplete-hint"];function gq(n,t){if(1&n&&ln(0,"sbb-pseudo-checkbox",2),2&n){const e=Yt();Je("disabled",e.disabled)("state",e.selected?"checked":"unchecked")}}function bq(n,t){if(1&n&&(oe(0,"span",3),$e(1),de()),2&n){const e=Yt();Le(1),wr("(",e.group.label,")")}}const _q=["*"],yq=(new Kc("14.1.7"),"undefined"!=typeof globalThis&&globalThis),vq="undefined"!=typeof window&&window,xq="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,hD=yq||"undefined"!=typeof global&&global||vq||xq,pD=function(n,...t){if(pD.translate){const i=pD.translate(n,t);n=i[0],t=i[1]}let e=wO(n[0],n.raw[0]);for(let i=1;i<n.length;i++)e+=t[i-1]+wO(n[i],n.raw[i]);return e};function wO(n,t){return":"===t.charAt(0)?n.substring(function wq(n,t){for(let e=1,i=1;e<n.length;e++,i++)if("\\"===t[i])i++;else if(":"===n[e])return e;throw new Error(`Unterminated $localize metadata block in "${t}".`)}(n,t)+1):n}const fD=new ta("standard");function Em(n){return class extends n{constructor(...t){super(...t),this.variant=fD}get variantSnapshot(){return fD.value}}}const Cq=new Et("sbb-sanity-checks",{providedIn:"root",factory:function Sq(){return!0}});let Wi=(()=>{class n{constructor(e,i,r){this._sanityChecks=i,this._document=r,this._hasDoneGlobalChecks=!1,fD.next(this._document.documentElement.classList.contains("sbb-lean")?"lean":"standard"),e._applyBodyHighContrastModeCssClasses(),function Tq(){"function"!=typeof hD.$localize&&(hD.$localize=Object.assign(pD,hD.$localize))}(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(e){return!ZE()&&("boolean"==typeof this._sanityChecks?this._sanityChecks:!!this._sanityChecks[e])}}return n.\u0275fac=function(e){return new(e||n)(ze(pO),ze(Cq,8),ze($n))},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({}),n})();function Ga(n){return class extends n{constructor(...t){super(...t),this._disabled=!1}get disabled(){return this._disabled}set disabled(t){this._disabled=jn(t)}}}function nS(n){return class extends n{constructor(...t){super(...t),this.errorState=!1}updateErrorState(){const t=this.errorState,s=(this.errorStateMatcher||this._defaultErrorStateMatcher).isErrorState(this.ngControl?this.ngControl.control:null,this._parentFormGroup||this._parentForm);s!==t&&(this.errorState=s,this.stateChanges.next())}}}function SO(n){return class extends n{constructor(...t){super(...t),this._isInitialized=!1,this._pendingSubscribers=[],this.initialized=new kt(e=>{this._isInitialized?this._notifySubscriber(e):this._pendingSubscribers.push(e)})}_markInitialized(){this._isInitialized=!0,this._pendingSubscribers.forEach(this._notifySubscriber),this._pendingSubscribers=null}_notifySubscriber(t){t.next(),t.complete()}}}function $b(n,t=0){return class extends n{constructor(...e){super(...e),this._tabIndex=t,this.defaultTabIndex=t}get tabIndex(){return this.disabled?-1:this._tabIndex}set tabIndex(e){this._tabIndex=null!=e?gh(e):this.defaultTabIndex}}}class Op{deserialize(t){return null==t||this.isDateInstance(t)&&this.isValid(t)?t:this.invalid()}setLocale(t){this._locale=t}compareDate(t,e){return this.getYear(t)-this.getYear(e)||this.getMonth(t)-this.getMonth(e)||this.getDate(t)-this.getDate(e)}sameDate(t,e){if(t&&e){const i=this.isValid(t),r=this.isValid(e);return i&&r?!this.compareDate(t,e):i===r}return t===e}clampDate(t,e,i){return e&&this.compareDate(t,e)<0?e:i&&this.compareDate(t,i)>0?i:t}}const iS=new Et("sbb-date-formats"),Eq={dateInput:"EEEEEE, dd.MM.yyyy",dateInputPure:"dd.MM.yyyy",dateA11yLabel:"dd MM yyyy"},CO=new Et("SBB_DATEPICKER_2DIGIT_YEAR_PIVOT"),Dq=/^\d{4}-\d{2}-\d{2}(?:T\d{2}:\d{2}:\d{2}(?:\.\d+)?(?:Z|(?:(?:\+|-)\d{2}:\d{2}))?)?$/;function mD(n,t){const e=Array(n);for(let i=0;i<n;i++)e[i]=t(i);return e}let TO=(()=>{class n extends Op{constructor(e,i){super(),this._locale=e,this._titleCasePipe=new Wk,this._datePipe=new Xk(e),this._yearPivot="number"==typeof i?i:(new Date).getFullYear()-1975}getYear(e){return e.getFullYear()}getMonth(e){return e.getMonth()}getDate(e){return e.getDate()}getDayOfWeek(e){return e.getDay()}getMonthName(e){return this._datePipe.transform(e,"LLLL")}getMonthNames(e){let i;switch(e){case"long":i="LLLL";break;case"narrow":i="LLLLL";break;default:i="LLL"}return mD(12,r=>this._datePipe.transform(new Date(2017,r,1),i))}getDateNames(){return mD(31,e=>this._datePipe.transform(new Date(2017,0,e+1),"d"))}getDayOfWeekNames(e){let i;switch(e){case"long":i="EEEE";break;case"narrow":i="EEEEE";break;default:i="EEE"}return mD(7,r=>this._datePipe.transform(new Date(2017,0,r+1),i))}getYearName(e){return this._datePipe.transform(e,"yyyy")}getFirstDayOfWeek(){return 1}getNumDaysInMonth(e){const i=new Date(0);return i.setFullYear(e.getFullYear(),e.getMonth()+1,0),i.setHours(0,0,0,0),i.getDate()}clone(e){return new Date(e.valueOf())}createDate(e,i,r){if(i<0||i>11)throw Error(`Invalid month index "${i}". Month index has to be between 0 and 11.`);if(r<1)throw Error(`Invalid date "${r}". Date has to be greater than 0.`);const s=this._createDateWithOverflow(e,i,r);if(s.getMonth()!==i)throw Error(`Invalid date "${r}" for month with index "${i}".`);return s}today(){const e=new Date;return e.setHours(0,0,0,0),e}parse(e){return"number"==typeof e?new Date(e):"string"==typeof e?this._parseStringDate(e):null}format(e,i){if(!this.isValid(e))throw Error("NativeDateAdapter: Cannot format invalid date.");return this._titleCasePipe.transform(this._datePipe.transform(e,i))}addCalendarYears(e,i){return this.addCalendarMonths(e,12*i)}addCalendarMonths(e,i){const r=e.getMonth()+i,s=new Date(0);s.setFullYear(e.getFullYear(),r,1),s.setHours(0,0,0,0);const d=this.getNumDaysInMonth(s),m=this.clone(e);return m.setMonth(r,Math.min(d,e.getDate())),m}addCalendarDays(e,i){const r=this.clone(e);return r.setDate(r.getDate()+i),r}toIso8601(e){return this._datePipe.transform(e,"yyyy-MM-dd")}deserialize(e){if("string"==typeof e){if(!e)return null;if(Dq.test(e)){const i=new Date(e);if(this.isValid(i))return i}}return super.deserialize(e)}isDateInstance(e){return e instanceof Date}isValid(e){return!isNaN(e.valueOf())}invalid(){return new Date(NaN)}_parseStringDate(e){const i=/^(\w+,[ ]?)?(\d+)\.(\d+)\.(\d+)$/.exec(e);if(!i)return null;const r=this._createDateWithOverflow(+i[4],+i[3]-1,+i[2]);return this._normalizeYear(r)}_normalizeYear(e){if(e.getFullYear()<0||e.getFullYear()>=100)return e;const i=e.getFullYear()<=this._yearPivot?2e3:1900;return new Date(e.getFullYear()+i,e.getMonth(),e.getDate())}_createDateWithOverflow(e,i,r){const s=new Date(e,i,r);return e>=0&&e<100&&s.setFullYear(this.getYear(s)-1900),s}}return n.\u0275fac=function(e){return new(e||n)(ze(Vl),ze(CO,8))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})(),gD=(()=>{class n{isErrorState(e,i){return!!(e&&e.invalid&&(e.touched||i&&i.submitted))}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const rS=new Et("SBB_OPTION_PARENT_COMPONENT"),Iq=Ga(class{});let Mq=0;const EO=new Et("SbbOptgroup");let bD=(()=>{class n extends Iq{constructor(e){var i;super(),this._labelId="sbb-optgroup-label-"+Mq++,this._inert=null!==(i=null==e?void 0:e.inertGroups)&&void 0!==i&&i}}return n.\u0275fac=function(e){return new(e||n)(G(rS,8))},n.\u0275cmp=vn({type:n,selectors:[["sbb-optgroup"]],hostAttrs:[1,"sbb-optgroup","sbb-menu-group"],hostVars:5,hostBindings:function(e,i){2&e&&(fn("role",i._inert?null:"group")("aria-disabled",i._inert?null:i.disabled.toString())("aria-labelledby",i._inert?null:i._labelId),Ri("sbb-disabled",i.disabled))},inputs:{disabled:"disabled",label:"label"},exportAs:["sbbOptgroup"],features:[Vn([{provide:EO,useExisting:n}]),qt],ngContentSelectors:mq,decls:4,vars:2,consts:[[1,"sbb-label","sbb-optgroup-label",3,"id"]],template:function(e,i){1&e&&(Mo(fq),oe(0,"label",0),$e(1),Pr(2),de(),Pr(3,1)),2&e&&(Je("id",i._labelId),Le(1),wr("",i.label," "))},encapsulation:2,changeDetection:0}),n})(),Aq=(()=>{class n{constructor(){this.state="unchecked",this.disabled=!1}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=vn({type:n,selectors:[["sbb-pseudo-checkbox"]],hostAttrs:[1,"sbb-pseudo-checkbox"],hostVars:6,hostBindings:function(e,i){2&e&&Ri("sbb-selection-disabled",i.disabled)("sbb-selection-checked","checked"===i.state)("sbb-selection-indeterminate","indeterminate"===i.state)},inputs:{state:"state",disabled:"disabled"},decls:4,vars:0,consts:[[1,"sbb-selection-container"],[1,"sbb-selection-container-checked"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","focusable","false"],["fill","none","fill-rule","evenodd","stroke","#000","stroke-width","1","points","6 12 10 16 19 7.01"]],template:function(e,i){1&e&&(oe(0,"div",0)(1,"span",1),F(),oe(2,"svg",2),ln(3,"polyline",3),de()()())},encapsulation:2,changeDetection:0}),n})(),kq=0;class DO{constructor(t,e=!1){this.source=t,this.isUserInput=e}}let Tv=(()=>{class n{constructor(e,i,r,s,d){this._element=e,this._document=i,this._changeDetectorRef=r,this._parent=s,this.group=d,this._selected=!1,this._active=!1,this._disabled=!1,this._mostRecentViewValue="",this._highlighted=!1,this.id="sbb-option-"+kq++,this.onSelectionChange=new nn,this._stateChanges=new Zt}get multiple(){return this._parent&&this._parent.multiple}get selected(){return this._selected}get disabled(){return this.group&&this.group.disabled||this._disabled}set disabled(e){this._disabled=jn(e),this._changeDetectorRef.markForCheck()}get active(){return this._active}get viewValue(){return(this._getHostElement().textContent||"").trim()}select(){this.selected||(this._selected=!0,this._changeDetectorRef.markForCheck(),this._emitSelectionChangeEvent())}deselect(){this._selected&&(this._selected=!1,this._changeDetectorRef.markForCheck(),this._emitSelectionChangeEvent())}focus(e,i){const r=this._getHostElement();"function"==typeof r.focus&&r.focus(i)}setActiveStyles(){this.active||(this._active=!0,this._changeDetectorRef.markForCheck())}setInactiveStyles(){this.active&&(this._active=!1,this._changeDetectorRef.markForCheck())}getLabel(){return this.viewValue}_handleKeydown(e){(13===e.keyCode||32===e.keyCode)&&!ra(e)&&(this._selectViaInteraction(),e.preventDefault())}_selectViaInteraction(){this.disabled||(this._selected=!this.multiple||!this.selected,this._changeDetectorRef.markForCheck(),this._emitSelectionChangeEvent(!0))}_getAriaSelected(){return this.selected||!this.multiple&&null}_getTabIndex(){return this.disabled?"-1":"0"}_getHostElement(){return this._element.nativeElement}ngAfterViewChecked(){if(this._selected){const e=this.viewValue;e!==this._mostRecentViewValue&&(this._mostRecentViewValue=e,this._stateChanges.next())}}ngOnDestroy(){this._stateChanges.complete()}_highlight(e,i){if(void 0===this._originalInnerHtml)this._originalInnerHtml=this._element.nativeElement.innerHTML;else{if(e===this._highlightValue)return;this._highlighted&&(this._element.nativeElement.innerHTML=this._originalInnerHtml,this._highlighted=!1)}if(this._highlightValue=e,e&&this._originalInnerHtml){const r=i||(y=>y),s=(e=r(e)).replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),d=new RegExp(`${s}+`,"i"),m=this._findAllTextNodesWithMatch(d,r);m.forEach(y=>this._highlightNode(y,d,r)),this._highlighted=!!m.length}}_findAllTextNodesWithMatch(e,i,r=this._element.nativeElement){const s=[],d=r.childNodes;for(let m=0;m<d.length;m++){const y=d[m];3===y.nodeType&&e.test(i(y.textContent||""))?s.push(y):y.childNodes.length&&s.push(...this._findAllTextNodesWithMatch(e,i,y))}return s}_highlightNode(e,i,r){const s=[],d=this._document;i.lastIndex=0;let y,m=e.textContent||"";do{if(y=r(m).match(i),!y){s.push(d.createTextNode(m));continue}y.index&&(s.push(d.createTextNode(m.substring(0,y.index))),m=m.substring(y.index));const M=d.createElement("strong");M.textContent=m.substring(0,y[0].length),s.push(M),m=m.substring(y[0].length)}while(y);const C=e.parentNode;s.forEach(M=>C.insertBefore(M,e)),C.removeChild(e)}_emitSelectionChangeEvent(e=!1){this.onSelectionChange.emit(new DO(this,e))}}return n.\u0275fac=function(e){return new(e||n)(G(Tn),G($n),G(Sr),G(rS,8),G(EO,8))},n.\u0275cmp=vn({type:n,selectors:[["sbb-option"]],hostAttrs:["role","option",1,"sbb-option","sbb-menu-item","sbb-link-reset"],hostVars:12,hostBindings:function(e,i){1&e&&Qt("keydown",function(s){return i._handleKeydown(s)})("click",function(){return i._selectViaInteraction()}),2&e&&(vc("id",i.id),fn("tabindex",i._getTabIndex())("aria-selected",i._getAriaSelected())("aria-disabled",i.disabled.toString()),Ri("sbb-selected",i.selected)("sbb-option-multiple",i.multiple)("sbb-focused",i.active)("sbb-disabled",i.disabled))},inputs:{value:"value",id:"id",disabled:"disabled"},outputs:{onSelectionChange:"onSelectionChange"},exportAs:["sbbOption"],ngContentSelectors:_q,decls:3,vars:2,consts:[[3,"disabled","state",4,"ngIf"],["class","cdk-visually-hidden",4,"ngIf"],[3,"disabled","state"],[1,"cdk-visually-hidden"]],template:function(e,i){1&e&&(Mo(),$t(0,gq,1,2,"sbb-pseudo-checkbox",0),Pr(1),$t(2,bq,2,1,"span",1)),2&e&&(Je("ngIf",i.multiple),Le(2),Je("ngIf",i.group&&i.group._inert))},dependencies:[Ts,Aq],styles:[".sbb-option.sbb-menu-item{cursor:default}.sbb-pseudo-checkbox{display:inline-block;margin-right:calc(0.5333333333rem * var(--sbb-scaling-factor));margin-bottom:calc(-0.3rem * var(--sbb-scaling-factor));overflow:hidden;line-height:0}.sbb-pseudo-checkbox .sbb-selection-container{margin:0}"],encapsulation:2,changeDetection:0}),n})();function IO(n,t,e,i){return n<e?n:n+t>e+i?Math.max(0,n-i+t):e}let Pq=0,Lq=(()=>{class n{constructor(){this.id="sbb-option-hint-"+Pq++}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=Lt({type:n,selectors:[["sbb-option-hint"]],hostAttrs:[1,"sbb-option-hint","sbb-label"],hostVars:1,hostBindings:function(e,i){2&e&&fn("id",i.id)}}),n})(),oS=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({imports:[gr,Wi]}),n})();const Oq=["*"];let sS;function Ev(n){var t;return(null===(t=function Fq(){if(void 0===sS&&(sS=null,"undefined"!=typeof window)){const n=window;void 0!==n.trustedTypes&&(sS=n.trustedTypes.createPolicy("sbb-esta#angular",{createHTML:t=>t}))}return sS}())||void 0===t?void 0:t.createHTML(n))||n}function MO(n){return Error(`Unable to find icon with the name "${n}"`)}function AO(n){return Error(`The URL provided to SbbIconRegistry was not trusted as a resource URL via Angular's DomSanitizer. Attempted URL was "${n}".`)}function kO(n){return Error(`The literal provided to SbbIconRegistry was not trusted as safe HTML by Angular's DomSanitizer. Attempted literal was "${n}".`)}class Fp{constructor(t,e,i){this.url=t,this.svgText=e,this.options=i}}let Bq=(()=>{class n{constructor(e,i,r,s){this._httpClient=e,this._sanitizer=i,this._errorHandler=s,this._svgIconConfigs=new Map,this._iconSetConfigs=new Map,this._cachedIconsByUrl=new Map,this._inProgressUrlFetches=new Map,this._fontCssClassesByAlias=new Map,this._resolvers=[],this._defaultFontSetClass=["sbb-icons"],this._sbbCdnSupportedNamespaces=["kom","fpl"],this._document=r}addSvgIcon(e,i,r){return this.addSvgIconInNamespace("",e,i,r)}addSvgIconLiteral(e,i,r){return this.addSvgIconLiteralInNamespace("",e,i,r)}addSvgIconInNamespace(e,i,r,s){return this._addSvgIconConfig(e,i,new Fp(r,null,s))}addSvgIconResolver(e){return this._resolvers.push(e),this}addSvgIconLiteralInNamespace(e,i,r,s){const d=this._sanitizer.sanitize(sr.HTML,r);if(!d)throw kO(r);const m=Ev(d);return this._addSvgIconConfig(e,i,new Fp("",m,s))}addSvgIconSet(e,i){return this.addSvgIconSetInNamespace("",e,i)}addSvgIconSetLiteral(e,i){return this.addSvgIconSetLiteralInNamespace("",e,i)}addSvgIconSetInNamespace(e,i,r){return this._addSvgIconSetConfig(e,new Fp(i,null,r))}addSvgIconSetLiteralInNamespace(e,i,r){const s=this._sanitizer.sanitize(sr.HTML,i);if(!s)throw kO(i);const d=Ev(s);return this._addSvgIconSetConfig(e,new Fp("",d,r))}registerFontClassAlias(e,i=e){return this._fontCssClassesByAlias.set(e,i),this}classNameForFontAlias(e){return this._fontCssClassesByAlias.get(e)||e}setDefaultFontSetClass(...e){return this._defaultFontSetClass=e,this}getDefaultFontSetClass(){return this._defaultFontSetClass}getSvgIconFromUrl(e){const i=this._sanitizer.sanitize(sr.RESOURCE_URL,e);if(!i)throw AO(e);const r=this._cachedIconsByUrl.get(i);return r?Rn(aS(r)):this._loadSvgIconFromConfig(new Fp(e,null)).pipe(No(s=>this._cachedIconsByUrl.set(i,s)),W(s=>aS(s)))}getNamedSvgIcon(e,i=""){const r=RO(i,e);let s=this._svgIconConfigs.get(r);if(s)return this._getSvgFromConfig(s);if(s=this._getIconConfigFromResolvers(i,e),s)return this._svgIconConfigs.set(r,s),this._getSvgFromConfig(s);const d=this._iconSetConfigs.get(i);return d?this._getSvgFromIconSetConfigs(e,d):kb(MO(r))}ngOnDestroy(){this._resolvers=[],this._svgIconConfigs.clear(),this._iconSetConfigs.clear(),this._cachedIconsByUrl.clear()}_getSvgFromConfig(e){return e.svgText?Rn(aS(this._svgElementFromConfig(e))):this._loadSvgIconFromConfig(e).pipe(W(i=>aS(i)))}_getSvgFromIconSetConfigs(e,i){const r=this._extractIconWithNameFromAnySet(e,i);return r?Rn(r):EP(i.filter(d=>!d.svgText).map(d=>this._loadSvgIconSetFromConfig(d).pipe(dh(m=>{const C=`Loading icon set URL: ${this._sanitizer.sanitize(sr.RESOURCE_URL,d.url)} failed: ${m.message}`;return this._errorHandler.handleError(new Error(C)),Rn(null)})))).pipe(W(()=>{const d=this._extractIconWithNameFromAnySet(e,i);if(!d)throw MO(e);return d}))}_extractIconWithNameFromAnySet(e,i){for(let r=i.length-1;r>=0;r--){const s=i[r];if(s.svgText&&s.svgText.toString().indexOf(e)>-1){const d=this._svgElementFromConfig(s),m=this._extractSvgIconFromSet(d,e,s.options);if(m)return m}}return null}_loadSvgIconFromConfig(e){return this._fetchIcon(e).pipe(No(i=>e.svgText=i),W(()=>this._svgElementFromConfig(e)))}_loadSvgIconSetFromConfig(e){return e.svgText?Rn(null):this._fetchIcon(e).pipe(No(i=>e.svgText=i))}_extractSvgIconFromSet(e,i,r){const s=e.querySelector(`[id="${i}"]`);if(!s)return null;const d=s.cloneNode(!0);if(d.removeAttribute("id"),"svg"===d.nodeName.toLowerCase())return this._setSvgAttributes(d,r);if("symbol"===d.nodeName.toLowerCase())return this._setSvgAttributes(this._toSvgElement(d),r);const m=this._svgElementFromString(Ev("<svg></svg>"));return m.appendChild(d),this._setSvgAttributes(m,r)}_svgElementFromString(e){const i=this._document.createElement("DIV");i.innerHTML=e;const r=i.querySelector("svg");if(!r)throw Error("<svg> tag not found");return r}_toSvgElement(e){const i=this._svgElementFromString(Ev("<svg></svg>")),r=e.attributes;for(let s=0;s<r.length;s++){const{name:d,value:m}=r[s];"id"!==d&&i.setAttribute(d,m)}for(let s=0;s<e.childNodes.length;s++)e.childNodes[s].nodeType===this._document.ELEMENT_NODE&&i.appendChild(e.childNodes[s].cloneNode(!0));return i}_setSvgAttributes(e,i){return e.setAttribute("fit",""),e.setAttribute("preserveAspectRatio","xMidYMid meet"),e.setAttribute("focusable","false"),i&&i.viewBox&&e.setAttribute("viewBox",i.viewBox),e}_fetchIcon(e){var i;const{url:r,options:s}=e,d=null!==(i=null==s?void 0:s.withCredentials)&&void 0!==i&&i;if(!this._httpClient)throw function Nq(){return Error("Could not find HttpClient provider for use with Sbb Angular icons. Please include the HttpClientModule from @angular/common/http in your app imports.")}();if(null==r)throw Error(`Cannot fetch icon from URL "${r}".`);const m=this._sanitizer.sanitize(sr.RESOURCE_URL,r);if(!m)throw AO(r);const y=this._inProgressUrlFetches.get(m);if(y)return y;const C=this._httpClient.get(m,{responseType:"text",withCredentials:d}).pipe(W(M=>Ev(M)),Sw(()=>this._inProgressUrlFetches.delete(m)),un());return this._inProgressUrlFetches.set(m,C),C}_addSvgIconConfig(e,i,r){return this._svgIconConfigs.set(RO(e,i),r),this}_addSvgIconSetConfig(e,i){const r=this._iconSetConfigs.get(e);return r?r.push(i):this._iconSetConfigs.set(e,[i]),this}_svgElementFromConfig(e){if(!e.svgElement){const i=this._svgElementFromString(e.svgText);this._setSvgAttributes(i,e.options),e.svgElement=i}return e.svgElement}_getIconConfigFromResolvers(e,i){for(let r=0;r<this._resolvers.length;r++){const s=this._resolvers[r](i,e);if(s)return zq(s)?new Fp(s.url,null,s.options):new Fp(s,null)}if(-1!==this._sbbCdnSupportedNamespaces.indexOf(e)){const r=this._sanitizer.bypassSecurityTrustResourceUrl(`https://icons.app.sbb.ch/${e}/${i}.svg`);return new Fp(r,null)}}}return n.\u0275fac=function(e){return new(e||n)(ze(yP,8),ze(wR),ze($n,8),ze(ul))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function aS(n){return n.cloneNode(!0)}function RO(n,t){return n+":"+t}function zq(n){return!(!n.url||!n.options)}const Vq=new Et("sbb-icon-location",{providedIn:"root",factory:function jq(){const n=Fr($n),t=n?n.location:null;return{getPathname:()=>t?t.pathname+t.search:""}}}),PO=["clip-path","color-profile","src","cursor","fill","filter","marker","marker-start","marker-mid","marker-end","mask","stroke"],Uq=PO.map(n=>`[${n}]`).join(", "),Hq=/^url\(['"]?#(.*?)['"]?\)$/;let qa=(()=>{class n{constructor(e,i,r,s,d){this._elementRef=e,this._iconRegistry=i,this._location=s,this._errorHandler=d,this._inline=!1,this._previousFontSetClass=[],this._currentIconFetch=te.EMPTY,r||this._elementRef.nativeElement.setAttribute("aria-hidden","true")}get inline(){return this._inline}set inline(e){this._inline=jn(e)}get svgIcon(){return this._svgIcon}set svgIcon(e){e!==this._svgIcon&&(e?this._updateSvgIcon(e):this._svgIcon&&this._clearSvgElement(),this._svgIcon=e)}get fontSet(){return this._fontSet}set fontSet(e){const i=this._cleanupFontValue(e);i!==this._fontSet&&(this._fontSet=i,this._updateFontIconClasses())}get fontIcon(){return this._fontIcon}set fontIcon(e){const i=this._cleanupFontValue(e);i!==this._fontIcon&&(this._fontIcon=i,this._updateFontIconClasses())}_splitIconName(e){if(!e)return["",""];const i=e.split(":");switch(i.length){case 1:return["",i[0]];case 2:return i;default:throw Error(`Invalid icon name: "${e}"`)}}ngOnInit(){this._updateFontIconClasses()}ngAfterViewChecked(){const e=this._elementsWithExternalReferences;if(e&&e.size){const i=this._location.getPathname();i!==this._previousPath&&(this._previousPath=i,this._prependPathToReferences(i))}}ngOnDestroy(){this._currentIconFetch.unsubscribe(),this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear()}_usingFontIcon(){return!this.svgIcon}_setSvgElement(e){this._clearSvgElement();const i=this._location.getPathname();this._previousPath=i,this._cacheChildrenWithExternalReferences(e),this._prependPathToReferences(i),this._elementRef.nativeElement.appendChild(e)}_clearSvgElement(){const e=this._elementRef.nativeElement;let i=e.childNodes.length;for(this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear();i--;){const r=e.childNodes[i];(1!==r.nodeType||"svg"===r.nodeName.toLowerCase())&&r.remove()}}_updateFontIconClasses(){if(!this._usingFontIcon())return;const e=this._elementRef.nativeElement,i=(this.fontSet?[this._iconRegistry.classNameForFontAlias(this.fontSet)]:this._iconRegistry.getDefaultFontSetClass()).filter(r=>r.length>0);this._previousFontSetClass.forEach(r=>e.classList.remove(r)),i.forEach(r=>e.classList.add(r)),this._previousFontSetClass=i,this.fontIcon!==this._previousFontIconClass&&(this._previousFontIconClass&&e.classList.remove(this._previousFontIconClass),this.fontIcon&&e.classList.add(this.fontIcon),this._previousFontIconClass=this.fontIcon)}_cleanupFontValue(e){return"string"==typeof e?e.trim().split(" ")[0]:e}_prependPathToReferences(e){const i=this._elementsWithExternalReferences;i&&i.forEach((r,s)=>{r.forEach(d=>{s.setAttribute(d.name,`url('${e}#${d.value}')`)})})}_cacheChildrenWithExternalReferences(e){const i=e.querySelectorAll(Uq),r=this._elementsWithExternalReferences=this._elementsWithExternalReferences||new Map;for(let s=0;s<i.length;s++)PO.forEach(d=>{const m=i[s],y=m.getAttribute(d),C=y?y.match(Hq):null;if(C){let M=r.get(m);M||(M=[],r.set(m,M)),M.push({name:d,value:C[1]})}})}_updateSvgIcon(e){if(this._svgNamespace=null,this._svgName=null,this._currentIconFetch.unsubscribe(),e){const[i,r]=this._splitIconName(e);i&&(this._svgNamespace=i),r&&(this._svgName=r),this._currentIconFetch=this._iconRegistry.getNamedSvgIcon(r,i).pipe(Vr(1)).subscribe(s=>this._setSvgElement(s),s=>{this._errorHandler.handleError(new Error(`Error retrieving icon ${i}:${r}! ${s.message}`))})}}}return n.\u0275fac=function(e){return new(e||n)(G(Tn),G(Bq),Uo("aria-hidden"),G(Vq),G(ul))},n.\u0275cmp=vn({type:n,selectors:[["sbb-icon"]],hostAttrs:["role","img",1,"sbb-icon","notranslate"],hostVars:5,hostBindings:function(e,i){2&e&&(fn("data-sbb-icon-type",i._usingFontIcon()?"font":"svg")("data-sbb-icon-name",i._svgName||i.fontIcon)("data-sbb-icon-namespace",i._svgNamespace||i.fontSet),Ri("sbb-icon-inline",i.inline))},inputs:{color:"color",inline:"inline",svgIcon:"svgIcon",fontSet:"fontSet",fontIcon:"fontIcon"},exportAs:["sbbIcon"],ngContentSelectors:Oq,decls:1,vars:0,template:function(e,i){1&e&&(Mo(),Pr(0))},styles:[".sbb-icon{background-repeat:no-repeat;display:inline-block;line-height:0;overflow:hidden}.sbb-icon svg:not(.color-immutable) [fill]:not([fill=none]){fill:currentColor}.sbb-icon svg:not(.color-immutable) [stroke]:not([stroke=none]){stroke:currentColor}.sbb-icon svg:not(.color-immutable)>:where(path,polygon,polyline):where(:not([stroke]):not([fill])),.sbb-icon svg:not(.color-immutable) :where(:not([stroke]):not([fill])) :where(path,polygon,polyline):where(:not([stroke]):not([fill])){fill:currentColor}.sbb-icon.sbb-icon-inline{vertical-align:middle;margin-block-start:calc(-.2666666667rem*var(--sbb-scaling-factor));margin-block-end:calc(-.1333333333rem*var(--sbb-scaling-factor))}:where(.sbb-icon-fit) .sbb-icon,.sbb-icon:where(.sbb-icon-fit),:where(.sbb-icon-fit,.sbb-icon-scaled) .sbb-icon svg,.sbb-icon:where(.sbb-icon-fit,.sbb-icon-scaled) svg{width:100%;height:100%}:where(.sbb-icon-scaled) .sbb-icon,.sbb-icon:where(.sbb-icon-scaled){width:var(--sbb-icon-size-default);height:var(--sbb-icon-size-default)}"],encapsulation:2,changeDetection:0}),n})(),mo=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({imports:[Wi]}),n})();const LO=["*"],$q=["tabListContainer"],Gq=["tabList"],qq=["tabListInner"],Wq=["nextPaginator"],Xq=["previousPaginator"],Qq=["sbb-tab-nav-bar",""];new Et("SbbTabContent"),new Et("SbbTabLabel"),new Et("SBB_TAB"),Ga(class{}),new Et("SBB_TAB_GROUP"),Es("translateTab",[dr("hidden",Ln({visibility:"hidden"})),qi("* => void, * => hidden",[Ln({opacity:1}),Qi("{{animationDurationHide}} ease",Ln({opacity:0}))]),qi("hidden => show",[Ln({opacity:0,visibility:"visible"}),Qi("{{animationDuration}} ease",Ln({opacity:1}))]),qi("void => show",Qi("0s"))]),new Et("SBB_TABS_CONFIG"),Ga(class{});const _D=kp({passive:!0}),tW=Em(class{});let nW=(()=>{class n extends tW{constructor(e,i,r,s,d,m){super(),this._elementRef=e,this._changeDetectorRef=i,this._viewportRuler=r,this._ngZone=s,this._platform=d,this._animationMode=m,this._scrollShadowTrigger=new Zt,this._scrollDistance=0,this._selectedIndexChanged=!1,this._destroyed=new Zt,this._showPaginationControls=!1,this._disableScrollAfter=!0,this._disableScrollBefore=!0,this._stopScrolling=new Zt,this._disablePagination=!1,this._selectedIndex=0,this.selectFocusedIndex=new nn,this.indexFocused=new nn,s.runOutsideAngular(()=>{au(e.nativeElement,"mouseleave").pipe(Pi(this._destroyed)).subscribe(()=>{this._stopInterval()})})}get disablePagination(){return this._disablePagination}set disablePagination(e){this._disablePagination=jn(e)}get selectedIndex(){return this._selectedIndex}set selectedIndex(e){e=gh(e),this._selectedIndex!==e&&(this._selectedIndexChanged=!0,this._selectedIndex=e,this._keyManager&&this._keyManager.updateActiveItem(e))}ngAfterViewInit(){au(this._previousPaginator.nativeElement,"touchstart",_D).pipe(Pi(this._destroyed)).subscribe(()=>{this._handlePaginatorPress("before")}),au(this._nextPaginator.nativeElement,"touchstart",_D).pipe(Pi(this._destroyed)).subscribe(()=>{this._handlePaginatorPress("after")})}ngAfterContentInit(){const e=this._viewportRuler.change(150),i=()=>this.updatePagination();this._keyManager=new sD(this._items).withHorizontalOrientation("ltr").withHomeAndEnd().withWrap(),this._keyManager.updateActiveItem(this._selectedIndex),this._ngZone.onStable.pipe(Vr(1)).subscribe(i),Er(e,this._items.changes,this.variant).pipe(Pi(this._destroyed)).subscribe(()=>{this._ngZone.run(()=>{Promise.resolve().then(()=>{this._scrollDistance=Math.max(0,Math.min(this._getMaxScrollDistance(),this._scrollDistance)),i()})})}),this._keyManager.change.pipe(Pi(this._destroyed)).subscribe(r=>{this.indexFocused.emit(r),this._setTabFocus(r)}),this._ngZone.runOutsideAngular(()=>{this.variant.pipe(Cr(r=>"standard"===r),na(()=>Er(au(this._tabListContainer.nativeElement,"scroll",_D),this._scrollShadowTrigger,e)),Ds(null),W(()=>this._calculateScrollState()),Pp(),Pi(this._destroyed)).subscribe(r=>this._applyScrollShadows(r))}),this._ngZone.runOutsideAngular(()=>{this.variant.pipe(Pi(this._destroyed)).subscribe(r=>{"lean"===r?this._tabListContainer.nativeElement.scrollLeft=0:this._tabList.nativeElement.style.removeProperty("transform")})})}ngAfterContentChecked(){this._tabLabelCount!==this._items.length&&(this.updatePagination(),this._tabLabelCount=this._items.length,this._changeDetectorRef.markForCheck()),this._selectedIndexChanged&&(this._scrollToLabel(this._selectedIndex),this._checkScrollingControls(),this._selectedIndexChanged=!1,this._changeDetectorRef.markForCheck()),this._scrollDistanceChanged&&(this._updateTabScrollPosition(),this._scrollDistanceChanged=!1,this._changeDetectorRef.markForCheck())}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete(),this._stopScrolling.complete()}_handleKeydown(e){if(!ra(e))switch(e.keyCode){case 13:case 32:this.focusIndex!==this.selectedIndex&&(this.selectFocusedIndex.emit(this.focusIndex),this._itemSelected(e));break;default:this._keyManager.onKeydown(e)}}_onContentChanges(){const e=this._elementRef.nativeElement.textContent;e!==this._currentTextContent&&(this._currentTextContent=e||"",this._ngZone.run(()=>{this.updatePagination(),this._changeDetectorRef.markForCheck()}))}updatePagination(){this._checkPaginationEnabled(),this._checkScrollingControls(),this._updateTabScrollPosition()}get focusIndex(){return this._keyManager?this._keyManager.activeItemIndex:0}set focusIndex(e){!this._isValidIndex(e)||this.focusIndex===e||!this._keyManager||this._keyManager.setActiveItem(e)}_isValidIndex(e){if(!this._items)return!0;const i=this._items?this._items.toArray()[e]:null;return!!i&&!i.disabled}_setTabFocus(e){this._showPaginationControls&&this._scrollToLabel(e),this._items&&this._items.length&&(this._items.toArray()[e].focus(),this._tabListContainer.nativeElement.scrollLeft=0)}_updateTabScrollPosition(){this.disablePagination||"standard"===this.variantSnapshot||(this._tabList.nativeElement.style.transform=`translateX(${Math.round(-this.scrollDistance)}px)`,(this._platform.TRIDENT||this._platform.EDGE)&&(this._tabListContainer.nativeElement.scrollLeft=0))}get scrollDistance(){return this._scrollDistance}set scrollDistance(e){this._scrollTo(e)}_scrollHeader(e){return this._scrollTo(this._scrollDistance+("before"===e?-1:1)*this._tabListContainer.nativeElement.offsetWidth/3)}_handlePaginatorClick(e){this._stopInterval(),this._scrollHeader(e)}_scrollToLabel(e){if(this.disablePagination||"standard"===this.variantSnapshot)return;const i=this._items?this._items.toArray()[e]:null;if(!i)return;const r=this._tabListContainer.nativeElement.offsetWidth,{offsetLeft:s,offsetWidth:d}=i.elementRef.nativeElement,y=s+d,C=this.scrollDistance,M=this.scrollDistance+r;s<C?this.scrollDistance-=C-s+60:y>M&&(this.scrollDistance+=y-M+60)}_checkPaginationEnabled(){if(this.disablePagination||"standard"===this.variantSnapshot)this._showPaginationControls=!1;else{const e=this._tabListInner.nativeElement.scrollWidth-this._elementRef.nativeElement.offsetWidth>1;e||(this.scrollDistance=0),e!==this._showPaginationControls&&this._changeDetectorRef.markForCheck(),this._showPaginationControls=e}}_checkScrollingControls(){this.disablePagination||"standard"===this.variantSnapshot?this._disableScrollAfter=this._disableScrollBefore=!0:(this._disableScrollBefore=0===this.scrollDistance,this._disableScrollAfter=this.scrollDistance===this._getMaxScrollDistance(),this._changeDetectorRef.markForCheck())}_getMaxScrollDistance(){return this._tabListInner.nativeElement.scrollWidth-this._tabListContainer.nativeElement.offsetWidth||0}_stopInterval(){this._stopScrolling.next()}_handlePaginatorPress(e,i){i&&null!=i.button&&0!==i.button||(this._stopInterval(),uD(650,100).pipe(Pi(Er(this._stopScrolling,this._destroyed))).subscribe(()=>{const{maxScrollDistance:r,distance:s}=this._scrollHeader(e);(0===s||s>=r)&&this._stopInterval()}))}_scrollTo(e){if(this.disablePagination||"standard"===this.variantSnapshot)return{maxScrollDistance:0,distance:0};const i=this._getMaxScrollDistance();return this._scrollDistance=Math.max(0,Math.min(i,e)),this._scrollDistanceChanged=!0,this._checkScrollingControls(),{maxScrollDistance:i,distance:this._scrollDistance}}_calculateScrollState(){const e=this._tabListContainer.nativeElement;if(e.scrollWidth===e.offsetWidth)return"hidden";const i=0===e.scrollLeft;return i||e.scrollWidth-e.scrollLeft-e.offsetWidth<=1?i?"left":"right":"middle"}_applyScrollShadows(e){const i=this._elementRef.nativeElement;"hidden"===e||"left"===e?i.classList.remove("sbb-tab-header-left-shadow"):i.classList.add("sbb-tab-header-left-shadow"),"hidden"===e||"right"===e?i.classList.remove("sbb-tab-header-right-shadow"):i.classList.add("sbb-tab-header-right-shadow")}}return n.\u0275fac=function(e){return new(e||n)(G(Tn),G(Sr),G(lu),G(qn),G(cs),G(Qu,8))},n.\u0275dir=Lt({type:n,inputs:{disablePagination:"disablePagination"},features:[qt]}),n})(),FO=0,NO=(()=>{class n extends nW{constructor(e,i,r,s,d,m){super(e,r,s,i,d,m)}_itemSelected(){}ngAfterContentInit(){this._items.changes.pipe(Ds(null),Pi(this._destroyed)).subscribe(()=>{this.updateActiveLink()}),super.ngAfterContentInit()}updateActiveLink(){if(!this._items)return;const e=this._items.toArray();for(let i=0;i<e.length;i++)if(e[i].active)return this.selectedIndex=i,this._changeDetectorRef.markForCheck(),void(this.tabPanel&&(this.tabPanel._activeTabId=e[i].id));this.selectedIndex=-1}_getRole(){return this.tabPanel?"tablist":this._elementRef.nativeElement.getAttribute("role")}}return n.\u0275fac=function(e){return new(e||n)(G(Tn),G(qn),G(Sr),G(lu),G(cs),G(Qu,8))},n.\u0275dir=Lt({type:n,inputs:{tabPanel:"tabPanel"},features:[qt]}),n})(),yD=(()=>{class n extends NO{constructor(e,i,r,s,d,m){super(e,i,r,s,d,m)}}return n.\u0275fac=function(e){return new(e||n)(G(Tn),G(qn),G(Sr),G(lu),G(cs),G(Qu,8))},n.\u0275cmp=vn({type:n,selectors:[["","sbb-tab-nav-bar",""]],contentQueries:function(e,i,r){if(1&e&&zr(r,vD,5),2&e){let s;Nn(s=Bn())&&(i._items=s)}},viewQuery:function(e,i){if(1&e&&(ur($q,7),ur(Gq,7),ur(qq,7),ur(Wq,5),ur(Xq,5)),2&e){let r;Nn(r=Bn())&&(i._tabListContainer=r.first),Nn(r=Bn())&&(i._tabList=r.first),Nn(r=Bn())&&(i._tabListInner=r.first),Nn(r=Bn())&&(i._nextPaginator=r.first),Nn(r=Bn())&&(i._previousPaginator=r.first)}},hostAttrs:[1,"sbb-tab-nav-bar","sbb-tab-header"],hostVars:3,hostBindings:function(e,i){2&e&&(fn("role",i._getRole()),Ri("sbb-tab-header-pagination-controls-enabled",i._showPaginationControls&&"lean"===i.variantSnapshot))},exportAs:["sbbTabNavBar","sbbTabNav"],features:[qt],attrs:Qq,ngContentSelectors:LO,decls:13,vars:8,consts:[["aria-hidden","true","type","button","tabindex","-1",1,"sbb-tab-header-pagination","sbb-tab-header-pagination-before","sbb-button-reset-frameless",3,"disabled","click","mousedown","touchend"],["previousPaginator",""],["svgIcon","kom:chevron-left-small",1,"sbb-tab-header-pagination-chevron"],[1,"sbb-tab-link-container","sbb-scrollbar",3,"keydown"],["tabListContainer",""],[1,"sbb-tab-list",3,"cdkObserveContent"],["tabList",""],[1,"sbb-tab-links"],["tabListInner",""],["aria-hidden","true","type","button","tabindex","-1",1,"sbb-tab-header-pagination","sbb-tab-header-pagination-after","sbb-button-reset-frameless",3,"disabled","mousedown","click","touchend"],["nextPaginator",""],["svgIcon","kom:chevron-right-small",1,"sbb-tab-header-pagination-chevron"]],template:function(e,i){1&e&&(Mo(),oe(0,"button",0,1),Qt("click",function(){return i._handlePaginatorClick("before")})("mousedown",function(s){return i._handlePaginatorPress("before",s)})("touchend",function(){return i._stopInterval()}),ln(2,"sbb-icon",2),de(),oe(3,"div",3,4),Qt("keydown",function(s){return i._handleKeydown(s)}),oe(5,"div",5,6),Qt("cdkObserveContent",function(){return i._onContentChanges()}),oe(7,"div",7,8),Pr(9),de()()(),oe(10,"button",9,10),Qt("mousedown",function(s){return i._handlePaginatorPress("after",s)})("click",function(){return i._handlePaginatorClick("after")})("touchend",function(){return i._stopInterval()}),ln(12,"sbb-icon",11),de()),2&e&&(Ri("sbb-tab-header-pagination-disabled",i._disableScrollBefore),Je("disabled",i._disableScrollBefore||null),Le(5),Ri("_sbb-animation-noopable","NoopAnimations"===i._animationMode),Le(5),Ri("sbb-tab-header-pagination-disabled",i._disableScrollAfter),Je("disabled",i._disableScrollAfter||null))},dependencies:[YL,qa],styles:['.sbb-tab-header{display:flex;overflow:hidden;position:relative;flex-shrink:0}.sbb-tab-header-pagination{-webkit-user-select:none;user-select:none;position:relative;display:none;justify-content:center;align-items:center;min-width:2.1333333333rem;cursor:pointer;z-index:2;-webkit-tap-highlight-color:rgba(0,0,0,0);touch-action:none;color:var(--sbb-color-granite);box-shadow:0 .1333333333rem .2666666667rem -.0666666667rem rgba(0,0,0,.2),0 .2666666667rem .3333333333rem rgba(0,0,0,.1411764706),0 .0666666667rem .6666666667rem rgba(0,0,0,.1215686275)}.sbb-tab-header-pagination::after{content:"";display:block;position:absolute;bottom:0;height:0;margin:0 auto;border-bottom:var(--sbb-border-width-thin) solid var(--sbb-color-text)}:where(html:not(.sbb-lean)) .sbb-tab-header-pagination::after{transition:width var(--sbb-transition-duration-default),left var(--sbb-transition-duration-default);left:0;right:0;width:0}:where(html.sbb-lean) .sbb-tab-header-pagination::after{left:var(--sbb-border-width-negative);right:var(--sbb-border-width-negative);border-color:var(--sbb-color-graphite)}.sbb-tab-header-pagination-controls-enabled .sbb-tab-header-pagination{display:flex}.sbb-tab-header-pagination:hover:not(.sbb-tab-header-pagination-disabled){color:var(--sbb-color-call-to-action-hover)}.sbb-tab-header-pagination::after{right:0;left:0}.sbb-tab-header-pagination.sbb-tab-header-pagination-after.sbb-tab-header-pagination-disabled::after{left:-.0666666667rem}.sbb-tab-header-pagination-disabled .sbb-tab-header-pagination-chevron{opacity:.4}.sbb-tab-header-pagination-disabled{box-shadow:none;cursor:default}.sbb-tab-list{flex-grow:1;position:relative;transition:transform var(--sbb-transition-duration-slow) var(--sbb-transition-timing-fast-start);will-change:transform}.sbb-tab-header{position:relative}:where(html:not(.sbb-lean)) .sbb-tab-header::before,:where(html:not(.sbb-lean)) .sbb-tab-header::after{position:absolute;top:0;content:"";z-index:2;width:.8rem;height:calc(100% - .5rem);transition:transform var(--sbb-transition-duration-fast) var(--sbb-transition-timing-default);pointer-events:none}@media all and (min-width: 40.1875em){:where(html:not(.sbb-lean)) .sbb-tab-header::before,:where(html:not(.sbb-lean)) .sbb-tab-header::after{width:calc(1.6rem * var(--sbb-scaling-factor))}}:where(html:not(.sbb-lean)) .sbb-tab-header::before{left:0;transform:translateX(-100%);background:linear-gradient(270deg, hsla(0deg, 0%, 100%, 0.37) 0, var(--sbb-color-background))}:where(html:not(.sbb-lean)) .sbb-tab-header.sbb-tab-header-left-shadow::before{transform:translateX(0)}:where(html:not(.sbb-lean)) .sbb-tab-header::after{right:0;transform:translateX(100%);background:linear-gradient(90deg, hsla(0deg, 0%, 100%, 0.37) 0, var(--sbb-color-background))}:where(html:not(.sbb-lean)) .sbb-tab-header.sbb-tab-header-right-shadow::after{transform:translateX(0)}.sbb-tab-links{display:flex;padding-top:calc(0.1333333333rem * var(--sbb-scaling-factor))}:where(html.sbb-lean) .sbb-tab-links{padding-top:0}:where(html.sbb-lean) .sbb-tab-links::after{content:"";width:100%;flex-grow:1;flex-shrink:1;border-bottom:var(--sbb-border-width) solid var(--sbb-color-graphite)}.sbb-tab-link-container{display:flex;position:relative;flex-grow:1;overflow-x:auto;z-index:1;padding-bottom:1.3333333333rem}:where(html.sbb-lean) .sbb-tab-link-container{overflow:hidden;padding-bottom:0}.sbb-tab-link{margin-right:2.1333333333rem;cursor:pointer;box-sizing:border-box;text-align:center;display:inline-flex;justify-content:center;align-items:center;white-space:nowrap;font-family:var(--sbb-font-light);font-size:1.3333333333rem;color:var(--sbb-color-text);line-height:1em;padding-bottom:1.3333333333rem;outline:none;vertical-align:top;text-decoration:none;position:relative;overflow:hidden;-webkit-tap-highlight-color:rgba(0,0,0,0)}.sbb-tab-link::after{content:"";display:block;position:absolute;bottom:0;height:0;margin:0 auto;border-bottom:var(--sbb-border-width-thin) solid var(--sbb-color-text)}:where(html:not(.sbb-lean)) .sbb-tab-link::after{transition:width var(--sbb-transition-duration-default),left var(--sbb-transition-duration-default);left:0;right:0;width:0}:where(html.sbb-lean) .sbb-tab-link::after{left:var(--sbb-border-width-negative);right:var(--sbb-border-width-negative);border-color:var(--sbb-color-graphite)}@media all and (min-width: 40.1875em){:where(html:not(.sbb-lean)) .sbb-tab-link{margin-right:calc(2.8rem * var(--sbb-scaling-factor));font-size:calc(1.7333333333rem * var(--sbb-scaling-factor))}}:where(html.sbb-lean) .sbb-tab-link{font-size:var(--sbb-font-size);line-height:1.3333333333rem;padding:.4rem 1rem .6rem;background-color:var(--sbb-color-background);margin-right:0;border:var(--sbb-border-width) solid rgba(0,0,0,0);border-bottom:none;border-radius:var(--sbb-border-radius) var(--sbb-border-radius) 0 0}.sbb-tab-link:last-child{margin-right:0 !important}:where(html:not(.sbb-lean)) .sbb-tab-link.sbb-tab-label-active::after{width:100%}:where(html.sbb-lean) .sbb-tab-link.sbb-tab-label-active{border-color:var(--sbb-color-graphite)}:where(html.sbb-lean) .sbb-tab-link.sbb-tab-label-active::after{display:none}.sbb-tab-link:not(.sbb-tab-label-active):not(.sbb-tab-disabled):is(:focus,:hover){color:var(--sbb-color-call-to-action-hover)}.sbb-tab-link:not(.sbb-tab-label-active):not(.sbb-tab-disabled):is(:focus,:hover)::after{border-bottom-color:var(--sbb-color-call-to-action-hover)}:where(html:not(.sbb-lean)) .sbb-tab-link:not(.sbb-tab-label-active):not(.sbb-tab-disabled):is(:focus,:hover)::after{width:100%}.sbb-tab-link.sbb-tab-label-active:is(:hover,:focus){color:currentColor;cursor:default}:where(html.sbb-lean) .sbb-tab-link.sbb-tab-label-active:focus-visible{outline:var(--sbb-border-width) solid var(--sbb-color-black);outline-offset:calc(-1*var(--sbb-border-width))}.sbb-tab-link.sbb-tab-disabled{color:var(--sbb-color-storm)}.sbb-tab-link.sbb-tab-disabled:is(:hover,:focus){cursor:default}:where(html:not(.sbb-lean)) .sbb-tab-link.sbb-tab-disabled::after{width:0 !important}.sbb-tab-link .sbb-tab-label-content{display:inline-flex;justify-content:center;align-items:center;white-space:nowrap}:where(html.sbb-lean) .sbb-tab-link .sbb-badge:not(.sbb-badge-hidden){padding-right:.7333333333rem}:where(html.sbb-lean) .sbb-tab-link .sbb-badge-content{transform:scale(0.8)}[sbb-stretch-tabs] .sbb-tab-link{flex-basis:0;flex-grow:1}:where(html.sbb-lean) .sbb-tab-link{overflow:unset}.sbb-tab-link.sbb-tab-disabled{pointer-events:none}:is(.sbb-tab-nav-panel,.sbb-tab-nav-bar-body){display:block;position:relative;overflow:hidden;transition:height var(--sbb-transition-duration-slow)}:where(html.sbb-lean) :is(.sbb-tab-nav-panel,.sbb-tab-nav-bar-body){border:var(--sbb-border-width) solid var(--sbb-color-graphite);border-top:none;background-color:var(--sbb-color-background)}:where(html.sbb-lean) :is(.sbb-tab-nav-panel,.sbb-tab-nav-bar-body){padding:1rem}'],encapsulation:2}),n})();const iW=$b(Ga(class{}));let rW=(()=>{class n extends iW{constructor(e,i,r,s){super(),this._tabNavBar=e,this.elementRef=i,this._focusMonitor=s,this._isActive=!1,this.id="sbb-tab-link-"+FO++,this.tabIndex=parseInt(r,10)||0}get active(){return this._isActive}set active(e){const i=jn(e);i!==this._isActive&&(this._isActive=i,this._tabNavBar.updateActiveLink())}focus(){this.elementRef.nativeElement.focus()}ngAfterViewInit(){this._focusMonitor.monitor(this.elementRef)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this.elementRef)}_handleFocus(){this._tabNavBar.focusIndex=this._tabNavBar._items.toArray().indexOf(this)}_handleKeydown(e){this._tabNavBar.tabPanel&&32===e.keyCode&&this.elementRef.nativeElement.click()}_getAriaControls(){var e;return this._tabNavBar.tabPanel?null===(e=this._tabNavBar.tabPanel)||void 0===e?void 0:e.id:this.elementRef.nativeElement.getAttribute("aria-controls")}_getAriaSelected(){return this._tabNavBar.tabPanel?this.active?"true":"false":this.elementRef.nativeElement.getAttribute("aria-selected")}_getAriaCurrent(){return this.active&&!this._tabNavBar.tabPanel?"page":null}_getRole(){return this._tabNavBar.tabPanel?"tab":this.elementRef.nativeElement.getAttribute("role")}_getTabIndex(){return this._tabNavBar.tabPanel?this._isActive?0:-1:this.tabIndex}}return n.\u0275fac=function(e){return new(e||n)(G(NO),G(Tn),Uo("tabindex"),G(fa))},n.\u0275dir=Lt({type:n,inputs:{active:"active",id:"id"},features:[qt]}),n})(),vD=(()=>{class n extends rW{constructor(e,i,r,s){super(e,i,r,s)}}return n.\u0275fac=function(e){return new(e||n)(G(yD),G(Tn),Uo("tabindex"),G(fa))},n.\u0275dir=Lt({type:n,selectors:[["","sbb-tab-link",""],["","sbbTabLink",""]],hostAttrs:[1,"sbb-tab-link","sbb-link-reset"],hostVars:11,hostBindings:function(e,i){1&e&&Qt("focus",function(){return i._handleFocus()})("keydown",function(s){return i._handleKeydown(s)}),2&e&&(fn("aria-controls",i._getAriaControls())("aria-current",i._getAriaCurrent())("aria-disabled",i.disabled)("aria-selected",i._getAriaSelected())("id",i.id)("tabIndex",i._getTabIndex())("role",i._getRole()),Ri("sbb-tab-disabled",i.disabled)("sbb-tab-label-active",i.active))},inputs:{disabled:"disabled",tabIndex:"tabIndex"},exportAs:["sbbTabLink"],features:[qt]}),n})(),BO=(()=>{class n{constructor(){this.id="sbb-tab-nav-panel-"+FO++}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=vn({type:n,selectors:[["sbb-tab-nav-panel"]],hostAttrs:["role","tabpanel",1,"sbb-tab-nav-panel"],hostVars:2,hostBindings:function(e,i){2&e&&fn("aria-labelledby",i._activeTabId)("id",i.id)},inputs:{id:"id"},exportAs:["sbbTabNavPanel"],ngContentSelectors:LO,decls:1,vars:0,template:function(e,i){1&e&&(Mo(),Pr(0))},encapsulation:2,changeDetection:0}),n})(),zO=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({imports:[gr,oa,Zw,Sm,Tm,Wi,mo]}),n})();const Np={app_stages:[{key:"PROD",apiEndpoint:"https://api.opentransportdata.swiss/ojp2020",authBearerKey:"eyJvcmciOiI2NDA2NTFhNTIyZmEwNTAwMDEyOWJiZTEiLCJpZCI6Ijk0YTFhNjExYjM5ZjQ4MWNiMGI5MjFiNTgyNmM1ZGFjIiwiaCI6Im11cm11cjEyOCJ9"},{key:"INT",apiEndpoint:"https://odpch-api.clients.liip.ch/ojp-passiv-int",authBearerKey:"eyJvcmciOiI2M2Q4ODhiMDNmZmRmODAwMDEzMDIwODkiLCJpZCI6ImJkOTNmYzA1ZGMwYzQwM2Q4MWYzMmFhNWMxNWZjMjU2IiwiaCI6Im11cm11cjEyOCJ9"},{key:"TEST",apiEndpoint:"https://odpch-api.clients.liip.ch/ojp-test",authBearerKey:"eyJvcmciOiI2M2Q4ODhiMDNmZmRmODAwMDEzMDIwODkiLCJpZCI6ImZlYWJiMjEzZDcyZTRhYmM5N2RhYWJiZDM5YWZmZWIwIiwiaCI6Im11cm11cjEyOCJ9"},{key:"LA Beta",apiEndpoint:"https://api.opentransportdata.swiss/ojp-la-aktiv",authBearerKey:"eyJvcmciOiI2NDA2NTFhNTIyZmEwNTAwMDEyOWJiZTEiLCJpZCI6ImE5ZDFkYmI4YWVjMDRiYjFiZjA2ZmUyNmZmZTk2YTY2IiwiaCI6Im11cm11cjEyOCJ9"}],map_app_map_layers:{stops:{LIR_Restriction_Type:"stop",minZoom:13,layer_ids:["stops-circle","stops-label"],click_layer_ids:"SAME_AS_LAYER_IDS"},addresses:{LIR_Restriction_Type:"address",minZoom:17,layer_ids:["address-circle"],click_layer_ids:"SAME_AS_LAYER_IDS"},sharing_cars:{LIR_Restriction_Type:"poi_amenity",LIR_POI_Type:"car_sharing",minZoom:12,layer_ids:["car-rental-icon","car-rental-text-number","car-rental-text-provider"],click_layer_ids:"SAME_AS_LAYER_IDS"},sharing_bicycles:{LIR_Restriction_Type:"poi_amenity",LIR_POI_Type:"bicycle_rental",minZoom:14,layer_ids:["bike-icon","bike-text-number","bike-text-provider"],click_layer_ids:"SAME_AS_LAYER_IDS"},sharing_scooters:{LIR_Restriction_Type:"poi_amenity",LIR_POI_Type:"escooter_rental",minZoom:14,layer_ids:["scooter-icon","scooter-text-number","scooter-text-provider"],click_layer_ids:"SAME_AS_LAYER_IDS"},charging_stations:{LIR_Restriction_Type:"poi_amenity",LIR_POI_Type:"charging_station",minZoom:12,layer_ids:["charging-station-icon","charging-station-text-number","charging-station-text-provider"],click_layer_ids:"SAME_AS_LAYER_IDS"},sbb_services:{LIR_Restriction_Type:"poi_amenity",LIR_POI_Type:"sbb_services",minZoom:12,layer_ids:["charging-station-icon","charging-station-text-number","charging-station-text-provider"],click_layer_ids:"SAME_AS_LAYER_IDS"},pois_other:{LIR_Restriction_Type:"poi_amenity",LIR_POI_Type:"other",minZoom:12,layer_ids:["charging-station-icon","charging-station-text-number","charging-station-text-provider"],click_layer_ids:"SAME_AS_LAYER_IDS"},"pois-ALL":{LIR_Restriction_Type:"poi_all",LIR_POI_Type:["service","shopping","leisure","catering","public","parkride","accommodation"],minZoom:16,layer_ids:["poi-all"],click_layer_ids:"SAME_AS_LAYER_IDS"}}},Dv={ContinousLeg:"#009933",TransferLeg:"#0000ff",TimedLeg:"#D04D44"},oW=["ContinousLeg","TimedLeg","TransferLeg"],Dm={Unknown:"#ffafcc",LongDistanceRail:"#D04D44",SBahn:"#3D69CA",Bus:"#5F8EF4",PostAuto:"#EBBE24",OnDemand:"#D77D00",Aerial:"#8B4513",Funicular:"#006400",Walk:"#009933","Self-Drive Car":"#ff004f","Shared Mobility":"#32CD32",Guidance:"#6f0000",Transfer:"#088F8F"},sW=["LongDistanceRail","SBahn","Bus","PostAuto","OnDemand","Aerial","Walk","Guidance","Transfer","Self-Drive Car","Shared Mobility"];var aW=qe(1503);class xD{constructor(t,e,i,r,s){this.name=t,this.parentName=e,this.attributes=i,this.children=r,this.text=s}findTextFromChildNamed(t){var e;const i=t.split("/");let r=this;return i.forEach((d,m)=>{r&&(r=r.findChildNamed(d))}),null!==(e=null==r?void 0:r.text)&&void 0!==e?e:null}findChildNamed(t){const e=t.split("/");let i=this;return e.forEach((r,s)=>{var d;i=null!==(d=null==i?void 0:i.children.find(y=>y.name===r))&&void 0!==d?d:null}),i}findChildrenNamed(t){t.includes("/")&&(console.error("ERROR - do you want to use more than one level for findChildrenNamed? Use findTextFromChildNamed."),console.log(t));const e=[];return this.children.forEach(i=>{i.name===t&&e.push(i)}),e}computeText(){const t=[];if(null===this.text){if(0===this.children.length)return null;this.children.forEach(e=>{const i=e.computeText();i&&t.push(i)})}else t.push(this.text);return t.join(" ")}}class wD{constructor(){this.mapUriNS={"http://www.vdv.de/ojp":"","http://www.siri.org.uk/siri":"siri"},this.rootNode=new xD("root",null,{},[],null),this.currentNode=this.rootNode,this.stack=[]}resetNodes(){this.rootNode=new xD("root",null,{},[],null),this.currentNode=this.rootNode,this.stack=[]}parseXML(t){if(gW)Promise.resolve().then(qe.t.bind(qe,1503,19)).then(e=>{const i=e.default.createStream(!0,{trim:!0,xmlns:!0});this._parseXML(t,i)});else{const e=aW.createStream(!0,{trim:!0,xmlns:!0});this._parseXML(t,e)}}_parseXML(t,e){this.resetNodes(),e.on("opentag",i=>{this.onOpenTag(i)}),e.on("text",i=>{this.onText(i)}),e.on("closetag",i=>{this.onSaxCloseTag(i)}),e.on("error",i=>{this.onError(i)}),e.on("end",()=>{this.onEnd()}),e.write(t),e.end()}onOpenTag(t){const e=(()=>{var r;const s=[],d=null!==(r=this.mapUriNS[t.uri])&&void 0!==r?r:"";return""!==d&&s.push(d),s.push(t.local),s.join(":")})(),i=new xD(e,this.currentNode.name,t.attributes,[],null);this.currentNode.children.push(i),this.stack.push(i),this.currentNode=i}onText(t){this.currentNode.text=t}onSaxCloseTag(t){this.stack.pop(),this.onCloseTag(this.currentNode.name),this.currentNode=this.stack[this.stack.length-1]}onCloseTag(t){}onError(t){}onEnd(){}}class gl{static formatDate(t){return[t.getFullYear(),"-",("00"+(t.getMonth()+1)).slice(-2),"-",("00"+t.getDate()).slice(-2)," ",("00"+t.getHours()).slice(-2),":",("00"+t.getMinutes()).slice(-2),":",("00"+t.getSeconds()).slice(-2)].join("")}static formatTimeHHMM(t){return gl.formatDate(t).substring(11,16)}static formatDistance(t){return t>1e3?(t/1e3).toFixed(1)+"km":t+"m"}}var Yo=(()=>{return(n=Yo||(Yo={})).LegType="leg.type",n.DrawType="draw.type",n.PointType="point.type",n.LineType="line.type",Yo;var n})();class Dc{static FilterBeelines(){return this.FilterByDrawType("Beeline")}static FilterWalkingLegs(){return["all",this.FilterByDrawType("LegLine"),this.FilterByLineType("Walk")]}static FilterLegPoints(){return this.FilterByDrawType("LegPoint")}static ColorCaseByLegLineType(){const t=["case"];return sW.forEach(e=>{t.push(["==",["get",Yo.LineType],e]),t.push(Dm[e])}),t.push("#FF1493"),t}static FilterByDrawType(t){return["==",["get",Yo.DrawType],t]}static FilterByPointType(t){return["==",["get",Yo.PointType],t]}static FilterByLineType(t){return["==",["get",Yo.LineType],t]}static FilterTimedLegTracks(){return["all",this.FilterByDrawType("LegLine")]}static ColorCaseByLegType(){const t=["case"];return oW.forEach(e=>{t.push(["==",["get",Yo.LegType],e]),t.push(Dv[e])}),t.push("#FF1493"),t}}class Is{constructor(t,e){this.longitude=parseFloat(t.toFixed(6)),this.latitude=parseFloat(e.toFixed(6)),this.properties=null}static initWithStringCoords(t,e){if(null===t||null===e)return null;const i=parseFloat(t),r=parseFloat(e);return 0===i||0===r?null:new Is(i,r)}static initWithLocationTreeNode(t){const e=t.findTextFromChildNamed("GeoPosition/siri:Longitude"),i=t.findTextFromChildNamed("GeoPosition/siri:Latitude");return Is.initWithStringCoords(e,i)}static initWithFeature(t){if("Point"!==t.geometry.type)return null;const e=t.geometry.coordinates,s=new Is(e[0],e[1]);return s.properties=t.properties,s}asLngLat(){return[this.longitude,this.latitude]}asLatLngString(t=!0){let e="";return e=t?this.latitude.toFixed(6)+","+this.longitude.toFixed(6):this.latitude+","+this.longitude,e}asPosition(){return[this.longitude,this.latitude]}distanceFrom(t){const i=(t.latitude-this.latitude)*Math.PI/180,r=(t.longitude-this.longitude)*Math.PI/180,s=Math.sin(i/2)*Math.sin(i/2)+Math.cos(this.latitude*Math.PI/180)*Math.cos(t.latitude*Math.PI/180)*Math.sin(r/2)*Math.sin(r/2),d=2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s));return Math.round(6371*d*1e3)}}class bh{constructor(t,e,i,r="StopPlace"){this.stopPlaceRef=t,this.stopPlaceName=e,this.topographicPlaceRef=i,this.stopType=r}static initWithLocationTreeNode(t){let e="StopPlace",i=t.findTextFromChildNamed("StopPlace/StopPlaceRef"),r=t.findTextFromChildNamed("StopPlace/StopPlaceName/Text"),s=t.findTextFromChildNamed("StopPlace/TopographicPlaceRef");return null===i&&(e="StopPoint",i=t.findTextFromChildNamed("StopPoint/siri:StopPointRef"),r=t.findTextFromChildNamed("StopPoint/StopPointName/Text"),s=t.findTextFromChildNamed("StopPoint/TopographicPlaceRef")),null===i&&(e="StopPoint",i=t.findTextFromChildNamed("siri:StopPointRef")),null===i?null:new bh(i,r,s,e)}static initWithServiceTreeNode(t,e){const i=t.findTextFromChildNamed(e+"StopPointRef"),r=t.findTextFromChildNamed(e+"Text/Text");return i&&r?new bh(i,r,null,"StopPlace"):null}}class lS{constructor(t,e,i){this.addressCode=t,this.addressName=e,this.topographicPlaceRef=i}static initWithLocationTreeNode(t){const e=t.findChildNamed("Address");if(null===e)return null;const i=e.findTextFromChildNamed("AddressCode");if(null===i)return null;const r=e.findTextFromChildNamed("AddressName/Text"),s=e.findTextFromChildNamed("TopographicPlaceRef");return new lS(i,r,s)}}const TD={service:["atm","hairdresser"],shopping:["all","clothes","optician"],catering:["all"],accommodation:["all"]};class ED{constructor(t,e,i,r,s){this.code=t,this.name=e,this.category=i,this.subCategory=r,this.categoryTags=s}static initWithLocationTreeNode(t){const e=t.findChildNamed("PointOfInterest");if(null===e)return null;const i=e.findTextFromChildNamed("PointOfInterestCode"),r=e.findTextFromChildNamed("PointOfInterestName/Text");if(!i||!r)return null;const s=[];let d=null,m=null;return e.findChildrenNamed("PointOfInterestCategory").forEach(M=>{const k=M.findTextFromChildNamed("OsmTag/Value");k&&s.push(k);const z=M.findTextFromChildNamed("OsmTag/Tag");("POI_0"===z||"amenity"===z)&&(d=k),"POI_1"===z&&(m=k)}),null===d?(console.error("PointOfInterest.initWithLocationTreeNode error - no category"),console.log(t),null):new ED(i,r,d,m,s)}computePoiMapIcon(){const t="poi-unknown";return this.category in TD?this.subCategory&&TD[this.category].indexOf(this.subCategory)>-1?"poi-"+this.category+"-"+this.subCategory:TD[this.category].indexOf("all")>-1?"poi-"+this.category+"-all":t:t}}class DD{constructor(t,e){this.code=t,this.name=e}static initWithLocationTreeNode(t){const e=t.findTextFromChildNamed("TopographicPlace/TopographicPlaceCode"),i=t.findTextFromChildNamed("TopographicPlace/TopographicPlaceName/Text");return e&&i?new DD(e,i):null}}const lW=/^([0-9\.]+?),([0-9\.]+?)$/;class ao{constructor(){this.address=null,this.locationName=null,this.stopPlace=null,this.geoPosition=null,this.poi=null,this.topographicPlace=null,this.attributes={},this.probability=null,this.originSystem=null}static initWithTreeNode(t){const e=new ao;return e.address=lS.initWithLocationTreeNode(t),e.geoPosition=Is.initWithLocationTreeNode(t),e.locationName=t.findTextFromChildNamed("LocationName/Text"),e.poi=ED.initWithLocationTreeNode(t),e.stopPlace=bh.initWithLocationTreeNode(t),e.topographicPlace=DD.initWithLocationTreeNode(t),e.attributes=ao.computeAttributes(t),e}static initWithLocationResultTreeNode(t){const e=t.findChildNamed("Location");if(null===e)return null;const i=ao.initWithTreeNode(e),r=t.findTextFromChildNamed("Probability");return r&&(i.probability=parseFloat(r)),i.originSystem=t.findTextFromChildNamed("OriginSystem"),i}static initWithStopPlaceRef(t,e=""){const i=new ao;return i.stopPlace=new bh(t,e,null),i}static initWithLngLat(t,e){const i=new ao;return i.geoPosition=new Is(t,e),i}static computeAttributes(t){const e={},i=t.findChildNamed("Attribute");i&&i.children.forEach(s=>{const d=s.name.split(":"),m=1===d.length?d[0]:d[1],y=s.computeText();null!==y&&(e[m]=y)});const r=t.findChildNamed("Extension/LocationExtensionStructure");return r&&r.children.forEach(s=>{e[s.name]=s.text}),e}static initWithFeature(t){var e,i,r,s;const d=Is.initWithFeature(t);if(null===d)return null;const m=t.properties;if(null===m)return null;const y=new ao;y.geoPosition=d,y.locationName=null!==(e=m.locationName)&&void 0!==e?e:null;const C=m["stopPlace.stopPlaceRef"];if(C){const k=null!==(i=m["stopPlace.stopPlaceName"])&&void 0!==i?i:null;y.stopPlace=new bh(C,k,null)}const M=m.addressCode;if(M){const k=null!==(r=m.addressName)&&void 0!==r?r:null,z=null!==(s=m.topographicPlaceRef)&&void 0!==s?s:null;y.address=new lS(M,k,z)}return y}static initFromLiteralCoords(t){let e=t.trim();e=e.replace(/\(.+?\)/g,""),e=e.replace(/[^0-9\.,]/g,"");const i=e.match(lW);if(null===i)return null;let r=parseFloat(i[1]),s=parseFloat(i[2]);r>s&&(r=parseFloat(i[2]),s=parseFloat(i[1]));const d=ao.initWithLngLat(r,s),m=t.trim().match(/\(([^\)]*)\)?/);return null!==m&&(d.locationName=m[1]),d}asGeoJSONFeature(){var t,e,i,r,s,d,m,y,C,M,k,z,q,Q,xe;if(null===this.geoPosition)return null;const De={};(null!==(e=null===(t=this.stopPlace)||void 0===t?void 0:t.stopPlaceRef)&&void 0!==e?e:null)&&(De["stopPlace.stopPlaceRef"]=null!==(r=null===(i=this.stopPlace)||void 0===i?void 0:i.stopPlaceRef)&&void 0!==r?r:"",De["stopPlace.stopPlaceName"]=null!==(d=null===(s=this.stopPlace)||void 0===s?void 0:s.stopPlaceName)&&void 0!==d?d:"",De["stopPlace.topographicPlaceRef"]=null!==(y=null===(m=this.stopPlace)||void 0===m?void 0:m.topographicPlaceRef)&&void 0!==y?y:""),this.address&&(De.addressCode=null!==(M=null===(C=this.address)||void 0===C?void 0:C.addressCode)&&void 0!==M?M:"",De.addressName=null!==(z=null===(k=this.address)||void 0===k?void 0:k.addressName)&&void 0!==z?z:"",De.topographicPlaceRef=null!==(Q=null===(q=this.address)||void 0===q?void 0:q.topographicPlaceRef)&&void 0!==Q?Q:""),this.poi&&(De["poi.name"]=this.poi.name,De["poi.code"]=this.poi.code,De["poi.category"]=this.poi.category,De["poi.subcategory"]=this.poi.subCategory,De["poi.osm.tags"]=this.poi.categoryTags.join(",")),De.locationName=null!==(xe=this.locationName)&&void 0!==xe?xe:"";for(let ut in this.attributes)De["OJP.Attr."+ut]=this.attributes[ut];return{type:"Feature",properties:De,geometry:{type:"Point",coordinates:[this.geoPosition.longitude,this.geoPosition.latitude]}}}computeLocationName(t=!0){var e,i;return null!==(e=this.stopPlace)&&void 0!==e&&e.stopPlaceName?this.stopPlace.stopPlaceName:null!==(i=this.topographicPlace)&&void 0!==i&&i.name?this.topographicPlace.name:this.poi&&this.poi.name?this.poi.name:this.locationName?this.locationName:t&&this.geoPosition?this.geoPosition.asLatLngString():null}findClosestLocation(t){const e=this.geoPosition;if(null===e)return null;let i=null;return t.forEach(r=>{const s=r.geoPosition;if(null===s)return;const d=e.distanceFrom(s);(null===i||d<i.distance)&&(i={location:r,distance:d})}),i}getLocationType(){return this.stopPlace?"stop":this.poi?"poi":this.address?"address":this.topographicPlace?"topographicPlace":null}}class Bp{constructor(t){Array.isArray(t)||(t=[t]);const e=Math.min.apply(null,t.map(d=>d.longitude)),i=Math.min.apply(null,t.map(d=>d.latitude)),r=Math.max.apply(null,t.map(d=>d.longitude)),s=Math.max.apply(null,t.map(d=>d.latitude));this.southWest=new Is(e,i),this.northEast=new Is(r,s)}static initFromGeoPosition(t,e,i){const r=.1*e/7612,s=.1*i/11119,d=new Is(t.longitude-r/2,t.latitude-s/2),m=new Is(t.longitude+r/2,t.latitude+s/2);return new Bp([d,m])}extend(t){Array.isArray(t)||(t=[t]),t.forEach(e=>{const i=Math.min(this.southWest.longitude,e.longitude),r=Math.min(this.southWest.latitude,e.latitude),s=Math.max(this.northEast.longitude,e.longitude),d=Math.max(this.northEast.latitude,e.latitude);this.southWest=new Is(i,r),this.northEast=new Is(s,d)})}asFeatureBBOX(){return[this.southWest.longitude,this.southWest.latitude,this.northEast.longitude,this.northEast.latitude]}isValid(){return this.southWest.longitude!==1/0}containsGeoPosition(t){return!(t.longitude<this.southWest.longitude||t.latitude<this.southWest.latitude||t.longitude>this.northEast.longitude||t.latitude>this.northEast.latitude)}}class Iv{constructor(t,e){if(this.timetableTime=t,this.estimatedTime=e,e){const i=(e.getTime()-t.getTime())/1e3;this.delayMinutes=Math.floor(i/60)}else this.delayMinutes=null}static initWithParentTreeNode(t,e){const i=t.findChildNamed(e);return null===i?null:Iv.initWithContextTreeNode(i)}static initWithContextTreeNode(t){const e=t.findTextFromChildNamed("TimetabledTime");if(null===e)return null;const i=new Date(Date.parse(e));let r=null;const s=t.findTextFromChildNamed("EstimatedTime");return s&&(r=new Date(Date.parse(s))),new Iv(i,r)}}class zp{constructor(t,e,i,r,s,d){this.stopPointType=t,this.location=e,this.arrivalData=i,this.departureData=r,this.plannedPlatform=s,this.actualPlatform=null,this.sequenceOrder=d,this.siriSituationIds=[],this.siriSituations=[],this.vehicleAccessType=null}static initWithTreeNode(t,e){const i=t.findTextFromChildNamed("siri:StopPointRef"),r=t.findTextFromChildNamed("StopPointName/Text");if(!i||!r)return null;const s=new ao;s.stopPlace=new bh(i,r,null);const d=Iv.initWithParentTreeNode(t,"ServiceArrival"),m=Iv.initWithParentTreeNode(t,"ServiceDeparture"),y=t.findTextFromChildNamed("PlannedQuay/Text"),C=t.findTextFromChildNamed("Order"),M=null===C?null:parseInt(C,10),k=new zp(e,s,d,m,y,M);return k.actualPlatform=t.findTextFromChildNamed("EstimatedQuay/Text"),k.siriSituationIds=[],t.findChildrenNamed("SituationFullRef").forEach(q=>{const Q=q.findTextFromChildNamed("siri:SituationNumber");Q&&k.siriSituationIds.push(Q)}),k.vehicleAccessType=zp.computePlatformAssistance(t),k}static computePlatformAssistance(t){const e=t.findTextFromChildNamed("NameSuffix/Text");return null===e?null:"PLATFORM_ACCESS_WITH_ASSISTANCE"===e?"PLATFORM_ACCESS_WITH_ASSISTANCE":"PLATFORM_ACCESS_WITH_ASSISTANCE_WHEN_NOTIFIED"===e?"PLATFORM_ACCESS_WITH_ASSISTANCE_WHEN_NOTIFIED":"PLATFORM_NOT_WHEELCHAIR_ACCESSIBLE"===e?"PLATFORM_NOT_WHEELCHAIR_ACCESSIBLE":"PLATFORM_ACCESS_WITHOUT_ASSISTANCE"===e?"PLATFORM_ACCESS_WITHOUT_ASSISTANCE":"NO_DATA"===e?"NO_DATA":null}patchSituations(t){this.siriSituations=[],this.siriSituationIds.forEach(e=>{var i;const r=null!==(i=t[e])&&void 0!==i?i:null;r&&this.siriSituations.push(r)})}}class ID{constructor(t,e,i){this.ptMode=t,this.name=e,this.shortName=i,this.isDemandMode=!1}static initWithServiceTreeNode(t){const e=t.findTextFromChildNamed("Mode/PtMode");if(null===e)return null;const i=t.findTextFromChildNamed("Mode/Name/Text"),r=t.findTextFromChildNamed("Mode/ShortName/Text"),s=new ID(e,i,r),d=t.findTextFromChildNamed("Mode/siri:BusSubmode");return s.isDemandMode="demandAndResponseBus"===d||"unknown"===d,s}isRail(){return"rail"===this.ptMode}hasPrecisePolyline(){if(this.isDemandMode)return!0;const e=this.computePublicTransportPictogram();return-1===["picto-bus","picto-bus-fallback","picto-tram"].indexOf(e)}computePublicTransportPictogram(){return"bus"===this.ptMode?"picto-bus":this.isRail()?"picto-railway":"tram"===this.ptMode?"picto-tram":"CC"===this.shortName?"picto-rack-railway":"FUN"===this.shortName?"picto-funicular":"PB"===this.shortName?"picto-cablecar":"GB"===this.shortName?"picto-gondola":"SL"===this.shortName?"picto-chairlift":"water"===this.ptMode?"picto-boat":this.isDemandMode?"car-sharing":"picto-bus-fallback"}}class cS{constructor(t,e,i){this.journeyRef=t,this.ptMode=e,this.agencyID=i,this.originStopPlace=null,this.destinationStopPlace=null,this.serviceLineNumber=null,this.journeyNumber=null,this.siriSituationIds=[],this.siriSituations=[],this.serviceAttributes={}}static initWithTreeNode(t){const e=t.findChildNamed("Service");if(null===e)return null;const i=e.findTextFromChildNamed("JourneyRef"),r=ID.initWithServiceTreeNode(e),s=e.findTextFromChildNamed("OperatorRef"),d=null==s?void 0:s.replace("ojp:","");if(!(i&&r&&d))return null;const m=new cS(i,r,d);return m.originStopPlace=bh.initWithServiceTreeNode(e,"Origin"),m.destinationStopPlace=bh.initWithServiceTreeNode(e,"Destination"),m.serviceLineNumber=e.findTextFromChildNamed("PublishedLineName/Text"),m.journeyNumber=t.findTextFromChildNamed("Extension/PublishedJourneyNumber/Text"),m.siriSituationIds=[],e.findChildrenNamed("SituationFullRef").forEach(C=>{const M=C.findTextFromChildNamed("siri:SituationNumber");M&&m.siriSituationIds.push(M)}),m.serviceAttributes={},e.findChildrenNamed("Attribute").forEach(C=>{let M=C.findTextFromChildNamed("Code");if(null===M)return console.error("ERROR - cant find code for Attribute"),void console.log(C);M.startsWith("A_")&&(M=M.replace(/A_*/,""));const k=C.findTextFromChildNamed("Text/Text");if(null===k)return console.error("ERROR - cant find code/text for Attribute"),void console.log(C);const z={code:M,text:k,extra:{}};C.children.forEach(q=>{if(q.name.startsWith("siri:")){const Q=q.name.split("siri:");if(2!==Q.length)return;const De=q.text;if(null===De)return;z.extra[Q[1]]=De}}),m.serviceAttributes[M]=z}),m}computeLegLineType(){return"801"===this.agencyID?"PostAuto":this.ptMode.isRail()?"LongDistanceRail":this.ptMode.isDemandMode?"OnDemand":"Bus"}formatServiceName(){var t,e,i,r;if(this.ptMode.isDemandMode)return null!==(t=this.serviceLineNumber)&&void 0!==t?t:"OnDemand";const s=[];return this.serviceLineNumber?(this.ptMode.isRail()||s.push(null!==(e=this.ptMode.shortName)&&void 0!==e?e:this.ptMode.ptMode),s.push(this.serviceLineNumber),s.push(null!==(i=this.journeyNumber)&&void 0!==i?i:"")):s.push(null!==(r=this.ptMode.shortName)&&void 0!==r?r:this.ptMode.ptMode),s.push("("+this.agencyID+")"),s.join(" ")}}class MD{constructor(t,e){this.stopPoint=t,this.journeyService=e,this.prevStopPoints=[],this.nextStopPoints=[]}static initWithTreeNode(t){const e=t.findChildNamed("StopEvent");if(null===e)return null;const i=e.findChildNamed("ThisCall/CallAtStop");if(null===i)return null;const r=zp.initWithTreeNode(i,"Intermediate");if(null===r)return null;const s=cS.initWithTreeNode(e);if(null===s)return null;const d=new MD(r,s);return["PreviousCall","OnwardCall"].forEach(y=>{const M="PreviousCall"===y?d.prevStopPoints:d.nextStopPoints;e.findChildrenNamed(y).forEach(z=>{const q=z.findChildNamed("CallAtStop");if(null===q)return;const Q=zp.initWithTreeNode(q,"Intermediate");Q&&M.push(Q)})}),d}patchStopEventLocations(t){let e=[this.stopPoint];["prev","next"].forEach(r=>{e=e.concat("prev"===r?this.prevStopPoints:this.nextStopPoints)}),e.forEach(r=>{var s;const d=null===(s=r.location.stopPlace)||void 0===s?void 0:s.stopPlaceRef;d&&d in t&&(r.location=t[d])})}asStationBoard(){var t,e,i;const r=this.computeServiceLineNumber(),s=null!==(t=this.journeyService.ptMode.shortName)&&void 0!==t?t:"N/A",d=this.computeStopTimeData(this.stopPoint.arrivalData),m=this.computeStopTimeData(this.stopPoint.departureData);return{stopEvent:this,serviceLineNumber:r,servicePtMode:s,tripNumber:this.journeyService.journeyNumber,tripHeading:null!==(i=null===(e=this.journeyService.destinationStopPlace)||void 0===e?void 0:e.stopPlaceName)&&void 0!==i?i:"N/A",tripOperator:this.journeyService.agencyID,mapStationBoardTime:{Arrivals:d,Departures:m},stopPlatform:this.stopPoint.plannedPlatform,stopPlatformActual:this.stopPoint.plannedPlatform===this.stopPoint.actualPlatform?null:this.stopPoint.actualPlatform,stopSituations:this.stopPoint.siriSituations}}computeServiceLineNumber(){var t;const e=null!==(t=this.journeyService.ptMode.shortName)&&void 0!==t?t:"N/A";return this.journeyService.serviceLineNumber||e}computeStopTimeData(t){var e;if(null===t)return null;const i=null!==t.delayMinutes,r=gl.formatTimeHHMM(t.timetableTime),s=t.estimatedTime?gl.formatTimeHHMM(t.estimatedTime):"n/a",d=!!t.estimatedTime&&r!==s,m=this.computeStopTime(t.timetableTime);return null===m?null:{stopTime:m,stopTimeActual:this.computeStopTime(null!==(e=t.estimatedTime)&&void 0!==e?e:null),stopDelayText:this.computeDelayTime(t),hasDelay:i,hasDelayDifferentTime:d}}computeStopTime(t){return null===t?null:gl.formatTimeHHMM(t)}computeDelayTime(t){var e;const i=null!==(e=t.delayMinutes)&&void 0!==e?e:null;if(null===i)return null;if(0===i)return"ON TIME";const r=[];return r.push(" "),r.push(i>0?"+":""),r.push(""+i),r.push("'"),r.join("")}}function VO(n,t,e,i,r,s,d){try{var m=n[s](d),y=m.value}catch(C){return void e(C)}m.done?t(y):Promise.resolve(y).then(i,r)}function uS(n){return function(){var t=this,e=arguments;return new Promise(function(i,r){var s=n.apply(t,e);function d(y){VO(s,i,r,d,m,"next",y)}function m(y){VO(s,i,r,d,m,"throw",y)}d(void 0)})}}var cW=qe(8472);class AD{constructor(t){this.stageConfig=t,this.requestInfo={requestDateTime:null,requestXML:null,responseDateTime:null,responseXML:null,parseDateTime:null,error:null},this.logRequests=!1,this.mockRequestXML=null,this.mockResponseXML=null}buildRequestXML(){return"<override/>"}fetchOJPResponse(){this.requestInfo.requestDateTime=new Date,this.requestInfo.requestXML=this.mockRequestXML?this.mockRequestXML:this.buildRequestXML();const t=this.stageConfig.apiEndpoint;this.logRequests&&(console.log("OJP Request: /POST - "+t),console.log(this.requestInfo.requestXML));const e={method:"POST",body:this.requestInfo.requestXML,headers:{"Content-Type":"text/xml",Authorization:"Bearer "+this.stageConfig.authBearerKey}};return new Promise(r=>{if(this.mockResponseXML)return this.requestInfo.responseXML=this.mockResponseXML,this.requestInfo.responseDateTime=new Date,void r(this.requestInfo);cW(t,e).then(s=>s.ok?s.text():(this.requestInfo.error={error:"FetchError",message:"HTTP ERROR - Status:"+s.status+" - URL:"+t},null)).then(s=>{null!==s&&(this.requestInfo.responseXML=s,this.requestInfo.responseDateTime=new Date),r(this.requestInfo)}).catch(s=>{this.requestInfo.error={error:"FetchError",message:s},r(this.requestInfo)})})}}class jO{constructor(t,e,i,r){this.legType=t,this.legID=e,this.fromLocation=i,this.toLocation=r,this.legTrack=null,this.legDuration=null}patchLocations(t){[this.fromLocation,this.toLocation].forEach(e=>{var i;this.patchLocation(e,t),!e.geoPosition&&null!==(i=this.legTrack)&&void 0!==i&&i.hasGeoData&&(e===this.fromLocation?this.fromLocation.geoPosition=this.legTrack.fromGeoPosition():this.toLocation.geoPosition=this.legTrack.toGeoPosition())})}patchSituations(t){}patchLocation(t,e){var i,r;if(t.geoPosition)return;const s=null!==(r=null===(i=t.stopPlace)||void 0===i?void 0:i.stopPlaceRef)&&void 0!==r?r:null;if(null===s)return console.error("TripLeg.patchLocation - no stopPlaceRef found in location"),void console.log(t);if(!(s in e))return console.error("TripLeg.patchLocation - no stopPlaceRef found in mapContextLocations"),console.log(t),console.log("location.stopPlace?.stopPlaceRef :"+s),void console.log(e);const d=e[s];t.locationName=d.locationName,t.stopPlace=d.stopPlace,t.geoPosition=d.geoPosition}computeGeoJSONFeatures(){let t=[];if(this.useBeeline()){const r=this.computeBeelineFeature();r&&t.push(r)}const i=this.computeLinePointFeatures();return t=t.concat(i),t=t.concat(this.computeSpecificJSONFeatures()),t.forEach(r=>{r.properties&&(r.properties["leg.idx"]=this.legID-1,r.properties[Yo.LegType]=this.computeLegType())}),t}useBeeline(){var t;return!(null!==(t=this.legTrack)&&void 0!==t&&t.hasGeoData)}computeLegType(){return"TimedLeg"==this.legType?"TimedLeg":"TransferLeg"==this.legType?"TransferLeg":"ContinousLeg"==this.legType?"ContinousLeg":"n/a"}computeSpecificJSONFeatures(){return[]}computeLegColor(){var t;return null!==(t=Dv[this.legType])&&void 0!==t?t:Dv.TimedLeg}computeLinePointsData(){const t=[];return[this.fromLocation,this.toLocation].forEach(i=>{var r,s;const d=i.asGeoJSONFeature();if(null!=d&&d.properties){const m=i===this.fromLocation,y=m?"From":"To",C=m?null===(r=this.legTrack)||void 0===r?void 0:r.fromGeoPosition():null===(s=this.legTrack)||void 0===s?void 0:s.toGeoPosition();C&&(d.geometry.coordinates=C.asPosition()),t.push({type:y,feature:d})}}),t}computeLinePointFeatures(){const t=[],e=this.computeLegLineType();return this.computeLinePointsData().forEach(r=>{const d=r.feature;null!==d.properties&&(d.properties[Yo.PointType]=r.type,d.properties[Yo.DrawType]="LegPoint",d.properties[Yo.LineType]=e,d.bbox=[d.geometry.coordinates[0],d.geometry.coordinates[1],d.geometry.coordinates[0],d.geometry.coordinates[1]],t.push(d))}),t}computeLegLineType(){return"Unknown"}computeBeelineFeature(){const t=this.computeBeelineGeoPositions();if(t.length<2)return null;const e=[];t.forEach(y=>{e.push(y.asPosition())});const i={};i[Yo.DrawType]="Beeline";const s=this.computeLegLineType();i[Yo.LineType]=s;const d=new Bp(t);return{type:"Feature",properties:i,geometry:{type:"LineString",coordinates:e},bbox:d.asFeatureBBOX()}}computeBeelineGeoPositions(){const t=[];return[this.fromLocation,this.toLocation].forEach(i=>{i.geoPosition&&t.push(i.geoPosition)}),t}}class dS{constructor(t,e){this.coordinates=t,this.bbox=e}static initWithTreeNode(t){const e=t.findChildNamed("LinkProjection");if(null===e)return null;const i=[];if(e.findChildrenNamed("Position").forEach(m=>{const y=m.findTextFromChildNamed("siri:Longitude"),C=m.findTextFromChildNamed("siri:Latitude");if(y&&C){const M=new Is(parseFloat(y),parseFloat(C));i.push(M)}}),i.length<2)return null;const s=new Bp(i);return new dS(i,s)}computeLength(){let t=0;return this.coordinates.forEach((e,i)=>{0!==i&&(t+=e.distanceFrom(this.coordinates[i-1]))}),t}asGeoJSONFeature(){const t={type:"Feature",bbox:this.bbox.asFeatureBBOX(),properties:{},geometry:{type:"LineString",coordinates:[]}};return this.coordinates.forEach(e=>{t.geometry.coordinates.push([e.longitude,e.latitude])}),t}}class kD{constructor(t){this.sections=t}static initWithTreeNode(t){const e=t.findChildNamed("PathGuidance");if(null===e)return null;let i=[];return e.findChildrenNamed("PathGuidanceSection").forEach(d=>{const m=RD.initWithSectionTreeNode(d);m&&i.push(m)}),new kD(i)}}class RD{constructor(){this.trackSection=null,this.guidanceAdvice=null,this.turnAction=null}static initWithSectionTreeNode(t){const e=new RD,i=t.findChildNamed("TrackSection");return i&&(e.trackSection=PD.initWithTrackSectionTreeNode(i)),e.guidanceAdvice=t.findTextFromChildNamed("GuidanceAdvice"),e.turnAction=t.findTextFromChildNamed("TurnAction"),e}}class PD{constructor(){this.linkProjection=null,this.roadName=null,this.duration=null,this.length=null}static initWithTrackSectionTreeNode(t){const e=new PD;e.linkProjection=dS.initWithTreeNode(t),e.roadName=t.findTextFromChildNamed("RoadName"),e.duration=t.findTextFromChildNamed("Duration");const i=t.findTextFromChildNamed("Length");return null!==i&&(e.length=parseInt(i,10)),e}}class ad{constructor(t,e){this.hours=t,this.minutes=e,this.totalMinutes=60*t+e}static initWithTreeNode(t,e="Duration"){const i=t.findTextFromChildNamed(e);return null===i?null:ad.initFromDurationText(i)}static initFromDurationText(t){if(null===t)return null;let e=0;const i=(t=t.replace("PT","")).match(/([0-9]+?)H/);i&&(e=parseInt(i[1]));let r=0;const s=t.match(/([0-9]+?)M/);return s&&(r=parseInt(s[1])),new ad(e,r)}static initFromTotalMinutes(t){const e=Math.floor(t/60);return new ad(e,t-60*e)}formatDuration(){const t=[];return this.hours>0&&t.push(this.hours+"h "),t.push(this.minutes+"min"),t.join("")}plus(t){return ad.initFromTotalMinutes(this.totalMinutes+t.totalMinutes)}}class hS{constructor(t){this.trackSections=t;let e=0;this.hasGeoData=!1,t.forEach(i=>{i.linkProjection&&(this.hasGeoData=!0),i.duration&&(e+=i.duration.totalMinutes)}),this.duration=null,e>0&&(this.duration=ad.initFromTotalMinutes(e))}static initWithLegTreeNode(t){const e=t.findChildNamed("LegTrack");if(null===e)return null;const i=[];return e.findChildrenNamed("TrackSection").forEach(d=>{const m=LD.initWithTreeNode(d);m&&i.push(m)}),new hS(i)}fromGeoPosition(){if(0===this.trackSections.length)return null;const e=this.trackSections[0].linkProjection;return null===e?null:e.coordinates[0]}toGeoPosition(){if(0===this.trackSections.length)return null;const e=this.trackSections[this.trackSections.length-1].linkProjection;return null===e?null:e.coordinates[e.coordinates.length-1]}}class LD{constructor(t,e){this.fromLocation=t,this.toLocation=e,this.duration=null,this.length=null,this.linkProjection=null}static initWithTreeNode(t){const e=t.findChildNamed("TrackStart"),i=t.findChildNamed("TrackEnd");if(!e||!i)return null;const r=ao.initWithTreeNode(e),s=ao.initWithTreeNode(i);if(!r||!s)return console.error("CANT instantiate TrackSection.initWithTreeNode"),console.log(t),null;const d=new LD(r,s);d.duration=ad.initWithTreeNode(t);const m=dS.initWithTreeNode(t);d.linkProjection=m;const y=t.findTextFromChildNamed("Length");return null===y?m&&(d.length=m.computeLength()):d.length=parseInt(y,10),d}}class pS{constructor(t){this.bookingArrangements=t}static initWithLegTreeNode(t){const e=t.findChildNamed("Service/BookingArrangements");if(null===e)return null;const i=e.findChildrenNamed("BookingArrangement");if(0===i.length)return console.error("ERROR - no BookingArrangements nodes found"),null;const r=[];return i.forEach(d=>{const m=d.findTextFromChildNamed("BookingAgencyName/Text");let y=d.findTextFromChildNamed("InfoUrl");if(null===m||null===y||(y=y.trim(),y.length<2))return;"<"===y[0]&&(y=y.substring(1,y.length-1));var C=document.createElement("textarea");C.innerHTML=y.trim(),y=C.innerText;const M={agencyCode:m.trim(),agencyName:pS.computeAgencyName(m),infoURL:y};r.push(M)}),new pS(r)}static computeAgencyName(t){return(t=t.trim()).endsWith("_local.ch")?"local.ch":t.endsWith("_maps.google.ch")?"maps.google.com":t.endsWith("_openstreetmap.org")?"openstreetmap.org":"n/a catalog: "+t}}class fS extends jO{constructor(t,e,i,r,s){super(t,e,r,s),this.legTransportMode=null,this.legDistance=i,this.pathGuidance=null,this.walkDuration=null,this.serviceBooking=null}static initWithTreeNode(t,e,i){var r;const s=e.findChildNamed("LegStart"),d=e.findChildNamed("LegEnd");if(null===s||null===d)return null;const m=ao.initWithTreeNode(s),y=ao.initWithTreeNode(d);if(null===m||null===y)return null;let C=null!==(r=e.findTextFromChildNamed("Length"))&&void 0!==r?r:"0";const M=parseInt(C),k=new fS(i,t,M,m,y);return k.legDuration=ad.initWithTreeNode(e),k.pathGuidance=kD.initWithTreeNode(e),k.legTransportMode=k.computeLegTransportModeFromTreeNode(e),("taxi"===k.legTransportMode||"others-drive-car"===k.legTransportMode)&&(k.serviceBooking=pS.initWithLegTreeNode(e)),k.legTrack=hS.initWithLegTreeNode(e),"TransferLeg"===i&&(k.walkDuration=ad.initWithTreeNode(e,"WalkDuration")),k}computeLegTransportModeFromTreeNode(t){const e=t.findTextFromChildNamed("Service/IndividualMode"),i=t.findTextFromChildNamed("Service/BookingArrangements/BookingArrangement/BookingAgencyName/Text");return this.computeLegTransportModeFromString(e,i)}computeLegTransportModeFromString(t,e=null){return null===t?null:"walk"===t?"walk":"self-drive-car"===t?"self-drive-car":"cycle"===t?"cycle":"taxi"===t?-1!==(null==e?void 0:e.indexOf("_limousine_"))?"others-drive-car":"taxi":null}isDriveCarLeg(){return"self-drive-car"===this.legTransportMode}isSharedMobility(){return null!==this.legTransportMode&&-1!==["cycle","bicycle_rental","car_sharing","escooter_rental"].indexOf(this.legTransportMode)}isWalking(){return"walk"===this.legTransportMode}isTaxi(){return"taxi"===this.legTransportMode||"others-drive-car"===this.legTransportMode}computeSpecificJSONFeatures(){var t,e;const i=[];return null===(t=this.pathGuidance)||void 0===t||t.sections.forEach((r,s)=>{var d,m,y,C,M,k,z,q,Q,xe;const De=null===(m=null===(d=r.trackSection)||void 0===d?void 0:d.linkProjection)||void 0===m?void 0:m.asGeoJSONFeature();null!=De&&De.properties&&(De.properties[Yo.DrawType]="LegLine",De.properties[Yo.LineType]="Guidance",De.properties["PathGuidanceSection.idx"]=s,De.properties["PathGuidanceSection.TrackSection.RoadName"]=null!==(C=null===(y=r.trackSection)||void 0===y?void 0:y.roadName)&&void 0!==C?C:"",De.properties["PathGuidanceSection.TrackSection.Duration"]=null!==(k=null===(M=r.trackSection)||void 0===M?void 0:M.duration)&&void 0!==k?k:"",De.properties["PathGuidanceSection.TrackSection.Length"]=null!==(q=null===(z=r.trackSection)||void 0===z?void 0:z.length)&&void 0!==q?q:"",De.properties["PathGuidanceSection.GuidanceAdvice"]=null!==(Q=r.guidanceAdvice)&&void 0!==Q?Q:"",De.properties["PathGuidanceSection.TurnAction"]=null!==(xe=r.turnAction)&&void 0!==xe?xe:"",i.push(De))}),null===(e=this.legTrack)||void 0===e||e.trackSections.forEach(r=>{var s;const d=null===(s=r.linkProjection)||void 0===s?void 0:s.asGeoJSONFeature();null!=d&&d.properties&&(d.properties[Yo.DrawType]="LegLine",d.properties[Yo.LineType]=this.computeLegLineType(),i.push(d))}),i}computeLegLineType(){return this.isDriveCarLeg()?"Self-Drive Car":this.isSharedMobility()?"Shared Mobility":this.isTaxi()?"OnDemand":"TransferLeg"===this.legType?"Transfer":"Walk"}computeLinePointsData(){return"TransferLeg"===this.legType?[]:super.computeLinePointsData()}computeLegColor(){return this.isDriveCarLeg()?Dm["Self-Drive Car"]:this.isSharedMobility()?Dm["Shared Mobility"]:"TransferLeg"===this.legType?Dm.Transfer:this.isTaxi()?Dm.OnDemand:Dm.Walk}formatDistance(){return this.legDistance>1e3?(this.legDistance/1e3).toFixed(1)+" km":this.legDistance+" m"}useBeeline(){if("TransferLeg"===this.legType){if(null===this.pathGuidance)return super.useBeeline();let t=!1;return this.pathGuidance.sections.forEach(e=>{var i;null!==(i=e.trackSection)&&void 0!==i&&i.linkProjection&&(t=!0)}),!1===t}return super.useBeeline()}}class Mv extends jO{constructor(t,e,i,r,s=[]){super("TimedLeg",t,i.location,r.location),this.service=e,this.fromStopPoint=i,this.toStopPoint=r,this.intermediateStopPoints=s}static initWithTreeNode(t,e){const i=cS.initWithTreeNode(e);if(null===i)return null;const r=e.findChildNamed("LegBoard"),s=e.findChildNamed("LegAlight");if(null===r||null===s)return null;const d=zp.initWithTreeNode(r,"From"),m=zp.initWithTreeNode(s,"To");if(null===d||null===m)return null;const y=[];e.findChildrenNamed("LegIntermediates").forEach(k=>{const z=zp.initWithTreeNode(k,"Intermediate");z&&y.push(z)});const M=new Mv(t,i,d,m,y);return M.legTrack=hS.initWithLegTreeNode(e),M.legTrack&&null===M.legDuration&&(M.legDuration=M.legTrack.duration),M}patchLocations(t){super.patchLocations(t),this.intermediateStopPoints.forEach(e=>{this.patchLocation(e.location,t)})}computeDepartureTime(){return this.computeStopPointTime(this.fromStopPoint.departureData)}computeArrivalTime(){return this.computeStopPointTime(this.toStopPoint.arrivalData)}computeStopPointTime(t){var e;return null===t?null:null!==(e=t.estimatedTime)&&void 0!==e?e:t.timetableTime}computeSpecificJSONFeatures(){var t;let e=[];const i=this.service.computeLegLineType();return!this.useBeeline()&&(null===(t=this.legTrack)||void 0===t||t.trackSections.forEach(s=>{var d;const m=null===(d=s.linkProjection)||void 0===d?void 0:d.asGeoJSONFeature();null!=m&&m.properties&&(m.properties[Yo.DrawType]="LegLine",m.properties[Yo.LineType]=i,e.push(m))})),e}computeLegLineType(){return this.service.computeLegLineType()}computeLinePointsData(){const t=super.computeLinePointsData();return this.intermediateStopPoints.forEach(e=>{const i=e.location.asGeoJSONFeature();null!=i&&i.properties&&t.push({type:"Intermediate",feature:i})}),t}computeLegColor(){var t;const e=super.computeLegColor(),i=this.service.computeLegLineType();return null!==(t=Dm[i])&&void 0!==t?t:e}computeBeelineGeoPositions(){const t=[],e=[];return e.push(this.fromStopPoint),this.intermediateStopPoints.forEach(i=>{e.push(i)}),e.push(this.toStopPoint),e.forEach(i=>{i.location.geoPosition&&t.push(i.location.geoPosition)}),t}useBeeline(){const t=this.service.ptMode.hasPrecisePolyline();return super.useBeeline()||!t}patchSituations(t){this.service.siriSituations=[],this.service.siriSituationIds.forEach(e=>{var i;const r=null!==(i=t[e])&&void 0!==i?i:null;r&&this.service.siriSituations.push(r)})}}class Wa{constructor(t){this.location=t,this.minDuration=2,this.maxDuration=30,this.minDistance=100,this.maxDistance=2e4,this.customTransportMode=null}static Empty(){const t=new ao;return new Wa(t)}}class OD{constructor(t,e,i){this.id=t,this.legs=e,this.stats=i,this.tripFareResults=[]}static initFromTreeNode(t){const e=t.findTextFromChildNamed("TripId");if(null===e)return null;const i=ad.initFromDurationText(t.findTextFromChildNamed("Duration"));if(null===i)return null;const r=t.findTextFromChildNamed("Transfers");if(null===r)return null;const s=t.findTextFromChildNamed("StartTime"),d=t.findTextFromChildNamed("EndTime");if(null===s||null===d)return null;const m=new Date(Date.parse(s)),y=new Date(Date.parse(d)),C=[];let M=0;if(t.findChildrenNamed("TripLeg").forEach(Ze=>{var It,ut;const Ht=class uW{static initWithTreeNode(t){const e=t.findTextFromChildNamed("LegId");if(null===e)return null;const i=parseInt(e,10),r=t.findChildNamed("TransferLeg");if(r){const m=fS.initWithTreeNode(i,r,"TransferLeg");if(m)return m}const s=t.findChildNamed("TimedLeg");if(s){const m=Mv.initWithTreeNode(i,s);if(m)return m}const d=t.findChildNamed("ContinuousLeg");if(d){const m=fS.initWithTreeNode(i,d,"ContinousLeg");if(m)return m}return null}}.initWithTreeNode(Ze);null!==Ht&&((null!==(ut=null===(It=Ht.legTrack)||void 0===It?void 0:It.trackSections)&&void 0!==ut?ut:[]).forEach(Yn=>{var ai;M+=null!==(ai=Yn.length)&&void 0!==ai?ai:0}),C.push(Ht))}),0===C.length)return console.error("Trip.initFromTreeNode no legs found ?"),console.log(t),null;let z=0,q="trip";const Q=t.findTextFromChildNamed("Distance");null===Q?(q="legs-sum",z=M):z=parseInt(Q);const xe={duration:i,distanceMeters:z,distanceSource:q,transferNo:parseInt(r),startDatetime:m,endDatetime:y};return new OD(e,C,xe)}computeDepartureTime(){var t;const e=this.legs.filter(d=>d instanceof Mv);if(0===e.length)return console.log("No TimedLeg found for this trip"),console.log(this),null;const r=e[0].fromStopPoint.departureData;return null===r?null:null!==(t=r.estimatedTime)&&void 0!==t?t:r.timetableTime}computeArrivalTime(){var t;const e=this.legs.filter(d=>d instanceof Mv);if(0===e.length)return console.log("No TimedLeg found for this trip"),console.log(this),new Date;const r=e[e.length-1].toStopPoint.arrivalData;return null===r?null:null!==(t=r.estimatedTime)&&void 0!==t?t:r.timetableTime}computeGeoJSON(){let t=[];return this.legs.forEach(i=>{const r=i.computeGeoJSONFeatures();t=t.concat(r)}),{type:"FeatureCollection",features:t}}computeFromLocation(){return 0===this.legs.length?null:this.legs[0].fromLocation}computeToLocation(){return 0===this.legs.length?null:this.legs[this.legs.length-1].toLocation}computeBBOX(){var t,e;const i=new Bp([]),r=null===(t=this.computeFromLocation())||void 0===t?void 0:t.geoPosition;r&&i.extend(r);const s=null===(e=this.computeToLocation())||void 0===e?void 0:e.geoPosition;return s&&i.extend(s),this.legs.forEach(d=>{d.computeGeoJSONFeatures().forEach(y=>{var C;const M=null!==(C=y.bbox)&&void 0!==C?C:null;null!==M&&(i.extend(new Is(M[0],M[1])),i.extend(new Is(M[2],M[3])))})}),i}}var dW=qe(7904);class FD{constructor(){this.serviceRequestNode=this.computeBaseServiceRequestNode()}computeBaseServiceRequestNode(){const t=dW.create("siri:OJP",{version:"1.0",encoding:"utf-8"});return t.att("xmlns","http://www.vdv.de/ojp"),t.att("xmlns:siri","http://www.siri.org.uk/siri"),t.att("xmlns:xsi","http://www.w3.org/2001/XMLSchema-instance"),t.att("xmlns:xsd","http://www.w3.org/2001/XMLSchema"),t.att("xsi:schemaLocation","http://www.vdv.de/ojp"),t.att("version","1.0"),t.ele("siri:OJPRequest").ele("siri:ServiceRequest")}buildRequestNode(){this.serviceRequestNode=this.computeBaseServiceRequestNode()}buildRequestXML(){return this.buildRequestNode(),this.serviceRequestNode.end({pretty:!0})}}class ld extends FD{constructor(t,e,i=new Date,r="Dep"){super(),this.fromTripLocation=t,this.toTripLocation=e,this.departureDate=i,this.tripRequestBoardingType=r,this.modeType="monomodal",this.transportMode="public_transport",this.includeLegProjection=!0,this.useNumberOfResultsAfter=!0}static Empty(){const t=Wa.Empty();return new ld(t,t,new Date,"Dep")}static initWithLocationsAndDate(t,e,i=new Date,r="Dep"){if(null===t||null===e)return null;const s=new Wa(t),d=new Wa(e);return ld.initWithTripLocationsAndDate(s,d,i,r)}static initWithTripLocationsAndDate(t,e,i=new Date,r="Dep"){return null===t||null===e||!t.location.geoPosition&&!t.location.stopPlace||!e.location.geoPosition&&!e.location.stopPlace?null:new ld(t,e,i,r)}buildRequestNode(){super.buildRequestNode();const e=(new Date).toISOString();this.serviceRequestNode.ele("siri:RequestTimestamp",e),this.serviceRequestNode.ele("siri:RequestorRef","OJP_JS_SDK_v"+bS);const i=this.serviceRequestNode.ele("OJPTripRequest");i.ele("siri:RequestTimestamp",e);const s="monomodal"===this.modeType,d=this.transportMode,m=["From","To"];m.forEach(k=>{var z,q,Q,xe;const De="From"===k,Ze=De?this.fromTripLocation:this.toTripLocation,It=Ze.location,Ht=i.ele(De?"Origin":"Destination"),Mn=Ht.ele("PlaceRef");if(null!==(z=It.stopPlace)&&void 0!==z&&z.stopPlaceRef){const ai=null!==(q=It.locationName)&&void 0!==q?q:"n/a";let Tr=null!==(xe=null===(Q=It.stopPlace)||void 0===Q?void 0:Q.stopPlaceRef)&&void 0!==xe?xe:"";Mn.ele("StopPlaceRef",Tr),Mn.ele("LocationName").ele("Text",ai)}else if(It.geoPosition){const ai=Mn.ele("GeoPosition");ai.ele("siri:Longitude",It.geoPosition.longitude),ai.ele("siri:Latitude",It.geoPosition.latitude);const Tr=It.geoPosition.asLatLngString();Mn.ele("LocationName").ele("Text",Tr)}const Yn=this.departureDate.toISOString();if(De?"Dep"===this.tripRequestBoardingType&&Ht.ele("DepArrTime",Yn):"Arr"===this.tripRequestBoardingType&&Ht.ele("DepArrTime",Yn),s){if(De&&-1!==["walk","cycle"].indexOf(d)){const Tr=Ht.ele("IndividualTransportOptions");Tr.ele("Mode",d),"walk"===d&&Tr.ele("MaxDuration","PT3000M"),"cycle"===d&&Tr.ele("MaxDuration","PT600M")}}else if(("taxi"===d||"others-drive-car"===d)&&(()=>!(De&&"mode_at_end"===this.modeType||!De&&"mode_at_start"===this.modeType))()){const ma=Ht.ele("IndividualTransportOptions");Ze.customTransportMode&&ma.ele("Mode",Ze.customTransportMode),ma.ele("MinDuration","PT"+Ze.minDuration+"M"),ma.ele("MaxDuration","PT"+Ze.maxDuration+"M"),ma.ele("MinDistance",Ze.minDistance),ma.ele("MaxDistance",Ze.maxDistance)}});const y=i.ele("Params"),M=(()=>this.useNumberOfResultsAfter&&"Dep"===this.tripRequestBoardingType?"NumberOfResultsAfter":this.useNumberOfResultsAfter&&"Arr"===this.tripRequestBoardingType?"NumberOfResultsBefore":"NumberOfResults")();if(y.ele(M,5),"NumberOfResultsAfter"===M&&y.ele("NumberOfResultsBefore",0),"NumberOfResultsBefore"===M&&y.ele("NumberOfResultsAfter",0),y.ele("IncludeTrackSections",!0),y.ele("IncludeLegProjection",this.includeLegProjection),y.ele("IncludeTurnDescription",!0),y.ele("IncludeIntermediateStops",!0),s)-1!==["walk","self-drive-car","cycle","taxi","others-drive-car"].indexOf(d)&&y.ele("ItModesToCover",d),-1!==["bicycle_rental","car_sharing","escooter_rental"].indexOf(d)&&y.ele("Extension").ele("ItModesToCover",d);else if("taxi"!==d&&"others-drive-car"!==d){const q=y.ele("Extension");m.forEach(Q=>{const xe="From"===Q;if(xe&&"mode_at_end"===this.modeType||!xe&&"mode_at_start"===this.modeType)return;const De=xe?this.fromTripLocation:this.toTripLocation,It=q.ele(xe?"Origin":"Destination");It.ele("MinDuration","PT"+De.minDuration+"M"),It.ele("MaxDuration","PT"+De.maxDuration+"M"),It.ele("MinDistance",De.minDistance),It.ele("MaxDistance",De.maxDistance),De.customTransportMode&&It.ele("Mode",De.customTransportMode)})}}}const Av={key:"PROD",apiEndpoint:"https://api.opentransportdata.swiss/ojp2020",authBearerKey:"57c5dbbbf1fe4d00010000186ba6e4bb4be543a9b4e40d2d6495592b"};class ND{constructor(t,e,i){this.summary=t,this.description=e,this.details=i}static initWithSituationTreeNode(t){const e=t.findTextFromChildNamed("siri:Summary"),i=t.findTextFromChildNamed("siri:Description");if(!e||!i)return console.error("ERROR: SituationContent.initFromSituationNode - cant init"),console.log(t),null;const r=[];return t.findChildrenNamed("siri:Detail").forEach(m=>{const y=m.text;y&&r.push(y)}),0===r.length?(console.error("ERROR: SituationContent.initFromSituationNode - empty details"),console.log(t),null):new ND(e,i,r)}}class BD{constructor(t){this.sourceType=t,this.countryRef=null,this.name=null,this.externalCode=null}static initWithSituationTreeNode(t){const e=t.findTextFromChildNamed("siri:Source/siri:SourceType");if(null===e)return console.log("ERROR - cant PtSituationSource.initFromSituationNode"),console.log(t),null;const i=new BD(e);return i.countryRef=t.findTextFromChildNamed("siri:Source/siri:CountryRef"),i.name=t.findTextFromChildNamed("siri:Source/siri:Name"),i.externalCode=t.findTextFromChildNamed("siri:Source/siri:ExternalCode"),i}}class mS{constructor(t,e,i,r,s,d,m,y){this.situationNumber=t,this.creationTime=e,this.participantRef=i,this.version=r,this.source=s,this.validityPeriod=d,this.priority=m,this.situationContent=y,this.treeNode=null}static initWithSituationTreeNode(t){const e=t.findTextFromChildNamed("siri:SituationNumber"),i=t.findTextFromChildNamed("siri:CreationTime");if(null===i)return console.error("ERROR: PtSituationElement.initFromSituationNode - creationTimeS is null"),console.log(t),null;const r=new Date(i),s=t.findTextFromChildNamed("siri:ParticipantRef"),d=t.findTextFromChildNamed("siri:Version");if(null===d)return console.error("ERROR: PtSituationElement.initFromSituationNode - Version is NULL"),console.log(t),null;const m=parseInt(d),y=BD.initWithSituationTreeNode(t),C=t.findTextFromChildNamed("siri:ValidityPeriod/siri:StartTime"),M=t.findTextFromChildNamed("siri:ValidityPeriod/siri:EndTime");if(!C||!M)return console.error("ERROR: PtSituationElement.initFromSituationNode - ValidityPeriod is null"),console.log("      PtSituationElement.initFromSituationNode - ValidityPeriod/StartTime"+C),console.log("      PtSituationElement.initFromSituationNode - ValidityPeriod/EndTime"+M),null;const k={startDate:new Date(C),endDate:new Date(M)},z=t.findTextFromChildNamed("siri:Priority");if(null===z)return console.error("ERROR: PtSituationElement.initFromSituationNode - Priority is NULL"),console.log(t),null;const q=parseInt(z),Q=ND.initWithSituationTreeNode(t);if(!(e&&s&&y&&Q))return console.error("ERROR: PtSituationElement.initFromSituationNode - cant init"),console.log(t),null;const xe=new mS(e,r,s,m,y,k,q,Q);return xe.treeNode=t,xe}}class hW extends wD{constructor(){super(),this.callback=null,this.trips=[],this.tripsNo=0,this.mapContextLocations={},this.mapContextSituations={}}reset(){this.trips=[],this.tripsNo=0,this.mapContextLocations={},this.mapContextSituations={}}parseXML(t){this.reset(),this.tripsNo=t.split("<TripResult>").length-1,0===this.tripsNo&&(this.tripsNo=t.split("<ojp:TripResult>").length-1),this.callback&&this.callback({trips:this.trips,tripsNo:this.tripsNo,message:"TripRequest.TripsNo"}),super.parseXML(t)}onCloseTag(t){if("Trip"===t&&"TripResult"===this.currentNode.parentName){const e=OD.initFromTreeNode(this.currentNode);e&&(e.legs.forEach(i=>{i.patchLocations(this.mapContextLocations),i.patchSituations(this.mapContextSituations)}),this.trips.push(e),this.callback&&this.callback({tripsNo:this.tripsNo,trips:this.trips,message:"TripRequest.Trip"}))}if("TripResponseContext"===t){const e=this.currentNode.findChildNamed("Places");e&&(this.mapContextLocations={},e.findChildrenNamed("Location").forEach(s=>{var d,m;const y=ao.initWithTreeNode(s),C=null!==(m=null===(d=y.stopPlace)||void 0===d?void 0:d.stopPlaceRef)&&void 0!==m?m:null;null!==C&&(this.mapContextLocations[C]=y)}));const i=this.currentNode.findChildNamed("Situations");i&&(this.mapContextSituations={},i.findChildrenNamed("PtSituation").forEach(s=>{const d=mS.initWithSituationTreeNode(s);d&&(this.mapContextSituations[d.situationNumber]=d)}))}}onEnd(){this.callback&&this.callback({tripsNo:this.tripsNo,trips:this.trips,message:"TripRequest.DONE"})}}class cu extends AD{constructor(t,e){super(t),this.requestParams=e,this.requestInfo.requestXML=this.buildRequestXML()}static initWithResponseMock(t){const e=ld.Empty(),i=new cu(Av,e);return i.mockResponseXML=t,i}static initWithRequestMock(t){const e=ld.Empty(),i=new cu(Av,e);return i.mockRequestXML=t,i}static initWithStopRefs(t,e,i,r=new Date,s="Dep"){const d=ao.initWithStopPlaceRef(e),m=ao.initWithStopPlaceRef(i),y=ld.initWithLocationsAndDate(d,m,r,s);return null===y?null:new cu(t,y)}static initWithLocationsAndDate(t,e,i,r,s="Dep"){const d=ld.initWithLocationsAndDate(e,i,r,s);return null===d?null:new cu(t,d)}static initWithTripLocationsAndDate(t,e,i,r,s="Dep"){const d=ld.initWithTripLocationsAndDate(e,i,r,s);return null===d?null:new cu(t,d)}buildRequestXML(){return this.requestParams.buildRequestXML()}fetchResponse(){var t=this;return uS(function*(){return yield t.fetchOJPResponse(),new Promise(i=>{t.parseTripRequestResponse(i)})})()}fetchResponseWithCallback(t){this.fetchOJPResponse().then(e=>{this.requestInfo=e,this.parseTripRequestResponse(t)})}parseTripRequestResponse(t){if(null!==this.requestInfo.error||null===this.requestInfo.responseXML){return void t({tripsNo:0,trips:[],message:"ERROR"})}const e=new hW;e.callback=i=>{"TripRequest.DONE"===i.message&&this.sortTrips(i.trips),"TripRequest.Trip"===i.message&&1===i.trips.length&&(this.requestInfo.parseDateTime=new Date),t(i)},e.parseXML(this.requestInfo.responseXML)}sortTrips(t){var e;const r=this.requestParams.transportMode;if("monomodal"!==this.requestParams.modeType)return;const s=null!==(e=t.find(d=>1===d.legs.length&&"ContinousLeg"===d.legs[0].legType&&d.legs[0].legTransportMode===r))&&void 0!==e?e:null;if(s){const d=t.indexOf(s);t.splice(d,1),t.unshift(s)}}}class pW{constructor(t,e){this.stageConfig=t,this.requestParams=e,this.tripRequests=[],this.sections=[]}fetchResponse(t){const e=this.requestParams.departureDate;this.tripRequests=[],this.computeTripResponse(0,e,t)}computeTripResponse(t,e,i){const r=t===this.requestParams.tripModeTypes.length-1,m=ld.initWithTripLocationsAndDate(this.requestParams.tripLocations[t],this.requestParams.tripLocations[t+1],e,this.requestParams.tripRequestBoardingType);if(null===m)return void console.error("JourneyRequest - TripsRequestParams null for trip idx "+t);m.includeLegProjection=this.requestParams.includeLegProjection,m.useNumberOfResultsAfter=this.requestParams.useNumberOfResultsAfter,m.modeType=this.requestParams.tripModeTypes[t],m.transportMode=this.requestParams.transportModes[t];const y=new cu(this.stageConfig,m);this.tripRequests.push(y),y.fetchResponseWithCallback(C=>{if("ERROR"!==C.message){if(t>this.sections.length-1&&this.sections.push(C),this.sections[t]=C,("TripRequest.TripsNo"===C.message||"TripRequest.Trip"===C.message)&&i({sections:this.sections,message:C.message,error:null}),"TripRequest.DONE"===C.message){if(!(C.trips.length>0))return void i({sections:this.sections,message:"JourneyRequest.DONE",error:null});r?i({sections:this.sections,message:"JourneyRequest.DONE",error:null}):this.computeTripResponse(t+1,e=C.trips[0].stats.endDatetime,i)}}else i({sections:this.sections,message:"ERROR",error:{error:"ParseTripsXMLError",message:"TODO - handle this"}})})}}class zD{constructor(t,e,i,r,s){this.tripLocations=t,this.tripModeTypes=e,this.transportModes=i,this.departureDate=r,this.includeLegProjection=!0,this.useNumberOfResultsAfter=!0,this.tripRequestBoardingType=s}static initWithLocationsAndDate(t,e,i,r,s,d,m){if(null===t||null===e)return null;if(!t.location.geoPosition&&!t.location.stopPlace||!e.location.geoPosition&&!e.location.stopPlace)return console.error("JourneyRequestParams.initWithLocationsAndDate - broken from, to"),console.log(t),console.log(e),null;let y=!1;if(i.forEach(k=>{null===k.location.geoPosition&&(y=!0)}),y)return console.error("JourneyRequestParams.initWithLocationsAndDate - broken via"),console.log(i),null;if(i.length+1!==r.length)return console.error("JourneyRequestParams.initWithLocationsAndDate - wrong via/mot types"),console.log(i),console.log(r),null;let C=[];return C.push(t),C=C.concat(i),C.push(e),new zD(C,r,s,d,m)}}class fW extends wD{constructor(){super(),this.callback=null,this.locations=[]}parseXML(t){this.locations=[],super.parseXML(t)}onCloseTag(t){if("Location"===t&&"OJPLocationInformationDelivery"===this.currentNode.parentName){const e=ao.initWithLocationResultTreeNode(this.currentNode);e&&this.locations.push(e)}}onError(t){console.error("ERROR: SAX parser"),console.log(t),this.callback&&this.callback({locations:this.locations,message:"ERROR"})}onEnd(){this.callback&&this.callback({locations:this.locations,message:"LocationInformation.DONE"})}}class Vp extends FD{constructor(){super(),this.locationName=null,this.stopPlaceRef=null,this.geoRestrictionType=null,this.poiOsmTags=null,this.numberOfResults=null,this.bboxWest=null,this.bboxNorth=null,this.bboxEast=null,this.bboxSouth=null}static initWithLocationName(t,e=null){const i=new Vp;return i.locationName=t,null!==e&&(i.geoRestrictionType=e),i}static initWithStopPlaceRef(t){const e=new Vp;return e.stopPlaceRef=t,e}static initWithBBOXAndType(t,e,i,r,s,d=1e3,m=null){const y=new Vp;return y.bboxWest=t,y.bboxNorth=e,y.bboxEast=i,y.bboxSouth=r,y.numberOfResults=d,y.geoRestrictionType=s,y.poiOsmTags=m,y}buildRequestNode(){var t,e,i,r,s,d,m;super.buildRequestNode();const C=(new Date).toISOString();this.serviceRequestNode.ele("siri:RequestTimestamp",C),this.serviceRequestNode.ele("siri:RequestorRef","OJP_JS_SDK_v"+bS);const M=this.serviceRequestNode.ele("OJPLocationInformationRequest");M.ele("siri:RequestTimestamp",C);let k=null;const z=null!==(t=this.locationName)&&void 0!==t?t:null;z&&(k=M.ele("InitialInput"),k.ele("LocationName",z));const q=null!==(e=this.stopPlaceRef)&&void 0!==e?e:null;if(q){const Yn=M.ele("PlaceRef");Yn.ele("StopPlaceRef",q),Yn.ele("LocationName").ele("Text","n/a")}const Q=null!==(i=this.bboxWest)&&void 0!==i?i:null,xe=null!==(r=this.bboxNorth)&&void 0!==r?r:null,De=null!==(s=this.bboxEast)&&void 0!==s?s:null,Ze=null!==(d=this.bboxSouth)&&void 0!==d?d:null;if(Q&&xe&&De&&Ze){null===k&&(k=M.ele("InitialInput"));const Yn=k.ele("GeoRestriction").ele("Rectangle"),ai=Yn.ele("UpperLeft");ai.ele("siri:Longitude",Q.toFixed(6)),ai.ele("siri:Latitude",xe.toFixed(6));const Tr=Yn.ele("LowerRight");Tr.ele("siri:Longitude",De.toFixed(6)),Tr.ele("siri:Latitude",Ze.toFixed(6))}const It=M.ele("Restrictions"),ut=this.computeRestrictionType();if(ut&&(It.ele("Type",ut),("poi_amenity"===this.geoRestrictionType||"poi_all"===this.geoRestrictionType)&&this.poiOsmTags)){const ai=It.ele("PointOfInterestFilter").ele("PointOfInterestCategory"),Tr="poi_amenity"===this.geoRestrictionType?"amenity":"POI";this.poiOsmTags.forEach(ma=>{const Hs=ai.ele("OsmTag");Hs.ele("Tag",Tr),Hs.ele("Value",ma)})}const Ht=null!==(m=this.numberOfResults)&&void 0!==m?m:10;It.ele("NumberOfResults",Ht),M.ele("siri:Extensions").ele("ParamsExtension").ele("PrivateModeFilter").ele("Exclude","false")}computeRestrictionType(){return"stop"===this.geoRestrictionType?"stop":"poi_all"===this.geoRestrictionType||"poi_amenity"===this.geoRestrictionType?"poi":this.geoRestrictionType}}class $l extends AD{constructor(t,e){super(t),this.requestParams=e,this.requestInfo.requestXML=this.buildRequestXML()}static initWithResponseMock(t){const e=new Vp,i=new $l(Av,e);return i.mockResponseXML=t,i}static initWithLocationName(t,e,i=null){const r=Vp.initWithLocationName(e,i);return new $l(t,r)}static initWithStopPlaceRef(t,e){const i=Vp.initWithStopPlaceRef(e);return new $l(t,i)}static initWithBBOXAndType(t,e,i,r,s,d,m=1e3,y=null){const C=Vp.initWithBBOXAndType(e,i,r,s,d,m,y);return new $l(t,C)}buildRequestXML(){return this.requestParams.buildRequestXML()}fetchResponse(){var t=this;return uS(function*(){return yield t.fetchOJPResponse(),new Promise(i=>{const r={locations:[],message:null};if(null!==t.requestInfo.error||null===t.requestInfo.responseXML)return r.message="ERROR",void i(r);const s=new fW;s.callback=({locations:d,message:m})=>{r.locations=d,r.message=m,"LocationInformation.DONE"===m&&(t.requestInfo.parseDateTime=new Date),i(r)},s.parseXML(t.requestInfo.responseXML)})})()}fetchLocations(){var t=this;return uS(function*(){const e=yield t.fetchResponse();return new Promise(r=>{"LocationInformation.DONE"===e.message&&r(e.locations)})})()}}class gS extends FD{constructor(t,e,i,r){super(),this.stopPlaceRef=t,this.geoPosition=e,this.depArrTime=r,this.numberOfResults=10,this.stopEventType=i,this.includePreviousCalls=!1,this.includeOnwardCalls=!1,this.includeRealtimeData=!0}static Empty(){return new gS(null,null,"departure",new Date)}buildRequestNode(){super.buildRequestNode();const t=(new Date).toISOString(),e=this.depArrTime.toISOString();this.serviceRequestNode.ele("siri:RequestTimestamp",t),this.serviceRequestNode.ele("siri:RequestorRef","OJP_JS_SDK_v"+bS);const i=this.serviceRequestNode.ele("OJPStopEventRequest");i.ele("siri:RequestTimestamp",t);const r=i.ele("Location");if(this.stopPlaceRef){const m=r.ele("PlaceRef");m.ele("StopPlaceRef",this.stopPlaceRef),m.ele("LocationName").ele("Text","")}r.ele("DepArrTime",e);const s=i.ele("Params");s.ele("NumberOfResults",this.numberOfResults),s.ele("StopEventType",this.stopEventType),s.ele("IncludePreviousCalls",this.includePreviousCalls),s.ele("IncludeOnwardCalls",this.includeOnwardCalls),s.ele("IncludeRealtimeData",this.includeRealtimeData),i.ele("siri:Extensions").ele("ParamsExtension").ele("PrivateModeFilter").ele("Exclude","false")}}class mW extends wD{constructor(){super(),this.callback=null,this.stopEvents=[],this.mapContextLocations={},this.mapContextSituations={}}reset(){this.stopEvents=[],this.mapContextLocations={},this.mapContextSituations={}}parseXML(t){this.reset(),super.parseXML(t)}onCloseTag(t){if("StopEventResult"===t){const e=MD.initWithTreeNode(this.currentNode);e&&(e.patchStopEventLocations(this.mapContextLocations),e.stopPoint.patchSituations(this.mapContextSituations),this.stopEvents.push(e))}if("StopEventResponseContext"===t){const e=this.currentNode.findChildNamed("Places");e&&(this.mapContextLocations={},e.findChildrenNamed("Location").forEach(s=>{var d,m;const y=ao.initWithTreeNode(s),C=null!==(m=null===(d=y.stopPlace)||void 0===d?void 0:d.stopPlaceRef)&&void 0!==m?m:null;null!==C&&(this.mapContextLocations[C]=y)}));const i=this.currentNode.findChildNamed("Situations");i&&(this.mapContextSituations={},i.findChildrenNamed("PtSituation").forEach(s=>{const d=mS.initWithSituationTreeNode(s);d&&(this.mapContextSituations[d.situationNumber]=d)}))}}onEnd(){this.callback&&this.callback({stopEvents:this.stopEvents,message:"StopEvent.DONE"})}}class _h extends AD{constructor(t,e){e.includePreviousCalls=!0,e.includeOnwardCalls=!0,super(t),this.requestParams=e,this.requestInfo.requestXML=this.buildRequestXML()}static Empty(){const t=gS.Empty();return new _h(Av,t)}static initWithMock(t){const e=_h.Empty();return e.mockResponseXML=t,e}static initWithRequestMock(t){const e=_h.Empty();return e.mockRequestXML=t,e}static initWithStopPlaceRef(t,e,i,r){const s=new gS(e,null,i,r);return new _h(t,s)}buildRequestXML(){return this.requestParams.buildRequestXML()}fetchResponse(){var t=this;return uS(function*(){return yield t.fetchOJPResponse(),new Promise(i=>{const r={stopEvents:[],message:null};if(null!==t.requestInfo.error||null===t.requestInfo.responseXML)return r.message="ERROR",void i(r);const s=new mW;s.callback=({stopEvents:d,message:m})=>{r.stopEvents=d,r.message=m,"StopEvent.DONE"===m&&(t.requestInfo.parseDateTime=new Date,i(r))},s.parseXML(t.requestInfo.responseXML)})})()}}const bS="0.9.31",gW="undefined"!=typeof process&&process.versions&&process.versions.node;var bW=qe(9898),Ms=qe.n(bW);let jp=(()=>{class n{constructor(){this.newMapBoundsRequested=new nn,this.newMapCenterAndZoomRequested=new nn,this.initialMapCenter=null,this.initialMapZoom=null}tryToCenterAndZoomToLocation(e,i=16){var r,s;if(null===e)return;const d=null!==(s=null===(r=e.geoPosition)||void 0===r?void 0:r.asLngLat())&&void 0!==s?s:null;if(null===d)return;const m=new(Ms().LngLat)(d[0],d[1]);this.newMapCenterAndZoomRequested.emit({lnglat:m,zoom:i})}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),Ic=(()=>{class n{constructor(e){this.mapService=e,this.embedQueryParams=new URLSearchParams,this.defaultsInited=new nn,this.locationsUpdated=new nn,this.geoLocationsUpdated=new nn,this.tripsUpdated=new nn,this.activeTripSelected=new nn,this.viaAtIndexRemoved=new nn,this.viaAtIndexUpdated=new nn,this.searchParamsReset=new nn,this.queryParams=new URLSearchParams(document.location.search),this.fromTripLocation=null,this.toTripLocation=null,this.viaTripLocations=[],this.journeyTripsPlaceholder=["-"],this.tripModeTypes=["monomodal"],this.tripTransportModes=["public_transport"],this.journeyTripRequests=[],this.departureDate=this.computeInitialDate(),this.currentAppStage="PROD",this.permalinkRelativeURL=null}initDefaults(){var e,i,r,s,d;let m=this.queryParams.get("stage");m&&(this.currentAppStage=this.computeAppStageFromString(m));const C=null!==(e=this.queryParams.get("from"))&&void 0!==e?e:"8507000",M=null!==(i=this.queryParams.get("to"))&&void 0!==i?i:"8503000",k=[],z=this.getStageConfig(),q=["From","To"];q.forEach(ut=>{let Mn="From"===ut?C:M;if("LA Beta"===this.currentAppStage){const ai=Mn.match(/^[^\|]+?\|(.+?)$/);ai?Mn=ai[1]:console.error("ERROR LA Beta - CANT match stopPlaceRef")}const Yn=ao.initFromLiteralCoords(Mn);if(Yn){const ai=new Promise(Tr=>{Tr([Yn])});k.push(ai)}else{let ai=$l.initWithStopPlaceRef(z,Mn);"string"==typeof Mn&&/^[A-Z]/.test(Mn)&&(ai=$l.initWithLocationName(z,Mn));const Tr=ai.fetchLocations();k.push(Tr)}});const Q=new Bp([]),xe=null!==(r=this.queryParams.get("via"))&&void 0!==r?r:null;(null===xe?[]:xe.split(";")).forEach(ut=>{const Ht=ao.initFromLiteralCoords(ut);if(Ht){const Mn=new Wa(Ht);this.viaTripLocations.push(Mn),Ht.geoPosition&&Q.extend(Ht.geoPosition)}}),this.journeyTripsPlaceholder=[],this.tripModeTypes=[];const Ze=null!==(s=this.queryParams.get("mode_types"))&&void 0!==s?s:null;Ze?Ze.split(";").forEach(ut=>{this.tripModeTypes.push(ut),this.journeyTripsPlaceholder.push("-")}):(this.journeyTripsPlaceholder=["-"],this.tripModeTypes=["monomodal"]),this.tripTransportModes=[];const It=null!==(d=this.queryParams.get("transport_modes"))&&void 0!==d?d:null;It?It.split(";").forEach(ut=>{this.tripTransportModes.push(ut)}):this.tripTransportModes=["public_transport"],Promise.all(k).then(ut=>{if(q.forEach(Ht=>{const Mn="From"===Ht,Yn=Mn?ut[0]:ut[1];if(0===Yn.length)return;const ai=Yn[0];Mn?this.fromTripLocation=new Wa(ai):this.toTripLocation=new Wa(ai),ai.geoPosition&&Q.extend(ai.geoPosition)}),this.locationsUpdated.emit(),this.geoLocationsUpdated.emit(),this.updatePermalinkAddress(),Q.isValid()&&(this.queryParams.has("from")||this.queryParams.has("to"))&&!this.mapService.initialMapCenter){const Yn={bounds:new(Ms().LngLatBounds)(Q.asFeatureBBOX())};this.mapService.newMapBoundsRequested.emit(Yn)}this.defaultsInited.emit()})}refetchEndpointsByName(){const e=[],i=new Promise((s,d)=>{s(null)}),r=["From","To"];r.forEach(s=>{const y="From"===s?this.fromTripLocation:this.toTripLocation;if(null===y)return void e.push(i);const C=y.location.geoPosition;if(null===C)return void e.push(i);const M=Bp.initFromGeoPosition(C,200,200),k=this.getStageConfig(),q=$l.initWithBBOXAndType(k,M.southWest.longitude,M.northEast.latitude,M.northEast.longitude,M.southWest.latitude,"stop",300).fetchLocations();e.push(q)}),Promise.all(e).then(s=>{r.forEach(d=>{const m="From"===d,y=m?s[0]:s[1];if(null===y)return;const C=m?this.fromTripLocation:this.toTripLocation;if(null===C)return void e.push(i);const M=C.location.findClosestLocation(y);null!==M&&(m?this.fromTripLocation=new Wa(M.location):this.toTripLocation=new Wa(M.location),this.updatePermalinkAddress(),this.locationsUpdated.emit(),this.geoLocationsUpdated.emit())})})}switchEndpoints(){const e=Object.assign({},this.fromTripLocation);this.fromTripLocation=Object.assign({},this.toTripLocation),this.toTripLocation=Object.assign({},e),this.updatePermalinkAddress(),this.locationsUpdated.emit(),this.geoLocationsUpdated.emit()}computeAppStageFromString(e){const i=Np.app_stages.map(m=>m.key),r=i.map(m=>m.toLowerCase()),s=e.trim(),d=r.indexOf(s.toLowerCase());return-1!==d?i[d]:"PROD"}updateTripEndpoint(e,i,r){if("From"===i&&(this.fromTripLocation=e?new Wa(e):null),"To"===i&&(this.toTripLocation=e?new Wa(e):null),e&&"Via"===i){const s=new Wa(e);this.viaTripLocations.push(s),this.journeyTripsPlaceholder.push("-"),this.tripModeTypes.push("monomodal"),this.tripTransportModes.push("public_transport")}this.locationsUpdated.emit(),this.geoLocationsUpdated.emit(),this.activeTripSelected.emit(null),this.searchParamsReset.emit(),this.updatePermalinkAddress()}updateViaPoint(e,i){this.viaTripLocations[i].location=e,this.viaAtIndexUpdated.emit({location:e,idx:i}),this.activeTripSelected.emit(null),this.searchParamsReset.emit(),this.updatePermalinkAddress()}updateTrips(e){this.tripsUpdated.emit(e),this.activeTripSelected.emit(e.length>0?e[0]:null)}removeViaAtIndex(e){this.viaTripLocations.splice(e,1),this.tripModeTypes.splice(e,1),this.journeyTripsPlaceholder.splice(e,1),this.tripTransportModes.splice(e,1),0===this.viaTripLocations.length&&(this.journeyTripsPlaceholder=["-"],this.tripModeTypes=["monomodal"],this.tripTransportModes=["public_transport"]),this.viaAtIndexRemoved.emit(e),this.activeTripSelected.emit(null),this.searchParamsReset.emit(),this.updatePermalinkAddress()}computeTripRequestXML(e){const i=this.getStageConfig(),r=cu.initWithTripLocationsAndDate(i,this.fromTripLocation,this.toTripLocation,e);return null===r||null===r.requestInfo.requestXML?"BROKEN TripsRequestParams":r.requestInfo.requestXML}updatePermalinkAddress(){const e=new URLSearchParams;["From","To"].forEach(C=>{var M,k,z,q;const Q="From"===C?this.fromTripLocation:this.toTripLocation,xe=C.toLowerCase(),De=null!==(k=null===(M=null==Q?void 0:Q.location.stopPlace)||void 0===M?void 0:M.stopPlaceRef)&&void 0!==k?k:null;if(De)e.append(xe,De);else{let Ze=null!==(q=null===(z=null==Q?void 0:Q.location.geoPosition)||void 0===z?void 0:z.asLatLngString(!0))&&void 0!==q?q:null;if(Ze){const ut=null==Q?void 0:Q.location.computeLocationName(!1);ut&&(Ze=Ze+"("+ut+")"),e.append(xe,Ze)}}});const r=[];this.viaTripLocations.forEach(C=>{var M,k;const z=C.location,q=null!==(k=null===(M=null==z?void 0:z.geoPosition)||void 0===M?void 0:M.asLatLngString(!0))&&void 0!==k?k:null;q&&r.push(q)}),r.length>0&&e.append("via",r.join(";")),e.append("mode_types",this.tripModeTypes.join(";")),e.append("transport_modes",this.tripTransportModes.join(";"));const s=gl.formatDate(this.departureDate);e.append("trip_datetime",s.substring(0,16));const d=this.currentAppStage.toLowerCase();e.append("stage",d),this.permalinkRelativeURL=document.location.pathname.replace("/embed","")+"?"+e.toString();const m=new URLSearchParams;["from","to"].forEach(C=>{const M=e.get(C);null!==M&&m.append(C,M)}),this.embedQueryParams=m}computeInitialDate(){var e;const i=new Date,r=null!==(e=this.queryParams.get("trip_datetime"))&&void 0!==e?e:null;return null===r?i:new Date(Date.parse(r))}getStageConfig(e=this.currentAppStage){var i;const r=null!==(i=Np.app_stages.find(s=>s.key===e))&&void 0!==i?i:null;return null===r?(console.error("ERROR - cant find stage"+e+" using PROD"),Av):r}updateAppStage(e){this.currentAppStage=e,this.updatePermalinkAddress()}updateDepartureDateTime(e){this.departureDate=e,this.updatePermalinkAddress()}updateTripMode(e,i,r){this.tripModeTypes[r]=e,this.tripTransportModes[r]=i,this.updatePermalinkAddress()}computeTripLocationsToUpdate(e){const i=[],r=[this.fromTripLocation];this.viaTripLocations.forEach(y=>{r.push(y)}),r.push(this.toTripLocation);const s=this.tripModeTypes[e],d=r[e];d&&("mode_at_start"===s||"mode_at_start_end"===s)&&i.push(d);const m=r[e+1];return m&&("mode_at_end"===s||"mode_at_start_end"===s)&&i.push(m),i}updateTripLocationRestrictions(e,i,r,s,d){this.computeTripLocationsToUpdate(d).forEach(y=>{y.minDuration=e,y.maxDuration=i,y.minDistance=r,y.maxDistance=s})}updateTripLocationCustomMode(e){const i=this.computeTripLocationsToUpdate(e),r=this.tripModeTypes[e];i.forEach(s=>{s.customTransportMode="monomodal"===r?null:this.tripTransportModes[e]})}updateParamsFromTrip(e){if(!(e.legs.length>0))return;const s=e.legs[e.legs.length-1];this.fromTripLocation=new Wa(e.legs[0].fromLocation),this.toTripLocation=new Wa(s.toLocation),this.viaTripLocations=[],this.journeyTripsPlaceholder=["-"],this.tripModeTypes=["monomodal"],this.tripTransportModes=["public_transport"],this.geoLocationsUpdated.emit(),this.updatePermalinkAddress()}}return n.\u0275fac=function(e){return new(e||n)(ze(jp))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class _W{constructor(t=!1,e,i=!0,r){this._multiple=t,this._emitChanges=i,this.compareWith=r,this._selection=new Set,this._deselectedToEmit=[],this._selectedToEmit=[],this.changed=new Zt,e&&e.length&&(t?e.forEach(s=>this._markSelected(s)):this._markSelected(e[0]),this._selectedToEmit.length=0)}get selected(){return this._selected||(this._selected=Array.from(this._selection.values())),this._selected}select(...t){this._verifyValueAssignment(t),t.forEach(i=>this._markSelected(i));const e=this._hasQueuedChanges();return this._emitChangeEvent(),e}deselect(...t){this._verifyValueAssignment(t),t.forEach(i=>this._unmarkSelected(i));const e=this._hasQueuedChanges();return this._emitChangeEvent(),e}setSelection(...t){this._verifyValueAssignment(t);const e=this.selected,i=new Set(t);t.forEach(s=>this._markSelected(s)),e.filter(s=>!i.has(s)).forEach(s=>this._unmarkSelected(s));const r=this._hasQueuedChanges();return this._emitChangeEvent(),r}toggle(t){return this.isSelected(t)?this.deselect(t):this.select(t)}clear(t=!0){this._unmarkAll();const e=this._hasQueuedChanges();return t&&this._emitChangeEvent(),e}isSelected(t){if(this.compareWith){for(const e of this._selection)if(this.compareWith(e,t))return!0;return!1}return this._selection.has(t)}isEmpty(){return 0===this._selection.size}hasValue(){return!this.isEmpty()}sort(t){this._multiple&&this.selected&&this._selected.sort(t)}isMultipleSelection(){return this._multiple}_emitChangeEvent(){this._selected=null,(this._selectedToEmit.length||this._deselectedToEmit.length)&&(this.changed.next({source:this,added:this._selectedToEmit,removed:this._deselectedToEmit}),this._deselectedToEmit=[],this._selectedToEmit=[])}_markSelected(t){this.isSelected(t)||(this._multiple||this._unmarkAll(),this.isSelected(t)||this._selection.add(t),this._emitChanges&&this._selectedToEmit.push(t))}_unmarkSelected(t){this.isSelected(t)&&(this._selection.delete(t),this._emitChanges&&this._deselectedToEmit.push(t))}_unmarkAll(){this.isEmpty()||this._selection.forEach(t=>this._unmarkSelected(t))}_verifyValueAssignment(t){}_hasQueuedChanges(){return!(!this._deselectedToEmit.length&&!this._selectedToEmit.length)}}let jD=(()=>{class n{constructor(){this._listeners=[]}notify(e,i){for(let r of this._listeners)r(e,i)}listen(e){return this._listeners.push(e),()=>{this._listeners=this._listeners.filter(i=>e!==i)}}ngOnDestroy(){this._listeners=[]}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),yW=0;const UD=new Et("CdkAccordion");let vW=(()=>{class n{constructor(){this._stateChanges=new Zt,this._openCloseAllActions=new Zt,this.id="cdk-accordion-"+yW++,this._multi=!1}get multi(){return this._multi}set multi(e){this._multi=jn(e)}openAll(){this._multi&&this._openCloseAllActions.next(!0)}closeAll(){this._openCloseAllActions.next(!1)}ngOnChanges(e){this._stateChanges.next(e)}ngOnDestroy(){this._stateChanges.complete(),this._openCloseAllActions.complete()}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=Lt({type:n,selectors:[["cdk-accordion"],["","cdkAccordion",""]],inputs:{multi:"multi"},exportAs:["cdkAccordion"],features:[Vn([{provide:UD,useExisting:n}]),cr]}),n})(),xW=0,wW=(()=>{class n{constructor(e,i,r){this.accordion=e,this._changeDetectorRef=i,this._expansionDispatcher=r,this._openCloseAllSubscription=te.EMPTY,this.closed=new nn,this.opened=new nn,this.destroyed=new nn,this.expandedChange=new nn,this.id="cdk-accordion-child-"+xW++,this._expanded=!1,this._disabled=!1,this._removeUniqueSelectionListener=()=>{},this._removeUniqueSelectionListener=r.listen((s,d)=>{this.accordion&&!this.accordion.multi&&this.accordion.id===d&&this.id!==s&&(this.expanded=!1)}),this.accordion&&(this._openCloseAllSubscription=this._subscribeToOpenCloseAllActions())}get expanded(){return this._expanded}set expanded(e){e=jn(e),this._expanded!==e&&(this._expanded=e,this.expandedChange.emit(e),e?(this.opened.emit(),this._expansionDispatcher.notify(this.id,this.accordion?this.accordion.id:this.id)):this.closed.emit(),this._changeDetectorRef.markForCheck())}get disabled(){return this._disabled}set disabled(e){this._disabled=jn(e)}ngOnDestroy(){this.opened.complete(),this.closed.complete(),this.destroyed.emit(),this.destroyed.complete(),this._removeUniqueSelectionListener(),this._openCloseAllSubscription.unsubscribe()}toggle(){this.disabled||(this.expanded=!this.expanded)}close(){this.disabled||(this.expanded=!1)}open(){this.disabled||(this.expanded=!0)}_subscribeToOpenCloseAllActions(){return this.accordion._openCloseAllActions.subscribe(e=>{this.disabled||(this.expanded=e)})}}return n.\u0275fac=function(e){return new(e||n)(G(UD,12),G(Sr),G(jD))},n.\u0275dir=Lt({type:n,selectors:[["cdk-accordion-item"],["","cdkAccordionItem",""]],inputs:{expanded:"expanded",disabled:"disabled"},outputs:{closed:"closed",opened:"opened",destroyed:"destroyed",expandedChange:"expandedChange"},exportAs:["cdkAccordionItem"],features:[Vn([{provide:UD,useValue:void 0}])]}),n})(),SW=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({}),n})();const CW=["body"];function TW(n,t){}const EW=[[["sbb-expansion-panel-header"]],"*"],DW=["sbb-expansion-panel-header","*"];function IW(n,t){1&n&&ln(0,"sbb-icon",5),2&n&&Je("@indicatorRotate",Yt(2)._getExpandedState())}function MW(n,t){1&n&&ln(0,"sbb-icon",9)}function AW(n,t){1&n&&ln(0,"sbb-icon",10)}function kW(n,t){1&n&&(Bl(0,6),$t(1,MW,1,0,"sbb-icon",7),$t(2,AW,1,0,"sbb-icon",8),zl()),2&n&&(Je("ngSwitch",Yt(2)._isExpanded()),Le(1),Je("ngSwitchCase",!1),Le(1),Je("ngSwitchCase",!0))}function RW(n,t){1&n&&(oe(0,"span",2),yb(1,"async"),$t(2,IW,1,1,"sbb-icon",3),$t(3,kW,3,3,"ng-container",4),de()),2&n&&(Je("ngSwitch",vb(1,3,Yt().panel.variant)),Le(2),Je("ngSwitchCase","lean"),Le(1),Je("ngSwitchCase","standard"))}const PW=["*"],HD=new Et("SBB_ACCORDION"),$O="225ms cubic-bezier(0.4,0.0,0.2,1)",GO={indicatorRotate:Es("indicatorRotate",[dr("collapsed, void",Ln({transform:"rotate(90deg)"})),dr("expanded",Ln({transform:"rotate(-90deg)"})),qi("expanded <=> collapsed, void => collapsed",Qi($O))]),bodyExpansion:Es("bodyExpansion",[dr("collapsed, void",Ln({height:"0px",visibility:"hidden"})),dr("expanded",Ln({height:"*",visibility:"visible"})),qi("expanded <=> collapsed, void => collapsed",Qi($O))])},qO=new Et("SBB_EXPANSION_PANEL");let LW=(()=>{class n{constructor(e,i){this._template=e,this._expansionPanel=i}}return n.\u0275fac=function(e){return new(e||n)(G(Qr),G(qO,8))},n.\u0275dir=Lt({type:n,selectors:[["ng-template","sbbExpansionPanelContent",""]]}),n})();const OW=Em(wW);let FW=0,Im=(()=>{class n extends OW{constructor(e,i,r,s,d){super(i,r,s),this._viewContainerRef=e,this._hideToggle=!1,this.afterExpand=new nn,this.afterCollapse=new nn,this._inputChanges=new Zt,this._headerId="sbb-expansion-panel-header-"+FW++,this._bodyAnimationDone=new Zt,this.accordion=i,this._document=d,this._bodyAnimationDone.pipe(Pp((m,y)=>m.fromState===y.fromState&&m.toState===y.toState)).subscribe(m=>{"void"!==m.fromState&&("expanded"===m.toState?this.afterExpand.emit():"collapsed"===m.toState&&this.afterCollapse.emit())})}get hideToggle(){return this._hideToggle||this.accordion&&this.accordion.hideToggle}set hideToggle(e){this._hideToggle=jn(e)}_getExpandedState(){return this.expanded?"expanded":"collapsed"}toggle(){this.expanded=!this.expanded}close(){this.expanded=!1}open(){this.expanded=!0}ngAfterContentInit(){this._lazyContent&&this._lazyContent._expansionPanel===this&&this.opened.pipe(Ds(null),Cr(()=>this.expanded&&!this._portal),Vr(1)).subscribe(()=>{this._portal=new Cm(this._lazyContent._template,this._viewContainerRef)})}ngOnChanges(e){this._inputChanges.next(e)}ngOnDestroy(){super.ngOnDestroy(),this._bodyAnimationDone.complete(),this._inputChanges.complete()}_containsFocus(){if(this._body){const e=this._document.activeElement,i=this._body.nativeElement;return e===i||i.contains(e)}return!1}}return n.\u0275fac=function(e){return new(e||n)(G(Fo),G(HD,12),G(Sr),G(jD),G($n))},n.\u0275cmp=vn({type:n,selectors:[["sbb-expansion-panel"]],contentQueries:function(e,i,r){if(1&e&&zr(r,LW,5),2&e){let s;Nn(s=Bn())&&(i._lazyContent=s.first)}},viewQuery:function(e,i){if(1&e&&ur(CW,5),2&e){let r;Nn(r=Bn())&&(i._body=r.first)}},hostAttrs:[1,"sbb-expansion-panel"],hostVars:2,hostBindings:function(e,i){2&e&&Ri("sbb-expanded",i.expanded)},inputs:{disabled:"disabled",expanded:"expanded",hideToggle:"hideToggle"},outputs:{afterExpand:"afterExpand",afterCollapse:"afterCollapse"},exportAs:["sbbExpansionPanel"],features:[Vn([{provide:HD,useValue:void 0},{provide:qO,useExisting:n}]),qt,cr],ngContentSelectors:DW,decls:6,vars:4,consts:[["role","region",1,"sbb-expansion-panel-content",3,"id"],["body",""],[1,"sbb-expansion-panel-body","sbb-expansion-panel-horizontal-padding"],[3,"cdkPortalOutlet"]],template:function(e,i){1&e&&(Mo(EW),Pr(0),oe(1,"div",0,1),Qt("@bodyExpansion.done",function(s){return i._bodyAnimationDone.next(s)}),oe(3,"div",2),Pr(4,1),$t(5,TW,0,0,"ng-template",3),de()()),2&e&&(Le(1),Je("@bodyExpansion",i._getExpandedState())("id",i.id),fn("aria-labelledby",i._headerId),Le(4),Je("cdkPortalOutlet",i._portal))},dependencies:[sd],styles:['.sbb-expansion-panel{box-sizing:content-box;display:block;margin:0;transition:border-color var(--sbb-transition-fast-start);border:var(--sbb-border-width-thin) solid var(--sbb-color-milk)}.sbb-expansion-panel+.sbb-expansion-panel{margin-top:calc(var(--sbb-border-width-thin)*2)}.sbb-expansion-panel.sbb-expanded{border-color:var(--sbb-color-cloud)}.sbb-expansion-panel.sbb-expanded.sbb-expansion-panel-full-width{border-left-color:rgba(0,0,0,0);border-right-color:rgba(0,0,0,0);border-left-width:0;border-right-width:0;padding-left:var(--sbb-border-width-thin);padding-right:var(--sbb-border-width-thin)}.sbb-expansion-panel-horizontal-padding{padding-left:calc(var(--sbb-expansion-panel-padding-horizontal) - var(--sbb-border-width-thin));padding-right:calc(var(--sbb-expansion-panel-padding-horizontal) - var(--sbb-border-width-thin))}.sbb-expansion-panel-header{cursor:pointer;display:flex;align-items:center;position:relative;background-color:var(--sbb-color-milk);outline:none;padding-top:var(--sbb-expansion-panel-header-padding-top);padding-bottom:var(--sbb-expansion-panel-header-padding-bottom)}:where(html.sbb-lean) .sbb-expansion-panel-header{padding-bottom:calc(0.8rem - var(--sbb-border-width-thin))}.sbb-expansion-panel-header.sbb-expanded::after{content:"";display:block;position:absolute;height:0;bottom:0;width:calc(100% - var(--sbb-expansion-panel-padding-horizontal)*2 + var(--sbb-border-width-thin)*2);left:calc(var(--sbb-expansion-panel-padding-horizontal) - var(--sbb-border-width-thin));border-bottom:var(--sbb-border-width-thin) solid var(--sbb-color-cloud)}.sbb-expansion-panel-header:is(.sbb-expanded,.sbb-expanded:is(:focus,:hover)){background:inherit}.sbb-expansion-panel-header.sbb-disabled{cursor:default;opacity:.75}.sbb-expansion-panel-header-indicator{flex:0 0 auto;line-height:0;height:var(--sbb-icon-size-default);width:var(--sbb-icon-size-default);margin-left:1.6rem;color:var(--sbb-color-black);margin-top:-0.5em;margin-bottom:-0.5em}:where(html:not(.sbb-lean)) .sbb-expansion-panel-header-indicator{border:var(--sbb-border-width-thin) solid var(--sbb-color-storm);border-radius:50%;padding:calc(0.2666666667rem * var(--sbb-scaling-factor) - var(--sbb-border-width-thin))}@media all and (min-width: 40.1875em)and (max-width: 64.0525em){:where(html:not(.sbb-lean)) .sbb-expansion-panel-header-indicator{margin-left:2.6666666667rem}}@media all and (min-width: 40.1875em){:where(html:not(.sbb-lean)) .sbb-expansion-panel-header-indicator{height:calc(2.1333333333rem * var(--sbb-scaling-factor));width:calc(2.1333333333rem * var(--sbb-scaling-factor))}}@media all and (min-width: 160.0625em){:where(html:not(.sbb-lean)) .sbb-expansion-panel-header-indicator{margin-left:2.4rem}}@media all and (min-width: 240.0625em){:where(html:not(.sbb-lean)) .sbb-expansion-panel-header-indicator{margin-left:2.9333333333rem}}.sbb-expansion-panel-header-content{display:flex;flex:1;overflow:hidden;font-family:var(--sbb-font-light);font-size:var(--sbb-font-size-large);line-height:var(--sbb-expansion-panel-line-height)}.sbb-expansion-panel-content{display:flex;flex-direction:column;overflow:visible}.sbb-expansion-panel-content[style*="visibility: hidden"] *{visibility:hidden !important}.sbb-expansion-panel-content.ng-animating,.sbb-expansion-panel:not(.sbb-expanded) .sbb-expansion-panel-content{overflow:hidden}.sbb-expansion-panel-body{font-size:var(--sbb-font-size);line-height:var(--sbb-line-height);padding-top:var(--sbb-divider-medium);padding-bottom:var(--sbb-divider-medium)}.sbb-expansion-panel-body>*:first-child{margin-top:0}'],encapsulation:2,data:{animation:[GO.bodyExpansion]},changeDetection:0}),n})();const BW=$b(class NW{});let _S=(()=>{class n extends BW{constructor(e,i,r,s,d,m){super(),this.panel=e,this._element=i,this._focusMonitor=r,this._changeDetectorRef=s,this._document=d,this._parentChangeSubscription=te.EMPTY;const y=e.accordion?e.accordion._stateChanges.pipe(Cr(C=>!!C.hideToggle)):ps;this.tabIndex=parseInt(m||"",10)||0,this._parentChangeSubscription=Er(e.opened,e.closed,y,e._inputChanges.pipe(Cr(C=>!(!C.hideToggle&&!C.disabled)))).subscribe(()=>this._changeDetectorRef.markForCheck()),e.closed.pipe(Cr(()=>e._containsFocus())).subscribe(()=>r.focusVia(i,"program"))}get disabled(){return this.panel.disabled}_toggle(){this.disabled||this.panel.toggle()}_isExpanded(){return this.panel.expanded}_getExpandedState(){return this.panel._getExpandedState()}_getPanelId(){return this.panel.id}_showToggle(){return!this.panel.hideToggle&&!this.panel.disabled}_keydown(e){switch(e.keyCode){case 32:case 13:!ra(e)&&this._isFocused()&&(e.preventDefault(),this._toggle());break;default:return void(this.panel.accordion&&this.panel.accordion._handleHeaderKeydown(e))}}focus(e,i){e?this._focusMonitor.focusVia(this._element,e,i):this._element.nativeElement.focus(i)}ngAfterViewInit(){this._focusMonitor.monitor(this._element).subscribe(e=>{e&&this.panel.accordion&&this.panel.accordion._handleHeaderFocus(this)})}ngOnDestroy(){this._parentChangeSubscription.unsubscribe(),this._focusMonitor.stopMonitoring(this._element)}_isFocused(){var e;return(null===(e=this._document)||void 0===e?void 0:e.activeElement)===this._element.nativeElement}}return n.\u0275fac=function(e){return new(e||n)(G(Im,1),G(Tn),G(fa),G(Sr),G($n),Uo("tabindex"))},n.\u0275cmp=vn({type:n,selectors:[["sbb-expansion-panel-header"]],hostAttrs:["role","button",1,"sbb-expansion-panel-header","sbb-expansion-panel-horizontal-padding"],hostVars:9,hostBindings:function(e,i){1&e&&Qt("click",function(){return i._toggle()})("keydown",function(s){return i._keydown(s)}),2&e&&(fn("id",i.panel._headerId)("tabindex",i.tabIndex)("aria-controls",i._getPanelId())("aria-expanded",i._isExpanded())("aria-disabled",i.disabled),Ri("sbb-expanded",i._isExpanded())("sbb-disabled",i.disabled))},inputs:{tabIndex:"tabIndex"},features:[qt],ngContentSelectors:PW,decls:3,vars:1,consts:[[1,"sbb-expansion-panel-header-content"],["class","sbb-expansion-panel-header-indicator sbb-icon-fit",3,"ngSwitch",4,"ngIf"],[1,"sbb-expansion-panel-header-indicator","sbb-icon-fit",3,"ngSwitch"],["svgIcon","kom:chevron-right-small",4,"ngSwitchCase"],[3,"ngSwitch",4,"ngSwitchCase"],["svgIcon","kom:chevron-right-small"],[3,"ngSwitch"],["svgIcon","kom:plus-small",4,"ngSwitchCase"],["svgIcon","kom:minus-small",4,"ngSwitchCase"],["svgIcon","kom:plus-small"],["svgIcon","kom:minus-small"]],template:function(e,i){1&e&&(Mo(),oe(0,"span",0),Pr(1),de(),$t(2,RW,4,5,"span",1)),2&e&&(Le(2),Je("ngIf",i._showToggle()))},dependencies:[Ts,Eb,Bx,qa,Hy],encapsulation:2,data:{animation:[GO.indicatorRotate]},changeDetection:0}),n})(),$D=(()=>{class n extends vW{constructor(){super(...arguments),this._ownHeaders=new nm,this._hideToggle=!1}get hideToggle(){return this._hideToggle}set hideToggle(e){this._hideToggle=jn(e)}ngAfterContentInit(){this._headers.changes.pipe(Ds(this._headers)).subscribe(e=>{this._ownHeaders.reset(e.filter(i=>i.panel.accordion===this)),this._ownHeaders.notifyOnChanges()}),this._keyManager=new sD(this._ownHeaders).withWrap().withHomeAndEnd()}_handleHeaderKeydown(e){this._keyManager.onKeydown(e)}_handleHeaderFocus(e){this._keyManager.updateActiveItem(e)}ngOnDestroy(){super.ngOnDestroy(),this._ownHeaders.destroy()}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Vi(n)))(i||n)}}(),n.\u0275dir=Lt({type:n,selectors:[["sbb-accordion"]],contentQueries:function(e,i,r){if(1&e&&zr(r,_S,5),2&e){let s;Nn(s=Bn())&&(i._headers=s)}},hostAttrs:[1,"sbb-accordion"],inputs:{hideToggle:"hideToggle"},exportAs:["sbbAccordion"],features:[Vn([{provide:HD,useExisting:n}]),qt]}),n})(),WO=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({imports:[gr,SW,oa,Wi,mo]}),n})();const XO=X$();class zW{constructor(t,e){this._viewportRuler=t,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=e}attach(){}enable(){if(this._canBeEnabled()){const t=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=t.style.left||"",this._previousHTMLStyles.top=t.style.top||"",t.style.left=us(-this._previousScrollPosition.left),t.style.top=us(-this._previousScrollPosition.top),t.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){const t=this._document.documentElement,i=t.style,r=this._document.body.style,s=i.scrollBehavior||"",d=r.scrollBehavior||"";this._isEnabled=!1,i.left=this._previousHTMLStyles.left,i.top=this._previousHTMLStyles.top,t.classList.remove("cdk-global-scrollblock"),XO&&(i.scrollBehavior=r.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),XO&&(i.scrollBehavior=s,r.scrollBehavior=d)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;const e=this._document.body,i=this._viewportRuler.getViewportSize();return e.scrollHeight>i.height||e.scrollWidth>i.width}}class VW{constructor(t,e,i,r){this._scrollDispatcher=t,this._ngZone=e,this._viewportRuler=i,this._config=r,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(t){this._overlayRef=t}enable(){if(this._scrollSubscription)return;const t=this._scrollDispatcher.scrolled(0);this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=t.subscribe(()=>{const e=this._viewportRuler.getViewportScrollPosition().top;Math.abs(e-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=t.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}class ZO{enable(){}disable(){}attach(){}}function GD(n,t){return t.some(e=>n.bottom<e.top||n.top>e.bottom||n.right<e.left||n.left>e.right)}function YO(n,t){return t.some(e=>n.top<e.top||n.bottom>e.bottom||n.left<e.left||n.right>e.right)}class jW{constructor(t,e,i,r){this._scrollDispatcher=t,this._viewportRuler=e,this._ngZone=i,this._config=r,this._scrollSubscription=null}attach(t){this._overlayRef=t}enable(){this._scrollSubscription||(this._scrollSubscription=this._scrollDispatcher.scrolled(this._config?this._config.scrollThrottle:0).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){const e=this._overlayRef.overlayElement.getBoundingClientRect(),{width:i,height:r}=this._viewportRuler.getViewportSize();GD(e,[{width:i,height:r,bottom:r,right:i,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}}))}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}let UW=(()=>{class n{constructor(e,i,r,s){this._scrollDispatcher=e,this._viewportRuler=i,this._ngZone=r,this.noop=()=>new ZO,this.close=d=>new VW(this._scrollDispatcher,this._ngZone,this._viewportRuler,d),this.block=()=>new zW(this._viewportRuler,this._document),this.reposition=d=>new jW(this._scrollDispatcher,this._viewportRuler,this._ngZone,d),this._document=s}}return n.\u0275fac=function(e){return new(e||n)(ze(_O),ze(lu),ze(qn),ze($n))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class Mm{constructor(t){if(this.scrollStrategy=new ZO,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,t){const e=Object.keys(t);for(const i of e)void 0!==t[i]&&(this[i]=t[i])}}}class HW{constructor(t,e){this.connectionPair=t,this.scrollableViewProperties=e}}class Up{constructor(t,e,i,r,s,d,m,y,C,M=!1){this._portalOutlet=t,this._host=e,this._pane=i,this._config=r,this._ngZone=s,this._keyboardDispatcher=d,this._document=m,this._location=y,this._outsideClickDispatcher=C,this._animationsDisabled=M,this._backdropElement=null,this._backdropClick=new Zt,this._attachments=new Zt,this._detachments=new Zt,this._locationChanges=te.EMPTY,this._backdropClickHandler=k=>this._backdropClick.next(k),this._backdropTransitionendHandler=k=>{this._disposeBackdrop(k.target)},this._keydownEvents=new Zt,this._outsidePointerEvents=new Zt,r.scrollStrategy&&(this._scrollStrategy=r.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=r.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(t){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);const e=this._portalOutlet.attach(t);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe(Vr(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),"function"==typeof(null==e?void 0:e.onDestroy)&&e.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),e}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();const t=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),t}dispose(){var t;const e=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),null===(t=this._host)||void 0===t||t.remove(),this._previousHostParent=this._pane=this._host=null,e&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(t){t!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=t,this.hasAttached()&&(t.attach(this),this.updatePosition()))}updateSize(t){this._config=Object.assign(Object.assign({},this._config),t),this._updateElementSize()}setDirection(t){this._config=Object.assign(Object.assign({},this._config),{direction:t}),this._updateElementDirection()}addPanelClass(t){this._pane&&this._toggleClasses(this._pane,t,!0)}removePanelClass(t){this._pane&&this._toggleClasses(this._pane,t,!1)}getDirection(){const t=this._config.direction;return t?"string"==typeof t?t:t.value:"ltr"}updateScrollStrategy(t){t!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=t,this.hasAttached()&&(t.attach(this),t.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;const t=this._pane.style;t.width=us(this._config.width),t.height=us(this._config.height),t.minWidth=us(this._config.minWidth),t.minHeight=us(this._config.minHeight),t.maxWidth=us(this._config.maxWidth),t.maxHeight=us(this._config.maxHeight)}_togglePointerEvents(t){this._pane.style.pointerEvents=t?"":"none"}_attachBackdrop(){const t="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._animationsDisabled&&this._backdropElement.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),this._animationsDisabled||"undefined"==typeof requestAnimationFrame?this._backdropElement.classList.add(t):this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(t)})})}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){const t=this._backdropElement;if(t){if(this._animationsDisabled)return void this._disposeBackdrop(t);t.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{t.addEventListener("transitionend",this._backdropTransitionendHandler)}),t.style.pointerEvents="none",this._backdropTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(()=>{this._disposeBackdrop(t)},500))}}_toggleClasses(t,e,i){const r=Xw(e||[]).filter(s=>!!s);r.length&&(i?t.classList.add(...r):t.classList.remove(...r))}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{const t=this._ngZone.onStable.pipe(Pi(Er(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||0===this._pane.children.length)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),t.unsubscribe())})})}_disposeScrollStrategy(){const t=this._scrollStrategy;t&&(t.disable(),t.detach&&t.detach())}_disposeBackdrop(t){t&&(t.removeEventListener("click",this._backdropClickHandler),t.removeEventListener("transitionend",this._backdropTransitionendHandler),t.remove(),this._backdropElement===t&&(this._backdropElement=null)),this._backdropTimeout&&(clearTimeout(this._backdropTimeout),this._backdropTimeout=void 0)}}let qb=(()=>{class n{constructor(e,i){this._platform=i,this._document=e}ngOnDestroy(){var e;null===(e=this._containerElement)||void 0===e||e.remove()}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){const e="cdk-overlay-container";if(this._platform.isBrowser||ZE()){const r=this._document.querySelectorAll(`.${e}[platform="server"], .${e}[platform="test"]`);for(let s=0;s<r.length;s++)r[s].remove()}const i=this._document.createElement("div");i.classList.add(e),ZE()?i.setAttribute("platform","test"):this._platform.isBrowser||i.setAttribute("platform","server"),this._document.body.appendChild(i),this._containerElement=i}}return n.\u0275fac=function(e){return new(e||n)(ze($n),ze(cs))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const KO="cdk-overlay-connected-position-bounding-box",$W=/([A-Za-z%]+)$/;class GW{constructor(t,e,i,r,s){this._viewportRuler=e,this._document=i,this._platform=r,this._overlayContainer=s,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new Zt,this._resizeSubscription=te.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(t)}get positions(){return this._preferredPositions}attach(t){this._validatePositions(),t.hostElement.classList.add(KO),this._overlayRef=t,this._boundingBox=t.hostElement,this._pane=t.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition)return void this.reapplyLastPosition();this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const t=this._originRect,e=this._overlayRect,i=this._viewportRect,r=this._containerRect,s=[];let d;for(let m of this._preferredPositions){let y=this._getOriginPoint(t,r,m),C=this._getOverlayPoint(y,e,m),M=this._getOverlayFit(C,e,i,m);if(M.isCompletelyWithinViewport)return this._isPushed=!1,void this._applyPosition(m,y);this._canFitWithFlexibleDimensions(M,C,i)?s.push({position:m,origin:y,overlayRect:e,boundingBoxRect:this._calculateBoundingBoxRect(y,m)}):(!d||d.overlayFit.visibleArea<M.visibleArea)&&(d={overlayFit:M,overlayPoint:C,originPoint:y,position:m,overlayRect:e})}if(s.length){let m=null,y=-1;for(const C of s){const M=C.boundingBoxRect.width*C.boundingBoxRect.height*(C.position.weight||1);M>y&&(y=M,m=C)}return this._isPushed=!1,void this._applyPosition(m.position,m.origin)}if(this._canPush)return this._isPushed=!0,void this._applyPosition(d.position,d.originPoint);this._applyPosition(d.position,d.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&Am(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(KO),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;const t=this._lastPosition;if(t){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const e=this._getOriginPoint(this._originRect,this._containerRect,t);this._applyPosition(t,e)}else this.apply()}withScrollableContainers(t){return this._scrollables=t,this}withPositions(t){return this._preferredPositions=t,-1===t.indexOf(this._lastPosition)&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(t){return this._viewportMargin=t,this}withFlexibleDimensions(t=!0){return this._hasFlexibleDimensions=t,this}withGrowAfterOpen(t=!0){return this._growAfterOpen=t,this}withPush(t=!0){return this._canPush=t,this}withLockedPosition(t=!0){return this._positionLocked=t,this}setOrigin(t){return this._origin=t,this}withDefaultOffsetX(t){return this._offsetX=t,this}withDefaultOffsetY(t){return this._offsetY=t,this}withTransformOriginOn(t){return this._transformOriginSelector=t,this}_getOriginPoint(t,e,i){let r,s;if("center"==i.originX)r=t.left+t.width/2;else{const d=this._isRtl()?t.right:t.left,m=this._isRtl()?t.left:t.right;r="start"==i.originX?d:m}return e.left<0&&(r-=e.left),s="center"==i.originY?t.top+t.height/2:"top"==i.originY?t.top:t.bottom,e.top<0&&(s-=e.top),{x:r,y:s}}_getOverlayPoint(t,e,i){let r,s;return r="center"==i.overlayX?-e.width/2:"start"===i.overlayX?this._isRtl()?-e.width:0:this._isRtl()?0:-e.width,s="center"==i.overlayY?-e.height/2:"top"==i.overlayY?0:-e.height,{x:t.x+r,y:t.y+s}}_getOverlayFit(t,e,i,r){const s=JO(e);let{x:d,y:m}=t,y=this._getOffset(r,"x"),C=this._getOffset(r,"y");y&&(d+=y),C&&(m+=C);let z=0-m,q=m+s.height-i.height,Q=this._subtractOverflows(s.width,0-d,d+s.width-i.width),xe=this._subtractOverflows(s.height,z,q),De=Q*xe;return{visibleArea:De,isCompletelyWithinViewport:s.width*s.height===De,fitsInViewportVertically:xe===s.height,fitsInViewportHorizontally:Q==s.width}}_canFitWithFlexibleDimensions(t,e,i){if(this._hasFlexibleDimensions){const r=i.bottom-e.y,s=i.right-e.x,d=QO(this._overlayRef.getConfig().minHeight),m=QO(this._overlayRef.getConfig().minWidth),C=t.fitsInViewportHorizontally||null!=m&&m<=s;return(t.fitsInViewportVertically||null!=d&&d<=r)&&C}return!1}_pushOverlayOnScreen(t,e,i){if(this._previousPushAmount&&this._positionLocked)return{x:t.x+this._previousPushAmount.x,y:t.y+this._previousPushAmount.y};const r=JO(e),s=this._viewportRect,d=Math.max(t.x+r.width-s.width,0),m=Math.max(t.y+r.height-s.height,0),y=Math.max(s.top-i.top-t.y,0),C=Math.max(s.left-i.left-t.x,0);let M=0,k=0;return M=r.width<=s.width?C||-d:t.x<this._viewportMargin?s.left-i.left-t.x:0,k=r.height<=s.height?y||-m:t.y<this._viewportMargin?s.top-i.top-t.y:0,this._previousPushAmount={x:M,y:k},{x:t.x+M,y:t.y+k}}_applyPosition(t,e){if(this._setTransformOrigin(t),this._setOverlayElementStyles(e,t),this._setBoundingBoxStyles(e,t),t.panelClass&&this._addPanelClasses(t.panelClass),this._lastPosition=t,this._positionChanges.observers.length){const i=this._getScrollVisibility(),r=new HW(t,i);this._positionChanges.next(r)}this._isInitialRender=!1}_setTransformOrigin(t){if(!this._transformOriginSelector)return;const e=this._boundingBox.querySelectorAll(this._transformOriginSelector);let i,r=t.overlayY;i="center"===t.overlayX?"center":this._isRtl()?"start"===t.overlayX?"right":"left":"start"===t.overlayX?"left":"right";for(let s=0;s<e.length;s++)e[s].style.transformOrigin=`${i} ${r}`}_calculateBoundingBoxRect(t,e){const i=this._viewportRect,r=this._isRtl();let s,d,m,M,k,z;if("top"===e.overlayY)d=t.y,s=i.height-d+this._viewportMargin;else if("bottom"===e.overlayY)m=i.height-t.y+2*this._viewportMargin,s=i.height-m+this._viewportMargin;else{const q=Math.min(i.bottom-t.y+i.top,t.y),Q=this._lastBoundingBoxSize.height;s=2*q,d=t.y-q,s>Q&&!this._isInitialRender&&!this._growAfterOpen&&(d=t.y-Q/2)}if("end"===e.overlayX&&!r||"start"===e.overlayX&&r)z=i.width-t.x+this._viewportMargin,M=t.x-this._viewportMargin;else if("start"===e.overlayX&&!r||"end"===e.overlayX&&r)k=t.x,M=i.right-t.x;else{const q=Math.min(i.right-t.x+i.left,t.x),Q=this._lastBoundingBoxSize.width;M=2*q,k=t.x-q,M>Q&&!this._isInitialRender&&!this._growAfterOpen&&(k=t.x-Q/2)}return{top:d,left:k,bottom:m,right:z,width:M,height:s}}_setBoundingBoxStyles(t,e){const i=this._calculateBoundingBoxRect(t,e);!this._isInitialRender&&!this._growAfterOpen&&(i.height=Math.min(i.height,this._lastBoundingBoxSize.height),i.width=Math.min(i.width,this._lastBoundingBoxSize.width));const r={};if(this._hasExactPosition())r.top=r.left="0",r.bottom=r.right=r.maxHeight=r.maxWidth="",r.width=r.height="100%";else{const s=this._overlayRef.getConfig().maxHeight,d=this._overlayRef.getConfig().maxWidth;r.height=us(i.height),r.top=us(i.top),r.bottom=us(i.bottom),r.width=us(i.width),r.left=us(i.left),r.right=us(i.right),r.alignItems="center"===e.overlayX?"center":"end"===e.overlayX?"flex-end":"flex-start",r.justifyContent="center"===e.overlayY?"center":"bottom"===e.overlayY?"flex-end":"flex-start",s&&(r.maxHeight=us(s)),d&&(r.maxWidth=us(d))}this._lastBoundingBoxSize=i,Am(this._boundingBox.style,r)}_resetBoundingBoxStyles(){Am(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){Am(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(t,e){const i={},r=this._hasExactPosition(),s=this._hasFlexibleDimensions,d=this._overlayRef.getConfig();if(r){const M=this._viewportRuler.getViewportScrollPosition();Am(i,this._getExactOverlayY(e,t,M)),Am(i,this._getExactOverlayX(e,t,M))}else i.position="static";let m="",y=this._getOffset(e,"x"),C=this._getOffset(e,"y");y&&(m+=`translateX(${y}px) `),C&&(m+=`translateY(${C}px)`),i.transform=m.trim(),d.maxHeight&&(r?i.maxHeight=us(d.maxHeight):s&&(i.maxHeight="")),d.maxWidth&&(r?i.maxWidth=us(d.maxWidth):s&&(i.maxWidth="")),Am(this._pane.style,i)}_getExactOverlayY(t,e,i){let r={top:"",bottom:""},s=this._getOverlayPoint(e,this._overlayRect,t);return this._isPushed&&(s=this._pushOverlayOnScreen(s,this._overlayRect,i)),"bottom"===t.overlayY?r.bottom=this._document.documentElement.clientHeight-(s.y+this._overlayRect.height)+"px":r.top=us(s.y),r}_getExactOverlayX(t,e,i){let d,r={left:"",right:""},s=this._getOverlayPoint(e,this._overlayRect,t);return this._isPushed&&(s=this._pushOverlayOnScreen(s,this._overlayRect,i)),d=this._isRtl()?"end"===t.overlayX?"left":"right":"end"===t.overlayX?"right":"left","right"===d?r.right=this._document.documentElement.clientWidth-(s.x+this._overlayRect.width)+"px":r.left=us(s.x),r}_getScrollVisibility(){const t=this._getOriginRect(),e=this._pane.getBoundingClientRect(),i=this._scrollables.map(r=>r.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:YO(t,i),isOriginOutsideView:GD(t,i),isOverlayClipped:YO(e,i),isOverlayOutsideView:GD(e,i)}}_subtractOverflows(t,...e){return e.reduce((i,r)=>i-Math.max(r,0),t)}_getNarrowedViewportRect(){const t=this._document.documentElement.clientWidth,e=this._document.documentElement.clientHeight,i=this._viewportRuler.getViewportScrollPosition();return{top:i.top+this._viewportMargin,left:i.left+this._viewportMargin,right:i.left+t-this._viewportMargin,bottom:i.top+e-this._viewportMargin,width:t-2*this._viewportMargin,height:e-2*this._viewportMargin}}_isRtl(){return"rtl"===this._overlayRef.getDirection()}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(t,e){return"x"===e?null==t.offsetX?this._offsetX:t.offsetX:null==t.offsetY?this._offsetY:t.offsetY}_validatePositions(){}_addPanelClasses(t){this._pane&&Xw(t).forEach(e=>{""!==e&&-1===this._appliedPanelClasses.indexOf(e)&&(this._appliedPanelClasses.push(e),this._pane.classList.add(e))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(t=>{this._pane.classList.remove(t)}),this._appliedPanelClasses=[])}_getOriginRect(){const t=this._origin;if(t instanceof Tn)return t.nativeElement.getBoundingClientRect();if(t instanceof Element)return t.getBoundingClientRect();const e=t.width||0,i=t.height||0;return{top:t.y,bottom:t.y+i,left:t.x,right:t.x+e,height:i,width:e}}}function Am(n,t){for(let e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}function QO(n){if("number"!=typeof n&&null!=n){const[t,e]=n.split($W);return e&&"px"!==e?null:parseFloat(t)}return n||null}function JO(n){return{top:Math.floor(n.top),right:Math.floor(n.right),bottom:Math.floor(n.bottom),left:Math.floor(n.left),width:Math.floor(n.width),height:Math.floor(n.height)}}const eF="cdk-global-overlay-wrapper";class qW{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._alignItems="",this._xPosition="",this._xOffset="",this._width="",this._height="",this._isDisposed=!1}attach(t){const e=t.getConfig();this._overlayRef=t,this._width&&!e.width&&t.updateSize({width:this._width}),this._height&&!e.height&&t.updateSize({height:this._height}),t.hostElement.classList.add(eF),this._isDisposed=!1}top(t=""){return this._bottomOffset="",this._topOffset=t,this._alignItems="flex-start",this}left(t=""){return this._xOffset=t,this._xPosition="left",this}bottom(t=""){return this._topOffset="",this._bottomOffset=t,this._alignItems="flex-end",this}right(t=""){return this._xOffset=t,this._xPosition="right",this}start(t=""){return this._xOffset=t,this._xPosition="start",this}end(t=""){return this._xOffset=t,this._xPosition="end",this}width(t=""){return this._overlayRef?this._overlayRef.updateSize({width:t}):this._width=t,this}height(t=""){return this._overlayRef?this._overlayRef.updateSize({height:t}):this._height=t,this}centerHorizontally(t=""){return this.left(t),this._xPosition="center",this}centerVertically(t=""){return this.top(t),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;const t=this._overlayRef.overlayElement.style,e=this._overlayRef.hostElement.style,i=this._overlayRef.getConfig(),{width:r,height:s,maxWidth:d,maxHeight:m}=i,y=!("100%"!==r&&"100vw"!==r||d&&"100%"!==d&&"100vw"!==d),C=!("100%"!==s&&"100vh"!==s||m&&"100%"!==m&&"100vh"!==m),M=this._xPosition,k=this._xOffset,z="rtl"===this._overlayRef.getConfig().direction;let q="",Q="",xe="";y?xe="flex-start":"center"===M?(xe="center",z?Q=k:q=k):z?"left"===M||"end"===M?(xe="flex-end",q=k):("right"===M||"start"===M)&&(xe="flex-start",Q=k):"left"===M||"start"===M?(xe="flex-start",q=k):("right"===M||"end"===M)&&(xe="flex-end",Q=k),t.position=this._cssPosition,t.marginLeft=y?"0":q,t.marginTop=C?"0":this._topOffset,t.marginBottom=this._bottomOffset,t.marginRight=y?"0":Q,e.justifyContent=xe,e.alignItems=C?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;const t=this._overlayRef.overlayElement.style,e=this._overlayRef.hostElement,i=e.style;e.classList.remove(eF),i.justifyContent=i.alignItems=t.marginTop=t.marginBottom=t.marginLeft=t.marginRight=t.position="",this._overlayRef=null,this._isDisposed=!0}}let WW=(()=>{class n{constructor(e,i,r,s){this._viewportRuler=e,this._document=i,this._platform=r,this._overlayContainer=s}global(){return new qW}flexibleConnectedTo(e){return new GW(e,this._viewportRuler,this._document,this._platform,this._overlayContainer)}}return n.\u0275fac=function(e){return new(e||n)(ze(lu),ze($n),ze(cs),ze(qb))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),tF=(()=>{class n{constructor(e){this._attachedOverlays=[],this._document=e}ngOnDestroy(){this.detach()}add(e){this.remove(e),this._attachedOverlays.push(e)}remove(e){const i=this._attachedOverlays.indexOf(e);i>-1&&this._attachedOverlays.splice(i,1),0===this._attachedOverlays.length&&this.detach()}}return n.\u0275fac=function(e){return new(e||n)(ze($n))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),XW=(()=>{class n extends tF{constructor(e,i){super(e),this._ngZone=i,this._keydownListener=r=>{const s=this._attachedOverlays;for(let d=s.length-1;d>-1;d--)if(s[d]._keydownEvents.observers.length>0){const m=s[d]._keydownEvents;this._ngZone?this._ngZone.run(()=>m.next(r)):m.next(r);break}}}add(e){super.add(e),this._isAttached||(this._ngZone?this._ngZone.runOutsideAngular(()=>this._document.body.addEventListener("keydown",this._keydownListener)):this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}}return n.\u0275fac=function(e){return new(e||n)(ze($n),ze(qn,8))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),ZW=(()=>{class n extends tF{constructor(e,i,r){super(e),this._platform=i,this._ngZone=r,this._cursorStyleIsSet=!1,this._pointerDownListener=s=>{this._pointerDownEventTarget=Rp(s)},this._clickListener=s=>{const d=Rp(s),m="click"===s.type&&this._pointerDownEventTarget?this._pointerDownEventTarget:d;this._pointerDownEventTarget=null;const y=this._attachedOverlays.slice();for(let C=y.length-1;C>-1;C--){const M=y[C];if(M._outsidePointerEvents.observers.length<1||!M.hasAttached())continue;if(M.overlayElement.contains(d)||M.overlayElement.contains(m))break;const k=M._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>k.next(s)):k.next(s)}}}add(e){if(super.add(e),!this._isAttached){const i=this._document.body;this._ngZone?this._ngZone.runOutsideAngular(()=>this._addEventListeners(i)):this._addEventListeners(i),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=i.style.cursor,i.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){const e=this._document.body;e.removeEventListener("pointerdown",this._pointerDownListener,!0),e.removeEventListener("click",this._clickListener,!0),e.removeEventListener("auxclick",this._clickListener,!0),e.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(e.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}_addEventListeners(e){e.addEventListener("pointerdown",this._pointerDownListener,!0),e.addEventListener("click",this._clickListener,!0),e.addEventListener("auxclick",this._clickListener,!0),e.addEventListener("contextmenu",this._clickListener,!0)}}return n.\u0275fac=function(e){return new(e||n)(ze($n),ze(cs),ze(qn,8))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),YW=0,Bo=(()=>{class n{constructor(e,i,r,s,d,m,y,C,M,k,z,q){this.scrollStrategies=e,this._overlayContainer=i,this._componentFactoryResolver=r,this._positionBuilder=s,this._keyboardDispatcher=d,this._injector=m,this._ngZone=y,this._document=C,this._directionality=M,this._location=k,this._outsideClickDispatcher=z,this._animationsModuleType=q}create(e){const i=this._createHostElement(),r=this._createPaneElement(i),s=this._createPortalOutlet(r),d=new Mm(e);return d.direction=d.direction||this._directionality.value,new Up(s,i,r,d,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher,"NoopAnimations"===this._animationsModuleType)}position(){return this._positionBuilder}_createPaneElement(e){const i=this._document.createElement("div");return i.id="cdk-overlay-"+YW++,i.classList.add("cdk-overlay-pane"),e.appendChild(i),i}_createHostElement(){const e=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(e),e}_createPortalOutlet(e){return this._appRef||(this._appRef=this._injector.get(Cb)),new HG(e,this._componentFactoryResolver,this._appRef,this._injector,this._document)}}return n.\u0275fac=function(e){return new(e||n)(ze(UW),ze(qb),ze(Gd),ze(WW),ze(XW),ze(Nr),ze(qn),ze($n),ze(Lp),ze(Ix),ze(ZW),ze(Qu,8))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})();const KW=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom"},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"}],nF=new Et("cdk-connected-overlay-scroll-strategy");let iF=(()=>{class n{constructor(e){this.elementRef=e}}return n.\u0275fac=function(e){return new(e||n)(G(Tn))},n.\u0275dir=Lt({type:n,selectors:[["","cdk-overlay-origin",""],["","overlay-origin",""],["","cdkOverlayOrigin",""]],exportAs:["cdkOverlayOrigin"]}),n})(),rF=(()=>{class n{constructor(e,i,r,s,d){this._overlay=e,this._dir=d,this._hasBackdrop=!1,this._lockPosition=!1,this._growAfterOpen=!1,this._flexibleDimensions=!1,this._push=!1,this._backdropSubscription=te.EMPTY,this._attachSubscription=te.EMPTY,this._detachSubscription=te.EMPTY,this._positionSubscription=te.EMPTY,this.viewportMargin=0,this.open=!1,this.disableClose=!1,this.backdropClick=new nn,this.positionChange=new nn,this.attach=new nn,this.detach=new nn,this.overlayKeydown=new nn,this.overlayOutsideClick=new nn,this._templatePortal=new Cm(i,r),this._scrollStrategyFactory=s,this.scrollStrategy=this._scrollStrategyFactory()}get offsetX(){return this._offsetX}set offsetX(e){this._offsetX=e,this._position&&this._updatePositionStrategy(this._position)}get offsetY(){return this._offsetY}set offsetY(e){this._offsetY=e,this._position&&this._updatePositionStrategy(this._position)}get hasBackdrop(){return this._hasBackdrop}set hasBackdrop(e){this._hasBackdrop=jn(e)}get lockPosition(){return this._lockPosition}set lockPosition(e){this._lockPosition=jn(e)}get flexibleDimensions(){return this._flexibleDimensions}set flexibleDimensions(e){this._flexibleDimensions=jn(e)}get growAfterOpen(){return this._growAfterOpen}set growAfterOpen(e){this._growAfterOpen=jn(e)}get push(){return this._push}set push(e){this._push=jn(e)}get overlayRef(){return this._overlayRef}get dir(){return this._dir?this._dir.value:"ltr"}ngOnDestroy(){this._attachSubscription.unsubscribe(),this._detachSubscription.unsubscribe(),this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe(),this._overlayRef&&this._overlayRef.dispose()}ngOnChanges(e){this._position&&(this._updatePositionStrategy(this._position),this._overlayRef.updateSize({width:this.width,minWidth:this.minWidth,height:this.height,minHeight:this.minHeight}),e.origin&&this.open&&this._position.apply()),e.open&&(this.open?this._attachOverlay():this._detachOverlay())}_createOverlay(){(!this.positions||!this.positions.length)&&(this.positions=KW);const e=this._overlayRef=this._overlay.create(this._buildConfig());this._attachSubscription=e.attachments().subscribe(()=>this.attach.emit()),this._detachSubscription=e.detachments().subscribe(()=>this.detach.emit()),e.keydownEvents().subscribe(i=>{this.overlayKeydown.next(i),27===i.keyCode&&!this.disableClose&&!ra(i)&&(i.preventDefault(),this._detachOverlay())}),this._overlayRef.outsidePointerEvents().subscribe(i=>{this.overlayOutsideClick.next(i)})}_buildConfig(){const e=this._position=this.positionStrategy||this._createPositionStrategy(),i=new Mm({direction:this._dir,positionStrategy:e,scrollStrategy:this.scrollStrategy,hasBackdrop:this.hasBackdrop});return(this.width||0===this.width)&&(i.width=this.width),(this.height||0===this.height)&&(i.height=this.height),(this.minWidth||0===this.minWidth)&&(i.minWidth=this.minWidth),(this.minHeight||0===this.minHeight)&&(i.minHeight=this.minHeight),this.backdropClass&&(i.backdropClass=this.backdropClass),this.panelClass&&(i.panelClass=this.panelClass),i}_updatePositionStrategy(e){const i=this.positions.map(r=>({originX:r.originX,originY:r.originY,overlayX:r.overlayX,overlayY:r.overlayY,offsetX:r.offsetX||this.offsetX,offsetY:r.offsetY||this.offsetY,panelClass:r.panelClass||void 0}));return e.setOrigin(this._getFlexibleConnectedPositionStrategyOrigin()).withPositions(i).withFlexibleDimensions(this.flexibleDimensions).withPush(this.push).withGrowAfterOpen(this.growAfterOpen).withViewportMargin(this.viewportMargin).withLockedPosition(this.lockPosition).withTransformOriginOn(this.transformOriginSelector)}_createPositionStrategy(){const e=this._overlay.position().flexibleConnectedTo(this._getFlexibleConnectedPositionStrategyOrigin());return this._updatePositionStrategy(e),e}_getFlexibleConnectedPositionStrategyOrigin(){return this.origin instanceof iF?this.origin.elementRef:this.origin}_attachOverlay(){this._overlayRef?this._overlayRef.getConfig().hasBackdrop=this.hasBackdrop:this._createOverlay(),this._overlayRef.hasAttached()||this._overlayRef.attach(this._templatePortal),this.hasBackdrop?this._backdropSubscription=this._overlayRef.backdropClick().subscribe(e=>{this.backdropClick.emit(e)}):this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe(),this.positionChange.observers.length>0&&(this._positionSubscription=this._position.positionChanges.pipe(O2(()=>this.positionChange.observers.length>0)).subscribe(e=>{this.positionChange.emit(e),0===this.positionChange.observers.length&&this._positionSubscription.unsubscribe()}))}_detachOverlay(){this._overlayRef&&this._overlayRef.detach(),this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)(G(Bo),G(Qr),G(Fo),G(nF),G(Lp,8))},n.\u0275dir=Lt({type:n,selectors:[["","cdk-connected-overlay",""],["","connected-overlay",""],["","cdkConnectedOverlay",""]],inputs:{origin:["cdkConnectedOverlayOrigin","origin"],positions:["cdkConnectedOverlayPositions","positions"],positionStrategy:["cdkConnectedOverlayPositionStrategy","positionStrategy"],offsetX:["cdkConnectedOverlayOffsetX","offsetX"],offsetY:["cdkConnectedOverlayOffsetY","offsetY"],width:["cdkConnectedOverlayWidth","width"],height:["cdkConnectedOverlayHeight","height"],minWidth:["cdkConnectedOverlayMinWidth","minWidth"],minHeight:["cdkConnectedOverlayMinHeight","minHeight"],backdropClass:["cdkConnectedOverlayBackdropClass","backdropClass"],panelClass:["cdkConnectedOverlayPanelClass","panelClass"],viewportMargin:["cdkConnectedOverlayViewportMargin","viewportMargin"],scrollStrategy:["cdkConnectedOverlayScrollStrategy","scrollStrategy"],open:["cdkConnectedOverlayOpen","open"],disableClose:["cdkConnectedOverlayDisableClose","disableClose"],transformOriginSelector:["cdkConnectedOverlayTransformOriginOn","transformOriginSelector"],hasBackdrop:["cdkConnectedOverlayHasBackdrop","hasBackdrop"],lockPosition:["cdkConnectedOverlayLockPosition","lockPosition"],flexibleDimensions:["cdkConnectedOverlayFlexibleDimensions","flexibleDimensions"],growAfterOpen:["cdkConnectedOverlayGrowAfterOpen","growAfterOpen"],push:["cdkConnectedOverlayPush","push"]},outputs:{backdropClick:"backdropClick",positionChange:"positionChange",attach:"attach",detach:"detach",overlayKeydown:"overlayKeydown",overlayOutsideClick:"overlayOutsideClick"},exportAs:["cdkConnectedOverlay"],features:[cr]}),n})();const JW={provide:nF,deps:[Bo],useFactory:function QW(n){return()=>n.scrollStrategies.reposition()}};let bl=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({providers:[Bo,JW],imports:[tS,oa,dD,dD]}),n})();const e7=["tooltip"];function t7(n,t){1&n&&za(0)}function n7(n,t){if(1&n&&(Bl(0),$t(1,t7,1,0,"ng-container",7),zl()),2&n){const e=t.ngIf;Le(1),Je("ngTemplateOutlet",e)}}function i7(n,t){1&n&&$e(0),2&n&&hi(Yt().message)}function r7(n,t){if(1&n){const e=Io();oe(0,"button",8),Qt("click",function(){return Mi(e),Ai(Yt().hide(0))}),ln(1,"sbb-icon",9),de()}}function o7(n,t){1&n&&Pr(0)}const s7=["*"],qD="tooltip-panel",oF=kp({passive:!0}),sF=new Et("sbb-tooltip-scroll-strategy"),u7={provide:sF,deps:[Bo],useFactory:function c7(n){return()=>n.scrollStrategies.reposition({scrollThrottle:20})}},d7=new Et("sbb-tooltip-default-options",{providedIn:"root",factory:function h7(){return{showDelay:0,hideDelay:0,touchendHideDelay:1500,autoFocus:!0,restoreFocus:!0}}});class aF{constructor(t){this.instance=t}}let p7=(()=>{class n{constructor(e,i,r,s,d,m,y,C,M,k,z){this._overlay=e,this._elementRef=i,this._scrollDispatcher=r,this._viewContainerRef=s,this._ngZone=d,this._platform=m,this._ariaDescriber=y,this._focusMonitor=C,this._defaultOptions=k,this._disabled=!1,this._viewInitialized=!1,this._pointerExitEventsInitialized=!1,this._viewportMargin=8,this._cssClassPrefix="sbb",this.trigger="hover",this._showDelay=this._defaultOptions.showDelay,this._hideDelay=this._defaultOptions.hideDelay,this.touchGestures="auto",this._message="",this.tooltipPanelClass="",this._passiveListeners=[],this._destroyed=new Zt,this.opened=new nn,this.dismissed=new nn,this._scrollStrategy=M,this._document=z,null!=k&&k.touchGestures&&(this.touchGestures=k.touchGestures)}get disabled(){return this._disabled}set disabled(e){this._disabled=jn(e),this._disabled?this.hide(0):this._setupPointerEnterEventsIfNeeded()}get showDelay(){return this._showDelay}set showDelay(e){this._showDelay=gh(e)}get hideDelay(){return this._hideDelay}set hideDelay(e){this._hideDelay=gh(e),this._tooltipInstance&&(this._tooltipInstance._mouseLeaveHideDelay=this._hideDelay)}get message(){return this._message}set message(e){"string"==typeof this._message&&this._ariaDescriber.removeDescription(this._elementRef.nativeElement,this._message,"tooltip"),this._message=e instanceof Qr?e:null!=e?String(e).trim():"",!this._message&&this._isTooltipVisible()?this.hide(0):(this._setupPointerEnterEventsIfNeeded(),this._updateTooltipMessage(),"string"==typeof this._message&&this._ngZone.runOutsideAngular(()=>{Promise.resolve().then(()=>{this._ariaDescriber.describe(this._elementRef.nativeElement,this._message,"tooltip")})}))}get tooltipClass(){return this._tooltipClass}set tooltipClass(e){this._tooltipClass=e,this._tooltipInstance&&this._setTooltipClass(this._tooltipClass)}_preventClickBubbling(e){!this.disabled&&"click"===this.trigger&&e.stopPropagation()}ngAfterViewInit(){this._viewInitialized=!0,this._setupPointerEnterEventsIfNeeded(),this._focusMonitor.monitor(this._elementRef).pipe(Cr(()=>"hover"===this.trigger),Pi(this._destroyed)).subscribe(e=>{e?"keyboard"===e&&this._ngZone.run(()=>this.show()):this._ngZone.run(()=>this.hide(0))})}ngOnDestroy(){const e=this._elementRef.nativeElement;clearTimeout(this._touchstartTimeout),this._overlayRef&&(this._overlayRef.dispose(),this._tooltipInstance=null),this._passiveListeners.forEach(([i,r])=>{e.removeEventListener(i,r,oF)}),this._passiveListeners.length=0,this._destroyed.next(),this._destroyed.complete(),"string"==typeof this._message&&this._ariaDescriber.removeDescription(e,this._message,"tooltip"),this._focusMonitor.stopMonitoring(e)}show(e=this.showDelay){var i,r;if(this.disabled||!this.message||this._isTooltipVisible()&&!this._tooltipInstance._showTimeoutId&&!this._tooltipInstance._hideTimeoutId)return;const s=this._createOverlay();this._detach(),this._portal=this._portal||new od(this._tooltipComponent,this._viewContainerRef),this._tooltipInstance=s.attach(this._portal).instance,this._tooltipInstance._triggerElement=this._elementRef.nativeElement,this._tooltipInstance._mouseLeaveHideDelay=this._hideDelay,this.message instanceof Qr&&this._ariaDescriber.describe(this._elementRef.nativeElement,this._tooltipInstance._elementRef.nativeElement),this._tooltipInstance.afterShown().pipe(Pi(this._destroyed)).subscribe(()=>this.opened.emit(new aF(this))),this._tooltipInstance.afterHidden().pipe(Pi(this._destroyed)).subscribe(()=>{this.dismissed.emit(new aF(this)),this._detach()}),this._setTooltipClass(this._tooltipClass),this._updateTooltipMessage(),"click"===this.trigger?(this._tooltipInstance._config={autoFocus:null===(i=this._defaultOptions.autoFocus)||void 0===i||i,restoreFocus:null===(r=this._defaultOptions.restoreFocus)||void 0===r||r},this._tooltipInstance._initializeWithAttachedContent(),this._tooltipInstance._triggeredByClick=!0):(this._tooltipInstance._config=void 0,this._tooltipInstance._triggeredByClick=!1),this._tooltipInstance.show(e)}hide(e=this.hideDelay){this._tooltipInstance&&this._tooltipInstance.hide(e)}toggle(){this._isTooltipVisible()?this.hide():this.show()}_isTooltipVisible(){return!!this._tooltipInstance&&this._tooltipInstance.isVisible()}_createOverlay(){var e;if(this._overlayRef)return this._overlayRef;const i=this._scrollDispatcher.getAncestorScrollContainers(this._elementRef),r=`${this._cssClassPrefix}-${qD}-`,s=this._overlay.position().flexibleConnectedTo(this._elementRef).withTransformOriginOn(`.${this._cssClassPrefix}-tooltip`).withFlexibleDimensions(!1).withViewportMargin(this._viewportMargin).withScrollableContainers(i).withPositions([{originX:"center",originY:"bottom",overlayX:"center",overlayY:"top",offsetY:2},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top",offsetX:5,offsetY:2,panelClass:`${r}left`},{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top",offsetX:-5,offsetY:2,panelClass:`${r}right`},{originX:"center",originY:"top",overlayX:"center",overlayY:"bottom",offsetY:-2},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom",offsetX:5,offsetY:-2,panelClass:`${r}left`},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom",offsetX:-5,offsetY:-2,panelClass:`${r}right`}]);return s.positionChanges.pipe(Pi(this._destroyed)).subscribe(d=>{this._updateCurrentPositionClass(d.connectionPair),this._tooltipInstance&&d.scrollableViewProperties.isOriginOutsideView&&this._tooltipInstance.isVisible()&&this._ngZone.run(()=>this.hide(0))}),this._overlayRef=this._overlay.create({positionStrategy:s,panelClass:nD(this.tooltipPanelClass).concat(`${this._cssClassPrefix}-${qD}`),scrollStrategy:this._scrollStrategy()}),this._overlayRef.detachments().pipe(Pi(this._destroyed)).subscribe(()=>this._detach()),this._overlayRef.keydownEvents().pipe(Pi(this._destroyed)).subscribe(d=>{this._isTooltipVisible()&&27===d.keyCode&&!ra(d)&&(d.preventDefault(),d.stopPropagation(),this._ngZone.run(()=>this.hide(0)))}),this._overlayRef.outsidePointerEvents().pipe(Pi(this._destroyed)).subscribe(()=>{var d;return null===(d=this._tooltipInstance)||void 0===d?void 0:d._handleBodyInteraction()}),!(null===(e=this._defaultOptions)||void 0===e)&&e.disableTooltipInteractivity&&this._overlayRef.addPanelClass(`${this._cssClassPrefix}-tooltip-panel-non-interactive`),this._overlayRef}_detach(){this._overlayRef&&this._overlayRef.hasAttached()&&(this.message instanceof Qr&&this._tooltipInstance&&this._ariaDescriber.removeDescription(this._elementRef.nativeElement,this._tooltipInstance._elementRef.nativeElement),this._overlayRef.detach()),this._tooltipInstance=null}_updateTooltipMessage(){this._tooltipInstance&&(this._tooltipInstance.message=this.message,this._tooltipInstance._markForCheck(),this._ngZone.onMicrotaskEmpty.pipe(Vr(1),Pi(this._destroyed)).subscribe(()=>{this._tooltipInstance&&this._overlayRef.updatePosition()}))}_setTooltipClass(e){this._tooltipInstance&&(this._tooltipInstance.tooltipClass=e,this._tooltipInstance._markForCheck())}_updateCurrentPositionClass(e){const{overlayY:i,originX:r,originY:s}=e;let d;if(d="center"===i?"start"===r?"left":"right":"bottom"===i&&"top"===s?"above":"below",d!==this._currentPosition){const m=this._overlayRef;if(m){const y=`${this._cssClassPrefix}-${qD}-`;m.removePanelClass(y+this._currentPosition),m.addPanelClass(y+d)}this._currentPosition=d}}_setupPointerEnterEventsIfNeeded(){this._disabled||!this.message||!this._viewInitialized||this._passiveListeners.length||("click"===this.trigger?this._passiveListeners.push(["click",()=>this.show(0)]):this._platformSupportsMouseEvents()?this._passiveListeners.push(["mouseenter",()=>{this._setupPointerExitEventsIfNeeded(),this.show()}]):"off"!==this.touchGestures&&(this._disableNativeGesturesIfNecessary(),this._passiveListeners.push(["touchstart",()=>{this._setupPointerExitEventsIfNeeded(),clearTimeout(this._touchstartTimeout),this._touchstartTimeout=setTimeout(()=>this.show(),500)}])),this._addListeners(this._passiveListeners))}_setupPointerExitEventsIfNeeded(){if(this._pointerExitEventsInitialized)return;this._pointerExitEventsInitialized=!0;const e=[];if(this._platformSupportsMouseEvents())e.push(["mouseleave",i=>{var r;const s=i.relatedTarget;(!s||null===(r=this._overlayRef)||void 0===r||!r.overlayElement.contains(s))&&this.hide()}],["wheel",i=>this._wheelListener(i)]);else if("off"!==this.touchGestures){this._disableNativeGesturesIfNecessary();const i=()=>{clearTimeout(this._touchstartTimeout),this.hide(this._defaultOptions.touchendHideDelay)};e.push(["touchend",i],["touchcancel",i])}this._addListeners(e),this._passiveListeners.push(...e)}_addListeners(e){e.forEach(([i,r])=>{this._elementRef.nativeElement.addEventListener(i,r,oF)})}_platformSupportsMouseEvents(){return!this._platform.IOS&&!this._platform.ANDROID}_wheelListener(e){if(this._isTooltipVisible()){const i=this._document.elementFromPoint(e.clientX,e.clientY),r=this._elementRef.nativeElement;i!==r&&!r.contains(i)&&this.hide()}}_disableNativeGesturesIfNecessary(){const e=this.touchGestures;if("off"!==e){const i=this._elementRef.nativeElement,r=i.style;("on"===e||"INPUT"!==i.nodeName&&"TEXTAREA"!==i.nodeName)&&(r.userSelect=r.msUserSelect=r.webkitUserSelect=r.MozUserSelect="none"),("on"===e||!i.draggable)&&(r.webkitUserDrag="none"),r.touchAction="none",r.webkitTapHighlightColor="transparent"}}}return n.\u0275fac=function(e){Qc()},n.\u0275dir=Lt({type:n,hostBindings:function(e,i){1&e&&Qt("click",function(s){return i._preventClickBubbling(s)})},inputs:{trigger:["sbbTooltipTrigger","trigger"],disabled:["sbbTooltipDisabled","disabled"],showDelay:["sbbTooltipShowDelay","showDelay"],hideDelay:["sbbTooltipHideDelay","hideDelay"],touchGestures:["sbbTooltipTouchGestures","touchGestures"],message:["sbbTooltip","message"],tooltipClass:["sbbTooltipClass","tooltipClass"],tooltipPanelClass:["sbbTooltipPanelClass","tooltipPanelClass"]},outputs:{opened:"opened",dismissed:"dismissed"}}),n})(),lF=(()=>{class n extends p7{constructor(e,i,r,s,d,m,y,C,M,k,z){super(e,i,r,s,d,m,y,C,M,k,z),this._tooltipComponent=m7}}return n.\u0275fac=function(e){return new(e||n)(G(Bo),G(Tn),G(_O),G(Fo),G(qn),G(cs),G(tO),G(fa),G(sF),G(d7,8),G($n))},n.\u0275dir=Lt({type:n,selectors:[["","sbbTooltip",""]],hostVars:3,hostBindings:function(e,i){2&e&&(fn("aria-expanded","click"===i.trigger?i._isTooltipVisible():null),Ri("sbb-tooltip-trigger","click"===i.trigger))},exportAs:["sbbTooltip"],features:[qt]}),n})(),f7=(()=>{class n{constructor(e,i,r,s,d,m){this._elementRef=e,this._focusTrapFactory=i,this._changeDetectorRef=r,this._focusMonitor=s,this._visibility="initial",this._closeInteractionType=null,this._config={},this._closeOnInteraction=!1,this._elementFocusedBeforeDialogWasOpened=null,this._isVisible=!1,this._onShow=new Zt,this._onHide=new Zt,this._triggeredByClick=!1,this._animationsDisabled="NoopAnimations"===m,this._document=d}show(e){clearTimeout(this._hideTimeoutId),this._closeOnInteraction=!0,this._showTimeoutId=setTimeout(()=>{this._showTimeoutId=void 0,this._toggleVisibility(!0)},e)}hide(e){clearTimeout(this._showTimeoutId),this._hideTimeoutId=setTimeout(()=>{this._toggleVisibility(!1),this._hideTimeoutId=void 0,this._markForCheck()},e)}afterShown(){return this._onShow}afterHidden(){return this._onHide}isVisible(){return this._isVisible}ngOnDestroy(){clearTimeout(this._showTimeoutId),clearTimeout(this._hideTimeoutId),this._onShow.complete(),this._onHide.complete(),this._triggerElement=null}_handleBodyInteraction(){this._closeOnInteraction&&this.hide(0)}_initializeWithAttachedContent(){this._setupFocusTrap(),this._capturePreviouslyFocusedElement(),this._focusDialogContainer()}_markForCheck(){this._changeDetectorRef.markForCheck()}_handleMouseLeave({relatedTarget:e}){!this._triggeredByClick&&(!e||!this._triggerElement.contains(e))&&this.hide(this._mouseLeaveHideDelay)}_handleAnimationEnd({animationName:e}){(e===this._showAnimation||e===this._hideAnimation)&&this._finalizeAnimation(e===this._showAnimation)}_finalizeAnimation(e){e?this._closeOnInteraction=!0:this.isVisible()||this._onHide.next(),e&&this.isVisible()&&this._config&&this._trapFocus(),!e&&!this.isVisible()&&this._restoreFocus()}_toggleVisibility(e){const i=this._tooltip.nativeElement,r=this._showAnimation,s=this._hideAnimation;if(i.classList.remove(e?s:r),i.classList.add(e?r:s),this._isVisible=e,e&&!this._animationsDisabled&&"function"==typeof getComputedStyle){const d=getComputedStyle(i);("0s"===d.getPropertyValue("animation-duration")||"none"===d.getPropertyValue("animation-name"))&&(this._animationsDisabled=!0)}e&&this._onShow.next(),this._animationsDisabled&&(i.classList.add("_sbb-animation-noopable"),this._finalizeAnimation(e))}_trapFocus(){var e;null!==(e=this._config)&&void 0!==e&&e.autoFocus?this._focusTrap.focusInitialElementWhenReady():this._containsFocus()||this._elementRef.nativeElement.focus()}_restoreFocus(){var e;const i=this._elementFocusedBeforeDialogWasOpened;if((null===(e=this._config)||void 0===e?void 0:e.restoreFocus)&&i&&"function"==typeof i.focus){const r=su(),s=this._elementRef.nativeElement;(!r||r===this._document.body||r===s||s.contains(r))&&(this._focusMonitor.focusVia(i,this._closeInteractionType),this._closeInteractionType=null)}this._focusTrap&&this._focusTrap.destroy()}_setupFocusTrap(){this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement)}_capturePreviouslyFocusedElement(){this._document&&(this._elementFocusedBeforeDialogWasOpened=su())}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){const e=this._elementRef.nativeElement,i=su();return e===i||e.contains(i)}}return n.\u0275fac=function(e){return new(e||n)(G(Tn),G(lO),G(Sr),G(fa),G($n,8),G(Qu,8))},n.\u0275dir=Lt({type:n}),n})(),m7=(()=>{class n extends f7{constructor(e,i,r,s,d,m,y){super(e,i,r,s,d,y),this._breakpointObserver=m,this._isHandset=this._breakpointObserver.observe("(max-width: 642.99px) and (orientation: portrait), (max-width: 1024.99px) and (orientation: landscape)"),this._showAnimation="sbb-tooltip-container-show",this._hideAnimation="sbb-tooltip-container-hide"}get _templateRef(){return this.message instanceof Qr?this.message:null}}return n.\u0275fac=function(e){return new(e||n)(G(Tn),G(lO),G(Sr),G(fa),G($n,8),G(iD),G(Qu,8))},n.\u0275cmp=vn({type:n,selectors:[["sbb-tooltip-component"]],viewQuery:function(e,i){if(1&e&&ur(e7,7),2&e){let r;Nn(r=Bn())&&(i._tooltip=r.first)}},hostAttrs:["aria-hidden","true",1,"sbb-tooltip-component"],hostVars:2,hostBindings:function(e,i){1&e&&Qt("mouseleave",function(s){return i._handleMouseLeave(s)}),2&e&&Zu("zoom",i.isVisible()?1:null)},features:[qt],decls:9,vars:10,consts:[[1,"sbb-tooltip-container",3,"animationend"],["tooltip",""],[1,"sbb-tooltip",3,"ngClass"],[1,"sbb-tooltip-content"],[4,"ngIf","ngIfElse"],["stringMessage",""],["type","button","class","sbb-tooltip-icon sbb-tooltip-close-button sbb-icon-fit sbb-button-reset-frameless",3,"click",4,"ngIf"],[4,"ngTemplateOutlet"],["type","button",1,"sbb-tooltip-icon","sbb-tooltip-close-button","sbb-icon-fit","sbb-button-reset-frameless",3,"click"],["svgIcon","kom:cross-small"]],template:function(e,i){if(1&e&&(oe(0,"div",0,1),Qt("animationend",function(s){return i._handleAnimationEnd(s)}),yb(2,"async"),oe(3,"div",2)(4,"div",3),$t(5,n7,2,1,"ng-container",4),$t(6,i7,1,1,"ng-template",null,5,im),de(),$t(8,r7,2,0,"button",6),de()()),2&e){const r=Nl(7);let s;Ri("sbb-tooltip-handset",null==(s=vb(2,8,i._isHandset))?null:s.matches),Le(3),Ri("sbb-tooltip-has-close-button",i._triggeredByClick),Je("ngClass",i.tooltipClass),Le(2),Je("ngIf",i._templateRef)("ngIfElse",r),Le(3),Je("ngIf",i._triggeredByClick)}},dependencies:[Tb,Ts,rT,qa,Hy],styles:['.sbb-tooltip-component{display:block;filter:drop-shadow(0 var(--sbb-box-shadow-width) 0 var(--sbb-box-shadow-color))}.sbb-tooltip-container{height:100%;font-size:var(--sbb-font-size);line-height:var(--sbb-line-height);opacity:0}.sbb-tooltip-container._sbb-animation-noopable{animation:none;opacity:1}.sbb-tooltip-container::after,.sbb-tooltip-container::before{top:calc(.5*var(--sbb-border-width));left:0;right:0;margin-left:auto;margin-right:auto;content:"";height:var(--sbb-tooltip-content-arrow-size);width:var(--sbb-tooltip-content-arrow-size);position:absolute;pointer-events:none;transform:rotate(45deg);border:var(--sbb-border-width) solid rgba(0,0,0,0)}.sbb-tooltip-panel-above .sbb-tooltip-container::after,.sbb-tooltip-panel-above .sbb-tooltip-container::before{top:auto;bottom:calc(.5*var(--sbb-tooltip-shadow-arrow-size));transform:rotate(225deg)}.sbb-tooltip-panel-left .sbb-tooltip-container::after,.sbb-tooltip-panel-left .sbb-tooltip-container::before{margin-right:var(--sbb-tooltip-arrow-horizontal-space)}.sbb-tooltip-panel-right .sbb-tooltip-container::after,.sbb-tooltip-panel-right .sbb-tooltip-container::before{margin-left:var(--sbb-tooltip-arrow-horizontal-space)}.sbb-tooltip-container::before{border-color:var(--sbb-color-weak-accent);z-index:1}.sbb-tooltip-container::after{background-color:var(--sbb-tooltip-background-color);background-clip:padding-box;z-index:2;--sbb-tooltip-arrow-padding-offset: 0rem;clip-path:polygon(0 0, calc(var(--sbb-tooltip-content-arrow-size) - var(--sbb-tooltip-arrow-padding-offset)) 0, 0 calc(var(--sbb-tooltip-content-arrow-size) - var(--sbb-tooltip-arrow-padding-offset)))}html.sbb-lean .sbb-tooltip-container::after{--sbb-tooltip-arrow-padding-offset: 0.0666666667rem}.sbb-tooltip-panel-above .sbb-tooltip-container{margin-bottom:calc(0.8rem * var(--sbb-scaling-factor))}@keyframes sbb-tooltip-container-show{0%{opacity:0}100%{opacity:1}}@keyframes sbb-tooltip-container-hide{0%{opacity:1}100%{opacity:0}}.sbb-tooltip-container-show{animation:sbb-tooltip-container-show var(--sbb-transition-duration-fast) cubic-bezier(0, 0, 0.2, 1) forwards}.sbb-tooltip-container-hide{animation:sbb-tooltip-container-hide 75ms cubic-bezier(0, 0, 0.2, 1) forwards}.sbb-tooltip{max-width:calc(30.6666666667rem * var(--sbb-scaling-factor));padding:var(--sbb-tooltip-padding);position:relative;overflow:hidden;color:var(--sbb-color-granite);text-overflow:ellipsis;background-color:var(--sbb-tooltip-background-color);border:var(--sbb-border-width) solid var(--sbb-color-weak-accent);border-radius:var(--sbb-border-radius);z-index:2}.cdk-high-contrast-active .sbb-tooltip{outline:solid 1px}.sbb-tooltip-panel-below .sbb-tooltip{margin-top:var(--sbb-tooltip-arrow-offset)}:where(html.sbb-lean) .sbb-tooltip{color:var(--sbb-color-text)}.sbb-tooltip-zero-padding{--sbb-tooltip-padding: 0}.sbb-tooltip-has-close-button{padding-right:calc(4.7333333333rem * var(--sbb-scaling-factor))}:where(html.sbb-lean) .sbb-tooltip-has-close-button{padding-right:3.2rem}.sbb-tooltip-zero-padding .sbb-tooltip-has-close-button{padding-right:0}.sbb-tooltip-close-button{color:var(--sbb-color-weak-accent);position:absolute;width:var(--sbb-icon-size-default);height:var(--sbb-icon-size-default);top:var(--sbb-tooltip-padding);right:var(--sbb-tooltip-padding);line-height:0}:where(html:not(.sbb-lean)) .sbb-tooltip-close-button{border:var(--sbb-border-width-thin) solid var(--sbb-color-storm);border-radius:50%}.sbb-tooltip-panel-non-interactive{pointer-events:none}'],encapsulation:2,changeDetection:0}),n})();const g7=Ga(class{});let b7=1,cF=(()=>{class n extends g7{constructor(){super(...arguments),this.id="sbb-tooltip-id-"+b7++,this.trigger="click",this._destroyed=new Zt,this.svgIcon="kom:circle-question-mark-small",this.opened=new nn,this.dismissed=new nn}get hoverShowDelay(){return this._hoverShowDelay}set hoverShowDelay(e){this._hoverShowDelay=gh(e,0)}get hoverHideDelay(){return this._hoverHideDelay}set hoverHideDelay(e){this._hoverHideDelay=gh(e,0)}ngOnInit(){this._tooltip.opened.pipe(Pi(this._destroyed)).subscribe(e=>this.opened.emit(e)),this._tooltip.dismissed.pipe(Pi(this._destroyed)).subscribe(e=>this.dismissed.emit(e))}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}show(){this._tooltip.show(0)}hide(){this._tooltip.hide(0)}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Vi(n)))(i||n)}}(),n.\u0275cmp=vn({type:n,selectors:[["sbb-tooltip"]],viewQuery:function(e,i){if(1&e&&ur(lF,7),2&e){let r;Nn(r=Bn())&&(i._tooltip=r.first)}},hostAttrs:[1,"sbb-tooltip-wrapper"],hostVars:2,hostBindings:function(e,i){2&e&&fn("id",i.id)("aria-expanded",i._tooltip._isTooltipVisible())},inputs:{disabled:"disabled",id:"id",trigger:"trigger",hoverShowDelay:"hoverShowDelay",hoverHideDelay:"hoverHideDelay",svgIcon:"svgIcon",sbbTooltipClass:"sbbTooltipClass",sbbTooltipPanelClass:"sbbTooltipPanelClass"},outputs:{opened:"opened",dismissed:"dismissed"},features:[qt],ngContentSelectors:s7,decls:5,vars:9,consts:[["type","button",1,"sbb-tooltip-icon","sbb-tooltip-trigger","sbb-icon-scaled","sbb-button-reset-frameless",3,"sbbTooltip","sbbTooltipTrigger","sbbTooltipShowDelay","sbbTooltipHideDelay","sbbTooltipClass","sbbTooltipPanelClass","click"],["tooltip","sbbTooltip"],[3,"svgIcon"],["tooltipTemplate",""]],template:function(e,i){if(1&e){const r=Io();Mo(),oe(0,"button",0,1),Qt("click",function(){return Mi(r),Ai(Nl(1).show(0))}),ln(2,"sbb-icon",2),de(),$t(3,o7,1,0,"ng-template",null,3,im)}if(2&e){const r=Nl(1),s=Nl(4);Ri("sbb-tooltip-trigger-active",r._isTooltipVisible()),Je("sbbTooltip",s)("sbbTooltipTrigger",i.trigger)("sbbTooltipShowDelay",i.hoverShowDelay)("sbbTooltipHideDelay",i.hoverHideDelay)("sbbTooltipClass",i.sbbTooltipClass)("sbbTooltipPanelClass",i.sbbTooltipPanelClass),Le(2),Je("svgIcon",i.svgIcon)}},dependencies:[qa,lF],encapsulation:2,changeDetection:0}),n})(),uF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({providers:[u7],imports:[Sm,gr,bl,oa,Wi,mo,Tm]}),n})();function _7(n,t){if(1&n){const e=Io();oe(0,"div",15)(1,"div",16),Qt("click",function(){return Mi(e),Ai(Yt().handleTapOnPill())}),$e(2,"MAP"),de()()}}function y7(n,t){1&n&&za(0)}function v7(n,t){1&n&&za(0)}function x7(n,t){1&n&&za(0)}function w7(n,t){if(1&n&&(oe(0,"div")(1,"div"),$e(2),de()()),2&n){const e=Yt(3);Le(2),wr("Pl. ",e.legInfoDataModel.fromLocationData.platformText,"")}}function S7(n,t){if(1&n&&(oe(0,"div")(1,"div"),$e(2,"Pl. "),oe(3,"del"),$e(4),de(),oe(5,"span",22),$e(6),de()()()),2&n){const e=Yt(3);Le(4),wr(" ",e.legInfoDataModel.fromLocationData.platformText,""),Le(2),wr(" ",e.legInfoDataModel.fromLocationData.actualPlatformText,"")}}function C7(n,t){if(1&n&&(oe(0,"div"),$t(1,w7,3,1,"div",19),$t(2,S7,7,2,"div",19),de()),2&n){const e=Yt(2);Le(1),Je("ngIf",!e.legInfoDataModel.fromLocationData.actualPlatformText),Le(1),Je("ngIf",e.legInfoDataModel.fromLocationData.actualPlatformText)}}function T7(n,t){if(1&n&&ln(0,"img",26),2&n){const e=Yt(2);Va("src",e.legInfoDataModel.fromLocationData.platformAssistanceIconPath,ll),Va("title",e.legInfoDataModel.fromLocationData.platformAssistanceTooltip)}}function E7(n,t){if(1&n&&(oe(0,"li"),$e(1),de()),2&n){const e=t.$implicit;Le(1),wr(" ",e," ")}}function D7(n,t){if(1&n&&(oe(0,"div")(1,"p")(2,"strong"),$e(3),de()(),oe(4,"div"),$e(5),de(),oe(6,"ul",30),$t(7,E7,2,1,"li",29),de()()),2&n){const e=t.$implicit;Le(3),hi(e.situationContent.summary),Le(2),wr(" ",e.situationContent.description," "),Le(2),Je("ngForOf",e.situationContent.details)}}function I7(n,t){if(1&n&&(oe(0,"div",27)(1,"sbb-tooltip",28),$t(2,D7,8,3,"div",29),de()()),2&n){const e=Yt(2);Le(2),Je("ngForOf",e.legInfoDataModel.situations)}}function M7(n,t){if(1&n&&(oe(0,"div")(1,"div"),$e(2),de()()),2&n){const e=Yt(3);Le(2),wr("Pl. ",e.legInfoDataModel.toLocationData.platformText,"")}}function A7(n,t){if(1&n&&(oe(0,"div")(1,"div"),$e(2,"Pl. "),oe(3,"del"),$e(4),de(),oe(5,"span",22),$e(6),de()()()),2&n){const e=Yt(3);Le(4),wr(" ",e.legInfoDataModel.toLocationData.platformText,""),Le(2),wr(" ",e.legInfoDataModel.toLocationData.actualPlatformText,"")}}function k7(n,t){if(1&n&&(oe(0,"div"),$t(1,M7,3,1,"div",19),$t(2,A7,7,2,"div",19),de()),2&n){const e=Yt(2);Le(1),Je("ngIf",!e.legInfoDataModel.toLocationData.actualPlatformText),Le(1),Je("ngIf",e.legInfoDataModel.toLocationData.actualPlatformText)}}function R7(n,t){if(1&n&&ln(0,"img",26),2&n){const e=Yt(2);Va("src",e.legInfoDataModel.toLocationData.platformAssistanceIconPath,ll),Va("title",e.legInfoDataModel.toLocationData.platformAssistanceTooltip)}}function P7(n,t){if(1&n){const e=Io();oe(0,"div",17)(1,"div",18),Qt("click",function(){return Mi(e),Ai(Yt().handleClickOnLocation("From"))}),oe(2,"span"),$e(3),de(),$t(4,C7,3,2,"div",19),de(),oe(5,"div",20),$t(6,T7,1,2,"img",21),oe(7,"span"),$e(8),de(),oe(9,"span",22),$e(10),de()()(),oe(11,"div",4)(12,"div",23),ln(13,"div",24),de(),$t(14,I7,3,1,"div",25),de(),oe(15,"div",17)(16,"div",18),Qt("click",function(){return Mi(e),Ai(Yt().handleClickOnLocation("To"))}),oe(17,"span"),$e(18),de(),$t(19,k7,3,2,"div",19),de(),oe(20,"div",20),$t(21,R7,1,2,"img",21),oe(22,"span"),$e(23),de(),oe(24,"span",22),$e(25),de()()()}if(2&n){const e=Yt();Le(3),hi(e.legInfoDataModel.fromLocationData.locationText),Le(1),Je("ngIf",e.legInfoDataModel.fromLocationData.platformText),Le(2),Je("ngIf",null!==e.legInfoDataModel.fromLocationData.platformAssistanceIconPath),Le(2),hi(e.legInfoDataModel.fromLocationData.timeText),Le(2),hi(e.legInfoDataModel.fromLocationData.delayText),Le(4),Je("ngIf",e.legInfoDataModel.hasSituations),Le(4),hi(e.legInfoDataModel.toLocationData.locationText),Le(1),Je("ngIf",e.legInfoDataModel.toLocationData.platformText),Le(2),Je("ngIf",null!==e.legInfoDataModel.toLocationData.platformAssistanceIconPath),Le(2),hi(e.legInfoDataModel.toLocationData.timeText),Le(2),hi(e.legInfoDataModel.toLocationData.delayText)}}function L7(n,t){if(1&n&&(oe(0,"li"),$e(1),de()),2&n){const e=t.$implicit;Le(1),wr(" ",e," ")}}function O7(n,t){if(1&n&&(oe(0,"sbb-tooltip",35)(1,"ul",30),$t(2,L7,2,1,"li",29),de()()),2&n){const e=Yt(2);Le(2),Je("ngForOf",e.legInfoDataModel.guidanceTextLines)}}function F7(n,t){1&n&&(oe(0,"div"),ln(1,"div",36),de())}function N7(n,t){if(1&n){const e=Io();oe(0,"div",17)(1,"div",31)(2,"div",32)(3,"div",33),Qt("click",function(){return Mi(e),Ai(Yt().handleClickOnLocation("From"))}),$e(4),de(),$t(5,O7,3,1,"sbb-tooltip",34),$t(6,F7,2,0,"div",19),oe(7,"div",33),Qt("click",function(){return Mi(e),Ai(Yt().handleClickOnLocation("To"))}),$e(8),de()()(),oe(9,"div",20)(10,"div"),$e(11),de()()()}if(2&n){const e=Yt();Le(4),hi(e.legInfoDataModel.fromLocationData.locationText),Le(1),Je("ngIf",e.legInfoDataModel.hasGuidance),Le(1),Je("ngIf",0==e.legInfoDataModel.hasGuidance),Le(2),hi(e.legInfoDataModel.toLocationData.locationText),Le(3),hi(e.legInfoDataModel.durationText)}}function B7(n,t){if(1&n&&(oe(0,"li"),$e(1," Book on "),oe(2,"a",38),$e(3),de()()),2&n){const e=t.$implicit;Le(2),Va("href",e.infoURL,ll),Le(1),hi(e.agencyName)}}function z7(n,t){if(1&n){const e=Io();oe(0,"div",17)(1,"div",31)(2,"div",32)(3,"div",33),Qt("click",function(){return Mi(e),Ai(Yt().handleClickOnLocation("From"))}),$e(4),de(),oe(5,"ul",37),$t(6,B7,4,2,"li",29),de(),oe(7,"div",33),Qt("click",function(){return Mi(e),Ai(Yt().handleClickOnLocation("To"))}),$e(8),de()()(),oe(9,"div",20)(10,"div"),$e(11),de()()()}if(2&n){const e=Yt();Le(4),hi(e.legInfoDataModel.fromLocationData.locationText),Le(2),Je("ngForOf",e.legInfoDataModel.bookingArrangements),Le(2),hi(e.legInfoDataModel.toLocationData.locationText),Le(3),hi(e.legInfoDataModel.durationText)}}const V7=function(n){return{"background-color":n}};let j7=(()=>{class n{constructor(e,i){this.mapService=e,this.router=i,this.legInfoDataModel={},this.isEmbed=-1!==this.router.url.indexOf("/embed/")}ngOnInit(){this.leg&&this.initLegInfo(this.leg)}computeLegLeadText(){if(void 0===this.leg)return"n/a";if("TransferLeg"===this.leg.legType){const e="Transfer",i=this.leg;let r="";return i.walkDuration&&(r=" "+i.walkDuration.formatDuration()),e+r}if("ContinousLeg"===this.leg.legType){const i=this.computeLegLeadTextContinousLeg(this.leg);let r="";return this.leg.legDuration&&(r=" "+this.leg.legDuration.formatDuration()),i+r}if("TimedLeg"===this.leg.legType){const i=this.leg.service.formatServiceName();let r="";return this.leg.legDuration&&(r=" "+this.leg.legDuration.formatDuration()),i+r}return this.leg.legType}computeLegLeadTextContinousLeg(e){return"walk"===e.legTransportMode?"Walk":e.isDriveCarLeg()?"Drive":e.isSharedMobility()?"Ride":e.isTaxi()?"others-drive-car"===e.legTransportMode?"Limo":"Taxi":"PLACEHOLDER - NEW MOT?"}computeLegPillClassName(){return this.leg?"ContinousLeg"===this.leg.legType?"continous-leg-pill":"TimedLeg"===this.leg.legType?"timed-leg-pill":"TransferLeg"===this.leg.legType?"transfer-leg-pill":"":""}handleTapOnPill(){if(!this.leg)return;const e=this.leg.computeGeoJSONFeatures(),i=new Bp([]);if(e.forEach(m=>{const y=m.bbox;if(y){const C=new Is(y[0],y[1]);i.extend(C);const M=new Is(y[2],y[3]);i.extend(M)}}),!i.isValid())return console.error("Invalid BBOX for leg"),void console.log(this.leg);const r=new(Ms().LngLatBounds)(i.asFeatureBBOX());if(r.getSouthWest().distanceTo(r.getNorthEast())<20){const m={lnglat:r.getCenter(),zoom:16};this.mapService.newMapCenterAndZoomRequested.emit(m)}else this.mapService.newMapBoundsRequested.emit({bounds:r})}computeLegColor(){var e,i;return null!==(i=null===(e=this.leg)||void 0===e?void 0:e.computeLegColor())&&void 0!==i?i:Dv.TimedLeg}initLegInfo(e){var i,r,s,d;this.legInfoDataModel.legColor=this.computeLegColor(),this.legInfoDataModel.leadingText=this.computeLegLeadText();const m="TransferLeg"===e.legType;this.legInfoDataModel.guidanceTextLines=[],m&&(null!==(r=null===(i=e.pathGuidance)||void 0===i?void 0:i.sections)&&void 0!==r?r:[]).forEach(q=>{var Q,xe,De,Ze,It,ut;if(null===q.guidanceAdvice)return;const Ht=[null!==(Q=q.guidanceAdvice)&&void 0!==Q?Q:"","(",null!==(xe=q.turnAction)&&void 0!==xe?xe:"",") - ",null!==(Ze=null===(De=q.trackSection)||void 0===De?void 0:De.roadName)&&void 0!==Ze?Ze:""],Mn=null!==(ut=null===(It=q.trackSection)||void 0===It?void 0:It.length)&&void 0!==ut?ut:0;Mn>0&&(Ht.push(" ("),Ht.push(""+Mn),Ht.push("m)"));const Yn=Ht.join("");this.legInfoDataModel.guidanceTextLines.push(Yn)});let y="TransferLeg"===e.legType;const C="ContinousLeg"===e.legType;if(C){const k=e;y=k.isWalking(),y&&(this.legInfoDataModel.distanceText=k.formatDistance())}this.legInfoDataModel.isWalking=y,this.legInfoDataModel.legTemplate=y?"walk":C&&e.isTaxi()?"taxi":"timed",this.legInfoDataModel.bookingArrangements=C?null===e.serviceBooking?[]:e.serviceBooking.bookingArrangements:[],this.legInfoDataModel.durationText=null!==(d=null===(s=e.legDuration)||void 0===s?void 0:s.formatDuration())&&void 0!==d?d:"",this.legInfoDataModel.hasGuidance=this.legInfoDataModel.guidanceTextLines.length>0;const M=this.computeLegIconFilename(e);if(this.legInfoDataModel.legIconPath="assets/pictograms/"+M+".png",this.legInfoDataModel.isTimed="TimedLeg"===e.legType,this.legInfoDataModel.fromLocationData=this.computeLocationData(e,"From"),this.legInfoDataModel.toLocationData=this.computeLocationData(e,"To"),this.legInfoDataModel.situations="TimedLeg"!==e.legType?[]:e.service.siriSituations,this.legInfoDataModel.hasSituations=this.legInfoDataModel.situations.length>0,"TimedLeg"===e.legType){const k=e;this.legInfoDataModel.fromLocationData.platformAssistanceIconPath=this.computePlatformAssistanceIconPath(k,"From"),this.legInfoDataModel.fromLocationData.platformAssistanceTooltip=this.computePlatformAssistanceTooltip(k,"From"),this.legInfoDataModel.toLocationData.platformAssistanceIconPath=this.computePlatformAssistanceIconPath(k,"To"),this.legInfoDataModel.toLocationData.platformAssistanceTooltip=this.computePlatformAssistanceTooltip(k,"To")}}computeLegIconFilename(e){if("TransferLeg"===e.legType)return"picto-walk";if("TimedLeg"===e.legType)return e.service.ptMode.computePublicTransportPictogram();if("ContinousLeg"===e.legType){const i=e;return i.isDriveCarLeg()?"car-sharing":i.isSharedMobility()?"velo-scooter-sharing":i.isTaxi()?"taxi":"picto-walk"}return"picto-bus-fallback"}computePlatformAssistanceIconPath(e,i){const r="From"===i?e.fromStopPoint:e.toStopPoint,s="PLATFORM_ACCESS_WITHOUT_ASSISTANCE"===r.vehicleAccessType?"platform_independent":"PLATFORM_ACCESS_WITH_ASSISTANCE"===r.vehicleAccessType?"platform_help_driver":"PLATFORM_ACCESS_WITH_ASSISTANCE_WHEN_NOTIFIED"===r.vehicleAccessType?"platform_advance_notice":"PLATFORM_NOT_WHEELCHAIR_ACCESSIBLE"===r.vehicleAccessType?"platform_not_possible":"NO_DATA"===r.vehicleAccessType?"platform_no_information":null;return null===s?null:"assets/platform-assistance/"+s+".jpg"}computePlatformAssistanceTooltip(e,i){const r="From"===i?e.fromStopPoint:e.toStopPoint;return"PLATFORM_ACCESS_WITHOUT_ASSISTANCE"===r.vehicleAccessType?"Step-free access; level entry/exit.":"PLATFORM_ACCESS_WITH_ASSISTANCE"===r.vehicleAccessType?"Step-free access; entry/exit through staff assistance, no prior registration necessary.":"PLATFORM_ACCESS_WITH_ASSISTANCE_WHEN_NOTIFIED"===r.vehicleAccessType?"Step-free access; entry/exit through staff assistance, advance registration required.":"PLATFORM_NOT_WHEELCHAIR_ACCESSIBLE"===r.vehicleAccessType?"Not usable for wheelchairs.":"No available information about vehicle access."}computeLocationData(e,i){var r;const s="From"===i,m={locationText:null!==(r=(s?e.fromLocation:e.toLocation).computeLocationName())&&void 0!==r?r:"",platformText:null,timeText:null,delayText:null};if("TimedLeg"===e.legType){const y=e,C=s?y.fromStopPoint:y.toStopPoint,M=s?C.departureData:C.arrivalData,k=null==M?void 0:M.timetableTime;if(k){m.timeText=gl.formatTimeHHMM(k);const z=null==M?void 0:M.delayMinutes;if(z){const q=[];q.push(" "),q.push(z>0?"+":""),q.push(""+z),q.push("'"),m.delayText=q.join("")}}m.platformText=C.plannedPlatform,m.actualPlatformText=C.actualPlatform===C.plannedPlatform?null:C.actualPlatform}return m}handleClickOnLocation(e){this.leg&&this.mapService.tryToCenterAndZoomToLocation("From"===e?this.leg.fromLocation:this.leg.toLocation)}}return n.\u0275fac=function(e){return new(e||n)(G(jp),G(ls))},n.\u0275cmp=vn({type:n,selectors:[["result-trip-leg"]],inputs:{leg:"leg"},decls:24,vars:13,consts:[[1,"mb-2","d-flex","flex-row"],[1,"flex-grow-1"],[1,"badge","leg-pill","pill-hover","leg-leading-text",3,"ngStyle","click"],["class","flex-grow-0 leg-right-side",4,"ngIf"],[1,"mb-2","d-flex","flex-row","align-items-center"],[1,"flex-grow-0","leg-left-side"],[1,"d-flex","flex-column","leg-icon-wrapper"],[1,"text-center"],[1,"leg-icon",3,"src"],[4,"ngIf","ngIfThen"],[1,"mb-2"],[1,"border-bottom",2,"height","8px"],["timedLegTemplate",""],["walkingLegTemplate",""],["taxiLegTemplate",""],[1,"flex-grow-0","leg-right-side"],[1,"badge","leg-pill","pill-hover","bg-primary",3,"click"],[1,"d-flex","flex-row","align-items-center"],[1,"flex-grow-1","leg-location","location-hover",3,"click"],[4,"ngIf"],[1,"flex-grow-0","leg-time","leg-right-side"],["class","leg-platform-assistance",3,"src","title",4,"ngIf"],[1,"time-delay"],[1,"flex-grow-1","leg-location","location-hover"],[1,"border-bottom",2,"height","8px","margin-left","4px"],["class","flex-grow-0 situation-info",4,"ngIf"],[1,"leg-platform-assistance",3,"src","title"],[1,"flex-grow-0","situation-info"],["svgIcon","fpl:info"],[4,"ngFor","ngForOf"],[1,"tooltip-list"],[1,"flex-grow-1","leg-location"],[1,"d-flex","flex-column","leg-location"],[1,"location-hover",3,"click"],["svgIcon","kom:arrow-change-horizontal-medium",4,"ngIf"],["svgIcon","kom:arrow-change-horizontal-medium"],[1,"border-bottom",2,"height","8px","margin-left","4px","margin-right","8px"],[1,"booking-arrangement"],["target","_blank",3,"href"]],template:function(e,i){if(1&e&&(oe(0,"div",0)(1,"div",1)(2,"div",2),Qt("click",function(){return i.handleTapOnPill()}),$e(3),de()(),$t(4,_7,3,0,"div",3),de(),oe(5,"div",4)(6,"div",5)(7,"div",6)(8,"div",7),ln(9,"img",8),de(),oe(10,"div",7),$e(11),de()()(),oe(12,"div",1),$t(13,y7,1,0,"ng-container",9),$t(14,v7,1,0,"ng-container",9),$t(15,x7,1,0,"ng-container",9),de()(),oe(16,"div",10),ln(17,"div",11),de(),$t(18,P7,26,11,"ng-template",null,12,im),$t(20,N7,12,5,"ng-template",null,13,im),$t(22,z7,12,4,"ng-template",null,14,im)),2&e){const r=Nl(19),s=Nl(21),d=Nl(23);Le(2),Je("ngStyle",xC(11,V7,i.legInfoDataModel.legColor)),Le(1),hi(i.legInfoDataModel.leadingText),Le(1),Je("ngIf",!1===i.isEmbed),Le(5),Va("src",i.legInfoDataModel.legIconPath,ll),Le(2),hi(i.legInfoDataModel.distanceText),Le(2),Je("ngIf","walk"==i.legInfoDataModel.legTemplate)("ngIfThen",s),Le(1),Je("ngIf","timed"==i.legInfoDataModel.legTemplate)("ngIfThen",r),Le(1),Je("ngIf","taxi"==i.legInfoDataModel.legTemplate)("ngIfThen",d)}},dependencies:[Sc,Ts,qk,cF],styles:[".pill-hover[_ngcontent-%COMP%]:hover, .location-hover[_ngcontent-%COMP%]:hover{cursor:pointer}.tooltip-list[_ngcontent-%COMP%]{margin-top:16px;margin-bottom:8px}.leg-left-side[_ngcontent-%COMP%]{width:50px}.leg-right-side[_ngcontent-%COMP%]{width:auto}.leg-leading-text[_ngcontent-%COMP%]{margin-bottom:2px}.leg-icon[_ngcontent-%COMP%]{width:40px;height:40px}.leg-location[_ngcontent-%COMP%]{background-color:transparent;margin-left:4px}.leg-time-wrapper[_ngcontent-%COMP%]{background-color:transparent}.leg-time[_ngcontent-%COMP%]{font-size:15px}.time-delay[_ngcontent-%COMP%]{color:#c45f00}.booking-arrangement[_ngcontent-%COMP%]{margin-top:4px;margin-bottom:4px}.booking-arrangement[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-top:0;padding-left:0}.situation-info[_ngcontent-%COMP%]{margin-left:4px}.leg-platform-assistance[_ngcontent-%COMP%]{width:30px}"]}),n})();function U7(n,t){1&n&&ln(0,"result-trip-leg",4),2&n&&Je("leg",t.$implicit)}let H7=(()=>{class n{constructor(e){this.userTripService=e,this.tripHeaderStats={}}ngOnInit(){var e;this.trip&&this.initTripHeaderStats(this.trip),this.tripPanel&&0===this.idx&&this.tripPanel.open(),null===(e=this.tripPanel)||void 0===e||e.afterExpand.subscribe(r=>{this.trip&&this.userTripService.activeTripSelected.emit(this.trip)})}initTripHeaderStats(e){var i;this.tripHeaderStats.title="Trip "+((null!==(i=this.idx)&&void 0!==i?i:0)+1),this.tripHeaderStats.tripChangesInfo=0===e.stats.transferNo?"direct":1===e.stats.transferNo?e.stats.transferNo+" transfer":e.stats.transferNo+" transfers",this.tripHeaderStats.tripFromTime=gl.formatTimeHHMM(e.stats.startDatetime),this.tripHeaderStats.tripToTime=gl.formatTimeHHMM(e.stats.endDatetime),this.tripHeaderStats.tripDurationS=e.stats.duration.formatDuration(),this.tripHeaderStats.tripDistanceS=gl.formatDistance(e.stats.distanceMeters)}}return n.\u0275fac=function(e){return new(e||n)(G(Ic))},n.\u0275cmp=vn({type:n,selectors:[["journey-result-row"]],viewQuery:function(e,i){if(1&e&&ur(Im,7),2&e){let r;Nn(r=Bn())&&(i.tripPanel=r.first)}},inputs:{trip:"trip",idx:"idx"},decls:15,vars:8,consts:[[3,"hideToggle"],[1,"d-flex","justify-content-between","w-100","trip-info"],[1,"trip-info-header"],[3,"leg",4,"ngFor","ngForOf"],[3,"leg"]],template:function(e,i){1&e&&(oe(0,"sbb-expansion-panel",0)(1,"sbb-expansion-panel-header")(2,"div",1)(3,"div")(4,"div",2),$e(5),de(),oe(6,"div"),$e(7),de()(),oe(8,"div",2)(9,"div"),$e(10),de(),oe(11,"div"),$e(12),de()()()(),oe(13,"div"),$t(14,U7,1,1,"result-trip-leg",3),de()()),2&e&&(Je("hideToggle",!0),Le(5),dx("",i.tripHeaderStats.title," - ",i.tripHeaderStats.tripChangesInfo,""),Le(2),dx("",i.tripHeaderStats.tripDurationS," - ",i.tripHeaderStats.tripDistanceS,""),Le(3),hi(i.tripHeaderStats.tripFromTime),Le(2),hi(i.tripHeaderStats.tripToTime),Le(2),Je("ngForOf",null==i.trip?null:i.trip.legs))},dependencies:[Sc,Im,_S,j7],styles:[".trip-info[_ngcontent-%COMP%]{font-size:14px}.trip-info-header[_ngcontent-%COMP%]{font-size:16px}"]}),n})();function $7(n,t){if(1&n&&ln(0,"journey-result-row",1),2&n){const i=t.index;Je("trip",t.$implicit)("idx",i)}}let dF=(()=>{class n{constructor(e){this.userTripService=e,this.trips=[]}ngOnInit(){this.userTripService.tripsUpdated.subscribe(e=>{this.trips=e}),this.userTripService.searchParamsReset.subscribe(()=>{this.trips=[]})}}return n.\u0275fac=function(e){return new(e||n)(G(Ic))},n.\u0275cmp=vn({type:n,selectors:[["journey-results"]],decls:2,vars:1,consts:[[3,"trip","idx",4,"ngFor","ngForOf"],[3,"trip","idx"]],template:function(e,i){1&e&&(oe(0,"sbb-accordion"),$t(1,$7,1,2,"journey-result-row",0),de()),2&e&&(Le(1),Je("ngForOf",i.trips))},dependencies:[Sc,$D,H7],encapsulation:2}),n})();class km{static formatMapboxLngLatAsLatLng(t){return t.lat.toFixed(6)+","+t.lng.toFixed(6)}static computePointLngLatFromFeature(t){if("Point"!==t.geometry.type)return null;const e=t.geometry.coordinates;return Ms().LngLat.convert(e)}static bboxPxFromLngLatWidthPx(t,e,i,r=null){null===r&&(r=i);const s=t.project(e);return[[s.x-i/2,s.y+r/2],[s.x+i/2,s.y-r/2]]}static areBoundsInsideOtherBounds(t,e){return!(t.getWest()<e.getWest()||t.getNorth()>e.getNorth()||t.getEast()>e.getEast()||t.getSouth()<e.getSouth())}static queryNearbyFeaturesByLayerIDs(t,e,i){const r=km.bboxPxFromLngLatWidthPx(t,e,30),s=t.queryRenderedFeatures(r,{layers:i});let d=[],m=null;return s.forEach(y=>{const C=km.computePointLngLatFromFeature(y);if(null===C)return;const M=Math.round(e.distanceTo(C));null!==m&&M>m||(m=M,d.push({feature:y,distance:M}))}),d.sort((y,C)=>y.distance-C.distance),d}}class hF{constructor(t){this.map=t,this.container=null,this.debugCenterEl=null,this.debugZoomEl=null}onAdd(t){return this.map=t,this.container=document.createElement("div"),this.container.className="mapboxgl-ctrl mapboxgl-ctrl-group map-control",this.container.innerHTML=document.getElementById("map-debug-control").innerHTML,t.on("move",()=>{this.updateDebugCenter()}),t.on("zoom",()=>{this.updateDebugZoom()}),setTimeout(()=>{this.debugCenterEl=document.getElementById("map_debug_center"),this.debugZoomEl=document.getElementById("map_debug_zoom"),this.updateDebugZoom(),this.updateDebugCenter()},200),this.container}onRemove(){this.map=null,this.container=null}updateDebugZoom(){!this.map||!this.debugZoomEl||(this.debugZoomEl.innerText=this.map.getZoom().toFixed(2).toString())}updateDebugCenter(){if(!this.map||!this.debugCenterEl)return;const t=this.map.getCenter().toArray().map(e=>e.toFixed(6));this.debugCenterEl.innerText=t.join(",")}}class pF{static prettyPrintXML(t){var e=(new DOMParser).parseFromString(t,"application/xml"),i=(new DOMParser).parseFromString(['<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform">','  <xsl:strip-space elements="*"/>','  <xsl:template match="para[content-style][not(text())]">','    <xsl:value-of select="normalize-space(.)"/>',"  </xsl:template>",'  <xsl:template match="node()|@*">','    <xsl:copy><xsl:apply-templates select="node()|@*"/></xsl:copy>',"  </xsl:template>",'  <xsl:output indent="yes"/>',"</xsl:stylesheet>"].join("\n"),"application/xml");try{var r=new XSLTProcessor;r.importStylesheet(i);var s=r.transformToDocument(e);return(new XMLSerializer).serializeToString(s)}catch(m){return console.error("XML_Helpers.prettyPrintXML - fails, see TODO"),t}}}function G7(n,t){}function q7(n,t){}function W7(n,t){1&n&&(oe(0,"button",1),ln(1,"sbb-icon",2),de()),2&n&&Je("aria-label",Yt().closeAriaLabel)}const X7=["*"];class yS{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.ariaModal=!0,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.closeOnNavigation=!0,this.closeOnDestroy=!0}}let fF=(()=>{class n extends Sv{constructor(e,i,r,s,d,m,y,C){super(),this._elementRef=e,this._focusTrapFactory=i,this._config=s,this._interactivityChecker=d,this._ngZone=m,this._overlayRef=y,this._focusMonitor=C,this._elementFocusedBeforeDialogWasOpened=null,this._closeInteractionType=null,this.attachDomPortal=M=>{this._portalOutlet.hasAttached();const k=this._portalOutlet.attachDomPortal(M);return this._contentAttached(),k},this._ariaLabelledBy=this._config.ariaLabelledBy||null,this._document=r}_contentAttached(){this._initializeFocusTrap(),this._handleBackdropClicks(),this._captureInitialFocus()}_captureInitialFocus(){this._trapFocus()}ngOnDestroy(){this._restoreFocus()}attachComponentPortal(e){this._portalOutlet.hasAttached();const i=this._portalOutlet.attachComponentPortal(e);return this._contentAttached(),i}attachTemplatePortal(e){this._portalOutlet.hasAttached();const i=this._portalOutlet.attachTemplatePortal(e);return this._contentAttached(),i}_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(e,i){this._interactivityChecker.isFocusable(e)||(e.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{const r=()=>{e.removeEventListener("blur",r),e.removeEventListener("mousedown",r),e.removeAttribute("tabindex")};e.addEventListener("blur",r),e.addEventListener("mousedown",r)})),e.focus(i)}_focusByCssSelector(e,i){let r=this._elementRef.nativeElement.querySelector(e);r&&this._forceFocus(r,i)}_trapFocus(){const e=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||e.focus();break;case!0:case"first-tabbable":this._focusTrap.focusInitialElementWhenReady().then(i=>{i||this._focusDialogContainer()});break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this._config.autoFocus)}}_restoreFocus(){const e=this._config.restoreFocus;let i=null;if("string"==typeof e?i=this._document.querySelector(e):"boolean"==typeof e?i=e?this._elementFocusedBeforeDialogWasOpened:null:e&&(i=e),this._config.restoreFocus&&i&&"function"==typeof i.focus){const r=su(),s=this._elementRef.nativeElement;(!r||r===this._document.body||r===s||s.contains(r))&&(this._focusMonitor?(this._focusMonitor.focusVia(i,this._closeInteractionType),this._closeInteractionType=null):i.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){const e=this._elementRef.nativeElement,i=su();return e===i||e.contains(i)}_initializeFocusTrap(){this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=su())}_handleBackdropClicks(){this._overlayRef.backdropClick().subscribe(()=>{this._config.disableClose&&this._recaptureFocus()})}}return n.\u0275fac=function(e){return new(e||n)(G(Tn),G(Ub),G($n,8),G(yS),G(wm),G(qn),G(Up),G(fa))},n.\u0275cmp=vn({type:n,selectors:[["cdk-dialog-container"]],viewQuery:function(e,i){if(1&e&&ur(sd,7),2&e){let r;Nn(r=Bn())&&(i._portalOutlet=r.first)}},hostAttrs:["tabindex","-1",1,"cdk-dialog-container"],hostVars:6,hostBindings:function(e,i){2&e&&fn("id",i._config.id||null)("role",i._config.role)("aria-modal",i._config.ariaModal)("aria-labelledby",i._config.ariaLabel?null:i._ariaLabelledBy)("aria-label",i._config.ariaLabel)("aria-describedby",i._config.ariaDescribedBy||null)},features:[qt],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(e,i){1&e&&$t(0,G7,0,0,"ng-template",0)},dependencies:[sd],styles:[".cdk-dialog-container{display:block;width:100%;height:100%;min-height:inherit;max-height:inherit}"],encapsulation:2}),n})();class WD{constructor(t,e){this.overlayRef=t,this.config=e,this.closed=new Zt,this.disableClose=e.disableClose,this.backdropClick=t.backdropClick(),this.keydownEvents=t.keydownEvents(),this.outsidePointerEvents=t.outsidePointerEvents(),this.id=e.id,this.keydownEvents.subscribe(i=>{27===i.keyCode&&!this.disableClose&&!ra(i)&&(i.preventDefault(),this.close(void 0,{focusOrigin:"keyboard"}))}),this.backdropClick.subscribe(()=>{this.disableClose||this.close(void 0,{focusOrigin:"mouse"})})}close(t,e){if(this.containerInstance){const i=this.closed;this.containerInstance._closeInteractionType=(null==e?void 0:e.focusOrigin)||"program",this.overlayRef.dispose(),i.next(t),i.complete(),this.componentInstance=this.containerInstance=null}}updatePosition(){return this.overlayRef.updatePosition(),this}updateSize(t="",e=""){return this.overlayRef.updateSize({width:t,height:e}),this}addPanelClass(t){return this.overlayRef.addPanelClass(t),this}removePanelClass(t){return this.overlayRef.removePanelClass(t),this}}const mF=new Et("DialogScrollStrategy"),Z7=new Et("DialogData"),Y7=new Et("DefaultDialogConfig"),Q7={provide:mF,deps:[Bo],useFactory:function K7(n){return()=>n.scrollStrategies.block()}};let J7=0,gF=(()=>{class n{constructor(e,i,r,s,d,m){this._overlay=e,this._injector=i,this._defaultOptions=r,this._parentDialog=s,this._overlayContainer=d,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new Zt,this._afterOpenedAtThisLevel=new Zt,this._ariaHiddenElements=new Map,this.afterAllClosed=hm(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(Ds(void 0))),this._scrollStrategy=m}get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}open(e,i){const r=this._defaultOptions||new yS;(i=Object.assign(Object.assign({},r),i)).id=i.id||"cdk-dialog-"+J7++,i.id&&this.getDialogById(i.id);const s=this._getOverlayConfig(i),d=this._overlay.create(s),m=new WD(d,i),y=this._attachContainer(d,m,i);return m.containerInstance=y,this._attachDialogContent(e,m,y,i),this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(m),m.closed.subscribe(()=>this._removeOpenDialog(m,!0)),this.afterOpened.next(m),m}closeAll(){XD(this.openDialogs,e=>e.close())}getDialogById(e){return this.openDialogs.find(i=>i.id===e)}ngOnDestroy(){XD(this._openDialogsAtThisLevel,e=>{!1===e.config.closeOnDestroy&&this._removeOpenDialog(e,!1)}),XD(this._openDialogsAtThisLevel,e=>e.close()),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete(),this._openDialogsAtThisLevel=[]}_getOverlayConfig(e){const i=new Mm({positionStrategy:e.positionStrategy||this._overlay.position().global().centerHorizontally().centerVertically(),scrollStrategy:e.scrollStrategy||this._scrollStrategy(),panelClass:e.panelClass,hasBackdrop:e.hasBackdrop,direction:e.direction,minWidth:e.minWidth,minHeight:e.minHeight,maxWidth:e.maxWidth,maxHeight:e.maxHeight,width:e.width,height:e.height,disposeOnNavigation:e.closeOnNavigation});return e.backdropClass&&(i.backdropClass=e.backdropClass),i}_attachContainer(e,i,r){var s;const d=r.injector||(null===(s=r.viewContainerRef)||void 0===s?void 0:s.injector),m=[{provide:yS,useValue:r},{provide:WD,useValue:i},{provide:Up,useValue:e}];let y;r.container?"function"==typeof r.container?y=r.container:(y=r.container.type,m.push(...r.container.providers(r))):y=fF;const C=new od(y,r.viewContainerRef,Nr.create({parent:d||this._injector,providers:m}),r.componentFactoryResolver);return e.attach(C).instance}_attachDialogContent(e,i,r,s){if(e instanceof Qr){const d=this._createInjector(s,i,r,void 0);let m={$implicit:s.data,dialogRef:i};s.templateContext&&(m=Object.assign(Object.assign({},m),"function"==typeof s.templateContext?s.templateContext():s.templateContext)),r.attachTemplatePortal(new Cm(e,null,m,d))}else{const d=this._createInjector(s,i,r,this._injector),m=r.attachComponentPortal(new od(e,s.viewContainerRef,d,s.componentFactoryResolver));i.componentInstance=m.instance}}_createInjector(e,i,r,s){var d;const m=e.injector||(null===(d=e.viewContainerRef)||void 0===d?void 0:d.injector),y=[{provide:Z7,useValue:e.data},{provide:WD,useValue:i}];return e.providers&&("function"==typeof e.providers?y.push(...e.providers(i,e,r)):y.push(...e.providers)),e.direction&&(!m||!m.get(Lp,null,Un.Optional))&&y.push({provide:Lp,useValue:{value:e.direction,change:Rn()}}),Nr.create({parent:m||s,providers:y})}_removeOpenDialog(e,i){const r=this.openDialogs.indexOf(e);r>-1&&(this.openDialogs.splice(r,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((s,d)=>{s?d.setAttribute("aria-hidden",s):d.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),i&&this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){const e=this._overlayContainer.getContainerElement();if(e.parentElement){const i=e.parentElement.children;for(let r=i.length-1;r>-1;r--){const s=i[r];s!==e&&"SCRIPT"!==s.nodeName&&"STYLE"!==s.nodeName&&!s.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(s,s.getAttribute("aria-hidden")),s.setAttribute("aria-hidden","true"))}}}_getAfterAllClosed(){const e=this._parentDialog;return e?e._getAfterAllClosed():this._afterAllClosedAtThisLevel}}return n.\u0275fac=function(e){return new(e||n)(ze(Bo),ze(Nr),ze(Y7,8),ze(n,12),ze(qb),ze(mF))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})();function XD(n,t){let e=n.length;for(;e--;)t(n[e])}let e9=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({providers:[gF,Q7],imports:[bl,oa,Sm,oa]}),n})();const Wb={params:{enterAnimationDuration:"150ms",exitAnimationDuration:"75ms"}},t9={dialogContainer:Es("dialogContainer",[dr("void, exit",Ln({opacity:0,transform:"scale(0.7)"})),dr("enter",Ln({transform:"none"})),qi("* => enter",TR([Qi("{{enterAnimationDuration}} cubic-bezier(0, 0, 0.2, 1)",Ln({transform:"none",opacity:1})),gT("@*",mT(),{optional:!0})]),Wb),qi("* => void, * => exit",TR([Qi("{{exitAnimationDuration}} cubic-bezier(0.4, 0.0, 0.2, 1)",Ln({opacity:0})),gT("@*",mT(),{optional:!0})]),Wb)])};class kv{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.maxWidth="80vw",this.maxHeight="96vh",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.autoFocus=!0,this.restoreFocus=!0,this.delayFocusTrap=!1,this.closeOnNavigation=!0,this.enterAnimationDuration=Wb.params.enterAnimationDuration,this.exitAnimationDuration=Wb.params.exitAnimationDuration}}let bF=(()=>{class n extends fF{constructor(e,i,r,s,d,m,y,C){super(e,i,r,s,d,m,y,C),this._animationStateChanged=new nn,this._state="enter"}_captureInitialFocus(){this._config.delayFocusTrap||this._trapFocus()}_getAnimationState(){return{value:this._state,params:{enterAnimationDuration:this._config.enterAnimationDuration||Wb.params.enterAnimationDuration,exitAnimationDuration:this._config.exitAnimationDuration||Wb.params.exitAnimationDuration}}}_openAnimationDone(e){this._config.delayFocusTrap&&this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:e})}}return n.\u0275fac=function(e){return new(e||n)(G(Tn),G(Ub),G($n,8),G(kv),G(wm),G(qn),G(Up),G(fa))},n.\u0275cmp=vn({type:n,selectors:[["ng-component"]],features:[qt],decls:0,vars:0,template:function(e,i){},encapsulation:2}),n})(),n9=(()=>{class n extends bF{constructor(e,i,r,s,d,m,y,C,M){super(e,i,r,s,d,m,y,M),this._changeDetectorRef=C}_onAnimationDone({toState:e,totalTime:i}){"enter"===e?this._openAnimationDone(i):"exit"===e&&this._animationStateChanged.next({state:"closed",totalTime:i})}_onAnimationStart({toState:e,totalTime:i}){"enter"===e?this._animationStateChanged.next({state:"opening",totalTime:i}):("exit"===e||"void"===e)&&this._animationStateChanged.next({state:"closing",totalTime:i})}_startExitAnimation(){this._state="exit",this._changeDetectorRef.markForCheck()}}return n.\u0275fac=function(e){return new(e||n)(G(Tn),G(Ub),G($n,8),G(kv),G(wm),G(qn),G(Up),G(Sr),G(fa))},n.\u0275cmp=vn({type:n,selectors:[["sbb-dialog-container"]],hostAttrs:["tabindex","-1","aria-modal","true",1,"sbb-dialog-container"],hostVars:6,hostBindings:function(e,i){1&e&&Iy("@dialogContainer.done",function(s){return i._onAnimationDone(s)})("@dialogContainer.start",function(s){return i._onAnimationStart(s)}),2&e&&(vc("id",i._config.id),fn("role",i._config.role)("aria-labelledby",i._config.ariaLabel?null:i._ariaLabelledBy)("aria-label",i._config.ariaLabel)("aria-describedby",i._config.ariaDescribedBy||null),Ay("@dialogContainer",i._getAnimationState()))},features:[qt],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(e,i){1&e&&$t(0,q7,0,0,"ng-template",0)},dependencies:[sd],styles:[".sbb-overlay-background{background-color:var(--sbb-color-white-alpha70);align-items:center}.sbb-dialog-container{display:flex;flex-direction:column;border:var(--sbb-border-width) solid var(--sbb-color-weak-accent);box-sizing:border-box;overflow:hidden;outline:0;background-color:var(--sbb-color-background);box-shadow:var(--sbb-box-shadow-below);width:100%;height:100%;min-height:inherit;max-height:inherit}.cdk-high-contrast-active .sbb-dialog-container{outline:solid .0666666667rem}.sbb-dialog-container>*:only-child:not(.sbb-dialog-content){width:100%;height:100%;display:flex;flex-direction:column}.sbb-dialog-content{display:block;padding:var(--sbb-dialog-padding);flex:1 1 auto;max-height:80vh;overflow:auto;-webkit-overflow-scrolling:touch}.sbb-dialog-content>*:first-child{margin-top:0}.sbb-dialog-title{font-size:var(--sbb-font-size);padding:calc(1rem * var(--sbb-scaling-factor)) calc(2.6666666667rem * var(--sbb-scaling-factor)) calc(1rem * var(--sbb-scaling-factor)) var(--sbb-dialog-padding);flex:0 0 auto;display:block;position:relative;box-shadow:var(--sbb-box-shadow-horizontal-border-top);overflow:hidden;white-space:nowrap;text-overflow:ellipsis;min-height:calc(3.5333333333rem * var(--sbb-scaling-factor))}.sbb-dialog-title-close-button{position:absolute;right:calc(1.0666666667rem * var(--sbb-scaling-factor));cursor:pointer;line-height:0}.sbb-dialog-title-close-button:is(:hover,:focus){color:var(--sbb-color-call-to-action-hover)}.sbb-dialog-actions{padding:calc(0.4666666667rem * var(--sbb-scaling-factor)) calc(1.0666666667rem * var(--sbb-scaling-factor));display:flex;flex:0 0 auto;flex-wrap:wrap;gap:var(--sbb-button-gap);align-items:center;box-sizing:content-box;box-shadow:var(--sbb-box-shadow-horizontal-border-bottom)}.sbb-dialog-actions.sbb-dialog-actions-align-start,.sbb-dialog-actions[align=start],.sbb-dialog-actions[align=left]{justify-content:flex-start}.sbb-dialog-actions.sbb-dialog-actions-align-center,.sbb-dialog-actions[align=center]{justify-content:center}.sbb-dialog-actions.sbb-dialog-actions-align-end,.sbb-dialog-actions[align=end]{justify-content:flex-end}"],encapsulation:2,data:{animation:[t9.dialogContainer]}}),n})();class vS{constructor(t,e,i){this.ref=t,this._containerInstance=i,this._afterOpened=new Zt,this._beforeClosed=new Zt,this._state=0,this.disableClose=e.disableClose,this.id=t.id,i._animationStateChanged.pipe(Cr(r=>"opened"===r.state),Vr(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),i._animationStateChanged.pipe(Cr(r=>"closed"===r.state),Vr(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._finishDialogClose()}),t.overlayRef.detachments().subscribe(()=>{this._beforeClosed.next(this._result),this._beforeClosed.complete(),this._finishDialogClose()}),Er(this.backdropClick(),this.keydownEvents().pipe(Cr(r=>27===r.keyCode&&!this.disableClose&&!ra(r)))).subscribe(r=>{this.disableClose||(r.preventDefault(),_F(this,"keydown"===r.type?"keyboard":"mouse"))})}close(t){this._result=t,this._containerInstance._animationStateChanged.pipe(Cr(e=>"closing"===e.state),Vr(1)).subscribe(e=>{this._beforeClosed.next(t),this._beforeClosed.complete(),this.ref.overlayRef.detachBackdrop(),this._closeFallbackTimeout=setTimeout(()=>this._finishDialogClose(),e.totalTime+100)}),this._state=1,this._containerInstance._startExitAnimation()}afterOpened(){return this._afterOpened}afterClosed(){return this.ref.closed}beforeClosed(){return this._beforeClosed}backdropClick(){return this.ref.backdropClick}keydownEvents(){return this.ref.keydownEvents}updatePosition(t){const e=this.ref.config.positionStrategy;return t&&(t.left||t.right)?t.left?e.left(t.left):e.right(t.right):e.centerHorizontally(),t&&(t.top||t.bottom)?t.top?e.top(t.top):e.bottom(t.bottom):e.centerVertically(),this.ref.updatePosition(),this}updateSize(t="",e=""){return this.ref.updateSize(t,e),this}addPanelClass(t){return this.ref.addPanelClass(t),this}removePanelClass(t){return this.ref.removePanelClass(t),this}getState(){return this._state}_finishDialogClose(){this._state=2,this.ref.close(this._result,{focusOrigin:this._closeInteractionType}),this.componentInstance=null}}function _F(n,t,e){return n._closeInteractionType=t,n.close(e)}const i9=new Et("SbbDialogData"),r9=new Et("sbb-dialog-default-options"),yF=new Et("sbb-dialog-scroll-strategy"),s9={provide:yF,deps:[Bo],useFactory:function o9(n){return()=>n.scrollStrategies.block()}};let a9=0,vF=(()=>{class n{constructor(e,i,r,s,d,m,y,C,M){this._overlay=e,this._defaultOptions=r,this._parentDialog=s,this._dialogRefConstructor=y,this._dialogContainerType=C,this._dialogDataToken=M,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new Zt,this._afterOpenedAtThisLevel=new Zt,this._idPrefix="sbb-dialog-",this.afterAllClosed=hm(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(Ds(void 0))),this._scrollStrategy=m,this._dialog=i.get(gF)}get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}_getAfterAllClosed(){const e=this._parentDialog;return e?e._getAfterAllClosed():this._afterAllClosedAtThisLevel}open(e,i){let r;(i=Object.assign(Object.assign({},this._defaultOptions||new kv),i)).id=i.id||`${this._idPrefix}${a9++}`,i.scrollStrategy=i.scrollStrategy||this._scrollStrategy(),i.backdropClass=i.backdropClass||"sbb-overlay-background";const s=this._dialog.open(e,Object.assign(Object.assign({},i),{positionStrategy:this._overlay.position().global().centerHorizontally().centerVertically(),disableClose:!0,closeOnDestroy:!1,container:{type:this._dialogContainerType,providers:()=>[{provide:kv,useValue:i},{provide:yS,useValue:i}]},templateContext:()=>({dialogRef:r,lightboxRef:r}),providers:(d,m,y)=>(r=new this._dialogRefConstructor(d,i,y),r.updatePosition(null==i?void 0:i.position),[{provide:this._dialogContainerType,useValue:y},{provide:this._dialogDataToken,useValue:m.data},{provide:this._dialogRefConstructor,useValue:r}])}));return r.componentInstance=s.componentInstance,this.openDialogs.push(r),this.afterOpened.next(r),r.afterClosed().subscribe(()=>{const d=this.openDialogs.indexOf(r);d>-1&&(this.openDialogs.splice(d,1),this.openDialogs.length||this._getAfterAllClosed().next())}),r}closeAll(){this._closeDialogs(this.openDialogs)}getDialogById(e){return this.openDialogs.find(i=>i.id===e)}ngOnDestroy(){this._closeDialogs(this._openDialogsAtThisLevel),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete()}_closeDialogs(e){let i=e.length;for(;i--;)e[i].close()}}return n.\u0275fac=function(e){Qc()},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})(),uu=(()=>{class n extends vF{constructor(e,i,r,s,d,m){super(e,i,r,d,m,s,vS,n9,i9)}}return n.\u0275fac=function(e){return new(e||n)(ze(Bo),ze(Nr),ze(r9,8),ze(yF),ze(n,12),ze(qb))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})(),l9=0,Xb=(()=>{class n{constructor(e,i,r){this._dialogRef=e,this._elementRef=i,this._dialog=r,this.ariaLabel=$localize`:Aria label to close a dialog@@sbbDialogCloseDialog:Close dialog`,this.type="button",this._canCloseInterceptor=()=>!0}ngOnInit(){this._dialogRef||(this._dialogRef=xF(this._elementRef,this._dialog.openDialogs))}ngOnChanges(e){const i=e._sbbDialogClose||e._sbbDialogCloseResult;i&&(this.dialogResult=i.currentValue)}_onButtonClick(e){!this._canCloseInterceptor()||_F(this._dialogRef,0===e.screenX&&0===e.screenY?"keyboard":"mouse",this.dialogResult)}}return n.\u0275fac=function(e){return new(e||n)(G(vS,8),G(Tn),G(uu))},n.\u0275dir=Lt({type:n,selectors:[["","sbb-dialog-close",""],["","sbbDialogClose",""]],hostVars:2,hostBindings:function(e,i){1&e&&Qt("click",function(s){return i._onButtonClick(s)}),2&e&&fn("aria-label",i.ariaLabel||null)("type",i.type)},inputs:{ariaLabel:["aria-label","ariaLabel"],type:"type",dialogResult:["sbb-dialog-close","dialogResult"],_sbbDialogClose:["sbbDialogClose","_sbbDialogClose"]},exportAs:["sbbDialogClose"],features:[cr]}),n})(),c9=(()=>{class n{constructor(e,i,r,s){this._dialogRef=e,this._elementRef=i,this._dialog=r,this._changeDetectorRef=s,this.id="sbb-dialog-title-"+l9++,this.closeAriaLabel=$localize`:Aria label to close a dialog@@sbbDialogCloseDialog:Close dialog`,this._closeEnabled=!0}ngOnInit(){this._dialogRef||(this._dialogRef=xF(this._elementRef,this._dialog.openDialogs)),this._dialogRef&&Promise.resolve().then(()=>{const e=this._dialogRef._containerInstance;!e||(e._config.disableClose&&(this._closeEnabled=!1,this._changeDetectorRef.markForCheck()),e._ariaLabelledBy||(e._ariaLabelledBy=this.id))})}}return n.\u0275fac=function(e){return new(e||n)(G(vS,8),G(Tn),G(uu),G(Sr))},n.\u0275dir=Lt({type:n,inputs:{id:"id",closeAriaLabel:"closeAriaLabel"}}),n})(),Rv=(()=>{class n extends c9{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Vi(n)))(i||n)}}(),n.\u0275cmp=vn({type:n,selectors:[["sbb-dialog-title"],["","sbb-dialog-title",""],["","sbbDialogTitle",""]],hostAttrs:[1,"sbb-dialog-title"],hostVars:1,hostBindings:function(e,i){2&e&&vc("id",i.id)},exportAs:["sbbDialogTitle"],features:[qt],ngContentSelectors:X7,decls:2,vars:1,consts:[["sbb-dialog-close","","class","sbb-dialog-title-close-button sbb-button-reset-frameless",3,"aria-label",4,"ngIf"],["sbb-dialog-close","",1,"sbb-dialog-title-close-button","sbb-button-reset-frameless",3,"aria-label"],["svgIcon","kom:cross-small"]],template:function(e,i){1&e&&(Mo(),Pr(0),$t(1,W7,2,1,"button",0)),2&e&&(Le(1),Je("ngIf",i._closeEnabled))},dependencies:[Ts,qa,Xb],encapsulation:2,changeDetection:0}),n})(),Pv=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=Lt({type:n,selectors:[["","sbb-dialog-content",""],["sbb-dialog-content"],["","sbbDialogContent",""]],hostAttrs:[1,"sbb-dialog-content","sbb-scrollbar"]}),n})(),Lv=(()=>{class n{constructor(){this.align="end"}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=Lt({type:n,selectors:[["","sbb-dialog-actions",""],["sbb-dialog-actions"],["","sbbDialogActions",""]],hostAttrs:[1,"sbb-dialog-actions"],hostVars:6,hostBindings:function(e,i){2&e&&Ri("sbb-dialog-actions-align-start","start"===i.align)("sbb-dialog-actions-align-center","center"===i.align)("sbb-dialog-actions-align-end","end"===i.align)},inputs:{align:"align"}}),n})();function xF(n,t){let e=n.nativeElement.parentElement;for(;e&&!e.classList.contains("sbb-dialog-container")&&!e.classList.contains("sbb-lightbox-container");)e=e.parentElement;return e?t.find(i=>i.id===e.id):null}let ZD=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({providers:[uu,s9],imports:[gr,e9,bl,oa,Wi,mo]}),n})(),YD=(()=>{class n{constructor(){this.requestXmlS="loading...",this.responseXmlS="loading..."}updateRequestData(e){this.requestXmlS=e.requestXML?pF.prettyPrintXML(e.requestXML):"n/a",this.responseXmlS=e.responseXML?pF.prettyPrintXML(e.responseXML):"n/a"}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=vn({type:n,selectors:[["debug-xml-popover"]],decls:15,vars:2,consts:[["sbbDialogTitle",""],["sbbDialogContent",""],[2,"width","500px"],["rows","7",1,"w-100"],["sbbDialogActions",""],["type","button","sbbDialogClose","",1,"btn","btn-secondary"]],template:function(e,i){1&e&&(oe(0,"div",0),$e(1,"Debug XML"),de(),oe(2,"div",1)(3,"div",2)(4,"div"),$e(5," Request XML "),oe(6,"textarea",3),$e(7),de()(),oe(8,"div"),$e(9," Response XML "),oe(10,"textarea",3),$e(11),de()()()(),oe(12,"div",4)(13,"button",5),$e(14," Close "),de()()),2&e&&(Le(7),hi(i.requestXmlS),Le(4),hi(i.responseXmlS))},dependencies:[Xb,Rv,Pv,Lv],encapsulation:2}),n})();const u9=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"circle","minzoom":0,"paint":{"circle-color":"#0000FF","circle-radius":4,"circle-stroke-width":1,"circle-stroke-color":"#fff"}}'),d9=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":14.5,"layout":{"text-field":"{stopPlace.stopPlaceName} \\n {stopPlace.stopPlaceRefLabel}","text-size":12,"text-justify":"left","text-anchor":"top-left","text-offset":[0.2,0.2]},"paint":{"text-halo-color":"rgba(241, 231, 231, 1)","text-halo-width":1}}'),h9=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"circle","minzoom":0,"paint":{"circle-color":"#eb0000","circle-radius":4,"circle-stroke-width":1,"circle-stroke-color":"#fff"}}'),p9=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":0,"layout":{"icon-image":"poi-charging-station","icon-allow-overlap":true,"icon-size":0.5}}'),f9=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":0,"layout":{"icon-image":"car-15","icon-allow-overlap":true,"icon-size":1.4}}'),m9=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":0,"layout":{"icon-image":"bicycle-15","icon-allow-overlap":true,"icon-size":1.4}}'),g9=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":0,"layout":{"icon-image":"poi-scooter","icon-allow-overlap":true,"icon-size":0.4}}'),xS=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","layout":{"text-field":"{sharedVehicle.itemsNo}","text-allow-overlap":true,"text-size":12,"text-offset":[0.7,-1.2]},"paint":{"text-halo-color":"rgba(241, 231, 231, 1)","text-color":["case",["==",["get","sharedVehicle.itemsNo"],0],"red","#006400"],"text-halo-width":1}}'),wS=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":15,"layout":{"text-field":"{sharedVehicle.provider}","text-allow-overlap":true,"text-size":12,"text-offset":[0,1.2]},"paint":{"text-halo-color":"rgba(241, 231, 231, 1)","text-halo-width":1}}'),wF={"stops-circle":u9,"stops-label":d9,"address-circle":h9,"charging-station-icon":p9,"charging-station-text-number":xS,"charging-station-text-provider":wS,"car-rental-icon":f9,"car-rental-text-number":xS,"car-rental-text-provider":wS,"bike-icon":m9,"bike-text-number":xS,"bike-text-provider":wS,"scooter-icon":g9,"scooter-text-number":xS,"scooter-text-provider":wS,"poi-all":JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":0,"layout":{"icon-image":["get","style.icon-image"],"icon-allow-overlap":true,"icon-size":0.4}}')};class Ov{constructor(t,e,i,r){this.layerKey=t,this.map=e,this.geoRestrictionType=i.LIR_Restriction_Type,this.geoRestrictionPoiOSMTags=i.LIR_POI_Type?Array.isArray(i.LIR_POI_Type)?i.LIR_POI_Type:[i.LIR_POI_Type]:null,this.minZoom=i.minZoom,this.features=[],this.mapSourceID=t+"-map-src",this.userTripService=r,this.isEnabled=!1,this.lastOJPRequest=null,this.addMapSourceAndLayers(),this.currentLocations=[]}addMapSourceAndLayers(){var t;this.map.addSource(this.mapSourceID,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this.layerKey in Np.map_app_map_layers?(null!==(t=Np.map_app_map_layers[this.layerKey].layer_ids)&&void 0!==t?t:[this.layerKey]).forEach(r=>{if(!(r in wF))return void console.error("ERROR - AppMapLayer.addMapSourceAndLayers no layer def for "+r);const d=JSON.parse(JSON.stringify(wF[r]));d.id=r,d.source=this.mapSourceID,this.map.addLayer(d)}):console.error("ERROR - AppMapLayer.addMapSourceAndLayers no layers defined for "+this.layerKey)}shouldLoadNewFeatures(){return!(!this.isEnabled||this.map.getZoom()<this.minZoom)}refreshFeatures(){return Ke(this,void 0,void 0,function*(){if(!this.shouldLoadNewFeatures())return void this.removeAllFeatures();const t="poi_all"===this.geoRestrictionType?1e3:300,e=this.map.getBounds(),i=$l.initWithBBOXAndType(this.userTripService.getStageConfig(),e.getWest(),e.getNorth(),e.getEast(),e.getSouth(),this.geoRestrictionType,t,this.geoRestrictionPoiOSMTags);this.lastOJPRequest=i;const r=Np.map_app_map_layers[this.layerKey],s=yield i.fetchResponse();if("ERROR"===s.message)return console.log("AppMapLayer: "+this.layerKey+" backend ERROR"),void console.log(s);const d=[],m={};s.locations.forEach((C,M)=>{var k,z,q;if(null===C.geoPosition)return;if("poi_amenity"===r.LIR_Restriction_Type&&r.LIR_POI_Type!==(null!==(z=null===(k=C.poi)||void 0===k?void 0:k.category)&&void 0!==z?z:null))return void d.push(C);const Q=C.geoPosition.asLatLngString();if(!(Q in m)){const Ze={type:"Feature",properties:{locations_idx:[]},geometry:{type:"Point",coordinates:C.geoPosition.asPosition()}};m[Q]=Ze}const xe=null!==(q=m[Q])&&void 0!==q?q:null;null!==xe&&null!==xe.properties&&xe.properties.locations_idx.push(M)}),this.currentLocations=s.locations;const y=Object.values(m);y.forEach(C=>{if(null===C.properties)return;const M=C.properties.locations_idx,k=[];M.forEach(z=>{var q;const Q=null!==(q=s.locations[z])&&void 0!==q?q:null;Q&&k.push(Q)}),C.properties.locations_idx=M.join(","),this.annotateFeatureFromLocations(C,k)}),this.setSourceFeatures(y)})}removeAllFeatures(){0!==this.features.length&&this.setSourceFeatures([])}setSourceFeatures(t){this.features=t,this.map.getSource(this.mapSourceID).setData({type:"FeatureCollection",features:t})}annotateFeatureFromLocations(t,e){}handleMapClick(t){var e,i,r;if(!this.shouldLoadNewFeatures())return!1;const s=Np.map_app_map_layers[this.layerKey];let d=null!==(e=s.click_layer_ids)&&void 0!==e?e:[];if(0===d.length)return!1;"SAME_AS_LAYER_IDS"===d&&(d=null!==(i=s.layer_ids)&&void 0!==i?i:[this.layerKey]);const m=km.queryNearbyFeaturesByLayerIDs(this.map,t.lngLat,d);if(0===m.length)return!1;const y=m[0];if(null===y.feature.properties)return!1;let C=null!==(r=y.feature.properties.locations_idx)&&void 0!==r?r:"";if(C=C.trim(),""===C)return!1;const M=[];C.split(",").forEach(q=>{var Q;const xe=parseInt(q,10),De=null!==(Q=this.currentLocations[xe])&&void 0!==Q?Q:null;De&&!(xe in M)&&(M[xe]=De)});const z=Object.values(M);return 0!==z.length&&(this.showPopup(z),!0)}showPopup(t){var e,i;const r=t[0],s=null!==(i=null===(e=r.geoPosition)||void 0===e?void 0:e.asLngLat())&&void 0!==i?i:null;if(null===s)return;const d=this.computePopupHTML(t);if(null===d)return;const m=document.createElement("div");m.innerHTML=d;const y=new(Ms().Popup)({focusAfterOpen:!1,maxWidth:"400px"});m.addEventListener("click",C=>{const k=C.target.getAttribute("data-endpoint-type");null!==k&&(this.userTripService.updateTripEndpoint(r,k,"MapPopupClick"),y.remove())}),y.setLngLat(s).setDOMContent(m).addTo(this.map)}computePopupHTML(t){var e,i,r,s;if(0===t.length)return null;const d=t[0],m=document.getElementById("map-endpoint-picker-popup");if(null===m)return null;let y=m.innerHTML;y=y.replace("[GEO_RESTRICTION_TYPE]",this.geoRestrictionType);const C=null!==(s=null!==(i=null===(e=d.geoPosition)||void 0===e?void 0:e.properties)&&void 0!==i?i:null===(r=d.asGeoJSONFeature())||void 0===r?void 0:r.properties)&&void 0!==s?s:null;if(null==C)return y=y.replace("[GEOJSON_PROPERTIES_TABLE]","ERROR: cant read GeoJSON properties"),y;const M=[];for(let z in C){let q=C[z];if("string"==typeof q){const xe=new String(q);xe.startsWith("http")&&(q='<a href="'+xe+'" target="_blank">'+xe+"</a>")}M.push("<tr><td>"+z+"</td><td>"+q+"</td></tr>")}const k='<table class="table">'+M.join("")+"</table>";return y=y.replace("[GEOJSON_PROPERTIES_TABLE]",k),y}}class _9 extends Ov{annotateFeatureFromLocations(t,e){if(null===t.properties||0===e.length)return;let i=0;e.forEach((r,s)=>{"available"===this.computeLocationStatus(r)&&(i+=1)}),t.properties["sharedVehicle.itemsNo"]=i}computeLocationStatus(t){var e;const i=null!==(e=t.attributes.locationStatus)&&void 0!==e?e:null;if(null===i)return null;const r=i.toUpperCase();return"AVAILABALE"===r?"available":"OCCUPIED"===r?"occupied":"UNKNOWN"===r?"unknown":null}computePopupHTML(t){var e;const i=document.getElementById("map-poi-picker-popup");if(null===i||0===t.length)return null;const r=t[0];if(null===r.poi||"charging_station"!==r.poi.category)return null;const s=[];s.push('<tr><td style="width:50px;">Name</td><td>'+r.poi.name+" - "+r.locationName+"</td></tr>");let d=r.poi.code;d=d.replace(r.poi.name,""),d=d.replace(null!==(e=r.locationName)&&void 0!==e?e:"n/a",""),s.push("<tr><td>Code</td><td>"+d+"</td></tr>");const m=[];t.forEach((M,k)=>{var z;if(null===M.poi)return;const q=this.computeLocationStatus(M);if(null===q)return;const Q=(()=>{let Ze="bg-success";return"occupied"===q&&(Ze="bg-danger"),"unknown"===q&&(Ze="bg-secondary"),'<span class="badge rounded-pill '+Ze+'">'+q.toUpperCase()+"</span>"})(),xe=null!==(z=M.attributes.Code)&&void 0!==z?z:null;m.push("<li>"+Q+" "+xe+"</li>")}),s.push('<tr><td colspan="2"><p>Chargers ('+t.length+")</p><ul>"+m.join("")+"</ul></td></tr>");let y=i.innerHTML;y=y.replace("[POI_NAME]","Charging Station");const C='<table class="table popup-charging-station">'+s.join("")+"</table>";return y=y.replace("[GEOJSON_PROPERTIES_TABLE]",C),y}}class y9 extends Ov{annotateFeatureFromLocations(t,e){null!==t.properties&&(0===e.length||null===e[0].poi||(t.properties["style.icon-image"]=e[0].poi.computePoiMapIcon()))}computePopupHTML(t){if(0===t.length)return null;const e=t[0];if(null===e.poi)return null;const i=document.getElementById("map-poi-picker-popup");if(null===i)return null;let r=i.innerHTML;r=r.replace("[POI_NAME]",e.poi.name);const s=[];s.push("<tr><td>Code</td><td>"+e.poi.code.substring(0,20)+"...</td></tr>"),s.push("<tr><td>Category</td><td>"+e.poi.category+"</td></tr>"),s.push("<tr><td>SubCategory</td><td>"+e.poi.subCategory+"</td></tr>");const d='<table class="table">'+s.join("")+"</table>";return r=r.replace("[GEOJSON_PROPERTIES_TABLE]",d),r}}class Fv{constructor(t,e,i,r,s){this.poiType=t,this.vehicleType=e,this.provider=i,this.code=r,this.name=s,this.hireFacility=null,this.isFixedStation=!1,this.docksNo=null,this.vehiclesNo=null,this.vehicleName=null}static initFromLocation(t){var e,i,r;if(null===t.poi)return null;const s=t.poi.category,d=(()=>{var Q;const xe=null!==(Q=t.attributes.Code)&&void 0!==Q?Q:null;return null!==xe?xe:t.poi.code})(),m=(()=>{if("bicycle_rental"===s){if("Publibike"===t.locationName)return["PubliBike","Bike"];if("Publiebike"===t.locationName)return["PubliBike","E-Bike"];if("Nextbike"===t.locationName)return["Nextbike","Bike"]}return d.startsWith("2em_cars")?["2EM Car Sharing","Car"]:d.startsWith("2em_cars_e")?["2EM Car Sharing","E-Car"]:d.startsWith("bird-")?["Bird","E-Scooter"]:d.startsWith("bolt_")?["Bolt","E-Scooter"]:d.startsWith("carvelo2go")?["Carvelo2go","E-CargoBike"]:d.startsWith("donkey_kreuzlingen")?["Regivelo.ch","Bike"]:d.startsWith("donkey_")?["Donkey Republic","Bike"]:d.startsWith("edrivecarsharing")?["E-drive Car Sharing","E-Car"]:d.startsWith("bird-platform-partner-jmfleetswl-")?["JM Fleets","E-Scooter"]:d.startsWith("liemobil_liechtenstein_ebike")?["LIEmobil","E-Bike"]:d.startsWith("lime_")?d.includes("_escooter")?["Lime","E-Scooter"]:["Lime","E-Bike"]:d.startsWith("mobility")?["Mobility","Car"]:d.startsWith("emobility")?["Mobility","E-Car"]:d.startsWith("nextbike_ch")?["Nextbike","Bike"]:d.startsWith("pickebike_")?d.includes("_emoped")?["Pick-e-Bike","E-Moped"]:["Pick-e-Bike","E-Bike"]:d.startsWith("share_birrer_ch")?["Share Birrer","E-Car"]:d.startsWith("sponticar")?["Sponti-Car","E-Car"]:d.startsWith("tier")?["TIER","E-Scooter"]:d.startsWith("tier_ebike")?["TIER","E-Bike"]:d.startsWith("voiscooters.com")?["VOI","E-Scooter"]:[null,"E-Scooter"]})(),y=m[0],C=m[1];if(null===y)return console.error("CANT DETECT provider"),console.log(t),null;const M="escooter_rental"===s?null!==(Q=t.attributes.Text)&&void 0!==Q?Q:null:"2EM Car Sharing"===y?y:"bicycle_rental"===s||"car_sharing"===s?t.poi.name:null;var Q;if(null===M)return console.error("CANT find name"),console.log(t),null;const k=new Fv(s,C,y,d,M),z=null!==(e=t.attributes.num_docks_available)&&void 0!==e?e:null;null!==z&&(k.docksNo=parseInt(z,10));const q=null!==(i=t.attributes.num_vehicles_available)&&void 0!==i?i:null;return null!==q&&(k.isFixedStation=!0,k.vehiclesNo=parseInt(q,10)),k.hireFacility=null!==(r=t.attributes.HireFacility)&&void 0!==r?r:null,"2EM Car Sharing"===y&&(k.vehicleName=t.poi.name),k}computeProviderLabel(){return"2EM Car Sharing"===this.provider?"2EM Car":"Carvelo2go"===this.provider?"Carvelo":"E-drive Car Sharing"===this.provider?"E-drive":"Donkey Republic"===this.provider?"Donkey Rep.":this.provider}}class v9 extends Ov{annotateFeatureFromLocations(t,e){if(null===t.properties||0===e.length)return;let i=null;e.forEach(s=>{const d=Fv.initFromLocation(s);null!==d&&null!==d.vehiclesNo&&(null===i&&(i=0),i+=d.vehiclesNo)}),null!==i&&(t.properties["sharedVehicle.itemsNo"]=i);const r=Fv.initFromLocation(e[0]);r&&(t.properties["sharedVehicle.provider"]=r.computeProviderLabel())}computePopupHTML(t){if(0===t.length)return null;const e=document.getElementById("map-poi-picker-popup");if(null===e)return null;let i=e.innerHTML;const r=[];if(t.forEach(M=>{const k=Fv.initFromLocation(M);k&&r.push(k)}),0===r.length){const M=t[0];i=i.replace("[POI_NAME]","GENERIC SHARED MOBILITY");const k=[];for(let q in M.attributes){let Q=M.attributes[q];if("string"==typeof Q){const De=new String(Q);De.startsWith("http")&&(Q='<a href="'+De+'" target="_blank">'+De+"</a>")}k.push("<tr><td>"+q+"</td><td>"+Q+"</td></tr>")}const z='<table class="table">'+k.join("")+"</table>";return i=i.replace("[GEOJSON_PROPERTIES_TABLE]",z),null}const s=r[0];i=i.replace("[POI_NAME]",s.provider);const m=[];if(m.push('<tr><td style="width:75px;">Name</td><td>'+s.name+"</td></tr>"),m.push("<tr><td>Code</td><td>"+s.code+"</td></tr>"),s.isFixedStation){const M=[];r.forEach(k=>{let q=k.vehiclesNo+" "+k.vehicleType+(1===k.vehiclesNo?"":"s");null!==k.vehicleName&&(q+=" - "+k.vehicleName),M.push("<li>"+q+"</li>")}),m.push('<tr><td class="align-middle">Vehicles</td><td><ul>'+M.join("")+"</ul></td></tr>")}const C='<div class="popup-shared-mobility">'+['<table class="table">'+m.join("")+"</table>"].join("")+"</div>";return i=i.replace("[GEOJSON_PROPERTIES_TABLE]",C),i}}class x9 extends Ov{annotateFeatureFromLocations(t,e){if(null===t.properties||0===e.length)return;const i=e[0];if(null===i.stopPlace)return;const r=i.stopPlace.stopPlaceRef;t.properties["stopPlace.stopPlaceRef"]=r,t.properties["stopPlace.stopPlaceName"]=i.stopPlace.stopPlaceName;let s=r.slice();s.length>32&&(s=r.substring(0,32)+"..."),t.properties["stopPlace.stopPlaceRefLabel"]=s}computePopupHTML(t){var e,i;if(0===t.length)return null;const r=document.getElementById("map-endpoint-stop-picker-popup");if(null===r)return null;const s=t[0],d=s.computeLocationName(),m=null!==(i=null===(e=s.stopPlace)||void 0===e?void 0:e.stopPlaceRef)&&void 0!==i?i:null;if(null===d||null===m)return null;let y=r.innerHTML;return y=y.replace("[STOP_NAME]",d),y=y.replace("[STOP_ID]",m),y}}class SF{static init(t,e,i,r){return"stop"===i.LIR_Restriction_Type?new x9(t,e,i,r):"poi_amenity"===i.LIR_Restriction_Type&&"charging_station"===i.LIR_POI_Type?new _9(t,e,i,r):"poi_amenity"===i.LIR_Restriction_Type?new v9(t,e,i,r):"poi_all"===i.LIR_Restriction_Type?new y9(t,e,i,r):new Ov(t,e,i,r)}}class CF{constructor(t,e,i){this.debugXmlPopover=e,this.prevMapBoundsHash="",this.map=t,this.layersData=[],this.userTripService=i}onAdd(t){this.map=t;const e=document.createElement("div");return e.className="mapboxgl-ctrl mapboxgl-ctrl-group map-control",e.innerHTML=document.getElementById("map-layers-legend-control").innerHTML,this.addLayers(e,t),this.addPOICompositeLayers(e,t),t.on("zoom",i=>{this.onZoomChanged(t)}),this.onZoomChanged(t),t.on("idle",i=>{this.handleMapIdleEvents(t)}),t.on("click",i=>{this.handleMapClickEvents(i,t)}),e}onRemove(){this.map=null}addLayers(t,e){t.querySelectorAll(".map-layer-data").forEach(i=>{var r;const s=i.getAttribute("data-map-layer-key");if(null===s)return;const d=i.querySelector(".map-layer-checkbox");if(null===d)return;const m=i.querySelector(".layer-xml-info"),y=null!==(r=Np.map_app_map_layers[s])&&void 0!==r?r:null;if(null===y)return console.error("ERROR - MapLayersLegendControl - cant find layerKey "+s+" in APP_CONFIG"),d.disabled=!0,i.insertAdjacentHTML("beforeend",'<span class="badge bg-danger text-white">ERROR</span>'),void(m&&m.classList.add("d-none"));const C=SF.init(s,e,y,this.userTripService);C.isEnabled=d.checked,m&&this.addLayerInfoClickHandler(m,C),d.addEventListener("change",k=>{C.isEnabled=d.checked,d.checked?C.refreshFeatures():C.removeAllFeatures()}),this.layersData.push({inputEls:[d],xmlInfoEl:m,layer:C})})}addLayerInfoClickHandler(t,e){t.addEventListener("click",i=>{const r=e.lastOJPRequest;if(r){const s=this.debugXmlPopover.open(YD,{position:{top:"10px"}});s.afterOpened().subscribe(()=>{s.componentInstance.updateRequestData(r.requestInfo)})}})}addPOICompositeLayers(t,e){t.querySelectorAll(".map-composite-pois").forEach(i=>{this.addPOICompositeLayer(i,e)})}addPOICompositeLayer(t,e){const i="pois-ALL",r=JSON.parse(JSON.stringify(Np.map_app_map_layers[i])),s=[],d=[];t.querySelectorAll(".map-layer-poi").forEach(M=>{const k=M,z=k.getAttribute("data-osm-tag");null!==z&&(d.push(k),k.checked&&s.push(z),k.addEventListener("change",q=>{const Q=[];d.forEach(xe=>{const De=xe.getAttribute("data-osm-tag");xe.checked&&De&&Q.push(De)}),m.geoRestrictionPoiOSMTags=Q,m.isEnabled=Q.length>0,m.refreshFeatures(),C.xmlInfoEl&&(m.isEnabled?C.xmlInfoEl.classList.remove("d-none"):C.xmlInfoEl.classList.add("d-none"))}))}),r.LIR_POI_Type=s;const m=SF.init(i,e,r,this.userTripService);m.isEnabled=s.length>0;const y=t.querySelector(".layer-xml-info");this.addLayerInfoClickHandler(y,m);const C={layer:m,inputEls:d,xmlInfoEl:y};this.layersData.push(C)}handleMapIdleEvents(t){const e=t.getBounds().toString();this.prevMapBoundsHash!==e&&(this.prevMapBoundsHash=e,this.layersData.forEach(r=>{r.layer.refreshFeatures()}))}onZoomChanged(t){this.layersData.forEach(e=>{var i;const r=e.layer.minZoom,s=t.getZoom()<r;null===(i=e.inputEls)||void 0===i||i.forEach(d=>{d.disabled=s}),e.xmlInfoEl&&(s?e.xmlInfoEl.classList.add("d-none"):e.xmlInfoEl.classList.remove("d-none"))})}handleMapClickEvents(t,e){let i=!1;this.layersData.forEach(r=>{i||r.layer.handleMapClick(t)&&(i=!0)})}}const w9=JSON.parse('{"id":"ojp-trip-leg-beeline","type":"line","source":"[SOURCE]","filter":["[CASE_FILTER_BY_DRAW_TYPE]"],"layout":{"line-join":"round","line-cap":"round","visibility":"visible"},"paint":{"line-width":4,"line-opacity":0.4,"line-color":["[CASE_COLOR_BY_LEG_TYPE]"]}}'),S9=JSON.parse('{"id":"ojp-trip-timed-leg-point-circle","type":"circle","source":"[SOURCE]","filter":["[FILTER BY DRAW_TYPE == TimedLegPoint]"],"layout":{},"paint":{"circle-radius":["IF POINT_TYPE: FROM",4,"IF POINT_TYPE: TO",8,"OTHERWISE",2],"circle-color":["IF POINT_TYPE: TO","COLOR BY TIMED_LEG","OTHERWISE","#FFF"],"circle-stroke-color":["IF POINT_TYPE: TO","#FFF","OTHERWISE","COLOR BY TIMED_LEG"],"circle-stroke-width":["IF POINT_TYPE: FROM",4,"IF POINT_TYPE: TO",1,"OTHERWISE",3]}}'),C9=JSON.parse('{"id":"ojp-trip-timed-leg-track","type":"line","source":"[SOURCE]","filter":["[FILTER BY DRAW_TYPE == TimedLegLine]"],"layout":{"line-join":"round","line-cap":"round","visibility":"visible"},"paint":{"line-width":4,"line-opacity":1,"line-color":["[CASE COLOR BY TIMED_LEG"]}}'),T9=JSON.parse('{"id":"ojp-trip-walking-leg-line","type":"line","source":"[SOURCE]","filter":["all","[FILTER BY DRAW_TYPE == ContinousLegLine]","[FILTER BY LINE_TYPE == Walk]"],"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":"#009933","line-width":4,"line-dasharray":[0.2,2]}}');class E9{constructor(t){this.mapSourceId="trip-data",this.features=[],this.map=t,this.addMapSourceAndLayers()}renderTrip(t){if(t){const e=t.computeGeoJSON();this.setSourceFeatures(e.features)}else this.removeAllFeatures()}addMapSourceAndLayers(){this.map.addSource(this.mapSourceId,{type:"geojson",data:{type:"FeatureCollection",features:[]}});const t=w9;t.filter=Dc.FilterBeelines(),t.paint&&(t.paint["line-color"]=Dc.ColorCaseByLegLineType());const e=Dc.ColorCaseByLegLineType(),i=S9;if(i.filter=Dc.FilterLegPoints(),i.paint){const m=["case",Dc.FilterByPointType("From"),4,Dc.FilterByPointType("To"),8,2];i.paint["circle-radius"]=m;const y=["case",Dc.FilterByPointType("To"),e,"#FFF"];i.paint["circle-color"]=y;const C=["case",Dc.FilterByPointType("To"),"#FFF",e];i.paint["circle-stroke-color"]=C;const M=["case",Dc.FilterByPointType("From"),4,Dc.FilterByPointType("To"),1,3];i.paint["circle-stroke-width"]=M}const r=C9;r.filter=Dc.FilterTimedLegTracks(),r.paint&&(r.paint["line-color"]=e);const s=T9;s.filter=Dc.FilterWalkingLegs(),s.paint&&(s.paint["line-color"]=Dv.ContinousLeg),[t,r,s,i].forEach(m=>{const y=m;y.source=this.mapSourceId,this.map.addLayer(y)})}removeAllFeatures(){0!==this.features.length&&this.setSourceFeatures([])}setSourceFeatures(t){this.features=t,this.map.getSource(this.mapSourceId).setData({type:"FeatureCollection",features:t})}}let D9=(()=>{class n{constructor(e,i,r){this.userTripService=e,this.mapService=i,this.debugXmlPopover=r,this.fromMarker=new(Ms().Marker),this.toMarker=new(Ms().Marker),["From","To"].forEach(d=>{var m=document.createElement("div");m.className="marker-journey-endpoint marker-journey-endpoint-"+d;const y=new(Ms().Marker)({element:m,draggable:!0,anchor:"bottom"});y.on("dragend",C=>{this.handleMarkerDrag(y,d)}),"From"===d&&(this.fromMarker=y),"To"===d&&(this.toMarker=y)}),this.viaMarkers=[],this.mapLoadingPromise=null,this.popupContextMenu=new(Ms().Popup)({focusAfterOpen:!1}),this.tripRenderController=null}ngOnInit(){this.userTripService.geoLocationsUpdated.subscribe(e=>{this.updateMarkers()}),this.userTripService.activeTripSelected.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{var s;null===(s=this.tripRenderController)||void 0===s||s.renderTrip(e)})}),this.mapService.newMapBoundsRequested.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{var s,d;const m=e.bounds,y=null!==(s=e.padding)&&void 0!==s?s:100;if(null!==(d=e.onlyIfOutside)&&void 0!==d&&d&&km.areBoundsInsideOtherBounds(m,r.getBounds()))return;const M=[m.getWest(),m.getSouth(),m.getEast(),m.getNorth()];r.fitBounds(M,{padding:y,duration:0})})}),this.mapService.newMapCenterAndZoomRequested.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{r.jumpTo({center:e.lnglat,zoom:e.zoom})})}),this.userTripService.viaAtIndexRemoved.subscribe(e=>{e>this.viaMarkers.length-1||(this.viaMarkers[e].remove(),this.viaMarkers.splice(e,1))}),this.initMap()}initMap(){const e=new(Ms().LngLatBounds)([[5.9559,45.818],[10.4921,47.8084]]),i=new(Ms().Map)({container:"map_canvas",style:"mapbox://styles/mapbox/light-v10",bounds:e,accessToken:"pk.eyJ1IjoidmFzaWxlIiwiYSI6ImNra2k2dWFkeDFrbG0ycXF0Nmg0Z2tsNXAifQ.nK-i-3cpWmji7HvK1Ilynw"});this.mapService.initialMapCenter?(i.setCenter(this.mapService.initialMapCenter),this.mapService.initialMapZoom&&i.setZoom(this.mapService.initialMapZoom)):i.fitBounds(e,{padding:50,duration:0}),this.mapLoadingPromise=new Promise((r,s)=>{i.on("load",d=>{r(i),this.onMapLoad(i)})})}updateMarkers(){["From","To"].forEach(s=>{var d;const m="From"===s,y=m?this.userTripService.fromTripLocation:this.userTripService.toTripLocation;this.updateMarkerLocation(m?this.fromMarker:this.toMarker,null!==(d=null==y?void 0:y.location)&&void 0!==d?d:null)});const i=this.viaMarkers.length,r=this.userTripService.viaTripLocations.length;if(i>r){let s=this.viaMarkers;r>0&&(s=this.viaMarkers.splice(r,i-r)),s.forEach(d=>{d.remove()})}this.userTripService.viaTripLocations.forEach((s,d)=>{var m;let y=null!==(m=this.viaMarkers[d])&&void 0!==m?m:null;null===y&&(y=this.createViaMarker(s.location),this.viaMarkers.push(y)),this.updateMarkerLocation(y,s.location)})}handleMarkerDrag(e,i){const r=e.getLngLat();let s=ao.initWithLngLat(r.lng,r.lat);this.userTripService.updateTripEndpoint(s,i,"MapDragend")}onMapLoad(e){this.addMapControls(e),e.on("contextmenu",i=>{this.showPickupPopup(e,i.lngLat)}),e.on("styleimagemissing",i=>{e.loadImage("./assets/map-style-icons/"+i.id+".png",(s,d)=>{s?console.error(s):!e.hasImage(i.id)&&d&&e.addImage(i.id,d)})}),this.tripRenderController=new E9(e)}showPickupPopup(e,i){let r=document.getElementById("map-endpoint-coords-picker-popup").innerHTML;const s=km.formatMapboxLngLatAsLatLng(i);r=r.replace("[PICKER_COORDS]",s);const d=document.createElement("div");d.innerHTML=r,d.addEventListener("click",m=>{const C=m.target.getAttribute("data-endpoint-type");if(null===C)return;const M=ao.initWithLngLat(i.lng,i.lat);this.userTripService.updateTripEndpoint(M,C,"MapPopupClick"),this.popupContextMenu.remove()}),this.popupContextMenu.setLngLat(i).setDOMContent(d).addTo(e)}addMapControls(e){const i=new(Ms().NavigationControl)({showCompass:!1,visualizePitch:!1});e.addControl(i,"bottom-right");const r=new(Ms().ScaleControl)({maxWidth:200,unit:"metric"});e.addControl(r);const s=new hF(e);e.addControl(s,"top-left");const d=new CF(e,this.debugXmlPopover,this.userTripService);e.addControl(d,"top-right")}updateMarkerLocation(e,i){var r,s,d;const m=null!==(s=null===(r=null==i?void 0:i.geoPosition)||void 0===r?void 0:r.asLngLat())&&void 0!==s?s:null;if(null===m)return void e.remove();const y=void 0===e.getLngLat();e.setLngLat(m),y&&(null===(d=this.mapLoadingPromise)||void 0===d||d.then(C=>{e.addTo(C)}))}createViaMarker(e){var i;const r=document.createElement("div");r.className="marker-journey-endpoint marker-journey-endpoint-Via";let s=!1;null===(null===(i=e.geoPosition)||void 0===i?void 0:i.properties)&&(s=!0);const d=new(Ms().Marker)({element:r,anchor:"bottom",draggable:s}),m=this.viaMarkers.length;return d.on("dragend",y=>{const C=d.getLngLat();let M=ao.initWithLngLat(C.lng,C.lat);this.userTripService.updateViaPoint(M,m)}),d}}return n.\u0275fac=function(e){return new(e||n)(G(Ic),G(jp),G(uu))},n.\u0275cmp=vn({type:n,selectors:[["app-map"]],decls:48,vars:0,consts:[["id","map_canvas",1,"map_wrapper"],[1,"d-none"],["id","map-endpoint-coords-picker-popup"],[1,"popup-picker","p-2"],[1,"popup-picker-header","mb-2"],[1,"popup-picker-body"],["type","button","data-endpoint-type","From",1,"btn","btn-primary","btn-sm"],["type","button","data-endpoint-type","To",1,"btn","btn-primary","btn-sm"],["type","button","data-endpoint-type","Via",1,"btn","btn-primary","btn-sm"],["id","map-endpoint-stop-picker-popup"],["id","map-endpoint-picker-popup"],["id","map-poi-picker-popup"]],template:function(e,i){1&e&&(ln(0,"div",0),oe(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),$e(5," Coords: [PICKER_COORDS] "),de(),oe(6,"div",5)(7,"button",6),$e(8,"From"),de(),oe(9,"button",7),$e(10,"To"),de(),oe(11,"button",8),$e(12,"Via"),de()()()(),oe(13,"div",9)(14,"div",3)(15,"div",4),$e(16," [STOP_NAME] ([STOP_ID]) "),de(),oe(17,"div",5)(18,"button",6),$e(19,"From"),de(),oe(20,"button",7),$e(21,"To"),de(),oe(22,"button",8),$e(23,"Via"),de()()()(),oe(24,"div",10)(25,"div",3)(26,"div",4),$e(27," TYPE: [GEO_RESTRICTION_TYPE] "),de(),oe(28,"div",5),$e(29," [GEOJSON_PROPERTIES_TABLE] "),oe(30,"button",6),$e(31,"From"),de(),oe(32,"button",7),$e(33,"To"),de(),oe(34,"button",8),$e(35,"Via"),de()()()(),oe(36,"div",11)(37,"div",3)(38,"div",4),$e(39," [POI_NAME] "),de(),oe(40,"div",5),$e(41," [GEOJSON_PROPERTIES_TABLE] "),oe(42,"button",6),$e(43,"From"),de(),oe(44,"button",7),$e(45,"To"),de(),oe(46,"button",8),$e(47,"Via"),de()()()()())},styles:[".map_wrapper[_ngcontent-%COMP%]{height:600px;border:1px solid #e5e5e5}.popup-picker-body[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:2px}"]}),n})();class TF{static computeExecutionTime(t,e){return null===t||null===e?0:(e.getTime()-t.getTime())/1e3}}function I9(n,t){1&n&&ln(0,"span",11)}let M9=(()=>{class n{constructor(e){this.userTripService=e,this.tripCustomRequestSaved=new nn,this.tripCustomResponseSaved=new nn,this.inputTripRequestXML="... loading",this.inputTripRequestResponseXML="Paste custom OJP TripRequest Response XML here...",this.isRunningTripRequest=!1}parseCustomRequestXML(){this.isRunningTripRequest=!0,this.userTripService.getStageConfig();const i=cu.initWithRequestMock(this.inputTripRequestXML);i.fetchResponse().then(r=>{if("ERROR"===r.message)return console.error("ERROR fetching OJP response"),void console.log(r);const s=i.requestInfo.responseXML;if(null===s)return console.error("ERROR parsing OJP response"),void console.log(i);this.tripCustomRequestSaved.emit(s)})}parseCustomResponseXML(){this.tripCustomResponseSaved.emit(this.inputTripRequestResponseXML)}}return n.\u0275fac=function(e){return new(e||n)(G(Ic))},n.\u0275cmp=vn({type:n,selectors:[["input-xml-popover"]],outputs:{tripCustomRequestSaved:"tripCustomRequestSaved",tripCustomResponseSaved:"tripCustomResponseSaved"},decls:26,vars:5,consts:[["sbbDialogTitle",""],["sbbDialogContent",""],[2,"width","500px"],[1,"d-flex","justify-content-between"],["target","_blank","href","https://opentransportdata.swiss/en/cookbook/ojptriprequest/"],["rows","7",1,"w-100",3,"ngModel","ngModelChange"],[1,"d-flex"],["type","button",1,"btn","btn-primary",3,"disabled","click"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],["sbbDialogActions",""],["type","button","sbbDialogClose","",1,"btn","btn-secondary"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"]],template:function(e,i){1&e&&(oe(0,"div",0),$e(1,"Custom Trip Request / Response XML"),de(),oe(2,"div",1)(3,"div",2)(4,"div",3)(5,"div"),$e(6,"Trip Request XML"),de(),oe(7,"div")(8,"a",4),$e(9,"Cookbook opentransportdata.swiss"),de()()(),oe(10,"textarea",5),Qt("ngModelChange",function(s){return i.inputTripRequestXML=s}),de(),oe(11,"div",6)(12,"button",7),Qt("click",function(){return i.parseCustomRequestXML()}),$t(13,I9,1,0,"span",8),$e(14," Execute OJPTripRequest "),de()(),ln(15,"hr"),oe(16,"div",3)(17,"div"),$e(18,"Trip Request Response XML"),de()(),oe(19,"textarea",5),Qt("ngModelChange",function(s){return i.inputTripRequestResponseXML=s}),de(),oe(20,"div",6)(21,"button",7),Qt("click",function(){return i.parseCustomResponseXML()}),$e(22," Display Trips "),de()()()(),oe(23,"div",9)(24,"button",10),$e(25," Close "),de()()),2&e&&(Le(10),Je("ngModel",i.inputTripRequestXML),Le(2),Je("disabled",i.isRunningTripRequest),Le(1),Je("ngIf",i.isRunningTripRequest),Le(6),Je("ngModel",i.inputTripRequestResponseXML),Le(2),Je("disabled",i.isRunningTripRequest))},dependencies:[Ts,id,uh,Ip,Xb,Rv,Pv,Lv],encapsulation:2}),n})();const A9=["input"],k9=["*"],R9=new Et("sbb-checkbox-default-options",{providedIn:"root",factory:function EF(){return{clickAction:"check-indeterminate"}}});const P9={provide:Us,useExisting:Ni(()=>L9),multi:!0};let L9=(()=>{class n extends mE{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Vi(n)))(i||n)}}(),n.\u0275dir=Lt({type:n,selectors:[["sbb-checkbox","required","","formControlName",""],["sbb-checkbox","required","","formControl",""],["sbb-checkbox","required","","ngModel",""]],features:[Vn([P9]),qt]}),n})(),O9=0;const F9={clickAction:"check-indeterminate"},N9={provide:Ha,useExisting:Ni(()=>IF),multi:!0};class B9{}const z9=$b(Ga(class{}));let DF=(()=>{class n extends z9{constructor(e,i,r,s,d){super(),this._elementRef=e,this._changeDetectorRef=i,this._focusMonitor=r,this._options=d,this.ariaLabel="",this.ariaLabelledby=null,this._uniqueId="sbb-checkbox-"+ ++O9,this.id=this._uniqueId,this.labelPosition="after",this.name=null,this.change=new nn,this.indeterminateChange=new nn,this._onTouched=()=>{},this._controlValueAccessorChangeFn=()=>{},this._checked=!1,this._disabled=!1,this._indeterminate=!1,this._options=this._options||F9,this.tabIndex=parseInt(s,10)||0}get inputId(){return`${this.id||this._uniqueId}-input`}get required(){return this._required}set required(e){this._required=jn(e)}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(e=>{e||Promise.resolve().then(()=>{this._onTouched(),this._changeDetectorRef.markForCheck()})}),this._syncIndeterminate(this._indeterminate)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}get checked(){return this._checked}set checked(e){const i=jn(e);i!==this.checked&&(this._checked=i,this._changeDetectorRef.markForCheck())}get disabled(){return this._disabled}set disabled(e){const i=jn(e);i!==this.disabled&&(this._disabled=i,this._changeDetectorRef.markForCheck())}get indeterminate(){return this._indeterminate}set indeterminate(e){const i=e!==this._indeterminate;this._indeterminate=jn(e),i&&this.indeterminateChange.emit(this._indeterminate),this._syncIndeterminate(this._indeterminate)}_onLabelTextChange(){this._changeDetectorRef.detectChanges()}writeValue(e){this.checked=!!e}registerOnChange(e){this._controlValueAccessorChangeFn=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this.disabled=e}_getAriaChecked(){return this.checked?"true":this.indeterminate?"mixed":"false"}_emitChangeEvent(){const e=new B9;e.source=this,e.checked=this.checked,this._controlValueAccessorChangeFn(this.checked),this.change.emit(e)}toggle(){this.checked=!this.checked,this._controlValueAccessorChangeFn(this.checked)}_onInputClick(e){var i;const r=null===(i=this._options)||void 0===i?void 0:i.clickAction;e.stopPropagation(),this.disabled||"noop"===r?!this.disabled&&"noop"===r&&(this._inputElement.nativeElement.checked=this.checked,this._inputElement.nativeElement.indeterminate=this.indeterminate):(this.indeterminate&&"check"!==r&&Promise.resolve().then(()=>{this._indeterminate=!1,this.indeterminateChange.emit(this._indeterminate)}),this._checked=!this._checked,this._emitChangeEvent())}focus(e,i){e?this._focusMonitor.focusVia(this._inputElement,e,i):this._inputElement.nativeElement.focus(i)}_onInteractionEvent(e){e.stopPropagation()}_syncIndeterminate(e){const i=this._inputElement;i&&(i.nativeElement.indeterminate=e)}}return n.\u0275fac=function(e){return new(e||n)(G(Tn),G(Sr),G(fa),Uo("tabindex"),G(R9,8))},n.\u0275dir=Lt({type:n,viewQuery:function(e,i){if(1&e&&ur(A9,5),2&e){let r;Nn(r=Bn())&&(i._inputElement=r.first)}},inputs:{ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],ariaDescribedby:["aria-describedby","ariaDescribedby"],id:"id",required:"required",labelPosition:"labelPosition",name:"name",value:"value",checked:"checked",disabled:"disabled",indeterminate:"indeterminate"},outputs:{change:"change",indeterminateChange:"indeterminateChange"},features:[qt]}),n})(),IF=(()=>{class n extends DF{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Vi(n)))(i||n)}}(),n.\u0275cmp=vn({type:n,selectors:[["sbb-checkbox"]],hostAttrs:[1,"sbb-checkbox","sbb-selection-item"],hostVars:10,hostBindings:function(e,i){2&e&&(vc("id",i.id),fn("tabindex",null)("aria-label",null)("aria-labelledby",null),Ri("sbb-selection-indeterminate",i.indeterminate)("sbb-selection-checked",i.checked)("sbb-selection-disabled",i.disabled))},inputs:{tabIndex:"tabIndex"},exportAs:["sbbCheckbox"],features:[Vn([N9]),qt],ngContentSelectors:k9,decls:11,vars:12,consts:[[1,"sbb-selection-item-label"],["type","checkbox",1,"cdk-visually-hidden","sbb-selection-input","sbb-checkbox-input","sbb-transparent-parent-overlay",3,"id","required","checked","disabled","tabIndex","change","click"],["input",""],[1,"sbb-selection-container"],[1,"sbb-selection-container-checked"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","focusable","false"],["fill","none","fill-rule","evenodd","stroke","#000","stroke-width","1","points","6 12 10 16 19 7.01"],[1,"sbb-selection-content",3,"cdkObserveContent"],[2,"display","none"]],template:function(e,i){1&e&&(Mo(),oe(0,"label",0)(1,"input",1,2),Qt("change",function(s){return i._onInteractionEvent(s)})("click",function(s){return i._onInputClick(s)}),de(),oe(3,"div",3)(4,"span",4),F(),oe(5,"svg",5),ln(6,"polyline",6),de()()(),Y(),oe(7,"div",7),Qt("cdkObserveContent",function(){return i._onLabelTextChange()}),oe(8,"span",8),$e(9,"\xa0"),de(),Pr(10),de()()),2&e&&(fn("for",i.inputId),Le(1),Je("id",i.inputId)("required",i.required)("checked",i.checked)("disabled",i.disabled)("tabIndex",i.tabIndex),fn("value",i.value)("name",i.name)("aria-label",i.ariaLabel||null)("aria-labelledby",i.ariaLabelledby)("aria-checked",i._getAriaChecked())("aria-describedby",i.ariaDescribedby))},dependencies:[YL],encapsulation:2,changeDetection:0}),n})(),MF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({imports:[Zw,Wi]}),n})(),V9=(()=>{class n{constructor(e){var i,r;this.userTripService=e,this.embedHTMLs="n/a",this.fromLocationText="",this.toLocationText="",this.fromLocationChecked=!1,this.toLocationChecked=!0,this.fromLocationText=n.computeLocationText(null===(i=e.fromTripLocation)||void 0===i?void 0:i.location),this.toLocationText=n.computeLocationText(null===(r=e.toTripLocation)||void 0===r?void 0:r.location),this.updateEmbedHTML()}static computeLocationText(e){var i,r,s,d,m;if(!e)return"";const y=e.getLocationType();if("stop"===y)return e.computeLocationName()+"(stopRef "+(null!==(r=null===(i=e.stopPlace)||void 0===i?void 0:i.stopPlaceRef)&&void 0!==r?r:"")+")";const C=e.geoPosition;return C?(null!==(s=e.computeLocationName())&&void 0!==s?s:"")+"(coords "+(null!==(d=C.asLatLngString(!0))&&void 0!==d?d:"")+")":y+" - "+(null!==(m=e.computeLocationName())&&void 0!==m?m:"")}updateEmbedHTML(){const e=new URLSearchParams;["from","to"].forEach(s=>{const d=(()=>{if("from"===s?this.fromLocationChecked:this.toLocationChecked){const y=this.userTripService.embedQueryParams.get(s);if(null!==y)return y}return""})();e.append(s,d)});const i=document.location.pathname.replace("/search","/embed/search")+"?"+e.toString(),r=document.location.protocol+"//"+document.location.host+i;this.embedHTMLs='<iframe src="'+r+'" width="100%" height="100%" frameBorder="0"></iframe>'}}return n.\u0275fac=function(e){return new(e||n)(G(Ic))},n.\u0275cmp=vn({type:n,selectors:[["embed-search-popover"]],decls:20,vars:5,consts:[["sbbDialogTitle",""],["sbbDialogContent",""],[2,"width","500px"],[3,"ngModel","ngModelChange","change"],["rows","7",1,"w-100"],["sbbDialogActions",""],["type","button","sbbDialogClose","",1,"btn","btn-secondary"]],template:function(e,i){1&e&&(oe(0,"div",0),$e(1,"Embed journey in another website"),de(),oe(2,"div",1)(3,"div",2)(4,"p"),$e(5,"Select which journey endpoints should be prefilled:"),de(),oe(6,"div")(7,"div")(8,"sbb-checkbox",3),Qt("ngModelChange",function(s){return i.fromLocationChecked=s})("change",function(){return i.updateEmbedHTML()}),$e(9),de()(),oe(10,"div")(11,"sbb-checkbox",3),Qt("ngModelChange",function(s){return i.toLocationChecked=s})("change",function(){return i.updateEmbedHTML()}),$e(12),de()()(),oe(13,"p"),$e(14,"Copy the following code in the target webpage"),de(),oe(15,"textarea",4),$e(16),de()()(),oe(17,"div",5)(18,"button",6),$e(19," Close "),de()()),2&e&&(Le(8),Je("ngModel",i.fromLocationChecked),Le(1),wr("(From) ",i.fromLocationText,""),Le(2),Je("ngModel",i.toLocationChecked),Le(1),wr("(To) ",i.toLocationText,""),Le(4),hi(i.embedHTMLs))},dependencies:[uh,Ip,IF,Xb,Rv,Pv,Lv],encapsulation:2}),n})();function j9(n,t){}const AF=new Et("SbbNotificationToastData");class SS{constructor(){this.politeness="assertive",this.duration=0,this.data=null,this.verticalPosition="bottom",this.type="success"}}const U9={notificationState:Es("state",[dr("void, hidden",Ln({transform:"scale(0.8)",opacity:0})),dr("visible",Ln({transform:"scale(1)",opacity:1})),qi("* => visible",Qi("150ms cubic-bezier(0, 0, 0.2, 1)")),qi("* => void, * => hidden",Qi("75ms cubic-bezier(0.4, 0.0, 1, 1)",Ln({opacity:0})))])};let H9=(()=>{class n extends Sv{constructor(e,i,r,s){super(),this._ngZone=e,this._elementRef=i,this._changeDetectorRef=r,this.config=s,this._destroyed=!1,this._onExit=new Zt,this._onEnter=new Zt,this._animationState="void",this.attachDomPortal=d=>{this._assertNotAttached();const m=this._portalOutlet.attachDomPortal(d);return this._afterPortalAttached(),m},this._role="assertive"!==s.politeness||s.announcementMessage?"off"===s.politeness?null:"status":"alert"}get _svgIcon(){switch(this.config.type){case"success":return"kom:tick-small";case"error":case"warn":return"kom:sign-exclamation-point-small";default:return"kom:circle-information-small"}}attachComponentPortal(e){this._assertNotAttached();const i=this._portalOutlet.attachComponentPortal(e);return this._afterPortalAttached(),i}attachTemplatePortal(e){this._assertNotAttached();const i=this._portalOutlet.attachTemplatePortal(e);return this._afterPortalAttached(),i}onAnimationEnd(e){const{fromState:i,toState:r}=e;if(("void"===r&&"void"!==i||"hidden"===r)&&this._completeExit(),"visible"===r){const s=this._onEnter;this._ngZone.run(()=>{s.next(),s.complete()})}}enter(){this._destroyed||(this._animationState="visible",this._changeDetectorRef.detectChanges())}exit(){return this._animationState="hidden",this._elementRef.nativeElement.setAttribute("sbb-exit",""),this._onExit}ngOnDestroy(){this._destroyed=!0,this._completeExit()}_completeExit(){this._ngZone.onMicrotaskEmpty.pipe(Vr(1)).subscribe(()=>{this._onExit.next(),this._onExit.complete()})}_afterPortalAttached(){const e=this._elementRef.nativeElement,i=this.config.panelClass;i&&(Array.isArray(i)?i.forEach(r=>e.classList.add(r)):e.classList.add(i)),e.classList.add("sbb-notification-toast-center")}_assertNotAttached(){if(this._portalOutlet.hasAttached())throw Error("Attempting to attach notification content after content is already attached")}}return n.\u0275fac=function(e){return new(e||n)(G(qn),G(Tn),G(Sr),G(SS))},n.\u0275dir=Lt({type:n,viewQuery:function(e,i){if(1&e&&ur(sd,7),2&e){let r;Nn(r=Bn())&&(i._portalOutlet=r.first)}},features:[qt]}),n})(),$9=(()=>{class n extends H9{_afterPortalAttached(){super._afterPortalAttached(),"top"===this.config.verticalPosition&&this._elementRef.nativeElement.classList.add("sbb-notification-toast-top")}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Vi(n)))(i||n)}}(),n.\u0275cmp=vn({type:n,selectors:[["sbb-notification-toast-container"]],hostAttrs:[1,"sbb-notification-toast"],hostVars:10,hostBindings:function(e,i){1&e&&Iy("@state.done",function(s){return i.onAnimationEnd(s)}),2&e&&(fn("role",i._role),Ay("@state",i._animationState),Ri("sbb-notification-toast-success","success"===i.config.type)("sbb-notification-toast-info","info"===i.config.type)("sbb-notification-toast-warn","warn"===i.config.type)("sbb-notification-toast-error","error"===i.config.type))},features:[qt],decls:6,vars:1,consts:[[1,"sbb-notification-toast-icon-wrapper","sbb-icon-fit"],[3,"svgIcon"],[1,"sbb-notification-toast-content"],["cdkPortalOutlet",""],["type","button",1,"sbb-notification-toast-icon-wrapper","sbb-notification-toast-icon-close-wrapper","sbb-icon-fit",3,"click"],["svgIcon","kom:cross-small"]],template:function(e,i){1&e&&(oe(0,"span",0),ln(1,"sbb-icon",1),de(),oe(2,"div",2),$t(3,j9,0,0,"ng-template",3),de(),oe(4,"button",4),Qt("click",function(){return i.exit()}),ln(5,"sbb-icon",5),de()),2&e&&(Le(1),Je("svgIcon",i._svgIcon))},dependencies:[sd,qa],styles:[".sbb-notification-toast{display:flex;min-height:calc(3.2rem * var(--sbb-scaling-factor));border-radius:var(--sbb-border-radius);color:var(--sbb-color-white);background-color:var(--sbb-color-background);font-size:var(--sbb-font-size);line-height:var(--sbb-line-height);padding-top:calc(0.8rem * var(--sbb-scaling-factor) - var(--sbb-border-width-thin));padding-bottom:calc(\n    0.8rem * var(--sbb-scaling-factor) - var(--sbb-border-width-thin) - var(\n        --sbb-line-height\n      ) + var(--sbb-icon-size-default)\n  );margin:calc(1.3333333333rem * var(--sbb-scaling-factor))}:where(html.sbb-lean) .sbb-notification-toast{padding-bottom:calc(\n      0.8rem * var(--sbb-scaling-factor) - var(--sbb-border-width-thin)\n    )}.sbb-notification-toast-mobile .sbb-notification-toast{margin:calc(0.5333333333rem * var(--sbb-scaling-factor));max-width:100%;min-width:0;width:100%}.sbb-notification-toast-mobile{width:100%}.sbb-notification-toast-error{background-color:var(--sbb-color-error)}:is(.sbb-notification-toast-error,.sbb-notification-toast-error :is(a,button)){color:var(--sbb-color-white)}.sbb-notification-toast-success{border:var(--sbb-border-width-thin) solid var(--sbb-color-green)}:is(.sbb-notification-toast-success,.sbb-notification-toast-success :is(a,button)){color:var(--sbb-color-green)}.sbb-notification-toast-info{border:var(--sbb-border-width-thin) solid var(--sbb-color-granite)}:is(.sbb-notification-toast-info,.sbb-notification-toast-info :is(a,button)){color:var(--sbb-color-granite)}.sbb-notification-toast-warn{background-color:var(--sbb-color-orange)}:is(.sbb-notification-toast-warn,.sbb-notification-toast-warn :is(a,button)){color:var(--sbb-color-white)}.sbb-notification-toast-content{margin-left:calc(0.5333333333rem * var(--sbb-scaling-factor));margin-right:calc(1.6rem * var(--sbb-scaling-factor))}.sbb-notification-toast-icon-wrapper{min-width:var(--sbb-icon-size-default);width:var(--sbb-icon-size-default);height:var(--sbb-icon-size-default);margin-left:calc(1.0666666667rem * var(--sbb-scaling-factor));border:none;background:none;padding:0;align-self:flex-start}.sbb-notification-toast-icon-close-wrapper{cursor:pointer;margin-left:auto;margin-right:calc(1.4666666667rem * var(--sbb-scaling-factor))}"],encapsulation:2,data:{animation:[U9.notificationState]}}),n})();const G9=Math.pow(2,31)-1;class KD{constructor(t,e){this._overlayRef=e,this._afterDismissed=new Zt,this._afterOpened=new Zt,this.containerInstance=t,t._onExit.subscribe(()=>this._finishDismiss())}dismiss(){this._afterDismissed.closed||this.containerInstance.exit(),clearTimeout(this._durationTimeoutId)}_dismissAfter(t){this._durationTimeoutId=setTimeout(()=>this.dismiss(),Math.min(t,G9))}_open(){this._afterOpened.closed||(this._afterOpened.next(),this._afterOpened.complete())}_finishDismiss(){this._overlayRef.dispose(),this._afterDismissed.next(null),this._afterDismissed.complete()}afterDismissed(){return this._afterDismissed.asObservable()}afterOpened(){return this.containerInstance._onEnter}}let q9=(()=>{class n{constructor(e,i){this.notificationToastRef=e,this.data=i}dismiss(){this.notificationToastRef.dismiss()}}return n.\u0275fac=function(e){return new(e||n)(G(KD),G(AF))},n.\u0275cmp=vn({type:n,selectors:[["sbb-simple-notification"]],decls:2,vars:1,template:function(e,i){1&e&&(oe(0,"span"),$e(1),de()),2&e&&(Le(1),hi(i.data.message))},encapsulation:2,changeDetection:0}),n})(),QD=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({imports:[gr,oa,bl,Wi,mo]}),n})();const W9=new Et("notification-default-options",{providedIn:"root",factory:function X9(){return new SS}});let kF=(()=>{class n{constructor(e,i,r,s,d,m){this._overlay=e,this._injector=i,this._live=r,this._breakpointObserver=s,this._parentNotification=d,this._defaultConfig=m,this._notificationRefAtThisLevel=null,this._simpleNotificationToastComponent=q9,this._notificationToastContainerComponent=$9,this._mobileDeviceCssClass="sbb-notification-toast-mobile"}get _openedNotificationRef(){const e=this._parentNotification;return e?e._openedNotificationRef:this._notificationRefAtThisLevel}set _openedNotificationRef(e){this._parentNotification?this._parentNotification._openedNotificationRef=e:this._notificationRefAtThisLevel=e}openFromComponent(e,i){return this._attach(e,i)}openFromTemplate(e,i){return this._attach(e,i)}open(e,i){const r=Object.assign(Object.assign({},this._defaultConfig),i);return r.data={message:e},r.announcementMessage===e&&(r.announcementMessage=void 0),this.openFromComponent(this._simpleNotificationToastComponent,r)}dismiss(){this._openedNotificationRef&&this._openedNotificationRef.dismiss()}ngOnDestroy(){this._notificationRefAtThisLevel&&this._notificationRefAtThisLevel.dismiss()}_attachNotificationToastContainer(e,i){var r;const s=null===(r=null==i?void 0:i.viewContainerRef)||void 0===r?void 0:r.injector,d=new fO(s||this._injector,new WeakMap([[SS,i]])),m=new od(this._notificationToastContainerComponent,i.viewContainerRef,d),y=e.attach(m);return y.instance.config=i,y.instance}_attach(e,i){const r=Object.assign(Object.assign(Object.assign({},new SS),this._defaultConfig),i),s=this._createOverlay(r),d=this._attachNotificationToastContainer(s,r),m=new KD(d,s);if(e instanceof Qr){const y=new Cm(e,null,{$implicit:r.data,notificationRef:m});m.instance=d.attachTemplatePortal(y)}else{const y=this._createInjector(r,m),C=new od(e,void 0,y),M=d.attachComponentPortal(C);m.instance=M.instance}return this._breakpointObserver.observe("(max-width: 642.99px) and (orientation: portrait)").pipe(Pi(s.detachments())).subscribe(y=>{const C=s.overlayElement.classList;y.matches?C.add(this._mobileDeviceCssClass):C.remove(this._mobileDeviceCssClass)}),this._animateNotification(m,r),this._openedNotificationRef=m,this._openedNotificationRef}_animateNotification(e,i){e.afterDismissed().subscribe(()=>{this._openedNotificationRef===e&&(this._openedNotificationRef=null),i.announcementMessage&&this._live.clear()}),this._openedNotificationRef?(this._openedNotificationRef.afterDismissed().subscribe(()=>{e.containerInstance.enter()}),this._openedNotificationRef.dismiss()):e.containerInstance.enter(),i.duration&&i.duration>0&&e.afterOpened().subscribe(()=>e._dismissAfter(i.duration)),i.announcementMessage&&this._live.announce(i.announcementMessage,i.politeness)}_createOverlay(e){const i=new Mm,r=this._overlay.position().global();return r.centerHorizontally(),"top"===e.verticalPosition?r.top("0"):r.bottom("0"),i.positionStrategy=r,this._overlay.create(i)}_createInjector(e,i){var r;const s=null===(r=null==e?void 0:e.viewContainerRef)||void 0===r?void 0:r.injector;return new fO(s||this._injector,new WeakMap([[KD,i],[AF,e.data]]))}}return n.\u0275fac=function(e){return new(e||n)(ze(Bo),ze(Nr),ze(uO),ze(iD),ze(n,12),ze(W9))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:QD}),n})();const Z9=["sbb-button",""];function Y9(n,t){1&n&&ln(0,"sbb-icon",2),2&n&&Je("svgIcon",Yt().svgIcon)}function K9(n,t){1&n&&ln(0,"sbb-icon",3),2&n&&Je("svgIcon",Yt().svgIcon)}const Q9=["*"],J9=["sbb-button","sbb-alt-button","sbb-secondary-button","sbb-ghost-button","sbb-frameless-button","sbb-link"],eX=["sbb-button","sbb-secondary-button","sbb-frameless-button","sbb-link"],tX=["sbb-button","sbb-alt-button","sbb-secondary-button","sbb-ghost-button"],RF={"sbb-button":"kom:arrow-right-small","sbb-secondary-button":"kom:arrow-right-small","sbb-frameless-button":"kom:plus-small","sbb-link":"kom:arrow-right-small"},nX=Ga(Em(class{constructor(n){this._elementRef=n}}));let PF=(()=>{class n extends nX{constructor(e,i,r,s){super(e),this._focusMonitor=i,this._animationMode=r,this._contentObserver=s,this._hasIconIndicator=this._hasHostAttributes(...eX),this._hasIconButtonClass=!1,this._iconRefs=new nm;for(const d of J9)this._hasHostAttributes(d)&&(this._getHostElement().classList.add(d),d in RF&&(this.svgIcon=RF[d]));e.nativeElement.classList.add("sbb-button-base")}ngAfterContentInit(){var e,i;const r=null!==(i=null===(e=this._contentObserver)||void 0===e?void 0:e.observe(this._elementRef))&&void 0!==i?i:this._iconRefs.changes;this._isIconButton=null==r?void 0:r.pipe(Ds([]),W(()=>this._hasHostAttributes(...tX)&&""===this._elementRef.nativeElement.textContent.trim()&&1===this._iconRefs.length)),this._isIconButton.subscribe(s=>this._hasIconButtonClass=s),this._leftIconVisible=dm([this.variant,this._isIconButton]).pipe(W(([s,d])=>!d&&"standard"===s&&this._hasIconIndicator)),this._rightIconVisible=dm([this.variant,this._isIconButton]).pipe(W(([s,d])=>!d&&("standard"===s&&this._hasIconIndicator||"lean"===s&&this._hasHostAttributes("sbb-link"))))}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}focus(e,i){e?this._focusMonitor.focusVia(this._getHostElement(),e,i):this._getHostElement().focus(i)}_getHostElement(){return this._elementRef.nativeElement}_hasHostAttributes(...e){return e.some(i=>this._getHostElement().hasAttribute(i))}}return n.\u0275fac=function(e){return new(e||n)(G(Tn),G(fa),G(Qu,8),G(ZL,8))},n.\u0275cmp=vn({type:n,selectors:[["button","sbb-button",""],["button","sbb-alt-button",""],["button","sbb-secondary-button",""],["button","sbb-ghost-button",""],["button","sbb-frameless-button",""],["button","sbb-link",""]],contentQueries:function(e,i,r){if(1&e&&zr(r,qa,4,Tn),2&e){let s;Nn(s=Bn())&&(i._iconRefs=s)}},hostVars:7,hostBindings:function(e,i){2&e&&(fn("disabled",i.disabled||null),Ri("_sbb-animation-noopable","NoopAnimations"===i._animationMode)("sbb-disabled",i.disabled)("sbb-icon-button",i._hasIconButtonClass))},inputs:{disabled:"disabled",svgIcon:"svgIcon"},exportAs:["sbbButton"],features:[qt],attrs:Z9,ngContentSelectors:Q9,decls:5,vars:6,consts:[["class","sbb-button-indicator-icon sbb-button-left-icon",3,"svgIcon",4,"ngIf"],["class","sbb-button-indicator-icon sbb-button-right-icon",3,"svgIcon",4,"ngIf"],[1,"sbb-button-indicator-icon","sbb-button-left-icon",3,"svgIcon"],[1,"sbb-button-indicator-icon","sbb-button-right-icon",3,"svgIcon"]],template:function(e,i){1&e&&(Mo(),$t(0,Y9,1,1,"sbb-icon",0),yb(1,"async"),Pr(2),$t(3,K9,1,1,"sbb-icon",1),yb(4,"async")),2&e&&(Je("ngIf",vb(1,2,i._leftIconVisible)&&i.svgIcon),Le(3),Je("ngIf",vb(4,4,i._rightIconVisible)&&i.svgIcon))},dependencies:[Ts,qa,Hy],encapsulation:2,changeDetection:0}),n})(),JD=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({imports:[gr,Wi,mo]}),n})();const rX=["connectionContainer"];function oX(n,t){if(1&n&&(Bl(0),oe(1,"span"),$e(2),de(),zl()),2&n){const e=Yt();Le(2),hi(e.label)}}function sX(n,t){1&n&&Pr(0,1,["*ngSwitchCase","true"])}function aX(n,t){1&n&&Pr(0,2,["*ngIf","_hasErrors()"])}const lX=["*",[["sbb-label"]],[["sbb-error"],["","sbbError",""]]],cX=["*","sbb-label","sbb-error,[sbbError]"];let uX=0;const LF=new Et("SbbError");let dX=(()=>{class n{constructor(e,i){this.id="sbb-error-"+uX++,e||i.nativeElement.setAttribute("aria-live","polite")}}return n.\u0275fac=function(e){return new(e||n)(Uo("aria-live"),G(Tn))},n.\u0275dir=Lt({type:n,selectors:[["sbb-error"],["","sbbError",""]],hostAttrs:["aria-atomic","true",1,"sbb-error"],hostVars:1,hostBindings:function(e,i){2&e&&fn("id",i.id)},inputs:{id:"id"},features:[Vn([{provide:LF,useExisting:n}])]}),n})();class Nv{}let eI=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=Lt({type:n,selectors:[["sbb-label"]],hostAttrs:[1,"sbb-label"]}),n})(),hX=0;const CS=new Et("SBB_FORM_FIELD");let Bv=(()=>{class n{constructor(e,i){this._elementRef=e,this._changeDetectorRef=i,this._destroyed=new Zt,this._labelId="sbb-form-field-label-"+hX++}get _control(){return this._explicitFormFieldControl||this._controlNonStatic||this._controlStatic}set _control(e){this._explicitFormFieldControl=e}getLabelId(){return this._hasLabel()||this.label?this._labelId:null}ngAfterContentInit(){this._validateControlChild();const e=this._control;e.controlType&&this._elementRef.nativeElement.classList.add(`sbb-form-field-type-${e.controlType}`),e.stateChanges.pipe(Ds(null)).subscribe(()=>{this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()}),e.ngControl&&e.ngControl.valueChanges&&e.ngControl.valueChanges.pipe(Pi(this._destroyed)).subscribe(()=>this._changeDetectorRef.markForCheck()),this._errorChildren.changes.pipe(Ds(null)).subscribe(()=>{this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()})}ngAfterContentChecked(){this._validateControlChild()}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}_shouldForward(e){const i=this._control?this._control.ngControl:null;return i&&i[e]}_hasLabel(){return!(!this._labelChildNonStatic&&!this._labelChildStatic)}_hasErrors(){return!!(this._errorChildren&&this._errorChildren.length&&this._control.errorState)}_syncDescribedByIds(){if(this._control){const e=[];this._control.userAriaDescribedBy&&"string"==typeof this._control.userAriaDescribedBy&&e.push(...this._control.userAriaDescribedBy.split(" ")),this._errorChildren&&e.push(...this._errorChildren.map(i=>i.id)),this._control.setDescribedByIds(e)}}_validateControlChild(){}getConnectedOverlayOrigin(){return this._connectionContainerRef||this._elementRef}}return n.\u0275fac=function(e){return new(e||n)(G(Tn),G(Sr))},n.\u0275cmp=vn({type:n,selectors:[["sbb-form-field"]],contentQueries:function(e,i,r){if(1&e&&(zr(r,Nv,5),zr(r,Nv,7),zr(r,eI,5),zr(r,eI,7),zr(r,LF,5)),2&e){let s;Nn(s=Bn())&&(i._controlNonStatic=s.first),Nn(s=Bn())&&(i._controlStatic=s.first),Nn(s=Bn())&&(i._labelChildNonStatic=s.first),Nn(s=Bn())&&(i._labelChildStatic=s.first),Nn(s=Bn())&&(i._errorChildren=s)}},viewQuery:function(e,i){if(1&e&&ur(rX,7),2&e){let r;Nn(r=Bn())&&(i._connectionContainerRef=r.first)}},hostAttrs:[1,"sbb-form-field"],hostVars:20,hostBindings:function(e,i){2&e&&Ri("sbb-form-field-invalid",null==i._control?null:i._control.errorState)("sbb-form-field-disabled",null==i._control?null:i._control.disabled)("sbb-focused",null==i._control?null:i._control.focused)("ng-untouched",i._shouldForward("untouched"))("ng-touched",i._shouldForward("touched"))("ng-pristine",i._shouldForward("pristine"))("ng-dirty",i._shouldForward("dirty"))("ng-valid",i._shouldForward("valid"))("ng-invalid",i._shouldForward("invalid"))("ng-pending",i._shouldForward("pending"))},inputs:{label:"label"},exportAs:["sbbFormField"],features:[Vn([{provide:CS,useExisting:n}])],ngContentSelectors:cX,decls:10,vars:9,consts:[[1,"sbb-form-field-wrapper"],[1,"sbb-form-field-label-wrapper",3,"click"],[1,"sbb-label","sbb-form-field-label",3,"id","ngSwitch"],[4,"ngSwitchCase"],[1,"sbb-form-field-input-wrapper"],["connectionContainer",""],[1,"sbb-form-field-error-wrapper"],[4,"ngIf"]],template:function(e,i){1&e&&(Mo(lX),oe(0,"div",0)(1,"div",1),Qt("click",function(s){return i._control.onContainerClick&&i._control.onContainerClick(s)}),oe(2,"label",2),$t(3,oX,3,1,"ng-container",3),$t(4,sX,1,0,"ng-content",3),de()(),oe(5,"div",4,5),Pr(7),de(),oe(8,"div",6),$t(9,aX,1,0,"ng-content",7),de()()),2&e&&(Le(2),Ri("sbb-form-field-empty",i._control.empty),Je("id",i._labelId)("ngSwitch",i._hasLabel()),fn("for",i._control.id)("aria-owns",i._control.id),Le(1),Je("ngSwitchCase",!1),Le(1),Je("ngSwitchCase",!0),Le(5),Je("ngIf",i._hasErrors()))},dependencies:[Ts,Eb,Bx],styles:[".sbb-form-field{display:inline-block;position:relative;width:var(--sbb-form-field-width)}.sbb-form-field-short{width:33.333%}@media all and (min-width: 26.3125em){.sbb-form-field-short{width:25%}}@media all and (min-width: 64.0625em){.sbb-form-field-short{width:16.66666%}}.sbb-form-field-medium{width:100%}@media all and (min-width: 40.1875em){.sbb-form-field-medium{width:50%}}.sbb-form-field-long{width:100%}.sbb-form-field-wrapper{padding-bottom:calc(1.5333333333rem * var(--sbb-scaling-factor))}:where(html.sbb-lean) .sbb-form-field-wrapper{padding-bottom:1.0666666667rem}.sbb-form-field-flexible-errors .sbb-form-field-wrapper{padding-bottom:0}.sbb-form-field-label-wrapper{margin-bottom:var(--sbb-form-label-wrapper-margin-bottom);padding-left:var(--sbb-form-label-wrapper-padding-left)}.sbb-form-field .sbb-input-element{width:100%;max-width:100%}.sbb-form-field textarea.sbb-input-element{resize:vertical;overflow:auto}.sbb-form-field textarea.sbb-input-element.cdk-textarea-autosize{resize:none}.sbb-form-field-error-wrapper{position:absolute;box-sizing:border-box;width:100%;overflow:hidden}.sbb-form-field-flexible-errors .sbb-form-field-error-wrapper{position:relative}:is(.sbb-form-field-error-wrapper,.sbb-form-field-label-wrapper) :is(.sbb-icon,.sbb-tooltip-icon),:is(.sbb-form-field-error-wrapper,.sbb-form-field-label-wrapper) .sbb-icon svg{vertical-align:bottom;width:calc(1.0666666667rem * var(--sbb-scaling-factor));height:calc(1.0666666667rem * var(--sbb-scaling-factor))}:is(.sbb-form-field-error-wrapper,.sbb-form-field-label-wrapper) .sbb-tooltip-icon:not(:hover):not(:focus){color:inherit}:is(.sbb-form-field-error-wrapper,.sbb-form-field-label-wrapper) .sbb-tooltip-trigger{margin-left:calc(0.5333333333rem * var(--sbb-scaling-factor))}.sbb-form-group,.sbb-form-group-center,.sbb-form-group-wrap,.sbb-form-group-vertical{display:flex;gap:var(--sbb-divider-thin)}:is(.sbb-form-group,.sbb-form-group-center,.sbb-form-group-wrap){align-items:flex-start}.sbb-form-group-wrap{flex-wrap:wrap}.sbb-form-group-center{justify-content:center}:is(.sbb-form-group,.sbb-form-group-center,.sbb-form-group-wrap):where(:not(.sbb-form-group-vertical)) :is(.sbb-button,.sbb-alt-button,.sbb-secondary-button,.sbb-ghost-button,.sbb-icon-button){margin-top:calc(var(--sbb-form-label-line-height) + var(--sbb-form-label-wrapper-margin-bottom))}.sbb-form-group-vertical{flex-direction:column}.sbb-form-group-vertical.sbb-form-group-center{justify-content:inherit;align-items:center}.sbb-form-group-vertical>:is(.sbb-button,.sbb-alt-button,.sbb-secondary-button,.sbb-ghost-button,.sbb-icon-button){width:var(--sbb-form-field-width)}:where(html:not(.sbb-lean)) .sbb-form-group-vertical>:is(.sbb-button,.sbb-alt-button,.sbb-secondary-button,.sbb-ghost-button,.sbb-icon-button) .sbb-button-right-icon{right:unset !important}"],encapsulation:2,changeDetection:0}),n})(),TS=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({imports:[gr,Wi]}),n})();const OF=kp({passive:!0});let pX=(()=>{class n{constructor(e,i){this._platform=e,this._ngZone=i,this._monitoredElements=new Map}monitor(e){if(!this._platform.isBrowser)return ps;const i=xm(e),r=this._monitoredElements.get(i);if(r)return r.subject;const s=new Zt,d="cdk-text-field-autofilled",m=y=>{"cdk-text-field-autofill-start"!==y.animationName||i.classList.contains(d)?"cdk-text-field-autofill-end"===y.animationName&&i.classList.contains(d)&&(i.classList.remove(d),this._ngZone.run(()=>s.next({target:y.target,isAutofilled:!1}))):(i.classList.add(d),this._ngZone.run(()=>s.next({target:y.target,isAutofilled:!0})))};return this._ngZone.runOutsideAngular(()=>{i.addEventListener("animationstart",m,OF),i.classList.add("cdk-text-field-autofill-monitored")}),this._monitoredElements.set(i,{subject:s,unlisten:()=>{i.removeEventListener("animationstart",m,OF)}}),s}stopMonitoring(e){const i=xm(e),r=this._monitoredElements.get(i);r&&(r.unlisten(),r.subject.complete(),i.classList.remove("cdk-text-field-autofill-monitored"),i.classList.remove("cdk-text-field-autofilled"),this._monitoredElements.delete(i))}ngOnDestroy(){this._monitoredElements.forEach((e,i)=>this.stopMonitoring(i))}}return n.\u0275fac=function(e){return new(e||n)(ze(cs),ze(qn))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),tI=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({}),n})();const FF=new Et("SBB_INPUT_VALUE_ACCESSOR");let fX=0;const mX=["button","checkbox","file","hidden","image","radio","range","reset","submit"],gX=nS(class{constructor(n,t,e,i){this._defaultErrorStateMatcher=n,this._parentForm=t,this._parentFormGroup=e,this.ngControl=i,this.stateChanges=new Zt}});let Zb=(()=>{class n extends gX{constructor(e,i,r,s,d,m,y,C,M){super(m,s,d,r),this._elementRef=e,this._platform=i,this.ngControl=r,this._autofillMonitor=C,this.focused=!1,this.controlType="sbb-input",this.autofilled=!1,this._disabled=!1,this.id="sbb-native-input-"+fX++,this._required=!1,this._type="text",this._readonly=!1,this._neverEmptyInputTypes=["date","datetime","datetime-local","month","time","week"].filter(q=>UL().has(q)),this._iOSKeyupListener=q=>{const Q=q.target;!Q.value&&0===Q.selectionStart&&0===Q.selectionEnd&&(Q.setSelectionRange(1,1),Q.setSelectionRange(0,0))};const k=this._elementRef.nativeElement,z=k.nodeName.toLowerCase();this._inputValueAccessor=y||k,this._previousNativeValue=this.value,i.IOS&&M.runOutsideAngular(()=>{e.nativeElement.addEventListener("keyup",this._iOSKeyupListener)}),this._isNativeSelect="select"===z,this._isTextarea="textarea"===z,this._isNativeSelect&&(this.controlType=k.multiple?"sbb-native-select-multiple":"sbb-native-select")}get disabled(){return this.ngControl&&null!==this.ngControl.disabled?this.ngControl.disabled:this._disabled}set disabled(e){this._disabled=jn(e),this.focused&&(this.focused=!1,this.stateChanges.next())}get required(){return this._required}set required(e){this._required=jn(e)}get type(){return this._type}set type(e){this._type=e||"text",this._validateType(),!this._isTextarea&&UL().has(this._type)&&(this._elementRef.nativeElement.type=this._type)}get value(){return this._inputValueAccessor.value}set value(e){e!==this.value&&(this._inputValueAccessor.value=e,this.stateChanges.next())}get readonly(){return this._readonly}set readonly(e){this._readonly=jn(e)}get empty(){return!(this._isNeverEmpty()||this._elementRef.nativeElement.value||this._isBadInput()||this.autofilled)}ngAfterViewInit(){this._platform.isBrowser&&this._autofillMonitor.monitor(this._elementRef.nativeElement).subscribe(e=>{this.autofilled=e.isAutofilled,this.stateChanges.next()}),this._platform.IOS&&this._elementRef.nativeElement.removeEventListener("keyup",this._iOSKeyupListener)}ngOnChanges(){this.stateChanges.next()}ngOnDestroy(){this.stateChanges.complete(),this._platform.isBrowser&&this._autofillMonitor.stopMonitoring(this._elementRef.nativeElement)}ngDoCheck(){this.ngControl&&this.updateErrorState(),this._dirtyCheckNativeValue()}focus(e){this._elementRef.nativeElement.focus(e)}_focusChanged(e){e!==this.focused&&(this.focused=e,this.stateChanges.next())}_dirtyCheckNativeValue(){const e=this._elementRef.nativeElement.value;this._previousNativeValue!==e&&(this._previousNativeValue=e,this.stateChanges.next())}_validateType(){mX.indexOf(this._type)}_isNeverEmpty(){return this._neverEmptyInputTypes.indexOf(this._type)>-1}_isBadInput(){const e=this._elementRef.nativeElement.validity;return e&&e.badInput}setDescribedByIds(e){e.length?this._elementRef.nativeElement.setAttribute("aria-describedby",e.join(" ")):this._elementRef.nativeElement.removeAttribute("aria-describedby")}onContainerClick(){this.focused||this.focus()}}return n.\u0275fac=function(e){return new(e||n)(G(Tn),G(cs),G(Hl,10),G(Mb,8),G(Ab,8),G(gD),G(FF,10),G(pX),G(qn))},n.\u0275dir=Lt({type:n,selectors:[["input","sbbInput",""],["select","sbbInput",""],["textarea","sbbInput",""]],hostAttrs:[1,"sbb-input-element"],hostVars:9,hostBindings:function(e,i){1&e&&Qt("focus",function(){return i._focusChanged(!0)})("blur",function(){return i._focusChanged(!1)}),2&e&&(vc("disabled",i.disabled)("required",i.required),fn("id",i.id)("name",i.name||null)("readonly",i.readonly&&!i._isNativeSelect||null)("aria-invalid",i.empty&&i.required?null:i.errorState)("aria-required",i.required)("placeholder",i.readonly?"-":i.placeholder||null)("tabindex",i.empty&&i.readonly?-1:null))},inputs:{disabled:"disabled",id:"id",placeholder:"placeholder",name:"name",required:"required",type:"type",errorStateMatcher:"errorStateMatcher",userAriaDescribedBy:["aria-describedby","userAriaDescribedBy"],value:"value",readonly:"readonly"},exportAs:["sbbInput"],features:[Vn([{provide:Nv,useExisting:n}]),qt,cr]}),n})(),NF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({imports:[tI,Wi,TS,tI,TS]}),n})();const bX=["sbb-calendar-body",""];function _X(n,t){1&n&&ln(0,"td",4),2&n&&fn("colspan",Yt(2).firstRowOffset)}function yX(n,t){if(1&n){const e=Io();oe(0,"td",5)(1,"button",6),Qt("click",function(){const s=Mi(e).$implicit;return Ai(Yt(2).cellClicked(s))})("focus",function(r){const d=Mi(e).$implicit;return Ai(Yt(2)._emitActiveDateChange(d,r))}),oe(2,"div",7),$e(3),de()()()}if(2&n){const e=t.$implicit,i=t.index,r=Yt().index,s=Yt();Zu("width",100/s.numCols,"%"),fn("data-sbb-row",r)("data-sbb-col",i),Le(1),Ri("sbb-calendar-body-disabled",!e.enabled)("sbb-calendar-body-active",s.isActiveCell(r,i))("sbb-calendar-body-range-background","range"===e.rangeBackground)("sbb-calendar-body-range-background-offset-start",null!==e.rangeBackground&&0===r&&s.firstRowOffset&&0===i)("sbb-calendar-body-selected-begin","begin"===e.rangeBackground)("sbb-calendar-body-selected-end","end"===e.rangeBackground)("sbb-calendar-body-selected",s.selectedValue===e.value)("sbb-calendar-body-today",s.todayValue===e.value),Je("tabindex",s.isActiveCell(r,i)?0:-1),fn("aria-label",e.ariaLabel)("aria-disabled",!e.enabled||null)("aria-pressed",s.selectedValue===e.value)("aria-current",s.todayValue===e.value?"date":null),Le(2),hi(e.displayValue)}}function vX(n,t){if(1&n&&(oe(0,"tr",1),$t(1,_X,1,1,"td",2),$t(2,yX,4,26,"td",3),de()),2&n){const e=t.$implicit,i=t.index,r=Yt();Le(1),Je("ngIf",0===i&&r.firstRowOffset),Le(1),Je("ngForOf",e)}}function xX(n,t){if(1&n&&(oe(0,"th")(1,"span",5),$e(2),de(),oe(3,"span",6),$e(4),de()()),2&n){const e=t.$implicit;Le(2),hi(e.long),Le(2),hi(e.narrow)}}function wX(n,t){}function SX(n,t){if(1&n){const e=Io();oe(0,"button",3),Qt("click",function(){return Mi(e),Ai(Yt().prevDay())}),ln(1,"sbb-icon",4),de()}if(2&n){const e=Yt();Je("disabled",e.disabled),fn("aria-label",e.prevDayAriaLabel)}}function CX(n,t){1&n&&ln(0,"sbb-datepicker-toggle")}function TX(n,t){if(1&n){const e=Io();oe(0,"button",5),Qt("click",function(){return Mi(e),Ai(Yt().nextDay())}),ln(1,"sbb-icon",6),de()}if(2&n){const e=Yt();Je("disabled",e.disabled),fn("aria-label",e.nextDayAriaLabel)}}const EX=["*"];class DX{constructor(t,e,i,r,s){this.value=t,this.displayValue=e,this.ariaLabel=i,this.enabled=r,this.rangeBackground=s}}let BF=(()=>{class n{constructor(e,i){this._elementRef=e,this._ngZone=i,this._focusActiveCellAfterViewChecked=!1,this.numCols=7,this.allowDisabledSelection=!1,this.activeCell=0,this.selectedValueChange=new nn,this.activeDateChange=new nn}ngAfterViewChecked(){this._focusActiveCellAfterViewChecked&&(this.focusActiveCell(),this._focusActiveCellAfterViewChecked=!1)}cellClicked(e){!this.allowDisabledSelection&&!e.enabled||this.selectedValueChange.emit(e.value)}_emitActiveDateChange(e,i){e.enabled&&this.activeDateChange.emit(e.value)}get firstRowOffset(){return this.rows&&this.rows.length&&this.rows[0].length?this.numCols-this.rows[0].length:0}isActiveCell(e,i){let r=e*this.numCols+i;return e&&(r-=this.firstRowOffset),r===this.activeCell}focusActiveCell(){this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.asObservable().pipe(Vr(1)).subscribe(()=>{setTimeout(()=>{const e=this._elementRef.nativeElement.querySelector(".sbb-calendar-body-active");e&&e.focus()})})})}_scheduleFocusActiveCellAfterViewChecked(){this._focusActiveCellAfterViewChecked=!0}}return n.\u0275fac=function(e){return new(e||n)(G(Tn),G(qn))},n.\u0275cmp=vn({type:n,selectors:[["","sbb-calendar-body",""]],hostAttrs:["role","grid",1,"sbb-calendar-body"],hostVars:1,hostBindings:function(e,i){2&e&&fn("aria-readonly",!0)},inputs:{label:"label",rows:"rows",todayValue:"todayValue",selectedValue:"selectedValue",labelMinRequiredCells:"labelMinRequiredCells",numCols:"numCols",allowDisabledSelection:"allowDisabledSelection",activeCell:"activeCell"},outputs:{selectedValueChange:"selectedValueChange",activeDateChange:"activeDateChange"},exportAs:["sbbCalendarBody"],attrs:bX,decls:1,vars:1,consts:[["role","row",4,"ngFor","ngForOf"],["role","row"],["class","sbb-calendar-body-label",4,"ngIf"],["role","gridcell","class","sbb-calendar-body-cell-container",3,"width",4,"ngFor","ngForOf"],[1,"sbb-calendar-body-label"],["role","gridcell",1,"sbb-calendar-body-cell-container"],["type","button",1,"sbb-calendar-body-cell","sbb-button-reset-frameless",3,"tabindex","click","focus"],[1,"sbb-calendar-body-cell-content"]],template:function(e,i){1&e&&$t(0,vX,3,2,"tr",0),2&e&&Je("ngForOf",i.rows)},dependencies:[Sc,Ts],encapsulation:2,changeDetection:0}),n})();function Rm(n){return Error(`SbbDatepicker: No provider found for ${n}.`)}class zF{constructor(t,e){this.start=t,this.end=e}}const nI=new Et("SBB_DATEPICKER");let VF=(()=>{class n{constructor(e,i,r,s,d){if(this._dateAdapter=e,this.locale=i,this._changeDetectorRef=r,this._dateFormats=s,this.selectedChange=new nn,this.userSelection=new nn,this.activeDateChange=new nn,this.dateRange=null,!this._dateAdapter)throw Rm("DateAdapter");if(!this._dateFormats)throw Rm("SBB_DATE_FORMATS");d&&d.connected&&d.datepickerInput.value&&d.connected.datepickerInput.value?this.dateRange=new zF(d.datepickerInput.value,d.connected.datepickerInput.value):d&&d.main&&d.datepickerInput.value&&d.main.datepickerInput.value&&(this.dateRange=new zF(d.main.datepickerInput.value,d.datepickerInput.value));const m=this._dateAdapter.getFirstDayOfWeek(),y=this._dateAdapter.getDayOfWeekNames("narrow"),M=this._dateAdapter.getDayOfWeekNames("long").map((k,z)=>({long:k,narrow:y[z]}));this.weekdays=M.slice(m).concat(M.slice(0,m)),this._activeDate=this._dateAdapter.today()}get activeDate(){return this._activeDate}set activeDate(e){const i=this._activeDate,r=this._getValidDateOrNull(this._dateAdapter.deserialize(e))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(r,this.minDate,this.maxDate),this._hasSameMonthAndYear(i,this._activeDate)||this.init()}get selected(){return this._selected}set selected(e){this._selected=this._getValidDateOrNull(this._dateAdapter.deserialize(e)),this.selectedDate=this._getDateInCurrentMonth(this._selected)}get minDate(){return this._minDate}set minDate(e){this._minDate=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get maxDate(){return this._maxDate}set maxDate(e){this._maxDate=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}ngAfterContentInit(){this.init()}dateSelected(e){if(this.selectedDate!==e){const i=this._getDateFromDayOfMonth(e);this.selectedChange.emit(i)}this.userSelection.emit()}_updateActiveDate(e){const i=this._activeDate;this.activeDate=this._getDateFromDayOfMonth(e),this._dateAdapter.compareDate(i,this.activeDate)&&this.activeDateChange.emit(this._activeDate)}handleCalendarBodyKeydown(e){const i=this._activeDate;switch(e.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,1);break;case 38:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,-7);break;case 40:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,7);break;case 36:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,1-this._dateAdapter.getDate(this._activeDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,this._dateAdapter.getNumDaysInMonth(this._activeDate)-this._dateAdapter.getDate(this._activeDate));break;case 33:this.activeDate=e.altKey?this._dateAdapter.addCalendarYears(this._activeDate,-1):this._dateAdapter.addCalendarMonths(this._activeDate,-1);break;case 34:this.activeDate=e.altKey?this._dateAdapter.addCalendarYears(this._activeDate,1):this._dateAdapter.addCalendarMonths(this._activeDate,1);break;case 13:return void((!this.dateFilter||this.dateFilter(this._activeDate))&&(this.dateSelected(this._dateAdapter.getDate(this._activeDate)),this.userSelection.emit(),e.preventDefault()));default:return}this._dateAdapter.compareDate(i,this.activeDate)&&(this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked()),e.preventDefault()}init(){this.selectedDate=this._getDateInCurrentMonth(this.selected),this.todayDate=this._getDateInCurrentMonth(this._dateAdapter.today()),this.monthLabel=this._dateAdapter.getMonthNames("short")[this._dateAdapter.getMonth(this.activeDate)].toLocaleUpperCase();const e=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),1);this.firstWeekOffset=(7+this._dateAdapter.getDayOfWeek(e)-this._dateAdapter.getFirstDayOfWeek())%7,this._createWeekCells(),this._changeDetectorRef.markForCheck()}focusActiveCell(){this.sbbCalendarBody.focusActiveCell()}_focusActiveCellAfterViewChecked(){this.sbbCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_getDateFromDayOfMonth(e){return this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),e)}_createWeekCells(){const e=this._dateAdapter.getNumDaysInMonth(this.activeDate),i=this._dateAdapter.getDateNames();this.weeks=[[]];for(let r=0,s=this.firstWeekOffset;r<e;r++,s++){7===s&&(this.weeks.push([]),s=0);const d=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),r+1),m=this._shouldEnableDate(d),y=this._dateAdapter.format(d,this._dateFormats.dateA11yLabel),C=this._shouldApplyRangeBackground(d);this.weeks[this.weeks.length-1].push(new DX(r+1,i[r],y,m,C))}}_shouldApplyRangeBackground(e){return this.dateRange&&this.dateRange.start&&this.dateRange.end&&!this._dateAdapter.sameDate(this.dateRange.start,this.dateRange.end)?this._dateAdapter.compareDate(e,this.dateRange.start)>0&&this._dateAdapter.compareDate(e,this.dateRange.end)<0?"range":this._isRangeLimit(e):null}_isRangeLimit(e){return 0===this._dateAdapter.compareDate(e,this.dateRange.start)?"begin":0===this._dateAdapter.compareDate(e,this.dateRange.end)?"end":null}_shouldEnableDate(e){return!!e&&(!this.dateFilter||this.dateFilter(e))&&(!this.minDate||this._dateAdapter.compareDate(e,this.minDate)>=0)&&(!this.maxDate||this._dateAdapter.compareDate(e,this.maxDate)<=0)}_getDateInCurrentMonth(e){return e&&this._hasSameMonthAndYear(e,this.activeDate)?this._dateAdapter.getDate(e):null}_hasSameMonthAndYear(e,i){return!(!e||!i||this._dateAdapter.getMonth(e)!==this._dateAdapter.getMonth(i)||this._dateAdapter.getYear(e)!==this._dateAdapter.getYear(i))}_getValidDateOrNull(e){return this._dateAdapter.isDateInstance(e)&&this._dateAdapter.isValid(e)?e:null}}return n.\u0275fac=function(e){return new(e||n)(G(Op,8),G(Vl),G(Sr),G(iS,8),G(nI,8))},n.\u0275cmp=vn({type:n,selectors:[["sbb-month-view"]],viewQuery:function(e,i){if(1&e&&ur(BF,7),2&e){let r;Nn(r=Bn())&&(i.sbbCalendarBody=r.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter"},outputs:{selectedChange:"selectedChange",userSelection:"userSelection",activeDateChange:"activeDateChange"},exportAs:["sbbMonthView"],decls:7,vars:7,consts:[[1,"sbb-calendar-table"],[1,"sbb-calendar-table-header"],[4,"ngFor","ngForOf"],["colspan","7","aria-hidden","true",1,"sbb-calendar-table-header-divider"],["sbb-calendar-body","",3,"label","rows","todayValue","selectedValue","labelMinRequiredCells","activeCell","selectedValueChange","activeDateChange","keydown"],[1,"cdk-visually-hidden"],["aria-hidden","true"]],template:function(e,i){1&e&&(oe(0,"table",0)(1,"thead",1)(2,"tr"),$t(3,xX,5,2,"th",2),de(),oe(4,"tr"),ln(5,"th",3),de()(),oe(6,"tbody",4),Qt("selectedValueChange",function(s){return i.dateSelected(s)})("activeDateChange",function(s){return i._updateActiveDate(s)})("keydown",function(s){return i.handleCalendarBodyKeydown(s)}),de()()),2&e&&(Le(3),Je("ngForOf",i.weekdays),Le(3),Va("label",i.monthLabel),Je("rows",i.weeks)("todayValue",i.todayDate)("selectedValue",i.selectedDate)("labelMinRequiredCells",3)("activeCell",i._dateAdapter.getDate(i.activeDate)-1))},dependencies:[Sc,BF],encapsulation:2,changeDetection:0}),n})(),IX=(()=>{class n{constructor(e,i,r){this._dateAdapter=e,this._labelSwitchToPreviousMonth=$localize`:Button label to switch to the previous month@@sbbDatepickerSwitchToPreviousMonth:Change to the previous month`,this._labelSwitchToNextMonth=$localize`:Button label to switch to the next month@@sbbDatepickerSwitchToNextMonth:Change to the next month`,this._labelSwitchToPreviousYear=$localize`:Button label to switch to the previous year@@sbbDatepickerSwitchToPreviousYear:Change to the previous year`,this._labelSwitchToNextYear=$localize`:Button label to switch to the next year@@sbbDatepickerSwitchToNextYear:Change to the next year`,this.calendar=i,this.calendar.stateChanges.subscribe(()=>r.markForCheck())}get monthText(){return this._dateAdapter.getMonthName(this.calendar.activeDate)}get yearText(){return this._dateAdapter.getYearName(this.calendar.activeDate)}previousMonthClicked(){const e=this._dateAdapter.addCalendarMonths(this.calendar.activeDate,-1);this._assignActiveDate(e)}nextMonthClicked(){const e=this._dateAdapter.addCalendarMonths(this.calendar.activeDate,1);this._assignActiveDate(e)}previousMonthEnabled(){return!this.calendar.minDate||!this._isSameMonthView(this.calendar.activeDate,this.calendar.minDate)}nextMonthEnabled(){return!this.calendar.maxDate||!this._isSameMonthView(this.calendar.activeDate,this.calendar.maxDate)}_isSameMonthView(e,i){return this._dateAdapter.getYear(e)===this._dateAdapter.getYear(i)&&this._dateAdapter.getMonth(e)===this._dateAdapter.getMonth(i)}previousYearClicked(){const e=this._dateAdapter.addCalendarYears(this.calendar.activeDate,-1);this._assignActiveDate(e)}nextYearClicked(){const e=this._dateAdapter.addCalendarYears(this.calendar.activeDate,1);this._assignActiveDate(e)}previousYearEnabled(){return!this.calendar.minDate||!this._isSameYearView(this.calendar.activeDate,this.calendar.minDate)}nextYearEnabled(){return!this.calendar.maxDate||!this._isSameYearView(this.calendar.activeDate,this.calendar.maxDate)}_isSameYearView(e,i){return this._dateAdapter.getYear(e)===this._dateAdapter.getYear(i)}_assignActiveDate(e){this.calendar.activeDate=this.calendar.minDate&&this._dateAdapter.compareDate(this.calendar.minDate,e)>0?this.calendar.minDate:this.calendar.maxDate&&this._dateAdapter.compareDate(this.calendar.maxDate,e)<0?this.calendar.maxDate:e}}return n.\u0275fac=function(e){return new(e||n)(G(Op,8),G(Ni(()=>rI)),G(Sr))},n.\u0275cmp=vn({type:n,selectors:[["sbb-calendar-header"]],hostAttrs:[1,"sbb-calendar-header","sbb-icon-scaled"],exportAs:["sbbCalendarHeader"],decls:15,vars:12,consts:[[1,"sbb-calendar-controls"],[1,"sbb-calendar-controls-months"],["type","button",1,"sbb-calendar-controls-button","sbb-calendar-controls-button-previous",3,"disabled","click"],["svgIcon","kom:chevron-small-left-small"],["aria-live","polite",1,"sbb-calendar-controls-label"],["type","button",1,"sbb-calendar-controls-button","sbb-calendar-controls-button-next",3,"disabled","click"],["svgIcon","kom:chevron-small-right-small"],[1,"sbb-calendar-controls-years"]],template:function(e,i){1&e&&(oe(0,"div",0)(1,"div",1)(2,"button",2),Qt("click",function(){return i.previousMonthClicked()}),ln(3,"sbb-icon",3),de(),oe(4,"span",4),$e(5),de(),oe(6,"button",5),Qt("click",function(){return i.nextMonthClicked()}),ln(7,"sbb-icon",6),de()(),oe(8,"div",7)(9,"button",2),Qt("click",function(){return i.previousYearClicked()}),ln(10,"sbb-icon",3),de(),oe(11,"span",4),$e(12),de(),oe(13,"button",5),Qt("click",function(){return i.nextYearClicked()}),ln(14,"sbb-icon",6),de()()()),2&e&&(Le(2),Je("disabled",!i.previousMonthEnabled()),fn("aria-label",i._labelSwitchToPreviousMonth),Le(2),fn("aria-label",i.monthText),Le(1),hi(i.monthText),Le(1),Je("disabled",!i.nextMonthEnabled()),fn("aria-label",i._labelSwitchToNextMonth),Le(3),Je("disabled",!i.previousYearEnabled()),fn("aria-label",i._labelSwitchToPreviousYear),Le(2),fn("aria-label",i.yearText),Le(1),hi(i.yearText),Le(1),Je("disabled",!i.nextYearEnabled()),fn("aria-label",i._labelSwitchToNextYear))},dependencies:[qa],encapsulation:2,changeDetection:0}),n})(),rI=(()=>{class n{constructor(e,i,r){if(this._dateAdapter=e,this._dateFormats=i,this._changeDetectorRef=r,this._moveFocusOnNextTick=!1,this.selectedChange=new nn,this.userSelection=new nn,this.stateChanges=new Zt,!this._dateAdapter)throw Rm("DateAdapter");if(!this._dateFormats)throw Rm("SBB_DATE_FORMATS")}get startAt(){return this._startAt}set startAt(e){this._startAt=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get selected(){return this._selected}set selected(e){this._selected=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get minDate(){return this._minDate}set minDate(e){this._minDate=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get maxDate(){return this._maxDate}set maxDate(e){this._maxDate=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get activeDate(){return this._clampedActiveDate}set activeDate(e){this._clampedActiveDate=this._dateAdapter.clampDate(e,this.minDate,this.maxDate),this.stateChanges.next()}ngAfterContentInit(){this.calendarHeaderPortal=new od(this.headerComponent||IX),this.activeDate=this.startAt||this._dateAdapter.today()}ngAfterViewChecked(){this._moveFocusOnNextTick&&(this._moveFocusOnNextTick=!1,this.focusActiveCell())}ngOnDestroy(){this.stateChanges.complete()}ngOnChanges(e){const i=e.minDate&&!this._dateAdapter.sameDate(e.minDate.previousValue,e.minDate.currentValue)?e.minDate:void 0,r=e.maxDate&&!this._dateAdapter.sameDate(e.maxDate.previousValue,e.maxDate.currentValue)?e.maxDate:void 0,s=i||r||e.dateFilter;if(s&&!s.firstChange){const d=this._getCurrentViewComponent();d&&(this._changeDetectorRef.detectChanges(),d.init())}this.stateChanges.next()}focusActiveCell(){this._getCurrentViewComponent().focusActiveCell()}dateSelected(e){e&&!this._dateAdapter.sameDate(e,this.selected)&&this.selectedChange.emit(e)}userSelected(){this.userSelection.emit()}_getValidDateOrNull(e){return this._dateAdapter.isDateInstance(e)&&this._dateAdapter.isValid(e)?e:null}_getCurrentViewComponent(){return this.monthView}}return n.\u0275fac=function(e){return new(e||n)(G(Op,8),G(iS,8),G(Sr))},n.\u0275cmp=vn({type:n,selectors:[["sbb-calendar"]],viewQuery:function(e,i){if(1&e&&ur(VF,7),2&e){let r;Nn(r=Bn())&&(i.monthView=r.first)}},hostAttrs:[1,"sbb-calendar"],inputs:{headerComponent:"headerComponent",startAt:"startAt",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter"},outputs:{selectedChange:"selectedChange",userSelection:"userSelection"},exportAs:["sbbCalendar"],features:[cr],decls:3,vars:6,consts:[[3,"cdkPortalOutlet"],["cdkMonitorSubtreeFocus","","tabindex","-1",1,"sbb-calendar-content"],[3,"activeDate","selected","dateFilter","maxDate","minDate","activeDateChange","selectedChange","userSelection"]],template:function(e,i){1&e&&($t(0,wX,0,0,"ng-template",0),oe(1,"div",1)(2,"sbb-month-view",2),Qt("activeDateChange",function(s){return i.activeDate=s})("selectedChange",function(s){return i.dateSelected(s)})("userSelection",function(){return i.userSelected()}),de()()),2&e&&(Je("cdkPortalOutlet",i.calendarHeaderPortal),Le(2),Je("activeDate",i.activeDate)("selected",i.selected)("dateFilter",i.dateFilter)("maxDate",i.maxDate)("minDate",i.minDate))},dependencies:[sd,jG,VF],encapsulation:2,changeDetection:0}),n})(),MX=(()=>{class n{ngAfterViewInit(){this.calendar.focusActiveCell()}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=vn({type:n,selectors:[["sbb-datepicker-content"]],viewQuery:function(e,i){if(1&e&&ur(rI,7),2&e){let r;Nn(r=Bn())&&(i.calendar=r.first)}},hostAttrs:[1,"sbb-datepicker-content"],exportAs:["sbbDatepickerContent"],decls:1,vars:10,consts:[["cdkTrapFocus","","role","dialog",1,"sbb-datepicker-content-container",3,"id","ngClass","startAt","minDate","maxDate","dateFilter","headerComponent","selected","selectedChange","userSelection"]],template:function(e,i){if(1&e&&(oe(0,"sbb-calendar",0),Qt("selectedChange",function(s){return i.datepicker.select(s)})("userSelection",function(){return i.datepicker.close()}),de()),2&e){let r;Je("id",i.datepicker.id)("ngClass",i.datepicker.panelClass)("startAt",i.datepicker.startAt)("minDate",i.datepicker.minDate)("maxDate",i.datepicker.maxDate)("dateFilter",i.datepicker.dateFilter)("headerComponent",i.datepicker.calendarHeaderComponent)("selected",i.datepicker.selected),fn("aria-modal",!0)("aria-labelledby",null!==(r=i._dialogLabelId)&&void 0!==r?r:void 0)}},dependencies:[Tb,DG,rI],styles:['.sbb-datepicker-content{position:relative;top:var(--sbb-datepicker-content-offset);font-size:var(--sbb-font-size)}.sbb-datepicker-panel-above .sbb-datepicker-content{top:auto;bottom:var(--sbb-datepicker-content-offset)}.sbb-datepicker-content::after{top:var(--sbb-datepicker-calendar-arrow-offset);left:calc(var(--sbb-datepicker-button-offset) + var(--sbb-border-width));content:"";height:var(--sbb-datepicker-calendar-arrow-width);width:var(--sbb-datepicker-calendar-arrow-width);position:absolute;pointer-events:none;transform:rotate(-135deg);background-color:var(--sbb-color-background);border:var(--sbb-border-width) solid rgba(0,0,0,0);border-right-color:var(--sbb-color-weak-accent);border-bottom-color:var(--sbb-color-weak-accent);clip-path:polygon(-0.4px 100%, 100% -0.4px, 100% 100%)}.sbb-datepicker-with-arrows .sbb-datepicker-content::after{left:calc(var(--sbb-datepicker-button-offset) + var(--sbb-border-width) + var(--sbb-icon-size-default) + var(--sbb-datepicker-button-gap))}.sbb-datepicker-panel-above .sbb-datepicker-content::after{top:auto;bottom:var(--sbb-datepicker-calendar-arrow-offset);transform:rotate(45deg);clip-path:var(--sbb-box-shadow-arrow-clip-path);box-shadow:var(--sbb-box-shadow-arrow-width) var(--sbb-box-shadow-arrow-width) 0 var(--sbb-box-shadow-arrow-width) var(--sbb-box-shadow-color)}.sbb-calendar{display:block;max-width:100%;width:var(--sbb-datepicker-calendar-width);height:var(--sbb-datepicker-calendar-height);background-color:var(--sbb-color-background);border:var(--sbb-border-width) solid var(--sbb-color-weak-accent);border-radius:var(--sbb-border-radius);box-shadow:var(--sbb-box-shadow-below)}.sbb-calendar-header{display:block;border-bottom:var(--sbb-border-width-thin) solid var(--sbb-datepicker-calendar-line-color)}.sbb-calendar-controls{display:flex;height:var(--sbb-datepicker-calendar-header-height);align-items:center}.sbb-calendar-controls-months,.sbb-calendar-controls-years{display:flex;height:var(--sbb-datepicker-calendar-header-height);flex:1 0 50%;text-align:center;position:relative}.sbb-calendar-controls-months::after{content:"";display:block;position:absolute;width:0;height:100%;top:0;right:0;border-right:var(--sbb-border-width-thin) solid var(--sbb-datepicker-calendar-line-color)}.sbb-calendar-controls-button{background:none;max-width:none;min-width:0;padding:0;margin:0;border:none;display:flex;align-items:center;justify-content:center;flex-shrink:0;flex-grow:0;outline:0;padding-left:var(--sbb-datepicker-calendar-controls-padding);padding-right:var(--sbb-datepicker-calendar-controls-padding);height:var(--sbb-datepicker-calendar-header-height);cursor:pointer;color:var(--sbb-datepicker-calendar-header-color)}.sbb-calendar-controls-button:is(:hover,:focus,:active){color:var(--sbb-color-call-to-action-hover)}.sbb-calendar-controls-button:disabled{cursor:default;opacity:0}.sbb-calendar-controls-button-previous{float:left;padding-right:0}.sbb-calendar-controls-button-next{float:right;padding-left:0}.sbb-calendar-controls-label{flex-grow:1;flex-shrink:1;font-family:var(--sbb-font-light);font-size:1.4rem;line-height:3.2;color:var(--sbb-datepicker-calendar-header-color)}@media all and (min-width: 40.1875em){:where(html:not(.sbb-lean)) .sbb-calendar-controls-label{font-size:var(--sbb-font-size-large)}}:where(html.sbb-lean) .sbb-calendar-controls-label{font-size:var(--sbb-font-size);line-height:2.4rem}.sbb-calendar-content{padding:0 var(--sbb-datepicker-calendar-table-content-padding-width)}.sbb-calendar-table{width:100%;border-spacing:0;border-collapse:collapse;margin:0;position:relative}.sbb-calendar-table :is(td,th){color:var(--sbb-color-weak-accent);font-size:var(--sbb-font-size);line-height:1.5}.sbb-calendar-table-header::after{content:"";display:block;position:absolute;top:calc(2.2rem * var(--sbb-scaling-factor));border-bottom:var(--sbb-border-width-thin) solid var(--sbb-datepicker-calendar-line-color);width:calc(100% + var(--sbb-datepicker-calendar-table-content-padding-width)*2);left:calc(var(--sbb-datepicker-calendar-table-content-padding-width)*-1)}.sbb-calendar-table-header tr th{font-family:var(--sbb-font-roman);font-weight:400;font-size:var(--sbb-font-size-small);text-transform:uppercase;padding:calc(0.4666666667rem * var(--sbb-scaling-factor));color:var(--sbb-datepicker-calendar-header-color)}.sbb-calendar-table-header-divider{height:calc(1rem * var(--sbb-scaling-factor))}.sbb-calendar-body-cell-container{position:relative;height:0;padding:0;line-height:0;text-align:center}.sbb-calendar-body-cell{position:relative;top:0;left:0;width:100%;height:100%;background:none;text-align:center;outline:none;font-family:inherit;margin:0;cursor:pointer}.sbb-calendar-body-cell:is(.sbb-calendar-body-range-background,.sbb-calendar-body-selected-begin,.sbb-calendar-body-selected-end)::before{position:absolute;top:12.5%;left:12.5%;display:flex;align-items:center;justify-content:center;width:var(--sbb-datepicker-calendar-body-cell-size);height:var(--sbb-datepicker-calendar-body-cell-size);line-height:1;padding-left:calc(0.0666666667rem * var(--sbb-scaling-factor));padding-bottom:calc(0.0666666667rem * var(--sbb-scaling-factor));content:"";background-color:var(--sbb-datepicker-calendar-table-range-bg-color);width:100%;left:0}:is(.sbb-calendar-body-cell-container:is(:last-child,:first-child)>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell:is(.sbb-calendar-body-selected-begin,.sbb-calendar-body-selected-end,.sbb-calendar-body-range-background-offset-start))::before{width:50%}:is(.sbb-calendar-body-cell-container:first-child>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell:is(.sbb-calendar-body-selected-begin,.sbb-calendar-body-range-background-offset-start))::before{left:auto;right:0}:is(.sbb-calendar-body-cell-container:is(:last-child,:first-child)>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell.sbb-calendar-body-range-background-offset-start)::after{position:absolute;top:12.5%;left:12.5%;display:flex;align-items:center;justify-content:center;width:var(--sbb-datepicker-calendar-body-cell-size);height:var(--sbb-datepicker-calendar-body-cell-size);line-height:1;padding-left:calc(0.0666666667rem * var(--sbb-scaling-factor));padding-bottom:calc(0.0666666667rem * var(--sbb-scaling-factor));content:"";background-color:var(--sbb-datepicker-calendar-table-range-bg-color)}:is(.sbb-calendar-body-cell-container:first-child>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell.sbb-calendar-body-range-background-offset-start)::after{border-radius:50% 0 0 50%}.sbb-calendar-body-cell-container:last-child>.sbb-calendar-body-cell.sbb-calendar-body-range-background::after{border-radius:0 50% 50% 0}:is(.sbb-calendar-body-cell-container:first-child:last-child>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell-container:last-child>.sbb-calendar-body-cell:is(.sbb-calendar-body-range-background-offset-start,.sbb-calendar-body-selected-begin),.sbb-calendar-body-cell-container:first-child>.sbb-calendar-body-cell.sbb-calendar-body-selected-end,.sbb-calendar-body-cell.sbb-calendar-body-range-background-offset-start.sbb-calendar-body-selected-end)::before{display:none}:is(.sbb-calendar-body-cell-container:first-child:last-child>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell-container:last-child>.sbb-calendar-body-cell:is(.sbb-calendar-body-range-background-offset-start,.sbb-calendar-body-selected-begin),.sbb-calendar-body-cell-container:first-child>.sbb-calendar-body-cell.sbb-calendar-body-selected-end,.sbb-calendar-body-cell.sbb-calendar-body-range-background-offset-start.sbb-calendar-body-selected-end)::after{border-radius:50%}.sbb-calendar-body-cell,.sbb-calendar-body-label{padding-top:var(--sbb-datepicker-calendar-body-cell-padding);padding-bottom:var(--sbb-datepicker-calendar-body-cell-padding)}.sbb-calendar-body-cell.sbb-calendar-body-disabled{color:var(--sbb-color-cement);cursor:default}:where(html.sbb-lean) .sbb-calendar-body-cell.sbb-calendar-body-disabled{color:var(--sbb-color-storm)}.sbb-calendar-body-cell.sbb-calendar-body-disabled::after{content:"";width:calc(2.1333333333rem * var(--sbb-scaling-factor));height:calc(0.0666666667rem * var(--sbb-scaling-factor));top:calc(1.6666666667rem * var(--sbb-scaling-factor));left:calc(50% - var(--sbb-datepicker-calendar-body-cell-disabled-offset));background-color:var(--sbb-color-cement);display:block;position:absolute;transform:rotate(-45deg)}:where(html.sbb-lean) .sbb-calendar-body-cell.sbb-calendar-body-disabled::after{background-color:var(--sbb-color-storm);width:1.6rem;top:1.2rem}.sbb-calendar-body-today{font-family:var(--sbb-font-bold);color:var(--sbb-color-black)}.sbb-calendar-body-cell-content{position:absolute;top:12.5%;left:12.5%;display:flex;align-items:center;justify-content:center;width:var(--sbb-datepicker-calendar-body-cell-size);height:var(--sbb-datepicker-calendar-body-cell-size);line-height:1;padding-left:calc(0.0666666667rem * var(--sbb-scaling-factor));padding-bottom:calc(0.0666666667rem * var(--sbb-scaling-factor));border:var(--sbb-border-width) solid rgba(0,0,0,0);border-radius:50%;z-index:1}.sbb-calendar-body-cell:not(.sbb-calendar-body-disabled):is(:hover,:focus) .sbb-calendar-body-cell-content{background-color:var(--sbb-color-background);color:var(--sbb-color-call-to-action-hover);border-color:var(--sbb-color-call-to-action-hover)}:is(.sbb-calendar-body-cell:not(.sbb-calendar-body-disabled).sbb-calendar-body-selected,.sbb-calendar-body-selected-begin,.sbb-calendar-body-selected-end) .sbb-calendar-body-cell-content{background-color:var(--sbb-color-background);color:var(--sbb-color-weak-accent);border-color:var(--sbb-color-weak-accent)}'],encapsulation:2,changeDetection:0}),n})(),AX=(()=>{class n{constructor(e,i,r){this._changeDetectorRef=e,this._datepicker=i,this._labelShowCalendar=$localize`:Open calendar@@sbbDatepickerOpenCalendar:Show calendar`,this._stateChanges=te.EMPTY;const s=Number(r);this.tabIndex=s||0===s?s:null}get disabled(){return void 0===this._disabled?this._datepicker.disabled:this._disabled}set disabled(e){this._disabled=jn(e)}ngOnChanges(e){e.datepicker&&this._watchStateChanges()}ngOnDestroy(){this._stateChanges.unsubscribe()}ngAfterContentInit(){this._watchStateChanges()}open(e){this._datepicker&&!this.disabled&&(this._datepicker.open(),e.stopPropagation())}_watchStateChanges(){const e=this._datepicker?this._datepicker.disabledChange:Rn(),i=this._datepicker&&this._datepicker.datepickerInput?this._datepicker.datepickerInput.disabledChange:Rn(),r=this._datepicker?Er(this._datepicker.openedStream,this._datepicker.closedStream):Rn();this._stateChanges.unsubscribe(),this._stateChanges=Er(e,i,r).subscribe(()=>this._changeDetectorRef.markForCheck())}}return n.\u0275fac=function(e){return new(e||n)(G(Sr),G(nI),Uo("tabindex"))},n.\u0275cmp=vn({type:n,selectors:[["sbb-datepicker-toggle"]],hostAttrs:[1,"sbb-datepicker-toggle"],hostVars:3,hostBindings:function(e,i){2&e&&(fn("tabindex",null),Ri("sbb-datepicker-toggle-active",i._datepicker&&i._datepicker.opened))},inputs:{tabIndex:"tabIndex",disabled:"disabled"},features:[cr],decls:2,vars:3,consts:[["aria-haspopup","true","type","button",1,"sbb-datepicker-toggle-button","sbb-icon-scaled",3,"disabled","click"],["svgIcon","kom:calendar-small"]],template:function(e,i){1&e&&(oe(0,"button",0),Qt("click",function(s){return i.open(s)}),ln(1,"sbb-icon",1),de()),2&e&&(Je("disabled",i.disabled),fn("aria-label",i._labelShowCalendar)("tabindex",i.disabled?-1:i.tabIndex))},dependencies:[qa],encapsulation:2,changeDetection:0}),n})(),kX=0;const jF=new Et("sbb-datepicker-scroll-strategy"),PX={provide:jF,deps:[Bo],useFactory:function RX(n){return()=>n.scrollStrategies.reposition()}};let oI=(()=>{class n{constructor(e,i,r,s,d,m,y){if(this._overlay=e,this._ngZone=i,this._viewContainerRef=r,this._changeDetectorRef=s,this._scrollStrategy=d,this._dateAdapter=m,this.locale=y,this._arrows=!1,this._toggle=!0,this.openedStream=new nn,this.closedStream=new nn,this._opened=!1,this.id="sbb-datepicker-"+kX++,this._validSelected=null,this.nextDayAriaLabel=$localize`:Next day button's aria-label@@sbbDatePickerNextDayAriaLabel:Next day`,this.prevDayAriaLabel=$localize`:Previous day button's aria-label@@sbbDatePickerPrevDayAriaLabel:Previous day`,this._focusedElementBeforeOpen=null,this._inputSubscription=te.EMPTY,this._inputChangeSubscription=te.EMPTY,this._connectedDatepickerSubscription=te.EMPTY,this._posStrategySubscription=te.EMPTY,this.disabledChange=new Zt,this.selectedChanged=new Zt,!this._dateAdapter)throw Rm("DateAdapter");this._dateAdapter.setLocale(y)}get startAt(){return this._startAt||(this.datepickerInput?this.datepickerInput.value:null)}set startAt(e){this._startAt=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get disabled(){return void 0===this._disabled&&this.datepickerInput?this.datepickerInput.disabled:!!this._disabled}set disabled(e){const i=jn(e);i!==this._disabled&&(this._disabled=i,this.disabledChange.next(i))}set connected(e){e!==this._connected&&this._connected&&(this._connected.main=null),e&&(e.main=this),this._connected=e}get connected(){return this._connected}get arrows(){return this._arrows}set arrows(e){this._arrows=jn(e)}get arrowsVisible(){var e;return this.arrows&&!(null!==(e=this.datepickerInput)&&void 0!==e&&e.readonly)}get toggle(){return this._toggle}set toggle(e){this._toggle=jn(e)}set notoggle(e){this._toggle=!jn(e)}get toggleVisible(){var e;return this.toggle&&!(null!==(e=this.datepickerInput)&&void 0!==e&&e.readonly)}get opened(){return this._opened}set opened(e){jn(e)?this.open():this.close()}get selected(){return this._validSelected}set selected(e){this._validSelected=e,this._changeDetectorRef.markForCheck()}get minDate(){return this.datepickerInput&&this.datepickerInput.min}get maxDate(){return this.datepickerInput&&this.datepickerInput.max}get dateFilter(){return this.datepickerInput&&this.datepickerInput.dateFilter}get prevDayActive(){return this.arrowsVisible&&this.datepickerInput&&!!this.datepickerInput.value&&(!this.minDate||this._dateAdapter.compareDate(this.datepickerInput.value,this.minDate)>0)}get nextDayActive(){return this.arrowsVisible&&this.datepickerInput&&!!this.datepickerInput.value&&(!this.maxDate||this._dateAdapter.compareDate(this.datepickerInput.value,this.maxDate)<0)}ngOnDestroy(){this.close(),this._inputSubscription.unsubscribe(),this._inputChangeSubscription.unsubscribe(),this._connectedDatepickerSubscription.unsubscribe(),this.disabledChange.complete(),this.popupRef&&(this._posStrategySubscription.unsubscribe(),this.popupRef.dispose(),this._popupComponentRef=null)}select(e){const i=this.selected;this.selected=e,this._dateAdapter.sameDate(i,this.selected)||this.selectedChanged.next(e)}nextDay(){this.selected&&(this.selected=this._dateAdapter.addCalendarDays(this.selected,1),this.selectedChanged.next(this.selected))}prevDay(){this.selected&&(this.selected=this._dateAdapter.addCalendarDays(this.selected,-1),this.selectedChanged.next(this.selected))}registerInput(e){if(this.datepickerInput)throw Error("A SbbDatepicker can only be associated with a single input.");this.datepickerInput=e,this._inputSubscription=this.datepickerInput.valueChange.subscribe(i=>this.selected=i),this._inputChangeSubscription=Er(this.datepickerInput.disabledChange,this.datepickerInput.readonlyChange).subscribe(()=>this._changeDetectorRef.markForCheck()),this._connectedDatepickerSubscription=Er(this.openedStream.pipe(ov("opened")),this.selectedChanged.pipe(ov("selected")),this.closedStream.pipe(ov("closed"))).pipe(function iX(n,t=null){return t=null!=t?t:n,Di((e,i)=>{let r=[],s=0;e.subscribe(Ci(i,d=>{let m=null;s++%t==0&&r.push([]);for(const y of r)y.push(d),n<=y.length&&(m=null!=m?m:[],m.push(y));if(m)for(const y of m)p(r,y),i.next(y)},()=>{for(const d of r)i.next(d);i.complete()},void 0,()=>{r=null}))})}(3,1),Cr(([i,r,s])=>!!this.connected&&!!this.datepickerInput.value&&"opened"===i&&"selected"===r&&"closed"===s&&(!this.connected.datepickerInput.value||this._dateAdapter.compareDate(this.datepickerInput.value,this.connected.datepickerInput.value)>0)),No(()=>{this.connected.datepickerInput.value&&(this.connected.datepickerInput.value=null,this.connected.datepickerInput._cvaOnChange(null))})).subscribe(()=>this.connected.open())}open(){if(!this._opened&&!this.disabled){if(!this.datepickerInput)throw Error("Attempted to open an SbbDatepicker with no associated input.");this._focusedElementBeforeOpen=su(),this._openAsPopup(),this._opened=!0,this.openedStream.emit()}}close(){if(!this._opened)return;this.popupRef&&this.popupRef.hasAttached()&&this.popupRef.detach(),this._calendarPortal&&this._calendarPortal.isAttached&&this._calendarPortal.detach();const e=()=>{this._opened&&(this._opened=!1,this.closedStream.emit(),this._focusedElementBeforeOpen=null)};this._focusedElementBeforeOpen&&"function"==typeof this._focusedElementBeforeOpen.focus?(this._focusedElementBeforeOpen.focus(),setTimeout(e)):e()}_getPanelClasses(){return["sbb-datepicker-panel",this.arrows?"sbb-datepicker-with-arrows":"sbb-datepicker-no-arrows"]}_openAsPopup(){this._calendarPortal||(this._calendarPortal=new od(MX,this._viewContainerRef)),this.popupRef?this.popupRef.getConfig().panelClass=this._getPanelClasses():this._createPopup(),this.popupRef.hasAttached()||(this._popupComponentRef=this.popupRef.attach(this._calendarPortal),this._popupComponentRef.instance.datepicker=this,this._popupComponentRef.instance._dialogLabelId=this.datepickerInput.getOverlayLabelId(),this._ngZone.onStable.asObservable().pipe(Vr(1)).subscribe(()=>{this.popupRef.updatePosition()}))}_createPopup(){const e=new Mm({positionStrategy:this._createPopupPositionStrategy(),hasBackdrop:!0,backdropClass:"sbb-overlay-transparent-backdrop",scrollStrategy:this._scrollStrategy(),panelClass:this._getPanelClasses()});this.popupRef=this._overlay.create(e),Er(this.popupRef.backdropClick(),this.popupRef.detachments(),this.popupRef.keydownEvents().pipe(Cr(i=>27===i.keyCode||this.datepickerInput&&i.altKey&&38===i.keyCode))).subscribe(()=>this.close())}_createPopupPositionStrategy(){const e=this._overlay.position().flexibleConnectedTo(this.datepickerInput.getConnectedOverlayOrigin()).withTransformOriginOn(".sbb-datepicker-content").withFlexibleDimensions(!1).withViewportMargin(8).withPush(!1).withPositions([{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom"}]);return this._posStrategySubscription=e.positionChanges.subscribe(i=>{"top"===i.connectionPair.originY?this.popupRef.hostElement.classList.add("sbb-datepicker-panel-above"):this.popupRef.hostElement.classList.remove("sbb-datepicker-panel-above")}),e}_getValidDateOrNull(e){return this._dateAdapter.isDateInstance(e)&&this._dateAdapter.isValid(e)?e:null}}return n.\u0275fac=function(e){return new(e||n)(G(Bo),G(qn),G(Fo),G(Sr),G(jF),G(Op,8),G(Vl))},n.\u0275cmp=vn({type:n,selectors:[["sbb-datepicker"]],hostAttrs:[1,"sbb-datepicker"],hostVars:6,hostBindings:function(e,i){2&e&&Ri("sbb-datepicker-arrows-enabled",i.arrowsVisible)("sbb-datepicker-toggle-enabled",i.toggleVisible)("sbb-datepicker-disabled",i.disabled)},inputs:{calendarHeaderComponent:"calendarHeaderComponent",startAt:"startAt",disabled:"disabled",panelClass:"panelClass",connected:"connected",arrows:"arrows",toggle:"toggle",notoggle:"notoggle",opened:"opened",nextDayAriaLabel:"nextDayAriaLabel",prevDayAriaLabel:"prevDayAriaLabel"},outputs:{openedStream:"opened",closedStream:"closed"},exportAs:["sbbDatepicker"],features:[Vn([{provide:nI,useExisting:n}])],ngContentSelectors:EX,decls:4,vars:3,consts:[["type","button","class","sbb-datepicker-arrow-button sbb-datepicker-arrow-button-left sbb-icon-scaled",3,"disabled","click",4,"ngIf"],[4,"ngIf"],["type","button","class","sbb-datepicker-arrow-button sbb-datepicker-arrow-button-right sbb-icon-scaled",3,"disabled","click",4,"ngIf"],["type","button",1,"sbb-datepicker-arrow-button","sbb-datepicker-arrow-button-left","sbb-icon-scaled",3,"disabled","click"],["svgIcon","kom:chevron-small-left-small"],["type","button",1,"sbb-datepicker-arrow-button","sbb-datepicker-arrow-button-right","sbb-icon-scaled",3,"disabled","click"],["svgIcon","kom:chevron-small-right-small"]],template:function(e,i){1&e&&(Mo(),$t(0,SX,2,2,"button",0),$t(1,CX,1,0,"sbb-datepicker-toggle",1),Pr(2),$t(3,TX,2,2,"button",2)),2&e&&(Je("ngIf",i.prevDayActive),Le(1),Je("ngIf",i.toggleVisible),Le(2),Je("ngIf",i.nextDayActive))},dependencies:[Ts,qa,AX],styles:[".sbb-datepicker{display:inline-block;position:relative;color:var(--sbb-color-weak-accent)}.sbb-form-field .sbb-datepicker{width:100%}.sbb-datepicker-disabled{color:var(--sbb-color-granite)}.sbb-datepicker>.sbb-date-input{width:100%}:is(.sbb-datepicker-toggle-enabled,.sbb-datepicker-arrows-enabled)>.sbb-date-input{padding-left:var(--sbb-datepicker-toggle-or-arrows-padding)}.sbb-datepicker-arrows-enabled>.sbb-date-input{padding-right:var(--sbb-datepicker-toggle-or-arrows-padding)}.sbb-datepicker-arrows-enabled.sbb-datepicker-toggle-enabled>.sbb-date-input{padding-left:var(--sbb-datepicker-toggle-and-arrows-padding)}:is(.sbb-datepicker-arrow-button,.sbb-datepicker-toggle-button){background:none;max-width:none;min-width:0;padding:0;margin:0;border:none;position:absolute;top:50%;transform:translateY(-50%);outline:0;color:inherit;line-height:0}:is(.sbb-datepicker-arrow-button,.sbb-datepicker-toggle-button):not(:disabled){cursor:pointer}:is(.sbb-datepicker-arrow-button,.sbb-datepicker-toggle-button):not(:disabled):is(:hover,:focus,:active){color:var(--sbb-color-call-to-action-hover)}.sbb-datepicker-arrow-button-left,.sbb-datepicker-toggle-button{left:var(--sbb-datepicker-button-offset)}.sbb-datepicker-arrows-enabled .sbb-datepicker-toggle-button{left:var(--sbb-datepicker-adjacent-button-offset)}.sbb-datepicker-arrow-button-right{right:var(--sbb-datepicker-button-offset)}"],encapsulation:2,changeDetection:0}),n})();class ES{constructor(t,e){this.target=t,this.targetElement=e,this.value=this.target.value}}const LX={provide:Ha,useExisting:Ni(()=>DS),multi:!0},OX={provide:Us,useExisting:Ni(()=>DS),multi:!0};let DS=(()=>{class n{constructor(e,i,r,s,d){if(this._elementRef=e,this._dateAdapter=i,this._dateFormats=r,this._datepicker=s,this._formField=d,this._disabled=!1,this._readonly=!1,this.dateChange=new nn,this.dateInput=new nn,this.inputBlurred=new nn,this.valueChange=new nn,this.disabledChange=new nn,this.readonlyChange=new nn,this._datepickerSubscription=te.EMPTY,this._lastValueValid=!1,this._onTouched=()=>{},this._cvaOnChange=()=>{},this._validatorOnChange=()=>{},this._parseValidator=()=>this._lastValueValid?null:{sbbDateParse:{text:this._elementRef.nativeElement.value}},this._minValidator=m=>{const y=this._getValidDateOrNull(this._dateAdapter.deserialize(m.value));return!this.min||!y||this._dateAdapter.compareDate(this.min,y)<=0?null:{sbbDateMin:{min:this.min,actual:y}}},this._maxValidator=m=>{const y=this._getValidDateOrNull(this._dateAdapter.deserialize(m.value));return!this.max||!y||this._dateAdapter.compareDate(this.max,y)>=0?null:{sbbDateMax:{max:this.max,actual:y}}},this._filterValidator=m=>{const y=this._getValidDateOrNull(this._dateAdapter.deserialize(m.value));return this._dateFilter&&y&&!this._dateFilter(y)?{sbbDateFilter:!0}:null},this._validator=YT.compose([this._parseValidator,this._minValidator,this._maxValidator,this._filterValidator]),!this._dateAdapter)throw Rm("DateAdapter");if(!this._dateFormats)throw Rm("SBB_DATE_FORMATS")}set dateFilter(e){this._dateFilter=e,this._validatorOnChange()}get dateFilter(){return this._dateFilter}get value(){return this._value}set value(e){e=this._dateAdapter.deserialize(e),this._lastValueValid=!e||this._dateAdapter.isValid(e),e=this._getValidDateOrNull(e);const i=this.value;this._value=e,this._formatValue(e),this._dateAdapter.sameDate(i,e)||this.valueChange.emit(e)}get min(){return this._min||(this._datepicker&&this._datepicker.main&&this._datepicker.main.datepickerInput&&this._datepicker.main.datepickerInput.value?this._datepicker.main.datepickerInput.value:null)}set min(e){this._min=this._getValidDateOrNull(this._dateAdapter.deserialize(e)),this._validatorOnChange()}get max(){return this._max}set max(e){this._max=this._getValidDateOrNull(this._dateAdapter.deserialize(e)),this._validatorOnChange()}get disabled(){return this._disabled}set disabled(e){const i=jn(e),r=this._elementRef.nativeElement;this._disabled!==i&&(this._disabled=i,this.disabledChange.emit(i)),i&&r.blur&&r.blur()}get readonly(){return this._readonly}set readonly(e){this._readonly=jn(e),this.readonlyChange.next(this._readonly)}ngOnInit(){!this._datepicker||(this._datepicker.registerInput(this),this._datepickerSubscription.unsubscribe(),this._datepickerSubscription=this._datepicker.selectedChanged.subscribe(e=>{this.value=e,this._cvaOnChange(e),this._onTouched(),this.dateInput.emit(new ES(this,this._elementRef.nativeElement)),this.dateChange.emit(new ES(this,this._elementRef.nativeElement))}))}ngOnDestroy(){this._datepickerSubscription.unsubscribe(),this.valueChange.complete(),this.disabledChange.complete()}registerOnValidatorChange(e){this._validatorOnChange=e}validate(e){return this._validator?this._validator(e):null}getConnectedOverlayOrigin(){return this._elementRef}writeValue(e){this.value=e}registerOnChange(e){this._cvaOnChange=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this.disabled=e}_onKeydown(e){this._datepicker&&e.altKey&&40===e.keyCode&&(this._datepicker.open(),e.preventDefault())}_onInput(e){let i=this._dateAdapter.parse(e);this._lastValueValid=!i||this._dateAdapter.isValid(i),i=this._getValidDateOrNull(i),this._dateAdapter.sameDate(i,this._value)?this._validatorOnChange():(this._value=i,this._cvaOnChange(i),this.valueChange.emit(i),this.dateInput.emit(new ES(this,this._elementRef.nativeElement)))}_onChange(){this.dateChange.emit(new ES(this,this._elementRef.nativeElement))}_onBlur(){this.value&&this._formatValue(this.value),this._onTouched(),this.inputBlurred.emit()}_formatValue(e){var i;const r=this._datepicker?this._dateFormats.dateInput:null!==(i=this._dateFormats.dateInputPure)&&void 0!==i?i:this._dateFormats.dateInput;this._elementRef.nativeElement.value=null!=e?this._dateAdapter.format(e,r):""}_getValidDateOrNull(e){return this._dateAdapter.isDateInstance(e)&&this._dateAdapter.isValid(e)?e:null}getOverlayLabelId(){return this._formField?this._formField.getLabelId():this._elementRef.nativeElement.getAttribute("aria-labelledby")}}return n.\u0275fac=function(e){return new(e||n)(G(Tn),G(Op,8),G(iS,8),G(oI,8),G(CS,8))},n.\u0275dir=Lt({type:n,selectors:[["input","sbbDateInput",""]],hostAttrs:[1,"sbb-date-input"],hostVars:5,hostBindings:function(e,i){1&e&&Qt("keydown",function(s){return i._onKeydown(s)})("input",function(s){return i._onInput(s.target.value)})("change",function(){return i._onChange()})("blur",function(){return i._onBlur()}),2&e&&(vc("disabled",i.disabled),fn("aria-haspopup",i._datepicker?"dialog":null)("aria-owns",(null==i._datepicker?null:i._datepicker.opened)&&i._datepicker.id||null)("min",i.min?i._dateAdapter.toIso8601(i.min):null)("max",i.max?i._dateAdapter.toIso8601(i.max):null))},inputs:{dateFilter:"dateFilter",value:"value",min:"min",max:"max",disabled:"disabled",readonly:"readonly"},outputs:{dateChange:"dateChange",dateInput:"dateInput",inputBlurred:"inputBlurred"},exportAs:["sbbDateInput"],features:[Vn([LX,OX,{provide:FF,useExisting:n}])]}),n})(),UF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({providers:[PX,{provide:Op,useClass:TO},{provide:iS,useValue:Eq}],imports:[gr,oa,Sm,bl,Wi,mo]}),n})();const FX=["input"],NX=["*"];let BX=0;const zX={provide:Ha,useExisting:Ni(()=>aI),multi:!0};class HF{constructor(t,e){this.source=t,this.value=e}}const $F=new Et("SbbRadioGroup"),sI=new Et("SbbRadioButton");let VX=(()=>{class n{constructor(e){this._changeDetector=e,this.change=new nn,this._value=null,this._name="sbb-radio-group-"+BX++,this._selected=null,this._isInitialized=!1,this._disabled=!1,this._required=!1,this._controlValueAccessorChangeFn=()=>{},this._onTouched=()=>{}}get name(){return this._name}set name(e){this._name=e,this._updateRadioButtonNames()}get value(){return this._value}set value(e){this._value!==e&&(this._value=e,this._updateSelectedRadioFromValue(),this._checkSelectedRadioButton())}get selected(){return this._selected}set selected(e){this._selected=e,this.value=e?e.value:null,this._checkSelectedRadioButton()}get disabled(){return this._disabled}set disabled(e){this._disabled=jn(e),this._markRadiosForCheck()}get required(){return this._required}set required(e){this._required=jn(e),this._markRadiosForCheck()}_checkSelectedRadioButton(){this._selected&&!this._selected.checked&&(this._selected.checked=!0)}ngAfterContentInit(){this._isInitialized=!0}_touch(){this._onTouched&&this._onTouched()}_emitChangeEvent(){this._isInitialized&&this.change.emit(new HF(this._selected,this._value))}_markRadiosForCheck(){this._radios&&this._radios.forEach(e=>e._markForCheck())}writeValue(e){this.value=e,this._changeDetector.markForCheck()}registerOnChange(e){this._controlValueAccessorChangeFn=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this.disabled=e,this._changeDetector.markForCheck()}_updateRadioButtonNames(){this._radios&&this._radios.forEach(e=>{e.name=this.name,e._markForCheck()})}_updateSelectedRadioFromValue(){this._radios&&(null===this._selected||this._selected.value!==this._value)&&(this._selected=null,this._radios.forEach(i=>{i.checked=this.value===i.value,i.checked&&(this._selected=i)}))}}return n.\u0275fac=function(e){return new(e||n)(G(Sr))},n.\u0275dir=Lt({type:n,contentQueries:function(e,i,r){if(1&e&&zr(r,sI,5),2&e){let s;Nn(s=Bn())&&(i._radios=s)}},hostAttrs:[1,"sbb-radio-group-base"],inputs:{name:"name",value:"value",selected:"selected",disabled:"disabled",required:"required"},outputs:{change:"change"}}),n})(),aI=(()=>{class n extends VX{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Vi(n)))(i||n)}}(),n.\u0275dir=Lt({type:n,selectors:[["sbb-radio-group"]],contentQueries:function(e,i,r){if(1&e&&zr(r,sI,5),2&e){let s;Nn(s=Bn())&&(i._radios=s)}},hostAttrs:["role","radiogroup",1,"sbb-radio-group"],exportAs:["sbbRadioGroup"],features:[Vn([zX,{provide:$F,useExisting:n}]),qt]}),n})();const UX=$b(class jX{});let HX=0,$X=(()=>{class n extends UX{constructor(e,i,r,s,d,m){super(),this._elementRef=i,this._changeDetector=r,this._focusMonitor=s,this._radioDispatcher=d,this._uniqueId="sbb-radio-button-"+ ++HX,this.id=this._uniqueId,this.change=new nn,this._checked=!1,this._value=null,this._removeUniqueSelectionListener=()=>{},this.radioGroup=e,m&&(this.tabIndex=gh(m,0)),this._removeUniqueSelectionListener=d.listen((y,C)=>{y!==this.id&&C===this.name&&(this.checked=!1)})}get checked(){return this._checked}set checked(e){const i=jn(e);this._checked!==i&&(this._checked=i,i&&this.radioGroup&&this.radioGroup.value!==this.value?this.radioGroup.selected=this:!i&&this.radioGroup&&this.radioGroup.value===this.value&&(this.radioGroup.selected=null),i&&this._radioDispatcher.notify(this.id,this.name),this._changeDetector.markForCheck())}get value(){return this._value}set value(e){this._value!==e&&(this._value=e,null!==this.radioGroup&&(this.checked||(this.checked=this.radioGroup.value===e),this.checked&&(this.radioGroup.selected=this)))}get disabled(){return this._disabled||null!==this.radioGroup&&this.radioGroup.disabled}set disabled(e){this._setDisabled(jn(e))}get required(){return this._required||this.radioGroup&&this.radioGroup.required}set required(e){this._required=jn(e)}get inputId(){return`${this.id||this._uniqueId}-input`}focus(e,i){i?this._focusMonitor.focusVia(this._inputElement,i,e):this._inputElement.nativeElement.focus(e)}_markForCheck(){this._changeDetector.markForCheck()}ngOnInit(){this.radioGroup&&(this.checked=this.radioGroup.value===this._value,this.checked&&(this.radioGroup.selected=this),this.name=this.radioGroup.name)}ngDoCheck(){this._updateTabIndex()}ngAfterViewInit(){this._updateTabIndex(),this._focusMonitor.monitor(this._elementRef,!0).subscribe(e=>{!e&&this.radioGroup&&this.radioGroup._touch()})}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._removeUniqueSelectionListener()}_emitChangeEvent(){this.change.emit(new HF(this,this._value))}_onInputClick(e){e.stopPropagation()}_onInputChange(e){null==e||e.stopPropagation();const i=this.radioGroup&&this.value!==this.radioGroup.value;this.checked=!0,this._emitChangeEvent(),this.radioGroup&&(this.radioGroup._controlValueAccessorChangeFn(this.value),i&&this.radioGroup._emitChangeEvent())}_setDisabled(e){this._disabled!==e&&(this._disabled=e,this._changeDetector.markForCheck())}_updateTabIndex(){var e;const i=this.radioGroup;let r;if(r=i&&i.selected&&!this.disabled?i.selected===this?this.tabIndex:-1:this.tabIndex,r!==this._previousTabIndex){const s=null===(e=this._inputElement)||void 0===e?void 0:e.nativeElement;s&&(s.setAttribute("tabindex",r+""),this._previousTabIndex=r)}}}return n.\u0275fac=function(e){Qc()},n.\u0275dir=Lt({type:n,viewQuery:function(e,i){if(1&e&&ur(FX,5),2&e){let r;Nn(r=Bn())&&(i._inputElement=r.first)}},hostVars:1,hostBindings:function(e,i){2&e&&fn("id",i.id)},inputs:{id:"id",name:"name",ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],ariaDescribedby:["aria-describedby","ariaDescribedby"],checked:"checked",value:"value",disabled:"disabled",required:"required"},outputs:{change:"change"},features:[qt]}),n})(),GF=(()=>{class n extends $X{constructor(e,i,r,s,d,m){super(e,i,r,s,d,m)}}return n.\u0275fac=function(e){return new(e||n)(G($F,8),G(Tn),G(Sr),G(fa),G(jD),Uo("tabindex"))},n.\u0275cmp=vn({type:n,selectors:[["sbb-radio-button"]],hostAttrs:[1,"sbb-radio-button","sbb-selection-item"],hostVars:9,hostBindings:function(e,i){1&e&&Qt("focus",function(){return i._inputElement.nativeElement.focus()}),2&e&&(fn("tabindex",null)("id",i.id)("aria-label",null)("aria-labelledby",null)("aria-describedby",null),Ri("sbb-selection-checked",i.checked)("sbb-selection-disabled",i.disabled))},inputs:{tabIndex:"tabIndex"},exportAs:["sbbRadioButton"],features:[Vn([{provide:sI,useExisting:n}]),qt],ngContentSelectors:NX,decls:9,vars:11,consts:[[1,"sbb-selection-item-label"],["type","radio",1,"sbb-selection-input","sbb-radio-input","sbb-transparent-parent-overlay",3,"id","checked","disabled","tabIndex","required","change","click"],["input",""],[1,"sbb-selection-container"],[1,"sbb-selection-container-checked"],[1,"sbb-selection-content"],[2,"display","none"]],template:function(e,i){1&e&&(Mo(),oe(0,"label",0)(1,"input",1,2),Qt("change",function(s){return i._onInputChange(s)})("click",function(s){return i._onInputClick(s)}),de(),oe(3,"div",3),ln(4,"div",4),de(),oe(5,"div",5)(6,"span",6),$e(7,"\xa0"),de(),Pr(8),de()()),2&e&&(fn("for",i.inputId),Le(1),Je("id",i.inputId)("checked",i.checked)("disabled",i.disabled)("tabIndex",i.tabIndex)("required",i.required),fn("name",i.name)("value",i.value)("aria-label",i.ariaLabel)("aria-labelledby",i.ariaLabelledby)("aria-describedby",i.ariaDescribedby))},encapsulation:2,changeDetection:0}),n})(),lI=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({imports:[Wi]}),n})();const GX=/[0-9]{3,4}/,qX=/([0-9]{1,2})[.:,\-;_hH]?([0-9]{1,2})?/,WX=/([0-9]{1,2})([0-9]{2})/;let WF=(()=>{class n{constructor(e,i,r,s,d){this._elementRef=e,this._renderer=i,this._control=r,this._input=d,this._document=s,this.placeholder="HH:MM"}get placeholder(){return this._placeholder}set placeholder(e){this._placeholder=null!=e?e:"HH:MM",this._input&&(this._input.placeholder=this._placeholder)}_onBlur(e){const i=this._validateInput(e);if(!i||i.length<=2)return;const r=this._parseHour(i[1]),s=this._parseMinute(i[2]);if(this._control&&this._control.control)this._control.control.setValue(`${r}:${s}`);else{this._renderer.setProperty(this._elementRef.nativeElement,"value",`${r}:${s}`);const d=this._document.createEvent("Event");d.initEvent("input",!0,!0),this._elementRef.nativeElement.dispatchEvent(d)}}_validateInput(e){return GX.test(e)?e.match(WX):e?e.match(qX):null}_parseHour(e){return e.length>1?e:"0"+e}_parseMinute(e){return(e=e||"00").length>1?e:"0"+e}}return n.\u0275fac=function(e){return new(e||n)(G(Tn),G(hc),G(Hl,10),G($n),G(Zb,8))},n.\u0275dir=Lt({type:n,selectors:[["input","sbbTimeInput",""]],hostAttrs:["type","text","pattern","[0-9]*","inputmode","numeric",1,"sbb-time-input","sbb-input-element"],hostVars:1,hostBindings:function(e,i){1&e&&Qt("blur",function(s){return i._onBlur(s.target.value)}),2&e&&fn("placeholder",i.placeholder)},inputs:{placeholder:"placeholder"},exportAs:["sbbTimeInput"]}),n})(),XF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({imports:[Wi]}),n})();function ZF(n,t){return t?e=>rv(t.pipe(Vr(1),function XX(){return Di((n,t)=>{n.subscribe(Ci(t,Ue))})}()),e.pipe(ZF(n))):Gn((e,i)=>n(e,i).pipe(Vr(1),ov(e)))}const YX=["panel"];function KX(n,t){if(1&n&&(oe(0,"div",0,1),Pr(2),de()),2&n){const e=t.id,i=Yt();Je("id",i.id)("ngClass",i._classList),fn("aria-label",i.ariaLabel||null)("aria-labelledby",i._getPanelAriaLabelledby(e))}}const QX=["*"];let JX=0;class eZ{constructor(t,e){this.source=t,this.option=e}}const YF=new Et("sbb-autocomplete-default-options",{providedIn:"root",factory:function tZ(){return{autoActiveFirstOption:!1,autoSelectActiveOption:!1}}});let KF=(()=>{class n{constructor(e,i,r,s){this._changeDetectorRef=e,this._elementRef=i,this._activeOptionChanges=te.EMPTY,this._visibleClass="sbb-autocomplete-visible",this._hiddenClass="sbb-autocomplete-hidden",this._showPanel=new ta(!1),this._isOpen=!1,this.displayWith=null,this.localeNormalizer=null,this.optionSelected=new nn,this.opened=new nn,this.closed=new nn,this.optionActivated=new nn,this._classList={},this._showHintIfNoOptions=!1,this.id="sbb-autocomplete-"+JX++,this.inertGroups=(null==s?void 0:s.SAFARI)||!1,this._autoActiveFirstOption=!!r.autoActiveFirstOption,this._autoSelectActiveOption=!!r.autoSelectActiveOption}get showPanel(){return this._showPanel.value}get isOpen(){return this._isOpen&&this.showPanel}get autoActiveFirstOption(){return this._autoActiveFirstOption}set autoActiveFirstOption(e){this._autoActiveFirstOption=jn(e)}get autoSelectActiveOption(){return this._autoSelectActiveOption}set autoSelectActiveOption(e){this._autoSelectActiveOption=jn(e)}set classList(e){this._classList=e&&e.length?nD(e).reduce((i,r)=>(i[r]=!0,i),{}):{},this._setVisibilityClasses(this._classList),this._elementRef.nativeElement.className=""}get showHintIfNoOptions(){return this._showHintIfNoOptions}set showHintIfNoOptions(e){this._showHintIfNoOptions=jn(e)}ngAfterContentInit(){this._keyManager=new rO(this.options).withWrap(),this._activeOptionChanges=this._keyManager.change.subscribe(e=>{this.isOpen&&this.optionActivated.emit({source:this,option:this.options.toArray()[e]||null})}),this._setVisibility()}ngOnDestroy(){this._activeOptionChanges.unsubscribe()}_setScrollTop(e){this.panel&&(this.panel.nativeElement.scrollTop=e)}_getScrollTop(){return this.panel?this.panel.nativeElement.scrollTop:0}_setVisibility(){this._showPanel.next(!!this.options.length||!!this.hints.length&&this.showHintIfNoOptions),this._setVisibilityClasses(this._classList),this._changeDetectorRef.markForCheck()}_emitSelectEvent(e){const i=new eZ(this,e);this.optionSelected.emit(i)}_getPanelAriaLabelledby(e){return this.ariaLabel?null:this.ariaLabelledby?(e?e+" ":"")+this.ariaLabelledby:e}_setVisibilityClasses(e){e[this._visibleClass]=this.showPanel,e[this._hiddenClass]=!this.showPanel}}return n.\u0275fac=function(e){return new(e||n)(G(Sr),G(Tn),G(YF),G(cs))},n.\u0275cmp=vn({type:n,selectors:[["sbb-autocomplete"]],contentQueries:function(e,i,r){if(1&e&&(zr(r,Tv,5),zr(r,bD,5),zr(r,Lq,5)),2&e){let s;Nn(s=Bn())&&(i.options=s),Nn(s=Bn())&&(i.optionGroups=s),Nn(s=Bn())&&(i.hints=s)}},viewQuery:function(e,i){if(1&e&&(ur(Qr,7),ur(YX,5)),2&e){let r;Nn(r=Bn())&&(i.template=r.first),Nn(r=Bn())&&(i.panel=r.first)}},hostAttrs:[1,"sbb-autocomplete"],inputs:{ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],displayWith:"displayWith",localeNormalizer:"localeNormalizer",autoActiveFirstOption:"autoActiveFirstOption",autoSelectActiveOption:"autoSelectActiveOption",panelWidth:"panelWidth",classList:["class","classList"],showHintIfNoOptions:"showHintIfNoOptions"},outputs:{optionSelected:"optionSelected",opened:"opened",closed:"closed",optionActivated:"optionActivated"},exportAs:["sbbAutocomplete"],features:[Vn([{provide:rS,useExisting:n}])],ngContentSelectors:QX,decls:1,vars:0,consts:[["role","listbox",1,"sbb-panel","sbb-panel-padded","sbb-autocomplete-panel","sbb-scrollbar",3,"id","ngClass"],["panel",""]],template:function(e,i){1&e&&(Mo(),$t(0,KX,3,4,"ng-template"))},dependencies:[Tb],styles:[".sbb-autocomplete-visible{visibility:visible}.sbb-autocomplete-hidden{visibility:hidden;padding:0 !important}:where(html:not(.sbb-lean)) .sbb-autocomplete-panel .sbb-menu-group .sbb-menu-item{padding-left:calc(0.9333333333rem * var(--sbb-scaling-factor))}"],encapsulation:2,changeDetection:0}),n})();const QF=new Et("sbb-autocomplete-scroll-strategy"),iZ={provide:QF,deps:[Bo],useFactory:function nZ(n){return()=>n.scrollStrategies.reposition()}};let IS=(()=>{class n{constructor(e,i,r,s,d,m,y,C,M,k){this._element=e,this._overlay=i,this._viewContainerRef=r,this._zone=s,this._changeDetectorRef=d,this._formField=y,this._document=C,this._viewportRuler=M,this._defaults=k,this._componentDestroyed=!1,this._autocompleteDisabled=!1,this._viewportSubscription=te.EMPTY,this._positionSubscription=te.EMPTY,this._highlightSubscription=te.EMPTY,this._connectedElementClassSubscription=te.EMPTY,this._inputValue=new ta(""),this._canOpenOnNextFocus=!0,this._closeKeyEventStream=new Zt,this._windowBlurHandler=()=>{this._canOpenOnNextFocus=this._document.activeElement!==this._element.nativeElement||this.panelOpen},this._onChange=()=>{},this._onTouched=()=>{},this.position="auto",this.autocompleteAttribute="off",this._aboveClass="sbb-autocomplete-panel-above",this._overlayAttached=!1,this.optionSelections=hm(()=>{const z=this.autocomplete?this.autocomplete.options:null;return z?z.changes.pipe(Ds(z),na(()=>Er(...z.map(q=>q.onSelectionChange)))):this._zone.onStable.pipe(Vr(1),na(()=>this.optionSelections))}),this._scrollStrategy=m}get autocomplete(){return this._autocomplete}set autocomplete(e){if(this._autocomplete=e,this._highlightSubscription.unsubscribe(),this._connectedElementClassSubscription.unsubscribe(),!e)return;const i=e.options?Rn(null):this._zone.onStable.pipe(Vr(1));this._highlightSubscription=i.pipe(na(()=>dm([this._inputValue,e.options.changes.pipe(Ds(e.options.toArray()))])),Cr(r=>!!r[1]&&!!r[1].length)).subscribe(([r,s])=>{s.forEach(d=>d._highlight(r,this.autocomplete.localeNormalizer))}),this._connectedElementClassSubscription=this.autocomplete._showPanel.pipe(Pp(),Cr(r=>!r)).subscribe(()=>{this._getConnectedElement().nativeElement.classList.remove("sbb-input-with-open-panel"),this._getConnectedElement().nativeElement.classList.remove("sbb-input-with-open-panel-above")})}get autocompleteDisabled(){return this._autocompleteDisabled}set autocompleteDisabled(e){this._autocompleteDisabled=jn(e)}ngAfterViewInit(){const e=this._getWindow();void 0!==e&&this._zone.runOutsideAngular(()=>e.addEventListener("blur",this._windowBlurHandler))}ngOnChanges(e){e.position&&this._positionStrategy&&(this._setStrategyPositions(this._positionStrategy),this.panelOpen&&this._overlayRef.updatePosition())}ngOnDestroy(){const e=this._getWindow();void 0!==e&&e.removeEventListener("blur",this._windowBlurHandler),this._viewportSubscription.unsubscribe(),this._positionSubscription.unsubscribe(),this._highlightSubscription.unsubscribe(),this._connectedElementClassSubscription.unsubscribe(),this._componentDestroyed=!0,this._destroyPanel(),this._closeKeyEventStream.complete()}get panelOpen(){return this._overlayAttached&&this.autocomplete.showPanel}openPanel(){this._attachOverlay()}closePanel(){!this._overlayAttached||(this.panelOpen&&this._zone.run(()=>{this.autocomplete.closed.emit()}),this.autocomplete._isOpen=this._overlayAttached=!1,this._pendingAutoselectedOption=null,this._overlayRef&&this._overlayRef.hasAttached()&&(this._overlayRef.detach(),this._closingActionsSubscription.unsubscribe()),this._getConnectedElement().nativeElement.classList.remove("sbb-input-with-open-panel"),this._getConnectedElement().nativeElement.classList.remove("sbb-input-with-open-panel-above"),this._componentDestroyed||this._changeDetectorRef.detectChanges())}updatePosition(){this._overlayAttached&&this._overlayRef.updatePosition()}get panelClosingActions(){return Er(this.optionSelections,this.autocomplete._keyManager.tabOut.pipe(Cr(()=>this._overlayAttached)),this._closeKeyEventStream,this._getOutsideClickStream(),this._overlayRef?this._overlayRef.detachments().pipe(Cr(()=>this._overlayAttached)):Rn()).pipe(W(e=>e instanceof DO?e:null))}get activeOption(){return this.autocomplete&&this.autocomplete._keyManager?this.autocomplete._keyManager.activeItem:null}_getOutsideClickStream(){return Er(au(this._document,"click"),au(this._document,"auxclick"),au(this._document,"touchend")).pipe(Cr(e=>{const i=Rp(e),r=this._formField?this._formField._elementRef.nativeElement:null,s=this.connectedTo?this.connectedTo.elementRef.nativeElement:null;return this._overlayAttached&&i!==this._element.nativeElement&&this._document.activeElement!==this._element.nativeElement&&(!r||!r.contains(i))&&(!s||!s.contains(i))&&!!this._overlayRef&&!this._overlayRef.overlayElement.contains(i)}))}writeValue(e){Promise.resolve(null).then(()=>this._assignOptionValue(e))}registerOnChange(e){this._onChange=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this._element.nativeElement.disabled=e}_handleKeydown(e){const i=e.keyCode,r=ra(e);if(27===i&&!r&&e.preventDefault(),this.activeOption&&13===i&&this.panelOpen&&!r)this.activeOption._selectViaInteraction(),this._resetActiveItem(),e.preventDefault();else if(this.autocomplete){const s=this.autocomplete._keyManager.activeItem,d=38===i||40===i;9===i||d&&!r&&this.panelOpen?this.autocomplete._keyManager.onKeydown(e):d&&this._canOpen()&&this.openPanel(),(d||this.autocomplete._keyManager.activeItem!==s)&&(this._scrollToOption(this.autocomplete._keyManager.activeItemIndex||0),this.autocomplete.autoSelectActiveOption&&this.activeOption&&(this._pendingAutoselectedOption||(this._valueBeforeAutoSelection=this._element.nativeElement.value),this._pendingAutoselectedOption=this.activeOption,this._assignOptionValue(this.activeOption.value)))}}_handleInput(e){const i=e.target;let r=i.value;"number"===i.type&&(r=""===r?null:parseFloat(r)),this._previousValue!==r&&(this._previousValue=r,this._pendingAutoselectedOption=null,this._onChange(r),this._inputValue.next(i.value),this._canOpen()&&this._document.activeElement===e.target&&this.openPanel())}_handleFocus(){this._canOpenOnNextFocus?this._canOpen()&&(this._previousValue=this._element.nativeElement.value,this._attachOverlay()):this._canOpenOnNextFocus=!0}_handleClick(){this._canOpen()&&!this.panelOpen&&this.openPanel()}_updateSize(){var e;null===(e=this._overlayRef)||void 0===e||e.updateSize({width:this._getPanelWidth()})}_subscribeToClosingActions(){const e=this._zone.onStable.pipe(Vr(1)),i=this.autocomplete.options.changes.pipe(No(()=>this._positionStrategy.reapplyLastPosition()),function ZX(n,t=Ww){const e=uD(n,t);return ZF(()=>e)}(0));return Er(e,i).pipe(na(()=>(this._zone.run(()=>{const r=this.panelOpen;if(this._resetActiveItem(),this.autocomplete._setVisibility(),this._changeDetectorRef.detectChanges(),this.panelOpen){const s=this.autocomplete.panel.nativeElement.scrollTop;this._overlayRef.updatePosition(),this.autocomplete.panel.nativeElement.scrollTop=s}r!==this.panelOpen&&(this.panelOpen?this.autocomplete.opened.emit():this.autocomplete.closed.emit())}),this.panelClosingActions)),Vr(1)).subscribe(r=>this._setValueAndClose(r))}_destroyPanel(){this._overlayRef&&(this.closePanel(),this._overlayRef.dispose(),this._overlayRef=null)}_assignOptionValue(e){const i=this.autocomplete&&this.autocomplete.displayWith?this.autocomplete.displayWith(e):e;this._updateNativeInputValue(null!=i?i:"")}_updateNativeInputValue(e){this._formField&&this._formField._control?this._formField._control.value=e:this._element.nativeElement.value=e,this._previousValue=e,this._inputValue.next(e)}_setValueAndClose(e){const i=e?e.source:this._pendingAutoselectedOption;i&&(this._clearPreviousSelectedOption(i),this._assignOptionValue(i.value),this._onChange(i.value),this.autocomplete._emitSelectEvent(i),this._element.nativeElement.focus()),this.closePanel()}_clearPreviousSelectedOption(e){this.autocomplete.options.forEach(i=>{i!==e&&i.selected&&i.deselect()})}_attachOverlay(){var e;let i=this._overlayRef;i?(this._positionStrategy.setOrigin(this._getConnectedElement()),i.updateSize({width:this._getPanelWidth()})):(this._portal=new Cm(this.autocomplete.template,this._viewContainerRef,{id:null===(e=this._formField)||void 0===e?void 0:e.getLabelId()}),i=this._overlay.create(this._getOverlayConfig()),this._overlayRef=i,this._positionStrategy&&(this._positionSubscription.unsubscribe(),this._positionSubscription=dm([this._positionStrategy.positionChanges,this.autocomplete._showPanel]).subscribe(([s,d])=>{this.autocomplete.panel&&d&&(this._getConnectedElement().nativeElement.classList.add("sbb-input-with-open-panel"),"top"===s.connectionPair.originY?(this.autocomplete.panel.nativeElement.classList.add("sbb-panel-above"),this._getConnectedElement().nativeElement.classList.add("sbb-input-with-open-panel-above")):(this.autocomplete.panel.nativeElement.classList.remove("sbb-panel-above"),this._getConnectedElement().nativeElement.classList.remove("sbb-input-with-open-panel-above")))})),this._handleOverlayEvents(i),this._viewportSubscription=this._viewportRuler.change().subscribe(()=>{this.panelOpen&&i&&i.updateSize({width:this._getPanelWidth()})})),i&&!i.hasAttached()&&(i.attach(this._portal),this._closingActionsSubscription=this._subscribeToClosingActions());const r=this.panelOpen;this.autocomplete._setVisibility(),this.autocomplete._isOpen=this._overlayAttached=!0,this.panelOpen&&r!==this.panelOpen&&this.autocomplete.opened.emit()}_getOverlayConfig(){var e;return new Mm({positionStrategy:this._getOverlayPosition(),scrollStrategy:this._scrollStrategy(),width:this._getPanelWidth(),panelClass:nD(null===(e=this._defaults)||void 0===e?void 0:e.overlayPanelClass).concat("sbb-overlay-panel"),minHeight:0})}_getOverlayPosition(){const e=this._overlay.position().flexibleConnectedTo(this._getConnectedElement()).withFlexibleDimensions(!0).withPush(!1);return this._setStrategyPositions(e),this._positionStrategy=e,e}_setStrategyPositions(e){const i=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"}],r=this._aboveClass,s=[{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom",panelClass:r},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom",panelClass:r}];let d;d="above"===this.position?s:"below"===this.position?i:[...i,...s],e.withPositions(d)}_getConnectedElement(){return this.connectedTo?this.connectedTo.elementRef:this._formField?this._formField.getConnectedOverlayOrigin():this._element}_getPanelWidth(){return this.autocomplete.panelWidth||this._getHostWidth()}_getHostWidth(){return this._getConnectedElement().nativeElement.getBoundingClientRect().width}_resetActiveItem(){const e=this.autocomplete;e.autoActiveFirstOption?e._keyManager.setFirstItemActive():e._keyManager.setActiveItem(-1)}_canOpen(){const e=this._element.nativeElement;return!e.readOnly&&!e.disabled&&!this.autocompleteDisabled}_getWindow(){var e;return(null===(e=this._document)||void 0===e?void 0:e.defaultView)||window}_scrollToOption(e){const i=this.autocomplete,r=function Rq(n,t,e){if(e.length){const i=t.toArray(),r=e.toArray();let s=0;for(let d=0;d<n+1;d++)i[d].group&&i[d].group===r[s]&&s++;return s}return 0}(e,i.options,i.optionGroups);if(0===e&&1===r)i._setScrollTop(0);else if(i.panel){const s=i.options.toArray()[e];if(s){const d=s._getHostElement(),m=IO(d.offsetTop,d.offsetHeight,i._getScrollTop(),i.panel.nativeElement.offsetHeight);i._setScrollTop(m)}}}_handleOverlayEvents(e){e.keydownEvents().subscribe(i=>{var r;(27===i.keyCode&&!ra(i)||38===i.keyCode&&ra(i,"altKey"))&&(this._pendingAutoselectedOption&&(this._updateNativeInputValue(null!==(r=this._valueBeforeAutoSelection)&&void 0!==r?r:""),this._pendingAutoselectedOption=null),this._closeKeyEventStream.next(),this._resetActiveItem(),i.stopPropagation(),i.preventDefault())}),e.outsidePointerEvents().subscribe()}}return n.\u0275fac=function(e){return new(e||n)(G(Tn),G(Bo),G(Fo),G(qn),G(Sr),G(QF),G(CS,9),G($n,8),G(lu),G(YF,8))},n.\u0275dir=Lt({type:n,selectors:[["input","sbbAutocomplete",""]],hostAttrs:[1,"sbb-autocomplete-trigger"],hostVars:9,hostBindings:function(e,i){1&e&&Qt("focusin",function(){return i._handleFocus()})("blur",function(){return i._onTouched()})("input",function(s){return i._handleInput(s)})("keydown",function(s){return i._handleKeydown(s)})("click",function(){return i._handleClick()}),2&e&&(fn("autocomplete",i.autocompleteAttribute)("role",i.autocompleteDisabled?null:"combobox")("aria-autocomplete",i.autocompleteDisabled?null:"list")("aria-activedescendant",i.panelOpen&&i.activeOption?i.activeOption.id:null)("aria-expanded",i.autocompleteDisabled?null:i.panelOpen.toString())("aria-owns",i.autocompleteDisabled||!i.panelOpen||null==i.autocomplete?null:i.autocomplete.id)("aria-haspopup",i.autocompleteDisabled?null:"listbox"),Ri("sbb-focused",i.panelOpen))},inputs:{autocomplete:["sbbAutocomplete","autocomplete"],position:["sbbAutocompletePosition","position"],connectedTo:["sbbAutocompleteConnectedTo","connectedTo"],autocompleteAttribute:["autocomplete","autocompleteAttribute"],autocompleteDisabled:["sbbAutocompleteDisabled","autocompleteDisabled"]},exportAs:["sbbAutocompleteTrigger"],features:[Vn([{provide:Ha,useExisting:Ni(()=>n),multi:!0}]),cr]}),n})(),JF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({providers:[iZ],imports:[gr,Sm,bl,Wi,oS,oS,bl]}),n})();function rZ(n,t){if(1&n&&(oe(0,"sbb-option",11),$e(1),de()),2&n){const e=t.$implicit,i=t.index;Je("value",Yt(2).$implicit[0]+"."+i),Le(1),wr(" ",e.computeLocationName()," ")}}function oZ(n,t){if(1&n&&(oe(0,"sbb-optgroup",9),$t(1,rZ,2,2,"sbb-option",10),de()),2&n){const e=Yt().$implicit,i=Yt();Je("label",e[1]),Le(1),Je("ngForOf",i.mapLookupLocations[e[0]])}}function sZ(n,t){if(1&n&&(Bl(0),$t(1,oZ,2,2,"sbb-optgroup",8),zl()),2&n){const e=t.$implicit,i=Yt();Le(1),Je("ngIf",i.mapLookupLocations[e[0]].length>0)}}class aZ{isErrorState(t,e){return!!(t&&t.invalid&&(t.dirty||t.touched||e&&e.submitted))}}let lZ=(()=>{class n{constructor(e,i){this.mapService=e,this.userTripService=i,this.shouldFetchNewData=!0,this.inputControl=new yw("",[YT.required]),this.inputControlMatcher=new aZ,this.placeholder="",this.endpointType="From",this.inputValue="",this.selectedLocation=new nn,this.mapLookupLocations={},this.resetMapLocations(),this.optionLocationTypes=[["stop","Stops"],["poi","POIs"],["topographicPlace","Topographic Places"],["address","Addresses"]]}ngOnInit(){this.inputControl.valueChanges.pipe(wv(500),Pp()).subscribe(e=>{if(null===e||!this.shouldFetchNewData)return;if(0===e.trim().length)return void this.selectedLocation.emit(null);if(e.length<2)return;const i=ao.initFromLiteralCoords(e);if(i)return this.resetMapLocations(),void this.handleCoordsPick(i);this.fetchJourneyPoints(e)})}ngOnChanges(e){if("inputValue"in e){const i=e.inputValue.currentValue;if(""===i)return;this.inputControl.setValue(i,{emitEvent:!1})}}onOpenAutocomplete(){this.shouldFetchNewData=!0}onOptionSelected(e){this.shouldFetchNewData=!1;const i=e.option.value.split(".");if(2!==i.length)return;const r=i[0],s=parseInt(i[1],10),d=this.mapLookupLocations[r][s],m=d.computeLocationName();this.inputControl.setValue(m),this.selectedLocation.emit(d)}fetchJourneyPoints(e){return Ke(this,void 0,void 0,function*(){let i=this.userTripService.getStageConfig();const s=yield $l.initWithLocationName(i,e).fetchResponse();this.resetMapLocations(),s.locations.forEach(d=>{const m=d.getLocationType();null!==m&&this.mapLookupLocations[m].push(d)})})}handleTapOnMapButton(){var e;const i="From"===this.endpointType?this.userTripService.fromTripLocation:this.userTripService.toTripLocation,r=null!==(e=null==i?void 0:i.location)&&void 0!==e?e:null;this.mapService.tryToCenterAndZoomToLocation(r)}handleCoordsPick(e){const i=e.geoPosition;if(null===i)return;const r=i.asLatLngString(!1);this.inputControl.setValue(r),this.selectedLocation.emit(e)}resetMapLocations(){this.mapLookupLocations={address:[],poi:[],stop:[],topographicPlace:[]}}}return n.\u0275fac=function(e){return new(e||n)(G(jp),G(Ic))},n.\u0275cmp=vn({type:n,selectors:[["journey-point-input"]],inputs:{placeholder:"placeholder",endpointType:"endpointType",inputValue:"inputValue"},outputs:{selectedLocation:"selectedLocation"},features:[cr],decls:11,vars:5,consts:[[1,"w-100","trip-endpoint"],[1,"endpoint-label",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","12","height","12","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-map"],["fill-rule","evenodd","d","M15.817.113A.5.5 0 0 1 16 .5v14a.5.5 0 0 1-.402.49l-5 1a.502.502 0 0 1-.196 0L5.5 15.01l-4.902.98A.5.5 0 0 1 0 15.5v-14a.5.5 0 0 1 .402-.49l5-1a.5.5 0 0 1 .196 0L10.5.99l4.902-.98a.5.5 0 0 1 .415.103zM10 1.91l-4-.8v12.98l4 .8V1.91zm1 12.98 4-.8V1.11l-4 .8v12.98zm-6-.8V1.11l-4 .8v12.98l4-.8z"],["sbbInput","","type","text",1,"trip-endpoint",3,"placeholder","formControl","sbbAutocomplete"],[3,"optionSelected","opened"],["journeyPoint","sbbAutocomplete"],[4,"ngFor","ngForOf"],[3,"label",4,"ngIf"],[3,"label"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(e,i){if(1&e&&(oe(0,"sbb-form-field",0)(1,"div",1),Qt("click",function(){return i.handleTapOnMapButton()}),F(),oe(2,"svg",2),ln(3,"path",3),de(),$e(4),de(),Y(),ln(5,"input",4),oe(6,"sbb-error"),$e(7,"Mandatory field, please complete."),de()(),oe(8,"sbb-autocomplete",5,6),Qt("optionSelected",function(s){return i.onOptionSelected(s)})("opened",function(){return i.onOpenAutocomplete()}),$t(10,sZ,2,1,"ng-container",7),de()),2&e){const r=Nl(9);Le(4),wr(" ",i.placeholder," "),Le(1),Je("placeholder",i.placeholder)("formControl",i.inputControl)("sbbAutocomplete",r),Le(5),Je("ngForOf",i.optionLocationTypes)}},dependencies:[Sc,Ts,id,uh,vw,Tv,bD,KF,IS,Bv,dX,Zb],styles:[".endpoint-label[_ngcontent-%COMP%]{font-size:12px}.endpoint-label[_ngcontent-%COMP%]:hover{cursor:pointer}"]}),n})();const cZ=["panel"];function uZ(n,t){if(1&n&&(oe(0,"span",7),$e(1),de()),2&n){const e=Yt();Le(1),hi(e.readonly?"-":e.placeholder||"\xa0")}}function dZ(n,t){if(1&n&&(oe(0,"span",8)(1,"span"),$e(2),de()()),2&n){const e=Yt();Le(2),hi(e.triggerValue||"\xa0")}}function hZ(n,t){1&n&&ln(0,"sbb-icon",9)}function pZ(n,t){1&n&&ln(0,"sbb-icon",10)}function fZ(n,t){if(1&n){const e=Io();oe(0,"div",11,12),Qt("@transformPanel.done",function(r){return Mi(e),Ai(Yt()._panelDoneAnimatingStream.next(r.toState))})("keydown",function(r){return Mi(e),Ai(Yt()._handleKeydown(r))}),Pr(2),de()}if(2&n){const e=Yt();Zu("transform-origin",e._transformOrigin)("font-size",e._triggerFontSize,"px"),Ri("sbb-select-multiple",e.multiple),Je("ngClass",e.panelClass)("@transformPanel",e.multiple?"showing-multiple":"showing"),fn("id",e.id+"-panel")("aria-multiselectable",e.multiple)("aria-label",e.ariaLabel||null)("aria-labelledby",e._getPanelAriaLabelledby())}}const mZ=["*"],gZ={transformPanel:Es("transformPanel",[dr("void",Ln({opacity:0})),dr("showing",Ln({opacity:1})),dr("showing-multiple",Ln({opacity:1})),qi("void => *",Qi("120ms cubic-bezier(0, 0, 0.2, 1)")),qi("* => void",Qi("100ms 25ms linear",Ln({opacity:0})))])};let eN=0;const tN=new Et("sbb-select-scroll-strategy"),_Z=new Et("SBB_SELECT_CONFIG"),yZ={provide:tN,deps:[Bo],useFactory:function bZ(n){return()=>n.scrollStrategies.reposition()}};class vZ{constructor(t,e){this.source=t,this.value=e}}const xZ=$b(Ga(nS(Em(class{constructor(n,t,e,i){this._defaultErrorStateMatcher=n,this._parentForm=t,this._parentFormGroup=e,this.ngControl=i,this.stateChanges=new Zt}}))));let wZ=(()=>{class n extends xZ{constructor(e,i,r,s,d,m,y,C,M,k,z,q,Q){var xe;super(s,m,y,M),this._viewportRuler=e,this._changeDetectorRef=i,this._ngZone=r,this._elementRef=d,this._parentFormField=C,this.ngControl=M,this._liveAnnouncer=q,this._defaultOptions=Q,this._scrollTop=0,this._triggerFontSize=0,this._transformOrigin="top",this._offsetY=0,this._positions=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom"}],this._panelOpen=!1,this._compareWith=(De,Ze)=>De===Ze,this._uid="sbb-select-"+eN++,this._triggerAriaLabelledBy=null,this._destroy=new Zt,this._onChange=()=>{},this._onTouched=()=>{},this._valueId="sbb-select-value-"+eN++,this._panelDoneAnimatingStream=new Zt,this._overlayPanelClass=(null===(xe=this._defaultOptions)||void 0===xe?void 0:xe.overlayPanelClass)||"sbb-overlay-panel",this._focused=!1,this.controlType="sbb-select",this._multiple=!1,this._readonly=!1,this.ariaLabel="",this.optionSelectionChanges=hm(()=>{const De=this.options;return De?De.changes.pipe(Ds(De),na(()=>Er(...De.map(Ze=>Ze.onSelectionChange)))):this._ngZone.onStable.pipe(Vr(1),na(()=>this.optionSelectionChanges))}),this.openedChange=new nn,this._openedStream=this.openedChange.pipe(Cr(De=>De),W(()=>{})),this._closedStream=this.openedChange.pipe(Cr(De=>!De),W(()=>{})),this.selectionChange=new nn,this.valueChange=new nn,this.ngControl&&(this.ngControl.valueAccessor=this),null!=(null==Q?void 0:Q.typeaheadDebounceInterval)&&(this._typeaheadDebounceInterval=Q.typeaheadDebounceInterval),this._scrollStrategyFactory=z,this._scrollStrategy=this._scrollStrategyFactory(),this.tabIndex=parseInt(k,10)||0,this.id=this.id,this._overlayOrigin=new iF(d)}get focused(){return this._focused||this._panelOpen}get placeholder(){return this._placeholder}set placeholder(e){this._placeholder=e,this.stateChanges.next()}get required(){var e,i,r,s;return null!==(s=null!==(e=this._required)&&void 0!==e?e:null===(r=null===(i=this.ngControl)||void 0===i?void 0:i.control)||void 0===r?void 0:r.hasValidator(YT.required))&&void 0!==s&&s}set required(e){this._required=jn(e),this.stateChanges.next()}get multiple(){return this._multiple}set multiple(e){this._multiple=jn(e)}get readonly(){return this._readonly}set readonly(e){this._readonly=jn(e),this.stateChanges.next()}get compareWith(){return this._compareWith}set compareWith(e){this._compareWith=e,this._selectionModel&&this._initializeSelection()}get value(){return this._value}set value(e){this._assignValue(e)&&this._onChange(e)}get typeaheadDebounceInterval(){return this._typeaheadDebounceInterval}set typeaheadDebounceInterval(e){this._typeaheadDebounceInterval=gh(e)}get id(){return this._id}set id(e){this._id=e||this._uid,this.stateChanges.next()}ngOnInit(){this._selectionModel=new _W(this.multiple),this.stateChanges.next(),this._panelDoneAnimatingStream.pipe(Pp(),Pi(this._destroy)).subscribe(()=>this._panelDoneAnimating(this.panelOpen)),this._viewportRuler.change().pipe(Pi(this._destroy)).subscribe(()=>{this.panelOpen&&(this._triggerRect=this._elementRef.nativeElement.getBoundingClientRect(),this._changeDetectorRef.markForCheck())})}ngAfterContentInit(){this._initKeyManager(),this._selectionModel.changed.pipe(Pi(this._destroy)).subscribe(e=>{e.added.forEach(i=>i.select()),e.removed.forEach(i=>i.deselect())}),this.options.changes.pipe(Ds(null),Pi(this._destroy)).subscribe(()=>{this._resetOptions(),this._initializeSelection()})}ngDoCheck(){const e=this._getTriggerAriaLabelledby(),i=this.ngControl;if(e!==this._triggerAriaLabelledBy){const r=this._elementRef.nativeElement;this._triggerAriaLabelledBy=e,e?r.setAttribute("aria-labelledby",e):r.removeAttribute("aria-labelledby")}this.ngControl&&(this._previousControl!==i.control&&(void 0!==this._previousControl&&null!==i.disabled&&i.disabled!==this.disabled&&(this.disabled=i.disabled),this._previousControl=i.control),this.updateErrorState())}ngOnChanges(e){(e.disabled||e.userAriaDescribedBy)&&this.stateChanges.next(),e.typeaheadDebounceInterval&&this._keyManager&&this._keyManager.withTypeAhead(this._typeaheadDebounceInterval)}ngOnDestroy(){this._destroy.next(),this._destroy.complete(),this.stateChanges.complete()}toggle(){this.panelOpen?this.close():this.open()}open(){this._canOpen()&&(this._panelOpen=!0,this._keyManager.withHorizontalOrientation(null),this._highlightCorrectOption(),this._changeDetectorRef.markForCheck(),this._triggerRect=this._elementRef.nativeElement.getBoundingClientRect(),this._triggerFontSize=parseInt(getComputedStyle(this._elementRef.nativeElement).fontSize||"0",10),this._ngZone.onStable.pipe(Vr(1)).subscribe(()=>{this._triggerFontSize&&this.overlayDir.overlayRef&&this.overlayDir.overlayRef.overlayElement&&(this.overlayDir.overlayRef.overlayElement.style.fontSize=`${this._triggerFontSize}px`),this._calculateOverlayPosition()}))}close(){this._panelOpen&&(this._panelOpen=!1,this._keyManager.withHorizontalOrientation("ltr"),this._changeDetectorRef.markForCheck(),this._onTouched())}writeValue(e){this._assignValue(e)}registerOnChange(e){this._onChange=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this.disabled=e,this._changeDetectorRef.markForCheck(),this.stateChanges.next()}get panelOpen(){return this._panelOpen}get selected(){var e,i;return this.multiple?(null===(e=this._selectionModel)||void 0===e?void 0:e.selected)||[]:null===(i=this._selectionModel)||void 0===i?void 0:i.selected[0]}get triggerValue(){return this.empty?"":this._multiple?this._selectionModel.selected.map(i=>i.viewValue).join(", "):this._selectionModel.selected[0].viewValue}_handleKeydown(e){this.disabled||(this.panelOpen?this._handleOpenKeydown(e):this._handleClosedKeydown(e))}_handleClosedKeydown(e){const i=e.keyCode,r=40===i||38===i||37===i||39===i,s=13===i||32===i,d=this._keyManager;if(!d.isTyping()&&s&&!ra(e)||(this.multiple||e.altKey)&&r)e.preventDefault(),this.open();else if(!this.multiple){const m=this.selected;d.onKeydown(e);const y=this.selected;y&&m!==y&&this._liveAnnouncer.announce(y.viewValue,1e4)}}_handleOpenKeydown(e){const i=this._keyManager,r=e.keyCode,s=40===r||38===r,d=i.isTyping();if(s&&e.altKey)e.preventDefault(),this.close();else if(d||13!==r&&32!==r||!i.activeItem||ra(e))if(!d&&this._multiple&&65===r&&e.ctrlKey){e.preventDefault();const m=this.options.some(y=>!y.disabled&&!y.selected);this.options.forEach(y=>{y.disabled||(m?y.select():y.deselect())})}else{const m=i.activeItemIndex;i.onKeydown(e),this._multiple&&s&&e.shiftKey&&i.activeItem&&i.activeItemIndex!==m&&i.activeItem._selectViaInteraction()}else e.preventDefault(),i.activeItem._selectViaInteraction()}_onFocus(){this.disabled||(this._focused=!0,this.stateChanges.next())}_onBlur(){this._focused=!1,!this.disabled&&!this.panelOpen&&(this._onTouched(),this._changeDetectorRef.markForCheck(),this.stateChanges.next())}_onAttached(){this.overlayDir.positionChange.pipe(Vr(1)).subscribe(e=>{"top"===e.connectionPair.originY?(this.panel.nativeElement.classList.add("sbb-panel-above"),this._elementRef.nativeElement.classList.add("sbb-input-with-open-panel-above")):(this.panel.nativeElement.classList.remove("sbb-panel-above"),this._elementRef.nativeElement.classList.remove("sbb-input-with-open-panel-above")),this._changeDetectorRef.detectChanges(),this._positioningSettled()})}get empty(){return!this._selectionModel||this._selectionModel.isEmpty()}_initializeSelection(){Promise.resolve().then(()=>{this.ngControl&&(this._value=this.ngControl.value),this._setSelectionByValue(this._value),this.stateChanges.next()})}_setSelectionByValue(e){if(this._selectionModel.selected.forEach(i=>i.setInactiveStyles()),this._selectionModel.clear(),this.multiple&&e)Array.isArray(e),e.forEach(i=>this._selectOptionByValue(i)),this._sortValues();else{const i=this._selectOptionByValue(e);i?this._keyManager.updateActiveItem(i):this.panelOpen||this._keyManager.updateActiveItem(-1)}this._changeDetectorRef.markForCheck()}_selectOptionByValue(e){const i=this.options.find(r=>{if(this._selectionModel.isSelected(r))return!1;try{return null!=r.value&&this._compareWith(r.value,e)}catch(s){return!1}});return i&&this._selectionModel.select(i),i}_assignValue(e){return!!(e!==this._value||this._multiple&&Array.isArray(e))&&(this.options&&this._setSelectionByValue(e),this._value=e,!0)}_initKeyManager(){this._keyManager=new rO(this.options).withTypeAhead(this._typeaheadDebounceInterval).withVerticalOrientation().withHorizontalOrientation("ltr").withHomeAndEnd().withAllowedModifierKeys(["shiftKey"]),this._keyManager.tabOut.pipe(Pi(this._destroy)).subscribe(()=>{this.panelOpen&&(!this.multiple&&this._keyManager.activeItem&&this._keyManager.activeItem._selectViaInteraction(),this.focus(),this.close())}),this._keyManager.change.pipe(Pi(this._destroy)).subscribe(()=>{this._panelOpen&&this.panel?this._scrollOptionIntoView(this._keyManager.activeItemIndex||0):!this._panelOpen&&!this.multiple&&this._keyManager.activeItem&&this._keyManager.activeItem._selectViaInteraction()})}_resetOptions(){const e=Er(this.options.changes,this._destroy);this.optionSelectionChanges.pipe(Pi(e)).subscribe(i=>{this._onSelect(i.source,i.isUserInput),i.isUserInput&&!this.multiple&&this._panelOpen&&(this.close(),this.focus())}),Er(...this.options.map(i=>i._stateChanges)).pipe(Pi(e)).subscribe(()=>{this._changeDetectorRef.markForCheck(),this.stateChanges.next()})}_onSelect(e,i){const r=this._selectionModel.isSelected(e);null!=e.value||this._multiple?(r!==e.selected&&(e.selected?this._selectionModel.select(e):this._selectionModel.deselect(e)),i&&this._keyManager.setActiveItem(e),this.multiple&&(this._sortValues(),i&&this.focus())):(e.deselect(),this._selectionModel.clear(),null!=this.value&&this._propagateChanges(e.value)),r!==this._selectionModel.isSelected(e)&&this._propagateChanges(),this.stateChanges.next()}_sortValues(){if(this.multiple){const e=this.options.toArray();this._selectionModel.sort((i,r)=>this.sortComparator?this.sortComparator(i,r,e):e.indexOf(i)-e.indexOf(r)),this.stateChanges.next()}}_propagateChanges(e){let i=null;i=this.multiple?this.selected.map(r=>r.value):this.selected?this.selected.value:e,this._value=i,this.valueChange.emit(i),this._onChange(i),this.selectionChange.emit(new vZ(this,i)),this._changeDetectorRef.markForCheck()}_highlightCorrectOption(){this._keyManager&&(this.empty?this._keyManager.setFirstItemActive():this._keyManager.setActiveItem(this._selectionModel.selected[0]))}_canOpen(){var e;return!this._panelOpen&&!this.disabled&&(null===(e=this.options)||void 0===e?void 0:e.length)>0&&!this.readonly}focus(e){this._elementRef.nativeElement.focus(e)}_getPanelAriaLabelledby(){var e;if(this.ariaLabel)return null;const i=null===(e=this._parentFormField)||void 0===e?void 0:e.getLabelId();return this.ariaLabelledby?(i?i+" ":"")+this.ariaLabelledby:i}_getAriaActiveDescendant(){return this.panelOpen&&this._keyManager&&this._keyManager.activeItem?this._keyManager.activeItem.id:null}_getTriggerAriaLabelledby(){var e;if(this.ariaLabel)return null;const i=null===(e=this._parentFormField)||void 0===e?void 0:e.getLabelId();let r=(i?i+" ":"")+this._valueId;return this.ariaLabelledby&&(r+=" "+this.ariaLabelledby),r}_panelDoneAnimating(e){this.panelOpen?this._scrollTop=0:(this.overlayDir.offsetX=0,this._changeDetectorRef.markForCheck()),e||this._elementRef.nativeElement.classList.remove("sbb-input-with-open-panel-above"),this.openedChange.emit(e)}_getOverlayMinWidth(){var e;return null===(e=this._triggerRect)||void 0===e?void 0:e.width}setDescribedByIds(e){e.length?this._elementRef.nativeElement.setAttribute("aria-describedby",e.join(" ")):this._elementRef.nativeElement.removeAttribute("aria-describedby")}onContainerClick(){this.focus(),this.open()}_calculateOverlayScroll(e,i,r){const s=e._getHostElement().offsetHeight,d=e._getHostElement().offsetTop;return Math.min(Math.max(0,d-i+s/2),r)}_scrollOptionIntoView(e){if(0===e)this.panel.nativeElement.scrollTop=0;else{const i=this.options.toArray()[e];if(i){const r=i._getHostElement();this.panel.nativeElement.scrollTop=IO(r.offsetTop,r.offsetHeight,this.panel.nativeElement.scrollTop,this.panel.nativeElement.offsetHeight)}}}_positioningSettled(){this.panel.nativeElement.scrollTop=this._scrollTop}_calculateOverlayPosition(){if(!this.panel)return;const e=this.panel.nativeElement.clientHeight,r=this.panel.nativeElement.scrollHeight-e,s=this._selectionModel.selected[0];this._scrollTop=this.empty||-1===this.options.toArray().indexOf(s)?0:this._calculateOverlayScroll(s,e/2,r)}}return n.\u0275fac=function(e){return new(e||n)(G(lu),G(Sr),G(qn),G(gD),G(Tn),G(Mb,8),G(Ab,8),G(CS,8),G(Hl,10),Uo("tabindex"),G(tN),G(uO),G(_Z,8))},n.\u0275cmp=vn({type:n,selectors:[["sbb-select"]],contentQueries:function(e,i,r){if(1&e&&(zr(r,Tv,5),zr(r,bD,5)),2&e){let s;Nn(s=Bn())&&(i.options=s),Nn(s=Bn())&&(i.optionGroups=s)}},viewQuery:function(e,i){if(1&e&&(ur(cZ,5),ur(rF,5)),2&e){let r;Nn(r=Bn())&&(i.panel=r.first),Nn(r=Bn())&&(i.overlayDir=r.first)}},hostAttrs:["role","combobox","aria-autocomplete","none","aria-haspopup","true",1,"sbb-select","sbb-input-element"],hostVars:26,hostBindings:function(e,i){1&e&&Qt("click",function(){return i.toggle()})("keydown",function(s){return i._handleKeydown(s)})("focus",function(){return i._onFocus()})("blur",function(){return i._onBlur()}),2&e&&(fn("id",i.id)("tabindex",i.readonly?-1:i.tabIndex)("aria-controls",i.panelOpen?i.id+"-panel":null)("aria-owns",i.panelOpen?i.id+"-panel":null)("aria-expanded",i.panelOpen)("aria-label",i.ariaLabel||null)("aria-required",i.required.toString())("aria-disabled",i.disabled.toString())("aria-invalid",i.errorState)("aria-activedescendant",i._getAriaActiveDescendant()),Ri("sbb-disabled",i.disabled)("sbb-select-invalid",i.errorState)("sbb-select-required",i.required)("sbb-select-empty",i.empty)("sbb-select-multiple",i.multiple)("sbb-readonly",i.readonly)("sbb-focused",i.focused)("sbb-input-with-open-panel",i.panelOpen))},inputs:{disabled:"disabled",tabIndex:"tabIndex",userAriaDescribedBy:["aria-describedby","userAriaDescribedBy"],panelClass:"panelClass",placeholder:"placeholder",required:"required",multiple:"multiple",readonly:"readonly",compareWith:"compareWith",value:"value",ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],errorStateMatcher:"errorStateMatcher",typeaheadDebounceInterval:"typeaheadDebounceInterval",sortComparator:"sortComparator",id:"id"},outputs:{openedChange:"openedChange",_openedStream:"opened",_closedStream:"closed",selectionChange:"selectionChange",valueChange:"valueChange"},exportAs:["sbbSelect"],features:[Vn([{provide:Nv,useExisting:n},{provide:rS,useExisting:n}]),qt,cr],ngContentSelectors:mZ,decls:8,vars:20,consts:[["aria-hidden","true",1,"sbb-select-value",3,"ngSwitch"],["class","sbb-select-placeholder",4,"ngSwitchCase"],["class","sbb-select-value-text",4,"ngSwitchCase"],[3,"ngSwitch"],["class","sbb-icon-scaled sbb-select-arrow-icon","svgIcon","kom:chevron-small-down-small",4,"ngSwitchCase"],["class","sbb-icon-scaled sbb-select-arrow-icon sbb-select-arrow-icon-lean","svgIcon","kom:chevron-right-small",4,"ngSwitchCase"],["cdk-connected-overlay","","cdkConnectedOverlayLockPosition","","cdkConnectedOverlayFlexibleDimensions","","cdkConnectedOverlayHasBackdrop","","cdkConnectedOverlayBackdropClass","cdk-overlay-transparent-backdrop",3,"cdkConnectedOverlayPanelClass","cdkConnectedOverlayScrollStrategy","cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayPositions","cdkConnectedOverlayWidth","cdkConnectedOverlayOffsetX","cdkConnectedOverlayOffsetY","cdkConnectedOverlayMinHeight","backdropClick","attach","detach"],[1,"sbb-select-placeholder"],[1,"sbb-select-value-text"],["svgIcon","kom:chevron-small-down-small",1,"sbb-icon-scaled","sbb-select-arrow-icon"],["svgIcon","kom:chevron-right-small",1,"sbb-icon-scaled","sbb-select-arrow-icon","sbb-select-arrow-icon-lean"],["role","listbox","tabindex","-1",1,"sbb-panel","sbb-panel-padded","sbb-select-panel","sbb-scrollbar",3,"ngClass","keydown"],["panel",""]],template:function(e,i){1&e&&(Mo(),oe(0,"div",0),$t(1,uZ,2,1,"span",1),$t(2,dZ,3,1,"span",2),de(),Bl(3,3),yb(4,"async"),$t(5,hZ,1,0,"sbb-icon",4),$t(6,pZ,1,0,"sbb-icon",5),zl(),$t(7,fZ,3,12,"ng-template",6),Qt("backdropClick",function(){return i.close()})("attach",function(){return i._onAttached()})("detach",function(){return i.close()})),2&e&&(Ri("sbb-select-value-empty",i.empty),Je("ngSwitch",i.empty),fn("id",i._valueId),Le(1),Je("ngSwitchCase",!0),Le(1),Je("ngSwitchCase",!1),Le(1),Je("ngSwitch",vb(4,18,i.variant)),Le(2),Je("ngSwitchCase","standard"),Le(1),Je("ngSwitchCase","lean"),Le(1),Je("cdkConnectedOverlayPanelClass",i._overlayPanelClass)("cdkConnectedOverlayScrollStrategy",i._scrollStrategy)("cdkConnectedOverlayOrigin",i._overlayOrigin)("cdkConnectedOverlayOpen",i.panelOpen)("cdkConnectedOverlayPositions",i._positions)("cdkConnectedOverlayWidth",i._getOverlayMinWidth())("cdkConnectedOverlayOffsetX",0)("cdkConnectedOverlayOffsetY",i._offsetY)("cdkConnectedOverlayMinHeight",30))},dependencies:[Tb,Eb,Bx,rF,qa,Hy],styles:[".sbb-select{display:inline-block;cursor:pointer;position:relative;text-align:left;padding-right:calc(2.9333333333rem * var(--sbb-scaling-factor))}:where(html.sbb-lean) .sbb-select{padding-right:2.5333333333rem}.sbb-select:is([readonly],.sbb-readonly){cursor:default}.sbb-form-field .sbb-select,.sbb-table th.sbb-header-cell.sbb-table-filter .sbb-select{display:block}.sbb-select-value{overflow:hidden;text-overflow:ellipsis}:where(html.sbb-lean) .sbb-select-value-empty{color:var(--sbb-color-storm)}.sbb-select-arrow-icon{position:absolute;top:50%;transform:translateY(-50%);right:calc(0.6rem * var(--sbb-scaling-factor));color:var(--sbb-color-granite)}:where(html.sbb-lean) .sbb-select-arrow-icon{right:.4rem}.sbb-select:is([readonly],.sbb-readonly) .sbb-select-arrow-icon{display:none}.sbb-select-arrow-icon>svg{transition:transform 120ms cubic-bezier(0, 0, 0.2, 1)}.sbb-input-with-open-panel .sbb-select-arrow-icon>svg{transform:rotate(180deg)}.sbb-icon.sbb-select-arrow-icon-lean>svg{transform:rotate(90deg)}.sbb-input-with-open-panel .sbb-icon.sbb-select-arrow-icon-lean>svg{transform:rotate(-90deg)}.sbb-select-panel :is(.sbb-menu-group+.sbb-menu-group,.sbb-menu-item+.sbb-menu-group,.sbb-menu-group+.sbb-menu-item){border-top:none}:where(html:not(.sbb-lean)) .sbb-select-panel.sbb-select-multiple .sbb-menu-group .sbb-menu-item{padding-left:calc(0.9333333333rem * var(--sbb-scaling-factor))}"],encapsulation:2,data:{animation:[gZ.transformPanel]},changeDetection:0}),n})(),nN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({providers:[yZ],imports:[gr,bl,Wi,mo,oS,oS,bl]}),n})();const SZ=["settingsContainer"];function CZ(n,t){if(1&n&&(oe(0,"sbb-option",17),$e(1),de()),2&n){const e=t.$implicit,i=Yt();Je("value",e.modeType),Le(1),hi(i.computeTripModeTypeText(e.modeType))}}function TZ(n,t){if(1&n){const e=Io();oe(0,"div",18),Qt("click",function(){return Mi(e),Ai(Yt().showRequestXmlPopover())}),oe(1,"span",19),$e(2,"XML"),de()()}}function EZ(n,t){if(1&n&&(oe(0,"sbb-option",17),$e(1),de()),2&n){const e=t.$implicit,i=Yt();Je("value",e),Le(1),hi(i.computeTripTransportModeText(e))}}function DZ(n,t){if(1&n){const e=Io();oe(0,"div",20)(1,"div",21),Qt("click",function(){return Mi(e),Ai(Yt().handleTapOnMapButton())}),F(),oe(2,"svg",22),ln(3,"path",23),de(),$e(4," Via "),de(),Y(),oe(5,"div",24)(6,"div"),$e(7),de(),ln(8,"div",25),oe(9,"button",26),Qt("click",function(){return Mi(e),Ai(Yt().removeVia())}),F(),oe(10,"svg",27),ln(11,"path",28)(12,"path",29),de(),$e(13," Remove "),de()()()}if(2&n){const e=Yt();Le(7),hi(e.computeViaName())}}let IZ=(()=>{class n{constructor(e,i,r){this.debugXmlPopover=e,this.userTripService=i,this.mapService=r,this.tripTransportModeData=[{modeType:"monomodal",transportModes:["public_transport","walk","cycle","self-drive-car","bicycle_rental","escooter_rental","car_sharing","taxi","others-drive-car"]},{modeType:"mode_at_start",transportModes:["walk","cycle","bicycle_rental","escooter_rental","taxi","others-drive-car"]},{modeType:"mode_at_end",transportModes:["walk","bicycle_rental","escooter_rental","car_sharing","taxi","others-drive-car"]},{modeType:"mode_at_start_end",transportModes:["walk","bicycle_rental","escooter_rental"]}],this.tripModeType=this.tripTransportModeData[0].modeType,this.tripTransportModes=JSON.parse(JSON.stringify(this.tripTransportModeData[0].transportModes)),this.tripTransportMode=this.tripTransportModes[0],this.tripModeTypeIdx=0,this.tripMotTypeDataModel={},this.settingsCollapseID="mode_custom_mode_settings_NOT_READY_YET",this.endpointMinDurationS="2",this.endpointMaxDurationS="30",this.endpointMinDistanceS="100",this.endpointMaxDistanceS="20000"}ngOnInit(){var e;this.tripModeType=this.userTripService.tripModeTypes[this.tripModeTypeIdx];const i=null!==(e=this.tripTransportModeData.find(r=>r.modeType===this.tripModeType))&&void 0!==e?e:this.tripTransportModeData[0];this.tripTransportModes=JSON.parse(JSON.stringify(i.transportModes)),this.tripTransportMode=this.userTripService.tripTransportModes[this.tripModeTypeIdx],this.tripMotTypeDataModel.isNotLastSegment=!this.isLastSegment(),this.tripMotTypeDataModel.requestInfo=null,this.userTripService.activeTripSelected.subscribe(r=>{this.updateRequestDataModel()}),this.userTripService.defaultsInited.subscribe(r=>{this.userTripService.updateTripLocationCustomMode(this.tripModeTypeIdx)}),this.settingsCollapseID="mode_custom_mode_settings_"+this.tripModeTypeIdx}isLastSegment(){return this.tripModeTypeIdx===this.userTripService.tripModeTypes.length-1}handleTapOnMapButton(){var e;const i=null!==(e=this.userTripService.viaTripLocations[this.tripModeTypeIdx])&&void 0!==e?e:null;this.mapService.tryToCenterAndZoomToLocation(i.location)}computeViaName(){var e,i,r;const s=null!==(e=this.userTripService.viaTripLocations[this.tripModeTypeIdx])&&void 0!==e?e:null;return null===s?"":null!==(r=null===(i=s.location.geoPosition)||void 0===i?void 0:i.asLatLngString())&&void 0!==r?r:""}removeVia(){this.userTripService.removeViaAtIndex(this.tripModeTypeIdx)}onTripModeChange(){var e;const i=null!==(e=this.tripTransportModeData.find(s=>s.modeType===this.tripModeType))&&void 0!==e?e:null;null!==i&&(this.tripTransportModes=JSON.parse(JSON.stringify(i.transportModes)),-1!==this.tripTransportModes.indexOf(this.tripTransportMode)||(this.tripTransportMode=this.tripTransportModes[0]),this.userTripService.updateTripMode(this.tripModeType,this.tripTransportMode,this.tripModeTypeIdx),this.userTripService.updateTripLocationCustomMode(this.tripModeTypeIdx))}onTransportModeChange(){this.userTripService.updateTripMode(this.tripModeType,this.tripTransportMode,this.tripModeTypeIdx),this.userTripService.updateTripLocationCustomMode(this.tripModeTypeIdx),"public_transport"===this.tripTransportMode&&this.settingsContainer.nativeElement.classList.remove("show")}updateRequestDataModel(){var e;this.tripMotTypeDataModel.isNotLastSegment=!this.isLastSegment();const i=null!==(e=this.userTripService.journeyTripRequests[this.tripModeTypeIdx])&&void 0!==e?e:null;this.tripMotTypeDataModel.requestInfo=null!==i?i.requestInfo:null}showRequestXmlPopover(){const e=this.debugXmlPopover.open(YD,{position:{top:"10px"}});e.afterOpened().subscribe(()=>{this.tripMotTypeDataModel.requestInfo&&e.componentInstance.updateRequestData(this.tripMotTypeDataModel.requestInfo)})}computeTripModeTypeText(e){var i;return null!==(i={monomodal:"Monomodal",mode_at_start:"Mode at Start",mode_at_end:"Mode at End",mode_at_start_end:"Mode at Start & End"}[e])&&void 0!==i?i:"n/a"}computeTripTransportModeText(e){var i;return null!==(i={public_transport:"Public Transport",walk:"Walking",cycle:"Own Bicycle",escooter_rental:"eScooter Sharing",car_sharing:"Car Sharing","self-drive-car":"Own Car",bicycle_rental:"Bicycle Sharing",charging_station:"Charging Stations",taxi:"Taxi","others-drive-car":"Limousine"}[e])&&void 0!==i?i:"n/a"}onRestrictionsChange(){const e=parseInt(this.endpointMinDurationS,10),i=parseInt(this.endpointMaxDurationS,10),r=parseInt(this.endpointMinDistanceS,10),s=parseInt(this.endpointMaxDistanceS,10);this.userTripService.updateTripLocationRestrictions(e,i,r,s,this.tripModeTypeIdx)}}return n.\u0275fac=function(e){return new(e||n)(G(uu),G(Ic),G(jp))},n.\u0275cmp=vn({type:n,selectors:[["trip-mode-type"]],viewQuery:function(e,i){if(1&e&&ur(SZ,5),2&e){let r;Nn(r=Bn())&&(i.settingsContainer=r.first)}},inputs:{tripModeTypeIdx:"tripModeTypeIdx"},decls:39,vars:14,consts:[[1,"trip-mot-type-container"],[1,"d-flex","align-items-center","via-mot"],[1,"flex-grow-1"],[1,"w-100"],[3,"ngModel","ngModelChange","selectionChange"],[3,"value",4,"ngFor","ngForOf"],["class","xml-info",3,"click",4,"ngIf"],[1,"mobility-settings"],["sbb-secondary-button","","type","button","data-bs-toggle","collapse","aria-expanded","false",3,"disabled"],["svgIcon","kom:combined-mobility-small"],[1,"mobility-settings-left-v2","endpoint-settings-wrapper","collapse",3,"id"],["settingsContainer",""],[1,"endpoint-settings","d-none2"],[1,"d-flex","align-items-center","mb-2"],["sbbInput","",2,"width","50px",3,"ngModel","ngModelChange","change"],["sbbInput","",2,"width","70px",3,"ngModel","ngModelChange","change"],["class","via-content",4,"ngIf"],[3,"value"],[1,"xml-info",3,"click"],[1,"layer-xml-info","badge","bg-info","text-dark"],[1,"via-content"],[1,"via-label",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","12","height","12","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-map"],["fill-rule","evenodd","d","M15.817.113A.5.5 0 0 1 16 .5v14a.5.5 0 0 1-.402.49l-5 1a.502.502 0 0 1-.196 0L5.5 15.01l-4.902.98A.5.5 0 0 1 0 15.5v-14a.5.5 0 0 1 .402-.49l5-1a.5.5 0 0 1 .196 0L10.5.99l4.902-.98a.5.5 0 0 1 .415.103zM10 1.91l-4-.8v12.98l4 .8V1.91zm1 12.98 4-.8V1.11l-4 .8v12.98zm-6-.8V1.11l-4 .8v12.98l4-.8z"],[1,"d-flex","align-items-center"],[2,"width","8px"],["type","button",1,"btn","btn-sm","btn-outline-danger",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-x-circle"],["d","M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"],["d","M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"]],template:function(e,i){1&e&&(oe(0,"div",0)(1,"div",1)(2,"div",2)(3,"sbb-form-field",3)(4,"sbb-label"),$e(5,"Choose Monomodal / Multimodal"),de(),oe(6,"sbb-select",4),Qt("ngModelChange",function(s){return i.tripModeType=s})("selectionChange",function(){return i.onTripModeChange()}),$t(7,CZ,2,2,"sbb-option",5),de()()(),$t(8,TZ,3,0,"div",6),de(),oe(9,"div",1)(10,"div",2)(11,"sbb-form-field",3)(12,"sbb-label"),$e(13,"Choose MOT (Mode of Transport)"),de(),oe(14,"sbb-select",4),Qt("ngModelChange",function(s){return i.tripTransportMode=s})("selectionChange",function(){return i.onTransportModeChange()}),$t(15,EZ,2,2,"sbb-option",5),de()()(),oe(16,"div",7)(17,"button",8),ln(18,"sbb-icon",9),de()()(),oe(19,"div",10,11)(21,"div",12)(22,"div",13)(23,"div",2),$e(24," Duration (mins) "),de(),oe(25,"div")(26,"input",14),Qt("ngModelChange",function(s){return i.endpointMinDurationS=s})("change",function(){return i.onRestrictionsChange()}),de(),oe(27,"span"),$e(28," to "),de(),oe(29,"input",14),Qt("ngModelChange",function(s){return i.endpointMaxDurationS=s})("change",function(){return i.onRestrictionsChange()}),de()()(),oe(30,"div",13)(31,"div",2),$e(32," Distance (meters) "),de(),oe(33,"div")(34,"input",14),Qt("ngModelChange",function(s){return i.endpointMinDistanceS=s})("change",function(){return i.onRestrictionsChange()}),de(),oe(35,"span"),$e(36," to "),de(),oe(37,"input",15),Qt("ngModelChange",function(s){return i.endpointMaxDistanceS=s})("change",function(){return i.onRestrictionsChange()}),de()()()()(),$t(38,DZ,14,1,"div",16),de()),2&e&&(Le(6),Je("ngModel",i.tripModeType),Le(1),Je("ngForOf",i.tripTransportModeData),Le(1),Je("ngIf",i.tripMotTypeDataModel.requestInfo),Le(6),Je("ngModel",i.tripTransportMode),Le(1),Je("ngForOf",i.tripTransportModes),Le(2),Va("disabled","monomodal"===i.tripModeType),fn("data-bs-target","#"+i.settingsCollapseID+("monomodal"===i.tripModeType?"_DISABLED":""))("aria-controls",i.settingsCollapseID),Le(2),Va("id",i.settingsCollapseID),Le(7),Je("ngModel",i.endpointMinDurationS),Le(3),Je("ngModel",i.endpointMaxDurationS),Le(5),Je("ngModel",i.endpointMinDistanceS),Le(3),Je("ngModel",i.endpointMaxDistanceS),Le(1),Je("ngIf",i.tripMotTypeDataModel.isNotLastSegment))},dependencies:[Sc,Ts,id,uh,Ip,Tv,PF,Bv,eI,qa,Zb,wZ],styles:[".trip-mot-type-container[_ngcontent-%COMP%]{margin-top:0;margin-bottom:0}.via-content[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:16px}.via-mot[_ngcontent-%COMP%]{margin-left:12px}.via-label[_ngcontent-%COMP%]{font-size:12px}.via-label[_ngcontent-%COMP%]:hover{cursor:pointer}.xml-info[_ngcontent-%COMP%]{cursor:pointer;margin-left:5px}.mobility-settings[_ngcontent-%COMP%]{margin-left:5px;margin-top:3px}.mobility-settings-left-v2[_ngcontent-%COMP%]{margin-left:10px}.endpoint-settings[_ngcontent-%COMP%]{margin-bottom:18px;margin-left:12px;margin-right:12px;padding:0 14px;border-color:#cacaca;border-style:solid;border-width:0 1px 1px 1px;border-radius:2px}"]}),n})();function MZ(n,t){1&n&&za(0)}function AZ(n,t){1&n&&ln(0,"trip-mode-type",29),2&n&&Je("tripModeTypeIdx",t.index)}function kZ(n,t){if(1&n&&(Bl(0),$t(1,AZ,1,1,"trip-mode-type",28),zl()),2&n){const e=Yt(2);Le(1),Je("ngForOf",e.userTripService.journeyTripsPlaceholder)}}function RZ(n,t){if(1&n&&(oe(0,"sbb-radio-button",30),$e(1),de()),2&n){const e=t.$implicit;Je("value",e),Le(1),hi(e)}}function PZ(n,t){if(1&n){const e=Io();oe(0,"sbb-radio-button",34),Qt("change",function(r){return Mi(e),Ai(Yt(3).onChangeStageAPI(r))}),$e(1),de()}if(2&n){const e=t.$implicit,i=Yt(3);Je("value",e)("checked",i.userTripService.currentAppStage==e),Le(1),wr(" ",e," ")}}function LZ(n,t){if(1&n&&(oe(0,"div",31)(1,"div")(2,"sbb-radio-group",32),$t(3,PZ,2,3,"sbb-radio-button",33),de()()()),2&n){const e=Yt(2);Le(3),Je("ngForOf",e.appStageOptions)}}function OZ(n,t){1&n&&ln(0,"span",35)}function FZ(n,t){if(1&n){const e=Io();oe(0,"div",36)(1,"button",37),Qt("click",function(){return Mi(e),Ai(Yt(2).loadInputTripXMLPopover())}),$e(2," Debug XML "),de()()}}function NZ(n,t){if(1&n){const e=Io();oe(0,"div",6)(1,"div",7)(2,"journey-point-input",8),Qt("selectedLocation",function(r){return Mi(e),Ai(Yt().onLocationSelected(r,"From"))}),de()()(),$t(3,kZ,2,1,"ng-container",9),oe(4,"div",10)(5,"div",7)(6,"journey-point-input",8),Qt("selectedLocation",function(r){return Mi(e),Ai(Yt().onLocationSelected(r,"To"))}),de()(),oe(7,"div",11)(8,"button",12),Qt("click",function(){return Mi(e),Ai(Yt().swapEndpoints())}),ln(9,"sbb-icon",13),de()()(),oe(10,"div",6)(11,"div")(12,"sbb-form-field",14)(13,"sbb-datepicker",15)(14,"input",16),Qt("ngModelChange",function(r){return Mi(e),Ai(Yt().searchDate=r)})("dateChange",function(){return Mi(e),Ai(Yt().onChangeDateTime())}),de()()()(),oe(15,"div",17)(16,"sbb-form-field",18)(17,"input",19),Qt("ngModelChange",function(r){return Mi(e),Ai(Yt().searchTime=r)})("change",function(){return Mi(e),Ai(Yt().onChangeDateTime())}),de()()(),oe(18,"div",20)(19,"sbb-radio-group",21),Qt("ngModelChange",function(r){return Mi(e),Ai(Yt().currentBoardingType=r)}),$t(20,RZ,2,2,"sbb-radio-button",22),de()()(),$t(21,LZ,4,1,"div",23),oe(22,"div",6)(23,"div",24)(24,"button",25),Qt("click",function(){return Mi(e),Ai(Yt().handleTapOnSearch())}),$t(25,OZ,1,0,"span",26),$e(26," Search Journeys "),de()(),$t(27,FZ,3,0,"div",27),de()}if(2&n){const e=Yt();Le(2),Je("endpointType","From")("inputValue",e.fromLocationText)("placeholder","From"),Le(1),Je("ngIf",!e.isEmbed),Le(3),Je("endpointType","To")("inputValue",e.toLocationText)("placeholder","To"),Le(8),Je("ngModel",e.searchDate),Le(3),Je("ngModel",e.searchTime),Le(2),Je("ngModel",e.currentBoardingType),Le(1),Je("ngForOf",e.tripRequestBoardingTypes),Le(1),Je("ngIf",!1===e.isEmbed),Le(3),Je("disabled",e.shouldDisableSearchButton()),Le(1),Je("ngIf",e.isSearching),Le(2),Je("ngIf",!e.isEmbed)}}function BZ(n,t){if(1&n&&(oe(0,"div")(1,"span",41),$e(2),de()()),2&n){const e=Yt(2);Le(2),hi(e.requestDurationF)}}function zZ(n,t){if(1&n){const e=Io();Bl(0),oe(1,"div")(2,"a",42),$e(3,"Permalink"),de()(),oe(4,"div",43),$e(5," | "),de(),oe(6,"div")(7,"a",44),Qt("click",function(){return Mi(e),Ai(Yt(2).loadEmbedHTMLPopover())}),$e(8,"Embed"),de()(),zl()}if(2&n){const e=Yt(2);Le(2),Va("href",e.userTripService.permalinkRelativeURL,ll)}}function VZ(n,t){if(1&n&&(oe(0,"div",38)(1,"div",1)(2,"div",39),$t(3,BZ,3,1,"div",9),ln(4,"div",40),$t(5,zZ,9,1,"ng-container",9),de()()()),2&n){const e=Yt();Le(3),Je("ngIf",null!==e.requestDurationF),Le(2),Je("ngIf",null!==e.userTripService.permalinkRelativeURL)}}function jZ(n,t){if(1&n&&(oe(0,"div",38)(1,"div",1)(2,"div",39)(3,"div")(4,"a",42),$e(5,"Open in OJP Demo App"),de()()()()()),2&n){const e=Yt();Le(4),Va("href",e.userTripService.permalinkRelativeURL,ll)}}let iN=(()=>{class n{constructor(e,i,r,s,d,m){this.notificationToast=e,this.tripXmlPopover=i,this.embedHTMLPopover=r,this.router=s,this.userTripService=d,this.mapService=m,this.appStageOptions=[];const y=this.userTripService.departureDate;this.searchDate=y,this.searchTime=gl.formatTimeHHMM(y),this.fromLocationText="",this.toLocationText="",this.appStageOptions=["PROD","INT","TEST","LA Beta"],this.isSearching=!1,this.tripRequestFormattedXML="RequestXML",this.tripResponseFormattedXML="ResponseXML",this.requestDurationF=null,this.lastCustomTripRequestXML=null,this.useMocks=!1,this.headerText="Search",this.currentBoardingType="Dep",this.tripRequestBoardingTypes=["Dep","Arr"],this.isEmbed=-1!==this.router.url.indexOf("/embed/")}ngOnInit(){this.userTripService.initDefaults(),this.userTripService.locationsUpdated.subscribe(e=>{this.updateLocationTexts()}),this.userTripService.tripsUpdated.subscribe(e=>{e.length>0?this.collapseSearchPanel():this.expandSearchPanel()}),this.userTripService.searchParamsReset.subscribe(()=>{this.expandSearchPanel(),this.requestDurationF=null}),this.userTripService.defaultsInited.subscribe(e=>{var i;null!==(i=new URLSearchParams(document.location.search).get("do_search"))&&void 0!==i&&i&&this.handleTapOnSearch()}),this.useMocks&&this.initLocationsFromMocks()}updateLocationTexts(){const i=[];if(["From","To"].forEach(r=>{var s,d;const m="From"===r?this.userTripService.fromTripLocation:this.userTripService.toTripLocation,y=null!==(s=null==m?void 0:m.location)&&void 0!==s?s:null;if(null===y)return;let C=null!==(d=y.computeLocationName())&&void 0!==d?d:"";"From"===r?this.fromLocationText=C.trim():this.toLocationText=C.trim(),i.push(C)}),this.isEmbed){const r=[];r.push(""===this.fromLocationText?"From Location":this.fromLocationText),r.push("-"),r.push(""===this.toLocationText?"To Location":this.toLocationText),this.headerText=r.join(" ")}}initLocationsFromMocks(){return Ke(this,void 0,void 0,function*(){const i=yield(yield fetch("/path/to/mock")).text();cu.initWithResponseMock(i).fetchResponseWithCallback(s=>{"TripRequest.TripsNo"===s.message&&console.log("DEBUG: TripsNo => "+s.tripsNo),"TripRequest.Trip"===s.message&&(console.log("DEBUG: New Trip => "+s.trips.length+"/"+s.tripsNo),1===s.trips.length&&this.handleCustomTripResponse(s.trips)),"TripRequest.DONE"===s.message&&this.handleCustomTripResponse(s.trips)})})}onLocationSelected(e,i){this.userTripService.updateTripEndpoint(e,i,"SearchForm")}onChangeStageAPI(e){this.userTripService.updateAppStage(e.value),this.userTripService.refetchEndpointsByName()}onChangeDateTime(){this.userTripService.updateDepartureDateTime(this.computeFormDepartureDate())}computeFormDepartureDate(){const e=this.searchDate,i=this.searchTime.split(":");if(2===i.length){const r=parseInt(i[0]),s=parseInt(i[1]);e.setHours(r),e.setMinutes(s)}return e}shouldDisableSearchButton(){return!!this.isSearching}handleTapOnSearch(){this.userTripService.updateDepartureDateTime(this.computeFormDepartureDate());const e=zD.initWithLocationsAndDate(this.userTripService.fromTripLocation,this.userTripService.toTripLocation,this.userTripService.viaTripLocations,this.userTripService.tripModeTypes,this.userTripService.tripTransportModes,this.userTripService.departureDate,this.currentBoardingType);if(null===e)return void this.notificationToast.open("Please check from/to input points",{type:"error",verticalPosition:"top"});"LA Beta"===this.userTripService.currentAppStage&&(e.useNumberOfResultsAfter=!1),this.notificationToast.dismiss();const i=this.userTripService.getStageConfig(),r=new pW(i,e);this.isSearching=!0,r.fetchResponse(s=>{if(s.error)return this.notificationToast.open(s.error.message,{type:"error",verticalPosition:"top"}),this.isSearching=!1,this.userTripService.journeyTripRequests=[],this.requestDurationF=null,void this.userTripService.updateTrips([]);const d=s.sections.flatMap(m=>m.trips);if("JourneyRequest.DONE"===s.message){0===d.length&&this.notificationToast.open("No trips found",{type:"info",verticalPosition:"top"});const m=r.tripRequests[0].requestInfo,y=TF.computeExecutionTime(m.requestDateTime,m.responseDateTime),C=TF.computeExecutionTime(m.responseDateTime,m.parseDateTime);this.requestDurationF=(y+C).toFixed(2)+" sec",this.isSearching=!1,this.userTripService.updateTrips(d),d.length>0&&this.zoomToTrip(d[0])}else this.userTripService.journeyTripRequests=r.tripRequests,"TripRequest.Trip"===s.message&&(this.userTripService.updateTrips(d),1===d.length)&&this.zoomToTrip(d[0]),"ERROR"===s.message&&(this.isSearching=!1)})}zoomToTrip(e){const i=e.computeBBOX();if(!1===i.isValid())return;const s={bounds:new(Ms().LngLatBounds)(i.asFeatureBBOX())};this.mapService.newMapBoundsRequested.emit(s)}expandSearchPanel(){var e;null===(e=this.searchPanel)||void 0===e||e.open()}collapseSearchPanel(){var e;null===(e=this.searchPanel)||void 0===e||e.close()}loadInputTripXMLPopover(){const e=this.tripXmlPopover.open(M9,{position:{top:"20px"}});e.afterOpened().subscribe(()=>{const i=e.componentInstance;i.inputTripRequestXML=this.userTripService.computeTripRequestXML(this.computeFormDepartureDate());const r=s=>{this.lastCustomTripRequestXML=i.inputTripRequestXML,cu.initWithResponseMock(s).fetchResponse().then(m=>{i.inputTripRequestResponseXML=s,e.close(),this.handleCustomTripResponse(m.trips)})};i.tripCustomRequestSaved.subscribe(r),i.tripCustomResponseSaved.subscribe(r)})}handleCustomTripResponse(e){this.requestDurationF="USER XML",this.isSearching=!1,this.userTripService.updateTrips(e),this.updateSearchForm(e),e.length>0&&this.zoomToTrip(e[0])}updateSearchForm(e){0!==e.length&&(this.userTripService.updateParamsFromTrip(e[0]),this.updateLocationTexts())}swapEndpoints(){this.userTripService.switchEndpoints()}loadEmbedHTMLPopover(){this.embedHTMLPopover.open(V9,{position:{top:"20px"}}).afterOpened().subscribe(()=>{})}}return n.\u0275fac=function(e){return new(e||n)(G(kF),G(uu),G(uu),G(ls),G(Ic),G(jp))},n.\u0275cmp=vn({type:n,selectors:[["app-search-form"]],viewQuery:function(e,i){if(1&e&&ur(Im,7),2&e){let r;Nn(r=Bn())&&(i.searchPanel=r.first)}},decls:11,vars:5,consts:[[1,"row","mb-1"],[1,"col"],[3,"expanded"],[4,"ngTemplateOutlet"],["searchContent",""],["class","row mb-2",4,"ngIf"],[1,"d-flex"],[1,"flex-grow-1","journey-endpoint"],[3,"endpointType","inputValue","placeholder","selectedLocation"],[4,"ngIf"],[1,"d-flex","align-items-center"],[1,"swap-endpoints"],["sbb-secondary-button","","data-bs-toggle","collapse","aria-expanded","false",3,"click"],["svgIcon","kom:arrow-change-horizontal-medium"],["label","Choose Day"],["arrows",""],["sbbInput","","sbbDateInput","",3,"ngModel","ngModelChange","dateChange"],[2,"margin-left","8px","width","100px"],["label","Time"],["sbbInput","","sbbTimeInput","",3,"ngModel","ngModelChange","change"],[2,"margin-top","28px"],[1,"sbb-radio-group-horizontal",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["class","mb-2 d-flex",4,"ngIf"],[2,"margin-right","4px"],["type","button",1,"btn","btn-primary",3,"disabled","click"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],["class","ms-auto",4,"ngIf"],[3,"tripModeTypeIdx",4,"ngFor","ngForOf"],[3,"tripModeTypeIdx"],[3,"value"],[1,"mb-2","d-flex"],[1,"sbb-radio-group-horizontal"],[3,"value","checked","change",4,"ngFor","ngForOf"],[3,"value","checked","change"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"],[1,"ms-auto"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"row","mb-2"],[1,"d-flex","flex-row-reverse"],[2,"width","7px"],[1,"badge","bg-success"],["target","_blank",3,"href"],["clas","text-center",2,"width","7px","margin-left","4px"],["target","_blank","role","button",1,"text-decoration-underline",3,"click"]],template:function(e,i){if(1&e&&(oe(0,"div",0)(1,"div",1)(2,"sbb-accordion")(3,"sbb-expansion-panel",2)(4,"sbb-expansion-panel-header"),$e(5),de(),$t(6,MZ,1,0,"ng-container",3),de()()()(),$t(7,NZ,28,15,"ng-template",null,4,im),$t(9,VZ,6,2,"div",5),$t(10,jZ,6,1,"div",5)),2&e){const r=Nl(8);Le(3),Je("expanded",!0),Le(2),hi(i.headerText),Le(1),Je("ngTemplateOutlet",r),Le(3),Je("ngIf",!i.isEmbed),Le(1),Je("ngIf",i.isEmbed&&null!==i.userTripService.permalinkRelativeURL)}},dependencies:[Sc,Ts,rT,id,uh,Ip,$D,Im,_S,PF,oI,DS,Bv,qa,Zb,GF,aI,WF,lZ,IZ],styles:[".debug-xml[_ngcontent-%COMP%]:hover{cursor:pointer}.swap-endpoints[_ngcontent-%COMP%]{margin-left:5px;margin-top:10px}"]}),n})(),rN=(()=>{class n{constructor(){this.model={sdkVersion:bS,lastUpdate:"10.March 2024"}}ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=vn({type:n,selectors:[["web-footer"]],decls:132,vars:2,consts:[[1,"d-none"],["id","map-debug-control"],[1,"fw-bold"],["id","map_debug_center"],["id","map_debug_zoom"],["id","map-layers-legend-control"],[1,"map-layers-legend-wrapper"],[1,"d-flex","flex-row"],[1,"flex-grow-1","map-layers-header"],["href","#map_layers_body","data-bs-toggle","collapse","aria-expanded","true","aria-controls","map_layers_body",1,"content-collapse","align-middle"],[1,"bi","bi-plus-circle"],[1,"bi","bi-dash-circle"],["id","map_layers_body",1,"collapse","show"],["data-map-layer-key","stops",1,"map-layer-data","mb-2"],["type","checkbox","checked","",1,"map-layer-checkbox","align-middle"],[1,"layer-text"],[1,"layer-xml-info","badge","bg-info","text-dark"],["data-map-layer-key","addresses",1,"map-layer-data","mb-2"],["type","checkbox",1,"map-layer-checkbox","align-middle"],[1,"flex-grow-1"],["href","#map_layers_mobility_body","data-bs-toggle","collapse","aria-expanded","true","aria-controls","map_layers_mobility_body",1,"content-collapse","collapsed","align-middle"],["id","map_layers_mobility_body",1,"collapse","mb-2",2,"margin-left","8px"],["data-map-layer-key","sharing_cars",1,"map-layer-data"],["data-map-layer-key","sharing_bicycles",1,"map-layer-data"],["data-map-layer-key","sharing_scooters",1,"map-layer-data"],["data-map-layer-key","charging_stations",1,"map-layer-data"],[1,"map-composite-pois"],["href","#map_layers_pois_body","data-bs-toggle","collapse","aria-expanded","true","aria-controls","map_layers_pois_body",1,"content-collapse","collapsed","align-middle"],["id","map_layers_pois_body",1,"collapse","mb-2",2,"margin-left","8px"],["type","checkbox","data-osm-tag","service",1,"map-layer-poi","align-middle"],["type","checkbox","data-osm-tag","shopping",1,"map-layer-poi","align-middle"],["type","checkbox","data-osm-tag","leisure",1,"map-layer-poi","align-middle"],["type","checkbox","data-osm-tag","catering",1,"map-layer-poi","align-middle"],["type","checkbox","data-osm-tag","public",1,"map-layer-poi","align-middle"],["type","checkbox","data-osm-tag","parkride",1,"map-layer-poi","align-middle"],["type","checkbox","data-osm-tag","accommodation",1,"map-layer-poi","align-middle"],["type","checkbox","data-osm-tag","sbb_services",1,"map-layer-poi","align-middle"],["type","checkbox","data-osm-tag","other",1,"map-layer-poi","align-middle"],[1,"row","bg-ojp-blue","text-white"],[1,"bg-ojp-orange","w-100",2,"height","5px"],[1,"col"],[1,"footer"],["href","https://opentransportdata.swiss/en/","target","_blank"],["href","https://github.com/openTdataCH/ojp-demo-app-src/blob/main/CHANGELOG.md","target","_blank"],["href","https://github.com/openTdataCH/ojp-js/blob/main/CHANGELOG.md","target","_blank"],[1,"row",2,"height","16px"]],template:function(e,i){1&e&&(oe(0,"div",0)(1,"div",1)(2,"div")(3,"span",2),$e(4,"Center"),de(),$e(5,": "),oe(6,"span",3),$e(7,"n/a"),de()(),oe(8,"div")(9,"span",2),$e(10,"Zoom"),de(),$e(11,": "),oe(12,"span",4),$e(13,"n/a"),de()()(),oe(14,"div",5)(15,"div",6)(16,"div",7)(17,"div",8),$e(18,"Toggle Map Layers"),de(),oe(19,"div")(20,"a",9),ln(21,"i",10)(22,"i",11),de()()(),oe(23,"div",12)(24,"div",13),ln(25,"input",14),oe(26,"span",15),$e(27,"Stops (z13+)"),de(),oe(28,"span",16),$e(29,"XML"),de()(),oe(30,"div",17),ln(31,"input",18),oe(32,"span",15),$e(33,"Addresses (z17+)"),de(),oe(34,"span",16),$e(35,"XML"),de()(),oe(36,"div",7)(37,"div",19),$e(38,"Shared Mobility"),de(),oe(39,"div")(40,"a",20),ln(41,"i",10)(42,"i",11),de()()(),oe(43,"div",21)(44,"div",22),ln(45,"input",18),oe(46,"span",15),$e(47,"Shared Cars (z12+)"),de(),oe(48,"span",16),$e(49,"XML"),de()(),oe(50,"div",23),ln(51,"input",18),oe(52,"span",15),$e(53,"Shared Bicycles (z14+)"),de(),oe(54,"span",16),$e(55,"XML"),de()(),oe(56,"div",24),ln(57,"input",18),oe(58,"span",15),$e(59,"Shared Scooters (z14+)"),de(),oe(60,"span",16),$e(61,"XML"),de()(),oe(62,"div",25),ln(63,"input",18),oe(64,"span",15),$e(65,"Charging Stations (z12+)"),de(),oe(66,"span",16),$e(67,"XML"),de()()(),oe(68,"div",26)(69,"div",7)(70,"div",19),$e(71,"Other POIs (z16+) "),oe(72,"span",16),$e(73,"XML"),de()(),oe(74,"div")(75,"a",27),ln(76,"i",10)(77,"i",11),de()()(),oe(78,"div",28)(79,"div"),ln(80,"input",29),oe(81,"span",15),$e(82,"Service"),de()(),oe(83,"div"),ln(84,"input",30),oe(85,"span",15),$e(86,"Shopping"),de()(),oe(87,"div"),ln(88,"input",31),oe(89,"span",15),$e(90,"Leisure"),de()(),oe(91,"div"),ln(92,"input",32),oe(93,"span",15),$e(94,"Catering"),de()(),oe(95,"div"),ln(96,"input",33),oe(97,"span",15),$e(98,"Public"),de()(),oe(99,"div"),ln(100,"input",34),oe(101,"span",15),$e(102,"Parkride"),de()(),oe(103,"div"),ln(104,"input",35),oe(105,"span",15),$e(106,"Accommodation"),de()(),oe(107,"div"),ln(108,"input",36),oe(109,"span",15),$e(110,"SBB Services"),de()(),oe(111,"div"),ln(112,"input",37),oe(113,"span",15),$e(114,"Other"),de()()()()()()()(),oe(115,"div",38),ln(116,"div",39),oe(117,"div",40)(118,"div",41)(119,"div"),$e(120," \xa9 "),oe(121,"a",42),$e(122,"Open-Data-Plattform Mobilit\xe4t Schweiz"),de(),$e(123," 2021 - 2024 "),de(),oe(124,"div"),$e(125," Last Update: "),oe(126,"a",43),$e(127),de(),$e(128," - "),oe(129,"a",44),$e(130),de()()()()(),ln(131,"div",45)),2&e&&(Le(127),hi(i.model.lastUpdate),Le(3),wr("OJP SDK ",i.model.sdkVersion,""))},encapsulation:2}),n})(),oN=(()=>{class n{ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=vn({type:n,selectors:[["web-header"]],decls:19,vars:0,consts:[[1,"row"],[1,"col","nav-main","bg-ojp-blue"],[1,"d-flex","flex-row","align-items-center","justify-content-between"],[1,"navbar-brand","text-white"],["src","assets/opentransportdata.swiss.header-icons.svg","height","23",1,"mb-2"],[1,"d-none","d-md-flex"],[1,"nav-item"],["href","https://github.com/openTdataCH/ojp-demo-app-src",1,"nav-link"],["href","https://github.com/openTdataCH/ojp-demo-app-src/blob/main/docs/README.md",1,"nav-link"],["href","https://opentransportdata.swiss/en/cookbook/open-journey-planner-ojp/",1,"nav-link"],[1,"bg-ojp-orange","w-100",2,"height","10px"]],template:function(e,i){1&e&&(oe(0,"div",0)(1,"div",1)(2,"div",2)(3,"div")(4,"span",3),$e(5,"OJP Demo"),de(),ln(6,"br")(7,"img",4),de(),oe(8,"div",5)(9,"div",6)(10,"a",7),$e(11,"Source Code"),de()(),oe(12,"div",6)(13,"a",8),$e(14,"Docs"),de()(),oe(15,"div",6)(16,"a",9),$e(17,"OJP Cookbook"),de()()()()(),ln(18,"div",10),de())},encapsulation:2}),n})(),UZ=(()=>{class n{ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=vn({type:n,selectors:[["journey-search"]],decls:17,vars:4,consts:[[1,"container"],[1,"app-root"],["sbb-tab-nav-bar","",3,"tabPanel"],["sbb-tab-link","",3,"active"],["sbb-tab-link","",3,"active","routerLink"],["tabPanel",""],[1,"row"],[1,"col-md-5"],[1,"col-md-7"]],template:function(e,i){if(1&e&&(oe(0,"div",0),ln(1,"web-header"),oe(2,"div",1)(3,"nav",2)(4,"a",3),$e(5,"Journey Search"),de(),oe(6,"a",4),$e(7,"Station Board"),de()(),oe(8,"sbb-tab-nav-panel",null,5)(10,"div",6)(11,"div",7),ln(12,"app-search-form")(13,"journey-results"),de(),oe(14,"div",8),ln(15,"app-map"),de()()()(),ln(16,"web-footer"),de()),2&e){const r=Nl(9);Le(3),Je("tabPanel",r),Le(1),Je("active","true"),Le(2),Je("active","false")("routerLink","../board")}},dependencies:[yv,yD,BO,vD,dF,D9,iN,rN,oN],styles:[".app-root[_ngcontent-%COMP%]{border:1px solid #CACACA;margin-left:calc(-.5 * var(--bs-gutter-x));margin-right:calc(-.5 * var(--bs-gutter-x));padding:8px}"]}),n})();const HZ=JSON.parse('{"id":"ojp-service-track-line","type":"line","source":"[SOURCE_ID]","filter":["all",["==",["geometry-type"],"LineString"]],"layout":{"line-join":"round","line-cap":"round"},"paint":{"line-width":4,"line-opacity":1,"line-color":["case",["==",["get","line-type"],"prev"],"#D3D3D3","#3D69CA"]}}'),$Z=JSON.parse('{"id":"ojp-service-track-stop","type":"circle","source":"[SOURCE_ID]","filter":["all",["==",["geometry-type"],"Point"]],"layout":{},"paint":{"circle-radius":["case",["==",["get","point-size"],"large"],6,4],"circle-color":["case",["==",["get","line-type"],"prev"],"#D3D3D3","#3D69CA"],"circle-stroke-color":"#FFF","circle-stroke-width":["case",["==",["get","point-size"],"large"],3,1]}}');class GZ{constructor(t){this.map=t,this.sourceID="stop-event-service-data",this.addMapLayers(t)}addMapLayers(t){t.addSource(this.sourceID,{type:"geojson",data:{type:"FeatureCollection",features:[]}});const i=HZ;i.source=this.sourceID,t.addLayer(i);const r=$Z;r.source=this.sourceID,t.addLayer(r)}drawStopEvent(t){let e=[];const i={prev:[],next:[]},r={prev:[],next:[]},s=["prev","next"];s.forEach(y=>{const C="prev"===y;let M=C?t.prevStopPoints:t.nextStopPoints;M.forEach((k,z)=>{const q=k.location.geoPosition;if(null===q)return;i[y].push(q.asPosition());const Q=0===z,xe=z===M.length-1,De=k.location.asGeoJSONFeature();De&&De.properties&&(De.properties["point-type"]=y,De.properties["point-size"]=C?Q?"large":"normal":xe?"large":"normal",r[y].push(De))})});const d=t.stopPoint.location.geoPosition;if(d){i.prev.push(d.asPosition()),i.next.unshift(d.asPosition());const y=t.stopPoint.location.asGeoJSONFeature();y&&y.properties&&(y.properties["point-type"]="next",y.properties["point-size"]="large",r.next.push(y))}s.forEach(y=>{const C=i[y];C.length<2||(e.push({type:"Feature",properties:{"line-type":y},geometry:{type:"LineString",coordinates:C}}),e=e.concat(r[y]))}),this.udateStopEventSource({type:"FeatureCollection",features:e})}resetStopEventLayers(){this.udateStopEventSource({type:"FeatureCollection",features:[]})}udateStopEventSource(t){const e=this.map.getSource(this.sourceID);if(null===e)return console.error("ERROR - cant find the source "+this.sourceID),void console.log(this.map.getStyle());e.setData(t)}}let cI=(()=>{class n{constructor(){this.stationBoardDataUpdated=new nn,this.stationBoardEntrySelected=new nn,this.stationOnMapClicked=new nn}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Jt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),qZ=(()=>{class n{constructor(e,i,r,s){this.userTripService=e,this.mapService=i,this.debugXmlPopover=r,this.stationBoardService=s,this.mapLoadingPromise=null,this.stopEventServiceRenderer=null}ngOnInit(){this.initMap(),this.mapService.newMapCenterAndZoomRequested.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{r.jumpTo({center:e.lnglat,zoom:e.zoom})})}),this.stationBoardService.stationBoardEntrySelected.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{this.updateMapForEntry(e)})})}initMap(){const e=new(Ms().LngLatBounds)([[5.9559,45.818],[10.4921,47.8084]]),i=new(Ms().Map)({container:"map_canvas_station_board",style:"mapbox://styles/mapbox/light-v10",bounds:e,accessToken:"pk.eyJ1IjoidmFzaWxlIiwiYSI6ImNra2k2dWFkeDFrbG0ycXF0Nmg0Z2tsNXAifQ.nK-i-3cpWmji7HvK1Ilynw"});this.mapService.initialMapCenter?(i.setCenter(this.mapService.initialMapCenter),this.mapService.initialMapZoom&&i.setZoom(this.mapService.initialMapZoom)):i.fitBounds(e,{padding:50,duration:0}),this.mapLoadingPromise=new Promise((r,s)=>{i.on("load",d=>{r(i),this.onMapLoad(i)})})}onMapLoad(e){this.addMapControls(e),this.addMapListeners(e),this.stopEventServiceRenderer=new GZ(e)}addMapControls(e){const i=new(Ms().NavigationControl)({showCompass:!1,visualizePitch:!1});e.addControl(i,"bottom-right");const r=new(Ms().ScaleControl)({maxWidth:200,unit:"metric"});e.addControl(r);const s=new hF(e);e.addControl(s,"top-left");const d=new CF(e,this.debugXmlPopover,this.userTripService);e.addControl(d,"top-right")}updateMapForEntry(e){var i,r;null===e?null===(i=this.stopEventServiceRenderer)||void 0===i||i.resetStopEventLayers():null===(r=this.stopEventServiceRenderer)||void 0===r||r.drawStopEvent(e)}addMapListeners(e){e.on("styleimagemissing",i=>{e.loadImage("./assets/map-style-icons/"+i.id+".png",(s,d)=>{s?console.error(s):!e.hasImage(i.id)&&d&&e.addImage(i.id,d)})}),e.on("click",i=>{const r=km.queryNearbyFeaturesByLayerIDs(e,i.lngLat,["stops-circle","stops-label"]);r.length>0&&this.stationBoardService.stationOnMapClicked.emit(r[0].feature)})}}return n.\u0275fac=function(e){return new(e||n)(G(Ic),G(jp),G(uu),G(cI))},n.\u0275cmp=vn({type:n,selectors:[["station-board-map"]],decls:1,vars:0,consts:[["id","map_canvas_station_board",1,"map_wrapper"]],template:function(e,i){1&e&&ln(0,"div",0)},styles:[".map_wrapper[_ngcontent-%COMP%]{height:600px;border:1px solid #e5e5e5}"]}),n})();const WZ=["stationBoardWrapper"];function XZ(n,t){if(1&n&&(oe(0,"div")(1,"div"),$e(2),de()()),2&n){const e=Yt(2).$implicit;Le(2),wr("Pl. ",e.stopPlatform,"")}}function ZZ(n,t){if(1&n&&(oe(0,"div")(1,"div"),$e(2,"Pl. "),oe(3,"del"),$e(4),de(),$e(5),de()()),2&n){const e=Yt(2).$implicit;Le(4),wr(" ",e.stopPlatform,""),Le(1),wr(" ",e.stopPlatformActual,"")}}function YZ(n,t){if(1&n&&(oe(0,"div",14),$t(1,XZ,3,1,"div",13),$t(2,ZZ,6,2,"div",13),de()),2&n){const e=Yt().$implicit;Le(1),Je("ngIf",!e.stopPlatformActual),Le(1),Je("ngIf",e.stopPlatformActual)}}function KZ(n,t){if(1&n&&(oe(0,"div")(1,"div",15),$e(2),de()()),2&n){const e=Yt().$implicit,i=Yt();Le(2),hi(e.mapStationBoardTime[i.stationBoardType].stopTime)}}function QZ(n,t){if(1&n&&(oe(0,"div")(1,"del"),$e(2),de()()),2&n){const e=Yt(2).$implicit,i=Yt();Le(2),hi(e.mapStationBoardTime[i.stationBoardType].stopTime)}}function JZ(n,t){if(1&n&&(oe(0,"div"),$t(1,QZ,3,1,"div",13),oe(2,"div",15),$e(3),de(),oe(4,"div",16),$e(5),de()()),2&n){const e=Yt().$implicit,i=Yt();Le(1),Je("ngIf",i.hasDelayDifferentTime(e)),Le(2),hi(e.mapStationBoardTime[i.stationBoardType].stopTimeActual),Le(2),hi(e.mapStationBoardTime[i.stationBoardType].stopDelayText)}}function eY(n,t){if(1&n&&(oe(0,"li"),$e(1),de()),2&n){const e=t.$implicit;Le(1),wr(" ",e," ")}}function tY(n,t){if(1&n&&(oe(0,"div")(1,"p")(2,"strong"),$e(3),de()(),oe(4,"div"),$e(5),de(),oe(6,"ul",19),$t(7,eY,2,1,"li",18),de()()),2&n){const e=t.$implicit;Le(3),hi(e.situationContent.summary),Le(2),wr(" ",e.situationContent.description," "),Le(2),Je("ngForOf",e.situationContent.details)}}function nY(n,t){if(1&n&&(oe(0,"div")(1,"sbb-tooltip",17),$t(2,tY,8,3,"div",18),de()()),2&n){const e=Yt().$implicit;Le(2),Je("ngForOf",e.stopSituations)}}const iY=function(n){return{"item-selected":n}};function rY(n,t){if(1&n&&(oe(0,"div",2)(1,"div",3)(2,"div",4)(3,"div",5)(4,"div",6),$e(5),de(),oe(6,"div",7),$e(7),de()(),oe(8,"div",8)(9,"div",9),$e(10),de(),$t(11,YZ,3,2,"div",10),oe(12,"div",11)(13,"span"),$e(14),de(),$e(15," - "),oe(16,"span"),$e(17),de()()(),oe(18,"div",12),$t(19,KZ,3,1,"div",13),$t(20,JZ,6,3,"div",13),$t(21,nY,3,1,"div",13),de()()()()),2&n){const e=t.$implicit,i=t.index,r=Yt();Je("ngClass",xC(11,iY,i===r.selectedIDx)),fn("data-index",i),Le(5),hi(e.serviceLineNumber),Le(2),hi(e.tripNumber),Le(3),hi(e.tripHeading),Le(1),Je("ngIf",e.stopPlatform),Le(3),wr("Operator: ",e.tripOperator,""),Le(3),wr("Type: ",e.servicePtMode,""),Le(2),Je("ngIf",!r.hasDelay(e)),Le(1),Je("ngIf",r.hasDelay(e)),Le(1),Je("ngIf",r.hasSituations(e))}}let sN=(()=>{class n{constructor(e){this.stationBoardService=e,this.stopEventsData=[],this.selectedIDx=null,this.stationBoardType="Departures"}ngOnInit(){this.stationBoardService.stationBoardDataUpdated.subscribe(e=>{this.stationBoardType=e.type;const i=e.items;this.stopEventsData=[],i.forEach(r=>{const s=r.asStationBoard();this.stopEventsData.push(s)}),i.length>0?this.selectDataRowAtIndex(0):this.stationBoardService.stationBoardEntrySelected.emit(null)})}ngAfterViewInit(){var e;(null===(e=this.stationBoardWrapperRef)||void 0===e?void 0:e.nativeElement).addEventListener("click",i=>{var r,s;const d=i.target;if(null===d)return;const m=null!==(s=null===(r=d.closest(".card-item"))||void 0===r?void 0:r.getAttribute("data-index"))&&void 0!==s?s:null;if(null===m)return;const y=parseInt(m,10);this.selectedIDx!==y&&this.selectDataRowAtIndex(y)})}selectDataRowAtIndex(e){this.selectedIDx=e,this.stationBoardService.stationBoardEntrySelected.emit(this.stopEventsData[e].stopEvent)}hasDelay(e){return e.mapStationBoardTime[this.stationBoardType].hasDelay}hasDelayDifferentTime(e){return e.mapStationBoardTime[this.stationBoardType].hasDelayDifferentTime}hasSituations(e){return e.stopSituations.length>0}}return n.\u0275fac=function(e){return new(e||n)(G(cI))},n.\u0275cmp=vn({type:n,selectors:[["station-board-result"]],viewQuery:function(e,i){if(1&e&&ur(WZ,5),2&e){let r;Nn(r=Bn())&&(i.stationBoardWrapperRef=r.first)}},decls:3,vars:1,consts:[["stationBoardWrapper",""],["class","card card card-item mb-2",3,"ngClass",4,"ngFor","ngForOf"],[1,"card","card","card-item","mb-2",3,"ngClass"],[1,"card-body"],[1,"d-flex","dep-content","align-items-center"],[1,"service-line-number-wrapper"],[1,"service-line-number","text-center"],[1,"trip-info","text-center"],[1,"flex-fill","dep-center"],[1,"trip-heading"],["class","stop-platform-text",4,"ngIf"],[1,"trip-debug"],[1,"text-center"],[4,"ngIf"],[1,"stop-platform-text"],[1,"departure-time"],[1,"departure-delay"],["svgIcon","fpl:info"],[4,"ngFor","ngForOf"],[1,"tooltip-list"]],template:function(e,i){1&e&&(oe(0,"div",null,0),$t(2,rY,22,13,"div",1),de()),2&e&&(Le(2),Je("ngForOf",i.stopEventsData))},dependencies:[Tb,Sc,Ts,cF],styles:[".service-line-number-wrapper[_ngcontent-%COMP%]{padding:0 16px 0 4px}.service-line-number[_ngcontent-%COMP%]{font-size:24px}.service-pt-mode[_ngcontent-%COMP%]{font-size:12px}.trip-heading[_ngcontent-%COMP%]{margin-top:2px;font-size:20px}.trip-info[_ngcontent-%COMP%]{font-size:12px}.stop-platform-wrapper[_ngcontent-%COMP%]{margin-right:4px}.stop-platform-text[_ngcontent-%COMP%]{font-size:14px}.stop-platform[_ngcontent-%COMP%]{font-size:18px}.departure-time[_ngcontent-%COMP%]{width:80px;font-size:20px}.departure-delay[_ngcontent-%COMP%]{color:#c45f00}.trip-debug[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{font-size:12px}.card-item[_ngcontent-%COMP%]{cursor:pointer}.item-selected[_ngcontent-%COMP%]{background-color:#f5f5f5}"]}),n})();function oY(n,t){if(1&n&&(oe(0,"sbb-option",5),$e(1),de()),2&n){const e=t.$implicit,i=Yt();Je("value",e.stopPlaceRef),Le(1),wr(" ",i.renderLookupName(e)," ")}}let aN=(()=>{class n{constructor(e){this.userTripService=e,this.locationSelected=new nn,this.searchInputControl=new yw(""),this.stopLookups=[n.AroundMeStopLookup],this.currentStopLookup=null,this.isBusySearching=!1,this.hackIgnoreInputChangesFlag=!1}static get AroundMeStopLookup(){return{stopPlaceRef:"AROUND_ME",stopName:"Current Location",special_type:"around_me",location:null}}ngOnInit(){this.searchInputControl.valueChanges.pipe(wv(500),Pp()).subscribe(e=>{this.onInputChangeAfterIdle()})}renderLookupName(e){let i=e.stopName;return e.distance&&(i+=" ("+e.distance+" m)"),i}onInputChangeAfterIdle(){const e=this.searchInputControl.value.trim();this.hackIgnoreInputChangesFlag?this.hackIgnoreInputChangesFlag=!1:0!==e.length?e.length<3||this.fetchLookupLocations(e):this.stopLookups=[n.AroundMeStopLookup]}fetchLookupLocations(e){return Ke(this,void 0,void 0,function*(){this.isBusySearching=!0;const r=this.userTripService.getStageConfig(),d=yield $l.initWithLocationName(r,e,"stop").fetchResponse();this.parseLocations(d.locations),this.isBusySearching=!1})}parseLocations(e,i=null){this.stopLookups=[],e.forEach(r=>{var s;const d=null===(s=r.stopPlace)||void 0===s?void 0:s.stopPlaceRef;if(null===d)return;const y={stopPlaceRef:d,stopName:r.computeLocationName(),location:r};r.geoPosition&&i&&(y.distance=r.geoPosition.distanceFrom(i)),this.stopLookups.push(y)}),i&&this.stopLookups.sort((r,s)=>null==r.distance||null==s.distance?0:r.distance-s.distance),this.stopLookups=this.stopLookups.slice(0,10)}onStopLookupSelected(e){var i;const r=e.option.value;let s=null!==(i=this.stopLookups.find(m=>m.stopPlaceRef===r))&&void 0!==i?i:null;if(null===s)return void console.log("WHOOPS - cant find the stop for: "+r);if("around_me"===s.special_type)return void this.handleGeolocationLookup();this.currentStopLookup=s,this.hackIgnoreInputChangesFlag=!0,this.searchInputControl.setValue(s.stopName);const d=s.location;d&&this.locationSelected.emit(d)}handleGeolocationLookup(){navigator.geolocation?(this.hackIgnoreInputChangesFlag=!0,this.searchInputControl.setValue("... looking up location"),navigator.geolocation.getCurrentPosition(e=>{this.handleNewGeoPosition(e,i=>{var r;const s=new Is(e.coords.longitude,e.coords.latitude);this.parseLocations(i,s),null===(r=this.autocompleteInputTrigger)||void 0===r||r.openPanel()})})):console.log("no navigator.geolocation enabled")}handleNewGeoPosition(e,i){return Ke(this,void 0,void 0,function*(){const d=e.coords.longitude-.025,m=e.coords.longitude+.025,y=e.coords.latitude+.025,C=e.coords.latitude-.025,M=this.userTripService.getStageConfig(),z=yield $l.initWithBBOXAndType(M,d,y,m,C,"stop",300,null).fetchResponse();i(z.locations)})}updateLocationText(e){var i,r;const s=null!==(r=null===(i=e.stopPlace)||void 0===i?void 0:i.stopPlaceName)&&void 0!==r?r:null;null!==s&&(this.hackIgnoreInputChangesFlag=!0,this.searchInputControl.setValue(s))}}return n.\u0275fac=function(e){return new(e||n)(G(Ic))},n.\u0275cmp=vn({type:n,selectors:[["station-board-input"]],viewQuery:function(e,i){if(1&e&&ur(IS,7),2&e){let r;Nn(r=Bn())&&(i.autocompleteInputTrigger=r.first)}},outputs:{locationSelected:"locationSelected"},decls:6,vars:4,consts:[["label","Station",1,"w-100"],["sbbInput","","type","text",3,"placeholder","formControl","sbbAutocomplete"],[3,"optionSelected"],["autocompleteTemplate","sbbAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(e,i){if(1&e&&(oe(0,"div")(1,"sbb-form-field",0),ln(2,"input",1),de(),oe(3,"sbb-autocomplete",2,3),Qt("optionSelected",function(s){return i.onStopLookupSelected(s)}),$t(5,oY,2,2,"sbb-option",4),de()()),2&e){const r=Nl(4);Le(2),Je("placeholder","Type to search for stations")("formControl",i.searchInputControl)("sbbAutocomplete",r),Le(3),Je("ngForOf",i.stopLookups)}},dependencies:[Sc,id,uh,vw,Tv,KF,IS,Bv,Zb],encapsulation:2}),n})();function sY(n,t){1&n&&ln(0,"span",12)}let aY=(()=>{class n{constructor(e){this.userTripService=e,this.customRequestSaved=new nn,this.customResponseSaved=new nn,this.customRequestXMLs="... wait",this.customResponseXMLs="Paste custom OJP StopEventRequest Response XML here...",this.isRunningRequest=!1}parseCustomRequestXML(){this.isRunningRequest=!0;const e=_h.initWithRequestMock(this.customRequestXMLs);e.fetchResponse().then(i=>{this.isRunningRequest=!1;const r=e.requestInfo.responseXML;null!==r?this.customRequestSaved.emit(r):console.log("ERROR - no response from StopEventRequest")})}parseCustomResponseXML(){this.customResponseSaved.emit(this.customResponseXMLs)}}return n.\u0275fac=function(e){return new(e||n)(G(Ic))},n.\u0275cmp=vn({type:n,selectors:[["custom-stop-event-popover"]],outputs:{customRequestSaved:"customRequestSaved",customResponseSaved:"customResponseSaved"},decls:26,vars:4,consts:[["sbbDialogTitle",""],["sbbDialogContent",""],[2,"width","500px"],[1,"d-flex","justify-content-between"],["target","_blank","href","https://opentransportdata.swiss/en/cookbook/ojp-stopeventservice/"],["rows","7",1,"w-100",3,"ngModel","ngModelChange"],[1,"d-flex"],["type","button",1,"btn","btn-primary",3,"disabled","click"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],["type","button",1,"btn","btn-primary",3,"click"],["sbbDialogActions",""],["type","button","sbbDialogClose","",1,"btn","btn-secondary"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"]],template:function(e,i){1&e&&(oe(0,"div",0),$e(1,"Custom StopEvent Request / Response XML"),de(),oe(2,"div",1)(3,"div",2)(4,"div",3)(5,"div"),$e(6,"StopEvent Request XML"),de(),oe(7,"div")(8,"a",4),$e(9,"Cookbook opentransportdata.swiss"),de()()(),oe(10,"textarea",5),Qt("ngModelChange",function(s){return i.customRequestXMLs=s}),de(),oe(11,"div",6)(12,"button",7),Qt("click",function(){return i.parseCustomRequestXML()}),$t(13,sY,1,0,"span",8),$e(14," Execute OJP StopEvent Request "),de()(),ln(15,"hr"),oe(16,"div",3)(17,"div"),$e(18,"StopEvent Request Response XML"),de()(),oe(19,"textarea",5),Qt("ngModelChange",function(s){return i.customResponseXMLs=s}),de(),oe(20,"div",6)(21,"button",9),Qt("click",function(){return i.parseCustomResponseXML()}),$e(22," Display StopEvents "),de()()()(),oe(23,"div",10)(24,"button",11),$e(25," Close "),de()()),2&e&&(Le(10),Je("ngModel",i.customRequestXMLs),Le(2),Je("disabled",i.isRunningRequest),Le(1),Je("ngIf",i.isRunningRequest),Le(6),Je("ngModel",i.customResponseXMLs))},dependencies:[Ts,id,uh,Ip,Xb,Rv,Pv,Lv],encapsulation:2}),n})(),lY=(()=>{class n{constructor(){this.embedHTMLs="n/a"}updateEmbedHTML(e){var i,r;const s=null!==(r=null===(i=e.stopPlace)||void 0===i?void 0:i.stopPlaceRef)&&void 0!==r?r:"n/a",d=document.location.pathname.replace("/board","/embed/board")+"?stop_id="+s,m=document.location.protocol+"//"+document.location.host+d;this.embedHTMLs='<iframe src="'+m+'" width="100%" height="100%" frameBorder="0"></iframe>'}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=vn({type:n,selectors:[["embed-station-board-popover"]],decls:11,vars:1,consts:[["sbbDialogTitle",""],["sbbDialogContent",""],[2,"width","500px"],["rows","7",1,"w-100"],["sbbDialogActions",""],["type","button","sbbDialogClose","",1,"btn","btn-secondary"]],template:function(e,i){1&e&&(oe(0,"div",0),$e(1,"Embed journey in another website"),de(),oe(2,"div",1)(3,"div",2)(4,"p"),$e(5,"Copy the following code in the target webpage"),de(),oe(6,"textarea",3),$e(7),de()()(),oe(8,"div",4)(9,"button",5),$e(10," Close "),de()()),2&e&&(Le(7),hi(i.embedHTMLs))},dependencies:[Xb,Rv,Pv,Lv],encapsulation:2}),n})();function cY(n,t){if(1&n){const e=Io();oe(0,"div",20),Qt("click",function(){return Mi(e),Ai(Yt().showRequestXmlPopover())}),oe(1,"span",21),$e(2,"XML"),de()()}}function uY(n,t){if(1&n&&(oe(0,"sbb-radio-button",25),$e(1),de()),2&n){const e=t.$implicit;Je("value",e),Le(1),wr(" ",e," ")}}function dY(n,t){if(1&n){const e=Io();oe(0,"div",22)(1,"div")(2,"sbb-radio-group",23),Qt("ngModelChange",function(r){return Mi(e),Ai(Yt().stationBoardType=r)})("change",function(){return Mi(e),Ai(Yt().onTypeChanged())}),$t(3,uY,2,2,"sbb-radio-button",24),de()()()}if(2&n){const e=Yt();Le(2),Je("ngModel",e.stationBoardType),Le(1),Je("ngForOf",e.stationBoardTypes)}}function hY(n,t){if(1&n){const e=Io();oe(0,"sbb-radio-button",28),Qt("change",function(r){return Mi(e),Ai(Yt(2).onChangeStageAPI(r))}),$e(1),de()}if(2&n){const e=t.$implicit,i=Yt(2);Je("value",e)("checked",i.userTripService.currentAppStage==e),Le(1),wr(" ",e," ")}}function pY(n,t){if(1&n&&(oe(0,"div",22)(1,"div")(2,"sbb-radio-group",26),$t(3,hY,2,3,"sbb-radio-button",27),de()()()),2&n){const e=Yt();Le(3),Je("ngForOf",e.appStageOptions)}}function fY(n,t){1&n&&ln(0,"span",29)}function mY(n,t){if(1&n){const e=Io();oe(0,"div",30)(1,"button",31),Qt("click",function(){return Mi(e),Ai(Yt().loadCustomXMLPopover())}),$e(2," Custom XML "),de()()}}function gY(n,t){if(1&n&&(oe(0,"div",0)(1,"div",1)(2,"div",32)(3,"div")(4,"a",33),$e(5,"Open in OJP Demo App"),de()()()()()),2&n){const e=Yt();Le(4),Va("href",e.permalinkURLAddress,ll)}}function bY(n,t){if(1&n){const e=Io();Bl(0),oe(1,"div",35),$e(2," | "),de(),oe(3,"div")(4,"a",36),Qt("click",function(){return Mi(e),Ai(Yt(2).loadEmbedHTMLPopover())}),$e(5,"Embed"),de()(),zl()}}function _Y(n,t){if(1&n&&(oe(0,"div",0)(1,"div",1)(2,"div",32)(3,"div")(4,"a",33),$e(5,"Permalink"),de()(),$t(6,bY,6,0,"ng-container",34),de()()()),2&n){const e=Yt();Le(4),Va("href",e.permalinkURLAddress,ll),Le(2),Je("ngIf",null!==e.searchLocation)}}let lN=(()=>{class n{constructor(e,i,r,s,d,m,y,C){this.notificationToast=e,this.debugXmlPopover=i,this.customXmlPopover=r,this.mapService=s,this.stationBoardService=d,this.userTripService=m,this.embedHTMLPopover=y,this.router=C,this.headerText="Search",this.useMocks=!1,this.queryParams=new URLSearchParams(document.location.search),this.appStageOptions=["PROD","INT","TEST","LA Beta"],this.stationBoardTypes=["Departures","Arrivals"],this.stationBoardType=this.computeStationBoardType(),this.searchLocation=null,this.searchDate=this.computeSearchDateTime(),this.searchTime=gl.formatTimeHHMM(this.searchDate),this.isSearching=!1,this.permalinkURLAddress="",this.updatePermalinkURLAddress(),this.currentRequestInfo=null;const M=new URLSearchParams(document.location.search);this.useMocks="yes"===M.get("use_mocks"),this.isEmbed=-1!==this.router.url.indexOf("/embed/"),this.isEmbed&&(this.headerText=this.stationBoardType)}ngOnInit(){const e=this.queryParams.get("stage");if(e){const r=this.computeAppStageFromString(e);r&&this.userTripService.updateAppStage(r)}const i=this.queryParams.get("stop_id");i&&(this.updateCurrentRequestData(i),this.fetchStopEventsForStopRef(i),this.lookupStopPlaceRef(i)),this.stationBoardService.stationOnMapClicked.subscribe(r=>{this.handleMapClick(r)}),this.useMocks&&this.useMocks&&"localhost"===document.location.hostname&&this.fetchStopEventFromMocks()}computeAppStageFromString(e){const i=this.appStageOptions.map(d=>d.toLowerCase()),r=e.trim(),s=i.indexOf(r.toLowerCase());return-1!==s?this.appStageOptions[s]:null}onLocationSelected(e){var i,r;const s=null!==(r=null===(i=e.stopPlace)||void 0===i?void 0:i.stopPlaceRef)&&void 0!==r?r:null;s&&this.updateCurrentRequestData(s),this.searchLocation=e,this.mapService.tryToCenterAndZoomToLocation(e),this.updatePermalinkURLAddress(),this.updateHeaderText(),this.resetResultList()}onDateTimeChanged(){const e=this.searchTime.split(":");if(2===e.length){const i=parseInt(e[0],10),r=parseInt(e[1],10);this.searchDate.setHours(i),this.searchDate.setMinutes(r)}this.updatePermalinkURLAddress()}onTypeChanged(){this.updatePermalinkURLAddress()}isSearchButtonDisabled(){return!(!this.isSearching&&null!==this.searchLocation)}searchButtonClicked(){var e,i,r;this.notificationToast.dismiss();const s=null!==(r=null===(i=null===(e=this.searchLocation)||void 0===e?void 0:e.stopPlace)||void 0===i?void 0:i.stopPlaceRef)&&void 0!==r?r:null;null!==s?this.fetchStopEventsForStopRef(s):console.error("ERROR - no stopPlaceRef available")}computeSearchDateTime(){let e=new Date;const i=this.queryParams.get("day");i&&(e=new Date(Date.parse(i)));const r=this.queryParams.get("time"),s=new Date;let d=s.getHours(),m=s.getMinutes();if(r){const y=r.split(":");2===y.length&&(d=parseInt(y[0],10),m=parseInt(y[1],10))}return e.setHours(d),e.setMinutes(m),e}computeStationBoardType(){return"arr"===this.queryParams.get("type")?"Arrivals":"Departures"}updatePermalinkURLAddress(){var e,i,r;const s=new URLSearchParams;"Arrivals"===this.stationBoardType&&s.set("type","arr");const d=null!==(r=null===(i=null===(e=this.searchLocation)||void 0===e?void 0:e.stopPlace)||void 0===i?void 0:i.stopPlaceRef)&&void 0!==r?r:null;d&&s.set("stop_id",d);const m=gl.formatDate(new Date),y=gl.formatDate(this.searchDate),C=m.substring(0,10),M=y.substring(0,10);M!==C&&s.set("day",M);const k=m.substring(11,16),z=y.substring(11,16);k!==z&&s.set("time",z);const q=document.location.pathname.replace("/embed","")+"?"+s.toString();this.permalinkURLAddress=q}fetchStopEventsForStopRef(e){const i=this.computeStopEventRequest(e);i.fetchResponse().then(r=>{this.currentRequestInfo=i.requestInfo,this.parseStopEvents(r.stopEvents)})}fetchStopEventFromMocks(){return Ke(this,void 0,void 0,function*(){const i=yield(yield fetch("/path/to/mock.xml")).text();_h.initWithMock(i).fetchResponse().then(s=>{this.parseStopEvents(s.stopEvents)})})}computeStopEventRequest(e){const i="Arrivals"===this.stationBoardType?"arrival":"departure",r=this.computeStopBoardDate(),s=this.userTripService.getStageConfig();return _h.initWithStopPlaceRef(s,e,i,r)}parseStopEvents(e){var i;e.length>0&&(null===(i=this.searchPanel)||void 0===i||i.close()),this.stationBoardService.stationBoardDataUpdated.emit({type:this.stationBoardType,items:e})}lookupStopPlaceRef(e){return Ke(this,void 0,void 0,function*(){const i=this.userTripService.getStageConfig(),s=yield $l.initWithStopPlaceRef(i,e).fetchResponse();if(0===s.locations.length)return void console.error("ERROR - cant find stopPlaceRef with ID: "+e);const d=s.locations[0];this.searchLocation=d,this.mapService.tryToCenterAndZoomToLocation(d),this.updatePermalinkURLAddress(),this.updateHeaderText(),this.autocompleteInputComponent&&this.autocompleteInputComponent.updateLocationText(d)})}updateHeaderText(){if(!this.isEmbed||null===this.searchLocation)return;const e=this.searchLocation.computeLocationName();null!==e&&(this.headerText=e+" "+this.stationBoardType)}handleMapClick(e){var i;const r=ao.initWithFeature(e);null!==r&&(this.searchLocation=r,this.autocompleteInputComponent&&this.autocompleteInputComponent.updateLocationText(r),this.resetResultList(),this.updatePermalinkURLAddress(),null===(i=this.searchPanel)||void 0===i||i.open())}resetResultList(){this.stationBoardService.stationBoardDataUpdated.emit({type:this.stationBoardType,items:[]})}computeStopBoardDate(){const e=this.searchDate,i=this.searchTime.split(":");if(2===i.length){const r=parseInt(i[0]),s=parseInt(i[1]);e.setHours(r),e.setMinutes(s)}return e}showRequestXmlPopover(){const e=this.debugXmlPopover.open(YD,{position:{top:"10px"}});e.afterOpened().subscribe(()=>{this.currentRequestInfo&&e.componentInstance.updateRequestData(this.currentRequestInfo)})}onChangeStageAPI(e){this.userTripService.updateAppStage(e.value)}loadCustomXMLPopover(){const e=this.customXmlPopover.open(aY,{position:{top:"20px"}});e.afterOpened().subscribe(()=>{var i,r;this.notificationToast.dismiss();const s=e.componentInstance;if(null===this.currentRequestInfo){const m=this.computeStopEventRequest("8503000");this.currentRequestInfo=m.requestInfo}s.customRequestXMLs=null!==(r=null===(i=this.currentRequestInfo)||void 0===i?void 0:i.requestXML)&&void 0!==r?r:"n/a",s.customRequestSaved.subscribe(d=>{e.close(),this.handleCustomResponse(d)}),s.customResponseSaved.subscribe(d=>{e.close(),this.handleCustomResponse(d)})})}handleCustomResponse(e){null!==this.currentRequestInfo&&(this.currentRequestInfo.responseDateTime=new Date,this.currentRequestInfo.responseXML=e,_h.initWithMock(e).fetchResponse().then(r=>{const s=r.stopEvents;s.length>0?(this.mapService.tryToCenterAndZoomToLocation(s[0].stopPoint.location),this.parseStopEvents(r.stopEvents)):this.notificationToast.open("No StopEvents found",{type:"error",verticalPosition:"top"})}))}updateCurrentRequestData(e){const i=this.computeStopEventRequest(e);this.currentRequestInfo=i.requestInfo}loadEmbedHTMLPopover(){const e=this.embedHTMLPopover.open(lY,{position:{top:"20px"}});e.afterOpened().subscribe(()=>{this.searchLocation&&e.componentInstance.updateEmbedHTML(this.searchLocation)})}}return n.\u0275fac=function(e){return new(e||n)(G(kF),G(uu),G(uu),G(jp),G(cI),G(Ic),G(uu),G(ls))},n.\u0275cmp=vn({type:n,selectors:[["station-board-search"]],viewQuery:function(e,i){if(1&e&&(ur(Im,7),ur(aN,5)),2&e){let r;Nn(r=Bn())&&(i.searchPanel=r.first),Nn(r=Bn())&&(i.autocompleteInputComponent=r.first)}},decls:28,vars:12,consts:[[1,"row","mb-2"],[1,"col"],[3,"expanded"],[1,"d-flex","align-items-center"],[1,"flex-grow-1"],[3,"locationSelected"],["class","xml-info",3,"click",4,"ngIf"],["class","mb-3 d-flex",4,"ngIf"],[1,"d-flex"],["label","Choose Day"],["arrows",""],["sbbInput","","sbbDateInput","",3,"ngModel","ngModelChange","dateChange"],[2,"margin-left","8px"],["label","Time"],["sbbInput","","sbbTimeInput","",3,"ngModel","ngModelChange","change"],[2,"margin-right","4px"],["type","button",1,"btn","btn-primary",3,"disabled","click"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],["class","ms-auto",4,"ngIf"],["class","row mb-2",4,"ngIf"],[1,"xml-info",3,"click"],[1,"layer-xml-info","badge","bg-info","text-dark"],[1,"mb-3","d-flex"],[1,"sbb-radio-group-horizontal",3,"ngModel","ngModelChange","change"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"sbb-radio-group-horizontal"],[3,"value","checked","change",4,"ngFor","ngForOf"],[3,"value","checked","change"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"],[1,"ms-auto"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"d-flex","flex-row-reverse"],["target","_blank",3,"href"],[4,"ngIf"],["clas","text-center",2,"width","7px","margin-left","4px"],["target","_blank","role","button",1,"text-decoration-underline",3,"click"]],template:function(e,i){1&e&&(oe(0,"div",0)(1,"div",1)(2,"sbb-accordion")(3,"sbb-expansion-panel",2)(4,"sbb-expansion-panel-header"),$e(5),de(),oe(6,"div",3)(7,"div",4)(8,"station-board-input",5),Qt("locationSelected",function(s){return i.onLocationSelected(s)}),de()(),$t(9,cY,3,0,"div",6),de(),$t(10,dY,4,2,"div",7),oe(11,"div",8)(12,"div")(13,"sbb-form-field",9)(14,"sbb-datepicker",10)(15,"input",11),Qt("ngModelChange",function(s){return i.searchDate=s})("dateChange",function(){return i.onDateTimeChanged()}),de()()()(),oe(16,"div",12)(17,"sbb-form-field",13)(18,"input",14),Qt("ngModelChange",function(s){return i.searchTime=s})("change",function(){return i.onDateTimeChanged()}),de()()()(),$t(19,pY,4,1,"div",7),oe(20,"div",8)(21,"div",15)(22,"button",16),Qt("click",function(){return i.searchButtonClicked()}),$t(23,fY,1,0,"span",17),$e(24," Search "),de()(),$t(25,mY,3,0,"div",18),de()()()()(),$t(26,gY,6,1,"div",19),$t(27,_Y,7,2,"div",19)),2&e&&(Le(3),Je("expanded",!0),Le(2),hi(i.headerText),Le(4),Je("ngIf",(null==i.currentRequestInfo?null:i.currentRequestInfo.requestXML)&&!i.isEmbed),Le(1),Je("ngIf",!i.isEmbed),Le(5),Je("ngModel",i.searchDate),Le(3),Je("ngModel",i.searchTime),Le(1),Je("ngIf",!i.isEmbed),Le(3),Je("disabled",i.isSearchButtonDisabled()),Le(1),Je("ngIf",i.isSearching),Le(2),Je("ngIf",!i.isEmbed),Le(1),Je("ngIf",i.isEmbed),Le(1),Je("ngIf",!i.isEmbed))},dependencies:[Sc,Ts,id,uh,Ip,$D,Im,_S,oI,DS,Bv,Zb,GF,aI,WF,aN],styles:[".xml-info[_ngcontent-%COMP%]{cursor:pointer;margin-left:5px}"]}),n})();const yY=[{path:"embed/search",component:(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=vn({type:n,selectors:[["embed-search"]],decls:5,vars:0,consts:[[1,"container"],[1,"row","app-root"],[1,"col"]],template:function(e,i){1&e&&(oe(0,"div",0)(1,"div",1)(2,"div",2),ln(3,"app-search-form")(4,"journey-results"),de()()())},dependencies:[dF,iN],styles:[".app-root[_ngcontent-%COMP%]{background-color:#fff;padding:8px}"]}),n})()},{path:"embed/board",component:(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=vn({type:n,selectors:[["embed-search"]],decls:5,vars:0,consts:[[1,"container"],[1,"row","app-root"],[1,"col"]],template:function(e,i){1&e&&(oe(0,"div",0)(1,"div",1)(2,"div",2),ln(3,"station-board-search")(4,"station-board-result"),de()()())},dependencies:[sN,lN],styles:[".app-root[_ngcontent-%COMP%]{background-color:#fff;padding:8px}"]}),n})()},{path:"search",component:UZ},{path:"board",component:(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=vn({type:n,selectors:[["station-board"]],decls:17,vars:4,consts:[[1,"container"],[1,"app-root"],["sbb-tab-nav-bar","",3,"tabPanel"],["sbb-tab-link","",3,"active","routerLink"],["sbb-tab-link","",3,"active"],["tabPanel",""],[1,"row"],[1,"col-md-5"],[1,"col-md-7"]],template:function(e,i){if(1&e&&(oe(0,"div",0),ln(1,"web-header"),oe(2,"div",1)(3,"nav",2)(4,"a",3),$e(5,"Journey Search"),de(),oe(6,"a",4),$e(7,"Station Board"),de()(),oe(8,"sbb-tab-nav-panel",null,5)(10,"div",6)(11,"div",7),ln(12,"station-board-search")(13,"station-board-result"),de(),oe(14,"div",8),ln(15,"station-board-map"),de()()()(),ln(16,"web-footer"),de()),2&e){const r=Nl(9);Le(3),Je("tabPanel",r),Le(1),Je("active","false")("routerLink","../search"),Le(2),Je("active","true")}},dependencies:[yv,yD,BO,vD,qZ,sN,lN,rN,oN],styles:[".app-root[_ngcontent-%COMP%]{background-color:#fff;border:1px solid #CACACA;margin-left:calc(-.5 * var(--bs-gutter-x));margin-right:calc(-.5 * var(--bs-gutter-x));padding:8px}"]}),n})()},{path:"",redirectTo:"/search",pathMatch:"full"}];let vY=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({imports:[$w.forRoot(yY),$w]}),n})(),xY=(()=>{class n{ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=vn({type:n,selectors:[["app-root"]],decls:1,vars:0,template:function(e,i){1&e&&ln(0,"router-outlet")},dependencies:[PE],encapsulation:2}),n})();Es("showDismiss",[dr("void, dismissed",Ln({height:0,paddingTop:0,paddingBottom:0,borderTopWidth:0,borderBottomWidth:0})),dr("visible",Ln({height:"*",paddingTop:"*",paddingBottom:"*",borderTopWidth:"*",borderBottomWidth:"*"})),qi("void => visible",Qi("0.25s cubic-bezier(0.4,0.0,0.2,1)")),qi("visible => dismissed",Qi("0.25s cubic-bezier(0.4,0.0,0.2,1)"))]);let cN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({imports:[gr,$w,Wi,mo]}),n})();Ga(class{});let uI=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({imports:[Sm,Wi]}),n})();Es("transformMenu",[dr("void",Ln({opacity:0})),dr("enter-usermenu",Ln({width:"{{width}}",maxHeight:"100%"}),{params:{width:"288px"}}),qi("void => enter",Qi("120ms cubic-bezier(0, 0, 0.2, 1)",Ln({opacity:1}))),qi("enter => void",Qi("100ms linear",Ln({opacity:0}))),qi("void => enter-usermenu",Qi("300ms cubic-bezier(.785,.135,.15,.86)",Wy([Ln({width:"var(--sbb-menu-trigger-width)",height:"var(--sbb-menu-trigger-height)",offset:0}),Ln({width:"{{width}}",height:"*",opacity:1,maxHeight:"100%",offset:1})]))),qi("enter-usermenu => void",Qi("300ms cubic-bezier(.785,.135,.15,.86)",Ln({opacity:0,width:"var(--sbb-menu-trigger-width)",height:"var(--sbb-menu-trigger-height)"})))]),new Et("SbbMenuContent"),new Et("SBB_MENU_PANEL"),Ga(class{}),new Et("sbb-menu-default-options",{providedIn:"root",factory:function EY(){return{overlapTrigger:!1,xPosition:"after",yPosition:"below",backdropClass:"cdk-overlay-transparent-backdrop"}}}),new Et("sbb-menu-inherited-trigger-context");const MY={provide:new Et("sbb-menu-scroll-strategy"),deps:[Bo],useFactory:function IY(n){return()=>n.scrollStrategies.reposition()}};kp({passive:!0}),Em(class{});let MS=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({providers:[MY],imports:[gr,bl,oa,Wi,mo,Tm]}),n})(),uN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({imports:[gr,Wi,MS,mo]}),n})();new Et("recaptcha-settings");let dN=(()=>{class n{get nativeWindow(){return function RY(){return window}()}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})();const PY=new Et("recaptcha-language"),LY=new Et("recaptcha-base-url"),OY=new Et("recaptcha-nonce-tag");let FY=(()=>{class n{constructor(e,i,r,s,d){this._windowRef=e,this._language=r||null,this._baseUrl=s||null,this._nonce=d||null,this._document=i,this._init(),this.ready=n._ready.pipe(Cr(m=>!!m))}_init(){if(n._ready)return;this._windowRef.nativeWindow.ng2recaptchaloaded=()=>{n._ready.next(grecaptcha)},n._ready=new ta(null);const e=this._document.createElement("script");e.innerHTML="",e.src=`${this._baseUrl||"https://www.google.com/recaptcha/api.js"}?render=explicit&onload=ng2recaptchaloaded${this._language?"&hl="+this._language:""}`,this._nonce&&(e.nonce=this._nonce),e.async=!0,e.defer=!0,this._document.head.appendChild(e)}}return n._ready=null,n.\u0275fac=function(e){return new(e||n)(ze(dN),ze($n),ze(PY,8),ze(LY,8),ze(OY,8))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})(),hN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({providers:[FY,dN],imports:[gr,Wi]}),n})();const NY=["*",[["sbb-checkbox-panel-subtitle"]],[["sbb-checkbox-panel-warning"]],[["sbb-checkbox-panel-note"]]],BY=["*","sbb-checkbox-panel-subtitle","sbb-checkbox-panel-warning","sbb-checkbox-panel-note"],zY={provide:Ha,useExisting:Ni(()=>VY),multi:!0};let VY=(()=>{class n extends DF{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Vi(n)))(i||n)}}(),n.\u0275cmp=vn({type:n,selectors:[["sbb-checkbox-panel"]],hostAttrs:[1,"sbb-checkbox-panel","sbb-selection-panel-item","sbb-checkbox","sbb-selection-item"],hostVars:8,hostBindings:function(e,i){2&e&&(vc("id",i.id),fn("tabindex",null),Ri("sbb-selection-indeterminate",i.indeterminate)("sbb-selection-checked",i.checked)("sbb-selection-disabled",i.disabled))},inputs:{tabIndex:"tabIndex"},exportAs:["sbbCheckboxPanel"],features:[Vn([zY]),qt],ngContentSelectors:BY,decls:16,vars:12,consts:[[1,"sbb-selection-item-label"],["type","checkbox",1,"cdk-visually-hidden","sbb-selection-input","sbb-checkbox-input","sbb-transparent-parent-overlay",3,"id","required","checked","disabled","tabIndex","change","click"],["input",""],[1,"sbb-selection-container"],[1,"sbb-selection-container-checked"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","focusable","false"],["fill","none","fill-rule","evenodd","stroke","#000","stroke-width","1","points","6 12 10 16 19 7.01"],[1,"sbb-selection-content"],[1,"sbb-selection-inner-content"],[2,"display","none"]],template:function(e,i){1&e&&(Mo(NY),oe(0,"label",0)(1,"input",1,2),Qt("change",function(s){return i._onInteractionEvent(s)})("click",function(s){return i._onInputClick(s)}),de(),oe(3,"span",3)(4,"span",4),F(),oe(5,"svg",5),ln(6,"polyline",6),de()()(),Y(),oe(7,"span",7)(8,"span",8)(9,"span",9),$e(10,"\xa0"),de(),oe(11,"span"),Pr(12),de(),Pr(13,1),de(),Pr(14,2),Pr(15,3),de()()),2&e&&(fn("for",i.inputId),Le(1),Je("id",i.inputId)("required",i.required)("checked",i.checked)("disabled",i.disabled)("tabIndex",i.tabIndex),fn("value",i.value)("name",i.name)("aria-label",i.ariaLabel||null)("aria-labelledby",i.ariaLabelledby)("aria-checked",i._getAriaChecked())("aria-describedby",i.ariaDescribedby))},encapsulation:2,changeDetection:0}),n})(),pN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({imports:[gr,Wi]}),n})();new Et("SBB_CHIP_LIST"),new Et("SBB_CHIP"),new Et("SbbChipRemove"),new Et("SbbChipTrailingIcon"),$b(class UY{constructor(t){this._elementRef=t}},-1);const vN=new Et("sbb-chips-default-options");nS(class{constructor(n,t,e,i){this._defaultErrorStateMatcher=n,this._parentForm=t,this._parentFormGroup=e,this.ngControl=i,this.stateChanges=new Zt}});let xN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({providers:[{provide:vN,useValue:{separatorKeyCodes:[13]}}],imports:[gr,Wi,mo]}),n})();new Et("FILE_SELECTOR_OPTIONS");const Ko={TEXT:["text/*"],IMAGE:["image/*"],IMAGE_JPG:["image/jpeg","image/pjpeg"],IMAGE_PNG:["image/png"],IMAGE_SVG:["image/svg+xml"],IMAGE_GIF:["image/gif"],AUDIO:["audio/*"],AUDIO_MP4:["audio/mp4"],AUDIO_MP3:["audio/mpeg","audio/mp3"],AUDIO_OGG:["audio/ogg"],AUDIO_WAVE:["audio/wave"],AUDIO_WAV:["audio/wav","audio/x-wav","audio/x-pn-wav","audio/webm"],VIDEO:["video/*"],VIDEO_MP4:["video/mp4"],VIDEO_MPEG:["video/mpeg"],VIDEO_OGG:["video/ogg"],VIDEO_MOV:["video/quicktime"],VIDEO_WEBM:["video/webm"],VIDEO_AVI:["video/x-msvideo"],VIDEO_WMV:["video/x-ms-wmv"],PDF:["application/pdf"],MS_WORD_DOC:["application/msword","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.wordprocessingml.template","application/vnd.ms-word.document.macroEnabled.12","application/vnd.ms-word.template.macroEnabled.12"],MS_EXCEL:["application/vnd.ms-excel","application/vnd.ms-excel","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.openxmlformats-officedocument.spreadsheetml.template","application/vnd.ms-excel.sheet.macroEnabled.12","application/vnd.ms-excel.template.macroEnabled.12","application/vnd.ms-excel.addin.macroEnabled.12","application/vnd.ms-excel.sheet.binary.macroEnabled.12"],MS_POWERPOINT:["application/vnd.ms-powerpoint","application/vnd.ms-powerpoint","application/vnd.ms-powerpoint","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.presentationml.template","application/vnd.openxmlformats-officedocument.presentationml.slideshow","application/vnd.ms-powerpoint.addin.macroEnabled.12","application/vnd.ms-powerpoint.presentation.macroEnabled.12","application/vnd.ms-powerpoint.presentation.macroEnabled.12","application/vnd.ms-powerpoint.slideshow.macroEnabled.12"],ZIP:["application/x-gtar","application/x-gcompress","application/compress","application/x-tar","application/x-rar-compressed","application/octet-stream","application/x-zip-compressed","application/zip-compressed","application/x-7z-compressed","application/gzip","application/zip","application/x-bzip2"]};(new Map).set("doc",[...Ko.MS_WORD_DOC,...Ko.MS_EXCEL,...Ko.MS_POWERPOINT]).set("audio",[...Ko.AUDIO_MP4,...Ko.AUDIO_MP3,...Ko.AUDIO_OGG,...Ko.AUDIO_WAVE,...Ko.AUDIO_WAV]).set("image",[...Ko.IMAGE_GIF,...Ko.IMAGE_JPG,...Ko.IMAGE_PNG,...Ko.IMAGE_SVG]).set("pdf",Ko.PDF).set("video",[...Ko.VIDEO_MP4,...Ko.VIDEO_MPEG,...Ko.VIDEO_OGG,...Ko.VIDEO_MOV,...Ko.VIDEO_WEBM,...Ko.VIDEO_AVI,...Ko.VIDEO_WMV]).set("zip",Ko.ZIP),Ga(class{constructor(n){this._elementRef=n}});let wN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({imports:[gr,Wi,mo]}),n})();new Et("SBB_HEADER"),Es("menu",[dr("open",Ln({left:0})),dr("void",Ln({left:-305,visibility:"hidden"})),qi("open => void, void => open",[Qi("0.3s ease-in-out")])]);const aK={provide:new Et("sbb-header-menu-scroll-strategy"),deps:[Bo],useFactory:function sK(n){return()=>n.scrollStrategies.reposition()}};kp({passive:!0}),Ga(class{});let SN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({providers:[aK],imports:[gr,Zw,bl,oa,Wi,mo]}),n})();function lK(n,t){}function cK(n,t){}class hI{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.ariaModal=!0,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.closeOnNavigation=!0,this.closeOnDestroy=!0}}let uK=(()=>{class n extends Sv{constructor(e,i,r,s,d,m,y,C){super(),this._elementRef=e,this._focusTrapFactory=i,this._config=s,this._interactivityChecker=d,this._ngZone=m,this._overlayRef=y,this._focusMonitor=C,this._elementFocusedBeforeDialogWasOpened=null,this._closeInteractionType=null,this.attachDomPortal=M=>{this._portalOutlet.hasAttached();const k=this._portalOutlet.attachDomPortal(M);return this._contentAttached(),k},this._ariaLabelledBy=this._config.ariaLabelledBy||null,this._document=r}_contentAttached(){this._initializeFocusTrap(),this._handleBackdropClicks(),this._captureInitialFocus()}_captureInitialFocus(){this._trapFocus()}ngOnDestroy(){this._restoreFocus()}attachComponentPortal(e){this._portalOutlet.hasAttached();const i=this._portalOutlet.attachComponentPortal(e);return this._contentAttached(),i}attachTemplatePortal(e){this._portalOutlet.hasAttached();const i=this._portalOutlet.attachTemplatePortal(e);return this._contentAttached(),i}_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(e,i){this._interactivityChecker.isFocusable(e)||(e.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{const r=()=>{e.removeEventListener("blur",r),e.removeEventListener("mousedown",r),e.removeAttribute("tabindex")};e.addEventListener("blur",r),e.addEventListener("mousedown",r)})),e.focus(i)}_focusByCssSelector(e,i){let r=this._elementRef.nativeElement.querySelector(e);r&&this._forceFocus(r,i)}_trapFocus(){const e=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||e.focus();break;case!0:case"first-tabbable":this._focusTrap.focusInitialElementWhenReady().then(i=>{i||this._focusDialogContainer()});break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this._config.autoFocus)}}_restoreFocus(){const e=this._config.restoreFocus;let i=null;if("string"==typeof e?i=this._document.querySelector(e):"boolean"==typeof e?i=e?this._elementFocusedBeforeDialogWasOpened:null:e&&(i=e),this._config.restoreFocus&&i&&"function"==typeof i.focus){const r=su(),s=this._elementRef.nativeElement;(!r||r===this._document.body||r===s||s.contains(r))&&(this._focusMonitor?(this._focusMonitor.focusVia(i,this._closeInteractionType),this._closeInteractionType=null):i.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){const e=this._elementRef.nativeElement,i=su();return e===i||e.contains(i)}_initializeFocusTrap(){this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=su())}_handleBackdropClicks(){this._overlayRef.backdropClick().subscribe(()=>{this._config.disableClose&&this._recaptureFocus()})}}return n.\u0275fac=function(e){return new(e||n)(G(Tn),G(Ub),G($n,8),G(hI),G(wm),G(qn),G(Up),G(fa))},n.\u0275cmp=vn({type:n,selectors:[["cdk-dialog-container"]],viewQuery:function(e,i){if(1&e&&ur(sd,7),2&e){let r;Nn(r=Bn())&&(i._portalOutlet=r.first)}},hostAttrs:["tabindex","-1",1,"cdk-dialog-container"],hostVars:6,hostBindings:function(e,i){2&e&&fn("id",i._config.id||null)("role",i._config.role)("aria-modal",i._config.ariaModal)("aria-labelledby",i._config.ariaLabel?null:i._ariaLabelledBy)("aria-label",i._config.ariaLabel)("aria-describedby",i._config.ariaDescribedBy||null)},features:[qt],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(e,i){1&e&&$t(0,lK,0,0,"ng-template",0)},dependencies:[sd],styles:[".cdk-dialog-container{display:block;width:100%;height:100%;min-height:inherit;max-height:inherit}"],encapsulation:2}),n})();class pI{constructor(t,e){this.overlayRef=t,this.config=e,this.closed=new Zt,this.disableClose=e.disableClose,this.backdropClick=t.backdropClick(),this.keydownEvents=t.keydownEvents(),this.outsidePointerEvents=t.outsidePointerEvents(),this.id=e.id,this.keydownEvents.subscribe(i=>{27===i.keyCode&&!this.disableClose&&!ra(i)&&(i.preventDefault(),this.close(void 0,{focusOrigin:"keyboard"}))}),this.backdropClick.subscribe(()=>{this.disableClose||this.close(void 0,{focusOrigin:"mouse"})})}close(t,e){if(this.containerInstance){const i=this.closed;this.containerInstance._closeInteractionType=(null==e?void 0:e.focusOrigin)||"program",this.overlayRef.dispose(),i.next(t),i.complete(),this.componentInstance=this.containerInstance=null}}updatePosition(){return this.overlayRef.updatePosition(),this}updateSize(t="",e=""){return this.overlayRef.updateSize({width:t,height:e}),this}addPanelClass(t){return this.overlayRef.addPanelClass(t),this}removePanelClass(t){return this.overlayRef.removePanelClass(t),this}}const CN=new Et("DialogScrollStrategy"),dK=new Et("DialogData"),hK=new Et("DefaultDialogConfig"),fK={provide:CN,deps:[Bo],useFactory:function pK(n){return()=>n.scrollStrategies.block()}};let mK=0,gK=(()=>{class n{constructor(e,i,r,s,d,m){this._overlay=e,this._injector=i,this._defaultOptions=r,this._parentDialog=s,this._overlayContainer=d,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new Zt,this._afterOpenedAtThisLevel=new Zt,this._ariaHiddenElements=new Map,this.afterAllClosed=hm(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(Ds(void 0))),this._scrollStrategy=m}get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}open(e,i){const r=this._defaultOptions||new hI;(i=Object.assign(Object.assign({},r),i)).id=i.id||"cdk-dialog-"+mK++,i.id&&this.getDialogById(i.id);const s=this._getOverlayConfig(i),d=this._overlay.create(s),m=new pI(d,i),y=this._attachContainer(d,m,i);return m.containerInstance=y,this._attachDialogContent(e,m,y,i),this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(m),m.closed.subscribe(()=>this._removeOpenDialog(m,!0)),this.afterOpened.next(m),m}closeAll(){fI(this.openDialogs,e=>e.close())}getDialogById(e){return this.openDialogs.find(i=>i.id===e)}ngOnDestroy(){fI(this._openDialogsAtThisLevel,e=>{!1===e.config.closeOnDestroy&&this._removeOpenDialog(e,!1)}),fI(this._openDialogsAtThisLevel,e=>e.close()),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete(),this._openDialogsAtThisLevel=[]}_getOverlayConfig(e){const i=new Mm({positionStrategy:e.positionStrategy||this._overlay.position().global().centerHorizontally().centerVertically(),scrollStrategy:e.scrollStrategy||this._scrollStrategy(),panelClass:e.panelClass,hasBackdrop:e.hasBackdrop,direction:e.direction,minWidth:e.minWidth,minHeight:e.minHeight,maxWidth:e.maxWidth,maxHeight:e.maxHeight,width:e.width,height:e.height,disposeOnNavigation:e.closeOnNavigation});return e.backdropClass&&(i.backdropClass=e.backdropClass),i}_attachContainer(e,i,r){var s;const d=r.injector||(null===(s=r.viewContainerRef)||void 0===s?void 0:s.injector),m=[{provide:hI,useValue:r},{provide:pI,useValue:i},{provide:Up,useValue:e}];let y;r.container?"function"==typeof r.container?y=r.container:(y=r.container.type,m.push(...r.container.providers(r))):y=uK;const C=new od(y,r.viewContainerRef,Nr.create({parent:d||this._injector,providers:m}),r.componentFactoryResolver);return e.attach(C).instance}_attachDialogContent(e,i,r,s){if(e instanceof Qr){const d=this._createInjector(s,i,r,void 0);let m={$implicit:s.data,dialogRef:i};s.templateContext&&(m=Object.assign(Object.assign({},m),"function"==typeof s.templateContext?s.templateContext():s.templateContext)),r.attachTemplatePortal(new Cm(e,null,m,d))}else{const d=this._createInjector(s,i,r,this._injector),m=r.attachComponentPortal(new od(e,s.viewContainerRef,d,s.componentFactoryResolver));i.componentInstance=m.instance}}_createInjector(e,i,r,s){var d;const m=e.injector||(null===(d=e.viewContainerRef)||void 0===d?void 0:d.injector),y=[{provide:dK,useValue:e.data},{provide:pI,useValue:i}];return e.providers&&("function"==typeof e.providers?y.push(...e.providers(i,e,r)):y.push(...e.providers)),e.direction&&(!m||!m.get(Lp,null,Un.Optional))&&y.push({provide:Lp,useValue:{value:e.direction,change:Rn()}}),Nr.create({parent:m||s,providers:y})}_removeOpenDialog(e,i){const r=this.openDialogs.indexOf(e);r>-1&&(this.openDialogs.splice(r,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((s,d)=>{s?d.setAttribute("aria-hidden",s):d.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),i&&this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){const e=this._overlayContainer.getContainerElement();if(e.parentElement){const i=e.parentElement.children;for(let r=i.length-1;r>-1;r--){const s=i[r];s!==e&&"SCRIPT"!==s.nodeName&&"STYLE"!==s.nodeName&&!s.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(s,s.getAttribute("aria-hidden")),s.setAttribute("aria-hidden","true"))}}}_getAfterAllClosed(){const e=this._parentDialog;return e?e._getAfterAllClosed():this._afterAllClosedAtThisLevel}}return n.\u0275fac=function(e){return new(e||n)(ze(Bo),ze(Nr),ze(hK,8),ze(n,12),ze(qb),ze(CN))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})();function fI(n,t){let e=n.length;for(;e--;)t(n[e])}let bK=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({providers:[gK,fK],imports:[bl,oa,Sm,oa]}),n})();const AS={params:{enterAnimationDuration:"150ms",exitAnimationDuration:"75ms"}},_K={lightboxContainer:Es("lightboxContainer",[dr("void, exit",Ln({opacity:0,transform:"scale(0.7)"})),dr("enter",Ln({transform:"none"})),qi("* => enter",Qi("{{enterAnimationDuration}} cubic-bezier(0, 0, 0.2, 1)",Ln({transform:"none",opacity:1})),AS),qi("* => void, * => exit",Qi("{{exitAnimationDuration}} cubic-bezier(0.4, 0.0, 0.2, 1)",Ln({opacity:0})),AS)])};let yK=(()=>{class n extends bF{constructor(e,i,r,s,d,m,y,C,M,k){var z;super(e,i,r,s,d,m,y,M),this._changeDetectorRef=C,this._viewportRuler=k,this._destroyed=new Zt,null===(z=this._viewportRuler)||void 0===z||z.change().pipe(Pi(this._destroyed),Ds(null)).subscribe(()=>{this._height=this._viewportRuler.getViewportSize().height})}_onAnimationDone({toState:e,totalTime:i}){"enter"===e?(this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:i})):"exit"===e&&this._animationStateChanged.next({state:"closed",totalTime:i})}_onAnimationStart({toState:e,totalTime:i}){"enter"===e?this._animationStateChanged.next({state:"opening",totalTime:i}):("exit"===e||"void"===e)&&this._animationStateChanged.next({state:"closing",totalTime:i})}_startExitAnimation(){this._state="exit",this._changeDetectorRef.markForCheck()}ngOnDestroy(){super.ngOnDestroy(),this._destroyed.next(),this._destroyed.complete()}}return n.\u0275fac=function(e){return new(e||n)(G(Tn),G(Ub),G($n,8),G(kv),G(wm),G(qn),G(Up),G(Sr),G(fa),G(lu))},n.\u0275cmp=vn({type:n,selectors:[["sbb-lightbox-container"]],hostAttrs:["tabindex","-1","aria-modal","true",1,"sbb-lightbox-container"],hostVars:8,hostBindings:function(e,i){1&e&&Iy("@lightboxContainer.done",function(s){return i._onAnimationDone(s)})("@lightboxContainer.start",function(s){return i._onAnimationStart(s)}),2&e&&(vc("id",i._config.id),fn("role",i._config.role)("aria-labelledby",i._config.ariaLabel?null:i._ariaLabelledBy)("aria-label",i._config.ariaLabel)("aria-describedby",i._config.ariaDescribedBy||null),Ay("@lightboxContainer",i._getAnimationState()),Zu("height",i._height,"px"))},features:[qt],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(e,i){1&e&&$t(0,cK,0,0,"ng-template",0)},dependencies:[sd],styles:[".sbb-overlay-background{background-color:var(--sbb-color-white-alpha70);align-items:center}.sbb-lightbox-container{display:flex;flex-direction:column;box-sizing:border-box;overflow:hidden;outline:0;background-color:var(--sbb-color-background);width:100%;height:100vh}.cdk-high-contrast-active .sbb-lightbox-container{outline:solid .0666666667rem}.sbb-lightbox-container>*:only-child:not(.sbb-lightbox-content){width:100%;height:100%;display:flex;flex-direction:column}.sbb-lightbox-content{display:block;padding:var(--sbb-divider-big) var(--sbb-lightbox-padding-horizontal);flex:1 1 auto;overflow:auto;-webkit-overflow-scrolling:touch}.sbb-lightbox-content>*:first-child{margin-top:0}.sbb-lightbox-title{padding:calc(1.4rem * var(--sbb-scaling-factor)) 3.7333333333rem calc(1.1333333333rem * var(--sbb-scaling-factor)) 1.3333333333rem;flex:0 0 auto;font-size:var(--sbb-font-size);line-height:var(--sbb-line-height);display:block;position:relative;box-shadow:var(--sbb-box-shadow-horizontal-border-top);overflow:hidden;white-space:nowrap;text-overflow:ellipsis;min-height:calc(4.2666666667rem * var(--sbb-scaling-factor))}@media all and (min-width: 40.1875em){.sbb-lightbox-title{padding-left:1.6rem;padding-right:4rem}}@media all and (min-width: 64.0625em){.sbb-lightbox-title{padding-left:calc(5.3333333333rem * var(--sbb-scaling-factor));padding-right:calc(6.1333333333rem * var(--sbb-scaling-factor))}}@media all and (min-width: 160.0625em)and (max-width: 240.0525em){:where(html:not(.sbb-lean)) .sbb-lightbox-title{padding-top:1.8666666667rem;padding-bottom:1.8666666667rem}}.sbb-lightbox-title-close-button{position:absolute;right:1.3333333333rem;cursor:pointer;line-height:0;color:var(--sbb-color-storm);outline:0}.sbb-lightbox-title-close-button:is(:hover,:focus){color:var(--sbb-color-call-to-action-hover)}@media all and (min-width: 40.1875em){.sbb-lightbox-title-close-button{right:1.6rem}}@media all and (min-width: 64.0625em){.sbb-lightbox-title-close-button{right:calc(3.7333333333rem * var(--sbb-scaling-factor))}}.sbb-lightbox-actions{padding:var(--sbb-lightbox-actions-padding-vertical) var(--sbb-lightbox-padding-horizontal);display:flex;flex:0 0 auto;flex-flow:column wrap;gap:var(--sbb-button-gap);align-items:center;justify-content:space-between;box-sizing:content-box;box-shadow:var(--sbb-box-shadow-horizontal-border-bottom)}@media all and (min-width: 40.1875em){.sbb-lightbox-actions{flex-direction:row}}"],encapsulation:2,data:{animation:[_K.lightboxContainer]}}),n})();class vK extends vS{constructor(t,e,i){super(t,e,i),this.closeRequest=new Zt,t.overlayRef.keydownEvents().pipe(Cr(r=>27===r.keyCode&&!!this.disableClose&&!ra(r))).subscribe(()=>this.closeRequest.next(null)),t.overlayRef.detachments().subscribe(()=>{this.closeRequest.complete()})}updatePosition(){return this}updateSize(){return this}}const xK=new Et("SbbLightboxData"),wK=new Et("sbb-lightbox-default-options"),TN=new Et("sbb-lightbox-scroll-strategy"),CK={provide:TN,deps:[Bo],useFactory:function SK(n){return()=>n.scrollStrategies.block()}};let TK=0,EK=(()=>{class n extends vF{constructor(e,i,r,s,d,m){super(e,i,r,d,m,s,vK,yK,xK),this._idPrefix="sbb-lightbox-"}get openLightboxes(){return this.openDialogs}open(e,i){const r=Object.assign(Object.assign({},i),{width:"100vw",minWidth:"100vw",maxWidth:"100vw",height:"auto",minHeight:"auto",maxHeight:"none"});return r.id=r.id||`${this._idPrefix}${TK++}`,super.open(e,r)}getDialogById(e){return this.openDialogs.find(i=>i.id===e)}getLightboxById(e){return this.getDialogById(e)}}return n.\u0275fac=function(e){return new(e||n)(ze(Bo),ze(Nr),ze(wK,8),ze(TN),ze(n,12),ze(qb))},n.\u0275prov=Jt({token:n,factory:n.\u0275fac}),n})(),EN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({providers:[EK,CK],imports:[gr,bK,ZD,bl,oa,Wi,mo]}),n})(),DN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({imports:[gr,Wi]}),n})();Es("showDismiss",[dr("void, dismissed",Ln({height:0,paddingTop:0,paddingBottom:0,borderTopWidth:0,borderBottomWidth:0})),dr("visible",Ln({height:"*",paddingTop:"*",paddingBottom:"*",borderTopWidth:"*",borderBottomWidth:"*"})),qi("visible => dismissed",Qi("0.25s cubic-bezier(0.4,0.0,0.2,1)"))]),Em(class{});let IN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({imports:[gr,Wi,mo]}),n})();new Et("SBB_PAGINATOR_DEFAULT_OPTIONS"),Ga(SO(class{}));let MN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({imports:[gr,$w,Wi,mo]}),n})(),kK=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({imports:[tS]}),n})();Es("stepTransition",[qi("* => previous, * => next",[Ln({opacity:1}),Qi("150ms ease",Ln({opacity:0}))]),qi("previous => current, next => current",[Ln({opacity:0}),Qi("500ms ease",Ln({opacity:1}))]),qi("void => current",Qi("0s"))]);let AN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({imports:[gr,oa,kK,Wi,mo]}),n})(),kN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({imports:[gr,Wi,lI]}),n})();Es("growShrink",[dr("void",Ln({opacity:0,width:"0px"})),dr("open",Ln({opacity:1,width:"*"})),qi("void => *",Qi("300ms ease")),qi("* => void",Qi("300ms 25ms linear"))]);const FK={provide:new Et("sbb-select-scroll-strategy"),deps:[Bo],useFactory:function OK(n){return()=>n.scrollStrategies.reposition()}};["start","center","end"].map(n=>({originX:n,originY:"top",overlayX:n,overlayY:"top"}));let RN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({providers:[FK],imports:[gr,oa,bl,Wi,JD,mo]}),n})();new Et("SBB_SIDEBAR_CONTAINER"),Es("transform",[dr("open, open-instant",Ln({transform:"none",visibility:"visible"})),dr("void",Ln({"box-shadow":"none",visibility:"hidden"})),qi("void => open-instant",Qi("0ms")),qi("void <=> open, open-instant => void",Qi("300ms cubic-bezier(0.785, 0.135, 0.15, 0.86)"))]);let PN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({imports:[gr,Tm,Wi,mo,Tm]}),n})(),LN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({imports:[gr,Wi,mo]}),n})(),KK=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({imports:[dD]}),n})();new Et("SBB_SORT_DEFAULT_OPTIONS"),SO(Ga(class{}));const Jb="225ms cubic-bezier(0.4,0.0,0.2,1)";Es("indicator",[dr("active-asc, asc",Ln({transform:"scaleY(-1)"})),dr("active-desc, desc",Ln({transform:"scaleY(1)"})),qi("active-asc <=> active-desc",Qi(Jb)),qi("asc <=> desc",Qi("0ms"))]),Es("arrowOpacity",[dr("desc-to-active, asc-to-active, active",Ln({opacity:1})),dr("desc-to-hint, asc-to-hint, hint",Ln({opacity:.54})),dr("hint-to-desc, active-to-desc, desc, hint-to-asc, active-to-asc, asc, void",Ln({opacity:0})),qi("* => asc, * => desc, * => active, * => hint, * => void",Qi("0ms")),qi("* <=> *",Qi(Jb))]),Es("arrowPosition",[qi("* => desc-to-hint, * => desc-to-active",Qi(Jb,Wy([Ln({transform:"translateY(-25%)"}),Ln({transform:"translateY(0)"})]))),qi("* => hint-to-desc, * => active-to-desc",Qi(Jb,Wy([Ln({transform:"translateY(0)"}),Ln({transform:"translateY(25%)"})]))),qi("* => asc-to-hint, * => asc-to-active",Qi(Jb,Wy([Ln({transform:"translateY(25%)"}),Ln({transform:"translateY(0)"})]))),qi("* => hint-to-asc, * => active-to-asc",Qi(Jb,Wy([Ln({transform:"translateY(0)"}),Ln({transform:"translateY(-25%)"})]))),dr("desc-to-hint, asc-to-hint, hint, desc-to-active, asc-to-active, active",Ln({transform:"translateY(0)"})),dr("hint-to-desc, active-to-desc, desc",Ln({transform:"translateY(-25%)"})),dr("hint-to-asc, active-to-asc, asc",Ln({transform:"translateY(25%)"}))]),Es("allowChildren",[qi("* <=> *",[gT("@*",mT(),{optional:!0})])]),Ga(class{}),kp({passive:!0});let WN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({imports:[KK,gr,Wi]}),n})(),XN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({imports:[gr,Wi,uI]}),n})();nS(class{constructor(n,t,e,i){this._defaultErrorStateMatcher=n,this._parentForm=t,this._parentFormGroup=e,this.ngControl=i,this.stateChanges=new Zt}});let ZN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({imports:[gr,tI,Wi]}),n})(),YN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({imports:[gr,Wi]}),n})();const KN="225ms cubic-bezier(0.785, 0.135, 0.15, 0.86)";Es("translateHeight",[dr("void",Ln({height:0,paddingTop:0,paddingBottom:0})),dr("auto",Ln({height:"*",paddingTop:"*",paddingBottom:"*"})),qi("fixed => auto, initial => auto, * => void",[Ln({height:"{{currentHeight}}px"}),Qi(KN)]),qi("void => fixed, void => auto",Qi(KN)),qi("void => initial",Qi(0))]);let QN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({imports:[gr,oa,Wi,mo]}),n})();Em(class{});let JN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({imports:[gr,Wi,mo,MS]}),n})();const FQ=[WO,cN,JF,uI,uN,JD,hN,MF,pN,xN,UF,ZD,wN,TS,SN,mo,NF,EN,DN,MS,IN,QD,MN,AN,lI,kN,RN,nN,PN,LN,WN,zO,XN,ZN,YN,XF,QN,uF,JN];let NQ=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n}),n.\u0275inj=wn({imports:[FQ,WO,cN,JF,uI,uN,JD,hN,MF,pN,xN,UF,ZD,wN,TS,SN,mo,NF,EN,DN,MS,IN,QD,MN,AN,lI,kN,RN,nN,PN,LN,WN,zO,XN,ZN,YN,XF,QN,uF,JN]}),n})(),BQ=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=xn({type:n,bootstrap:[xY]}),n.\u0275inj=wn({imports:[_R,oU,yU,vY,CH,TH,NQ]}),n})();(function gV(){mk=!1})(),Xj().bootstrapModule(BQ).catch(n=>console.error(n))},5343:(rn,hn)=>{"use strict";hn.byteLength=function ne(Ge){var xt=Ye(Ge),_n=xt[1];return 3*(xt[0]+_n)/4-_n},hn.toByteArray=function Xe(Ge){var xt,ye,Kt=Ye(Ge),_n=Kt[0],Sn=Kt[1],st=new Me(function Ve(Ge,xt,Kt){return 3*(xt+Kt)/4-Kt}(0,_n,Sn)),an=0,we=Sn>0?_n-4:_n;for(ye=0;ye<we;ye+=4)xt=be[Ge.charCodeAt(ye)]<<18|be[Ge.charCodeAt(ye+1)]<<12|be[Ge.charCodeAt(ye+2)]<<6|be[Ge.charCodeAt(ye+3)],st[an++]=xt>>16&255,st[an++]=xt>>8&255,st[an++]=255&xt;return 2===Sn&&(xt=be[Ge.charCodeAt(ye)]<<2|be[Ge.charCodeAt(ye+1)]>>4,st[an++]=255&xt),1===Sn&&(xt=be[Ge.charCodeAt(ye)]<<10|be[Ge.charCodeAt(ye+1)]<<4|be[Ge.charCodeAt(ye+2)]>>2,st[an++]=xt>>8&255,st[an++]=255&xt),st},hn.fromByteArray=function Ue(Ge){for(var xt,Kt=Ge.length,_n=Kt%3,Sn=[],an=0,we=Kt-_n;an<we;an+=16383)Sn.push(wt(Ge,an,an+16383>we?we:an+16383));return 1===_n?Sn.push(qe[(xt=Ge[Kt-1])>>2]+qe[xt<<4&63]+"=="):2===_n&&Sn.push(qe[(xt=(Ge[Kt-2]<<8)+Ge[Kt-1])>>10]+qe[xt>>4&63]+qe[xt<<2&63]+"="),Sn.join("")};for(var qe=[],be=[],Me="undefined"!=typeof Uint8Array?Uint8Array:Array,Te="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",p=0,te=Te.length;p<te;++p)qe[p]=Te[p],be[Te.charCodeAt(p)]=p;function Ye(Ge){var xt=Ge.length;if(xt%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var Kt=Ge.indexOf("=");return-1===Kt&&(Kt=xt),[Kt,Kt===xt?0:4-Kt%4]}function gt(Ge){return qe[Ge>>18&63]+qe[Ge>>12&63]+qe[Ge>>6&63]+qe[63&Ge]}function wt(Ge,xt,Kt){for(var Sn=[],st=xt;st<Kt;st+=3)Sn.push(gt((Ge[st]<<16&16711680)+(Ge[st+1]<<8&65280)+(255&Ge[st+2])));return Sn.join("")}be["-".charCodeAt(0)]=62,be["_".charCodeAt(0)]=63},3172:(rn,hn,qe)=>{"use strict";var be=qe(5343),Me=qe(8461),Te="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;hn.Buffer=ne,hn.SlowBuffer=function st(he){return+he!=he&&(he=0),ne.alloc(+he)},hn.INSPECT_MAX_BYTES=50;var p=2147483647;function Ye(he){if(he>p)throw new RangeError('The value "'+he+'" is invalid for option "size"');var V=new Uint8Array(he);return Object.setPrototypeOf(V,ne.prototype),V}function ne(he,V,H){if("number"==typeof he){if("string"==typeof V)throw new TypeError('The "string" argument must be of type string. Received type number');return wt(he)}return Ve(he,V,H)}function Ve(he,V,H){if("string"==typeof he)return function Ue(he,V){if(("string"!=typeof V||""===V)&&(V="utf8"),!ne.isEncoding(V))throw new TypeError("Unknown encoding: "+V);var H=0|an(he,V),Ee=Ye(H),Ke=Ee.write(he,V);return Ke!==H&&(Ee=Ee.slice(0,Ke)),Ee}(he,V);if(ArrayBuffer.isView(he))return function xt(he){if(vi(he,Uint8Array)){var V=new Uint8Array(he);return Kt(V.buffer,V.byteOffset,V.byteLength)}return Ge(he)}(he);if(null==he)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof he);if(vi(he,ArrayBuffer)||he&&vi(he.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(vi(he,SharedArrayBuffer)||he&&vi(he.buffer,SharedArrayBuffer)))return Kt(he,V,H);if("number"==typeof he)throw new TypeError('The "value" argument must not be of type number. Received type number');var Ee=he.valueOf&&he.valueOf();if(null!=Ee&&Ee!==he)return ne.from(Ee,V,H);var Ke=function _n(he){if(ne.isBuffer(he)){var V=0|Sn(he.length),H=Ye(V);return 0===H.length||he.copy(H,0,0,V),H}return void 0!==he.length?"number"!=typeof he.length||qr(he.length)?Ye(0):Ge(he):"Buffer"===he.type&&Array.isArray(he.data)?Ge(he.data):void 0}(he);if(Ke)return Ke;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof he[Symbol.toPrimitive])return ne.from(he[Symbol.toPrimitive]("string"),V,H);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof he)}function Xe(he){if("number"!=typeof he)throw new TypeError('"size" argument must be of type number');if(he<0)throw new RangeError('The value "'+he+'" is invalid for option "size"')}function wt(he){return Xe(he),Ye(he<0?0:0|Sn(he))}function Ge(he){for(var V=he.length<0?0:0|Sn(he.length),H=Ye(V),Ee=0;Ee<V;Ee+=1)H[Ee]=255&he[Ee];return H}function Kt(he,V,H){if(V<0||he.byteLength<V)throw new RangeError('"offset" is outside of buffer bounds');if(he.byteLength<V+(H||0))throw new RangeError('"length" is outside of buffer bounds');var Ee;return Ee=void 0===V&&void 0===H?new Uint8Array(he):void 0===H?new Uint8Array(he,V):new Uint8Array(he,V,H),Object.setPrototypeOf(Ee,ne.prototype),Ee}function Sn(he){if(he>=p)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+p.toString(16)+" bytes");return 0|he}function an(he,V){if(ne.isBuffer(he))return he.length;if(ArrayBuffer.isView(he)||vi(he,ArrayBuffer))return he.byteLength;if("string"!=typeof he)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof he);var H=he.length,Ee=arguments.length>2&&!0===arguments[2];if(!Ee&&0===H)return 0;for(var Ke=!1;;)switch(V){case"ascii":case"latin1":case"binary":return H;case"utf8":case"utf-8":return W(he).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*H;case"hex":return H>>>1;case"base64":return Ii(he).length;default:if(Ke)return Ee?-1:W(he).length;V=(""+V).toLowerCase(),Ke=!0}}function we(he,V,H){var Ee=!1;if((void 0===V||V<0)&&(V=0),V>this.length||((void 0===H||H>this.length)&&(H=this.length),H<=0)||(H>>>=0)<=(V>>>=0))return"";for(he||(he="utf8");;)switch(he){case"hex":return Hi(this,V,H);case"utf8":case"utf-8":return yt(this,V,H);case"ascii":return kt(this,V,H);case"latin1":case"binary":return cn(this,V,H);case"base64":return je(this,V,H);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Li(this,V,H);default:if(Ee)throw new TypeError("Unknown encoding: "+he);he=(he+"").toLowerCase(),Ee=!0}}function ye(he,V,H){var Ee=he[V];he[V]=he[H],he[H]=Ee}function Ie(he,V,H,Ee,Ke){if(0===he.length)return-1;if("string"==typeof H?(Ee=H,H=0):H>2147483647?H=2147483647:H<-2147483648&&(H=-2147483648),qr(H=+H)&&(H=Ke?0:he.length-1),H<0&&(H=he.length+H),H>=he.length){if(Ke)return-1;H=he.length-1}else if(H<0){if(!Ke)return-1;H=0}if("string"==typeof V&&(V=ne.from(V,Ee)),ne.isBuffer(V))return 0===V.length?-1:ae(he,V,H,Ee,Ke);if("number"==typeof V)return V&=255,"function"==typeof Uint8Array.prototype.indexOf?Ke?Uint8Array.prototype.indexOf.call(he,V,H):Uint8Array.prototype.lastIndexOf.call(he,V,H):ae(he,[V],H,Ee,Ke);throw new TypeError("val must be string, number or Buffer")}function ae(he,V,H,Ee,Ke){var er,jt=1,en=he.length,Oi=V.length;if(void 0!==Ee&&("ucs2"===(Ee=String(Ee).toLowerCase())||"ucs-2"===Ee||"utf16le"===Ee||"utf-16le"===Ee)){if(he.length<2||V.length<2)return-1;jt=2,en/=2,Oi/=2,H/=2}function Si(ds,_a){return 1===jt?ds[_a]:ds.readUInt16BE(_a*jt)}if(Ke){var Jr=-1;for(er=H;er<en;er++)if(Si(he,er)===Si(V,-1===Jr?0:er-Jr)){if(-1===Jr&&(Jr=er),er-Jr+1===Oi)return Jr*jt}else-1!==Jr&&(er-=er-Jr),Jr=-1}else for(H+Oi>en&&(H=en-Oi),er=H;er>=0;er--){for(var br=!0,ba=0;ba<Oi;ba++)if(Si(he,er+ba)!==Si(V,ba)){br=!1;break}if(br)return er}return-1}function dt(he,V,H,Ee){H=Number(H)||0;var Ke=he.length-H;Ee?(Ee=Number(Ee))>Ke&&(Ee=Ke):Ee=Ke;var jt=V.length;Ee>jt/2&&(Ee=jt/2);for(var en=0;en<Ee;++en){var Oi=parseInt(V.substr(2*en,2),16);if(qr(Oi))return en;he[H+en]=Oi}return en}function re(he,V,H,Ee){return Qn(W(V,he.length-H),he,H,Ee)}function me(he,V,H,Ee){return Qn(function Pt(he){for(var V=[],H=0;H<he.length;++H)V.push(255&he.charCodeAt(H));return V}(V),he,H,Ee)}function lt(he,V,H,Ee){return Qn(Ii(V),he,H,Ee)}function mt(he,V,H,Ee){return Qn(function Qe(he,V){for(var H,Ee,jt=[],en=0;en<he.length&&!((V-=2)<0);++en)Ee=(H=he.charCodeAt(en))>>8,jt.push(H%256),jt.push(Ee);return jt}(V,he.length-H),he,H,Ee)}function je(he,V,H){return be.fromByteArray(0===V&&H===he.length?he:he.slice(V,H))}function yt(he,V,H){H=Math.min(he.length,H);for(var Ee=[],Ke=V;Ke<H;){var Si,er,Jr,br,jt=he[Ke],en=null,Oi=jt>239?4:jt>223?3:jt>191?2:1;if(Ke+Oi<=H)switch(Oi){case 1:jt<128&&(en=jt);break;case 2:128==(192&(Si=he[Ke+1]))&&(br=(31&jt)<<6|63&Si)>127&&(en=br);break;case 3:er=he[Ke+2],128==(192&(Si=he[Ke+1]))&&128==(192&er)&&(br=(15&jt)<<12|(63&Si)<<6|63&er)>2047&&(br<55296||br>57343)&&(en=br);break;case 4:er=he[Ke+2],Jr=he[Ke+3],128==(192&(Si=he[Ke+1]))&&128==(192&er)&&128==(192&Jr)&&(br=(15&jt)<<18|(63&Si)<<12|(63&er)<<6|63&Jr)>65535&&br<1114112&&(en=br)}null===en?(en=65533,Oi=1):en>65535&&(Ee.push((en-=65536)>>>10&1023|55296),en=56320|1023&en),Ee.push(en),Ke+=Oi}return function ri(he){var V=he.length;if(V<=4096)return String.fromCharCode.apply(String,he);for(var H="",Ee=0;Ee<V;)H+=String.fromCharCode.apply(String,he.slice(Ee,Ee+=4096));return H}(Ee)}function kt(he,V,H){var Ee="";H=Math.min(he.length,H);for(var Ke=V;Ke<H;++Ke)Ee+=String.fromCharCode(127&he[Ke]);return Ee}function cn(he,V,H){var Ee="";H=Math.min(he.length,H);for(var Ke=V;Ke<H;++Ke)Ee+=String.fromCharCode(he[Ke]);return Ee}function Hi(he,V,H){var Ee=he.length;(!V||V<0)&&(V=0),(!H||H<0||H>Ee)&&(H=Ee);for(var Ke="",jt=V;jt<H;++jt)Ke+=Wr[he[jt]];return Ke}function Li(he,V,H){for(var Ee=he.slice(V,H),Ke="",jt=0;jt<Ee.length-1;jt+=2)Ke+=String.fromCharCode(Ee[jt]+256*Ee[jt+1]);return Ke}function yi(he,V,H){if(he%1!=0||he<0)throw new RangeError("offset is not uint");if(he+V>H)throw new RangeError("Trying to access beyond buffer length")}function Zt(he,V,H,Ee,Ke,jt){if(!ne.isBuffer(he))throw new TypeError('"buffer" argument must be a Buffer instance');if(V>Ke||V<jt)throw new RangeError('"value" argument is out of bounds');if(H+Ee>he.length)throw new RangeError("Index out of range")}function xo(he,V,H,Ee,Ke,jt){if(H+Ee>he.length)throw new RangeError("Index out of range");if(H<0)throw new RangeError("Index out of range")}function go(he,V,H,Ee,Ke){return V=+V,H>>>=0,Ke||xo(he,0,H,4),Me.write(he,V,H,Ee,23,4),H+4}function Di(he,V,H,Ee,Ke){return V=+V,H>>>=0,Ke||xo(he,0,H,8),Me.write(he,V,H,Ee,52,8),H+8}hn.kMaxLength=p,!(ne.TYPED_ARRAY_SUPPORT=function te(){try{var he=new Uint8Array(1),V={foo:function(){return 42}};return Object.setPrototypeOf(V,Uint8Array.prototype),Object.setPrototypeOf(he,V),42===he.foo()}catch(H){return!1}}())&&"undefined"!=typeof console&&"function"==typeof console.error&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(ne.prototype,"parent",{enumerable:!0,get:function(){if(ne.isBuffer(this))return this.buffer}}),Object.defineProperty(ne.prototype,"offset",{enumerable:!0,get:function(){if(ne.isBuffer(this))return this.byteOffset}}),ne.poolSize=8192,ne.from=function(he,V,H){return Ve(he,V,H)},Object.setPrototypeOf(ne.prototype,Uint8Array.prototype),Object.setPrototypeOf(ne,Uint8Array),ne.alloc=function(he,V,H){return function gt(he,V,H){return Xe(he),he<=0?Ye(he):void 0!==V?"string"==typeof H?Ye(he).fill(V,H):Ye(he).fill(V):Ye(he)}(he,V,H)},ne.allocUnsafe=function(he){return wt(he)},ne.allocUnsafeSlow=function(he){return wt(he)},ne.isBuffer=function(V){return null!=V&&!0===V._isBuffer&&V!==ne.prototype},ne.compare=function(V,H){if(vi(V,Uint8Array)&&(V=ne.from(V,V.offset,V.byteLength)),vi(H,Uint8Array)&&(H=ne.from(H,H.offset,H.byteLength)),!ne.isBuffer(V)||!ne.isBuffer(H))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(V===H)return 0;for(var Ee=V.length,Ke=H.length,jt=0,en=Math.min(Ee,Ke);jt<en;++jt)if(V[jt]!==H[jt]){Ee=V[jt],Ke=H[jt];break}return Ee<Ke?-1:Ke<Ee?1:0},ne.isEncoding=function(V){switch(String(V).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},ne.concat=function(V,H){if(!Array.isArray(V))throw new TypeError('"list" argument must be an Array of Buffers');if(0===V.length)return ne.alloc(0);var Ee;if(void 0===H)for(H=0,Ee=0;Ee<V.length;++Ee)H+=V[Ee].length;var Ke=ne.allocUnsafe(H),jt=0;for(Ee=0;Ee<V.length;++Ee){var en=V[Ee];if(vi(en,Uint8Array))jt+en.length>Ke.length?ne.from(en).copy(Ke,jt):Uint8Array.prototype.set.call(Ke,en,jt);else{if(!ne.isBuffer(en))throw new TypeError('"list" argument must be an Array of Buffers');en.copy(Ke,jt)}jt+=en.length}return Ke},ne.byteLength=an,ne.prototype._isBuffer=!0,ne.prototype.swap16=function(){var V=this.length;if(V%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var H=0;H<V;H+=2)ye(this,H,H+1);return this},ne.prototype.swap32=function(){var V=this.length;if(V%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var H=0;H<V;H+=4)ye(this,H,H+3),ye(this,H+1,H+2);return this},ne.prototype.swap64=function(){var V=this.length;if(V%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var H=0;H<V;H+=8)ye(this,H,H+7),ye(this,H+1,H+6),ye(this,H+2,H+5),ye(this,H+3,H+4);return this},ne.prototype.toLocaleString=ne.prototype.toString=function(){var V=this.length;return 0===V?"":0===arguments.length?yt(this,0,V):we.apply(this,arguments)},ne.prototype.equals=function(V){if(!ne.isBuffer(V))throw new TypeError("Argument must be a Buffer");return this===V||0===ne.compare(this,V)},ne.prototype.inspect=function(){var V="",H=hn.INSPECT_MAX_BYTES;return V=this.toString("hex",0,H).replace(/(.{2})/g,"$1 ").trim(),this.length>H&&(V+=" ... "),"<Buffer "+V+">"},Te&&(ne.prototype[Te]=ne.prototype.inspect),ne.prototype.compare=function(V,H,Ee,Ke,jt){if(vi(V,Uint8Array)&&(V=ne.from(V,V.offset,V.byteLength)),!ne.isBuffer(V))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof V);if(void 0===H&&(H=0),void 0===Ee&&(Ee=V?V.length:0),void 0===Ke&&(Ke=0),void 0===jt&&(jt=this.length),H<0||Ee>V.length||Ke<0||jt>this.length)throw new RangeError("out of range index");if(Ke>=jt&&H>=Ee)return 0;if(Ke>=jt)return-1;if(H>=Ee)return 1;if(this===V)return 0;for(var en=(jt>>>=0)-(Ke>>>=0),Oi=(Ee>>>=0)-(H>>>=0),Si=Math.min(en,Oi),er=this.slice(Ke,jt),Jr=V.slice(H,Ee),br=0;br<Si;++br)if(er[br]!==Jr[br]){en=er[br],Oi=Jr[br];break}return en<Oi?-1:Oi<en?1:0},ne.prototype.includes=function(V,H,Ee){return-1!==this.indexOf(V,H,Ee)},ne.prototype.indexOf=function(V,H,Ee){return Ie(this,V,H,Ee,!0)},ne.prototype.lastIndexOf=function(V,H,Ee){return Ie(this,V,H,Ee,!1)},ne.prototype.write=function(V,H,Ee,Ke){if(void 0===H)Ke="utf8",Ee=this.length,H=0;else if(void 0===Ee&&"string"==typeof H)Ke=H,Ee=this.length,H=0;else{if(!isFinite(H))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");H>>>=0,isFinite(Ee)?(Ee>>>=0,void 0===Ke&&(Ke="utf8")):(Ke=Ee,Ee=void 0)}var jt=this.length-H;if((void 0===Ee||Ee>jt)&&(Ee=jt),V.length>0&&(Ee<0||H<0)||H>this.length)throw new RangeError("Attempt to write outside buffer bounds");Ke||(Ke="utf8");for(var en=!1;;)switch(Ke){case"hex":return dt(this,V,H,Ee);case"utf8":case"utf-8":return re(this,V,H,Ee);case"ascii":case"latin1":case"binary":return me(this,V,H,Ee);case"base64":return lt(this,V,H,Ee);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return mt(this,V,H,Ee);default:if(en)throw new TypeError("Unknown encoding: "+Ke);Ke=(""+Ke).toLowerCase(),en=!0}},ne.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},ne.prototype.slice=function(V,H){var Ee=this.length;(V=~~V)<0?(V+=Ee)<0&&(V=0):V>Ee&&(V=Ee),(H=void 0===H?Ee:~~H)<0?(H+=Ee)<0&&(H=0):H>Ee&&(H=Ee),H<V&&(H=V);var Ke=this.subarray(V,H);return Object.setPrototypeOf(Ke,ne.prototype),Ke},ne.prototype.readUintLE=ne.prototype.readUIntLE=function(V,H,Ee){V>>>=0,H>>>=0,Ee||yi(V,H,this.length);for(var Ke=this[V],jt=1,en=0;++en<H&&(jt*=256);)Ke+=this[V+en]*jt;return Ke},ne.prototype.readUintBE=ne.prototype.readUIntBE=function(V,H,Ee){V>>>=0,H>>>=0,Ee||yi(V,H,this.length);for(var Ke=this[V+--H],jt=1;H>0&&(jt*=256);)Ke+=this[V+--H]*jt;return Ke},ne.prototype.readUint8=ne.prototype.readUInt8=function(V,H){return V>>>=0,H||yi(V,1,this.length),this[V]},ne.prototype.readUint16LE=ne.prototype.readUInt16LE=function(V,H){return V>>>=0,H||yi(V,2,this.length),this[V]|this[V+1]<<8},ne.prototype.readUint16BE=ne.prototype.readUInt16BE=function(V,H){return V>>>=0,H||yi(V,2,this.length),this[V]<<8|this[V+1]},ne.prototype.readUint32LE=ne.prototype.readUInt32LE=function(V,H){return V>>>=0,H||yi(V,4,this.length),(this[V]|this[V+1]<<8|this[V+2]<<16)+16777216*this[V+3]},ne.prototype.readUint32BE=ne.prototype.readUInt32BE=function(V,H){return V>>>=0,H||yi(V,4,this.length),16777216*this[V]+(this[V+1]<<16|this[V+2]<<8|this[V+3])},ne.prototype.readIntLE=function(V,H,Ee){V>>>=0,H>>>=0,Ee||yi(V,H,this.length);for(var Ke=this[V],jt=1,en=0;++en<H&&(jt*=256);)Ke+=this[V+en]*jt;return Ke>=(jt*=128)&&(Ke-=Math.pow(2,8*H)),Ke},ne.prototype.readIntBE=function(V,H,Ee){V>>>=0,H>>>=0,Ee||yi(V,H,this.length);for(var Ke=H,jt=1,en=this[V+--Ke];Ke>0&&(jt*=256);)en+=this[V+--Ke]*jt;return en>=(jt*=128)&&(en-=Math.pow(2,8*H)),en},ne.prototype.readInt8=function(V,H){return V>>>=0,H||yi(V,1,this.length),128&this[V]?-1*(255-this[V]+1):this[V]},ne.prototype.readInt16LE=function(V,H){V>>>=0,H||yi(V,2,this.length);var Ee=this[V]|this[V+1]<<8;return 32768&Ee?4294901760|Ee:Ee},ne.prototype.readInt16BE=function(V,H){V>>>=0,H||yi(V,2,this.length);var Ee=this[V+1]|this[V]<<8;return 32768&Ee?4294901760|Ee:Ee},ne.prototype.readInt32LE=function(V,H){return V>>>=0,H||yi(V,4,this.length),this[V]|this[V+1]<<8|this[V+2]<<16|this[V+3]<<24},ne.prototype.readInt32BE=function(V,H){return V>>>=0,H||yi(V,4,this.length),this[V]<<24|this[V+1]<<16|this[V+2]<<8|this[V+3]},ne.prototype.readFloatLE=function(V,H){return V>>>=0,H||yi(V,4,this.length),Me.read(this,V,!0,23,4)},ne.prototype.readFloatBE=function(V,H){return V>>>=0,H||yi(V,4,this.length),Me.read(this,V,!1,23,4)},ne.prototype.readDoubleLE=function(V,H){return V>>>=0,H||yi(V,8,this.length),Me.read(this,V,!0,52,8)},ne.prototype.readDoubleBE=function(V,H){return V>>>=0,H||yi(V,8,this.length),Me.read(this,V,!1,52,8)},ne.prototype.writeUintLE=ne.prototype.writeUIntLE=function(V,H,Ee,Ke){V=+V,H>>>=0,Ee>>>=0,Ke||Zt(this,V,H,Ee,Math.pow(2,8*Ee)-1,0);var en=1,Oi=0;for(this[H]=255&V;++Oi<Ee&&(en*=256);)this[H+Oi]=V/en&255;return H+Ee},ne.prototype.writeUintBE=ne.prototype.writeUIntBE=function(V,H,Ee,Ke){V=+V,H>>>=0,Ee>>>=0,Ke||Zt(this,V,H,Ee,Math.pow(2,8*Ee)-1,0);var en=Ee-1,Oi=1;for(this[H+en]=255&V;--en>=0&&(Oi*=256);)this[H+en]=V/Oi&255;return H+Ee},ne.prototype.writeUint8=ne.prototype.writeUInt8=function(V,H,Ee){return V=+V,H>>>=0,Ee||Zt(this,V,H,1,255,0),this[H]=255&V,H+1},ne.prototype.writeUint16LE=ne.prototype.writeUInt16LE=function(V,H,Ee){return V=+V,H>>>=0,Ee||Zt(this,V,H,2,65535,0),this[H]=255&V,this[H+1]=V>>>8,H+2},ne.prototype.writeUint16BE=ne.prototype.writeUInt16BE=function(V,H,Ee){return V=+V,H>>>=0,Ee||Zt(this,V,H,2,65535,0),this[H]=V>>>8,this[H+1]=255&V,H+2},ne.prototype.writeUint32LE=ne.prototype.writeUInt32LE=function(V,H,Ee){return V=+V,H>>>=0,Ee||Zt(this,V,H,4,4294967295,0),this[H+3]=V>>>24,this[H+2]=V>>>16,this[H+1]=V>>>8,this[H]=255&V,H+4},ne.prototype.writeUint32BE=ne.prototype.writeUInt32BE=function(V,H,Ee){return V=+V,H>>>=0,Ee||Zt(this,V,H,4,4294967295,0),this[H]=V>>>24,this[H+1]=V>>>16,this[H+2]=V>>>8,this[H+3]=255&V,H+4},ne.prototype.writeIntLE=function(V,H,Ee,Ke){if(V=+V,H>>>=0,!Ke){var jt=Math.pow(2,8*Ee-1);Zt(this,V,H,Ee,jt-1,-jt)}var en=0,Oi=1,Si=0;for(this[H]=255&V;++en<Ee&&(Oi*=256);)V<0&&0===Si&&0!==this[H+en-1]&&(Si=1),this[H+en]=(V/Oi>>0)-Si&255;return H+Ee},ne.prototype.writeIntBE=function(V,H,Ee,Ke){if(V=+V,H>>>=0,!Ke){var jt=Math.pow(2,8*Ee-1);Zt(this,V,H,Ee,jt-1,-jt)}var en=Ee-1,Oi=1,Si=0;for(this[H+en]=255&V;--en>=0&&(Oi*=256);)V<0&&0===Si&&0!==this[H+en+1]&&(Si=1),this[H+en]=(V/Oi>>0)-Si&255;return H+Ee},ne.prototype.writeInt8=function(V,H,Ee){return V=+V,H>>>=0,Ee||Zt(this,V,H,1,127,-128),V<0&&(V=255+V+1),this[H]=255&V,H+1},ne.prototype.writeInt16LE=function(V,H,Ee){return V=+V,H>>>=0,Ee||Zt(this,V,H,2,32767,-32768),this[H]=255&V,this[H+1]=V>>>8,H+2},ne.prototype.writeInt16BE=function(V,H,Ee){return V=+V,H>>>=0,Ee||Zt(this,V,H,2,32767,-32768),this[H]=V>>>8,this[H+1]=255&V,H+2},ne.prototype.writeInt32LE=function(V,H,Ee){return V=+V,H>>>=0,Ee||Zt(this,V,H,4,2147483647,-2147483648),this[H]=255&V,this[H+1]=V>>>8,this[H+2]=V>>>16,this[H+3]=V>>>24,H+4},ne.prototype.writeInt32BE=function(V,H,Ee){return V=+V,H>>>=0,Ee||Zt(this,V,H,4,2147483647,-2147483648),V<0&&(V=4294967295+V+1),this[H]=V>>>24,this[H+1]=V>>>16,this[H+2]=V>>>8,this[H+3]=255&V,H+4},ne.prototype.writeFloatLE=function(V,H,Ee){return go(this,V,H,!0,Ee)},ne.prototype.writeFloatBE=function(V,H,Ee){return go(this,V,H,!1,Ee)},ne.prototype.writeDoubleLE=function(V,H,Ee){return Di(this,V,H,!0,Ee)},ne.prototype.writeDoubleBE=function(V,H,Ee){return Di(this,V,H,!1,Ee)},ne.prototype.copy=function(V,H,Ee,Ke){if(!ne.isBuffer(V))throw new TypeError("argument should be a Buffer");if(Ee||(Ee=0),!Ke&&0!==Ke&&(Ke=this.length),H>=V.length&&(H=V.length),H||(H=0),Ke>0&&Ke<Ee&&(Ke=Ee),Ke===Ee||0===V.length||0===this.length)return 0;if(H<0)throw new RangeError("targetStart out of bounds");if(Ee<0||Ee>=this.length)throw new RangeError("Index out of range");if(Ke<0)throw new RangeError("sourceEnd out of bounds");Ke>this.length&&(Ke=this.length),V.length-H<Ke-Ee&&(Ke=V.length-H+Ee);var jt=Ke-Ee;return this===V&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(H,Ee,Ke):Uint8Array.prototype.set.call(V,this.subarray(Ee,Ke),H),jt},ne.prototype.fill=function(V,H,Ee,Ke){if("string"==typeof V){if("string"==typeof H?(Ke=H,H=0,Ee=this.length):"string"==typeof Ee&&(Ke=Ee,Ee=this.length),void 0!==Ke&&"string"!=typeof Ke)throw new TypeError("encoding must be a string");if("string"==typeof Ke&&!ne.isEncoding(Ke))throw new TypeError("Unknown encoding: "+Ke);if(1===V.length){var jt=V.charCodeAt(0);("utf8"===Ke&&jt<128||"latin1"===Ke)&&(V=jt)}}else"number"==typeof V?V&=255:"boolean"==typeof V&&(V=Number(V));if(H<0||this.length<H||this.length<Ee)throw new RangeError("Out of range index");if(Ee<=H)return this;var en;if(H>>>=0,Ee=void 0===Ee?this.length:Ee>>>0,V||(V=0),"number"==typeof V)for(en=H;en<Ee;++en)this[en]=V;else{var Oi=ne.isBuffer(V)?V:ne.from(V,Ke),Si=Oi.length;if(0===Si)throw new TypeError('The value "'+V+'" is invalid for argument "value"');for(en=0;en<Ee-H;++en)this[en+H]=Oi[en%Si]}return this};var Ci=/[^+/0-9A-Za-z-_]/g;function W(he,V){V=V||1/0;for(var H,Ee=he.length,Ke=null,jt=[],en=0;en<Ee;++en){if((H=he.charCodeAt(en))>55295&&H<57344){if(!Ke){if(H>56319){(V-=3)>-1&&jt.push(239,191,189);continue}if(en+1===Ee){(V-=3)>-1&&jt.push(239,191,189);continue}Ke=H;continue}if(H<56320){(V-=3)>-1&&jt.push(239,191,189),Ke=H;continue}H=65536+(Ke-55296<<10|H-56320)}else Ke&&(V-=3)>-1&&jt.push(239,191,189);if(Ke=null,H<128){if((V-=1)<0)break;jt.push(H)}else if(H<2048){if((V-=2)<0)break;jt.push(H>>6|192,63&H|128)}else if(H<65536){if((V-=3)<0)break;jt.push(H>>12|224,H>>6&63|128,63&H|128)}else{if(!(H<1114112))throw new Error("Invalid code point");if((V-=4)<0)break;jt.push(H>>18|240,H>>12&63|128,H>>6&63|128,63&H|128)}}return jt}function Ii(he){return be.toByteArray(function fe(he){if((he=(he=he.split("=")[0]).trim().replace(Ci,"")).length<2)return"";for(;he.length%4!=0;)he+="=";return he}(he))}function Qn(he,V,H,Ee){for(var Ke=0;Ke<Ee&&!(Ke+H>=V.length||Ke>=he.length);++Ke)V[Ke+H]=he[Ke];return Ke}function vi(he,V){return he instanceof V||null!=he&&null!=he.constructor&&null!=he.constructor.name&&he.constructor.name===V.name}function qr(he){return he!=he}var Wr=function(){for(var he="0123456789abcdef",V=new Array(256),H=0;H<16;++H)for(var Ee=16*H,Ke=0;Ke<16;++Ke)V[Ee+Ke]=he[H]+he[Ke];return V}()},8472:function(rn,hn){var Te,qe="undefined"!=typeof self?self:this,be=function(){function Te(){this.fetch=!1,this.DOMException=qe.DOMException}return Te.prototype=qe,new Te}();Te=be,function(te){var Ye_searchParams="URLSearchParams"in Te,Ye_iterable="Symbol"in Te&&"iterator"in Symbol,Ye_blob="FileReader"in Te&&"Blob"in Te&&function(){try{return new Blob,!0}catch(je){return!1}}(),Ye_formData="FormData"in Te,Ye_arrayBuffer="ArrayBuffer"in Te;if(Ye_arrayBuffer)var Ve=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],Xe=ArrayBuffer.isView||function(je){return je&&Ve.indexOf(Object.prototype.toString.call(je))>-1};function gt(je){if("string"!=typeof je&&(je=String(je)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(je))throw new TypeError("Invalid character in header field name");return je.toLowerCase()}function wt(je){return"string"!=typeof je&&(je=String(je)),je}function Ue(je){var yt={next:function(){var Tt=je.shift();return{done:void 0===Tt,value:Tt}}};return Ye_iterable&&(yt[Symbol.iterator]=function(){return yt}),yt}function Ge(je){this.map={},je instanceof Ge?je.forEach(function(yt,Tt){this.append(Tt,yt)},this):Array.isArray(je)?je.forEach(function(yt){this.append(yt[0],yt[1])},this):je&&Object.getOwnPropertyNames(je).forEach(function(yt){this.append(yt,je[yt])},this)}function xt(je){if(je.bodyUsed)return Promise.reject(new TypeError("Already read"));je.bodyUsed=!0}function Kt(je){return new Promise(function(yt,Tt){je.onload=function(){yt(je.result)},je.onerror=function(){Tt(je.error)}})}function _n(je){var yt=new FileReader,Tt=Kt(yt);return yt.readAsArrayBuffer(je),Tt}function an(je){if(je.slice)return je.slice(0);var yt=new Uint8Array(je.byteLength);return yt.set(new Uint8Array(je)),yt.buffer}function we(){return this.bodyUsed=!1,this._initBody=function(je){this._bodyInit=je,je?"string"==typeof je?this._bodyText=je:Ye_blob&&Blob.prototype.isPrototypeOf(je)?this._bodyBlob=je:Ye_formData&&FormData.prototype.isPrototypeOf(je)?this._bodyFormData=je:Ye_searchParams&&URLSearchParams.prototype.isPrototypeOf(je)?this._bodyText=je.toString():Ye_arrayBuffer&&Ye_blob&&function ne(je){return je&&DataView.prototype.isPrototypeOf(je)}(je)?(this._bodyArrayBuffer=an(je.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):Ye_arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(je)||Xe(je))?this._bodyArrayBuffer=an(je):this._bodyText=je=Object.prototype.toString.call(je):this._bodyText="",this.headers.get("content-type")||("string"==typeof je?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):Ye_searchParams&&URLSearchParams.prototype.isPrototypeOf(je)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},Ye_blob&&(this.blob=function(){var je=xt(this);if(je)return je;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?xt(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(_n)}),this.text=function(){var je=xt(this);if(je)return je;if(this._bodyBlob)return function Sn(je){var yt=new FileReader,Tt=Kt(yt);return yt.readAsText(je),Tt}(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(function st(je){for(var yt=new Uint8Array(je),Tt=new Array(yt.length),ri=0;ri<yt.length;ri++)Tt[ri]=String.fromCharCode(yt[ri]);return Tt.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},Ye_formData&&(this.formData=function(){return this.text().then(dt)}),this.json=function(){return this.text().then(JSON.parse)},this}Ge.prototype.append=function(je,yt){je=gt(je),yt=wt(yt);var Tt=this.map[je];this.map[je]=Tt?Tt+", "+yt:yt},Ge.prototype.delete=function(je){delete this.map[gt(je)]},Ge.prototype.get=function(je){return je=gt(je),this.has(je)?this.map[je]:null},Ge.prototype.has=function(je){return this.map.hasOwnProperty(gt(je))},Ge.prototype.set=function(je,yt){this.map[gt(je)]=wt(yt)},Ge.prototype.forEach=function(je,yt){for(var Tt in this.map)this.map.hasOwnProperty(Tt)&&je.call(yt,this.map[Tt],Tt,this)},Ge.prototype.keys=function(){var je=[];return this.forEach(function(yt,Tt){je.push(Tt)}),Ue(je)},Ge.prototype.values=function(){var je=[];return this.forEach(function(yt){je.push(yt)}),Ue(je)},Ge.prototype.entries=function(){var je=[];return this.forEach(function(yt,Tt){je.push([Tt,yt])}),Ue(je)},Ye_iterable&&(Ge.prototype[Symbol.iterator]=Ge.prototype.entries);var ye=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function ae(je,yt){var Tt=(yt=yt||{}).body;if(je instanceof ae){if(je.bodyUsed)throw new TypeError("Already read");this.url=je.url,this.credentials=je.credentials,yt.headers||(this.headers=new Ge(je.headers)),this.method=je.method,this.mode=je.mode,this.signal=je.signal,!Tt&&null!=je._bodyInit&&(Tt=je._bodyInit,je.bodyUsed=!0)}else this.url=String(je);if(this.credentials=yt.credentials||this.credentials||"same-origin",(yt.headers||!this.headers)&&(this.headers=new Ge(yt.headers)),this.method=function Ie(je){var yt=je.toUpperCase();return ye.indexOf(yt)>-1?yt:je}(yt.method||this.method||"GET"),this.mode=yt.mode||this.mode||null,this.signal=yt.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&Tt)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(Tt)}function dt(je){var yt=new FormData;return je.trim().split("&").forEach(function(Tt){if(Tt){var ri=Tt.split("="),kt=ri.shift().replace(/\+/g," "),cn=ri.join("=").replace(/\+/g," ");yt.append(decodeURIComponent(kt),decodeURIComponent(cn))}}),yt}function re(je){var yt=new Ge;return je.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(ri){var kt=ri.split(":"),cn=kt.shift().trim();if(cn){var Hi=kt.join(":").trim();yt.append(cn,Hi)}}),yt}function me(je,yt){yt||(yt={}),this.type="default",this.status=void 0===yt.status?200:yt.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in yt?yt.statusText:"OK",this.headers=new Ge(yt.headers),this.url=yt.url||"",this._initBody(je)}ae.prototype.clone=function(){return new ae(this,{body:this._bodyInit})},we.call(ae.prototype),we.call(me.prototype),me.prototype.clone=function(){return new me(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new Ge(this.headers),url:this.url})},me.error=function(){var je=new me(null,{status:0,statusText:""});return je.type="error",je};var lt=[301,302,303,307,308];me.redirect=function(je,yt){if(-1===lt.indexOf(yt))throw new RangeError("Invalid status code");return new me(null,{status:yt,headers:{location:je}})},te.DOMException=Te.DOMException;try{new te.DOMException}catch(je){te.DOMException=function(yt,Tt){this.message=yt,this.name=Tt;var ri=Error(yt);this.stack=ri.stack},te.DOMException.prototype=Object.create(Error.prototype),te.DOMException.prototype.constructor=te.DOMException}function mt(je,yt){return new Promise(function(Tt,ri){var kt=new ae(je,yt);if(kt.signal&&kt.signal.aborted)return ri(new te.DOMException("Aborted","AbortError"));var cn=new XMLHttpRequest;function Hi(){cn.abort()}cn.onload=function(){var Li={status:cn.status,statusText:cn.statusText,headers:re(cn.getAllResponseHeaders()||"")};Li.url="responseURL"in cn?cn.responseURL:Li.headers.get("X-Request-URL"),Tt(new me("response"in cn?cn.response:cn.responseText,Li))},cn.onerror=function(){ri(new TypeError("Network request failed"))},cn.ontimeout=function(){ri(new TypeError("Network request failed"))},cn.onabort=function(){ri(new te.DOMException("Aborted","AbortError"))},cn.open(kt.method,kt.url,!0),"include"===kt.credentials?cn.withCredentials=!0:"omit"===kt.credentials&&(cn.withCredentials=!1),"responseType"in cn&&Ye_blob&&(cn.responseType="blob"),kt.headers.forEach(function(Li,yi){cn.setRequestHeader(yi,Li)}),kt.signal&&(kt.signal.addEventListener("abort",Hi),cn.onreadystatechange=function(){4===cn.readyState&&kt.signal.removeEventListener("abort",Hi)}),cn.send(void 0===kt._bodyInit?null:kt._bodyInit)})}mt.polyfill=!0,Te.fetch||(Te.fetch=mt,Te.Headers=Ge,Te.Request=ae,Te.Response=me),te.Headers=Ge,te.Request=ae,te.Response=me,te.fetch=mt,Object.defineProperty(te,"__esModule",{value:!0})}({}),be.fetch.ponyfill=!0,delete be.fetch.polyfill;var Me=be;(hn=Me.fetch).default=Me.fetch,hn.fetch=Me.fetch,hn.Headers=Me.Headers,hn.Request=Me.Request,hn.Response=Me.Response,rn.exports=hn},6570:rn=>{function hn(be){if(be)return function qe(be){for(var Me in hn.prototype)be[Me]=hn.prototype[Me];return be}(be)}rn.exports=hn,hn.prototype.on=hn.prototype.addEventListener=function(be,Me){return this._callbacks=this._callbacks||{},(this._callbacks[be]=this._callbacks[be]||[]).push(Me),this},hn.prototype.once=function(be,Me){var Te=this;function p(){Te.off(be,p),Me.apply(this,arguments)}return this._callbacks=this._callbacks||{},p.fn=Me,this.on(be,p),this},hn.prototype.off=hn.prototype.removeListener=hn.prototype.removeAllListeners=hn.prototype.removeEventListener=function(be,Me){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var Te=this._callbacks[be];if(!Te)return this;if(1==arguments.length)return delete this._callbacks[be],this;for(var p,te=0;te<Te.length;te++)if((p=Te[te])===Me||p.fn===Me){Te.splice(te,1);break}return this},hn.prototype.emit=function(be){this._callbacks=this._callbacks||{};var Me=[].slice.call(arguments,1),Te=this._callbacks[be];if(Te)for(var p=0,te=(Te=Te.slice(0)).length;p<te;++p)Te[p].apply(this,Me);return this},hn.prototype.listeners=function(be){return this._callbacks=this._callbacks||{},this._callbacks[be]||[]},hn.prototype.hasListeners=function(be){return!!this.listeners(be).length}},8461:(rn,hn)=>{hn.read=function(qe,be,Me,Te,p){var te,Ye,ne=8*p-Te-1,Ve=(1<<ne)-1,Xe=Ve>>1,gt=-7,wt=Me?p-1:0,Ue=Me?-1:1,Ge=qe[be+wt];for(wt+=Ue,te=Ge&(1<<-gt)-1,Ge>>=-gt,gt+=ne;gt>0;te=256*te+qe[be+wt],wt+=Ue,gt-=8);for(Ye=te&(1<<-gt)-1,te>>=-gt,gt+=Te;gt>0;Ye=256*Ye+qe[be+wt],wt+=Ue,gt-=8);if(0===te)te=1-Xe;else{if(te===Ve)return Ye?NaN:1/0*(Ge?-1:1);Ye+=Math.pow(2,Te),te-=Xe}return(Ge?-1:1)*Ye*Math.pow(2,te-Te)},hn.write=function(qe,be,Me,Te,p,te){var Ye,ne,Ve,Xe=8*te-p-1,gt=(1<<Xe)-1,wt=gt>>1,Ue=23===p?Math.pow(2,-24)-Math.pow(2,-77):0,Ge=Te?0:te-1,xt=Te?1:-1,Kt=be<0||0===be&&1/be<0?1:0;for(be=Math.abs(be),isNaN(be)||be===1/0?(ne=isNaN(be)?1:0,Ye=gt):(Ye=Math.floor(Math.log(be)/Math.LN2),be*(Ve=Math.pow(2,-Ye))<1&&(Ye--,Ve*=2),(be+=Ye+wt>=1?Ue/Ve:Ue*Math.pow(2,1-wt))*Ve>=2&&(Ye++,Ve/=2),Ye+wt>=gt?(ne=0,Ye=gt):Ye+wt>=1?(ne=(be*Ve-1)*Math.pow(2,p),Ye+=wt):(ne=be*Math.pow(2,wt-1)*Math.pow(2,p),Ye=0));p>=8;qe[Me+Ge]=255&ne,Ge+=xt,ne/=256,p-=8);for(Ye=Ye<<p|ne,Xe+=p;Xe>0;qe[Me+Ge]=255&Ye,Ge+=xt,Ye/=256,Xe-=8);qe[Me+Ge-xt]|=128*Kt}},9898:function(rn){rn.exports=function(){"use strict";var hn,qe,be;function Me(p,te){if(hn)if(qe){var Ye="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+hn+")(sharedChunk); ("+qe+")(sharedChunk); self.onerror = null;",ne={};hn(ne),be=te(ne),"undefined"!=typeof window&&window&&window.URL&&window.URL.createObjectURL&&(be.workerUrl=window.URL.createObjectURL(new Blob([Ye],{type:"text/javascript"})))}else qe=te;else hn=te}return Me(0,function(p){var te="undefined"!=typeof self?self:{},Ye="2.15.0";let ne;const Ve={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==ne){const a=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{ne=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):a}catch(o){ne=a}}return ne},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Ve.API_URL)return null;try{const a=new URL(Ve.API_URL);return"api.mapbox.cn"===a.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===a.hostname?"https://events.mapbox.com/events/v2":null}catch(a){return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Xe={supported:!1,testSupport:function(a){!Ue&&wt&&(Ge?xt(a):gt=a)}};let gt,wt,Ue=!1,Ge=!1;function xt(a){const o=a.createTexture();a.bindTexture(a.TEXTURE_2D,o);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,wt),a.isContextLost())return;Xe.supported=!0}catch(l){}a.deleteTexture(o),Ue=!0}te.document&&(wt=te.document.createElement("img"),wt.onload=function(){gt&&xt(gt),gt=null,Ge=!0},wt.onerror=function(){Ue=!0,gt=null},wt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Kt="01";function _n(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var Sn=st;function st(a,o,l,u){this.cx=3*a,this.bx=3*(l-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(u-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=o,this.p2x=l,this.p2y=u}st.prototype={sampleCurveX:function(a){return((this.ax*a+this.bx)*a+this.cx)*a},sampleCurveY:function(a){return((this.ay*a+this.by)*a+this.cy)*a},sampleCurveDerivativeX:function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},solveCurveX:function(a,o){if(void 0===o&&(o=1e-6),a<0)return 0;if(a>1)return 1;for(var l=a,u=0;u<8;u++){var f=this.sampleCurveX(l)-a;if(Math.abs(f)<o)return l;var b=this.sampleCurveDerivativeX(l);if(Math.abs(b)<1e-6)break;l-=f/b}var v=0,w=1;for(l=a,u=0;u<20&&(f=this.sampleCurveX(l),!(Math.abs(f-a)<o));u++)a>f?v=l:w=l,l=.5*(w-v)+v;return l},solve:function(a,o){return this.sampleCurveY(this.solveCurveX(a,o))}};var an=_n(Sn),we=ye;function ye(a,o){this.x=a,this.y=o}ye.prototype={clone:function(){return new ye(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,o){return this.clone()._rotateAround(a,o)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var o=a.x-this.x,l=a.y-this.y;return o*o+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,o){return Math.atan2(this.x*o-this.y*a,this.x*a+this.y*o)},_matMult:function(a){var o=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=o,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var o=Math.cos(a),l=Math.sin(a),u=l*this.x+o*this.y;return this.x=o*this.x-l*this.y,this.y=u,this},_rotateAround:function(a,o){var l=Math.cos(a),u=Math.sin(a),f=o.y+u*(this.x-o.x)+l*(this.y-o.y);return this.x=o.x+l*(this.x-o.x)-u*(this.y-o.y),this.y=f,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ye.convert=function(a){return a instanceof ye?a:Array.isArray(a)?new ye(a[0],a[1]):a};var Ie=_n(we);const ae=Math.PI/180,dt=180/Math.PI;function re(a){return a*ae}function me(a){return a*dt}const lt=[[0,0],[1,0],[1,1],[0,1]];function mt(a){if(a<=0)return 0;if(a>=1)return 1;const o=a*a,l=o*a;return 4*(a<.5?l:3*(a-o)+l-.75)}function je(a,o,l,u){const f=new an(a,o,l,u);return function(b){return f.solve(b)}}const yt=je(.25,.1,.25,1);function Tt(a,o,l){return Math.min(l,Math.max(o,a))}function ri(a,o,l){return(l=Tt((l-a)/(o-a),0,1))*l*(3-2*l)}function kt(a,o,l){const u=l-o,f=((a-o)%u+u)%u+o;return f===o?l:f}function cn(a,o,l){if(!a.length)return l(null,[]);let u=a.length;const f=new Array(a.length);let b=null;a.forEach((v,w)=>{o(v,(T,E)=>{T&&(b=T),f[w]=E,0==--u&&l(b,f)})})}function Hi(a){const o=[];for(const l in a)o.push(a[l]);return o}function Li(a,...o){for(const l of o)for(const u in l)a[u]=l[u];return a}let yi=1;function Zt(){return yi++}function xo(){return function a(o){return o?(o^Math.random()*(16>>o/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()}function go(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))}function Di(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)}function Ci(a,o){a.forEach(l=>{o[l]&&(o[l]=o[l].bind(o))})}function fe(a,o){return-1!==a.indexOf(o,a.length-o.length)}function W(a,o,l){const u={};for(const f in a)u[f]=o.call(l||this,a[f],f,a);return u}function Pt(a,o,l){const u={};for(const f in a)o.call(l||this,a[f],f,a)&&(u[f]=a[f]);return u}function Qe(a){return Array.isArray(a)?a.map(Qe):"object"==typeof a&&a?W(a,Qe):a}const Ii={};function Qn(a){Ii[a]||("undefined"!=typeof console&&console.warn(a),Ii[a]=!0)}function vi(a,o,l){return(l.y-a.y)*(o.x-a.x)>(o.y-a.y)*(l.x-a.x)}function qr(a){let o=0;for(let l,u,f=0,b=a.length,v=b-1;f<b;v=f++)l=a[f],u=a[v],o+=(u.x-l.x)*(l.y+u.y);return o}function Wr(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function he(a){const o={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,u,f,b)=>{const v=f||b;return o[u]=!v||v.toLowerCase(),""}),o["max-age"]){const l=parseInt(o["max-age"],10);isNaN(l)?delete o["max-age"]:o["max-age"]=l}return o}let V=null;function H(a){if(null==V){const o=a.navigator?a.navigator.userAgent:null;V=!!a.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return V}function Ee(a){try{const o=te[a];return o.setItem("_mapbox_test_",1),o.removeItem("_mapbox_test_"),!0}catch(o){return!1}}function Ke(a,o){return[a[4*o],a[4*o+1],a[4*o+2],a[4*o+3]]}const jt="mapbox-tiles";let Si,er,en=500,Oi=50;function Jr(){try{return te.caches}catch(a){}}function br(){Jr()&&!Si&&(Si=te.caches.open(jt))}function ba(a){const o=a.indexOf("?");if(o<0)return a;const u=function(f){const b=f.indexOf("?");return b>0?f.slice(b+1).split("&"):[]}(a).filter(f=>{const b=f.split("=");return"language"===b[0]||"worldview"===b[0]});return u.length?`${a.slice(0,o)}?${u.join("&")}`:a.slice(0,o)}let ds=1/0;const _a={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(_a);class ql extends Error{constructor(o,l,u){401===l&&tt(u)&&(o+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(o),this.status=l,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Wl=Wr()?()=>self.worker&&self.worker.referrer:()=>("blob:"===te.location.protocol?te.parent:te).location.href,Ac=function(a,o){if(!(/^file:/.test(l=a.url)||/^file:/.test(Wl())&&!/^\w+:/.test(l))){if(te.fetch&&te.Request&&te.AbortController&&te.Request.prototype.hasOwnProperty("signal"))return function(u,f){const b=new te.AbortController,v=new te.Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:Wl(),referrerPolicy:u.referrerPolicy,signal:b.signal});let w=!1,T=!1;const E=(A=v.url).indexOf("sku=")>0&&tt(A);var A;"json"===u.type&&v.headers.set("Accept","application/json");const P=(N,B,$)=>{if(T)return;if(N&&"SecurityError"!==N.message&&Qn(N.toString()),B&&$)return L(B);const K=Date.now();te.fetch(v).then(ce=>{if(ce.ok){const Ce=E?ce.clone():null;return L(ce,Ce,K)}return f(new ql(ce.statusText,ce.status,u.url))}).catch(ce=>{"AbortError"!==ce.name&&f(new Error(`${ce.message} ${u.url}`))})},L=(N,B,$)=>{("arrayBuffer"===u.type?N.arrayBuffer():"json"===u.type?N.json():N.text()).then(K=>{T||(B&&$&&function(ce,Ce,ue){if(br(),!Si)return;const ve={status:Ce.status,statusText:Ce.statusText,headers:new te.Headers};Ce.headers.forEach((at,rt)=>ve.headers.set(rt,at));const Ae=he(Ce.headers.get("Cache-Control")||"");if(Ae["no-store"])return;Ae["max-age"]&&ve.headers.set("Expires",new Date(ue+1e3*Ae["max-age"]).toUTCString());const ke=ve.headers.get("Expires");ke&&(new Date(ke).getTime()-ue<42e4||function(at,rt){if(void 0===er)try{new Response(new ReadableStream),er=!0}catch(_t){er=!1}er?rt(at.body):at.blob().then(rt)}(Ce,at=>{const rt=new te.Response(at,ve);br(),Si&&Si.then(_t=>_t.put(ba(ce.url),rt)).catch(_t=>Qn(_t.message))}))}(v,B,$),w=!0,f(null,K,N.headers.get("Cache-Control"),N.headers.get("Expires")))}).catch(K=>{T||f(new Error(K.message))})};return E?function(N,B){if(br(),!Si)return B(null);const $=ba(N.url);Si.then(K=>{K.match($).then(ce=>{const Ce=function(ue){if(!ue)return!1;const ve=new Date(ue.headers.get("Expires")||0),Ae=he(ue.headers.get("Cache-Control")||"");return ve>Date.now()&&!Ae["no-cache"]}(ce);K.delete($),Ce&&K.put($,ce.clone()),B(null,ce,Ce)}).catch(B)}).catch(B)}(v,P):P(null,null),{cancel:()=>{T=!0,w||b.abort()}}}(a,o);if(Wr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,o,void 0,!0)}var l;return function(u,f){const b=new te.XMLHttpRequest;b.open(u.method||"GET",u.url,!0),"arrayBuffer"===u.type&&(b.responseType="arraybuffer");for(const v in u.headers)b.setRequestHeader(v,u.headers[v]);return"json"===u.type&&(b.responseType="text",b.setRequestHeader("Accept","application/json")),b.withCredentials="include"===u.credentials,b.onerror=()=>{f(new Error(b.statusText))},b.onload=()=>{if((b.status>=200&&b.status<300||0===b.status)&&null!==b.response){let v=b.response;if("json"===u.type)try{v=JSON.parse(b.response)}catch(w){return f(w)}f(null,v,b.getResponseHeader("Cache-Control"),b.getResponseHeader("Expires"))}else f(new ql(b.statusText,b.status,u.url))},b.send(u.body),{cancel:()=>b.abort()}}(a,o)},du=function(a,o){return Ac(Li(a,{type:"arrayBuffer"}),o)};function Ch(a){const o=te.document.createElement("a");return o.href=a,o.protocol===te.document.location.protocol&&o.host===te.document.location.host}const Se="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let X,Z;X=[],Z=0;const _e=function(a,o){if(Xe.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),Z>=Ve.MAX_PARALLEL_IMAGE_REQUESTS){const b={requestParameters:a,callback:o,cancelled:!1,cancel(){this.cancelled=!0}};return X.push(b),b}Z++;let l=!1;const u=()=>{if(!l)for(l=!0,Z--;X.length&&Z<Ve.MAX_PARALLEL_IMAGE_REQUESTS;){const b=X.shift(),{requestParameters:v,callback:w,cancelled:T}=b;T||(b.cancel=_e(v,w).cancel)}},f=du(a,(b,v,w,T)=>{u(),b?o(b):v&&(te.createImageBitmap?function(E,A){const P=new te.Blob([new Uint8Array(E)],{type:"image/png"});te.createImageBitmap(P).then(L=>{A(null,L)}).catch(L=>{A(new Error(`Could not load image because of ${L.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(v,(E,A)=>o(E,A,w,T)):function(E,A){const P=new te.Image,L=te.URL;P.onload=()=>{A(null,P),L.revokeObjectURL(P.src),P.onload=null,te.requestAnimationFrame(()=>{P.src=Se})},P.onerror=()=>A(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const N=new te.Blob([new Uint8Array(E)],{type:"image/png"});P.src=E.byteLength?L.createObjectURL(N):Se}(v,(E,A)=>o(E,A,w,T)))});return{cancel:()=>{f.cancel(),u()}}},Re="NO_ACCESS_TOKEN";function Be(a){return 0===a.indexOf("mapbox:")}function tt(a){return Ve.API_URL_REGEX.test(a)}function et(a){return Ve.API_CDN_URL_REGEX.test(a)}function Ne(a){return Ve.API_STYLE_REGEX.test(a)&&!ct(a)}function ct(a){return Ve.API_SPRITE_REGEX.test(a)}const Wt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function tn(a){const o=a.match(Wt);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function Ut(a){const o=a.params.length?`?${a.params.join("&")}`:"";return`${a.protocol}://${a.authority}${a.path}${o}`}const ni="mapbox.eventData";function pi(a){if(!a)return null;const o=a.split(".");if(!o||3!==o.length)return null;try{return JSON.parse(decodeURIComponent(te.atob(o[1]).split("").map(l=>"%"+("00"+l.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(l){return null}}class ti{constructor(o){this.type=o,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(o){const l=pi(Ve.ACCESS_TOKEN);let u="";return u=l&&l.u?te.btoa(encodeURIComponent(l.u).replace(/%([0-9A-F]{2})/g,(f,b)=>String.fromCharCode(Number("0x"+b)))):Ve.ACCESS_TOKEN||"",o?`${ni}.${o}:${u}`:`${ni}:${u}`}fetchEventData(){const o=Ee("localStorage"),l=this.getStorageKey(),u=this.getStorageKey("uuid");if(o)try{const f=te.localStorage.getItem(l);f&&(this.eventData=JSON.parse(f));const b=te.localStorage.getItem(u);b&&(this.anonId=b)}catch(f){Qn("Unable to read from LocalStorage")}}saveEventData(){const o=Ee("localStorage"),l=this.getStorageKey(),u=this.getStorageKey("uuid");if(o)try{te.localStorage.setItem(u,this.anonId),Object.keys(this.eventData).length>=1&&te.localStorage.setItem(l,JSON.stringify(this.eventData))}catch(f){Qn("Unable to write to LocalStorage")}}processRequests(o){}postEvent(o,l,u,f){if(!Ve.EVENTS_URL)return;const b=tn(Ve.EVENTS_URL);b.params.push(`access_token=${f||Ve.ACCESS_TOKEN||""}`);const v={event:this.type,created:new Date(o).toISOString()},w=l?Li(v,l):v,T={url:Ut(b),headers:{"Content-Type":"text/plain"},body:JSON.stringify([w])};var A;this.pendingRequest=(A=E=>{this.pendingRequest=null,u(E),this.saveEventData(),this.processRequests(f)},Ac(Li(T,{method:"POST"}),A))}queueRequest(o,l){this.queue.push(o),this.processRequests(l)}}const fi=new class extends ti{constructor(a){super("appUserTurnstile"),this._customAccessToken=a}postTurnstileEvent(a,o){Ve.EVENTS_URL&&Ve.ACCESS_TOKEN&&Array.isArray(a)&&a.some(l=>Be(l)||tt(l))&&this.queueRequest(Date.now(),o)}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const o=pi(Ve.ACCESS_TOKEN),l=o?o.u:Ve.ACCESS_TOKEN;let u=l!==this.eventData.tokenU;Di(this.anonId)||(this.anonId=xo(),u=!0);const f=this.queue.shift();if(this.eventData.lastSuccess){const b=new Date(this.eventData.lastSuccess),v=new Date(f),w=(f-this.eventData.lastSuccess)/864e5;u=u||w>=1||w<-1||b.getDate()!==v.getDate()}else u=!0;u?this.postEvent(f,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Ye,skuId:Kt,"enabled.telemetry":!1,userId:this.anonId},b=>{b||(this.eventData.lastSuccess=f,this.eventData.tokenU=l)},a):this.processRequests()}},Ti=fi.postTurnstileEvent.bind(fi),Fi=new class extends ti{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(a,o,l,u){this.skuToken=o,this.errorCb=u,Ve.EVENTS_URL&&(l||Ve.ACCESS_TOKEN?this.queueRequest({id:a,timestamp:Date.now()},l):this.errorCb(new Error(Re)))}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;const{id:o,timestamp:l}=this.queue.shift();o&&this.success[o]||(this.anonId||this.fetchEventData(),Di(this.anonId)||(this.anonId=xo()),this.postEvent(l,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Ye,skuId:Kt,skuToken:this.skuToken,userId:this.anonId},u=>{u?this.errorCb(u):o&&(this.success[o]=!0)},a))}},lo=Fi.postMapLoadEvent.bind(Fi),Qo=new class extends ti{constructor(){super("gljs.performance")}postPerformanceEvent(a,o){Ve.EVENTS_URL&&(a||Ve.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:o},a)}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:o,performanceData:l}=this.queue.shift(),u=function(f){const b=te.performance.getEntriesByType("resource"),v=te.performance.getEntriesByType("mark"),w=function(L){const N={};if(L)for(const B in L)if("other"!==B)for(const $ of L[B]){const K=`${B}ResolveRangeMin`,ce=`${B}ResolveRangeMax`,Ce=`${B}RequestCount`,ue=`${B}RequestCachedCount`;N[K]=Math.min(N[K]||1/0,$.startTime),N[ce]=Math.max(N[ce]||-1/0,$.responseEnd);const ve=Ae=>{void 0===N[Ae]&&(N[Ae]=0),++N[Ae]};void 0!==$.transferSize&&0===$.transferSize&&ve(ue),ve(Ce)}return N}(function(L,N){const B={};if(L)for(const $ of L){const K=N($);void 0===B[K]&&(B[K]=[]),B[K].push($)}return B}(b,Lm)),T=te.devicePixelRatio,E=te.navigator.connection||te.navigator.mozConnection||te.navigator.webkitConnection,A={counters:[],metadata:[],attributes:[]},P=(L,N,B)=>{null!=B&&L.push({name:N,value:B.toString()})};for(const L in w)P(A.counters,L,w[L]);if(f.interactionRange[0]!==1/0&&f.interactionRange[1]!==-1/0&&(P(A.counters,"interactionRangeMin",f.interactionRange[0]),P(A.counters,"interactionRangeMax",f.interactionRange[1])),v)for(const L of Object.keys(hu)){const N=hu[L],B=v.find($=>$.name===N);B&&P(A.counters,N,B.startTime)}return P(A.counters,"visibilityHidden",f.visibilityHidden),P(A.attributes,"style",function(L){if(L)for(const N of L){const B=N.name.split("?")[0];if(Ne(B)){const $=B.split("/").slice(-2);if(2===$.length)return`mapbox://styles/${$[0]}/${$[1]}`}}}(b)),P(A.attributes,"terrainEnabled",f.terrainEnabled?"true":"false"),P(A.attributes,"fogEnabled",f.fogEnabled?"true":"false"),P(A.attributes,"projection",f.projection),P(A.attributes,"zoom",f.zoom),P(A.metadata,"devicePixelRatio",T),P(A.metadata,"connectionEffectiveType",E?E.effectiveType:void 0),P(A.metadata,"navigatorUserAgent",te.navigator.userAgent),P(A.metadata,"screenWidth",te.screen.width),P(A.metadata,"screenHeight",te.screen.height),P(A.metadata,"windowWidth",te.innerWidth),P(A.metadata,"windowHeight",te.innerHeight),P(A.metadata,"mapWidth",f.width/T),P(A.metadata,"mapHeight",f.height/T),P(A.metadata,"webglRenderer",f.renderer),P(A.metadata,"webglVendor",f.vendor),P(A.metadata,"sdkVersion",Ye),P(A.metadata,"sdkIdentifier","mapbox-gl-js"),A}(l);for(const f of u.metadata);for(const f of u.counters);for(const f of u.attributes);this.postEvent(o,u,()=>{},a)}},bo=Qo.postPerformanceEvent.bind(Qo),Xa=new class extends ti{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(a,o,l,u){if(!Ve.API_URL||!Ve.SESSION_PATH)return;const f=tn(Ve.API_URL+Ve.SESSION_PATH);f.params.push(`sku=${o||""}`),f.params.push(`access_token=${u||Ve.ACCESS_TOKEN||""}`);const b={url:Ut(f),headers:{"Content-Type":"text/plain"}};var w;this.pendingRequest=(w=v=>{this.pendingRequest=null,l(v),this.saveEventData(),this.processRequests(u)},Ac(Li(b,{method:"GET"}),w))}getSessionAPI(a,o,l,u){this.skuToken=o,this.errorCb=u,Ve.SESSION_PATH&&Ve.API_URL&&(l||Ve.ACCESS_TOKEN?this.queueRequest({id:a,timestamp:Date.now()},l):this.errorCb(new Error(Re)))}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;const{id:o,timestamp:l}=this.queue.shift();o&&this.success[o]||this.getSession(l,this.skuToken,u=>{u?this.errorCb(u):o&&(this.success[o]=!0)},a)}},wo=Xa.getSessionAPI.bind(Xa),hs=new Set,hu={create:"create",load:"load",fullLoad:"fullLoad"},_l={mark(a){te.performance.mark(a)},measure(a,o,l){te.performance.measure(a,o,l)}};function Lm(a){const o=a.name.split("?")[0];return et(o)&&o.includes("mapbox-gl.js")?"javascript":et(o)&&o.includes("mapbox-gl.css")?"css":Ve.API_FONTS_REGEX.test(o)?"fontRange":ct(o)?"sprite":Ne(o)?"style":Ve.API_TILEJSON_REGEX.test(o)?"tilejson":"other"}const Gn=te.performance;function Xl(a){const o=a?a.url.toString():void 0;return Gn.getEntriesByName(o)}let ps,Om,Th,ya;const va={now:()=>void 0!==Th?Th:te.performance.now(),setNow(a){Th=a},restoreNow(){Th=void 0},frame(a){const o=te.requestAnimationFrame(a);return{cancel:()=>te.cancelAnimationFrame(o)}},getImageData(a,o=0){const{width:l,height:u}=a;ya||(ya=te.document.createElement("canvas"));const f=ya.getContext("2d",{willReadFrequently:!0});if(!f)throw new Error("failed to create canvas 2d context");return(l>ya.width||u>ya.height)&&(ya.width=l,ya.height=u),f.clearRect(-o,-o,l+2*o,u+2*o),f.drawImage(a,0,0,l,u),f.getImageData(-o,-o,l+2*o,u+2*o)},resolveURL:a=>(ps||(ps=te.document.createElement("a")),ps.href=a,ps.href),get devicePixelRatio(){return te.devicePixelRatio},get prefersReducedMotion(){return!!te.matchMedia&&(null==Om&&(Om=te.matchMedia("(prefers-reduced-motion: reduce)")),Om.matches)}};function Eh(a,o,l){l[a]&&-1!==l[a].indexOf(o)||(l[a]=l[a]||[],l[a].push(o))}function kc(a,o,l){if(l&&l[a]){const u=l[a].indexOf(o);-1!==u&&l[a].splice(u,1)}}class Rc{constructor(o,l={}){Li(this,l),this.type=o}}class Za extends Rc{constructor(o,l={}){super("error",Li({error:o},l))}}class pu{on(o,l){return this._listeners=this._listeners||{},Eh(o,l,this._listeners),this}off(o,l){return kc(o,l,this._listeners),kc(o,l,this._oneTimeListeners),this}once(o,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},Eh(o,l,this._oneTimeListeners),this):new Promise(u=>this.once(o,u))}fire(o,l){"string"==typeof o&&(o=new Rc(o,l||{}));const u=o.type;if(this.listens(u)){o.target=this;const f=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(const w of f)w.call(this,o);const b=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(const w of b)kc(u,w,this._oneTimeListeners),w.call(this,o);const v=this._eventedParent;v&&(Li(o,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),v.fire(o))}else o instanceof Za&&console.error(o.error);return this}listens(o){return!!(this._listeners&&this._listeners[o]&&this._listeners[o].length>0||this._oneTimeListeners&&this._oneTimeListeners[o]&&this._oneTimeListeners[o].length>0||this._eventedParent&&this._eventedParent.listens(o))}setEventedParent(o,l){return this._eventedParent=o,this._eventedParentData=l,this}}var bt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function yl(a,...o){for(const l of o)for(const u in l)a[u]=l[u];return a}function co(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function Ro(a){if(Array.isArray(a))return a.map(Ro);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const o={};for(const l in a)o[l]=Ro(a[l]);return o}return co(a)}class $p extends Error{constructor(o,l){super(l),this.message=l,this.key=o}}var Ya=$p;class Gp{constructor(o,l=[]){this.parent=o,this.bindings={};for(const[u,f]of l)this.bindings[u]=f}concat(o){return new Gp(this,o)}get(o){if(this.bindings[o])return this.bindings[o];if(this.parent)return this.parent.get(o);throw new Error(`${o} not found in scope.`)}has(o){return!!this.bindings[o]||!!this.parent&&this.parent.has(o)}}var eo=Gp;const Er={kind:"null"},un={kind:"number"},xi={kind:"string"},Cn={kind:"boolean"},fs={kind:"color"},zi={kind:"object"},mi={kind:"value"},$s={kind:"collator"},Ni={kind:"formatted"},Hn={kind:"resolvedImage"};function As(a,o){return{kind:"array",itemType:a,N:o}}function Ur(a){if("array"===a.kind){const o=Ur(a.itemType);return"number"==typeof a.N?`array<${o}, ${a.N}>`:"value"===a.itemType.kind?"array":`array<${o}>`}return a.kind}const Ot=[Er,un,xi,Cn,fs,Ni,zi,As(mi),Hn];function sa(a,o){if("error"===o.kind)return null;if("array"===a.kind){if("array"===o.kind&&(0===o.N&&"value"===o.itemType.kind||!sa(a.itemType,o.itemType))&&("number"!=typeof a.N||a.N===o.N))return null}else{if(a.kind===o.kind)return null;if("value"===a.kind)for(const l of Ot)if(!sa(l,o))return null}return`Expected ${Ur(a)} but found ${Ur(o)} instead.`}function ii(a,o){return o.some(l=>l.kind===a.kind)}function Xi(a,o){return o.some(l=>"null"===l?null===a:"array"===l?Array.isArray(a):"object"===l?a&&!Array.isArray(a)&&"object"==typeof a:l===typeof a)}var qp,t_={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function dd(a){return(a=Math.round(a))<0?0:a>255?255:a}function Zl(a){return dd("%"===a[a.length-1]?parseFloat(a)/100*255:parseInt(a))}function Jo(a){return(o="%"===a[a.length-1]?parseFloat(a)/100:parseFloat(a))<0?0:o>1?1:o;var o}function hd(a,o,l){return l<0?l+=1:l>1&&(l-=1),6*l<1?a+(o-a)*l*6:2*l<1?o:3*l<2?a+(o-a)*(2/3-l)*6:a}try{qp={}.parseCSSColor=function(a){var o,l=a.replace(/ /g,"").toLowerCase();if(l in t_)return t_[l].slice();if("#"===l[0])return 4===l.length?(o=parseInt(l.substr(1),16))>=0&&o<=4095?[(3840&o)>>4|(3840&o)>>8,240&o|(240&o)>>4,15&o|(15&o)<<4,1]:null:7===l.length&&(o=parseInt(l.substr(1),16))>=0&&o<=16777215?[(16711680&o)>>16,(65280&o)>>8,255&o,1]:null;var u=l.indexOf("("),f=l.indexOf(")");if(-1!==u&&f+1===l.length){var b=l.substr(0,u),v=l.substr(u+1,f-(u+1)).split(","),w=1;switch(b){case"rgba":if(4!==v.length)return null;w=Jo(v.pop());case"rgb":return 3!==v.length?null:[Zl(v[0]),Zl(v[1]),Zl(v[2]),w];case"hsla":if(4!==v.length)return null;w=Jo(v.pop());case"hsl":if(3!==v.length)return null;var T=(parseFloat(v[0])%360+360)%360/360,E=Jo(v[1]),A=Jo(v[2]),P=A<=.5?A*(E+1):A+E-A*E,L=2*A-P;return[dd(255*hd(L,P,T+1/3)),dd(255*hd(L,P,T)),dd(255*hd(L,P,T-1/3)),w];default:return null}}return null}}catch(a){}class ks{constructor(o,l,u,f=1){this.r=o,this.g=l,this.b=u,this.a=f}static parse(o){if(!o)return;if(o instanceof ks)return o;if("string"!=typeof o)return;const l=qp(o);return l?new ks(l[0]/255*l[3],l[1]/255*l[3],l[2]/255*l[3],l[3]):void 0}toString(){const[o,l,u,f]=this.toArray();return`rgba(${Math.round(o)},${Math.round(l)},${Math.round(u)},${f})`}toArray(){const{r:o,g:l,b:u,a:f}=this;return 0===f?[0,0,0,0]:[255*o/f,255*l/f,255*u/f,f]}toArray01(){const{r:o,g:l,b:u,a:f}=this;return 0===f?[0,0,0,0]:[o/f,l/f,u/f,f]}toArray01PremultipliedAlpha(){const{r:o,g:l,b:u,a:f}=this;return[o,l,u,f]}}ks.black=new ks(0,0,0,1),ks.white=new ks(1,1,1,1),ks.transparent=new ks(0,0,0,0),ks.red=new ks(1,0,0,1),ks.blue=new ks(0,0,1,1);var uo=ks;class xa{constructor(o,l,u){this.sensitivity=o?l?"variant":"case":l?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(o,l){return this.collator.compare(o,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Fm{constructor(o,l,u,f,b){this.text=o.normalize?o.normalize():o,this.image=l,this.scale=u,this.fontStack=f,this.textColor=b}}class Gs{constructor(o){this.sections=o}static fromString(o){return new Gs([new Fm(o,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(o=>0!==o.text.length||o.image&&0!==o.image.name.length)}static factory(o){return o instanceof Gs?o:Gs.fromString(o)}toString(){return 0===this.sections.length?"":this.sections.map(o=>o.text).join("")}serialize(){const o=["format"];for(const l of this.sections){if(l.image){o.push(["image",l.image.name]);continue}o.push(l.text);const u={};l.fontStack&&(u["text-font"]=["literal",l.fontStack.split(",")]),l.scale&&(u["font-scale"]=l.scale),l.textColor&&(u["text-color"]=["rgba"].concat(l.textColor.toArray())),o.push(u)}return o}}class wa{constructor(o){this.name=o.name,this.available=o.available}toString(){return this.name}static fromString(o){return o?new wa({name:o,available:!1}):null}serialize(){return["image",this.name]}}function n_(a,o,l,u){return"number"==typeof a&&a>=0&&a<=255&&"number"==typeof o&&o>=0&&o<=255&&"number"==typeof l&&l>=0&&l<=255?void 0===u||"number"==typeof u&&u>=0&&u<=1?null:`Invalid rgba value [${[a,o,l,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof u?[a,o,l,u]:[a,o,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function pd(a){if(null===a||"string"==typeof a||"boolean"==typeof a||"number"==typeof a||a instanceof uo||a instanceof xa||a instanceof Gs||a instanceof wa)return!0;if(Array.isArray(a)){for(const o of a)if(!pd(o))return!1;return!0}if("object"==typeof a){for(const o in a)if(!pd(a[o]))return!1;return!0}return!1}function to(a){if(null===a)return Er;if("string"==typeof a)return xi;if("boolean"==typeof a)return Cn;if("number"==typeof a)return un;if(a instanceof uo)return fs;if(a instanceof xa)return $s;if(a instanceof Gs)return Ni;if(a instanceof wa)return Hn;if(Array.isArray(a)){const o=a.length;let l;for(const u of a){const f=to(u);if(l){if(l===f)continue;l=mi;break}l=f}return As(l||mi,o)}return zi}function fd(a){const o=typeof a;return null===a?"":"string"===o||"number"===o||"boolean"===o?String(a):a instanceof uo||a instanceof Gs||a instanceof wa?a.toString():JSON.stringify(a)}class Nm{constructor(o,l){this.type=o,this.value=l}static parse(o,l){if(2!==o.length)return l.error(`'literal' expression requires exactly one argument, but found ${o.length-1} instead.`);if(!pd(o[1]))return l.error("invalid value");const u=o[1];let f=to(u);const b=l.expectedType;return"array"!==f.kind||0!==f.N||!b||"array"!==b.kind||"number"==typeof b.N&&0!==b.N||(f=b),new Nm(f,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof uo?["rgba"].concat(this.value.toArray()):this.value instanceof Gs?this.value.serialize():this.value}}var So=Nm,ci=class{constructor(a){this.name="ExpressionEvaluationError",this.message=a}toJSON(){return this.message}};const Bm={string:xi,number:un,boolean:Cn,object:zi};class zm{constructor(o,l){this.type=o,this.args=l}static parse(o,l){if(o.length<2)return l.error("Expected at least one argument.");let u,f=1;const b=o[0];if("array"===b){let w,T;if(o.length>2){const E=o[1];if("string"!=typeof E||!(E in Bm)||"object"===E)return l.error('The item type argument of "array" must be one of string, number, boolean',1);w=Bm[E],f++}else w=mi;if(o.length>3){if(null!==o[2]&&("number"!=typeof o[2]||o[2]<0||o[2]!==Math.floor(o[2])))return l.error('The length argument to "array" must be a positive integer literal',2);T=o[2],f++}u=As(w,T)}else u=Bm[b];const v=[];for(;f<o.length;f++){const w=l.parse(o[f],f,mi);if(!w)return null;v.push(w)}return new zm(u,v)}evaluate(o){for(let l=0;l<this.args.length;l++){const u=this.args[l].evaluate(o);if(!sa(this.type,to(u)))return u;if(l===this.args.length-1)throw new ci(`Expected value to be of type ${Ur(this.type)}, but found ${Ur(to(u))} instead.`)}return null}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){const o=this.type,l=[o.kind];if("array"===o.kind){const u=o.itemType;if("string"===u.kind||"number"===u.kind||"boolean"===u.kind){l.push(u.kind);const f=o.N;("number"==typeof f||this.args.length>1)&&l.push(f)}}return l.concat(this.args.map(u=>u.serialize()))}}var Yl=zm;class Jt{constructor(o){this.type=Ni,this.sections=o}static parse(o,l){if(o.length<2)return l.error("Expected at least one argument.");const u=o[1];if(!Array.isArray(u)&&"object"==typeof u)return l.error("First argument must be an image or text section.");const f=[];let b=!1;for(let v=1;v<=o.length-1;++v){const w=o[v];if(b&&"object"==typeof w&&!Array.isArray(w)){b=!1;let T=null;if(w["font-scale"]&&(T=l.parse(w["font-scale"],1,un),!T))return null;let E=null;if(w["text-font"]&&(E=l.parse(w["text-font"],1,As(xi)),!E))return null;let A=null;if(w["text-color"]&&(A=l.parse(w["text-color"],1,fs),!A))return null;const P=f[f.length-1];P.scale=T,P.font=E,P.textColor=A}else{const T=l.parse(o[v],1,mi);if(!T)return null;const E=T.type.kind;if("string"!==E&&"value"!==E&&"null"!==E&&"resolvedImage"!==E)return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");b=!0,f.push({content:T,scale:null,font:null,textColor:null})}}return new Jt(f)}evaluate(o){return new Gs(this.sections.map(l=>{const u=l.content.evaluate(o);return to(u)===Hn?new Fm("",u,null,null,null):new Fm(fd(u),null,l.scale?l.scale.evaluate(o):null,l.font?l.font.evaluate(o).join(","):null,l.textColor?l.textColor.evaluate(o):null)}))}eachChild(o){for(const l of this.sections)o(l.content),l.scale&&o(l.scale),l.font&&o(l.font),l.textColor&&o(l.textColor)}outputDefined(){return!1}serialize(){const o=["format"];for(const l of this.sections){o.push(l.content.serialize());const u={};l.scale&&(u["font-scale"]=l.scale.serialize()),l.font&&(u["text-font"]=l.font.serialize()),l.textColor&&(u["text-color"]=l.textColor.serialize()),o.push(u)}return o}}class Wp{constructor(o){this.type=Hn,this.input=o}static parse(o,l){if(2!==o.length)return l.error("Expected two arguments.");const u=l.parse(o[1],1,xi);return u?new Wp(u):l.error("No image name provided.")}evaluate(o){const l=this.input.evaluate(o),u=wa.fromString(l);return u&&o.availableImages&&(u.available=o.availableImages.indexOf(l)>-1),u}eachChild(o){o(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const wn={"to-boolean":Cn,"to-color":fs,"to-number":un,"to-string":xi};class fu{constructor(o,l){this.type=o,this.args=l}static parse(o,l){if(o.length<2)return l.error("Expected at least one argument.");const u=o[0];if(("to-boolean"===u||"to-string"===u)&&2!==o.length)return l.error("Expected one argument.");const f=wn[u],b=[];for(let v=1;v<o.length;v++){const w=l.parse(o[v],v,mi);if(!w)return null;b.push(w)}return new fu(f,b)}evaluate(o){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(o));if("color"===this.type.kind){let l,u;for(const f of this.args){if(l=f.evaluate(o),u=null,l instanceof uo)return l;if("string"==typeof l){const b=o.parseColor(l);if(b)return b}else if(Array.isArray(l)&&(u=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:n_(l[0],l[1],l[2],l[3]),!u))return new uo(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new ci(u||`Could not parse color from value '${"string"==typeof l?l:String(JSON.stringify(l))}'`)}if("number"===this.type.kind){let l=null;for(const u of this.args){if(l=u.evaluate(o),null===l)return 0;const f=Number(l);if(!isNaN(f))return f}throw new ci(`Could not convert ${JSON.stringify(l)} to number.`)}return"formatted"===this.type.kind?Gs.fromString(fd(this.args[0].evaluate(o))):"resolvedImage"===this.type.kind?wa.fromString(fd(this.args[0].evaluate(o))):fd(this.args[0].evaluate(o))}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Jt([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Wp(this.args[0]).serialize();const o=[`to-${this.type.kind}`];return this.eachChild(l=>{o.push(l.serialize())}),o}}var mu=fu;const Sa=["Unknown","Point","LineString","Polygon"];var Xp=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Sa[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const a=this.featureDistanceData.center,o=this.featureDistanceData.scale,{x:l,y:u}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(l*o-a[0])+this.featureDistanceData.bearing[1]*(u*o-a[1])}return 0}parseColor(a){let o=this._parseColorCache[a];return o||(o=this._parseColorCache[a]=uo.parse(a)),o}};class Pc{constructor(o,l,u,f){this.name=o,this.type=l,this._evaluate=u,this.args=f}evaluate(o){return this._evaluate(o,this.args)}eachChild(o){this.args.forEach(o)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(o=>o.serialize()))}static parse(o,l){const u=o[0],f=Pc.definitions[u];if(!f)return l.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const b=Array.isArray(f)?f[0]:f.type,v=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,w=v.filter(([E])=>!Array.isArray(E)||E.length===o.length-1);let T=null;for(const[E,A]of w){T=new Lc(l.registry,l.path,null,l.scope);const P=[];let L=!1;for(let N=1;N<o.length;N++){const B=o[N],$=Array.isArray(E)?E[N-1]:E.type,K=T.parse(B,1+P.length,$);if(!K){L=!0;break}P.push(K)}if(!L)if(Array.isArray(E)&&E.length!==P.length)T.error(`Expected ${E.length} arguments, but found ${P.length} instead.`);else{for(let N=0;N<P.length;N++){const B=Array.isArray(E)?E[N]:E.type,$=P[N];T.concat(N+1).checkSubtype(B,$.type)}if(0===T.errors.length)return new Pc(u,b,A,P)}}if(1===w.length)l.errors.push(...T.errors);else{const E=(w.length?w:v).map(([P])=>{return L=P,Array.isArray(L)?`(${L.map(Ur).join(", ")})`:`(${Ur(L.type)}...)`;var L}).join(" | "),A=[];for(let P=1;P<o.length;P++){const L=l.parse(o[P],1+A.length);if(!L)return null;A.push(Ur(L.type))}l.error(`Expected arguments of type ${E}, but found (${A.join(", ")}) instead.`)}return null}static register(o,l){Pc.definitions=l;for(const u in l)o[u]=Pc}}var Ka=Pc;class Kl{constructor(o,l,u){this.type=$s,this.locale=u,this.caseSensitive=o,this.diacriticSensitive=l}static parse(o,l){if(2!==o.length)return l.error("Expected one argument.");const u=o[1];if("object"!=typeof u||Array.isArray(u))return l.error("Collator options argument must be an object.");const f=l.parse(void 0!==u["case-sensitive"]&&u["case-sensitive"],1,Cn);if(!f)return null;const b=l.parse(void 0!==u["diacritic-sensitive"]&&u["diacritic-sensitive"],1,Cn);if(!b)return null;let v=null;return u.locale&&(v=l.parse(u.locale,1,xi),!v)?null:new Kl(f,b,v)}evaluate(o){return new xa(this.caseSensitive.evaluate(o),this.diacriticSensitive.evaluate(o),this.locale?this.locale.evaluate(o):null)}eachChild(o){o(this.caseSensitive),o(this.diacriticSensitive),this.locale&&o(this.locale)}outputDefined(){return!1}serialize(){const o={};return o["case-sensitive"]=this.caseSensitive.serialize(),o["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(o.locale=this.locale.serialize()),["collator",o]}}const Ca=8192;function md(a,o){a[0]=Math.min(a[0],o[0]),a[1]=Math.min(a[1],o[1]),a[2]=Math.max(a[2],o[0]),a[3]=Math.max(a[3],o[1])}function gu(a,o){return!(a[0]<=o[0]||a[2]>=o[2]||a[1]<=o[1]||a[3]>=o[3])}function Un(a,o){const l=(180+a[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,f=Math.pow(2,o.z);return[Math.round(l*f*Ca),Math.round(u*f*Ca)]}function Dh(a,o,l){const u=a[0]-o[0],f=a[1]-o[1],b=a[0]-l[0],v=a[1]-l[1];return u*v-b*f==0&&u*b<=0&&f*v<=0}function Ih(a,o){let l=!1;for(let v=0,w=o.length;v<w;v++){const T=o[v];for(let E=0,A=T.length;E<A-1;E++){if(Dh(a,T[E],T[E+1]))return!1;(f=T[E])[1]>(u=a)[1]!=(b=T[E+1])[1]>u[1]&&u[0]<(b[0]-f[0])*(u[1]-f[1])/(b[1]-f[1])+f[0]&&(l=!l)}}var u,f,b;return l}function Rs(a,o){for(let l=0;l<o.length;l++)if(Ih(a,o[l]))return!0;return!1}function Mh(a,o,l,u){const f=u[0]-l[0],b=u[1]-l[1],v=(a[0]-l[0])*b-f*(a[1]-l[1]),w=(o[0]-l[0])*b-f*(o[1]-l[1]);return v>0&&w<0||v<0&&w>0}function gd(a,o,l){for(const E of l)for(let A=0;A<E.length-1;++A)if((w=[(v=E[A+1])[0]-(b=E[A])[0],v[1]-b[1]])[0]*(T=[(f=o)[0]-(u=a)[0],f[1]-u[1]])[1]-w[1]*T[0]!=0&&Mh(u,f,b,v)&&Mh(b,v,u,f))return!0;var u,f,b,v,w,T;return!1}function Ei(a,o){for(let l=0;l<a.length;++l)if(!Ih(a[l],o))return!1;for(let l=0;l<a.length-1;++l)if(gd(a[l],a[l+1],o))return!1;return!0}function Ta(a,o){for(let l=0;l<o.length;l++)if(Ei(a,o[l]))return!0;return!1}function Vm(a,o,l){const u=[];for(let f=0;f<a.length;f++){const b=[];for(let v=0;v<a[f].length;v++){const w=Un(a[f][v],l);md(o,w),b.push(w)}u.push(b)}return u}function i_(a,o,l){const u=[];for(let f=0;f<a.length;f++){const b=Vm(a[f],o,l);u.push(b)}return u}function qs(a,o,l,u){if(a[0]<l[0]||a[0]>l[2]){const f=.5*u;let b=a[0]-l[0]>f?-u:l[0]-a[0]>f?u:0;0===b&&(b=a[0]-l[2]>f?-u:l[2]-a[0]>f?u:0),a[0]+=b}md(o,a)}function Lr(a,o,l,u){const f=Math.pow(2,u.z)*Ca,b=[u.x*Ca,u.y*Ca],v=[];if(!a)return v;for(const w of a)for(const T of w){const E=[T.x+b[0],T.y+b[1]];qs(E,o,l,f),v.push(E)}return v}function jm(a,o,l,u){const f=Math.pow(2,u.z)*Ca,b=[u.x*Ca,u.y*Ca],v=[];if(!a)return v;for(const T of a){const E=[];for(const A of T){const P=[A.x+b[0],A.y+b[1]];md(o,P),E.push(P)}v.push(E)}if(o[2]-o[0]<=f/2){(w=o)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const T of v)for(const E of T)qs(E,o,l,f)}var w;return v}class bd{constructor(o,l){this.type=Cn,this.geojson=o,this.geometries=l}static parse(o,l){if(2!==o.length)return l.error(`'within' expression requires exactly one argument, but found ${o.length-1} instead.`);if(pd(o[1])){const u=o[1];if("FeatureCollection"===u.type)for(let f=0;f<u.features.length;++f){const b=u.features[f].geometry.type;if("Polygon"===b||"MultiPolygon"===b)return new bd(u,u.features[f].geometry)}else if("Feature"===u.type){const f=u.geometry.type;if("Polygon"===f||"MultiPolygon"===f)return new bd(u,u.geometry)}else if("Polygon"===u.type||"MultiPolygon"===u.type)return new bd(u,u)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(o){if(null!=o.geometry()&&null!=o.canonicalID()){if("Point"===o.geometryType())return function(l,u){const f=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],v=l.canonicalID();if(!v)return!1;if("Polygon"===u.type){const w=Vm(u.coordinates,b,v),T=Lr(l.geometry(),f,b,v);if(!gu(f,b))return!1;for(const E of T)if(!Ih(E,w))return!1}if("MultiPolygon"===u.type){const w=i_(u.coordinates,b,v),T=Lr(l.geometry(),f,b,v);if(!gu(f,b))return!1;for(const E of T)if(!Rs(E,w))return!1}return!0}(o,this.geometries);if("LineString"===o.geometryType())return function(l,u){const f=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],v=l.canonicalID();if(!v)return!1;if("Polygon"===u.type){const w=Vm(u.coordinates,b,v),T=jm(l.geometry(),f,b,v);if(!gu(f,b))return!1;for(const E of T)if(!Ei(E,w))return!1}if("MultiPolygon"===u.type){const w=i_(u.coordinates,b,v),T=jm(l.geometry(),f,b,v);if(!gu(f,b))return!1;for(const E of T)if(!Ta(E,w))return!1}return!0}(o,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var vl=bd;function $i(a){if(a instanceof Ka&&("get"===a.name&&1===a.args.length||"feature-state"===a.name||"has"===a.name&&1===a.args.length||"properties"===a.name||"geometry-type"===a.name||"id"===a.name||/^filter-/.test(a.name))||a instanceof vl)return!1;let o=!0;return a.eachChild(l=>{o&&!$i(l)&&(o=!1)}),o}function aa(a){if(a instanceof Ka&&"feature-state"===a.name)return!1;let o=!0;return a.eachChild(l=>{o&&!aa(l)&&(o=!1)}),o}function xl(a,o){if(a instanceof Ka&&o.indexOf(a.name)>=0)return!1;let l=!0;return a.eachChild(u=>{l&&!xl(u,o)&&(l=!1)}),l}class bu{constructor(o,l){this.type=l.type,this.name=o,this.boundExpression=l}static parse(o,l){if(2!==o.length||"string"!=typeof o[1])return l.error("'var' expression requires exactly one string literal argument.");const u=o[1];return l.scope.has(u)?new bu(u,l.scope.get(u)):l.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(o){return this.boundExpression.evaluate(o)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Zp=bu;class Ws{constructor(o,l=[],u,f=new eo,b=[]){this.registry=o,this.path=l,this.key=l.map(v=>`[${v}]`).join(""),this.scope=f,this.errors=b,this.expectedType=u}parse(o,l,u,f,b={}){return l?this.concat(l,u,f)._parse(o,b):this._parse(o,b)}_parse(o,l){function u(f,b,v){return"assert"===v?new Yl(b,[f]):"coerce"===v?new mu(b,[f]):f}if(null!==o&&"string"!=typeof o&&"boolean"!=typeof o&&"number"!=typeof o||(o=["literal",o]),Array.isArray(o)){if(0===o.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const f=o[0];if("string"!=typeof f)return this.error(`Expression name must be a string, but found ${typeof f} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const b=this.registry[f];if(b){let v=b.parse(o,this);if(!v)return null;if(this.expectedType){const w=this.expectedType,T=v.type;if("string"!==w.kind&&"number"!==w.kind&&"boolean"!==w.kind&&"object"!==w.kind&&"array"!==w.kind||"value"!==T.kind)if("color"!==w.kind&&"formatted"!==w.kind&&"resolvedImage"!==w.kind||"value"!==T.kind&&"string"!==T.kind){if(this.checkSubtype(w,T))return null}else v=u(v,w,l.typeAnnotation||"coerce");else v=u(v,w,l.typeAnnotation||"assert")}if(!(v instanceof So)&&"resolvedImage"!==v.type.kind&&Yp(v)){const w=new Xp;try{v=new So(v.type,v.evaluate(w))}catch(T){return this.error(T.message),null}}return v}return this.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===o?"'undefined' value invalid. Use null instead.":"object"==typeof o?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof o} instead.`)}concat(o,l,u){const f="number"==typeof o?this.path.concat(o):this.path,b=u?this.scope.concat(u):this.scope;return new Ws(this.registry,f,l||null,b,this.errors)}error(o,...l){const u=`${this.key}${l.map(f=>`[${f}]`).join("")}`;this.errors.push(new Ya(u,o))}checkSubtype(o,l){const u=sa(o,l);return u&&this.error(u),u}}var Lc=Ws;function Yp(a){if(a instanceof Zp)return Yp(a.boundExpression);if(a instanceof Ka&&"error"===a.name||a instanceof Kl||a instanceof vl)return!1;const o=a instanceof mu||a instanceof Yl;let l=!0;return a.eachChild(u=>{l=o?l&&Yp(u):l&&u instanceof So}),!!l&&$i(a)&&xl(a,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function vn(a,o){const l=a.length-1;let u,f,b=0,v=l,w=0;for(;b<=v;)if(w=Math.floor((b+v)/2),u=a[w],f=a[w+1],u<=o){if(w===l||o<f)return w;b=w+1}else{if(!(u>o))throw new ci("Input is not a number.");v=w-1}return 0}class Ah{constructor(o,l,u){this.type=o,this.input=l,this.labels=[],this.outputs=[];for(const[f,b]of u)this.labels.push(f),this.outputs.push(b)}static parse(o,l){if(o.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return l.error("Expected an even number of arguments.");const u=l.parse(o[1],1,un);if(!u)return null;const f=[];let b=null;l.expectedType&&"value"!==l.expectedType.kind&&(b=l.expectedType);for(let v=1;v<o.length;v+=2){const w=1===v?-1/0:o[v],T=o[v+1],E=v,A=v+1;if("number"!=typeof w)return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(f.length&&f[f.length-1][0]>=w)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const P=l.parse(T,A,b);if(!P)return null;b=b||P.type,f.push([w,P])}return new Ah(b,u,f)}evaluate(o){const l=this.labels,u=this.outputs;if(1===l.length)return u[0].evaluate(o);const f=this.input.evaluate(o);if(f<=l[0])return u[0].evaluate(o);const b=l.length;return f>=l[b-1]?u[b-1].evaluate(o):u[vn(l,f)].evaluate(o)}eachChild(o){o(this.input);for(const l of this.outputs)o(l)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}serialize(){const o=["step",this.input.serialize()];for(let l=0;l<this.labels.length;l++)l>0&&o.push(this.labels[l]),o.push(this.outputs[l].serialize());return o}}var kh=Ah;function Bi(a,o,l){return a*(1-l)+o*l}var xn=Object.freeze({__proto__:null,array:function(a,o,l){return a.map((u,f)=>Bi(u,o[f],l))},color:function(a,o,l){return new uo(Bi(a.r,o.r,l),Bi(a.g,o.g,l),Bi(a.b,o.b,l),Bi(a.a,o.a,l))},number:Bi});const Lt=4/29,_o=6/29,hr=3*_o*_o,gs=Math.PI/180,_u=180/Math.PI;function bs(a){return a>.008856451679035631?Math.pow(a,1/3):a/hr+Lt}function yu(a){return a>_o?a*a*a:hr*(a-Lt)}function _d(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function Ql(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function yd(a){const o=Ql(a.r),l=Ql(a.g),u=Ql(a.b),f=bs((.4124564*o+.3575761*l+.1804375*u)/.95047),b=bs((.2126729*o+.7151522*l+.072175*u)/1);return{l:116*b-16,a:500*(f-b),b:200*(b-bs((.0193339*o+.119192*l+.9503041*u)/1.08883)),alpha:a.a}}function Jl(a){let o=(a.l+16)/116,l=isNaN(a.a)?o:o+a.a/500,u=isNaN(a.b)?o:o-a.b/200;return o=1*yu(o),l=.95047*yu(l),u=1.08883*yu(u),new uo(_d(3.2404542*l-1.5371385*o-.4985314*u),_d(-.969266*l+1.8760108*o+.041556*u),_d(.0556434*l-.2040259*o+1.0572252*u),a.alpha)}function es(a,o,l){const u=o-a;return a+l*(u>180||u<-180?u-360*Math.round(u/360):u)}const vd={forward:yd,reverse:Jl,interpolate:function(a,o,l){return{l:Bi(a.l,o.l,l),a:Bi(a.a,o.a,l),b:Bi(a.b,o.b,l),alpha:Bi(a.alpha,o.alpha,l)}}},Vo={forward:function(a){const{l:o,a:l,b:u}=yd(a),f=Math.atan2(u,l)*_u;return{h:f<0?f+360:f,c:Math.sqrt(l*l+u*u),l:o,alpha:a.a}},reverse:function(a){const o=a.h*gs,l=a.c;return Jl({l:a.l,a:Math.cos(o)*l,b:Math.sin(o)*l,alpha:a.alpha})},interpolate:function(a,o,l){return{h:es(a.h,o.h,l),c:Bi(a.c,o.c,l),l:Bi(a.l,o.l,l),alpha:Bi(a.alpha,o.alpha,l)}}};var yn=Object.freeze({__proto__:null,hcl:Vo,lab:vd});class ui{constructor(o,l,u,f,b){this.type=o,this.operator=l,this.interpolation=u,this.input=f,this.labels=[],this.outputs=[];for(const[v,w]of b)this.labels.push(v),this.outputs.push(w)}static interpolationFactor(o,l,u,f){let b=0;if("exponential"===o.name)b=Br(l,o.base,u,f);else if("linear"===o.name)b=Br(l,1,u,f);else if("cubic-bezier"===o.name){const v=o.controlPoints;b=new an(v[0],v[1],v[2],v[3]).solve(Br(l,1,u,f))}return b}static parse(o,l){let[u,f,b,...v]=o;if(!Array.isArray(f)||0===f.length)return l.error("Expected an interpolation type expression.",1);if("linear"===f[0])f={name:"linear"};else if("exponential"===f[0]){const E=f[1];if("number"!=typeof E)return l.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:E}}else{if("cubic-bezier"!==f[0])return l.error(`Unknown interpolation type ${String(f[0])}`,1,0);{const E=f.slice(1);if(4!==E.length||E.some(A=>"number"!=typeof A||A<0||A>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:E}}}if(o.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(b=l.parse(b,2,un),!b)return null;const w=[];let T=null;"interpolate-hcl"===u||"interpolate-lab"===u?T=fs:l.expectedType&&"value"!==l.expectedType.kind&&(T=l.expectedType);for(let E=0;E<v.length;E+=2){const A=v[E],P=v[E+1],L=E+3,N=E+4;if("number"!=typeof A)return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(w.length&&w[w.length-1][0]>=A)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',L);const B=l.parse(P,N,T);if(!B)return null;T=T||B.type,w.push([A,B])}return"number"===T.kind||"color"===T.kind||"array"===T.kind&&"number"===T.itemType.kind&&"number"==typeof T.N?new ui(T,u,f,b,w):l.error(`Type ${Ur(T)} is not interpolatable.`)}evaluate(o){const l=this.labels,u=this.outputs;if(1===l.length)return u[0].evaluate(o);const f=this.input.evaluate(o);if(f<=l[0])return u[0].evaluate(o);const b=l.length;if(f>=l[b-1])return u[b-1].evaluate(o);const v=vn(l,f),w=ui.interpolationFactor(this.interpolation,f,l[v],l[v+1]),T=u[v].evaluate(o),E=u[v+1].evaluate(o);return"interpolate"===this.operator?xn[this.type.kind.toLowerCase()](T,E,w):"interpolate-hcl"===this.operator?Vo.reverse(Vo.interpolate(Vo.forward(T),Vo.forward(E),w)):vd.reverse(vd.interpolate(vd.forward(T),vd.forward(E),w))}eachChild(o){o(this.input);for(const l of this.outputs)o(l)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}serialize(){let o;o="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const l=[this.operator,o,this.input.serialize()];for(let u=0;u<this.labels.length;u++)l.push(this.labels[u],this.outputs[u].serialize());return l}}function Br(a,o,l,u){const f=u-l,b=a-l;return 0===f?0:1===o?b/f:(Math.pow(o,b)-1)/(Math.pow(o,f)-1)}var no=ui;class Qa{constructor(o,l){this.type=o,this.args=l}static parse(o,l){if(o.length<2)return l.error("Expectected at least one argument.");let u=null;const f=l.expectedType;f&&"value"!==f.kind&&(u=f);const b=[];for(const w of o.slice(1)){const T=l.parse(w,1+b.length,u,void 0,{typeAnnotation:"omit"});if(!T)return null;u=u||T.type,b.push(T)}const v=f&&b.some(w=>sa(f,w.type));return new Qa(v?mi:u,b)}evaluate(o){let l,u=null,f=0;for(const b of this.args){if(f++,u=b.evaluate(o),u&&u instanceof wa&&!u.available&&(l||(l=u),u=null,f===this.args.length))return l;if(null!==u)break}return u}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){const o=["coalesce"];return this.eachChild(l=>{o.push(l.serialize())}),o}}var yo=Qa;class Ja{constructor(o,l){this.type=l.type,this.bindings=[].concat(o),this.result=l}evaluate(o){return this.result.evaluate(o)}eachChild(o){for(const l of this.bindings)o(l[1]);o(this.result)}static parse(o,l){if(o.length<4)return l.error(`Expected at least 3 arguments, but found ${o.length-1} instead.`);const u=[];for(let b=1;b<o.length-1;b+=2){const v=o[b];if("string"!=typeof v)return l.error(`Expected string, but found ${typeof v} instead.`,b);if(/[^a-zA-Z0-9_]/.test(v))return l.error("Variable names must contain only alphanumeric characters or '_'.",b);const w=l.parse(o[b+1],b+1);if(!w)return null;u.push([v,w])}const f=l.parse(o[o.length-1],o.length-1,l.expectedType,u);return f?new Ja(u,f):null}outputDefined(){return this.result.outputDefined()}serialize(){const o=["let"];for(const[l,u]of this.bindings)o.push(l,u.serialize());return o.push(this.result.serialize()),o}}var Xr=Ja;class Oc{constructor(o,l,u){this.type=o,this.index=l,this.input=u}static parse(o,l){if(3!==o.length)return l.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const u=l.parse(o[1],1,un),f=l.parse(o[2],2,As(l.expectedType||mi));return u&&f?new Oc(f.type.itemType,u,f):null}evaluate(o){const l=this.index.evaluate(o),u=this.input.evaluate(o);if(l<0)throw new ci(`Array index out of bounds: ${l} < 0.`);if(l>=u.length)throw new ci(`Array index out of bounds: ${l} > ${u.length-1}.`);if(l!==Math.floor(l))throw new ci(`Array index must be an integer, but found ${l} instead.`);return u[l]}eachChild(o){o(this.index),o(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var xd=Oc;class wi{constructor(o,l){this.type=Cn,this.needle=o,this.haystack=l}static parse(o,l){if(3!==o.length)return l.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const u=l.parse(o[1],1,mi),f=l.parse(o[2],2,mi);return u&&f?ii(u.type,[Cn,xi,un,Er,mi])?new wi(u,f):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ur(u.type)} instead`):null}evaluate(o){const l=this.needle.evaluate(o),u=this.haystack.evaluate(o);if(null==u)return!1;if(!Xi(l,["boolean","string","number","null"]))throw new ci(`Expected first argument to be of type boolean, string, number or null, but found ${Ur(to(l))} instead.`);if(!Xi(u,["string","array"]))throw new ci(`Expected second argument to be of type array or string, but found ${Ur(to(u))} instead.`);return u.indexOf(l)>=0}eachChild(o){o(this.needle),o(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Fc=wi;class el{constructor(o,l,u){this.type=un,this.needle=o,this.haystack=l,this.fromIndex=u}static parse(o,l){if(o.length<=2||o.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const u=l.parse(o[1],1,mi),f=l.parse(o[2],2,mi);if(!u||!f)return null;if(!ii(u.type,[Cn,xi,un,Er,mi]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ur(u.type)} instead`);if(4===o.length){const b=l.parse(o[3],3,un);return b?new el(u,f,b):null}return new el(u,f)}evaluate(o){const l=this.needle.evaluate(o),u=this.haystack.evaluate(o);if(!Xi(l,["boolean","string","number","null"]))throw new ci(`Expected first argument to be of type boolean, string, number or null, but found ${Ur(to(l))} instead.`);if(!Xi(u,["string","array"]))throw new ci(`Expected second argument to be of type array or string, but found ${Ur(to(u))} instead.`);if(this.fromIndex){const f=this.fromIndex.evaluate(o);return u.indexOf(l,f)}return u.indexOf(l)}eachChild(o){o(this.needle),o(this.haystack),this.fromIndex&&o(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const o=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),o]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Ph=el;class wl{constructor(o,l,u,f,b,v){this.inputType=o,this.type=l,this.input=u,this.cases=f,this.outputs=b,this.otherwise=v}static parse(o,l){if(o.length<5)return l.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if(o.length%2!=1)return l.error("Expected an even number of arguments.");let u,f;l.expectedType&&"value"!==l.expectedType.kind&&(f=l.expectedType);const b={},v=[];for(let E=2;E<o.length-1;E+=2){let A=o[E];const P=o[E+1];Array.isArray(A)||(A=[A]);const L=l.concat(E);if(0===A.length)return L.error("Expected at least one branch label.");for(const B of A){if("number"!=typeof B&&"string"!=typeof B)return L.error("Branch labels must be numbers or strings.");if("number"==typeof B&&Math.abs(B)>Number.MAX_SAFE_INTEGER)return L.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof B&&Math.floor(B)!==B)return L.error("Numeric branch labels must be integer values.");if(u){if(L.checkSubtype(u,to(B)))return null}else u=to(B);if(void 0!==b[String(B)])return L.error("Branch labels must be unique.");b[String(B)]=v.length}const N=l.parse(P,E,f);if(!N)return null;f=f||N.type,v.push(N)}const w=l.parse(o[1],1,mi);if(!w)return null;const T=l.parse(o[o.length-1],o.length-1,f);return T?"value"!==w.type.kind&&l.concat(1).checkSubtype(u,w.type)?null:new wl(u,f,w,b,v,T):null}evaluate(o){const l=this.input.evaluate(o);return(to(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(o)}eachChild(o){o(this.input),this.outputs.forEach(o),o(this.otherwise)}outputDefined(){return this.outputs.every(o=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){const o=["match",this.input.serialize()],l=Object.keys(this.cases).sort(),u=[],f={};for(const v of l){const w=f[this.cases[v]];void 0===w?(f[this.cases[v]]=u.length,u.push([this.cases[v],[v]])):u[w][1].push(v)}const b=v=>"number"===this.inputType.kind?Number(v):v;for(const[v,w]of u)o.push(1===w.length?b(w[0]):w.map(b)),o.push(this.outputs[v].serialize());return o.push(this.otherwise.serialize()),o}}var ts=wl;class Nc{constructor(o,l,u){this.type=o,this.branches=l,this.otherwise=u}static parse(o,l){if(o.length<4)return l.error(`Expected at least 3 arguments, but found only ${o.length-1}.`);if(o.length%2!=0)return l.error("Expected an odd number of arguments.");let u;l.expectedType&&"value"!==l.expectedType.kind&&(u=l.expectedType);const f=[];for(let v=1;v<o.length-1;v+=2){const w=l.parse(o[v],v,Cn);if(!w)return null;const T=l.parse(o[v+1],v+1,u);if(!T)return null;f.push([w,T]),u=u||T.type}const b=l.parse(o[o.length-1],o.length-1,u);return b?new Nc(u,f,b):null}evaluate(o){for(const[l,u]of this.branches)if(l.evaluate(o))return u.evaluate(o);return this.otherwise.evaluate(o)}eachChild(o){for(const[l,u]of this.branches)o(l),o(u);o(this.otherwise)}outputDefined(){return this.branches.every(([o,l])=>l.outputDefined())&&this.otherwise.outputDefined()}serialize(){const o=["case"];return this.eachChild(l=>{o.push(l.serialize())}),o}}var Bc=Nc;class _s{constructor(o,l,u,f){this.type=o,this.input=l,this.beginIndex=u,this.endIndex=f}static parse(o,l){if(o.length<=2||o.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const u=l.parse(o[1],1,mi),f=l.parse(o[2],2,un);if(!u||!f)return null;if(!ii(u.type,[As(mi),xi,mi]))return l.error(`Expected first argument to be of type array or string, but found ${Ur(u.type)} instead`);if(4===o.length){const b=l.parse(o[3],3,un);return b?new _s(u.type,u,f,b):null}return new _s(u.type,u,f)}evaluate(o){const l=this.input.evaluate(o),u=this.beginIndex.evaluate(o);if(!Xi(l,["string","array"]))throw new ci(`Expected first argument to be of type array or string, but found ${Ur(to(l))} instead.`);if(this.endIndex){const f=this.endIndex.evaluate(o);return l.slice(u,f)}return l.slice(u)}eachChild(o){o(this.input),o(this.beginIndex),this.endIndex&&o(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const o=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),o]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var zc=_s;function wd(a,o){return"=="===a||"!="===a?"boolean"===o.kind||"string"===o.kind||"number"===o.kind||"null"===o.kind||"value"===o.kind:"string"===o.kind||"number"===o.kind||"value"===o.kind}function Or(a,o,l,u){return 0===u.compare(o,l)}function vu(a,o,l){const u="=="!==a&&"!="!==a;return class tB{constructor(b,v,w){this.type=Cn,this.lhs=b,this.rhs=v,this.collator=w,this.hasUntypedArgument="value"===b.type.kind||"value"===v.type.kind}static parse(b,v){if(3!==b.length&&4!==b.length)return v.error("Expected two or three arguments.");const w=b[0];let T=v.parse(b[1],1,mi);if(!T)return null;if(!wd(w,T.type))return v.concat(1).error(`"${w}" comparisons are not supported for type '${Ur(T.type)}'.`);let E=v.parse(b[2],2,mi);if(!E)return null;if(!wd(w,E.type))return v.concat(2).error(`"${w}" comparisons are not supported for type '${Ur(E.type)}'.`);if(T.type.kind!==E.type.kind&&"value"!==T.type.kind&&"value"!==E.type.kind)return v.error(`Cannot compare types '${Ur(T.type)}' and '${Ur(E.type)}'.`);u&&("value"===T.type.kind&&"value"!==E.type.kind?T=new Yl(E.type,[T]):"value"!==T.type.kind&&"value"===E.type.kind&&(E=new Yl(T.type,[E])));let A=null;if(4===b.length){if("string"!==T.type.kind&&"string"!==E.type.kind&&"value"!==T.type.kind&&"value"!==E.type.kind)return v.error("Cannot use collator to compare non-string types.");if(A=v.parse(b[3],3,$s),!A)return null}return new tB(T,E,A)}evaluate(b){const v=this.lhs.evaluate(b),w=this.rhs.evaluate(b);if(u&&this.hasUntypedArgument){const T=to(v),E=to(w);if(T.kind!==E.kind||"string"!==T.kind&&"number"!==T.kind)throw new ci(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${T.kind}, ${E.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const T=to(v),E=to(w);if("string"!==T.kind||"string"!==E.kind)return o(b,v,w)}return this.collator?l(b,v,w,this.collator.evaluate(b)):o(b,v,w)}eachChild(b){b(this.lhs),b(this.rhs),this.collator&&b(this.collator)}outputDefined(){return!0}serialize(){const b=[a];return this.eachChild(v=>{b.push(v.serialize())}),b}}}const r_=vu("==",function(a,o,l){return o===l},Or),Ps=vu("!=",function(a,o,l){return o!==l},function(a,o,l,u){return!Or(0,o,l,u)}),Ea=vu("<",function(a,o,l){return o<l},function(a,o,l,u){return u.compare(o,l)<0}),Kp=vu(">",function(a,o,l){return o>l},function(a,o,l,u){return u.compare(o,l)>0}),Lh=vu("<=",function(a,o,l){return o<=l},function(a,o,l,u){return u.compare(o,l)<=0}),Sd=vu(">=",function(a,o,l){return o>=l},function(a,o,l,u){return u.compare(o,l)>=0});class Ls{constructor(o,l,u,f,b,v){this.type=xi,this.number=o,this.locale=l,this.currency=u,this.unit=f,this.minFractionDigits=b,this.maxFractionDigits=v}static parse(o,l){if(3!==o.length)return l.error("Expected two arguments.");const u=l.parse(o[1],1,un);if(!u)return null;const f=o[2];if("object"!=typeof f||Array.isArray(f))return l.error("NumberFormat options argument must be an object.");let b=null;if(f.locale&&(b=l.parse(f.locale,1,xi),!b))return null;let v=null;if(f.currency&&(v=l.parse(f.currency,1,xi),!v))return null;let w=null;if(f.unit&&(w=l.parse(f.unit,1,xi),!w))return null;let T=null;if(f["min-fraction-digits"]&&(T=l.parse(f["min-fraction-digits"],1,un),!T))return null;let E=null;return f["max-fraction-digits"]&&(E=l.parse(f["max-fraction-digits"],1,un),!E)?null:new Ls(u,b,v,w,T,E)}evaluate(o){return new Intl.NumberFormat(this.locale?this.locale.evaluate(o):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(o):void 0,unit:this.unit?this.unit.evaluate(o):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(o):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(o):void 0}).format(this.number.evaluate(o))}eachChild(o){o(this.number),this.locale&&o(this.locale),this.currency&&o(this.currency),this.unit&&o(this.unit),this.minFractionDigits&&o(this.minFractionDigits),this.maxFractionDigits&&o(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const o={};return this.locale&&(o.locale=this.locale.serialize()),this.currency&&(o.currency=this.currency.serialize()),this.unit&&(o.unit=this.unit.serialize()),this.minFractionDigits&&(o["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(o["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),o]}}class xu{constructor(o){this.type=un,this.input=o}static parse(o,l){if(2!==o.length)return l.error(`Expected 1 argument, but found ${o.length-1} instead.`);const u=l.parse(o[1],1);return u?"array"!==u.type.kind&&"string"!==u.type.kind&&"value"!==u.type.kind?l.error(`Expected argument of type string or array, but found ${Ur(u.type)} instead.`):new xu(u):null}evaluate(o){const l=this.input.evaluate(o);if("string"==typeof l||Array.isArray(l))return l.length;throw new ci(`Expected value to be of type string or array, but found ${Ur(to(l))} instead.`)}eachChild(o){o(this.input)}outputDefined(){return!1}serialize(){const o=["length"];return this.eachChild(l=>{o.push(l.serialize())}),o}}const o_={"==":r_,"!=":Ps,">":Kp,"<":Ea,">=":Sd,"<=":Lh,array:Yl,at:xd,boolean:Yl,case:Bc,coalesce:yo,collator:Kl,format:Jt,image:Wp,in:Fc,"index-of":Ph,interpolate:no,"interpolate-hcl":no,"interpolate-lab":no,length:xu,let:Xr,literal:So,match:ts,number:Yl,"number-format":Ls,object:Yl,slice:zc,step:kh,string:Yl,"to-boolean":mu,"to-color":mu,"to-number":mu,"to-string":mu,var:Zp,within:vl};function Hm(a,[o,l,u,f]){o=o.evaluate(a),l=l.evaluate(a),u=u.evaluate(a);const b=f?f.evaluate(a):1,v=n_(o,l,u,b);if(v)throw new ci(v);return new uo(o/255*b,l/255*b,u/255*b,b)}function Sl(a,o){return a in o}function Qp(a,o){const l=o[a];return void 0===l?null:l}function Da(a){return{type:a}}Ka.register(o_,{error:[{kind:"error"},[xi],(a,[o])=>{throw new ci(o.evaluate(a))}],typeof:[xi,[mi],(a,[o])=>Ur(to(o.evaluate(a)))],"to-rgba":[As(un,4),[fs],(a,[o])=>o.evaluate(a).toArray()],rgb:[fs,[un,un,un],Hm],rgba:[fs,[un,un,un,un],Hm],has:{type:Cn,overloads:[[[xi],(a,[o])=>Sl(o.evaluate(a),a.properties())],[[xi,zi],(a,[o,l])=>Sl(o.evaluate(a),l.evaluate(a))]]},get:{type:mi,overloads:[[[xi],(a,[o])=>Qp(o.evaluate(a),a.properties())],[[xi,zi],(a,[o,l])=>Qp(o.evaluate(a),l.evaluate(a))]]},"feature-state":[mi,[xi],(a,[o])=>Qp(o.evaluate(a),a.featureState||{})],properties:[zi,[],a=>a.properties()],"geometry-type":[xi,[],a=>a.geometryType()],id:[mi,[],a=>a.id()],zoom:[un,[],a=>a.globals.zoom],pitch:[un,[],a=>a.globals.pitch||0],"distance-from-center":[un,[],a=>a.distanceFromCenter()],"heatmap-density":[un,[],a=>a.globals.heatmapDensity||0],"line-progress":[un,[],a=>a.globals.lineProgress||0],"sky-radial-progress":[un,[],a=>a.globals.skyRadialProgress||0],accumulated:[mi,[],a=>void 0===a.globals.accumulated?null:a.globals.accumulated],"+":[un,Da(un),(a,o)=>{let l=0;for(const u of o)l+=u.evaluate(a);return l}],"*":[un,Da(un),(a,o)=>{let l=1;for(const u of o)l*=u.evaluate(a);return l}],"-":{type:un,overloads:[[[un,un],(a,[o,l])=>o.evaluate(a)-l.evaluate(a)],[[un],(a,[o])=>-o.evaluate(a)]]},"/":[un,[un,un],(a,[o,l])=>o.evaluate(a)/l.evaluate(a)],"%":[un,[un,un],(a,[o,l])=>o.evaluate(a)%l.evaluate(a)],ln2:[un,[],()=>Math.LN2],pi:[un,[],()=>Math.PI],e:[un,[],()=>Math.E],"^":[un,[un,un],(a,[o,l])=>Math.pow(o.evaluate(a),l.evaluate(a))],sqrt:[un,[un],(a,[o])=>Math.sqrt(o.evaluate(a))],log10:[un,[un],(a,[o])=>Math.log(o.evaluate(a))/Math.LN10],ln:[un,[un],(a,[o])=>Math.log(o.evaluate(a))],log2:[un,[un],(a,[o])=>Math.log(o.evaluate(a))/Math.LN2],sin:[un,[un],(a,[o])=>Math.sin(o.evaluate(a))],cos:[un,[un],(a,[o])=>Math.cos(o.evaluate(a))],tan:[un,[un],(a,[o])=>Math.tan(o.evaluate(a))],asin:[un,[un],(a,[o])=>Math.asin(o.evaluate(a))],acos:[un,[un],(a,[o])=>Math.acos(o.evaluate(a))],atan:[un,[un],(a,[o])=>Math.atan(o.evaluate(a))],min:[un,Da(un),(a,o)=>Math.min(...o.map(l=>l.evaluate(a)))],max:[un,Da(un),(a,o)=>Math.max(...o.map(l=>l.evaluate(a)))],abs:[un,[un],(a,[o])=>Math.abs(o.evaluate(a))],round:[un,[un],(a,[o])=>{const l=o.evaluate(a);return l<0?-Math.round(-l):Math.round(l)}],floor:[un,[un],(a,[o])=>Math.floor(o.evaluate(a))],ceil:[un,[un],(a,[o])=>Math.ceil(o.evaluate(a))],"filter-==":[Cn,[xi,mi],(a,[o,l])=>a.properties()[o.value]===l.value],"filter-id-==":[Cn,[mi],(a,[o])=>a.id()===o.value],"filter-type-==":[Cn,[xi],(a,[o])=>a.geometryType()===o.value],"filter-<":[Cn,[xi,mi],(a,[o,l])=>{const u=a.properties()[o.value],f=l.value;return typeof u==typeof f&&u<f}],"filter-id-<":[Cn,[mi],(a,[o])=>{const l=a.id(),u=o.value;return typeof l==typeof u&&l<u}],"filter->":[Cn,[xi,mi],(a,[o,l])=>{const u=a.properties()[o.value],f=l.value;return typeof u==typeof f&&u>f}],"filter-id->":[Cn,[mi],(a,[o])=>{const l=a.id(),u=o.value;return typeof l==typeof u&&l>u}],"filter-<=":[Cn,[xi,mi],(a,[o,l])=>{const u=a.properties()[o.value],f=l.value;return typeof u==typeof f&&u<=f}],"filter-id-<=":[Cn,[mi],(a,[o])=>{const l=a.id(),u=o.value;return typeof l==typeof u&&l<=u}],"filter->=":[Cn,[xi,mi],(a,[o,l])=>{const u=a.properties()[o.value],f=l.value;return typeof u==typeof f&&u>=f}],"filter-id->=":[Cn,[mi],(a,[o])=>{const l=a.id(),u=o.value;return typeof l==typeof u&&l>=u}],"filter-has":[Cn,[mi],(a,[o])=>o.value in a.properties()],"filter-has-id":[Cn,[],a=>null!==a.id()&&void 0!==a.id()],"filter-type-in":[Cn,[As(xi)],(a,[o])=>o.value.indexOf(a.geometryType())>=0],"filter-id-in":[Cn,[As(mi)],(a,[o])=>o.value.indexOf(a.id())>=0],"filter-in-small":[Cn,[xi,As(mi)],(a,[o,l])=>l.value.indexOf(a.properties()[o.value])>=0],"filter-in-large":[Cn,[xi,As(mi)],(a,[o,l])=>function(u,f,b,v){for(;b<=v;){const w=b+v>>1;if(f[w]===u)return!0;f[w]>u?v=w-1:b=w+1}return!1}(a.properties()[o.value],l.value,0,l.value.length-1)],all:{type:Cn,overloads:[[[Cn,Cn],(a,[o,l])=>o.evaluate(a)&&l.evaluate(a)],[Da(Cn),(a,o)=>{for(const l of o)if(!l.evaluate(a))return!1;return!0}]]},any:{type:Cn,overloads:[[[Cn,Cn],(a,[o,l])=>o.evaluate(a)||l.evaluate(a)],[Da(Cn),(a,o)=>{for(const l of o)if(l.evaluate(a))return!0;return!1}]]},"!":[Cn,[Cn],(a,[o])=>!o.evaluate(a)],"is-supported-script":[Cn,[xi],(a,[o])=>{const l=a.globals&&a.globals.isSupportedScript;return!l||l(o.evaluate(a))}],upcase:[xi,[xi],(a,[o])=>o.evaluate(a).toUpperCase()],downcase:[xi,[xi],(a,[o])=>o.evaluate(a).toLowerCase()],concat:[xi,Da(mi),(a,o)=>o.map(l=>fd(l.evaluate(a))).join("")],"resolved-locale":[xi,[$s],(a,[o])=>o.evaluate(a).resolvedLocale()]});var Oh=o_;function s_(a){return{result:"success",value:a}}function wu(a){return{result:"error",value:a}}function Cd(a){return"data-driven"===a["property-type"]}function Jp(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function ef(a){return!!a.expression&&a.expression.interpolated}function Zi(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":null===a?"null":typeof a}function Fh(a){return"object"==typeof a&&null!==a&&!Array.isArray(a)}function a_(a){return a}function tf(a,o){const l="color"===o.type,u=a.stops&&"object"==typeof a.stops[0][0],f=u||!(u||void 0!==a.property),b=a.type||(ef(o)?"exponential":"interval");if(l&&((a=yl({},a)).stops&&(a.stops=a.stops.map(E=>[E[0],uo.parse(E[1])])),a.default=uo.parse(a.default?a.default:o.default)),a.colorSpace&&"rgb"!==a.colorSpace&&!yn[a.colorSpace])throw new Error(`Unknown color space: ${a.colorSpace}`);let v,w,T;if("exponential"===b)v=Ia;else if("interval"===b)v=Ed;else if("categorical"===b){v=l_,w=Object.create(null);for(const E of a.stops)w[E[0]]=E[1];T=typeof a.stops[0][0]}else{if("identity"!==b)throw new Error(`Unknown function type "${b}"`);v=c_}if(u){const E={},A=[];for(let N=0;N<a.stops.length;N++){const B=a.stops[N],$=B[0].zoom;void 0===E[$]&&(E[$]={zoom:$,type:a.type,property:a.property,default:a.default,stops:[]},A.push($)),E[$].stops.push([B[0].value,B[1]])}const P=[];for(const N of A)P.push([E[N].zoom,tf(E[N],o)]);const L={name:"linear"};return{kind:"composite",interpolationType:L,interpolationFactor:no.interpolationFactor.bind(void 0,L),zoomStops:P.map(N=>N[0]),evaluate:({zoom:N},B)=>Ia({stops:P,base:a.base},o,N).evaluate(N,B)}}if(f){const E="exponential"===b?{name:"exponential",base:void 0!==a.base?a.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:no.interpolationFactor.bind(void 0,E),zoomStops:a.stops.map(A=>A[0]),evaluate:({zoom:A})=>v(a,o,A,w,T)}}return{kind:"source",evaluate(E,A){const P=A&&A.properties?A.properties[a.property]:void 0;return void 0===P?Td(a.default,o.default):v(a,o,P,w,T)}}}function Td(a,o,l){return void 0!==a?a:void 0!==o?o:void 0!==l?l:void 0}function l_(a,o,l,u,f){return Td(typeof l===f?u[l]:void 0,a.default,o.default)}function Ed(a,o,l){if("number"!==Zi(l))return Td(a.default,o.default);const u=a.stops.length;if(1===u||l<=a.stops[0][0])return a.stops[0][1];if(l>=a.stops[u-1][0])return a.stops[u-1][1];const f=vn(a.stops.map(b=>b[0]),l);return a.stops[f][1]}function Ia(a,o,l){const u=void 0!==a.base?a.base:1;if("number"!==Zi(l))return Td(a.default,o.default);const f=a.stops.length;if(1===f||l<=a.stops[0][0])return a.stops[0][1];if(l>=a.stops[f-1][0])return a.stops[f-1][1];const b=vn(a.stops.map(A=>A[0]),l),v=function(A,P,L,N){const B=N-L,$=A-L;return 0===B?0:1===P?$/B:(Math.pow(P,$)-1)/(Math.pow(P,B)-1)}(l,u,a.stops[b][0],a.stops[b+1][0]),w=a.stops[b][1],T=a.stops[b+1][1];let E=xn[o.type]||a_;if(a.colorSpace&&"rgb"!==a.colorSpace){const A=yn[a.colorSpace];E=(P,L)=>A.reverse(A.interpolate(A.forward(P),A.forward(L),v))}return"function"==typeof w.evaluate?{evaluate(...A){const P=w.evaluate.apply(void 0,A),L=T.evaluate.apply(void 0,A);if(void 0!==P&&void 0!==L)return E(P,L,v)}}:E(w,T,v)}function c_(a,o,l){return"color"===o.type?l=uo.parse(l):"formatted"===o.type?l=Gs.fromString(l.toString()):"resolvedImage"===o.type?l=wa.fromString(l.toString()):Zi(l)===o.type||"enum"===o.type&&o.values[l]||(l=void 0),Td(l,a.default,o.default)}class nf{constructor(o,l){var u;this.expression=o,this._warningHistory={},this._evaluator=new Xp,this._defaultValue=l?"color"===(u=l).type&&(Fh(u.default)||Array.isArray(u.default))?new uo(0,0,0,0):"color"===u.type?uo.parse(u.default)||null:void 0===u.default?null:u.default:null,this._enumValues=l&&"enum"===l.type?l.values:null}evaluateWithoutErrorHandling(o,l,u,f,b,v,w,T){return this._evaluator.globals=o,this._evaluator.feature=l,this._evaluator.featureState=u,this._evaluator.canonical=f||null,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=v,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=T||null,this.expression.evaluate(this._evaluator)}evaluate(o,l,u,f,b,v,w,T){this._evaluator.globals=o,this._evaluator.feature=l||null,this._evaluator.featureState=u||null,this._evaluator.canonical=f||null,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=v||null,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=T||null;try{const E=this.expression.evaluate(this._evaluator);if(null==E||"number"==typeof E&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new ci(`Expected value to be one of ${Object.keys(this._enumValues).map(A=>JSON.stringify(A)).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,"undefined"!=typeof console&&console.warn(E.message)),this._defaultValue}}}function Dd(a){return Array.isArray(a)&&a.length>0&&"string"==typeof a[0]&&a[0]in Oh}function la(a,o){const l=new Lc(Oh,[],o?function(f){const b={color:fs,string:xi,number:un,enum:xi,boolean:Cn,formatted:Ni,resolvedImage:Hn};return"array"===f.type?As(b[f.value]||mi,f.length):b[f.type]}(o):void 0),u=l.parse(a,void 0,void 0,void 0,o&&"string"===o.type?{typeAnnotation:"coerce"}:void 0);return u?s_(new nf(u,o)):wu(l.errors)}class rf{constructor(o,l){this.kind=o,this._styleExpression=l,this.isStateDependent="constant"!==o&&!aa(l.expression)}evaluateWithoutErrorHandling(o,l,u,f,b,v){return this._styleExpression.evaluateWithoutErrorHandling(o,l,u,f,b,v)}evaluate(o,l,u,f,b,v){return this._styleExpression.evaluate(o,l,u,f,b,v)}}class cr{constructor(o,l,u,f){this.kind=o,this.zoomStops=u,this._styleExpression=l,this.isStateDependent="camera"!==o&&!aa(l.expression),this.interpolationType=f}evaluateWithoutErrorHandling(o,l,u,f,b,v){return this._styleExpression.evaluateWithoutErrorHandling(o,l,u,f,b,v)}evaluate(o,l,u,f,b,v){return this._styleExpression.evaluate(o,l,u,f,b,v)}interpolationFactor(o,l,u){return this.interpolationType?no.interpolationFactor(this.interpolationType,o,l,u):0}}function Su(a,o){if("error"===(a=la(a,o)).result)return a;const l=a.value.expression,u=$i(l);if(!u&&!Cd(o))return wu([new Ya("","data expressions not supported")]);const f=xl(l,["zoom","pitch","distance-from-center"]);if(!f&&!Jp(o))return wu([new Ya("","zoom expressions not supported")]);const b=Bh(l);return b||f?b instanceof Ya?wu([b]):b instanceof no&&!ef(o)?wu([new Ya("",'"interpolate" expressions cannot be used with this property')]):s_(b?new cr(u?"camera":"composite",a.value,b.labels,b instanceof no?b.interpolation:void 0):new rf(u?"constant":"source",a.value)):wu([new Ya("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Nh{constructor(o,l){this._parameters=o,this._specification=l,yl(this,tf(this._parameters,this._specification))}static deserialize(o){return new Nh(o._parameters,o._specification)}static serialize(o){return{_parameters:o._parameters,_specification:o._specification}}}function Bh(a){let o=null;if(a instanceof Xr)o=Bh(a.result);else if(a instanceof yo){for(const l of a.args)if(o=Bh(l),o)break}else(a instanceof kh||a instanceof no)&&a.input instanceof Ka&&"zoom"===a.input.name&&(o=a);return o instanceof Ya||a.eachChild(l=>{const u=Bh(l);u instanceof Ya?o=u:!o&&u?o=new Ya("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):o&&u&&o!==u&&(o=new Ya("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),o}class pn{constructor(o,l,u,f){this.message=(o?`${o}: `:"")+u,f&&(this.identifier=f),null!=l&&l.__line__&&(this.line=l.__line__)}}function ca(a){const o=a.key,l=a.value,u=a.valueSpec||{},f=a.objectElementValidators||{},b=a.style,v=a.styleSpec;let w=[];const T=Zi(l);if("object"!==T)return[new pn(o,l,`object expected, ${T} found`)];for(const E in l){const A=E.split(".")[0];let P;f[A]?P=f[A]:u[A]?P=At:f["*"]?P=f["*"]:u["*"]&&(P=At),P?w=w.concat(P({key:(o&&`${o}.`)+E,value:l[E],valueSpec:u[A]||u["*"],style:b,styleSpec:v,object:l,objectKey:E},l)):w.push(new pn(o,l[E],`unknown property "${E}"`))}for(const E in u)f[E]||u[E].required&&void 0===u[E].default&&void 0===l[E]&&w.push(new pn(o,l,`missing required property "${E}"`));return w}function $m(a){const o=a.value,l=a.valueSpec,u=a.style,f=a.styleSpec,b=a.key,v=a.arrayElementValidator||At;if("array"!==Zi(o))return[new pn(b,o,`array expected, ${Zi(o)} found`)];if(l.length&&o.length!==l.length)return[new pn(b,o,`array length ${l.length} expected, length ${o.length} found`)];if(l["min-length"]&&o.length<l["min-length"])return[new pn(b,o,`array length at least ${l["min-length"]} expected, length ${o.length} found`)];let w={type:l.value,values:l.values,minimum:l.minimum,maximum:l.maximum,function:void 0};f.$version<7&&(w.function=l.function),"object"===Zi(l.value)&&(w=l.value);let T=[];for(let E=0;E<o.length;E++)T=T.concat(v({array:o,arrayIndex:E,value:o[E],valueSpec:w,style:u,styleSpec:f,key:`${b}[${E}]`}));return T}function Vc(a){const o=a.key,l=a.value,u=a.valueSpec;let f=Zi(l);if("number"===f&&l!=l&&(f="NaN"),"number"!==f)return[new pn(o,l,`number expected, ${f} found`)];if("minimum"in u){let b=u.minimum;if("array"===Zi(u.minimum)&&(b=u.minimum[a.arrayIndex]),l<b)return[new pn(o,l,`${l} is less than the minimum value ${b}`)]}if("maximum"in u){let b=u.maximum;if("array"===Zi(u.maximum)&&(b=u.maximum[a.arrayIndex]),l>b)return[new pn(o,l,`${l} is greater than the maximum value ${b}`)]}return[]}function Id(a){const o=a.valueSpec,l=co(a.value.type);let u,f,b,v={};const w="categorical"!==l&&void 0===a.value.property,T=!w,E="array"===Zi(a.value.stops)&&"array"===Zi(a.value.stops[0])&&"object"===Zi(a.value.stops[0][0]),A=ca({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(N){if("identity"===l)return[new pn(N.key,N.value,'identity function may not have a "stops" property')];let B=[];const $=N.value;return B=B.concat($m({key:N.key,value:$,valueSpec:N.valueSpec,style:N.style,styleSpec:N.styleSpec,arrayElementValidator:P})),"array"===Zi($)&&0===$.length&&B.push(new pn(N.key,$,"array must have at least one stop")),B},default:function(N){return At({key:N.key,value:N.value,valueSpec:o,style:N.style,styleSpec:N.styleSpec})}}});return"identity"===l&&w&&A.push(new pn(a.key,a.value,'missing required property "property"')),"identity"===l||a.value.stops||A.push(new pn(a.key,a.value,'missing required property "stops"')),"exponential"===l&&a.valueSpec.expression&&!ef(a.valueSpec)&&A.push(new pn(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(T&&!Cd(a.valueSpec)?A.push(new pn(a.key,a.value,"property functions not supported")):w&&!Jp(a.valueSpec)&&A.push(new pn(a.key,a.value,"zoom functions not supported"))),"categorical"!==l&&!E||void 0!==a.value.property||A.push(new pn(a.key,a.value,'"property" property is required')),A;function P(N){let B=[];const $=N.value,K=N.key;if("array"!==Zi($))return[new pn(K,$,`array expected, ${Zi($)} found`)];if(2!==$.length)return[new pn(K,$,`array length 2 expected, length ${$.length} found`)];if(E){if("object"!==Zi($[0]))return[new pn(K,$,`object expected, ${Zi($[0])} found`)];if(void 0===$[0].zoom)return[new pn(K,$,"object stop key must have zoom")];if(void 0===$[0].value)return[new pn(K,$,"object stop key must have value")];const ce=co($[0].zoom);if("number"!=typeof ce)return[new pn(K,$[0].zoom,"stop zoom values must be numbers")];if(b&&b>ce)return[new pn(K,$[0].zoom,"stop zoom values must appear in ascending order")];ce!==b&&(b=ce,f=void 0,v={}),B=B.concat(ca({key:`${K}[0]`,value:$[0],valueSpec:{zoom:{}},style:N.style,styleSpec:N.styleSpec,objectElementValidators:{zoom:Vc,value:L}}))}else B=B.concat(L({key:`${K}[0]`,value:$[0],valueSpec:{},style:N.style,styleSpec:N.styleSpec},$));return Dd(Ro($[1]))?B.concat([new pn(`${K}[1]`,$[1],"expressions are not allowed in function stops.")]):B.concat(At({key:`${K}[1]`,value:$[1],valueSpec:o,style:N.style,styleSpec:N.styleSpec}))}function L(N,B){const $=Zi(N.value),K=co(N.value),ce=null!==N.value?N.value:B;if(u){if($!==u)return[new pn(N.key,ce,`${$} stop domain type must match previous stop domain type ${u}`)]}else u=$;if("number"!==$&&"string"!==$&&"boolean"!==$&&"number"!=typeof K&&"string"!=typeof K&&"boolean"!=typeof K)return[new pn(N.key,ce,"stop domain value must be a number, string, or boolean")];if("number"!==$&&"categorical"!==l){let Ce=`number expected, ${$} found`;return Cd(o)&&void 0===l&&(Ce+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new pn(N.key,ce,Ce)]}return"categorical"!==l||"number"!==$||"number"==typeof K&&isFinite(K)&&Math.floor(K)===K?"categorical"!==l&&"number"===$&&"number"==typeof K&&"number"==typeof f&&void 0!==f&&K<f?[new pn(N.key,ce,"stop domain values must appear in ascending order")]:(f=K,"categorical"===l&&K in v?[new pn(N.key,ce,"stop domain values must be unique")]:(v[K]=!0,[])):[new pn(N.key,ce,`integer expected, found ${String(K)}`)]}}function Dr(a){const o=("property"===a.expressionContext?Su:la)(Ro(a.value),a.valueSpec);if("error"===o.result)return o.value.map(u=>new pn(`${a.key}${u.key}`,a.value,u.message));const l=o.value.expression||o.value._styleExpression.expression;if("property"===a.expressionContext&&"text-font"===a.propertyKey&&!l.outputDefined())return[new pn(a.key,a.value,`Invalid data expression for "${a.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===a.expressionContext&&"layout"===a.propertyType&&!aa(l))return[new pn(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===a.expressionContext)return jc(l,a);if(a.expressionContext&&0===a.expressionContext.indexOf("cluster")){if(!xl(l,["zoom","feature-state"]))return[new pn(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===a.expressionContext&&!$i(l))return[new pn(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function jc(a,o){const l=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(o.valueSpec&&o.valueSpec.expression)for(const f of o.valueSpec.expression.parameters)l.delete(f);if(0===l.size)return[];const u=[];return a instanceof Ka&&l.has(a.name)?[new pn(o.key,o.value,`["${a.name}"] expression is not supported in a filter for a ${o.object.type} layer with id: ${o.object.id}`)]:(a.eachChild(f=>{u.push(...jc(f,o))}),u)}function zh(a){const o=a.key,l=a.value,u=a.valueSpec,f=[];return Array.isArray(u.values)?-1===u.values.indexOf(co(l))&&f.push(new pn(o,l,`expected one of [${u.values.join(", ")}], ${JSON.stringify(l)} found`)):-1===Object.keys(u.values).indexOf(co(l))&&f.push(new pn(o,l,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(l)} found`)),f}function Md(a){if(!0===a||!1===a)return!0;if(!Array.isArray(a)||0===a.length)return!1;switch(a[0]){case"has":return a.length>=2&&"$id"!==a[1]&&"$type"!==a[1];case"in":return a.length>=3&&("string"!=typeof a[1]||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==a.length||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const o of a.slice(1))if(!Md(o)&&"boolean"!=typeof o)return!1;return!0;default:return!0}}function Vh(a,o="fill"){if(null==a)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Md(a)||(a=Tu(a));const l=a;let u=!0;try{u=function(E){if(!Cu(E))return E;let A=Ro(E);return Zr(A),A=u_(A),A}(l)}catch(E){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(l,null,2)}\n        `)}const f=bt[`filter_${o}`],b=la(u,f);let v=null;if("error"===b.result)throw new Error(b.value.map(E=>`${E.key}: ${E.message}`).join(", "));v=(E,A,P)=>b.value.evaluate(E,A,{},P);let w=null,T=null;if(u!==l){const E=la(l,f);if("error"===E.result)throw new Error(E.value.map(A=>`${A.key}: ${A.message}`).join(", "));w=(A,P,L,N,B)=>E.value.evaluate(A,P,{},L,void 0,void 0,N,B),T=!$i(E.value.expression)}return{filter:v,dynamicFilter:w||void 0,needGeometry:Os(u),needFeature:!!T}}function u_(a){if(!Array.isArray(a))return a;const o=function(l){if(Gm.has(l[0]))for(let u=1;u<l.length;u++)if(Cu(l[u]))return!0;return l}(a);return!0===o?o:o.map(l=>u_(l))}function Zr(a){let o=!1;const l=[];if("case"===a[0]){for(let u=1;u<a.length-1;u+=2)o=o||Cu(a[u]),l.push(a[u+1]);l.push(a[a.length-1])}else if("match"===a[0]){o=o||Cu(a[1]);for(let u=2;u<a.length-1;u+=2)l.push(a[u+1]);l.push(a[a.length-1])}else if("step"===a[0]){o=o||Cu(a[1]);for(let u=1;u<a.length-1;u+=2)l.push(a[u+1])}o&&(a.length=0,a.push("any",...l));for(let u=1;u<a.length;u++)Zr(a[u])}function Cu(a){if(!Array.isArray(a))return!1;if("pitch"===(o=a[0])||"distance-from-center"===o)return!0;var o;for(let l=1;l<a.length;l++)if(Cu(a[l]))return!0;return!1}const Gm=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function jh(a,o){return a<o?-1:a>o?1:0}function Os(a){if(!Array.isArray(a))return!1;if("within"===a[0])return!0;for(let o=1;o<a.length;o++)if(Os(a[o]))return!0;return!1}function Tu(a){if(!a)return!0;const o=a[0];return a.length<=1?"any"!==o:"=="===o?Ad(a[1],a[2],"=="):"!="===o?Uh(Ad(a[1],a[2],"==")):"<"===o||">"===o||"<="===o||">="===o?Ad(a[1],a[2],o):"any"===o?(l=a.slice(1),["any"].concat(l.map(Tu))):"all"===o?["all"].concat(a.slice(1).map(Tu)):"none"===o?["all"].concat(a.slice(1).map(Tu).map(Uh)):"in"===o?ec(a[1],a.slice(2)):"!in"===o?Uh(ec(a[1],a.slice(2))):"has"===o?ys(a[1]):"!has"===o?Uh(ys(a[1])):"within"!==o||a;var l}function Ad(a,o,l){switch(a){case"$type":return[`filter-type-${l}`,o];case"$id":return[`filter-id-${l}`,o];default:return[`filter-${l}`,a,o]}}function ec(a,o){if(0===o.length)return!1;switch(a){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(l=>typeof l!=typeof o[0])?["filter-in-large",a,["literal",o.sort(jh)]]:["filter-in-small",a,["literal",o]]}}function ys(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function Uh(a){return["!",a]}function tc(a){return Md(Ro(a.value))?Dr(yl({},a,{expressionContext:"filter",valueSpec:a.styleSpec[`filter_${a.layerType||"fill"}`]})):kd(a)}function kd(a){const o=a.value,l=a.key;if("array"!==Zi(o))return[new pn(l,o,`array expected, ${Zi(o)} found`)];const u=a.styleSpec;let f,b=[];if(o.length<1)return[new pn(l,o,"filter array must have at least 1 element")];switch(b=b.concat(zh({key:`${l}[0]`,value:o[0],valueSpec:u.filter_operator,style:a.style,styleSpec:a.styleSpec})),co(o[0])){case"<":case"<=":case">":case">=":o.length>=2&&"$type"===co(o[1])&&b.push(new pn(l,o,`"$type" cannot be use with operator "${o[0]}"`));case"==":case"!=":3!==o.length&&b.push(new pn(l,o,`filter array for operator "${o[0]}" must have 3 elements`));case"in":case"!in":o.length>=2&&(f=Zi(o[1]),"string"!==f&&b.push(new pn(`${l}[1]`,o[1],`string expected, ${f} found`)));for(let v=2;v<o.length;v++)f=Zi(o[v]),"$type"===co(o[1])?b=b.concat(zh({key:`${l}[${v}]`,value:o[v],valueSpec:u.geometry_type,style:a.style,styleSpec:a.styleSpec})):"string"!==f&&"number"!==f&&"boolean"!==f&&b.push(new pn(`${l}[${v}]`,o[v],`string, number, or boolean expected, ${f} found`));break;case"any":case"all":case"none":for(let v=1;v<o.length;v++)b=b.concat(kd({key:`${l}[${v}]`,value:o[v],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":f=Zi(o[1]),2!==o.length?b.push(new pn(l,o,`filter array for "${o[0]}" operator must have 2 elements`)):"string"!==f&&b.push(new pn(`${l}[1]`,o[1],`string expected, ${f} found`));break;case"within":f=Zi(o[1]),2!==o.length?b.push(new pn(l,o,`filter array for "${o[0]}" operator must have 2 elements`)):"object"!==f&&b.push(new pn(`${l}[1]`,o[1],`object expected, ${f} found`))}return b}function tl(a,o){const l=a.key,u=a.style,f=a.styleSpec,b=a.value,v=a.objectKey,w=f[`${o}_${a.layerType}`];if(!w)return[];const T=v.match(/^(.*)-transition$/);if("paint"===o&&T&&w[T[1]]&&w[T[1]].transition)return At({key:l,value:b,valueSpec:f.transition,style:u,styleSpec:f});const E=a.valueSpec||w[v];if(!E)return[new pn(l,b,`unknown property "${v}"`)];let A;if("string"===Zi(b)&&Cd(E)&&!E.tokens&&(A=/^{([^}]+)}$/.exec(b))){const L=`\`{ "type": "identity", "property": ${A?JSON.stringify(A[1]):'"_"'} }\``;return[new pn(l,b,`"${v}" does not support interpolation syntax\nUse an identity property function instead: ${L}.`)]}const P=[];return"symbol"===a.layerType&&("text-field"===v&&u&&!u.glyphs&&P.push(new pn(l,b,'use of "text-field" requires a style "glyphs" property')),"text-font"===v&&Fh(Ro(b))&&"identity"===co(b.type)&&P.push(new pn(l,b,'"text-font" does not support identity functions'))),P.concat(At({key:a.key,value:b,valueSpec:E,style:u,styleSpec:f,expressionContext:"property",propertyType:o,propertyKey:v}))}function sf(a){return tl(a,"paint")}function Rd(a){return tl(a,"layout")}function di(a){let o=[];const l=a.value,u=a.key,f=a.style,b=a.styleSpec;l.type||l.ref||o.push(new pn(u,l,'either "type" or "ref" is required'));let v=co(l.type);const w=co(l.ref);if(l.id){const T=co(l.id);for(let E=0;E<a.arrayIndex;E++){const A=f.layers[E];co(A.id)===T&&o.push(new pn(u,l.id,`duplicate layer id "${l.id}", previously used at line ${A.id.__line__}`))}}if("ref"in l){let T;["type","source","source-layer","filter","layout"].forEach(E=>{E in l&&o.push(new pn(u,l[E],`"${E}" is prohibited for ref layers`))}),f.layers.forEach(E=>{co(E.id)===w&&(T=E)}),T?T.ref?o.push(new pn(u,l.ref,"ref cannot reference another ref layer")):v=co(T.type):"string"==typeof w&&o.push(new pn(u,l.ref,`ref layer "${w}" not found`))}else if("background"!==v&&"sky"!==v)if(l.source){const T=f.sources&&f.sources[l.source],E=T&&co(T.type);T?"vector"===E&&"raster"===v?o.push(new pn(u,l.source,`layer "${l.id}" requires a raster source`)):"raster"===E&&"raster"!==v?o.push(new pn(u,l.source,`layer "${l.id}" requires a vector source`)):"vector"!==E||l["source-layer"]?"raster-dem"===E&&"hillshade"!==v?o.push(new pn(u,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==v||!l.paint||!l.paint["line-gradient"]&&!l.paint["line-trim-offset"]||"geojson"===E&&T.lineMetrics||o.push(new pn(u,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):o.push(new pn(u,l,`layer "${l.id}" must specify a "source-layer"`)):o.push(new pn(u,l.source,`source "${l.source}" not found`))}else o.push(new pn(u,l,'missing required property "source"'));return o=o.concat(ca({key:u,value:l,valueSpec:b.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":()=>[],type:()=>At({key:`${u}.type`,value:l.type,valueSpec:b.layer.type,style:a.style,styleSpec:a.styleSpec,object:l,objectKey:"type"}),filter:T=>tc(yl({layerType:v},T)),layout:T=>ca({layer:l,key:T.key,value:T.value,valueSpec:{},style:T.style,styleSpec:T.styleSpec,objectElementValidators:{"*":E=>Rd(yl({layerType:v},E))}}),paint:T=>ca({layer:l,key:T.key,value:T.value,valueSpec:{},style:T.style,styleSpec:T.styleSpec,objectElementValidators:{"*":E=>sf(yl({layerType:v},E))}})}})),o}function Cl(a){const o=a.value,l=a.key,u=Zi(o);return"string"!==u?[new pn(l,o,`string expected, ${u} found`)]:[]}const d_={promoteId:function({key:a,value:o}){if("string"===Zi(o))return Cl({key:a,value:o});{const l=[];for(const u in o)l.push(...Cl({key:`${a}.${u}`,value:o[u]}));return l}}};function qm(a){const o=a.value,l=a.key,u=a.styleSpec,f=a.style;if(!o.type)return[new pn(l,o,'"type" is required')];const b=co(o.type);let v;switch(b){case"vector":case"raster":case"raster-dem":return v=ca({key:l,value:o,valueSpec:u[`source_${b.replace("-","_")}`],style:a.style,styleSpec:u,objectElementValidators:d_}),v;case"geojson":if(v=ca({key:l,value:o,valueSpec:u.source_geojson,style:f,styleSpec:u,objectElementValidators:d_}),o.cluster)for(const w in o.clusterProperties){const[T,E]=o.clusterProperties[w],A="string"==typeof T?[T,["accumulated"],["get",w]]:T;v.push(...Dr({key:`${l}.${w}.map`,value:E,expressionContext:"cluster-map"})),v.push(...Dr({key:`${l}.${w}.reduce`,value:A,expressionContext:"cluster-reduce"}))}return v;case"video":return ca({key:l,value:o,valueSpec:u.source_video,style:f,styleSpec:u});case"image":return ca({key:l,value:o,valueSpec:u.source_image,style:f,styleSpec:u});case"canvas":return[new pn(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return zh({key:`${l}.type`,value:o.type,valueSpec:{values:h_(u)},style:f,styleSpec:u})}}function h_(a){return a.source.reduce((o,l)=>{const u=a[l];return"enum"===u.type.type&&(o=o.concat(Object.keys(u.type.values))),o},[])}function Wm(a){const o=a.value,l=a.styleSpec,u=l.light,f=a.style;let b=[];const v=Zi(o);if(void 0===o)return b;if("object"!==v)return b=b.concat([new pn("light",o,`object expected, ${v} found`)]),b;for(const w in o){const T=w.match(/^(.*)-transition$/);b=b.concat(T&&u[T[1]]&&u[T[1]].transition?At({key:w,value:o[w],valueSpec:l.transition,style:f,styleSpec:l}):u[w]?At({key:w,value:o[w],valueSpec:u[w],style:f,styleSpec:l}):[new pn(w,o[w],`unknown property "${w}"`)])}return b}function Hh(a){const o=a.value,l=a.key,u=a.style,f=a.styleSpec,b=f.terrain;let v=[];const w=Zi(o);if(void 0===o)return v;if("object"!==w)return v=v.concat([new pn("terrain",o,`object expected, ${w} found`)]),v;for(const T in o){const E=T.match(/^(.*)-transition$/);v=v.concat(E&&b[E[1]]&&b[E[1]].transition?At({key:T,value:o[T],valueSpec:f.transition,style:u,styleSpec:f}):b[T]?At({key:T,value:o[T],valueSpec:b[T],style:u,styleSpec:f}):[new pn(T,o[T],`unknown property "${T}"`)])}if(o.source){const T=u.sources&&u.sources[o.source],E=T&&co(T.type);T?"raster-dem"!==E&&v.push(new pn(l,o.source,`terrain cannot be used with a source of type ${String(E)}, it only be used with a "raster-dem" source type`)):v.push(new pn(l,o.source,`source "${o.source}" not found`))}else v.push(new pn(l,o,'terrain is missing required property "source"'));return v}function Xm(a){const o=a.value,l=a.style,u=a.styleSpec,f=u.fog;let b=[];const v=Zi(o);if(void 0===o)return b;if("object"!==v)return b=b.concat([new pn("fog",o,`object expected, ${v} found`)]),b;for(const w in o){const T=w.match(/^(.*)-transition$/);b=b.concat(T&&f[T[1]]&&f[T[1]].transition?At({key:w,value:o[w],valueSpec:u.transition,style:l,styleSpec:u}):f[w]?At({key:w,value:o[w],valueSpec:f[w],style:l,styleSpec:u}):[new pn(w,o[w],`unknown property "${w}"`)])}return b}const Zm={"*":()=>[],array:$m,boolean:function(a){const o=a.value,l=a.key,u=Zi(o);return"boolean"!==u?[new pn(l,o,`boolean expected, ${u} found`)]:[]},number:Vc,color:function(a){const o=a.key,l=a.value,u=Zi(l);return"string"!==u?[new pn(o,l,`color expected, ${u} found`)]:null===qp(l)?[new pn(o,l,`color expected, "${l}" found`)]:[]},enum:zh,filter:tc,function:Id,layer:di,object:ca,source:qm,light:Wm,terrain:Hh,fog:Xm,string:Cl,formatted:function(a){return 0===Cl(a).length?[]:Dr(a)},resolvedImage:function(a){return 0===Cl(a).length?[]:Dr(a)},projection:function(a){const o=a.value,l=a.styleSpec,u=l.projection,f=a.style;let b=[];const v=Zi(o);if("object"===v)for(const w in o)b=b.concat(At({key:w,value:o[w],valueSpec:u[w],style:f,styleSpec:l}));else"string"!==v&&(b=b.concat([new pn("projection",o,`object or string expected, ${v} found`)]));return b}};function At(a){const o=a.value,l=a.valueSpec,u=a.styleSpec;return l.expression&&Fh(co(o))?Id(a):l.expression&&Dd(Ro(o))?Dr(a):l.type&&Zm[l.type]?Zm[l.type](a):ca(yl({},a,{valueSpec:l.type?u[l.type]:l}))}function tr(a){const o=a.value,l=a.key,u=Cl(a);return u.length||(-1===o.indexOf("{fontstack}")&&u.push(new pn(l,o,'"glyphs" url must include a "{fontstack}" token')),-1===o.indexOf("{range}")&&u.push(new pn(l,o,'"glyphs" url must include a "{range}" token'))),u}function Mi(a,o=bt){return Xs(At({key:"",value:a,valueSpec:o.$root,styleSpec:o,style:a,objectElementValidators:{glyphs:tr,"*":()=>[]}}))}const Ai=a=>Xs(sf(a)),Co=a=>Xs(Rd(a));function Xs(a){return a.slice().sort((o,l)=>o.line&&l.line?o.line-l.line:0)}function Eu(a,o){let l=!1;if(o&&o.length)for(const u of o)a.fire(new Za(new Error(u.message))),l=!0;return l}var nl=ua;function ua(a,o,l){var u=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var f=new Int32Array(this.arrayBuffer);a=f[0],this.d=(o=f[1])+2*(l=f[2]);for(var b=0;b<this.d*this.d;b++){var v=f[3+b],w=f[3+b+1];u.push(v===w?null:f.subarray(v,w))}var T=f[3+u.length+1];this.keys=f.subarray(f[3+u.length],T),this.bboxes=f.subarray(T),this.insert=this._insertReadonly}else{this.d=o+2*l;for(var E=0;E<this.d*this.d;E++)u.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=a,this.padding=l,this.scale=o/a,this.uid=0;var A=l/o*a;this.min=-A,this.max=a+A}ua.prototype.insert=function(a,o,l,u,f){this._forEachCell(o,l,u,f,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(o),this.bboxes.push(l),this.bboxes.push(u),this.bboxes.push(f)},ua.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ua.prototype._insertCell=function(a,o,l,u,f,b){this.cells[f].push(b)},ua.prototype.query=function(a,o,l,u,f){var b=this.min,v=this.max;if(a<=b&&o<=b&&v<=l&&v<=u&&!f)return Array.prototype.slice.call(this.keys);var w=[];return this._forEachCell(a,o,l,u,this._queryCell,w,{},f),w},ua.prototype._queryCell=function(a,o,l,u,f,b,v,w){var T=this.cells[f];if(null!==T)for(var E=this.keys,A=this.bboxes,P=0;P<T.length;P++){var L=T[P];if(void 0===v[L]){var N=4*L;(w?w(A[N+0],A[N+1],A[N+2],A[N+3]):a<=A[N+2]&&o<=A[N+3]&&l>=A[N+0]&&u>=A[N+1])?(v[L]=!0,b.push(E[L])):v[L]=!1}}},ua.prototype._forEachCell=function(a,o,l,u,f,b,v,w){for(var T=this._convertToCellCoord(a),E=this._convertToCellCoord(o),A=this._convertToCellCoord(l),P=this._convertToCellCoord(u),L=T;L<=A;L++)for(var N=E;N<=P;N++){var B=this.d*N+L;if((!w||w(this._convertFromCellCoord(L),this._convertFromCellCoord(N),this._convertFromCellCoord(L+1),this._convertFromCellCoord(N+1)))&&f.call(this,a,o,l,u,B,b,v,w))return}},ua.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},ua.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},ua.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,o=3+this.cells.length+1+1,l=0,u=0;u<this.cells.length;u++)l+=this.cells[u].length;var f=new Int32Array(o+l+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;for(var b=o,v=0;v<a.length;v++){var w=a[v];f[3+v]=b,f.set(w,b),b+=w.length}return f[3+a.length]=b,f.set(this.keys,b),f[3+a.length+1]=b+=this.keys.length,f.set(this.bboxes,b),b+=this.bboxes.length,f.buffer};var Du=_n(nl);const $h={};function gn(a,o,l={}){Object.defineProperty(a,"_classRegistryKey",{value:o,writeable:!1}),$h[o]={klass:a,omit:l.omit||[]}}gn(Object,"Object"),Du.serialize=function(a,o){const l=a.toArrayBuffer();return o&&o.push(l),{buffer:l}},Du.deserialize=function(a){return new Du(a.buffer)},Object.defineProperty(Du,"name",{value:"Grid"}),gn(Du,"Grid"),gn(uo,"Color"),gn(Error,"Error"),gn(ql,"AJAXError"),gn(wa,"ResolvedImage"),gn(Nh,"StylePropertyFunction"),gn(nf,"StyleExpression",{omit:["_evaluator"]}),gn(cr,"ZoomDependentExpression"),gn(rf,"ZoomConstantExpression"),gn(Ka,"CompoundExpression",{omit:["_evaluate"]});for(const a in Oh)$h[Oh[a]._classRegistryKey]||gn(Oh[a],`Expression${a}`);function Gh(a){return a&&"undefined"!=typeof ArrayBuffer&&(a instanceof ArrayBuffer||a.constructor&&"ArrayBuffer"===a.constructor.name)}function jo(a){return te.ImageBitmap&&a instanceof te.ImageBitmap}function Fs(a,o){if(null==a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(Gh(a)||jo(a))return o&&o.push(a),a;if(ArrayBuffer.isView(a)){const l=a;return o&&o.push(l.buffer),l}if(a instanceof te.ImageData)return o&&o.push(a.data.buffer),a;if(Array.isArray(a)){const l=[];for(const u of a)l.push(Fs(u,o));return l}if("object"==typeof a){const l=a.constructor,u=l._classRegistryKey;if(!u)throw new Error(`can't serialize object of unregistered class ${u}`);const f=l.serialize?l.serialize(a,o):{};if(!l.serialize){for(const b in a)a.hasOwnProperty(b)&&($h[u].omit.indexOf(b)>=0||(f[b]=Fs(a[b],o)));a instanceof Error&&(f.message=a.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==u&&(f.$name=u),f}throw new Error("can't serialize object of type "+typeof a)}function nc(a){if(null==a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||Gh(a)||jo(a)||ArrayBuffer.isView(a)||a instanceof te.ImageData)return a;if(Array.isArray(a))return a.map(nc);if("object"==typeof a){const o=a.$name||"Object",{klass:l}=$h[o];if(!l)throw new Error(`can't deserialize unregistered class ${o}`);if(l.deserialize)return l.deserialize(a);const u=Object.create(l.prototype);for(const f of Object.keys(a))"$name"!==f&&(u[f]=nc(a[f]));return u}throw new Error("can't deserialize object of type "+typeof a)}const on_Latin_1_Supplement=a=>a>=128&&a<=255,on_Arabic=a=>a>=1536&&a<=1791,on_Arabic_Supplement=a=>a>=1872&&a<=1919,on_Arabic_Extended_A=a=>a>=2208&&a<=2303,on_Hangul_Jamo=a=>a>=4352&&a<=4607,on_Unified_Canadian_Aboriginal_Syllabics=a=>a>=5120&&a<=5759,on_Khmer=a=>a>=6016&&a<=6143,on_Unified_Canadian_Aboriginal_Syllabics_Extended=a=>a>=6320&&a<=6399,on_General_Punctuation=a=>a>=8192&&a<=8303,on_Letterlike_Symbols=a=>a>=8448&&a<=8527,on_Number_Forms=a=>a>=8528&&a<=8591,on_Miscellaneous_Technical=a=>a>=8960&&a<=9215,on_Control_Pictures=a=>a>=9216&&a<=9279,on_Optical_Character_Recognition=a=>a>=9280&&a<=9311,on_Enclosed_Alphanumerics=a=>a>=9312&&a<=9471,on_Geometric_Shapes=a=>a>=9632&&a<=9727,on_Miscellaneous_Symbols=a=>a>=9728&&a<=9983,on_Miscellaneous_Symbols_and_Arrows=a=>a>=11008&&a<=11263,on_CJK_Radicals_Supplement=a=>a>=11904&&a<=12031,on_Kangxi_Radicals=a=>a>=12032&&a<=12255,on_Ideographic_Description_Characters=a=>a>=12272&&a<=12287,on_CJK_Symbols_and_Punctuation=a=>a>=12288&&a<=12351,on_Hiragana=a=>a>=12352&&a<=12447,on_Katakana=a=>a>=12448&&a<=12543,on_Bopomofo=a=>a>=12544&&a<=12591,on_Hangul_Compatibility_Jamo=a=>a>=12592&&a<=12687,on_Kanbun=a=>a>=12688&&a<=12703,on_Bopomofo_Extended=a=>a>=12704&&a<=12735,on_CJK_Strokes=a=>a>=12736&&a<=12783,on_Katakana_Phonetic_Extensions=a=>a>=12784&&a<=12799,on_Enclosed_CJK_Letters_and_Months=a=>a>=12800&&a<=13055,on_CJK_Compatibility=a=>a>=13056&&a<=13311,on_CJK_Unified_Ideographs_Extension_A=a=>a>=13312&&a<=19903,on_Yijing_Hexagram_Symbols=a=>a>=19904&&a<=19967,on_CJK_Unified_Ideographs=a=>a>=19968&&a<=40959,on_Yi_Syllables=a=>a>=40960&&a<=42127,on_Yi_Radicals=a=>a>=42128&&a<=42191,on_Hangul_Jamo_Extended_A=a=>a>=43360&&a<=43391,on_Hangul_Syllables=a=>a>=44032&&a<=55215,on_Hangul_Jamo_Extended_B=a=>a>=55216&&a<=55295,on_Private_Use_Area=a=>a>=57344&&a<=63743,on_CJK_Compatibility_Ideographs=a=>a>=63744&&a<=64255,on_Arabic_Presentation_Forms_A=a=>a>=64336&&a<=65023,on_Vertical_Forms=a=>a>=65040&&a<=65055,on_CJK_Compatibility_Forms=a=>a>=65072&&a<=65103,on_Small_Form_Variants=a=>a>=65104&&a<=65135,on_Arabic_Presentation_Forms_B=a=>a>=65136&&a<=65279,on_Halfwidth_and_Fullwidth_Forms=a=>a>=65280&&a<=65519;function Ma(a){for(const o of a)if(lf(o.charCodeAt(0)))return!0;return!1}function p_(a){for(const o of a)if(!af(o.charCodeAt(0)))return!1;return!0}function af(a){return!(on_Arabic(a)||on_Arabic_Supplement(a)||on_Arabic_Extended_A(a)||on_Arabic_Presentation_Forms_A(a)||on_Arabic_Presentation_Forms_B(a))}function lf(a){return!(746!==a&&747!==a&&(a<4352||!(on_Bopomofo_Extended(a)||on_Bopomofo(a)||on_CJK_Compatibility_Forms(a)&&!(a>=65097&&a<=65103)||on_CJK_Compatibility_Ideographs(a)||on_CJK_Compatibility(a)||on_CJK_Radicals_Supplement(a)||on_CJK_Strokes(a)||!(!on_CJK_Symbols_and_Punctuation(a)||a>=12296&&a<=12305||a>=12308&&a<=12319||12336===a)||on_CJK_Unified_Ideographs_Extension_A(a)||on_CJK_Unified_Ideographs(a)||on_Enclosed_CJK_Letters_and_Months(a)||on_Hangul_Compatibility_Jamo(a)||on_Hangul_Jamo_Extended_A(a)||on_Hangul_Jamo_Extended_B(a)||on_Hangul_Jamo(a)||on_Hangul_Syllables(a)||on_Hiragana(a)||on_Ideographic_Description_Characters(a)||on_Kanbun(a)||on_Kangxi_Radicals(a)||on_Katakana_Phonetic_Extensions(a)||on_Katakana(a)&&12540!==a||!(!on_Halfwidth_and_Fullwidth_Forms(a)||65288===a||65289===a||65293===a||a>=65306&&a<=65310||65339===a||65341===a||65343===a||a>=65371&&a<=65503||65507===a||a>=65512&&a<=65519)||!(!on_Small_Form_Variants(a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||on_Unified_Canadian_Aboriginal_Syllabics(a)||on_Unified_Canadian_Aboriginal_Syllabics_Extended(a)||on_Vertical_Forms(a)||on_Yijing_Hexagram_Symbols(a)||on_Yi_Syllables(a)||on_Yi_Radicals(a))))}function Ym(a){return!(lf(a)||(o=a,on_Latin_1_Supplement(o)&&(167===o||169===o||174===o||177===o||188===o||189===o||190===o||215===o||247===o)||on_General_Punctuation(o)&&(8214===o||8224===o||8225===o||8240===o||8241===o||8251===o||8252===o||8258===o||8263===o||8264===o||8265===o||8273===o)||on_Letterlike_Symbols(o)||on_Number_Forms(o)||on_Miscellaneous_Technical(o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||9003===o||o>=9085&&o<=9114||o>=9150&&o<=9165||9167===o||o>=9169&&o<=9179||o>=9186&&o<=9215)||on_Control_Pictures(o)&&9251!==o||on_Optical_Character_Recognition(o)||on_Enclosed_Alphanumerics(o)||on_Geometric_Shapes(o)||on_Miscellaneous_Symbols(o)&&!(o>=9754&&o<=9759)||on_Miscellaneous_Symbols_and_Arrows(o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||on_CJK_Symbols_and_Punctuation(o)||on_Katakana(o)||on_Private_Use_Area(o)||on_CJK_Compatibility_Forms(o)||on_Small_Form_Variants(o)||on_Halfwidth_and_Fullwidth_Forms(o)||8734===o||8756===o||8757===o||o>=9984&&o<=10087||o>=10102&&o<=10131||65532===o||65533===o));var o}function qh(a){return a>=1424&&a<=2303||on_Arabic_Presentation_Forms_A(a)||on_Arabic_Presentation_Forms_B(a)}function cf(a,o){return!(!o&&qh(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||on_Khmer(a))}function Km(a){for(const o of a)if(qh(o.charCodeAt(0)))return!0;return!1}const Pd="deferred",uf="loading",Wh="loaded";let ic=null,g="unavailable",c=null;const h=function(a){a&&"string"==typeof a&&a.indexOf("NetworkError")>-1&&(g="error"),ic&&ic(a)};function _(){x.fire(new Rc("pluginStateChange",{pluginStatus:g,pluginURL:c}))}const x=new pu,S=function(){return g},D=function(){if(g!==Pd||!c)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");g=uf,_(),c&&du({url:c},a=>{a?h(a):(g=Wh,_())})},I={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>g===Wh||null!=I.applyArabicShaping,isLoading:()=>g===uf,setState(a){g=a.pluginStatus,c=a.pluginURL},isParsed:()=>null!=I.applyArabicShaping&&null!=I.processBidirectionalText&&null!=I.processStyledBidirectionalText,getPluginURL:()=>c};class R{constructor(o,l){this.zoom=o,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.transition=l.transition,this.pitch=l.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(o){return function(l,u){for(const f of l)if(!cf(f.charCodeAt(0),u))return!1;return!0}(o,I.isLoaded())}}class O{constructor(o,l){this.property=o,this.value=l,this.expression=function(u,f){if(Fh(u))return new Nh(u,f);if(Dd(u)){const b=Su(u,f);if("error"===b.result)throw new Error(b.value.map(v=>`${v.key}: ${v.message}`).join(", "));return b.value}{let b=u;return"string"==typeof u&&"color"===f.type&&(b=uo.parse(u)),{kind:"constant",evaluate:()=>b}}}(void 0===l?o.specification.default:l,o.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(o,l,u){return this.property.possiblyEvaluate(this,o,l,u)}}class F{constructor(o){this.property=o,this.value=new O(o,void 0)}transitioned(o,l){return new Y(this.property,this.value,l,Li({},o.transition,this.transition),o.now)}untransitioned(){return new Y(this.property,this.value,null,{},0)}}class j{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitionablePropertyValues)}getValue(o){return Qe(this._values[o].value.value)}setValue(o,l){this._values.hasOwnProperty(o)||(this._values[o]=new F(this._values[o].property)),this._values[o].value=new O(this._values[o].property,null===l?void 0:Qe(l))}getTransition(o){return Qe(this._values[o].transition)}setTransition(o,l){this._values.hasOwnProperty(o)||(this._values[o]=new F(this._values[o].property)),this._values[o].transition=Qe(l)||void 0}serialize(){const o={};for(const l of Object.keys(this._values)){const u=this.getValue(l);void 0!==u&&(o[l]=u);const f=this.getTransition(l);void 0!==f&&(o[`${l}-transition`]=f)}return o}transitioned(o,l){const u=new ee(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].transitioned(o,l._values[f]);return u}untransitioned(){const o=new ee(this._properties);for(const l of Object.keys(this._values))o._values[l]=this._values[l].untransitioned();return o}}class Y{constructor(o,l,u,f,b){const v=f.delay||0,w=f.duration||0;b=b||0,this.property=o,this.value=l,this.begin=b+v,this.end=this.begin+w,o.specification.transition&&(f.delay||f.duration)&&(this.prior=u)}possiblyEvaluate(o,l,u){const f=o.now||0,b=this.value.possiblyEvaluate(o,l,u),v=this.prior;if(v){if(f>this.end)return this.prior=null,b;if(this.value.isDataDriven())return this.prior=null,b;if(f<this.begin)return v.possiblyEvaluate(o,l,u);{const w=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(v.possiblyEvaluate(o,l,u),b,mt(w))}}return b}}class ee{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitioningPropertyValues)}possiblyEvaluate(o,l,u){const f=new le(this._properties);for(const b of Object.keys(this._values))f._values[b]=this._values[b].possiblyEvaluate(o,l,u);return f}hasTransition(){for(const o of Object.keys(this._values))if(this._values[o].prior)return!0;return!1}}class se{constructor(o){this._properties=o,this._values=Object.create(o.defaultPropertyValues)}getValue(o){return Qe(this._values[o].value)}setValue(o,l){this._values[o]=new O(this._values[o].property,null===l?void 0:Qe(l))}serialize(){const o={};for(const l of Object.keys(this._values)){const u=this.getValue(l);void 0!==u&&(o[l]=u)}return o}possiblyEvaluate(o,l,u){const f=new le(this._properties);for(const b of Object.keys(this._values))f._values[b]=this._values[b].possiblyEvaluate(o,l,u);return f}}class ie{constructor(o,l,u){this.property=o,this.value=l,this.parameters=u}isConstant(){return"constant"===this.value.kind}constantOr(o){return"constant"===this.value.kind?this.value.value:o}evaluate(o,l,u,f){return this.property.evaluate(this.value,this.parameters,o,l,u,f)}}class le{constructor(o){this._properties=o,this._values=Object.create(o.defaultPossiblyEvaluatedValues)}get(o){return this._values[o]}}class U{constructor(o){this.specification=o}possiblyEvaluate(o,l){return o.expression.evaluate(l)}interpolate(o,l,u){const f=xn[this.specification.type];return f?f(o,l,u):o}}class J{constructor(o,l){this.specification=o,this.overrides=l}possiblyEvaluate(o,l,u,f){return new ie(this,"constant"===o.expression.kind||"camera"===o.expression.kind?{kind:"constant",value:o.expression.evaluate(l,null,{},u,f)}:o.expression,l)}interpolate(o,l,u){if("constant"!==o.value.kind||"constant"!==l.value.kind)return o;if(void 0===o.value.value||void 0===l.value.value)return new ie(this,{kind:"constant",value:void 0},o.parameters);const f=xn[this.specification.type];return f?new ie(this,{kind:"constant",value:f(o.value.value,l.value.value,u)},o.parameters):o}evaluate(o,l,u,f,b,v){return"constant"===o.kind?o.value:o.evaluate(l,u,f,b,v)}}class pe{constructor(o){this.specification=o}possiblyEvaluate(o,l,u,f){return!!o.expression.evaluate(l,null,{},u,f)}interpolate(){return!1}}class ge{constructor(o){this.properties=o,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const l=new R(0,{});for(const u in o){const f=o[u];f.specification.overridable&&this.overridableProperties.push(u);const b=this.defaultPropertyValues[u]=new O(f,void 0),v=this.defaultTransitionablePropertyValues[u]=new F(f);this.defaultTransitioningPropertyValues[u]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=b.possiblyEvaluate(l)}}}function Fe(a,o){return 256*(a=Tt(Math.floor(a),0,255))+Tt(Math.floor(o),0,255)}gn(J,"DataDrivenProperty"),gn(U,"DataConstantProperty"),gn(pe,"ColorRampProperty");const Pe={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Oe{constructor(o,l){this._structArray=o,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class We{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(o,l){return o._trim(),l&&(o.isTransferred=!0,l.push(o.arrayBuffer)),{length:o.length,arrayBuffer:o.arrayBuffer}}static deserialize(o){const l=Object.create(this.prototype);return l.arrayBuffer=o.arrayBuffer,l.length=o.length,l.capacity=o.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(o){this.reserve(o),this.length=o}reserve(o){if(o>this.capacity){this.capacity=Math.max(o,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function He(a,o=1){let l=0,u=0;return{members:a.map(f=>{const b=Pe[f.type].BYTES_PER_ELEMENT,v=l=ot(l,Math.max(o,b)),w=f.components||1;return u=Math.max(u,b),l+=b*w,{name:f.name,type:f.type,components:w,offset:v}}),size:ot(l,Math.max(u,o)),alignment:o}}function ot(a,o){return Math.ceil(a/o)*o}class Ft extends We{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l){const u=this.length;return this.resize(u+1),this.emplace(u,o,l)}emplace(o,l,u){const f=2*o;return this.int16[f+0]=l,this.int16[f+1]=u,o}}Ft.prototype.bytesPerElement=4,gn(Ft,"StructArrayLayout2i4");class nt extends We{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,u){const f=this.length;return this.resize(f+1),this.emplace(f,o,l,u)}emplace(o,l,u,f){const b=3*o;return this.int16[b+0]=l,this.int16[b+1]=u,this.int16[b+2]=f,o}}nt.prototype.bytesPerElement=6,gn(nt,"StructArrayLayout3i6");class St extends We{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,u,f){const b=this.length;return this.resize(b+1),this.emplace(b,o,l,u,f)}emplace(o,l,u,f,b){const v=4*o;return this.int16[v+0]=l,this.int16[v+1]=u,this.int16[v+2]=f,this.int16[v+3]=b,o}}St.prototype.bytesPerElement=8,gn(St,"StructArrayLayout4i8");class pt extends We{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b,v,w){const T=this.length;return this.resize(T+1),this.emplace(T,o,l,u,f,b,v,w)}emplace(o,l,u,f,b,v,w,T){const E=6*o,A=12*o,P=3*o;return this.int16[E+0]=l,this.int16[E+1]=u,this.uint8[A+4]=f,this.uint8[A+5]=b,this.uint8[A+6]=v,this.uint8[A+7]=w,this.float32[P+2]=T,o}}pt.prototype.bytesPerElement=12,gn(pt,"StructArrayLayout2i4ub1f12");class Nt extends We{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,u,f){const b=this.length;return this.resize(b+1),this.emplace(b,o,l,u,f)}emplace(o,l,u,f,b){const v=4*o;return this.float32[v+0]=l,this.float32[v+1]=u,this.float32[v+2]=f,this.float32[v+3]=b,o}}Nt.prototype.bytesPerElement=16,gn(Nt,"StructArrayLayout4f16");class it extends We{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b){const v=this.length;return this.resize(v+1),this.emplace(v,o,l,u,f,b)}emplace(o,l,u,f,b,v){const w=6*o,T=3*o;return this.uint16[w+0]=l,this.uint16[w+1]=u,this.uint16[w+2]=f,this.uint16[w+3]=b,this.float32[T+2]=v,o}}it.prototype.bytesPerElement=12,gn(it,"StructArrayLayout4ui1f12");class vt extends We{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,u,f){const b=this.length;return this.resize(b+1),this.emplace(b,o,l,u,f)}emplace(o,l,u,f,b){const v=4*o;return this.uint16[v+0]=l,this.uint16[v+1]=u,this.uint16[v+2]=f,this.uint16[v+3]=b,o}}vt.prototype.bytesPerElement=8,gn(vt,"StructArrayLayout4ui8");class Bt extends We{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b,v){const w=this.length;return this.resize(w+1),this.emplace(w,o,l,u,f,b,v)}emplace(o,l,u,f,b,v,w){const T=6*o;return this.int16[T+0]=l,this.int16[T+1]=u,this.int16[T+2]=f,this.int16[T+3]=b,this.int16[T+4]=v,this.int16[T+5]=w,o}}Bt.prototype.bytesPerElement=12,gn(Bt,"StructArrayLayout6i12");class Mt extends We{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b,v,w,T,E,A,P,L){const N=this.length;return this.resize(N+1),this.emplace(N,o,l,u,f,b,v,w,T,E,A,P,L)}emplace(o,l,u,f,b,v,w,T,E,A,P,L,N){const B=12*o;return this.int16[B+0]=l,this.int16[B+1]=u,this.int16[B+2]=f,this.int16[B+3]=b,this.uint16[B+4]=v,this.uint16[B+5]=w,this.uint16[B+6]=T,this.uint16[B+7]=E,this.int16[B+8]=A,this.int16[B+9]=P,this.int16[B+10]=L,this.int16[B+11]=N,o}}Mt.prototype.bytesPerElement=24,gn(Mt,"StructArrayLayout4i4ui4i24");class Vt extends We{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b,v){const w=this.length;return this.resize(w+1),this.emplace(w,o,l,u,f,b,v)}emplace(o,l,u,f,b,v,w){const T=10*o,E=5*o;return this.int16[T+0]=l,this.int16[T+1]=u,this.int16[T+2]=f,this.float32[E+2]=b,this.float32[E+3]=v,this.float32[E+4]=w,o}}Vt.prototype.bytesPerElement=20,gn(Vt,"StructArrayLayout3i3f20");class In extends We{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.uint32[1*o+0]=l,o}}In.prototype.bytesPerElement=4,gn(In,"StructArrayLayout1ul4");class zn extends We{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b,v,w,T,E,A,P,L,N){const B=this.length;return this.resize(B+1),this.emplace(B,o,l,u,f,b,v,w,T,E,A,P,L,N)}emplace(o,l,u,f,b,v,w,T,E,A,P,L,N,B){const $=20*o,K=10*o;return this.int16[$+0]=l,this.int16[$+1]=u,this.int16[$+2]=f,this.int16[$+3]=b,this.int16[$+4]=v,this.float32[K+3]=w,this.float32[K+4]=T,this.float32[K+5]=E,this.float32[K+6]=A,this.int16[$+14]=P,this.uint32[K+8]=L,this.uint16[$+18]=N,this.uint16[$+19]=B,o}}zn.prototype.bytesPerElement=40,gn(zn,"StructArrayLayout5i4f1i1ul2ui40");class bn extends We{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b,v,w){const T=this.length;return this.resize(T+1),this.emplace(T,o,l,u,f,b,v,w)}emplace(o,l,u,f,b,v,w,T){const E=8*o;return this.int16[E+0]=l,this.int16[E+1]=u,this.int16[E+2]=f,this.int16[E+4]=b,this.int16[E+5]=v,this.int16[E+6]=w,this.int16[E+7]=T,o}}bn.prototype.bytesPerElement=16,gn(bn,"StructArrayLayout3i2i2i16");class An extends We{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b){const v=this.length;return this.resize(v+1),this.emplace(v,o,l,u,f,b)}emplace(o,l,u,f,b,v){const w=4*o,T=8*o;return this.float32[w+0]=l,this.float32[w+1]=u,this.float32[w+2]=f,this.int16[T+6]=b,this.int16[T+7]=v,o}}An.prototype.bytesPerElement=16,gn(An,"StructArrayLayout2f1f2i16");class gi extends We{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,u,f){const b=this.length;return this.resize(b+1),this.emplace(b,o,l,u,f)}emplace(o,l,u,f,b){const v=12*o,w=3*o;return this.uint8[v+0]=l,this.uint8[v+1]=u,this.float32[w+1]=f,this.float32[w+2]=b,o}}gi.prototype.bytesPerElement=12,gn(gi,"StructArrayLayout2ub2f12");class oi extends We{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,u){const f=this.length;return this.resize(f+1),this.emplace(f,o,l,u)}emplace(o,l,u,f){const b=3*o;return this.float32[b+0]=l,this.float32[b+1]=u,this.float32[b+2]=f,o}}oi.prototype.bytesPerElement=12,gn(oi,"StructArrayLayout3f12");class En extends We{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,u){const f=this.length;return this.resize(f+1),this.emplace(f,o,l,u)}emplace(o,l,u,f){const b=3*o;return this.uint16[b+0]=l,this.uint16[b+1]=u,this.uint16[b+2]=f,o}}En.prototype.bytesPerElement=6,gn(En,"StructArrayLayout3ui6");class nr extends We{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b,v,w,T,E,A,P,L,N,B,$,K,ce,Ce,ue,ve,Ae){const ke=this.length;return this.resize(ke+1),this.emplace(ke,o,l,u,f,b,v,w,T,E,A,P,L,N,B,$,K,ce,Ce,ue,ve,Ae)}emplace(o,l,u,f,b,v,w,T,E,A,P,L,N,B,$,K,ce,Ce,ue,ve,Ae,ke){const at=30*o,rt=15*o,_t=60*o;return this.int16[at+0]=l,this.int16[at+1]=u,this.int16[at+2]=f,this.float32[rt+2]=b,this.float32[rt+3]=v,this.uint16[at+8]=w,this.uint16[at+9]=T,this.uint32[rt+5]=E,this.uint32[rt+6]=A,this.uint32[rt+7]=P,this.uint16[at+16]=L,this.uint16[at+17]=N,this.uint16[at+18]=B,this.float32[rt+10]=$,this.float32[rt+11]=K,this.uint8[_t+48]=ce,this.uint8[_t+49]=Ce,this.uint8[_t+50]=ue,this.uint32[rt+13]=ve,this.int16[at+28]=Ae,this.uint8[_t+58]=ke,o}}nr.prototype.bytesPerElement=60,gn(nr,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class pr extends We{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b,v,w,T,E,A,P,L,N,B,$,K,ce,Ce,ue,ve,Ae,ke,at,rt,_t,zt,ht,Dt,Ct,Rt){const Gt=this.length;return this.resize(Gt+1),this.emplace(Gt,o,l,u,f,b,v,w,T,E,A,P,L,N,B,$,K,ce,Ce,ue,ve,Ae,ke,at,rt,_t,zt,ht,Dt,Ct,Rt)}emplace(o,l,u,f,b,v,w,T,E,A,P,L,N,B,$,K,ce,Ce,ue,ve,Ae,ke,at,rt,_t,zt,ht,Dt,Ct,Rt,Gt){const ft=38*o,sn=19*o;return this.int16[ft+0]=l,this.int16[ft+1]=u,this.int16[ft+2]=f,this.float32[sn+2]=b,this.float32[sn+3]=v,this.int16[ft+8]=w,this.int16[ft+9]=T,this.int16[ft+10]=E,this.int16[ft+11]=A,this.int16[ft+12]=P,this.int16[ft+13]=L,this.uint16[ft+14]=N,this.uint16[ft+15]=B,this.uint16[ft+16]=$,this.uint16[ft+17]=K,this.uint16[ft+18]=ce,this.uint16[ft+19]=Ce,this.uint16[ft+20]=ue,this.uint16[ft+21]=ve,this.uint16[ft+22]=Ae,this.uint16[ft+23]=ke,this.uint16[ft+24]=at,this.uint16[ft+25]=rt,this.uint16[ft+26]=_t,this.uint16[ft+27]=zt,this.uint16[ft+28]=ht,this.uint32[sn+15]=Dt,this.float32[sn+16]=Ct,this.float32[sn+17]=Rt,this.float32[sn+18]=Gt,o}}pr.prototype.bytesPerElement=76,gn(pr,"StructArrayLayout3i2f6i15ui1ul3f76");class _r extends We{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.float32[1*o+0]=l,o}}_r.prototype.bytesPerElement=4,gn(_r,"StructArrayLayout1f4");class ki extends We{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b){const v=this.length;return this.resize(v+1),this.emplace(v,o,l,u,f,b)}emplace(o,l,u,f,b,v){const w=5*o;return this.float32[w+0]=l,this.float32[w+1]=u,this.float32[w+2]=f,this.float32[w+3]=b,this.float32[w+4]=v,o}}ki.prototype.bytesPerElement=20,gn(ki,"StructArrayLayout5f20");class ns extends We{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,u,f){const b=this.length;return this.resize(b+1),this.emplace(b,o,l,u,f)}emplace(o,l,u,f,b){const v=6*o;return this.uint32[3*o+0]=l,this.uint16[v+2]=u,this.uint16[v+3]=f,this.uint16[v+4]=b,o}}ns.prototype.bytesPerElement=12,gn(ns,"StructArrayLayout1ul3ui12");class io extends We{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l){const u=this.length;return this.resize(u+1),this.emplace(u,o,l)}emplace(o,l,u){const f=2*o;return this.uint16[f+0]=l,this.uint16[f+1]=u,o}}io.prototype.bytesPerElement=4,gn(io,"StructArrayLayout2ui4");class Ns extends We{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.uint16[1*o+0]=l,o}}Ns.prototype.bytesPerElement=2,gn(Ns,"StructArrayLayout1ui2");class da extends We{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l){const u=this.length;return this.resize(u+1),this.emplace(u,o,l)}emplace(o,l,u){const f=2*o;return this.float32[f+0]=l,this.float32[f+1]=u,o}}da.prototype.bytesPerElement=8,gn(da,"StructArrayLayout2f8");class Ir extends Oe{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Ir.prototype.size=40;class or extends zn{get(o){return new Ir(this,o)}}gn(or,"CollisionBoxArray");class Yi extends Oe{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(o){this._structArray.uint8[this._pos1+49]=o}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(o){this._structArray.uint8[this._pos1+50]=o}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(o){this._structArray.uint32[this._pos4+13]=o}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(o){this._structArray.uint8[this._pos1+58]=o}}Yi.prototype.size=60;class ro extends nr{get(o){return new Yi(this,o)}}gn(ro,"PlacedSymbolArray");class is extends Oe{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(o){this._structArray.uint32[this._pos4+15]=o}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}is.prototype.size=76;class Rr extends pr{get(o){return new is(this,o)}}gn(Rr,"SymbolInstanceArray");class vs extends _r{getoffsetX(o){return this.float32[1*o+0]}}gn(vs,"GlyphOffsetArray");class Xh extends Ft{getx(o){return this.int16[2*o+0]}gety(o){return this.int16[2*o+1]}}gn(Xh,"SymbolLineVertexArray");class il extends Oe{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}il.prototype.size=12;class Tl extends ns{get(o){return new il(this,o)}}gn(Tl,"FeatureIndexArray");class El extends io{geta_centroid_pos0(o){return this.uint16[2*o+0]}geta_centroid_pos1(o){return this.uint16[2*o+1]}}gn(El,"FillExtrusionCentroidArray");const Dl=He([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),rc=He([{name:"a_dash",components:4,type:"Uint16"}]);var Il={exports:{}},Uv=function(a,o){var l,u,f,b,v,w,T,E;for(u=a.length-(l=3&a.length),f=o,v=3432918353,w=461845907,E=0;E<u;)T=255&a.charCodeAt(E)|(255&a.charCodeAt(++E))<<8|(255&a.charCodeAt(++E))<<16|(255&a.charCodeAt(++E))<<24,++E,f=27492+(65535&(b=5*(65535&(f=(f^=T=(65535&(T=(T=(65535&T)*v+(((T>>>16)*v&65535)<<16)&4294967295)<<15|T>>>17))*w+(((T>>>16)*w&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(b>>>16)&65535)<<16);switch(T=0,l){case 3:T^=(255&a.charCodeAt(E+2))<<16;case 2:T^=(255&a.charCodeAt(E+1))<<8;case 1:f^=T=(65535&(T=(T=(65535&(T^=255&a.charCodeAt(E)))*v+(((T>>>16)*v&65535)<<16)&4294967295)<<15|T>>>17))*w+(((T>>>16)*w&65535)<<16)&4294967295}return f^=a.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0},Hv=function(a,o){for(var l,u=a.length,f=o^u,b=0;u>=4;)l=1540483477*(65535&(l=255&a.charCodeAt(b)|(255&a.charCodeAt(++b))<<8|(255&a.charCodeAt(++b))<<16|(255&a.charCodeAt(++b))<<24))+((1540483477*(l>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),u-=4,++b;switch(u){case 3:f^=(255&a.charCodeAt(b+2))<<16;case 2:f^=(255&a.charCodeAt(b+1))<<8;case 1:f=1540483477*(65535&(f^=255&a.charCodeAt(b)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0};Il.exports=Uv,Il.exports.murmur3=Uv,Il.exports.murmur2=Hv;var Uo=_n(Il.exports);class Uc{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(o,l,u,f){this.ids.push(Od(o)),this.positions.push(l,u,f)}getPositions(o){const l=Od(o);let u=0,f=this.ids.length-1;for(;u<f;){const v=u+f>>1;this.ids[v]>=l?f=v:u=v+1}const b=[];for(;this.ids[u]===l;)b.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return b}static serialize(o,l){const u=new Float64Array(o.ids),f=new Uint32Array(o.positions);return Iu(u,f,0,u.length-1),l&&l.push(u.buffer,f.buffer),{ids:u,positions:f}}static deserialize(o){const l=new Uc;return l.ids=o.ids,l.positions=o.positions,l.indexed=!0,l}}function Od(a){const o=+a;return!isNaN(o)&&Number.MIN_SAFE_INTEGER<=o&&o<=Number.MAX_SAFE_INTEGER?o:Uo(String(a))}function Iu(a,o,l,u){for(;l<u;){const f=a[l+u>>1];let b=l-1,v=u+1;for(;;){do{b++}while(a[b]<f);do{v--}while(a[v]>f);if(b>=v)break;df(a,b,v),df(o,3*b,3*v),df(o,3*b+1,3*v+1),df(o,3*b+2,3*v+2)}v-l<u-v?(Iu(a,o,l,v),l=v+1):(Iu(a,o,v+1,u),u=v)}}function df(a,o,l){const u=a[o];a[o]=a[l],a[l]=u}gn(Uc,"FeaturePositionMap");class Ml{constructor(o){this.gl=o.gl,this.initialized=!1}fetchUniformLocation(o,l){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(o,l),this.initialized=!0),!!this.location}}class Hc extends Ml{constructor(o){super(o),this.current=0}set(o,l,u){this.fetchUniformLocation(o,l)&&this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class HS extends Ml{constructor(o){super(o),this.current=[0,0,0,0]}set(o,l,u){this.fetchUniformLocation(o,l)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3])))}}class $v extends Ml{constructor(o){super(o),this.current=uo.transparent}set(o,l,u){this.fetchUniformLocation(o,l)&&(u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a)))}}const Et=new Float32Array(16),CI=new Float32Array(9),TI=new Float32Array(4);function Gv(a){return[Fe(255*a.r,255*a.g),Fe(255*a.b,255*a.a)]}class Jm{constructor(o,l,u){this.value=o,this.uniformNames=l.map(f=>`u_${f}`),this.type=u}setUniform(o,l,u,f,b){l.set(o,b,f.constantOr(this.value))}getBinding(o,l){return"color"===this.type?new $v(o):new Hc(o)}}class hf{constructor(o,l){this.uniformNames=l.map(u=>`u_${u}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(o){this.pixelRatio=o.pixelRatio||1,this.pattern=o.tl.concat(o.br)}setUniform(o,l,u,f,b){const v="u_pattern"===b||"u_dash"===b?this.pattern:"u_pixel_ratio"===b?this.pixelRatio:null;v&&l.set(o,b,v)}getBinding(o,l){return"u_pattern"===l||"u_dash"===l?new HS(o):new Hc(o)}}class Mu{constructor(o,l,u,f){this.expression=o,this.type=u,this.maxValue=0,this.paintVertexAttributes=l.map(b=>({name:`a_${b}`,type:"Float32",components:"color"===u?2:1,offset:0})),this.paintVertexArray=new f}populatePaintArray(o,l,u,f,b,v){const w=this.paintVertexArray.length,T=this.expression.evaluate(new R(0),l,{},b,f,v);this.paintVertexArray.resize(o),this._setPaintValue(w,o,T)}updatePaintArray(o,l,u,f,b){const v=this.expression.evaluate({zoom:0},u,f,void 0,b);this._setPaintValue(o,l,v)}_setPaintValue(o,l,u){if("color"===this.type){const f=Gv(u);for(let b=o;b<l;b++)this.paintVertexArray.emplace(b,f[0],f[1])}else{for(let f=o;f<l;f++)this.paintVertexArray.emplace(f,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class oc{constructor(o,l,u,f,b,v){this.expression=o,this.uniformNames=l.map(w=>`u_${w}_t`),this.type=u,this.useIntegerZoom=f,this.zoom=b,this.maxValue=0,this.paintVertexAttributes=l.map(w=>({name:`a_${w}`,type:"Float32",components:"color"===u?4:2,offset:0})),this.paintVertexArray=new v}populatePaintArray(o,l,u,f,b,v){const w=this.expression.evaluate(new R(this.zoom),l,{},b,f,v),T=this.expression.evaluate(new R(this.zoom+1),l,{},b,f,v),E=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValue(E,o,w,T)}updatePaintArray(o,l,u,f,b){const v=this.expression.evaluate({zoom:this.zoom},u,f,void 0,b),w=this.expression.evaluate({zoom:this.zoom+1},u,f,void 0,b);this._setPaintValue(o,l,v,w)}_setPaintValue(o,l,u,f){if("color"===this.type){const b=Gv(u),v=Gv(f);for(let w=o;w<l;w++)this.paintVertexArray.emplace(w,b[0],b[1],v[0],v[1])}else{for(let b=o;b<l;b++)this.paintVertexArray.emplace(b,u,f);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(f))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(o,l,u,f,b){const v=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,w=Tt(this.expression.interpolationFactor(v,this.zoom,this.zoom+1),0,1);l.set(o,b,w)}getBinding(o,l){return new Hc(o)}}class rl{constructor(o,l,u,f,b){this.expression=o,this.layerId=b,this.paintVertexAttributes=("array"===u?rc:Dl).members;for(let v=0;v<l.length;++v);this.paintVertexArray=new f}populatePaintArray(o,l,u){const f=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValues(f,o,l.patterns&&l.patterns[this.layerId],u)}updatePaintArray(o,l,u,f,b,v){this._setPaintValues(o,l,u.patterns&&u.patterns[this.layerId],v)}_setPaintValues(o,l,u,f){if(!f||!u)return;const b=f[u];if(!b)return;const{tl:v,br:w,pixelRatio:T}=b;for(let E=o;E<l;E++)this.paintVertexArray.emplace(E,v[0],v[1],w[0],w[1],T)}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Fd{constructor(o,l,u=(()=>!0)){this.binders={},this._buffers=[];const f=[];for(const b in o.paint._values){if(!u(b))continue;const v=o.paint.get(b);if(!(v instanceof ie&&Cd(v.property.specification)))continue;const w=f_(b,o.type),T=v.value,E=v.property.specification.type,A=!!v.property.useIntegerZoom,P="line-dasharray"===b||b.endsWith("pattern"),L="line-dasharray"===b&&"constant"!==o.layout.get("line-cap").value.kind;if("constant"!==T.kind||L)if("source"===T.kind||L||P){const N=qv(b,E,"source");this.binders[b]=P?new rl(T,w,E,N,o.id):new Mu(T,w,E,N),f.push(`/a_${b}`)}else{const N=qv(b,E,"composite");this.binders[b]=new oc(T,w,E,A,l,N),f.push(`/z_${b}`)}else this.binders[b]=P?new hf(T.value,w):new Jm(T.value,w,E),f.push(`/u_${b}`)}this.cacheKey=f.sort().join("")}getMaxValue(o){const l=this.binders[o];return l instanceof Mu||l instanceof oc?l.maxValue:0}populatePaintArrays(o,l,u,f,b,v){for(const w in this.binders){const T=this.binders[w];(T instanceof Mu||T instanceof oc||T instanceof rl)&&T.populatePaintArray(o,l,u,f,b,v)}}setConstantPatternPositions(o){for(const l in this.binders){const u=this.binders[l];u instanceof hf&&u.setConstantPatternPositions(o)}}updatePaintArrays(o,l,u,f,b,v){let w=!1;for(const T in o){const E=l.getPositions(T);for(const A of E){const P=u.feature(A.index);for(const L in this.binders){const N=this.binders[L];if((N instanceof Mu||N instanceof oc||N instanceof rl)&&!0===N.expression.isStateDependent){const B=f.paint.get(L);N.expression=B.value,N.updatePaintArray(A.start,A.end,P,o[T],b,v),w=!0}}}}return w}defines(){const o=[];for(const l in this.binders){const u=this.binders[l];(u instanceof Jm||u instanceof hf)&&o.push(...u.uniformNames.map(f=>`#define HAS_UNIFORM_${f}`))}return o}getBinderAttributes(){const o=[];for(const l in this.binders){const u=this.binders[l];if(u instanceof Mu||u instanceof oc||u instanceof rl)for(let f=0;f<u.paintVertexAttributes.length;f++)o.push(u.paintVertexAttributes[f].name)}return o}getBinderUniforms(){const o=[];for(const l in this.binders){const u=this.binders[l];if(u instanceof Jm||u instanceof hf||u instanceof oc)for(const f of u.uniformNames)o.push(f)}return o}getPaintVertexBuffers(){return this._buffers}getUniforms(o){const l=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof Jm||f instanceof hf||f instanceof oc)for(const b of f.uniformNames)l.push({name:b,property:u,binding:f.getBinding(o,b)})}return l}setUniforms(o,l,u,f,b){for(const{name:v,property:w,binding:T}of u)this.binders[w].setUniform(o,T,b,f.get(w),v)}updatePaintBuffers(){this._buffers=[];for(const o in this.binders){const l=this.binders[o];(l instanceof Mu||l instanceof oc||l instanceof rl)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(o){for(const l in this.binders){const u=this.binders[l];(u instanceof Mu||u instanceof oc||u instanceof rl)&&u.upload(o)}this.updatePaintBuffers()}destroy(){for(const o in this.binders){const l=this.binders[o];(l instanceof Mu||l instanceof oc||l instanceof rl)&&l.destroy()}}}class Zh{constructor(o,l,u=(()=>!0)){this.programConfigurations={};for(const f of o)this.programConfigurations[f.id]=new Fd(f,l,u);this.needsUpload=!1,this._featureMap=new Uc,this._bufferOffset=0}populatePaintArrays(o,l,u,f,b,v,w){for(const T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(o,l,f,b,v,w);void 0!==l.id&&this._featureMap.add(l.id,u,this._bufferOffset,o),this._bufferOffset=o,this.needsUpload=!0}updatePaintArrays(o,l,u,f,b){for(const v of u)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(o,this._featureMap,l,v,f,b)||this.needsUpload}get(o){return this.programConfigurations[o]}upload(o){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(o);this.needsUpload=!1}}destroy(){for(const o in this.programConfigurations)this.programConfigurations[o].destroy()}}const Ho={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function f_(a,o){return Ho[a]||[a.replace(`${o}-`,"").replace(/-/g,"_")]}const pf={"line-pattern":{source:it,composite:it},"fill-pattern":{source:it,composite:it},"fill-extrusion-pattern":{source:it,composite:it},"line-dasharray":{source:vt,composite:vt}},EI={color:{source:da,composite:Nt},number:{source:_r,composite:da}};function qv(a,o,l){const u=pf[a];return u&&u[l]||EI[o][l]}gn(Jm,"ConstantBinder"),gn(hf,"PatternConstantBinder"),gn(Mu,"SourceExpressionBinder"),gn(rl,"PatternCompositeBinder"),gn(oc,"CompositeExpressionBinder"),gn(Fd,"ProgramConfiguration",{omit:["_buffers"]}),gn(Zh,"ProgramConfigurationSet");const ha="-transition";class $o extends pu{constructor(o,l){if(super(),this.id=o.id,this.type=o.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==o.type&&(this.metadata=o.metadata,this.minzoom=o.minzoom,this.maxzoom=o.maxzoom,"background"!==o.type&&"sky"!==o.type&&(this.source=o.source,this.sourceLayer=o["source-layer"],this.filter=o.filter),l.layout&&(this._unevaluatedLayout=new se(l.layout)),l.paint)){this._transitionablePaint=new j(l.paint);for(const u in o.paint)this.setPaintProperty(u,o.paint[u],{validate:!1});for(const u in o.layout)this.setLayoutProperty(u,o.layout[u],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new le(l.paint)}}getLayoutProperty(o){return"visibility"===o?this.visibility:this._unevaluatedLayout.getValue(o)}setLayoutProperty(o,l,u={}){null!=l&&this._validate(Co,`layers.${this.id}.layout.${o}`,o,l,u)||("visibility"!==o?this._unevaluatedLayout.setValue(o,l):this.visibility=l)}getPaintProperty(o){return fe(o,ha)?this._transitionablePaint.getTransition(o.slice(0,-11)):this._transitionablePaint.getValue(o)}setPaintProperty(o,l,u={}){if(null!=l&&this._validate(Ai,`layers.${this.id}.paint.${o}`,o,l,u))return!1;if(fe(o,ha))return this._transitionablePaint.setTransition(o.slice(0,-11),l||void 0),!1;{const f=this._transitionablePaint._values[o],b=f.value.isDataDriven(),v=f.value;this._transitionablePaint.setValue(o,l),this._handleSpecialPaintPropertyUpdate(o);const w=this._transitionablePaint._values[o].value,T=w.isDataDriven(),E=fe(o,"pattern")||"line-dasharray"===o;return T||b||E||this._handleOverridablePaintPropertyUpdate(o,v,w)}}_handleSpecialPaintPropertyUpdate(o){}getProgramIds(){return null}getProgramConfiguration(o){return null}_handleOverridablePaintPropertyUpdate(o,l,u){return!1}isHidden(o){return!!(this.minzoom&&o<this.minzoom)||!!(this.maxzoom&&o>=this.maxzoom)||"none"===this.visibility}updateTransitions(o){this._transitioningPaint=this._transitionablePaint.transitioned(o,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(o,l){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(o,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(o,void 0,l)}serialize(){const o={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(o.layout=o.layout||{},o.layout.visibility=this.visibility),Pt(o,(l,u)=>!(void 0===l||"layout"===u&&!Object.keys(l).length||"paint"===u&&!Object.keys(l).length))}_validate(o,l,u,f,b={}){return(!b||!1!==b.validate)&&Eu(this,o.call(Mi,{key:l,layerType:this.type,objectKey:u,value:f,styleSpec:bt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const o in this.paint._values){const l=this.paint.get(o);if(l instanceof ie&&Cd(l.property.specification)&&("source"===l.value.kind||"composite"===l.value.kind)&&l.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Vh(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Wv=He([{name:"a_pos",components:2,type:"Int16"}],4),eg=He([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Hr{constructor(o=[]){this.segments=o}prepareSegment(o,l,u,f){let b=this.segments[this.segments.length-1];return o>Hr.MAX_VERTEX_ARRAY_LENGTH&&Qn(`Max vertices per segment is ${Hr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${o}`),(!b||b.vertexLength+o>Hr.MAX_VERTEX_ARRAY_LENGTH||b.sortKey!==f)&&(b={vertexOffset:l.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},void 0!==f&&(b.sortKey=f),this.segments.push(b)),b}get(){return this.segments}destroy(){for(const o of this.segments)for(const l in o.vaos)o.vaos[l].destroy()}static simpleSegment(o,l,u,f){return new Hr([{vertexOffset:o,primitiveOffset:l,vertexLength:u,primitiveLength:f,vaos:{},sortKey:0}])}}Hr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,gn(Hr,"SegmentVector");var Pn=8192;class Au{constructor(o,l){o&&(l?this.setSouthWest(o).setNorthEast(l):4===o.length?this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]]):this.setSouthWest(o[0]).setNorthEast(o[1]))}setNorthEast(o){return this._ne=o instanceof yr?new yr(o.lng,o.lat):yr.convert(o),this}setSouthWest(o){return this._sw=o instanceof yr?new yr(o.lng,o.lat):yr.convert(o),this}extend(o){const l=this._sw,u=this._ne;let f,b;if(o instanceof yr)f=o,b=o;else{if(!(o instanceof Au))return Array.isArray(o)?4===o.length||o.every(Array.isArray)?this.extend(Au.convert(o)):this.extend(yr.convert(o)):"object"==typeof o&&null!==o&&o.hasOwnProperty("lat")&&(o.hasOwnProperty("lon")||o.hasOwnProperty("lng"))?this.extend(yr.convert(o)):this;if(f=o._sw,b=o._ne,!f||!b)return this}return l||u?(l.lng=Math.min(f.lng,l.lng),l.lat=Math.min(f.lat,l.lat),u.lng=Math.max(b.lng,u.lng),u.lat=Math.max(b.lat,u.lat)):(this._sw=new yr(f.lng,f.lat),this._ne=new yr(b.lng,b.lat)),this}getCenter(){return new yr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new yr(this.getWest(),this.getNorth())}getSouthEast(){return new yr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(o){const{lng:l,lat:u}=yr.convert(o);let f=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&f}static convert(o){return!o||o instanceof Au?o:new Au(o)}}var tg=1e-6,Aa="undefined"!=typeof Float32Array?Float32Array:Array;function $S(){var a=new Aa(9);return Aa!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function m_(a,o,l){var u=o[0],f=o[1],b=o[2],v=o[3],w=o[4],T=o[5],E=o[6],A=o[7],P=o[8],L=l[0],N=l[1],B=l[2],$=l[3],K=l[4],ce=l[5],Ce=l[6],ue=l[7],ve=l[8];return a[0]=L*u+N*v+B*E,a[1]=L*f+N*w+B*A,a[2]=L*b+N*T+B*P,a[3]=$*u+K*v+ce*E,a[4]=$*f+K*w+ce*A,a[5]=$*b+K*T+ce*P,a[6]=Ce*u+ue*v+ve*E,a[7]=Ce*f+ue*w+ve*A,a[8]=Ce*b+ue*T+ve*P,a}function ho(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function ff(a,o){var l=o[0],u=o[1],f=o[2],b=o[3],v=o[4],w=o[5],T=o[6],E=o[7],A=o[8],P=o[9],L=o[10],N=o[11],B=o[12],$=o[13],K=o[14],ce=o[15],Ce=l*w-u*v,ue=l*T-f*v,ve=l*E-b*v,Ae=u*T-f*w,ke=u*E-b*w,at=f*E-b*T,rt=A*$-P*B,_t=A*K-L*B,zt=A*ce-N*B,ht=P*K-L*$,Dt=P*ce-N*$,Ct=L*ce-N*K,Rt=Ce*Ct-ue*Dt+ve*ht+Ae*zt-ke*_t+at*rt;return Rt?(a[0]=(w*Ct-T*Dt+E*ht)*(Rt=1/Rt),a[1]=(f*Dt-u*Ct-b*ht)*Rt,a[2]=($*at-K*ke+ce*Ae)*Rt,a[3]=(L*ke-P*at-N*Ae)*Rt,a[4]=(T*zt-v*Ct-E*_t)*Rt,a[5]=(l*Ct-f*zt+b*_t)*Rt,a[6]=(K*ve-B*at-ce*ue)*Rt,a[7]=(A*at-L*ve+N*ue)*Rt,a[8]=(v*Dt-w*zt+E*rt)*Rt,a[9]=(u*zt-l*Dt-b*rt)*Rt,a[10]=(B*ke-$*ve+ce*Ce)*Rt,a[11]=(P*ve-A*ke-N*Ce)*Rt,a[12]=(w*_t-v*ht-T*rt)*Rt,a[13]=(l*ht-u*_t+f*rt)*Rt,a[14]=($*ue-B*Ae-K*Ce)*Rt,a[15]=(A*Ae-P*ue+L*Ce)*Rt,a):null}function ol(a,o,l){var u=o[0],f=o[1],b=o[2],v=o[3],w=o[4],T=o[5],E=o[6],A=o[7],P=o[8],L=o[9],N=o[10],B=o[11],$=o[12],K=o[13],ce=o[14],Ce=o[15],ue=l[0],ve=l[1],Ae=l[2],ke=l[3];return a[0]=ue*u+ve*w+Ae*P+ke*$,a[1]=ue*f+ve*T+Ae*L+ke*K,a[2]=ue*b+ve*E+Ae*N+ke*ce,a[3]=ue*v+ve*A+Ae*B+ke*Ce,a[4]=(ue=l[4])*u+(ve=l[5])*w+(Ae=l[6])*P+(ke=l[7])*$,a[5]=ue*f+ve*T+Ae*L+ke*K,a[6]=ue*b+ve*E+Ae*N+ke*ce,a[7]=ue*v+ve*A+Ae*B+ke*Ce,a[8]=(ue=l[8])*u+(ve=l[9])*w+(Ae=l[10])*P+(ke=l[11])*$,a[9]=ue*f+ve*T+Ae*L+ke*K,a[10]=ue*b+ve*E+Ae*N+ke*ce,a[11]=ue*v+ve*A+Ae*B+ke*Ce,a[12]=(ue=l[12])*u+(ve=l[13])*w+(Ae=l[14])*P+(ke=l[15])*$,a[13]=ue*f+ve*T+Ae*L+ke*K,a[14]=ue*b+ve*E+Ae*N+ke*ce,a[15]=ue*v+ve*A+Ae*B+ke*Ce,a}function ng(a,o,l){var u,f,b,v,w,T,E,A,P,L,N,B,$=l[0],K=l[1],ce=l[2];return o===a?(a[12]=o[0]*$+o[4]*K+o[8]*ce+o[12],a[13]=o[1]*$+o[5]*K+o[9]*ce+o[13],a[14]=o[2]*$+o[6]*K+o[10]*ce+o[14],a[15]=o[3]*$+o[7]*K+o[11]*ce+o[15]):(f=o[1],b=o[2],v=o[3],w=o[4],T=o[5],E=o[6],A=o[7],P=o[8],L=o[9],N=o[10],B=o[11],a[0]=u=o[0],a[1]=f,a[2]=b,a[3]=v,a[4]=w,a[5]=T,a[6]=E,a[7]=A,a[8]=P,a[9]=L,a[10]=N,a[11]=B,a[12]=u*$+w*K+P*ce+o[12],a[13]=f*$+T*K+L*ce+o[13],a[14]=b*$+E*K+N*ce+o[14],a[15]=v*$+A*K+B*ce+o[15]),a}function ku(a,o,l){var u=l[0],f=l[1],b=l[2];return a[0]=o[0]*u,a[1]=o[1]*u,a[2]=o[2]*u,a[3]=o[3]*u,a[4]=o[4]*f,a[5]=o[5]*f,a[6]=o[6]*f,a[7]=o[7]*f,a[8]=o[8]*b,a[9]=o[9]*b,a[10]=o[10]*b,a[11]=o[11]*b,a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15],a}function g_(a,o,l){var u=Math.sin(l),f=Math.cos(l),b=o[4],v=o[5],w=o[6],T=o[7],E=o[8],A=o[9],P=o[10],L=o[11];return o!==a&&(a[0]=o[0],a[1]=o[1],a[2]=o[2],a[3]=o[3],a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15]),a[4]=b*f+E*u,a[5]=v*f+A*u,a[6]=w*f+P*u,a[7]=T*f+L*u,a[8]=E*f-b*u,a[9]=A*f-v*u,a[10]=P*f-w*u,a[11]=L*f-T*u,a}function ig(a,o,l){var u=Math.sin(l),f=Math.cos(l),b=o[0],v=o[1],w=o[2],T=o[3],E=o[8],A=o[9],P=o[10],L=o[11];return o!==a&&(a[4]=o[4],a[5]=o[5],a[6]=o[6],a[7]=o[7],a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15]),a[0]=b*f-E*u,a[1]=v*f-A*u,a[2]=w*f-P*u,a[3]=T*f-L*u,a[8]=b*u+E*f,a[9]=v*u+A*f,a[10]=w*u+P*f,a[11]=T*u+L*f,a}function Xv(a,o){return a[0]=o[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=o[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=o[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function Zv(a,o,l){var u,f,b,v=l[0],w=l[1],T=l[2],E=Math.hypot(v,w,T);return E<tg?null:(v*=E=1/E,w*=E,T*=E,u=Math.sin(o),f=Math.cos(o),a[0]=v*v*(b=1-f)+f,a[1]=w*v*b+T*u,a[2]=T*v*b-w*u,a[3]=0,a[4]=v*w*b-T*u,a[5]=w*w*b+f,a[6]=T*w*b+v*u,a[7]=0,a[8]=v*T*b+w*u,a[9]=w*T*b-v*u,a[10]=T*T*b+f,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a)}Math.hypot||(Math.hypot=function(){for(var a=0,o=arguments.length;o--;)a+=arguments[o]*arguments[o];return Math.sqrt(a)});var GS=ol;function b_(){var a=new Aa(3);return Aa!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function rg(a){var o=new Aa(3);return o[0]=a[0],o[1]=a[1],o[2]=a[2],o}function Ru(a){return Math.hypot(a[0],a[1],a[2])}function mf(a,o,l){var u=new Aa(3);return u[0]=a,u[1]=o,u[2]=l,u}function ka(a,o,l){return a[0]=o[0]+l[0],a[1]=o[1]+l[1],a[2]=o[2]+l[2],a}function gf(a,o,l){return a[0]=o[0]-l[0],a[1]=o[1]-l[1],a[2]=o[2]-l[2],a}function bf(a,o,l){return a[0]=o[0]*l[0],a[1]=o[1]*l[1],a[2]=o[2]*l[2],a}function _f(a,o,l){return a[0]=Math.min(o[0],l[0]),a[1]=Math.min(o[1],l[1]),a[2]=Math.min(o[2],l[2]),a}function yf(a,o,l){return a[0]=Math.max(o[0],l[0]),a[1]=Math.max(o[1],l[1]),a[2]=Math.max(o[2],l[2]),a}function Ra(a,o,l){return a[0]=o[0]*l,a[1]=o[1]*l,a[2]=o[2]*l,a}function Yh(a,o,l,u){return a[0]=o[0]+l[0]*u,a[1]=o[1]+l[1]*u,a[2]=o[2]+l[2]*u,a}function Po(a,o){var l=o[0],u=o[1],f=o[2],b=l*l+u*u+f*f;return b>0&&(b=1/Math.sqrt(b)),a[0]=o[0]*b,a[1]=o[1]*b,a[2]=o[2]*b,a}function xs(a,o){return a[0]*o[0]+a[1]*o[1]+a[2]*o[2]}function __(a,o,l){var u=o[0],f=o[1],b=o[2],v=l[0],w=l[1],T=l[2];return a[0]=f*T-b*w,a[1]=b*v-u*T,a[2]=u*w-f*v,a}function ze(a,o,l){var u=o[0],f=o[1],b=o[2],v=l[3]*u+l[7]*f+l[11]*b+l[15];return a[0]=(l[0]*u+l[4]*f+l[8]*b+l[12])/(v=v||1),a[1]=(l[1]*u+l[5]*f+l[9]*b+l[13])/v,a[2]=(l[2]*u+l[6]*f+l[10]*b+l[14])/v,a}function y_(a,o,l){var u=l[0],f=l[1],b=l[2],v=o[0],w=o[1],T=o[2],E=f*T-b*w,A=b*v-u*T,P=u*w-f*v,L=f*P-b*A,N=b*E-u*P,B=u*A-f*E,$=2*l[3];return A*=$,P*=$,N*=2,B*=2,a[0]=v+(E*=$)+(L*=2),a[1]=w+A+N,a[2]=T+P+B,a}var Fr,Pa=gf,vf=bf,qS=Ru;function Yv(a,o,l){return a[0]=o[0]*l,a[1]=o[1]*l,a[2]=o[2]*l,a[3]=o[3]*l,a}function Kv(a,o){var l=o[0],u=o[1],f=o[2],b=o[3],v=l*l+u*u+f*f+b*b;return v>0&&(v=1/Math.sqrt(v)),a[0]=l*v,a[1]=u*v,a[2]=f*v,a[3]=b*v,a}function $c(a,o,l){var u=o[0],f=o[1],b=o[2],v=o[3];return a[0]=l[0]*u+l[4]*f+l[8]*b+l[12]*v,a[1]=l[1]*u+l[5]*f+l[9]*b+l[13]*v,a[2]=l[2]*u+l[6]*f+l[10]*b+l[14]*v,a[3]=l[3]*u+l[7]*f+l[11]*b+l[15]*v,a}function Kh(){var a=new Aa(4);return Aa!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function v_(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a}function Qh(a,o,l){l*=.5;var u=o[0],f=o[1],b=o[2],v=o[3],w=Math.sin(l),T=Math.cos(l);return a[0]=u*T+v*w,a[1]=f*T+b*w,a[2]=b*T-f*w,a[3]=v*T-u*w,a}function Qv(a,o,l){l*=.5;var u=o[0],f=o[1],b=o[2],v=o[3],w=Math.sin(l),T=Math.cos(l);return a[0]=u*T-b*w,a[1]=f*T+v*w,a[2]=b*T+u*w,a[3]=v*T-f*w,a}b_(),Fr=new Aa(4),Aa!=Float32Array&&(Fr[0]=0,Fr[1]=0,Fr[2]=0,Fr[3]=0);var Jv=Kv;b_(),mf(1,0,0),mf(0,1,0),Kh(),Kh(),$S();const xf=He([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:wf}=xf,x_=He([{name:"a_pos_3",components:3,type:"Int16"}]);var Sf=He([{name:"a_pos",type:"Int16",components:2}]);class w_{constructor(o,l){this.pos=o,this.dir=l}intersectsPlane(o,l,u){const f=xs(l,this.dir);if(Math.abs(f)<1e-6)return!1;const b=((o[0]-this.pos[0])*l[0]+(o[1]-this.pos[1])*l[1]+(o[2]-this.pos[2])*l[2])/f;return u[0]=this.pos[0]+this.dir[0]*b,u[1]=this.pos[1]+this.dir[1]*b,u[2]=this.pos[2]+this.dir[2]*b,!0}closestPointOnSphere(o,l,u){if($=(N=this.pos)[0],K=N[1],ce=N[2],Ce=(B=o)[0],ue=B[1],ve=B[2],Math.abs($-Ce)<=tg*Math.max(1,Math.abs($),Math.abs(Ce))&&Math.abs(K-ue)<=tg*Math.max(1,Math.abs(K),Math.abs(ue))&&Math.abs(ce-ve)<=tg*Math.max(1,Math.abs(ce),Math.abs(ve))||0===l)return u[0]=u[1]=u[2]=0,!1;var N,B,$,K,ce,Ce,ue,ve;const[f,b,v]=this.dir,w=this.pos[0]-o[0],T=this.pos[1]-o[1],E=this.pos[2]-o[2],A=f*f+b*b+v*v,P=2*(w*f+T*b+E*v),L=P*P-4*A*(w*w+T*T+E*E-l*l);if(L<0){const N=Math.max(-P/2,0),B=w+f*N,$=T+b*N,K=E+v*N,ce=Math.hypot(B,$,K);return u[0]=B*l/ce,u[1]=$*l/ce,u[2]=K*l/ce,!1}{const N=(-P-Math.sqrt(L))/(2*A);if(N<0){const B=Math.hypot(w,T,E);return u[0]=w*l/B,u[1]=T*l/B,u[2]=E*l/B,!1}return u[0]=w+f*N,u[1]=T+b*N,u[2]=E+v*N,!0}}}class Pu{constructor(o,l,u,f,b){this.TL=o,this.TR=l,this.BR=u,this.BL=f,this.horizon=b}static fromInvProjectionMatrix(o,l,u){const f=[-1,1,1],b=[1,1,1],v=[1,-1,1],w=[-1,-1,1],T=ze(f,f,o),E=ze(b,b,o),A=ze(v,v,o),P=ze(w,w,o);return new Pu(T,E,A,P,l/u)}}class Nd{constructor(o,l){this.points=o,this.planes=l}static fromInvProjectionMatrix(o,l,u,f){const b=Math.pow(2,u),v=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(T=>{const E=$c([],T,o),A=1/E[3]/l*b;return(P=E)[0]=(L=E)[0]*(N=[A,A,f?1/E[3]:A,A])[0],P[1]=L[1]*N[1],P[2]=L[2]*N[2],P[3]=L[3]*N[3],P;var P,L,N}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(T=>{const E=Po([],__([],Pa([],v[T[0]],v[T[1]]),Pa([],v[T[2]],v[T[1]]))),A=-xs(E,v[T[1]]);return E.concat(A)});return new Nd(v,w)}}class Bs{static fromPoints(o){const l=[1/0,1/0,1/0],u=[-1/0,-1/0,-1/0];for(const f of o)_f(l,l,f),yf(u,u,f);return new Bs(l,u)}static applyTransform(o,l){const u=o.getCorners();for(let f=0;f<u.length;++f)ze(u[f],u[f],l);return Bs.fromPoints(u)}constructor(o,l){this.min=o,this.max=l,this.center=Ra([],ka([],this.min,this.max),.5)}quadrant(o){const l=[o%2==0,o<2],u=rg(this.min),f=rg(this.max);for(let b=0;b<l.length;b++)u[b]=l[b]?this.min[b]:this.center[b],f[b]=l[b]?this.center[b]:this.max[b];return f[2]=this.max[2],new Bs(u,f)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}distanceZ(o){return Math.max(Math.min(this.max[2],o[2]),this.min[2])-o[2]}getCorners(){const o=this.min,l=this.max;return[[o[0],o[1],o[2]],[l[0],o[1],o[2]],[l[0],l[1],o[2]],[o[0],l[1],o[2]],[o[0],o[1],l[2]],[l[0],o[1],l[2]],[l[0],l[1],l[2]],[o[0],l[1],l[2]]]}intersects(o){const l=this.getCorners();let u=!0;for(let f=0;f<o.planes.length;f++){const b=o.planes[f];let v=0;for(let w=0;w<l.length;w++)v+=xs(b,l[w])+b[3]>=0;if(0===v)return 0;v!==l.length&&(u=!1)}if(u)return 2;for(let f=0;f<3;f++){let b=Number.MAX_VALUE,v=-Number.MAX_VALUE;for(let w=0;w<o.points.length;w++){const T=o.points[w][f]-this.min[f];b=Math.min(b,T),v=Math.max(v,T)}if(v<0||b>this.max[f]-this.min[f])return 0}return 1}}const sc=Pn/Math.PI/2,Cf=[64,32,16],sl=-sc,Ys=sc,t0=[new Bs([sl,sl,sl],[Ys,Ys,Ys]),new Bs([sl,sl,sl],[0,0,Ys]),new Bs([0,sl,sl],[Ys,0,Ys]),new Bs([sl,0,sl],[0,Ys,Ys]),new Bs([0,0,sl],[Ys,Ys,Ys])];function og(a){return a*sc/Mf}function C_(a,o,l,u=!0){const f=Ra([],a._camera.position,a.worldSize),b=[o,l,1,1];$c(b,b,a.pixelMatrixInverse),Yv(b,b,1/b[3]);const v=Po([],Pa([],b,f)),w=a.globeMatrix,T=[w[12],w[13],w[14]],E=Pa([],T,f),A=Ru(E),P=Po([],E),L=a.worldSize/(2*Math.PI),N=xs(P,v),B=Math.asin(L/A);if(B<Math.acos(N)){if(!u)return null;const zt=[],ht=[];Ra(zt,v,A/N),Po(ht,Pa(ht,zt,E)),Po(v,ka(v,E,Ra(v,ht,Math.tan(B)*A)))}const $=[];new w_(f,v).closestPointOnSphere(T,L,$);const K=Po([],Ke(w,0)),ce=Po([],Ke(w,1)),Ce=Po([],Ke(w,2)),ue=xs(K,$),ve=xs(ce,$),Ae=xs(Ce,$),ke=me(Math.asin(-ve/L));let at=me(Math.atan2(ue,Ae));at=a.center.lng+function(zt,ht){const Dt=(ht-zt+180)%360-180;return Dt<-180?Dt+360:Dt}(a.center.lng,at);const rt=lc(at),_t=Tt(Al(ke),0,1);return new To(rt,_t)}class II{constructor(o,l,u){this.a=Pa([],o,u),this.b=Pa([],l,u),this.center=u;const f=Po([],this.a),b=Po([],this.b);this.angle=Math.acos(xs(f,b))}}function sg(a,o){if(0===a.angle)return null;let l;return l=0===a.a[o]?1/a.angle*.5*Math.PI:1/a.angle*Math.atan(a.b[o]/a.a[o]/Math.sin(a.angle)-1/Math.tan(a.angle)),l<0||l>1?null:function(u,f,b,v){const w=Math.sin(b);return u*(Math.sin((1-v)*b)/w)+f*(Math.sin(v*b)/w)}(a.a[o],a.b[o],a.angle,Tt(l,0,1))+a.center[o]}function Gc(a){if(a.z<=1)return t0[a.z+2*a.y+a.x];const o=Tf(T_(a));return Bs.fromPoints(o)}function zd(a,o,l){return Ra(a,a,1-l),Yh(a,a,o,l)}function n0(a,o){const l=Vd(o.zoom);if(0===l)return Gc(a);const u=T_(a),f=Tf(u),b=lc(u.getWest())*o.worldSize,v=lc(u.getEast())*o.worldSize,w=Al(u.getNorth())*o.worldSize,T=Al(u.getSouth())*o.worldSize,E=[b,w,0],A=[v,w,0],P=[b,T,0],L=[v,T,0],N=ff([],o.globeMatrix);return ze(E,E,N),ze(A,A,N),ze(P,P,N),ze(L,L,N),f[0]=zd(f[0],P,l),f[1]=zd(f[1],L,l),f[2]=zd(f[2],A,l),f[3]=zd(f[3],E,l),Bs.fromPoints(f)}function ag(a,o,l){for(const u of a)ze(u,u,o),Ra(u,u,l)}function T_({x:a,y:o,z:l}){const u=1/(1<<l),f=new yr(La(a*u),vr((o+1)*u)),b=new yr(La((a+1)*u),vr(o*u));return new Au(f,b)}function Tf(a){const o=re(a.getNorth()),l=re(a.getSouth()),u=Math.cos(o),f=Math.cos(l),b=Math.sin(o),v=Math.sin(l),w=a.getWest(),T=a.getEast();return[Ef(f,v,w),Ef(f,v,T),Ef(u,b,T),Ef(u,b,w)]}function Ef(a,o,l,u=sc){return l=re(l),[a*Math.sin(l)*u,-o*u,a*Math.cos(l)*u]}function Df(a,o,l){return Ef(Math.cos(re(a)),Math.sin(re(a)),o,l)}function lg(a,o,l,u){const f=1<<l.z,b=(a/Pn+l.x)/f;return Df(vr((o/Pn+l.y)/f),La(b),u)}function E_({min:a,max:o}){return 16383/Math.max(o[0]-a[0],o[1]-a[1],o[2]-a[2])}const WS=new Float64Array(16);function If(a){const o=E_(a),l=Xv(WS,[o,o,o]);return ng(l,l,((u=[])[0]=-(f=a.min)[0],u[1]=-f[1],u[2]=-f[2],u));var u,f}function cg(a){const o=(u=a.min,(l=WS)[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=u[0],l[13]=u[1],l[14]=u[2],l[15]=1,l);var l,u;const f=1/E_(a);return ku(o,o,[f,f,f])}function ug(a,o,l,u,f){const b=function(T){const E=Pn/(2*Math.PI);return T/(2*Math.PI)/E}(l),v=[a,o,-l/(2*Math.PI)],w=ho(new Float64Array(16));return ng(w,w,v),ku(w,w,[b,b,b]),g_(w,w,re(-f)),ig(w,w,re(-u)),w}function Vd(a){return ri(5,6,a)}function D_(a,o){const l=Df(o.lat,o.lng);return v=(f=gf([],function(B){const $=Df(B._center.lat,B._center.lng);let K=__([],mf(0,1,0),$);const ce=Zv([],-B.angle,$);K=ze(K,K,ce),Zv(ce,-B._pitch,K);const Ce=Po([],$);return Ra(Ce,Ce,og(B.cameraToCenterDistance/B.pixelsPerMeter)),ze(Ce,Ce,ce),ka([],$,Ce)}(a),l))[0],w=f[1],T=f[2],E=(b=l)[0],A=b[1],P=b[2],N=(L=Math.sqrt(v*v+w*w+T*T)*Math.sqrt(E*E+A*A+P*P))&&xs(f,b)/L,Math.acos(Math.min(Math.max(N,-1),1));var f,b,v,w,T,E,A,P,L,N}function dg(a,o){return D_(a,o)>Math.PI/2*1.01}const Ks=re(85),XS=Math.cos(Ks),ZS=Math.sin(Ks),Mf=6371008.8,I_=2*Math.PI*Mf;class ac{constructor(o,l){if(isNaN(o)||isNaN(l))throw new Error(`Invalid LngLat object: (${o}, ${l})`);if(this.lng=+o,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ac(kt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(o){const l=Math.PI/180,u=this.lat*l,f=o.lat*l,b=Math.sin(u)*Math.sin(f)+Math.cos(u)*Math.cos(f)*Math.cos((o.lng-this.lng)*l);return Mf*Math.acos(Math.min(b,1))}toBounds(o=0){const l=360*o/40075017,u=l/Math.cos(Math.PI/180*this.lat);return new Au(new ac(this.lng-u,this.lat-l),new ac(this.lng+u,this.lat+l))}toEcef(o){const l=og(o);return Df(this.lat,this.lng,sc+l)}static convert(o){if(o instanceof ac)return o;if(Array.isArray(o)&&(2===o.length||3===o.length))return new ac(Number(o[0]),Number(o[1]));if(!Array.isArray(o)&&"object"==typeof o&&null!==o)return new ac(Number("lng"in o?o.lng:o.lon),Number(o.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var yr=ac;function M_(a){return I_*Math.cos(a*Math.PI/180)}function lc(a){return(180+a)/360}function Al(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function kl(a,o){return a/M_(o)}function La(a){return 360*a-180}function vr(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function hg(a,o){return a*M_(vr(o))}const Go=85.051129;function pg(a){return 1/Math.cos(a*Math.PI/180)}class To{constructor(o,l,u=0){this.x=+o,this.y=+l,this.z=+u}static fromLngLat(o,l=0){const u=yr.convert(o);return new To(lc(u.lng),Al(u.lat),kl(l,u.lat))}toLngLat(){return new yr(La(this.x),vr(this.y))}toAltitude(){return hg(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/I_*pg(vr(this.y))}}function jd(a,o,l,u,f,b,v,w,T){const E=(o+u)/2,A=(l+f)/2,P=new Ie(E,A);w(P),function(L,N,B,$,K,ce){const Ce=B-K,ue=$-ce;return Math.abs(($-N)*Ce-(B-L)*ue)/Math.hypot(Ce,ue)}(P.x,P.y,b.x,b.y,v.x,v.y)>=T?(jd(a,o,l,E,A,b,P,w,T),jd(a,E,A,u,f,P,v,w,T)):a.push(v)}function A_(a,o,l){let u=a[0],f=u.x,b=u.y;o(u);const v=[u];for(let w=1;w<a.length;w++){const T=a[w],{x:E,y:A}=T;o(T),jd(v,f,b,E,A,u,T,o,l),f=E,b=A,u=T}return v}function k_(a,o,l,u){if(u(o,l)){const f=o.add(l)._mult(.5);k_(a,o,f,u),k_(a,f,l,u)}else a.push(l)}function YS(a,o){let l=a[0];const u=[l];for(let f=1;f<a.length;f++){const b=a[f];k_(u,l,b,o),l=b}return u}const fg=Math.pow(2,14)-1,r0=-fg-1;function o0(a,o){const l=Math.round(a.x*o),u=Math.round(a.y*o);return a.x=Tt(l,r0,fg),a.y=Tt(u,r0,fg),(l<a.x||l>a.x+1||u<a.y||u>a.y+1)&&Qn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),a}function qc(a,o,l){const u=a.loadGeometry(),f=a.extent,b=Pn/f;if(o&&l&&l.projection.isReprojectedInTileSpace){const v=1<<o.z,{scale:w,x:T,y:E,projection:A}=l,P=L=>{const N=La((o.x+L.x/f)/v),B=vr((o.y+L.y/f)/v),$=A.project(N,B);L.x=($.x*w-T)*f,L.y=($.y*w-E)*f};for(let L=0;L<u.length;L++)if(1!==a.type)u[L]=A_(u[L],P,1);else{const N=[];for(const B of u[L])B.x<0||B.x>=f||B.y<0||B.y>=f||(P(B),N.push(B));u[L]=N}}for(const v of u)for(const w of v)o0(w,b);return u}function Lu(a,o){return{type:a.type,id:a.id,properties:a.properties,geometry:o?qc(a):[]}}function mg(a,o,l,u,f){a.emplaceBack(2*o+(u+1)/2,2*l+(f+1)/2)}function gg(a,o,l){a.emplaceBack(o.x,o.y,o.z,16384*l[0],16384*l[1],16384*l[2])}class Af{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.id),this.index=o.index,this.hasPattern=!1,this.projection=o.projection,this.layoutVertexArray=new Ft,this.indexArray=new En,this.segments=new Hr,this.programConfigurations=new Zh(o.layers,o.zoom),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(o,l,u,f){const b=this.layers[0],v=[];let w=null;"circle"===b.type&&(w=b.layout.get("circle-sort-key"));for(const{feature:E,id:A,index:P,sourceLayerIndex:L}of o){const N=this.layers[0]._featureFilter.needGeometry,B=Lu(E,N);if(!this.layers[0]._featureFilter.filter(new R(this.zoom),B,u))continue;const $=w?w.evaluate(B,{},u):void 0,K={id:A,properties:E.properties,type:E.type,sourceLayerIndex:L,index:P,geometry:N?B.geometry:qc(E,u,f),patterns:{},sortKey:$};v.push(K)}w&&v.sort((E,A)=>E.sortKey-A.sortKey);let T=null;"globe"===f.projection.name&&(this.globeExtVertexArray=new Bt,T=f.projection);for(const E of v){const{geometry:A,index:P,sourceLayerIndex:L}=E,N=o[P].feature;this.addFeature(E,A,P,l.availableImages,u,T),l.featureIndex.insert(N,A,P,L,this.index)}}update(o,l,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,l,this.stateDependentLayers,u,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Wv.members),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=o.createVertexBuffer(this.globeExtVertexArray,eg.members))),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(o,l,u,f,b,v){for(const w of l)for(const T of w){const E=T.x,A=T.y;if(E<0||E>=Pn||A<0||A>=Pn)continue;if(v){const N=v.projectTilePoint(E,A,b),B=v.upVector(b,E,A),$=this.globeExtVertexArray;gg($,N,B),gg($,N,B),gg($,N,B),gg($,N,B)}const P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,o.sortKey),L=P.vertexLength;mg(this.layoutVertexArray,E,A,-1,-1),mg(this.layoutVertexArray,E,A,1,-1),mg(this.layoutVertexArray,E,A,1,1),mg(this.layoutVertexArray,E,A,-1,1),this.indexArray.emplaceBack(L,L+1,L+2),this.indexArray.emplaceBack(L,L+2,L+3),P.vertexLength+=4,P.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,u,{},f,b)}}function bg(a,o){for(let l=0;l<a.length;l++)if(Ou(o,a[l]))return!0;for(let l=0;l<o.length;l++)if(Ou(a,o[l]))return!0;return!!Ud(a,o)}function KS(a,o,l){return!!Ou(a,o)||!!P_(o,a,l)}function R_(a,o){if(1===a.length)return yg(o,a[0]);for(let l=0;l<o.length;l++){const u=o[l];for(let f=0;f<u.length;f++)if(Ou(a,u[f]))return!0}for(let l=0;l<a.length;l++)if(yg(o,a[l]))return!0;for(let l=0;l<o.length;l++)if(Ud(a,o[l]))return!0;return!1}function QS(a,o,l){if(a.length>1){if(Ud(a,o))return!0;for(let u=0;u<o.length;u++)if(P_(o[u],a,l))return!0}for(let u=0;u<a.length;u++)if(P_(a[u],o,l))return!0;return!1}function Ud(a,o){if(0===a.length||0===o.length)return!1;for(let l=0;l<a.length-1;l++){const u=a[l],f=a[l+1];for(let b=0;b<o.length-1;b++)if(JS(u,f,o[b],o[b+1]))return!0}return!1}function JS(a,o,l,u){return vi(a,l,u)!==vi(o,l,u)&&vi(a,o,l)!==vi(a,o,u)}function P_(a,o,l){const u=l*l;if(1===o.length)return a.distSqr(o[0])<u;for(let f=1;f<o.length;f++)if(_g(a,o[f-1],o[f])<u)return!0;return!1}function _g(a,o,l){const u=o.distSqr(l);if(0===u)return a.distSqr(o);const f=((a.x-o.x)*(l.x-o.x)+(a.y-o.y)*(l.y-o.y))/u;return a.distSqr(f<0?o:f>1?l:l.sub(o)._mult(f)._add(o))}function yg(a,o){let l,u,f,b=!1;for(let v=0;v<a.length;v++){l=a[v];for(let w=0,T=l.length-1;w<l.length;T=w++)u=l[w],f=l[T],u.y>o.y!=f.y>o.y&&o.x<(f.x-u.x)*(o.y-u.y)/(f.y-u.y)+u.x&&(b=!b)}return b}function Ou(a,o){let l=!1;for(let u=0,f=a.length-1;u<a.length;f=u++){const b=a[u],v=a[f];b.y>o.y!=v.y>o.y&&o.x<(v.x-b.x)*(o.y-b.y)/(v.y-b.y)+b.x&&(l=!l)}return l}function e1(a,o,l,u,f){for(const v of a)if(o<=v.x&&l<=v.y&&u>=v.x&&f>=v.y)return!0;const b=[new Ie(o,l),new Ie(o,f),new Ie(u,f),new Ie(u,l)];if(a.length>2)for(const v of b)if(Ou(a,v))return!0;for(let v=0;v<a.length-1;v++)if(Jh(a[v],a[v+1],b))return!0;return!1}function Jh(a,o,l){const u=l[0],f=l[2];if(a.x<u.x&&o.x<u.x||a.x>f.x&&o.x>f.x||a.y<u.y&&o.y<u.y||a.y>f.y&&o.y>f.y)return!1;const b=vi(a,o,l[0]);return b!==vi(a,o,l[1])||b!==vi(a,o,l[2])||b!==vi(a,o,l[3])}function Fu(a,o,l){const u=o.paint.get(a).value;return"constant"===u.kind?u.value:l.programConfigurations.get(o.id).getMaxValue(a)}function kf(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function s0(a,o,l,u,f){if(!o[0]&&!o[1])return a;const b=Ie.convert(o)._mult(f);"viewport"===l&&b._rotate(-u);const v=[];for(let w=0;w<a.length;w++)v.push(a[w].sub(b));return v}function vg(a,o,l,u){const f=Ie.convert(a)._mult(u);return"viewport"===o&&f._rotate(-l),f}gn(Af,"CircleBucket",{omit:["layers"]});const t1=new ge({"circle-sort-key":new J(bt.layout_circle["circle-sort-key"])});var n1={paint:new ge({"circle-radius":new J(bt.paint_circle["circle-radius"]),"circle-color":new J(bt.paint_circle["circle-color"]),"circle-blur":new J(bt.paint_circle["circle-blur"]),"circle-opacity":new J(bt.paint_circle["circle-opacity"]),"circle-translate":new U(bt.paint_circle["circle-translate"]),"circle-translate-anchor":new U(bt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new U(bt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new U(bt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new J(bt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new J(bt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new J(bt.paint_circle["circle-stroke-opacity"])}),layout:t1};function a0(a,o,l,u,f,b,v,w,T){if(b&&a.queryGeometry.isAboveHorizon)return!1;b&&(T*=a.pixelToTileUnitsFactor);const E=a.tileID.canonical,A=l.projection.upVectorScale(E,l.center.lat,l.worldSize).metersToTile;for(const P of o)for(const L of P){const N=L.add(w),B=f&&l.elevation?l.elevation.exaggeration()*f.getElevationAt(N.x,N.y,!0):0,$=l.projection.projectTilePoint(N.x,N.y,E);if(B>0){const ue=l.projection.upVector(E,N.x,N.y);$.x+=ue[0]*A*B,$.y+=ue[1]*A*B,$.z+=ue[2]*A*B}const K=b?N:r1($.x,$.y,$.z,u),ce=b?a.tilespaceRays.map(ue=>c0(ue,B)):a.queryGeometry.screenGeometry,Ce=$c([],[$.x,$.y,$.z,1],u);if(!v&&b?T*=Ce[3]/l.cameraToCenterDistance:v&&!b&&(T*=l.cameraToCenterDistance/Ce[3]),b){const ue=vr((L.y/Pn+E.y)/(1<<E.z));T/=l.projection.pixelsPerMeter(ue,1)/kl(1,ue)}if(KS(ce,K,T))return!0}return!1}function r1(a,o,l,u){const f=$c([],[a,o,l,1],u);return new Ie(f[0]/f[3],f[1]/f[3])}const l0=mf(0,0,0),o1=mf(0,0,1);function c0(a,o){const l=b_();return l0[2]=o,a.intersectsPlane(l0,o1,l),new Ie(l[0],l[1])}class xg extends Af{}function L_(a,{width:o,height:l},u,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==o*l*u)throw new RangeError("mismatched image size")}else f=new Uint8Array(o*l*u);return a.width=o,a.height=l,a.data=f,a}function wg(a,o,l){const{width:u,height:f}=o;u===a.width&&f===a.height||(O_(a,o,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,u),height:Math.min(a.height,f)},l),a.width=u,a.height=f,a.data=o.data)}function O_(a,o,l,u,f,b){if(0===f.width||0===f.height)return o;if(f.width>a.width||f.height>a.height||l.x>a.width-f.width||l.y>a.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>o.width||f.height>o.height||u.x>o.width-f.width||u.y>o.height-f.height)throw new RangeError("out of range destination coordinates for image copy");const v=a.data,w=o.data;for(let T=0;T<f.height;T++){const E=((l.y+T)*a.width+l.x)*b,A=((u.y+T)*o.width+u.x)*b;for(let P=0;P<f.width*b;P++)w[A+P]=v[E+P]}return o}gn(xg,"HeatmapBucket",{omit:["layers"]});class Wc{constructor(o,l){L_(this,o,1,l)}resize(o){wg(this,new Wc(o),1)}clone(){return new Wc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,l,u,f,b){O_(o,l,u,f,b,1)}}class Qs{constructor(o,l){L_(this,o,4,l)}resize(o){wg(this,new Qs(o),4)}replace(o,l){l?this.data.set(o):this.data=o instanceof Uint8ClampedArray?new Uint8Array(o.buffer):o}clone(){return new Qs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,l,u,f,b){O_(o,l,u,f,b,4)}}gn(Wc,"AlphaImage"),gn(Qs,"RGBAImage");var u0={paint:new ge({"heatmap-radius":new J(bt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new J(bt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new U(bt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new pe(bt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new U(bt.paint_heatmap["heatmap-opacity"])})};function Xc(a){const o={},l=a.resolution||256,u=a.clips?a.clips.length:1,f=a.image||new Qs({width:l,height:u}),b=(v,w,T)=>{o[a.evaluationKey]=T;const E=a.expression.evaluate(o);f.data[v+w+0]=Math.floor(255*E.r/E.a),f.data[v+w+1]=Math.floor(255*E.g/E.a),f.data[v+w+2]=Math.floor(255*E.b/E.a),f.data[v+w+3]=Math.floor(255*E.a)};if(a.clips)for(let v=0,w=0;v<u;++v,w+=4*l)for(let T=0,E=0;T<l;T++,E+=4){const A=T/(l-1),{start:P,end:L}=a.clips[v];b(w,E,P*(1-A)+L*A)}else for(let v=0,w=0;v<l;v++,w+=4)b(0,w,v/(l-1));return f}var d0={paint:new ge({"hillshade-illumination-direction":new U(bt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new U(bt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new U(bt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new U(bt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new U(bt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new U(bt.paint_hillshade["hillshade-accent-color"])})};const h0=He([{name:"a_pos",components:2,type:"Int16"}],4),{members:s1}=h0;var p0={exports:{}};function Hd(a,o,l){l=l||2;var u,f,b,v,w,T,E,A=o&&o.length,P=A?o[0]*l:a.length,L=f0(a,0,P,l,!0),N=[];if(!L||L.next===L.prev)return N;if(A&&(L=function($,K,ce,Ce){var ue,ve,Ae,ke=[];for(ue=0,ve=K.length;ue<ve;ue++)(Ae=f0($,K[ue]*Ce,ue<ve-1?K[ue+1]*Ce:$.length,Ce,!1))===Ae.next&&(Ae.steiner=!0),ke.push(B_(Ae));for(ke.sort(Cg),ue=0;ue<ke.length;ue++)ce=b0(ke[ue],ce);return ce}(a,o,L,l)),a.length>80*l){u=b=a[0],f=v=a[1];for(var B=l;B<P;B+=l)(w=a[B])<u&&(u=w),(T=a[B+1])<f&&(f=T),w>b&&(b=w),T>v&&(v=T);E=0!==(E=Math.max(b-u,v-f))?32767/E:0}return ep(L,N,l,u,f,E,0),N}function f0(a,o,l,u,f){var b,v;if(f===y0(a,o,l,u)>0)for(b=o;b<l;b+=u)v=zu(b,a[b],a[b+1],v);else for(b=l-u;b>=o;b-=u)v=zu(b,a[b],a[b+1],v);return v&&Tg(v,v.next)&&(Lf(v),v=v.next),v}function Nu(a,o){if(!a)return a;o||(o=a);var l,u=a;do{if(l=!1,u.steiner||!Tg(u,u.next)&&0!==oo(u.prev,u,u.next))u=u.next;else{if(Lf(u),(u=o=u.prev)===u.next)break;l=!0}}while(l||u!==o);return o}function ep(a,o,l,u,f,b,v){if(a){!v&&b&&function(A,P,L,N){var B=A;do{0===B.z&&(B.z=Rf(B.x,B.y,P,L,N)),B.prevZ=B.prev,B.nextZ=B.next,B=B.next}while(B!==A);B.prevZ.nextZ=null,B.prevZ=null,function($){var K,ce,Ce,ue,ve,Ae,ke,at,rt=1;do{for(ce=$,$=null,ve=null,Ae=0;ce;){for(Ae++,Ce=ce,ke=0,K=0;K<rt&&(ke++,Ce=Ce.nextZ);K++);for(at=rt;ke>0||at>0&&Ce;)0!==ke&&(0===at||!Ce||ce.z<=Ce.z)?(ue=ce,ce=ce.nextZ,ke--):(ue=Ce,Ce=Ce.nextZ,at--),ve?ve.nextZ=ue:$=ue,ue.prevZ=ve,ve=ue;ce=Ce}ve.nextZ=null,rt*=2}while(Ae>1)}(B)}(a,u,f,b);for(var w,T,E=a;a.prev!==a.next;)if(w=a.prev,T=a.next,b?F_(a,u,f,b):m0(a))o.push(w.i/l|0),o.push(a.i/l|0),o.push(T.i/l|0),Lf(a),a=T.next,E=T.next;else if((a=T)===E){v?1===v?ep(a=g0(Nu(a),o,l),o,l,u,f,b,2):2===v&&Sg(a,o,l,u,f,b):ep(Nu(a),o,l,u,f,b,1);break}}}function m0(a){var o=a.prev,l=a,u=a.next;if(oo(o,l,u)>=0)return!1;for(var f=o.x,b=l.x,v=u.x,w=o.y,T=l.y,E=u.y,A=f<b?f<v?f:v:b<v?b:v,P=w<T?w<E?w:E:T<E?T:E,L=f>b?f>v?f:v:b>v?b:v,N=w>T?w>E?w:E:T>E?T:E,B=u.next;B!==o;){if(B.x>=A&&B.x<=L&&B.y>=P&&B.y<=N&&cc(f,w,b,T,v,E,B.x,B.y)&&oo(B.prev,B,B.next)>=0)return!1;B=B.next}return!0}function F_(a,o,l,u){var f=a.prev,b=a,v=a.next;if(oo(f,b,v)>=0)return!1;for(var w=f.x,T=b.x,E=v.x,A=f.y,P=b.y,L=v.y,N=w<T?w<E?w:E:T<E?T:E,B=A<P?A<L?A:L:P<L?P:L,$=w>T?w>E?w:E:T>E?T:E,K=A>P?A>L?A:L:P>L?P:L,ce=Rf(N,B,o,l,u),Ce=Rf($,K,o,l,u),ue=a.prevZ,ve=a.nextZ;ue&&ue.z>=ce&&ve&&ve.z<=Ce;){if(ue.x>=N&&ue.x<=$&&ue.y>=B&&ue.y<=K&&ue!==f&&ue!==v&&cc(w,A,T,P,E,L,ue.x,ue.y)&&oo(ue.prev,ue,ue.next)>=0||(ue=ue.prevZ,ve.x>=N&&ve.x<=$&&ve.y>=B&&ve.y<=K&&ve!==f&&ve!==v&&cc(w,A,T,P,E,L,ve.x,ve.y)&&oo(ve.prev,ve,ve.next)>=0))return!1;ve=ve.nextZ}for(;ue&&ue.z>=ce;){if(ue.x>=N&&ue.x<=$&&ue.y>=B&&ue.y<=K&&ue!==f&&ue!==v&&cc(w,A,T,P,E,L,ue.x,ue.y)&&oo(ue.prev,ue,ue.next)>=0)return!1;ue=ue.prevZ}for(;ve&&ve.z<=Ce;){if(ve.x>=N&&ve.x<=$&&ve.y>=B&&ve.y<=K&&ve!==f&&ve!==v&&cc(w,A,T,P,E,L,ve.x,ve.y)&&oo(ve.prev,ve,ve.next)>=0)return!1;ve=ve.nextZ}return!0}function g0(a,o,l){var u=a;do{var f=u.prev,b=u.next.next;!Tg(f,b)&&_0(f,u,u.next,b)&&Bu(f,b)&&Bu(b,f)&&(o.push(f.i/l|0),o.push(u.i/l|0),o.push(b.i/l|0),Lf(u),Lf(u.next),u=a=b),u=u.next}while(u!==a);return Nu(u)}function Sg(a,o,l,u,f,b){var v=a;do{for(var w=v.next.next;w!==v.prev;){if(v.i!==w.i&&a1(v,w)){var T=Eg(v,w);return v=Nu(v,v.next),T=Nu(T,T.next),ep(v,o,l,u,f,b,0),void ep(T,o,l,u,f,b,0)}w=w.next}v=v.next}while(v!==a)}function Cg(a,o){return a.x-o.x}function b0(a,o){var l=function(f,b){var v,w=b,T=f.x,E=f.y,A=-1/0;do{if(E<=w.y&&E>=w.next.y&&w.next.y!==w.y){var P=w.x+(E-w.y)*(w.next.x-w.x)/(w.next.y-w.y);if(P<=T&&P>A&&(A=P,v=w.x<w.next.x?w:w.next,P===T))return v}w=w.next}while(w!==b);if(!v)return null;var L,N=v,B=v.x,$=v.y,K=1/0;w=v;do{T>=w.x&&w.x>=B&&T!==w.x&&cc(E<$?T:A,E,B,$,E<$?A:T,E,w.x,w.y)&&(L=Math.abs(E-w.y)/(T-w.x),Bu(w,f)&&(L<K||L===K&&(w.x>v.x||w.x===v.x&&N_(v,w)))&&(v=w,K=L)),w=w.next}while(w!==N);return v}(a,o);if(!l)return o;var u=Eg(l,a);return Nu(u,u.next),Nu(l,l.next)}function N_(a,o){return oo(a.prev,a,o.prev)<0&&oo(o.next,a,a.next)<0}function Rf(a,o,l,u,f){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-l)*f|0)|a<<8))|a<<4))|a<<2))|a<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-u)*f|0)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function B_(a){var o=a,l=a;do{(o.x<l.x||o.x===l.x&&o.y<l.y)&&(l=o),o=o.next}while(o!==a);return l}function cc(a,o,l,u,f,b,v,w){return(f-v)*(o-w)>=(a-v)*(b-w)&&(a-v)*(u-w)>=(l-v)*(o-w)&&(l-v)*(b-w)>=(f-v)*(u-w)}function a1(a,o){return a.next.i!==o.i&&a.prev.i!==o.i&&!function(l,u){var f=l;do{if(f.i!==l.i&&f.next.i!==l.i&&f.i!==u.i&&f.next.i!==u.i&&_0(f,f.next,l,u))return!0;f=f.next}while(f!==l);return!1}(a,o)&&(Bu(a,o)&&Bu(o,a)&&function(l,u){var f=l,b=!1,v=(l.x+u.x)/2,w=(l.y+u.y)/2;do{f.y>w!=f.next.y>w&&f.next.y!==f.y&&v<(f.next.x-f.x)*(w-f.y)/(f.next.y-f.y)+f.x&&(b=!b),f=f.next}while(f!==l);return b}(a,o)&&(oo(a.prev,a,o.prev)||oo(a,o.prev,o))||Tg(a,o)&&oo(a.prev,a,a.next)>0&&oo(o.prev,o,o.next)>0)}function oo(a,o,l){return(o.y-a.y)*(l.x-o.x)-(o.x-a.x)*(l.y-o.y)}function Tg(a,o){return a.x===o.x&&a.y===o.y}function _0(a,o,l,u){var f=tp(oo(a,o,l)),b=tp(oo(a,o,u)),v=tp(oo(l,u,a)),w=tp(oo(l,u,o));return f!==b&&v!==w||!(0!==f||!Pf(a,l,o))||!(0!==b||!Pf(a,u,o))||!(0!==v||!Pf(l,a,u))||!(0!==w||!Pf(l,o,u))}function Pf(a,o,l){return o.x<=Math.max(a.x,l.x)&&o.x>=Math.min(a.x,l.x)&&o.y<=Math.max(a.y,l.y)&&o.y>=Math.min(a.y,l.y)}function tp(a){return a>0?1:a<0?-1:0}function Bu(a,o){return oo(a.prev,a,a.next)<0?oo(a,o,a.next)>=0&&oo(a,a.prev,o)>=0:oo(a,o,a.prev)<0||oo(a,a.next,o)<0}function Eg(a,o){var l=new z_(a.i,a.x,a.y),u=new z_(o.i,o.x,o.y),f=a.next,b=o.prev;return a.next=o,o.prev=a,l.next=f,f.prev=l,u.next=l,l.prev=u,b.next=u,u.prev=b,u}function zu(a,o,l,u){var f=new z_(a,o,l);return u?(f.next=u.next,f.prev=u,u.next.prev=f,u.next=f):(f.prev=f,f.next=f),f}function Lf(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function z_(a,o,l){this.i=a,this.x=o,this.y=l,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function y0(a,o,l,u){for(var f=0,b=o,v=l-u;b<l;b+=u)f+=(a[v]-a[b])*(a[b+1]+a[v+1]),v=b;return f}p0.exports=Hd,p0.exports.default=Hd,Hd.deviation=function(a,o,l,u){var f=o&&o.length,b=Math.abs(y0(a,0,f?o[0]*l:a.length,l));if(f)for(var v=0,w=o.length;v<w;v++)b-=Math.abs(y0(a,o[v]*l,v<w-1?o[v+1]*l:a.length,l));var T=0;for(v=0;v<u.length;v+=3){var E=u[v]*l,A=u[v+1]*l,P=u[v+2]*l;T+=Math.abs((a[E]-a[P])*(a[A+1]-a[E+1])-(a[E]-a[A])*(a[P+1]-a[E+1]))}return 0===b&&0===T?0:Math.abs((T-b)/b)},Hd.flatten=function(a){for(var o=a[0][0].length,l={vertices:[],holes:[],dimensions:o},u=0,f=0;f<a.length;f++){for(var b=0;b<a[f].length;b++)for(var v=0;v<o;v++)l.vertices.push(a[f][b][v]);f>0&&l.holes.push(u+=a[f-1].length)}return l};var V_=_n(p0.exports);function j_(a,o,l,u,f){v0(a,o,l||0,u||a.length-1,f||Dg)}function v0(a,o,l,u,f){for(;u>l;){if(u-l>600){var b=u-l+1,v=o-l+1,w=Math.log(b),T=.5*Math.exp(2*w/3),E=.5*Math.sqrt(w*T*(b-T)/b)*(v-b/2<0?-1:1);v0(a,o,Math.max(l,Math.floor(o-v*T/b+E)),Math.min(u,Math.floor(o+(b-v)*T/b+E)),f)}var A=a[o],P=l,L=u;for(np(a,l,o),f(a[u],A)>0&&np(a,l,u);P<L;){for(np(a,P,L),P++,L--;f(a[P],A)<0;)P++;for(;f(a[L],A)>0;)L--}0===f(a[l],A)?np(a,l,L):np(a,++L,u),L<=o&&(l=L+1),o<=L&&(u=L-1)}}function np(a,o,l){var u=a[o];a[o]=a[l],a[l]=u}function Dg(a,o){return a<o?-1:a>o?1:0}function Of(a,o){const l=a.length;if(l<=1)return[a];const u=[];let f,b;for(let v=0;v<l;v++){const w=qr(a[v]);0!==w&&(a[v].area=Math.abs(w),void 0===b&&(b=w<0),b===w<0?(f&&u.push(f),f=[a[v]]):f.push(a[v]))}if(f&&u.push(f),o>1)for(let v=0;v<u.length;v++)u[v].length<=o||(j_(u[v],o,1,u[v].length-1,x0),u[v]=u[v].slice(0,o));return u}function x0(a,o){return o.area-a.area}function Ig(a,o,l){const u=l.patternDependencies;let f=!1;for(const b of o){const v=b.paint.get(`${a}-pattern`);v.isConstant()||(f=!0);const w=v.constantOr(null);w&&(f=!0,u[w]=!0)}return f}function Mg(a,o,l,u,f){const b=f.patternDependencies;for(const v of o){const w=v.paint.get(`${a}-pattern`).value;if("constant"!==w.kind){let T=w.evaluate({zoom:u},l,{},f.availableImages);T=T&&T.name?T.name:T,b[T]=!0,l.patterns[v.id]=T}}return l}class uc{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.id),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ft,this.indexArray=new En,this.indexArray2=new io,this.programConfigurations=new Zh(o.layers,o.zoom),this.segments=new Hr,this.segments2=new Hr,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.projection=o.projection}populate(o,l,u,f){this.hasPattern=Ig("fill",this.layers,l);const b=this.layers[0].layout.get("fill-sort-key"),v=[];for(const{feature:w,id:T,index:E,sourceLayerIndex:A}of o){const P=this.layers[0]._featureFilter.needGeometry,L=Lu(w,P);if(!this.layers[0]._featureFilter.filter(new R(this.zoom),L,u))continue;const N=b?b.evaluate(L,{},u,l.availableImages):void 0,B={id:T,properties:w.properties,type:w.type,sourceLayerIndex:A,index:E,geometry:P?L.geometry:qc(w,u,f),patterns:{},sortKey:N};v.push(B)}b&&v.sort((w,T)=>w.sortKey-T.sortKey);for(const w of v){const{geometry:T,index:E,sourceLayerIndex:A}=w;if(this.hasPattern){const P=Mg("fill",this.layers,w,this.zoom,l);this.patternFeatures.push(P)}else this.addFeature(w,T,E,u,{},l.availableImages);l.featureIndex.insert(o[E].feature,T,E,A,this.index)}}update(o,l,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,l,this.stateDependentLayers,u,f)}addFeatures(o,l,u,f,b){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,l,u,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,s1),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.indexBuffer2=o.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(o,l,u,f,b,v=[]){for(const w of Of(l,500)){let T=0;for(const B of w)T+=B.length;const E=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray),A=E.vertexLength,P=[],L=[];for(const B of w){if(0===B.length)continue;B!==w[0]&&L.push(P.length/2);const $=this.segments2.prepareSegment(B.length,this.layoutVertexArray,this.indexArray2),K=$.vertexLength;this.layoutVertexArray.emplaceBack(B[0].x,B[0].y),this.indexArray2.emplaceBack(K+B.length-1,K),P.push(B[0].x),P.push(B[0].y);for(let ce=1;ce<B.length;ce++)this.layoutVertexArray.emplaceBack(B[ce].x,B[ce].y),this.indexArray2.emplaceBack(K+ce-1,K+ce),P.push(B[ce].x),P.push(B[ce].y);$.vertexLength+=B.length,$.primitiveLength+=B.length}const N=V_(P,L);for(let B=0;B<N.length;B+=3)this.indexArray.emplaceBack(A+N[B],A+N[B+1],A+N[B+2]);E.vertexLength+=T,E.primitiveLength+=N.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,u,b,v,f)}}gn(uc,"FillBucket",{omit:["layers","patternFeatures"]});const l1=new ge({"fill-sort-key":new J(bt.layout_fill["fill-sort-key"])});var c1={paint:new ge({"fill-antialias":new U(bt.paint_fill["fill-antialias"]),"fill-opacity":new J(bt.paint_fill["fill-opacity"]),"fill-color":new J(bt.paint_fill["fill-color"]),"fill-outline-color":new J(bt.paint_fill["fill-outline-color"]),"fill-translate":new U(bt.paint_fill["fill-translate"]),"fill-translate-anchor":new U(bt.paint_fill["fill-translate-anchor"]),"fill-pattern":new J(bt.paint_fill["fill-pattern"])}),layout:l1};const u1=He([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),d1=He([{name:"a_centroid_pos",components:2,type:"Uint16"}]),h1=He([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Oa}=u1;var Fa={},p1=we,w0=ip;function ip(a,o,l,u,f){this.properties={},this.extent=l,this.type=0,this._pbf=a,this._geometry=-1,this._keys=u,this._values=f,a.readFields(f1,this,o)}function f1(a,o,l){1==a?o.id=l.readVarint():2==a?function(u,f){for(var b=u.readVarint()+u.pos;u.pos<b;){var v=f._keys[u.readVarint()],w=f._values[u.readVarint()];f.properties[v]=w}}(l,o):3==a?o.type=l.readVarint():4==a&&(o._geometry=l.pos)}function m1(a){for(var o,l,u=0,f=0,b=a.length,v=b-1;f<b;v=f++)u+=((l=a[v]).x-(o=a[f]).x)*(o.y+l.y);return u}ip.types=["Unknown","Point","LineString","Polygon"],ip.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var o,l=a.readVarint()+a.pos,u=1,f=0,b=0,v=0,w=[];a.pos<l;){if(f<=0){var T=a.readVarint();u=7&T,f=T>>3}if(f--,1===u||2===u)b+=a.readSVarint(),v+=a.readSVarint(),1===u&&(o&&w.push(o),o=[]),o.push(new p1(b,v));else{if(7!==u)throw new Error("unknown command "+u);o&&o.push(o[0].clone())}}return o&&w.push(o),w},ip.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var o=a.readVarint()+a.pos,l=1,u=0,f=0,b=0,v=1/0,w=-1/0,T=1/0,E=-1/0;a.pos<o;){if(u<=0){var A=a.readVarint();l=7&A,u=A>>3}if(u--,1===l||2===l)(f+=a.readSVarint())<v&&(v=f),f>w&&(w=f),(b+=a.readSVarint())<T&&(T=b),b>E&&(E=b);else if(7!==l)throw new Error("unknown command "+l)}return[v,T,w,E]},ip.prototype.toGeoJSON=function(a,o,l){var u,f,b=this.extent*Math.pow(2,l),v=this.extent*a,w=this.extent*o,T=this.loadGeometry(),E=ip.types[this.type];function A(N){for(var B=0;B<N.length;B++){var $=N[B];N[B]=[360*($.x+v)/b-180,360/Math.PI*Math.atan(Math.exp((180-360*($.y+w)/b)*Math.PI/180))-90]}}switch(this.type){case 1:var P=[];for(u=0;u<T.length;u++)P[u]=T[u][0];A(T=P);break;case 2:for(u=0;u<T.length;u++)A(T[u]);break;case 3:for(T=function(N){var B=N.length;if(B<=1)return[N];for(var $,K,ce=[],Ce=0;Ce<B;Ce++){var ue=m1(N[Ce]);0!==ue&&(void 0===K&&(K=ue<0),K===ue<0?($&&ce.push($),$=[N[Ce]]):$.push(N[Ce]))}return $&&ce.push($),ce}(T),u=0;u<T.length;u++)for(f=0;f<T[u].length;f++)A(T[u][f])}1===T.length?T=T[0]:E="Multi"+E;var L={type:"Feature",geometry:{type:E,coordinates:T},properties:this.properties};return"id"in this&&(L.id=this.id),L};var g1=w0,U_=S0;function S0(a,o){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(b1,this,o),this.length=this._features.length}function b1(a,o,l){15===a?o.version=l.readVarint():1===a?o.name=l.readString():5===a?o.extent=l.readVarint():2===a?o._features.push(l.pos):3===a?o._keys.push(l.readString()):4===a&&o._values.push(function(u){for(var f=null,b=u.readVarint()+u.pos;u.pos<b;){var v=u.readVarint()>>3;f=1===v?u.readString():2===v?u.readFloat():3===v?u.readDouble():4===v?u.readVarint64():5===v?u.readVarint():6===v?u.readSVarint():7===v?u.readBoolean():null}return f}(l))}S0.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var o=this._pbf.readVarint()+this._pbf.pos;return new g1(this._pbf,o,this.extent,this._keys,this._values)};var _1=U_;function y1(a,o,l){if(3===a){var u=new _1(l,l.readVarint()+l.pos);u.length&&(o[u.name]=u)}}var rp=Fa.VectorTile=function(a,o){this.layers=a.readFields(y1,{},o)},al=Fa.VectorTileFeature=w0;function Vu(a,o,l,u){const f=[],b=0===u?(v,w,T,E,A,P)=>{v.push(new Ie(P,T+(P-w)/(E-w)*(A-T)))}:(v,w,T,E,A,P)=>{v.push(new Ie(w+(P-T)/(A-T)*(E-w),P))};for(const v of a){const w=[];for(const T of v){if(T.length<=2)continue;const E=[];for(let L=0;L<T.length-1;L++){const N=T[L].x,B=T[L].y,$=T[L+1].x,K=T[L+1].y,ce=0===u?N:B,Ce=0===u?$:K;ce<o?Ce>o&&b(E,N,B,$,K,o):ce>l?Ce<l&&b(E,N,B,$,K,l):E.push(T[L]),Ce<o&&ce>=o&&b(E,N,B,$,K,o),Ce>l&&ce<=l&&b(E,N,B,$,K,l)}let A=T[T.length-1];const P=0===u?A.x:A.y;P>=o&&P<=l&&E.push(A),E.length&&(A=E[E.length-1],E[0].x===A.x&&E[0].y===A.y||E.push(E[0]),w.push(E))}w.length&&f.push(w)}return f}Fa.VectorTileLayer=U_;const C0=al.types,T0=Math.pow(2,13);function op(a,o,l,u,f,b,v,w){a.emplaceBack((o<<1)+v,(l<<1)+b,(Math.floor(u*T0)<<1)+f,Math.round(w))}function Ag(a,o,l){a.emplaceBack(o.x,o.y,o.z,16384*l[0],16384*l[1],16384*l[2])}class v1{constructor(){this.acc=new Ie(0,0),this.polyCount=[]}startRing(o){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Ie(o.x,o.y),this.max=new Ie(o.x,o.y))}append(o,l){this.currentPolyCount.edges++,this.acc._add(o);const u=this.min,f=this.max;o.x<u.x?u.x=o.x:o.x>f.x&&(f.x=o.x),o.y<u.y?u.y=o.y:o.y>f.y&&(f.y=o.y),((0===o.x||o.x===Pn)&&o.x===l.x)!=((0===o.y||o.y===Pn)&&o.y===l.y)&&this.processBorderOverlap(o,l),l.x<0!=o.x<0&&this.addBorderIntersection(0,Bi(l.y,o.y,(0-l.x)/(o.x-l.x))),l.x>Pn!=o.x>Pn&&this.addBorderIntersection(1,Bi(l.y,o.y,(Pn-l.x)/(o.x-l.x))),l.y<0!=o.y<0&&this.addBorderIntersection(2,Bi(l.x,o.x,(0-l.y)/(o.y-l.y))),l.y>Pn!=o.y>Pn&&this.addBorderIntersection(3,Bi(l.x,o.x,(Pn-l.y)/(o.y-l.y)))}addBorderIntersection(o,l){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const u=this.borders[o];l<u[0]&&(u[0]=l),l>u[1]&&(u[1]=l)}processBorderOverlap(o,l){if(o.x===l.x){if(o.y===l.y)return;const u=0===o.x?0:1;this.addBorderIntersection(u,l.y),this.addBorderIntersection(u,o.y)}else{const u=0===o.y?2:3;this.addBorderIntersection(u,l.x),this.addBorderIntersection(u,o.x)}}centroid(){const o=this.polyCount.reduce((l,u)=>l+u.edges,0);return 0!==o?this.acc.div(o)._round():new Ie(0,0)}span(){return new Ie(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((o,l)=>o+ +(l[0]!==Number.MAX_VALUE),0)}}class kg{constructor(o){this.zoom=o.zoom,this.canonical=o.canonical,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.id),this.index=o.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=o.projection,this.layoutVertexArray=new St,this.centroidVertexArray=new El,this.indexArray=new En,this.programConfigurations=new Zh(o.layers,o.zoom),this.segments=new Hr,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.enableTerrain=o.enableTerrain}populate(o,l,u,f){this.features=[],this.hasPattern=Ig("fill-extrusion",this.layers,l),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(b){const v=Math.exp(Math.PI*(1-b.y/(1<<b.z)*2));return 80150034*v/(v*v+1)/Pn/(1<<b.z)}(u),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:b,id:v,index:w,sourceLayerIndex:T}of o){const E=this.layers[0]._featureFilter.needGeometry,A=Lu(b,E);if(!this.layers[0]._featureFilter.filter(new R(this.zoom),A,u))continue;const P={id:v,sourceLayerIndex:T,index:w,geometry:E?A.geometry:qc(b,u,f),properties:b.properties,type:b.type,patterns:{}},L=this.layoutVertexArray.length;this.hasPattern?this.features.push(Mg("fill-extrusion",this.layers,P,this.zoom,l)):this.addFeature(P,P.geometry,w,u,{},l.availableImages,f),l.featureIndex.insert(b,P.geometry,w,T,this.index,L)}this.sortBorders()}addFeatures(o,l,u,f,b){for(const v of this.features){const{geometry:w}=v;this.addFeature(v,w,v.index,l,u,f,b)}this.sortBorders()}update(o,l,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,l,this.stateDependentLayers,u,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Oa),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=o.createVertexBuffer(this.layoutVertexExtArray,h1.members,!0))),this.programConfigurations.upload(o),this.uploaded=!0}uploadCentroid(o){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=o.createVertexBuffer(this.centroidVertexArray,d1.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(o,l,u,f,b,v,w){const T=[new Ie(0,0),new Ie(Pn,Pn)],E=w.projection,A="globe"===E.name,P=this.enableTerrain&&!A?new v1:null,L="Polygon"===C0[o.type];A&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Bt);const N=Of(l,500);for(let ce=N.length-1;ce>=0;ce--){const Ce=N[ce];(0===Ce.length||(B=Ce[0]).every(ue=>ue.x<=0)||B.every(ue=>ue.x>=Pn)||B.every(ue=>ue.y<=0)||B.every(ue=>ue.y>=Pn))&&N.splice(ce,1)}var B;let $;if(A)$=I0(N,T,f);else{$=[];for(const ce of N)$.push({polygon:ce,bounds:T})}const K=L?this.edgeRadius:0;for(const{polygon:ce,bounds:Ce}of $){let ue=0,ve=0;for(const ke of ce)L&&!ke[0].equals(ke[ke.length-1])&&ke.push(ke[0]),ve+=L?ke.length-1:ke.length;const Ae=this.segments.prepareSegment((L?5:4)*ve,this.layoutVertexArray,this.indexArray);if(L){const ke=[],at=[];ue=Ae.vertexLength;for(const _t of ce){let zt,ht;_t.length&&_t!==ce[0]&&at.push(ke.length/2),zt=_t[1].sub(_t[0])._perp()._unit();for(let Dt=1;Dt<_t.length;Dt++){const Ct=_t[Dt],Rt=_t[Dt===_t.length-1?1:Dt+1];let{x:Gt,y:ft}=Ct;if(K){ht=Rt.sub(Ct)._perp()._unit();const sn=zt.add(ht)._unit(),mn=K*Math.min(4,1/(zt.x*sn.x+zt.y*sn.y));Gt+=mn*sn.x,ft+=mn*sn.y,zt=ht}op(this.layoutVertexArray,Gt,ft,0,0,1,1,0),Ae.vertexLength++,ke.push(Ct.x,Ct.y),A&&Ag(this.layoutVertexExtArray,E.projectTilePoint(Gt,ft,f),E.upVector(f,Gt,ft))}}const rt=V_(ke,at);for(let _t=0;_t<rt.length;_t+=3)this.indexArray.emplaceBack(ue+rt[_t],ue+rt[_t+2],ue+rt[_t+1]),Ae.primitiveLength++}for(const ke of ce){P&&ke.length&&P.startRing(ke[0]);let at,rt,_t,zt=ke.length>4&&$_(ke[ke.length-2],ke[0],ke[1]),ht=K?H_(ke[ke.length-2],ke[0],ke[1],K):0;rt=ke[1].sub(ke[0])._perp()._unit();let Dt=!0;for(let Ct=1,Rt=0;Ct<ke.length;Ct++){let Gt=ke[Ct-1],ft=ke[Ct];const sn=ke[Ct===ke.length-1?1:Ct+1];if(P&&L&&P.currentPolyCount.top++,w1(ft,Gt,Ce)){K&&(rt=sn.sub(ft)._perp()._unit(),Dt=!Dt);continue}P&&P.append(ft,Gt);const mn=ft.sub(Gt)._perp(),dn=mn.x/(Math.abs(mn.x)+Math.abs(mn.y)),Wn=mn.y>0?1:0,Xt=Gt.dist(ft);if(Rt+Xt>32768&&(Rt=0),K){_t=sn.sub(ft)._perp()._unit();let ei=x1(Gt,ft,sn,Rg(rt,_t),K);isNaN(ei)&&(ei=0);const Fn=ft.sub(Gt)._unit();Gt=Gt.add(Fn.mult(ht))._round(),ft=ft.add(Fn.mult(-ei))._round(),ht=ei,rt=_t}const kn=Ae.vertexLength,Jn=ke.length>4&&$_(Gt,ft,sn);let ji=E0(Rt,zt,Dt);if(op(this.layoutVertexArray,Gt.x,Gt.y,dn,Wn,0,0,ji),op(this.layoutVertexArray,Gt.x,Gt.y,dn,Wn,0,1,ji),Rt+=Xt,ji=E0(Rt,Jn,!Dt),zt=Jn,op(this.layoutVertexArray,ft.x,ft.y,dn,Wn,0,0,ji),op(this.layoutVertexArray,ft.x,ft.y,dn,Wn,0,1,ji),Ae.vertexLength+=4,this.indexArray.emplaceBack(kn+0,kn+1,kn+2),this.indexArray.emplaceBack(kn+1,kn+3,kn+2),Ae.primitiveLength+=2,K){const ei=ue+(1===Ct?ke.length-2:Ct-2),Fn=1===Ct?ue:ei+1;if(this.indexArray.emplaceBack(kn+1,ei,kn+3),this.indexArray.emplaceBack(ei,Fn,kn+3),Ae.primitiveLength+=2,void 0===at&&(at=kn),!w1(sn,ke[Ct],Ce)){const Gi=Ct===ke.length-1?at:Ae.vertexLength;this.indexArray.emplaceBack(kn+2,kn+3,Gi),this.indexArray.emplaceBack(kn+3,Gi+1,Gi),this.indexArray.emplaceBack(kn+3,Fn,Gi+1),Ae.primitiveLength+=3}Dt=!Dt}if(A){const ei=this.layoutVertexExtArray,Fn=E.projectTilePoint(Gt.x,Gt.y,f),Gi=E.projectTilePoint(ft.x,ft.y,f),Xn=E.upVector(f,Gt.x,Gt.y),Zn=E.upVector(f,ft.x,ft.y);Ag(ei,Fn,Xn),Ag(ei,Fn,Xn),Ag(ei,Gi,Zn),Ag(ei,Gi,Zn)}}L&&(ue+=ke.length-1)}}if(P&&P.polyCount.length>0){if(P.borders){P.vertexArrayOffset=this.centroidVertexArray.length;const ce=P.borders,Ce=this.featuresOnBorder.push(P)-1;for(let ue=0;ue<4;ue++)ce[ue][0]!==Number.MAX_VALUE&&this.borders[ue].push(Ce)}this.encodeCentroid(P.borders?void 0:P.centroid(),P)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,u,b,v,f)}sortBorders(){for(let o=0;o<4;o++)this.borders[o].sort((l,u)=>this.featuresOnBorder[l].borders[o][0]-this.featuresOnBorder[u].borders[o][0])}encodeCentroid(o,l,u=!0){let f,b;if(o)if(0!==o.y){const w=l.span()._mult(this.tileToMeter);f=(Math.max(o.x,1)<<3)+Math.min(7,Math.round(w.x/10)),b=(Math.max(o.y,1)<<3)+Math.min(7,Math.round(w.y/10))}else f=Math.ceil(7*(o.x+450)),b=0;else f=0,b=+u;let v=u?this.centroidVertexArray.length:l.vertexArrayOffset;for(const w of l.polyCount){u&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*w.edges+w.top);for(let T=0;T<w.top;T++)this.centroidVertexArray.emplace(v++,f,b);for(let T=0;T<2*w.edges;T++)this.centroidVertexArray.emplace(v++,0,b),this.centroidVertexArray.emplace(v++,f,b)}}}function Rg(a,o){const l=a.add(o)._unit();return a.x*l.x+a.y*l.y}function H_(a,o,l,u){const f=o.sub(a)._perp()._unit(),b=l.sub(o)._perp()._unit();return x1(a,o,l,Rg(f,b),u)}function x1(a,o,l,u,f){const b=Math.sqrt(1-u*u);return Math.min(a.dist(o)/3,o.dist(l)/3,f*b/u)}function w1(a,o,l){return a.x<l[0].x&&o.x<l[0].x||a.x>l[1].x&&o.x>l[1].x||a.y<l[0].y&&o.y<l[0].y||a.y>l[1].y&&o.y>l[1].y}function $_(a,o,l){if(a.x<0||a.x>=Pn||o.x<0||o.x>=Pn||l.x<0||l.x>=Pn)return!1;const u=l.sub(o),f=u.perp(),b=a.sub(o);return(u.x*b.x+u.y*b.y)/Math.sqrt((u.x*u.x+u.y*u.y)*(b.x*b.x+b.y*b.y))>-.866&&f.x*b.x+f.y*b.y<0}function E0(a,o,l){const u=o?2|a:-3&a;return l?1|u:-2&u}function D0(){const a=Math.PI/32,o=Math.tan(a),l=Mf;return l*Math.sqrt(1+2*o*o)-l}function I0(a,o,l){const u=1<<l.z,f=La(l.x/u),b=La((l.x+1)/u),v=vr(l.y/u),w=vr((l.y+1)/u);return function(T,E,A,P,L=0,N){const B=[];if(!T.length||!A||!P)return B;const $=(ke,at)=>{for(const rt of ke)B.push({polygon:rt,bounds:at})},K=Math.ceil(Math.log2(A)),ce=Math.ceil(Math.log2(P)),Ce=K-ce,ue=[];for(let ke=0;ke<Math.abs(Ce);ke++)ue.push(Ce>0?0:1);for(let ke=0;ke<Math.min(K,ce);ke++)ue.push(0),ue.push(1);let ve=T;if(ve=Vu(ve,E[0].y-L,E[1].y+L,1),ve=Vu(ve,E[0].x-L,E[1].x+L,0),!ve.length)return B;const Ae=[];for(ue.length?Ae.push({polygons:ve,bounds:E,depth:0}):$(ve,E);Ae.length;){const ke=Ae.pop(),at=ke.depth,rt=ue[at],_t=ke.bounds[0],zt=ke.bounds[1],ht=0===rt?_t.x:_t.y,Dt=0===rt?zt.x:zt.y,Ct=N?N(rt,ht,Dt):.5*(ht+Dt),Rt=Vu(ke.polygons,ht-L,Ct+L,rt),Gt=Vu(ke.polygons,Ct-L,Dt+L,rt);if(Rt.length){const ft=[_t,new Ie(0===rt?Ct:zt.x,1===rt?Ct:zt.y)];ue.length>at+1?Ae.push({polygons:Rt,bounds:ft,depth:at+1}):$(Rt,ft)}if(Gt.length){const ft=[new Ie(0===rt?Ct:_t.x,1===rt?Ct:_t.y),zt];ue.length>at+1?Ae.push({polygons:Gt,bounds:ft,depth:at+1}):$(Gt,ft)}}return B}(a,o,Math.ceil((b-f)/11.25),Math.ceil((v-w)/11.25),1,(T,E,A)=>{if(0===T)return.5*(E+A);{const P=vr((l.y+E/Pn)/u);return(Al(.5*(vr((l.y+A/Pn)/u)+P))*u-l.y)*Pn}})}gn(kg,"FillExtrusionBucket",{omit:["layers","features"]}),gn(v1,"PartMetadata");const S1=new ge({"fill-extrusion-edge-radius":new U(bt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var M0={paint:new ge({"fill-extrusion-opacity":new U(bt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new J(bt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new U(bt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new U(bt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new J(bt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new J(bt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new J(bt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new U(bt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new U(bt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new U(bt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new U(bt["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:S1};function Ff(a,o,l){var u=2*Math.PI*6378137/256/Math.pow(2,l);return[a*u-2*Math.PI*6378137/2,o*u-2*Math.PI*6378137/2]}class Nf{constructor(o,l,u){this.z=o,this.x=l,this.y=u,this.key=sr(0,o,o,l,u)}equals(o){return this.z===o.z&&this.x===o.x&&this.y===o.y}url(o,l){const u=(v=this.y,w=this.z,T=Ff(256*(b=this.x),256*(v=Math.pow(2,w)-v-1),w),E=Ff(256*(b+1),256*(v+1),w),T[0]+","+T[1]+","+E[0]+","+E[1]),f=function(b,v,w){let T,E="";for(let A=b;A>0;A--)T=1<<A-1,E+=(v&T?1:0)+(w&T?2:0);return E}(this.z,this.x,this.y);var b,v,w,T,E;return o[(this.x+this.y)%o.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===l?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",f).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Pg{constructor(o,l){this.wrap=o,this.canonical=l,this.key=sr(o,l.z,l.z,l.x,l.y)}}class zs{constructor(o,l,u,f,b){this.overscaledZ=o,this.wrap=l,this.canonical=new Nf(u,+f,+b),this.key=0===l&&o===u?this.canonical.key:sr(l,o,u,f,b)}equals(o){return this.overscaledZ===o.overscaledZ&&this.wrap===o.wrap&&this.canonical.equals(o.canonical)}scaledTo(o){const l=this.canonical.z-o;return o>this.canonical.z?new zs(o,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new zs(o,this.wrap,o,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(o,l=!0){if(this.overscaledZ===o&&l)return this.key;if(o>this.canonical.z)return sr(this.wrap*+l,o,this.canonical.z,this.canonical.x,this.canonical.y);{const u=this.canonical.z-o;return sr(this.wrap*+l,o,o,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(o){if(o.wrap!==this.wrap)return!1;const l=this.canonical.z-o.canonical.z;return 0===o.overscaledZ||o.overscaledZ<this.overscaledZ&&o.canonical.x===this.canonical.x>>l&&o.canonical.y===this.canonical.y>>l}children(o){if(this.overscaledZ>=o)return[new zs(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,u=2*this.canonical.x,f=2*this.canonical.y;return[new zs(l,this.wrap,l,u,f),new zs(l,this.wrap,l,u+1,f),new zs(l,this.wrap,l,u,f+1),new zs(l,this.wrap,l,u+1,f+1)]}isLessThan(o){return this.wrap<o.wrap||!(this.wrap>o.wrap)&&(this.overscaledZ<o.overscaledZ||!(this.overscaledZ>o.overscaledZ)&&(this.canonical.x<o.canonical.x||!(this.canonical.x>o.canonical.x)&&this.canonical.y<o.canonical.y))}wrapped(){return new zs(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(o){return new zs(this.overscaledZ,o,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Pg(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function sr(a,o,l,u,f){const b=1<<Math.min(l,22);let v=b*(f%b)+u%b;return a&&l<22&&(v+=b*b*((a<0?-2*a-1:2*a)%(1<<2*(22-l)))),16*(32*v+l)+(o-l)}gn(Nf,"CanonicalTileID"),gn(zs,"OverscaledTileID",{omit:["projMatrix"]});class sp extends Ie{constructor(o,l,u){super(o,l),this.z=u}}function Bf(a,o){return a.x*o.x+a.y*o.y}function ll(a,o){if(1===a.length){let l=0;const u=o[l++];let f;for(;!f||u.equals(f);)if(f=o[l++],!f)return 1/0;for(;l<o.length;l++){const b=o[l],v=a[0],w=f.sub(u),T=b.sub(u),E=v.sub(u),A=Bf(w,w),P=Bf(w,T),L=Bf(T,T),N=Bf(E,w),B=Bf(E,T),$=A*L-P*P,K=(L*N-P*B)/$,ce=(A*B-P*N)/$,Ce=u.z*(1-K-ce)+f.z*K+b.z*ce;if(isFinite(Ce))return Ce}return 1/0}{let l=1/0;for(const u of o)l=Math.min(l,u.z);return l}}function G_(a,o,l,u,f,b,v,w){const T=v*f.getElevationAt(a,o,!0,!0),E=0!==b[0],A=E?0===b[1]?v*(b[0]/7-450):v*function(P,L,N){const B=Math.floor(L[0]/8),$=Math.floor(L[1]/8),K=10*(L[0]-8*B),ce=10*(L[1]-8*$),Ce=P.getElevationAt(B,$,!0,!0),ue=P.getMeterToDEM(N),ve=Math.floor(.5*(K*ue-1)),Ae=Math.floor(.5*(ce*ue-1)),ke=P.tileCoordToPixel(B,$),at=2*ve+1,rt=2*Ae+1,_t=(mn=at,dn=rt,[(Gt=P).getElevationAtPixel(ft=ke.x-ve,sn=ke.y-Ae,!0),Gt.getElevationAtPixel(ft+dn,sn,!0),Gt.getElevationAtPixel(ft,sn+dn,!0),Gt.getElevationAtPixel(ft+mn,sn+dn,!0)]),zt=Math.abs(_t[0]-_t[1]),ht=Math.abs(_t[2]-_t[3]),Dt=Math.abs(_t[0]-_t[2])+Math.abs(_t[1]-_t[3]),Ct=Math.min(.25,.5*ue*(zt+ht)/at),Rt=Math.min(.25,.5*ue*Dt/rt);var Gt,ft,sn,mn,dn;return Ce+Math.max(Ct*K,Rt*ce)}(f,b,w):T;return{base:T+(0===l)?-1:l,top:E?Math.max(A+u,T+l+2):T+u}}const C1=He([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:T1}=C1,E1=He([{name:"a_packed",components:4,type:"Float32"}]),{members:D1}=E1,I1=al.types,AI=Math.cos(Math.PI/180*37.5);class q_{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.id),this.index=o.index,this.projection=o.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new pt,this.layoutVertexArray2=new Nt,this.indexArray=new En,this.programConfigurations=new Zh(o.layers,o.zoom),this.segments=new Hr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(o,l,u,f){this.hasPattern=Ig("line",this.layers,l);const b=this.layers[0].layout.get("line-sort-key"),v=[];for(const{feature:A,id:P,index:L,sourceLayerIndex:N}of o){const B=this.layers[0]._featureFilter.needGeometry,$=Lu(A,B);if(!this.layers[0]._featureFilter.filter(new R(this.zoom),$,u))continue;const K=b?b.evaluate($,{},u):void 0,ce={id:P,properties:A.properties,type:A.type,sourceLayerIndex:N,index:L,geometry:B?$.geometry:qc(A,u,f),patterns:{},sortKey:K};v.push(ce)}b&&v.sort((A,P)=>A.sortKey-P.sortKey);const{lineAtlas:w,featureIndex:T}=l,E=this.addConstantDashes(w);for(const A of v){const{geometry:P,index:L,sourceLayerIndex:N}=A;if(E&&this.addFeatureDashes(A,w),this.hasPattern){const B=Mg("line",this.layers,A,this.zoom,l);this.patternFeatures.push(B)}else this.addFeature(A,P,L,u,w.positions,l.availableImages);T.insert(o[L].feature,P,L,N,this.index)}}addConstantDashes(o){let l=!1;for(const u of this.layers){const f=u.paint.get("line-dasharray").value,b=u.layout.get("line-cap").value;if("constant"!==f.kind||"constant"!==b.kind)l=!0;else{const v=b.value,w=f.value;if(!w)continue;o.addDash(w,v)}}return l}addFeatureDashes(o,l){const u=this.zoom;for(const f of this.layers){const b=f.paint.get("line-dasharray").value,v=f.layout.get("line-cap").value;if("constant"===b.kind&&"constant"===v.kind)continue;let w,T;if("constant"===b.kind){if(w=b.value,!w)continue}else w=b.evaluate({zoom:u},o);T="constant"===v.kind?v.value:v.evaluate({zoom:u},o),l.addDash(w,T),o.patterns[f.id]=l.getKey(w,T)}}update(o,l,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,l,this.stateDependentLayers,u,f)}addFeatures(o,l,u,f,b){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,l,u,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=o.createVertexBuffer(this.layoutVertexArray2,D1)),this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,T1),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(o){if(o.properties&&o.properties.hasOwnProperty("mapbox_clip_start")&&o.properties.hasOwnProperty("mapbox_clip_end"))return{start:+o.properties.mapbox_clip_start,end:+o.properties.mapbox_clip_end}}addFeature(o,l,u,f,b,v){const w=this.layers[0].layout,T=w.get("line-join").evaluate(o,{}),E=w.get("line-cap").evaluate(o,{}),A=w.get("line-miter-limit"),P=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(o);for(const L of l)this.addLine(L,o,T,E,A,P);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,u,b,v,f)}addLine(o,l,u,f,b,v){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ce=0;ce<o.length-1;ce++)this.totalDistance+=o[ce].dist(o[ce+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const w="Polygon"===I1[l.type];let T=o.length;for(;T>=2&&o[T-1].equals(o[T-2]);)T--;let E=0;for(;E<T-1&&o[E].equals(o[E+1]);)E++;if(T<(w?3:2))return;"bevel"===u&&(b=1.05);const A=this.overscaling<=16?15*Pn/(512*this.overscaling):0,P=this.segments.prepareSegment(10*T,this.layoutVertexArray,this.indexArray);let L,N,B,$,K;this.e1=this.e2=-1,w&&(L=o[T-2],K=o[E].sub(L)._unit()._perp());for(let ce=E;ce<T;ce++){if(B=ce===T-1?w?o[E+1]:void 0:o[ce+1],B&&o[ce].equals(B))continue;K&&($=K),L&&(N=L),L=o[ce],K=B?B.sub(L)._unit()._perp():$,$=$||K;let Ce=$.add(K);0===Ce.x&&0===Ce.y||Ce._unit();const ue=$.x*K.x+$.y*K.y,ve=Ce.x*K.x+Ce.y*K.y,Ae=0!==ve?1/ve:1/0,ke=2*Math.sqrt(2-2*ve),at=ve<AI&&N&&B,rt=$.x*K.y-$.y*K.x>0;if(at&&ce>E){const ht=L.dist(N);if(ht>2*A){const Dt=L.sub(L.sub(N)._mult(A/ht)._round());this.updateDistance(N,Dt),this.addCurrentVertex(Dt,$,0,0,P),N=Dt}}const _t=N&&B;let zt=_t?u:w?"butt":f;if(_t&&"round"===zt&&(Ae<v?zt="miter":Ae<=2&&(zt="fakeround")),"miter"===zt&&Ae>b&&(zt="bevel"),"bevel"===zt&&(Ae>2&&(zt="flipbevel"),Ae<b&&(zt="miter")),N&&this.updateDistance(N,L),"miter"===zt)Ce._mult(Ae),this.addCurrentVertex(L,Ce,0,0,P);else if("flipbevel"===zt){if(Ae>100)Ce=K.mult(-1);else{const ht=Ae*$.add(K).mag()/$.sub(K).mag();Ce._perp()._mult(ht*(rt?-1:1))}this.addCurrentVertex(L,Ce,0,0,P),this.addCurrentVertex(L,Ce.mult(-1),0,0,P)}else if("bevel"===zt||"fakeround"===zt){const ht=-Math.sqrt(Ae*Ae-1),Dt=rt?ht:0,Ct=rt?0:ht;if(N&&this.addCurrentVertex(L,$,Dt,Ct,P),"fakeround"===zt){const Rt=Math.round(180*ke/Math.PI/20);for(let Gt=1;Gt<Rt;Gt++){let ft=Gt/Rt;if(.5!==ft){const mn=ft-.5;ft+=ft*mn*(ft-1)*((1.0904+ue*(ue*(3.55645-1.43519*ue)-3.2452))*mn*mn+(.848013+ue*(.215638*ue-1.06021)))}const sn=K.sub($)._mult(ft)._add($)._unit()._mult(rt?-1:1);this.addHalfVertex(L,sn.x,sn.y,!1,rt,0,P)}}B&&this.addCurrentVertex(L,K,-Dt,-Ct,P)}else if("butt"===zt)this.addCurrentVertex(L,Ce,0,0,P);else if("square"===zt){const ht=N?1:-1;N||this.addCurrentVertex(L,Ce,ht,ht,P),this.addCurrentVertex(L,Ce,0,0,P),N&&this.addCurrentVertex(L,Ce,ht,ht,P)}else"round"===zt&&(N&&(this.addCurrentVertex(L,$,0,0,P),this.addCurrentVertex(L,$,1,1,P,!0)),B&&(this.addCurrentVertex(L,K,-1,-1,P,!0),this.addCurrentVertex(L,K,0,0,P)));if(at&&ce<T-1){const ht=L.dist(B);if(ht>2*A){const Dt=L.add(B.sub(L)._mult(A/ht)._round());this.updateDistance(L,Dt),this.addCurrentVertex(Dt,K,0,0,P),L=Dt}}}}addCurrentVertex(o,l,u,f,b,v=!1){const w=l.y*f-l.x,T=-l.y-l.x*f;this.addHalfVertex(o,l.x+l.y*u,l.y-l.x*u,v,!1,u,b),this.addHalfVertex(o,w,T,v,!0,-f,b)}addHalfVertex({x:o,y:l},u,f,b,v,w,T){this.layoutVertexArray.emplaceBack((o<<1)+(b?1:0),(l<<1)+(v?1:0),Math.round(63*u)+128,Math.round(63*f)+128,1+(0===w?0:w<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const E=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,E),T.primitiveLength++),v?this.e2=E:this.e1=E}updateScaledDistance(){if(this.lineClips){const o=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=o*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(o,l){this.distance+=o.dist(l),this.updateScaledDistance()}}gn(q_,"LineBucket",{omit:["layers","patternFeatures"]});const zf=new ge({"line-cap":new J(bt.layout_line["line-cap"]),"line-join":new J(bt.layout_line["line-join"]),"line-miter-limit":new U(bt.layout_line["line-miter-limit"]),"line-round-limit":new U(bt.layout_line["line-round-limit"]),"line-sort-key":new J(bt.layout_line["line-sort-key"])});var Lg={paint:new ge({"line-opacity":new J(bt.paint_line["line-opacity"]),"line-color":new J(bt.paint_line["line-color"]),"line-translate":new U(bt.paint_line["line-translate"]),"line-translate-anchor":new U(bt.paint_line["line-translate-anchor"]),"line-width":new J(bt.paint_line["line-width"]),"line-gap-width":new J(bt.paint_line["line-gap-width"]),"line-offset":new J(bt.paint_line["line-offset"]),"line-blur":new J(bt.paint_line["line-blur"]),"line-dasharray":new J(bt.paint_line["line-dasharray"]),"line-pattern":new J(bt.paint_line["line-pattern"]),"line-gradient":new pe(bt.paint_line["line-gradient"]),"line-trim-offset":new U(bt.paint_line["line-trim-offset"])}),layout:zf};const W_=new class extends J{possiblyEvaluate(a,o){return o=new R(Math.floor(o.zoom),{now:o.now,fadeDuration:o.fadeDuration,transition:o.transition}),super.possiblyEvaluate(a,o)}evaluate(a,o,l,u){return o=Li({},o,{zoom:Math.floor(o.zoom)}),super.evaluate(a,o,l,u)}}(Lg.paint.properties["line-width"].specification);function X_(a,o){return o>0?o+2*a:a}W_.useIntegerZoom=!0;const A0=He([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),M1=He([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),k0=He([{name:"a_projected_pos",components:4,type:"Float32"}],4);He([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const R0=He([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Z_=He([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);He([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const A1=He([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),k1=He([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);He([{name:"triangle",components:3,type:"Uint16"}]),He([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),He([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),He([{type:"Float32",name:"offsetX"}]),He([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);const cl=128;function Og(a,o){const{expression:l}=o;if("constant"===l.kind)return{kind:"constant",layoutSize:l.evaluate(new R(a+1))};if("source"===l.kind)return{kind:"source"};{const{zoomStops:u,interpolationType:f}=l;let b=0;for(;b<u.length&&u[b]<=a;)b++;b=Math.max(0,b-1);let v=b;for(;v<u.length&&u[v]<a+1;)v++;v=Math.min(u.length-1,v);const w=u[b],T=u[v];return"composite"===l.kind?{kind:"composite",minZoom:w,maxZoom:T,interpolationType:f}:{kind:"camera",minZoom:w,maxZoom:T,minSize:l.evaluate(new R(w)),maxSize:l.evaluate(new R(T)),interpolationType:f}}}function dc(a,{uSize:o,uSizeT:l},{lowerSize:u,upperSize:f}){return"source"===a.kind?u/cl:"composite"===a.kind?Bi(u/cl,f/cl,l):o}function ap(a,o){let l=0,u=0;if("constant"===a.kind)u=a.layoutSize;else if("source"!==a.kind){const{interpolationType:f,minZoom:b,maxZoom:v}=a,w=f?Tt(no.interpolationFactor(f,o,b,v),0,1):0;"camera"===a.kind?u=Bi(a.minSize,a.maxSize,w):l=w}return{uSizeT:l,uSize:u}}var Y_=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:cl,evaluateSizeForFeature:dc,evaluateSizeForZoom:ap,getSizeData:Og});function Fg(a,o,l){return a.sections.forEach(u=>{u.text=function(f,b,v){const w=b.layout.get("text-transform").evaluate(v,{});return"uppercase"===w?f=f.toLocaleUpperCase():"lowercase"===w&&(f=f.toLocaleLowerCase()),I.applyArabicShaping&&(f=I.applyArabicShaping(f)),f}(u.text,o,l)}),a}const Vf={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function K_(a){return"\ufe36"===a||"\ufe48"===a||"\ufe38"===a||"\ufe44"===a||"\ufe42"===a||"\ufe3e"===a||"\ufe3c"===a||"\ufe3a"===a||"\ufe18"===a||"\ufe40"===a||"\ufe10"===a||"\ufe13"===a||"\ufe14"===a||"\uff40"===a||"\uffe3"===a||"\ufe11"===a||"\ufe12"===a}function Ng(a){return"\ufe35"===a||"\ufe47"===a||"\ufe37"===a||"\ufe43"===a||"\ufe41"===a||"\ufe3d"===a||"\ufe3b"===a||"\ufe39"===a||"\ufe17"===a||"\ufe3f"===a}var Zc=Mr,Q_=function(a,o,l,u,f){var b,v,w=8*f-u-1,T=(1<<w)-1,E=T>>1,A=-7,P=l?f-1:0,L=l?-1:1,N=a[o+P];for(P+=L,b=N&(1<<-A)-1,N>>=-A,A+=w;A>0;b=256*b+a[o+P],P+=L,A-=8);for(v=b&(1<<-A)-1,b>>=-A,A+=u;A>0;v=256*v+a[o+P],P+=L,A-=8);if(0===b)b=1-E;else{if(b===T)return v?NaN:1/0*(N?-1:1);v+=Math.pow(2,u),b-=E}return(N?-1:1)*v*Math.pow(2,b-u)},Bg=function(a,o,l,u,f,b){var v,w,T,E=8*b-f-1,A=(1<<E)-1,P=A>>1,L=23===f?Math.pow(2,-24)-Math.pow(2,-77):0,N=u?0:b-1,B=u?1:-1,$=o<0||0===o&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(w=isNaN(o)?1:0,v=A):(v=Math.floor(Math.log(o)/Math.LN2),o*(T=Math.pow(2,-v))<1&&(v--,T*=2),(o+=v+P>=1?L/T:L*Math.pow(2,1-P))*T>=2&&(v++,T/=2),v+P>=A?(w=0,v=A):v+P>=1?(w=(o*T-1)*Math.pow(2,f),v+=P):(w=o*Math.pow(2,P-1)*Math.pow(2,f),v=0));f>=8;a[l+N]=255&w,N+=B,w/=256,f-=8);for(v=v<<f|w,E+=f;E>0;a[l+N]=255&v,N+=B,v/=256,E-=8);a[l+N-B]|=128*$};function Mr(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}Mr.Varint=0,Mr.Fixed64=1,Mr.Bytes=2,Mr.Fixed32=5;var J_=4294967296,ey=1/J_,$d="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function Yc(a){return a.type===Mr.Bytes?a.readVarint()+a.pos:a.pos+1}function P0(a,o,l){var u=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));l.realloc(u);for(var f=l.pos-1;f>=a;f--)l.buf[f+u]=l.buf[f]}function R1(a,o){for(var l=0;l<a.length;l++)o.writeVarint(a[l])}function ty(a,o){for(var l=0;l<a.length;l++)o.writeSVarint(a[l])}function P1(a,o){for(var l=0;l<a.length;l++)o.writeFloat(a[l])}function L0(a,o){for(var l=0;l<a.length;l++)o.writeDouble(a[l])}function L1(a,o){for(var l=0;l<a.length;l++)o.writeBoolean(a[l])}function O0(a,o){for(var l=0;l<a.length;l++)o.writeFixed32(a[l])}function kI(a,o){for(var l=0;l<a.length;l++)o.writeSFixed32(a[l])}function O1(a,o){for(var l=0;l<a.length;l++)o.writeFixed64(a[l])}function Gd(a,o){for(var l=0;l<a.length;l++)o.writeSFixed64(a[l])}function zg(a,o){return(a[o]|a[o+1]<<8|a[o+2]<<16)+16777216*a[o+3]}function Rl(a,o,l){a[l]=o,a[l+1]=o>>>8,a[l+2]=o>>>16,a[l+3]=o>>>24}function Tn(a,o){return(a[o]|a[o+1]<<8|a[o+2]<<16)+(a[o+3]<<24)}Mr.prototype={destroy:function(){this.buf=null},readFields:function(a,o,l){for(l=l||this.length;this.pos<l;){var u=this.readVarint(),f=u>>3,b=this.pos;this.type=7&u,a(f,o,this),this.pos===b&&this.skip(u)}return o},readMessage:function(a,o){return this.readFields(a,o,this.readVarint()+this.pos)},readFixed32:function(){var a=zg(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=Tn(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=zg(this.buf,this.pos)+zg(this.buf,this.pos+4)*J_;return this.pos+=8,a},readSFixed64:function(){var a=zg(this.buf,this.pos)+Tn(this.buf,this.pos+4)*J_;return this.pos+=8,a},readFloat:function(){var a=Q_(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=Q_(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var o,l,u=this.buf;return o=127&(l=u[this.pos++]),l<128?o:(o|=(127&(l=u[this.pos++]))<<7,l<128?o:(o|=(127&(l=u[this.pos++]))<<14,l<128?o:(o|=(127&(l=u[this.pos++]))<<21,l<128?o:function(f,b,v){var w,T,E=v.buf;if(w=(112&(T=E[v.pos++]))>>4,T<128||(w|=(127&(T=E[v.pos++]))<<3,T<128)||(w|=(127&(T=E[v.pos++]))<<10,T<128)||(w|=(127&(T=E[v.pos++]))<<17,T<128)||(w|=(127&(T=E[v.pos++]))<<24,T<128)||(w|=(1&(T=E[v.pos++]))<<31,T<128))return function lp(a,o,l){return l?4294967296*o+(a>>>0):4294967296*(o>>>0)+(a>>>0)}(f,w,b);throw new Error("Expected varint not more than 10 bytes")}(o|=(15&(l=u[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var a=this.readVarint()+this.pos,o=this.pos;return this.pos=a,a-o>=12&&$d?$d.decode(this.buf.subarray(o,a)):function(l,u,f){for(var b="",v=u;v<f;){var w,T,E,A=l[v],P=null,L=A>239?4:A>223?3:A>191?2:1;if(v+L>f)break;1===L?A<128&&(P=A):2===L?128==(192&(w=l[v+1]))&&(P=(31&A)<<6|63&w)<=127&&(P=null):3===L?(T=l[v+2],128==(192&(w=l[v+1]))&&128==(192&T)&&((P=(15&A)<<12|(63&w)<<6|63&T)<=2047||P>=55296&&P<=57343)&&(P=null)):4===L&&(T=l[v+2],E=l[v+3],128==(192&(w=l[v+1]))&&128==(192&T)&&128==(192&E)&&((P=(15&A)<<18|(63&w)<<12|(63&T)<<6|63&E)<=65535||P>=1114112)&&(P=null)),null===P?(P=65533,L=1):P>65535&&(P-=65536,b+=String.fromCharCode(P>>>10&1023|55296),P=56320|1023&P),b+=String.fromCharCode(P),v+=L}return b}(this.buf,o,a)},readBytes:function(){var a=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,a);return this.pos=a,o},readPackedVarint:function(a,o){if(this.type!==Mr.Bytes)return a.push(this.readVarint(o));var l=Yc(this);for(a=a||[];this.pos<l;)a.push(this.readVarint(o));return a},readPackedSVarint:function(a){if(this.type!==Mr.Bytes)return a.push(this.readSVarint());var o=Yc(this);for(a=a||[];this.pos<o;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==Mr.Bytes)return a.push(this.readBoolean());var o=Yc(this);for(a=a||[];this.pos<o;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==Mr.Bytes)return a.push(this.readFloat());var o=Yc(this);for(a=a||[];this.pos<o;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==Mr.Bytes)return a.push(this.readDouble());var o=Yc(this);for(a=a||[];this.pos<o;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==Mr.Bytes)return a.push(this.readFixed32());var o=Yc(this);for(a=a||[];this.pos<o;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==Mr.Bytes)return a.push(this.readSFixed32());var o=Yc(this);for(a=a||[];this.pos<o;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==Mr.Bytes)return a.push(this.readFixed64());var o=Yc(this);for(a=a||[];this.pos<o;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==Mr.Bytes)return a.push(this.readSFixed64());var o=Yc(this);for(a=a||[];this.pos<o;)a.push(this.readSFixed64());return a},skip:function(a){var o=7&a;if(o===Mr.Varint)for(;this.buf[this.pos++]>127;);else if(o===Mr.Bytes)this.pos=this.readVarint()+this.pos;else if(o===Mr.Fixed32)this.pos+=4;else{if(o!==Mr.Fixed64)throw new Error("Unimplemented type: "+o);this.pos+=8}},writeTag:function(a,o){this.writeVarint(a<<3|o)},realloc:function(a){for(var o=this.length||16;o<this.pos+a;)o*=2;if(o!==this.length){var l=new Uint8Array(o);l.set(this.buf),this.buf=l,this.length=o}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),Rl(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),Rl(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),Rl(this.buf,-1&a,this.pos),Rl(this.buf,Math.floor(a*ey),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),Rl(this.buf,-1&a,this.pos),Rl(this.buf,Math.floor(a*ey),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(o,l){var u,f,b,w;if(o>=0?(u=o%4294967296|0,f=o/4294967296|0):(f=~(-o/4294967296),4294967295^(u=~(-o%4294967296))?u=u+1|0:(u=0,f=f+1|0)),o>=0x10000000000000000||o<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),b=u,(w=l).buf[w.pos++]=127&b|128,b>>>=7,w.buf[w.pos++]=127&b|128,b>>>=7,w.buf[w.pos++]=127&b|128,b>>>=7,w.buf[w.pos++]=127&b|128,w.buf[w.pos]=127&(b>>>=7),function(b,v){var w=(7&b)<<4;v.buf[v.pos++]|=w|((b>>>=3)?128:0),b&&(v.buf[v.pos++]=127&b|((b>>>=7)?128:0),b&&(v.buf[v.pos++]=127&b|((b>>>=7)?128:0),b&&(v.buf[v.pos++]=127&b|((b>>>=7)?128:0),b&&(v.buf[v.pos++]=127&b|((b>>>=7)?128:0),b&&(v.buf[v.pos++]=127&b)))))}(f,l)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(Boolean(a))},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var o=this.pos;this.pos=function(u,f,b){for(var v,w,T=0;T<f.length;T++){if((v=f.charCodeAt(T))>55295&&v<57344){if(!w){v>56319||T+1===f.length?(u[b++]=239,u[b++]=191,u[b++]=189):w=v;continue}if(v<56320){u[b++]=239,u[b++]=191,u[b++]=189,w=v;continue}v=w-55296<<10|v-56320|65536,w=null}else w&&(u[b++]=239,u[b++]=191,u[b++]=189,w=null);v<128?u[b++]=v:(v<2048?u[b++]=v>>6|192:(v<65536?u[b++]=v>>12|224:(u[b++]=v>>18|240,u[b++]=v>>12&63|128),u[b++]=v>>6&63|128),u[b++]=63&v|128)}return b}(this.buf,a,this.pos);var l=this.pos-o;l>=128&&P0(o,l,this),this.pos=o-1,this.writeVarint(l),this.pos+=l},writeFloat:function(a){this.realloc(4),Bg(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),Bg(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var o=a.length;this.writeVarint(o),this.realloc(o);for(var l=0;l<o;l++)this.buf[this.pos++]=a[l]},writeRawMessage:function(a,o){this.pos++;var l=this.pos;a(o,this);var u=this.pos-l;u>=128&&P0(l,u,this),this.pos=l-1,this.writeVarint(u),this.pos+=u},writeMessage:function(a,o,l){this.writeTag(a,Mr.Bytes),this.writeRawMessage(o,l)},writePackedVarint:function(a,o){o.length&&this.writeMessage(a,R1,o)},writePackedSVarint:function(a,o){o.length&&this.writeMessage(a,ty,o)},writePackedBoolean:function(a,o){o.length&&this.writeMessage(a,L1,o)},writePackedFloat:function(a,o){o.length&&this.writeMessage(a,P1,o)},writePackedDouble:function(a,o){o.length&&this.writeMessage(a,L0,o)},writePackedFixed32:function(a,o){o.length&&this.writeMessage(a,O0,o)},writePackedSFixed32:function(a,o){o.length&&this.writeMessage(a,kI,o)},writePackedFixed64:function(a,o){o.length&&this.writeMessage(a,O1,o)},writePackedSFixed64:function(a,o){o.length&&this.writeMessage(a,Gd,o)},writeBytesField:function(a,o){this.writeTag(a,Mr.Bytes),this.writeBytes(o)},writeFixed32Field:function(a,o){this.writeTag(a,Mr.Fixed32),this.writeFixed32(o)},writeSFixed32Field:function(a,o){this.writeTag(a,Mr.Fixed32),this.writeSFixed32(o)},writeFixed64Field:function(a,o){this.writeTag(a,Mr.Fixed64),this.writeFixed64(o)},writeSFixed64Field:function(a,o){this.writeTag(a,Mr.Fixed64),this.writeSFixed64(o)},writeVarintField:function(a,o){this.writeTag(a,Mr.Varint),this.writeVarint(o)},writeSVarintField:function(a,o){this.writeTag(a,Mr.Varint),this.writeSVarint(o)},writeStringField:function(a,o){this.writeTag(a,Mr.Bytes),this.writeString(o)},writeFloatField:function(a,o){this.writeTag(a,Mr.Fixed32),this.writeFloat(o)},writeDoubleField:function(a,o){this.writeTag(a,Mr.Fixed64),this.writeDouble(o)},writeBooleanField:function(a,o){this.writeVarintField(a,Boolean(o))}};var Vg=_n(Zc);function jf(a,o,l){o.glyphs=[],1===a&&l.readMessage(hc,o)}function hc(a,o,l){if(3===a){const{id:u,bitmap:f,width:b,height:v,left:w,top:T,advance:E}=l.readMessage(F1,{});o.glyphs.push({id:u,bitmap:new Wc({width:b+6,height:v+6},f),metrics:{width:b,height:v,left:w,top:T,advance:E}})}else 4===a?o.ascender=l.readSVarint():5===a&&(o.descender=l.readSVarint())}function F1(a,o,l){1===a?o.id=l.readVarint():2===a?o.bitmap=l.readBytes():3===a?o.width=l.readVarint():4===a?o.height=l.readVarint():5===a?o.left=l.readSVarint():6===a?o.top=l.readSVarint():7===a&&(o.advance=l.readVarint())}function Kc(a){let o=0,l=0;for(const v of a)o+=v.w*v.h,l=Math.max(l,v.w);a.sort((v,w)=>w.h-v.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),l),h:1/0}];let f=0,b=0;for(const v of a)for(let w=u.length-1;w>=0;w--){const T=u[w];if(!(v.w>T.w||v.h>T.h)){if(v.x=T.x,v.y=T.y,b=Math.max(b,v.y+v.h),f=Math.max(f,v.x+v.w),v.w===T.w&&v.h===T.h){const E=u.pop();w<u.length&&(u[w]=E)}else v.h===T.h?(T.x+=v.w,T.w-=v.w):v.w===T.w?(T.y+=v.h,T.h-=v.h):(u.push({x:T.x+v.w,y:T.y,w:T.w-v.w,h:v.h}),T.y+=v.h,T.h-=v.h);break}}return{w:f,h:b,fill:o/(f*b)||0}}class Uf{constructor(o,{pixelRatio:l,version:u,stretchX:f,stretchY:b,content:v}){this.paddedRect=o,this.pixelRatio=l,this.stretchX=f,this.stretchY=b,this.content=v,this.version=u}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class jg{constructor(o,l){const u={},f={};this.haveRenderCallbacks=[];const b=[];this.addImages(o,u,b),this.addImages(l,f,b);const{w:v,h:w}=Kc(b),T=new Qs({width:v||1,height:w||1});for(const E in o){const A=o[E],P=u[E].paddedRect;Qs.copy(A.data,T,{x:0,y:0},{x:P.x+1,y:P.y+1},A.data)}for(const E in l){const A=l[E],P=f[E].paddedRect,L=P.x+1,N=P.y+1,B=A.data.width,$=A.data.height;Qs.copy(A.data,T,{x:0,y:0},{x:L,y:N},A.data),Qs.copy(A.data,T,{x:0,y:$-1},{x:L,y:N-1},{width:B,height:1}),Qs.copy(A.data,T,{x:0,y:0},{x:L,y:N+$},{width:B,height:1}),Qs.copy(A.data,T,{x:B-1,y:0},{x:L-1,y:N},{width:1,height:$}),Qs.copy(A.data,T,{x:0,y:0},{x:L+B,y:N},{width:1,height:$})}this.image=T,this.iconPositions=u,this.patternPositions=f}addImages(o,l,u){for(const f in o){const b=o[f],v={x:0,y:0,w:b.data.width+2,h:b.data.height+2};u.push(v),l[f]=new Uf(v,b),b.hasRenderCallback&&this.haveRenderCallbacks.push(f)}}patchUpdatedImages(o,l){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(u=>o.hasImage(u)),o.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const u in o.updatedImages)this.patchUpdatedImage(this.iconPositions[u],o.getImage(u),l),this.patchUpdatedImage(this.patternPositions[u],o.getImage(u),l)}patchUpdatedImage(o,l,u){if(!o||!l||o.version===l.version)return;o.version=l.version;const[f,b]=o.tl;u.update(l.data,void 0,{x:f,y:b})}}gn(Uf,"ImagePosition"),gn(jg,"ImageAtlas");const Na={horizontal:1,vertical:2,horizontalOnly:3};class ul{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(o,l){const u=new ul;return u.scale=o||1,u.fontStack=l,u}static forImage(o){const l=new ul;return l.imageName=o,l}}class cp{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(o,l){const u=new cp;for(let f=0;f<o.sections.length;f++){const b=o.sections[f];b.image?u.addImageSection(b):u.addTextSection(b,l)}return u}length(){return this.text.length}getSection(o){return this.sections[this.sectionIndex[o]]}getSections(){return this.sections}getSectionIndex(o){return this.sectionIndex[o]}getCharCode(o){return this.text.charCodeAt(o)}verticalizePunctuation(o){this.text=function(l,u){let f="";for(let b=0;b<l.length;b++){const v=l.charCodeAt(b+1)||null,w=l.charCodeAt(b-1)||null;f+=!u&&(v&&Ym(v)&&!Vf[l[b+1]]||w&&Ym(w)&&!Vf[l[b-1]])||!Vf[l[b]]?l[b]:Vf[l[b]]}return f}(this.text,o)}trim(){let o=0;for(let u=0;u<this.text.length&&Hg[this.text.charCodeAt(u)];u++)o++;let l=this.text.length;for(let u=this.text.length-1;u>=0&&u>=o&&Hg[this.text.charCodeAt(u)];u--)l--;this.text=this.text.substring(o,l),this.sectionIndex=this.sectionIndex.slice(o,l)}substring(o,l){const u=new cp;return u.text=this.text.substring(o,l),u.sectionIndex=this.sectionIndex.slice(o,l),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((o,l)=>Math.max(o,this.sections[l].scale),0)}addTextSection(o,l){this.text+=o.text,this.sections.push(ul.forText(o.scale,o.fontStack||l));const u=this.sections.length-1;for(let f=0;f<o.text.length;++f)this.sectionIndex.push(u)}addImageSection(o){const l=o.image?o.image.name:"";if(0===l.length)return void Qn("Can't add FormattedSection with an empty image.");const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(ul.forImage(l)),this.sectionIndex.push(this.sections.length-1)):Qn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function ny(a,o,l,u,f,b,v,w,T,E,A,P,L,N,B){const $=cp.fromFeature(a,f);P===Na.vertical&&$.verticalizePunctuation(L);let K=[];const ce=function(ke,at,rt,_t,zt,ht){if(!ke)return[];const Dt=[],Ct=function(sn,mn,dn,Wn,Xt,kn){let Jn=0;for(let ji=0;ji<sn.length();ji++){const ei=sn.getSection(ji);Jn+=B0(sn.getCharCode(ji),ei,Wn,Xt,mn,kn)}return Jn/Math.max(1,Math.ceil(Jn/dn))}(ke,at,rt,_t,zt,ht),Rt=ke.text.indexOf("\u200b")>=0;let Gt=0;for(let sn=0;sn<ke.length();sn++){const mn=ke.getSection(sn),dn=ke.getCharCode(sn);if(Hg[dn]||(Gt+=B0(dn,mn,_t,zt,at,ht)),sn<ke.length()-1){const Wn=!((ft=dn)<11904||!(on_Bopomofo_Extended(ft)||on_Bopomofo(ft)||on_CJK_Compatibility_Forms(ft)||on_CJK_Compatibility_Ideographs(ft)||on_CJK_Compatibility(ft)||on_CJK_Radicals_Supplement(ft)||on_CJK_Strokes(ft)||on_CJK_Symbols_and_Punctuation(ft)||on_CJK_Unified_Ideographs_Extension_A(ft)||on_CJK_Unified_Ideographs(ft)||on_Enclosed_CJK_Letters_and_Months(ft)||on_Halfwidth_and_Fullwidth_Forms(ft)||on_Hiragana(ft)||on_Ideographic_Description_Characters(ft)||on_Kangxi_Radicals(ft)||on_Katakana_Phonetic_Extensions(ft)||on_Katakana(ft)||on_Vertical_Forms(ft)||on_Yi_Radicals(ft)||on_Yi_Syllables(ft)));(N1[dn]||Wn||mn.imageName)&&Dt.push(qd(sn+1,Gt,Ct,Dt,B1(dn,ke.getCharCode(sn+1),Wn&&Rt),!1))}}var ft;return pc(qd(ke.length(),Gt,Ct,Dt,0,!0))}($,E,b,o,u,N),{processBidirectionalText:Ce,processStyledBidirectionalText:ue}=I;if(Ce&&1===$.sections.length){const ke=Ce($.toString(),ce);for(const at of ke){const rt=new cp;rt.text=at,rt.sections=$.sections;for(let _t=0;_t<at.length;_t++)rt.sectionIndex.push(0);K.push(rt)}}else if(ue){const ke=ue($.text,$.sectionIndex,ce);for(const at of ke){const rt=new cp;rt.text=at[0],rt.sectionIndex=at[1],rt.sections=$.sections,K.push(rt)}}else K=function(ke,at){const rt=[],_t=ke.text;let zt=0;for(const ht of at)rt.push(ke.substring(zt,ht)),zt=ht;return zt<_t.length&&rt.push(ke.substring(zt,_t.length)),rt}($,ce);const ve=[],Ae={positionedLines:ve,text:$.toString(),top:A[1],bottom:A[1],left:A[0],right:A[0],writingMode:P,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ke,at,rt,_t,zt,ht,Dt,Ct,Rt,Gt,ft,sn){let mn=0,dn=0,Wn=0;const Xt="right"===Ct?1:"left"===Ct?0:.5;let kn=!1;for(const Xn of zt){const Zn=Xn.getSections();for(const ir of Zn){if(ir.imageName)continue;const Ar=at[ir.fontStack];if(Ar&&(kn=void 0!==Ar.ascender&&void 0!==Ar.descender,!kn))break}if(!kn)break}let Jn=0;for(const Xn of zt){Xn.trim();const Zn=Xn.getMaxScale(),ir=24*(Zn-1),Ar={positionedGlyphs:[],lineOffset:0};ke.positionedLines[Jn]=Ar;const fr=Ar.positionedGlyphs;let mr=0;if(!Xn.length()){dn+=ht,++Jn;continue}let $r=0,Yr=0;for(let xr=0;xr<Xn.length();xr++){const Do=Xn.getSection(xr),po=Xn.getSectionIndex(xr),Kr=Xn.getCharCode(xr);let Ki=Do.scale,fo=null,kr=null,ws=null,qt=24,qo=0;const vo=!(Rt===Na.horizontal||!ft&&!lf(Kr)||ft&&(Hg[Kr]||(ji=Kr,on_Arabic(ji)||on_Arabic_Supplement(ji)||on_Arabic_Extended_A(ji)||on_Arabic_Presentation_Forms_A(ji)||on_Arabic_Presentation_Forms_B(ji))));if(Do.imageName){const Vs=_t[Do.imageName];if(!Vs)continue;ws=Do.imageName,ke.iconsInText=ke.iconsInText||!0,kr=Vs.paddedRect;const Lo=Vs.displaySize;Ki=24*Ki/sn,fo={width:Lo[0],height:Lo[1],left:1,top:-3,advance:vo?Lo[1]:Lo[0],localGlyph:!1},qo=kn?-fo.height*Ki:24*Zn-17-Lo[1]*Ki,qt=fo.advance;const Fl=(vo?Lo[0]:Lo[1])*Ki-24*Zn;Fl>0&&Fl>mr&&(mr=Fl)}else{const Vs=rt[Do.fontStack];if(!Vs)continue;Vs[Kr]&&(kr=Vs[Kr]);const Lo=at[Do.fontStack];if(!Lo)continue;const Fl=Lo.glyphs[Kr];if(!Fl)continue;if(fo=Fl.metrics,qt=8203!==Kr?24:0,kn){const _p=void 0!==Lo.ascender?Math.abs(Lo.ascender):0,Kf=void 0!==Lo.descender?Math.abs(Lo.descender):0,Qf=(_p+Kf)*Ki;$r<Qf&&($r=Qf,Yr=(_p-Kf)/2*Ki),qo=-_p*Ki}else qo=24*(Zn-Ki)-17}vo?(ke.verticalizable=!0,fr.push({glyph:Kr,imageName:ws,x:mn,y:dn+qo,vertical:vo,scale:Ki,localGlyph:fo.localGlyph,fontStack:Do.fontStack,sectionIndex:po,metrics:fo,rect:kr}),mn+=qt*Ki+Gt):(fr.push({glyph:Kr,imageName:ws,x:mn,y:dn+qo,vertical:vo,scale:Ki,localGlyph:fo.localGlyph,fontStack:Do.fontStack,sectionIndex:po,metrics:fo,rect:kr}),mn+=fo.advance*Ki+Gt)}0!==fr.length&&(Wn=Math.max(mn-Gt,Wn),kn?V0(fr,Xt,mr,Yr,ht*Zn/2):V0(fr,Xt,mr,0,ht/2)),mn=0;const Gr=ht*Zn+mr;Ar.lineOffset=Math.max(mr,ir),dn+=Gr,++Jn}var ji;const ei=dn,{horizontalAlign:Fn,verticalAlign:Gi}=iy(Dt);(function(Xn,Zn,ir,Ar,fr,mr){const $r=(Zn-ir)*fr,Yr=-mr*Ar;for(const Gr of Xn)for(const xr of Gr.positionedGlyphs)xr.x+=$r,xr.y+=Yr})(ke.positionedLines,Xt,Fn,Gi,Wn,ei),ke.top+=-Gi*ei,ke.bottom=ke.top+ei,ke.left+=-Fn*Wn,ke.right=ke.left+Wn,ke.hasBaseline=kn}(Ae,o,l,u,K,v,w,T,P,E,L,B),!function(ke){for(const at of ke)if(0!==at.positionedGlyphs.length)return!1;return!0}(ve)&&Ae}const Hg={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},N1={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function B0(a,o,l,u,f,b){if(o.imageName){const v=u[o.imageName];return v?v.displaySize[0]*o.scale*24/b+f:0}{const v=l[o.fontStack],w=v&&v.glyphs[a];return w?w.metrics.advance*o.scale+f:0}}function z0(a,o,l,u){const f=Math.pow(a-o,2);return u?a<o?f/2:2*f:f+Math.abs(l)*l}function B1(a,o,l){let u=0;return 10===a&&(u-=1e4),l&&(u+=150),40!==a&&65288!==a||(u+=50),41!==o&&65289!==o||(u+=50),u}function qd(a,o,l,u,f,b){let v=null,w=z0(o,l,f,b);for(const T of u){const E=z0(o-T.x,l,f,b)+T.badness;E<=w&&(v=T,w=E)}return{index:a,x:o,priorBreak:v,badness:w}}function pc(a){return a?pc(a.priorBreak).concat(a.index):[]}function iy(a){let o=.5,l=.5;switch(a){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:o,verticalAlign:l}}function V0(a,o,l,u,f){if(!(o||l||u||f))return;const b=a.length-1,v=a[b],w=(v.x+v.metrics.advance*v.scale)*o;for(let T=0;T<=b;T++)a[T].x-=w,a[T].y+=l+u+f}function RI(a,o,l){const{horizontalAlign:u,verticalAlign:f}=iy(l),b=o[0]-a.displaySize[0]*u,v=o[1]-a.displaySize[1]*f;return{image:a,top:v,bottom:v+a.displaySize[1],left:b,right:b+a.displaySize[0]}}function z1(a,o,l,u,f,b){const v=a.image;let w;if(v.content){const K=v.content,ce=v.pixelRatio||1;w=[K[0]/ce,K[1]/ce,v.displaySize[0]-K[2]/ce,v.displaySize[1]-K[3]/ce]}const T=o.left*b,E=o.right*b;let A,P,L,N;"width"===l||"both"===l?(N=f[0]+T-u[3],P=f[0]+E+u[1]):(N=f[0]+(T+E-v.displaySize[0])/2,P=N+v.displaySize[0]);const B=o.top*b,$=o.bottom*b;return"height"===l||"both"===l?(A=f[1]+B-u[0],L=f[1]+$+u[2]):(A=f[1]+(B+$-v.displaySize[1])/2,L=A+v.displaySize[1]),{image:v,top:A,right:P,bottom:L,left:N,collisionPadding:w}}class fc extends Ie{constructor(o,l,u,f,b){super(o,l),this.angle=f,this.z=u,void 0!==b&&(this.segment=b)}clone(){return new fc(this.x,this.y,this.z,this.angle,this.segment)}}function V1(a,o,l,u,f){if(void 0===o.segment)return!0;let b=o,v=o.segment+1,w=0;for(;w>-l/2;){if(v--,v<0)return!1;w-=a[v].dist(b),b=a[v]}w+=a[v].dist(a[v+1]),v++;const T=[];let E=0;for(;w<l/2;){const A=a[v],P=a[v+1];if(!P)return!1;let L=a[v-1].angleTo(A)-A.angleTo(P);for(L=Math.abs((L+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:w,angleDelta:L}),E+=L;w-T[0].distance>u;)E-=T.shift().angleDelta;if(E>f)return!1;v++,w+=A.dist(P)}return!0}function ry(a){let o=0;for(let l=0;l<a.length-1;l++)o+=a[l].dist(a[l+1]);return o}function j1(a,o,l){return a?.6*o*l:0}function oy(a,o){return Math.max(a?a.right-a.left:0,o?o.right-o.left:0)}function U1(a,o,l,u,f,b){const v=j1(l,f,b),w=oy(l,u)*b;let T=0;const E=ry(a)/2;for(let A=0;A<a.length-1;A++){const P=a[A],L=a[A+1],N=P.dist(L);if(T+N>E){const B=(E-T)/N,$=Bi(P.x,L.x,B),K=Bi(P.y,L.y,B),ce=new fc($,K,0,L.angleTo(P),A);return!v||V1(a,ce,w,v,o)?ce:void 0}T+=N}}function j0(a,o,l,u,f,b,v,w,T){const E=j1(u,b,v),A=oy(u,f),P=A*v,L=0===a[0].x||a[0].x===T||0===a[0].y||a[0].y===T;return o-P<o/4&&(o=P+o/4),U0(a,L?o/2*w%o:(A/2+2*b)*v*w%o,o,E,l,P,L,!1,T)}function U0(a,o,l,u,f,b,v,w,T){const E=b/2,A=ry(a);let P=0,L=o-l,N=[];for(let B=0;B<a.length-1;B++){const $=a[B],K=a[B+1],ce=$.dist(K),Ce=K.angleTo($);for(;L+l<P+ce;){L+=l;const ue=(L-P)/ce,ve=Bi($.x,K.x,ue),Ae=Bi($.y,K.y,ue);if(ve>=0&&ve<T&&Ae>=0&&Ae<T&&L-E>=0&&L+E<=A){const ke=new fc(ve,Ae,0,Ce,B);ke._round(),u&&!V1(a,ke,b,u,f)||N.push(ke)}}P+=ce}return w||N.length||v||(N=U0(a,P/2,l,u,f,b,v,!0,T)),N}function H0(a,o,l,u,f){const b=[];for(let v=0;v<a.length;v++){const w=a[v];let T;for(let E=0;E<w.length-1;E++){let A=w[E],P=w[E+1];A.x<o&&P.x<o||(A.x<o?A=new Ie(o,A.y+(o-A.x)/(P.x-A.x)*(P.y-A.y))._round():P.x<o&&(P=new Ie(o,A.y+(o-A.x)/(P.x-A.x)*(P.y-A.y))._round()),A.y<l&&P.y<l||(A.y<l?A=new Ie(A.x+(l-A.y)/(P.y-A.y)*(P.x-A.x),l)._round():P.y<l&&(P=new Ie(A.x+(l-A.y)/(P.y-A.y)*(P.x-A.x),l)._round()),A.x>=u&&P.x>=u||(A.x>=u?A=new Ie(u,A.y+(u-A.x)/(P.x-A.x)*(P.y-A.y))._round():P.x>=u&&(P=new Ie(u,A.y+(u-A.x)/(P.x-A.x)*(P.y-A.y))._round()),A.y>=f&&P.y>=f||(A.y>=f?A=new Ie(A.x+(f-A.y)/(P.y-A.y)*(P.x-A.x),f)._round():P.y>=f&&(P=new Ie(A.x+(f-A.y)/(P.y-A.y)*(P.x-A.x),f)._round()),T&&A.equals(T[T.length-1])||(T=[A],b.push(T)),T.push(P)))))}}return b}gn(fc,"Anchor");const ea=1e20;function $0(a,o,l,u,f,b,v,w,T){for(let E=o;E<o+u;E++)sy(a,l*b+E,b,f,v,w,T);for(let E=l;E<l+f;E++)sy(a,E*b+o,1,u,v,w,T)}function sy(a,o,l,u,f,b,v){b[0]=0,v[0]=-ea,v[1]=ea,f[0]=a[o];for(let w=1,T=0,E=0;w<u;w++){f[w]=a[o+w*l];const A=w*w;do{const P=b[T];E=(f[w]-f[P]+A-P*P)/(w-P)/2}while(E<=v[T]&&--T>-1);T++,b[T]=w,v[T]=E,v[T+1]=ea}for(let w=0,T=0;w<u;w++){for(;v[T+1]<w;)T++;const E=b[T],A=w-E;a[o+w*l]=f[E]+A*A}}const ay={none:0,ideographs:1,all:2};class up{constructor(o,l,u){this.requestManager=o,this.localGlyphMode=l,this.localFontFamily=u,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(o){this.url=o}getGlyphs(o,l){const u=[];for(const f in o)for(const b of o[f])u.push({stack:f,id:b});cn(u,({stack:f,id:b},v)=>{let w=this.entries[f];w||(w=this.entries[f]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let T=w.glyphs[b];if(void 0!==T)return void v(null,{stack:f,id:b,glyph:T});if(T=this._tinySDF(w,f,b),T)return w.glyphs[b]=T,void v(null,{stack:f,id:b,glyph:T});const E=Math.floor(b/256);if(256*E>65535)return void v(new Error("glyphs > 65535 not supported"));if(w.ranges[E])return void v(null,{stack:f,id:b,glyph:T});let A=w.requests[E];A||(A=w.requests[E]=[],up.loadGlyphRange(f,E,this.url,this.requestManager,(P,L)=>{if(L){w.ascender=L.ascender,w.descender=L.descender;for(const N in L.glyphs)this._doesCharSupportLocalGlyph(+N)||(w.glyphs[+N]=L.glyphs[+N]);w.ranges[E]=!0}for(const N of A)N(P,L);delete w.requests[E]})),A.push((P,L)=>{P?v(P):L&&v(null,{stack:f,id:b,glyph:L.glyphs[b]||null})})},(f,b)=>{if(f)l(f);else if(b){const v={};for(const{stack:w,id:T,glyph:E}of b)void 0===v[w]&&(v[w]={}),void 0===v[w].glyphs&&(v[w].glyphs={}),v[w].glyphs[T]=E&&{id:E.id,bitmap:E.bitmap.clone(),metrics:E.metrics},v[w].ascender=this.entries[w].ascender,v[w].descender=this.entries[w].descender;l(null,v)}})}_doesCharSupportLocalGlyph(o){return this.localGlyphMode!==ay.none&&(this.localGlyphMode===ay.all?!!this.localFontFamily:!!this.localFontFamily&&(on_CJK_Unified_Ideographs(o)||on_Hangul_Syllables(o)||on_Hiragana(o)||on_Katakana(o)||on_CJK_Symbols_and_Punctuation(o)))}_tinySDF(o,l,u){const f=this.localFontFamily;if(!f||!this._doesCharSupportLocalGlyph(u))return;let b=o.tinySDF;if(!b){let $="400";/bold/i.test(l)?$="900":/medium/i.test(l)?$="500":/light/i.test(l)&&($="200"),b=o.tinySDF=new up.TinySDF({fontFamily:f,fontWeight:$,fontSize:48,buffer:6,radius:16}),b.fontWeight=$}if(this.localGlyphs[b.fontWeight][u])return this.localGlyphs[b.fontWeight][u];const v=String.fromCharCode(u),{data:w,width:T,height:E,glyphWidth:A,glyphHeight:P,glyphLeft:L,glyphTop:N,glyphAdvance:B}=b.draw(v);return this.localGlyphs[b.fontWeight][u]={id:u,bitmap:new Wc({width:T,height:E},w),metrics:{width:A/2,height:P/2,left:L/2,top:N/2-27,advance:B/2,localGlyph:!0}}}}up.loadGlyphRange=function(a,o,l,u,f){const b=256*o,v=b+255,w=u.transformRequest(u.normalizeGlyphsURL(l).replace("{fontstack}",a).replace("{range}",`${b}-${v}`),_a.Glyphs);du(w,(T,E)=>{if(T)f(T);else if(E){const A={},P=new Vg(E).readFields(jf,{});for(const L of P.glyphs)A[L.id]=L;f(null,{glyphs:A,ascender:P.ascender,descender:P.descender})}})},up.TinySDF=class{constructor({fontSize:a=24,buffer:o=3,radius:l=8,cutoff:u=.25,fontFamily:f="sans-serif",fontWeight:b="normal",fontStyle:v="normal"}={}){this.buffer=o,this.cutoff=u,this.radius=l;const w=this.size=a+4*o,T=this._createCanvas(w),E=this.ctx=T.getContext("2d",{willReadFrequently:!0});E.font=`${v} ${b} ${a}px ${f}`,E.textBaseline="alphabetic",E.textAlign="left",E.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(a){const o=document.createElement("canvas");return o.width=o.height=a,o}draw(a){const{width:o,actualBoundingBoxAscent:l,actualBoundingBoxDescent:u,actualBoundingBoxLeft:f,actualBoundingBoxRight:b}=this.ctx.measureText(a),v=Math.ceil(l),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(b-f))),T=Math.min(this.size-this.buffer,v+Math.ceil(u)),E=w+2*this.buffer,A=T+2*this.buffer,P=Math.max(E*A,0),L=new Uint8ClampedArray(P),N={data:L,width:E,height:A,glyphWidth:w,glyphHeight:T,glyphTop:v,glyphLeft:0,glyphAdvance:o};if(0===w||0===T)return N;const{ctx:B,buffer:$,gridInner:K,gridOuter:ce}=this;B.clearRect($,$,w,T),B.fillText(a,$,$+v);const Ce=B.getImageData($,$,w,T);ce.fill(ea,0,P),K.fill(0,0,P);for(let ue=0;ue<T;ue++)for(let ve=0;ve<w;ve++){const Ae=Ce.data[4*(ue*w+ve)+3]/255;if(0===Ae)continue;const ke=(ue+$)*E+ve+$;if(1===Ae)ce[ke]=0,K[ke]=ea;else{const at=.5-Ae;ce[ke]=at>0?at*at:0,K[ke]=at<0?at*at:0}}$0(ce,0,0,E,A,E,this.f,this.v,this.z),$0(K,$,$,w,T,E,this.f,this.v,this.z);for(let ue=0;ue<P;ue++){const ve=Math.sqrt(ce[ue])-Math.sqrt(K[ue]);L[ue]=Math.round(255-255*(ve/this.radius+this.cutoff))}return N}};function ly(a,o,l,u){const f=[],b=a.image,v=b.pixelRatio,w=b.paddedRect.w-2,T=b.paddedRect.h-2,E=a.right-a.left,A=a.bottom-a.top,P=b.stretchX||[[0,w]],L=b.stretchY||[[0,T]],N=(ht,Dt)=>ht+Dt[1]-Dt[0],B=P.reduce(N,0),$=L.reduce(N,0),K=w-B,ce=T-$;let Ce=0,ue=B,ve=0,Ae=$,ke=0,at=K,rt=0,_t=ce;if(b.content&&u){const ht=b.content;Ce=$g(P,0,ht[0]),ve=$g(L,0,ht[1]),ue=$g(P,ht[0],ht[2]),Ae=$g(L,ht[1],ht[3]),ke=ht[0]-Ce,rt=ht[1]-ve,at=ht[2]-ht[0]-ue,_t=ht[3]-ht[1]-Ae}const zt=(ht,Dt,Ct,Rt)=>{const Gt=Gg(ht.stretch-Ce,ue,E,a.left),ft=bi(ht.fixed-ke,at,ht.stretch,B),sn=Gg(Dt.stretch-ve,Ae,A,a.top),mn=bi(Dt.fixed-rt,_t,Dt.stretch,$),dn=Gg(Ct.stretch-Ce,ue,E,a.left),Wn=bi(Ct.fixed-ke,at,Ct.stretch,B),Xt=Gg(Rt.stretch-ve,Ae,A,a.top),kn=bi(Rt.fixed-rt,_t,Rt.stretch,$),Jn=new Ie(Gt,sn),ji=new Ie(dn,sn),ei=new Ie(dn,Xt),Fn=new Ie(Gt,Xt),Gi=new Ie(ft/v,mn/v),Xn=new Ie(Wn/v,kn/v),Zn=o*Math.PI/180;if(Zn){const fr=Math.sin(Zn),mr=Math.cos(Zn),$r=[mr,-fr,fr,mr];Jn._matMult($r),ji._matMult($r),Fn._matMult($r),ei._matMult($r)}const ir=ht.stretch+ht.fixed,Ar=Dt.stretch+Dt.fixed;return{tl:Jn,tr:ji,bl:Fn,br:ei,tex:{x:b.paddedRect.x+1+ir,y:b.paddedRect.y+1+Ar,w:Ct.stretch+Ct.fixed-ir,h:Rt.stretch+Rt.fixed-Ar},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Gi,pixelOffsetBR:Xn,minFontScaleX:at/v/E,minFontScaleY:_t/v/A,isSDF:l}};if(u&&(b.stretchX||b.stretchY)){const ht=G0(P,K,B),Dt=G0(L,ce,$);for(let Ct=0;Ct<ht.length-1;Ct++){const Rt=ht[Ct],Gt=ht[Ct+1];for(let ft=0;ft<Dt.length-1;ft++)f.push(zt(Rt,Dt[ft],Gt,Dt[ft+1]))}}else f.push(zt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:T+1}));return f}function $g(a,o,l){let u=0;for(const f of a)u+=Math.max(o,Math.min(l,f[1]))-Math.max(o,Math.min(l,f[0]));return u}function G0(a,o,l){const u=[{fixed:-1,stretch:0}];for(const[f,b]of a){const v=u[u.length-1];u.push({fixed:f-v.stretch,stretch:v.stretch}),u.push({fixed:f-v.stretch,stretch:v.stretch+(b-f)})}return u.push({fixed:o+1,stretch:l}),u}function Gg(a,o,l,u){return a/o*l+u}function bi(a,o,l,u){return a-o*l/u}function Le(a,o,l,u){const f=o+a.positionedLines[u].lineOffset;return 0===u?l+f/2:l+(f+(o+a.positionedLines[u-1].lineOffset))/2}class q0{constructor(o=[],l=W0){if(this.data=o,this.length=this.data.length,this.compare=l,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(o){this.data.push(o),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const o=this.data[0],l=this.data.pop();return this.length--,this.length>0&&(this.data[0]=l,this._down(0)),o}peek(){return this.data[0]}_up(o){const{data:l,compare:u}=this,f=l[o];for(;o>0;){const b=o-1>>1,v=l[b];if(u(f,v)>=0)break;l[o]=v,o=b}l[o]=f}_down(o){const{data:l,compare:u}=this,f=this.length>>1,b=l[o];for(;o<f;){let v=1+(o<<1),w=l[v];const T=v+1;if(T<this.length&&u(l[T],w)<0&&(v=T,w=l[T]),u(w,b)>=0)break;l[o]=w,o=v}l[o]=b}}function W0(a,o){return a<o?-1:a>o?1:0}function H1(a,o=1,l=!1){let u=1/0,f=1/0,b=-1/0,v=-1/0;const w=a[0];for(let N=0;N<w.length;N++){const B=w[N];(!N||B.x<u)&&(u=B.x),(!N||B.y<f)&&(f=B.y),(!N||B.x>b)&&(b=B.x),(!N||B.y>v)&&(v=B.y)}const T=Math.min(b-u,v-f);let E=T/2;const A=new q0([],$1);if(0===T)return new Ie(u,f);for(let N=u;N<b;N+=T)for(let B=f;B<v;B+=T)A.push(new Wd(N+E,B+E,E,a));let P=function(N){let B=0,$=0,K=0;const ce=N[0];for(let Ce=0,ue=ce.length,ve=ue-1;Ce<ue;ve=Ce++){const Ae=ce[Ce],ke=ce[ve],at=Ae.x*ke.y-ke.x*Ae.y;$+=(Ae.x+ke.x)*at,K+=(Ae.y+ke.y)*at,B+=3*at}return new Wd($/B,K/B,0,N)}(a),L=A.length;for(;A.length;){const N=A.pop();(N.d>P.d||!P.d)&&(P=N,l&&console.log("found best %d after %d probes",Math.round(1e4*N.d)/1e4,L)),N.max-P.d<=o||(E=N.h/2,A.push(new Wd(N.p.x-E,N.p.y-E,E,a)),A.push(new Wd(N.p.x+E,N.p.y-E,E,a)),A.push(new Wd(N.p.x-E,N.p.y+E,E,a)),A.push(new Wd(N.p.x+E,N.p.y+E,E,a)),L+=4)}return l&&(console.log(`num probes: ${L}`),console.log(`best distance: ${P.d}`)),P.p}function $1(a,o){return o.max-a.max}class Wd{constructor(o,l,u,f){this.p=new Ie(o,l),this.h=u,this.d=function(b,v){let w=!1,T=1/0;for(let E=0;E<v.length;E++){const A=v[E];for(let P=0,L=A.length,N=L-1;P<L;N=P++){const B=A[P],$=A[N];B.y>b.y!=$.y>b.y&&b.x<($.x-B.x)*(b.y-B.y)/($.y-B.y)+B.x&&(w=!w),T=Math.min(T,_g(b,B,$))}}return(w?1:-1)*Math.sqrt(T)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}}const qg=Number.POSITIVE_INFINITY,G1=Math.sqrt(2);function X0(a,[o,l]){let u=0,f=0;if(l===qg){o<0&&(o=0);const b=o/G1;switch(a){case"top-right":case"top-left":f=b-7;break;case"bottom-right":case"bottom-left":f=7-b;break;case"bottom":f=7-o;break;case"top":f=o-7}switch(a){case"top-right":case"bottom-right":u=-b;break;case"top-left":case"bottom-left":u=b;break;case"left":u=o;break;case"right":u=-o}}else{switch(o=Math.abs(o),l=Math.abs(l),a){case"top-right":case"top-left":case"top":f=l-7;break;case"bottom-right":case"bottom-left":case"bottom":f=7-l}switch(a){case"top-right":case"bottom-right":case"right":u=-o;break;case"top-left":case"bottom-left":case"left":u=o}}return[u,f]}function PI(a,o,l,u,f,b,v,w,T,E){a.createArrays(),a.tilePixelRatio=Pn/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;const A=a.layers[0].layout,P=a.layers[0]._unevaluatedLayout._values,L={};if("composite"===a.textSizeData.kind){const{minZoom:$,maxZoom:K}=a.textSizeData;L.compositeTextSizes=[P["text-size"].possiblyEvaluate(new R($),w),P["text-size"].possiblyEvaluate(new R(K),w)]}if("composite"===a.iconSizeData.kind){const{minZoom:$,maxZoom:K}=a.iconSizeData;L.compositeIconSizes=[P["icon-size"].possiblyEvaluate(new R($),w),P["icon-size"].possiblyEvaluate(new R(K),w)]}L.layoutTextSize=P["text-size"].possiblyEvaluate(new R(T+1),w),L.layoutIconSize=P["icon-size"].possiblyEvaluate(new R(T+1),w),L.textMaxSize=P["text-size"].possiblyEvaluate(new R(18),w);const N="map"===A.get("text-rotation-alignment")&&"point"!==A.get("symbol-placement"),B=A.get("text-size");for(const $ of a.features){const K=A.get("text-font").evaluate($,{},w).join(","),ce=B.evaluate($,{},w),Ce=L.layoutTextSize.evaluate($,{},w),ue=(L.layoutIconSize.evaluate($,{},w),{horizontal:{},vertical:void 0}),ve=$.text;let Ae,ke=[0,0];if(ve){const _t=ve.toString(),zt=24*A.get("text-letter-spacing").evaluate($,{},w),ht=24*A.get("text-line-height").evaluate($,{},w),Dt=p_(_t)?zt:0,Ct=A.get("text-anchor").evaluate($,{},w),Rt=A.get("text-variable-anchor");if(!Rt){const dn=A.get("text-radial-offset").evaluate($,{},w);ke=dn?X0(Ct,[24*dn,qg]):A.get("text-offset").evaluate($,{},w).map(Wn=>24*Wn)}let Gt=N?"center":A.get("text-justify").evaluate($,{},w);const ft="point"===A.get("symbol-placement"),sn=ft?24*A.get("text-max-width").evaluate($,{},w):1/0,mn=dn=>{a.allowVerticalPlacement&&Ma(_t)&&(ue.vertical=ny(ve,o,l,f,K,sn,ht,Ct,dn,Dt,ke,Na.vertical,!0,Ce,ce))};if(!N&&Rt){const dn="auto"===Gt?Rt.map(Xt=>Wg(Xt)):[Gt];let Wn=!1;for(let Xt=0;Xt<dn.length;Xt++){const kn=dn[Xt];if(!ue.horizontal[kn])if(Wn)ue.horizontal[kn]=ue.horizontal[0];else{const Jn=ny(ve,o,l,f,K,sn,ht,"center",kn,Dt,ke,Na.horizontal,!1,Ce,ce);Jn&&(ue.horizontal[kn]=Jn,Wn=1===Jn.positionedLines.length)}}mn("left")}else{if("auto"===Gt&&(Gt=Wg(Ct)),ft||A.get("text-writing-mode").indexOf("horizontal")>=0||!Ma(_t)){const dn=ny(ve,o,l,f,K,sn,ht,Ct,Gt,Dt,ke,Na.horizontal,!1,Ce,ce);dn&&(ue.horizontal[Gt]=dn)}mn(ft?"left":Gt)}}let at=!1;if($.icon&&$.icon.name){const _t=u[$.icon.name];_t&&(Ae=RI(f[$.icon.name],A.get("icon-offset").evaluate($,{},w),A.get("icon-anchor").evaluate($,{},w)),at=_t.sdf,void 0===a.sdfIcons?a.sdfIcons=_t.sdf:a.sdfIcons!==_t.sdf&&Qn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(_t.pixelRatio!==a.pixelRatio||0!==A.get("icon-rotate").constantOr(1))&&(a.iconsNeedLinear=!0))}const rt=Zg(ue.horizontal)||ue.vertical;a.iconsInText||(a.iconsInText=!!rt&&rt.iconsInText),(rt||Ae)&&Z0(a,$,ue,Ae,u,L,Ce,0,ke,at,v,w,E)}b&&a.generateCollisionDebugBuffers(T,a.collisionBoxArray)}function Wg(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Z0(a,o,l,u,f,b,v,w,T,E,A,P,L){let N=b.textMaxSize.evaluate(o,{},P);void 0===N&&(N=v);const B=a.layers[0].layout,$=B.get("icon-offset").evaluate(o,{},P),K=Zg(l.horizontal)||l.vertical,ce="globe"===L.name,ue=v/24,ve=a.tilePixelRatio*N/24,Ae=(Ct=a.overscaling,a.zoom>18&&Ct>2&&(Ct>>=1),Math.max(Pn/(512*Ct),1)*B.get("symbol-spacing")),ke=B.get("text-padding")*a.tilePixelRatio,at=B.get("icon-padding")*a.tilePixelRatio,rt=re(B.get("text-max-angle")),_t="map"===B.get("text-rotation-alignment")&&"point"!==B.get("symbol-placement"),zt="map"===B.get("icon-rotation-alignment")&&"point"!==B.get("symbol-placement"),ht=B.get("symbol-placement"),Dt=Ae/2;var Ct;const Rt=B.get("icon-text-fit");let Gt;u&&"none"!==Rt&&(a.allowVerticalPlacement&&l.vertical&&(Gt=z1(u,l.vertical,Rt,B.get("icon-text-fit-padding"),$,ue)),K&&(u=z1(u,K,Rt,B.get("icon-text-fit-padding"),$,ue)));const ft=(sn,mn,dn)=>{if(mn.x<0||mn.x>=Pn||mn.y<0||mn.y>=Pn)return;let Wn=null;if(ce){const{x:Xt,y:kn,z:Jn}=L.projectTilePoint(mn.x,mn.y,dn);Wn={anchor:new fc(Xt,kn,Jn,0,void 0),up:L.upVector(dn,mn.x,mn.y)}}!function(Xt,kn,Jn,ji,ei,Fn,Gi,Xn,Zn,ir,Ar,fr,mr,$r,Yr,Gr,xr,Do,po,Kr,Ki,fo,kr,ws,qt){const qo=Xt.addToLineVertexArray(kn,ji);let vo,Vs,Lo,Fl,_p,Kf,Qf,Jf=0,Wu=0,lC=0,yp=0,Ty=-1,Ey=-1;const hl={};let cx=Uo("");const js=Jn?Jn.anchor:kn;let th=0,rs=0;if(void 0===Zn._unevaluatedLayout.getValue("text-radial-offset")?[th,rs]=Zn.layout.get("text-offset").evaluate(Ki,{},qt).map(fn=>24*fn):(th=24*Zn.layout.get("text-radial-offset").evaluate(Ki,{},qt),rs=qg),Xt.allowVerticalPlacement&&ei.vertical){const fn=ei.vertical;if(Yr)Kf=Y0(fn),Xn&&(Qf=Y0(Xn));else{const Wo=Zn.layout.get("text-rotate").evaluate(Ki,{},qt)+90;Lo=Yg(ir,js,kn,Ar,fr,mr,fn,$r,Wo,Gr),Xn&&(Fl=Yg(ir,js,kn,Ar,fr,mr,Xn,Do,Wo))}}if(Fn){const fn=Zn.layout.get("icon-rotate").evaluate(Ki,{},qt),Wo="none"!==Zn.layout.get("icon-text-fit"),yc=ly(Fn,fn,kr,Wo),Xu=Xn?ly(Xn,fn,kr,Wo):void 0;Vs=Yg(ir,js,kn,Ar,fr,mr,Fn,Do,fn),Jf=4*yc.length;const nh=Xt.iconSizeData;let fl=null;"source"===nh.kind?(fl=[cl*Zn.layout.get("icon-size").evaluate(Ki,{},qt)],fl[0]>ju&&Qn(`${Xt.layerIds[0]}: Value for "icon-size" is >= ${Nr}. Reduce your "icon-size".`)):"composite"===nh.kind&&(fl=[cl*fo.compositeIconSizes[0].evaluate(Ki,{},qt),cl*fo.compositeIconSizes[1].evaluate(Ki,{},qt)],(fl[0]>ju||fl[1]>ju)&&Qn(`${Xt.layerIds[0]}: Value for "icon-size" is >= ${Nr}. Reduce your "icon-size".`)),Xt.addSymbols(Xt.icon,yc,fl,Kr,po,Ki,!1,Jn,kn,qo.lineStartIndex,qo.lineLength,-1,ws,qt),Ty=Xt.icon.placedSymbolArray.length-1,Xu&&(Wu=4*Xu.length,Xt.addSymbols(Xt.icon,Xu,fl,Kr,po,Ki,Na.vertical,Jn,kn,qo.lineStartIndex,qo.lineLength,-1,ws,qt),Ey=Xt.icon.placedSymbolArray.length-1)}for(const fn in ei.horizontal){const Wo=ei.horizontal[fn];vo||(cx=Uo(Wo.text),Yr?_p=Y0(Wo):vo=Yg(ir,js,kn,Ar,fr,mr,Wo,$r,Zn.layout.get("text-rotate").evaluate(Ki,{},qt),Gr));const yc=1===Wo.positionedLines.length;if(lC+=Xg(Xt,Jn,kn,Wo,Gi,Zn,Yr,Ki,Gr,qo,ei.vertical?Na.horizontal:Na.horizontalOnly,yc?Object.keys(ei.horizontal):[fn],hl,Ty,fo,ws,qt),yc)break}ei.vertical&&(yp+=Xg(Xt,Jn,kn,ei.vertical,Gi,Zn,Yr,Ki,Gr,qo,Na.vertical,["vertical"],hl,Ey,fo,ws,qt));let pa=-1;const vp=(fn,Wo)=>fn?Math.max(fn,Wo):Wo;pa=vp(_p,pa),pa=vp(Kf,pa),pa=vp(Qf,pa);const pl=pa>-1?1:0;Xt.glyphOffsetArray.length>=Hu.MAX_GLYPHS&&Qn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==Ki.sortKey&&Xt.addToSortKeyRanges(Xt.symbolInstances.length,Ki.sortKey),Xt.symbolInstances.emplaceBack(js.x,js.y,js.z,kn.x,kn.y,hl.right>=0?hl.right:-1,hl.center>=0?hl.center:-1,hl.left>=0?hl.left:-1,hl.vertical>=0?hl.vertical:-1,Ty,Ey,cx,void 0!==vo?vo:Xt.collisionBoxArray.length,void 0!==vo?vo+1:Xt.collisionBoxArray.length,void 0!==Lo?Lo:Xt.collisionBoxArray.length,void 0!==Lo?Lo+1:Xt.collisionBoxArray.length,void 0!==Vs?Vs:Xt.collisionBoxArray.length,void 0!==Vs?Vs+1:Xt.collisionBoxArray.length,Fl||Xt.collisionBoxArray.length,Fl?Fl+1:Xt.collisionBoxArray.length,Ar,lC,yp,Jf,Wu,pl,0,th,rs,pa)}(a,mn,Wn,sn,l,u,f,Gt,a.layers[0],a.collisionBoxArray,o.index,o.sourceLayerIndex,a.index,ke,_t,T,0,at,zt,$,o,b,E,A,P)};if("line"===ht)for(const sn of H0(o.geometry,0,0,Pn,Pn)){const mn=j0(sn,Ae,rt,l.vertical||K,u,24,ve,a.overscaling,Pn);for(const dn of mn)K&&LI(a,K.text,Dt,dn)||ft(sn,dn,P)}else if("line-center"===ht){for(const sn of o.geometry)if(sn.length>1){const mn=U1(sn,rt,l.vertical||K,u,24,ve);mn&&ft(sn,mn,P)}}else if("Polygon"===o.type)for(const sn of Of(o.geometry,0)){const mn=H1(sn,16);ft(sn[0],new fc(mn.x,mn.y,0,0,void 0),P)}else if("LineString"===o.type)for(const sn of o.geometry)ft(sn,new fc(sn[0].x,sn[0].y,0,0,void 0),P);else if("Point"===o.type)for(const sn of o.geometry)for(const mn of sn)ft([mn],new fc(mn.x,mn.y,0,0,void 0),P)}const Nr=255,ju=Nr*cl;function Xg(a,o,l,u,f,b,v,w,T,E,A,P,L,N,B,$,K){const ce=function(ve,Ae,ke,at,rt,_t,zt,ht){const Dt=[];if(0===Ae.positionedLines.length)return Dt;const Ct=at.layout.get("text-rotate").evaluate(_t,{})*Math.PI/180,Rt=function(dn){const Wn=dn[0],Xt=dn[1],kn=Wn*Xt;return kn>0?[Wn,-Xt]:kn<0?[-Wn,Xt]:0===Wn?[Xt,Wn]:[Xt,-Wn]}(ke);let Gt=Math.abs(Ae.top-Ae.bottom);for(const dn of Ae.positionedLines)Gt-=dn.lineOffset;const ft=Ae.positionedLines.length,sn=Gt/ft;let mn=Ae.top-ke[1];for(let dn=0;dn<ft;++dn){const Wn=Ae.positionedLines[dn];mn=Le(Ae,sn,mn,dn);for(const Xt of Wn.positionedGlyphs){if(!Xt.rect)continue;const kn=Xt.rect||{};let Jn=4,ji=!0,ei=1,Fn=0;if(Xt.imageName){const kr=zt[Xt.imageName];if(!kr)continue;if(kr.sdf){Qn("SDF images are not supported in formatted text and will be ignored.");continue}ji=!1,ei=kr.pixelRatio,Jn=1/ei}const Gi=(rt||ht)&&Xt.vertical,Xn=Xt.metrics.advance*Xt.scale/2,Zn=Xt.metrics,ir=Xt.rect;if(null===ir)continue;ht&&Ae.verticalizable&&(Fn=Xt.imageName?Xn-Xt.metrics.width*Xt.scale/2:0);const Ar=rt?[Xt.x+Xn,Xt.y]:[0,0];let fr=[0,0],mr=[0,0],$r=!1;rt||(Gi?(mr=[Xt.x+Xn+Rt[0],Xt.y+Rt[1]-Fn],$r=!0):fr=[Xt.x+Xn+ke[0],Xt.y+ke[1]-Fn]);const Yr=ir.w*Xt.scale/(ei*(Xt.localGlyph?2:1)),Gr=ir.h*Xt.scale/(ei*(Xt.localGlyph?2:1));let xr,Do,po,Kr;if(Gi){const kr=Xt.y-mn,ws=new Ie(-Xn,Xn-kr),qt=-Math.PI/2,qo=new Ie(...mr);xr=new Ie(-Xn+fr[0],fr[1]),xr._rotateAround(qt,ws)._add(qo),xr.x+=-kr+Xn,xr.y-=(Zn.left-Jn)*Xt.scale;const vo=Xt.imageName?Zn.advance*Xt.scale:24*Xt.scale,Vs=String.fromCharCode(Xt.glyph);K_(Vs)?xr.x+=(1-Jn)*Xt.scale:Ng(Vs)?xr.x+=vo-Zn.height*Xt.scale+(-Jn-1)*Xt.scale:xr.x+=Xt.imageName||Zn.width+2*Jn===ir.w&&Zn.height+2*Jn===ir.h?(vo-Gr)/2:(vo-(Zn.height+2*Jn)*Xt.scale)/2,Do=new Ie(xr.x,xr.y-Yr),po=new Ie(xr.x+Gr,xr.y),Kr=new Ie(xr.x+Gr,xr.y-Yr)}else{const kr=(Zn.left-Jn)*Xt.scale-Xn+fr[0],ws=(-Zn.top-Jn)*Xt.scale+fr[1],qt=kr+Yr,qo=ws+Gr;xr=new Ie(kr,ws),Do=new Ie(qt,ws),po=new Ie(kr,qo),Kr=new Ie(qt,qo)}if(Ct){let kr;kr=rt?new Ie(0,0):$r?new Ie(Rt[0],Rt[1]):new Ie(ke[0],ke[1]),xr._rotateAround(Ct,kr),Do._rotateAround(Ct,kr),po._rotateAround(Ct,kr),Kr._rotateAround(Ct,kr)}const Ki=new Ie(0,0),fo=new Ie(0,0);Dt.push({tl:xr,tr:Do,bl:po,br:Kr,tex:kn,writingMode:Ae.writingMode,glyphOffset:Ar,sectionIndex:Xt.sectionIndex,isSDF:ji,pixelOffsetTL:Ki,pixelOffsetBR:fo,minFontScaleX:0,minFontScaleY:0})}}return Dt}(0,u,T,b,v,w,f,a.allowVerticalPlacement),Ce=a.textSizeData;let ue=null;"source"===Ce.kind?(ue=[cl*b.layout.get("text-size").evaluate(w,{},K)],ue[0]>ju&&Qn(`${a.layerIds[0]}: Value for "text-size" is >= ${Nr}. Reduce your "text-size".`)):"composite"===Ce.kind&&(ue=[cl*B.compositeTextSizes[0].evaluate(w,{},K),cl*B.compositeTextSizes[1].evaluate(w,{},K)],(ue[0]>ju||ue[1]>ju)&&Qn(`${a.layerIds[0]}: Value for "text-size" is >= ${Nr}. Reduce your "text-size".`)),a.addSymbols(a.text,ce,ue,T,v,w,A,o,l,E.lineStartIndex,E.lineLength,N,$,K);for(const ve of P)L[ve]=a.text.placedSymbolArray.length-1;return 4*ce.length}function Zg(a){for(const o in a)return a[o];return null}function Yg(a,o,l,u,f,b,v,w,T,E){let A=v.top,P=v.bottom,L=v.left,N=v.right;const B=v.collisionPadding;if(B&&(L-=B[0],A-=B[1],N+=B[2],P+=B[3]),T){const $=new Ie(L,A),K=new Ie(N,A),ce=new Ie(L,P),Ce=new Ie(N,P),ue=re(T);let ve=new Ie(0,0);E&&(ve=new Ie(E[0],E[1])),$._rotateAround(ue,ve),K._rotateAround(ue,ve),ce._rotateAround(ue,ve),Ce._rotateAround(ue,ve),L=Math.min($.x,K.x,ce.x,Ce.x),N=Math.max($.x,K.x,ce.x,Ce.x),A=Math.min($.y,K.y,ce.y,Ce.y),P=Math.max($.y,K.y,ce.y,Ce.y)}return a.emplaceBack(o.x,o.y,o.z,l.x,l.y,L,A,N,P,w,u,f,b),a.length-1}function Y0(a){a.collisionPadding&&(a.top-=a.collisionPadding[1],a.bottom+=a.collisionPadding[3]);const o=a.bottom-a.top;return o>0?Math.max(10,o):null}function LI(a,o,l,u){const f=a.compareText;if(o in f){const b=f[o];for(let v=b.length-1;v>=0;v--)if(u.dist(b[v])<l)return!0}else f[o]=[];return f[o].push(u),!1}function q1(a,o){const l=a.fovAboveCenter,u=a.elevation?a.elevation.getMinElevationBelowMSL()*o:0,f=(a._camera.position[2]*a.worldSize-u)/Math.cos(a._pitch),b=Math.sin(l)*f/Math.sin(Math.max(Math.PI/2-a._pitch-l,.01)),v=Math.sin(a._pitch)*b+f;return Math.min(1.01*v,f*(1/a._horizonShift))}function Xd(a,o){if(!o.isReprojectedInTileSpace)return{scale:1<<a.z,x:a.x,y:a.y,x2:a.x+1,y2:a.y+1,projection:o};const l=Math.pow(2,-a.z),u=a.x*l,f=(a.x+1)*l,b=a.y*l,v=(a.y+1)*l,w=La(u),T=La(f),E=vr(b),A=vr(v),P=o.project(w,E),L=o.project(T,E),N=o.project(T,A),B=o.project(w,A);let $=Math.min(P.x,L.x,N.x,B.x),K=Math.min(P.y,L.y,N.y,B.y),ce=Math.max(P.x,L.x,N.x,B.x),Ce=Math.max(P.y,L.y,N.y,B.y);const ue=l/16;function ve(ke,at,rt,_t,zt,ht){const Dt=(rt+zt)/2,Ct=(_t+ht)/2,Rt=o.project(La(Dt),vr(Ct)),Gt=Math.max(0,$-Rt.x,K-Rt.y,Rt.x-ce,Rt.y-Ce);$=Math.min($,Rt.x),ce=Math.max(ce,Rt.x),K=Math.min(K,Rt.y),Ce=Math.max(Ce,Rt.y),Gt>ue&&(ve(ke,Rt,rt,_t,Dt,Ct),ve(Rt,at,Dt,Ct,zt,ht))}ve(P,L,u,b,f,b),ve(L,N,f,b,f,v),ve(N,B,f,v,u,v),ve(B,P,u,v,u,b),$-=ue,K-=ue,ce+=ue,Ce+=ue;const Ae=1/Math.max(ce-$,Ce-K);return{scale:Ae,x:$*Ae,y:K*Ae,x2:ce*Ae,y2:Ce*Ae,projection:o}}const K0=ho(new Float32Array(16));class Zd{constructor(o){this.spec=o,this.name=o.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(o,l){return{x:0,y:0,z:0}}unproject(o,l){return new yr(0,0)}projectTilePoint(o,l,u){return{x:o,y:l,z:0}}locationPoint(o,l,u=!0){return o._coordinatePoint(o.locationCoordinate(l),u)}pixelsPerMeter(o,l){return kl(1,o)*l}pixelSpaceConversion(o,l,u){return 1}farthestPixelDistance(o){return q1(o,o.pixelsPerMeter)}pointCoordinate(o,l,u,f){const b=o.horizonLineFromTop(!1),v=new Ie(l,Math.max(b,u));return o.rayIntersectionCoordinate(o.pointRayIntersection(v,f))}pointCoordinate3D(o,l,u){const f=new Ie(l,u);if(o.elevation)return o.elevation.pointCoordinate(f);{const b=this.pointCoordinate(o,f.x,f.y,0);return[b.x,b.y,b.z]}}isPointAboveHorizon(o,l){if(o.elevation)return!this.pointCoordinate3D(o,l.x,l.y);const u=o.horizonLineFromTop();return l.y<u}createInversionMatrix(o,l){return K0}createTileMatrix(o,l,u){let f,b,v;const w=u.canonical,T=ho(new Float64Array(16));if(this.isReprojectedInTileSpace){const E=Xd(w,this);f=1,b=E.x+u.wrap*E.scale,v=E.y,ku(T,T,[f/E.scale,f/E.scale,o.pixelsPerMeter/l])}else f=l/o.zoomScale(w.z),b=(w.x+Math.pow(2,w.z)*u.wrap)*f,v=w.y*f;return ng(T,T,[b,v,0]),ku(T,T,[f/Pn,f/Pn,1]),T}upVector(o,l,u){return[0,0,1]}upVectorScale(o,l,u){return{metersToTile:1}}}class W1 extends Zd{constructor(o){super(o),this.range=[4,7],this.center=o.center||[-96,37.5];const[l,u]=this.parallels=o.parallels||[29.5,45.5],f=Math.sin(re(l));this.n=(f+Math.sin(re(u)))/2,this.c=1+f*(2*this.n-f),this.r0=Math.sqrt(this.c)/this.n}project(o,l){const{n:u,c:f,r0:b}=this,v=re(o-this.center[0]),w=re(l),T=Math.sqrt(f-2*u*Math.sin(w))/u;return{x:T*Math.sin(v*u),y:T*Math.cos(v*u)-b,z:0}}unproject(o,l){const{n:u,c:f,r0:b}=this,v=b+l;let w=Math.atan2(o,Math.abs(v))*Math.sign(v);v*u<0&&(w-=Math.PI*Math.sign(o)*Math.sign(v));const T=re(this.center[0])*u;w=kt(w,-Math.PI-T,Math.PI-T);const E=Tt(me(w/u)+this.center[0],-180,180),A=Math.asin(Tt((f-(o*o+v*v)*u*u)/(2*u),-1,1)),P=Tt(me(A),-Go,Go);return new yr(E,P)}}const mc=1.340264,Hf=-.081106,pp=893e-6,Uu=.003796,Kg=Math.sqrt(3)/2;class Q0 extends Zd{project(o,l){l=l/180*Math.PI,o=o/180*Math.PI;const u=Math.asin(Kg*Math.sin(l)),f=u*u,b=f*f*f;return{x:.5*(o*Math.cos(u)/(Kg*(mc+3*Hf*f+b*(7*pp+9*Uu*f)))/Math.PI+.5),y:1-.5*(u*(mc+Hf*f+b*(pp+Uu*f))/Math.PI+1),z:0}}unproject(o,l){o=(2*o-.5)*Math.PI;let u=l=(2*(1-l)-1)*Math.PI,f=u*u,b=f*f*f;for(let A,P,L,N=0;N<12&&(P=u*(mc+Hf*f+b*(pp+Uu*f))-l,L=mc+3*Hf*f+b*(7*pp+9*Uu*f),A=P/L,u=Tt(u-A,-Math.PI/3,Math.PI/3),f=u*u,b=f*f*f,!(Math.abs(A)<1e-12));++N);const v=Kg*o*(mc+3*Hf*f+b*(7*pp+9*Uu*f))/Math.cos(u),w=Math.asin(Math.sin(u)/Kg),T=Tt(180*v/Math.PI,-180,180),E=Tt(180*w/Math.PI,-Go,Go);return new yr(T,E)}}class X1 extends Zd{constructor(o){super(o),this.wrap=!0,this.supportsWorldCopies=!0}project(o,l){return{x:.5+o/360,y:.5-l/360,z:0}}unproject(o,l){const u=360*(o-.5),f=Tt(360*(.5-l),-Go,Go);return new yr(u,f)}}const fp=Math.PI/2;function Qg(a){return Math.tan((fp+a)/2)}class Z1 extends Zd{constructor(o){super(o),this.center=o.center||[0,30];const[l,u]=this.parallels=o.parallels||[30,30];let f=re(l),b=re(u);this.southernCenter=f+b<0,this.southernCenter&&(f=-f,b=-b);const v=Math.cos(f),w=Qg(f);this.n=f===b?Math.sin(f):Math.log(v/Math.cos(b))/Math.log(Qg(b)/w),this.f=v*Math.pow(Qg(f),this.n)/this.n}project(o,l){l=re(l),this.southernCenter&&(l=-l),o=re(o-this.center[0]);const u=1e-6,{n:f,f:b}=this;b>0?l<-fp+u&&(l=-fp+u):l>fp-u&&(l=fp-u);const v=b/Math.pow(Qg(l),f);let w=v*Math.sin(f*o),T=b-v*Math.cos(f*o);return w=.5*(w/Math.PI+.5),T=.5*(T/Math.PI+.5),{x:w,y:this.southernCenter?T:1-T,z:0}}unproject(o,l){o=(2*o-.5)*Math.PI,this.southernCenter&&(l=1-l),l=(2*(1-l)-.5)*Math.PI;const{n:u,f}=this,b=f-l,v=Math.sign(b),w=Math.sign(u)*Math.sqrt(o*o+b*b);let T=Math.atan2(o,Math.abs(b))*v;b*u<0&&(T-=Math.PI*Math.sign(o)*v);const E=Tt(me(T/u)+this.center[0],-180,180),A=Tt(me(2*Math.atan(Math.pow(f/w,1/u))-fp),-Go,Go);return new yr(E,this.southernCenter?-A:A)}}class J0 extends Zd{constructor(o){super(o),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(o,l){return{x:lc(o),y:Al(l),z:0}}unproject(o,l){const u=La(o),f=vr(l);return new yr(u,f)}}const cy=re(Go);class Y1 extends Zd{project(o,l){const u=(l=re(l))*l,f=u*u;return{x:.5*((o=re(o))*(.8707-.131979*u+f*(f*(.003971*u-.001529*f)-.013791))/Math.PI+.5),y:1-.5*(l*(1.007226+u*(.015085+f*(.028874*u-.044475-.005916*f)))/Math.PI+1),z:0}}unproject(o,l){o=(2*o-.5)*Math.PI;let u=l=(2*(1-l)-1)*Math.PI,f=25,b=0,v=u*u;do{v=u*u;const E=v*v;b=(u*(1.007226+v*(.015085+E*(.028874*v-.044475-.005916*E)))-l)/(1.007226+v*(.045255+E*(.259866*v-.311325-.005916*11*E))),u=Tt(u-b,-cy,cy)}while(Math.abs(b)>1e-6&&--f>0);v=u*u;const w=Tt(me(o/(.8707+v*(v*(v*v*v*(.003971-.001529*v)-.013791)-.131979))),-180,180),T=me(u);return new yr(w,T)}}const uy=re(Go);class ex extends Zd{project(o,l){l=re(l),o=re(o);const u=Math.cos(l),f=2/Math.PI,b=Math.acos(u*Math.cos(o/2)),v=Math.sin(b)/b,w=.5*(o*f+2*u*Math.sin(o/2)/v)||0,T=.5*(l+Math.sin(l)/v)||0;return{x:.5*(w/Math.PI+.5),y:1-.5*(T/Math.PI+1),z:0}}unproject(o,l){let u=o=(2*o-.5)*Math.PI,f=l=(2*(1-l)-1)*Math.PI,b=25;const v=1e-6;let w=0,T=0;do{const E=Math.cos(f),A=Math.sin(f),P=2*A*E,L=A*A,N=E*E,B=Math.cos(u/2),$=Math.sin(u/2),K=2*B*$,ce=$*$,Ce=1-N*B*B,ue=Ce?1/Ce:0,ve=Ce?Math.acos(E*B)*Math.sqrt(1/Ce):0,Ae=.5*(2*ve*E*$+2*u/Math.PI)-o,ke=.5*(ve*A+f)-l,at=.5*ue*(N*ce+ve*E*B*L)+1/Math.PI,rt=ue*(K*P/4-ve*A*$),_t=.125*ue*(P*$-ve*A*N*K),zt=.5*ue*(L*B+ve*ce*E)+.5,ht=rt*_t-zt*at;w=(ke*rt-Ae*zt)/ht,T=(Ae*_t-ke*at)/ht,u=Tt(u-w,-Math.PI,Math.PI),f=Tt(f-T,-uy,uy)}while((Math.abs(w)>v||Math.abs(T)>v)&&--b>0);return new yr(me(u),me(f))}}class Jg extends Zd{constructor(o){super(o),this.center=o.center||[0,0],this.parallels=o.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(re(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(o,l){const{scale:u,cosPhi:f}=this;return{x:re(o)*f*u+.5,y:-Math.sin(re(l))/f*u+.5,z:0}}unproject(o,l){const{scale:u,cosPhi:f}=this,b=-(l-.5)/u,v=Tt(me((o-.5)/u)/f,-180,180),w=Math.asin(Tt(b*f,-1,1)),T=Tt(me(w),-Go,Go);return new yr(v,T)}}class OI extends J0{constructor(o){super(o),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(o,l,u){const f=lg(o,l,u);return ze(f,f,If(Gc(u))),{x:f[0],y:f[1],z:f[2]}}locationPoint(o,l){const u=Df(l.lat,l.lng),f=Po([],u),b=o.elevation?o.elevation.getAtPointOrZero(o.locationCoordinate(l),o._centerAltitude):o._centerAltitude;Yh(u,u,f,kl(1,0)*Pn*b);const v=ho(new Float64Array(16));return ol(v,o.pixelMatrix,o.globeMatrix),ze(u,u,v),new Ie(u[0],u[1])}pixelsPerMeter(o,l){return kl(1,0)*l}pixelSpaceConversion(o,l,u){const f=kl(1,o)*l,b=Bi(kl(1,45)*l,f,u);return this.pixelsPerMeter(o,l)/b}createTileMatrix(o,l,u){const f=cg(Gc(u.canonical));return ol(new Float64Array(16),o.globeMatrix,f)}createInversionMatrix(o,l){const{center:u}=o,f=If(Gc(l));return ig(f,f,re(u.lng)),g_(f,f,re(u.lat)),ku(f,f,[o._pixelsPerMercatorPixel,o._pixelsPerMercatorPixel,1]),Float32Array.from(f)}pointCoordinate(o,l,u,f){return C_(o,l,u,!0)||new To(0,0)}pointCoordinate3D(o,l,u){const f=this.pointCoordinate(o,l,u,0);return[f.x,f.y,f.z]}isPointAboveHorizon(o,l){return!C_(o,l.x,l.y,!1)}farthestPixelDistance(o){const l=function(f,b){const v=f.cameraToCenterDistance,w=f._centerAltitude*b,T=f._camera,E=f._camera.forward(),A=ka([],Ra([],E,-v),[0,0,w]),P=f.worldSize/(2*Math.PI),L=[0,0,-P],N=f.width/f.height,B=Math.tan(f.fovAboveCenter),$=Ra([],T.up(),B),K=Ra([],T.right(),B*N),ce=Po([],ka([],ka([],E,$),K)),Ce=[];let ue;if(new w_(A,ce).closestPointOnSphere(L,P,Ce)){const ve=ka([],Ce,L),Ae=Pa([],ve,A);ue=Math.cos(f.fovAboveCenter)*Ru(Ae)}else{const ve=Pa([],A,L),Ae=Pa([],L,A);Po(Ae,Ae);const ke=Ru(ve)-P;ue=Math.sqrt(ke*(ke+2*P));const at=Math.acos(ue/(P+ke))-Math.acos(xs(E,Ae));ue*=Math.cos(at)}return 1.01*ue}(o,this.pixelsPerMeter(o.center.lat,o.worldSize)),u=Vd(o.zoom);if(u>0){const f=q1(o,kl(1,o.center.lat)*o.worldSize),b=o.worldSize/(2*Math.PI),v=Math.max(o.width,o.height)/o.worldSize*Math.PI;return Bi(l,f+b*(1-Math.cos(v)),Math.pow(u,10))}return l}upVector(o,l,u){return lg(l,u,o,1)}upVectorScale(o){return{metersToTile:og(E_(Gc(o)))}}}function eb(a){const o=a.parallels,l=!!o&&Math.abs(o[0]+o[1])<.01;switch(a.name){case"mercator":return new J0(a);case"equirectangular":return new X1(a);case"naturalEarth":return new Y1(a);case"equalEarth":return new Q0(a);case"winkelTripel":return new ex(a);case"albers":return l?new Jg(a):new W1(a);case"lambertConformalConic":return l?new Jg(a):new Z1(a);case"globe":return new OI(a)}throw new Error(`Invalid projection name: ${a.name}`)}const K1=al.types,FI=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function G(a,o,l,u,f,b,v,w,T,E,A,P,L){const N=w?Math.min(ju,Math.round(w[0])):0,B=w?Math.min(ju,Math.round(w[1])):0;a.emplaceBack(o,l,Math.round(32*u),Math.round(32*f),b,v,(N<<1)+(T?1:0),B,16*E,16*A,256*P,256*L)}function Qc(a,o,l,u,f,b,v){a.emplaceBack(o,l,u,f,b,v)}function $f(a,o,l,u,f){a.emplaceBack(o,l,u,f),a.emplaceBack(o,l,u,f),a.emplaceBack(o,l,u,f),a.emplaceBack(o,l,u,f)}function tb(a){for(const o of a.sections)if(Km(o.text))return!0;return!1}class Ba{constructor(o){this.layoutVertexArray=new Mt,this.indexArray=new En,this.programConfigurations=o,this.segments=new Hr,this.dynamicLayoutVertexArray=new Nt,this.opacityVertexArray=new In,this.placedSymbolArray=new ro,this.globeExtVertexArray=new Vt}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(o,l,u,f){this.isEmpty()||(u&&(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,A0.members),this.indexBuffer=o.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=o.createVertexBuffer(this.dynamicLayoutVertexArray,k0.members,!0),this.opacityVertexBuffer=o.createVertexBuffer(this.opacityVertexArray,FI,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=o.createVertexBuffer(this.globeExtVertexArray,M1.members,!0)),this.opacityVertexBuffer.itemSize=1),(u||f)&&this.programConfigurations.upload(o))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}gn(Ba,"SymbolBuffers");class nb{constructor(o,l,u){this.layoutVertexArray=new o,this.layoutAttributes=l,this.indexArray=new u,this.segments=new Hr,this.collisionVertexArray=new gi,this.collisionVertexArrayExt=new oi}upload(o){this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=o.createVertexBuffer(this.collisionVertexArray,R0.members,!0),this.collisionVertexBufferExt=o.createVertexBuffer(this.collisionVertexArrayExt,Z_.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}gn(nb,"CollisionBuffers");class Hu{constructor(o){this.collisionBoxArray=o.collisionBoxArray,this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(v=>v.id),this.index=o.index,this.pixelRatio=o.pixelRatio,this.sourceLayerIndex=o.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ho([]),this.placementViewportMatrix=ho([]);const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Og(this.zoom,l["text-size"]),this.iconSizeData=Og(this.zoom,l["icon-size"]);const u=this.layers[0].layout,f=u.get("symbol-sort-key"),b=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==b&&void 0!==f.constantOr(1),this.sortFeaturesByY=("viewport-y"===b||"auto"===b&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(v=>Na[v]),this.stateDependentLayerIds=this.layers.filter(v=>v.isStateDependent()).map(v=>v.id),this.sourceID=o.sourceID,this.projection=o.projection}createArrays(){this.text=new Ba(new Zh(this.layers,this.zoom,o=>/^text/.test(o))),this.icon=new Ba(new Zh(this.layers,this.zoom,o=>/^icon/.test(o))),this.glyphOffsetArray=new vs,this.lineVertexArray=new Xh,this.symbolInstances=new Rr}calculateGlyphDependencies(o,l,u,f,b){for(let v=0;v<o.length;v++)if(l[o.charCodeAt(v)]=!0,f&&b){const w=Vf[o.charAt(v)];w&&(l[w.charCodeAt(0)]=!0)}}populate(o,l,u,f){const b=this.layers[0],v=b.layout,w="globe"===this.projection.name,T=v.get("text-font"),E=v.get("text-field"),A=v.get("icon-image"),P=("constant"!==E.value.kind||E.value.value instanceof Gs&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&("constant"!==T.value.kind||T.value.value.length>0),L="constant"!==A.value.kind||!!A.value.value||Object.keys(A.parameters).length>0,N=v.get("symbol-sort-key");if(this.features=[],!P&&!L)return;const B=l.iconDependencies,$=l.glyphDependencies,K=l.availableImages,ce=new R(this.zoom);for(const{feature:Ce,id:ue,index:ve,sourceLayerIndex:Ae}of o){const ke=b._featureFilter.needGeometry,at=Lu(Ce,ke);if(!b._featureFilter.filter(ce,at,u))continue;if(ke||(at.geometry=qc(Ce,u,f)),w&&1!==Ce.type&&u.z<=5){const ht=at.geometry,Dt=.98078528056,Ct=(Rt,Gt)=>xs(lg(Rt.x,Rt.y,u,1),lg(Gt.x,Gt.y,u,1))<Dt;for(let Rt=0;Rt<ht.length;Rt++)ht[Rt]=YS(ht[Rt],Ct)}let rt,_t;if(P){const ht=b.getValueAndResolveTokens("text-field",at,u,K),Dt=Gs.factory(ht);tb(Dt)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===S()||this.hasRTLText&&I.isParsed())&&(rt=Fg(Dt,b,at))}if(L){const ht=b.getValueAndResolveTokens("icon-image",at,u,K);_t=ht instanceof wa?ht:wa.fromString(ht)}if(!rt&&!_t)continue;const zt=this.sortFeaturesByKey?N.evaluate(at,{},u):void 0;if(this.features.push({id:ue,text:rt,icon:_t,index:ve,sourceLayerIndex:Ae,geometry:at.geometry,properties:Ce.properties,type:K1[Ce.type],sortKey:zt}),_t&&(B[_t.name]=!0),rt){const ht=T.evaluate(at,{},u).join(","),Dt="map"===v.get("text-rotation-alignment")&&"point"!==v.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Na.vertical)>=0;for(const Ct of rt.sections)if(Ct.image)B[Ct.image.name]=!0;else{const Rt=Ma(rt.toString()),Gt=Ct.fontStack||ht,ft=$[Gt]=$[Gt]||{};this.calculateGlyphDependencies(Ct.text,ft,Dt,this.allowVerticalPlacement,Rt)}}}"line"===v.get("symbol-placement")&&(this.features=function(Ce){const ue={},ve={},Ae=[];let ke=0;function at(ht){Ae.push(Ce[ht]),ke++}function rt(ht,Dt,Ct){const Rt=ve[ht];return delete ve[ht],ve[Dt]=Rt,Ae[Rt].geometry[0].pop(),Ae[Rt].geometry[0]=Ae[Rt].geometry[0].concat(Ct[0]),Rt}function _t(ht,Dt,Ct){const Rt=ue[Dt];return delete ue[Dt],ue[ht]=Rt,Ae[Rt].geometry[0].shift(),Ae[Rt].geometry[0]=Ct[0].concat(Ae[Rt].geometry[0]),Rt}function zt(ht,Dt,Ct){const Rt=Ct?Dt[0][Dt[0].length-1]:Dt[0][0];return`${ht}:${Rt.x}:${Rt.y}`}for(let ht=0;ht<Ce.length;ht++){const Dt=Ce[ht],Ct=Dt.geometry,Rt=Dt.text?Dt.text.toString():null;if(!Rt){at(ht);continue}const Gt=zt(Rt,Ct),ft=zt(Rt,Ct,!0);if(Gt in ve&&ft in ue&&ve[Gt]!==ue[ft]){const sn=_t(Gt,ft,Ct),mn=rt(Gt,ft,Ae[sn].geometry);delete ue[Gt],delete ve[ft],ve[zt(Rt,Ae[mn].geometry,!0)]=mn,Ae[sn].geometry=null}else Gt in ve?rt(Gt,ft,Ct):ft in ue?_t(Gt,ft,Ct):(at(ht),ue[Gt]=ke-1,ve[ft]=ke-1)}return Ae.filter(ht=>ht.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Ce,ue)=>Ce.sortKey-ue.sortKey)}update(o,l,u,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(o,l,this.layers,u,f),this.icon.programConfigurations.updatePaintArrays(o,l,this.layers,u,f))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(o){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(o),this.iconCollisionBox.upload(o)),this.text.upload(o,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(o,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=eb(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(o,l){const u=this.lineVertexArray.length;if(void 0!==o.segment)for(const{x:f,y:b}of l)this.lineVertexArray.emplaceBack(f,b);return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(o,l,u,f,b,v,w,T,E,A,P,L,N,B){const $=o.indexArray,K=o.layoutVertexArray,ce=o.globeExtVertexArray,Ce=o.segments.prepareSegment(4*l.length,K,$,this.canOverlap?v.sortKey:void 0),ue=this.glyphOffsetArray.length,ve=Ce.vertexLength,Ae=this.allowVerticalPlacement&&w===Na.vertical?Math.PI/2:0,ke=v.text&&v.text.sections;for(let rt=0;rt<l.length;rt++){const{tl:_t,tr:zt,bl:ht,br:Dt,tex:Ct,pixelOffsetTL:Rt,pixelOffsetBR:Gt,minFontScaleX:ft,minFontScaleY:sn,glyphOffset:mn,isSDF:dn,sectionIndex:Wn}=l[rt],Xt=Ce.vertexLength,kn=mn[1];if(G(K,E.x,E.y,_t.x,kn+_t.y,Ct.x,Ct.y,u,dn,Rt.x,Rt.y,ft,sn),G(K,E.x,E.y,zt.x,kn+zt.y,Ct.x+Ct.w,Ct.y,u,dn,Gt.x,Rt.y,ft,sn),G(K,E.x,E.y,ht.x,kn+ht.y,Ct.x,Ct.y+Ct.h,u,dn,Rt.x,Gt.y,ft,sn),G(K,E.x,E.y,Dt.x,kn+Dt.y,Ct.x+Ct.w,Ct.y+Ct.h,u,dn,Gt.x,Gt.y,ft,sn),T){const{x:Jn,y:ji,z:ei}=T.anchor,[Fn,Gi,Xn]=T.up;Qc(ce,Jn,ji,ei,Fn,Gi,Xn),Qc(ce,Jn,ji,ei,Fn,Gi,Xn),Qc(ce,Jn,ji,ei,Fn,Gi,Xn),Qc(ce,Jn,ji,ei,Fn,Gi,Xn),$f(o.dynamicLayoutVertexArray,Jn,ji,ei,Ae)}else $f(o.dynamicLayoutVertexArray,E.x,E.y,E.z,Ae);$.emplaceBack(Xt,Xt+1,Xt+2),$.emplaceBack(Xt+1,Xt+2,Xt+3),Ce.vertexLength+=4,Ce.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(mn[0]),rt!==l.length-1&&Wn===l[rt+1].sectionIndex||o.programConfigurations.populatePaintArrays(K.length,v,v.index,{},N,B,ke&&ke[Wn])}const at=T?T.anchor:E;o.placedSymbolArray.emplaceBack(at.x,at.y,at.z,E.x,E.y,ue,this.glyphOffsetArray.length-ue,ve,A,P,E.segment,u?u[0]:0,u?u[1]:0,f[0],f[1],w,0,!1,0,L,0)}_commitLayoutVertex(o,l,u,f,b,v,w){o.emplaceBack(l,u,f,b,v,Math.round(w.x),Math.round(w.y))}_addCollisionDebugVertices(o,l,u,f,b,v,w){const T=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),E=T.vertexLength,A=w.tileAnchorX,P=w.tileAnchorY;for(let N=0;N<4;N++)u.collisionVertexArray.emplaceBack(0,0,0,0);u.collisionVertexArrayExt.emplaceBack(l,-o.padding,-o.padding),u.collisionVertexArrayExt.emplaceBack(l,o.padding,-o.padding),u.collisionVertexArrayExt.emplaceBack(l,o.padding,o.padding),u.collisionVertexArrayExt.emplaceBack(l,-o.padding,o.padding),this._commitLayoutVertex(u.layoutVertexArray,f,b,v,A,P,new Ie(o.x1,o.y1)),this._commitLayoutVertex(u.layoutVertexArray,f,b,v,A,P,new Ie(o.x2,o.y1)),this._commitLayoutVertex(u.layoutVertexArray,f,b,v,A,P,new Ie(o.x2,o.y2)),this._commitLayoutVertex(u.layoutVertexArray,f,b,v,A,P,new Ie(o.x1,o.y2)),T.vertexLength+=4;const L=u.indexArray;L.emplaceBack(E,E+1),L.emplaceBack(E+1,E+2),L.emplaceBack(E+2,E+3),L.emplaceBack(E+3,E),T.primitiveLength+=4}_addTextDebugCollisionBoxes(o,l,u,f,b,v){for(let w=f;w<b;w++){const T=u.get(w),E=this.getSymbolInstanceTextSize(o,v,l,w);this._addCollisionDebugVertices(T,E,this.textCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,v)}}_addIconDebugCollisionBoxes(o,l,u,f,b,v){for(let w=f;w<b;w++){const T=u.get(w),E=this.getSymbolInstanceIconSize(o,l,v.placedIconSymbolIndex);this._addCollisionDebugVertices(T,E,this.iconCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,v)}}generateCollisionDebugBuffers(o,l){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new nb(bn,A1.members,io),this.iconCollisionBox=new nb(bn,A1.members,io);const u=ap(this.iconSizeData,o),f=ap(this.textSizeData,o);for(let b=0;b<this.symbolInstances.length;b++){const v=this.symbolInstances.get(b);this._addTextDebugCollisionBoxes(f,o,l,v.textBoxStartIndex,v.textBoxEndIndex,v),this._addTextDebugCollisionBoxes(f,o,l,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v),this._addIconDebugCollisionBoxes(u,o,l,v.iconBoxStartIndex,v.iconBoxEndIndex,v),this._addIconDebugCollisionBoxes(u,o,l,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex,v)}}getSymbolInstanceTextSize(o,l,u,f){const b=this.text.placedSymbolArray.get(l.rightJustifiedTextSymbolIndex>=0?l.rightJustifiedTextSymbolIndex:l.centerJustifiedTextSymbolIndex>=0?l.centerJustifiedTextSymbolIndex:l.leftJustifiedTextSymbolIndex>=0?l.leftJustifiedTextSymbolIndex:l.verticalPlacedTextSymbolIndex>=0?l.verticalPlacedTextSymbolIndex:f),v=dc(this.textSizeData,o,b)/24;return this.tilePixelRatio*v}getSymbolInstanceIconSize(o,l,u){const f=this.icon.placedSymbolArray.get(u),b=dc(this.iconSizeData,o,f);return this.tilePixelRatio*b}_commitDebugCollisionVertexUpdate(o,l,u){o.emplaceBack(l,-u,-u),o.emplaceBack(l,u,-u),o.emplaceBack(l,u,u),o.emplaceBack(l,-u,u)}_updateTextDebugCollisionBoxes(o,l,u,f,b,v){for(let w=f;w<b;w++){const T=u.get(w),E=this.getSymbolInstanceTextSize(o,v,l,w);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,E,T.padding)}}_updateIconDebugCollisionBoxes(o,l,u,f,b,v){for(let w=f;w<b;w++){const T=u.get(w),E=this.getSymbolInstanceIconSize(o,l,v);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,E,T.padding)}}updateCollisionDebugBuffers(o,l){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const u=ap(this.iconSizeData,o),f=ap(this.textSizeData,o);for(let b=0;b<this.symbolInstances.length;b++){const v=this.symbolInstances.get(b);this._updateTextDebugCollisionBoxes(f,o,l,v.textBoxStartIndex,v.textBoxEndIndex,v),this._updateTextDebugCollisionBoxes(f,o,l,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v),this._updateIconDebugCollisionBoxes(u,o,l,v.iconBoxStartIndex,v.iconBoxEndIndex,v.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(u,o,l,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex,v.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(o,l,u,f,b,v,w,T,E){const A={};if(l<u){const{x1:P,y1:L,x2:N,y2:B,padding:$,projectedAnchorX:K,projectedAnchorY:ce,projectedAnchorZ:Ce,tileAnchorX:ue,tileAnchorY:ve,featureIndex:Ae}=o.get(l);A.textBox={x1:P,y1:L,x2:N,y2:B,padding:$,projectedAnchorX:K,projectedAnchorY:ce,projectedAnchorZ:Ce,tileAnchorX:ue,tileAnchorY:ve},A.textFeatureIndex=Ae}if(f<b){const{x1:P,y1:L,x2:N,y2:B,padding:$,projectedAnchorX:K,projectedAnchorY:ce,projectedAnchorZ:Ce,tileAnchorX:ue,tileAnchorY:ve,featureIndex:Ae}=o.get(f);A.verticalTextBox={x1:P,y1:L,x2:N,y2:B,padding:$,projectedAnchorX:K,projectedAnchorY:ce,projectedAnchorZ:Ce,tileAnchorX:ue,tileAnchorY:ve},A.verticalTextFeatureIndex=Ae}if(v<w){const{x1:P,y1:L,x2:N,y2:B,padding:$,projectedAnchorX:K,projectedAnchorY:ce,projectedAnchorZ:Ce,tileAnchorX:ue,tileAnchorY:ve,featureIndex:Ae}=o.get(v);A.iconBox={x1:P,y1:L,x2:N,y2:B,padding:$,projectedAnchorX:K,projectedAnchorY:ce,projectedAnchorZ:Ce,tileAnchorX:ue,tileAnchorY:ve},A.iconFeatureIndex=Ae}if(T<E){const{x1:P,y1:L,x2:N,y2:B,padding:$,projectedAnchorX:K,projectedAnchorY:ce,projectedAnchorZ:Ce,tileAnchorX:ue,tileAnchorY:ve,featureIndex:Ae}=o.get(T);A.verticalIconBox={x1:P,y1:L,x2:N,y2:B,padding:$,projectedAnchorX:K,projectedAnchorY:ce,projectedAnchorZ:Ce,tileAnchorX:ue,tileAnchorY:ve},A.verticalIconFeatureIndex=Ae}return A}deserializeCollisionBoxes(o){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const u=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(o,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(o,l){const u=o.placedSymbolArray.get(l),f=u.vertexStartIndex+4*u.numGlyphs;for(let b=u.vertexStartIndex;b<f;b+=4)o.indexArray.emplaceBack(b,b+1,b+2),o.indexArray.emplaceBack(b+1,b+2,b+3)}getSortedSymbolIndexes(o){if(this.sortedAngle===o&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const l=Math.sin(o),u=Math.cos(o),f=[],b=[],v=[];for(let w=0;w<this.symbolInstances.length;++w){v.push(w);const T=this.symbolInstances.get(w);f.push(0|Math.round(l*T.tileAnchorX+u*T.tileAnchorY)),b.push(T.featureIndex)}return v.sort((w,T)=>f[w]-f[T]||b[T]-b[w]),v}addToSortKeyRanges(o,l){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===l?u.symbolInstanceEnd=o+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:o,symbolInstanceEnd:o+1})}sortFeatures(o){if(this.sortFeaturesByY&&this.sortedAngle!==o&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(o),this.sortedAngle=o,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const u=this.symbolInstances.get(l);this.featureSortOrder.push(u.featureIndex);const{rightJustifiedTextSymbolIndex:f,centerJustifiedTextSymbolIndex:b,leftJustifiedTextSymbolIndex:v,verticalPlacedTextSymbolIndex:w,placedIconSymbolIndex:T,verticalPlacedIconSymbolIndex:E}=u;f>=0&&this.addIndicesForPlacedSymbol(this.text,f),b>=0&&b!==f&&this.addIndicesForPlacedSymbol(this.text,b),v>=0&&v!==b&&v!==f&&this.addIndicesForPlacedSymbol(this.text,v),w>=0&&this.addIndicesForPlacedSymbol(this.text,w),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}gn(Hu,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Hu.MAX_GLYPHS=65535,Hu.addDynamicAttributes=$f;const dy=new ge({"symbol-placement":new U(bt.layout_symbol["symbol-placement"]),"symbol-spacing":new U(bt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new U(bt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new J(bt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new U(bt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new U(bt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new U(bt.layout_symbol["icon-ignore-placement"]),"icon-optional":new U(bt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new U(bt.layout_symbol["icon-rotation-alignment"]),"icon-size":new J(bt.layout_symbol["icon-size"]),"icon-text-fit":new U(bt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new U(bt.layout_symbol["icon-text-fit-padding"]),"icon-image":new J(bt.layout_symbol["icon-image"]),"icon-rotate":new J(bt.layout_symbol["icon-rotate"]),"icon-padding":new U(bt.layout_symbol["icon-padding"]),"icon-keep-upright":new U(bt.layout_symbol["icon-keep-upright"]),"icon-offset":new J(bt.layout_symbol["icon-offset"]),"icon-anchor":new J(bt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new U(bt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new U(bt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new U(bt.layout_symbol["text-rotation-alignment"]),"text-field":new J(bt.layout_symbol["text-field"]),"text-font":new J(bt.layout_symbol["text-font"]),"text-size":new J(bt.layout_symbol["text-size"]),"text-max-width":new J(bt.layout_symbol["text-max-width"]),"text-line-height":new J(bt.layout_symbol["text-line-height"]),"text-letter-spacing":new J(bt.layout_symbol["text-letter-spacing"]),"text-justify":new J(bt.layout_symbol["text-justify"]),"text-radial-offset":new J(bt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new U(bt.layout_symbol["text-variable-anchor"]),"text-anchor":new J(bt.layout_symbol["text-anchor"]),"text-max-angle":new U(bt.layout_symbol["text-max-angle"]),"text-writing-mode":new U(bt.layout_symbol["text-writing-mode"]),"text-rotate":new J(bt.layout_symbol["text-rotate"]),"text-padding":new U(bt.layout_symbol["text-padding"]),"text-keep-upright":new U(bt.layout_symbol["text-keep-upright"]),"text-transform":new J(bt.layout_symbol["text-transform"]),"text-offset":new J(bt.layout_symbol["text-offset"]),"text-allow-overlap":new U(bt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new U(bt.layout_symbol["text-ignore-placement"]),"text-optional":new U(bt.layout_symbol["text-optional"])});var Ll={paint:new ge({"icon-opacity":new J(bt.paint_symbol["icon-opacity"]),"icon-color":new J(bt.paint_symbol["icon-color"]),"icon-halo-color":new J(bt.paint_symbol["icon-halo-color"]),"icon-halo-width":new J(bt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new J(bt.paint_symbol["icon-halo-blur"]),"icon-translate":new U(bt.paint_symbol["icon-translate"]),"icon-translate-anchor":new U(bt.paint_symbol["icon-translate-anchor"]),"text-opacity":new J(bt.paint_symbol["text-opacity"]),"text-color":new J(bt.paint_symbol["text-color"],{runtimeType:fs,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new J(bt.paint_symbol["text-halo-color"]),"text-halo-width":new J(bt.paint_symbol["text-halo-width"]),"text-halo-blur":new J(bt.paint_symbol["text-halo-blur"]),"text-translate":new U(bt.paint_symbol["text-translate"]),"text-translate-anchor":new U(bt.paint_symbol["text-translate-anchor"])}),layout:dy};class ib{constructor(o){this.type=o.property.overrides?o.property.overrides.runtimeType:Er,this.defaultValue=o}evaluate(o){if(o.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(o.formattedSection))return l.getOverride(o.formattedSection)}return o.feature&&o.featureState?this.defaultValue.evaluate(o.feature,o.featureState):this.defaultValue.property.specification.default}eachChild(o){this.defaultValue.isConstant()||o(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}gn(ib,"FormatSectionOverride",{omit:["defaultValue"]});class Gf extends $o{constructor(o){super(o,Ll)}recalculate(o,l){super.recalculate(o,l),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const u=this.layout.get("text-writing-mode");if(u){const f=[];for(const b of u)f.indexOf(b)<0&&f.push(b);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(o,l,u,f){const b=this.layout.get(o).evaluate(l,{},u,f),v=this._unevaluatedLayout._values[o];return v.isDataDriven()||Dd(v.value)||!b?b:(w=l.properties,b.replace(/{([^{}]+)}/g,(E,A)=>A in w?String(w[A]):""));var w}createBucket(o){return new Hu(o)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const o of Ll.paint.overridableProperties){if(!Gf.hasPaintOverride(this.layout,o))continue;const l=this.paint.get(o),u=new ib(l),f=new nf(u,l.property.specification);let b=null;b="constant"===l.value.kind||"source"===l.value.kind?new rf("source",f):new cr("composite",f,l.value.zoomStops,l.value._interpolationType),this.paint._values[o]=new ie(l.property,b,l.parameters)}}_handleOverridablePaintPropertyUpdate(o,l,u){return!(!this.layout||l.isDataDriven()||u.isDataDriven())&&Gf.hasPaintOverride(this.layout,o)}static hasPaintOverride(o,l){const u=o.get("text-field"),f=Ll.paint.properties[l];let b=!1;const v=w=>{for(const T of w)if(f.overrides&&f.overrides.hasOverride(T))return void(b=!0)};if("constant"===u.value.kind&&u.value.value instanceof Gs)v(u.value.value.sections);else if("source"===u.value.kind){const w=E=>{b||(E instanceof So&&to(E.value)===Ni?v(E.value.sections):E instanceof Jt?v(E.sections):E.eachChild(w))},T=u.value;T._styleExpression&&w(T._styleExpression.expression)}return b}getProgramConfiguration(o){return new Fd(this,o)}}var hy={paint:new ge({"background-color":new U(bt.paint_background["background-color"]),"background-pattern":new U(bt.paint_background["background-pattern"]),"background-opacity":new U(bt.paint_background["background-opacity"])})},NI={paint:new ge({"raster-opacity":new U(bt.paint_raster["raster-opacity"]),"raster-hue-rotate":new U(bt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new U(bt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new U(bt.paint_raster["raster-brightness-max"]),"raster-saturation":new U(bt.paint_raster["raster-saturation"]),"raster-contrast":new U(bt.paint_raster["raster-contrast"]),"raster-resampling":new U(bt.paint_raster["raster-resampling"]),"raster-fade-duration":new U(bt.paint_raster["raster-fade-duration"])})};class tx extends $o{constructor(o){super(o,{}),this.implementation=o}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(o){this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)}onRemove(o){this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)}}var BI={paint:new ge({"sky-type":new U(bt.paint_sky["sky-type"]),"sky-atmosphere-sun":new U(bt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new U(bt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new U(bt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new U(bt.paint_sky["sky-gradient-radius"]),"sky-gradient":new pe(bt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new U(bt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new U(bt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new U(bt.paint_sky["sky-opacity"])})};function mp(a,o,l){const u=[0,0,1],f=v_([]);return Qv(f,f,l?-re(a)+Math.PI:re(a)),Qh(f,f,-re(o)),y_(u,u,f),Po(u,u)}const rb={circle:class extends $o{constructor(a){super(a,n1)}createBucket(a){return new Af(a)}queryRadius(a){const o=a;return Fu("circle-radius",this,o)+Fu("circle-stroke-width",this,o)+kf(this.paint.get("circle-translate"))}queryIntersectsFeature(a,o,l,u,f,b,v,w){const T=vg(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),b.angle,a.pixelToTileUnitsFactor),E=this.paint.get("circle-radius").evaluate(o,l)+this.paint.get("circle-stroke-width").evaluate(o,l);return a0(a,u,b,v,w,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),T,E)}getProgramIds(){return["circle"]}getProgramConfiguration(a){return new Fd(this,a)}},heatmap:class extends $o{createBucket(a){return new xg(a)}constructor(a){super(a,u0),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){"heatmap-color"===a&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Xc({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(a){return Fu("heatmap-radius",this,a)}queryIntersectsFeature(a,o,l,u,f,b,v,w){const T=this.paint.get("heatmap-radius").evaluate(o,l);return a0(a,u,b,v,w,!0,!0,new Ie(0,0),T)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(a){return new Fd(this,a)}},hillshade:class extends $o{constructor(a){super(a,d0)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends $o{constructor(a){super(a,c1)}getProgramIds(){const a=this.paint.get("fill-pattern"),o=a&&a.constantOr(1),l=[o?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&l.push(o&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),l}getProgramConfiguration(a){return new Fd(this,a)}recalculate(a,o){super.recalculate(a,o);const l=this.paint._values["fill-outline-color"];"constant"===l.value.kind&&void 0===l.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new uc(a)}queryRadius(){return kf(this.paint.get("fill-translate"))}queryIntersectsFeature(a,o,l,u,f,b){return!a.queryGeometry.isAboveHorizon&&R_(s0(a.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),b.angle,a.pixelToTileUnitsFactor),u)}isTileClipped(){return!0}},"fill-extrusion":class extends $o{constructor(a){super(a,M0)}createBucket(a){return new kg(a)}queryRadius(){return kf(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(a){return new Fd(this,a)}queryIntersectsFeature(a,o,l,u,f,b,v,w,T){const E=vg(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),b.angle,a.pixelToTileUnitsFactor),A=this.paint.get("fill-extrusion-height").evaluate(o,l),P=this.paint.get("fill-extrusion-base").evaluate(o,l),L=[0,0],N=w&&b.elevation,B=b.elevation?b.elevation.exaggeration():1,$=a.tile.getBucket(this);if(N&&$ instanceof kg){const ve=$.centroidVertexArray,Ae=T+1;Ae<ve.length&&(L[0]=ve.geta_centroid_pos0(Ae),L[1]=ve.geta_centroid_pos1(Ae))}if(0===L[0]&&1===L[1])return!1;"globe"===b.projection.name&&(u=I0([u],[new Ie(0,0),new Ie(Pn,Pn)],a.tileID.canonical).map(ve=>ve.polygon).flat());const K=N?w:null,[ce,Ce]=(Ae=u,ke=P,at=A,rt=E,_t=v,zt=K,ht=L,Dt=B,Ct=b.center.lat,"globe"===(ve=b).projection.name?function(Gt,ft,sn,mn,dn,Wn,Xt,kn,Jn,ji,ei){const Fn=[],Gi=[],Xn=Gt.projection.upVectorScale(ei,Gt.center.lat,Gt.worldSize).metersToTile,Zn=[0,0,0,1],ir=[0,0,0,1],Ar=(mr,$r,Yr,Gr)=>{mr[0]=$r,mr[1]=Yr,mr[2]=Gr,mr[3]=1},fr=D0();sn>0&&(sn+=fr),mn+=fr;for(const mr of ft){const $r=[],Yr=[];for(const Gr of mr){const xr=Gr.x+dn.x,Do=Gr.y+dn.y,po=Gt.projection.projectTilePoint(xr,Do,ei),Kr=Gt.projection.upVector(ei,Gr.x,Gr.y);let Ki=sn,fo=mn;if(Xt){const kr=G_(xr,Do,sn,mn,Xt,kn,Jn,ji);Ki+=kr.base,fo+=kr.top}0!==sn?Ar(Zn,po.x+Kr[0]*Xn*Ki,po.y+Kr[1]*Xn*Ki,po.z+Kr[2]*Xn*Ki):Ar(Zn,po.x,po.y,po.z),Ar(ir,po.x+Kr[0]*Xn*fo,po.y+Kr[1]*Xn*fo,po.z+Kr[2]*Xn*fo),ze(Zn,Zn,Wn),ze(ir,ir,Wn),$r.push(new sp(Zn[0],Zn[1],Zn[2])),Yr.push(new sp(ir[0],ir[1],ir[2]))}Fn.push($r),Gi.push(Yr)}return[Fn,Gi]}(ve,Ae,ke,at,rt,_t,zt,ht,Dt,Ct,a.tileID.canonical):zt?function(Gt,ft,sn,mn,dn,Wn,Xt,kn,Jn){const ji=[],ei=[],Fn=[0,0,0,1];for(const Gi of Gt){const Xn=[],Zn=[];for(const ir of Gi){const Ar=ir.x+mn.x,fr=ir.y+mn.y,mr=G_(Ar,fr,ft,sn,Wn,Xt,kn,Jn);Fn[0]=Ar,Fn[1]=fr,Fn[2]=mr.base,Fn[3]=1,$c(Fn,Fn,dn),Fn[3]=Math.max(Fn[3],1e-5);const $r=new sp(Fn[0]/Fn[3],Fn[1]/Fn[3],Fn[2]/Fn[3]);Fn[0]=Ar,Fn[1]=fr,Fn[2]=mr.top,Fn[3]=1,$c(Fn,Fn,dn),Fn[3]=Math.max(Fn[3],1e-5);const Yr=new sp(Fn[0]/Fn[3],Fn[1]/Fn[3],Fn[2]/Fn[3]);Xn.push($r),Zn.push(Yr)}ji.push(Xn),ei.push(Zn)}return[ji,ei]}(Ae,ke,at,rt,_t,zt,ht,Dt,Ct):function(Gt,ft,sn,mn,dn){const Wn=[],Xt=[],kn=dn[8]*ft,Jn=dn[9]*ft,ji=dn[10]*ft,ei=dn[11]*ft,Fn=dn[8]*sn,Gi=dn[9]*sn,Xn=dn[10]*sn,Zn=dn[11]*sn;for(const ir of Gt){const Ar=[],fr=[];for(const mr of ir){const $r=mr.x+mn.x,Yr=mr.y+mn.y,Gr=dn[0]*$r+dn[4]*Yr+dn[12],xr=dn[1]*$r+dn[5]*Yr+dn[13],Do=dn[2]*$r+dn[6]*Yr+dn[14],po=dn[3]*$r+dn[7]*Yr+dn[15],Kr=Gr+kn,Ki=xr+Jn,fo=Do+ji,kr=Math.max(po+ei,1e-5),ws=Gr+Fn,qt=xr+Gi,qo=Do+Xn,vo=Math.max(po+Zn,1e-5);Ar.push(new sp(Kr/kr,Ki/kr,fo/kr)),fr.push(new sp(ws/vo,qt/vo,qo/vo))}Wn.push(Ar),Xt.push(fr)}return[Wn,Xt]}(Ae,ke,at,rt,_t)),ue=a.queryGeometry;var ve,Ae,ke,at,rt,_t,zt,ht,Dt,Ct;return function(ve,Ae,ke){let at=1/0;R_(ke,Ae)&&(at=ll(ke,Ae[0]));for(let rt=0;rt<Ae.length;rt++){const _t=Ae[rt],zt=ve[rt];for(let ht=0;ht<_t.length-1;ht++){const Dt=_t[ht],Ct=[Dt,_t[ht+1],zt[ht+1],zt[ht],Dt];bg(ke,Ct)&&(at=Math.min(at,ll(ke,Ct)))}}return at!==1/0&&at}(ce,Ce,ue.isPointQuery()?ue.screenBounds:ue.screenGeometry)}},line:class extends $o{constructor(a){super(a,Lg),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(a){if("line-gradient"===a){const o=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=o._styleExpression&&o._styleExpression.expression instanceof kh,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(a,o){super.recalculate(a,o),this.paint._values["line-floorwidth"]=W_.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new q_(a)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(a){return new Fd(this,a)}queryRadius(a){const o=a,l=X_(Fu("line-width",this,o),Fu("line-gap-width",this,o)),u=Fu("line-offset",this,o);return l/2+Math.abs(u)+kf(this.paint.get("line-translate"))}queryIntersectsFeature(a,o,l,u,f,b){if(a.queryGeometry.isAboveHorizon)return!1;const v=s0(a.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),b.angle,a.pixelToTileUnitsFactor),w=a.pixelToTileUnitsFactor/2*X_(this.paint.get("line-width").evaluate(o,l),this.paint.get("line-gap-width").evaluate(o,l)),T=this.paint.get("line-offset").evaluate(o,l);return T&&(u=function(E,A){const P=[],L=new Ie(0,0);for(let N=0;N<E.length;N++){const B=E[N],$=[];for(let K=0;K<B.length;K++){const ce=B[K],Ce=B[K+1],ue=0===K?L:ce.sub(B[K-1])._unit()._perp(),ve=K===B.length-1?L:Ce.sub(ce)._unit()._perp(),Ae=ue._add(ve)._unit();Ae._mult(1/(Ae.x*ve.x+Ae.y*ve.y)),$.push(Ae._mult(A)._add(ce))}P.push($)}return P}(u,T*a.pixelToTileUnitsFactor)),function(E,A,P){for(let L=0;L<A.length;L++){const N=A[L];if(E.length>=3)for(let B=0;B<N.length;B++)if(Ou(E,N[B]))return!0;if(QS(E,N,P))return!0}return!1}(v,u,w)}isTileClipped(){return!0}},symbol:Gf,background:class extends $o{constructor(a){super(a,hy)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends $o{constructor(a){super(a,NI)}getProgramIds(){return["raster"]}},sky:class extends $o{constructor(a){super(a,BI),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){"sky-gradient"===a?this._updateColorRamp():"sky-atmosphere-sun"!==a&&"sky-atmosphere-halo-color"!==a&&"sky-atmosphere-color"!==a&&"sky-atmosphere-sun-intensity"!==a||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Xc({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(a){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const o=a.style.light.properties.get("position");return this._lightPosition.azimuthal!==o.azimuthal||this._lightPosition.polar!==o.polar}return!1}getCenter(a,o){if("atmosphere"===this.paint.get("sky-type")){const u=this.paint.get("sky-atmosphere-sun"),f=!u,b=a.style.light,v=b.properties.get("position");return f&&"viewport"===b.properties.get("anchor")&&Qn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),f?mp(v.azimuthal,90-v.polar,o):mp(u[0],90-u[1],o)}const l=this.paint.get("sky-gradient-center");return mp(l[0],90-l[1],o)}is3D(){return!1}isSky(){return!0}markSkyboxValid(a){this._skyboxInvalidated=!1,this._lightPosition=a.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const a=this.paint.get("sky-type");return"atmosphere"===a?["skyboxCapture","skybox"]:"gradient"===a?["skyboxGradient"]:null}}};class Yd{constructor(o,l,u,f){this.context=o,this.format=u,this.texture=o.gl.createTexture(),this.update(l,f)}update(o,l,u){const{width:f,height:b}=o,{context:v}=this,{gl:w}=v,{HTMLImageElement:T,HTMLCanvasElement:E,HTMLVideoElement:A,ImageData:P,ImageBitmap:L}=te;if(w.bindTexture(w.TEXTURE_2D,this.texture),v.pixelStoreUnpackFlipY.set(!1),v.pixelStoreUnpack.set(1),v.pixelStoreUnpackPremultiplyAlpha.set(this.format===w.RGBA&&(!l||!1!==l.premultiply)),u||this.size&&this.size[0]===f&&this.size[1]===b){const{x:N,y:B}=u||{x:0,y:0};o instanceof T||o instanceof E||o instanceof A||o instanceof P||L&&o instanceof L?w.texSubImage2D(w.TEXTURE_2D,0,N,B,w.RGBA,w.UNSIGNED_BYTE,o):w.texSubImage2D(w.TEXTURE_2D,0,N,B,f,b,w.RGBA,w.UNSIGNED_BYTE,o.data)}else this.size=[f,b],o instanceof T||o instanceof E||o instanceof A||o instanceof P||L&&o instanceof L?w.texImage2D(w.TEXTURE_2D,0,this.format,this.format,w.UNSIGNED_BYTE,o):w.texImage2D(w.TEXTURE_2D,0,this.format,f,b,0,this.format,w.UNSIGNED_BYTE,o.data);this.useMipmap=Boolean(l&&l.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&w.generateMipmap(w.TEXTURE_2D)}bind(o,l){const{context:u}=this,{gl:f}=u;f.bindTexture(f.TEXTURE_2D,this.texture),o!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,o),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap?o===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_NEAREST:o),this.filter=o),l!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,l),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,l),this.wrap=l)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}class py{constructor(o){this._callback=o,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class fy{constructor(){this.tasks={},this.taskQueue=[],Ci(["process"],this),this.invoker=new py(this.process),this.nextId=0}add(o,l){const u=this.nextId++,f=function({type:b,isSymbolTile:v,zoom:w}){return w=w||0,"message"===b?0:"maybePrepare"!==b||v?"parseTile"!==b||v?"parseTile"===b&&v?300-w:"maybePrepare"===b&&v?400-w:500:200-w:100-w}(l);if(0===f){Wr();try{o()}finally{}return{cancel:()=>{}}}return this.tasks[u]={fn:o,metadata:l,priority:f,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){Wr();try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;const o=this.pick();if(null===o)return;const l=this.tasks[o];if(delete this.tasks[o],this.taskQueue.length&&this.invoker.trigger(),!l)return;l.fn()}finally{}}pick(){let o=null,l=1/0;for(let f=0;f<this.taskQueue.length;f++){const b=this.tasks[this.taskQueue[f]];b.priority<l&&(l=b.priority,o=f)}if(null===o)return null;const u=this.taskQueue[o];return this.taskQueue.splice(o,1),u}remove(){this.invoker.remove()}}class Q1{constructor(o){this._stringToNumber={},this._numberToString=[];for(let l=0;l<o.length;l++){const u=o[l];this._stringToNumber[u]=l,this._numberToString[l]=u}}encode(o){return this._stringToNumber[o]}decode(o){return this._numberToString[o]}}const J1=["tile","layer","source","sourceLayer","state"];class nx{constructor(o,l,u,f,b){this.type="Feature",this._vectorTileFeature=o,this._z=l,this._x=u,this._y=f,this.properties=o.properties,this.id=b}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(o){this._geometry=o}toJSON(){const o={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(o.id=this.id);for(const l of J1)void 0!==this[l]&&(o[l]=this[l]);return o}}const Jc=new Uint16Array(8184);for(let a=0;a<2046;a++){let o=a+2,l=0,u=0,f=0,b=0,v=0,w=0;for(1&o?f=b=v=32:l=u=w=32;(o>>=1)>1;){const E=l+f>>1,A=u+b>>1;1&o?(f=l,b=u,l=v,u=w):(l=f,u=b,f=v,b=w),v=E,w=A}const T=4*a;Jc[T+0]=l,Jc[T+1]=u,Jc[T+2]=f,Jc[T+3]=b}const eu=new Uint16Array(2178),$u=new Uint8Array(1089),my=new Uint16Array(1089);function gy(a){return 0===a?-.03125:32===a?.03125:0}var by=He([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const ix={type:2,extent:Pn,loadGeometry:()=>[[new Ie(0,0),new Ie(8193,0),new Ie(8193,8193),new Ie(0,8193),new Ie(0,0)]]};class qf{constructor(o,l,u,f,b){this.tileID=o,this.uid=Zt(),this.uses=0,this.tileSize=l,this.tileZoom=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=b,this.expiredRequestCount=0,this.state="loading",f&&f.transform&&(this.projection=f.transform.projection)}registerFadeDuration(o){const l=o+this.timeAdded;l<va.now()||this.fadeEndTime&&l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=Xd(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(o,l,u){if(this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=function(f,b){const v={};if(!b)return v;for(const w of f){const T=w.layerIds.map(E=>b.getLayer(E)).filter(Boolean);if(0!==T.length){w.layers=T,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map(E=>T.filter(A=>A.id===E)[0]));for(const E of T)v[E.id]=w}}return v}(o.buckets,l.style),this.hasSymbolBuckets=!1;for(const f in this.buckets){const b=this.buckets[f];if(b instanceof Hu){if(this.hasSymbolBuckets=!0,!u)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const f in this.buckets){const b=this.buckets[f];if(b instanceof Hu&&b.hasRTLText){this.hasRTLText=!0,I.isLoading()||I.isLoaded()||"deferred"!==S()||D();break}}this.queryPadding=0;for(const f in this.buckets){const b=this.buckets[f];this.queryPadding=Math.max(this.queryPadding,l.style.getLayer(f).queryRadius(b))}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage),o.lineAtlas&&(this.lineAtlas=o.lineAtlas)}else this.collisionBoxArray=new or}unloadVectorData(){if(this.hasData()){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(o){return this.buckets[o.id]}upload(o){for(const u in this.buckets){const f=this.buckets[u];f.uploadPending()&&f.upload(o)}const l=o.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Yd(o,this.imageAtlas.image,l.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Yd(o,this.glyphAtlasImage,l.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Yd(o,this.lineAtlas.image,l.ALPHA),this.lineAtlas.uploaded=!0)}prepare(o){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture)}queryRenderedFeatures(o,l,u,f,b,v,w,T){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:f,pixelPosMatrix:w,transform:v,params:b,tileTransform:this.tileTransform},o,l,u):{}}querySourceFeatures(o,l){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const f=u.loadVTLayers(),b=l?l.sourceLayer:"",v=f._geojsonTileLayer||f[b];if(!v)return;const w=Vh(l&&l.filter),{z:T,x:E,y:A}=this.tileID.canonical,P={z:T,x:E,y:A};for(let L=0;L<v.length;L++){const N=v.feature(L);if(w.needGeometry){const K=Lu(N,!0);if(!w.filter(new R(this.tileID.overscaledZ),K,this.tileID.canonical))continue}else if(!w.filter(new R(this.tileID.overscaledZ),N))continue;const B=u.getId(N,b),$=new nx(N,T,E,A,B);$.tile=P,o.push($)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(o){const l=this.expirationTime;if(o.cacheControl){const u=he(o.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const u=Date.now();let f=!1;if(this.expirationTime>u)f=!1;else if(l)if(this.expirationTime<l)f=!0;else{const b=this.expirationTime-l;b?this.expirationTime=u+Math.max(b,3e4):f=!0}else f=!0;f?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(o,l){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(o).length||!l)return;const u=this.latestFeatureIndex.loadVTLayers(),f=l.style.listImages();for(const b in this.buckets){if(!l.style.hasLayer(b))continue;const v=this.buckets[b],w=v.layers[0].sourceLayer||"_geojsonTileLayer",T=u[w],E=o[w];if(!T||!E||0===Object.keys(E).length)continue;if(v.update(E,T,f,this.imageAtlas&&this.imageAtlas.patternPositions||{}),v instanceof q_||v instanceof uc){const P=l.style._getSourceCache(v.layers[0].source);l._terrain&&l._terrain.enabled&&P&&v.programConfigurations.needsUpload&&l._terrain._clearRenderCacheForTile(P.id,this.tileID)}const A=l&&l.style&&l.style.getLayer(b);A&&(this.queryPadding=Math.max(this.queryPadding,A.queryRadius(v)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<va.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=va.now()+o}setTexture(o,l){const u=l.context,f=u.gl;this.texture=this.texture||l.getTileTexture(o.width),this.texture?this.texture.update(o,{useMipmap:!0}):(this.texture=new Yd(u,o,f.RGBA,{useMipmap:!0}),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE))}setDependencies(o,l){const u={};for(const f of l)u[f]=!0;this.dependencies[o]=u}hasDependency(o,l){for(const u of o){const f=this.dependencies[u];if(f)for(const b of l)if(f[b])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(o,l){if(!l||"mercator"===l.name||this._tileDebugBuffer)return;const u=qc(ix,this.tileID.canonical,this.tileTransform)[0],f=new Ft,b=new Ns;for(let v=0;v<u.length;v++){const{x:w,y:T}=u[v];f.emplaceBack(w,T),b.emplaceBack(v)}b.emplaceBack(0),this._tileDebugIndexBuffer=o.createIndexBuffer(b),this._tileDebugBuffer=o.createVertexBuffer(f,Sf.members),this._tileDebugSegments=Hr.simpleSegment(0,0,f.length,b.length)}_makeTileBoundsBuffers(o,l){if(this._tileBoundsBuffer||!l||"mercator"===l.name)return;const u=qc(ix,this.tileID.canonical,this.tileTransform)[0];let f,b;if(this.isRaster){const v=function(w,T){const E=Xd(w,T),A=Math.pow(2,w.z);for(let K=0;K<33;K++)for(let ce=0;ce<33;ce++){const Ce=La((w.x+(ce+gy(ce))/32)/A),ue=vr((w.y+(K+gy(K))/32)/A),ve=T.project(Ce,ue),Ae=33*K+ce;eu[2*Ae+0]=Math.round((ve.x*E.scale-E.x)*Pn),eu[2*Ae+1]=Math.round((ve.y*E.scale-E.y)*Pn)}$u.fill(0),my.fill(0);for(let K=2045;K>=0;K--){const ce=4*K,Ce=Jc[ce+0],ue=Jc[ce+1],ve=Jc[ce+2],Ae=Jc[ce+3],ke=Ce+ve>>1,at=ue+Ae>>1,rt=ke+at-ue,_t=at+Ce-ke,zt=33*ue+Ce,ht=33*Ae+ve,Dt=33*at+ke,Ct=Math.hypot((eu[2*zt+0]+eu[2*ht+0])/2-eu[2*Dt+0],(eu[2*zt+1]+eu[2*ht+1])/2-eu[2*Dt+1])>=16;$u[Dt]=$u[Dt]||(Ct?1:0),K<1022&&($u[Dt]=$u[Dt]||$u[33*(ue+_t>>1)+(Ce+rt>>1)]||$u[33*(Ae+_t>>1)+(ve+rt>>1)])}const P=new St,L=new En;let N=0;function B(K,ce){const Ce=33*ce+K;return 0===my[Ce]&&(P.emplaceBack(eu[2*Ce+0],eu[2*Ce+1],K*Pn/32,ce*Pn/32),my[Ce]=++N),my[Ce]-1}function $(K,ce,Ce,ue,ve,Ae){const ke=K+Ce>>1,at=ce+ue>>1;if(Math.abs(K-ve)+Math.abs(ce-Ae)>1&&$u[33*at+ke])$(ve,Ae,K,ce,ke,at),$(Ce,ue,ve,Ae,ke,at);else{const rt=B(K,ce),_t=B(Ce,ue),zt=B(ve,Ae);L.emplaceBack(rt,_t,zt)}}return $(0,0,32,32,32,0),$(32,32,0,0,0,32),{vertices:P,indices:L}}(this.tileID.canonical,l);f=v.vertices,b=v.indices}else{f=new St,b=new En;for(const{x:w,y:T}of u)f.emplaceBack(w,T,0,0);const v=V_(f.int16,void 0,4);for(let w=0;w<v.length;w+=3)b.emplaceBack(v[w],v[w+1],v[w+2])}this._tileBoundsBuffer=o.createVertexBuffer(f,by.members),this._tileBoundsIndexBuffer=o.createIndexBuffer(b),this._tileBoundsSegments=Hr.simpleSegment(0,0,f.length,b.length)}_makeGlobeTileDebugBuffers(o,l){const u=l.projection;if(!u||"globe"!==u.name||l.freezeTileCoverage)return;const f=this.tileID.canonical,b=If(n0(f,l)),v=Vd(l.zoom);let w;v>0&&(w=ff(new Float64Array(16),l.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(o,f,l,b,w,v),this._makeGlobeTileDebugTextBuffer(o,f,l,b,w,v)}_globePoint(o,l,u,f,b,v,w){let T=lg(o,l,u);if(v){const E=1<<u.z,A=lc(f.center.lng),P=Al(f.center.lat),L=(u.x+.5)/E-A;let N=0;L>.5?N=-1:L<-.5&&(N=1);let B=(o/Pn+u.x)/E+N,$=(l/Pn+u.y)/E;B=(B-A)*f._pixelsPerMercatorPixel+A,$=($-P)*f._pixelsPerMercatorPixel+P;const K=[B*f.worldSize,$*f.worldSize,0];ze(K,K,v),T=zd(T,K,w)}return ze(T,T,b)}_makeGlobeTileDebugBorderBuffer(o,l,u,f,b,v){const w=new Ft,T=new Ns,E=new nt,A=(L,N,B,$,K)=>{const ce=(B-L)/(K-1),Ce=($-N)/(K-1),ue=w.length;for(let ve=0;ve<K;ve++){const Ae=L+ve*ce,ke=N+ve*Ce;w.emplaceBack(Ae,ke);const at=this._globePoint(Ae,ke,l,u,f,b,v);E.emplaceBack(at[0],at[1],at[2]),T.emplaceBack(ue+ve)}},P=Pn;A(0,0,P,0,16),A(P,0,P,P,16),A(P,P,0,P,16),A(0,P,0,0,16),this._tileDebugIndexBuffer=o.createIndexBuffer(T),this._tileDebugBuffer=o.createVertexBuffer(w,Sf.members),this._globeTileDebugBorderBuffer=o.createVertexBuffer(E,x_.members),this._tileDebugSegments=Hr.simpleSegment(0,0,w.length,T.length)}_makeGlobeTileDebugTextBuffer(o,l,u,f,b,v){const T=new Ft,E=new En,A=new nt,P=25;E.reserve(32),T.reserve(P),A.reserve(P);const L=(N,B)=>P*N+B;for(let N=0;N<P;N++){const B=2048*N;for(let $=0;$<P;$++){const K=2048*$;T.emplaceBack(K,B);const ce=this._globePoint(K,B,l,u,f,b,v);A.emplaceBack(ce[0],ce[1],ce[2])}}for(let N=0;N<4;N++)for(let B=0;B<4;B++){const $=L(N,B),K=L(N,B+1),ce=L(N+1,B),Ce=L(N+1,B+1);E.emplaceBack($,K,ce),E.emplaceBack(ce,K,Ce)}this._tileDebugTextIndexBuffer=o.createIndexBuffer(E),this._tileDebugTextBuffer=o.createVertexBuffer(T,Sf.members),this._globeTileDebugTextBuffer=o.createVertexBuffer(A,x_.members),this._tileDebugTextSegments=Hr.simpleSegment(0,0,P,32)}}class zI{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,l,u){const f=String(l);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][f]=this.stateChanges[o][f]||{},Li(this.stateChanges[o][f],u),null===this.deletedStates[o]){this.deletedStates[o]={};for(const b in this.state[o])b!==f&&(this.deletedStates[o][b]=null)}else if(this.deletedStates[o]&&null===this.deletedStates[o][f]){this.deletedStates[o][f]={};for(const b in this.state[o][f])u[b]||(this.deletedStates[o][f][b]=null)}else for(const b in u)this.deletedStates[o]&&this.deletedStates[o][f]&&null===this.deletedStates[o][f][b]&&delete this.deletedStates[o][f][b]}removeFeatureState(o,l,u){if(null===this.deletedStates[o])return;const f=String(l);if(this.deletedStates[o]=this.deletedStates[o]||{},u&&void 0!==l)null!==this.deletedStates[o][f]&&(this.deletedStates[o][f]=this.deletedStates[o][f]||{},this.deletedStates[o][f][u]=null);else if(void 0!==l)if(this.stateChanges[o]&&this.stateChanges[o][f])for(u in this.deletedStates[o][f]={},this.stateChanges[o][f])this.deletedStates[o][f][u]=null;else this.deletedStates[o][f]=null;else this.deletedStates[o]=null}getState(o,l){const u=String(l),f=Li({},(this.state[o]||{})[u],(this.stateChanges[o]||{})[u]);if(null===this.deletedStates[o])return{};if(this.deletedStates[o]){const b=this.deletedStates[o][l];if(null===b)return{};for(const v in b)delete f[v]}return f}initializeTileState(o,l){o.setFeatureState(this.state,l)}coalesceChanges(o,l){const u={};for(const f in this.stateChanges){this.state[f]=this.state[f]||{};const b={};for(const v in this.stateChanges[f])this.state[f][v]||(this.state[f][v]={}),Li(this.state[f][v],this.stateChanges[f][v]),b[v]=this.state[f][v];u[f]=b}for(const f in this.deletedStates){this.state[f]=this.state[f]||{};const b={};if(null===this.deletedStates[f])for(const v in this.state[f])b[v]={},this.state[f][v]={};else for(const v in this.deletedStates[f]){if(null===this.deletedStates[f][v])this.state[f][v]={};else if(this.state[f][v])for(const w of Object.keys(this.deletedStates[f][v]))delete this.state[f][v][w];b[v]=this.state[f][v]}u[f]=u[f]||{},Li(u[f],b)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(u).length)for(const f in o)o[f].setFeatureState(u,l)}}class eC{constructor(o){this.size=o,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(o,l){const u=this.toIdx(o,l);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(o,l){return this.leaves[this.toIdx(o,l)]}toIdx(o,l){return l*this.size+o}}function tC(a,o,l,u){let f=0,b=Number.MAX_VALUE;for(let v=0;v<3;v++)if(Math.abs(u[v])<1e-15){if(l[v]<a[v]||l[v]>o[v])return null}else{const w=1/u[v];let T=(a[v]-l[v])*w,E=(o[v]-l[v])*w;if(T>E){const A=T;T=E,E=A}if(T>f&&(f=T),E<b&&(b=E),f>b)return null}return f}function nC(a,o,l,u,f,b,v,w,T,E,A){const P=u-a,L=f-o,N=b-l,B=v-a,$=w-o,K=T-l,ce=A[1]*K-A[2]*$,Ce=A[2]*B-A[0]*K,ue=A[0]*$-A[1]*B,ve=P*ce+L*Ce+N*ue;if(Math.abs(ve)<1e-15)return null;const Ae=1/ve,ke=E[0]-a,at=E[1]-o,rt=E[2]-l,_t=(ke*ce+at*Ce+rt*ue)*Ae;if(_t<0||_t>1)return null;const zt=at*N-rt*L,ht=rt*P-ke*N,Dt=ke*L-at*P,Ct=(A[0]*zt+A[1]*ht+A[2]*Dt)*Ae;return Ct<0||_t+Ct>1?null:(B*zt+$*ht+K*Dt)*Ae}function iC(a,o,l){return(a-o)/(l-o)}function rC(a,o,l,u,f,b,v,w,T){const E=1<<l,A=b-u,P=v-f,L=(a+1)/E*A+u,N=(o+0)/E*P+f,B=(o+1)/E*P+f;w[0]=(a+0)/E*A+u,w[1]=N,T[0]=L,T[1]=B}class oC{constructor(o){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=o,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const l=function(b){const v=Math.ceil(Math.log2(b.dim/8)),w=[];let T=Math.ceil(Math.pow(2,v));const E=1/T,A=(N,B,$,K,ce)=>{const Ce=K?1:0,ue=(N+1)*$-Ce,ve=B*$,Ae=(B+1)*$-Ce;ce[0]=N*$,ce[1]=ve,ce[2]=ue,ce[3]=Ae};let P=new eC(T);const L=[];for(let N=0;N<T*T;N++){A(N%T,Math.floor(N/T),E,!1,L);const B=Kd(L[0],L[1],b),$=Kd(L[2],L[1],b),K=Kd(L[2],L[3],b),ce=Kd(L[0],L[3],b);P.minimums.push(Math.min(B,$,K,ce)),P.maximums.push(Math.max(B,$,K,ce)),P.leaves.push(1)}for(w.push(P),T/=2;T>=1;T/=2){const N=w[w.length-1];P=new eC(T);for(let B=0;B<T*T;B++){A(B%T,Math.floor(B/T),2,!0,L);const $=N.getElevation(L[0],L[1]),K=N.getElevation(L[2],L[1]),ce=N.getElevation(L[2],L[3]),Ce=N.getElevation(L[0],L[3]),ue=N.isLeaf(L[0],L[1]),ve=N.isLeaf(L[2],L[1]),Ae=N.isLeaf(L[2],L[3]),ke=N.isLeaf(L[0],L[3]),at=Math.min($.min,K.min,ce.min,Ce.min),rt=Math.max($.max,K.max,ce.max,Ce.max),_t=ue&&ve&&Ae&&ke;P.maximums.push(rt),P.minimums.push(at),P.leaves.push(rt-at<=5&&_t?1:0)}w.push(P)}return w}(this.dem),u=l.length-1,f=l[u];this._addNode(f.minimums[0],f.maximums[0],f.leaves[0]),this._construct(l,0,0,u,0)}raycastRoot(o,l,u,f,b,v,w=1){return tC([o,l,-100],[u,f,this.maximums[0]*w],b,v)}raycast(o,l,u,f,b,v,w=1){if(!this.nodeCount)return null;const T=this.raycastRoot(o,l,u,f,b,v,w);if(null==T)return null;const E=[],A=[],P=[],L=[],N=[{idx:0,t:T,nodex:0,nodey:0,depth:0}];for(;N.length>0;){const{idx:B,t:$,nodex:K,nodey:ce,depth:Ce}=N.pop();if(this.leaves[B]){rC(K,ce,Ce,o,l,u,f,P,L);const ve=1<<Ce,Ae=(K+0)/ve,ke=(K+1)/ve,at=(ce+0)/ve,rt=(ce+1)/ve,_t=Kd(Ae,at,this.dem)*w,zt=Kd(ke,at,this.dem)*w,ht=Kd(ke,rt,this.dem)*w,Dt=Kd(Ae,rt,this.dem)*w,Ct=nC(P[0],P[1],_t,L[0],P[1],zt,L[0],L[1],ht,b,v),Rt=nC(L[0],L[1],ht,P[0],L[1],Dt,P[0],P[1],_t,b,v),Gt=Math.min(null!==Ct?Ct:Number.MAX_VALUE,null!==Rt?Rt:Number.MAX_VALUE);if(Gt!==Number.MAX_VALUE)return Gt;{const ft=Yh([],b,v,$);if(sC(_t,zt,Dt,ht,iC(ft[0],P[0],L[0]),iC(ft[1],P[1],L[1]))>=ft[2])return $}continue}let ue=0;for(let ve=0;ve<this._siblingOffset.length;ve++){rC((K<<1)+this._siblingOffset[ve][0],(ce<<1)+this._siblingOffset[ve][1],Ce+1,o,l,u,f,P,L),P[2]=-100,L[2]=this.maximums[this.childOffsets[B]+ve]*w;const Ae=tC(P,L,b,v);if(null!=Ae){const ke=Ae;E[ve]=ke;let at=!1;for(let rt=0;rt<ue&&!at;rt++)ke>=E[A[rt]]&&(A.splice(rt,0,ve),at=!0);at||(A[ue]=ve),ue++}}for(let ve=0;ve<ue;ve++){const Ae=A[ve];N.push({idx:this.childOffsets[B]+Ae,t:E[Ae],nodex:(K<<1)+this._siblingOffset[Ae][0],nodey:(ce<<1)+this._siblingOffset[Ae][1],depth:Ce+1})}}return null}_addNode(o,l,u){return this.minimums.push(o),this.maximums.push(l),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(o,l,u,f,b){if(1===o[f].isLeaf(l,u))return;this.childOffsets[b]||(this.childOffsets[b]=this.nodeCount);const v=f-1,w=o[v];let T=0,E=0;for(let A=0;A<this._siblingOffset.length;A++){const P=2*l+this._siblingOffset[A][0],L=2*u+this._siblingOffset[A][1],N=w.getElevation(P,L),B=w.isLeaf(P,L),$=this._addNode(N.min,N.max,B);B&&(T|=1<<A),E||(E=$)}for(let A=0;A<this._siblingOffset.length;A++)T&1<<A||this._construct(o,2*l+this._siblingOffset[A][0],2*u+this._siblingOffset[A][1],v,E+A)}}function sC(a,o,l,u,f,b){return Bi(Bi(a,l,b),Bi(o,u,b),f)}function Kd(a,o,l){const u=l.dim,f=Tt(a*u-.5,0,u-1),b=Tt(o*u-.5,0,u-1),v=Math.floor(f),w=Math.floor(b),T=Math.min(v+1,u-1),E=Math.min(w+1,u-1);return sC(l.get(v,w),l.get(T,w),l.get(v,E),l.get(T,E),f-v,b-w)}const aC={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function Gu(a,o,l){return(256*a*256+256*o+l)/10-1e4}function _y(a,o,l){return 256*a+o+l/256-32768}class ob{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(o,l,u,f=!1,b=!1){if(this.uid=o,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(u&&"mapbox"!==u&&"terrarium"!==u)return Qn(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=l.height;const v=this.dim=l.height-2,w=new Uint32Array(l.data.buffer);if(this.pixels=new Uint8Array(l.data.buffer),this.encoding=u||"mapbox",this.borderReady=f,!f){for(let T=0;T<v;T++)w[this._idx(-1,T)]=w[this._idx(0,T)],w[this._idx(v,T)]=w[this._idx(v-1,T)],w[this._idx(T,-1)]=w[this._idx(T,0)],w[this._idx(T,v)]=w[this._idx(T,v-1)];w[this._idx(-1,-1)]=w[this._idx(0,0)],w[this._idx(v,-1)]=w[this._idx(v-1,0)],w[this._idx(-1,v)]=w[this._idx(0,v-1)],w[this._idx(v,v)]=w[this._idx(v-1,v-1)],b&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new oC(this)}get(o,l,u=!1){u&&(o=Tt(o,-1,this.dim),l=Tt(l,-1,this.dim));const f=4*this._idx(o,l);return("terrarium"===this.encoding?_y:Gu)(this.pixels[f],this.pixels[f+1],this.pixels[f+2])}static getUnpackVector(o){return aC[o]}get unpackVector(){return aC[this.encoding]}_idx(o,l){if(o<-1||o>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(o+1)}static pack(o,l){const u=[0,0,0,0],f=ob.getUnpackVector(l);let b=Math.floor((o+f[3])/f[2]);return u[2]=b%256,b=Math.floor(b/256),u[1]=b%256,b=Math.floor(b/256),u[0]=b,u}getPixels(){return new Qs({width:this.stride,height:this.stride},this.pixels)}backfillBorder(o,l,u){if(this.dim!==o.dim)throw new Error("dem dimension mismatch");let f=l*this.dim,b=l*this.dim+this.dim,v=u*this.dim,w=u*this.dim+this.dim;switch(l){case-1:f=b-1;break;case 1:b=f+1}switch(u){case-1:v=w-1;break;case 1:w=v+1}const T=-l*this.dim,E=-u*this.dim;for(let A=v;A<w;A++)for(let P=f;P<b;P++){const L=4*this._idx(P,A),N=4*this._idx(P+T,A+E);this.pixels[L+0]=o.pixels[N+0],this.pixels[L+1]=o.pixels[N+1],this.pixels[L+2]=o.pixels[N+2],this.pixels[L+3]=o.pixels[N+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}gn(ob,"DEMData"),gn(oC,"DemMinMaxQuadTree",{omit:["dem"]});class rx{constructor(o,l){this.max=o,this.onRemove=l,this.reset()}reset(){for(const o in this.data)for(const l of this.data[o])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(o,l,u){const f=o.wrapped().key;void 0===this.data[f]&&(this.data[f]=[]);const b={value:l,timeout:void 0};if(void 0!==u&&(b.timeout=setTimeout(()=>{this.remove(o,b)},u)),this.data[f].push(b),this.order.push(f),this.order.length>this.max){const v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const l=this.data[o].shift();return l.timeout&&clearTimeout(l.timeout),0===this.data[o].length&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),l.value}getByKey(o){const l=this.data[o];return l?l[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,l){if(!this.has(o))return this;const u=o.wrapped().key,f=void 0===l?0:this.data[u].indexOf(l),b=this.data[u][f];return this.data[u].splice(f,1),b.timeout&&clearTimeout(b.timeout),0===this.data[u].length&&delete this.data[u],this.onRemove(b.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(o){const l=[];for(const u in this.data)for(const f of this.data[u])o(f.value)||l.push(f);for(const u of l)this.remove(u.value.tileID,u)}}class qu{constructor(o,l,u){this.func=o,this.mask=l,this.range=u}}qu.ReadOnly=!1,qu.ReadWrite=!0,qu.disabled=new qu(519,qu.ReadOnly,[0,1]);class Wf{constructor(o,l,u,f,b,v){this.test=o,this.ref=l,this.mask=u,this.fail=f,this.depthFail=b,this.pass=v}}Wf.disabled=new Wf({func:519,mask:0},0,0,7680,7680,7680);class bc{constructor(o,l,u){this.blendFunction=o,this.blendColor=l,this.mask=u}}bc.Replace=[1,0],bc.disabled=new bc(bc.Replace,uo.transparent,[!1,!1,!1,!1]),bc.unblended=new bc(bc.Replace,uo.transparent,[!0,!0,!0,!0]),bc.alphaBlended=new bc([1,771],uo.transparent,[!0,!0,!0,!0]);class Ol{constructor(o,l,u){this.enable=o,this.mode=l,this.frontFace=u}}Ol.disabled=new Ol(!1,1029,2305),Ol.backCCW=new Ol(!0,1029,2305),Ol.backCW=new Ol(!0,1029,2304),Ol.frontCW=new Ol(!0,1028,2304),Ol.frontCCW=new Ol(!0,1028,2305);class Qd extends pu{constructor(o,l,u){super(),this.id=o,this._onlySymbols=u,l.on("data",f=>{"source"===f.dataType&&"metadata"===f.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===f.dataType&&"content"===f.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),l.on("error",()=>{this._sourceErrored=!0}),this._source=l,this._tiles={},this._cache=new rx(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new zI,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(o){this.map=o,this._minTileCacheSize=void 0===this._minTileCacheSize&&o?o._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&o?o._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const o in this._tiles){const l=this._tiles[o];if("loaded"!==l.state&&"errored"!==l.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(o,l){return o.isSymbolTile=this._onlySymbols,this._source.loadTile(o,l)}_unloadTile(o){if(this._source.unloadTile)return this._source.unloadTile(o,()=>{})}_abortTile(o){if(this._source.abortTile)return this._source.abortTile(o,()=>{})}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const l in this._tiles){const u=this._tiles[l];u.upload(o),u.prepare(this.map.style.imageManager)}}getIds(){return Hi(this._tiles).map(o=>o.tileID).sort(yy).map(o=>o.key)}getRenderableIds(o){const l=[];for(const u in this._tiles)this._isIdRenderable(+u,o)&&l.push(this._tiles[u]);return o?l.sort((u,f)=>{const b=u.tileID,v=f.tileID,w=new Ie(b.canonical.x,b.canonical.y)._rotate(this.transform.angle),T=new Ie(v.canonical.x,v.canonical.y)._rotate(this.transform.angle);return b.overscaledZ-v.overscaledZ||T.y-w.y||T.x-w.x}).map(u=>u.tileID.key):l.map(u=>u.tileID).sort(yy).map(u=>u.key)}hasRenderableParent(o){const l=this.findLoadedParent(o,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(o,l){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(l||!this._tiles[o].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)"errored"!==this._tiles[o].state&&this._reloadTile(+o,"reloading")}}_reloadTile(o,l){const u=this._tiles[o];u&&("loading"!==u.state&&(u.state=l),this._loadTile(u,this._tileLoaded.bind(this,u,o,l)))}_tileLoaded(o,l,u,f){if(f)if(o.state="errored",404!==f.status)this._source.fire(new Za(f,{tile:o}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const b=this.map.painter.terrain;this.update(this.transform,b.getScaledDemTileSize(),!0),b.resetTileLookupCache(this.id)}else this.update(this.transform);else o.timeAdded=va.now(),"expired"===u&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(l,o),"raster-dem"===this._source.type&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),this._source.fire(new Rc("data",{dataType:"source",tile:o,coord:o.tileID,sourceCacheId:this.id}))}_backfillDEM(o){const l=this.getRenderableIds();for(let f=0;f<l.length;f++){const b=l[f];if(o.neighboringTiles&&o.neighboringTiles[b]){const v=this.getTileByID(b);u(o,v),u(v,o)}}function u(f,b){if(!f.dem||f.dem.borderReady)return;f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0;let v=b.tileID.canonical.x-f.tileID.canonical.x;const w=b.tileID.canonical.y-f.tileID.canonical.y,T=Math.pow(2,f.tileID.canonical.z),E=b.tileID.key;0===v&&0===w||Math.abs(w)>1||(Math.abs(v)>1&&(1===Math.abs(v+T)?v+=T:1===Math.abs(v-T)&&(v-=T)),b.dem&&f.dem&&(f.dem.backfillBorder(b.dem,v,w),f.neighboringTiles&&f.neighboringTiles[E]&&(f.neighboringTiles[E].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,l,u,f){for(const b in this._tiles){let v=this._tiles[b];if(f[b]||!v.hasData()||v.tileID.overscaledZ<=l||v.tileID.overscaledZ>u)continue;let w=v.tileID;for(;v&&v.tileID.overscaledZ>l+1;){const E=v.tileID.scaledTo(v.tileID.overscaledZ-1);v=this._tiles[E.key],v&&v.hasData()&&(w=E)}let T=w;for(;T.overscaledZ>l;)if(T=T.scaledTo(T.overscaledZ-1),o[T.key]){f[w.key]=w;break}}}findLoadedParent(o,l){if(o.key in this._loadedParentTiles){const u=this._loadedParentTiles[o.key];return u&&u.tileID.overscaledZ>=l?u:null}for(let u=o.overscaledZ-1;u>=l;u--){const f=o.scaledTo(u),b=this._getLoadedTile(f);if(b)return b}}_getLoadedTile(o){const l=this._tiles[o.key];return l&&l.hasData()?l:this._cache.getByKey(this._source.reparseOverscaled?o.wrapped().key:o.canonical.key)}updateCacheSize(o,l){l=l||this._source.tileSize;const u=Math.ceil(o.width/l)+1,f=Math.ceil(o.height/l)+1,b=Math.floor(u*f*5),v="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,b):b,w="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,v):v;this._cache.setMaxSize(w)}handleWrapJump(o){const l=Math.round((o-(void 0===this._prevLng?o:this._prevLng))/360);if(this._prevLng=o,l){const u={};for(const f in this._tiles){const b=this._tiles[f];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+l),u[b.tileID.key]=b}this._tiles=u;for(const f in this._timers)clearTimeout(this._timers[f]),delete this._timers[f];for(const f in this._tiles)this._setTileReloadTimer(+f,this._tiles[f])}}update(o,l,u){if(this.transform=o,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!u)return;let f;this.updateCacheSize(o,l),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?f=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(w=>new zs(w.canonical.z,w.wrap,w.canonical.z,w.canonical.x,w.canonical.y)):(f=o.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(f=f.filter(w=>this._source.hasTile(w)))):f=[];const b=this._updateRetainedTiles(f);if(ox(this._source.type)&&0!==f.length){const w={},T={},E=Object.keys(b);for(const P of E){const L=b[P],N=this._tiles[P];if(!N||N.fadeEndTime&&N.fadeEndTime<=va.now())continue;const B=this.findLoadedParent(L,Math.max(L.overscaledZ-Qd.maxOverzooming,this._source.minzoom));B&&(this._addTile(B.tileID),w[B.tileID.key]=B.tileID),T[P]=L}const A=f[f.length-1].overscaledZ;for(const P in this._tiles){const L=this._tiles[P];if(b[P]||!L.hasData())continue;let N=L.tileID;for(;N.overscaledZ>A;){N=N.scaledTo(N.overscaledZ-1);const B=this._tiles[N.key];if(B&&B.hasData()&&T[N.key]){b[P]=L.tileID;break}}}for(const P in w)b[P]||(this._coveredTiles[P]=!0,b[P]=w[P])}for(const w in b)this._tiles[w].clearFadeHold();const v=function(w,T){const E=[];for(const A in w)A in T||E.push(A);return E}(this._tiles,b);for(const w of v){const T=this._tiles[w];T.hasSymbolBuckets&&!T.holdingForFade()?T.setHoldDuration(this.map._fadeDuration):T.hasSymbolBuckets&&!T.symbolFadeFinished()||this._removeTile(+w)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(+o)}_updateRetainedTiles(o){const l={};if(0===o.length)return l;const u={},f=o.reduce((E,A)=>Math.min(E,A.overscaledZ),1/0),b=o[0].overscaledZ,v=Math.max(b-Qd.maxOverzooming,this._source.minzoom),w=Math.max(b+Qd.maxUnderzooming,this._source.minzoom),T={};for(const E of o){const A=this._addTile(E);l[E.key]=E,A.hasData()||f<this._source.maxzoom&&(T[E.key]=E)}this._retainLoadedChildren(T,f,w,l);for(const E of o){let A=this._tiles[E.key];if(A.hasData())continue;if(E.canonical.z>=this._source.maxzoom){const L=E.children(this._source.maxzoom)[0],N=this.getTile(L);if(N&&N.hasData()){l[L.key]=L;continue}}else{const L=E.children(this._source.maxzoom);if(l[L[0].key]&&l[L[1].key]&&l[L[2].key]&&l[L[3].key])continue}let P=A.wasRequested();for(let L=E.overscaledZ-1;L>=v;--L){const N=E.scaledTo(L);if(u[N.key]||(u[N.key]=!0,A=this.getTile(N),!A&&P&&(A=this._addTile(N)),A&&(l[N.key]=N,P=A.wasRequested(),A.hasData())))break}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const l=[];let u,f=this._tiles[o].tileID;for(;f.overscaledZ>0;){if(f.key in this._loadedParentTiles){u=this._loadedParentTiles[f.key];break}l.push(f.key);const b=f.scaledTo(f.overscaledZ-1);if(u=this._getLoadedTile(b),u)break;f=b}for(const b of l)this._loadedParentTiles[b]=u}}_addTile(o){let l=this._tiles[o.key];if(l)return l;l=this._cache.getAndRemove(o),l&&(this._setTileReloadTimer(o.key,l),l.tileID=o,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,l)));const u=Boolean(l);if(!u){const f=this.map?this.map.painter:null;l=new qf(o,this._source.tileSize*o.overscaleFactor(),this.transform.tileZoom,f,this._isRaster),this._loadTile(l,this._tileLoaded.bind(this,l,o.key,l.state))}return l?(l.uses++,this._tiles[o.key]=l,u||this._source.fire(new Rc("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l):null}_setTileReloadTimer(o,l){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const u=l.getExpiryTimeout();u&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},u))}_removeTile(o){const l=this._tiles[o];l&&(l.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),l.uses>0||(l.hasData()&&"reloading"!==l.state?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(+o);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(o,l,u){const f=[],b=this.transform;if(!b)return f;const v="globe"===b.projection.name,w=lc(b.center.lng);for(const T in this._tiles){const E=this._tiles[T];if(u&&E.clearQueryDebugViz(),E.holdingForFade())continue;let A;if(v){const P=E.tileID.canonical;if(0===P.z){const L=[Math.abs(Tt(w,...Xf(P,-1))-w),Math.abs(Tt(w,...Xf(P,1))-w)];A=[0,2*L.indexOf(Math.min(...L))-1]}else{const L=[Math.abs(Tt(w,...Xf(P,-1))-w),Math.abs(Tt(w,...Xf(P,0))-w),Math.abs(Tt(w,...Xf(P,1))-w)];A=[L.indexOf(Math.min(...L))-1]}}else A=[0];for(const P of A){const L=o.containsTile(E,b,l,P);L&&f.push(L)}}return f}getVisibleCoordinates(o){const l=this.getRenderableIds(o).map(u=>this._tiles[u].tileID);for(const u of l)u.projMatrix=this.transform.calculateProjMatrix(u.toUnwrapped());return l}hasTransition(){if(this._source.hasTransition())return!0;if(ox(this._source.type))for(const o in this._tiles){const l=this._tiles[o];if(void 0!==l.fadeEndTime&&l.fadeEndTime>=va.now())return!0}return!1}setFeatureState(o,l,u){this._state.updateState(o=o||"_geojsonTileLayer",l,u)}removeFeatureState(o,l,u){this._state.removeFeatureState(o=o||"_geojsonTileLayer",l,u)}getFeatureState(o,l){return this._state.getState(o=o||"_geojsonTileLayer",l)}setDependencies(o,l,u){const f=this._tiles[o];f&&f.setDependencies(l,u)}reloadTilesForDependencies(o,l){for(const u in this._tiles)this._tiles[u].hasDependency(o,l)&&this._reloadTile(+u,"reloading");this._cache.filter(u=>!u.hasDependency(o,l))}_preloadTiles(o,l){if(!this._sourceLoaded){const w=()=>{this._sourceLoaded&&(this._source.off("data",w),this._preloadTiles(o,l))};return void this._source.on("data",w)}const u=new Map,f=Array.isArray(o)?o:[o],b=this.map.painter.terrain,v=this.usedForTerrain&&b?b.getScaledDemTileSize():this._source.tileSize;for(const w of f){const T=w.coveringTiles({tileSize:v,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const E of T)u.set(E.key,E);this.usedForTerrain&&w.updateElevation(!1)}cn(Array.from(u.values()),(w,T)=>{const E=new qf(w,this._source.tileSize*w.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(E,A=>{"raster-dem"===this._source.type&&E.dem&&this._backfillDEM(E),T(A,E)})},l)}}function yy(a,o){const l=Math.abs(2*a.wrap)-+(a.wrap<0),u=Math.abs(2*o.wrap)-+(o.wrap<0);return a.overscaledZ-o.overscaledZ||u-l||o.canonical.y-a.canonical.y||o.canonical.x-a.canonical.x}function ox(a){return"raster"===a||"image"===a||"video"===a||"custom"===a}function Xf(a,o){const l=1<<a.z;return[a.x/l+o,(a.x+1)/l+o]}Qd.maxOverzooming=10,Qd.maxUnderzooming=3;class Jd{constructor(o,l,u){this._demTile=o,this._dem=this._demTile.dem,this._scale=l,this._offset=u}static create(o,l,u){const f=u||o.findDEMTileFor(l);if(!f||!f.dem)return;const b=f.dem,v=f.tileID,w=1<<l.canonical.z-v.canonical.z;return new Jd(f,f.tileSize/Pn/w,[(l.canonical.x/w-v.canonical.x)*b.dim,(l.canonical.y/w-v.canonical.y)*b.dim])}tileCoordToPixel(o,l){const u=l*this._scale+this._offset[1],f=Math.floor(o*this._scale+this._offset[0]),b=Math.floor(u);return new Ie(f,b)}getElevationAt(o,l,u,f){const b=o*this._scale+this._offset[0],v=l*this._scale+this._offset[1],w=Math.floor(b),T=Math.floor(v),E=this._dem;return f=!!f,u?Bi(Bi(E.get(w,T,f),E.get(w,T+1,f),v-T),Bi(E.get(w+1,T,f),E.get(w+1,T+1,f),v-T),b-w):E.get(w,T,f)}getElevationAtPixel(o,l,u){return this._dem.get(o,l,!!u)}getMeterToDEM(o){return(1<<this._demTile.tileID.canonical.z)*kl(1,o)*this._dem.stride}}class eh{constructor(o,l){this.tileID=o,this.x=o.canonical.x,this.y=o.canonical.y,this.z=o.canonical.z,this.grid=new Du(Pn,16,0),this.featureIndexArray=new Tl,this.promoteId=l}insert(o,l,u,f,b,v=0){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,f,b,v);const T=this.grid;for(let E=0;E<l.length;E++){const A=l[E],P=[1/0,1/0,-1/0,-1/0];for(let L=0;L<A.length;L++){const N=A[L];P[0]=Math.min(P[0],N.x),P[1]=Math.min(P[1],N.y),P[2]=Math.max(P[2],N.x),P[3]=Math.max(P[3],N.y)}P[0]<Pn&&P[1]<Pn&&P[2]>=0&&P[3]>=0&&T.insert(w,P[0],P[1],P[2],P[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new rp(new Vg(this.rawTileData)).layers,this.sourceLayerCoder=new Q1(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const o in this.vtLayers)this.vtFeatures[o]=[]}return this.vtLayers}query(o,l,u,f){this.loadVTLayers();const b=o.params||{},v=Vh(b.filter),w=o.tileResult,T=o.transform,E=w.bufferedTilespaceBounds,A=this.grid.query(E.min.x,E.min.y,E.max.x,E.max.y,(B,$,K,ce)=>e1(w.bufferedTilespaceGeometry,B,$,K,ce));A.sort(gp);let P=null;T.elevation&&A.length>0&&(P=Jd.create(T.elevation,this.tileID));const L={};let N;for(let B=0;B<A.length;B++){const $=A[B];if($===N)continue;N=$;const K=this.featureIndexArray.get($);let ce=null;this.loadMatchingFeature(L,K,v,b.layers,b.availableImages,l,u,f,(Ce,ue,ve,Ae=0)=>(ce||(ce=qc(Ce,this.tileID.canonical,o.tileTransform)),ue.queryIntersectsFeature(w,Ce,ve,ce,this.z,o.transform,o.pixelPosMatrix,P,Ae)))}return L}loadMatchingFeature(o,l,u,f,b,v,w,T,E){const{featureIndex:A,bucketIndex:P,sourceLayerIndex:L,layoutVertexArrayOffset:N}=l,B=this.bucketLayerIDs[P];if(f&&!function(Ce,ue){for(let ve=0;ve<Ce.length;ve++)if(ue.indexOf(Ce[ve])>=0)return!0;return!1}(f,B))return;const $=this.sourceLayerCoder.decode(L),K=this.vtLayers[$].feature(A);if(u.needGeometry){const Ce=Lu(K,!0);if(!u.filter(new R(this.tileID.overscaledZ),Ce,this.tileID.canonical))return}else if(!u.filter(new R(this.tileID.overscaledZ),K))return;const ce=this.getId(K,$);for(let Ce=0;Ce<B.length;Ce++){const ue=B[Ce];if(f&&f.indexOf(ue)<0)continue;const ve=v[ue];if(!ve)continue;let Ae={};void 0!==ce&&T&&(Ae=T.getState(ve.sourceLayer||"_geojsonTileLayer",ce));const ke=Li({},w[ue]);ke.paint=lb(ke.paint,ve.paint,K,Ae,b),ke.layout=lb(ke.layout,ve.layout,K,Ae,b);const at=!E||E(K,ve,Ae,N);if(!at)continue;const rt=new nx(K,this.z,this.x,this.y,ce);rt.layer=ke;let _t=o[ue];void 0===_t&&(_t=o[ue]=[]),_t.push({featureIndex:A,feature:rt,intersectionZ:at})}}lookupSymbolFeatures(o,l,u,f,b,v,w,T){const E={};this.loadVTLayers();const A=Vh(b);for(const P of o)this.loadMatchingFeature(E,{bucketIndex:u,sourceLayerIndex:f,featureIndex:P,layoutVertexArrayOffset:0},A,v,w,T,l);return E}loadFeature(o){const{featureIndex:l,sourceLayerIndex:u}=o;this.loadVTLayers();const f=this.sourceLayerCoder.decode(u),b=this.vtFeatures[f];if(b[l])return b[l];const v=this.vtLayers[f].feature(l);return b[l]=v,v}hasLayer(o){for(const l of this.bucketLayerIDs)for(const u of l)if(o===u)return!0;return!1}getId(o,l){let u=o.id;if(this.promoteId){const f="string"==typeof this.promoteId?this.promoteId:this.promoteId[l];null!=f&&(u=o.properties[f]),"boolean"==typeof u&&(u=Number(u))}return u}}function lb(a,o,l,u,f){return W(a,(b,v)=>{const w=o instanceof le?o.get(v):null;return w&&w.evaluate?w.evaluate(l,u,f):w})}function gp(a,o){return o-a}gn(eh,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class cb{constructor(o,l){this.width=o,this.height=l,this.nextRow=0,this.image=new Wc({width:o,height:l}),this.positions={},this.uploaded=!1}getDash(o,l){const u=this.getKey(o,l);return this.positions[u]}trim(){const o=this.width,l=this.height=go(this.nextRow);this.image.resize({width:o,height:l})}getKey(o,l){return o.join(",")+l}getDashRanges(o,l,u){const f=[];let b=o.length%2==1?-o[o.length-1]*u:0,v=o[0]*u,w=!0;f.push({left:b,right:v,isDash:w,zeroLength:0===o[0]});let T=o[0];for(let E=1;E<o.length;E++){w=!w;const A=o[E];b=T*u,T+=A,v=T*u,f.push({left:b,right:v,isDash:w,zeroLength:0===A})}return f}addRoundDash(o,l,u){const f=l/2;for(let b=-u;b<=u;b++){const v=this.width*(this.nextRow+u+b);let w=0,T=o[w];for(let E=0;E<this.width;E++){E/T.right>1&&(T=o[++w]);const A=Math.abs(E-T.left),P=Math.abs(E-T.right),L=Math.min(A,P);let N;const B=b/u*(f+1);if(T.isDash){const $=f-Math.abs(B);N=Math.sqrt(L*L+$*$)}else N=f-Math.sqrt(L*L+B*B);this.image.data[v+E]=Math.max(0,Math.min(255,N+128))}}}addRegularDash(o,l){for(let T=o.length-1;T>=0;--T){const E=o[T],A=o[T+1];E.zeroLength?o.splice(T,1):A&&A.isDash===E.isDash&&(A.left=E.left,o.splice(T,1))}const u=o[0],f=o[o.length-1];u.isDash===f.isDash&&(u.left=f.left-this.width,f.right=u.right+this.width);const b=this.width*this.nextRow;let v=0,w=o[v];for(let T=0;T<this.width;T++){T/w.right>1&&(w=o[++v]);const E=Math.abs(T-w.left),A=Math.abs(T-w.right),P=Math.min(E,A);this.image.data[b+T]=Math.max(0,Math.min(255,(w.isDash?P:-P)+l+128))}}addDash(o,l){const u=this.getKey(o,l);if(this.positions[u])return this.positions[u];const f="round"===l,b=f?7:0,v=2*b+1;if(this.nextRow+v>this.height)return Qn("LineAtlas out of space"),null;0===o.length&&o.push(1);let w=0;for(let A=0;A<o.length;A++)o[A]<0&&(Qn("Negative value is found in line dasharray, replacing values with 0"),o[A]=0),w+=o[A];if(0!==w){const A=this.width/w,P=this.getDashRanges(o,this.width,A);f?this.addRoundDash(P,A,b):this.addRegularDash(P,"square"===l?.5*A:0)}const T=this.nextRow+b;this.nextRow+=v;const E={tl:[T,b],br:[w,0]};return this.positions[u]=E,E}}gn(cb,"LineAtlas");class vy{constructor(o){const l={},u=[];for(const w in o){const T=o[w],E=l[w]={};for(const A in T.glyphs){const P=T.glyphs[+A];if(!P||0===P.bitmap.width||0===P.bitmap.height)continue;const L=P.metrics.localGlyph?2:1,N={x:0,y:0,w:P.bitmap.width+2*L,h:P.bitmap.height+2*L};u.push(N),E[A]=N}}const{w:f,h:b}=Kc(u),v=new Wc({width:f||1,height:b||1});for(const w in o){const T=o[w];for(const E in T.glyphs){const A=T.glyphs[+E];if(!A||0===A.bitmap.width||0===A.bitmap.height)continue;const P=l[w][E],L=A.metrics.localGlyph?2:1;Wc.copy(A.bitmap,v,{x:0,y:0},{x:P.x+L,y:P.y+L},A.bitmap)}}this.image=v,this.positions=l}}gn(vy,"GlyphAtlas");class sx{constructor(o){this.tileID=new zs(o.tileID.overscaledZ,o.tileID.wrap,o.tileID.canonical.z,o.tileID.canonical.x,o.tileID.canonical.y),this.tileZoom=o.tileZoom,this.uid=o.uid,this.zoom=o.zoom,this.canonical=o.tileID.canonical,this.pixelRatio=o.pixelRatio,this.tileSize=o.tileSize,this.source=o.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=o.showCollisionBoxes,this.collectResourceTiming=!!o.collectResourceTiming,this.returnDependencies=!!o.returnDependencies,this.promoteId=o.promoteId,this.enableTerrain=!!o.enableTerrain,this.isSymbolTile=o.isSymbolTile,this.tileTransform=Xd(o.tileID.canonical,o.projection),this.projection=o.projection}parse(o,l,u,f,b){this.status="parsing",this.data=o,this.collisionBoxArray=new or;const v=new Q1(Object.keys(o.layers).sort()),w=new eh(this.tileID,this.promoteId);w.bucketLayerIDs=[];const T={},E=new cb(256,256),A={featureIndex:w,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:E,availableImages:u},P=l.familiesBySource[this.source];for(const Ae in P){const ke=o.layers[Ae];if(!ke)continue;let at=!1,rt=!1;for(const ht of P[Ae])"symbol"===ht[0].type?at=!0:rt=!0;if(!0===this.isSymbolTile&&!at||!1===this.isSymbolTile&&!rt)continue;1===ke.version&&Qn(`Vector tile source "${this.source}" layer "${Ae}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const _t=v.encode(Ae),zt=[];for(let ht=0;ht<ke.length;ht++){const Dt=ke.feature(ht),Ct=w.getId(Dt,Ae);zt.push({feature:Dt,id:Ct,index:ht,sourceLayerIndex:_t})}for(const ht of P[Ae]){const Dt=ht[0];void 0!==this.isSymbolTile&&"symbol"===Dt.type!==this.isSymbolTile||Dt.minzoom&&this.zoom<Math.floor(Dt.minzoom)||Dt.maxzoom&&this.zoom>=Dt.maxzoom||"none"!==Dt.visibility&&(Yf(ht,this.zoom,u),(T[Dt.id]=Dt.createBucket({index:w.bucketLayerIDs.length,layers:ht,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:_t,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:u})).populate(zt,A,this.tileID.canonical,this.tileTransform),w.bucketLayerIDs.push(ht.map(Ct=>Ct.id)))}}let L,N,B,$;E.trim();const K={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ce=()=>{if(L)return b(L);if(N&&B&&$){const Ae=new vy(N),ke=new jg(B,$);for(const at in T){const rt=T[at];rt instanceof Hu?(Yf(rt.layers,this.zoom,u),PI(rt,N,Ae.positions,B,ke.iconPositions,this.showCollisionBoxes,u,this.tileID.canonical,this.tileZoom,this.projection)):rt.hasPattern&&(rt instanceof q_||rt instanceof uc||rt instanceof kg)&&(Yf(rt.layers,this.zoom,u),rt.addFeatures(A,this.tileID.canonical,ke.patternPositions,u,this.tileTransform))}this.status="done",b(null,{buckets:Hi(T).filter(at=>!at.isEmpty()),featureIndex:w,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ae.image,lineAtlas:E,imageAtlas:ke,glyphMap:this.returnDependencies?N:null,iconMap:this.returnDependencies?B:null,glyphPositions:this.returnDependencies?Ae.positions:null})}},Ce=W(A.glyphDependencies,Ae=>Object.keys(Ae).map(Number));Object.keys(Ce).length?f.send("getGlyphs",{uid:this.uid,stacks:Ce},(Ae,ke)=>{L||(L=Ae,N=ke,ce())},void 0,!1,K):N={};const ue=Object.keys(A.iconDependencies);ue.length?f.send("getImages",{icons:ue,source:this.source,tileID:this.tileID,type:"icons"},(Ae,ke)=>{L||(L=Ae,B=ke,ce())},void 0,!1,K):B={};const ve=Object.keys(A.patternDependencies);ve.length?f.send("getImages",{icons:ve,source:this.source,tileID:this.tileID,type:"patterns"},(Ae,ke)=>{L||(L=Ae,$=ke,ce())},void 0,!1,K):$={},ce()}}function Yf(a,o,l){const u=new R(o);for(const f of a)f.recalculate(u,l)}class ub{constructor(o){this.entries={},this.scheduler=o}request(o,l,u,f){const b=this.entries[o]=this.entries[o]||{callbacks:[]};if(b.result){const[v,w]=b.result;return this.scheduler?this.scheduler.add(()=>{f(v,w)},l):f(v,w),()=>{}}return b.callbacks.push(f),b.cancel||(b.cancel=u((v,w)=>{b.result=[v,w];for(const T of b.callbacks)this.scheduler?this.scheduler.add(()=>{T(v,w)},l):T(v,w);setTimeout(()=>delete this.entries[o],3e3)})),()=>{b.result||(b.callbacks=b.callbacks.filter(v=>v!==f),b.callbacks.length||(b.cancel(),delete this.entries[o]))}}}function xy(a,o,l){const u=JSON.stringify(a.request);return a.data&&(this.deduped.entries[u]={result:[null,a.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom},f=>{const b=du(a.request,(v,w,T,E)=>{v?f(v):w&&f(null,{vectorTile:l?void 0:new rp(new Vg(w)),rawData:w,cacheControl:T,expires:E})});return()=>{b.cancel(),f()}},o)}const db=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class wy{static from(o){if(!(o instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[l,u]=new Uint8Array(o,0,2);if(219!==l)throw new Error("Data does not appear to be in a KDBush format.");const f=u>>4;if(1!==f)throw new Error(`Got v${f} data when expected v1.`);const b=db[15&u];if(!b)throw new Error("Unrecognized array type.");const[v]=new Uint16Array(o,2,1),[w]=new Uint32Array(o,4,1);return new wy(w,v,b,o)}constructor(o,l=64,u=Float64Array,f){if(isNaN(o)||o<0)throw new Error(`Unpexpected numItems value: ${o}.`);this.numItems=+o,this.nodeSize=Math.min(Math.max(+l,2),65535),this.ArrayType=u,this.IndexArrayType=o<65536?Uint16Array:Uint32Array;const b=db.indexOf(this.ArrayType),v=2*o*this.ArrayType.BYTES_PER_ELEMENT,w=o*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-w%8)%8;if(b<0)throw new Error(`Unexpected typed array class: ${u}.`);f&&f instanceof ArrayBuffer?(this.data=f,this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+w+T,2*o),this._pos=2*o,this._finished=!0):(this.data=new ArrayBuffer(8+v+w+T),this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+w+T,2*o),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+b]),new Uint16Array(this.data,2,1)[0]=l,new Uint32Array(this.data,4,1)[0]=o)}add(o,l){const u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=o,this.coords[this._pos++]=l,u}finish(){const o=this._pos>>1;if(o!==this.numItems)throw new Error(`Added ${o} items when expected ${this.numItems}.`);return ax(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(o,l,u,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:b,coords:v,nodeSize:w}=this,T=[0,b.length-1,0],E=[];for(;T.length;){const A=T.pop()||0,P=T.pop()||0,L=T.pop()||0;if(P-L<=w){for(let K=L;K<=P;K++){const ce=v[2*K],Ce=v[2*K+1];ce>=o&&ce<=u&&Ce>=l&&Ce<=f&&E.push(b[K])}continue}const N=L+P>>1,B=v[2*N],$=v[2*N+1];B>=o&&B<=u&&$>=l&&$<=f&&E.push(b[N]),(0===A?o<=B:l<=$)&&(T.push(L),T.push(N-1),T.push(1-A)),(0===A?u>=B:f>=$)&&(T.push(N+1),T.push(P),T.push(1-A))}return E}within(o,l,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:b,nodeSize:v}=this,w=[0,f.length-1,0],T=[],E=u*u;for(;w.length;){const A=w.pop()||0,P=w.pop()||0,L=w.pop()||0;if(P-L<=v){for(let K=L;K<=P;K++)Cy(b[2*K],b[2*K+1],o,l)<=E&&T.push(f[K]);continue}const N=L+P>>1,B=b[2*N],$=b[2*N+1];Cy(B,$,o,l)<=E&&T.push(f[N]),(0===A?o-u<=B:l-u<=$)&&(w.push(L),w.push(N-1),w.push(1-A)),(0===A?o+u>=B:l+u>=$)&&(w.push(N+1),w.push(P),w.push(1-A))}return T}}function ax(a,o,l,u,f,b){if(f-u<=l)return;const v=u+f>>1;lx(a,o,v,u,f,b),ax(a,o,l,u,v-1,1-b),ax(a,o,l,v+1,f,1-b)}function lx(a,o,l,u,f,b){for(;f>u;){if(f-u>600){const E=f-u+1,A=l-u+1,P=Math.log(E),L=.5*Math.exp(2*P/3),N=.5*Math.sqrt(P*L*(E-L)/E)*(A-E/2<0?-1:1);lx(a,o,l,Math.max(u,Math.floor(l-A*L/E+N)),Math.min(f,Math.floor(l+(E-A)*L/E+N)),b)}const v=o[2*l+b];let w=u,T=f;for(bp(a,o,u,l),o[2*f+b]>v&&bp(a,o,u,f);w<T;){for(bp(a,o,w,T),w++,T--;o[2*w+b]<v;)w++;for(;o[2*T+b]>v;)T--}o[2*u+b]===v?bp(a,o,u,T):(T++,bp(a,o,T,f)),T<=l&&(u=T+1),l<=T&&(f=T-1)}}function bp(a,o,l,u){Sy(a,l,u),Sy(o,2*l,2*u),Sy(o,2*l+1,2*u+1)}function Sy(a,o,l){const u=a[o];a[o]=a[l],a[l]=u}function Cy(a,o,l,u){const f=a-l,b=o-u;return f*f+b*b}p.ARRAY_TYPE=Aa,p.AUTH_ERR_MSG=Re,p.Aabb=Bs,p.Actor=class{constructor(a,o,l){this.target=a,this.parent=o,this.mapId=l,this.callbacks={},this.cancelCallbacks={},Ci(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Wr()?a:te,this.scheduler=new fy}send(a,o,l,u,f=!1,b){const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(l.metadata=b,this.callbacks[v]=l);const w=H(this.globalScope)?void 0:[];return this.target.postMessage({id:v,type:a,hasCallback:!!l,targetMapId:u,mustQueue:f,sourceMapId:this.mapId,data:Fs(o,w)},w),{cancel:()=>{l&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(a){const o=a.data,l=o.id;if(l&&(!o.targetMapId||this.mapId===o.targetMapId))if("<cancel>"===o.type){const u=this.cancelCallbacks[l];delete this.cancelCallbacks[l],u&&u.cancel()}else if(o.mustQueue||Wr()){const u=this.callbacks[l];this.cancelCallbacks[l]=this.scheduler.add(()=>this.processTask(l,o),u&&u.metadata||{type:"message"})}else this.processTask(l,o)}processTask(a,o){if("<response>"===o.type){const l=this.callbacks[a];delete this.callbacks[a],l&&(o.error?l(nc(o.error)):l(null,nc(o.data)))}else{const l=H(this.globalScope)?void 0:[],u=o.hasCallback?(b,v)=>{delete this.cancelCallbacks[a],this.target.postMessage({id:a,type:"<response>",sourceMapId:this.mapId,error:b?Fs(b):null,data:Fs(v,l)},l)}:b=>{},f=nc(o.data);if(this.parent[o.type])this.parent[o.type](o.sourceMapId,f,u);else if(this.parent.getWorkerSource){const b=o.type.split(".");this.parent.getWorkerSource(o.sourceMapId,b[0],f.source)[b[1]](f,u)}else u(new Error(`Could not find function ${o.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},p.CanonicalTileID=Nf,p.Color=uo,p.ColorMode=bc,p.CullFaceMode=Ol,p.DEMData=ob,p.DataConstantProperty=U,p.DedupedRequest=ub,p.DepthMode=qu,p.EXTENT=Pn,p.Elevation=class{isDataAvailableAtPoint(a){const o=this._source();if(this.isUsingMockSource()||!o||a.y<0||a.y>1)return!1;const l=o.getSource().maxzoom,u=1<<l,f=Math.floor(a.x),b=Math.floor((a.x-f)*u),v=Math.floor(a.y*u),w=this.findDEMTileFor(new zs(l,f,l,b,v));return!(!w||!w.dem)}getAtPointOrZero(a,o=0){return this.getAtPoint(a,o)||0}getAtPoint(a,o,l=!0){if(this.isUsingMockSource())return null;null==o&&(o=null);const u=this._source();if(!u||a.y<0||a.y>1)return o;const f=u.getSource().maxzoom,b=1<<f,v=Math.floor(a.x),w=a.x-v,T=new zs(f,v,f,Math.floor(w*b),Math.floor(a.y*b)),E=this.findDEMTileFor(T);if(!E||!E.dem)return o;const A=E.dem,P=1<<E.tileID.canonical.z,L=(w*P-E.tileID.canonical.x)*A.dim,N=(a.y*P-E.tileID.canonical.y)*A.dim,B=Math.floor(L),$=Math.floor(N);return(l?this.exaggeration():1)*Bi(Bi(A.get(B,$),A.get(B,$+1),N-$),Bi(A.get(B+1,$),A.get(B+1,$+1),N-$),L-B)}getAtTileOffset(a,o,l){const u=1<<a.canonical.z;return this.getAtPointOrZero(new To(a.wrap+(a.canonical.x+o/Pn)/u,(a.canonical.y+l/Pn)/u))}getAtTileOffsetFunc(a,o,l,u){return f=>{const b=this.getAtTileOffset(a,f.x,f.y),v=u.upVector(a.canonical,f.x,f.y);return Ra(v,v,b*u.upVectorScale(a.canonical,o,l).metersToTile),v}}getForTilePoints(a,o,l,u){if(this.isUsingMockSource())return!1;const f=Jd.create(this,a,u);return!!f&&(o.forEach(b=>{b[2]=this.exaggeration()*f.getElevationAt(b[0],b[1],l)}),!0)}getMinMaxForTile(a){if(this.isUsingMockSource())return null;const o=this.findDEMTileFor(a);if(!o||!o.dem)return null;const l=o.dem.tree,u=o.tileID,f=1<<a.canonical.z-u.canonical.z;let b=a.canonical.x/f-u.canonical.x,v=a.canonical.y/f-u.canonical.y,w=0;for(let T=0;T<a.canonical.z-u.canonical.z&&!l.leaves[w];T++){b*=2,v*=2;const E=2*Math.floor(v)+Math.floor(b);w=l.childOffsets[w]+E,b%=1,v%=1}return{min:this.exaggeration()*l.minimums[w],max:this.exaggeration()*l.maximums[w]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(a,o,l){throw new Error("Pure virtual method called.")}pointCoordinate(a){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(a){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},p.ErrorEvent=Za,p.EvaluationParameters=R,p.Event=Rc,p.Evented=pu,p.FillExtrusionBucket=kg,p.Frustum=Nd,p.FrustumCorners=Pu,p.GLOBE_RADIUS=sc,p.GLOBE_SCALE_MATCH_LATITUDE=45,p.GLOBE_ZOOM_THRESHOLD_MAX=6,p.GLOBE_ZOOM_THRESHOLD_MIN=5,p.GlobeSharedBuffers=class{constructor(a){this._createGrid(a),this._createPoles(a)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const a of this._poleSegments)a.destroy();for(const a of this._gridSegments)a.withSkirts.destroy(),a.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const a of this._wireframeSegments)a.destroy()}}_fillGridMeshWithLods(a,o){const l=new Ft,u=new En,f=[],b=a+1+2,v=o[0]+1,w=o[0]+1+(1+o.length),T=(E,A,P)=>{let L=E===b-1?E-2:0===E?E:E-1;return L+=P?24575:0,[L,A]};for(let E=0;E<b;++E)l.emplaceBack(...T(E,0,!0));for(let E=0;E<v;++E)for(let A=0;A<b;++A)l.emplaceBack(...T(A,E,(0===A||A===b-1)&&!0));for(let E=0;E<o.length;++E){const A=o[E];for(let P=0;P<b;++P)l.emplaceBack(...T(P,A,!0))}for(let E=0;E<o.length;++E){const A=u.length,P=o[E]+1+2,L=new En;for(let $=0;$<P-1;$++){const K=$===P-2,ce=K?b*(w-o.length+E-$):b;for(let Ce=0;Ce<b-1;Ce++){const ue=$*b+Ce;0===$||K||0===Ce||Ce===b-2?(L.emplaceBack(ue+1,ue,ue+ce),L.emplaceBack(ue+ce,ue+ce+1,ue+1)):(u.emplaceBack(ue+1,ue,ue+ce),u.emplaceBack(ue+ce,ue+ce+1,ue+1))}}const N=Hr.simpleSegment(0,A,l.length,u.length-A);for(let $=0;$<L.uint16.length;$+=3)u.emplaceBack(L.uint16[$],L.uint16[$+1],L.uint16[$+2]);const B=Hr.simpleSegment(0,A,l.length,u.length-A);f.push({withoutSkirts:N,withSkirts:B})}return{vertices:l,indices:u,segments:f}}_createGrid(a){const o=this._fillGridMeshWithLods(64,Cf);this._gridSegments=o.segments,this._gridBuffer=a.createVertexBuffer(o.vertices,Sf.members),this._gridIndexBuffer=a.createIndexBuffer(o.indices,!0)}_createPoles(a){const o=new En;for(let f=0;f<=64;f++)o.emplaceBack(0,f+1,f+2);this._poleIndexBuffer=a.createIndexBuffer(o,!0);const l=new ki,u=new ki;this._poleSegments=[];for(let f=0,b=0;f<5;f++){const v=360/(1<<f);l.emplaceBack(0,-sc,0,.5,0),u.emplaceBack(0,-sc,0,.5,1);for(let w=0;w<=64;w++){const T=w/64,E=Bi(0,v,T),[A,P,L]=Ef(XS,ZS,E,sc);l.emplaceBack(A,P,L,T,0),u.emplaceBack(A,P,L,T,1)}this._poleSegments.push(Hr.simpleSegment(b,0,66,64)),b+=66}this._poleNorthVertexBuffer=a.createVertexBuffer(l,wf,!1),this._poleSouthVertexBuffer=a.createVertexBuffer(u,wf,!1)}getGridBuffers(a,o){return[this._gridBuffer,this._gridIndexBuffer,o?this._gridSegments[a].withSkirts:this._gridSegments[a].withoutSkirts]}getPoleBuffers(a){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[a]]}getWirefameBuffers(a,o){if(!this._wireframeSegments){const l=new io,u=64,f=u+1+2,b=1;this._wireframeSegments=[];for(let v=0,w=0;v<Cf.length;v++){const T=Cf[v];for(let A=b;A<T+b;A++)for(let P=b;P<u+b;P++){const L=A*f+P;l.emplaceBack(L,L+1),l.emplaceBack(L,L+f),l.emplaceBack(L,L+f+1)}const E=T*u*3;this._wireframeSegments.push(Hr.simpleSegment(0,w,(T+1)*f,E)),w+=E}this._wireframeIndexBuffer=a.createIndexBuffer(l)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[o]]}},p.GlyphManager=up,p.ImagePosition=Uf,p.KDBush=wy,p.LivePerformanceUtils=_l,p.LngLat=yr,p.LngLatBounds=Au,p.LocalGlyphMode=ay,p.MAX_MERCATOR_LATITUDE=Go,p.MercatorCoordinate=To,p.ONE_EM=24,p.OverscaledTileID=zs,p.PerformanceMarkers=hu,p.Point=Ie,p.Properties=ge,p.RGBAImage=Qs,p.Ray=w_,p.RequestManager=class{constructor(a,o,l){this._transformRequestFn=a,this._customAccessToken=o,this._silenceAuthErrors=!!l,this._createSkuToken()}_createSkuToken(){const a=function(){let o="";for(let l=0;l<10;l++)o+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Kt,o].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=a.token,this._skuTokenExpiresAt=a.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(a,o){return this._transformRequestFn&&this._transformRequestFn(a,o)||{url:a}}normalizeStyleURL(a,o){if(!Be(a))return a;const l=tn(a);return l.path=`/styles/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||o)}normalizeGlyphsURL(a,o){if(!Be(a))return a;const l=tn(a);return l.path=`/fonts/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||o)}normalizeSourceURL(a,o,l,u){if(!Be(a))return a;const f=tn(a);return f.path=`/v4/${f.authority}.json`,f.params.push("secure"),l&&f.params.push(`language=${l}`),u&&f.params.push(`worldview=${u}`),this._makeAPIURL(f,this._customAccessToken||o)}normalizeSpriteURL(a,o,l,u){const f=tn(a);return Be(a)?(f.path=`/styles/v1${f.path}/sprite${o}${l}`,this._makeAPIURL(f,this._customAccessToken||u)):(f.path+=`${o}${l}`,Ut(f))}normalizeTileURL(a,o,l){if(this._isSkuTokenExpired()&&this._createSkuToken(),a&&!Be(a))return a;const u=tn(a);u.path=u.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${o||l&&"raster"!==u.authority&&512===l?"@2x":""}${Xe.supported?".webp":"$1"}`),"raster"===u.authority?u.path=`/${Ve.RASTER_URL_PREFIX}${u.path}`:(u.path=u.path.replace(/^.+\/v4\//,"/"),u.path=`/${Ve.TILE_URL_VERSION}${u.path}`);const f=this._customAccessToken||function(b){for(const v of b){const w=v.match(/^access_token=(.*)$/);if(w)return w[1]}return null}(u.params)||Ve.ACCESS_TOKEN;return Ve.REQUIRE_ACCESS_TOKEN&&f&&this._skuToken&&u.params.push(`sku=${this._skuToken}`),this._makeAPIURL(u,f)}canonicalizeTileURL(a,o){const l=tn(a);if(!l.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!l.path.match(/\.[\w]+$/))return a;let u="mapbox://";l.path.match(/^\/raster\/v1\//)?u+=`raster/${l.path.replace(`/${Ve.RASTER_URL_PREFIX}/`,"")}`:u+=`tiles/${l.path.replace(`/${Ve.TILE_URL_VERSION}/`,"")}`;let f=l.params;return o&&(f=f.filter(b=>!b.match(/^access_token=/))),f.length&&(u+=`?${f.join("&")}`),u}canonicalizeTileset(a,o){const l=!!o&&Be(o),u=[];for(const f of a.tiles||[])tt(f)?u.push(this.canonicalizeTileURL(f,l)):u.push(f);return u}_makeAPIURL(a,o){const l="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",u=tn(Ve.API_URL);if(a.protocol=u.protocol,a.authority=u.authority,"http"===a.protocol){const f=a.params.indexOf("secure");f>=0&&a.params.splice(f,1)}if("/"!==u.path&&(a.path=`${u.path}${a.path}`),!Ve.REQUIRE_ACCESS_TOKEN)return Ut(a);if(o=o||Ve.ACCESS_TOKEN,!this._silenceAuthErrors){if(!o)throw new Error(`An API access token is required to use Mapbox GL. ${l}`);if("s"===o[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${l}`)}return a.params=a.params.filter(f=>-1===f.indexOf("access_token")),a.params.push(`access_token=${o||""}`),Ut(a)}},p.ResourceType=_a,p.SegmentVector=Hr,p.SourceCache=Qd,p.StencilMode=Wf,p.StructArrayLayout1ui2=Ns,p.StructArrayLayout2f1f2i16=An,p.StructArrayLayout2i4=Ft,p.StructArrayLayout2ui4=io,p.StructArrayLayout3f12=oi,p.StructArrayLayout3ui6=En,p.StructArrayLayout4i8=St,p.StructArrayLayout5f20=ki,p.Texture=Yd,p.Tile=qf,p.Transitionable=j,p.Uniform1f=Hc,p.Uniform1i=class extends Ml{constructor(a){super(a),this.current=0}set(a,o,l){this.fetchUniformLocation(a,o)&&this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}},p.Uniform2f=class extends Ml{constructor(a){super(a),this.current=[0,0]}set(a,o,l){this.fetchUniformLocation(a,o)&&(l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1])))}},p.Uniform3f=class extends Ml{constructor(a){super(a),this.current=[0,0,0]}set(a,o,l){this.fetchUniformLocation(a,o)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2])))}},p.Uniform4f=HS,p.UniformColor=$v,p.UniformMatrix2f=class extends Ml{constructor(a){super(a),this.current=TI}set(a,o,l){if(this.fetchUniformLocation(a,o))for(let u=0;u<4;u++)if(l[u]!==this.current[u]){this.current=l,this.gl.uniformMatrix2fv(this.location,!1,l);break}}},p.UniformMatrix3f=class extends Ml{constructor(a){super(a),this.current=CI}set(a,o,l){if(this.fetchUniformLocation(a,o))for(let u=0;u<9;u++)if(l[u]!==this.current[u]){this.current=l,this.gl.uniformMatrix3fv(this.location,!1,l);break}}},p.UniformMatrix4f=class extends Ml{constructor(a){super(a),this.current=Et}set(a,o,l){if(this.fetchUniformLocation(a,o)){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let u=1;u<16;u++)if(l[u]!==this.current[u]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}}},p.UnwrappedTileID=Pg,p.ValidationError=pn,p.VectorTileFeature=al,p.VectorTileWorkerSource=class extends pu{constructor(a,o,l,u,f){super(),this.actor=a,this.layerIndex=o,this.availableImages=l,this.loadVectorData=f||xy,this.loading={},this.loaded={},this.deduped=new ub(a.scheduler),this.isSpriteLoaded=u,this.scheduler=a.scheduler}loadTile(a,o){const l=a.uid,u=a&&a.request,f=u&&u.collectResourceTiming,b=this.loading[l]=new sx(a);b.abort=this.loadVectorData(a,(v,w)=>{const T=!this.loading[l];if(delete this.loading[l],T||v||!w)return b.status="done",T||(this.loaded[l]=b),o(v);const E=w.rawData,A={};w.expires&&(A.expires=w.expires),w.cacheControl&&(A.cacheControl=w.cacheControl),b.vectorTile=w.vectorTile||new rp(new Vg(E));const P=()=>{b.parse(b.vectorTile,this.layerIndex,this.availableImages,this.actor,(L,N)=>{if(L||!N)return o(L);const B={};if(f){const $=Xl(u);$.length>0&&(B.resourceTiming=JSON.parse(JSON.stringify($)))}o(null,Li({rawTileData:E.slice(0)},N,A,B))})};this.isSpriteLoaded?P():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(P,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom}):P()}),this.loaded=this.loaded||{},this.loaded[l]=b})}reloadTile(a,o){const l=this.loaded,u=a.uid,f=this;if(l&&l[u]){const b=l[u];b.showCollisionBoxes=a.showCollisionBoxes,b.enableTerrain=!!a.enableTerrain,b.projection=a.projection,b.tileTransform=Xd(a.tileID.canonical,a.projection);const v=(w,T)=>{const E=b.reloadCallback;E&&(delete b.reloadCallback,b.parse(b.vectorTile,f.layerIndex,this.availableImages,f.actor,E)),o(w,T)};"parsing"===b.status?b.reloadCallback=v:"done"===b.status&&(b.vectorTile?b.parse(b.vectorTile,this.layerIndex,this.availableImages,this.actor,v):v())}}abortTile(a,o){const l=a.uid,u=this.loading[l];u&&(u.abort&&u.abort(),delete this.loading[l]),o()}removeTile(a,o){const l=this.loaded,u=a.uid;l&&l[u]&&delete l[u],o()}},p.WritingMode=Na,p.ZoomDependentExpression=cr,p.add=ka,p.addDynamicAttributes=$f,p.adjoint=function(a,o){var l=o[0],u=o[1],f=o[2],b=o[3],v=o[4],w=o[5],T=o[6],E=o[7],A=o[8];return a[0]=v*A-w*E,a[1]=f*E-u*A,a[2]=u*w-f*v,a[3]=w*T-b*A,a[4]=l*A-f*T,a[5]=f*b-l*w,a[6]=b*E-v*T,a[7]=u*T-l*E,a[8]=l*v-u*b,a},p.asyncAll=cn,p.bezier=je,p.bindAll=Ci,p.boundsAttributes=by,p.bufferConvexPolygon=function(a,o){const l=[];for(let u=0;u<a.length;u++){const f=kt(u-1,-1,a.length-1),b=kt(u+1,-1,a.length-1),v=a[u],w=a[b],T=a[f].sub(v).unit(),E=w.sub(v).unit(),A=E.angleWithSep(T.x,T.y),P=T.add(E).unit().mult(-1*o/Math.sin(A/2));l.push(v.add(P))}return l},p.cacheEntryPossiblyAdded=function(a){ds++,ds>Oi&&(a.getActor().send("enforceCacheSizeLimit",en),ds=0)},p.calculateGlobeLabelMatrix=function(a,o){const{x:l,y:u}=a.point,f=ug(l,u,a.worldSize/a._pixelsPerMercatorPixel,0,0);return ol(f,f,cg(Gc(o)))},p.calculateGlobeMatrix=function(a){const{x:o,y:l}=a.point,{lng:u,lat:f}=a._center;return ug(o,l,a.worldSize,u,f)},p.calculateGlobeMercatorMatrix=function(a){const o=a.pixelsPerMeter,l=o/kl(1,a.center.lat),u=ho(new Float64Array(16));return ng(u,u,[a.point.x,a.point.y,0]),ku(u,u,[l,l,o]),Float32Array.from(u)},p.circumferenceAtLatitude=M_,p.clamp=Tt,p.clearTileCache=function(a){if(!Jr())return;const o=te.caches.delete(jt);a&&o.catch(a).then(()=>a())},p.clipLine=H0,p.clone=function(a){var o=new Aa(16);return o[0]=a[0],o[1]=a[1],o[2]=a[2],o[3]=a[3],o[4]=a[4],o[5]=a[5],o[6]=a[6],o[7]=a[7],o[8]=a[8],o[9]=a[9],o[10]=a[10],o[11]=a[11],o[12]=a[12],o[13]=a[13],o[14]=a[14],o[15]=a[15],o},p.clone$1=Qe,p.collisionCircleLayout=k1,p.config=Ve,p.conjugate=function(a,o){return a[0]=-o[0],a[1]=-o[1],a[2]=-o[2],a[3]=o[3],a},p.create=function(){var a=new Aa(16);return Aa!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},p.create$1=$S,p.createExpression=la,p.createLayout=He,p.createStyleLayer=function(a){return"custom"===a.type?new tx(a):new rb[a.type](a)},p.cross=__,p.degToRad=re,p.distance=function(a,o){return Math.hypot(o[0]-a[0],o[1]-a[1],o[2]-a[2])},p.div=function(a,o,l){return a[0]=o[0]/l[0],a[1]=o[1]/l[1],a[2]=o[2]/l[2],a},p.dot=xs,p.earthRadius=Mf,p.ease=yt,p.easeCubicInOut=mt,p.ecefToLatLng=function([a,o,l]){const u=Math.hypot(a,o,l),f=Math.atan2(a,l),b=.5*Math.PI-Math.acos(-o/u);return new yr(me(f),me(b))},p.emitValidationErrors=Eu,p.endsWith=fe,p.enforceCacheSizeLimit=function(a){br(),Si&&Si.then(o=>{o.keys().then(l=>{for(let u=0;u<l.length-a;u++)o.delete(l[u])})})},p.evaluateSizeForFeature=dc,p.evaluateSizeForZoom=ap,p.evaluateVariableOffset=X0,p.evented=x,p.exactEquals=function(a,o){return a[0]===o[0]&&a[1]===o[1]&&a[2]===o[2]&&a[3]===o[3]},p.exactEquals$1=function(a,o){return a[0]===o[0]&&a[1]===o[1]&&a[2]===o[2]},p.exported=va,p.exported$1=Xe,p.extend=Li,p.extend$1=yl,p.fillExtrusionHeightLift=D0,p.filterObject=Pt,p.fromMat4=function(a,o){return a[0]=o[0],a[1]=o[1],a[2]=o[2],a[3]=o[4],a[4]=o[5],a[5]=o[6],a[6]=o[8],a[7]=o[9],a[8]=o[10],a},p.fromQuat=function(a,o){var l=o[0],u=o[1],f=o[2],b=o[3],v=l+l,w=u+u,T=f+f,E=l*v,A=u*v,P=u*w,L=f*v,N=f*w,B=f*T,$=b*v,K=b*w,ce=b*T;return a[0]=1-P-B,a[1]=A+ce,a[2]=L-K,a[3]=0,a[4]=A-ce,a[5]=1-E-B,a[6]=N+$,a[7]=0,a[8]=L+K,a[9]=N-$,a[10]=1-E-P,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},p.fromRotation=function(a,o){var l=Math.sin(o),u=Math.cos(o);return a[0]=u,a[1]=l,a[2]=0,a[3]=-l,a[4]=u,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},p.fromScaling=Xv,p.furthestTileCorner=function(a){const o=Math.round((a+45+360)%360/90)%4;return lt[o]},p.getAABBPointSquareDist=function(a,o,l){let u=0;for(let f=0;f<2;++f){const b=l?l[f]:0;a[f]>b&&(u+=(a[f]-b)*(a[f]-b)),o[f]<b&&(u+=(b-o[f])*(b-o[f]))}return u},p.getAnchorAlignment=iy,p.getAnchorJustification=Wg,p.getBounds=function(a){let o=1/0,l=1/0,u=-1/0,f=-1/0;for(const b of a)o=Math.min(o,b.x),l=Math.min(l,b.y),u=Math.max(u,b.x),f=Math.max(f,b.y);return{min:new Ie(o,l),max:new Ie(u,f)}},p.getColumn=Ke,p.getDefaultExportFromCjs=_n,p.getGridMatrix=function(a,o,l,u){const f=o.getNorth(),b=o.getSouth(),v=o.getWest(),w=o.getEast(),T=1<<a.z,E=w-v,A=f-b,P=E/64,L=-A/Cf[l],N=[0,P,0,L,0,0,f,v,0];if(a.z>0){const B=180/u;m_(N,N,[B/E+1,0,0,0,B/A+1,0,-.5*B/P,.5*B/L,1])}return N[2]=T,N[5]=a.x,N[8]=a.y,N},p.getImage=_e,p.getJSON=function(a,o){return Ac(Li(a,{type:"json"}),o)},p.getLatitudinalLod=function(a){const o=Go-5;a=Tt(a,-o,o)/o*90;const l=Math.pow(Math.abs(Math.sin(re(a))),3);return Math.round(l*(Cf.length-1))},p.getMapSessionAPI=wo,p.getPerformanceMeasurement=Xl,p.getProjection=eb,p.getRTLTextPluginStatus=S,p.getReferrer=Wl,p.getTilePoint=function(a,{x:o,y:l},u=0){return new Ie(((o-u)*a.scale-a.x)*Pn,(l*a.scale-a.y)*Pn)},p.getTileVec3=function(a,o,l=0){return mf(((o.x-l)*a.scale-a.x)*Pn,(o.y*a.scale-a.y)*Pn,hg(o.z,o.y))},p.getVideo=function(a,o){const l=te.document.createElement("video");l.muted=!0,l.onloadstart=function(){o(null,l)};for(let u=0;u<a.length;u++){const f=te.document.createElement("source");Ch(a[u])||(l.crossOrigin="Anonymous"),f.src=a[u],l.appendChild(f)}return{cancel:()=>{}}},p.globeCenterToScreenPoint=function(a){const o=[0,0,0],l=ho(new Float64Array(16));return ol(l,a.pixelMatrix,a.globeMatrix),ze(o,o,l),new Ie(o[0],o[1])},p.globeDenormalizeECEF=cg,p.globeECEFOrigin=function(a,o){const l=[0,0,0];return ze(l,l,If(Gc(o.canonical))),ze(l,l,a),l},p.globeMetersToEcef=og,p.globeNormalizeECEF=If,p.globePixelsToTileUnits=function(a,o){return Pn/(512*Math.pow(2,a))*E_(Gc(o))},p.globePoleMatrixForTile=function(a,o,l){const u=ho(new Float64Array(16)),f=(o/(1<<a)-.5)*Math.PI*2;return ig(u,l.globeMatrix,f),Float32Array.from(u)},p.globeTileBounds=Gc,p.globeTiltAtLngLat=D_,p.globeToMercatorTransition=Vd,p.globeUseCustomAntiAliasing=function(a,o,l){const u=Vd(l.zoom),f=a.style.map._antialias,b=!!o.extStandardDerivatives,v=o.extStandardDerivativesForceOff||a.terrain&&a.terrain.exaggeration()>0;return 0===u&&!f&&!v&&b},p.identity=ho,p.identity$1=v_,p.invert=ff,p.isFullscreen=function(){return!!te.document.fullscreenElement||!!te.document.webkitFullscreenElement},p.isLngLatBehindGlobe=dg,p.isMapAuthenticated=function(a){return hs.has(a)},p.isMapboxURL=Be,p.isSafariWithAntialiasingBug=function(a){const o=a.navigator?a.navigator.userAgent:null;return!!H(a)&&o&&(o.match("Version/15.4")||o.match("Version/15.5")||o.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},p.latFromMercatorY=vr,p.latLngToECEF=Df,p.len=qS,p.length=Ru,p.length$1=function(a){return Math.hypot(a[0],a[1],a[2],a[3])},p.lngFromMercatorX=La,p.loadVectorTile=xy,p.makeRequest=Ac,p.mapValue=function(a,o,l,u,f){return Tt((a-o)/(l-o)*(f-u)+u,u,f)},p.mercatorScale=pg,p.mercatorXfromLng=lc,p.mercatorYfromLat=Al,p.mercatorZfromAltitude=kl,p.mul=GS,p.mul$1=vf,p.multiply=ol,p.multiply$1=m_,p.multiply$2=bf,p.nextPowerOfTwo=go,p.normalize=Po,p.normalize$1=Jv,p.normalize$2=Kv,p.number=Bi,p.ortho=function(a,o,l,u,f,b,v){var w=1/(o-l),T=1/(u-f),E=1/(b-v);return a[0]=-2*w,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*T,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*E,a[11]=0,a[12]=(o+l)*w,a[13]=(f+u)*T,a[14]=(v+b)*E,a[15]=1,a},p.pbf=Zc,p.perspective=function(a,o,l,u,f){var b,v=1/Math.tan(o/2);return a[0]=v/l,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=v,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,null!=f&&f!==1/0?(a[10]=(f+u)*(b=1/(u-f)),a[14]=2*f*u*b):(a[10]=-1,a[14]=-2*u),a},p.pick=function(a,o){const l={};for(let u=0;u<o.length;u++){const f=o[u];f in a&&(l[f]=a[f])}return l},p.plugin=I,p.pointGeometry=we,p.polesInViewport=function(a){const o=ho(new Float64Array(16));ol(o,a.pixelMatrix,a.globeMatrix);const l=[0,sl,0],u=[0,Ys,0];return ze(l,l,o),ze(u,u,o),[l[0]>0&&l[0]<=a.width&&l[1]>0&&l[1]<=a.height&&!dg(a,new yr(a.center.lat,90)),u[0]>0&&u[0]<=a.width&&u[1]>0&&u[1]<=a.height&&!dg(a,new yr(a.center.lat,-90))]},p.polygonContainsPoint=Ou,p.polygonIntersectsBox=e1,p.polygonIntersectsPolygon=bg,p.polygonizeBounds=function(a,o,l=0,u=!0){const f=new Ie(l,l),b=a.sub(f),v=o.add(f),w=[b,new Ie(v.x,b.y),v,new Ie(b.x,v.y)];return u&&w.push(b.clone()),w},p.posAttributes=Sf,p.postMapLoadEvent=lo,p.postPerformanceEvent=bo,p.postTurnstileEvent=Ti,p.potpack=Kc,p.prevPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.floor(Math.log(a)/Math.LN2))},p.radToDeg=me,p.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],p.registerForPluginStateChange=function(a){return a({pluginStatus:g,pluginURL:c}),x.on("pluginStateChange",a),a},p.removeAuthState=function(a){hs.delete(a)},p.renderColorRamp=Xc,p.resample=A_,p.rotateX=g_,p.rotateX$1=Qh,p.rotateY=ig,p.rotateY$1=Qv,p.rotateZ=function(a,o,l){var u=Math.sin(l),f=Math.cos(l),b=o[0],v=o[1],w=o[2],T=o[3],E=o[4],A=o[5],P=o[6],L=o[7];return o!==a&&(a[8]=o[8],a[9]=o[9],a[10]=o[10],a[11]=o[11],a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15]),a[0]=b*f+E*u,a[1]=v*f+A*u,a[2]=w*f+P*u,a[3]=T*f+L*u,a[4]=E*f-b*u,a[5]=A*f-v*u,a[6]=P*f-w*u,a[7]=L*f-T*u,a},p.rotateZ$1=function(a,o,l){l*=.5;var u=o[0],f=o[1],b=o[2],v=o[3],w=Math.sin(l),T=Math.cos(l);return a[0]=u*T+f*w,a[1]=f*T-u*w,a[2]=b*T+v*w,a[3]=v*T-b*w,a},p.scale=ku,p.scale$1=Yv,p.scale$2=Ra,p.scaleAndAdd=Yh,p.set=function(a,o,l,u){return a[0]=o,a[1]=l,a[2]=u,a},p.setCacheLimits=function(a,o){en=a,Oi=o},p.setColumn=function(a,o,l){a[4*o+0]=l[0],a[4*o+1]=l[1],a[4*o+2]=l[2],a[4*o+3]=l[3]},p.setRTLTextPlugin=function(a,o,l=!1){if(g===Pd||g===uf||g===Wh)throw new Error("setRTLTextPlugin cannot be called multiple times.");c=va.resolveURL(a),g=Pd,ic=o,_(),l||D()},p.smoothstep=ri,p.spec=bt,p.squaredLength=function(a){var o=a[0],l=a[1],u=a[2];return o*o+l*l+u*u},p.storeAuthState=function(a,o){o?hs.add(a):hs.delete(a)},p.sub=Pa,p.subtract=gf,p.symbolSize=Y_,p.tileAABB=function(a,o,l,u,f,b,v,w,T){if("globe"===T.name)return function MI(a,o,l){const u=o/a.worldSize,f=a.globeMatrix;if(l.z<=1){const rt=Gc(l).getCorners();return ag(rt,f,u),Bs.fromPoints(rt)}const b=T_(l),v=Tf(b);ag(v,f,u);const w=Number.MAX_VALUE,T=[-w,-w,-w],E=[w,w,w];if(b.contains(a.center)){for(const zt of v)_f(E,E,zt),yf(T,T,zt);T[2]=0;const rt=a.point,_t=[rt.x*u,rt.y*u,0];return _f(E,E,_t),yf(T,T,_t),new Bs(E,T)}const A=[f[12]*u,f[13]*u,f[14]*u],P=b.getCenter(),L=Tt(a.center.lat,-Go,Go),N=Tt(P.lat,-Go,Go),B=lc(a.center.lng),$=Al(L);let K=B-lc(P.lng);const ce=$-Al(N);K>.5?K-=1:K<-.5&&(K+=1);let Ce=0;Math.abs(K)>Math.abs(ce)?Ce=K>=0?1:3:(Ce=ce>=0?0:2,Yh(A,A,[f[4]*u,f[5]*u,f[6]*u],-Math.sin(re(ce>=0?b.getSouth():b.getNorth()))*sc));const ue=v[Ce],ve=v[(Ce+1)%4],Ae=new II(ue,ve,A),ke=[sg(Ae,0)||ue[0],sg(Ae,1)||ue[1],sg(Ae,2)||ue[2]],at=Vd(a.zoom);if(at>0){const rt=function({x:zt,y:ht,z:Dt},Ct,Rt,Gt,ft){const sn=1/(1<<Dt);let mn=zt*sn,dn=mn+sn,Wn=ht*sn,Xt=Wn+sn,kn=0;const Jn=(mn+dn)/2-Gt;return Jn>.5?kn=-1:Jn<-.5&&(kn=1),mn=((mn+kn)*Ct-(Gt*=Ct))*Rt+Gt,dn=((dn+kn)*Ct-Gt)*Rt+Gt,Wn=(Wn*Ct-(ft*=Ct))*Rt+ft,Xt=(Xt*Ct-ft)*Rt+ft,[[mn,Xt,0],[dn,Xt,0],[dn,Wn,0],[mn,Wn,0]]}(l,o,a._pixelsPerMercatorPixel,B,$);for(let zt=0;zt<v.length;zt++)zd(v[zt],rt[zt],at);const _t=ka([],rt[Ce],rt[(Ce+1)%4]);Ra(_t,_t,.5),zd(ke,_t,at)}for(const rt of v)_f(E,E,rt),yf(T,T,rt);return E[2]=Math.min(ue[2],ve[2]),_f(E,E,ke),yf(T,T,ke),new Bs(E,T)}(a,o,new Nf(l,u,f));const E=Xd({z:l,x:u,y:f},T);return new Bs([(b+E.x/E.scale)*o,o*(E.y/E.scale),v],[(b+E.x2/E.scale)*o,o*(E.y2/E.scale),w])},p.tileCornersToBounds=T_,p.tileTransform=Xd,p.transformMat3=function(a,o,l){var u=o[0],f=o[1],b=o[2];return a[0]=u*l[0]+f*l[3]+b*l[6],a[1]=u*l[1]+f*l[4]+b*l[7],a[2]=u*l[2]+f*l[5]+b*l[8],a},p.transformMat4=ze,p.transformMat4$1=$c,p.transformQuat=y_,p.transitionTileAABBinECEF=n0,p.translate=ng,p.transpose=function(a,o){if(a===o){var l=o[1],u=o[2],f=o[5];a[1]=o[3],a[2]=o[6],a[3]=l,a[5]=o[7],a[6]=u,a[7]=f}else a[0]=o[0],a[1]=o[3],a[2]=o[6],a[3]=o[1],a[4]=o[4],a[5]=o[7],a[6]=o[2],a[7]=o[5],a[8]=o[8];return a},p.triggerPluginCompletionEvent=h,p.uniqueId=Zt,p.updateGlobeVertexNormal=function(a,o,l,u,f){const b=5*o+2;a.float32[b+0]=l,a.float32[b+1]=u,a.float32[b+2]=f},p.validateCustomStyleLayer=function(a){const o=[],l=a.id;return void 0===l&&o.push({message:`layers.${l}: missing required property "id"`}),void 0===a.render&&o.push({message:`layers.${l}: missing required method "render"`}),a.renderingMode&&"2d"!==a.renderingMode&&"3d"!==a.renderingMode&&o.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),o},p.validateFilter=a=>Xs(tc(a)),p.validateFog=a=>Xs(Xm(a)),p.validateLayer=a=>Xs(di(a)),p.validateLight=a=>Xs(Wm(a)),p.validateSource=a=>Xs(qm(a)),p.validateStyle=Mi,p.validateTerrain=a=>Xs(Hh(a)),p.values=Hi,p.vectorTile=Fa,p.version=Ye,p.warnOnce=Qn,p.window=te,p.wrap=kt}),Me(0,function(p){function te(Se){if("number"==typeof Se||"boolean"==typeof Se||"string"==typeof Se||null==Se)return JSON.stringify(Se);if(Array.isArray(Se)){let Z="[";for(const _e of Se)Z+=`${te(_e)},`;return`${Z}]`}let X="{";for(const Z of Object.keys(Se).sort())X+=`${Z}:${te(Se[Z])},`;return`${X}}`}function Ye(Se){let X="";for(const Z of p.refProperties)X+=`/${te(Se[Z])}`;return X}class ne{constructor(X){this.keyCache={},X&&this.replace(X)}replace(X){this._layerConfigs={},this._layers={},this.update(X,[])}update(X,Z){for(const Re of X)this._layerConfigs[Re.id]=Re,(this._layers[Re.id]=p.createStyleLayer(Re)).compileFilter(),this.keyCache[Re.id]&&delete this.keyCache[Re.id];for(const Re of Z)delete this.keyCache[Re],delete this._layerConfigs[Re],delete this._layers[Re];this.familiesBySource={};const _e=function(Re,Be){const tt={};for(let Ne=0;Ne<Re.length;Ne++){const ct=Be&&Be[Re[Ne].id]||Ye(Re[Ne]);Be&&(Be[Re[Ne].id]=ct);let Wt=tt[ct];Wt||(Wt=tt[ct]=[]),Wt.push(Re[Ne])}const et=[];for(const Ne in tt)et.push(tt[Ne]);return et}(p.values(this._layerConfigs),this.keyCache);for(const Re of _e){const Be=Re.map(tn=>this._layers[tn.id]),tt=Be[0];if("none"===tt.visibility)continue;const et=tt.source||"";let Ne=this.familiesBySource[et];Ne||(Ne=this.familiesBySource[et]={});const ct=tt.sourceLayer||"_geojsonTileLayer";let Wt=Ne[ct];Wt||(Wt=Ne[ct]=[]),Wt.push(Be)}}}class Ve{loadTile(X,Z){const{uid:_e,encoding:Re,rawImageData:Be,padding:tt,buildQuadTree:et}=X,Ne=p.window.ImageBitmap&&Be instanceof p.window.ImageBitmap?this.getImageData(Be,tt):Be;Z(null,new p.DEMData(_e,Ne,Re,tt<1,et))}getImageData(X,Z){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(X.width,X.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=X.width,this.offscreenCanvas.height=X.height,this.offscreenCanvasContext.drawImage(X,0,0,X.width,X.height);const _e=this.offscreenCanvasContext.getImageData(-Z,-Z,X.width+2*Z,X.height+2*Z);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),_e}}function Xe(Se,X){if(0!==Se.length){gt(Se[0],X);for(var Z=1;Z<Se.length;Z++)gt(Se[Z],!X)}}function gt(Se,X){for(var Z=0,_e=0,Re=0,Be=Se.length,tt=Be-1;Re<Be;tt=Re++){var et=(Se[Re][0]-Se[tt][0])*(Se[tt][1]+Se[Re][1]),Ne=Z+et;_e+=Math.abs(Z)>=Math.abs(et)?Z-Ne+et:et-Ne+Z,Z=Ne}Z+_e>=0!=!!X&&Se.reverse()}var wt=p.getDefaultExportFromCjs(function Se(X,Z){var _e,Re=X&&X.type;if("FeatureCollection"===Re)for(_e=0;_e<X.features.length;_e++)Se(X.features[_e],Z);else if("GeometryCollection"===Re)for(_e=0;_e<X.geometries.length;_e++)Se(X.geometries[_e],Z);else if("Feature"===Re)Se(X.geometry,Z);else if("Polygon"===Re)Xe(X.coordinates,Z);else if("MultiPolygon"===Re)for(_e=0;_e<X.coordinates.length;_e++)Xe(X.coordinates[_e],Z);return X});const Ue=p.VectorTileFeature.prototype.toGeoJSON;var Ge={exports:{}},xt=p.pointGeometry,Kt=p.vectorTile.VectorTileFeature,_n=Sn;function Sn(Se,X){this.options=X||{},this.features=Se,this.length=Se.length}function st(Se,X){this.id="number"==typeof Se.id?Se.id:void 0,this.type=Se.type,this.rawGeometry=1===Se.type?[Se.geometry]:Se.geometry,this.properties=Se.tags,this.extent=X||4096}Sn.prototype.feature=function(Se){return new st(this.features[Se],this.options.extent)},st.prototype.loadGeometry=function(){var Se=this.rawGeometry;this.geometry=[];for(var X=0;X<Se.length;X++){for(var Z=Se[X],_e=[],Re=0;Re<Z.length;Re++)_e.push(new xt(Z[Re][0],Z[Re][1]));this.geometry.push(_e)}return this.geometry},st.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Se=this.geometry,X=1/0,Z=-1/0,_e=1/0,Re=-1/0,Be=0;Be<Se.length;Be++)for(var tt=Se[Be],et=0;et<tt.length;et++){var Ne=tt[et];X=Math.min(X,Ne.x),Z=Math.max(Z,Ne.x),_e=Math.min(_e,Ne.y),Re=Math.max(Re,Ne.y)}return[X,_e,Z,Re]},st.prototype.toGeoJSON=Kt.prototype.toGeoJSON;var an=p.pbf,we=_n;function ye(Se){var X=new an;return function(Z,_e){for(var Re in Z.layers)_e.writeMessage(3,Ie,Z.layers[Re])}(Se,X),X.finish()}function Ie(Se,X){var Z;X.writeVarintField(15,Se.version||1),X.writeStringField(1,Se.name||""),X.writeVarintField(5,Se.extent||4096);var _e={keys:[],values:[],keycache:{},valuecache:{}};for(Z=0;Z<Se.length;Z++)_e.feature=Se.feature(Z),X.writeMessage(2,ae,_e);var Re=_e.keys;for(Z=0;Z<Re.length;Z++)X.writeStringField(3,Re[Z]);var Be=_e.values;for(Z=0;Z<Be.length;Z++)X.writeMessage(4,mt,Be[Z])}function ae(Se,X){var Z=Se.feature;void 0!==Z.id&&X.writeVarintField(1,Z.id),X.writeMessage(2,dt,Se),X.writeVarintField(3,Z.type),X.writeMessage(4,lt,Z)}function dt(Se,X){var Z=Se.feature,_e=Se.keys,Re=Se.values,Be=Se.keycache,tt=Se.valuecache;for(var et in Z.properties){var Ne=Z.properties[et],ct=Be[et];if(null!==Ne){void 0===ct&&(_e.push(et),Be[et]=ct=_e.length-1),X.writeVarint(ct);var Wt=typeof Ne;"string"!==Wt&&"boolean"!==Wt&&"number"!==Wt&&(Ne=JSON.stringify(Ne));var tn=Wt+":"+Ne,Ut=tt[tn];void 0===Ut&&(Re.push(Ne),tt[tn]=Ut=Re.length-1),X.writeVarint(Ut)}}}function re(Se,X){return(X<<3)+(7&Se)}function me(Se){return Se<<1^Se>>31}function lt(Se,X){for(var Z=Se.loadGeometry(),_e=Se.type,Re=0,Be=0,tt=Z.length,et=0;et<tt;et++){var Ne=Z[et],ct=1;1===_e&&(ct=Ne.length),X.writeVarint(re(1,ct));for(var Wt=3===_e?Ne.length-1:Ne.length,tn=0;tn<Wt;tn++){1===tn&&1!==_e&&X.writeVarint(re(2,Wt-1));var Ut=Ne[tn].x-Re,ni=Ne[tn].y-Be;X.writeVarint(me(Ut)),X.writeVarint(me(ni)),Re+=Ut,Be+=ni}3===_e&&X.writeVarint(re(7,1))}}function mt(Se,X){var Z=typeof Se;"string"===Z?X.writeStringField(1,Se):"boolean"===Z?X.writeBooleanField(7,Se):"number"===Z&&(Se%1!=0?X.writeDoubleField(3,Se):Se<0?X.writeSVarintField(6,Se):X.writeVarintField(5,Se))}Ge.exports=ye,Ge.exports.fromVectorTileJs=ye,Ge.exports.fromGeojsonVt=function(Se,X){X=X||{};var Z={};for(var _e in Se)Z[_e]=new we(Se[_e].features,X),Z[_e].name=_e,Z[_e].version=X.version,Z[_e].extent=X.extent;return ye({layers:Z})},Ge.exports.GeoJSONWrapper=we;var je=p.getDefaultExportFromCjs(Ge.exports);const yt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Se=>Se},Tt=Math.fround||(ri=new Float32Array(1),Se=>(ri[0]=+Se,ri[0]));var ri;class Li{constructor(X){this.options=Object.assign(Object.create(yt),X),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(X){const{log:Z,minZoom:_e,maxZoom:Re}=this.options;Z&&console.time("total time");const Be=`prepare ${X.length} points`;Z&&console.time(Be),this.points=X;const tt=[];for(let Ne=0;Ne<X.length;Ne++){const ct=X[Ne];if(!ct.geometry)continue;const[Wt,tn]=ct.geometry.coordinates,Ut=Tt(xo(Wt)),ni=Tt(go(tn));tt.push(Ut,ni,1/0,Ne,-1,1),this.options.reduce&&tt.push(0)}let et=this.trees[Re+1]=this._createTree(tt);Z&&console.timeEnd(Be);for(let Ne=Re;Ne>=_e;Ne--){const ct=+Date.now();et=this.trees[Ne]=this._createTree(this._cluster(et,Ne)),Z&&console.log("z%d: %d clusters in %dms",Ne,et.numItems,+Date.now()-ct)}return Z&&console.timeEnd("total time"),this}getClusters(X,Z){let _e=((X[0]+180)%360+360)%360-180;const Re=Math.max(-90,Math.min(90,X[1]));let Be=180===X[2]?180:((X[2]+180)%360+360)%360-180;const tt=Math.max(-90,Math.min(90,X[3]));if(X[2]-X[0]>=360)_e=-180,Be=180;else if(_e>Be){const tn=this.getClusters([_e,Re,180,tt],Z),Ut=this.getClusters([-180,Re,Be,tt],Z);return tn.concat(Ut)}const et=this.trees[this._limitZoom(Z)],Ne=et.range(xo(_e),go(tt),xo(Be),go(Re)),ct=et.data,Wt=[];for(const tn of Ne){const Ut=this.stride*tn;Wt.push(ct[Ut+5]>1?yi(ct,Ut,this.clusterProps):this.points[ct[Ut+3]])}return Wt}getChildren(X){const Z=this._getOriginId(X),_e=this._getOriginZoom(X),Re="No cluster with the specified id.",Be=this.trees[_e];if(!Be)throw new Error(Re);const tt=Be.data;if(Z*this.stride>=tt.length)throw new Error(Re);const et=this.options.radius/(this.options.extent*Math.pow(2,_e-1)),Ne=Be.within(tt[Z*this.stride],tt[Z*this.stride+1],et),ct=[];for(const Wt of Ne){const tn=Wt*this.stride;tt[tn+4]===X&&ct.push(tt[tn+5]>1?yi(tt,tn,this.clusterProps):this.points[tt[tn+3]])}if(0===ct.length)throw new Error(Re);return ct}getLeaves(X,Z,_e){const Re=[];return this._appendLeaves(Re,X,Z=Z||10,_e=_e||0,0),Re}getTile(X,Z,_e){const Re=this.trees[this._limitZoom(X)],Be=Math.pow(2,X),{extent:tt,radius:et}=this.options,Ne=et/tt,ct=(_e-Ne)/Be,Wt=(_e+1+Ne)/Be,tn={features:[]};return this._addTileFeatures(Re.range((Z-Ne)/Be,ct,(Z+1+Ne)/Be,Wt),Re.data,Z,_e,Be,tn),0===Z&&this._addTileFeatures(Re.range(1-Ne/Be,ct,1,Wt),Re.data,Be,_e,Be,tn),Z===Be-1&&this._addTileFeatures(Re.range(0,ct,Ne/Be,Wt),Re.data,-1,_e,Be,tn),tn.features.length?tn:null}getClusterExpansionZoom(X){let Z=this._getOriginZoom(X)-1;for(;Z<=this.options.maxZoom;){const _e=this.getChildren(X);if(Z++,1!==_e.length)break;X=_e[0].properties.cluster_id}return Z}_appendLeaves(X,Z,_e,Re,Be){const tt=this.getChildren(Z);for(const et of tt){const Ne=et.properties;if(Ne&&Ne.cluster?Be+Ne.point_count<=Re?Be+=Ne.point_count:Be=this._appendLeaves(X,Ne.cluster_id,_e,Re,Be):Be<Re?Be++:X.push(et),X.length===_e)break}return Be}_createTree(X){const Z=new p.KDBush(X.length/this.stride|0,this.options.nodeSize,Float32Array);for(let _e=0;_e<X.length;_e+=this.stride)Z.add(X[_e],X[_e+1]);return Z.finish(),Z.data=X,Z}_addTileFeatures(X,Z,_e,Re,Be,tt){for(const et of X){const Ne=et*this.stride,ct=Z[Ne+5]>1;let Wt,tn,Ut;if(ct)Wt=Zt(Z,Ne,this.clusterProps),tn=Z[Ne],Ut=Z[Ne+1];else{const ti=this.points[Z[Ne+3]];Wt=ti.properties;const[fi,Ti]=ti.geometry.coordinates;tn=xo(fi),Ut=go(Ti)}const ni={type:1,geometry:[[Math.round(this.options.extent*(tn*Be-_e)),Math.round(this.options.extent*(Ut*Be-Re))]],tags:Wt};let pi;pi=ct||this.options.generateId?Z[Ne+3]:this.points[Z[Ne+3]].id,void 0!==pi&&(ni.id=pi),tt.features.push(ni)}}_limitZoom(X){return Math.max(this.options.minZoom,Math.min(Math.floor(+X),this.options.maxZoom+1))}_cluster(X,Z){const{radius:_e,extent:Re,reduce:Be,minPoints:tt}=this.options,et=_e/(Re*Math.pow(2,Z)),Ne=X.data,ct=[],Wt=this.stride;for(let tn=0;tn<Ne.length;tn+=Wt){if(Ne[tn+2]<=Z)continue;Ne[tn+2]=Z;const Ut=Ne[tn],ni=Ne[tn+1],pi=X.within(Ne[tn],Ne[tn+1],et),ti=Ne[tn+5];let fi=ti;for(const Ti of pi){const Fi=Ti*Wt;Ne[Fi+2]>Z&&(fi+=Ne[Fi+5])}if(fi>ti&&fi>=tt){let Ti,Fi=Ut*ti,lo=ni*ti,Qo=-1;const bo=((tn/Wt|0)<<5)+(Z+1)+this.points.length;for(const Xa of pi){const wo=Xa*Wt;if(Ne[wo+2]<=Z)continue;Ne[wo+2]=Z;const hs=Ne[wo+5];Fi+=Ne[wo]*hs,lo+=Ne[wo+1]*hs,Ne[wo+4]=bo,Be&&(Ti||(Ti=this._map(Ne,tn,!0),Qo=this.clusterProps.length,this.clusterProps.push(Ti)),Be(Ti,this._map(Ne,wo)))}Ne[tn+4]=bo,ct.push(Fi/fi,lo/fi,1/0,bo,-1,fi),Be&&ct.push(Qo)}else{for(let Ti=0;Ti<Wt;Ti++)ct.push(Ne[tn+Ti]);if(fi>1)for(const Ti of pi){const Fi=Ti*Wt;if(!(Ne[Fi+2]<=Z)){Ne[Fi+2]=Z;for(let lo=0;lo<Wt;lo++)ct.push(Ne[Fi+lo])}}}}return ct}_getOriginId(X){return X-this.points.length>>5}_getOriginZoom(X){return(X-this.points.length)%32}_map(X,Z,_e){if(X[Z+5]>1){const tt=this.clusterProps[X[Z+6]];return _e?Object.assign({},tt):tt}const Re=this.points[X[Z+3]].properties,Be=this.options.map(Re);return _e&&Be===Re?Object.assign({},Be):Be}}function yi(Se,X,Z){return{type:"Feature",id:Se[X+3],properties:Zt(Se,X,Z),geometry:{type:"Point",coordinates:[(_e=Se[X],360*(_e-.5)),Di(Se[X+1])]}};var _e}function Zt(Se,X,Z){const _e=Se[X+5],Re=_e>=1e4?`${Math.round(_e/1e3)}k`:_e>=1e3?Math.round(_e/100)/10+"k":_e,Be=Se[X+6],tt=-1===Be?{}:Object.assign({},Z[Be]);return Object.assign(tt,{cluster:!0,cluster_id:Se[X+3],point_count:_e,point_count_abbreviated:Re})}function xo(Se){return Se/360+.5}function go(Se){const X=Math.sin(Se*Math.PI/180),Z=.5-.25*Math.log((1+X)/(1-X))/Math.PI;return Z<0?0:Z>1?1:Z}function Di(Se){const X=(180-360*Se)*Math.PI/180;return 360*Math.atan(Math.exp(X))/Math.PI-90}function Ci(Se,X,Z,_e){for(var Re,Be=_e,tt=Z-X>>1,et=Z-X,Ne=Se[X],ct=Se[X+1],Wt=Se[Z],tn=Se[Z+1],Ut=X+3;Ut<Z;Ut+=3){var ni=fe(Se[Ut],Se[Ut+1],Ne,ct,Wt,tn);if(ni>Be)Re=Ut,Be=ni;else if(ni===Be){var pi=Math.abs(Ut-tt);pi<et&&(Re=Ut,et=pi)}}Be>_e&&(Re-X>3&&Ci(Se,X,Re,_e),Se[Re+2]=Be,Z-Re>3&&Ci(Se,Re,Z,_e))}function fe(Se,X,Z,_e,Re,Be){var tt=Re-Z,et=Be-_e;if(0!==tt||0!==et){var Ne=((Se-Z)*tt+(X-_e)*et)/(tt*tt+et*et);Ne>1?(Z=Re,_e=Be):Ne>0&&(Z+=tt*Ne,_e+=et*Ne)}return(tt=Se-Z)*tt+(et=X-_e)*et}function W(Se,X,Z,_e){var Re={id:void 0===Se?null:Se,type:X,geometry:Z,tags:_e,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Be){var tt=Be.geometry,et=Be.type;if("Point"===et||"MultiPoint"===et||"LineString"===et)Pt(Be,tt);else if("Polygon"===et||"MultiLineString"===et)for(var Ne=0;Ne<tt.length;Ne++)Pt(Be,tt[Ne]);else if("MultiPolygon"===et)for(Ne=0;Ne<tt.length;Ne++)for(var ct=0;ct<tt[Ne].length;ct++)Pt(Be,tt[Ne][ct])}(Re),Re}function Pt(Se,X){for(var Z=0;Z<X.length;Z+=3)Se.minX=Math.min(Se.minX,X[Z]),Se.minY=Math.min(Se.minY,X[Z+1]),Se.maxX=Math.max(Se.maxX,X[Z]),Se.maxY=Math.max(Se.maxY,X[Z+1])}function Qe(Se,X,Z,_e){if(X.geometry){var Re=X.geometry.coordinates,Be=X.geometry.type,tt=Math.pow(Z.tolerance/((1<<Z.maxZoom)*Z.extent),2),et=[],Ne=X.id;if(Z.promoteId?Ne=X.properties[Z.promoteId]:Z.generateId&&(Ne=_e||0),"Point"===Be)Ii(Re,et);else if("MultiPoint"===Be)for(var ct=0;ct<Re.length;ct++)Ii(Re[ct],et);else if("LineString"===Be)Qn(Re,et,tt,!1);else if("MultiLineString"===Be){if(Z.lineMetrics){for(ct=0;ct<Re.length;ct++)Qn(Re[ct],et=[],tt,!1),Se.push(W(Ne,"LineString",et,X.properties));return}vi(Re,et,tt,!1)}else if("Polygon"===Be)vi(Re,et,tt,!0);else{if("MultiPolygon"!==Be){if("GeometryCollection"===Be){for(ct=0;ct<X.geometry.geometries.length;ct++)Qe(Se,{id:Ne,geometry:X.geometry.geometries[ct],properties:X.properties},Z,_e);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ct=0;ct<Re.length;ct++){var Wt=[];vi(Re[ct],Wt,tt,!0),et.push(Wt)}}Se.push(W(Ne,Be,et,X.properties))}}function Ii(Se,X){X.push(qr(Se[0])),X.push(Wr(Se[1])),X.push(0)}function Qn(Se,X,Z,_e){for(var Re,Be,tt=0,et=0;et<Se.length;et++){var Ne=qr(Se[et][0]),ct=Wr(Se[et][1]);X.push(Ne),X.push(ct),X.push(0),et>0&&(tt+=_e?(Re*ct-Ne*Be)/2:Math.sqrt(Math.pow(Ne-Re,2)+Math.pow(ct-Be,2))),Re=Ne,Be=ct}var Wt=X.length-3;X[2]=1,Ci(X,0,Wt,Z),X[Wt+2]=1,X.size=Math.abs(tt),X.start=0,X.end=X.size}function vi(Se,X,Z,_e){for(var Re=0;Re<Se.length;Re++){var Be=[];Qn(Se[Re],Be,Z,_e),X.push(Be)}}function qr(Se){return Se/360+.5}function Wr(Se){var X=Math.sin(Se*Math.PI/180),Z=.5-.25*Math.log((1+X)/(1-X))/Math.PI;return Z<0?0:Z>1?1:Z}function he(Se,X,Z,_e,Re,Be,tt,et){if(_e/=X,Be>=(Z/=X)&&tt<_e)return Se;if(tt<Z||Be>=_e)return null;for(var Ne=[],ct=0;ct<Se.length;ct++){var Wt=Se[ct],tn=Wt.geometry,Ut=Wt.type,ni=0===Re?Wt.minX:Wt.minY,pi=0===Re?Wt.maxX:Wt.maxY;if(ni>=Z&&pi<_e)Ne.push(Wt);else if(!(pi<Z||ni>=_e)){var ti=[];if("Point"===Ut||"MultiPoint"===Ut)V(tn,ti,Z,_e,Re);else if("LineString"===Ut)H(tn,ti,Z,_e,Re,!1,et.lineMetrics);else if("MultiLineString"===Ut)Ke(tn,ti,Z,_e,Re,!1);else if("Polygon"===Ut)Ke(tn,ti,Z,_e,Re,!0);else if("MultiPolygon"===Ut)for(var fi=0;fi<tn.length;fi++){var Ti=[];Ke(tn[fi],Ti,Z,_e,Re,!0),Ti.length&&ti.push(Ti)}if(ti.length){if(et.lineMetrics&&"LineString"===Ut){for(fi=0;fi<ti.length;fi++)Ne.push(W(Wt.id,Ut,ti[fi],Wt.tags));continue}"LineString"!==Ut&&"MultiLineString"!==Ut||(1===ti.length?(Ut="LineString",ti=ti[0]):Ut="MultiLineString"),"Point"!==Ut&&"MultiPoint"!==Ut||(Ut=3===ti.length?"Point":"MultiPoint"),Ne.push(W(Wt.id,Ut,ti,Wt.tags))}}}return Ne.length?Ne:null}function V(Se,X,Z,_e,Re){for(var Be=0;Be<Se.length;Be+=3){var tt=Se[Be+Re];tt>=Z&&tt<=_e&&(X.push(Se[Be]),X.push(Se[Be+1]),X.push(Se[Be+2]))}}function H(Se,X,Z,_e,Re,Be,tt){for(var et,Ne,ct=Ee(Se),Wt=0===Re?en:Oi,tn=Se.start,Ut=0;Ut<Se.length-3;Ut+=3){var ni=Se[Ut],pi=Se[Ut+1],ti=Se[Ut+2],fi=Se[Ut+3],Ti=Se[Ut+4],Fi=0===Re?ni:pi,lo=0===Re?fi:Ti,Qo=!1;tt&&(et=Math.sqrt(Math.pow(ni-fi,2)+Math.pow(pi-Ti,2))),Fi<Z?lo>Z&&(Ne=Wt(ct,ni,pi,fi,Ti,Z),tt&&(ct.start=tn+et*Ne)):Fi>_e?lo<_e&&(Ne=Wt(ct,ni,pi,fi,Ti,_e),tt&&(ct.start=tn+et*Ne)):jt(ct,ni,pi,ti),lo<Z&&Fi>=Z&&(Ne=Wt(ct,ni,pi,fi,Ti,Z),Qo=!0),lo>_e&&Fi<=_e&&(Ne=Wt(ct,ni,pi,fi,Ti,_e),Qo=!0),!Be&&Qo&&(tt&&(ct.end=tn+et*Ne),X.push(ct),ct=Ee(Se)),tt&&(tn+=et)}var bo=Se.length-3;ni=Se[bo],pi=Se[bo+1],ti=Se[bo+2],(Fi=0===Re?ni:pi)>=Z&&Fi<=_e&&jt(ct,ni,pi,ti),bo=ct.length-3,Be&&bo>=3&&(ct[bo]!==ct[0]||ct[bo+1]!==ct[1])&&jt(ct,ct[0],ct[1],ct[2]),ct.length&&X.push(ct)}function Ee(Se){var X=[];return X.size=Se.size,X.start=Se.start,X.end=Se.end,X}function Ke(Se,X,Z,_e,Re,Be){for(var tt=0;tt<Se.length;tt++)H(Se[tt],X,Z,_e,Re,Be,!1)}function jt(Se,X,Z,_e){Se.push(X),Se.push(Z),Se.push(_e)}function en(Se,X,Z,_e,Re,Be){var tt=(Be-X)/(_e-X);return Se.push(Be),Se.push(Z+(Re-Z)*tt),Se.push(1),tt}function Oi(Se,X,Z,_e,Re,Be){var tt=(Be-Z)/(Re-Z);return Se.push(X+(_e-X)*tt),Se.push(Be),Se.push(1),tt}function Si(Se,X){for(var Z=[],_e=0;_e<Se.length;_e++){var Re,Be=Se[_e],tt=Be.type;if("Point"===tt||"MultiPoint"===tt||"LineString"===tt)Re=er(Be.geometry,X);else if("MultiLineString"===tt||"Polygon"===tt){Re=[];for(var et=0;et<Be.geometry.length;et++)Re.push(er(Be.geometry[et],X))}else if("MultiPolygon"===tt)for(Re=[],et=0;et<Be.geometry.length;et++){for(var Ne=[],ct=0;ct<Be.geometry[et].length;ct++)Ne.push(er(Be.geometry[et][ct],X));Re.push(Ne)}Z.push(W(Be.id,tt,Re,Be.tags))}return Z}function er(Se,X){var Z=[];Z.size=Se.size,void 0!==Se.start&&(Z.start=Se.start,Z.end=Se.end);for(var _e=0;_e<Se.length;_e+=3)Z.push(Se[_e]+X,Se[_e+1],Se[_e+2]);return Z}function Jr(Se,X){if(Se.transformed)return Se;var Z,_e,Re,Be=1<<Se.z,tt=Se.x,et=Se.y;for(Z=0;Z<Se.features.length;Z++){var Ne=Se.features[Z],ct=Ne.geometry,Wt=Ne.type;if(Ne.geometry=[],1===Wt)for(_e=0;_e<ct.length;_e+=2)Ne.geometry.push(br(ct[_e],ct[_e+1],X,Be,tt,et));else for(_e=0;_e<ct.length;_e++){var tn=[];for(Re=0;Re<ct[_e].length;Re+=2)tn.push(br(ct[_e][Re],ct[_e][Re+1],X,Be,tt,et));Ne.geometry.push(tn)}}return Se.transformed=!0,Se}function br(Se,X,Z,_e,Re,Be){return[Math.round(Z*(Se*_e-Re)),Math.round(Z*(X*_e-Be))]}function ba(Se,X,Z,_e,Re){for(var Be=X===Re.maxZoom?0:Re.tolerance/((1<<X)*Re.extent),tt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Z,y:_e,z:X,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},et=0;et<Se.length;et++){tt.numFeatures++,ds(tt,Se[et],Be,Re);var Ne=Se[et].minX,ct=Se[et].minY,Wt=Se[et].maxX,tn=Se[et].maxY;Ne<tt.minX&&(tt.minX=Ne),ct<tt.minY&&(tt.minY=ct),Wt>tt.maxX&&(tt.maxX=Wt),tn>tt.maxY&&(tt.maxY=tn)}return tt}function ds(Se,X,Z,_e){var Re=X.geometry,Be=X.type,tt=[];if("Point"===Be||"MultiPoint"===Be)for(var et=0;et<Re.length;et+=3)tt.push(Re[et]),tt.push(Re[et+1]),Se.numPoints++,Se.numSimplified++;else if("LineString"===Be)_a(tt,Re,Se,Z,!1,!1);else if("MultiLineString"===Be||"Polygon"===Be)for(et=0;et<Re.length;et++)_a(tt,Re[et],Se,Z,"Polygon"===Be,0===et);else if("MultiPolygon"===Be)for(var Ne=0;Ne<Re.length;Ne++){var ct=Re[Ne];for(et=0;et<ct.length;et++)_a(tt,ct[et],Se,Z,!0,0===et)}if(tt.length){var Wt=X.tags||null;if("LineString"===Be&&_e.lineMetrics){for(var tn in Wt={},X.tags)Wt[tn]=X.tags[tn];Wt.mapbox_clip_start=Re.start/Re.size,Wt.mapbox_clip_end=Re.end/Re.size}var Ut={geometry:tt,type:"Polygon"===Be||"MultiPolygon"===Be?3:"LineString"===Be||"MultiLineString"===Be?2:1,tags:Wt};null!==X.id&&(Ut.id=X.id),Se.features.push(Ut)}}function _a(Se,X,Z,_e,Re,Be){var tt=_e*_e;if(_e>0&&X.size<(Re?tt:_e))Z.numPoints+=X.length/3;else{for(var et=[],Ne=0;Ne<X.length;Ne+=3)(0===_e||X[Ne+2]>tt)&&(Z.numSimplified++,et.push(X[Ne]),et.push(X[Ne+1])),Z.numPoints++;Re&&function(ct,Wt){for(var tn=0,Ut=0,ni=ct.length,pi=ni-2;Ut<ni;pi=Ut,Ut+=2)tn+=(ct[Ut]-ct[pi])*(ct[Ut+1]+ct[pi+1]);if(tn>0===Wt)for(Ut=0,ni=ct.length;Ut<ni/2;Ut+=2){var ti=ct[Ut],fi=ct[Ut+1];ct[Ut]=ct[ni-2-Ut],ct[Ut+1]=ct[ni-1-Ut],ct[ni-2-Ut]=ti,ct[ni-1-Ut]=fi}}(et,Be),Se.push(et)}}function ql(Se,X){var Z=(X=this.options=function(Re,Be){for(var tt in Be)Re[tt]=Be[tt];return Re}(Object.create(this.options),X)).debug;if(Z&&console.time("preprocess data"),X.maxZoom<0||X.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(X.promoteId&&X.generateId)throw new Error("promoteId and generateId cannot be used together.");var Re,Be,tt,et,Ne,ct,_e=function(Re,Be){var tt=[];if("FeatureCollection"===Re.type)for(var et=0;et<Re.features.length;et++)Qe(tt,Re.features[et],Be,et);else Qe(tt,"Feature"===Re.type?Re:{geometry:Re},Be);return tt}(Se,X);this.tiles={},this.tileCoords=[],Z&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",X.indexMaxZoom,X.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),et=Re=_e,Ne=he(Re,1,-1-(tt=(Be=X).buffer/Be.extent),tt,0,-1,2,Be),ct=he(Re,1,1-tt,2+tt,0,-1,2,Be),(Ne||ct)&&(et=he(Re,1,-tt,1+tt,0,-1,2,Be)||[],Ne&&(et=Si(Ne,1).concat(et)),ct&&(et=et.concat(Si(ct,-1)))),(_e=et).length&&this.splitTile(_e,0,0,0),Z&&(_e.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Wl(Se,X,Z){return 32*((1<<Se)*Z+X)+Se}function Ac(Se,X){const Z=Se.tileID.canonical;if(!this._geoJSONIndex)return X(null,null);const _e=this._geoJSONIndex.getTile(Z.z,Z.x,Z.y);if(!_e)return X(null,null);const Re=new class{constructor(tt){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=p.EXTENT,this.length=tt.length,this._features=tt}feature(tt){return new class{constructor(et){this._feature=et,this.extent=p.EXTENT,this.type=et.type,this.properties=et.tags,"id"in et&&!isNaN(et.id)&&(this.id=parseInt(et.id,10))}loadGeometry(){if(1===this._feature.type){const et=[];for(const Ne of this._feature.geometry)et.push([new p.Point(Ne[0],Ne[1])]);return et}{const et=[];for(const Ne of this._feature.geometry){const ct=[];for(const Wt of Ne)ct.push(new p.Point(Wt[0],Wt[1]));et.push(ct)}return et}}toGeoJSON(et,Ne,ct){return Ue.call(this,et,Ne,ct)}}(this._features[tt])}}(_e.features);let Be=je(Re);0===Be.byteOffset&&Be.byteLength===Be.buffer.byteLength||(Be=new Uint8Array(Be)),X(null,{vectorTile:Re,rawData:Be.buffer})}ql.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ql.prototype.splitTile=function(Se,X,Z,_e,Re,Be,tt){for(var et=[Se,X,Z,_e],Ne=this.options,ct=Ne.debug;et.length;){_e=et.pop(),Z=et.pop(),X=et.pop(),Se=et.pop();var Wt=1<<X,tn=Wl(X,Z,_e),Ut=this.tiles[tn];if(!Ut&&(ct>1&&console.time("creation"),Ut=this.tiles[tn]=ba(Se,X,Z,_e,Ne),this.tileCoords.push({z:X,x:Z,y:_e}),ct)){ct>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",X,Z,_e,Ut.numFeatures,Ut.numPoints,Ut.numSimplified),console.timeEnd("creation"));var ni="z"+X;this.stats[ni]=(this.stats[ni]||0)+1,this.total++}if(Ut.source=Se,Re){if(X===Ne.maxZoom||X===Re)continue;var pi=1<<Re-X;if(Z!==Math.floor(Be/pi)||_e!==Math.floor(tt/pi))continue}else if(X===Ne.indexMaxZoom||Ut.numPoints<=Ne.indexMaxPoints)continue;if(Ut.source=null,0!==Se.length){ct>1&&console.time("clipping");var ti,fi,Ti,Fi,lo,Qo,bo=.5*Ne.buffer/Ne.extent,Xa=.5-bo,wo=.5+bo,hs=1+bo;ti=fi=Ti=Fi=null,lo=he(Se,Wt,Z-bo,Z+wo,0,Ut.minX,Ut.maxX,Ne),Qo=he(Se,Wt,Z+Xa,Z+hs,0,Ut.minX,Ut.maxX,Ne),Se=null,lo&&(ti=he(lo,Wt,_e-bo,_e+wo,1,Ut.minY,Ut.maxY,Ne),fi=he(lo,Wt,_e+Xa,_e+hs,1,Ut.minY,Ut.maxY,Ne),lo=null),Qo&&(Ti=he(Qo,Wt,_e-bo,_e+wo,1,Ut.minY,Ut.maxY,Ne),Fi=he(Qo,Wt,_e+Xa,_e+hs,1,Ut.minY,Ut.maxY,Ne),Qo=null),ct>1&&console.timeEnd("clipping"),et.push(ti||[],X+1,2*Z,2*_e),et.push(fi||[],X+1,2*Z,2*_e+1),et.push(Ti||[],X+1,2*Z+1,2*_e),et.push(Fi||[],X+1,2*Z+1,2*_e+1)}}},ql.prototype.getTile=function(Se,X,Z){var _e=this.options,Re=_e.extent,Be=_e.debug;if(Se<0||Se>24)return null;var tt=1<<Se,et=Wl(Se,X=(X%tt+tt)%tt,Z);if(this.tiles[et])return Jr(this.tiles[et],Re);Be>1&&console.log("drilling down to z%d-%d-%d",Se,X,Z);for(var Ne,ct=Se,Wt=X,tn=Z;!Ne&&ct>0;)ct--,Wt=Math.floor(Wt/2),tn=Math.floor(tn/2),Ne=this.tiles[Wl(ct,Wt,tn)];return Ne&&Ne.source?(Be>1&&console.log("found parent tile z%d-%d-%d",ct,Wt,tn),Be>1&&console.time("drilling down"),this.splitTile(Ne.source,ct,Wt,tn,Se,X,Z),Be>1&&console.timeEnd("drilling down"),this.tiles[et]?Jr(this.tiles[et],Re):null):null};class du extends p.VectorTileWorkerSource{constructor(X,Z,_e,Re,Be){super(X,Z,_e,Re,Ac),Be&&(this.loadGeoJSON=Be)}loadData(X,Z){const _e=X&&X.request,Re=_e&&_e.collectResourceTiming;this.loadGeoJSON(X,(Be,tt)=>{if(Be||!tt)return Z(Be);if("object"!=typeof tt)return Z(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`));{wt(tt,!0);try{if(X.filter){const Ne=p.createExpression(X.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===Ne.result)throw new Error(Ne.value.map(Wt=>`${Wt.key}: ${Wt.message}`).join(", "));const ct=tt.features.filter(Wt=>Ne.value.evaluate({zoom:0},Wt));tt={type:"FeatureCollection",features:ct}}this._geoJSONIndex=X.cluster?new Li(function({superclusterOptions:Ne,clusterProperties:ct}){if(!ct||!Ne)return Ne;const Wt={},tn={},Ut={accumulated:null,zoom:0},ni={properties:null},pi=Object.keys(ct);for(const ti of pi){const[fi,Ti]=ct[ti],Fi=p.createExpression(Ti),lo=p.createExpression("string"==typeof fi?[fi,["accumulated"],["get",ti]]:fi);Wt[ti]=Fi.value,tn[ti]=lo.value}return Ne.map=ti=>{ni.properties=ti;const fi={};for(const Ti of pi)fi[Ti]=Wt[Ti].evaluate(Ut,ni);return fi},Ne.reduce=(ti,fi)=>{ni.properties=fi;for(const Ti of pi)Ut.accumulated=ti[Ti],ti[Ti]=tn[Ti].evaluate(Ut,ni)},Ne}(X)).load(tt.features):new ql(Ne=tt,X.geojsonVtOptions)}catch(Ne){return Z(Ne)}this.loaded={};const et={};if(Re){const Ne=p.getPerformanceMeasurement(_e);Ne&&(et.resourceTiming={},et.resourceTiming[X.source]=JSON.parse(JSON.stringify(Ne)))}Z(null,et)}var Ne})}reloadTile(X,Z){const _e=this.loaded;return _e&&_e[X.uid]?super.reloadTile(X,Z):this.loadTile(X,Z)}loadGeoJSON(X,Z){if(X.request)p.getJSON(X.request,Z);else{if("string"!=typeof X.data)return Z(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`));try{return Z(null,JSON.parse(X.data))}catch(_e){return Z(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(X,Z){try{Z(null,this._geoJSONIndex.getClusterExpansionZoom(X.clusterId))}catch(_e){Z(_e)}}getClusterChildren(X,Z){try{Z(null,this._geoJSONIndex.getChildren(X.clusterId))}catch(_e){Z(_e)}}getClusterLeaves(X,Z){try{Z(null,this._geoJSONIndex.getLeaves(X.clusterId,X.limit,X.offset))}catch(_e){Z(_e)}}}class Ch{constructor(X){this.self=X,this.actor=new p.Actor(X,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=p.getProjection({name:"mercator"}),this.workerSourceTypes={vector:p.VectorTileWorkerSource,geojson:du},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(Z,_e)=>{if(this.workerSourceTypes[Z])throw new Error(`Worker source with name "${Z}" already registered.`);this.workerSourceTypes[Z]=_e},this.self.registerRTLTextPlugin=Z=>{if(p.plugin.isParsed())throw new Error("RTL text plugin already registered.");p.plugin.applyArabicShaping=Z.applyArabicShaping,p.plugin.processBidirectionalText=Z.processBidirectionalText,p.plugin.processStyledBidirectionalText=Z.processStyledBidirectionalText}}clearCaches(X,Z,_e){delete this.layerIndexes[X],delete this.availableImages[X],delete this.workerSources[X],delete this.demWorkerSources[X],_e()}checkIfReady(X,Z,_e){_e()}setReferrer(X,Z){this.referrer=Z}spriteLoaded(X,Z){this.isSpriteLoaded[X]=Z;for(const _e in this.workerSources[X]){const Re=this.workerSources[X][_e];for(const Be in Re)Re[Be]instanceof p.VectorTileWorkerSource&&(Re[Be].isSpriteLoaded=Z,Re[Be].fire(new p.Event("isSpriteLoaded")))}}setImages(X,Z,_e){this.availableImages[X]=Z;for(const Re in this.workerSources[X]){const Be=this.workerSources[X][Re];for(const tt in Be)Be[tt].availableImages=Z}_e()}enableTerrain(X,Z,_e){this.terrain=Z,_e()}setProjection(X,Z){this.projections[X]=p.getProjection(Z)}setLayers(X,Z,_e){this.getLayerIndex(X).replace(Z),_e()}updateLayers(X,Z,_e){this.getLayerIndex(X).update(Z.layers,Z.removedIds),_e()}loadTile(X,Z,_e){const Re=this.enableTerrain?p.extend({enableTerrain:this.terrain},Z):Z;Re.projection=this.projections[X]||this.defaultProjection,this.getWorkerSource(X,Z.type,Z.source).loadTile(Re,_e)}loadDEMTile(X,Z,_e){const Re=this.enableTerrain?p.extend({buildQuadTree:this.terrain},Z):Z;this.getDEMWorkerSource(X,Z.source).loadTile(Re,_e)}reloadTile(X,Z,_e){const Re=this.enableTerrain?p.extend({enableTerrain:this.terrain},Z):Z;Re.projection=this.projections[X]||this.defaultProjection,this.getWorkerSource(X,Z.type,Z.source).reloadTile(Re,_e)}abortTile(X,Z,_e){this.getWorkerSource(X,Z.type,Z.source).abortTile(Z,_e)}removeTile(X,Z,_e){this.getWorkerSource(X,Z.type,Z.source).removeTile(Z,_e)}removeSource(X,Z,_e){if(!this.workerSources[X]||!this.workerSources[X][Z.type]||!this.workerSources[X][Z.type][Z.source])return;const Re=this.workerSources[X][Z.type][Z.source];delete this.workerSources[X][Z.type][Z.source],void 0!==Re.removeSource?Re.removeSource(Z,_e):_e()}loadWorkerSource(X,Z,_e){try{this.self.importScripts(Z.url),_e()}catch(Re){_e(Re.toString())}}syncRTLPluginState(X,Z,_e){try{p.plugin.setState(Z);const Re=p.plugin.getPluginURL();if(p.plugin.isLoaded()&&!p.plugin.isParsed()&&null!=Re){this.self.importScripts(Re);const Be=p.plugin.isParsed();_e(Be?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Re}`),Be)}}catch(Re){_e(Re.toString())}}getAvailableImages(X){let Z=this.availableImages[X];return Z||(Z=[]),Z}getLayerIndex(X){let Z=this.layerIndexes[X];return Z||(Z=this.layerIndexes[X]=new ne),Z}getWorkerSource(X,Z,_e){return this.workerSources[X]||(this.workerSources[X]={}),this.workerSources[X][Z]||(this.workerSources[X][Z]={}),this.workerSources[X][Z][_e]||(this.workerSources[X][Z][_e]=new this.workerSourceTypes[Z]({send:(Be,tt,et,Ne,ct,Wt)=>{this.actor.send(Be,tt,et,X,ct,Wt)},scheduler:this.actor.scheduler},this.getLayerIndex(X),this.getAvailableImages(X),this.isSpriteLoaded[X])),this.workerSources[X][Z][_e]}getDEMWorkerSource(X,Z){return this.demWorkerSources[X]||(this.demWorkerSources[X]={}),this.demWorkerSources[X][Z]||(this.demWorkerSources[X][Z]=new Ve),this.demWorkerSources[X][Z]}enforceCacheSizeLimit(X,Z){p.enforceCacheSizeLimit(Z)}getWorkerPerformanceMetrics(X,Z,_e){_e(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new Ch(self)),Ch}),Me(0,function(p){function te(g,c){if(Array.isArray(g)){if(!Array.isArray(c)||g.length!==c.length)return!1;for(let h=0;h<g.length;h++)if(!te(g[h],c[h]))return!1;return!0}if("object"==typeof g&&null!==g&&null!==c){if("object"!=typeof c||Object.keys(g).length!==Object.keys(c).length)return!1;for(const h in g)if(!te(g[h],c[h]))return!1;return!0}return g===c}var Ye=ne;function ne(g){return c=g,!("undefined"==typeof window||"undefined"==typeof document||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var _,x,S=new Blob([""],{type:"text/javascript"}),D=URL.createObjectURL(S);try{x=new Worker(D),_=!0}catch(I){_=!1}return x&&x.terminate(),URL.revokeObjectURL(D),_}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var _=document.createElement("canvas");_.width=_.height=1;var x=_.getContext("2d");if(!x)return!1;var S=x.getImageData(0,0,1,1);return S&&S.width===_.width}()||(void 0===Ve[h=c&&c.failIfMajorPerformanceCaveat]&&(Ve[h]=function(_){var x,D,I,R,S=(D=_,I=document.createElement("canvas"),(R=Object.create(ne.webGLContextAttributes)).failIfMajorPerformanceCaveat=D,I.getContext("webgl",R)||I.getContext("experimental-webgl",R));if(!S)return!1;try{x=S.createShader(S.VERTEX_SHADER)}catch(D){return!1}return!(!x||S.isContextLost())&&(S.shaderSource(x,"void main() {}"),S.compileShader(x),!0===S.getShaderParameter(x,S.COMPILE_STATUS))}(h)),!Ve[h]||document.documentMode));var c,h}var Ve={};function Xe(g,c,h){const _=p.window.document.createElement(g);return void 0!==c&&(_.className=c),h&&h.appendChild(_),_}function gt(g,c,h){const _=p.window.document.createElementNS("http://www.w3.org/2000/svg",g);for(const x of Object.keys(c))_.setAttributeNS(null,x,c[x]);return h&&h.appendChild(_),_}ne.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const wt=p.window.document&&p.window.document.documentElement.style,Ue=wt&&void 0!==wt.userSelect?"userSelect":"WebkitUserSelect";let Ge;function xt(){wt&&Ue&&(Ge=wt[Ue],wt[Ue]="none")}function Kt(){wt&&Ue&&(wt[Ue]=Ge)}function _n(g){g.preventDefault(),g.stopPropagation(),p.window.removeEventListener("click",_n,!0)}function Sn(){p.window.addEventListener("click",_n,!0),p.window.setTimeout(()=>{p.window.removeEventListener("click",_n,!0)},0)}function st(g,c){const h=g.getBoundingClientRect();return ye(g,h,c)}function an(g,c){const h=g.getBoundingClientRect(),_=[];for(let x=0;x<c.length;x++)_.push(ye(g,h,c[x]));return _}function we(g){return void 0!==p.window.InstallTrigger&&2===g.button&&g.ctrlKey&&p.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:g.button}function ye(g,c,h){const _=g.offsetWidth===c.width?1:g.offsetWidth/c.width;return new p.Point((h.clientX-c.left)*_,(h.clientY-c.top)*_)}function Ie(g,c){var h=c[0],_=c[1],x=c[2],S=c[3],D=h*S-x*_;return D?(g[0]=S*(D=1/D),g[1]=-_*D,g[2]=-x*D,g[3]=h*D,g):null}function ae(g){const{userImage:c}=g;return!!(c&&c.render&&c.render())&&(g.data.replace(new Uint8Array(c.data.buffer)),!0)}class dt extends p.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new p.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(c){if(this.loaded!==c&&(this.loaded=c,c)){for(const{ids:h,callback:_}of this.requestors)this._notify(h,_);this.requestors=[]}}hasImage(c){return!!this.getImage(c)}getImage(c){return this.images[c]}addImage(c,h){this._validate(c,h)&&(this.images[c]=h)}_validate(c,h){let _=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new p.ErrorEvent(new Error(`Image "${c}" has invalid "stretchX" value`))),_=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new p.ErrorEvent(new Error(`Image "${c}" has invalid "stretchY" value`))),_=!1),this._validateContent(h.content,h)||(this.fire(new p.ErrorEvent(new Error(`Image "${c}" has invalid "content" value`))),_=!1),_}_validateStretch(c,h){if(!c)return!0;let _=0;for(const x of c){if(x[0]<_||x[1]<x[0]||h<x[1])return!1;_=x[1]}return!0}_validateContent(c,h){return!(c&&(4!==c.length||c[0]<0||h.data.width<c[0]||c[1]<0||h.data.height<c[1]||c[2]<0||h.data.width<c[2]||c[3]<0||h.data.height<c[3]||c[2]<c[0]||c[3]<c[1]))}updateImage(c,h){h.version=this.images[c].version+1,this.images[c]=h,this.updatedImages[c]=!0}removeImage(c){const h=this.images[c];delete this.images[c],delete this.patterns[c],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(c,h){let _=!0;if(!this.isLoaded())for(const x of c)this.images[x]||(_=!1);this.isLoaded()||_?this._notify(c,h):this.requestors.push({ids:c,callback:h})}_notify(c,h){const _={};for(const x of c){this.images[x]||this.fire(new p.Event("styleimagemissing",{id:x}));const S=this.images[x];S?_[x]={data:S.data.clone(),pixelRatio:S.pixelRatio,sdf:S.sdf,version:S.version,stretchX:S.stretchX,stretchY:S.stretchY,content:S.content,hasRenderCallback:Boolean(S.userImage&&S.userImage.render)}:p.warnOnce(`Image "${x}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}h(null,_)}getPixelSize(){const{width:c,height:h}=this.atlasImage;return{width:c,height:h}}getPattern(c){const h=this.patterns[c],_=this.getImage(c);if(!_)return null;if(h&&h.position.version===_.version)return h.position;if(h)h.position.version=_.version;else{const x={w:_.data.width+2,h:_.data.height+2,x:0,y:0},S=new p.ImagePosition(x,_);this.patterns[c]={bin:x,position:S}}return this._updatePatternAtlas(),this.patterns[c].position}bind(c){const h=c.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new p.Texture(c,this.atlasImage,h.RGBA),this.atlasTexture&&this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const c=[];for(const S in this.patterns)c.push(this.patterns[S].bin);const{w:h,h:_}=p.potpack(c),x=this.atlasImage;x.resize({width:h||1,height:_||1});for(const S in this.patterns){const{bin:D}=this.patterns[S],I=D.x+1,R=D.y+1,O=this.images[S].data,F=O.width,j=O.height;p.RGBAImage.copy(O,x,{x:0,y:0},{x:I,y:R},{width:F,height:j}),p.RGBAImage.copy(O,x,{x:0,y:j-1},{x:I,y:R-1},{width:F,height:1}),p.RGBAImage.copy(O,x,{x:0,y:0},{x:I,y:R+j},{width:F,height:1}),p.RGBAImage.copy(O,x,{x:F-1,y:0},{x:I-1,y:R},{width:1,height:j}),p.RGBAImage.copy(O,x,{x:0,y:0},{x:I+F,y:R},{width:1,height:j})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(c){for(const h of c){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const _=this.images[h];ae(_)&&this.updateImage(h,_)}}}const re=new p.Properties({anchor:new p.DataConstantProperty(p.spec.light.anchor),position:new class{constructor(){this.specification=p.spec.light.position}possiblyEvaluate(g,c){return function([h,_,x]){const S=p.degToRad(_+90),D=p.degToRad(x);return{x:h*Math.cos(S)*Math.sin(D),y:h*Math.sin(S)*Math.sin(D),z:h*Math.cos(D),azimuthal:_,polar:x}}(g.expression.evaluate(c))}interpolate(g,c,h){return{x:p.number(g.x,c.x,h),y:p.number(g.y,c.y,h),z:p.number(g.z,c.z,h),azimuthal:p.number(g.azimuthal,c.azimuthal,h),polar:p.number(g.polar,c.polar,h)}}},color:new p.DataConstantProperty(p.spec.light.color),intensity:new p.DataConstantProperty(p.spec.light.intensity)});class me extends p.Evented{constructor(c){super(),this._transitionable=new p.Transitionable(re),this.setLight(c),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(c,h={}){if(!this._validate(p.validateLight,c,h))for(const _ in c){const x=c[_];p.endsWith(_,"-transition")?this._transitionable.setTransition(_.slice(0,-11),x):this._transitionable.setValue(_,x)}}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,h,_){return(!_||!1!==_.validate)&&p.emitValidationErrors(this,c.call(p.validateStyle,p.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:p.spec})))}}const lt=new p.Properties({source:new p.DataConstantProperty(p.spec.terrain.source),exaggeration:new p.DataConstantProperty(p.spec.terrain.exaggeration)});let mt=class extends p.Evented{constructor(g,c){super(),this._transitionable=new p.Transitionable(lt),this.set(g),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=c}get(){return this._transitionable.serialize()}set(g){for(const c in g){const h=g[c];p.endsWith(c,"-transition")?this._transitionable.setTransition(c.slice(0,-11),h):this._transitionable.setValue(c,h)}}updateTransitions(g){this._transitioning=this._transitionable.transitioned(g,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(g){this.properties=this._transitioning.possiblyEvaluate(g)}};function je(g,c,h,_){const x=p.smoothstep(45,65,h),[S,D]=yt(g,_),I=p.length(c);let R=1-Math.min(1,Math.exp((I-S)/(D-S)*-6));return R*=R*R,R=Math.min(1,1.00747*R),R*x*g.alpha}function yt(g,c){const h=.5/Math.tan(.5*c);return[g.range[0]+h,g.range[1]+h]}const Tt=new p.Properties({range:new p.DataConstantProperty(p.spec.fog.range),color:new p.DataConstantProperty(p.spec.fog.color),"high-color":new p.DataConstantProperty(p.spec.fog["high-color"]),"space-color":new p.DataConstantProperty(p.spec.fog["space-color"]),"horizon-blend":new p.DataConstantProperty(p.spec.fog["horizon-blend"]),"star-intensity":new p.DataConstantProperty(p.spec.fog["star-intensity"])});class ri extends p.Evented{constructor(c,h){super(),this._transitionable=new p.Transitionable(Tt),this.set(c),this._transitioning=this._transitionable.untransitioned(),this._transform=h}get state(){const c=this._transform,h="globe"===c.projection.name,_=p.globeToMercatorTransition(c.zoom),x=this.properties.get("range"),S=[.5,3];return{range:h?[p.number(S[0],x[0],_),p.number(S[1],x[1],_)]:x,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(c,h={}){if(!this._validate(p.validateFog,c,h)){for(const _ of Object.keys(p.spec.fog))c&&void 0===c[_]&&(c[_]=p.spec.fog[_].default);for(const _ in c){const x=c[_];p.endsWith(_,"-transition")?this._transitionable.setTransition(_.slice(0,-11),x):this._transitionable.setValue(_,x)}}}getOpacity(c){if(!this._transform.projection.supportsFog)return 0;const h=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:p.smoothstep(45,65,c))*h.a}getOpacityAtLatLng(c,h){return this._transform.projection.supportsFog?function(_,x,S){const D=p.MercatorCoordinate.fromLngLat(x),I=S.elevation?S.elevation.getAtPointOrZero(D):0,R=[D.x,D.y,I];return p.transformMat4(R,R,S.mercatorFogMatrix),je(_,R,S.pitch,S._fov)}(this.state,c,h):0}getFovAdjustedRange(c){return this._transform.projection.supportsFog?yt(this.state,c):[0,1]}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,h,_){return(!_||!1!==_.validate)&&p.emitValidationErrors(this,c.call(p.validateStyle,p.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:p.spec})))}}class kt{constructor(c,h){this.workerPool=c,this.actors=[],this.currentActor=0,this.id=p.uniqueId();const _=this.workerPool.acquire(this.id);for(let x=0;x<_.length;x++){const S=new kt.Actor(_[x],h,this.id);S.name=`Worker ${x}`,this.actors.push(S)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(c,h,_){p.asyncAll(this.actors,(x,S)=>{x.send(c,h,S)},_=_||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(c=>{c.remove()}),this.actors=[],this.workerPool.release(this.id)}}function cn(g,c,h){return c*(p.EXTENT/(g.tileSize*Math.pow(2,h-g.tileID.overscaledZ)))}kt.Actor=p.Actor;class Hi{constructor(c,h,_,x){this.screenBounds=c,this.cameraPoint=h,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=_,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,x)}static createFromScreenPoints(c,h){let _,x;if(c instanceof p.Point||"number"==typeof c[0]){const S=p.Point.convert(c);_=[S],x=h.isPointAboveHorizon(S)}else{const S=p.Point.convert(c[0]),D=p.Point.convert(c[1]);_=[S,D],x=p.polygonizeBounds(S,D).every(I=>h.isPointAboveHorizon(I))}return new Hi(_,h.getCameraPoint(),x,h)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(c){return p.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],c)}bufferedCameraGeometry(c){const h=this.screenBounds[0],_=1===this.screenBounds.length?this.screenBounds[0].add(new p.Point(1,1)):this.screenBounds[1],x=p.polygonizeBounds(h,_,0,!1);return this.cameraPoint.y>_.y&&(this.cameraPoint.x>h.x&&this.cameraPoint.x<_.x?x.splice(3,0,this.cameraPoint):this.cameraPoint.x>=_.x?x[2]=this.cameraPoint:this.cameraPoint.x<=h.x&&(x[3]=this.cameraPoint)),p.bufferConvexPolygon(x,c)}bufferedCameraGeometryGlobe(c){const h=this.screenBounds[0],_=1===this.screenBounds.length?this.screenBounds[0].add(new p.Point(1,1)):this.screenBounds[1],x=p.polygonizeBounds(h,_,c),S=this.cameraPoint.clone();switch(3*((S.y>h.y)+(S.y>_.y))+((S.x>h.x)+(S.x>_.x))){case 0:x[0]=S,x[4]=S.clone();break;case 1:x.splice(1,0,S);break;case 2:x[1]=S;break;case 3:x.splice(4,0,S);break;case 5:x.splice(2,0,S);break;case 6:x[3]=S;break;case 7:x.splice(3,0,S);break;case 8:x[2]=S}return x}containsTile(c,h,_,x=0){const S=c.queryPadding/h._pixelsPerMercatorPixel+1,D=_?this._bufferedCameraMercator(S,h):this._bufferedScreenMercator(S,h);let I=c.tileID.wrap+(D.unwrapped?x:0);const R=D.polygon.map(le=>p.getTilePoint(c.tileTransform,le,I));if(!p.polygonIntersectsBox(R,0,0,p.EXTENT,p.EXTENT))return;I=c.tileID.wrap+(this.screenGeometryMercator.unwrapped?x:0);const O=this.screenGeometryMercator.polygon.map(le=>p.getTileVec3(c.tileTransform,le,I)),F=O.map(le=>new p.Point(le[0],le[1])),j=h.getFreeCameraOptions().position||new p.MercatorCoordinate(0,0,0),Y=p.getTileVec3(c.tileTransform,j,I),ee=O.map(le=>{const U=p.sub(le,le,Y);return p.normalize(U,U),new p.Ray(Y,U)}),se=cn(c,1,h.zoom)*h._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:F,tilespaceRays:ee,bufferedTilespaceGeometry:R,bufferedTilespaceBounds:(ie=p.getBounds(R),ie.min.x=p.clamp(ie.min.x,0,p.EXTENT),ie.min.y=p.clamp(ie.min.y,0,p.EXTENT),ie.max.x=p.clamp(ie.max.x,0,p.EXTENT),ie.max.y=p.clamp(ie.max.y,0,p.EXTENT),ie),tile:c,tileID:c.tileID,pixelToTileUnitsFactor:se};var ie}_bufferedScreenMercator(c,h){const _=Zt(c);if(this._screenRaycastCache[_])return this._screenRaycastCache[_];{let x;return x="globe"===h.projection.name?this._projectAndResample(this.bufferedScreenGeometry(c),h):{polygon:this.bufferedScreenGeometry(c).map(S=>h.pointCoordinate3D(S)),unwrapped:!0},this._screenRaycastCache[_]=x,x}}_bufferedCameraMercator(c,h){const _=Zt(c);if(this._cameraRaycastCache[_])return this._cameraRaycastCache[_];{let x;return x="globe"===h.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(c),h):{polygon:this.bufferedCameraGeometry(c).map(S=>h.pointCoordinate3D(S)),unwrapped:!0},this._cameraRaycastCache[_]=x,x}}_projectAndResample(c,h){const _=function(S,D){const I=p.multiply([],D.pixelMatrix,D.globeMatrix),R=[0,-p.GLOBE_RADIUS,0,1],O=[0,p.GLOBE_RADIUS,0,1],F=[0,0,0,1];p.transformMat4$1(R,R,I),p.transformMat4$1(O,O,I),p.transformMat4$1(F,F,I);const j=new p.Point(R[0]/R[3],R[1]/R[3]),Y=new p.Point(O[0]/O[3],O[1]/O[3]),ee=p.polygonContainsPoint(S,j)&&R[3]<F[3],se=p.polygonContainsPoint(S,Y)&&O[3]<F[3];if(!ee&&!se)return null;const ie=function(Oe,We,He){for(let ot=1;ot<Oe.length;ot++){const Ft=yi(We.pointCoordinate3D(Oe[ot-1]).x),nt=yi(We.pointCoordinate3D(Oe[ot]).x);if(He<0){if(Ft<nt)return{idx:ot,t:-Ft/(nt-1-Ft)}}else if(nt<Ft)return{idx:ot,t:(1-Ft)/(nt+1-Ft)}}return null}(S,D,ee?-1:1);if(!ie)return null;const{idx:le,t:U}=ie;let J=le>1?Li(S.slice(0,le),D):[],pe=le<S.length?Li(S.slice(le),D):[];J=J.map(Oe=>new p.Point(yi(Oe.x),Oe.y)),pe=pe.map(Oe=>new p.Point(yi(Oe.x),Oe.y));const ge=[...J];0===ge.length&&ge.push(pe[pe.length-1]);const Fe=p.number(ge[ge.length-1].y,(0===pe.length?J[0]:pe[0]).y,U);let Pe;return Pe=ee?[new p.Point(0,Fe),new p.Point(0,0),new p.Point(1,0),new p.Point(1,Fe)]:[new p.Point(1,Fe),new p.Point(1,1),new p.Point(0,1),new p.Point(0,Fe)],ge.push(...Pe),0===pe.length?ge.push(J[0]):ge.push(...pe),{polygon:ge.map(Oe=>new p.MercatorCoordinate(Oe.x,Oe.y)),unwrapped:!1}}(c,h);if(_)return _;const x=function(S,D){let I=!1,R=-1/0,O=0;for(let j=0;j<S.length-1;j++)S[j].x>R&&(R=S[j].x,O=j);for(let j=0;j<S.length-1;j++){const Y=(O+j)%(S.length-1),ee=S[Y],se=S[Y+1];Math.abs(ee.x-se.x)>.5&&(ee.x<se.x?(ee.x+=1,0===Y&&(S[S.length-1].x+=1)):(se.x+=1,Y+1===S.length-1&&(S[0].x+=1)),I=!0)}const F=p.mercatorXfromLng(D.center.lng);return I&&F<Math.abs(F-1)&&S.forEach(j=>{j.x-=1}),{polygon:S,unwrapped:I}}(Li(c,h).map(S=>new p.Point(yi(S.x),S.y)),h);return{polygon:x.polygon.map(S=>new p.MercatorCoordinate(S.x,S.y)),unwrapped:x.unwrapped}}}function Li(g,c){return p.resample(g,h=>{const _=c.pointCoordinate3D(h);h.x=_.x,h.y=_.y},1/256)}function yi(g){return g<0?1+g%1:g%1}function Zt(g){return 100*g|0}function xo(g,c,h,_,x){const S=function(D,I){if(D)return x(D);if(I){g.url&&I.tiles&&g.tiles&&delete g.tiles;const R=p.pick(p.extend(I,g),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);I.vector_layers&&(R.vectorLayers=I.vector_layers,R.vectorLayerIds=R.vectorLayers.map(O=>O.id)),R.tiles=c.canonicalizeTileset(R,g.url),x(null,R)}};return g.url?p.getJSON(c.transformRequest(c.normalizeSourceURL(g.url,null,h,_),p.ResourceType.Source),S):p.exported.frame(()=>S(null,g))}class go{constructor(c,h,_){this.bounds=p.LngLatBounds.convert(this.validateBounds(c)),this.minzoom=h||0,this.maxzoom=_||24}validateBounds(c){return Array.isArray(c)&&4===c.length?[Math.max(-180,c[0]),Math.max(-90,c[1]),Math.min(180,c[2]),Math.min(90,c[3])]:[-180,-90,180,90]}contains(c){const h=Math.pow(2,c.z),_=Math.floor(p.mercatorXfromLng(this.bounds.getWest())*h),x=Math.floor(p.mercatorYfromLat(this.bounds.getNorth())*h),S=Math.ceil(p.mercatorXfromLng(this.bounds.getEast())*h),D=Math.ceil(p.mercatorYfromLat(this.bounds.getSouth())*h);return c.x>=_&&c.x<S&&c.y>=x&&c.y<D}}class Di{constructor(c,h,_){this.context=c;const x=c.gl;this.buffer=x.createBuffer(),this.dynamicDraw=Boolean(_),this.context.unbindVAO(),c.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||h.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(c){const h=this.context.gl;this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,c.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ci={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class fe{constructor(c,h,_,x){this.length=h.length,this.attributes=_,this.itemSize=h.bytesPerElement,this.dynamicDraw=x,this.context=c;const S=c.gl;this.buffer=S.createBuffer(),c.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||h.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(c){const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,c.arrayBuffer)}enableAttributes(c,h){for(let _=0;_<this.attributes.length;_++){const x=h.attributes[this.attributes[_].name];void 0!==x&&c.enableVertexAttribArray(x)}}setVertexAttribPointers(c,h,_){for(let x=0;x<this.attributes.length;x++){const S=this.attributes[x],D=h.attributes[S.name];void 0!==D&&c.vertexAttribPointer(D,S.components,c[Ci[S.type]],!1,this.itemSize,S.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class W{constructor(c){this.gl=c.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(c){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Pt extends W{getDefault(){return p.Color.transparent}set(c){const h=this.current;(c.r!==h.r||c.g!==h.g||c.b!==h.b||c.a!==h.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class Qe extends W{getDefault(){return 1}set(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)}}class Ii extends W{getDefault(){return 0}set(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)}}class Qn extends W{getDefault(){return[!0,!0,!0,!0]}set(c){const h=this.current;(c[0]!==h[0]||c[1]!==h[1]||c[2]!==h[2]||c[3]!==h[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class vi extends W{getDefault(){return!0}set(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)}}class qr extends W{getDefault(){return 255}set(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)}}class Wr extends W{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(c){const h=this.current;(c.func!==h.func||c.ref!==h.ref||c.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)}}class he extends W{getDefault(){const c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]}set(c){const h=this.current;(c[0]!==h[0]||c[1]!==h[1]||c[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)}}class V extends W{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;c?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=c,this.dirty=!1}}class H extends W{getDefault(){return[0,1]}set(c){const h=this.current;(c[0]!==h[0]||c[1]!==h[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)}}class Ee extends W{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;c?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=c,this.dirty=!1}}class Ke extends W{getDefault(){return this.gl.LESS}set(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)}}class jt extends W{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;c?h.enable(h.BLEND):h.disable(h.BLEND),this.current=c,this.dirty=!1}}class en extends W{getDefault(){const c=this.gl;return[c.ONE,c.ZERO]}set(c){const h=this.current;(c[0]!==h[0]||c[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(c[0],c[1]),this.current=c,this.dirty=!1)}}class Oi extends W{getDefault(){return p.Color.transparent}set(c){const h=this.current;(c.r!==h.r||c.g!==h.g||c.b!==h.b||c.a!==h.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class Si extends W{getDefault(){return this.gl.FUNC_ADD}set(c){(c!==this.current||this.dirty)&&(this.gl.blendEquation(c),this.current=c,this.dirty=!1)}}class er extends W{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;c?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=c,this.dirty=!1}}class Jr extends W{getDefault(){return this.gl.BACK}set(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)}}class br extends W{getDefault(){return this.gl.CCW}set(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)}}let ba,ds=class extends W{getDefault(){return null}set(g){(g!==this.current||this.dirty)&&(this.gl.useProgram(g),this.current=g,this.dirty=!1)}};class _a extends W{getDefault(){return this.gl.TEXTURE0}set(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)}}class ql extends W{getDefault(){const c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]}set(c){const h=this.current;(c[0]!==h[0]||c[1]!==h[1]||c[2]!==h[2]||c[3]!==h[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class Wl extends W{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,c),this.current=c,this.dirty=!1}}class Ac extends W{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class du extends W{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,c),this.current=c,this.dirty=!1}}class Ch extends W{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class Se extends W{getDefault(){return null}set(c){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class X extends W{constructor(c){super(c),this.vao=c.extVertexArrayObject}getDefault(){return null}set(c){this.vao&&(c!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(c),this.current=c,this.dirty=!1)}}class Z extends W{getDefault(){return 4}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}}class _e extends W{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}}class Re extends W{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}}class Be extends W{constructor(c,h){super(c),this.context=c,this.parent=h}getDefault(){return null}}class tt extends Be{setDirty(){this.dirty=!0}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}}class et extends Be{attachment(){return this.gl.DEPTH_ATTACHMENT}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,this.attachment(),h.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class Ne extends et{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class ct{constructor(c,h,_,x){this.context=c,this.width=h,this.height=_;const S=this.framebuffer=c.gl.createFramebuffer();this.colorAttachment=new tt(c,S),x&&(this.depthAttachment=new et(c,S))}destroy(){const c=this.context.gl,h=this.colorAttachment.get();if(h&&c.deleteTexture(h),this.depthAttachment){const _=this.depthAttachment.get();_&&c.deleteRenderbuffer(_)}c.deleteFramebuffer(this.framebuffer)}}class Wt{constructor(c,h=!1){if(this.gl=c,this.isWebGL2=h,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),h){const _=c;this.extVertexArrayObject={createVertexArrayOES:_.createVertexArray.bind(c),deleteVertexArrayOES:_.deleteVertexArray.bind(c),bindVertexArrayOES:_.bindVertexArray.bind(c)}}this.clearColor=new Pt(this),this.clearDepth=new Qe(this),this.clearStencil=new Ii(this),this.colorMask=new Qn(this),this.depthMask=new vi(this),this.stencilMask=new qr(this),this.stencilFunc=new Wr(this),this.stencilOp=new he(this),this.stencilTest=new V(this),this.depthRange=new H(this),this.depthTest=new Ee(this),this.depthFunc=new Ke(this),this.blend=new jt(this),this.blendFunc=new en(this),this.blendColor=new Oi(this),this.blendEquation=new Si(this),this.cullFace=new er(this),this.cullFaceSide=new Jr(this),this.frontFace=new br(this),this.program=new ds(this),this.activeTexture=new _a(this),this.viewport=new ql(this),this.bindFramebuffer=new Wl(this),this.bindRenderbuffer=new Ac(this),this.bindTexture=new du(this),this.bindVertexBuffer=new Ch(this),this.bindElementBuffer=new Se(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new X(this),this.pixelStoreUnpack=new Z(this),this.pixelStoreUnpackPremultiplyAlpha=new _e(this),this.pixelStoreUnpackFlipY=new Re(this),this.extTextureFilterAnisotropic=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=c.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=c.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=c.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=c.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),h||(this.extTextureHalfFloat=c.getExtension("OES_texture_half_float")),(h||this.extTextureHalfFloat&&c.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=c.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=h||c.getExtension("OES_standard_derivatives"),this.extTimerQuery=c.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=c.getParameter(c.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(c,h){return new Di(this,c,h)}createVertexBuffer(c,h,_){return new fe(this,c,h,_)}createRenderbuffer(c,h,_){const x=this.gl,S=x.createRenderbuffer();return this.bindRenderbuffer.set(S),x.renderbufferStorage(x.RENDERBUFFER,c,h,_),this.bindRenderbuffer.set(null),S}createFramebuffer(c,h,_){return new ct(this,c,h,_)}clear({color:c,depth:h,stencil:_}){const x=this.gl;let S=0;c&&(S|=x.COLOR_BUFFER_BIT,this.clearColor.set(c),this.colorMask.set([!0,!0,!0,!0])),void 0!==h&&(S|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),void 0!==_&&(S|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),x.clear(S)}setCullFace(c){!1===c.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(c.mode),this.frontFace.set(c.frontFace))}setDepthMode(c){c.func!==this.gl.ALWAYS||c.mask?(this.depthTest.set(!0),this.depthFunc.set(c.func),this.depthMask.set(c.mask),this.depthRange.set(c.range)):this.depthTest.set(!1)}setStencilMode(c){c.test.func!==this.gl.ALWAYS||c.mask?(this.stencilTest.set(!0),this.stencilMask.set(c.mask),this.stencilOp.set([c.fail,c.depthFail,c.pass]),this.stencilFunc.set({func:c.test.func,ref:c.ref,mask:c.test.mask})):this.stencilTest.set(!1)}setColorMode(c){te(c.blendFunction,p.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(c.blendFunction),this.blendColor.set(c.blendColor)),this.colorMask.set(c.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class tn extends p.Evented{constructor(c,h,_,x){if(super(),this.id=c,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,p.extend(this,p.pick(h,["url","scheme","tileSize","promoteId"])),this._options=p.extend({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x),this._tileWorkers={},this._deduped=new p.DedupedRequest}load(c){this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"}));const h=Array.isArray(this.map._language)?this.map._language.join():this.map._language,_=this.map._worldview;this._tileJSONRequest=xo(this._options,this.map._requestManager,h,_,(x,S)=>{this._tileJSONRequest=null,this._loaded=!0,x?(h&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${h}`),_&&2!==_.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${_}`),this.fire(new p.ErrorEvent(x))):S&&(p.extend(this,S),S.bounds&&(this.tileBounds=new go(S.bounds,this.minzoom,this.maxzoom)),p.postTurnstileEvent(S.tiles,this.map._requestManager._customAccessToken),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))),c&&c(x)})}loaded(){return this._loaded}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}onAdd(c){this.map=c,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(c){return this._options.tiles=c,this.reload(),this}setUrl(c){return this.url=c,this._options.url=c,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return p.extend({},this._options)}loadTile(c,h){const _=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),x={request:this.map._requestManager.transformRequest(_,p.ResourceType.Tile),data:void 0,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:p.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:c.isSymbolTile};if(x.request.collectResourceTiming=this._collectResourceTiming,c.actor&&"expired"!==c.state)"loading"===c.state?c.reloadCallback=h:c.request=c.actor.send("reloadTile",x,S.bind(this));else if(c.actor=this._tileWorkers[_]=this._tileWorkers[_]||this.dispatcher.getActor(),this.dispatcher.ready)c.request=c.actor.send("loadTile",x,S.bind(this),void 0,!0);else{const D=p.loadVectorTile.call({deduped:this._deduped},x,(I,R)=>{I||!R?S.call(this,I):(x.data={cacheControl:R.cacheControl,expires:R.expires,rawData:R.rawData.slice(0)},c.actor&&c.actor.send("loadTile",x,S.bind(this),void 0,!0))},!0);c.request={cancel:D}}function S(D,I){return delete c.request,c.aborted?h(null):D&&404!==D.status?h(D):(I&&I.resourceTiming&&(c.resourceTiming=I.resourceTiming),this.map._refreshExpiredTiles&&I&&c.setExpiryData(I),c.loadVectorData(I,this.map.painter),p.cacheEntryPossiblyAdded(this.dispatcher),h(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id})}unloadTile(c){c.unloadVectorData(),c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Ut extends p.Evented{constructor(c,h,_,x){super(),this.id=c,this.dispatcher=_,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=p.extend({type:"raster"},h),p.extend(this,p.pick(h,["url","scheme","tileSize"]))}load(c){this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=xo(this._options,this.map._requestManager,null,null,(h,_)=>{this._tileJSONRequest=null,this._loaded=!0,h?this.fire(new p.ErrorEvent(h)):_&&(p.extend(this,_),_.bounds&&(this.tileBounds=new go(_.bounds,this.minzoom,this.maxzoom)),p.postTurnstileEvent(_.tiles),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))),c&&c(h)})}loaded(){return this._loaded}onAdd(c){this.map=c,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(c){return this._options.tiles=c,this.reload(),this}setUrl(c){return this.url=c,this._options.url=c,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return p.extend({},this._options)}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}loadTile(c,h){const _=p.exported.devicePixelRatio>=2,x=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),_,this.tileSize);c.request=p.getImage(this.map._requestManager.transformRequest(x,p.ResourceType.Tile),(S,D,I,R)=>(delete c.request,c.aborted?(c.state="unloaded",h(null)):S?(c.state="errored",h(S)):D?(this.map._refreshExpiredTiles&&c.setExpiryData({cacheControl:I,expires:R}),c.setTexture(D,this.map.painter),c.state="loaded",p.cacheEntryPossiblyAdded(this.dispatcher),void h(null)):h(null)))}static loadTileData(c,h,_){c.setTexture(h,_)}static unloadTileData(c,h){c.texture&&h.saveTileTexture(c.texture)}abortTile(c,h){c.request&&(c.request.cancel(),delete c.request),h()}unloadTile(c,h){c.texture&&this.map.painter.saveTileTexture(c.texture),h()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function ni(g,c,h,_,x,S,D,I){const R=[g,h,x,c,_,S,1,1,1],O=[D,I,1],F=p.adjoint([],R),[j,Y,ee]=p.transformMat3(O,O,p.transpose(F,F));return p.multiply$1(R,[j,0,0,0,Y,0,0,0,ee],R)}class pi extends p.Evented{constructor(c,h,_,x){super(),this.id=c,this.dispatcher=_,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(x),this.options=h,this._dirty=!1}load(c,h){this._loaded=h||!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=p.getImage(this.map._requestManager.transformRequest(this.url,p.ResourceType.Image),(_,x)=>{if(this._imageRequest=null,this._loaded=!0,_)this.fire(new p.ErrorEvent(_));else if(x){const{HTMLImageElement:S}=p.window;this.image=x instanceof S?p.exported.getImageData(x):x,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,c&&(this.coordinates=c),this._finishLoading()}})}loaded(){return this._loaded}updateImage(c){return this.image&&c.url?(this._imageRequest&&c.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=c.url,this.load(c.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(c){this.map=c,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(c){this.coordinates=c,this._boundsArray=void 0;const h=c.map(p.MercatorCoordinate.fromLngLat);return this.tileID=function(_){let x=1/0,S=1/0,D=-1/0,I=-1/0;for(const j of _)x=Math.min(x,j.x),S=Math.min(S,j.y),D=Math.max(D,j.x),I=Math.max(I,j.y);const R=Math.max(D-x,I-S),O=Math.max(0,Math.floor(-Math.log(R)/Math.LN2)),F=Math.pow(2,O);return new p.CanonicalTileID(O,Math.floor((x+D)/2*F),Math.floor((S+I)/2*F))}(h),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(c){for(const R in this.tiles){const O=this.tiles[R];"loaded"!==O.state&&(O.state="loaded",O.texture=this.texture)}if(this._boundsArray)return;const h=p.tileTransform(this.tileID,this.map.transform.projection),[_,x,S,D]=this.coordinates.map(R=>{const O=h.projection.project(R[0],R[1]);return p.getTilePoint(h,O)._round()});this.perspectiveTransform=function(R,O,F,j,Y,ee,se,ie,le,U){const J=ni(0,0,R,0,0,O,R,O),pe=ni(F,j,Y,ee,se,ie,le,U);return p.multiply$1(pe,p.adjoint(J,J),pe),[pe[6]/pe[8]*R/p.EXTENT,pe[7]/pe[8]*O/p.EXTENT]}(this.width,this.height,_.x,_.y,x.x,x.y,D.x,D.y,S.x,S.y);const I=this._boundsArray=new p.StructArrayLayout4i8;I.emplaceBack(_.x,_.y,0,0),I.emplaceBack(x.x,x.y,p.EXTENT,0),I.emplaceBack(D.x,D.y,0,p.EXTENT),I.emplaceBack(S.x,S.y,p.EXTENT,p.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=c.createVertexBuffer(I,p.boundsAttributes.members),this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const c=this.map.painter.context,h=c.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new p.Texture(c,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(c)}loadTile(c,h){this.tileID&&this.tileID.equals(c.tileID.canonical)?(this.tiles[String(c.tileID.wrap)]=c,c.buckets={},h(null)):(c.state="errored",h(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const ti={vector:tn,raster:Ut,"raster-dem":class extends Ut{constructor(g,c,h,_){super(g,c,h,_),this.type="raster-dem",this.maxzoom=22,this._options=p.extend({type:"raster-dem"},c),this.encoding=c.encoding||"mapbox"}loadTile(g,c){const h=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function _(x,S){x&&(g.state="errored",c(x)),S&&(g.dem=S,g.dem.onDeserialize(),g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0,g.state="loaded",c(null))}g.request=p.getImage(this.map._requestManager.transformRequest(h,p.ResourceType.Tile),function(x,S,D,I){if(delete g.request,g.aborted)g.state="unloaded",c(null);else if(x)g.state="errored",c(x);else if(S){this.map._refreshExpiredTiles&&g.setExpiryData({cacheControl:D,expires:I});const R=p.window.ImageBitmap&&S instanceof p.window.ImageBitmap&&(null==ba&&(ba=p.window.OffscreenCanvas&&new p.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof p.window.createImageBitmap),ba),O=1-(S.width-p.prevPowerOfTwo(S.width))/2;O<1||g.neighboringTiles||(g.neighboringTiles=this._getNeighboringTiles(g.tileID));const F=R?S:p.exported.getImageData(S,O),j={uid:g.uid,coord:g.tileID,source:this.id,rawImageData:F,encoding:this.encoding,padding:O};g.actor&&"expired"!==g.state||(g.actor=this.dispatcher.getActor(),g.actor.send("loadDEMTile",j,_.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(g){const c=g.canonical,h=Math.pow(2,c.z),_=(c.x-1+h)%h,x=0===c.x?g.wrap-1:g.wrap,S=(c.x+1+h)%h,D=c.x+1===h?g.wrap+1:g.wrap,I={};return I[new p.OverscaledTileID(g.overscaledZ,x,c.z,_,c.y).key]={backfilled:!1},I[new p.OverscaledTileID(g.overscaledZ,D,c.z,S,c.y).key]={backfilled:!1},c.y>0&&(I[new p.OverscaledTileID(g.overscaledZ,x,c.z,_,c.y-1).key]={backfilled:!1},I[new p.OverscaledTileID(g.overscaledZ,g.wrap,c.z,c.x,c.y-1).key]={backfilled:!1},I[new p.OverscaledTileID(g.overscaledZ,D,c.z,S,c.y-1).key]={backfilled:!1}),c.y+1<h&&(I[new p.OverscaledTileID(g.overscaledZ,x,c.z,_,c.y+1).key]={backfilled:!1},I[new p.OverscaledTileID(g.overscaledZ,g.wrap,c.z,c.x,c.y+1).key]={backfilled:!1},I[new p.OverscaledTileID(g.overscaledZ,D,c.z,S,c.y+1).key]={backfilled:!1}),I}unloadTile(g){g.demTexture&&this.map.painter.saveTileTexture(g.demTexture),g.fbo&&(g.fbo.destroy(),delete g.fbo),g.dem&&delete g.dem,delete g.neighboringTiles,g.state="unloaded"}},geojson:class extends p.Evented{constructor(g,c,h,_){super(),this.id=g,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=h.getActor(),this.setEventedParent(_),this._data=c.data,this._options=p.extend({},c),this._collectResourceTiming=c.collectResourceTiming,void 0!==c.maxzoom&&(this.maxzoom=c.maxzoom),c.type&&(this.type=c.type),c.attribution&&(this.attribution=c.attribution),this.promoteId=c.promoteId;const x=p.EXTENT/this.tileSize;this.workerOptions=p.extend({source:this.id,cluster:c.cluster||!1,geojsonVtOptions:{buffer:(void 0!==c.buffer?c.buffer:128)*x,tolerance:(void 0!==c.tolerance?c.tolerance:.375)*x,extent:p.EXTENT,maxZoom:this.maxzoom,lineMetrics:c.lineMetrics||!1,generateId:c.generateId||!1},superclusterOptions:{maxZoom:void 0!==c.clusterMaxZoom?c.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,c.clusterMinPoints||2),extent:p.EXTENT,radius:(void 0!==c.clusterRadius?c.clusterRadius:50)*x,log:!1,generateId:c.generateId||!1},clusterProperties:c.clusterProperties,filter:c.filter},c.workerOptions)}onAdd(g){this.map=g,this.setData(this._data)}setData(g){return this._data=g,this._updateWorkerData(),this}getClusterExpansionZoom(g,c){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:g,source:this.id},c),this}getClusterChildren(g,c){return this.actor.send("geojson.getClusterChildren",{clusterId:g,source:this.id},c),this}getClusterLeaves(g,c,h,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:g,limit:c,offset:h},_),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new p.Event("dataloading",{dataType:"source"})),this._loaded=!1;const g=p.extend({},this.workerOptions),c=this._data;"string"==typeof c?(g.request=this.map._requestManager.transformRequest(p.exported.resolveURL(c),p.ResourceType.Source),g.request.collectResourceTiming=this._collectResourceTiming):g.data=JSON.stringify(c),this._pendingLoad=this.actor.send(`${this.type}.loadData`,g,(h,_)=>{if(this._loaded=!0,this._pendingLoad=null,h)this.fire(new p.ErrorEvent(h));else{const x={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(x.resourceTiming=_.resourceTiming[this.id]),this.fire(new p.Event("data",x)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(g,c){const h=g.actor?"reloadTile":"loadTile";g.actor=this.actor,g.request=this.actor.send(h,{type:this.type,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:p.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(_,x)=>(delete g.request,g.unloadVectorData(),g.aborted?c(null):_?c(_):(g.loadVectorData(x,this.map.painter,"reloadTile"===h),c(null))),void 0,"loadTile"===h)}abortTile(g){g.request&&(g.request.cancel(),delete g.request),g.aborted=!0}unloadTile(g){g.unloadVectorData(),this.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return p.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends pi{constructor(g,c,h,_){super(g,c,h,_),this.roundZoom=!0,this.type="video",this.options=c}load(){this._loaded=!1;const g=this.options;this.urls=[];for(const c of g.urls)this.urls.push(this.map._requestManager.transformRequest(c,p.ResourceType.Source).url);p.getVideo(this.urls,(c,h)=>{this._loaded=!0,c?this.fire(new p.ErrorEvent(c)):h&&(this.video=h,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(g){if(this.video){const c=this.video.seekable;g<c.start(0)||g>c.end(0)?this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${c.start(0)} and ${c.end(0)}-second mark.`))):this.video.currentTime=g}}getVideo(){return this.video}onAdd(g){this.map||(this.map=g,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const g=this.map.painter.context,c=g.gl;this.texture?this.video.paused||(this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),c.texSubImage2D(c.TEXTURE_2D,0,0,0,c.RGBA,c.UNSIGNED_BYTE,this.video)):(this.texture=new p.Texture(g,this.video,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(g)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:pi,canvas:class extends pi{constructor(g,c,h,_){super(g,c,h,_),c.coordinates?Array.isArray(c.coordinates)&&4===c.coordinates.length&&!c.coordinates.some(x=>!Array.isArray(x)||2!==x.length||x.some(S=>"number"!=typeof S))||this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${g}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${g}`,null,'missing required property "coordinates"'))),c.animate&&"boolean"!=typeof c.animate&&this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${g}`,null,'optional "animate" property must be a boolean value'))),c.canvas?"string"==typeof c.canvas||c.canvas instanceof p.window.HTMLCanvasElement||this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${g}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${g}`,null,'missing required property "canvas"'))),this.options=c,this.animate=void 0===c.animate||c.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof p.window.HTMLCanvasElement?this.options.canvas:p.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new p.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(g){this.map=g,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let g=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,g=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,g=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const c=this.map.painter.context;this.texture?(g||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new p.Texture(c,this.canvas,c.gl.RGBA,{premultiply:!0}),this._prepareData(c)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const g of[this.canvas.width,this.canvas.height])if(isNaN(g)||g<=0)return!0;return!1}},custom:class extends p.Evented{constructor(g,c,h,_){super(),this.id=g,this.type="custom",this._dataType="raster",this._dispatcher=h,this._implementation=c,this.setEventedParent(_),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new p.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new p.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new go(this._implementation.bounds,this.minzoom,this.maxzoom)),c.update=this._update.bind(this),c.clearTiles=this._clearTiles.bind(this),c.coveringTiles=this._coveringTiles.bind(this),p.extend(this,p.pick(c,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return p.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(g){this._map=g,this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(g),this.load()}onRemove(g){this._implementation.onRemove&&this._implementation.onRemove(g)}hasTile(g){if(this._implementation.hasTile){const{x:c,y:h,z:_}=g.canonical;return this._implementation.hasTile({x:c,y:h,z:_})}return!this.tileBounds||this.tileBounds.contains(g.canonical)}loadTile(g,c){const{x:h,y:_,z:x}=g.tileID.canonical,S=new p.window.AbortController;g.request=Promise.resolve(this._implementation.loadTile({x:h,y:_,z:x},{signal:S.signal})).then(function(D){return delete g.request,g.aborted?(g.state="unloaded",c(null)):void 0===D?(g.state="errored",c(null)):null===D?(this.loadTileData(g,{width:this.tileSize,height:this.tileSize,data:null}),g.state="loaded",c(null)):(I=D)instanceof p.window.ImageData||I instanceof p.window.HTMLCanvasElement||I instanceof p.window.ImageBitmap||I instanceof p.window.HTMLImageElement?(this.loadTileData(g,D),g.state="loaded",void c(null)):(g.state="errored",c(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var I}.bind(this)).catch(D=>{20!==D.code&&(g.state="errored",c(D))}),g.request.cancel=()=>S.abort()}loadTileData(g,c){Ut.loadTileData(g,c,this._map.painter)}unloadTileData(g){Ut.unloadTileData(g,this._map.painter)}unloadTile(g,c){if(this.unloadTileData(g),this._implementation.unloadTile){const{x:h,y:_,z:x}=g.tileID.canonical;this._implementation.unloadTile({x:h,y:_,z:x})}c()}abortTile(g,c){g.request&&g.request.cancel&&(g.request.cancel(),delete g.request),c()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(g=>({x:g.canonical.x,y:g.canonical.y,z:g.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))}}},fi=function(g,c,h,_){const x=new ti[c.type](g,c,h,_);if(x.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${x.id}`);return p.bindAll(["load","abort","unload","serialize","prepare"],x),x};function Ti(g,c){const h=p.identity([]);return p.scale(h,h,[.5*g.width,.5*-g.height,1]),p.translate(h,h,[1,-1,0]),p.multiply(h,h,g.calculateProjMatrix(c.toUnwrapped())),Float32Array.from(h)}function Fi(g,c,h,_,x,S,D,I=!1){const R=g.tilesIn(_,D,I);R.sort(Qo);const O=[];for(const j of R)O.push({wrappedTileID:j.tile.tileID.wrapped().key,queryResults:j.tile.queryRenderedFeatures(c,h,g._state,j,x,S,Ti(g.transform,j.tile.tileID),I)});const F=function(j){const Y={},ee={};for(const se of j){const ie=se.queryResults,le=se.wrappedTileID,U=ee[le]=ee[le]||{};for(const J in ie){const pe=ie[J],ge=U[J]=U[J]||{},Fe=Y[J]=Y[J]||[];for(const Pe of pe)ge[Pe.featureIndex]||(ge[Pe.featureIndex]=!0,Fe.push(Pe))}}return Y}(O);for(const j in F)F[j].forEach(Y=>{const ee=Y.feature,se=ee.layer;se&&"background"!==se.type&&"sky"!==se.type&&(ee.source=se.source,se["source-layer"]&&(ee.sourceLayer=se["source-layer"]),ee.state=void 0!==ee.id?g.getFeatureState(se["source-layer"],ee.id):{})});return F}function lo(g,c){const h=g.getRenderableIds().map(S=>g.getTileByID(S)),_=[],x={};for(let S=0;S<h.length;S++){const D=h[S],I=D.tileID.canonical.key;x[I]||(x[I]=!0,D.querySourceFeatures(_,c))}return _}function Qo(g,c){const h=g.tileID,_=c.tileID;return h.overscaledZ-_.overscaledZ||h.canonical.y-_.canonical.y||h.wrap-_.wrap||h.canonical.x-_.canonical.x}function bo(){return null!=ic.workerClass?new ic.workerClass:new p.window.Worker(ic.workerUrl)}const Xa="mapboxgl_preloaded_worker_pool";class wo{constructor(){this.active={}}acquire(c){if(!this.workers)for(this.workers=[];this.workers.length<wo.workerCount;)this.workers.push(new bo);return this.active[c]=!0,this.workers.slice()}release(c){delete this.active[c],0===this.numActive()&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Xa]}numActive(){return Object.keys(this.active).length}}let hs;function hu(){return hs||(hs=new wo),hs}function _l(g,c){const h={};for(const _ in g)"ref"!==_&&(h[_]=g[_]);return p.refProperties.forEach(_=>{_ in c&&(h[_]=c[_])}),h}function Lm(g){g=g.slice();const c=Object.create(null);for(let h=0;h<g.length;h++)c[g[h].id]=g[h];for(let h=0;h<g.length;h++)"ref"in g[h]&&(g[h]=_l(g[h],c[g[h].ref]));return g}wo.workerCount=2;const Gn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Xl(g,c,h){h.push({command:Gn.addSource,args:[g,c[g]]})}function ps(g,c,h){c.push({command:Gn.removeSource,args:[g]}),h[g]=!0}function Om(g,c,h,_){ps(g,h,_),Xl(g,c,h)}function Th(g,c,h){let _;for(_ in g[h])if(g[h].hasOwnProperty(_)&&"data"!==_&&!te(g[h][_],c[h][_]))return!1;for(_ in c[h])if(c[h].hasOwnProperty(_)&&"data"!==_&&!te(g[h][_],c[h][_]))return!1;return!0}function ya(g,c,h,_,x,S){let D;for(D in c=c||{},g=g||{})g.hasOwnProperty(D)&&(te(g[D],c[D])||h.push({command:S,args:[_,D,c[D],x]}));for(D in c)c.hasOwnProperty(D)&&!g.hasOwnProperty(D)&&(te(g[D],c[D])||h.push({command:S,args:[_,D,c[D],x]}))}function va(g){return g.id}function Eh(g,c){return g[c.id]=c,g}class kc{constructor(c,h){this.reset(c,h)}reset(c,h){this.points=c||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(c){if(1===this.points.length)return this.points[0];c=p.clamp(c,0,1);let h=1,_=this._distances[h];const x=c*this.paddedLength+this.padding;for(;_<x&&h<this._distances.length;)_=this._distances[++h];const S=h-1,D=this._distances[S],I=_-D,R=I>0?(x-D)/I:0;return this.points[S].mult(1-R).add(this.points[h].mult(R))}}class Rc{constructor(c,h,_){const x=this.boxCells=[],S=this.circleCells=[];this.xCellCount=Math.ceil(c/_),this.yCellCount=Math.ceil(h/_);for(let D=0;D<this.xCellCount*this.yCellCount;D++)x.push([]),S.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=c,this.height=h,this.xScale=this.xCellCount/c,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(c,h,_,x,S){this._forEachCell(h,_,x,S,this._insertBoxCell,this.boxUid++),this.boxKeys.push(c),this.bboxes.push(h),this.bboxes.push(_),this.bboxes.push(x),this.bboxes.push(S)}insertCircle(c,h,_,x){this._forEachCell(h-x,_-x,h+x,_+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(c),this.circles.push(h),this.circles.push(_),this.circles.push(x)}_insertBoxCell(c,h,_,x,S,D){this.boxCells[S].push(D)}_insertCircleCell(c,h,_,x,S,D){this.circleCells[S].push(D)}_query(c,h,_,x,S,D){if(_<0||c>this.width||x<0||h>this.height)return!S&&[];const I=[];if(c<=0&&h<=0&&this.width<=_&&this.height<=x){if(S)return!0;for(let R=0;R<this.boxKeys.length;R++)I.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(let R=0;R<this.circleKeys.length;R++){const O=this.circles[3*R],F=this.circles[3*R+1],j=this.circles[3*R+2];I.push({key:this.circleKeys[R],x1:O-j,y1:F-j,x2:O+j,y2:F+j})}return D?I.filter(D):I}return this._forEachCell(c,h,_,x,this._queryCell,I,{hitTest:S,seenUids:{box:{},circle:{}}},D),S?I.length>0:I}_queryCircle(c,h,_,x,S){const D=c-_,I=c+_,R=h-_,O=h+_;if(I<0||D>this.width||O<0||R>this.height)return!x&&[];const F=[];return this._forEachCell(D,R,I,O,this._queryCellCircle,F,{hitTest:x,circle:{x:c,y:h,radius:_},seenUids:{box:{},circle:{}}},S),x?F.length>0:F}query(c,h,_,x,S){return this._query(c,h,_,x,!1,S)}hitTest(c,h,_,x,S){return this._query(c,h,_,x,!0,S)}hitTestCircle(c,h,_,x){return this._queryCircle(c,h,_,!0,x)}_queryCell(c,h,_,x,S,D,I,R){const O=I.seenUids,F=this.boxCells[S];if(null!==F){const Y=this.bboxes;for(const ee of F)if(!O.box[ee]){O.box[ee]=!0;const se=4*ee;if(c<=Y[se+2]&&h<=Y[se+3]&&_>=Y[se+0]&&x>=Y[se+1]&&(!R||R(this.boxKeys[ee]))){if(I.hitTest)return D.push(!0),!0;D.push({key:this.boxKeys[ee],x1:Y[se],y1:Y[se+1],x2:Y[se+2],y2:Y[se+3]})}}}const j=this.circleCells[S];if(null!==j){const Y=this.circles;for(const ee of j)if(!O.circle[ee]){O.circle[ee]=!0;const se=3*ee;if(this._circleAndRectCollide(Y[se],Y[se+1],Y[se+2],c,h,_,x)&&(!R||R(this.circleKeys[ee]))){if(I.hitTest)return D.push(!0),!0;{const ie=Y[se],le=Y[se+1],U=Y[se+2];D.push({key:this.circleKeys[ee],x1:ie-U,y1:le-U,x2:ie+U,y2:le+U})}}}}}_queryCellCircle(c,h,_,x,S,D,I,R){const O=I.circle,F=I.seenUids,j=this.boxCells[S];if(null!==j){const ee=this.bboxes;for(const se of j)if(!F.box[se]){F.box[se]=!0;const ie=4*se;if(this._circleAndRectCollide(O.x,O.y,O.radius,ee[ie+0],ee[ie+1],ee[ie+2],ee[ie+3])&&(!R||R(this.boxKeys[se])))return D.push(!0),!0}}const Y=this.circleCells[S];if(null!==Y){const ee=this.circles;for(const se of Y)if(!F.circle[se]){F.circle[se]=!0;const ie=3*se;if(this._circlesCollide(ee[ie],ee[ie+1],ee[ie+2],O.x,O.y,O.radius)&&(!R||R(this.circleKeys[se])))return D.push(!0),!0}}}_forEachCell(c,h,_,x,S,D,I,R){const O=this._convertToXCellCoord(c),F=this._convertToYCellCoord(h),j=this._convertToXCellCoord(_),Y=this._convertToYCellCoord(x);for(let ee=O;ee<=j;ee++)for(let se=F;se<=Y;se++)if(S.call(this,c,h,_,x,this.xCellCount*se+ee,D,I,R))return}_convertToXCellCoord(c){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(c*this.xScale)))}_convertToYCellCoord(c){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(c*this.yScale)))}_circlesCollide(c,h,_,x,S,D){const I=x-c,R=S-h,O=_+D;return O*O>I*I+R*R}_circleAndRectCollide(c,h,_,x,S,D,I){const R=(D-x)/2,O=Math.abs(c-(x+R));if(O>R+_)return!1;const F=(I-S)/2,j=Math.abs(h-(S+F));if(j>F+_)return!1;if(O<=R||j<=F)return!0;const Y=O-R,ee=j-F;return Y*Y+ee*ee<=_*_}}const Za_unknown=0,Za_flipRequired=1,Za_flipNotRequired=2,pu=Math.tan(85*Math.PI/180);function bt(g,c,h,_,x,S,D){const I=p.create();if(h)if("globe"===S.name){const R=p.calculateGlobeLabelMatrix(x,c);p.multiply(I,I,R)}else{const R=Ie([],D);I[0]=R[0],I[1]=R[1],I[4]=R[2],I[5]=R[3],_||p.rotateZ(I,I,x.angle)}else p.multiply(I,x.labelPlaneMatrix,g);return I}function yl(g,c,h,_,x,S,D){const I=bt(g,c,h,_,x,S,D);return"globe"===S.name&&h||(I[2]=I[6]=I[10]=I[14]=0),I}function co(g,c,h,_,x,S,D){if(h){if("globe"===S.name){const I=bt(g,c,h,_,x,S,D);return p.invert(I,I),p.multiply(I,g,I),I}{const I=p.clone(g),R=p.identity([]);return R[0]=D[0],R[1]=D[1],R[4]=D[2],R[5]=D[3],p.multiply(I,I,R),_||p.rotateZ(I,I,-x.angle),I}}return x.glCoordMatrix}function Ro(g,c,h,_){const x=[g,c,h,1];h?p.transformMat4$1(x,x,_):mi(x,x,_);const S=x[3];return x[0]/=S,x[1]/=S,x[2]/=S,x}function $p(g,c){return Math.min(.5+g/c*.5,1.5)}function Ya(g,c){const h=g[0]/g[3],_=g[1]/g[3];return h>=-c[0]&&h<=c[0]&&_>=-c[1]&&_<=c[1]}function Gp(g,c,h,_,x,S,D,I,R,O){const F=h.transform,j=_?g.textSizeData:g.iconSizeData,Y=p.evaluateSizeForZoom(j,h.transform.zoom),ee="globe"===F.projection.name,se=[256/h.width*2+1,256/h.height*2+1],ie=_?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;ie.clear();let le=null;ee&&(le=_?g.text.globeExtVertexArray:g.icon.globeExtVertexArray);const U=g.lineVertexArray,J=_?g.text.placedSymbolArray:g.icon.placedSymbolArray,pe=h.transform.width/h.transform.height;let ge,Fe=!1;for(let Pe=0;Pe<J.length;Pe++){const Oe=J.get(Pe),{numGlyphs:We,writingMode:He}=Oe;if(He!==p.WritingMode.vertical||Fe||ge===p.WritingMode.horizontal||(Fe=!0),ge=He,(Oe.hidden||He===p.WritingMode.vertical)&&!Fe){zi(We,ie);continue}Fe=!1;const ot=new p.Point(Oe.tileAnchorX,Oe.tileAnchorY);let{x:Ft,y:nt,z:St}=F.projection.projectTilePoint(ot.x,ot.y,O.canonical);if(R){const[zn,bn,An]=R(ot);Ft+=zn,nt+=bn,St+=An}const pt=[Ft,nt,St,1];if(p.transformMat4$1(pt,pt,c),!Ya(pt,se)){zi(We,ie);continue}const Nt=$p(h.transform.cameraToCenterDistance,pt[3]),it=p.evaluateSizeForFeature(j,Y,Oe),vt=D?it/Nt:it*Nt,Bt=Ro(Ft,nt,St,x);if(Bt[3]<=0){zi(We,ie);continue}let Mt={};const Vt=D?null:R,In=un(Oe,vt,!1,I,c,x,S,g.glyphOffsetArray,U,ie,le,Bt,ot,Mt,pe,Vt,F.projection,O,D);Fe=In.useVertical,Vt&&In.needsFlipping&&(Mt={}),(In.notEnoughRoom||Fe||In.needsFlipping&&un(Oe,vt,!0,I,c,x,S,g.glyphOffsetArray,U,ie,le,Bt,ot,Mt,pe,Vt,F.projection,O,D).notEnoughRoom)&&zi(We,ie)}_?(g.text.dynamicLayoutVertexBuffer.updateData(ie),le&&g.text.globeExtVertexBuffer.updateData(le)):(g.icon.dynamicLayoutVertexBuffer.updateData(ie),le&&g.icon.globeExtVertexBuffer.updateData(le))}function eo(g,c,h,_,x,S,D,I,R,O,F,j,Y,ee,se,ie){const{lineStartIndex:le,glyphStartIndex:U,segment:J}=I,pe=U+I.numGlyphs,ge=le+I.lineLength,Fe=c.getoffsetX(U),Pe=c.getoffsetX(pe-1),Oe=fs(g*Fe,h,_,x,S,D,J,le,ge,R,O,F,j,Y,!0,ee,se,ie);if(!Oe)return null;const We=fs(g*Pe,h,_,x,S,D,J,le,ge,R,O,F,j,Y,!0,ee,se,ie);return We?{first:Oe,last:We}:null}function Er(g,c,h,_){return g===p.WritingMode.horizontal&&Math.abs(_)>Math.abs(h)?{useVertical:!0}:g===p.WritingMode.vertical?_>0?{needsFlipping:!0}:null:c!==Za_unknown&&(0===(x=h)||Math.abs(_/x)>pu)?c===Za_flipRequired?{needsFlipping:!0}:null:h<0?{needsFlipping:!0}:null;var x}function un(g,c,h,_,x,S,D,I,R,O,F,j,Y,ee,se,ie,le,U,J){const pe=c/24,ge=g.lineOffsetX*pe,Fe=g.lineOffsetY*pe,{lineStartIndex:Pe,glyphStartIndex:Oe,numGlyphs:We,segment:He,writingMode:ot,flipState:Ft}=g,nt=Pe+g.lineLength,St=pt=>{if(F){const[Bt,Mt,Vt]=pt.up,In=O.length;p.updateGlobeVertexNormal(F,In+0,Bt,Mt,Vt),p.updateGlobeVertexNormal(F,In+1,Bt,Mt,Vt),p.updateGlobeVertexNormal(F,In+2,Bt,Mt,Vt),p.updateGlobeVertexNormal(F,In+3,Bt,Mt,Vt)}const[Nt,it,vt]=pt.point;p.addDynamicAttributes(O,Nt,it,vt,pt.angle)};if(We>1){const pt=eo(pe,I,ge,Fe,h,j,Y,g,R,S,ee,ie,!1,le,U,J);if(!pt)return{notEnoughRoom:!0};if(_&&!h){let[Nt,it,vt]=pt.first.point,[Bt,Mt,Vt]=pt.last.point;[Nt,it]=Ro(Nt,it,vt,D),[Bt,Mt]=Ro(Bt,Mt,Vt,D);const In=Er(ot,Ft,(Bt-Nt)*se,Mt-it);if(g.flipState=In&&In.needsFlipping?Za_flipRequired:Za_flipNotRequired,In)return In}St(pt.first);for(let Nt=Oe+1;Nt<Oe+We-1;Nt++){const it=fs(pe*I.getoffsetX(Nt),ge,Fe,h,j,Y,He,Pe,nt,R,S,ee,ie,!1,!1,le,U,J);if(!it)return O.length-=4*(Nt-Oe),{notEnoughRoom:!0};St(it)}St(pt.last)}else{if(_&&!h){const Nt=Ro(Y.x,Y.y,0,x),it=Pe+He+1,vt=new p.Point(R.getx(it),R.gety(it)),Bt=Ro(vt.x,vt.y,0,x),Mt=Bt[3]>0?Bt:Cn(Y,vt,Nt,1,x,void 0,le,U.canonical),Vt=Er(ot,Ft,(Mt[0]-Nt[0])*se,Mt[1]-Nt[1]);if(g.flipState=Vt&&Vt.needsFlipping?Za_flipRequired:Za_flipNotRequired,Vt)return Vt}const pt=fs(pe*I.getoffsetX(Oe),ge,Fe,h,j,Y,He,Pe,nt,R,S,ee,ie,!1,!1,le,U,J);if(!pt)return{notEnoughRoom:!0};St(pt)}return{}}function xi(g,c,h,_,x){const{x:S,y:D,z:I}=_.projectTilePoint(g.x,g.y,c);if(!x)return Ro(S,D,I,h);const[R,O,F]=x(g);return Ro(S+R,D+O,I+F,h)}function Cn(g,c,h,_,x,S,D,I){const R=xi(g.sub(c)._unit()._add(g),I,x,D,S);return p.sub(R,h,R),p.normalize(R,R),p.scaleAndAdd(R,h,R,_)}function fs(g,c,h,_,x,S,D,I,R,O,F,j,Y,ee,se,ie,le,U){const J=_?g-c:g+c;let pe=J>0?1:-1,ge=0;_&&(pe*=-1,ge=Math.PI),pe<0&&(ge+=Math.PI);let Fe=I+D+(pe>0?0:1)|0,Pe=x,Oe=x,We=0,He=0;const ot=Math.abs(J),Ft=[],nt=[];let St=S,pt=St;const Nt=()=>Cn(pt,St,Oe,ot-We+1,F,Y,ie,le.canonical);for(;We+He<=ot;){if(Fe+=pe,Fe<I||Fe>=R)return null;if(Oe=Pe,pt=St,Ft.push(Oe),ee&&nt.push(pt),St=new p.Point(O.getx(Fe),O.gety(Fe)),Pe=j[Fe],!Pe){const An=xi(St,le.canonical,F,ie,Y);Pe=An[3]>0?j[Fe]=An:Nt()}We+=He,He=p.distance(Oe,Pe)}se&&Y&&(j[Fe]&&(Pe=Nt(),He=p.distance(Oe,Pe)),j[Fe]=Pe);const it=(ot-We)/He,vt=St.sub(pt)._mult(it)._add(pt),Bt=p.sub([],Pe,Oe),Mt=p.scaleAndAdd([],Oe,Bt,it);let Vt=[0,0,1],In=Bt[0],zn=Bt[1];if(U&&(Vt=ie.upVector(le.canonical,vt.x,vt.y),0!==Vt[0]||0!==Vt[1]||1!==Vt[2])){const An=[Vt[2],0,-Vt[0]],gi=p.cross([],Vt,An);p.normalize(An,An),p.normalize(gi,gi),In=p.dot(Bt,An),zn=p.dot(Bt,gi)}if(h){const An=p.cross([],Vt,Bt);p.normalize(An,An),p.scaleAndAdd(Mt,Mt,An,h*pe)}const bn=ge+Math.atan2(zn,In);return Ft.push(Mt),ee&&nt.push(vt),{point:Mt,angle:bn,path:Ft,tilePath:nt,up:Vt}}function zi(g,c){const h=c.length,_=h+4*g;c.resize(_),c.float32.fill(-1/0,4*h,4*_)}function mi(g,c,h){const _=c[0],x=c[1];return g[0]=h[0]*_+h[4]*x+h[12],g[1]=h[1]*_+h[5]*x+h[13],g[3]=h[3]*_+h[7]*x+h[15],g}const $s=100;class Ni{constructor(c,h,_=new Rc(c.width+200,c.height+200,25),x=new Rc(c.width+200,c.height+200,25)){this.transform=c,this.grid=_,this.ignoredGrid=x,this.pitchfactor=Math.cos(c._pitch)*c.cameraToCenterDistance,this.screenRightBoundary=c.width+$s,this.screenBottomBoundary=c.height+$s,this.gridRightBoundary=c.width+200,this.gridBottomBoundary=c.height+200,this.fogState=h}placeCollisionBox(c,h,_,x,S,D,I,R){let O=_.projectedAnchorX,F=_.projectedAnchorY,j=_.projectedAnchorZ;const Y=_.elevation,ee=_.tileID,se=c.getProjection();if(Y&&ee){const[Pe,Oe,We]=se.upVector(ee.canonical,_.tileAnchorX,_.tileAnchorY),He=se.upVectorScale(ee.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;O+=Pe*Y*He,F+=Oe*Y*He,j+=We*Y*He}const ie=this.projectAndGetPerspectiveRatio(I,O,F,j,_.tileID,"globe"===se.name||!!Y||this.transform.pitch>0,se),le=D*ie.perspectiveRatio,U=(_.x1*h+x.x-_.padding)*le+ie.point.x,J=(_.y1*h+x.y-_.padding)*le+ie.point.y,pe=(_.x2*h+x.x+_.padding)*le+ie.point.x,ge=(_.y2*h+x.y+_.padding)*le+ie.point.y,Fe=ie.perspectiveRatio<=.55||ie.occluded;return!this.isInsideGrid(U,J,pe,ge)||!S&&this.grid.hitTest(U,J,pe,ge,R)||Fe?{box:[],offscreen:!1,occluded:ie.occluded}:{box:[U,J,pe,ge],offscreen:this.isOffscreen(U,J,pe,ge),occluded:!1}}placeCollisionCircles(c,h,_,x,S,D,I,R,O,F,j,Y,ee,se,ie){const le=[],U=this.transform.elevation,J=c.getProjection(),pe=U?U.getAtTileOffsetFunc(ie,this.transform.center.lat,this.transform.worldSize,J):null,ge=new p.Point(_.tileAnchorX,_.tileAnchorY);let{x:Fe,y:Pe,z:Oe}=J.projectTilePoint(ge.x,ge.y,ie.canonical);if(pe){const[vt,Bt,Mt]=pe(ge);Fe+=vt,Pe+=Bt,Oe+=Mt}const We="globe"===J.name,He=this.projectAndGetPerspectiveRatio(I,Fe,Pe,Oe,ie,We||!!U||this.transform.pitch>0,J),{perspectiveRatio:ot}=He,Ft=(j?D/ot:D*ot)/p.ONE_EM,nt=Ro(Fe,Pe,Oe,R),St=He.signedDistanceFromCamera>0?eo(Ft,S,_.lineOffsetX*Ft,_.lineOffsetY*Ft,!1,nt,ge,_,x,R,{},U&&!j?pe:null,j&&!!U,J,ie,j):null;let pt=!1,Nt=!1,it=!0;if(St&&!He.occluded){const vt=.5*ee*ot+se,Bt=new p.Point(-100,-100),Mt=new p.Point(this.screenRightBoundary,this.screenBottomBoundary),Vt=new kc,{first:In,last:zn}=St,bn=In.path.length;let An=[];for(let En=bn-1;En>=1;En--)An.push(In.path[En]);for(let En=1;En<zn.path.length;En++)An.push(zn.path[En]);const gi=2.5*vt;O&&(An=An.map(([En,nr,pr],_r)=>(pe&&!We&&(pr=pe(_r<bn-1?In.tilePath[bn-1-_r]:zn.tilePath[_r-bn+2])[2]),Ro(En,nr,pr,O))),An.some(En=>En[3]<=0)&&(An=[]));let oi=[];if(An.length>0){let En=1/0,nr=-1/0,pr=1/0,_r=-1/0;for(const ki of An)En=Math.min(En,ki[0]),pr=Math.min(pr,ki[1]),nr=Math.max(nr,ki[0]),_r=Math.max(_r,ki[1]);nr>=Bt.x&&En<=Mt.x&&_r>=Bt.y&&pr<=Mt.y&&(oi=[An.map(ki=>new p.Point(ki[0],ki[1]))],(En<Bt.x||nr>Mt.x||pr<Bt.y||_r>Mt.y)&&(oi=p.clipLine(oi,Bt.x,Bt.y,Mt.x,Mt.y)))}for(const En of oi){Vt.reset(En,.25*vt);let nr=0;nr=Vt.length<=.5*vt?1:Math.ceil(Vt.paddedLength/gi)+1;for(let pr=0;pr<nr;pr++){const _r=pr/Math.max(nr-1,1),ki=Vt.lerp(_r),ns=ki.x+$s,io=ki.y+$s;le.push(ns,io,vt,0);const Ns=ns-vt,da=io-vt,Ir=ns+vt,or=io+vt;if(it=it&&this.isOffscreen(Ns,da,Ir,or),Nt=Nt||this.isInsideGrid(Ns,da,Ir,or),!h&&this.grid.hitTestCircle(ns,io,vt,Y)&&(pt=!0,!F))return{circles:[],offscreen:!1,collisionDetected:pt,occluded:!1}}}}return{circles:!F&&pt||!Nt?[]:le,offscreen:it,collisionDetected:pt,occluded:He.occluded}}queryRenderedSymbols(c){if(0===c.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const h=[];let _=1/0,x=1/0,S=-1/0,D=-1/0;for(const F of c){const j=new p.Point(F.x+$s,F.y+$s);_=Math.min(_,j.x),x=Math.min(x,j.y),S=Math.max(S,j.x),D=Math.max(D,j.y),h.push(j)}const I=this.grid.query(_,x,S,D).concat(this.ignoredGrid.query(_,x,S,D)),R={},O={};for(const F of I){const j=F.key;if(void 0===R[j.bucketInstanceId]&&(R[j.bucketInstanceId]={}),R[j.bucketInstanceId][j.featureIndex])continue;const Y=[new p.Point(F.x1,F.y1),new p.Point(F.x2,F.y1),new p.Point(F.x2,F.y2),new p.Point(F.x1,F.y2)];p.polygonIntersectsPolygon(h,Y)&&(R[j.bucketInstanceId][j.featureIndex]=!0,void 0===O[j.bucketInstanceId]&&(O[j.bucketInstanceId]=[]),O[j.bucketInstanceId].push(j.featureIndex))}return O}insertCollisionBox(c,h,_,x,S){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:x,collisionGroupID:S},c[0],c[1],c[2],c[3])}insertCollisionCircles(c,h,_,x,S){const D=h?this.ignoredGrid:this.grid,I={bucketInstanceId:_,featureIndex:x,collisionGroupID:S};for(let R=0;R<c.length;R+=4)D.insertCircle(I,c[R],c[R+1],c[R+2])}projectAndGetPerspectiveRatio(c,h,_,x,S,D,I){const R=[h,_,x,1];let O=!1;x||this.transform.pitch>0?(p.transformMat4$1(R,R,c),this.fogState&&S&&"globe"!==I.name&&(O=function(Y,ee,se,ie,le,U){const J=U.calculateFogTileMatrix(le),pe=[ee,se,ie];return p.transformMat4(pe,pe,J),je(Y,pe,U.pitch,U._fov)}(this.fogState,h,_,x,S.toUnwrapped(),this.transform)>.9)):mi(R,R,c);const F=R[3];return{point:new p.Point((R[0]/F+1)/2*this.transform.width+$s,(-R[1]/F+1)/2*this.transform.height+$s),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(I)/F*.5,1.5),signedDistanceFromCamera:F,occluded:D&&R[2]>F||O}}isOffscreen(c,h,_,x){return _<$s||c>=this.screenRightBoundary||x<$s||h>this.screenBottomBoundary}isInsideGrid(c,h,_,x){return _>=0&&c<this.gridRightBoundary&&x>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const c=p.identity([]);return p.translate(c,c,[-100,-100,0]),c}}function Hn(g,c,h){const _=c.createTileMatrix(g,g.worldSize,h.toUnwrapped());return p.multiply(new Float32Array(16),g.projMatrix,_)}function As(g,c,h){if(c.projection.name===h.projection.name)return g.projMatrix;const _=h.clone();return _.setProjection(c.projection),Hn(_,c.getProjection(),g)}function Ur(g,c,h){return c.name===h.projection.name?g.projMatrix:Hn(h,c,g)}class Ot{constructor(c,h,_,x){this.opacity=c?Math.max(0,Math.min(1,c.opacity+(c.placed?h:-h))):x&&_?1:0,this.placed=_}isHidden(){return 0===this.opacity&&!this.placed}}class sa{constructor(c,h,_,x,S,D=!1){this.text=new Ot(c?c.text:null,h,_,S),this.icon=new Ot(c?c.icon:null,h,x,S),this.clipped=D}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ii{constructor(c,h,_,x=!1){this.text=c,this.icon=h,this.skipFade=_,this.clipped=x}}class Xi{constructor(){this.invProjMatrix=p.create(),this.viewportMatrix=p.create(),this.circles=[]}}class qp{constructor(c,h,_,x,S){this.bucketInstanceId=c,this.featureIndex=h,this.sourceLayerIndex=_,this.bucketIndex=x,this.tileID=S}}class t_{constructor(c){this.crossSourceCollisions=c,this.maxGroupID=0,this.collisionGroups={}}get(c){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[c]){const h=++this.maxGroupID;this.collisionGroups[c]={ID:h,predicate:_=>_.collisionGroupID===h}}return this.collisionGroups[c]}}function dd(g,c,h,_,x){const{horizontalAlign:S,verticalAlign:D}=p.getAnchorAlignment(g),I=-(S-.5)*c,R=-(D-.5)*h,O=p.evaluateVariableOffset(g,_);return new p.Point(I+O[0]*x,R+O[1]*x)}function Zl(g,c,h,_,x){const S=new p.Point(g,c);return h&&S._rotate(_?x:-x),S}class Jo{constructor(c,h,_,x,S){this.transform=c.clone(),this.projection=c.projection.name,this.collisionIndex=new Ni(this.transform,S),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new t_(_),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(c,h,_,x){const S=_.getBucket(h),D=_.latestFeatureIndex;if(!S||!D||h.id!==S.layerIds[0])return;const I=S.layers[0].layout,R=_.collisionBoxArray,O=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),F=_.tileSize/p.EXTENT,j=_.tileID.toUnwrapped();this.transform.setProjection(S.projection);const Y=(ee=_.tileID,se=S.getProjection(),ie=this.transform,se.name===this.projection?ie.calculateProjMatrix(ee.toUnwrapped()):Hn(ie,se,ee));var ee,se,ie;const le="map"===I.get("text-pitch-alignment"),U="map"===I.get("text-rotation-alignment");h.compileFilter();const J=h.dynamicFilter(),pe=h.dynamicFilterNeedsFeature(),ge=this.transform.calculatePixelsToTileUnitsMatrix(_),Fe=yl(Y,_.tileID.canonical,le,U,this.transform,S.getProjection(),ge);let Pe=null;if(le){const He=co(Y,_.tileID.canonical,le,U,this.transform,S.getProjection(),ge);Pe=p.multiply([],this.transform.labelPlaneMatrix,He)}let Oe=null;J&&_.latestFeatureIndex&&(Oe={unwrappedTileID:j,dynamicFilter:J,dynamicFilterNeedsFeature:pe,featureIndex:_.latestFeatureIndex}),this.retainedQueryData[S.bucketInstanceId]=new qp(S.bucketInstanceId,D,S.sourceLayerIndex,S.index,_.tileID);const We={bucket:S,layout:I,posMatrix:Y,textLabelPlaneMatrix:Fe,labelToScreenMatrix:Pe,clippingData:Oe,scale:O,textPixelRatio:F,holdingForFade:_.holdingForFade(),collisionBoxArray:R,partiallyEvaluatedTextSize:p.evaluateSizeForZoom(S.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:p.evaluateSizeForZoom(S.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(S.sourceID)};if(x)for(const He of S.sortKeyRanges){const{sortKey:ot,symbolInstanceStart:Ft,symbolInstanceEnd:nt}=He;c.push({sortKey:ot,symbolInstanceStart:Ft,symbolInstanceEnd:nt,parameters:We})}else c.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:We})}attemptAnchorPlacement(c,h,_,x,S,D,I,R,O,F,j,Y,ee,se,ie,le,U,J){const{textOffset0:pe,textOffset1:ge,crossTileID:Fe}=Y,Pe=[pe,ge],Oe=dd(c,_,x,Pe,S),We=this.collisionIndex.placeCollisionBox(se,S,h,Zl(Oe.x,Oe.y,D,I,this.transform.angle),j,R,O,F.predicate);if(le){const He=se.getSymbolInstanceIconSize(J,this.transform.zoom,Y.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(se,He,le,Zl(Oe.x,Oe.y,D,I,this.transform.angle),j,R,O,F.predicate).box.length)return}if(We.box.length>0){let He;return this.prevPlacement&&this.prevPlacement.variableOffsets[Fe]&&this.prevPlacement.placements[Fe]&&this.prevPlacement.placements[Fe].text&&(He=this.prevPlacement.variableOffsets[Fe].anchor),this.variableOffsets[Fe]={textOffset:Pe,width:_,height:x,anchor:c,textScale:S,prevAnchor:He},this.markUsedJustification(se,c,Y,ie),se.allowVerticalPlacement&&(this.markUsedOrientation(se,ie,Y),this.placedOrientations[Fe]=ie),{shift:Oe,placedGlyphBoxes:We}}}placeLayerBucketPart(c,h,_,x){const{bucket:S,layout:D,posMatrix:I,textLabelPlaneMatrix:R,labelToScreenMatrix:O,clippingData:F,textPixelRatio:j,holdingForFade:Y,collisionBoxArray:ee,partiallyEvaluatedTextSize:se,partiallyEvaluatedIconSize:ie,collisionGroup:le}=c.parameters,U=D.get("text-optional"),J=D.get("icon-optional"),pe=D.get("text-allow-overlap"),ge=D.get("icon-allow-overlap"),Fe="map"===D.get("text-rotation-alignment"),Pe="map"===D.get("text-pitch-alignment"),Oe="none"!==D.get("icon-text-fit"),We="viewport-y"===D.get("symbol-z-order");this.transform.setProjection(S.projection);let He=pe&&(ge||!S.hasIconData()||J),ot=ge&&(pe||!S.hasTextData()||U);!S.collisionArrays&&ee&&S.deserializeCollisionBoxes(ee),_&&x&&S.updateCollisionDebugBuffers(this.transform.zoom,ee);const Ft=(nt,St,pt)=>{const{crossTileID:Nt,numVerticalGlyphVertices:it}=nt;if(F){const Ir={zoom:this.transform.zoom,pitch:this.transform.pitch};let or=null;if(F.dynamicFilterNeedsFeature){const Yi=this.retainedQueryData[S.bucketInstanceId];or=F.featureIndex.loadFeature({featureIndex:nt.featureIndex,bucketIndex:Yi.bucketIndex,sourceLayerIndex:Yi.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,F.dynamicFilter)(Ir,or,this.retainedQueryData[S.bucketInstanceId].tileID.canonical,new p.Point(nt.tileAnchorX,nt.tileAnchorY),this.transform.calculateDistanceTileData(F.unwrappedTileID)))return this.placements[Nt]=new ii(!1,!1,!1,!0),void h.add(Nt)}if(h.has(Nt))return;if(Y)return void(this.placements[Nt]=new ii(!1,!1,!1));let vt=!1,Bt=!1,Mt=!0,Vt=!1,In=!1,zn=null,bn={box:null,offscreen:null,occluded:null},An={box:null,offscreen:null,occluded:null},gi=null,oi=null,En=null,nr=0,pr=0,_r=0;pt.textFeatureIndex?nr=pt.textFeatureIndex:nt.useRuntimeCollisionCircles&&(nr=nt.featureIndex),pt.verticalTextFeatureIndex&&(pr=pt.verticalTextFeatureIndex);const ki=Ir=>{Ir.tileID=this.retainedQueryData[S.bucketInstanceId].tileID;const or=this.transform.elevation;(or||Ir.elevation)&&(Ir.elevation=or?or.getAtTileOffset(Ir.tileID,Ir.tileAnchorX,Ir.tileAnchorY):0)},ns=pt.textBox;if(ns){ki(ns);const Ir=Yi=>{let ro=p.WritingMode.horizontal;if(S.allowVerticalPlacement&&!Yi&&this.prevPlacement){const is=this.prevPlacement.placedOrientations[Nt];is&&(this.placedOrientations[Nt]=is,ro=is,this.markUsedOrientation(S,ro,nt))}return ro},or=(Yi,ro)=>{if(S.allowVerticalPlacement&&it>0&&pt.verticalTextBox){for(const is of S.writingModes)if(is===p.WritingMode.vertical?(bn=ro(),An=bn):bn=Yi(),bn&&bn.box&&bn.box.length)break}else bn=Yi()};if(D.get("text-variable-anchor")){let Yi=D.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Nt]){const Rr=this.prevPlacement.variableOffsets[Nt];Yi.indexOf(Rr.anchor)>0&&(Yi=Yi.filter(vs=>vs!==Rr.anchor),Yi.unshift(Rr.anchor))}const ro=(Rr,vs,Xh)=>{const il=S.getSymbolInstanceTextSize(se,nt,this.transform.zoom,St),Tl=(Rr.x2-Rr.x1)*il+2*Rr.padding,El=(Rr.y2-Rr.y1)*il+2*Rr.padding,Dl=Oe&&!ge?vs:null;Dl&&ki(Dl);let rc={box:[],offscreen:!1,occluded:!1};const Il=pe?2*Yi.length:Yi.length;for(let Ld=0;Ld<Il;++Ld){const Vi=this.attemptAnchorPlacement(Yi[Ld%Yi.length],Rr,Tl,El,il,Fe,Pe,j,I,le,Ld>=Yi.length,nt,St,S,Xh,Dl,se,ie);if(Vi&&(rc=Vi.placedGlyphBoxes,rc&&rc.box&&rc.box.length)){vt=!0,zn=Vi.shift;break}}return rc};or(()=>ro(ns,pt.iconBox,p.WritingMode.horizontal),()=>{const Rr=pt.verticalTextBox;return Rr&&ki(Rr),S.allowVerticalPlacement&&!(bn&&bn.box&&bn.box.length)&&it>0&&Rr?ro(Rr,pt.verticalIconBox,p.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),bn&&(vt=bn.box,Mt=bn.offscreen,Vt=bn.occluded);const is=Ir(!(!bn||!bn.box));if(!vt&&this.prevPlacement){const Rr=this.prevPlacement.variableOffsets[Nt];Rr&&(this.variableOffsets[Nt]=Rr,this.markUsedJustification(S,Rr.anchor,nt,is))}}else{const Yi=(ro,is)=>{const Rr=S.getSymbolInstanceTextSize(se,nt,this.transform.zoom,St),vs=this.collisionIndex.placeCollisionBox(S,Rr,ro,new p.Point(0,0),pe,j,I,le.predicate);return vs&&vs.box&&vs.box.length&&(this.markUsedOrientation(S,is,nt),this.placedOrientations[Nt]=is),vs};or(()=>Yi(ns,p.WritingMode.horizontal),()=>{const ro=pt.verticalTextBox;return S.allowVerticalPlacement&&it>0&&ro?(ki(ro),Yi(ro,p.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Ir(!!(bn&&bn.box&&bn.box.length))}}if(gi=bn,vt=gi&&gi.box&&gi.box.length>0,Mt=gi&&gi.offscreen,Vt=gi&&gi.occluded,nt.useRuntimeCollisionCircles){const Ir=S.text.placedSymbolArray.get(nt.centerJustifiedTextSymbolIndex>=0?nt.centerJustifiedTextSymbolIndex:nt.verticalPlacedTextSymbolIndex),or=p.evaluateSizeForFeature(S.textSizeData,se,Ir),Yi=D.get("text-padding");oi=this.collisionIndex.placeCollisionCircles(S,pe,Ir,S.lineVertexArray,S.glyphOffsetArray,or,I,R,O,_,Pe,le.predicate,nt.collisionCircleDiameter*or/p.ONE_EM,Yi,this.retainedQueryData[S.bucketInstanceId].tileID),vt=pe||oi.circles.length>0&&!oi.collisionDetected,Mt=Mt&&oi.offscreen,Vt=oi.occluded}if(pt.iconFeatureIndex&&(_r=pt.iconFeatureIndex),pt.iconBox){const Ir=or=>{ki(or);const Yi=Oe&&zn?Zl(zn.x,zn.y,Fe,Pe,this.transform.angle):new p.Point(0,0),ro=S.getSymbolInstanceIconSize(ie,this.transform.zoom,nt.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(S,ro,or,Yi,ge,j,I,le.predicate)};An&&An.box&&An.box.length&&pt.verticalIconBox?(En=Ir(pt.verticalIconBox),Bt=En.box.length>0):(En=Ir(pt.iconBox),Bt=En.box.length>0),Mt=Mt&&En.offscreen,In=En.occluded}const io=U||0===nt.numHorizontalGlyphVertices&&0===it,Ns=J||0===nt.numIconVertices;if(io||Ns?Ns?io||(Bt=Bt&&vt):vt=Bt&&vt:Bt=vt=Bt&&vt,vt&&gi&&gi.box&&this.collisionIndex.insertCollisionBox(gi.box,D.get("text-ignore-placement"),S.bucketInstanceId,An&&An.box&&pr?pr:nr,le.ID),Bt&&En&&this.collisionIndex.insertCollisionBox(En.box,D.get("icon-ignore-placement"),S.bucketInstanceId,_r,le.ID),oi&&(vt&&this.collisionIndex.insertCollisionCircles(oi.circles,D.get("text-ignore-placement"),S.bucketInstanceId,nr,le.ID),_)){const Ir=S.bucketInstanceId;let or=this.collisionCircleArrays[Ir];void 0===or&&(or=this.collisionCircleArrays[Ir]=new Xi);for(let Yi=0;Yi<oi.circles.length;Yi+=4)or.circles.push(oi.circles[Yi+0]),or.circles.push(oi.circles[Yi+1]),or.circles.push(oi.circles[Yi+2]),or.circles.push(oi.collisionDetected?1:0)}const da="globe"!==S.projection.name;He=He&&(da||!Vt),ot=ot&&(da||!In),this.placements[Nt]=new ii(vt||He,Bt||ot,Mt||S.justReloaded),h.add(Nt)};if(We){const nt=S.getSortedSymbolIndexes(this.transform.angle);for(let St=nt.length-1;St>=0;--St){const pt=nt[St];Ft(S.symbolInstances.get(pt),pt,S.collisionArrays[pt])}}else for(let nt=c.symbolInstanceStart;nt<c.symbolInstanceEnd;nt++)Ft(S.symbolInstances.get(nt),nt,S.collisionArrays[nt]);if(_&&S.bucketInstanceId in this.collisionCircleArrays){const nt=this.collisionCircleArrays[S.bucketInstanceId];p.invert(nt.invProjMatrix,I),nt.viewportMatrix=this.collisionIndex.getViewportMatrix()}S.justReloaded=!1}markUsedJustification(c,h,_,x){const{leftJustifiedTextSymbolIndex:S,centerJustifiedTextSymbolIndex:D,rightJustifiedTextSymbolIndex:I,verticalPlacedTextSymbolIndex:R,crossTileID:O}=_,F=p.getAnchorJustification(h),j=x===p.WritingMode.vertical?R:"left"===F?S:"center"===F?D:"right"===F?I:-1;S>=0&&(c.text.placedSymbolArray.get(S).crossTileID=j>=0&&S!==j?0:O),D>=0&&(c.text.placedSymbolArray.get(D).crossTileID=j>=0&&D!==j?0:O),I>=0&&(c.text.placedSymbolArray.get(I).crossTileID=j>=0&&I!==j?0:O),R>=0&&(c.text.placedSymbolArray.get(R).crossTileID=j>=0&&R!==j?0:O)}markUsedOrientation(c,h,_){const x=h===p.WritingMode.horizontal||h===p.WritingMode.horizontalOnly?h:0,S=h===p.WritingMode.vertical?h:0,{leftJustifiedTextSymbolIndex:D,centerJustifiedTextSymbolIndex:I,rightJustifiedTextSymbolIndex:R,verticalPlacedTextSymbolIndex:O}=_,F=c.text.placedSymbolArray;D>=0&&(F.get(D).placedOrientation=x),I>=0&&(F.get(I).placedOrientation=x),R>=0&&(F.get(R).placedOrientation=x),O>=0&&(F.get(O).placedOrientation=S)}commit(c){this.commitTime=c,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let _=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const x=h?h.symbolFadeChange(c):1,S=h?h.opacities:{},D=h?h.variableOffsets:{},I=h?h.placedOrientations:{};for(const R in this.placements){const O=this.placements[R],F=S[R];F?(this.opacities[R]=new sa(F,x,O.text,O.icon,null,O.clipped),_=_||O.text!==F.text.placed||O.icon!==F.icon.placed):(this.opacities[R]=new sa(null,x,O.text,O.icon,O.skipFade,O.clipped),_=_||O.text||O.icon)}for(const R in S){const O=S[R];if(!this.opacities[R]){const F=new sa(O,x,!1,!1);F.isHidden()||(this.opacities[R]=F,_=_||O.text.placed||O.icon.placed)}}for(const R in D)this.variableOffsets[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.variableOffsets[R]=D[R]);for(const R in I)this.placedOrientations[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.placedOrientations[R]=I[R]);_?this.lastPlacementChangeTime=c:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:c)}updateLayerOpacities(c,h){const _=new Set;for(const x of h){const S=x.getBucket(c);S&&x.latestFeatureIndex&&c.id===S.layerIds[0]&&this.updateBucketOpacities(S,_,x.collisionBoxArray)}}updateBucketOpacities(c,h,_){c.hasTextData()&&c.text.opacityVertexArray.clear(),c.hasIconData()&&c.icon.opacityVertexArray.clear(),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexArray.clear(),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexArray.clear();const x=c.layers[0].layout,S=!!c.layers[0].dynamicFilter(),D=new sa(null,0,!1,!1,!0),I=x.get("text-allow-overlap"),R=x.get("icon-allow-overlap"),O=x.get("text-variable-anchor"),F="map"===x.get("text-rotation-alignment"),j="map"===x.get("text-pitch-alignment"),Y="none"!==x.get("icon-text-fit"),ee=new sa(null,0,I&&(R||!c.hasIconData()||x.get("icon-optional")),R&&(I||!c.hasTextData()||x.get("text-optional")),!0);!c.collisionArrays&&_&&(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData())&&c.deserializeCollisionBoxes(_);const se=(le,U,J)=>{for(let pe=0;pe<U/4;pe++)le.opacityVertexArray.emplaceBack(J)};let ie=0;for(let le=0;le<c.symbolInstances.length;le++){const U=c.symbolInstances.get(le),{numHorizontalGlyphVertices:J,numVerticalGlyphVertices:pe,crossTileID:ge,numIconVertices:Fe}=U,Pe=h.has(ge);let Oe=this.opacities[ge];Pe?Oe=D:Oe||(Oe=ee,this.opacities[ge]=Oe),h.add(ge);const We=J>0||pe>0,He=Fe>0,ot=this.placedOrientations[ge],Ft=ot===p.WritingMode.vertical,nt=ot===p.WritingMode.horizontal||ot===p.WritingMode.horizontalOnly;if(!We&&!He||Oe.isHidden()||ie++,We){const St=pd(Oe.text);se(c.text,J,Ft?to:St),se(c.text,pe,nt?to:St);const pt=Oe.text.isHidden(),{leftJustifiedTextSymbolIndex:Nt,centerJustifiedTextSymbolIndex:it,rightJustifiedTextSymbolIndex:vt,verticalPlacedTextSymbolIndex:Bt}=U,Mt=c.text.placedSymbolArray,Vt=pt||Ft?1:0;Nt>=0&&(Mt.get(Nt).hidden=Vt),it>=0&&(Mt.get(it).hidden=Vt),vt>=0&&(Mt.get(vt).hidden=Vt),Bt>=0&&(Mt.get(Bt).hidden=pt||nt?1:0);const In=this.variableOffsets[ge];In&&this.markUsedJustification(c,In.anchor,U,ot);const zn=this.placedOrientations[ge];zn&&(this.markUsedJustification(c,"left",U,zn),this.markUsedOrientation(c,zn,U))}if(He){const St=pd(Oe.icon),{placedIconSymbolIndex:pt,verticalPlacedIconSymbolIndex:Nt}=U,it=c.icon.placedSymbolArray,vt=Oe.icon.isHidden()?1:0;pt>=0&&(se(c.icon,Fe,Ft?to:St),it.get(pt).hidden=vt),Nt>=0&&(se(c.icon,U.numVerticalIconVertices,nt?to:St),it.get(Nt).hidden=vt)}if(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData()){const St=c.collisionArrays[le];if(St){let pt=new p.Point(0,0),Nt=!0;if(St.textBox||St.verticalTextBox){if(O){const vt=this.variableOffsets[ge];vt?(pt=dd(vt.anchor,vt.width,vt.height,vt.textOffset,vt.textScale),F&&pt._rotate(j?this.transform.angle:-this.transform.angle)):Nt=!1}S&&(Nt=!Oe.clipped),St.textBox&&hd(c.textCollisionBox.collisionVertexArray,Oe.text.placed,!Nt||Ft,pt.x,pt.y),St.verticalTextBox&&hd(c.textCollisionBox.collisionVertexArray,Oe.text.placed,!Nt||nt,pt.x,pt.y)}const it=Nt&&Boolean(!nt&&St.verticalIconBox);St.iconBox&&hd(c.iconCollisionBox.collisionVertexArray,Oe.icon.placed,it,Y?pt.x:0,Y?pt.y:0),St.verticalIconBox&&hd(c.iconCollisionBox.collisionVertexArray,Oe.icon.placed,!it,Y?pt.x:0,Y?pt.y:0)}}}if(c.fullyClipped=0===ie,c.sortFeatures(this.transform.angle),this.retainedQueryData[c.bucketInstanceId]&&(this.retainedQueryData[c.bucketInstanceId].featureSortOrder=c.featureSortOrder),c.hasTextData()&&c.text.opacityVertexBuffer&&c.text.opacityVertexBuffer.updateData(c.text.opacityVertexArray),c.hasIconData()&&c.icon.opacityVertexBuffer&&c.icon.opacityVertexBuffer.updateData(c.icon.opacityVertexArray),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexBuffer&&c.iconCollisionBox.collisionVertexBuffer.updateData(c.iconCollisionBox.collisionVertexArray),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexBuffer&&c.textCollisionBox.collisionVertexBuffer.updateData(c.textCollisionBox.collisionVertexArray),c.bucketInstanceId in this.collisionCircleArrays){const le=this.collisionCircleArrays[c.bucketInstanceId];c.placementInvProjMatrix=le.invProjMatrix,c.placementViewportMatrix=le.viewportMatrix,c.collisionCircleArray=le.circles,delete this.collisionCircleArrays[c.bucketInstanceId]}}symbolFadeChange(c){return 0===this.fadeDuration?1:(c-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(c){return Math.max(0,(this.transform.zoom-c)/1.5)}hasTransitions(c){return this.stale||c-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(c,h){const _=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*_>c}setStale(){this.stale=!0}}function hd(g,c,h,_,x){g.emplaceBack(c?1:0,h?1:0,_||0,x||0),g.emplaceBack(c?1:0,h?1:0,_||0,x||0),g.emplaceBack(c?1:0,h?1:0,_||0,x||0),g.emplaceBack(c?1:0,h?1:0,_||0,x||0)}const ks=Math.pow(2,25),uo=Math.pow(2,24),xa=Math.pow(2,17),Fm=Math.pow(2,16),Gs=Math.pow(2,9),wa=Math.pow(2,8),n_=Math.pow(2,1);function pd(g){if(0===g.opacity&&!g.placed)return 0;if(1===g.opacity&&g.placed)return 4294967295;const c=g.placed?1:0,h=Math.floor(127*g.opacity);return h*ks+c*uo+h*xa+c*Fm+h*Gs+c*wa+h*n_+c}const to=0;class fd{constructor(c){this._sortAcrossTiles="viewport-y"!==c.layout.get("symbol-z-order")&&void 0!==c.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(c,h,_,x,S){const D=this._bucketParts;for(;this._currentTileIndex<c.length;)if(h.getBucketParts(D,x,c[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,S())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,D.sort((I,R)=>I.sortKey-R.sortKey));this._currentPartIndex<D.length;){const I=D[this._currentPartIndex];if(h.placeLayerBucketPart(I,this._seenCrossTileIDs,_,0===I.symbolInstanceStart),this._currentPartIndex++,S())return!0}return!1}}class Nm{constructor(c,h,_,x,S,D,I,R){this.placement=new Jo(c,S,D,I,R),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(c,h,_){const x=p.exported.now(),S=()=>{const D=p.exported.now()-x;return!this._forceFullPlacement&&D>2};for(;this._currentPlacementIndex>=0;){const D=h[c[this._currentPlacementIndex]],I=this.placement.collisionIndex.transform.zoom;if("symbol"===D.type&&(!D.minzoom||D.minzoom<=I)&&(!D.maxzoom||D.maxzoom>I)){if(this._inProgressLayer||(this._inProgressLayer=new fd(D)),this._inProgressLayer.continuePlacement(_[D.source],this.placement,this._showCollisionBoxes,D,S))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(c){return this.placement.commit(c),this.placement}}const So=512/p.EXTENT/2;class ci{constructor(c,h,_){this.tileID=c,this.bucketInstanceId=_,this.index=new p.KDBush(h.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const x=c.canonical.x*p.EXTENT,S=c.canonical.y*p.EXTENT;for(let D=0;D<h.length;D++){const{key:I,crossTileID:R,tileAnchorX:O,tileAnchorY:F}=h.get(D),j=Math.floor((x+O)*So),Y=Math.floor((S+F)*So);this.index.add(j,Y),this.keys.push(I),this.crossTileIDs.push(R)}this.index.finish()}findMatches(c,h,_){const x=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z),S=So/Math.pow(2,h.canonical.z-this.tileID.canonical.z),D=h.canonical.x*p.EXTENT,I=h.canonical.y*p.EXTENT;for(let R=0;R<c.length;R++){const O=c.get(R);if(O.crossTileID)continue;const{key:F,tileAnchorX:j,tileAnchorY:Y}=O,ee=Math.floor((D+j)*S),se=Math.floor((I+Y)*S),ie=this.index.range(ee-x,se-x,ee+x,se+x);for(const le of ie){const U=this.crossTileIDs[le];if(this.keys[le]===F&&!_.has(U)){_.add(U),O.crossTileID=U;break}}}}}class Bm{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class zm{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(c){const h=Math.round((c-this.lng)/360);if(0!==h)for(const _ in this.indexes){const x=this.indexes[_],S={};for(const D in x){const I=x[D];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+h),S[I.tileID.key]=I}this.indexes[_]=S}this.lng=c}addBucket(c,h,_){if(this.indexes[c.overscaledZ]&&this.indexes[c.overscaledZ][c.key]){if(this.indexes[c.overscaledZ][c.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(c.overscaledZ,this.indexes[c.overscaledZ][c.key])}for(let S=0;S<h.symbolInstances.length;S++)h.symbolInstances.get(S).crossTileID=0;this.usedCrossTileIDs[c.overscaledZ]||(this.usedCrossTileIDs[c.overscaledZ]=new Set);const x=this.usedCrossTileIDs[c.overscaledZ];for(const S in this.indexes){const D=this.indexes[S];if(Number(S)>c.overscaledZ)for(const I in D){const R=D[I];R.tileID.isChildOf(c)&&R.findMatches(h.symbolInstances,c,x)}else{const I=D[c.scaledTo(Number(S)).key];I&&I.findMatches(h.symbolInstances,c,x)}}for(let S=0;S<h.symbolInstances.length;S++){const D=h.symbolInstances.get(S);D.crossTileID||(D.crossTileID=_.generate(),x.add(D.crossTileID))}return void 0===this.indexes[c.overscaledZ]&&(this.indexes[c.overscaledZ]={}),this.indexes[c.overscaledZ][c.key]=new ci(c,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(c,h){for(const _ of h.crossTileIDs)this.usedCrossTileIDs[c].delete(_)}removeStaleBuckets(c){let h=!1;for(const _ in this.indexes){const x=this.indexes[_];for(const S in x)c[x[S].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,x[S]),delete x[S],h=!0)}return h}}class Yl{constructor(){this.layerIndexes={},this.crossTileIDs=new Bm,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(c,h,_,x){let S=this.layerIndexes[c.id];void 0===S&&(S=this.layerIndexes[c.id]=new zm);let D=!1;const I={};"globe"!==x.name&&S.handleWrapJump(_);for(const R of h){const O=R.getBucket(c);O&&c.id===O.layerIds[0]&&(O.bucketInstanceId||(O.bucketInstanceId=++this.maxBucketInstanceId),S.addBucket(R.tileID,O,this.crossTileIDs)&&(D=!0),I[O.bucketInstanceId]=!0)}return S.removeStaleBuckets(I)&&(D=!0),D}pruneUnusedLayers(c){const h={};c.forEach(_=>{h[_]=!0});for(const _ in this.layerIndexes)h[_]||delete this.layerIndexes[_]}}const Jt=(g,c)=>p.emitValidationErrors(g,c&&c.filter(h=>"source.canvas"!==h.identifier)),Wp=p.pick(Gn,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),wn=p.pick(Gn,["setCenter","setZoom","setBearing","setPitch"]),fu={version:8,layers:[],sources:{}},mu={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Sa extends p.Evented{constructor(c,h={}){super(),this.map=c,this.dispatcher=new kt(hu(),this),this.imageManager=new dt,this.imageManager.setEventedParent(this),this.glyphManager=new p.GlyphManager(c._requestManager,h.localFontFamily?p.LocalGlyphMode.all:h.localIdeographFontFamily?p.LocalGlyphMode.ideographs:p.LocalGlyphMode.none,h.localFontFamily||h.localIdeographFontFamily),this.crossTileSymbolIndex=new Yl,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",p.getReferrer());const _=this;this._rtlTextPluginCallback=Sa.registerForPluginStateChange(x=>{_.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:x.pluginStatus,pluginURL:x.pluginURL},(S,D)=>{if(p.triggerPluginCompletionEvent(S),D&&D.every(I=>I))for(const I in _._sourceCaches){const R=_._sourceCaches[I],O=R.getSource().type;"vector"!==O&&"geojson"!==O||R.reload()}})}),this.on("data",x=>{if("source"!==x.dataType||"metadata"!==x.sourceDataType)return;const S=this.getSource(x.sourceId);if(S&&S.vectorLayerIds)for(const D in this._layers){const I=this._layers[D];I.source===S.id&&this._validateLayer(I)}})}loadURL(c,h={}){this.fire(new p.Event("dataloading",{dataType:"style"}));const _="boolean"==typeof h.validate?h.validate:!p.isMapboxURL(c);c=this.map._requestManager.normalizeStyleURL(c,h.accessToken);const x=this.map._requestManager.transformRequest(c,p.ResourceType.Style);this._request=p.getJSON(x,(S,D)=>{this._request=null,S?this.fire(new p.ErrorEvent(S)):D&&this._load(D,_)})}loadJSON(c,h={}){this.fire(new p.Event("dataloading",{dataType:"style"})),this._request=p.exported.frame(()=>{this._request=null,this._load(c,!1!==h.validate)})}loadEmpty(){this.fire(new p.Event("dataloading",{dataType:"style"})),this._load(fu,!1)}_updateLayerCount(c,h){const _=h?1:-1;c.is3D()&&(this._num3DLayers+=_),"circle"===c.type&&(this._numCircleLayers+=_),"symbol"===c.type&&(this._numSymbolLayers+=_)}_load(c,h){if(h&&Jt(this,p.validateStyle(c)))return;this._loaded=!0,this.stylesheet=p.clone$1(c),this._updateMapProjection();for(const x in c.sources)this.addSource(x,c.sources[x],{validate:!1});this._changed=!1,c.sprite?this._loadSprite(c.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(c.glyphs);const _=Lm(this.stylesheet.layers);this._order=_.map(x=>x.id),this._layers={},this._serializedLayers={};for(const x of _){const S=p.createStyleLayer(x);S.setEventedParent(this,{layer:{id:S.id}}),this._layers[S.id]=S,this._serializedLayers[S.id]=S.serialize(),this._updateLayerCount(S,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new me(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new p.Event("data",{dataType:"style"})),this.fire(new p.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(c){c?this.stylesheet.projection=c:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(c){this._spriteRequest=function(h,_,x){let S,D,I;const R=p.exported.devicePixelRatio>1?"@2x":"";let O=p.getJSON(_.transformRequest(_.normalizeSpriteURL(h,R,".json"),p.ResourceType.SpriteJSON),(Y,ee)=>{O=null,I||(I=Y,S=ee,j())}),F=p.getImage(_.transformRequest(_.normalizeSpriteURL(h,R,".png"),p.ResourceType.SpriteImage),(Y,ee)=>{F=null,I||(I=Y,D=ee,j())});function j(){if(I)x(I);else if(S&&D){const Y=p.exported.getImageData(D),ee={};for(const se in S){const{width:ie,height:le,x:U,y:J,sdf:pe,pixelRatio:ge,stretchX:Fe,stretchY:Pe,content:Oe}=S[se],We=new p.RGBAImage({width:ie,height:le});p.RGBAImage.copy(Y,We,{x:U,y:J},{x:0,y:0},{width:ie,height:le}),ee[se]={data:We,pixelRatio:ge,sdf:pe,stretchX:Fe,stretchY:Pe,content:Oe}}x(null,ee)}}return{cancel(){O&&(O.cancel(),O=null),F&&(F.cancel(),F=null)}}}(c,this.map._requestManager,(h,_)=>{if(this._spriteRequest=null,h)this.fire(new p.ErrorEvent(h));else if(_)for(const x in _)this.imageManager.addImage(x,_[x]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new p.Event("data",{dataType:"style"}))})}_validateLayer(c){const h=this.getSource(c.source);if(!h)return;const _=c.sourceLayer;_&&("geojson"===h.type||h.vectorLayerIds&&-1===h.vectorLayerIds.indexOf(_))&&this.fire(new p.ErrorEvent(new Error(`Source layer "${_}" does not exist on source "${h.id}" as specified by style layer "${c.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const c in this._sourceCaches)if(!this._sourceCaches[c].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(c){const h=[];for(const _ of c){const x=this._layers[_];"custom"!==x.type&&h.push(x.serialize())}return h}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const c in this._sourceCaches)if(this._sourceCaches[c].hasTransition())return!0;for(const c in this._layers)if(this._layers[c].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(c){return!!this.terrain&&("function"==typeof c.isLayerDraped?c.isLayerDraped():mu[c.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(c){if(!this._loaded)return;const h=this._changed;if(this._changed){const x=Object.keys(this._updatedLayers),S=Object.keys(this._removedLayers);(x.length||S.length)&&this._updateWorkerLayers(x,S);for(const D in this._updatedSources){const I=this._updatedSources[D];"reload"===I?this._reloadSource(D):"clear"===I&&this._clearSource(D)}this._updateTilesForChangedImages();for(const D in this._updatedPaintProps)this._layers[D].updateTransitions(c);this.light.updateTransitions(c),this.fog&&this.fog.updateTransitions(c),this._resetUpdates()}const _={};for(const x in this._sourceCaches){const S=this._sourceCaches[x];_[x]=S.used,S.used=!1}for(const x of this._order){const S=this._layers[x];if(S.recalculate(c,this._availableImages),!S.isHidden(c.zoom)){const I=this._getLayerSourceCache(S);I&&(I.used=!0)}const D=this.map.painter;if(D){const I=S.getProgramIds();if(!I)continue;const R=S.getProgramConfiguration(c.zoom);for(const O of I)D.useProgram(O,R)}}for(const x in _){const S=this._sourceCaches[x];_[x]!==S.used&&S.getSource().fire(new p.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:S.getSource().id}))}this.light.recalculate(c),this.terrain&&this.terrain.recalculate(c),this.fog&&this.fog.recalculate(c),this.z=c.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),h&&this.fire(new p.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const c=Object.keys(this._changedImages);if(c.length){for(const h in this._sourceCaches)this._sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],c);this._changedImages={}}}_updateWorkerLayers(c,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(c),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(c){if(this._checkLoaded(),Jt(this,p.validateStyle(c)))return!1;(c=p.clone$1(c)).layers=Lm(c.layers);const h=function(x,S){if(!x)return[{command:Gn.setStyle,args:[S]}];let D=[];try{if(!te(x.version,S.version))return[{command:Gn.setStyle,args:[S]}];te(x.center,S.center)||D.push({command:Gn.setCenter,args:[S.center]}),te(x.zoom,S.zoom)||D.push({command:Gn.setZoom,args:[S.zoom]}),te(x.bearing,S.bearing)||D.push({command:Gn.setBearing,args:[S.bearing]}),te(x.pitch,S.pitch)||D.push({command:Gn.setPitch,args:[S.pitch]}),te(x.sprite,S.sprite)||D.push({command:Gn.setSprite,args:[S.sprite]}),te(x.glyphs,S.glyphs)||D.push({command:Gn.setGlyphs,args:[S.glyphs]}),te(x.transition,S.transition)||D.push({command:Gn.setTransition,args:[S.transition]}),te(x.light,S.light)||D.push({command:Gn.setLight,args:[S.light]}),te(x.fog,S.fog)||D.push({command:Gn.setFog,args:[S.fog]}),te(x.projection,S.projection)||D.push({command:Gn.setProjection,args:[S.projection]});const I={},R=[];!function(j,Y,ee,se){let ie;for(ie in Y=Y||{},j=j||{})j.hasOwnProperty(ie)&&(Y.hasOwnProperty(ie)||ps(ie,ee,se));for(ie in Y){if(!Y.hasOwnProperty(ie))continue;const le=Y[ie];j.hasOwnProperty(ie)?te(j[ie],le)||("geojson"===j[ie].type&&"geojson"===le.type&&Th(j,Y,ie)?ee.push({command:Gn.setGeoJSONSourceData,args:[ie,le.data]}):Om(ie,Y,ee,se)):Xl(ie,Y,ee)}}(x.sources,S.sources,R,I);const O=[];x.layers&&x.layers.forEach(j=>{j.source&&I[j.source]?D.push({command:Gn.removeLayer,args:[j.id]}):O.push(j)});let F=x.terrain;F&&I[F.source]&&(D.push({command:Gn.setTerrain,args:[void 0]}),F=void 0),D=D.concat(R),te(F,S.terrain)||D.push({command:Gn.setTerrain,args:[S.terrain]}),function(j,Y,ee){Y=Y||[];const se=(j=j||[]).map(va),ie=Y.map(va),le=j.reduce(Eh,{}),U=Y.reduce(Eh,{}),J=se.slice(),pe=Object.create(null);let ge,Fe,Pe,Oe,We,He,ot;for(ge=0,Fe=0;ge<se.length;ge++)Pe=se[ge],U.hasOwnProperty(Pe)?Fe++:(ee.push({command:Gn.removeLayer,args:[Pe]}),J.splice(J.indexOf(Pe,Fe),1));for(ge=0,Fe=0;ge<ie.length;ge++)Pe=ie[ie.length-1-ge],J[J.length-1-ge]!==Pe&&(le.hasOwnProperty(Pe)?(ee.push({command:Gn.removeLayer,args:[Pe]}),J.splice(J.lastIndexOf(Pe,J.length-Fe),1)):Fe++,He=J[J.length-ge],ee.push({command:Gn.addLayer,args:[U[Pe],He]}),J.splice(J.length-ge,0,Pe),pe[Pe]=!0);for(ge=0;ge<ie.length;ge++)if(Pe=ie[ge],Oe=le[Pe],We=U[Pe],!pe[Pe]&&!te(Oe,We))if(te(Oe.source,We.source)&&te(Oe["source-layer"],We["source-layer"])&&te(Oe.type,We.type)){for(ot in ya(Oe.layout,We.layout,ee,Pe,null,Gn.setLayoutProperty),ya(Oe.paint,We.paint,ee,Pe,null,Gn.setPaintProperty),te(Oe.filter,We.filter)||ee.push({command:Gn.setFilter,args:[Pe,We.filter]}),te(Oe.minzoom,We.minzoom)&&te(Oe.maxzoom,We.maxzoom)||ee.push({command:Gn.setLayerZoomRange,args:[Pe,We.minzoom,We.maxzoom]}),Oe)Oe.hasOwnProperty(ot)&&"layout"!==ot&&"paint"!==ot&&"filter"!==ot&&"metadata"!==ot&&"minzoom"!==ot&&"maxzoom"!==ot&&(0===ot.indexOf("paint.")?ya(Oe[ot],We[ot],ee,Pe,ot.slice(6),Gn.setPaintProperty):te(Oe[ot],We[ot])||ee.push({command:Gn.setLayerProperty,args:[Pe,ot,We[ot]]}));for(ot in We)We.hasOwnProperty(ot)&&!Oe.hasOwnProperty(ot)&&"layout"!==ot&&"paint"!==ot&&"filter"!==ot&&"metadata"!==ot&&"minzoom"!==ot&&"maxzoom"!==ot&&(0===ot.indexOf("paint.")?ya(Oe[ot],We[ot],ee,Pe,ot.slice(6),Gn.setPaintProperty):te(Oe[ot],We[ot])||ee.push({command:Gn.setLayerProperty,args:[Pe,ot,We[ot]]}))}else ee.push({command:Gn.removeLayer,args:[Pe]}),He=J[J.lastIndexOf(Pe)+1],ee.push({command:Gn.addLayer,args:[We,He]})}(O,S.layers,D)}catch(I){console.warn("Unable to compute style diff:",I),D=[{command:Gn.setStyle,args:[S]}]}return D}(this.serialize(),c).filter(x=>!(x.command in wn));if(0===h.length)return!1;const _=h.filter(x=>!(x.command in Wp));if(_.length>0)throw new Error(`Unimplemented: ${_.map(x=>x.command).join(", ")}.`);return h.forEach(x=>{"setTransition"!==x.command&&"setProjection"!==x.command&&this[x.command].apply(this,x.args)}),this.stylesheet=c,this._updateMapProjection(),!0}addImage(c,h){return this.getImage(c)?this.fire(new p.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(c,h),this._afterImageUpdated(c),this)}updateImage(c,h){this.imageManager.updateImage(c,h)}getImage(c){return this.imageManager.getImage(c)}removeImage(c){return this.getImage(c)?(this.imageManager.removeImage(c),this._afterImageUpdated(c),this):this.fire(new p.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(c){this._availableImages=this.imageManager.listImages(),this._changedImages[c]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new p.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(c,h,_={}){if(this._checkLoaded(),void 0!==this.getSource(c))throw new Error("There is already a source with this ID");if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(p.validateSource,`sources.${c}`,h,null,_))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const x=fi(c,h,this.dispatcher,this);x.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(c),source:x.serialize(),sourceId:c}));const S=D=>{const I=(D?"symbol:":"other:")+c,R=this._sourceCaches[I]=new p.SourceCache(I,x,D);(D?this._symbolSourceCaches:this._otherSourceCaches)[c]=R,R.style=this,R.onAdd(this.map)};S(!1),"vector"!==h.type&&"geojson"!==h.type||S(!0),x.onAdd&&x.onAdd(this.map),this._changed=!0}removeSource(c){this._checkLoaded();const h=this.getSource(c);if(!h)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===c)return this.fire(new p.ErrorEvent(new Error(`Source "${c}" cannot be removed while layer "${x}" is using it.`)));if(this.terrain&&this.terrain.get().source===c)return this.fire(new p.ErrorEvent(new Error(`Source "${c}" cannot be removed while terrain is using it.`)));const _=this._getSourceCaches(c);for(const x of _)delete this._sourceCaches[x.id],delete this._updatedSources[x.id],x.fire(new p.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:x.getSource().id})),x.setEventedParent(null),x.clearTiles();return delete this._otherSourceCaches[c],delete this._symbolSourceCaches[c],h.setEventedParent(null),h.onRemove&&h.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(c,h){this._checkLoaded(),this.getSource(c).setData(h),this._changed=!0}getSource(c){const h=this._getSourceCache(c);return h&&h.getSource()}_getSources(){const c=[];for(const h in this._otherSourceCaches){const _=this._getSourceCache(h);_&&c.push(_.getSource())}return c}addLayer(c,h,_={}){this._checkLoaded();const x=c.id;if(this.getLayer(x))return void this.fire(new p.ErrorEvent(new Error(`Layer with id "${x}" already exists on this map`)));let S;if("custom"===c.type){if(Jt(this,p.validateCustomStyleLayer(c)))return;S=p.createStyleLayer(c)}else{if("object"==typeof c.source&&(this.addSource(x,c.source),c=p.clone$1(c),c=p.extend(c,{source:x})),this._validate(p.validateLayer,`layers.${x}`,c,{arrayIndex:-1},_))return;S=p.createStyleLayer(c),this._validateLayer(S),S.setEventedParent(this,{layer:{id:x}}),this._serializedLayers[S.id]=S.serialize(),this._updateLayerCount(S,!0)}const D=h?this._order.indexOf(h):this._order.length;if(h&&-1===D)return void this.fire(new p.ErrorEvent(new Error(`Layer with id "${h}" does not exist on this map.`)));this._order.splice(D,0,x),this._layerOrderChanged=!0,this._layers[x]=S;const I=this._getLayerSourceCache(S);if(this._removedLayers[x]&&S.source&&I&&"custom"!==S.type){const R=this._removedLayers[x];delete this._removedLayers[x],R.type!==S.type?this._updatedSources[S.source]="clear":(this._updatedSources[S.source]="reload",I.pause())}this._updateLayer(S),S.onAdd&&S.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(c,h){if(this._checkLoaded(),this._changed=!0,!this._layers[c])return void this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be moved.`)));if(c===h)return;const _=this._order.indexOf(c);this._order.splice(_,1);const x=h?this._order.indexOf(h):this._order.length;h&&-1===x?this.fire(new p.ErrorEvent(new Error(`Layer with id "${h}" does not exist on this map.`))):(this._order.splice(x,0,c),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(c){this._checkLoaded();const h=this._layers[c];if(!h)return void this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be removed.`)));h.setEventedParent(null),this._updateLayerCount(h,!1);const _=this._order.indexOf(c);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[c]=h,delete this._layers[c],delete this._serializedLayers[c],delete this._updatedLayers[c],delete this._updatedPaintProps[c],h.onRemove&&h.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(c){return this._layers[c]}hasLayer(c){return c in this._layers}hasLayerType(c){for(const h in this._layers)if(this._layers[h].type===c)return!0;return!1}setLayerZoomRange(c,h,_){this._checkLoaded();const x=this.getLayer(c);x?x.minzoom===h&&x.maxzoom===_||(null!=h&&(x.minzoom=h),null!=_&&(x.maxzoom=_),this._updateLayer(x)):this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(c,h,_={}){this._checkLoaded();const x=this.getLayer(c);if(x){if(!te(x.filter,h))return null==h?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(p.validateFilter,`layers.${x.id}.filter`,h,{layerType:x.type},_)||(x.filter=p.clone$1(h),this._updateLayer(x)))}else this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be filtered.`)))}getFilter(c){const h=this.getLayer(c);return h&&p.clone$1(h.filter)}setLayoutProperty(c,h,_,x={}){this._checkLoaded();const S=this.getLayer(c);S?te(S.getLayoutProperty(h),_)||(S.setLayoutProperty(h,_,x),this._updateLayer(S)):this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(c,h){const _=this.getLayer(c);if(_)return _.getLayoutProperty(h);this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style.`)))}setPaintProperty(c,h,_,x={}){this._checkLoaded();const S=this.getLayer(c);S?te(S.getPaintProperty(h),_)||(S.setPaintProperty(h,_,x)&&this._updateLayer(S),this._changed=!0,this._updatedPaintProps[c]=!0):this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(c,h){const _=this.getLayer(c);return _&&_.getPaintProperty(h)}setFeatureState(c,h){this._checkLoaded();const _=c.source,x=c.sourceLayer,S=this.getSource(_);if(!S)return void this.fire(new p.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const D=S.type;if("geojson"===D&&x)return void this.fire(new p.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===D&&!x)return void this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===c.id&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided.")));const I=this._getSourceCaches(_);for(const R of I)R.setFeatureState(x,c.id,h)}removeFeatureState(c,h){this._checkLoaded();const _=c.source,x=this.getSource(_);if(!x)return void this.fire(new p.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const S=x.type,D="vector"===S?c.sourceLayer:void 0;if("vector"===S&&!D)return void this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(h&&"string"!=typeof c.id&&"number"!=typeof c.id)return void this.fire(new p.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const I=this._getSourceCaches(_);for(const R of I)R.removeFeatureState(D,c.id,h)}getFeatureState(c){this._checkLoaded();const h=c.source,_=c.sourceLayer,x=this.getSource(h);if(x){if("vector"!==x.type||_)return void 0===c.id&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(h)[0].getFeatureState(_,c.id);this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return p.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const c={};for(const h in this._sourceCaches){const _=this._sourceCaches[h].getSource();c[_.id]||(c[_.id]=_.serialize())}return p.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:c,layers:this._serializeLayers(this._order)},h=>void 0!==h)}_updateLayer(c){this._updatedLayers[c.id]=!0;const h=this._getLayerSourceCache(c);c.source&&!this._updatedSources[c.source]&&h&&"raster"!==h.getSource().type&&(this._updatedSources[c.source]="reload",h.pause()),this._changed=!0,c.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(c){const h=D=>"fill-extrusion"===this._layers[D].type,_={},x=[];for(let D=this._order.length-1;D>=0;D--){const I=this._order[D];if(h(I)){_[I]=D;for(const R of c){const O=R[I];if(O)for(const F of O)x.push(F)}}}x.sort((D,I)=>I.intersectionZ-D.intersectionZ);const S=[];for(let D=this._order.length-1;D>=0;D--){const I=this._order[D];if(h(I))for(let R=x.length-1;R>=0;R--){const O=x[R].feature;if(_[O.layer.id]<D)break;S.push(O),x.pop()}else for(const R of c){const O=R[I];if(O)for(const F of O)S.push(F.feature)}}return S}queryRenderedFeatures(c,h,_){h&&h.filter&&this._validate(p.validateFilter,"queryRenderedFeatures.filter",h.filter,null,h);const x={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new p.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const R of h.layers){const O=this._layers[R];if(!O)return this.fire(new p.ErrorEvent(new Error(`The layer '${R}' does not exist in the map's style and cannot be queried for features.`))),[];x[O.source]=!0}}const S=[];h.availableImages=this._availableImages;const D=h&&h.layers?h.layers.some(R=>{const O=this.getLayer(R);return O&&O.is3D()}):this.has3DLayers(),I=Hi.createFromScreenPoints(c,_);for(const R in this._sourceCaches){const O=this._sourceCaches[R].getSource().id;h.layers&&!x[O]||S.push(Fi(this._sourceCaches[R],this._layers,this._serializedLayers,I,h,_,D,!!this.map._showQueryGeometry))}return this.placement&&S.push(function(R,O,F,j,Y,ee,se){const ie={},le=ee.queryRenderedSymbols(j),U=[];for(const J of Object.keys(le).map(Number))U.push(se[J]);U.sort(Qo);for(const J of U){const pe=J.featureIndex.lookupSymbolFeatures(le[J.bucketInstanceId],O,J.bucketIndex,J.sourceLayerIndex,Y.filter,Y.layers,Y.availableImages,R);for(const ge in pe){const Fe=ie[ge]=ie[ge]||[],Pe=pe[ge];Pe.sort((Oe,We)=>{const He=J.featureSortOrder;if(He){const ot=He.indexOf(Oe.featureIndex);return He.indexOf(We.featureIndex)-ot}return We.featureIndex-Oe.featureIndex});for(const Oe of Pe)Fe.push(Oe)}}for(const J in ie)ie[J].forEach(pe=>{const ge=pe.feature,Fe=F(R[J]);if(!Fe)return;const Pe=Fe.getFeatureState(ge.layer["source-layer"],ge.id);ge.source=ge.layer.source,ge.layer["source-layer"]&&(ge.sourceLayer=ge.layer["source-layer"]),ge.state=Pe});return ie}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),I.screenGeometry,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(S)}querySourceFeatures(c,h){h&&h.filter&&this._validate(p.validateFilter,"querySourceFeatures.filter",h.filter,null,h);const _=this._getSourceCaches(c);let x=[];for(const S of _)x=x.concat(lo(S,h));return x}addSourceType(c,h,_){return Sa.getSourceType(c)?_(new Error(`A source type called "${c}" already exists.`)):(Sa.setSourceType(c,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:c,url:h.workerSourceURL},_):_(null,null))}getLight(){return this.light.getLight()}setLight(c,h={}){this._checkLoaded();const _=this.light.getLight();let x=!1;for(const D in c)if(!te(c[D],_[D])){x=!0;break}if(!x)return;const S=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(c,h),this.light.updateTransitions(S)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(c,h=1){if(this._checkLoaded(),!c)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let _=c;if(1===h){if("object"==typeof _.source){const x="terrain-dem-src";this.addSource(x,_.source),_=p.clone$1(_),_=p.extend(_,{source:x})}if(this._validate(p.validateTerrain,"terrain",_))return}if(!this.terrain||this.terrain&&h!==this.terrain.drapeRenderMode){if(!_)return;this._createTerrain(_,h)}else{const x=this.terrain,S=x.get();for(const D of Object.keys(p.spec.terrain))!_.hasOwnProperty(D)&&p.spec.terrain[D].default&&(_[D]=p.spec.terrain[D].default);for(const D in _)if(!te(_[D],S[D])){x.set(_),this.stylesheet.terrain=_;const I=this._setTransitionParameters({duration:0});x.updateTransitions(I);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(c){const h=this.fog=new ri(c,this.map.transform);this.stylesheet.fog=c;const _=this._setTransitionParameters({duration:0});h.updateTransitions(_)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const c of this.map._markers)c._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(c){if(this._checkLoaded(),!c)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const h=this.fog,_=h.get();0===Object.keys(c).length&&h.set(c);for(const x in c)if(!te(c[x],_[x])){h.set(c),this.stylesheet.fog=c;const S=this._setTransitionParameters({duration:0});h.updateTransitions(S);break}}else this._createFog(c);this._markersNeedUpdate=!0}_setTransitionParameters(c){return{now:p.exported.now(),transition:p.extend(c,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const c=this._order.filter(_=>this.isLayerDraped(this._layers[_])),h=this._order.filter(_=>!this.isLayerDraped(this._layers[_]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...c),this._drapedFirstOrder.push(...h)}_createTerrain(c,h){const _=this.terrain=new mt(c,h);this.stylesheet.terrain=c,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const x=this._setTransitionParameters({duration:0});_.updateTransitions(x)}_force3DLayerUpdate(){for(const c in this._layers){const h=this._layers[c];"fill-extrusion"===h.type&&this._updateLayer(h)}}_forceSymbolLayerUpdate(){for(const c in this._layers){const h=this._layers[c];"symbol"===h.type&&this._updateLayer(h)}}_validate(c,h,_,x,S={}){return(!S||!1!==S.validate)&&Jt(this,c.call(p.validateStyle,p.extend({key:h,style:this.serialize(),value:_,styleSpec:p.spec},x)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),p.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const c in this._layers)this._layers[c].setEventedParent(null);for(const c in this._sourceCaches)this._sourceCaches[c].clearTiles(),this._sourceCaches[c].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(c){const h=this._getSourceCaches(c);for(const _ of h)_.clearTiles()}_reloadSource(c){const h=this._getSourceCaches(c);for(const _ of h)_.resume(),_.reload()}_reloadSources(){for(const c of this._getSources())c.reload&&c.reload()}_updateSources(c){for(const h in this._sourceCaches)this._sourceCaches[h].update(c)}_generateCollisionBoxes(){for(const c in this._sourceCaches){const h=this._sourceCaches[c];h.resume(),h.reload()}}_updatePlacement(c,h,_,x,S=!1){let D=!1,I=!1;const R={};for(const O of this._order){const F=this._layers[O];if("symbol"!==F.type)continue;if(!R[F.source]){const Y=this._getLayerSourceCache(F);if(!Y)continue;R[F.source]=Y.getRenderableIds(!0).map(ee=>Y.getTileByID(ee)).sort((ee,se)=>se.tileID.overscaledZ-ee.tileID.overscaledZ||(ee.tileID.isLessThan(se.tileID)?-1:1))}const j=this.crossTileSymbolIndex.addLayer(F,R[F.source],c.center.lng,c.projection);D=D||j}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),S=S||this._layerOrderChanged||0===_,this._layerOrderChanged&&this.fire(new p.Event("neworder")),(S||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(p.exported.now(),c.zoom))&&(this.pauseablePlacement=new Nm(c,this._order,S,h,_,x,this.placement,this.fog&&c.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,R),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(p.exported.now()),I=!0),D&&this.pauseablePlacement.placement.setStale()),I||D)for(const O of this._order){const F=this._layers[O];"symbol"===F.type&&this.placement.updateLayerOpacities(F,R[F.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(p.exported.now())}_releaseSymbolFadeTiles(){for(const c in this._sourceCaches)this._sourceCaches[c].releaseSymbolFadeTiles()}getImages(c,h,_){this.imageManager.getImages(h.icons,_),this._updateTilesForChangedImages();const x=S=>{S&&S.setDependencies(h.tileID.key,h.type,h.icons)};x(this._otherSourceCaches[h.source]),x(this._symbolSourceCaches[h.source])}getGlyphs(c,h,_){this.glyphManager.getGlyphs(h.stacks,_)}getResource(c,h,_){return p.makeRequest(h,_)}_getSourceCache(c){return this._otherSourceCaches[c]}_getLayerSourceCache(c){return"symbol"===c.type?this._symbolSourceCaches[c.source]:this._otherSourceCaches[c.source]}_getSourceCaches(c){const h=[];return this._otherSourceCaches[c]&&h.push(this._otherSourceCaches[c]),this._symbolSourceCaches[c]&&h.push(this._symbolSourceCaches[c]),h}_isSourceCacheLoaded(c){const h=this._getSourceCaches(c);return 0===h.length?(this.fire(new p.ErrorEvent(new Error(`There is no source with ID '${c}'`))),!1):h.every(_=>_.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Sa.getSourceType=function(g){return ti[g]},Sa.setSourceType=function(g,c){ti[g]=c},Sa.registerForPluginStateChange=p.registerForPluginStateChange;var Xp="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",Pc="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Ka="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\nconst float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",Kl="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",Ca="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let md={},gu={};const Un=[];gd(Xp,Un),gd(Ka,Un),gd(Kl,Un),gd(Ca,Un),md=Ei("",Ka),gu=Ei(Ca,Kl);const Dh=Ei("\n#if __VERSION__ >=300\n#define varying in\n#define gl_FragColor glFragColor\n#define texture2D texture\n#define textureCube texture\nout vec4 glFragColor;\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\n#if __VERSION__ >=300\n#define attribute in\n#define varying out\n#define texture2D texture\n#endif\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),Ih=Xp,Rs="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var Mh={background:Ei("uniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nvarying vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform vec4 u_color;varying vec4 v_color;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(u_color);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:Ei("uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:Ei("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:Ei("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ei("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:Ei("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Ei("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Ei("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Ei("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:Ei("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:Ei("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:Ei("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:Ei("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:Ei("varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\nvoid main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvec3 normal=v_normal;\n#endif\nfloat z;vec4 color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);\n#else\ncolor=v_color;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef ZERO_ROOF_RADIUS\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#endif\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(color,NdotL);\n#else\nv_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_color*=u_opacity;\n#ifdef ZERO_ROOF_RADIUS\nv_roof_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef LIGHTING_3D_MODE\nv_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));\n#else\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:Ei("uniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,v_NdotL)*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_NdotL=NdotL;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:Ei("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ei("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\ngl_FragColor=apply_lighting(gl_FragColor);\n#endif\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:Ei("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nuniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);\n#ifdef RENDER_LINE_BORDER_AUTO\nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}\n#else\nout_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);\n#endif\n}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:Ei("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:Ei("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:Ei("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:Ei("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:Ei("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:Ei("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=wireframeOffset;\n#endif\nv_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:Ei("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Ei("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Pc),skyboxGradient:Ei("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Pc),skyboxCapture:Ei("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Ei("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\ncolor=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:Ei("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function gd(g,c){const h=g.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let _ of h)if(_=_.trim(),"#"===_[0]&&_.includes("if")&&!_.includes("endif")){_=_.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const x=_.split(" ");for(const S of x)c.includes(S)||c.push(S)}}function Ei(g,c){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,_=c.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),x={},S=[...Un];return gd(g,S),gd(c,S),{fragmentSource:g=g.replace(h,(D,I,R,O,F)=>(x[F]=!0,"define"===I?`\n#ifndef HAS_UNIFORM_u_${F}\nvarying ${R} ${O} ${F};\n#else\nuniform ${R} ${O} u_${F};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${F}\n    ${R} ${O} ${F} = u_${F};\n#endif\n`)),vertexSource:c=c.replace(h,(D,I,R,O,F)=>{const j="float"===O?"vec2":"vec4",Y=F.match(/color/)?"color":j;return x[F]?"define"===I?`\n#ifndef HAS_UNIFORM_u_${F}\nuniform lowp float u_${F}_t;\nattribute ${R} ${j} a_${F};\nvarying ${R} ${O} ${F};\n#else\nuniform ${R} ${O} u_${F};\n#endif\n`:"vec4"===Y?`\n#ifndef HAS_UNIFORM_u_${F}\n    ${F} = a_${F};\n#else\n    ${R} ${O} ${F} = u_${F};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${F}\n    ${F} = unpack_mix_${Y}(a_${F}, u_${F}_t);\n#else\n    ${R} ${O} ${F} = u_${F};\n#endif\n`:"define"===I?`\n#ifndef HAS_UNIFORM_u_${F}\nuniform lowp float u_${F}_t;\nattribute ${R} ${j} a_${F};\n#else\nuniform ${R} ${O} u_${F};\n#endif\n`:"vec4"===Y?`\n#ifndef HAS_UNIFORM_u_${F}\n    ${R} ${O} ${F} = a_${F};\n#else\n    ${R} ${O} ${F} = u_${F};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${F}\n    ${R} ${O} ${F} = unpack_mix_${Y}(a_${F}, u_${F}_t);\n#else\n    ${R} ${O} ${F} = u_${F};\n#endif\n`}),staticAttributes:_,usedDefines:S}}class Ta{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(c,h,_,x,S,D,I){this.context=c;let R=this.boundPaintVertexBuffers.length!==x.length;for(let F=0;!R&&F<x.length;F++)this.boundPaintVertexBuffers[F]!==x[F]&&(R=!0);let O=this.boundDynamicVertexBuffers.length!==I.length;for(let F=0;!O&&F<I.length;F++)this.boundDynamicVertexBuffers[F]!==I[F]&&(O=!0);if(!c.extVertexArrayObject||!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==_||R||O||this.boundIndexBuffer!==S||this.boundVertexOffset!==D)this.freshBind(h,_,x,S,D,I);else{c.bindVertexArrayOES.set(this.vao);for(const F of I)F&&F.bind();S&&S.dynamicDraw&&S.bind()}}freshBind(c,h,_,x,S,D){let I;const R=c.numAttributes,O=this.context,F=O.gl;if(O.extVertexArrayObject)this.vao&&this.destroy(),this.vao=O.extVertexArrayObject.createVertexArrayOES(),O.bindVertexArrayOES.set(this.vao),I=0,this.boundProgram=c,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=x,this.boundVertexOffset=S,this.boundDynamicVertexBuffers=D;else{I=O.currentNumAttributes||0;for(let j=R;j<I;j++)F.disableVertexAttribArray(j)}h.enableAttributes(F,c),h.bind(),h.setVertexAttribPointers(F,c,S);for(const j of _)j.enableAttributes(F,c),j.bind(),j.setVertexAttribPointers(F,c,S);for(const j of D)j&&(j.enableAttributes(F,c),j.bind(),j.setVertexAttribPointers(F,c,S));x&&x.bind(),O.currentNumAttributes=R}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Vm(g,c){const h=Math.pow(2,c.canonical.z),_=c.canonical.y;return[new p.MercatorCoordinate(0,_/h).toLngLat().lat,new p.MercatorCoordinate(0,(_+1)/h).toLngLat().lat]}function i_(g,c,h,_,x,S,D){const I=g.context,R=I.gl,O=h.fbo;if(!O)return;g.prepareDrawTile();const F=g.useProgram("hillshade");I.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,O.colorAttachment.get());const j=((ie,le,U,J)=>{const pe=U.paint.get("hillshade-shadow-color"),ge=U.paint.get("hillshade-highlight-color"),Fe=U.paint.get("hillshade-accent-color");let Pe=U.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===U.paint.get("hillshade-illumination-anchor")&&(Pe-=ie.transform.angle);const Oe=!ie.options.moving;return{u_matrix:J||ie.transform.calculateProjMatrix(le.tileID.toUnwrapped(),Oe),u_image:0,u_latrange:Vm(0,le.tileID),u_light:[U.paint.get("hillshade-exaggeration"),Pe],u_shadow:pe,u_highlight:ge,u_accent:Fe}})(g,h,_,g.terrain?c.projMatrix:null);g.prepareDrawProgram(I,F,c.toUnwrapped());const{tileBoundsBuffer:Y,tileBoundsIndexBuffer:ee,tileBoundsSegments:se}=g.getTileBoundsBuffers(h);F.draw(I,R.TRIANGLES,x,S,D,p.CullFaceMode.disabled,j,_.id,Y,ee,se)}function qs(g,c,h){if(!c.needsDEMTextureUpload)return;const _=g.context,x=_.gl;_.pixelStoreUnpackPremultiplyAlpha.set(!1),c.demTexture=c.demTexture||g.getTileTexture(h.stride);const S=h.getPixels();c.demTexture?c.demTexture.update(S,{premultiply:!1}):c.demTexture=new p.Texture(_,S,x.RGBA,{premultiply:!1}),c.needsDEMTextureUpload=!1}function Lr(g,c,h,_,x,S){const D=g.context,I=D.gl;if(!c.dem)return;const R=c.dem;if(D.activeTexture.set(I.TEXTURE1),qs(g,c,R),!c.demTexture)return;c.demTexture.bind(I.NEAREST,I.CLAMP_TO_EDGE);const O=R.dim;D.activeTexture.set(I.TEXTURE0);let F=c.fbo;if(!F){const se=new p.Texture(D,{width:O,height:O,data:null},I.RGBA);se.bind(I.LINEAR,I.CLAMP_TO_EDGE),F=c.fbo=D.createFramebuffer(O,O,!0),F.colorAttachment.set(se.texture)}D.bindFramebuffer.set(F.framebuffer),D.viewport.set([0,0,O,O]);const{tileBoundsBuffer:j,tileBoundsIndexBuffer:Y,tileBoundsSegments:ee}=g.getMercatorTileBoundsBuffers();g.useProgram("hillshadePrepare").draw(D,I.TRIANGLES,_,x,S,p.CullFaceMode.disabled,((se,ie)=>{const le=ie.stride,U=p.create();return p.ortho(U,0,p.EXTENT,-p.EXTENT,0,0,1),p.translate(U,U,[0,-p.EXTENT,0]),{u_matrix:U,u_image:1,u_dimension:[le,le],u_zoom:se.overscaledZ,u_unpack:ie.unpackVector}})(c.tileID,R),h.id,j,Y,ee),c.needsHillshadePrepare=!1}const jm=g=>({u_matrix:new p.UniformMatrix4f(g),u_image0:new p.Uniform1i(g),u_skirt_height:new p.Uniform1f(g)}),bd=(g,c)=>({u_matrix:g,u_image0:0,u_skirt_height:c}),vl=(g,c,h,_,x,S,D,I,R,O,F,j,Y,ee,se)=>({u_proj_matrix:Float32Array.from(g),u_globe_matrix:c,u_normalize_matrix:Float32Array.from(_),u_merc_matrix:h,u_zoom_transition:x,u_merc_center:S,u_image0:0,u_frustum_tl:D,u_frustum_tr:I,u_frustum_br:R,u_frustum_bl:O,u_globe_pos:F,u_globe_radius:j,u_viewport:Y,u_grid_matrix:se?Float32Array.from(se):new Float32Array(9),u_skirt_height:ee});function $i(g,c){return null!=g&&null!=c&&!(!g.hasData()||!c.hasData())&&null!=g.demTexture&&null!=c.demTexture&&g.tileID.key!==c.tileID.key}const aa=new class{constructor(){this.operations={}}newMorphing(g,c,h,_,x){if(g in this.operations){const S=this.operations[g];S.to.tileID.key!==h.tileID.key&&(S.queued=h)}else this.operations[g]={startTime:_,phase:0,duration:x,from:c,to:h,queued:null}}getMorphValuesForProxy(g){if(!(g in this.operations))return null;const c=this.operations[g];return{from:c.from,to:c.to,phase:c.phase}}update(g){for(const c in this.operations){const h=this.operations[c];for(h.phase=(g-h.startTime)/h.duration;h.phase>=1||!this._validOp(h);)if(!this._nextOp(h,g)){delete this.operations[c];break}}}_nextOp(g,c){return!!g.queued&&(g.from=g.to,g.to=g.queued,g.queued=null,g.phase=0,g.startTime=c,!0)}_validOp(g){return g.from.hasData()&&g.to.hasData()}},xl={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function bu(g){return 6*Math.pow(1.5,22-g)}function Zp(g,c){const h=1<<g.z;return!c&&(0===g.x||g.x===h-1)||0===g.y||g.y===h-1}const Ws=g=>({u_matrix:g});function Lc(g,c,h,_,x){if(x>0){const S=p.exported.now(),D=(S-g.timeAdded)/x,I=c?(S-c.timeAdded)/x:-1,R=h.getSource(),O=_.coveringZoomLevel({tileSize:R.tileSize,roundZoom:R.roundZoom}),F=!c||Math.abs(c.tileID.overscaledZ-O)>Math.abs(g.tileID.overscaledZ-O),j=F&&g.refreshedUponExpiration?1:p.clamp(F?D:1-I,0,1);return g.refreshedUponExpiration&&D>=1&&(g.refreshedUponExpiration=!1),c?{opacity:1,mix:1-j}:{opacity:j,mix:0}}return{opacity:1,mix:0}}class Yp extends p.SourceCache{constructor(c){const h={type:"raster-dem",maxzoom:c.transform.maxZoom},_=new kt(hu(),null),x=fi("mock-dem",h,_,c.style);super("mock-dem",x,!1),x.setEventedParent(this),this._sourceLoaded=!0}_loadTile(c,h){c.state="loaded",h(null)}}class vn extends p.SourceCache{constructor(c){const h=fi("proxy",{type:"geojson",maxzoom:c.transform.maxZoom},new kt(hu(),null),c.style);super("proxy",h,!1),h.setEventedParent(this),this.map=this.getSource().map=c,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(c,h,_){if(c.freezeTileCoverage)return;this.transform=c;const x=c.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((S,D)=>{if(S[D.key]="",!this._tiles[D.key]){const I=new p.Tile(D,this._source.tileSize*D.overscaleFactor(),c.tileZoom);I.state="loaded",this._tiles[D.key]=I}return S},{});for(const S in this._tiles)S in x||(this.freeFBO(S),this._tiles[S].unloadVectorData(),delete this._tiles[S])}freeFBO(c){const h=this.proxyCachedFBO[c];if(void 0!==h){const _=Object.values(h);this.renderCachePool.push(..._),delete this.proxyCachedFBO[c]}}deallocRenderCache(){this.renderCache.forEach(c=>c.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Ah extends p.OverscaledTileID{constructor(c,h,_){super(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,c.canonical.y),this.proxyTileKey=h,this.projMatrix=_}}class kh extends p.Elevation{constructor(c,h){super(),this.painter=c,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[_,x,S]=function(R){const O=new p.StructArrayLayout2i4,F=new p.StructArrayLayout3ui6,j=131;O.reserve(17161),F.reserve(33800);const Y=p.EXTENT/128,ee=p.EXTENT+Y/2,se=ee+Y;for(let le=-Y;le<se;le+=Y)for(let U=-Y;U<se;U+=Y){const J=U<0||U>ee||le<0||le>ee?24575:0,pe=p.clamp(Math.round(U),0,p.EXTENT),ge=p.clamp(Math.round(le),0,p.EXTENT);O.emplaceBack(pe+J,ge)}const ie=(le,U)=>{const J=U*j+le;F.emplaceBack(J+1,J,J+j),F.emplaceBack(J+j,J+j+1,J+1)};for(let le=1;le<129;le++)for(let U=1;U<129;U++)ie(U,le);return[0,129].forEach(le=>{for(let U=0;U<130;U++)ie(U,le),ie(le,U)}),[O,F,32768]}(),D=c.context;this.gridBuffer=D.createVertexBuffer(_,p.posAttributes.members),this.gridIndexBuffer=D.createIndexBuffer(x),this.gridSegments=p.SegmentVector.simpleSegment(0,0,_.length,x.length),this.gridNoSkirtSegments=p.SegmentVector.simpleSegment(0,0,_.length,S),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new vn(h.map),this.orthoMatrix=p.create(),p.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,p.EXTENT,0,p.EXTENT,0,1);const I=D.gl;this._overlapStencilMode=new p.StencilMode({func:I.GEQUAL,mask:255},0,255,I.KEEP,I.KEEP,I.REPLACE),this._previousZoom=c.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=h,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Yp(h.map)}set style(c){c.on("data",this._onStyleDataEvent.bind(this)),c.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=c,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(c,h,_){if(c&&c.terrain){this._style!==c&&(this.style=c),this.enabled=!0;const x=c.terrain.properties;this.sourceCache=0===c.terrain.drapeRenderMode?this._mockSourceCache:c._getSourceCache(x.get("source")),this._exaggeration=x.get("exaggeration");const S=()=>{this.sourceCache.used&&p.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const D=this.getScaledDemTileSize();this.sourceCache.update(h,D,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,S(),this._initializing=!0),S(),h.updateElevation(!0,_),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(h),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(c){this._findCoveringTileCache[c]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const c=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==c.efficiency&&p.warnOnce(`Terrain render cache efficiency is not optimal (${c.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${c.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(c){c.coord&&"source"===c.dataType?this._clearRenderCacheForTile(c.sourceCacheId,c.coord):"style"===c.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const c in this._style._sourceCaches)this._style._sourceCaches[c].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(c=>c.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const c=2*this.proxySourceCache.getSource().tileSize;return[c,c]}set useVertexMorphing(c){this._useVertexMorphing=c}updateTileBinding(c){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const h=this.proxySourceCache,_=this.painter.transform;this._initializing&&(this._initializing=0===_._centerAltitude&&-1===this.getAtPointOrZero(p.MercatorCoordinate.fromLngLat(_.center),-1),this._emptyDEMTextureDirty=!this._initializing);const x=this.proxyCoords=h.getIds().map(R=>{const O=h.getTileByID(R).tileID;return O.projMatrix=_.calculateProjMatrix(O.toUnwrapped()),O});(function(R,O){const F=O.transform.pointCoordinate(O.transform.getCameraPoint()),j=new p.Point(F.x,F.y);R.sort((Y,ee)=>{if(ee.overscaledZ-Y.overscaledZ)return ee.overscaledZ-Y.overscaledZ;const se=new p.Point(Y.canonical.x+(1<<Y.canonical.z)*Y.wrap,Y.canonical.y),ie=new p.Point(ee.canonical.x+(1<<ee.canonical.z)*ee.wrap,ee.canonical.y),le=j.mult(1<<Y.canonical.z);return le.x-=.5,le.y-=.5,le.distSqr(se)-le.distSqr(ie)})})(x,this.painter),this._previousZoom=_.zoom;const S=this.proxyToSource||{};this.proxyToSource={},x.forEach(R=>{this.proxyToSource[R.key]={}}),this.terrainTileForTile={};const D=this._style._sourceCaches;for(const R in D){const O=D[R];if(!O.used||(O!==this.sourceCache&&this.resetTileLookupCache(O.id),this._setupProxiedCoordsForOrtho(O,c[R],S),O.usedForTerrain))continue;const F=c[R];O.getSource().reparseOverscaled&&this._assignTerrainTiles(F)}this.proxiedCoords[h.id]=x.map(R=>new Ah(R,R.key,this.orthoMatrix)),this._assignTerrainTiles(x),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(S),this.renderingToTexture=!1,this._updateTimestamp=p.exported.now();const I={};this._visibleDemTiles=[];for(const R of this.proxyCoords){const O=this.terrainTileForTile[R.key];if(!O)continue;const F=O.tileID.key;F in I||(this._visibleDemTiles.push(O),I[F]=F)}}_assignTerrainTiles(c){this._initializing||c.forEach(h=>{if(this.terrainTileForTile[h.key])return;const _=this._findTileCoveringTileID(h,this.sourceCache);_&&(this.terrainTileForTile[h.key]=_)})}_prepareDEMTextures(){const c=this.painter.context,h=c.gl;for(const _ in this.terrainTileForTile){const x=this.terrainTileForTile[_],S=x.dem;!S||x.demTexture&&!x.needsDEMTextureUpload||(c.activeTexture.set(h.TEXTURE1),qs(this.painter,x,S))}}_prepareDemTileUniforms(c,h,_,x){if(!h||null==h.demTexture)return!1;const S=c.tileID.canonical,D=Math.pow(2,h.tileID.canonical.z-S.z),I=x||"";return _[`u_dem_tl${I}`]=[S.x*D%1,S.y*D%1],_[`u_dem_scale${I}`]=D,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const c=this.painter.context,h=c.gl;if(!this._emptyDepthBufferTexture){const _=new p.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new p.Texture(c,_,h.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let c=0;const h=this._visibleDemTiles.reduce((_,x)=>{if(!x.dem)return _;const S=x.dem.tree.minimums[0];return S>0&&c++,_+S},0);return c?h/c:0}_updateEmptyDEMTexture(){const c=this.painter.context,h=c.gl;c.activeTexture.set(h.TEXTURE2);const _=this._getLoadedAreaMinimum(),x=new p.RGBAImage({width:1,height:1},new Uint8Array(p.DEMData.pack(_,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let S=this._emptyDEMTexture;return S?S.update(x,{premultiply:!1}):S=this._emptyDEMTexture=new p.Texture(c,x,h.RGBA,{premultiply:!1}),S}setupElevationDraw(c,h,_){const x=this.painter.context,S=x.gl,D=(I=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:p.DEMData.getUnpackVector(I),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var I;D.u_dem_size=this.sourceCache.getSource().tileSize,D.u_exaggeration=this.exaggeration();let R=null,O=null,F=1;if(_&&_.morphing&&this._useVertexMorphing){const j=_.morphing.srcDemTile,Y=_.morphing.dstDemTile;F=_.morphing.phase,j&&Y&&(this._prepareDemTileUniforms(c,j,D,"_prev")&&(O=j),this._prepareDemTileUniforms(c,Y,D)&&(R=Y))}if(O&&R?(x.activeTexture.set(S.TEXTURE2),R.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE,S.NEAREST),x.activeTexture.set(S.TEXTURE4),O.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE,S.NEAREST),D.u_dem_lerp=F):(R=this.terrainTileForTile[c.tileID.key],x.activeTexture.set(S.TEXTURE2),(this._prepareDemTileUniforms(c,R,D)?R.demTexture:this.emptyDEMTexture).bind(S.NEAREST,S.CLAMP_TO_EDGE)),x.activeTexture.set(S.TEXTURE3),_&&_.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE),this._depthFBO&&(D.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE),D.u_depth_size_inv=[1,1]),_&&_.useMeterToDem&&R){const j=(1<<R.tileID.canonical.z)*p.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;D.u_meter_to_dem=j}if(_&&_.labelPlaneMatrixInv&&(D.u_label_plane_matrix_inv=_.labelPlaneMatrixInv),h.setTerrainUniformValues(x,D),"globe"===this.painter.transform.projection.name){const j=this.globeUniformValues(this.painter.transform,c.tileID.canonical,_&&_.useDenormalizedUpVectorScale);h.setGlobeUniformValues(x,j)}}globeUniformValues(c,h,_){const x=c.projection;return{u_tile_tl_up:x.upVector(h,0,0),u_tile_tr_up:x.upVector(h,p.EXTENT,0),u_tile_br_up:x.upVector(h,p.EXTENT,p.EXTENT),u_tile_bl_up:x.upVector(h,0,p.EXTENT),u_tile_up_scale:_?p.globeMetersToEcef(1):x.upVectorScale(h,c.center.lat,c.worldSize).metersToTile}}renderToBackBuffer(c){const h=this.painter,_=this.painter.context;0!==c.length&&(_.bindFramebuffer.set(null),_.viewport.set([0,0,h.width,h.height]),h.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(x,S,D,I,R){if("globe"===x.transform.projection.name)!function(O,F,j,Y,ee){const se=O.context,ie=se.gl;let le,U;const J=O.options.showTerrainWireframe?2:0,pe=O.transform,ge=p.globeUseCustomAntiAliasing(O,se,pe),Fe=(Nt,it)=>{if(U===Nt)return;const vt=[xl[Nt],"PROJECTION_GLOBE_VIEW"];ge&&vt.push("CUSTOM_ANTIALIASING"),it&&vt.push(xl[J]),le=O.useProgram("globeRaster",null,vt),U=Nt},Pe=O.colorModeForRenderPass(),Oe=new p.DepthMode(ie.LEQUAL,p.DepthMode.ReadWrite,O.depthRangeFor3D);aa.update(ee);const We=p.calculateGlobeMercatorMatrix(pe),He=[p.mercatorXfromLng(pe.center.lng),p.mercatorYfromLat(pe.center.lat)],ot=J?[!1,!0]:[!1],Ft=O.globeSharedBuffers,nt=[pe.width*p.exported.devicePixelRatio,pe.height*p.exported.devicePixelRatio],St=Float32Array.from(pe.globeMatrix),pt={useDenormalizedUpVectorScale:!0};if(ot.forEach(Nt=>{const it=O.transform,vt=bu(it.zoom)*F.exaggeration();U=-1;const Bt=Nt?ie.LINES:ie.TRIANGLES;for(const Mt of Y){const Vt=j.getTile(Mt),In=p.StencilMode.disabled,zn=F.prevTerrainTileForTile[Mt.key],bn=F.terrainTileForTile[Mt.key];$i(zn,bn)&&aa.newMorphing(Mt.key,zn,bn,ee,250),se.activeTexture.set(ie.TEXTURE0),Vt.texture.bind(ie.LINEAR,ie.CLAMP_TO_EDGE);const An=aa.getMorphValuesForProxy(Mt.key),gi=An?1:0;An&&p.extend$1(pt,{morphing:{srcDemTile:An.from,dstDemTile:An.to,phase:p.easeCubicInOut(An.phase)}});const oi=p.tileCornersToBounds(Mt.canonical),En=p.getLatitudinalLod(oi.getCenter().lat),nr=p.getGridMatrix(Mt.canonical,oi,En,it.worldSize/it._pixelsPerMercatorPixel),pr=p.globeNormalizeECEF(p.globeTileBounds(Mt.canonical)),_r=vl(it.projMatrix,St,We,pr,p.globeToMercatorTransition(it.zoom),He,it.frustumCorners.TL,it.frustumCorners.TR,it.frustumCorners.BR,it.frustumCorners.BL,it.globeCenterInViewSpace,it.globeRadius,nt,vt,nr);if(Fe(gi,Nt),F.setupElevationDraw(Vt,le,pt),O.prepareDrawProgram(se,le,Mt.toUnwrapped()),Ft){const[ki,ns,io]=Nt?Ft.getWirefameBuffers(O.context,En):Ft.getGridBuffers(En,0!==vt);le.draw(se,Bt,Oe,In,Pe,p.CullFaceMode.backCCW,_r,"globe_raster",ki,ns,io)}}}),Ft){const Nt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ge&&Nt.push("CUSTOM_ANTIALIASING"),le=O.useProgram("globeRaster",null,Nt);for(const it of Y){const{x:vt,y:Bt,z:Mt}=it.canonical,Vt=0===Bt,In=Bt===(1<<Mt)-1,[zn,bn,An,gi]=Ft.getPoleBuffers(Mt);if(gi&&(Vt||In)){const oi=j.getTile(it);se.activeTexture.set(ie.TEXTURE0),oi.texture.bind(ie.LINEAR,ie.CLAMP_TO_EDGE);let En=p.globePoleMatrixForTile(Mt,vt,pe);const nr=p.globeNormalizeECEF(p.globeTileBounds(it.canonical)),pr=(_r,ki)=>_r.draw(se,ie.TRIANGLES,Oe,p.StencilMode.disabled,Pe,p.CullFaceMode.disabled,vl(pe.projMatrix,En,En,nr,0,He,pe.frustumCorners.TL,pe.frustumCorners.TR,pe.frustumCorners.BR,pe.frustumCorners.BL,pe.globeCenterInViewSpace,pe.globeRadius,nt,0),"globe_pole_raster",ki,An,gi);F.setupElevationDraw(oi,le,pt),O.prepareDrawProgram(se,le,it.toUnwrapped()),Vt&&pr(le,zn),In&&(En=p.scale(p.create(),En,[1,-1,1]),pr(le,bn))}}}}(x,S,D,I,R);else{const O=x.context,F=O.gl;let j,Y;const ee=x.options.showTerrainWireframe?2:0,se=(pe,ge)=>{if(Y===pe)return;const Fe=[xl[pe]];ge&&Fe.push(xl[ee]),j=x.useProgram("terrainRaster",null,Fe),Y=pe},ie=x.colorModeForRenderPass(),le=new p.DepthMode(F.LEQUAL,p.DepthMode.ReadWrite,x.depthRangeFor3D);aa.update(R);const U=x.transform,J=bu(U.zoom)*S.exaggeration();(ee?[!1,!0]:[!1]).forEach(pe=>{Y=-1;const ge=pe?F.LINES:F.TRIANGLES,[Fe,Pe]=pe?S.getWirefameBuffer():[S.gridIndexBuffer,S.gridSegments];for(const Oe of I){const We=D.getTile(Oe),He=p.StencilMode.disabled,ot=S.prevTerrainTileForTile[Oe.key],Ft=S.terrainTileForTile[Oe.key];$i(ot,Ft)&&aa.newMorphing(Oe.key,ot,Ft,R,250),O.activeTexture.set(F.TEXTURE0),We.texture.bind(F.LINEAR,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST);const nt=aa.getMorphValuesForProxy(Oe.key),St=nt?1:0;let pt;nt&&(pt={morphing:{srcDemTile:nt.from,dstDemTile:nt.to,phase:p.easeCubicInOut(nt.phase)}});const Nt=bd(Oe.projMatrix,Zp(Oe.canonical,U.renderWorldCopies)?J/10:J);se(St,pe),S.setupElevationDraw(We,j,pt),x.prepareDrawProgram(O,j,Oe.toUnwrapped()),j.draw(O,ge,le,He,ie,p.CullFaceMode.backCCW,Nt,"terrain_raster",S.gridBuffer,Fe,Pe)}})}}(h,this,this.proxySourceCache,c,this._updateTimestamp),this.renderingToTexture=!0,h.gpuTimingDeferredRenderEnd(),c.splice(0,c.length))}renderBatch(c){if(0===this._drapedRenderBatches.length)return c+1;this.renderingToTexture=!0;const h=this.painter,_=this.painter.context,x=this.proxySourceCache,S=this.proxiedCoords[x.id],D=this._drapedRenderBatches.shift(),I=[],R=h.style.order;let O=0;for(const F of S){const j=x.getTileByID(F.proxyTileKey),Y=x.proxyCachedFBO[F.key]?x.proxyCachedFBO[F.key][c]:void 0,ee=void 0!==Y?x.renderCache[Y]:this.pool[O++],se=void 0!==Y;if(j.texture=ee.tex,se&&!ee.dirty){I.push(j.tileID);continue}let ie;_.bindFramebuffer.set(ee.fb.framebuffer),this.renderedToTile=!1,ee.dirty&&(_.clear({color:p.Color.transparent,stencil:0}),ee.dirty=!1);for(let le=D.start;le<=D.end;++le){const U=h.style._layers[R[le]];if(U.isHidden(h.transform.zoom))continue;const J=h.style._getLayerSourceCache(U),pe=J?this.proxyToSource[F.key][J.id]:[F];if(!pe)continue;const ge=pe;_.viewport.set([0,0,ee.fb.width,ee.fb.height]),ie!==(J?J.id:null)&&(this._setupStencil(ee,pe,U,J),ie=J?J.id:null),h.renderLayer(h,J,U,ge)}this.renderedToTile?(ee.dirty=!0,I.push(j.tileID)):se||--O,5===O&&(O=0,this.renderToBackBuffer(I))}return this.renderToBackBuffer(I),this.renderingToTexture=!1,_.bindFramebuffer.set(null),_.viewport.set([0,0,h.width,h.height]),D.end+1}postRender(){}renderCacheEfficiency(c){const h=c.order.length;if(0===h)return{efficiency:100};let _,x=0,S=0,D=!1;for(let I=0;I<h;++I){const R=c._layers[c.order[I]];this._style.isLayerDraped(R)?(D&&++x,++S):D||(D=!0,_=R.id)}return 0===S?{efficiency:100}:{efficiency:100*(1-x/S),firstUndrapedLayer:_}}getMinElevationBelowMSL(){let c=0;return this._visibleDemTiles.filter(h=>h.dem).forEach(h=>{c=Math.min(c,h.dem.tree.minimums[0])}),0===c?c:(c-30)*this._exaggeration}raycast(c,h,_){if(!this._visibleDemTiles)return null;const x=this._visibleDemTiles.filter(S=>S.dem).map(S=>{const D=S.tileID,I=1<<D.overscaledZ,{x:R,y:O}=D.canonical,F=R/I,j=(R+1)/I,Y=O/I,ee=(O+1)/I;return{minx:F,miny:Y,maxx:j,maxy:ee,t:S.dem.tree.raycastRoot(F,Y,j,ee,c,h,_),tile:S}});x.sort((S,D)=>(null!==S.t?S.t:Number.MAX_VALUE)-(null!==D.t?D.t:Number.MAX_VALUE));for(const S of x){if(null==S.t)return null;const D=S.tile.dem.tree.raycast(S.minx,S.miny,S.maxx,S.maxy,c,h,_);if(null!=D)return D}return null}_createFBO(){const c=this.painter.context,h=c.gl,_=this.drapeBufferSize;c.activeTexture.set(h.TEXTURE0);const x=new p.Texture(c,{width:_[0],height:_[1],data:null},h.RGBA);x.bind(h.LINEAR,h.CLAMP_TO_EDGE);const S=c.createFramebuffer(_[0],_[1],!1);return S.colorAttachment.set(x.texture),S.depthAttachment=new Ne(c,S.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=c.createRenderbuffer(c.gl.DEPTH_STENCIL,_[0],_[1]),this._stencilRef=0,S.depthAttachment.set(this._sharedDepthStencil),c.clear({stencil:0})):S.depthAttachment.set(this._sharedDepthStencil),c.extTextureFilterAnisotropic&&!c.extTextureFilterAnisotropicForceOff&&h.texParameterf(h.TEXTURE_2D,c.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c.extTextureFilterAnisotropicMax),{fb:S,tex:x,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const c in this._style._sourceCaches)if(this._style._sourceCaches[c].hasTransition())return!0;return this._style.order.some(c=>{const h=this._style._layers[c],_=h.isHidden(this.painter.transform.zoom);return"custom"===h.type?!_&&h.shouldRedrape():!_&&h.hasTransition()})}_clearLineLayersFromRenderCache(){let c=!1;for(const _ of this._style._getSources())if(_ instanceof tn){c=!0;break}if(!c)return;const h={};for(let _=0;_<this._style.order.length;++_){const x=this._style._layers[this._style.order[_]],S=this._style._getLayerSourceCache(x);if(S&&!h[S.id]&&!x.isHidden(this.painter.transform.zoom)&&"line"===x.type&&x.widthExpression()instanceof p.ZoomDependentExpression){h[S.id]=!0;for(const D of this.proxyCoords){const I=this.proxyToSource[D.key][S.id];if(I)for(const R of I)this._clearRenderCacheForTile(S.id,R)}}}}_clearRasterLayersFromRenderCache(){let c=!1;for(const _ in this._style._sourceCaches)if(this._style._sourceCaches[_]._source instanceof Ut){c=!0;break}if(!c)return;const h={};for(let _=0;_<this._style.order.length;++_){const x=this._style._layers[this._style.order[_]],S=this._style._getLayerSourceCache(x);if(!S||h[S.id]||x.isHidden(this.painter.transform.zoom)||"raster"!==x.type)continue;const D=x.paint.get("raster-fade-duration");for(const I of this.proxyCoords){const R=this.proxyToSource[I.key][S.id];if(R)for(const O of R){const F=Lc(S.getTile(O),S.findLoadedParent(O,0),S,this.painter.transform,D);(1!==F.opacity||0!==F.mix)&&this._clearRenderCacheForTile(S.id,O)}}}}_setupDrapedRenderBatches(){const c=this._style.order,h=c.length;if(0===h)return;const _=[];let x,S=0,D=this._style._layers[c[S]];for(;!this._style.isLayerDraped(D)&&D.isHidden(this.painter.transform.zoom)&&++S<h;)D=this._style._layers[c[S]];for(;S<h;++S){const I=this._style._layers[c[S]];I.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(I)?void 0===x&&(x=S):void 0!==x&&(_.push({start:x,end:S-1}),x=void 0))}void 0!==x&&_.push({start:x,end:S-1}),this._drapedRenderBatches=_}_setupRenderCache(c){const h=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,h.renderCache.length>h.renderCachePool.length){const D=Object.values(h.proxyCachedFBO);h.proxyCachedFBO={};for(let I=0;I<D.length;++I){const R=Object.values(D[I]);h.renderCachePool.push(...R)}}return}this._clearRasterLayersFromRenderCache();const _=this.proxyCoords,x=this._tilesDirty;for(let D=_.length-1;D>=0;D--){const I=_[D];if(h.getTileByID(I.key),void 0!==h.proxyCachedFBO[I.key]){const R=c[I.key],O=this.proxyToSource[I.key];let F=0;for(const j in O){const Y=O[j],ee=R[j];if(!ee||ee.length!==Y.length||Y.some((se,ie)=>se!==ee[ie]||x[j]&&x[j].hasOwnProperty(se.key))){F=-1;break}++F}for(const j in h.proxyCachedFBO[I.key])h.renderCache[h.proxyCachedFBO[I.key][j]].dirty=F<0||F!==Object.values(R).length}}const S=[...this._drapedRenderBatches];S.sort((D,I)=>I.end-I.start-(D.end-D.start));for(const D of S)for(const I of _){if(h.proxyCachedFBO[I.key])continue;let R=h.renderCachePool.pop();void 0===R&&h.renderCache.length<50&&(R=h.renderCache.length,h.renderCache.push(this._createFBO())),void 0!==R&&(h.proxyCachedFBO[I.key]={},h.proxyCachedFBO[I.key][D.start]=R,h.renderCache[R].dirty=!0)}this._tilesDirty={}}_setupStencil(c,h,_,x){if(!x||!this._sourceTilesOverlap[x.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const S=this.painter.context,D=S.gl;if(h.length<=1)return void(this._overlapStencilType=!1);let I;if(_.isTileClipped())I=h.length,this._overlapStencilMode.test={func:D.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(h[0].overscaledZ>h[h.length-1].overscaledZ))return void(this._overlapStencilType=!1);I=1,this._overlapStencilMode.test={func:D.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+I>255&&(S.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=I,this._overlapStencilMode.ref=this._stencilRef,_.isTileClipped()&&this._renderTileClippingMasks(h,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(c){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[c.key]),this._overlapStencilMode):p.StencilMode.disabled}_renderTileClippingMasks(c,h){const _=this.painter,x=this.painter.context,S=x.gl;_._tileClippingMaskIDs={},x.setColorMode(p.ColorMode.disabled),x.setDepthMode(p.DepthMode.disabled);const D=_.useProgram("clippingMask");for(const I of c){const R=_._tileClippingMaskIDs[I.key]=--h;D.draw(x,S.TRIANGLES,p.DepthMode.disabled,new p.StencilMode({func:S.ALWAYS,mask:0},R,255,S.KEEP,S.KEEP,S.REPLACE),p.ColorMode.disabled,p.CullFaceMode.disabled,Ws(I.projMatrix),"$clipping",_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}}pointCoordinate(c){const h=this.painter.transform;if(c.x<0||c.x>h.width||c.y<0||c.y>h.height)return null;const _=[c.x,c.y,1,1];p.transformMat4$1(_,_,h.pixelMatrixInverse),p.scale$1(_,_,1/_[3]),_[0]/=h.worldSize,_[1]/=h.worldSize;const x=h._camera.position,S=p.mercatorZfromAltitude(1,h.center.lat),D=[x[0],x[1],x[2]/S,0],I=p.subtract([],_.slice(0,3),D);p.normalize(I,I);const R=this.raycast(D,I,this._exaggeration);return null!==R&&R?(p.scaleAndAdd(D,D,I,R),D[3]=D[2],D[2]*=S,D):null}drawDepth(){const c=this.painter,h=c.context,_=this.proxySourceCache,x=Math.ceil(c.width),S=Math.ceil(c.height);if(!this._depthFBO||this._depthFBO.width===x&&this._depthFBO.height===S||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const D=h.gl,I=h.createFramebuffer(x,S,!0);h.activeTexture.set(D.TEXTURE0);const R=new p.Texture(h,{width:x,height:S,data:null},D.RGBA);R.bind(D.NEAREST,D.CLAMP_TO_EDGE),I.colorAttachment.set(R.texture);const O=h.createRenderbuffer(h.gl.DEPTH_COMPONENT16,x,S);I.depthAttachment.set(O),this._depthFBO=I,this._depthTexture=R}h.bindFramebuffer.set(this._depthFBO.framebuffer),h.viewport.set([0,0,x,S]),function(D,I,R,O){if("globe"===D.transform.projection.name)return;const F=D.context,j=F.gl;F.clear({depth:1});const Y=D.useProgram("terrainDepth"),ee=new p.DepthMode(j.LESS,p.DepthMode.ReadWrite,D.depthRangeFor3D);for(const se of O){const ie=R.getTile(se),le=bd(se.projMatrix,0);I.setupElevationDraw(ie,Y),Y.draw(F,j.TRIANGLES,ee,p.StencilMode.disabled,p.ColorMode.unblended,p.CullFaceMode.backCCW,le,"terrain_depth",I.gridBuffer,I.gridIndexBuffer,I.gridNoSkirtSegments)}}(c,this,_,this.proxyCoords)}_setupProxiedCoordsForOrtho(c,h,_){if(c.getSource()instanceof pi)return this._setupProxiedCoordsForImageSource(c,h,_);this._findCoveringTileCache[c.id]=this._findCoveringTileCache[c.id]||{};const x=this.proxiedCoords[c.id]=[],S=this.proxyCoords;for(let I=0;I<S.length;I++){const R=S[I],O=this._findTileCoveringTileID(R,c);if(O){const F=this._createProxiedId(R,O,_[R.key]&&_[R.key][c.id]);x.push(F),this.proxyToSource[R.key][c.id]=[F]}}let D=!1;for(let I=0;I<h.length;I++){const R=c.getTile(h[I]);if(!R||!R.hasData())continue;const O=this._findTileCoveringTileID(R.tileID,this.proxySourceCache);if(O&&O.tileID.canonical.z!==R.tileID.canonical.z){const F=this.proxyToSource[O.tileID.key][c.id],j=this._createProxiedId(O.tileID,R,_[O.tileID.key]&&_[O.tileID.key][c.id]);F?F.splice(F.length-1,0,j):this.proxyToSource[O.tileID.key][c.id]=[j],x.push(j),D=!0}}this._sourceTilesOverlap[c.id]=D}_setupProxiedCoordsForImageSource(c,h,_){if(!c.getSource().loaded())return;const x=this.proxiedCoords[c.id]=[],S=this.proxyCoords,D=c.getSource(),I=new p.Point(D.tileID.x,D.tileID.y)._div(1<<D.tileID.z),R=D.coordinates.map(p.MercatorCoordinate.fromLngLat).reduce((F,j)=>(F.min.x=Math.min(F.min.x,j.x-I.x),F.min.y=Math.min(F.min.y,j.y-I.y),F.max.x=Math.max(F.max.x,j.x-I.x),F.max.y=Math.max(F.max.y,j.y-I.y),F),{min:new p.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new p.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),O=(F,j)=>{const Y=F.wrap+F.canonical.x/(1<<F.canonical.z),ee=F.canonical.y/(1<<F.canonical.z),se=p.EXTENT/(1<<F.canonical.z),ie=j.wrap+j.canonical.x/(1<<j.canonical.z),le=j.canonical.y/(1<<j.canonical.z);return Y+se<ie+R.min.x||Y>ie+R.max.x||ee+se<le+R.min.y||ee>le+R.max.y};for(let F=0;F<S.length;F++){const j=S[F];for(let Y=0;Y<h.length;Y++){const ee=c.getTile(h[Y]);if(!ee||!ee.hasData()||O(j,ee.tileID))continue;const se=this._createProxiedId(j,ee,_[j.key]&&_[j.key][c.id]),ie=this.proxyToSource[j.key][c.id];ie?ie.push(se):this.proxyToSource[j.key][c.id]=[se],x.push(se)}}}_createProxiedId(c,h,_){let x=this.orthoMatrix;if(_){const S=_.find(D=>D.key===h.tileID.key);if(S)return S}if(h.tileID.key!==c.key){const S=c.canonical.z-h.tileID.canonical.z;let D,I,R;x=p.create();const O=h.tileID.wrap-c.wrap<<c.overscaledZ;S>0?(D=p.EXTENT>>S,I=D*((h.tileID.canonical.x<<S)-c.canonical.x+O),R=D*((h.tileID.canonical.y<<S)-c.canonical.y)):(D=p.EXTENT<<-S,I=p.EXTENT*(h.tileID.canonical.x-(c.canonical.x+O<<-S)),R=p.EXTENT*(h.tileID.canonical.y-(c.canonical.y<<-S))),p.ortho(x,0,D,0,D,0,1),p.translate(x,x,[I,R,0])}return new Ah(h.tileID,c.key,x)}_findTileCoveringTileID(c,h){let _=h.getTile(c);if(_&&_.hasData())return _;const x=this._findCoveringTileCache[h.id],S=x[c.key];if(_=S?h.getTileByID(S):null,_&&_.hasData()||null===S)return _;let D=_?_.tileID:c,I=D.overscaledZ;const R=h.getSource().minzoom,O=[];if(!S){const j=h.getSource().maxzoom;if(c.canonical.z>=j){const Y=c.canonical.z-j;h.getSource().reparseOverscaled?(I=Math.max(c.canonical.z+2,h.transform.tileZoom),D=new p.OverscaledTileID(I,c.wrap,j,c.canonical.x>>Y,c.canonical.y>>Y)):0!==Y&&(I=j,D=new p.OverscaledTileID(I,c.wrap,j,c.canonical.x>>Y,c.canonical.y>>Y))}D.key!==c.key&&(O.push(D.key),_=h.getTile(D))}const F=j=>{O.forEach(Y=>{x[Y]=j}),O.length=0};for(I-=1;I>=R&&(!_||!_.hasData());I--){_&&F(_.tileID.key);const j=D.calculateScaledKey(I);if(_=h.getTileByID(j),_&&_.hasData())break;const Y=x[j];if(null===Y)break;void 0===Y?O.push(j):_=h.getTileByID(Y)}return F(_?_.tileID.key:null),_&&_.hasData()?_:null}findDEMTileFor(c){return this.enabled?this._findTileCoveringTileID(c,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(c,h){let _=this._tilesDirty[c];_||(_=this._tilesDirty[c]={}),_[h.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const c=function(h){let _=0;const x=new p.StructArrayLayout2ui4,S=131;for(let D=1;D<129;D++){for(let I=1;I<129;I++)_=D*S+I,x.emplaceBack(_,_+1),x.emplaceBack(_,_+S),x.emplaceBack(_+1,_+S),128===D&&x.emplaceBack(_+S,_+S+1);x.emplaceBack(_+1,_+1+S)}return x}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(c),this.wireframeSegments=p.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,c.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class Bi{static cacheKey(c,h,_,x){let S=`${h}${x?x.cacheKey:""}`;for(const D of _)c.usedDefines.includes(D)&&(S+=`/${D}`);return S}constructor(c,h,_,x,S,D){const I=c.gl;this.program=I.createProgram();const R=function(U){const J=[];for(let pe=0;pe<U.length;pe++){if(null===U[pe])continue;const ge=U[pe].split(" ");J.push(ge.pop())}return J}(_.staticAttributes),O=x?x.getBinderAttributes():[],F=R.concat(O);let j=x?x.defines():[];j=j.concat(D.map(U=>`#define ${U}`));const Y=c.isWebGL2?"#version 300 es\n":"",ee=Y+j.concat(c.extStandardDerivatives&&0===Y.length?"#extension GL_OES_standard_derivatives : enable\n".concat(Rs):Rs,Rs,Ih,Dh.fragmentSource,gu.fragmentSource,_.fragmentSource).join("\n"),se=Y+j.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Ih,Dh.vertexSource,gu.vertexSource,md.vertexSource,_.vertexSource).join("\n"),ie=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(ie,ee),I.compileShader(ie),I.attachShader(this.program,ie);const le=I.createShader(I.VERTEX_SHADER);if(I.isContextLost())this.failedToCreate=!0;else{I.shaderSource(le,se),I.compileShader(le),I.attachShader(this.program,le),this.attributes={},this.numAttributes=F.length;for(let U=0;U<this.numAttributes;U++)F[U]&&(I.bindAttribLocation(this.program,U,F[U]),this.attributes[F[U]]=U);I.linkProgram(this.program),I.deleteShader(le),I.deleteShader(ie),this.fixedUniforms=S(c),this.binderUniforms=x?x.getUniforms(c):[],D.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new p.Uniform1i(U=c),u_dem_prev:new p.Uniform1i(U),u_dem_unpack:new p.Uniform4f(U),u_dem_tl:new p.Uniform2f(U),u_dem_scale:new p.Uniform1f(U),u_dem_tl_prev:new p.Uniform2f(U),u_dem_scale_prev:new p.Uniform1f(U),u_dem_size:new p.Uniform1f(U),u_dem_lerp:new p.Uniform1f(U),u_exaggeration:new p.Uniform1f(U),u_depth:new p.Uniform1i(U),u_depth_size_inv:new p.Uniform2f(U),u_meter_to_dem:new p.Uniform1f(U),u_label_plane_matrix_inv:new p.UniformMatrix4f(U)}),D.includes("GLOBE")&&(this.globeUniforms=(U=>({u_tile_tl_up:new p.Uniform3f(U),u_tile_tr_up:new p.Uniform3f(U),u_tile_br_up:new p.Uniform3f(U),u_tile_bl_up:new p.Uniform3f(U),u_tile_up_scale:new p.Uniform1f(U)}))(c)),D.includes("FOG")&&(this.fogUniforms=(U=>({u_fog_matrix:new p.UniformMatrix4f(U),u_fog_range:new p.Uniform2f(U),u_fog_color:new p.Uniform4f(U),u_fog_horizon_blend:new p.Uniform1f(U),u_fog_temporal_offset:new p.Uniform1f(U),u_frustum_tl:new p.Uniform3f(U),u_frustum_tr:new p.Uniform3f(U),u_frustum_br:new p.Uniform3f(U),u_frustum_bl:new p.Uniform3f(U),u_globe_pos:new p.Uniform3f(U),u_globe_radius:new p.Uniform1f(U),u_globe_transition:new p.Uniform1f(U),u_is_globe:new p.Uniform1i(U),u_viewport:new p.Uniform2f(U)}))(c))}var U}setTerrainUniformValues(c,h){if(!this.terrainUniforms)return;const _=this.terrainUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const x in h)_[x]&&_[x].set(this.program,x,h[x])}}setGlobeUniformValues(c,h){if(!this.globeUniforms)return;const _=this.globeUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const x in h)_[x]&&_[x].set(this.program,x,h[x])}}setFogUniformValues(c,h){if(!this.fogUniforms)return;const _=this.fogUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const x in h)_[x].set(this.program,x,h[x])}}draw(c,h,_,x,S,D,I,R,O,F,j,Y,ee,se,ie){const le=c.gl;if(this.failedToCreate)return;c.program.set(this.program),c.setDepthMode(_),c.setStencilMode(x),c.setColorMode(S),c.setCullFace(D);for(const J of Object.keys(this.fixedUniforms))this.fixedUniforms[J].set(this.program,J,I[J]);se&&se.setUniforms(this.program,c,this.binderUniforms,Y,{zoom:ee});const U={[le.LINES]:2,[le.TRIANGLES]:3,[le.LINE_STRIP]:1}[h];for(const J of j.get()){const pe=J.vaos||(J.vaos={});(pe[R]||(pe[R]=new Ta)).bind(c,this,O,se?se.getPaintVertexBuffers():[],F,J.vertexOffset,ie||[]),le.drawElements(h,J.primitiveLength*U,le.UNSIGNED_SHORT,J.primitiveOffset*U*2)}}}function xn(g,c){const h=Math.pow(2,c.tileID.overscaledZ),_=c.tileSize*Math.pow(2,g.transform.tileZoom)/h,x=_*(c.tileID.canonical.x+c.tileID.wrap*h),S=_*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_tile_units_to_pixels:1/cn(c,1,g.transform.tileZoom),u_pixel_coord_upper:[x>>16,S>>16],u_pixel_coord_lower:[65535&x,65535&S]}}const Um=p.create(),Rh=(g,c,h,_,x,S,D,I,R,O,F)=>{const j=c.style.light,Y=j.properties.get("position"),ee=[Y.x,Y.y,Y.z],se=p.create$1();"viewport"===j.properties.get("anchor")&&(p.fromRotation(se,-c.transform.angle),p.transformMat3(ee,ee,se));const ie=j.properties.get("color"),le=c.transform,U={u_matrix:g,u_lightpos:ee,u_lightintensity:j.properties.get("intensity"),u_lightcolor:[ie.r,ie.g,ie.b],u_vertical_gradient:+h,u_opacity:_,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Um,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:x,u_edge_radius:S};return"globe"===le.projection.name&&(U.u_tile_id=[D.canonical.x,D.canonical.y,1<<D.canonical.z],U.u_zoom_transition=R,U.u_inv_rot_matrix=F,U.u_merc_center=O,U.u_up_dir=le.projection.upVector(new p.CanonicalTileID(0,0,0),O[0]*p.EXTENT,O[1]*p.EXTENT),U.u_height_lift=I),U},Lt=(g,c,h,_,x,S,D,I,R,O,F,j)=>{const Y=Rh(g,c,h,_,x,S,D,R,O,F,j),ee={u_height_factor:-Math.pow(2,D.overscaledZ)/I.tileSize/8};return p.extend(Y,xn(c,I),ee)},_o=g=>({u_matrix:g}),hr=(g,c,h)=>p.extend(_o(g),xn(c,h)),ms=(g,c)=>({u_matrix:g,u_world:c}),gs=(g,c,h,_)=>p.extend(hr(g,c,h),{u_world:_}),_u=p.create(),bs=(g,c,h,_,x,S)=>{const D=g.transform,I="globe"===D.projection.name;let R;if("map"===S.paint.get("circle-pitch-alignment"))if(I){const F=p.globePixelsToTileUnits(D.zoom,c.canonical)*D._pixelsPerMercatorPixel;R=Float32Array.from([F,0,0,F])}else R=D.calculatePixelsToTileUnitsMatrix(h);else R=new Float32Array([D.pixelsToGLUnits[0],0,0,D.pixelsToGLUnits[1]]);const O={u_camera_to_center_distance:D.cameraToCenterDistance,u_matrix:g.translatePosMatrix(c.projMatrix,h,S.paint.get("circle-translate"),S.paint.get("circle-translate-anchor")),u_device_pixel_ratio:p.exported.devicePixelRatio,u_extrude_scale:R,u_inv_rot_matrix:_u,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(I){O.u_inv_rot_matrix=_,O.u_merc_center=x,O.u_tile_id=[c.canonical.x,c.canonical.y,1<<c.canonical.z],O.u_zoom_transition=p.globeToMercatorTransition(D.zoom);const F=x[0]*p.EXTENT,j=x[1]*p.EXTENT;O.u_up_dir=D.projection.upVector(new p.CanonicalTileID(0,0,0),F,j)}return O},yu=g=>{const c=[];return"map"===g.paint.get("circle-pitch-alignment")&&c.push("PITCH_WITH_MAP"),"map"===g.paint.get("circle-pitch-scale")&&c.push("SCALE_WITH_MAP"),c},_d=(g,c,h,_)=>{const x=p.EXTENT/h.tileSize;return{u_matrix:g,u_camera_to_center_distance:c.getCameraToCenterDistance(_),u_extrude_scale:[c.pixelsToGLUnits[0]/x,c.pixelsToGLUnits[1]/x]}},Ql=(g,c,h=1)=>({u_matrix:g,u_color:c,u_overlay:0,u_overlay_scale:h}),yd=p.create(),Jl=(g,c,h,_,x,S,D)=>{const I=g.transform,R="globe"===I.projection.name,O=R?p.globePixelsToTileUnits(I.zoom,c.canonical)*I._pixelsPerMercatorPixel:cn(h,1,S),F={u_matrix:c.projMatrix,u_extrude_scale:O,u_intensity:D,u_inv_rot_matrix:yd,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(R){F.u_inv_rot_matrix=_,F.u_merc_center=x,F.u_tile_id=[c.canonical.x,c.canonical.y,1<<c.canonical.z],F.u_zoom_transition=p.globeToMercatorTransition(I.zoom);const j=x[0]*p.EXTENT,Y=x[1]*p.EXTENT;F.u_up_dir=I.projection.upVector(new p.CanonicalTileID(0,0,0),j,Y)}return F},es=(g,c,h,_,x,S,D)=>{const I=g.transform,R=I.calculatePixelsToTileUnitsMatrix(c);return{u_matrix:yn(g,c,h,_),u_pixels_to_tile_units:R,u_device_pixel_ratio:S,u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:x,u_texsize:ui(h)?c.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Vo(c,g.transform),u_alpha_discard_threshold:0,u_trim_offset:D}},vd=(g,c,h,_,x)=>{const S=g.transform;return{u_matrix:yn(g,c,h,_),u_texsize:c.imageAtlasTexture.size,u_pixels_to_tile_units:S.calculatePixelsToTileUnitsMatrix(c),u_device_pixel_ratio:x,u_image:0,u_tile_units_to_pixels:Vo(c,S),u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Vo(g,c){return 1/cn(g,1,c.tileZoom)}function yn(g,c,h,_){return g.translatePosMatrix(_||c.tileID.projMatrix,c,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}function ui(g){const c=g.paint.get("line-dasharray").value;return c.value||"constant"!==c.kind}const Br=(g,c,h,_,x,S)=>{return{u_matrix:g,u_tl_parent:c,u_scale_parent:h,u_fade_t:_.mix,u_opacity:_.opacity*x.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:x.paint.get("raster-brightness-min"),u_brightness_high:x.paint.get("raster-brightness-max"),u_saturation_factor:(I=x.paint.get("raster-saturation"),I>0?1-1/(1.001-I):-I),u_contrast_factor:(D=x.paint.get("raster-contrast"),D>0?1/(1-D):1+D),u_spin_weights:no(x.paint.get("raster-hue-rotate")),u_perspective_transform:S};var D,I};function no(g){g*=Math.PI/180;const c=Math.sin(g),h=Math.cos(g);return[(2*h+1)/3,(-Math.sqrt(3)*c-h+1)/3,(Math.sqrt(3)*c-h+1)/3]}const Qa=p.create(),yo=(g,c,h,_,x,S,D,I,R,O,F,j,Y,ee,se,ie)=>{const le=x.transform,U={u_is_size_zoom_constant:+("constant"===g||"source"===g),u_is_size_feature_constant:+("constant"===g||"camera"===g),u_size_t:c?c.uSizeT:0,u_size:c?c.uSize:0,u_camera_to_center_distance:le.cameraToCenterDistance,u_rotate_symbol:+h,u_aspect_ratio:le.width/le.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:S,u_label_plane_matrix:D,u_coord_matrix:I,u_is_text:+R,u_pitch_with_map:+_,u_texsize:O,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Qa,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Qa,u_up_vector:[0,-1,0]};return"globe"===ie.name&&(U.u_tile_id=[F.canonical.x,F.canonical.y,1<<F.canonical.z],U.u_zoom_transition=j,U.u_inv_rot_matrix=ee,U.u_merc_center=Y,U.u_camera_forward=le._camera.forward(),U.u_ecef_origin=p.globeECEFOrigin(le.globeMatrix,F.toUnwrapped()),U.u_tile_matrix=Float32Array.from(le.globeMatrix),U.u_up_vector=se),U},Ja=(g,c,h,_,x,S,D,I,R,O,F,j,Y,ee,se,ie,le)=>p.extend(yo(g,c,h,_,x,S,D,I,R,O,j,Y,ee,se,ie,le),{u_gamma_scale:_?x.transform.cameraToCenterDistance*Math.cos(x.terrain?0:x.transform._pitch):1,u_device_pixel_ratio:p.exported.devicePixelRatio,u_is_halo:+F}),Xr=(g,c,h,_,x,S,D,I,R,O,F,j,Y,ee,se,ie)=>p.extend(Ja(g,c,h,_,x,S,D,I,!0,R,!0,F,j,Y,ee,se,ie),{u_texsize_icon:O,u_texture_icon:1}),Oc=(g,c,h)=>({u_matrix:g,u_opacity:c,u_color:h}),xd=(g,c,h,_,x)=>p.extend(function(S,D,I){const R=D.imageManager.getPattern(S.toString()),{width:O,height:F}=D.imageManager.getPixelSize(),j=Math.pow(2,I.tileID.overscaledZ),Y=I.tileSize*Math.pow(2,D.transform.tileZoom)/j,ee=Y*(I.tileID.canonical.x+I.tileID.wrap*j),se=Y*I.tileID.canonical.y;return{u_image:0,u_pattern_tl:R.tl,u_pattern_br:R.br,u_texsize:[O,F],u_pattern_size:R.displaySize,u_tile_units_to_pixels:1/cn(I,1,D.transform.tileZoom),u_pixel_coord_upper:[ee>>16,se>>16],u_pixel_coord_lower:[65535&ee,65535&se]}}(_,h,x),{u_matrix:g,u_opacity:c}),wi={fillExtrusion:g=>({u_matrix:new p.UniformMatrix4f(g),u_lightpos:new p.Uniform3f(g),u_lightintensity:new p.Uniform1f(g),u_lightcolor:new p.Uniform3f(g),u_vertical_gradient:new p.Uniform1f(g),u_opacity:new p.Uniform1f(g),u_edge_radius:new p.Uniform1f(g),u_ao:new p.Uniform2f(g),u_tile_id:new p.Uniform3f(g),u_zoom_transition:new p.Uniform1f(g),u_inv_rot_matrix:new p.UniformMatrix4f(g),u_merc_center:new p.Uniform2f(g),u_up_dir:new p.Uniform3f(g),u_height_lift:new p.Uniform1f(g)}),fillExtrusionPattern:g=>({u_matrix:new p.UniformMatrix4f(g),u_lightpos:new p.Uniform3f(g),u_lightintensity:new p.Uniform1f(g),u_lightcolor:new p.Uniform3f(g),u_vertical_gradient:new p.Uniform1f(g),u_height_factor:new p.Uniform1f(g),u_edge_radius:new p.Uniform1f(g),u_ao:new p.Uniform2f(g),u_tile_id:new p.Uniform3f(g),u_zoom_transition:new p.Uniform1f(g),u_inv_rot_matrix:new p.UniformMatrix4f(g),u_merc_center:new p.Uniform2f(g),u_up_dir:new p.Uniform3f(g),u_height_lift:new p.Uniform1f(g),u_image:new p.Uniform1i(g),u_texsize:new p.Uniform2f(g),u_pixel_coord_upper:new p.Uniform2f(g),u_pixel_coord_lower:new p.Uniform2f(g),u_tile_units_to_pixels:new p.Uniform1f(g),u_opacity:new p.Uniform1f(g)}),fill:g=>({u_matrix:new p.UniformMatrix4f(g)}),fillPattern:g=>({u_matrix:new p.UniformMatrix4f(g),u_image:new p.Uniform1i(g),u_texsize:new p.Uniform2f(g),u_pixel_coord_upper:new p.Uniform2f(g),u_pixel_coord_lower:new p.Uniform2f(g),u_tile_units_to_pixels:new p.Uniform1f(g)}),fillOutline:g=>({u_matrix:new p.UniformMatrix4f(g),u_world:new p.Uniform2f(g)}),fillOutlinePattern:g=>({u_matrix:new p.UniformMatrix4f(g),u_world:new p.Uniform2f(g),u_image:new p.Uniform1i(g),u_texsize:new p.Uniform2f(g),u_pixel_coord_upper:new p.Uniform2f(g),u_pixel_coord_lower:new p.Uniform2f(g),u_tile_units_to_pixels:new p.Uniform1f(g)}),circle:g=>({u_camera_to_center_distance:new p.Uniform1f(g),u_extrude_scale:new p.UniformMatrix2f(g),u_device_pixel_ratio:new p.Uniform1f(g),u_matrix:new p.UniformMatrix4f(g),u_inv_rot_matrix:new p.UniformMatrix4f(g),u_merc_center:new p.Uniform2f(g),u_tile_id:new p.Uniform3f(g),u_zoom_transition:new p.Uniform1f(g),u_up_dir:new p.Uniform3f(g)}),collisionBox:g=>({u_matrix:new p.UniformMatrix4f(g),u_camera_to_center_distance:new p.Uniform1f(g),u_extrude_scale:new p.Uniform2f(g)}),collisionCircle:g=>({u_matrix:new p.UniformMatrix4f(g),u_inv_matrix:new p.UniformMatrix4f(g),u_camera_to_center_distance:new p.Uniform1f(g),u_viewport_size:new p.Uniform2f(g)}),debug:g=>({u_color:new p.UniformColor(g),u_matrix:new p.UniformMatrix4f(g),u_overlay:new p.Uniform1i(g),u_overlay_scale:new p.Uniform1f(g)}),clippingMask:g=>({u_matrix:new p.UniformMatrix4f(g)}),heatmap:g=>({u_extrude_scale:new p.Uniform1f(g),u_intensity:new p.Uniform1f(g),u_matrix:new p.UniformMatrix4f(g),u_inv_rot_matrix:new p.UniformMatrix4f(g),u_merc_center:new p.Uniform2f(g),u_tile_id:new p.Uniform3f(g),u_zoom_transition:new p.Uniform1f(g),u_up_dir:new p.Uniform3f(g)}),heatmapTexture:g=>({u_image:new p.Uniform1i(g),u_color_ramp:new p.Uniform1i(g),u_opacity:new p.Uniform1f(g)}),hillshade:g=>({u_matrix:new p.UniformMatrix4f(g),u_image:new p.Uniform1i(g),u_latrange:new p.Uniform2f(g),u_light:new p.Uniform2f(g),u_shadow:new p.UniformColor(g),u_highlight:new p.UniformColor(g),u_accent:new p.UniformColor(g)}),hillshadePrepare:g=>({u_matrix:new p.UniformMatrix4f(g),u_image:new p.Uniform1i(g),u_dimension:new p.Uniform2f(g),u_zoom:new p.Uniform1f(g),u_unpack:new p.Uniform4f(g)}),line:g=>({u_matrix:new p.UniformMatrix4f(g),u_pixels_to_tile_units:new p.UniformMatrix2f(g),u_device_pixel_ratio:new p.Uniform1f(g),u_units_to_pixels:new p.Uniform2f(g),u_dash_image:new p.Uniform1i(g),u_gradient_image:new p.Uniform1i(g),u_image_height:new p.Uniform1f(g),u_texsize:new p.Uniform2f(g),u_tile_units_to_pixels:new p.Uniform1f(g),u_alpha_discard_threshold:new p.Uniform1f(g),u_trim_offset:new p.Uniform2f(g)}),linePattern:g=>({u_matrix:new p.UniformMatrix4f(g),u_texsize:new p.Uniform2f(g),u_pixels_to_tile_units:new p.UniformMatrix2f(g),u_device_pixel_ratio:new p.Uniform1f(g),u_image:new p.Uniform1i(g),u_units_to_pixels:new p.Uniform2f(g),u_tile_units_to_pixels:new p.Uniform1f(g),u_alpha_discard_threshold:new p.Uniform1f(g)}),raster:g=>({u_matrix:new p.UniformMatrix4f(g),u_tl_parent:new p.Uniform2f(g),u_scale_parent:new p.Uniform1f(g),u_fade_t:new p.Uniform1f(g),u_opacity:new p.Uniform1f(g),u_image0:new p.Uniform1i(g),u_image1:new p.Uniform1i(g),u_brightness_low:new p.Uniform1f(g),u_brightness_high:new p.Uniform1f(g),u_saturation_factor:new p.Uniform1f(g),u_contrast_factor:new p.Uniform1f(g),u_spin_weights:new p.Uniform3f(g),u_perspective_transform:new p.Uniform2f(g)}),symbolIcon:g=>({u_is_size_zoom_constant:new p.Uniform1i(g),u_is_size_feature_constant:new p.Uniform1i(g),u_size_t:new p.Uniform1f(g),u_size:new p.Uniform1f(g),u_camera_to_center_distance:new p.Uniform1f(g),u_rotate_symbol:new p.Uniform1i(g),u_aspect_ratio:new p.Uniform1f(g),u_fade_change:new p.Uniform1f(g),u_matrix:new p.UniformMatrix4f(g),u_label_plane_matrix:new p.UniformMatrix4f(g),u_coord_matrix:new p.UniformMatrix4f(g),u_is_text:new p.Uniform1i(g),u_pitch_with_map:new p.Uniform1i(g),u_texsize:new p.Uniform2f(g),u_tile_id:new p.Uniform3f(g),u_zoom_transition:new p.Uniform1f(g),u_inv_rot_matrix:new p.UniformMatrix4f(g),u_merc_center:new p.Uniform2f(g),u_camera_forward:new p.Uniform3f(g),u_tile_matrix:new p.UniformMatrix4f(g),u_up_vector:new p.Uniform3f(g),u_ecef_origin:new p.Uniform3f(g),u_texture:new p.Uniform1i(g)}),symbolSDF:g=>({u_is_size_zoom_constant:new p.Uniform1i(g),u_is_size_feature_constant:new p.Uniform1i(g),u_size_t:new p.Uniform1f(g),u_size:new p.Uniform1f(g),u_camera_to_center_distance:new p.Uniform1f(g),u_rotate_symbol:new p.Uniform1i(g),u_aspect_ratio:new p.Uniform1f(g),u_fade_change:new p.Uniform1f(g),u_matrix:new p.UniformMatrix4f(g),u_label_plane_matrix:new p.UniformMatrix4f(g),u_coord_matrix:new p.UniformMatrix4f(g),u_is_text:new p.Uniform1i(g),u_pitch_with_map:new p.Uniform1i(g),u_texsize:new p.Uniform2f(g),u_texture:new p.Uniform1i(g),u_gamma_scale:new p.Uniform1f(g),u_device_pixel_ratio:new p.Uniform1f(g),u_tile_id:new p.Uniform3f(g),u_zoom_transition:new p.Uniform1f(g),u_inv_rot_matrix:new p.UniformMatrix4f(g),u_merc_center:new p.Uniform2f(g),u_camera_forward:new p.Uniform3f(g),u_tile_matrix:new p.UniformMatrix4f(g),u_up_vector:new p.Uniform3f(g),u_ecef_origin:new p.Uniform3f(g),u_is_halo:new p.Uniform1i(g)}),symbolTextAndIcon:g=>({u_is_size_zoom_constant:new p.Uniform1i(g),u_is_size_feature_constant:new p.Uniform1i(g),u_size_t:new p.Uniform1f(g),u_size:new p.Uniform1f(g),u_camera_to_center_distance:new p.Uniform1f(g),u_rotate_symbol:new p.Uniform1i(g),u_aspect_ratio:new p.Uniform1f(g),u_fade_change:new p.Uniform1f(g),u_matrix:new p.UniformMatrix4f(g),u_label_plane_matrix:new p.UniformMatrix4f(g),u_coord_matrix:new p.UniformMatrix4f(g),u_is_text:new p.Uniform1i(g),u_pitch_with_map:new p.Uniform1i(g),u_texsize:new p.Uniform2f(g),u_texsize_icon:new p.Uniform2f(g),u_texture:new p.Uniform1i(g),u_texture_icon:new p.Uniform1i(g),u_gamma_scale:new p.Uniform1f(g),u_device_pixel_ratio:new p.Uniform1f(g),u_is_halo:new p.Uniform1i(g)}),background:g=>({u_matrix:new p.UniformMatrix4f(g),u_opacity:new p.Uniform1f(g),u_color:new p.UniformColor(g)}),backgroundPattern:g=>({u_matrix:new p.UniformMatrix4f(g),u_opacity:new p.Uniform1f(g),u_image:new p.Uniform1i(g),u_pattern_tl:new p.Uniform2f(g),u_pattern_br:new p.Uniform2f(g),u_texsize:new p.Uniform2f(g),u_pattern_size:new p.Uniform2f(g),u_pixel_coord_upper:new p.Uniform2f(g),u_pixel_coord_lower:new p.Uniform2f(g),u_tile_units_to_pixels:new p.Uniform1f(g)}),terrainRaster:jm,terrainDepth:jm,skybox:g=>({u_matrix:new p.UniformMatrix4f(g),u_sun_direction:new p.Uniform3f(g),u_cubemap:new p.Uniform1i(g),u_opacity:new p.Uniform1f(g),u_temporal_offset:new p.Uniform1f(g)}),skyboxGradient:g=>({u_matrix:new p.UniformMatrix4f(g),u_color_ramp:new p.Uniform1i(g),u_center_direction:new p.Uniform3f(g),u_radius:new p.Uniform1f(g),u_opacity:new p.Uniform1f(g),u_temporal_offset:new p.Uniform1f(g)}),skyboxCapture:g=>({u_matrix_3f:new p.UniformMatrix3f(g),u_sun_direction:new p.Uniform3f(g),u_sun_intensity:new p.Uniform1f(g),u_color_tint_r:new p.Uniform4f(g),u_color_tint_m:new p.Uniform4f(g),u_luminance:new p.Uniform1f(g)}),globeRaster:g=>({u_proj_matrix:new p.UniformMatrix4f(g),u_globe_matrix:new p.UniformMatrix4f(g),u_normalize_matrix:new p.UniformMatrix4f(g),u_merc_matrix:new p.UniformMatrix4f(g),u_zoom_transition:new p.Uniform1f(g),u_merc_center:new p.Uniform2f(g),u_image0:new p.Uniform1i(g),u_grid_matrix:new p.UniformMatrix3f(g),u_skirt_height:new p.Uniform1f(g),u_frustum_tl:new p.Uniform3f(g),u_frustum_tr:new p.Uniform3f(g),u_frustum_br:new p.Uniform3f(g),u_frustum_bl:new p.Uniform3f(g),u_globe_pos:new p.Uniform3f(g),u_globe_radius:new p.Uniform1f(g),u_viewport:new p.Uniform2f(g)}),globeAtmosphere:g=>({u_frustum_tl:new p.Uniform3f(g),u_frustum_tr:new p.Uniform3f(g),u_frustum_br:new p.Uniform3f(g),u_frustum_bl:new p.Uniform3f(g),u_horizon:new p.Uniform1f(g),u_transition:new p.Uniform1f(g),u_fadeout_range:new p.Uniform1f(g),u_color:new p.Uniform4f(g),u_high_color:new p.Uniform4f(g),u_space_color:new p.Uniform4f(g),u_star_intensity:new p.Uniform1f(g),u_star_density:new p.Uniform1f(g),u_star_size:new p.Uniform1f(g),u_temporal_offset:new p.Uniform1f(g),u_horizon_angle:new p.Uniform1f(g),u_rotation_matrix:new p.UniformMatrix4f(g)})};let Fc;function el(g,c,h,_,x,S,D){const I=g.context,R=I.gl,O=g.transform,F=g.useProgram("collisionBox"),j=[];let Y=0,ee=0;for(let ge=0;ge<_.length;ge++){const Fe=_[ge],Pe=c.getTile(Fe),Oe=Pe.getBucket(h);if(!Oe)continue;const We=As(Fe,Oe,O);let He=We;0===x[0]&&0===x[1]||(He=g.translatePosMatrix(We,Pe,x,S));const ot=D?Oe.textCollisionBox:Oe.iconCollisionBox,Ft=Oe.collisionCircleArray;if(Ft.length>0){const nt=p.create(),St=He;p.mul(nt,Oe.placementInvProjMatrix,O.glCoordMatrix),p.mul(nt,nt,Oe.placementViewportMatrix),j.push({circleArray:Ft,circleOffset:ee,transform:St,invTransform:nt,projection:Oe.getProjection()}),Y+=Ft.length/4,ee=Y}ot&&(g.terrain&&g.terrain.setupElevationDraw(Pe,F),F.draw(I,R.LINES,p.DepthMode.disabled,p.StencilMode.disabled,g.colorModeForRenderPass(),p.CullFaceMode.disabled,_d(He,O,Pe,Oe.getProjection()),h.id,ot.layoutVertexBuffer,ot.indexBuffer,ot.segments,null,O.zoom,null,[ot.collisionVertexBuffer,ot.collisionVertexBufferExt]))}if(!D||!j.length)return;const se=g.useProgram("collisionCircle"),ie=new p.StructArrayLayout2f1f2i16;ie.resize(4*Y),ie._trim();let le=0;for(const ge of j)for(let Fe=0;Fe<ge.circleArray.length/4;Fe++){const Pe=4*Fe,Oe=ge.circleArray[Pe+0],We=ge.circleArray[Pe+1],He=ge.circleArray[Pe+2],ot=ge.circleArray[Pe+3];ie.emplace(le++,Oe,We,He,ot,0),ie.emplace(le++,Oe,We,He,ot,1),ie.emplace(le++,Oe,We,He,ot,2),ie.emplace(le++,Oe,We,He,ot,3)}(!Fc||Fc.length<2*Y)&&(Fc=function(ge){const Fe=2*ge,Pe=new p.StructArrayLayout3ui6;Pe.resize(Fe),Pe._trim();for(let Oe=0;Oe<Fe;Oe++){const We=6*Oe;Pe.uint16[We+0]=4*Oe+0,Pe.uint16[We+1]=4*Oe+1,Pe.uint16[We+2]=4*Oe+2,Pe.uint16[We+3]=4*Oe+2,Pe.uint16[We+4]=4*Oe+3,Pe.uint16[We+5]=4*Oe+0}return Pe}(Y));const U=I.createIndexBuffer(Fc,!0),J=I.createVertexBuffer(ie,p.collisionCircleLayout.members,!0);for(const ge of j){const Fe={u_matrix:ge.transform,u_inv_matrix:ge.invTransform,u_camera_to_center_distance:(pe=O).getCameraToCenterDistance(ge.projection),u_viewport_size:[pe.width,pe.height]};se.draw(I,R.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,g.colorModeForRenderPass(),p.CullFaceMode.disabled,Fe,h.id,J,U,p.SegmentVector.simpleSegment(0,2*ge.circleOffset,ge.circleArray.length,ge.circleArray.length/2),null,O.zoom)}var pe;J.destroy(),U.destroy()}const Ph=p.create();function wl({width:g,height:c,anchor:h,textOffset:_,textScale:x},S){const{horizontalAlign:D,verticalAlign:I}=p.getAnchorAlignment(h),R=-(D-.5)*g,O=-(I-.5)*c,F=p.evaluateVariableOffset(h,_);return new p.Point((R/x+F[0])*S,(O/x+F[1])*S)}function ts(g,c,h,_,x,S,D,I,R,O,F){const j=g.text.placedSymbolArray,Y=g.text.dynamicLayoutVertexArray,ee=g.icon.dynamicLayoutVertexArray,se={},ie=g.getProjection(),le=Ur(I,ie,S),U=S.elevation,J=ie.upVectorScale(I.canonical,S.center.lat,S.worldSize).metersToTile;Y.clear();for(let pe=0;pe<j.length;pe++){const ge=j.get(pe),{tileAnchorX:Fe,tileAnchorY:Pe,numGlyphs:Oe}=ge,We=ge.hidden||!ge.crossTileID||g.allowVerticalPlacement&&!ge.placedOrientation?null:_[ge.crossTileID];if(We){let He=0,ot=0,Ft=0;if(U){const Vt=U?U.getAtTileOffset(I,Fe,Pe):0,[In,zn,bn]=ie.upVector(I.canonical,Fe,Pe);He=Vt*In*J,ot=Vt*zn*J,Ft=Vt*bn*J}let[nt,St,pt,Nt]=Ro(ge.projectedAnchorX+He,ge.projectedAnchorY+ot,ge.projectedAnchorZ+Ft,h?le:D);const it=$p(S.getCameraToCenterDistance(ie),Nt);let vt=x.evaluateSizeForFeature(g.textSizeData,O,ge)*it/p.ONE_EM;h&&(vt*=g.tilePixelRatio/R);const Bt=wl(We,vt);h?(({x:nt,y:St,z:pt}=ie.projectTilePoint(Fe+Bt.x,Pe+Bt.y,I.canonical)),[nt,St,pt]=Ro(nt+He,St+ot,pt+Ft,D)):(c&&Bt._rotate(-S.angle),nt+=Bt.x,St+=Bt.y,pt=0);const Mt=g.allowVerticalPlacement&&ge.placedOrientation===p.WritingMode.vertical?Math.PI/2:0;for(let Vt=0;Vt<Oe;Vt++)p.addDynamicAttributes(Y,nt,St,pt,Mt);F&&ge.associatedIconIndex>=0&&(se[ge.associatedIconIndex]={x:nt,y:St,z:pt,angle:Mt})}else zi(Oe,Y)}if(F){ee.clear();const pe=g.icon.placedSymbolArray;for(let ge=0;ge<pe.length;ge++){const Fe=pe.get(ge),{numGlyphs:Pe}=Fe,Oe=se[ge];if(Fe.hidden||!Oe)zi(Pe,ee);else{const{x:We,y:He,z:ot,angle:Ft}=Oe;for(let nt=0;nt<Pe;nt++)p.addDynamicAttributes(ee,We,He,ot,Ft)}}g.icon.dynamicLayoutVertexBuffer.updateData(ee)}g.text.dynamicLayoutVertexBuffer.updateData(Y)}function Nc(g,c,h){return h.iconsInText&&c?"symbolTextAndIcon":g?"symbolSDF":"symbolIcon"}function Bc(g,c,h,_,x,S,D,I,R,O,F,j){const Y=g.context,ee=Y.gl,se=g.transform,ie="map"===I,le="map"===R,U=ie&&"point"!==h.layout.get("symbol-placement"),J=ie&&!le&&!U,pe=void 0!==h.layout.get("symbol-sort-key").constantOr(1);let ge=!1;const Fe=g.depthModeForSublayer(0,p.DepthMode.ReadOnly),Pe=[p.mercatorXfromLng(se.center.lng),p.mercatorYfromLat(se.center.lat)],Oe=h.layout.get("text-variable-anchor"),We="globe"===se.projection.name,He=[],ot=[0,-1,0];let Ft=ot;!We&&!se.mercatorFromTransition||ie||(Ft=function(nt){const St=nt._camera.getWorldToCamera(nt.worldSize,1),pt=p.multiply([],St,nt.globeMatrix);p.invert(pt,pt);const Nt=[0,0,0],it=[0,1,0,0];return p.transformMat4$1(it,it,pt),Nt[0]=it[0],Nt[1]=it[1],Nt[2]=it[2],p.normalize(Nt,Nt),Nt}(se));for(const nt of _){const St=c.getTile(nt),pt=St.getBucket(h);if(!pt||"mercator"===pt.projection.name&&We)continue;const Nt=x?pt.text:pt.icon;if(!Nt||pt.fullyClipped||!Nt.segments.get().length)continue;const it=Nt.programConfigurations.get(h.id),vt=x||pt.sdfIcons,Bt=x?pt.textSizeData:pt.iconSizeData,Mt=le||0!==se.pitch,Vt=p.evaluateSizeForZoom(Bt,se.zoom);let In,zn,bn,An,gi=[0,0],oi=null;if(x)zn=St.glyphAtlasTexture,bn=ee.LINEAR,In=St.glyphAtlasTexture.size,pt.iconsInText&&(gi=St.imageAtlasTexture.size,oi=St.imageAtlasTexture,An=Mt||g.options.rotating||g.options.zooming||"composite"===Bt.kind||"camera"===Bt.kind?ee.LINEAR:ee.NEAREST);else{const El=1!==h.layout.get("icon-size").constantOr(0)||pt.iconsNeedLinear;zn=St.imageAtlasTexture,bn=vt||g.options.rotating||g.options.zooming||El||Mt?ee.LINEAR:ee.NEAREST,In=St.imageAtlasTexture.size}const En="globe"===pt.projection.name,nr=En?Ft:ot,pr=En?p.globeToMercatorTransition(se.zoom):0,_r=Ur(nt,pt.getProjection(),se),ki=se.calculatePixelsToTileUnitsMatrix(St),ns=bt(_r,St.tileID.canonical,le,ie,se,pt.getProjection(),ki),io=g.terrain&&le&&U?p.invert(p.create(),ns):Ph,Ns=co(_r,St.tileID.canonical,le,ie,se,pt.getProjection(),ki),da=Oe&&pt.hasTextData(),Ir="none"!==h.layout.get("icon-text-fit")&&da&&pt.hasIconData();if(U){const El=se.elevation,Dl=El?El.getAtTileOffsetFunc(nt,se.center.lat,se.worldSize,pt.getProjection()):null,rc=yl(_r,St.tileID.canonical,le,ie,se,pt.getProjection(),ki);Gp(pt,_r,g,x,rc,Ns,le,O,Dl,nt)}const or=U||x&&Oe||Ir,Yi=g.translatePosMatrix(_r,St,S,D),ro=or?Ph:ns,is=g.translatePosMatrix(Ns,St,S,D,!0),Rr=pt.getProjection().createInversionMatrix(se,nt.canonical),vs=[];g.terrainRenderModeElevated()&&le&&vs.push("PITCH_WITH_MAP_TERRAIN"),En&&vs.push("PROJECTION_GLOBE_VIEW"),or&&vs.push("PROJECTED_POS_ON_VIEWPORT");const Xh=vt&&0!==h.paint.get(x?"text-halo-width":"icon-halo-width").constantOr(1);let il;il=vt?pt.iconsInText?Xr(Bt.kind,Vt,J,le,g,Yi,ro,is,In,gi,nt,pr,Pe,Rr,nr,pt.getProjection()):Ja(Bt.kind,Vt,J,le,g,Yi,ro,is,x,In,!0,nt,pr,Pe,Rr,nr,pt.getProjection()):yo(Bt.kind,Vt,J,le,g,Yi,ro,is,x,In,nt,pr,Pe,Rr,nr,pt.getProjection());const Tl={program:g.useProgram(Nc(vt,x,pt),it,vs),buffers:Nt,uniformValues:il,atlasTexture:zn,atlasTextureIcon:oi,atlasInterpolation:bn,atlasInterpolationIcon:An,isSDF:vt,hasHalo:Xh,tile:St,labelPlaneMatrixInv:io};if(pe&&pt.canOverlap){ge=!0;const El=Nt.segments.get();for(const Dl of El)He.push({segments:new p.SegmentVector([Dl]),sortKey:Dl.sortKey,state:Tl})}else He.push({segments:Nt.segments,sortKey:0,state:Tl})}ge&&He.sort((nt,St)=>nt.sortKey-St.sortKey);for(const nt of He){const St=nt.state;if(g.terrain&&g.terrain.setupElevationDraw(St.tile,St.program,{useDepthForOcclusion:!We,labelPlaneMatrixInv:St.labelPlaneMatrixInv}),Y.activeTexture.set(ee.TEXTURE0),St.atlasTexture.bind(St.atlasInterpolation,ee.CLAMP_TO_EDGE),St.atlasTextureIcon&&(Y.activeTexture.set(ee.TEXTURE1),St.atlasTextureIcon&&St.atlasTextureIcon.bind(St.atlasInterpolationIcon,ee.CLAMP_TO_EDGE)),St.isSDF){const pt=St.uniformValues;St.hasHalo&&(pt.u_is_halo=1,_s(St.buffers,nt.segments,h,g,St.program,Fe,F,j,pt)),pt.u_is_halo=0}_s(St.buffers,nt.segments,h,g,St.program,Fe,F,j,St.uniformValues)}}function _s(g,c,h,_,x,S,D,I,R){const O=_.context,F=[g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer,g.globeExtVertexBuffer];x.draw(O,O.gl.TRIANGLES,S,D,I,p.CullFaceMode.disabled,R,h.id,g.layoutVertexBuffer,g.indexBuffer,c,h.paint,_.transform.zoom,g.programConfigurations.get(h.id),F)}function zc(g,c,h,_,x,S,D){const I=g.context.gl,R=h.paint.get("fill-pattern"),O=R&&R.constantOr(1);let F,j,Y,ee,se;D?(j=O&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",F=I.LINES):(j=O?"fillPattern":"fill",F=I.TRIANGLES);for(const ie of _){const le=c.getTile(ie);if(O&&!le.patternsLoaded())continue;const U=le.getBucket(h);if(!U)continue;g.prepareDrawTile();const J=U.programConfigurations.get(h.id),pe=g.useProgram(j,J);O&&(g.context.activeTexture.set(I.TEXTURE0),le.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),J.updatePaintBuffers());const ge=R.constantOr(null);if(ge&&le.imageAtlas){const Pe=le.imageAtlas.patternPositions[ge.toString()];Pe&&J.setConstantPatternPositions(Pe)}const Fe=g.translatePosMatrix(ie.projMatrix,le,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(D){ee=U.indexBuffer2,se=U.segments2;const Pe=g.terrain&&g.terrain.renderingToTexture?g.terrain.drapeBufferSize:[I.drawingBufferWidth,I.drawingBufferHeight];Y="fillOutlinePattern"===j&&O?gs(Fe,g,le,Pe):ms(Fe,Pe)}else ee=U.indexBuffer,se=U.segments,Y=O?hr(Fe,g,le):_o(Fe);g.prepareDrawProgram(g.context,pe,ie.toUnwrapped()),pe.draw(g.context,F,x,g.stencilModeForClipping(ie),S,p.CullFaceMode.disabled,Y,h.id,U.layoutVertexBuffer,ee,se,h.paint,g.transform.zoom,J)}}function wd(g,c,h,_,x,S,D){const I=g.context,R=I.gl,O=g.transform,F=h.paint.get("fill-extrusion-pattern"),j=F.constantOr(1),Y=h.paint.get("fill-extrusion-opacity"),ee=[h.paint.get("fill-extrusion-ambient-occlusion-intensity"),h.paint.get("fill-extrusion-ambient-occlusion-radius")],se=h.layout.get("fill-extrusion-edge-radius"),ie=se>0&&!h.paint.get("fill-extrusion-rounded-roof"),le=ie?0:se,U="globe"===O.projection.name?p.fillExtrusionHeightLift():0,J="globe"===O.projection.name,pe=J?p.globeToMercatorTransition(O.zoom):0,ge=[p.mercatorXfromLng(O.center.lng),p.mercatorYfromLat(O.center.lat)],Fe=[];J&&Fe.push("PROJECTION_GLOBE_VIEW"),ee[0]>0&&Fe.push("FAUX_AO"),ie&&Fe.push("ZERO_ROOF_RADIUS");for(const Pe of _){const Oe=c.getTile(Pe),We=Oe.getBucket(h);if(!We||We.projection.name!==O.projection.name)continue;const He=We.programConfigurations.get(h.id),ot=g.useProgram(j?"fillExtrusionPattern":"fillExtrusion",He,Fe);if(g.terrain){const vt=g.terrain;if(g.style.terrainSetForDrapingOnly())vt.setupElevationDraw(Oe,ot,{useMeterToDem:!0});else{if(!We.enableTerrain)continue;if(vt.setupElevationDraw(Oe,ot,{useMeterToDem:!0}),Or(I,c,Pe,We,h,vt),!We.centroidVertexBuffer){const Bt=ot.attributes.a_centroid_pos;void 0!==Bt&&R.vertexAttrib2f(Bt,0,0)}}}j&&(g.context.activeTexture.set(R.TEXTURE0),Oe.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),He.updatePaintBuffers());const Ft=F.constantOr(null);if(Ft&&Oe.imageAtlas){const vt=Oe.imageAtlas.patternPositions[Ft.toString()];vt&&He.setConstantPatternPositions(vt)}const nt=g.translatePosMatrix(Pe.projMatrix,Oe,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),St=O.projection.createInversionMatrix(O,Pe.canonical),pt=h.paint.get("fill-extrusion-vertical-gradient"),Nt=j?Lt(nt,g,pt,Y,ee,le,Pe,Oe,U,pe,ge,St):Rh(nt,g,pt,Y,ee,le,Pe,U,pe,ge,St);g.prepareDrawProgram(I,ot,Pe.toUnwrapped());const it=[];g.terrain&&it.push(We.centroidVertexBuffer),J&&it.push(We.layoutVertexExtBuffer),ot.draw(I,I.gl.TRIANGLES,x,S,D,p.CullFaceMode.backCCW,Nt,h.id,We.layoutVertexBuffer,We.indexBuffer,We.segments,h.paint,g.transform.zoom,He,it)}}function Or(g,c,h,_,x,S){const D=[U=>{let J=U.canonical.x-1,pe=U.wrap;return J<0&&(J=(1<<U.canonical.z)-1,pe--),new p.OverscaledTileID(U.overscaledZ,pe,U.canonical.z,J,U.canonical.y)},U=>{let J=U.canonical.x+1,pe=U.wrap;return J===1<<U.canonical.z&&(J=0,pe++),new p.OverscaledTileID(U.overscaledZ,pe,U.canonical.z,J,U.canonical.y)},U=>new p.OverscaledTileID(U.overscaledZ,U.wrap,U.canonical.z,U.canonical.x,(0===U.canonical.y?1<<U.canonical.z:U.canonical.y)-1),U=>new p.OverscaledTileID(U.overscaledZ,U.wrap,U.canonical.z,U.canonical.x,U.canonical.y===(1<<U.canonical.z)-1?0:U.canonical.y+1)],I=U=>{const J=c.getSource().minzoom,pe=Fe=>{const Pe=c.getTileByID(Fe);if(Pe&&Pe.hasData())return Pe.getBucket(x)},ge=[0,-1,1];for(const Fe of ge){if(U.overscaledZ+Fe<J)continue;const Pe=pe(U.calculateScaledKey(U.overscaledZ+Fe));if(Pe)return Pe}},R=[0,0,0],O=(U,J)=>(R[0]=Math.min(U.min.y,J.min.y),R[1]=Math.max(U.max.y,J.max.y),R[2]=p.EXTENT-J.min.x>U.max.x?J.min.x-p.EXTENT:U.max.x,R),F=(U,J)=>(R[0]=Math.min(U.min.x,J.min.x),R[1]=Math.max(U.max.x,J.max.x),R[2]=p.EXTENT-J.min.y>U.max.y?J.min.y-p.EXTENT:U.max.y,R),j=[(U,J)=>O(U,J),(U,J)=>O(J,U),(U,J)=>F(U,J),(U,J)=>F(J,U)],Y=new p.Point(0,0);let ee,se,ie;const le=(U,J,pe,ge,Fe)=>{const Pe=[[ge?pe:U,ge?U:pe,0],[ge?pe:J,ge?J:pe,0]],Oe=Fe<0?p.EXTENT+Fe:Fe,We=[ge?Oe:(U+J)/2,ge?(U+J)/2:Oe,0];return 0===pe&&Fe<0||0!==pe&&Fe>0?S.getForTilePoints(ie,[We],!0,se):Pe.push(We),S.getForTilePoints(h,Pe,!0,ee),Math.max(Pe[0][2],Pe[1][2],We[2])/S.exaggeration()};for(let U=0;U<4;U++){const J=(U<2?1:5)-U,pe=_.borders[U];if(0===pe.length)continue;const ge=ie=D[U](h),Fe=I(ge);if(!(Fe&&Fe instanceof p.FillExtrusionBucket&&Fe.enableTerrain)||_.borderDoneWithNeighborZ[U]===Fe.canonical.z&&Fe.borderDoneWithNeighborZ[J]===_.canonical.z||(se=S.findDEMTileFor(ge),!se||!se.dem))continue;if(!ee){const He=S.findDEMTileFor(h);if(!He||!He.dem)return;ee=He}const Pe=Fe.borders[J];let Oe=0;const We=Fe.borderDoneWithNeighborZ[J]!==_.canonical.z;if(_.canonical.z===Fe.canonical.z){for(let He=0;He<pe.length;He++){const ot=_.featuresOnBorder[pe[He]],Ft=ot.borders[U];let nt;for(;Oe<Pe.length&&(nt=Fe.featuresOnBorder[Pe[Oe]],!(nt.borders[J][1]>Ft[0]+3));)We&&Fe.encodeCentroid(void 0,nt,!1),Oe++;if(nt&&Oe<Pe.length){const St=Oe;let pt=0;for(;!(nt.borders[J][0]>Ft[1]-3)&&(pt++,++Oe!==Pe.length);)nt=Fe.featuresOnBorder[Pe[Oe]];if(nt=Fe.featuresOnBorder[Pe[St]],ot.intersectsCount()>1||nt.intersectsCount()>1||1!==pt){1!==pt&&(Oe=St),_.encodeCentroid(void 0,ot,!1),We&&Fe.encodeCentroid(void 0,nt,!1);continue}const Nt=j[U](ot,nt),it=U%2?p.EXTENT-1:0;Y.x=le(Nt[0],Math.min(p.EXTENT-1,Nt[1]),it,U<2,Nt[2]),Y.y=0,_.encodeCentroid(Y,ot,!1),We&&Fe.encodeCentroid(Y,nt,!1)}else _.encodeCentroid(void 0,ot,!1)}_.borderDoneWithNeighborZ[U]=Fe.canonical.z,_.needsCentroidUpdate=!0,We&&(Fe.borderDoneWithNeighborZ[J]=_.canonical.z,Fe.needsCentroidUpdate=!0)}else{for(const He of pe)_.encodeCentroid(void 0,_.featuresOnBorder[He],!1);if(We){for(const He of Pe)Fe.encodeCentroid(void 0,Fe.featuresOnBorder[He],!1);Fe.borderDoneWithNeighborZ[J]=_.canonical.z,Fe.needsCentroidUpdate=!0}_.borderDoneWithNeighborZ[U]=Fe.canonical.z,_.needsCentroidUpdate=!0}}(_.needsCentroidUpdate||!_.centroidVertexBuffer&&0!==_.centroidVertexArray.length)&&_.uploadCentroid(g)}const vu=new p.Color(1,0,0,1),r_=new p.Color(0,1,0,1),Ps=new p.Color(0,0,1,1),Ea=new p.Color(1,0,1,1),Kp=new p.Color(0,1,1,1);function Lh(g,c,h){const _=g.context,x=g.transform,S=_.gl,D="globe"===x.projection.name,I=D?["PROJECTION_GLOBE_VIEW"]:null;let R=h.projMatrix;if(D&&p.globeToMercatorTransition(x.zoom)>0){const ot=p.transitionTileAABBinECEF(h.canonical,x),Ft=p.globeDenormalizeECEF(ot);R=p.multiply(new Float32Array(16),x.globeMatrix,Ft),p.multiply(R,x.projMatrix,R)}const O=g.useProgram("debug",null,I),F=c.getTileByID(h.key);g.terrain&&g.terrain.setupElevationDraw(F,O);const j=p.DepthMode.disabled,Y=p.StencilMode.disabled,ee=g.colorModeForRenderPass();_.activeTexture.set(S.TEXTURE0),g.emptyTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),D?F._makeGlobeTileDebugBuffers(g.context,x):F._makeDebugTileBoundsBuffers(g.context,x.projection);const ie=F._tileDebugBuffer||g.debugBuffer,le=F._tileDebugIndexBuffer||g.debugIndexBuffer,U=F._tileDebugSegments||g.debugSegments;O.draw(_,S.LINE_STRIP,j,Y,ee,p.CullFaceMode.disabled,Ql(R,p.Color.red),"$debug",ie,le,U,null,null,null,[F._globeTileDebugBorderBuffer]);const J=F.latestRawTileData,pe=Math.floor((J&&J.byteLength||0)/1024),ge=c.getTile(h).tileSize,Fe=512/Math.min(ge,512)*(h.overscaledZ/x.zoom)*.5;let Pe=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(Pe+=` => ${h.overscaledZ}`),Pe+=` ${pe}kb`,function(ot,Ft){ot.initDebugOverlayCanvas();const nt=ot.debugOverlayCanvas,St=ot.context.gl,pt=ot.debugOverlayCanvas.getContext("2d");pt.clearRect(0,0,nt.width,nt.height),pt.shadowColor="white",pt.shadowBlur=2,pt.lineWidth=1.5,pt.strokeStyle="white",pt.textBaseline="top",pt.font="bold 36px Open Sans, sans-serif",pt.fillText(Ft,5,5),pt.strokeText(Ft,5,5),ot.debugOverlayTexture.update(nt),ot.debugOverlayTexture.bind(St.LINEAR,St.CLAMP_TO_EDGE)}(g,Pe);const Oe=F._tileDebugTextBuffer||g.debugBuffer,We=F._tileDebugTextIndexBuffer||g.quadTriangleIndexBuffer,He=F._tileDebugTextSegments||g.debugSegments;O.draw(_,S.TRIANGLES,j,Y,p.ColorMode.alphaBlended,p.CullFaceMode.disabled,Ql(R,p.Color.transparent,Fe),"$debug",Oe,We,He,null,null,null,[F._globeTileDebugTextBuffer])}function Sd(g,c,h,_){xu(g,0,c+h/2,g.transform.width,h,_)}function Ls(g,c,h,_){xu(g,c-h/2,0,h,g.transform.height,_)}function xu(g,c,h,_,x,S){const D=g.context,I=D.gl;I.enable(I.SCISSOR_TEST),I.scissor(c*p.exported.devicePixelRatio,h*p.exported.devicePixelRatio,_*p.exported.devicePixelRatio,x*p.exported.devicePixelRatio),D.clear({color:S}),I.disable(I.SCISSOR_TEST)}const o_=p.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Hm}=o_;function Sl(g,c,h,_){g.emplaceBack(c,h,_)}class Qp{constructor(c){this.vertexArray=new p.StructArrayLayout3f12,this.indices=new p.StructArrayLayout3ui6,Sl(this.vertexArray,-1,-1,1),Sl(this.vertexArray,1,-1,1),Sl(this.vertexArray,-1,1,1),Sl(this.vertexArray,1,1,1),Sl(this.vertexArray,-1,-1,-1),Sl(this.vertexArray,1,-1,-1),Sl(this.vertexArray,-1,1,-1),Sl(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=c.createVertexBuffer(this.vertexArray,Hm),this.indexBuffer=c.createIndexBuffer(this.indices),this.segment=p.SegmentVector.simpleSegment(0,0,36,12)}}function Da(g,c,h,_,x,S){const D=g.gl,I=c.paint.get("sky-atmosphere-color"),R=c.paint.get("sky-atmosphere-halo-color"),O=c.paint.get("sky-atmosphere-sun-intensity"),F={u_matrix_3f:p.fromMat4(p.create$1(),_),u_sun_direction:x,u_sun_intensity:O,u_color_tint_r:[(se=I).r,se.g,se.b,se.a],u_color_tint_m:[(ie=R).r,ie.g,ie.b,ie.a],u_luminance:5e-5};var se,ie;D.framebufferTexture2D(D.FRAMEBUFFER,D.COLOR_ATTACHMENT0,D.TEXTURE_CUBE_MAP_POSITIVE_X+S,c.skyboxTexture,0),h.draw(g,D.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,p.ColorMode.unblended,p.CullFaceMode.frontCW,F,"skyboxCapture",c.skyboxGeometry.vertexBuffer,c.skyboxGeometry.indexBuffer,c.skyboxGeometry.segment)}const Oh=p.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class s_{constructor(c){const h=new p.StructArrayLayout5f20;h.emplaceBack(-1,1,1,0,0),h.emplaceBack(1,1,1,1,0),h.emplaceBack(1,-1,1,1,1),h.emplaceBack(-1,-1,1,0,1);const _=new p.StructArrayLayout3ui6;_.emplaceBack(0,1,2),_.emplaceBack(2,3,0),this.vertexBuffer=c.createVertexBuffer(h,Oh.members),this.indexBuffer=c.createIndexBuffer(_),this.segments=p.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const wu={symbol:function(g,c,h,_,x){if("translucent"!==g.renderPass)return;const S=p.StencilMode.disabled,D=g.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(I,R,O,F,j,Y,ee){const se=R.transform,ie="map"===j,le="map"===Y;for(const U of I){const J=F.getTile(U),pe=J.getBucket(O);if(!pe||!pe.text||!pe.text.segments.get().length)continue;const ge=p.evaluateSizeForZoom(pe.textSizeData,se.zoom),Fe=Ur(U,pe.getProjection(),se),Pe=se.calculatePixelsToTileUnitsMatrix(J),Oe=bt(Fe,J.tileID.canonical,le,ie,se,pe.getProjection(),Pe),We="none"!==O.layout.get("icon-text-fit")&&pe.hasIconData();if(ge){const He=Math.pow(2,se.zoom-J.tileID.overscaledZ);ts(pe,ie,le,ee,p.symbolSize,se,Oe,U,He,ge,We)}}}(_,g,h,c,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),x),0!==h.paint.get("icon-opacity").constantOr(1)&&Bc(g,c,h,_,!1,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),h.layout.get("icon-rotation-alignment"),h.layout.get("icon-pitch-alignment"),h.layout.get("icon-keep-upright"),S,D),0!==h.paint.get("text-opacity").constantOr(1)&&Bc(g,c,h,_,!0,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),h.layout.get("text-keep-upright"),S,D),c.map.showCollisionBoxes&&(el(g,c,h,_,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),el(g,c,h,_,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(g,c,h,_){if("translucent"!==g.renderPass)return;const x=h.paint.get("circle-opacity"),S=h.paint.get("circle-stroke-width"),D=h.paint.get("circle-stroke-opacity"),I=void 0!==h.layout.get("circle-sort-key").constantOr(1);if(0===x.constantOr(1)&&(0===S.constantOr(1)||0===D.constantOr(1)))return;const R=g.context,O=R.gl,F=g.transform,j=g.depthModeForSublayer(0,p.DepthMode.ReadOnly),Y=p.StencilMode.disabled,ee=g.colorModeForRenderPass(),se="globe"===F.projection.name,ie=[p.mercatorXfromLng(F.center.lng),p.mercatorYfromLat(F.center.lat)],le=[];for(let J=0;J<_.length;J++){const pe=_[J],ge=c.getTile(pe),Fe=ge.getBucket(h);if(!Fe||Fe.projection.name!==F.projection.name)continue;const Pe=Fe.programConfigurations.get(h.id),Oe=yu(h);se&&Oe.push("PROJECTION_GLOBE_VIEW");const We=g.useProgram("circle",Pe,Oe),He=Fe.layoutVertexBuffer,ot=Fe.globeExtVertexBuffer,Ft=Fe.indexBuffer,nt=F.projection.createInversionMatrix(F,pe.canonical),St={programConfiguration:Pe,program:We,layoutVertexBuffer:He,globeExtVertexBuffer:ot,indexBuffer:Ft,uniformValues:bs(g,pe,ge,nt,ie,h),tile:ge};if(I){const pt=Fe.segments.get();for(const Nt of pt)le.push({segments:new p.SegmentVector([Nt]),sortKey:Nt.sortKey,state:St})}else le.push({segments:Fe.segments,sortKey:0,state:St})}I&&le.sort((J,pe)=>J.sortKey-pe.sortKey);const U={useDepthForOcclusion:!se};for(const J of le){const{programConfiguration:pe,program:ge,layoutVertexBuffer:Fe,globeExtVertexBuffer:Pe,indexBuffer:Oe,uniformValues:We,tile:He}=J.state,ot=J.segments;g.terrain&&g.terrain.setupElevationDraw(He,ge,U),g.prepareDrawProgram(R,ge,He.tileID.toUnwrapped()),ge.draw(R,O.TRIANGLES,j,Y,ee,p.CullFaceMode.disabled,We,h.id,Fe,Oe,ot,h.paint,F.zoom,pe,[Pe])}},heatmap:function(g,c,h,_){if(0!==h.paint.get("heatmap-opacity"))if("offscreen"===g.renderPass){const x=g.context,S=x.gl,D=p.StencilMode.disabled,I=new p.ColorMode([S.ONE,S.ONE],p.Color.transparent,[!0,!0,!0,!0]);(function(ee,se,ie,le){const U=ee.gl,J=se.width*le,pe=se.height*le;ee.activeTexture.set(U.TEXTURE1),ee.viewport.set([0,0,J,pe]);let ge=ie.heatmapFbo;if(!ge||ge&&(ge.width!==J||ge.height!==pe)){ge&&ge.destroy();const Fe=U.createTexture();U.bindTexture(U.TEXTURE_2D,Fe),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MIN_FILTER,U.LINEAR),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MAG_FILTER,U.LINEAR),ge=ie.heatmapFbo=ee.createFramebuffer(J,pe,!1),function(Pe,Oe,We,He,ot,Ft){const nt=Pe.gl;nt.texImage2D(nt.TEXTURE_2D,0,Pe.isWebGL2&&Pe.extRenderToTextureHalfFloat?nt.RGBA16F:nt.RGBA,ot,Ft,0,nt.RGBA,Pe.extRenderToTextureHalfFloat?Pe.isWebGL2?nt.HALF_FLOAT:Pe.extTextureHalfFloat.HALF_FLOAT_OES:nt.UNSIGNED_BYTE,null),He.colorAttachment.set(We)}(ee,0,Fe,ge,J,pe)}else U.bindTexture(U.TEXTURE_2D,ge.colorAttachment.get()),ee.bindFramebuffer.set(ge.framebuffer)})(x,g,h,"globe"===g.transform.projection.name?.5:.25),x.clear({color:p.Color.transparent});const R=g.transform,O="globe"===R.projection.name,F=O?["PROJECTION_GLOBE_VIEW"]:null,j=O?p.CullFaceMode.frontCCW:p.CullFaceMode.disabled,Y=[p.mercatorXfromLng(R.center.lng),p.mercatorYfromLat(R.center.lat)];for(let ee=0;ee<_.length;ee++){const se=_[ee];if(c.hasRenderableParent(se))continue;const ie=c.getTile(se),le=ie.getBucket(h);if(!le||le.projection.name!==R.projection.name)continue;const U=le.programConfigurations.get(h.id),J=g.useProgram("heatmap",U,F),{zoom:pe}=g.transform;g.terrain&&g.terrain.setupElevationDraw(ie,J),g.prepareDrawProgram(x,J,se.toUnwrapped());const ge=R.projection.createInversionMatrix(R,se.canonical);J.draw(x,S.TRIANGLES,p.DepthMode.disabled,D,I,j,Jl(g,se,ie,ge,Y,pe,h.paint.get("heatmap-intensity")),h.id,le.layoutVertexBuffer,le.indexBuffer,le.segments,h.paint,g.transform.zoom,U,O?[le.globeExtVertexBuffer]:null)}x.viewport.set([0,0,g.width,g.height])}else"translucent"===g.renderPass&&(g.context.setColorMode(g.colorModeForRenderPass()),function(x,S){const D=x.context,I=D.gl,R=S.heatmapFbo;if(!R)return;D.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,R.colorAttachment.get()),D.activeTexture.set(I.TEXTURE1);let O=S.colorRampTexture;O||(O=S.colorRampTexture=new p.Texture(D,S.colorRamp,I.RGBA)),O.bind(I.LINEAR,I.CLAMP_TO_EDGE),x.useProgram("heatmapTexture").draw(D,I.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,x.colorModeForRenderPass(),p.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:S.paint.get("heatmap-opacity")},S.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments,S.paint,x.transform.zoom)}(g,h))},line:function(g,c,h,_){if("translucent"!==g.renderPass)return;const x=h.paint.get("line-opacity"),S=h.paint.get("line-width");if(0===x.constantOr(1)||0===S.constantOr(1))return;const D=g.depthModeForSublayer(0,p.DepthMode.ReadOnly),I=g.colorModeForRenderPass(),R=g.terrain&&g.terrain.renderingToTexture?1:p.exported.devicePixelRatio,O=h.paint.get("line-dasharray"),F=O.constantOr(1),j=h.layout.get("line-cap"),Y=h.paint.get("line-pattern"),ee=Y.constantOr(1),se=h.paint.get("line-gradient"),ie=ee?"linePattern":"line",le=g.context,U=le.gl,J=(ge=>{const Fe=[];ui(ge)&&Fe.push("RENDER_LINE_DASH"),ge.paint.get("line-gradient")&&Fe.push("RENDER_LINE_GRADIENT");const Pe=ge.paint.get("line-trim-offset");0===Pe[0]&&0===Pe[1]||Fe.push("RENDER_LINE_TRIM_OFFSET");const Oe=ge.paint.get("line-pattern").constantOr(1),We=1!==ge.paint.get("line-opacity").constantOr(1);return!Oe&&We&&Fe.push("RENDER_LINE_ALPHA_DISCARD"),Fe})(h);let pe=J.includes("RENDER_LINE_ALPHA_DISCARD");g.terrain&&g.terrain.clipOrMaskOverlapStencilType()&&(pe=!1);for(const ge of _){const Fe=c.getTile(ge);if(ee&&!Fe.patternsLoaded())continue;const Pe=Fe.getBucket(h);if(!Pe)continue;g.prepareDrawTile();const Oe=Pe.programConfigurations.get(h.id),We=g.useProgram(ie,Oe,J),He=Y.constantOr(null);if(He&&Fe.imageAtlas){const vt=Fe.imageAtlas.patternPositions[He.toString()];vt&&Oe.setConstantPatternPositions(vt)}const ot=O.constantOr(null),Ft=j.constantOr(null);if(!ee&&ot&&Ft&&Fe.lineAtlas){const vt=Fe.lineAtlas.getDash(ot,Ft);vt&&Oe.setConstantPatternPositions(vt)}let[nt,St]=h.paint.get("line-trim-offset");("round"===Ft||"square"===Ft)&&nt!==St&&(0===nt&&(nt-=1),1===St&&(St+=1));const pt=g.terrain?ge.projMatrix:null,Nt=ee?vd(g,Fe,h,pt,R):es(g,Fe,h,pt,Pe.lineClipsArray.length,R,[nt,St]);if(se){const vt=Pe.gradients[h.id];let Bt=vt.texture;if(h.gradientVersion!==vt.version){let Mt=256;if(h.stepInterpolant){const Vt=c.getSource().maxzoom,In=ge.canonical.z===Vt?Math.ceil(1<<g.transform.maxZoom-ge.canonical.z):1;Mt=p.clamp(p.nextPowerOfTwo(Pe.maxLineLength/p.EXTENT*1024*In),256,le.maxTextureSize)}vt.gradient=p.renderColorRamp({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:Mt,image:vt.gradient||void 0,clips:Pe.lineClipsArray}),vt.texture?vt.texture.update(vt.gradient):vt.texture=new p.Texture(le,vt.gradient,U.RGBA),vt.version=h.gradientVersion,Bt=vt.texture}le.activeTexture.set(U.TEXTURE1),Bt.bind(h.stepInterpolant?U.NEAREST:U.LINEAR,U.CLAMP_TO_EDGE)}F&&(le.activeTexture.set(U.TEXTURE0),Fe.lineAtlasTexture.bind(U.LINEAR,U.REPEAT),Oe.updatePaintBuffers()),ee&&(le.activeTexture.set(U.TEXTURE0),Fe.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),Oe.updatePaintBuffers()),g.prepareDrawProgram(le,We,ge.toUnwrapped());const it=vt=>{We.draw(le,U.TRIANGLES,D,vt,I,p.CullFaceMode.disabled,Nt,h.id,Pe.layoutVertexBuffer,Pe.indexBuffer,Pe.segments,h.paint,g.transform.zoom,Oe,[Pe.layoutVertexBuffer2])};if(pe){const vt=g.stencilModeForClipping(ge).ref;0===vt&&g.terrain&&le.clear({stencil:0});const Bt={func:U.EQUAL,mask:255};Nt.u_alpha_discard_threshold=.8,it(new p.StencilMode(Bt,vt,255,U.KEEP,U.KEEP,U.INVERT)),Nt.u_alpha_discard_threshold=0,it(new p.StencilMode(Bt,vt,255,U.KEEP,U.KEEP,U.KEEP))}else it(g.stencilModeForClipping(ge))}pe&&(g.resetStencilClippingMasks(),g.terrain&&le.clear({stencil:0}))},fill:function(g,c,h,_){const x=h.paint.get("fill-color"),S=h.paint.get("fill-opacity");if(0===S.constantOr(1))return;const D=g.colorModeForRenderPass(),I=h.paint.get("fill-pattern"),R=g.opaquePassEnabledForLayer()&&!I.constantOr(1)&&1===x.constantOr(p.Color.transparent).a&&1===S.constantOr(0)?"opaque":"translucent";if(g.renderPass===R){const O=g.depthModeForSublayer(1,"opaque"===g.renderPass?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly);zc(g,c,h,_,O,D,!1)}if("translucent"===g.renderPass&&h.paint.get("fill-antialias")){const O=g.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,p.DepthMode.ReadOnly);zc(g,c,h,_,O,D,!0)}},"fill-extrusion":function(g,c,h,_){const x=h.paint.get("fill-extrusion-opacity");if(0!==x&&"translucent"===g.renderPass){const S=new p.DepthMode(g.context.gl.LEQUAL,p.DepthMode.ReadWrite,g.depthRangeFor3D);if(1!==x||h.paint.get("fill-extrusion-pattern").constantOr(1))wd(g,c,h,_,S,p.StencilMode.disabled,p.ColorMode.disabled),wd(g,c,h,_,S,g.stencilModeFor3D(),g.colorModeForRenderPass()),g.resetStencilClippingMasks();else{const D=g.colorModeForRenderPass();wd(g,c,h,_,S,p.StencilMode.disabled,D)}}},hillshade:function(g,c,h,_){if("offscreen"!==g.renderPass&&"translucent"!==g.renderPass)return;const x=g.context,S=g.depthModeForSublayer(0,p.DepthMode.ReadOnly),D=g.colorModeForRenderPass(),I=g.terrain&&g.terrain.renderingToTexture,[R,O]="translucent"!==g.renderPass||I?[{},_]:g.stencilConfigForOverlap(_);for(const F of O){const j=c.getTile(F);if(j.needsHillshadePrepare&&"offscreen"===g.renderPass)Lr(g,j,h,S,p.StencilMode.disabled,D);else if("translucent"===g.renderPass){const Y=I&&g.terrain?g.terrain.stencilModeForRTTOverlap(F):R[F.overscaledZ];i_(g,F,j,h,S,Y,D)}}x.viewport.set([0,0,g.width,g.height]),g.resetStencilClippingMasks()},raster:function(g,c,h,_,x,S){if("translucent"!==g.renderPass||0===h.paint.get("raster-opacity")||!_.length)return;const D=g.context,I=D.gl,R=c.getSource(),O=g.useProgram("raster"),F=g.colorModeForRenderPass(),j=g.terrain&&g.terrain.renderingToTexture,[Y,ee]=R instanceof pi||j?[{},_]:g.stencilConfigForOverlap(_),se=ee[ee.length-1].overscaledZ,ie=!g.options.moving;for(const le of ee){const U=j?p.DepthMode.disabled:g.depthModeForSublayer(le.overscaledZ-se,1===h.paint.get("raster-opacity")?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly,I.LESS),J=le.toUnwrapped(),pe=c.getTile(le);if(j&&(!pe||!pe.hasData()))continue;const ge=j?le.projMatrix:g.transform.calculateProjMatrix(J,ie),Fe=g.terrain&&j?g.terrain.stencilModeForRTTOverlap(le):Y[le.overscaledZ],Pe=S?0:h.paint.get("raster-fade-duration");pe.registerFadeDuration(Pe);const Oe=c.findLoadedParent(le,0),We=Lc(pe,Oe,c,g.transform,Pe);let He,ot;g.terrain&&g.terrain.prepareDrawTile();const Ft="nearest"===h.paint.get("raster-resampling")?I.NEAREST:I.LINEAR;D.activeTexture.set(I.TEXTURE0),pe.texture.bind(Ft,I.CLAMP_TO_EDGE),D.activeTexture.set(I.TEXTURE1),Oe?(Oe.texture.bind(Ft,I.CLAMP_TO_EDGE),He=Math.pow(2,Oe.tileID.overscaledZ-pe.tileID.overscaledZ),ot=[pe.tileID.canonical.x*He%1,pe.tileID.canonical.y*He%1]):pe.texture.bind(Ft,I.CLAMP_TO_EDGE),pe.texture.useMipmap&&D.extTextureFilterAnisotropic&&g.transform.pitch>20&&I.texParameterf(I.TEXTURE_2D,D.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,D.extTextureFilterAnisotropicMax);const nt=Br(ge,ot||[0,0],He||1,We,h,R instanceof pi?R.perspectiveTransform:[0,0]);if(g.prepareDrawProgram(D,O,J),R instanceof pi)R.boundsBuffer&&R.boundsSegments&&O.draw(D,I.TRIANGLES,U,p.StencilMode.disabled,F,p.CullFaceMode.disabled,nt,h.id,R.boundsBuffer,g.quadTriangleIndexBuffer,R.boundsSegments);else{const{tileBoundsBuffer:St,tileBoundsIndexBuffer:pt,tileBoundsSegments:Nt}=g.getTileBoundsBuffers(pe);O.draw(D,I.TRIANGLES,U,Fe,F,p.CullFaceMode.disabled,nt,h.id,St,pt,Nt)}}g.resetStencilClippingMasks()},background:function(g,c,h,_){const x=h.paint.get("background-color"),S=h.paint.get("background-opacity");if(0===S)return;const D=g.context,I=D.gl,R=g.transform,O=R.tileSize,F=h.paint.get("background-pattern");if(g.isPatternMissing(F))return;const j=!F&&1===x.a&&1===S&&g.opaquePassEnabledForLayer()?"opaque":"translucent";if(g.renderPass!==j)return;const Y=p.StencilMode.disabled,ee=g.depthModeForSublayer(0,"opaque"===j?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly),se=g.colorModeForRenderPass(),ie=g.useProgram(F?"backgroundPattern":"background");let le,U=_;U||(le=g.getBackgroundTiles(),U=Object.values(le).map(J=>J.tileID)),F&&(D.activeTexture.set(I.TEXTURE0),g.imageManager.bind(g.context));for(const J of U){const pe=J.toUnwrapped(),ge=_?J.projMatrix:g.transform.calculateProjMatrix(pe);g.prepareDrawTile();const Fe=c?c.getTile(J):le?le[J.key]:new p.Tile(J,O,R.zoom,g),Pe=F?xd(ge,S,g,F,{tileID:J,tileSize:O}):Oc(ge,S,x);g.prepareDrawProgram(D,ie,pe);const{tileBoundsBuffer:Oe,tileBoundsIndexBuffer:We,tileBoundsSegments:He}=g.getTileBoundsBuffers(Fe);ie.draw(D,I.TRIANGLES,ee,Y,se,p.CullFaceMode.disabled,Pe,h.id,Oe,We,He)}},sky:function(g,c,h){const _=g.transform,x="mercator"===_.projection.name||"globe"===_.projection.name?1:p.smoothstep(7,8,_.zoom),S=h.paint.get("sky-opacity")*x;if(0===S)return;const D=g.context,I=h.paint.get("sky-type"),R=new p.DepthMode(D.gl.LEQUAL,p.DepthMode.ReadOnly,[0,1]),O=g.frameCounter/1e3%1;"atmosphere"===I?"offscreen"===g.renderPass?h.needsSkyboxCapture(g)&&(function(F,j,Y,ee){const se=F.context,ie=se.gl;let le=j.skyboxFbo;if(!le){le=j.skyboxFbo=se.createFramebuffer(32,32,!1),j.skyboxGeometry=new Qp(se),j.skyboxTexture=se.gl.createTexture(),ie.bindTexture(ie.TEXTURE_CUBE_MAP,j.skyboxTexture),ie.texParameteri(ie.TEXTURE_CUBE_MAP,ie.TEXTURE_WRAP_S,ie.CLAMP_TO_EDGE),ie.texParameteri(ie.TEXTURE_CUBE_MAP,ie.TEXTURE_WRAP_T,ie.CLAMP_TO_EDGE),ie.texParameteri(ie.TEXTURE_CUBE_MAP,ie.TEXTURE_MIN_FILTER,ie.LINEAR),ie.texParameteri(ie.TEXTURE_CUBE_MAP,ie.TEXTURE_MAG_FILTER,ie.LINEAR);for(let ge=0;ge<6;++ge)ie.texImage2D(ie.TEXTURE_CUBE_MAP_POSITIVE_X+ge,0,ie.RGBA,32,32,0,ie.RGBA,ie.UNSIGNED_BYTE,null)}se.bindFramebuffer.set(le.framebuffer),se.viewport.set([0,0,32,32]);const U=j.getCenter(F,!0),J=F.useProgram("skyboxCapture"),pe=new Float64Array(16);p.identity(pe),p.rotateY(pe,pe,.5*-Math.PI),Da(se,j,J,pe,U,0),p.identity(pe),p.rotateY(pe,pe,.5*Math.PI),Da(se,j,J,pe,U,1),p.identity(pe),p.rotateX(pe,pe,.5*-Math.PI),Da(se,j,J,pe,U,2),p.identity(pe),p.rotateX(pe,pe,.5*Math.PI),Da(se,j,J,pe,U,3),p.identity(pe),Da(se,j,J,pe,U,4),p.identity(pe),p.rotateY(pe,pe,Math.PI),Da(se,j,J,pe,U,5),se.viewport.set([0,0,F.width,F.height])}(g,h),h.markSkyboxValid(g)):"sky"===g.renderPass&&function(F,j,Y,ee,se){const ie=F.context,le=ie.gl,U=F.transform,J=F.useProgram("skybox");ie.activeTexture.set(le.TEXTURE0),le.bindTexture(le.TEXTURE_CUBE_MAP,j.skyboxTexture);const pe={u_matrix:U.skyboxMatrix,u_sun_direction:j.getCenter(F,!1),u_cubemap:0,u_opacity:ee,u_temporal_offset:se};F.prepareDrawProgram(ie,J),J.draw(ie,le.TRIANGLES,Y,p.StencilMode.disabled,F.colorModeForRenderPass(),p.CullFaceMode.backCW,pe,"skybox",j.skyboxGeometry.vertexBuffer,j.skyboxGeometry.indexBuffer,j.skyboxGeometry.segment)}(g,h,R,S,O):"gradient"===I&&"sky"===g.renderPass&&function(F,j,Y,ee,se){const ie=F.context,le=ie.gl,U=F.transform,J=F.useProgram("skyboxGradient");j.skyboxGeometry||(j.skyboxGeometry=new Qp(ie)),ie.activeTexture.set(le.TEXTURE0);let pe=j.colorRampTexture;pe||(pe=j.colorRampTexture=new p.Texture(ie,j.colorRamp,le.RGBA)),pe.bind(le.LINEAR,le.CLAMP_TO_EDGE);const ge=(Fe=U.skyboxMatrix,Pe=j.getCenter(F,!1),Oe=j.paint.get("sky-gradient-radius"),We=ee,He=se,{u_matrix:Fe,u_color_ramp:0,u_center_direction:Pe,u_radius:p.degToRad(Oe),u_opacity:We,u_temporal_offset:He});var Fe,Pe,Oe,We,He;F.prepareDrawProgram(ie,J),J.draw(ie,le.TRIANGLES,Y,p.StencilMode.disabled,F.colorModeForRenderPass(),p.CullFaceMode.backCW,ge,"skyboxGradient",j.skyboxGeometry.vertexBuffer,j.skyboxGeometry.indexBuffer,j.skyboxGeometry.segment)}(g,h,R,S,O)},debug:function(g,c,h){for(let _=0;_<h.length;_++)Lh(g,c,h[_])},custom:function(g,c,h,_){const x=g.context,S=h.implementation;if(!g.transform.projection.unsupportedLayers||!g.transform.projection.unsupportedLayers.includes("custom")||g.terrain&&(g.terrain.renderingToTexture||"offscreen"===g.renderPass)&&h.isLayerDraped()){if("offscreen"===g.renderPass){const D=S.prerender;if(D){if(g.setCustomLayerDefaults(),x.setColorMode(g.colorModeForRenderPass()),"globe"===g.transform.projection.name){const I=g.transform.pointMerc;D.call(S,x.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),p.globeToMercatorTransition(g.transform.zoom),[I.x,I.y],g.transform.pixelsPerMeterRatio)}else D.call(S,x.gl,g.transform.customLayerMatrix());x.setDirty(),g.setBaseState()}}else if("translucent"===g.renderPass){if(g.terrain&&g.terrain.renderingToTexture){const I=S.renderToTile;if(I){const R=_[0].canonical,O=new p.MercatorCoordinate(R.x+_[0].wrap*(1<<R.z),R.y,R.z);x.setDepthMode(p.DepthMode.disabled),x.setStencilMode(p.StencilMode.disabled),x.setColorMode(g.colorModeForRenderPass()),g.setCustomLayerDefaults(),I.call(S,x.gl,O),x.setDirty(),g.setBaseState()}return}g.setCustomLayerDefaults(),x.setColorMode(g.colorModeForRenderPass()),x.setStencilMode(p.StencilMode.disabled);const D="3d"===S.renderingMode?new p.DepthMode(g.context.gl.LEQUAL,p.DepthMode.ReadWrite,g.depthRangeFor3D):g.depthModeForSublayer(0,p.DepthMode.ReadOnly);if(x.setDepthMode(D),"globe"===g.transform.projection.name){const I=g.transform.pointMerc;S.render(x.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),p.globeToMercatorTransition(g.transform.zoom),[I.x,I.y],g.transform.pixelsPerMeterRatio)}else S.render(x.gl,g.transform.customLayerMatrix());x.setDirty(),g.setBaseState(),x.bindFramebuffer.set(null)}}else p.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class Cd{constructor(c,h,_=!1){this.context=new Wt(c,_),this.transform=h,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=p.SourceCache.maxUnderzooming+p.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(c,h){const _=!!c&&!!c.terrain&&this.transform.projection.supportsTerrain;if(!(_||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new kh(this,c));const x=this._terrain;this.transform.elevation=_?x:null,x.update(c,this.transform,h)}_updateFog(c){const h=c.fog;if(!h||"globe"===this.transform.projection.name||h.getOpacity(this.transform.pitch)<1||h.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[_,x]=h.getFovAdjustedRange(this.transform._fov);if(_>x)return void(this.transform.fogCullDistSq=null);const S=_+.78*(x-_);this.transform.fogCullDistSq=S*S}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(c,h){if(this.width=c*p.exported.devicePixelRatio,this.height=h*p.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style.order)this.style._layers[_].resize()}setup(){const c=this.context,h=new p.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(p.EXTENT,0),h.emplaceBack(0,p.EXTENT),h.emplaceBack(p.EXTENT,p.EXTENT),this.tileExtentBuffer=c.createVertexBuffer(h,p.posAttributes.members),this.tileExtentSegments=p.SegmentVector.simpleSegment(0,0,4,2);const _=new p.StructArrayLayout2i4;_.emplaceBack(0,0),_.emplaceBack(p.EXTENT,0),_.emplaceBack(0,p.EXTENT),_.emplaceBack(p.EXTENT,p.EXTENT),this.debugBuffer=c.createVertexBuffer(_,p.posAttributes.members),this.debugSegments=p.SegmentVector.simpleSegment(0,0,4,5);const x=new p.StructArrayLayout2i4;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(-1,1),x.emplaceBack(1,1),this.viewportBuffer=c.createVertexBuffer(x,p.posAttributes.members),this.viewportSegments=p.SegmentVector.simpleSegment(0,0,4,2);const S=new p.StructArrayLayout4i8;S.emplaceBack(0,0,0,0),S.emplaceBack(p.EXTENT,0,p.EXTENT,0),S.emplaceBack(0,p.EXTENT,0,p.EXTENT),S.emplaceBack(p.EXTENT,p.EXTENT,p.EXTENT,p.EXTENT),this.mercatorBoundsBuffer=c.createVertexBuffer(S,p.boundsAttributes.members),this.mercatorBoundsSegments=p.SegmentVector.simpleSegment(0,0,4,2);const D=new p.StructArrayLayout3ui6;D.emplaceBack(0,1,2),D.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=c.createIndexBuffer(D);const I=new p.StructArrayLayout1ui2;for(const O of[0,1,3,2,0])I.emplaceBack(O);this.debugIndexBuffer=c.createIndexBuffer(I),this.emptyTexture=new p.Texture(c,new p.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),c.gl.RGBA),this.identityMat=p.create();const R=this.context.gl;this.stencilClearMode=new p.StencilMode({func:R.ALWAYS,mask:0},0,255,R.ZERO,R.ZERO,R.ZERO),this.loadTimeStamps.push(p.window.performance.now()),this.atmosphereBuffer=new s_(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(c){return c._makeTileBoundsBuffers(this.context,this.transform.projection),c._tileBoundsBuffer?{tileBoundsBuffer:c._tileBoundsBuffer,tileBoundsIndexBuffer:c._tileBoundsIndexBuffer,tileBoundsSegments:c._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const c=this.context,h=c.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(c,h.TRIANGLES,p.DepthMode.disabled,this.stencilClearMode,p.ColorMode.disabled,p.CullFaceMode.disabled,Ws(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(c,h,_){if(!h||this.currentStencilSource===h.id||!c.isTileClipped()||!_||0===_.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let I=!1;for(const R of _)if(void 0===this._tileClippingMaskIDs[R.key]){I=!0;break}if(!I)return}this.currentStencilSource=h.id;const x=this.context,S=x.gl;this.nextStencilID+_.length>256&&this.clearStencil(),x.setColorMode(p.ColorMode.disabled),x.setDepthMode(p.DepthMode.disabled);const D=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const I of _){const R=h.getTile(I),O=this._tileClippingMaskIDs[I.key]=this.nextStencilID++,{tileBoundsBuffer:F,tileBoundsIndexBuffer:j,tileBoundsSegments:Y}=this.getTileBoundsBuffers(R);D.draw(x,S.TRIANGLES,p.DepthMode.disabled,new p.StencilMode({func:S.ALWAYS,mask:0},O,255,S.KEEP,S.KEEP,S.REPLACE),p.ColorMode.disabled,p.CullFaceMode.disabled,Ws(I.projMatrix),"$clipping",F,j,Y)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const c=this.nextStencilID++,h=this.context.gl;return new p.StencilMode({func:h.NOTEQUAL,mask:255},c,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(c){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(c);const h=this.context.gl;return new p.StencilMode({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[c.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(c){const h=this.context.gl,_=c.sort((D,I)=>I.overscaledZ-D.overscaledZ),x=_[_.length-1].overscaledZ,S=_[0].overscaledZ-x+1;if(S>1){this.currentStencilSource=void 0,this.nextStencilID+S>256&&this.clearStencil();const D={};for(let I=0;I<S;I++)D[I+x]=new p.StencilMode({func:h.GEQUAL,mask:255},I+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=S,[D,_]}return[{[x]:p.StencilMode.disabled},_]}colorModeForRenderPass(){const c=this.context.gl;return this._showOverdrawInspector?new p.ColorMode([c.CONSTANT_COLOR,c.ONE],new p.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?p.ColorMode.unblended:p.ColorMode.alphaBlended}depthModeForSublayer(c,h,_){if(!this.opaquePassEnabledForLayer())return p.DepthMode.disabled;const x=1-((1+this.currentLayer)*this.numSublayers+c)*this.depthEpsilon;return new p.DepthMode(_||this.context.gl.LEQUAL,h,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(c,h){this.style=c,this.options=h,this.imageManager=c.imageManager,this.glyphManager=c.glyphManager,this.symbolFadeChange=c.placement.symbolFadeChange(p.exported.now()),this.imageManager.beginFrame();const _=this.style.order,x=this.style._sourceCaches;for(const O in x){const F=x[O];F.used&&F.prepare(this.context)}const S={},D={},I={};for(const O in x){const F=x[O];S[O]=F.getVisibleCoordinates(),D[O]=S[O].slice().reverse(),I[O]=F.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let O=0;O<_.length;O++)if(this.style._layers[_[O]].is3D()){this.opaquePassCutoff=O;break}if(this.terrain&&(this.terrain.updateTileBinding(I),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new p.GlobeSharedBuffers(this.context)),!p.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const O of _){const F=this.style._layers[O],j=c._getLayerSourceCache(F);if(!F.hasOffscreenPass()||F.isHidden(this.transform.zoom))continue;const Y=j?D[j.id]:void 0;("custom"===F.type||F.isSky()||Y&&Y.length)&&this.renderLayer(this,j,F,Y)}this.depthRangeFor3D=[0,1-(c.order.length+2)*this.numSublayers*this.depthEpsilon];const R=this.terrain;if(R&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&R.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:h.showOverdrawInspector?p.Color.black:p.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const O=this.style._layers[_[this.currentLayer]],F=c._getLayerSourceCache(O);if(O.isSky())continue;const j=F?D[F.id]:void 0;this._renderTileClippingMasks(O,F,j),this.renderLayer(this,F,O,j)}if(this.style.fog&&this.transform.projection.supportsFog&&function(O,F){const j=O.context,Y=j.gl,ee=O.transform,se=new p.DepthMode(Y.LEQUAL,p.DepthMode.ReadOnly,[0,1]),ie=O.useProgram("globeAtmosphere",null,"globe"===ee.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),le=p.globeToMercatorTransition(ee.zoom),U=F.properties.get("color").toArray01(),J=F.properties.get("high-color").toArray01(),pe=F.properties.get("space-color").toArray01PremultipliedAlpha(),ge=p.identity$1([]);p.rotateY$1(ge,ge,-p.degToRad(ee._center.lng)),p.rotateX$1(ge,ge,p.degToRad(ee._center.lat)),p.rotateZ$1(ge,ge,ee.angle),p.rotateX$1(ge,ge,-ee._pitch);const Fe=p.fromQuat(new Float32Array(16),ge),Pe=p.mapValue(F.properties.get("star-intensity"),0,1,0,.25),We=p.mapValue(F.properties.get("horizon-blend"),0,1,5e-4,.25),He=p.globeUseCustomAntiAliasing(O,j,ee)&&5e-4===We?ee.worldSize/(2*Math.PI*1.025)-1:ee.globeRadius,ot=O.frameCounter/1e3%1,Ft=p.length(ee.globeCenterInViewSpace),nt=Math.sqrt(Math.pow(Ft,2)-Math.pow(He,2)),St=Math.acos(nt/Ft),pt={u_frustum_tl:ee.frustumCorners.TL,u_frustum_tr:ee.frustumCorners.TR,u_frustum_br:ee.frustumCorners.BR,u_frustum_bl:ee.frustumCorners.BL,u_horizon:ee.frustumCorners.horizon,u_transition:le,u_fadeout_range:We,u_color:U,u_high_color:J,u_space_color:pe,u_star_intensity:Pe,u_star_size:5*p.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:ot,u_horizon_angle:St,u_rotation_matrix:Fe};O.prepareDrawProgram(j,ie);const Nt=O.atmosphereBuffer;Nt&&ie.draw(j,Y.TRIANGLES,se,p.StencilMode.disabled,p.ColorMode.alphaBlended,p.CullFaceMode.backCW,pt,"skybox",Nt.vertexBuffer,Nt.indexBuffer,Nt.segments)}(this,this.style.fog),this.renderPass="sky",(p.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const O=this.style._layers[_[this.currentLayer]],F=c._getLayerSourceCache(O);O.isSky()&&this.renderLayer(this,F,O,F?D[F.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<_.length;){const O=this.style._layers[_[this.currentLayer]],F=c._getLayerSourceCache(O);if(O.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(O)){if(O.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const j=F?("symbol"===O.type?I:D)[F.id]:void 0;this._renderTileClippingMasks(O,F,F?S[F.id]:void 0),this.renderLayer(this,F,O,j),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let O=null;p.values(this.style._layers).forEach(F=>{const j=c._getLayerSourceCache(F);j&&!F.isHidden(this.transform.zoom)&&(!O||O.getSource().maxzoom<j.getSource().maxzoom)&&(O=j)}),O&&this.options.showTileBoundaries&&wu.debug(this,O,O.getVisibleCoordinates())}this.options.showPadding&&function(O){const F=O.transform.padding;Sd(O,O.transform.height-(F.top||0),3,vu),Sd(O,F.bottom||0,3,r_),Ls(O,F.left||0,3,Ps),Ls(O,O.transform.width-(F.right||0),3,Ea);const j=O.transform.centerPoint;var Y,ee,se,ie;xu(Y=O,(ee=j.x)-1,(se=O.transform.height-j.y)-10,2,20,ie=Kp),xu(Y,ee-10,se-1,20,2,ie)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(p.window.performance.now()),this.saveCanvasCopy())}renderLayer(c,h,_,x){_.isHidden(this.transform.zoom)||("background"===_.type||"sky"===_.type||"custom"===_.type||x&&x.length)&&(this.id=_.id,this.gpuTimingStart(_),(!c.transform.projection.unsupportedLayers||!c.transform.projection.unsupportedLayers.includes(_.type)||c.terrain&&"custom"===_.type)&&wu[_.type](c,h,_,x,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(c){if(!this.options.gpuTiming)return;const h=this.context.extTimerQuery;let _=this.gpuTimers[c.id];_||(_=this.gpuTimers[c.id]={calls:0,cpuTime:0,query:h.createQueryEXT()}),_.calls++,h.beginQueryEXT(h.TIME_ELAPSED_EXT,_.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const c=this.context.extTimerQuery,h=c.createQueryEXT();this.deferredRenderGpuTimeQueries.push(h),c.beginQueryEXT(c.TIME_ELAPSED_EXT,h)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const c=this.context.extTimerQuery;c.endQueryEXT(c.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery;c.endQueryEXT(c.TIME_ELAPSED_EXT)}collectGpuTimers(){const c=this.gpuTimers;return this.gpuTimers={},c}collectDeferredRenderGpuQueries(){const c=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],c}queryGpuTimers(c){const h={};for(const _ in c){const x=c[_],S=this.context.extTimerQuery,D=S.getQueryObjectEXT(x.query,S.QUERY_RESULT_EXT)/1e6;S.deleteQueryEXT(x.query),h[_]=D}return h}queryGpuTimeDeferredRender(c){if(!this.options.gpuTimingDeferredRender)return 0;const h=this.context.extTimerQuery;let _=0;for(const x of c)_+=h.getQueryObjectEXT(x,h.QUERY_RESULT_EXT)/1e6,h.deleteQueryEXT(x);return _}translatePosMatrix(c,h,_,x,S){if(!_[0]&&!_[1])return c;const D=S?"map"===x?this.transform.angle:0:"viewport"===x?-this.transform.angle:0;if(D){const O=Math.sin(D),F=Math.cos(D);_=[_[0]*F-_[1]*O,_[0]*O+_[1]*F]}const I=[S?_[0]:cn(h,_[0],this.transform.zoom),S?_[1]:cn(h,_[1],this.transform.zoom),0],R=new Float32Array(16);return p.translate(R,c,I),R}saveTileTexture(c){const h=this._tileTextures[c.size[0]];h?h.push(c):this._tileTextures[c.size[0]]=[c]}getTileTexture(c){const h=this._tileTextures[c];return h&&h.length>0?h.pop():null}isPatternMissing(c){return null===c||void 0!==c&&!this.imageManager.getPattern(c.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const c=this.terrain&&this.terrain.renderingToTexture,h=this.terrain&&0===this.terrain.exaggeration(),_=this.style&&this.style.fog,x=[];return this.terrainRenderModeElevated()&&x.push("TERRAIN"),"globe"===this.transform.projection.name&&x.push("GLOBE"),h&&x.push("ZERO_EXAGGERATION"),_&&!c&&0!==_.getOpacity(this.transform.pitch)&&x.push("FOG"),c&&x.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&x.push("OVERDRAW_INSPECTOR"),x}useProgram(c,h,_){this.cache=this.cache||{};const x=_||[],S=this.currentGlobalDefines().concat(x),D=Bi.cacheKey(Mh[c],c,S,h);return this.cache[D]||(this.cache[D]=new Bi(this.context,c,Mh[c],h,wi[c],S)),this.cache[D]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const c=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(c.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=p.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new p.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(c,h,_){if(this.terrain&&this.terrain.renderingToTexture)return;const x=this.style.fog;if(x){const S=x.getOpacity(this.transform.pitch),D=((I,R,O,F,j,Y,ee,se,ie,le,U)=>{const J=I.transform,pe=R.properties.get("color").toArray01();pe[3]=F;const ge=I.frameCounter/1e3%1;return{u_fog_matrix:O?J.calculateFogTileMatrix(O):I.identityMat,u_fog_range:R.getFovAdjustedRange(J._fov),u_fog_color:pe,u_fog_horizon_blend:R.properties.get("horizon-blend"),u_fog_temporal_offset:ge,u_frustum_tl:j,u_frustum_tr:Y,u_frustum_br:ee,u_frustum_bl:se,u_globe_pos:ie,u_globe_radius:le,u_viewport:U,u_globe_transition:p.globeToMercatorTransition(J.zoom),u_is_globe:+("globe"===J.projection.name)}})(this,x,_,S,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*p.exported.devicePixelRatio,this.transform.height*p.exported.devicePixelRatio]);h.setFogUniformValues(c,D)}}setTileLoadedFlag(c){this.tileLoaded=c}saveCanvasCopy(){const c=this.canvasCopy();c&&(this.frameCopies.push(c),this.tileLoaded=!1)}canvasCopy(){const c=this.context.gl,h=c.createTexture();return c.bindTexture(c.TEXTURE_2D,h),c.copyTexImage2D(c.TEXTURE_2D,0,c.RGBA,0,0,c.drawingBufferWidth,c.drawingBufferHeight,0),h}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const c=this.style&&this.style.fog;return!!c&&0!==c.getOpacity(this.transform.pitch)}getBackgroundTiles(){const c=this._backgroundTiles,h=this._backgroundTiles={},_=this.transform.coveringTiles({tileSize:512});for(const x of _)h[x.key]=c[x.key]||new p.Tile(x,512,this.transform.tileZoom,this);return h}clearBackgroundTiles(){this._backgroundTiles={}}}class Jp{constructor(c=0,h=0,_=0,x=0){if(isNaN(c)||c<0||isNaN(h)||h<0||isNaN(_)||_<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=c,this.bottom=h,this.left=_,this.right=x}interpolate(c,h,_){return null!=h.top&&null!=c.top&&(this.top=p.number(c.top,h.top,_)),null!=h.bottom&&null!=c.bottom&&(this.bottom=p.number(c.bottom,h.bottom,_)),null!=h.left&&null!=c.left&&(this.left=p.number(c.left,h.left,_)),null!=h.right&&null!=c.right&&(this.right=p.number(c.right,h.right,_)),this}getCenter(c,h){const _=p.clamp((this.left+c-this.right)/2,0,c),x=p.clamp((this.top+h-this.bottom)/2,0,h);return new p.Point(_,x)}equals(c){return this.top===c.top&&this.bottom===c.bottom&&this.left===c.left&&this.right===c.right}clone(){return new Jp(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function ef(g,c){const h=p.getColumn(g,3);p.fromQuat(g,c),p.setColumn(g,3,h)}function Zi(g,c){const h=p.identity$1([]);return p.rotateZ$1(h,h,-c),p.rotateX$1(h,h,-g),h}function Fh(g,c){const h=[g[0],g[1],0],_=[c[0],c[1],0];if(p.length(h)>=1e-15){const D=p.normalize([],h);p.scale$2(_,D,p.dot(_,D)),c[0]=_[0],c[1]=_[1]}const x=p.cross([],c,g);if(p.len(x)<1e-15)return null;const S=Math.atan2(-x[1],x[0]);return Zi(Math.atan2(Math.sqrt(g[0]*g[0]+g[1]*g[1]),-g[2]),S)}class a_{constructor(c,h){this.position=c,this.orientation=h}get position(){return this._position}set position(c){if(c){const h=c instanceof p.MercatorCoordinate?c:new p.MercatorCoordinate(c[0],c[1],c[2]);this._renderWorldCopies&&(h.x=p.wrap(h.x,0,1)),this._position=h}else this._position=null}lookAtPoint(c,h){if(this.orientation=null,!this.position)return;const _=this.position,x=this._elevation?this._elevation.getAtPointOrZero(p.MercatorCoordinate.fromLngLat(c)):0,S=p.MercatorCoordinate.fromLngLat(c,x),D=[S.x-_.x,S.y-_.y,S.z-_.z];h||(h=[0,0,1]),h[2]=Math.abs(h[2]),this.orientation=Fh(D,h)}setPitchBearing(c,h){this.orientation=Zi(p.degToRad(c),p.degToRad(-h))}}class tf{constructor(c,h){this._transform=p.identity([]),this.orientation=h,this.position=c}get mercatorPosition(){const c=this.position;return new p.MercatorCoordinate(c[0],c[1],c[2])}get position(){const c=p.getColumn(this._transform,3);return[c[0],c[1],c[2]]}set position(c){var h;c&&p.setColumn(this._transform,3,[(h=c)[0],h[1],h[2],1])}get orientation(){return this._orientation}set orientation(c){this._orientation=c||p.identity$1([]),c&&ef(this._transform,this._orientation)}getPitchBearing(){const c=this.forward(),h=this.right();return{bearing:Math.atan2(-h[1],h[0]),pitch:Math.atan2(Math.sqrt(c[0]*c[0]+c[1]*c[1]),-c[2])}}setPitchBearing(c,h){this._orientation=Zi(c,h),ef(this._transform,this._orientation)}forward(){const c=p.getColumn(this._transform,2);return[-c[0],-c[1],-c[2]]}up(){const c=p.getColumn(this._transform,1);return[-c[0],-c[1],-c[2]]}right(){const c=p.getColumn(this._transform,0);return[c[0],c[1],c[2]]}getCameraToWorld(c,h){const _=new Float64Array(16);return p.invert(_,this.getWorldToCamera(c,h)),_}getWorldToCameraPosition(c,h,_){const x=this.position;p.scale$2(x,x,-c);const S=new Float64Array(16);return p.fromScaling(S,[_,_,_]),p.translate(S,S,x),S[10]*=h,S}getWorldToCamera(c,h){const _=new Float64Array(16),x=new Float64Array(4),S=this.position;return p.conjugate(x,this._orientation),p.scale$2(S,S,-c),p.fromQuat(_,x),p.translate(_,_,S),_[1]*=-1,_[5]*=-1,_[9]*=-1,_[13]*=-1,_[8]*=h,_[9]*=h,_[10]*=h,_[11]*=h,_}getCameraToClipPerspective(c,h,_,x){const S=new Float64Array(16);return p.perspective(S,c,h,_,x),S}getDistanceToElevation(c,h=!1){const _=0===c?0:p.mercatorZfromAltitude(c,h?p.latFromMercatorY(this.position[1]):this.position[1]),x=this.forward();return(_-this.position[2])/x[2]}clone(){return new tf([...this.position],[...this.orientation])}}function Td(g,c){const h=Ed(g.projection,g.zoom,g.width,g.height),_=function(S,D,I,R,O){const F=new p.LngLat(I.lng-180*Ia,I.lat),j=new p.LngLat(I.lng+180*Ia,I.lat),Y=S.project(F.lng,F.lat),ee=S.project(j.lng,j.lat),se=-Math.atan2(ee.y-Y.y,ee.x-Y.x),ie=p.MercatorCoordinate.fromLngLat(I);ie.y=p.clamp(ie.y,-1+Ia,1-Ia);const le=ie.toLngLat(),U=S.project(le.lng,le.lat),J=p.MercatorCoordinate.fromLngLat(le);J.x+=Ia;const pe=J.toLngLat(),ge=S.project(pe.lng,pe.lat),Fe=nf(ge.x-U.x,ge.y-U.y,se),Pe=p.MercatorCoordinate.fromLngLat(le);Pe.y+=Ia;const Oe=Pe.toLngLat(),We=S.project(Oe.lng,Oe.lat),He=nf(We.x-U.x,We.y-U.y,se),ot=Math.abs(Fe.x)/Math.abs(He.y),Ft=p.identity([]);p.rotateZ(Ft,Ft,-se*(1-(O?0:R)));const nt=p.identity([]);return p.scale(nt,nt,[1,1-(1-ot)*R,1]),nt[4]=-He.x/He.y*R,p.rotateZ(nt,nt,se),p.multiply(nt,Ft,nt),nt}(g.projection,0,g.center,h,c),x=l_(g);return p.scale(_,_,[x,x,1]),_}function l_(g){const c=g.projection,h=Ed(g.projection,g.zoom,g.width,g.height),_=c_(c,g.center),x=c_(c,p.LngLat.convert(c.center));return Math.pow(2,_*h+(1-h)*x)}function Ed(g,c,h,_,x=1/0){const S=g.range;if(!S)return 0;const D=Math.min(x,Math.max(h,_)),I=Math.log(D/1024)/Math.LN2;return p.smoothstep(S[0]+I,S[1]+I,c)}const Ia=1/4e4;function c_(g,c){const h=p.clamp(c.lat,-p.MAX_MERCATOR_LATITUDE,p.MAX_MERCATOR_LATITUDE),_=new p.LngLat(c.lng-180*Ia,h),x=new p.LngLat(c.lng+180*Ia,h),S=g.project(_.lng,h),D=g.project(x.lng,h),I=p.MercatorCoordinate.fromLngLat(_),R=p.MercatorCoordinate.fromLngLat(x),O=D.x-S.x,F=D.y-S.y,j=R.x-I.x,Y=R.y-I.y,ee=Math.sqrt((j*j+Y*Y)/(O*O+F*F));return Math.log(ee)/Math.LN2}function nf(g,c,h){const _=Math.cos(h),x=Math.sin(h);return{x:g*_-c*x,y:g*x+c*_}}class Dd{constructor(c,h,_,x,S,D,I){this.tileSize=512,this._renderWorldCopies=void 0===S||S,this._minZoom=c||0,this._maxZoom=h||22,this._minPitch=null==_?0:_,this._maxPitch=null==x?60:x,this.setProjection(D),this.setMaxBounds(I),this.width=0,this.height=0,this._center=new p.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Jp,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new tf,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const c=new Dd(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return c._elevation=this._elevation,c._centerAltitude=this._centerAltitude,c._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,c.tileSize=this.tileSize,c.mercatorFromTransition=this.mercatorFromTransition,c.width=this.width,c.height=this.height,c.cameraElevationReference=this.cameraElevationReference,c._center=this._center,c._setZoom(this.zoom),c._seaLevelZoom=this._seaLevelZoom,c.angle=this.angle,c._fov=this._fov,c._pitch=this._pitch,c._nearZ=this._nearZ,c._farZ=this._farZ,c._averageElevation=this._averageElevation,c._unmodified=this._unmodified,c._edgeInsets=this._edgeInsets.clone(),c._camera=this._camera.clone(),c._calcMatrices(),c.freezeTileCoverage=this.freezeTileCoverage,c.frustumCorners=this.frustumCorners,c}get elevation(){return this._elevation}set elevation(c){this._elevation!==c&&(this._elevation=c,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(c,h=!1){const _=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||_)&&this._updateCameraOnTerrain(),(c||_)&&this._constrainCamera(h),this._calcMatrices()}getProjection(){return p.pick(this.projection,["name","center","parallels"])}setProjection(c){this.projectionOptions=c||{name:"mercator"};const h=this.projection?this.getProjection():void 0;this.projection=p.getProjection(this.projectionOptions);const _=!te(h,this.getProjection());return _&&this._calcMatrices(),this.mercatorFromTransition=!1,_}setMercatorFromTransition(){const c=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=p.getProjection({name:"mercator"});const h=c!==this.projection.name;return h&&this._calcMatrices(),h}get minZoom(){return this._minZoom}set minZoom(c){this._minZoom!==c&&(this._minZoom=c,this.zoom=Math.max(this.zoom,c))}get maxZoom(){return this._maxZoom}set maxZoom(c){this._maxZoom!==c&&(this._maxZoom=c,this.zoom=Math.min(this.zoom,c))}get minPitch(){return this._minPitch}set minPitch(c){this._minPitch!==c&&(this._minPitch=c,this.pitch=Math.max(this.pitch,c))}get maxPitch(){return this._maxPitch}set maxPitch(c){this._maxPitch!==c&&(this._maxPitch=c,this.pitch=Math.min(this.pitch,c))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(c){void 0===c?c=!0:null===c&&(c=!1),this._renderWorldCopies=c}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const c=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(c))}get cameraWorldSize(){const c=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(c))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return p.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new p.Point(this.width,this.height)}get bearing(){return p.wrap(this.rotation,-180,180)}set bearing(c){this.rotation=c}get rotation(){return-this.angle/Math.PI*180}set rotation(c){const h=-c*Math.PI/180;var _,x,S,D,I,R,O,F,j,Y;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=(_=new p.ARRAY_TYPE(4),p.ARRAY_TYPE!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_),x=this.rotationMatrix,D=this.angle,I=(S=this.rotationMatrix)[0],R=S[1],O=S[2],F=S[3],j=Math.sin(D),Y=Math.cos(D),x[0]=I*Y+O*j,x[1]=R*Y+F*j,x[2]=I*-j+O*Y,x[3]=R*-j+F*Y)}get pitch(){return this._pitch/Math.PI*180}set pitch(c){const h=p.clamp(c,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const c=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/c)}set fov(c){c=Math.max(.01,Math.min(60,c)),this._fov!==c&&(this._unmodified=!1,this._fov=p.degToRad(c),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(c){this._averageElevation=c,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(c){const h=Math.min(Math.max(c,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._setZoom(h),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(c){this._zoom=c,this.scale=this.zoomScale(c),this.tileZoom=Math.floor(c),this.zoomFraction=c-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const c=this._elevation;this._centerAltitude=c.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=c.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const c=this._elevation,h=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],_=this.horizonLineFromTop();let x=0,S=0;for(let D=0;D<h.length;D++){const I=new p.Point(h[D][0]*this.width,_+h[D][1]*(this.height-_)),R=c.pointCoordinate(I);if(!R)continue;const O=1/Math.hypot(R[0]-this._camera.position[0],R[1]-this._camera.position[1]);x+=R[3]*O,S+=O}return 0===S?NaN:x/S}get center(){return this._center}set center(c){c.lat===this._center.lat&&c.lng===this._center.lng||(this._unmodified=!1,this._center=c,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const c=this._seaLevelZoom,h=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),_=this.pixelsPerMeter/this.worldSize*h,x=this._mercatorZfromZoom(c),S=this._mercatorZfromZoom(this._maxZoom),D=Math.max(x-_,S);this._setZoom(this._zoomFromMercatorZ(D))}get padding(){return this._edgeInsets.toJSON()}set padding(c){this._edgeInsets.equals(c)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,c,1),this._calcMatrices())}computeZoomRelativeTo(c){const h=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,c.toAltitude()));let _;_=c.z<this._camera.position[2]?[h.x,h.y,h.z]:[c.x,c.y,c.z];const x=p.length(p.sub([],this._camera.position,_));return p.clamp(this._zoomFromMercatorZ(x),this._minZoom,this._maxZoom)}setFreeCameraOptions(c){if(!this.height||!c.position&&!c.orientation)return;this._updateCameraState();let h=!1;if(c.orientation&&!p.exactEquals(c.orientation,this._camera.orientation)&&(h=this._setCameraOrientation(c.orientation)),c.position){const _=[c.position.x,c.position.y,c.position.z];p.exactEquals$1(_,this._camera.position)||(this._setCameraPosition(_),h=!0)}h&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const c=this._camera.position,h=new a_;return h.position=new p.MercatorCoordinate(c[0],c[1],c[2]),h.orientation=this._camera.orientation,h._elevation=this.elevation,h._renderWorldCopies=this.renderWorldCopies,h}_setCameraOrientation(c){if(!p.length$1(c))return!1;p.normalize$1(c,c);const h=p.transformQuat([],[0,0,-1],c),_=p.transformQuat([],[0,-1,0],c);if(_[2]<0)return!1;const x=Fh(h,_);return!!x&&(this._camera.orientation=x,!0)}_setCameraPosition(c){const h=this.zoomScale(this.minZoom)*this.tileSize,_=this.zoomScale(this.maxZoom)*this.tileSize,x=this.cameraToCenterDistance;c[2]=p.clamp(c[2],x/_,x/h),this._camera.position=c}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(c){return this._edgeInsets.equals(c)}interpolatePadding(c,h,_){this._unmodified=!1,this._edgeInsets.interpolate(c,h,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(c){const h=(c.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/c.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(c){const h=[new p.UnwrappedTileID(0,c)];if(this.renderWorldCopies){const _=this.pointCoordinate(new p.Point(0,0)),x=this.pointCoordinate(new p.Point(this.width,0)),S=this.pointCoordinate(new p.Point(this.width,this.height)),D=this.pointCoordinate(new p.Point(0,this.height)),I=Math.floor(Math.min(_.x,x.x,S.x,D.x)),R=Math.floor(Math.max(_.x,x.x,S.x,D.x)),O=1;for(let F=I-O;F<=R+O;F++)0!==F&&h.push(new p.UnwrappedTileID(F,c))}return h}coveringTiles(c){let h=this.coveringZoomLevel(c);const _=h,x=this.elevation&&!c.isTerrainDEM,S="mercator"===this.projection.name;if(void 0!==c.minzoom&&h<c.minzoom)return[];void 0!==c.maxzoom&&h>c.maxzoom&&(h=c.maxzoom);const D=this.locationCoordinate(this.center),I=this.center.lat,R=1<<h,O=[R*D.x,R*D.y,0],F="globe"===this.projection.name,j=!F,Y=p.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h,j),ee=F?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),se=R*p.mercatorZfromAltitude(1,this.center.lat),ie=this._camera.position[2]/p.mercatorZfromAltitude(1,this.center.lat),le=[R*ee.x,R*ee.y,ie*(j?1:se)],U=this.cameraToCenterDistance/c.tileSize*(c.roundZoom?1:.502),J=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?h:0,pe=c.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,ge=c.isTerrainDEM?-pe:this._elevation?this._elevation.getMinElevationBelowMSL():0,Fe=this.projection.isReprojectedInTileSpace?l_(this):1,Pe=it=>{const Bt=new p.MercatorCoordinate(it.x+25e-6,it.y,it.z),Mt=new p.MercatorCoordinate(it.x,it.y+25e-6,it.z),Vt=it.toLngLat(),In=Bt.toLngLat(),zn=Mt.toLngLat(),bn=this.locationCoordinate(Vt),An=this.locationCoordinate(In),gi=this.locationCoordinate(zn),oi=Math.hypot(An.x-bn.x,An.y-bn.y),En=Math.hypot(gi.x-bn.x,gi.y-bn.y);return Math.sqrt(oi*En)*Fe/25e-6},Oe=it=>{const vt=pe,Bt=ge;return{aabb:p.tileAABB(this,R,0,0,0,it,Bt,vt,this.projection),zoom:0,x:0,y:0,minZ:Bt,maxZ:vt,wrap:it,fullyVisible:!1}},We=[];let He=[];const ot=h,Ft=c.reparseOverscaled?_:h,nt=it=>it*it,St=nt((ie-this._centerAltitude)*se),pt=it=>{if(!this._elevation||!it.tileID||!S)return;const vt=this._elevation.getMinMaxForTile(it.tileID),Bt=it.aabb;vt?(Bt.min[2]=vt.min,Bt.max[2]=vt.max,Bt.center[2]=(Bt.min[2]+Bt.max[2])/2):(it.shouldSplit=Nt(it),it.shouldSplit||(Bt.min[2]=Bt.max[2]=Bt.center[2]=this._centerAltitude))},Nt=it=>{if(it.zoom<J)return!0;if(it.zoom===ot)return!1;if(null!=it.shouldSplit)return it.shouldSplit;const vt=it.aabb.distanceX(le),Bt=it.aabb.distanceY(le);let Mt=St,Vt=1;if(F){Mt=nt(it.aabb.distanceZ(le));const bn=Math.pow(2,it.zoom),An=p.latFromMercatorY((it.y+1)/bn),gi=p.latFromMercatorY(it.y/bn),oi=Math.min(Math.max(I,An),gi),En=p.circumferenceAtLatitude(oi)/p.circumferenceAtLatitude(I);if(Vt=oi===I?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,En/this._mercatorScaleRatio),this.zoom<=p.GLOBE_ZOOM_THRESHOLD_MIN&&it.zoom===ot-1&&En>=.9)return!0}else if(x&&(Mt=nt(it.aabb.distanceZ(le)*se)),this.projection.isReprojectedInTileSpace&&_<=5){const bn=Math.pow(2,it.zoom),An=Pe(new p.MercatorCoordinate((it.x+.5)/bn,(it.y+.5)/bn));Vt=An>.85?1:An}const In=vt*vt+Bt*Bt+Mt;return In<nt((1<<ot-it.zoom)*U*Vt*((bn,An)=>{if(An*nt(.707)<bn)return 1;const gi=Math.sqrt(An/bn);return gi/(1.4144271570014144+(Math.pow(1.1,gi-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Mt,St),In))};if(this.renderWorldCopies)for(let it=1;it<=3;it++)We.push(Oe(-it)),We.push(Oe(it));for(We.push(Oe(0));We.length>0;){const it=We.pop(),vt=it.x,Bt=it.y;let Mt=it.fullyVisible;if(!Mt){const Vt=it.aabb.intersects(Y);if(0===Vt)continue;Mt=2===Vt}if(it.zoom!==ot&&Nt(it))for(let Vt=0;Vt<4;Vt++){const In=(vt<<1)+Vt%2,zn=(Bt<<1)+(Vt>>1),bn={aabb:S?it.aabb.quadrant(Vt):p.tileAABB(this,R,it.zoom+1,In,zn,it.wrap,it.minZ,it.maxZ,this.projection),zoom:it.zoom+1,x:In,y:zn,wrap:it.wrap,fullyVisible:Mt,tileID:void 0,shouldSplit:void 0,minZ:it.minZ,maxZ:it.maxZ};x&&!F&&(bn.tileID=new p.OverscaledTileID(it.zoom+1===ot?Ft:it.zoom+1,it.wrap,it.zoom+1,In,zn),pt(bn)),We.push(bn)}else{const Vt=it.zoom===ot?Ft:it.zoom;if(c.minzoom&&c.minzoom>Vt)continue;const In=O[0]-(.5+vt+(it.wrap<<it.zoom))*(1<<h-it.zoom),zn=O[1]-.5-Bt,bn=it.tileID?it.tileID:new p.OverscaledTileID(Vt,it.wrap,it.zoom,vt,Bt);He.push({tileID:bn,distanceSq:In*In+zn*zn})}}if(this.fogCullDistSq){const it=this.fogCullDistSq,vt=this.horizonLineFromTop();He=He.filter(Bt=>{const Mt=[0,0,0,1],Vt=[p.EXTENT,p.EXTENT,0,1],In=this.calculateFogTileMatrix(Bt.tileID.toUnwrapped());p.transformMat4$1(Mt,Mt,In),p.transformMat4$1(Vt,Vt,In);const zn=p.getAABBPointSquareDist(Mt,Vt);if(0===zn)return!0;let bn=!1;const An=this._elevation;if(An&&zn>it&&0!==vt){const gi=this.calculateProjMatrix(Bt.tileID.toUnwrapped());let oi;c.isTerrainDEM||(oi=An.getMinMaxForTile(Bt.tileID)),oi||(oi={min:ge,max:pe});const En=p.furthestTileCorner(this.rotation),nr=[En[0]*p.EXTENT,En[1]*p.EXTENT,oi.max];p.transformMat4(nr,nr,gi),bn=(1-nr[1])*this.height*.5<vt}return zn<it||bn})}return He.sort((it,vt)=>it.distanceSq-vt.distanceSq).map(it=>it.tileID)}resize(c,h){this.width=c,this.height=h,this.pixelsToGLUnits=[2/c,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(c){return Math.pow(2,c)}scaleZoom(c){return Math.log(c)/Math.LN2}project(c){const h=p.clamp(c.lat,-p.MAX_MERCATOR_LATITUDE,p.MAX_MERCATOR_LATITUDE),_=this.projection.project(c.lng,h);return new p.Point(_.x*this.worldSize,_.y*this.worldSize)}unproject(c){return this.projection.unproject(c.x/this.worldSize,c.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/p.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(c,h){let _,x;const S=this.centerPoint;if("globe"===this.projection.name){const I=this.worldSize;_=(h.x-S.x)/I,x=(h.y-S.y)/I}else{const I=this.pointCoordinate(h),R=this.pointCoordinate(S);_=I.x-R.x,x=I.y-R.y}const D=this.locationCoordinate(c);this.setLocation(new p.MercatorCoordinate(D.x-_,D.y-x))}setLocation(c){this.center=this.coordinateLocation(c),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(c){return this.projection.locationPoint(this,c)}locationPoint3D(c){return this.projection.locationPoint(this,c,!0)}pointLocation(c){return this.coordinateLocation(this.pointCoordinate(c))}pointLocation3D(c){return this.coordinateLocation(this.pointCoordinate3D(c))}locationCoordinate(c,h){const _=h?p.mercatorZfromAltitude(h,c.lat):void 0,x=this.projection.project(c.lng,c.lat);return new p.MercatorCoordinate(x.x,x.y,_)}coordinateLocation(c){return this.projection.unproject(c.x,c.y)}pointRayIntersection(c,h){const _=null!=h?h:this._centerAltitude,x=[c.x,c.y,0,1],S=[c.x,c.y,1,1];p.transformMat4$1(x,x,this.pixelMatrixInverse),p.transformMat4$1(S,S,this.pixelMatrixInverse);const D=S[3];p.scale$1(x,x,1/x[3]),p.scale$1(S,S,1/D);const I=x[2],R=S[2];return{p0:x,p1:S,t:I===R?0:(_-I)/(R-I)}}screenPointToMercatorRay(c){const h=[c.x,c.y,0,1],_=[c.x,c.y,1,1];return p.transformMat4$1(h,h,this.pixelMatrixInverse),p.transformMat4$1(_,_,this.pixelMatrixInverse),p.scale$1(h,h,1/h[3]),p.scale$1(_,_,1/_[3]),h[2]=p.mercatorZfromAltitude(h[2],this._center.lat)*this.worldSize,_[2]=p.mercatorZfromAltitude(_[2],this._center.lat)*this.worldSize,p.scale$1(h,h,1/this.worldSize),p.scale$1(_,_,1/this.worldSize),new p.Ray([h[0],h[1],h[2]],p.normalize([],p.sub([],_,h)))}rayIntersectionCoordinate(c){const{p0:h,p1:_,t:x}=c,S=p.mercatorZfromAltitude(h[2],this._center.lat),D=p.mercatorZfromAltitude(_[2],this._center.lat);return new p.MercatorCoordinate(p.number(h[0],_[0],x)/this.worldSize,p.number(h[1],_[1],x)/this.worldSize,p.number(S,D,x))}pointCoordinate(c,h=this._centerAltitude){return this.projection.pointCoordinate(this,c.x,c.y,h)}pointCoordinate3D(c){if(!this.elevation)return this.pointCoordinate(c);let h=this.projection.pointCoordinate3D(this,c.x,c.y);if(h)return new p.MercatorCoordinate(h[0],h[1],h[2]);let _=0,x=this.horizonLineFromTop();if(c.y>x)return this.pointCoordinate(c);const S=.02*x,D=c.clone();for(let I=0;I<10&&x-_>S;I++){D.y=p.number(_,x,.66);const R=this.projection.pointCoordinate3D(this,D.x,D.y);R?(x=D.y,h=R):_=D.y}return h?new p.MercatorCoordinate(h[0],h[1],h[2]):this.pointCoordinate(c)}isPointAboveHorizon(c){return this.projection.isPointAboveHorizon(this,c)}isPointOnSurface(c){if(c.y<0||c.y>this.height||c.x<0||c.x>this.width)return!1;if(this.elevation||this.zoom>=p.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(c);const h=this.pointCoordinate(c);return h.y>=0&&h.y<=1}_coordinatePoint(c,h){const _=h&&this.elevation?this.elevation.getAtPointOrZero(c,this._centerAltitude):this._centerAltitude,x=[c.x*this.worldSize,c.y*this.worldSize,_+c.toAltitude(),1];return p.transformMat4$1(x,x,this.pixelMatrix),x[3]>0?new p.Point(x[0]/x[3],x[1]/x[3]):new p.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:c,left:h}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,S=this.pointLocation3D(new p.Point(h,c)),D=this.pointLocation3D(new p.Point(x,c)),I=this.pointLocation3D(new p.Point(x,_)),R=this.pointLocation3D(new p.Point(h,_));let O=Math.min(S.lng,D.lng,I.lng,R.lng),F=Math.max(S.lng,D.lng,I.lng,R.lng),j=Math.min(S.lat,D.lat,I.lat,R.lat),Y=Math.max(S.lat,D.lat,I.lat,R.lat);const ee=Math.pow(2,-this.zoom)/16*270,se="globe"===this.projection.name?1:4,ie=(le,U,J,pe,ge)=>{const Fe=(le+J)/2,Pe=(U+pe)/2,Oe=new p.Point(Fe,Pe),{lng:We,lat:He}=this.pointLocation3D(Oe),ot=Math.max(0,O-We,j-He,We-F,He-Y);O=Math.min(O,We),F=Math.max(F,We),j=Math.min(j,He),Y=Math.max(Y,He),(ge<se||ot>ee)&&(ie(le,U,Fe,Pe,ge+1),ie(Fe,Pe,J,pe,ge+1))};if(ie(h,c,x,c,1),ie(x,c,x,_,1),ie(x,_,h,_,1),ie(h,_,h,c,1),"globe"===this.projection.name){const[le,U]=p.polesInViewport(this);le?(Y=90,F=180,O=-180):U&&(j=-90,F=180,O=-180)}return new p.LngLatBounds(new p.LngLat(O,j),new p.LngLat(F,Y))}_getBoundsRectangular(c,h){const{top:_,left:x}=this._edgeInsets,S=this.height-this._edgeInsets.bottom,D=this.width-this._edgeInsets.right,I=new p.Point(x,_),R=new p.Point(D,_),O=new p.Point(D,S),F=new p.Point(x,S);let j=this.pointCoordinate(I,c),Y=this.pointCoordinate(R,c);const ee=this.pointCoordinate(O,h),se=this.pointCoordinate(F,h),ie=(le,U)=>(U.y-le.y)/(U.x-le.x);return j.y>1&&Y.y>=0?j=new p.MercatorCoordinate((1-se.y)/ie(se,j)+se.x,1):j.y<0&&Y.y<=1&&(j=new p.MercatorCoordinate(-se.y/ie(se,j)+se.x,0)),Y.y>1&&j.y>=0?Y=new p.MercatorCoordinate((1-ee.y)/ie(ee,Y)+ee.x,1):Y.y<0&&j.y<=1&&(Y=new p.MercatorCoordinate(-ee.y/ie(ee,Y)+ee.x,0)),(new p.LngLatBounds).extend(this.coordinateLocation(j)).extend(this.coordinateLocation(Y)).extend(this.coordinateLocation(se)).extend(this.coordinateLocation(ee))}_getBoundsRectangularTerrain(){const c=this.elevation;if(!c.visibleDemTiles.length||c.isUsingMockSource())return this._getBoundsRectangular(0,0);const h=c.visibleDemTiles.reduce((_,x)=>{if(x.dem){const S=x.dem.tree;_.min=Math.min(_.min,S.minimums[0]),_.max=Math.max(_.max,S.maximums[0])}return _},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(h.min*c.exaggeration(),h.max*c.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(c=!0){const h=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,_=this.height/2-h*(1-this._horizonShift);return c?Math.max(0,_):_}getMaxBounds(){return this.maxBounds}setMaxBounds(c){this.maxBounds=c,this.minLat=-p.MAX_MERCATOR_LATITUDE,this.maxLat=p.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,c&&(this.minLat=c.getSouth(),this.maxLat=c.getNorth(),this.minLng=c.getWest(),this.maxLng=c.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=p.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=p.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=p.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=p.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(c,h){return this.projection.createTileMatrix(this,h,c)}calculateDistanceTileData(c){const h=c.key,_=this._distanceTileDataCache;if(_[h])return _[h];const x=c.canonical,S=1/this.height,D=this.cameraWorldSize,I=D/this.zoomScale(x.z),R=(x.x+Math.pow(2,x.z)*c.wrap)*I,O=x.y*I,F=this.point;F.x*=D/this.worldSize,F.y*=D/this.worldSize;const j=this.angle,Y=Math.sin(-j),ee=-Math.cos(-j);return _[h]={bearing:[Y,ee],center:[(F.x-R)*S,(F.y-O)*S],scale:I/p.EXTENT*S},_[h]}calculateFogTileMatrix(c){const h=c.key,_=this._fogTileMatrixCache;if(_[h])return _[h];const x=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,c);return p.multiply(x,this.worldToFogMatrix,x),_[h]=new Float32Array(x),_[h]}calculateProjMatrix(c,h=!1){const _=c.key,x=h?this._alignedProjMatrixCache:this._projMatrixCache;if(x[_])return x[_];const S=this.calculatePosMatrix(c,this.worldSize);return p.multiply(S,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:h?this.alignedProjMatrix:this.projMatrix,S),x[_]=new Float32Array(S),x[_]}calculatePixelsToTileUnitsMatrix(c){const h=c.tileID.key,_=this._pixelsToTileUnitsCache;if(_[h])return _[h];const x=function(S,D){const{scale:I}=S.tileTransform,R=I*p.EXTENT/(S.tileSize*Math.pow(2,D.zoom-S.tileID.overscaledZ+S.tileID.canonical.z));return O=new Float32Array(4),Y=(F=D.inverseAdjustmentMatrix)[1],ee=F[2],se=F[3],le=(j=[R,R])[1],O[0]=F[0]*(ie=j[0]),O[1]=Y*ie,O[2]=ee*le,O[3]=se*le,O;var O,F,j,Y,ee,se,ie,le}(c,this);return _[h]=x,_[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const c=1/this.worldSize,h=p.fromScaling([],[c,c,c]);return p.multiply(h,h,this.globeMatrix),h}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const c=this._elevation;this._updateCameraState();const h=p.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(h),x=this._camera.forward(),S=p.mercatorZfromAltitude(1,this._center.lat);_[2]/=S,x[2]/=S,p.normalize(x,x);const D=c.raycast(_,x,c.exaggeration());if(D){const I=p.scaleAndAdd([],_,x,D),R=new p.MercatorCoordinate(I[0],I[1],p.mercatorZfromAltitude(I[2],p.latFromMercatorY(I[1]))),O=(R.z+p.length([R.x-_[0],R.y-_[1],R.z-_[2]*S]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(O),this._centerAltitude=R.toAltitude(),this._center=this.coordinateLocation(R),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(c=!1){if(!this._elevation)return;const h=this._elevation,_=p.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,x=this._computeCameraPosition(_),S=h.getAtPointOrZero(new p.MercatorCoordinate(...x)),D=this.pixelsPerMeter/this.worldSize*S,I=this._minimumHeightOverTerrain(),R=x[2]-D;if(R<=I)if(R<0||c){const O=this.locationCoordinate(this._center,this._centerAltitude),F=[x[0],x[1],O.z-x[2]],j=p.length(F);F[2]-=(I-R)/this._pixelsPerMercatorPixel;const Y=p.length(F);if(0===Y)return;p.scale$2(F,F,j/Y*this._pixelsPerMercatorPixel),this._camera.position=[x[0],x[1],O.z*this._pixelsPerMercatorPixel-F[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const c="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||c){const Y=this.center;return Y.lat=p.clamp(Y.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!c)&&(Y.lng=p.clamp(Y.lng,this.minLng,this.maxLng)),this.center=Y,void(this._constraining=!1)}const h=this._unmodified,{x:_,y:x}=this.point;let S=0,D=_,I=x;const R=this.width/2,O=this.height/2,F=this.worldMinY*this.scale,j=this.worldMaxY*this.scale;if(x-O<F&&(I=F+O),x+O>j&&(I=j-O),j-F<this.height&&(S=Math.max(S,this.height/(j-F)),I=(j+F)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const Y=this.worldMinX*this.scale,ee=this.worldMaxX*this.scale,se=this.worldSize/2-(Y+ee)/2;D=(_+se+this.worldSize)%this.worldSize-se,D-R<Y&&(D=Y+R),D+R>ee&&(D=ee-R),ee-Y<this.width&&(S=Math.max(S,this.width/(ee-Y)),D=(ee+Y)/2)}D===_&&I===x||(this.center=this.unproject(new p.Point(D,I))),S&&(this.zoom+=this.scaleZoom(S)),this._constrainCamera(),this._unmodified=h,this._constraining=!1}_minZoomForBounds(){let c=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(c=Math.max(c,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),c}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const c=this.centerOffset,h=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=p.mercatorZfromAltitude(1,this.center.lat)/p.mercatorZfromAltitude(1,p.GLOBE_SCALE_MATCH_LATITUDE));const _=Ed(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,_),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const x="meters"===this.projection.zAxisUnit?h:1,S=this._camera.getWorldToCamera(this.worldSize,x),D=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);D[8]=2*-c.x/this.width,D[9]=2*c.y/this.height;let I=p.mul([],D,S);if(this.projection.isReprojectedInTileSpace){const Pe=this.locationCoordinate(this.center),Oe=p.identity([]);p.translate(Oe,Oe,[Pe.x*this.worldSize,Pe.y*this.worldSize,0]),p.multiply(Oe,Oe,Td(this)),p.translate(Oe,Oe,[-Pe.x*this.worldSize,-Pe.y*this.worldSize,0]),p.multiply(I,I,Oe),this.inverseAdjustmentMatrix=function(We){const He=Td(We,!0);return Ie([],[He[0],He[1],He[4],He[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=p.scale([],I,[this.worldSize,this.worldSize,this.worldSize/x,1]),this.projMatrix=I,this.invProjMatrix=p.invert(new Float64Array(16),this.projMatrix);const R=p.invert([],D);this.frustumCorners=p.FrustumCorners.fromInvProjectionMatrix(R,this.horizonLineFromTop(),this.height);const O=new Float32Array(16);p.identity(O),p.scale(O,O,[1,-1,1]),p.rotateX(O,O,this._pitch),p.rotateZ(O,O,this.angle);const F=p.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),j=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;F[8]=2*-c.x/this.width,F[9]=2*(c.y+j)/this.height,this.skyboxMatrix=p.multiply(O,F,O);const Y=this.point,ee=Y.x,se=Y.y,ie=this.width%2/2,le=this.height%2/2,U=Math.cos(this.angle),J=Math.sin(this.angle),pe=ee-Math.round(ee)+U*ie+J*le,ge=se-Math.round(se)+U*le+J*ie,Fe=new Float64Array(I);if(p.translate(Fe,Fe,[pe>.5?pe-1:pe,ge>.5?ge-1:ge,0]),this.alignedProjMatrix=Fe,I=p.create(),p.scale(I,I,[this.width/2,-this.height/2,1]),p.translate(I,I,[1,-1,0]),this.labelPlaneMatrix=I,I=p.create(),p.scale(I,I,[1,-1,1]),p.translate(I,I,[-1,-1,0]),p.scale(I,I,[2/this.width,2/this.height,1]),this.glCoordMatrix=I,this.pixelMatrix=p.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},I=p.invert(new Float64Array(16),this.pixelMatrix),!I)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=I,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=p.calculateGlobeMatrix(this);const Pe=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=p.transformMat4(Pe,Pe,S),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=I;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const c=this.cameraWorldSizeForFog,h=this.cameraPixelsPerMeter,_=this._camera.position,x=1/this.height/this._pixelsPerMercatorPixel,S=[c,c,h];p.scale$2(S,S,x),p.scale$2(_,_,-1),p.multiply$2(_,_,S);const D=p.create();p.translate(D,D,_),p.scale(D,D,S),this.mercatorFogMatrix=D,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(c,h,x)}_computeCameraPosition(c){const h=(c=c||this.pixelsPerMeter)/this.pixelsPerMeter,_=this._camera.forward(),x=this.point,S=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*h-c/this.worldSize*this._centerAltitude;return[x.x/this.worldSize-_[0]*S,x.y/this.worldSize-_[1]*S,c/this.worldSize*this._centerAltitude-_[2]*S]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(c){const h=this._maxCameraBoundsDistance()*Math.cos(this._pitch),_=this._camera.position[2],x=c[2];let S=1;this.projection.wrap&&(this.center=this.center.wrap()),x>0&&(S=Math.min((h-_)/x,1)),this._camera.position=p.scaleAndAdd([],this._camera.position,c,S),this._updateStateFromCamera()}_updateStateFromCamera(){const c=this._camera.position,h=this._camera.forward(),{pitch:_,bearing:x}=this._camera.getPitchBearing(),S=p.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,D=this._mercatorZfromZoom(this._maxZoom)*Math.cos(p.degToRad(this._maxPitch)),I=Math.max((c[2]-S)/Math.cos(_),D),R=this._zoomFromMercatorZ(I);p.scaleAndAdd(c,c,h,I),this._pitch=p.clamp(_,p.degToRad(this.minPitch),p.degToRad(this.maxPitch)),this.angle=p.wrap(x,-Math.PI,Math.PI),this._setZoom(p.clamp(R,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new p.MercatorCoordinate(c[0],c[1],c[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(c){return Math.pow(2,c)*this.tileSize}_mercatorZfromZoom(c){return this.cameraToCenterDistance/this._worldSizeFromZoom(c)}_minimumHeightOverTerrain(){const c=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(c)}_zoomFromMercatorZ(c){return this.scaleZoom(this.cameraToCenterDistance/(c*this.tileSize))}zoomFromMercatorZAdjusted(c){let h=0,_=p.GLOBE_ZOOM_THRESHOLD_MAX,x=0,S=1/0;for(;_-h>1e-6&&_>h;){const D=h+.5*(_-h),I=this.tileSize*Math.pow(2,D),R=this.getCameraToCenterDistance(this.projection,D,I),O=this.scaleZoom(R/(c*this.tileSize)),F=Math.abs(D-O);F<S&&(S=F,x=D),D<O?h=D:_=D}return x}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(p.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(c,h){const _=Math.min(c.x,h.x),x=Math.max(c.x,h.x),S=Math.min(c.y,h.y),D=Math.max(c.y,h.y);if(S<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const I=[new p.Point(_,S),new p.Point(x,D),new p.Point(_,D),new p.Point(x,S)],R=this.renderWorldCopies?-3:0,O=this.renderWorldCopies?4:1;for(const F of I){const j=this.pointRayIntersection(F);if(j.t<0)return!0;const Y=this.rayIntersectionCoordinate(j);if(Y.x<R||Y.y<0||Y.x>O||Y.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+p.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new p.Point(0,0),new p.Point(this.width,this.height))}zoomDeltaToMovement(c,h){const _=p.length(p.sub([],this._camera.position,c)),x=this._zoomFromMercatorZ(_)+h;return _-this._mercatorZfromZoom(x)}getCameraPoint(){if("globe"===this.projection.name){const c=function([h,_,x],S){const D=[h,_,x,1];p.transformMat4$1(D,D,S);const I=D[3]=Math.max(D[3],1e-6);return D[0]/=I,D[1]/=I,D[2]/=I,D}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new p.Point(c[0],c[1])}{const c=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new p.Point(0,c))}}getCameraToCenterDistance(c,h=this.zoom,_=this.worldSize){const x=Ed(c,h,this.width,this.height,1024),S=c.pixelSpaceConversion(this.center.lat,_,x);return.5/Math.tan(.5*this._fov)*this.height*S}getWorldToCameraMatrix(){const c=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&p.multiply(c,c,this.globeMatrix),c}}function la(g,c){let h=!1,_=null;const x=()=>{_=null,h&&(g(),_=setTimeout(x,c),h=!1)};return()=>(h=!0,_||x(),_)}class rf{constructor(c){this._hashName=c&&encodeURIComponent(c),p.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=la(this._updateHashUnthrottled.bind(this),300)}addTo(c){return this._map=c,p.window.addEventListener("hashchange",this._onHashChange,!1),c.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),p.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const c=this._map;if(!c)return"";const h=cr(c);if(this._hashName){const _=this._hashName;let x=!1;const S=p.window.location.hash.slice(1).split("&").map(D=>{const I=D.split("=")[0];return I===_?(x=!0,`${I}=${h}`):D}).filter(D=>D);return x||S.push(`${_}=${h}`),`#${S.join("&")}`}return`#${h}`}_getCurrentHash(){const c=p.window.location.hash.replace("#","");if(this._hashName){let h;return c.split("&").map(_=>_.split("=")).forEach(_=>{_[0]===this._hashName&&(h=_)}),(h&&h[1]||"").split("/")}return c.split("/")}_onHashChange(){const c=this._map;if(!c)return!1;const h=this._getCurrentHash();if(h.length>=3&&!h.some(_=>isNaN(_))){const _=c.dragRotate.isEnabled()&&c.touchZoomRotate.isEnabled()?+(h[3]||0):c.getBearing();return c.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:_,pitch:+(h[4]||0)}),!0}return!1}_updateHashUnthrottled(){const c=p.window.location.href.replace(/(#.+)?$/,this.getHashString());p.window.history.replaceState(p.window.history.state,null,c)}}function cr(g,c){const h=g.getCenter(),_=Math.round(100*g.getZoom())/100,x=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),S=Math.pow(10,x),D=Math.round(h.lng*S)/S,I=Math.round(h.lat*S)/S,R=g.getBearing(),O=g.getPitch();let F=c?`/${D}/${I}/${_}`:`${_}/${I}/${D}`;return(R||O)&&(F+="/"+Math.round(10*R)/10),O&&(F+=`/${Math.round(O)}`),F}const Su={linearity:.3,easing:p.bezier(0,0,.3,1)},Nh=p.extend({deceleration:2500,maxSpeed:1400},Su),Bh=p.extend({deceleration:20,maxSpeed:1400},Su),pn=p.extend({deceleration:1e3,maxSpeed:360},Su),ca=p.extend({deceleration:1e3,maxSpeed:90},Su);class $m{constructor(c){this._map=c,this.clear()}clear(){this._inertiaBuffer=[]}record(c){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:p.exported.now(),settings:c})}_drainInertiaBuffer(){const c=this._inertiaBuffer,h=p.exported.now();for(;c.length>0&&h-c[0].time>160;)c.shift()}_onMoveEnd(c){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const h={zoom:0,bearing:0,pitch:0,pan:new p.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:S}of this._inertiaBuffer)h.zoom+=S.zoomDelta||0,h.bearing+=S.bearingDelta||0,h.pitch+=S.pitchDelta||0,S.panDelta&&h.pan._add(S.panDelta),S.around&&(h.around=S.around),S.pinchAround&&(h.pinchAround=S.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(h.pan.mag()){const S=Id(h.pan.mag(),_,p.extend({},Nh,c||{}));x.offset=h.pan.mult(S.amount/h.pan.mag()),x.center=this._map.transform.center,Vc(x,S)}if(h.zoom){const S=Id(h.zoom,_,Bh);x.zoom=this._map.transform.zoom+S.amount,Vc(x,S)}if(h.bearing){const S=Id(h.bearing,_,pn);x.bearing=this._map.transform.bearing+p.clamp(S.amount,-179,179),Vc(x,S)}if(h.pitch){const S=Id(h.pitch,_,ca);x.pitch=this._map.transform.pitch+S.amount,Vc(x,S)}if(x.zoom||x.bearing){const S=void 0===h.pinchAround?h.around:h.pinchAround;x.around=S?this._map.unproject(S):this._map.getCenter()}return this.clear(),x.noMoveStart=!0,x}}function Vc(g,c){(!g.duration||g.duration<c.duration)&&(g.duration=c.duration,g.easing=c.easing)}function Id(g,c,h){const{maxSpeed:_,linearity:x,deceleration:S}=h,D=p.clamp(g*x/(c/1e3),-_,_),I=Math.abs(D)/(S*x);return{easing:h.easing,duration:1e3*I,amount:D*(I/2)}}class Dr extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,h,_,x={}){const S=st(h.getCanvasContainer(),_),D=h.unproject(S);super(c,p.extend({point:S,lngLat:D,originalEvent:_},x)),this._defaultPrevented=!1,this.target=h}}class jc extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,h,_){const x="touchend"===c?_.changedTouches:_.touches,S=an(h.getCanvasContainer(),x),D=S.map(R=>h.unproject(R)),I=S.reduce((R,O,F,j)=>R.add(O.div(j.length)),new p.Point(0,0));super(c,{points:S,point:I,lngLats:D,lngLat:h.unproject(I),originalEvent:_}),this._defaultPrevented=!1}}class zh extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,h,_){super(c,{originalEvent:_}),this._defaultPrevented=!1}}class Md{constructor(c,h){this._map=c,this._clickTolerance=h.clickTolerance}reset(){this._mousedownPos=void 0}wheel(c){return this._firePreventable(new zh(c.type,this._map,c))}mousedown(c,h){return this._mousedownPos=h,this._firePreventable(new Dr(c.type,this._map,c))}mouseup(c){this._map.fire(new Dr(c.type,this._map,c))}preclick(c){const h=p.extend({},c);h.type="preclick",this._map.fire(new Dr(h.type,this._map,h))}click(c,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||(this.preclick(c),this._map.fire(new Dr(c.type,this._map,c)))}dblclick(c){return this._firePreventable(new Dr(c.type,this._map,c))}mouseover(c){this._map.fire(new Dr(c.type,this._map,c))}mouseout(c){this._map.fire(new Dr(c.type,this._map,c))}touchstart(c){return this._firePreventable(new jc(c.type,this._map,c))}touchmove(c){this._map.fire(new jc(c.type,this._map,c))}touchend(c){this._map.fire(new jc(c.type,this._map,c))}touchcancel(c){this._map.fire(new jc(c.type,this._map,c))}_firePreventable(c){if(this._map.fire(c),c.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Vh{constructor(c){this._map=c}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(c){this._map.fire(new Dr(c.type,this._map,c))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Dr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(c){this._delayContextMenu?this._contextMenuEvent=c:this._map.fire(new Dr(c.type,this._map,c)),this._map.listens("contextmenu")&&c.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class u_{constructor(c,h){this._map=c,this._el=c.getCanvasContainer(),this._container=c.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(c,h){this.isEnabled()&&c.shiftKey&&0===c.button&&(xt(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(c,h){if(!this._active)return;const _=h,x=this._startPos,S=this._lastPos;if(!x||!S||S.equals(_)||!this._box&&_.dist(x)<this._clickTolerance)return;this._lastPos=_,this._box||(this._box=Xe("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",c));const D=Math.min(x.x,_.x),I=Math.max(x.x,_.x),R=Math.min(x.y,_.y),O=Math.max(x.y,_.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${D}px,${R}px)`,this._box.style.width=I-D+"px",this._box.style.height=O-R+"px")})}mouseupWindow(c,h){if(!this._active)return;const _=this._startPos,x=h;if(_&&0===c.button){if(this.reset(),Sn(),_.x!==x.x||_.y!==x.y)return this._map.fire(new p.Event("boxzoomend",{originalEvent:c})),{cameraAnimation:S=>S.fitScreenCoordinates(_,x,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",c)}}keydown(c){this._active&&27===c.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",c))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Kt(),delete this._startPos,delete this._lastPos}_fireEvent(c,h){return this._map.fire(new p.Event(c,{originalEvent:h}))}}function Zr(g,c){const h={};for(let _=0;_<g.length;_++)h[g[_].identifier]=c[_];return h}class Cu{constructor(c){this.reset(),this.numTouches=c.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(c,h,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=c.timeStamp),_.length===this.numTouches&&(this.centroid=function(x){const S=new p.Point(0,0);for(const D of x)S._add(D);return S.div(x.length)}(h),this.touches=Zr(_,h)))}touchmove(c,h,_){if(this.aborted||!this.centroid)return;const x=Zr(_,h);for(const S in this.touches){const D=x[S];(!D||D.dist(this.touches[S])>30)&&(this.aborted=!0)}}touchend(c,h,_){if((!this.centroid||c.timeStamp-this.startTime>500)&&(this.aborted=!0),0===_.length){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class Gm{constructor(c){this.singleTap=new Cu(c),this.numTaps=c.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(c,h,_){this.singleTap.touchstart(c,h,_)}touchmove(c,h,_){this.singleTap.touchmove(c,h,_)}touchend(c,h,_){const x=this.singleTap.touchend(c,h,_);if(x){const S=c.timeStamp-this.lastTime<500,D=!this.lastTap||this.lastTap.dist(x)<30;if(S&&D||this.reset(),this.count++,this.lastTime=c.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class jh{constructor(){this._zoomIn=new Gm({numTouches:1,numTaps:2}),this._zoomOut=new Gm({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(c,h,_){this._zoomIn.touchstart(c,h,_),this._zoomOut.touchstart(c,h,_)}touchmove(c,h,_){this._zoomIn.touchmove(c,h,_),this._zoomOut.touchmove(c,h,_)}touchend(c,h,_){const x=this._zoomIn.touchend(c,h,_),S=this._zoomOut.touchend(c,h,_);return x?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:D=>D.easeTo({duration:300,zoom:D.getZoom()+1,around:D.unproject(x)},{originalEvent:c})}):S?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:D=>D.easeTo({duration:300,zoom:D.getZoom()-1,around:D.unproject(S)},{originalEvent:c})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Os={0:1,2:2};class Tu{constructor(c){this.reset(),this._clickTolerance=c.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(c,h){return!1}_move(c,h){return{}}mousedown(c,h){if(this._lastPoint)return;const _=we(c);this._correctButton(c,_)&&(this._lastPoint=h,this._eventButton=_)}mousemoveWindow(c,h){const _=this._lastPoint;if(_)if(c.preventDefault(),null!=this._eventButton&&function(x,S){const D=Os[S];return void 0===x.buttons||(x.buttons&D)!==D}(c,this._eventButton))this.reset();else if(this._moved||!(h.dist(_)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(_,h)}mouseupWindow(c){this._lastPoint&&we(c)===this._eventButton&&(this._moved&&Sn(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ad extends Tu{mousedown(c,h){super.mousedown(c,h),this._lastPoint&&(this._active=!0)}_correctButton(c,h){return 0===h&&!c.ctrlKey}_move(c,h){return{around:h,panDelta:h.sub(c)}}}class ec extends Tu{_correctButton(c,h){return 0===h&&c.ctrlKey||2===h}_move(c,h){const _=.8*(h.x-c.x);if(_)return this._active=!0,{bearingDelta:_}}contextmenu(c){c.preventDefault()}}class ys extends Tu{_correctButton(c,h){return 0===h&&c.ctrlKey||2===h}_move(c,h){const _=-.5*(h.y-c.y);if(_)return this._active=!0,{pitchDelta:_}}contextmenu(c){c.preventDefault()}}class Uh{constructor(c,h){this._map=c,this._el=c.getCanvasContainer(),this._minTouches=1,this._clickTolerance=h.clickTolerance||1,this.reset(),p.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new p.Point(0,0)}touchstart(c,h,_){return this._calculateTransform(c,h,_)}touchmove(c,h,_){if(this._active&&!(_.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===_.length&&!p.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return c.cancelable&&c.preventDefault(),this._calculateTransform(c,h,_)}}touchend(c,h,_){this._calculateTransform(c,h,_),this._active&&_.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(c,h,_){_.length>0&&(this._active=!0);const x=Zr(_,h),S=new p.Point(0,0),D=new p.Point(0,0);let I=0;for(const O in x){const F=x[O],j=this._touches[O];j&&(S._add(F),D._add(F.sub(j)),I++,x[O]=F)}if(this._touches=x,I<this._minTouches||!D.mag())return;const R=D.div(I);return this._sum._add(R),this._sum.mag()<this._clickTolerance?void 0:{around:S.div(I),panDelta:R}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Xe("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class tc{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(c){}_move(c,h,_){return{}}touchstart(c,h,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([h[0],h[1]]))}touchmove(c,h,_){const x=this._firstTwoTouches;if(!x)return;c.preventDefault();const[S,D]=x,I=kd(_,h,S),R=kd(_,h,D);if(!I||!R)return;const O=this._aroundCenter?null:I.add(R).div(2);return this._move([I,R],O,c)}touchend(c,h,_){if(!this._firstTwoTouches)return;const[x,S]=this._firstTwoTouches,D=kd(_,h,x),I=kd(_,h,S);D&&I||(this._active&&Sn(),this.reset())}touchcancel(){this.reset()}enable(c){this._enabled=!0,this._aroundCenter=!!c&&"center"===c.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function kd(g,c,h){for(let _=0;_<g.length;_++)if(g[_].identifier===h)return c[_]}function tl(g,c){return Math.log(g/c)/Math.LN2}class sf extends tc{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(c){this._startDistance=this._distance=c[0].dist(c[1])}_move(c,h){const _=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(tl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:tl(this._distance,_),pinchAround:h}}}function Rd(g,c){return 180*g.angleWith(c)/Math.PI}class di extends tc{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])}_move(c,h){const _=this._vector;if(this._vector=c[0].sub(c[1]),_&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Rd(this._vector,_),pinchAround:h}}_isBelowThreshold(c){this._minDiameter=Math.min(this._minDiameter,c.mag());const h=25/(Math.PI*this._minDiameter)*360,_=this._startVector;if(!_)return!1;const x=Rd(c,_);return Math.abs(x)<h}}function Cl(g){return Math.abs(g.y)>Math.abs(g.x)}class d_ extends tc{constructor(c){super(),this._map=c}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(c){this._lastPoints=c,Cl(c[0].sub(c[1]))&&(this._valid=!1)}_move(c,h,_){const x=this._lastPoints;if(!x)return;const S=c[0].sub(x[0]),D=c[1].sub(x[1]);return this._map._cooperativeGestures&&!p.isFullscreen()&&_.touches.length<3||(this._valid=this.gestureBeginsVertically(S,D,_.timeStamp),!this._valid)?void 0:(this._lastPoints=c,this._active=!0,{pitchDelta:(S.y+D.y)/2*-.5})}gestureBeginsVertically(c,h,_){if(void 0!==this._valid)return this._valid;const x=c.mag()>=2,S=h.mag()>=2;if(!x&&!S)return;if(!x||!S)return null==this._firstMove&&(this._firstMove=_),_-this._firstMove<100&&void 0;const D=c.y>0==h.y>0;return Cl(c)&&Cl(h)&&D}}const qm={panStep:100,bearingStep:15,pitchStep:10};class h_{constructor(){const c=qm;this._panStep=c.panStep,this._bearingStep=c.bearingStep,this._pitchStep=c.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(c){if(c.altKey||c.ctrlKey||c.metaKey)return;let h=0,_=0,x=0,S=0,D=0;switch(c.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:c.shiftKey?_=-1:(c.preventDefault(),S=-1);break;case 39:c.shiftKey?_=1:(c.preventDefault(),S=1);break;case 38:c.shiftKey?x=1:(c.preventDefault(),D=-1);break;case 40:c.shiftKey?x=-1:(c.preventDefault(),D=1);break;default:return}return this._rotationDisabled&&(_=0,x=0),{cameraAnimation:I=>{const R=I.getZoom();I.easeTo({duration:300,easeId:"keyboardHandler",easing:Wm,zoom:h?Math.round(R)+h*(c.shiftKey?2:1):R,bearing:I.getBearing()+_*this._bearingStep,pitch:I.getPitch()+x*this._pitchStep,offset:[-S*this._panStep,-D*this._panStep],center:I.getCenter()},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Wm(g){return g*(2-g)}const Hh=4.000244140625;class Xm{constructor(c,h){this._map=c,this._el=c.getCanvasContainer(),this._handler=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,p.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(c){this._defaultZoomRate=c}setWheelZoomRate(c){this._wheelZoomRate=c}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(c){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!c&&"center"===c.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(c){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(c.ctrlKey||c.metaKey||this.isZooming()||p.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let h=c.deltaMode===p.window.WheelEvent.DOM_DELTA_LINE?40*c.deltaY:c.deltaY;const _=p.exported.now(),x=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,0!==h&&h%Hh==0?this._type="wheel":0!==h&&Math.abs(h)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,c)):this._type||(this._type=Math.abs(x*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),c.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=c,this._delta-=h,this._active||this._start(c)),c.preventDefault()}_onTimeout(c){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)}_start(c){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=st(this._el,c);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:h,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const c=this._map.transform;"wheel"===this._type&&c.projection.wrap&&(c._center.lng>=180||c._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const h=()=>c._terrainEnabled()&&this._aroundCoord?c.computeZoomRelativeTo(this._aroundCoord):c.zoom;if(0!==this._delta){const R="wheel"===this._type&&Math.abs(this._delta)>Hh?this._wheelZoomRate:this._defaultZoomRate;let O=2/(1+Math.exp(-Math.abs(this._delta*R)));this._delta<0&&0!==O&&(O=1/O);const F=h(),j=Math.pow(2,F),Y="number"==typeof this._targetZoom?c.zoomScale(this._targetZoom):j;this._targetZoom=Math.min(c.maxZoom,Math.max(c.minZoom,c.scaleZoom(Y*O))),"wheel"===this._type&&(this._startZoom=F,this._easing=this._smoothOutEasing(200)),this._delta=0}const _="number"==typeof this._targetZoom?this._targetZoom:h(),x=this._startZoom,S=this._easing;let D,I=!1;if("wheel"===this._type&&x&&S){const R=Math.min((p.exported.now()-this._lastWheelEventTime)/200,1),O=S(R);D=p.number(x,_,O),R<1?this._frameId||(this._frameId=!0):I=!0}else D=_,I=!0;return this._active=!0,I&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!I,zoomDelta:D-h(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(c){let h=p.ease;if(this._prevEase){const _=this._prevEase,x=(p.exported.now()-_.start)/_.duration,S=_.easing(x+.01)-_.easing(x),D=.27/Math.sqrt(S*S+1e-4)*.01,I=Math.sqrt(.0729-D*D);h=p.bezier(D,I,.25,1)}return this._prevEase={start:p.exported.now(),duration:c,easing:h},h}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Xe("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(p.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class Zm{constructor(c,h){this._clickZoom=c,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class At{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(c,h){return c.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:_.getZoom()+(c.shiftKey?-1:1),around:_.unproject(h)},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class tr{constructor(){this._tap=new Gm({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(c,h,_){this._swipePoint||(this._tapTime&&c.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?_.length>0&&(this._swipePoint=h[0],this._swipeTouch=_[0].identifier):this._tap.touchstart(c,h,_))}touchmove(c,h,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const x=h[0],S=x.y-this._swipePoint.y;return this._swipePoint=x,c.preventDefault(),this._active=!0,{zoomDelta:S/128}}}else this._tap.touchmove(c,h,_)}touchend(c,h,_){this._tapTime?this._swipePoint&&0===_.length&&this.reset():this._tap.touchend(c,h,_)&&(this._tapTime=c.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Mi{constructor(c,h,_){this._el=c,this._mousePan=h,this._touchPan=_}enable(c){this._inertiaOptions=c||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ai{constructor(c,h,_){this._pitchWithRotate=c.pitchWithRotate,this._mouseRotate=h,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Co{constructor(c,h,_,x){this._el=c,this._touchZoom=h,this._touchRotate=_,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(c){this._touchZoom.enable(c),this._rotationDisabled||this._touchRotate.enable(c),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Xs=g=>g.zoom||g.drag||g.pitch||g.rotate;class Eu extends p.Event{}class nl{constructor(){this.constants=[1,1,.01],this.radius=0}setup(c,h){const _=p.sub([],h,c);this.radius=p.length(_[2]<0?p.div([],_,this.constants):[_[0],_[1],0])}projectRay(c){p.div(c,c,this.constants),p.normalize(c,c),p.mul$1(c,c,this.constants);const h=p.scale$2([],c,this.radius);if(h[2]>0){const _=p.scale$2([],[0,0,1],p.dot(h,[0,0,1])),x=p.scale$2([],p.normalize([],[h[0],h[1],0]),this.radius),S=p.add([],h,p.scale$2([],p.sub([],p.add([],x,_),h),2));h[0]=S[0],h[1]=S[1]}return h}}function Zs(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta}class ua{constructor(c,h){this._map=c,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new $m(c),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new nl,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(h),p.bindAll(["handleEvent","handleWindowEvent"],this);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[p.window.document,"mousemove",{capture:!0}],[p.window.document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[p.window,"blur",void 0]];for(const[x,S,D]of this._listeners)x.addEventListener(S,x===p.window.document?this.handleWindowEvent:this.handleEvent,D)}destroy(){for(const[c,h,_]of this._listeners)c.removeEventListener(h,c===p.window.document?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(c){const h=this._map,_=h.getCanvasContainer();this._add("mapEvent",new Md(h,c));const x=h.boxZoom=new u_(h,c);this._add("boxZoom",x);const S=new jh,D=new At;h.doubleClickZoom=new Zm(D,S),this._add("tapZoom",S),this._add("clickZoom",D);const I=new tr;this._add("tapDragZoom",I);const R=h.touchPitch=new d_(h);this._add("touchPitch",R);const O=new ec(c),F=new ys(c);h.dragRotate=new Ai(c,O,F),this._add("mouseRotate",O,["mousePitch"]),this._add("mousePitch",F,["mouseRotate"]);const j=new Ad(c),Y=new Uh(h,c);h.dragPan=new Mi(_,j,Y),this._add("mousePan",j),this._add("touchPan",Y,["touchZoom","touchRotate"]);const ee=new di,se=new sf;h.touchZoomRotate=new Co(_,se,ee,I),this._add("touchRotate",ee,["touchPan","touchZoom"]),this._add("touchZoom",se,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Vh(h));const ie=h.scrollZoom=new Xm(h,this);this._add("scrollZoom",ie,["mousePan"]);const le=h.keyboard=new h_;this._add("keyboard",le);for(const U of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])c.interactive&&c[U]&&h[U].enable(c[U])}_add(c,h,_){this._handlers.push({handlerName:c,handler:h,allowed:_}),this._handlersById[c]=h}stop(c){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},c),this._changes=[]}}isActive(){for(const{handler:c}of this._handlers)if(c.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Xs(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(c,h,_){for(const x in c)if(x!==_&&(!h||h.indexOf(x)<0))return!0;return!1}handleWindowEvent(c){this.handleEvent(c,`${c.type}Window`)}_getMapTouches(c){const h=[];for(const _ of c)this._el.contains(_.target)&&h.push(_);return h}handleEvent(c,h){this._updatingCamera=!0;const _="renderFrame"===c.type,x=_?void 0:c,S={needsRenderFrame:!1},D={},I={},R=c.touches?this._getMapTouches(c.touches):void 0,O=R?an(this._el,R):_?void 0:st(this._el,c);for(const{handlerName:Y,handler:ee,allowed:se}of this._handlers){if(!ee.isEnabled())continue;let ie;this._blockedByActive(I,se,Y)?ee.reset():ee[h||c.type]&&(ie=ee[h||c.type](c,O,R),this.mergeHandlerResult(S,D,ie,Y,x),ie&&ie.needsRenderFrame&&this._triggerRenderFrame()),(ie||ee.isActive())&&(I[Y]=ee)}const F={};for(const Y in this._previousActiveHandlers)I[Y]||(F[Y]=x);this._previousActiveHandlers=I,(Object.keys(F).length||Zs(S))&&(this._changes.push([S,D,F]),this._triggerRenderFrame()),(Object.keys(I).length||Zs(S))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:j}=S;j&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],j(this._map))}mergeHandlerResult(c,h,_,x,S){if(!_)return;p.extend(c,_);const D={handlerName:x,originalEvent:_.originalEvent||S};void 0!==_.zoomDelta&&(h.zoom=D),void 0!==_.panDelta&&(h.drag=D),void 0!==_.pitchDelta&&(h.pitch=D),void 0!==_.bearingDelta&&(h.rotate=D)}_applyChanges(){const c={},h={},_={};for(const[x,S,D]of this._changes)x.panDelta&&(c.panDelta=(c.panDelta||new p.Point(0,0))._add(x.panDelta)),x.zoomDelta&&(c.zoomDelta=(c.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(c.bearingDelta=(c.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(c.pitchDelta=(c.pitchDelta||0)+x.pitchDelta),void 0!==x.around&&(c.around=x.around),void 0!==x.aroundCoord&&(c.aroundCoord=x.aroundCoord),void 0!==x.pinchAround&&(c.pinchAround=x.pinchAround),x.noInertia&&(c.noInertia=x.noInertia),p.extend(h,S),p.extend(_,D);this._updateMapTransform(c,h,_),this._changes=[]}_updateMapTransform(c,h,_){const x=this._map,S=x.transform,D=J=>[J.x,J.y,J.z];if((J=>{const pe=this._eventsInProgress.drag;return pe&&!this._handlersById[pe.handlerName].isActive()})()&&!Zs(c)){const J=S.zoom;S.cameraElevationReference="sea",S.recenterOnTerrain(),S.cameraElevationReference="ground",J!==S.zoom&&this._map._update(!0)}if(S._isCameraConstrained&&x._stop(!0),!Zs(c))return void this._fireEvents(h,_,!0);let{panDelta:I,zoomDelta:R,bearingDelta:O,pitchDelta:F,around:j,aroundCoord:Y,pinchAround:ee}=c;S._isCameraConstrained&&(R>0&&(R=0),S._isCameraConstrained=!1),void 0!==ee&&(j=ee),(R||(J=>h[J]&&!this._eventsInProgress[J])("drag"))&&j&&(this._dragOrigin=D(S.pointCoordinate3D(j)),this._trackingEllipsoid.setup(S._camera.position,this._dragOrigin)),S.cameraElevationReference="sea",x._stop(!0),j=j||x.transform.centerPoint,O&&(S.bearing+=O),F&&(S.pitch+=F),S._updateCameraState();const se=[0,0,0];if(I)if("mercator"===S.projection.name){const J=this._trackingEllipsoid.projectRay(S.screenPointToMercatorRay(j).dir),pe=this._trackingEllipsoid.projectRay(S.screenPointToMercatorRay(j.sub(I)).dir);se[0]=pe[0]-J[0],se[1]=pe[1]-J[1]}else{const J=S.pointCoordinate(j);if("globe"===S.projection.name){I=I.rotate(-S.angle);const pe=S._pixelsPerMercatorPixel/S.worldSize;se[0]=-I.x*p.mercatorScale(p.latFromMercatorY(J.y))*pe,se[1]=-I.y*p.mercatorScale(S.center.lat)*pe}else{const pe=S.pointCoordinate(j.sub(I));J&&pe&&(se[0]=pe.x-J.x,se[1]=pe.y-J.y)}}const ie=S.zoom,le=[0,0,0];if(R){const J=D(Y||S.pointCoordinate3D(j)),pe={dir:p.normalize([],p.sub([],J,S._camera.position))};if(pe.dir[2]<0){const ge=S.zoomDeltaToMovement(J,R);p.scale$2(le,pe.dir,ge)}}const U=p.add(se,se,le);S._translateCameraConstrained(U),R&&Math.abs(S.zoom-ie)>1e-4&&S.recenterOnTerrain(),S.cameraElevationReference="ground",this._map._update(),c.noInertia||this._inertia.record(c),this._fireEvents(h,_,!0)}_fireEvents(c,h,_){const x=Xs(this._eventsInProgress),S=Xs(c),D={};for(const F in c){const{originalEvent:j}=c[F];this._eventsInProgress[F]||(D[`${F}start`]=j),this._eventsInProgress[F]=c[F]}!x&&S&&this._fireEvent("movestart",S.originalEvent);for(const F in D)this._fireEvent(F,D[F]);S&&this._fireEvent("move",S.originalEvent);for(const F in c){const{originalEvent:j}=c[F];this._fireEvent(F,j)}const I={};let R;for(const F in this._eventsInProgress){const{handlerName:j,originalEvent:Y}=this._eventsInProgress[F];this._handlersById[j].isActive()||(delete this._eventsInProgress[F],R=h[j]||Y,I[`${F}end`]=R)}for(const F in I)this._fireEvent(F,I[F]);const O=Xs(this._eventsInProgress);if(_&&(x||S)&&!O){this._updatingCamera=!0;const F=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),j=Y=>0!==Y&&-this._bearingSnap<Y&&Y<this._bearingSnap;F?(j(F.bearing||this._map.getBearing())&&(F.bearing=0),this._map.easeTo(F,{originalEvent:R})):(this._map.fire(new p.Event("moveend",{originalEvent:R})),j(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(c,h){this._map.fire(new p.Event(c,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(c=>{this._frameId=void 0,this.handleEvent(new Eu("renderFrame",{timeStamp:c})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Du="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class $h extends p.Evented{constructor(c,h){super(),this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=h.bearingSnap,this._respectPrefersReducedMotion=!1!==h.respectPrefersReducedMotion,p.bindAll(["_renderFrameCallback"],this)}getCenter(){return new p.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(c,h){return this.jumpTo({center:c},h)}panBy(c,h,_){return c=p.Point.convert(c).mult(-1),this.panTo(this.transform.center,p.extend({offset:c},h),_)}panTo(c,h,_){return this.easeTo(p.extend({center:c},h),_)}getZoom(){return this.transform.zoom}setZoom(c,h){return this.jumpTo({zoom:c},h),this}zoomTo(c,h,_){return this.easeTo(p.extend({zoom:c},h),_)}zoomIn(c,h){return this.zoomTo(this.getZoom()+1,c,h),this}zoomOut(c,h){return this.zoomTo(this.getZoom()-1,c,h),this}getBearing(){return this.transform.bearing}setBearing(c,h){return this.jumpTo({bearing:c},h),this}getPadding(){return this.transform.padding}setPadding(c,h){return this.jumpTo({padding:c},h),this}rotateTo(c,h,_){return this.easeTo(p.extend({bearing:c},h),_)}resetNorth(c,h){return this.rotateTo(0,p.extend({duration:1e3},c),h),this}resetNorthPitch(c,h){return this.easeTo(p.extend({bearing:0,pitch:0,duration:1e3},c),h),this}snapToNorth(c,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,h):this}getPitch(){return this.transform.pitch}setPitch(c,h){return this.jumpTo({pitch:c},h),this}cameraForBounds(c,h){c=p.LngLatBounds.convert(c);const _=h&&h.bearing||0,x=h&&h.pitch||0,S=c.getNorthWest(),D=c.getSouthEast();return this._cameraForBounds(this.transform,S,D,_,x,h)}_extendCameraOptions(c){const h={top:0,bottom:0,right:0,left:0};if("number"==typeof(c=p.extend({padding:h,offset:[0,0],maxZoom:this.transform.maxZoom},c)).padding){const _=c.padding;c.padding={top:_,bottom:_,right:_,left:_}}return c.padding=p.extend(h,c.padding),c}_minimumAABBFrustumDistance(c,h){const _=h.max[0]-h.min[0],x=h.max[1]-h.min[1];return _/x>c.aspect?_/(2*Math.tan(.5*c.fovX)*c.aspect):x/(2*Math.tan(.5*c.fovY)*c.aspect)}_cameraForBoundsOnGlobe(c,h,_,x,S,D){const I=c.clone(),R=this._extendCameraOptions(D);I.bearing=x,I.pitch=S;const O=p.LngLat.convert(h),F=p.LngLat.convert(_),j=.5*(O.lat+F.lat),Y=.5*(O.lng+F.lng),ee=p.latLngToECEF(j,Y),se=p.normalize([],ee),ie=p.normalize([],p.cross([],se,[0,1,0])),le=p.cross([],ie,se),U=[ie[0],ie[1],ie[2],0,le[0],le[1],le[2],0,se[0],se[1],se[2],0,0,0,0,1],J=[ee,p.latLngToECEF(O.lat,O.lng),p.latLngToECEF(F.lat,O.lng),p.latLngToECEF(F.lat,F.lng),p.latLngToECEF(O.lat,F.lng),p.latLngToECEF(j,O.lng),p.latLngToECEF(j,F.lng),p.latLngToECEF(O.lat,Y),p.latLngToECEF(F.lat,Y)];let pe=p.Aabb.fromPoints(J.map(Mt=>[p.dot(ie,Mt),p.dot(le,Mt),p.dot(se,Mt)]));const ge=p.transformMat4([],pe.center,U);0===p.squaredLength(ge)&&p.set(ge,0,0,1),p.normalize(ge,ge),p.scale$2(ge,ge,p.GLOBE_RADIUS),I.center=p.ecefToLatLng(ge);const Fe=I.getWorldToCameraMatrix(),Pe=p.invert(new Float64Array(16),Fe);pe=p.Aabb.applyTransform(pe,p.multiply([],Fe,U)),p.transformMat4(ge,ge,Fe);const Oe=.5*(pe.max[2]-pe.min[2]),We=this._minimumAABBFrustumDistance(I,pe),He=p.scale$2([],[0,0,1],Oe),ot=p.add(He,ge,He),Ft=We+(0===I.pitch?0:p.distance(ge,ot)),nt=I.globeCenterInViewSpace,St=p.sub([],ge,[nt[0],nt[1],nt[2]]);p.normalize(St,St),p.scale$2(St,St,Ft);const pt=p.add([],ge,St);p.transformMat4(pt,pt,Pe);const Nt=p.earthRadius/p.GLOBE_RADIUS,it=p.length(pt),vt=p.mercatorZfromAltitude(Math.max(it*Nt-p.earthRadius,Number.EPSILON),0),Bt=Math.min(I.zoomFromMercatorZAdjusted(vt),R.maxZoom);return Bt>.5*(p.GLOBE_ZOOM_THRESHOLD_MIN+p.GLOBE_ZOOM_THRESHOLD_MAX)?(I.setProjection({name:"mercator"}),I.zoom=Bt,this._cameraForBounds(I,h,_,x,S,D)):{center:I.center,zoom:Bt,bearing:x,pitch:S}}queryTerrainElevation(c,h){const _=this.transform.elevation;return _?(h=p.extend({},{exaggerated:!0},h),_.getAtPoint(p.MercatorCoordinate.fromLngLat(c),null,h.exaggerated)):null}_cameraForBounds(c,h,_,x,S,D){if("globe"===c.projection.name)return this._cameraForBoundsOnGlobe(c,h,_,x,S,D);const I=c.clone(),R=this._extendCameraOptions(D),O=I.padding;I.bearing=x,I.pitch=S;const F=p.LngLat.convert(h),j=p.LngLat.convert(_),Y=new p.LngLat(F.lng,j.lat),ee=new p.LngLat(j.lng,F.lat),se=I.project(F),ie=I.project(j),le=this.queryTerrainElevation(F),U=this.queryTerrainElevation(j),J=this.queryTerrainElevation(Y),pe=this.queryTerrainElevation(ee),ge=[[se.x,se.y,Math.min(le||0,U||0,J||0,pe||0)],[ie.x,ie.y,Math.max(le||0,U||0,J||0,pe||0)]];let Fe=p.Aabb.fromPoints(ge);const Pe=I.getWorldToCameraMatrix(),Oe=p.invert(new Float64Array(16),Pe);Fe=p.Aabb.applyTransform(Fe,Pe);const We=p.sub([],Fe.max,Fe.min),He=O.left||0,ot=O.right||0,Ft=O.bottom||0,nt=O.top||0,{left:St,right:pt,top:Nt,bottom:it}=R.padding,vt=.5*(He+ot),Bt=.5*(nt+Ft),Mt=Math.min(I.scaleZoom(I.scale*Math.min((I.width-(He+ot+St+pt))/We[0],(I.height-(Ft+nt+it+Nt))/We[1])),R.maxZoom),Vt=I.scale/I.zoomScale(Mt);Fe=new p.Aabb([Fe.min[0]-(St+vt)*Vt,Fe.min[1]-(it+Bt)*Vt,Fe.min[2]],[Fe.max[0]+(pt+vt)*Vt,Fe.max[1]+(Nt+Bt)*Vt,Fe.max[2]]);const In=.5*We[2],zn=this._minimumAABBFrustumDistance(I,Fe),bn=[0,0,1,0];p.transformMat4$1(bn,bn,Pe),p.normalize$2(bn,bn);const An=p.scale$2([],bn,zn+In),gi=p.add([],Fe.center,An),oi=("number"==typeof R.offset.x&&"number"==typeof R.offset.y?new p.Point(R.offset.x,R.offset.y):p.Point.convert(R.offset)).rotate(-p.degToRad(x));Fe.center[0]-=oi.x*Vt,Fe.center[1]+=oi.y*Vt,p.transformMat4(Fe.center,Fe.center,Oe),p.transformMat4(gi,gi,Oe);const En=[Fe.center[0],Fe.center[1],gi[2]*I.pixelsPerMeter];p.scale$2(En,En,1/I.worldSize);const nr=p.lngFromMercatorX(En[0]),pr=p.latFromMercatorY(En[1]),_r=Math.min(I._zoomFromMercatorZ(En[2]),R.maxZoom),ki=new p.LngLat(nr,pr);return I.mercatorFromTransition&&_r<.5*(p.GLOBE_ZOOM_THRESHOLD_MIN+p.GLOBE_ZOOM_THRESHOLD_MAX)?(I.setProjection({name:"globe"}),I.zoom=_r,this._cameraForBounds(I,h,_,x,S,D)):{center:ki,zoom:_r,bearing:x,pitch:S}}fitBounds(c,h,_){const x=this.cameraForBounds(c,h);return this._fitInternal(x,h,_)}fitScreenCoordinates(c,h,_,x,S){const D=p.Point.convert(c),I=p.Point.convert(h),R=new p.Point(Math.min(D.x,I.x),Math.min(D.y,I.y)),O=new p.Point(Math.max(D.x,I.x),Math.max(D.y,I.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(D,I))return this;const F=this.transform.pointLocation3D(R),j=this.transform.pointLocation3D(O),Y=this.transform.pointLocation3D(new p.Point(R.x,O.y)),ee=this.transform.pointLocation3D(new p.Point(O.x,R.y)),se=[Math.min(F.lng,j.lng,Y.lng,ee.lng),Math.min(F.lat,j.lat,Y.lat,ee.lat)],ie=[Math.max(F.lng,j.lng,Y.lng,ee.lng),Math.max(F.lat,j.lat,Y.lat,ee.lat)],le=x&&x.pitch?x.pitch:this.getPitch(),U=this._cameraForBounds(this.transform,se,ie,_,le,x);return this._fitInternal(U,x,S)}_fitInternal(c,h,_){return c?(delete(h=p.extend(c,h)).padding,h.linear?this.easeTo(h,_):this.flyTo(h,_)):this}jumpTo(c,h){this.stop();const _=c.preloadOnly?this.transform.clone():this.transform;let x=!1,S=!1,D=!1;return"zoom"in c&&_.zoom!==+c.zoom&&(x=!0,_.zoom=+c.zoom),void 0!==c.center&&(_.center=p.LngLat.convert(c.center)),"bearing"in c&&_.bearing!==+c.bearing&&(S=!0,_.bearing=+c.bearing),"pitch"in c&&_.pitch!==+c.pitch&&(D=!0,_.pitch=+c.pitch),null==c.padding||_.isPaddingEqual(c.padding)||(_.padding=c.padding),c.preloadOnly?(this._preloadTiles(_),this):(this.fire(new p.Event("movestart",h)).fire(new p.Event("move",h)),x&&this.fire(new p.Event("zoomstart",h)).fire(new p.Event("zoom",h)).fire(new p.Event("zoomend",h)),S&&this.fire(new p.Event("rotatestart",h)).fire(new p.Event("rotate",h)).fire(new p.Event("rotateend",h)),D&&this.fire(new p.Event("pitchstart",h)).fire(new p.Event("pitch",h)).fire(new p.Event("pitchend",h)),this.fire(new p.Event("moveend",h)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||p.warnOnce(Du),this.transform.getFreeCameraOptions()}setFreeCameraOptions(c,h){const _=this.transform;if(!_.projection.supportsFreeCamera)return p.warnOnce(Du),this;this.stop();const x=_.zoom,S=_.pitch,D=_.bearing;_.setFreeCameraOptions(c);const I=x!==_.zoom,R=S!==_.pitch,O=D!==_.bearing;return this.fire(new p.Event("movestart",h)).fire(new p.Event("move",h)),I&&this.fire(new p.Event("zoomstart",h)).fire(new p.Event("zoom",h)).fire(new p.Event("zoomend",h)),O&&this.fire(new p.Event("rotatestart",h)).fire(new p.Event("rotate",h)).fire(new p.Event("rotateend",h)),R&&this.fire(new p.Event("pitchstart",h)).fire(new p.Event("pitch",h)).fire(new p.Event("pitchend",h)),this.fire(new p.Event("moveend",h)),this}easeTo(c,h){this._stop(!1,c.easeId),(!1===(c=p.extend({offset:[0,0],duration:500,easing:p.ease},c)).animate||this._prefersReducedMotion(c))&&(c.duration=0);const _=this.transform,x=this.getZoom(),S=this.getBearing(),D=this.getPitch(),I=this.getPadding(),R="zoom"in c?+c.zoom:x,O="bearing"in c?this._normalizeBearing(c.bearing,S):S,F="pitch"in c?+c.pitch:D,j="padding"in c?c.padding:_.padding,Y=p.Point.convert(c.offset);let ee,se,ie;if("globe"===_.projection.name){const He=p.MercatorCoordinate.fromLngLat(_.center),ot=Y.rotate(-_.angle);He.x+=ot.x/_.worldSize,He.y+=ot.y/_.worldSize;const Ft=He.toLngLat(),nt=p.LngLat.convert(c.center||Ft);this._normalizeCenter(nt),ee=_.centerPoint.add(ot),se=new p.Point(He.x,He.y).mult(_.worldSize),ie=new p.Point(p.mercatorXfromLng(nt.lng),p.mercatorYfromLat(nt.lat)).mult(_.worldSize).sub(se)}else{ee=_.centerPoint.add(Y);const He=_.pointLocation(ee),ot=p.LngLat.convert(c.center||He);this._normalizeCenter(ot),se=_.project(He),ie=_.project(ot).sub(se)}const le=_.zoomScale(R-x);let U,J;c.around&&(U=p.LngLat.convert(c.around),J=_.locationPoint(U));const pe=this._zooming||R!==x,ge=this._rotating||S!==O,Fe=this._pitching||F!==D,Pe=!_.isPaddingEqual(j),Oe=He=>ot=>{if(pe&&(He.zoom=p.number(x,R,ot)),ge&&(He.bearing=p.number(S,O,ot)),Fe&&(He.pitch=p.number(D,F,ot)),Pe&&(He.interpolatePadding(I,j,ot),ee=He.centerPoint.add(Y)),U)He.setLocationAtPoint(U,J);else{const Ft=He.zoomScale(He.zoom-x),nt=R>x?Math.min(2,le):Math.max(.5,le),St=Math.pow(nt,1-ot),pt=He.unproject(se.add(ie.mult(ot*St)).mult(Ft));He.setLocationAtPoint(He.renderWorldCopies?pt.wrap():pt,ee)}return c.preloadOnly||this._fireMoveEvents(h),He};if(c.preloadOnly){const He=this._emulate(Oe,c.duration,_);return this._preloadTiles(He),this}const We={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=pe,this._rotating=ge,this._pitching=Fe,this._padding=Pe,this._easeId=c.easeId,this._prepareEase(h,c.noMoveStart,We),this._ease(Oe(_),He=>{_.recenterOnTerrain(),this._afterEase(h,He)},c),this}_prepareEase(c,h,_={}){this._moving=!0,this.transform.cameraElevationReference="sea",h||_.moving||this.fire(new p.Event("movestart",c)),this._zooming&&!_.zooming&&this.fire(new p.Event("zoomstart",c)),this._rotating&&!_.rotating&&this.fire(new p.Event("rotatestart",c)),this._pitching&&!_.pitching&&this.fire(new p.Event("pitchstart",c))}_fireMoveEvents(c){this.fire(new p.Event("move",c)),this._zooming&&this.fire(new p.Event("zoom",c)),this._rotating&&this.fire(new p.Event("rotate",c)),this._pitching&&this.fire(new p.Event("pitch",c))}_afterEase(c,h){if(this._easeId&&h&&this._easeId===h)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const _=this._zooming,x=this._rotating,S=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new p.Event("zoomend",c)),x&&this.fire(new p.Event("rotateend",c)),S&&this.fire(new p.Event("pitchend",c)),this.fire(new p.Event("moveend",c))}flyTo(c,h){if(this._prefersReducedMotion(c)){const Mt=p.pick(c,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Mt,h)}this.stop(),c=p.extend({offset:[0,0],speed:1.2,curve:1.42,easing:p.ease},c);const _=this.transform,x=this.getZoom(),S=this.getBearing(),D=this.getPitch(),I=this.getPadding(),R="zoom"in c?p.clamp(+c.zoom,_.minZoom,_.maxZoom):x,O="bearing"in c?this._normalizeBearing(c.bearing,S):S,F="pitch"in c?+c.pitch:D,j="padding"in c?c.padding:_.padding,Y=_.zoomScale(R-x),ee=p.Point.convert(c.offset);let se=_.centerPoint.add(ee);const ie=_.pointLocation(se),le=p.LngLat.convert(c.center||ie);this._normalizeCenter(le);const U=_.project(ie),J=_.project(le).sub(U);let pe=c.curve;const ge=Math.max(_.width,_.height),Fe=ge/Y,Pe=J.mag();if("minZoom"in c){const Mt=p.clamp(Math.min(c.minZoom,x,R),_.minZoom,_.maxZoom),Vt=ge/_.zoomScale(Mt-x);pe=Math.sqrt(Vt/Pe*2)}const Oe=pe*pe;function We(Mt){const Vt=(Fe*Fe-ge*ge+(Mt?-1:1)*Oe*Oe*Pe*Pe)/(2*(Mt?Fe:ge)*Oe*Pe);return Math.log(Math.sqrt(Vt*Vt+1)-Vt)}function He(Mt){return(Math.exp(Mt)-Math.exp(-Mt))/2}function ot(Mt){return(Math.exp(Mt)+Math.exp(-Mt))/2}const Ft=We(0);let nt=function(Mt){return ot(Ft)/ot(Ft+pe*Mt)},St=function(Mt){return ge*((ot(Ft)*(He(Vt=Ft+pe*Mt)/ot(Vt))-He(Ft))/Oe)/Pe;var Vt},pt=(We(1)-Ft)/pe;if(Math.abs(Pe)<1e-6||!isFinite(pt)){if(Math.abs(ge-Fe)<1e-6)return this.easeTo(c,h);const Mt=Fe<ge?-1:1;pt=Math.abs(Math.log(Fe/ge))/pe,St=function(){return 0},nt=function(Vt){return Math.exp(Mt*pe*Vt)}}c.duration="duration"in c?+c.duration:1e3*pt/("screenSpeed"in c?+c.screenSpeed/pe:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0);const Nt=S!==O,it=F!==D,vt=!_.isPaddingEqual(j),Bt=Mt=>Vt=>{const In=Vt*pt,zn=1/nt(In);Mt.zoom=1===Vt?R:x+Mt.scaleZoom(zn),Nt&&(Mt.bearing=p.number(S,O,Vt)),it&&(Mt.pitch=p.number(D,F,Vt)),vt&&(Mt.interpolatePadding(I,j,Vt),se=Mt.centerPoint.add(ee));const bn=1===Vt?le:Mt.unproject(U.add(J.mult(St(In))).mult(zn));return Mt.setLocationAtPoint(Mt.renderWorldCopies?bn.wrap():bn,se),Mt._updateCameraOnTerrain(),c.preloadOnly||this._fireMoveEvents(h),Mt};if(c.preloadOnly){const Mt=this._emulate(Bt,c.duration,_);return this._preloadTiles(Mt),this}return this._zooming=!0,this._rotating=Nt,this._pitching=it,this._padding=vt,this._prepareEase(h,!1),this._ease(Bt(_),()=>this._afterEase(h),c),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(c,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const _=this._onEaseEnd;this._onEaseEnd=void 0,_.call(this,h)}if(!c){const _=this.handlers;_&&_.stop(!1)}return this}_ease(c,h,_){!1===_.animate||0===_.duration?(c(1),h()):(this._easeStart=p.exported.now(),this._easeOptions=_,this._onEaseFrame=c,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const c=Math.min((p.exported.now()-this._easeStart)/this._easeOptions.duration,1),h=this._onEaseFrame;h&&h(this._easeOptions.easing(c)),c<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(c,h){c=p.wrap(c,-180,180);const _=Math.abs(c-h);return Math.abs(c-360-h)<_&&(c-=360),Math.abs(c+360-h)<_&&(c+=360),c}_normalizeCenter(c){const h=this.transform;if(!h.renderWorldCopies||h.maxBounds)return;const _=c.lng-h.center.lng;c.lng+=_>180?-360:_<-180?360:0}_prefersReducedMotion(c){return this._respectPrefersReducedMotion&&p.exported.prefersReducedMotion&&!(c&&c.essential)}_emulate(c,h,_){const x=Math.ceil(15*h/1e3),S=[],D=c(_.clone());for(let I=0;I<=x;I++){const R=D(I/x);S.push(R.clone())}return S}}class gn{constructor(c={}){this.options=c,p.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(c){const h=this.options&&this.options.compact;return this._map=c,this._container=Xe("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Xe("button","mapboxgl-ctrl-attrib-button",this._container),Xe("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Xe("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===h&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(c,h){const _=this._map._getUIString(`AttributionControl.${h}`);c.setAttribute("aria-label",_),c.removeAttribute("title"),c.firstElementChild&&c.firstElementChild.setAttribute("title",_)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let c=this._editLink;c||(c=this._editLink=this._container.querySelector(".mapbox-improve-map"));const h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||p.config.ACCESS_TOKEN}];if(c){const _=h.reduce((x,S,D)=>(S.value&&(x+=`${S.key}=${S.value}${D<h.length-1?"&":""}`),x),"?");c.href=`${p.config.FEEDBACK_URL}/${_}#${cr(this._map,!0)}`,c.rel="noopener nofollow",this._setElementTitle(c,"MapFeedback")}}_updateData(c){!c||"metadata"!==c.sourceDataType&&"visibility"!==c.sourceDataType&&"style"!==c.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let c=[];if(this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const h=this._map.style._sourceCaches;for(const x in h){const S=h[x];if(S.used){const D=S.getSource();D.attribution&&c.indexOf(D.attribution)<0&&c.push(D.attribution)}}c.sort((x,S)=>x.length-S.length),c=c.filter((x,S)=>{for(let D=S+1;D<c.length;D++)if(c[D].indexOf(x)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?c=[...this.options.customAttribution,...c]:c.unshift(this.options.customAttribution));const _=c.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,c.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Gh{constructor(){p.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(c){this._map=c,this._container=Xe("div","mapboxgl-ctrl");const h=Xe("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(c){c&&"metadata"!==c.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const c=this._map.style._sourceCaches;if(0===Object.entries(c).length)return!0;for(const h in c){const _=c[h].getSource();if(_.hasOwnProperty("mapbox_logo")&&!_.mapbox_logo)return!1}return!0}_updateCompact(){const c=this._container.children;if(c.length){const h=c[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}}}class jo{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(c){const h=++this._id;return this._queue.push({callback:c,id:h,cancelled:!1}),h}remove(c){const h=this._currentlyRunning,_=h?this._queue.concat(h):this._queue;for(const x of _)if(x.id===c)return void(x.cancelled=!0)}run(c=0){const h=this._currentlyRunning=this._queue;this._queue=[];for(const _ of h)if(!_.cancelled&&(_.callback(c),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Fs(g,c,h){if(g=new p.LngLat(g.lng,g.lat),c){const _=new p.LngLat(g.lng-360,g.lat),x=new p.LngLat(g.lng+360,g.lat),S=360*Math.ceil(Math.abs(g.lng-h.center.lng)/360),D=h.locationPoint(g).distSqr(c),I=c.x<0||c.y<0||c.x>h.width||c.y>h.height;h.locationPoint(_).distSqr(c)<D&&(I||Math.abs(_.lng-h.center.lng)<S)?g=_:h.locationPoint(x).distSqr(c)<D&&(I||Math.abs(x.lng-h.center.lng)<S)&&(g=x)}for(;Math.abs(g.lng-h.center.lng)>180;){const _=h.locationPoint(g);if(_.x>=0&&_.y>=0&&_.x<=h.width&&_.y<=h.height)break;g.lng>h.center.lng?g.lng-=360:g.lng+=360}return g}const nc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class on extends p.Evented{constructor(c,h){if(super(),(c instanceof p.window.HTMLElement||h)&&(c=p.extend({element:c},h)),p.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=c&&c.occludedOpacity||.2,c&&c.element)this._element=c.element,this._offset=p.Point.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=Xe("div");const x=41,S=27,D=gt("svg",{display:"block",height:x*this._scale+"px",width:S*this._scale+"px",viewBox:`0 0 ${S} ${x}`},this._element),I=gt("radialGradient",{id:"shadowGradient"},gt("defs",{},D));gt("stop",{offset:"10%","stop-opacity":.4},I),gt("stop",{offset:"100%","stop-opacity":.05},I),gt("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},D),gt("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},D),gt("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},D),gt("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},D),this._offset=p.Point.convert(c&&c.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",x=>{x.preventDefault()}),this._element.addEventListener("mousedown",x=>{x.preventDefault()});const _=this._element.classList;for(const x in nc)_.remove(`mapboxgl-marker-anchor-${x}`);_.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(c){return c===this._map||(this.remove(),this._map=c,c.getCanvasContainer().appendChild(this._element),c.on("move",this._updateMoving),c.on("moveend",this._update),c.on("remove",this._clearFadeTimer),c._addMarker(this),this.setDraggable(this._draggable),this._update(),c.on("click",this._onMapClick)),this}remove(){const c=this._map;return c&&(c.off("click",this._onMapClick),c.off("move",this._updateMoving),c.off("moveend",this._update),c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler),c.off("mouseup",this._onUp),c.off("touchend",this._onUp),c.off("mousemove",this._onMove),c.off("touchmove",this._onMove),c.off("remove",this._clearFadeTimer),c._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(c){return this._lngLat=p.LngLat.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){const x=Math.sqrt(Math.pow(13.5,2)/2);c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(24.6+x)],"bottom-right":[-x,-1*(24.6+x)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=c,c._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(c){const h=c.code,_=c.charCode||c.keyCode;"Space"!==h&&"Enter"!==h&&32!==_&&13!==_||this.togglePopup()}_onMapClick(c){const h=c.originalEvent.target,_=this._element;this._popup&&(h===_||_.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const c=this._popup;return c?(c.isOpen()?(c.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(c.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const c=this._map,h=this._pos;if(!c||!h)return!1;const _=c.unproject(h),x=c.getFreeCameraOptions();if(!x.position)return!1;const S=x.position.toLngLat();return S.distanceTo(_)<.9*S.distanceTo(this._lngLat)}_evaluateOpacity(){const c=this._map;if(!c)return;const h=this._pos;if(!h||h.x<0||h.x>c.transform.width||h.y<0||h.y>c.transform.height)return void this._clearFadeTimer();const _=c.unproject(h);let x;c._showingGlobe()&&p.isLngLatBehindGlobe(c.transform,this._lngLat)?x=0:(x=1-c._queryFogOpacity(_),c.transform._terrainEnabled()&&c.getTerrain()&&this._behindTerrain()&&(x*=this._occludedOpacity)),this._element.style.opacity=`${x}`,this._element.style.pointerEvents=x>0?"auto":"none",this._popup&&this._popup._setOpacity(x),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const c=this._pos;if(!c||!this._map)return;const h=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${c.x}px,${c.y}px)\n            ${nc[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${h.x}px,${h.y}px)\n        `}_calculateXYTransform(){const c=this._pos,h=this._map,_=this.getPitchAlignment();if(!h||!c||"map"!==_)return"";if(!h._showingGlobe()){const R=h.getPitch();return R?`rotateX(${R}deg)`:""}const x=p.radToDeg(p.globeTiltAtLngLat(h.transform,this._lngLat)),S=c.sub(p.globeCenterToScreenPoint(h.transform)),D=Math.abs(S.x)+Math.abs(S.y);if(0===D)return"";const I=x/D;return`rotateX(${-S.y*I}deg) rotateY(${S.x*I}deg)`}_calculateZTransform(){const c=this._pos,h=this._map;if(!h||!c)return"";let _=0;const x=this.getRotationAlignment();if("map"===x)if(h._showingGlobe()){const S=h.project(new p.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),D=h.project(new p.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(S);_=p.radToDeg(Math.atan2(D.y,D.x))-90}else _=-h.getBearing();else if("horizon"===x){const S=p.smoothstep(4,6,h.getZoom()),D=p.globeCenterToScreenPoint(h.transform);D.y+=S*h.transform.height;const I=c.sub(D),R=p.radToDeg(Math.atan2(I.y,I.x));_=(R>90?R-270:R+90)*(1-S)}return _+=this._rotation,_?`rotateZ(${_}deg)`:""}_update(c){p.window.cancelAnimationFrame(this._updateFrameId);const h=this._map;h&&(h.transform.renderWorldCopies&&(this._lngLat=Fs(this._lngLat,this._pos,h.transform)),this._pos=h.project(this._lngLat),!0===c?this._updateFrameId=p.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),h._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(h._showingGlobe()||h.getTerrain()||h.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(c){return this._offset=p.Point.convert(c),this._update(),this}_onMove(c){const h=this._map;if(!h)return;const _=this._pointerdownPos,x=this._positionDelta;if(_&&x){if(!this._isDragging){const S=this._clickTolerance||h._clickTolerance;if(c.point.dist(_)<S)return;this._isDragging=!0}this._pos=c.point.sub(x),this._lngLat=h.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new p.Event("dragstart"))),this.fire(new p.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const c=this._map;c&&(c.off("mousemove",this._onMove),c.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new p.Event("dragend")),this._state="inactive"}_addDragHandler(c){const h=this._map,_=this._pos;h&&_&&this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(_),this._pointerdownPos=c.point,this._state="pending",h.on("mousemove",this._onMove),h.on("touchmove",this._onMove),h.once("mouseup",this._onUp),h.once("touchend",this._onUp))}setDraggable(c){this._draggable=!!c;const h=this._map;return h&&(c?(h.on("mousedown",this._addDragHandler),h.on("touchstart",this._addDragHandler)):(h.off("mousedown",this._addDragHandler),h.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(c){return this._rotation=c||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(c){return this._rotationAlignment=c||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(c){return this._pitchAlignment=c||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(c){return this._occludedOpacity=c||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Ma={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},p_=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function af(g=new p.Point(0,0),c="bottom"){if("number"==typeof g){const h=Math.round(Math.sqrt(.5*Math.pow(g,2)));switch(c){case"top":return new p.Point(0,g);case"top-left":return new p.Point(h,h);case"top-right":return new p.Point(-h,h);case"bottom":return new p.Point(0,-g);case"bottom-left":return new p.Point(h,-h);case"bottom-right":return new p.Point(-h,-h);case"left":return new p.Point(g,0);case"right":return new p.Point(-g,0)}return new p.Point(0,0)}return g instanceof p.Point||Array.isArray(g)?p.Point.convert(g):p.Point.convert(g[c]||[0,0])}class lf{constructor(c){this.jumpTo(c)}getValue(c){if(c<=this._startTime)return this._start;if(c>=this._endTime)return this._end;const h=p.easeCubicInOut((c-this._startTime)/(this._endTime-this._startTime));return this._start*(1-h)+this._end*h}isEasing(c){return c>=this._startTime&&c<=this._endTime}jumpTo(c){this._startTime=-1/0,this._endTime=-1/0,this._start=c,this._end=c}easeTo(c,h,_){this._start=this.getValue(h),this._end=c,this._startTime=h,this._endTime=h+_}}const Ym={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},qh={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},cf={showCompass:!0,showZoom:!0,visualizePitch:!1};class Km{constructor(c,h,_=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new ec({clickTolerance:c.dragRotate._mouseRotate._clickTolerance}),this.map=c,_&&(this.mousePitch=new ys({clickTolerance:c.dragRotate._mousePitch._clickTolerance})),p.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),h.addEventListener("mousedown",this.mousedown),h.addEventListener("touchstart",this.touchstart,{passive:!1}),h.addEventListener("touchmove",this.touchmove),h.addEventListener("touchend",this.touchend),h.addEventListener("touchcancel",this.reset)}down(c,h){this.mouseRotate.mousedown(c,h),this.mousePitch&&this.mousePitch.mousedown(c,h),xt()}move(c,h){const _=this.map,x=this.mouseRotate.mousemoveWindow(c,h),S=x&&x.bearingDelta;if(S&&_.setBearing(_.getBearing()+S),this.mousePitch){const D=this.mousePitch.mousemoveWindow(c,h),I=D&&D.pitchDelta;I&&_.setPitch(_.getPitch()+I)}}off(){const c=this.element;c.removeEventListener("mousedown",this.mousedown),c.removeEventListener("touchstart",this.touchstart,{passive:!1}),c.removeEventListener("touchmove",this.touchmove),c.removeEventListener("touchend",this.touchend),c.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Kt(),p.window.removeEventListener("mousemove",this.mousemove),p.window.removeEventListener("mouseup",this.mouseup)}mousedown(c){this.down(p.extend({},c,{ctrlKey:!0,preventDefault:()=>c.preventDefault()}),st(this.element,c)),p.window.addEventListener("mousemove",this.mousemove),p.window.addEventListener("mouseup",this.mouseup)}mousemove(c){this.move(c,st(this.element,c))}mouseup(c){this.mouseRotate.mouseupWindow(c),this.mousePitch&&this.mousePitch.mouseupWindow(c),this.offTemp()}touchstart(c){1!==c.targetTouches.length?this.reset():(this._startPos=this._lastPos=an(this.element,c.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>c.preventDefault()},this._startPos))}touchmove(c){1!==c.targetTouches.length?this.reset():(this._lastPos=an(this.element,c.targetTouches)[0],this.move({preventDefault:()=>c.preventDefault()},this._lastPos))}touchend(c){0===c.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Pd={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},uf={maxWidth:100,unit:"metric"},Wh={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},ic={version:p.version,supported:Ye,setRTLTextPlugin:p.setRTLTextPlugin,getRTLTextPluginStatus:p.getRTLTextPluginStatus,Map:class extends $h{constructor(g){if(p.LivePerformanceUtils.mark(p.PerformanceMarkers.create),null!=(g=p.extend({},qh,g)).minZoom&&null!=g.maxZoom&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=g.minPitch&&null!=g.maxPitch&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=g.minPitch&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=g.maxPitch&&g.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(g.antialias&&p.isSafariWithAntialiasingBug(p.window)&&(g.antialias=!1,p.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Dd(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies),g),this._interactive=g.interactive,this._minTileCacheSize=g.minTileCacheSize,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._useWebGL2=g.useWebGL2,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=g.crossSourceCollisions,this._collectResourceTiming=g.collectResourceTiming,this._optimizeForTerrain=g.optimizeForTerrain,this._language=this._parseLanguage(g.language),this._worldview=g.worldview,this._renderTaskQueue=new jo,this._domRenderTaskQueue=new jo,this._controls=[],this._markers=[],this._popups=[],this._mapId=p.uniqueId(),this._locale=p.extend({},Ym,g.locale),this._clickTolerance=g.clickTolerance,this._cooperativeGestures=g.cooperativeGestures,this._performanceMetricsCollection=g.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new lf(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new p.RequestManager(g.transformRequest,g.accessToken,g.testMode),this._silenceAuthErrors=!!g.testMode,"string"==typeof g.container){if(this._container=p.window.document.getElementById(g.container),!this._container)throw new Error(`Container '${g.container}' not found.`)}else{if(!(g.container instanceof p.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(this._container.childNodes.length>0&&p.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),g.maxBounds&&this.setMaxBounds(g.maxBounds),p.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==p.window&&(p.window.addEventListener("online",this._onWindowOnline,!1),p.window.addEventListener("resize",this._onWindowResize,!1),p.window.addEventListener("orientationchange",this._onWindowResize,!1),p.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),p.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new ua(this,g),this._localFontFamily=g.localFontFamily,this._localIdeographFontFamily=g.localIdeographFontFamily,g.style&&this.setStyle(g.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),g.projection&&this.setProjection(g.projection),this._hash=g.hash&&new rf("string"==typeof g.hash&&g.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch}),g.bounds&&(this.resize(),this.fitBounds(g.bounds,p.extend({},g.fitBoundsOptions,{duration:0})))),this.resize(),g.attributionControl&&this.addControl(new gn({customAttribution:g.customAttribution})),this._logoControl=new Gh,this.addControl(this._logoControl,g.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",c=>{this._update("style"===c.dataType),this.fire(new p.Event(`${c.dataType}data`,c))}),this.on("dataloading",c=>{this.fire(new p.Event(`${c.dataType}dataloading`,c))})}_getMapId(){return this._mapId}addControl(g,c){if(void 0===c&&(c=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=g.onAdd(this);this._controls.push(g);const _=this._controlPositions[c];return-1!==c.indexOf("bottom")?_.insertBefore(h,_.firstChild):_.appendChild(h),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const c=this._controls.indexOf(g);return c>-1&&this._controls.splice(c,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(g){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const c=!this._moving;return c&&this.fire(new p.Event("movestart",g)).fire(new p.Event("move",g)),this.fire(new p.Event("resize",g)),c&&this.fire(new p.Event("moveend",g)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(g){return this.transform.setMaxBounds(p.LngLatBounds.convert(g)),this._update()}setMinZoom(g){if((g=null==g?-2:g)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g?this.setZoom(g):this.fire(new p.Event("zoomstart")).fire(new p.Event("zoom")).fire(new p.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=null==g?22:g)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g?this.setZoom(g):this.fire(new p.Event("zoomstart")).fire(new p.Event("zoom")).fire(new p.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=null==g?0:g)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g?this.setPitch(g):this.fire(new p.Event("pitchstart")).fire(new p.Event("pitch")).fire(new p.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=null==g?85:g)>85)throw new Error("maxPitch must be less than or equal to 85");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g?this.setPitch(g):this.fire(new p.Event("pitchstart")).fire(new p.Event("pitch")).fire(new p.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.renderWorldCopies=g,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(g){return"auto"===g?p.window.navigator.language:Array.isArray(g)?0===g.length?void 0:g.map(c=>"auto"===c?p.window.navigator.language:c):g}setLanguage(g){const c=this._parseLanguage(g);if(!this.style||c===this._language)return this;this._language=c,this.style._reloadSources();for(const h of this._controls)h._setLanguage&&h._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(g){return this.style&&g!==this._worldview?(this._worldview=g,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(g){return this._lazyInitEmptyStyle(),g?"string"==typeof g&&(g={name:g}):g=null,this._useExplicitProjection=!!g,this._prioritizeAndUpdateProjection(g,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const g=this.transform,c=g.projection.name;let h;"globe"===c&&g.zoom>=p.GLOBE_ZOOM_THRESHOLD_MAX?(g.setMercatorFromTransition(),h=!0):"mercator"===c&&g.zoom<p.GLOBE_ZOOM_THRESHOLD_MAX&&(g.setProjection({name:"globe"}),h=!0),h&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(g,c){return this._updateProjection(g||c||{name:"mercator"})}_updateProjection(g){let c;if(c="globe"===g.name&&this.transform.zoom>=p.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(g),this.style.applyProjectionUpdate(),c){this.painter.clearBackgroundTiles();for(const h in this.style._sourceCaches)this.style._sourceCaches[h].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(g){return this.transform.locationPoint3D(p.LngLat.convert(g))}unproject(g){return this.transform.pointLocation3D(p.Point.convert(g))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(g,c,h){if("mouseenter"===g||"mouseover"===g){let _=!1;const x=D=>{const I=c.filter(O=>this.getLayer(O)),R=I.length?this.queryRenderedFeatures(D.point,{layers:I}):[];R.length?_||(_=!0,h.call(this,new Dr(g,this,D.originalEvent,{features:R}))):_=!1},S=()=>{_=!1};return{layers:new Set(c),listener:h,delegates:{mousemove:x,mouseout:S}}}if("mouseleave"===g||"mouseout"===g){let _=!1;const x=D=>{const I=c.filter(R=>this.getLayer(R));(I.length?this.queryRenderedFeatures(D.point,{layers:I}):[]).length?_=!0:_&&(_=!1,h.call(this,new Dr(g,this,D.originalEvent)))},S=D=>{_&&(_=!1,h.call(this,new Dr(g,this,D.originalEvent)))};return{layers:new Set(c),listener:h,delegates:{mousemove:x,mouseout:S}}}{const _=x=>{const S=c.filter(I=>this.getLayer(I)),D=S.length?this.queryRenderedFeatures(x.point,{layers:S}):[];D.length&&(x.features=D,h.call(this,x),delete x.features)};return{layers:new Set(c),listener:h,delegates:{[g]:_}}}}on(g,c,h){if(void 0===h)return super.on(g,c);Array.isArray(c)||(c=[c]);const _=this._createDelegatedListener(g,c,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(_);for(const x in _.delegates)this.on(x,_.delegates[x]);return this}once(g,c,h){if(void 0===h)return super.once(g,c);Array.isArray(c)||(c=[c]);const _=this._createDelegatedListener(g,c,h);for(const x in _.delegates)this.once(x,_.delegates[x]);return this}off(g,c,h){if(void 0===h)return super.off(g,c);c=new Set(Array.isArray(c)?c:[c]);const _=(S,D)=>{if(S.size!==D.size)return!1;for(const I of S)if(!D.has(I))return!1;return!0},x=this._delegatedListeners?this._delegatedListeners[g]:void 0;return x&&(S=>{for(let D=0;D<S.length;D++){const I=S[D];if(I.listener===h&&_(I.layers,c)){for(const R in I.delegates)this.off(R,I.delegates[R]);return S.splice(D,1),this}}})(x),this}queryRenderedFeatures(g,c){return this.style?(void 0!==c||void 0===g||g instanceof p.Point||Array.isArray(g)||(c=g,g=void 0),this.style.queryRenderedFeatures(g=g||[[0,0],[this.transform.width,this.transform.height]],c=c||{},this.transform)):[]}querySourceFeatures(g,c){return this.style.querySourceFeatures(g,c)}isPointOnSurface(g){const{name:c}=this.transform.projection;return"globe"!==c&&"mercator"!==c&&p.warnOnce(`${c} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(p.Point.convert(g))}setStyle(g,c){return!1!==(c=p.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},c)).diff&&c.localIdeographFontFamily===this._localIdeographFontFamily&&c.localFontFamily===this._localFontFamily&&this.style&&g?(this._diffStyle(g,c),this):(this._localIdeographFontFamily=c.localIdeographFontFamily,this._localFontFamily=c.localFontFamily,this._updateStyle(g,c))}_getUIString(g){const c=this._locale[g];if(null==c)throw new Error(`Missing UI string '${g}'`);return c}_updateStyle(g,c){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),g&&(this.style=new Sa(this,c||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof g?this.style.loadURL(g):this.style.loadJSON(g)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Sa(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(g,c){if("string"==typeof g){const h=this._requestManager.normalizeStyleURL(g),_=this._requestManager.transformRequest(h,p.ResourceType.Style);p.getJSON(_,(x,S)=>{x?this.fire(new p.ErrorEvent(x)):S&&this._updateDiff(S,c)})}else"object"==typeof g&&this._updateDiff(g,c)}_updateDiff(g,c){try{this.style.setState(g)&&this._update(!0)}catch(h){p.warnOnce(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(g,c)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(p.warnOnce("There is no style added to the map."),!1)}addSource(g,c){return this._lazyInitEmptyStyle(),this.style.addSource(g,c),this._update(!0)}isSourceLoaded(g){return!!this.style&&this.style._isSourceCacheLoaded(g)}areTilesLoaded(){const g=this.style&&this.style._sourceCaches;for(const c in g){const h=g[c]._tiles;for(const _ in h){const x=h[_];if("loaded"!==x.state&&"errored"!==x.state)return!1}}return!0}addSourceType(g,c,h){this._lazyInitEmptyStyle(),this.style.addSourceType(g,c,h)}removeSource(g){return this.style.removeSource(g),this._updateTerrain(),this._update(!0)}getSource(g){return this.style.getSource(g)}addImage(g,c,{pixelRatio:h=1,sdf:_=!1,stretchX:x,stretchY:S,content:D}={}){if(this._lazyInitEmptyStyle(),c instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&c instanceof p.window.ImageBitmap){const{width:I,height:R,data:O}=p.exported.getImageData(c);this.style.addImage(g,{data:new p.RGBAImage({width:I,height:R},O),pixelRatio:h,stretchX:x,stretchY:S,content:D,sdf:_,version:0})}else if(void 0===c.width||void 0===c.height)this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:I,height:R}=c,O=c;this.style.addImage(g,{data:new p.RGBAImage({width:I,height:R},new Uint8Array(O.data)),pixelRatio:h,stretchX:x,stretchY:S,content:D,sdf:_,version:0,userImage:O}),O.onAdd&&O.onAdd(this,g)}}updateImage(g,c){const h=this.style.getImage(g);if(!h)return void this.fire(new p.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=c instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&c instanceof p.window.ImageBitmap?p.exported.getImageData(c):c,{width:x,height:S}=_;void 0!==x&&void 0!==S?x===h.data.width&&S===h.data.height?(h.data.replace(_.data,!(c instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&c instanceof p.window.ImageBitmap)),this.style.updateImage(g,h)):this.fire(new p.ErrorEvent(new Error(`The width and height of the updated image (${x}, ${S})\n                must be that same as the previous version of the image\n                (${h.data.width}, ${h.data.height})`))):this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(g){return g?!!this.style.getImage(g):(this.fire(new p.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(g)}loadImage(g,c){p.getImage(this._requestManager.transformRequest(g,p.ResourceType.Image),(h,_)=>{c(h,_ instanceof p.window.HTMLImageElement?p.exported.getImageData(_):_)})}listImages(){return this.style.listImages()}addLayer(g,c){return this._lazyInitEmptyStyle(),this.style.addLayer(g,c),this._update(!0)}moveLayer(g,c){return this.style.moveLayer(g,c),this._update(!0)}removeLayer(g){return this.style.removeLayer(g),this._update(!0)}getLayer(g){return this.style.getLayer(g)}setLayerZoomRange(g,c,h){return this.style.setLayerZoomRange(g,c,h),this._update(!0)}setFilter(g,c,h={}){return this.style.setFilter(g,c,h),this._update(!0)}getFilter(g){return this.style.getFilter(g)}setPaintProperty(g,c,h,_={}){return this.style.setPaintProperty(g,c,h,_),this._update(!0)}getPaintProperty(g,c){return this.style.getPaintProperty(g,c)}setLayoutProperty(g,c,h,_={}){return this.style.setLayoutProperty(g,c,h,_),this._update(!0)}getLayoutProperty(g,c){return this.style.getLayoutProperty(g,c)}setLight(g,c={}){return this._lazyInitEmptyStyle(),this.style.setLight(g,c),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(g){return this._lazyInitEmptyStyle(),!g&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(g),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(g){return this._lazyInitEmptyStyle(),this.style.setFog(g),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(g){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(p.LngLat.convert(g),this.transform):0}setFeatureState(g,c){return this.style.setFeatureState(g,c),this._update()}removeFeatureState(g,c){return this.style.removeFeatureState(g,c),this._update()}getFeatureState(g){return this.style.getFeatureState(g)}_updateContainerDimensions(){if(!this._container)return;const g=this._container.getBoundingClientRect().width||400,c=this._container.getBoundingClientRect().height||300;let h,_,x,S=this._container;for(;S&&(!_||!x);){const D=p.window.getComputedStyle(S).transform;D&&"none"!==D&&(h=D.match(/matrix.*\((.+)\)/)[1].split(", "),h[0]&&"0"!==h[0]&&"1"!==h[0]&&(_=h[0]),h[3]&&"0"!==h[3]&&"1"!==h[3]&&(x=h[3])),S=S.parentElement}this._containerWidth=_?Math.abs(g/_):g,this._containerHeight=x?Math.abs(c/x):c}_detectMissingCSS(){"rgb(250, 128, 114)"!==p.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&p.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=Xe("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();const c=this._canvasContainer=Xe("div","mapboxgl-canvas-container",g);this._interactive&&c.classList.add("mapboxgl-interactive"),this._canvas=Xe("canvas","mapboxgl-canvas",c),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const h=this._controlContainer=Xe("div","mapboxgl-control-container",g),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{_[x]=Xe("div",`mapboxgl-ctrl-${x}`,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,c){const h=p.exported.devicePixelRatio||1;this._canvas.width=h*Math.ceil(g),this._canvas.height=h*Math.ceil(c),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${c}px`}_addMarker(g){this._markers.push(g)}_removeMarker(g){const c=this._markers.indexOf(g);-1!==c&&this._markers.splice(c,1)}_addPopup(g){this._popups.push(g)}_removePopup(g){const c=this._popups.indexOf(g);-1!==c&&this._popups.splice(c,1)}_setupPainter(){const g=p.extend({},Ye.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),c=this._useWebGL2&&this._canvas.getContext("webgl2",g),h=c||this._canvas.getContext("webgl",g)||this._canvas.getContext("experimental-webgl",g);h?(this._useWebGL2&&!c&&p.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),p.storeAuthState(h,!0),this.painter=new Cd(h,this.transform,!!c),this.on("data",_=>{"source"===_.dataType&&this.painter.setTileLoadedFlag(!0)}),p.exported$1.testSupport(h)):this.fire(new p.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new p.Event("webglcontextlost",{originalEvent:g}))}_contextRestored(g){this._setupPainter(),this.resize(),this._update(),this.fire(new p.Event("webglcontextrestored",{originalEvent:g}))}_onMapScroll(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_requestDomTask(g){!this.loaded()||this.loaded()&&!this.isMoving()?g():this._domRenderTaskQueue.add(g)}_render(g){let c;const h=this.painter.context.extTimerQuery,_=p.exported.now();if(this.listens("gpu-timing-frame")&&(c=h.createQueryEXT(),h.beginQueryEXT(h.TIME_ELAPSED_EXT,c)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],p.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],p.window.performance.now())),this._renderTaskQueue.run(g),this._domRenderTaskQueue.run(g),this._removed)return;this._updateProjectionTransition();const x=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const I=this.transform.zoom,R=this.transform.pitch,O=p.exported.now(),F=new p.EvaluationParameters(I,{now:O,fadeDuration:x,pitch:R,transition:this.style.getTransition()});this.style.update(F)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let S=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),S=this._updateAverageElevation(_),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):S=this._updateAverageElevation(_),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,x,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:x,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new p.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new p.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),c){const I=p.exported.now()-_;h.endQueryEXT(h.TIME_ELAPSED_EXT,c),setTimeout(()=>{const R=h.getQueryObjectEXT(c,h.QUERY_RESULT_EXT)/1e6;h.deleteQueryEXT(c),this.fire(new p.Event("gpu-timing-frame",{cpuTime:I,gpuTime:R})),p.window.performance.mark("frame-gpu",{startTime:_,detail:{gpuTime:R}})},50)}if(this.listens("gpu-timing-layer")){const I=this.painter.collectGpuTimers();setTimeout(()=>{const R=this.painter.queryGpuTimers(I);this.fire(new p.Event("gpu-timing-layer",{layerTimes:R}))},50)}if(this.listens("gpu-timing-deferred-render")){const I=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const R=this.painter.queryGpuTimeDeferredRender(I);this.fire(new p.Event("gpu-timing-deferred-render",{gpuTime:R}))},50)}const D=this._sourcesDirty||this._styleDirty||this._placementDirty||S;if(D||this._repaint)this.triggerRepaint();else{const I=!this.isMoving()&&this.loaded();if(I&&(S=this._updateAverageElevation(_,!0)),S)this.triggerRepaint();else if(this._triggerFrame(!1),I&&(this.fire(new p.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const R=this._calculateSpeedIndex();this.fire(new p.Event("speedindexcompleted",{speedIndex:R})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||D||(this._fullyLoaded=!0,p.LivePerformanceUtils.mark(p.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&p.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(g){for(const c of this._markers)g&&!this.getRenderWorldCopies()&&(c._lngLat=c._lngLat.wrap()),c._update();for(const c of this._popups)!g||this.getRenderWorldCopies()||c._trackPointer||(c._lngLat=c._lngLat.wrap()),c._update()}_updateAverageElevation(g,c=!1){const h=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&h(0);if((c||g-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(g)){const _=this.transform.averageElevation;let x=this.transform.sampleAverageElevation(),S=!1;this.transform.elevation&&(S=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(x)?x=0:this._averageElevationLastSampledAt=g;const D=Math.abs(_-x);if(D>1){if(this._isInitialLoad||S)return this._averageElevation.jumpTo(x),h(x);this._averageElevation.easeTo(x,g,300)}else if(D>1e-4)return this._averageElevation.jumpTo(x),h(x)}return!!this._averageElevation.isEasing(g)&&h(this._averageElevation.getValue(g))}_authenticate(){p.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,g=>{if(g&&(g.message===p.AUTH_ERR_MSG||401===g.status)){const c=this.painter.context.gl;p.storeAuthState(c,!1),this._logoControl instanceof Gh&&this._logoControl._updateLogo(),c&&c.clear(c.DEPTH_BUFFER_BIT|c.COLOR_BUFFER_BIT|c.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new p.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),p.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const g=this._isDragging();this.painter.updateTerrain(this.style,g)}_calculateSpeedIndex(){const g=this.painter.canvasCopy(),c=this.painter.getCanvasCopiesAndTimestamps();c.timeStamps.push(performance.now());const h=this.painter.context.gl,_=h.createFramebuffer();function x(S){h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,S,0);const D=new Uint8Array(h.drawingBufferWidth*h.drawingBufferHeight*4);return h.readPixels(0,0,h.drawingBufferWidth,h.drawingBufferHeight,h.RGBA,h.UNSIGNED_BYTE,D),D}return h.bindFramebuffer(h.FRAMEBUFFER,_),this._canvasPixelComparison(x(g),c.canvasCopies.map(x),c.timeStamps)}_canvasPixelComparison(g,c,h){let _=h[1]-h[0];const x=g.length/4;for(let S=0;S<c.length;S++){const D=c[S];let I=0;for(let R=0;R<D.length;R+=4)D[R]===g[R]&&D[R+1]===g[R+1]&&D[R+2]===g[R+2]&&D[R+3]===g[R+3]&&(I+=1);_+=(h[S+2]-h[S+1])*(1-I/x)}return _}remove(){this._hash&&this._hash.remove();for(const c of this._controls)c.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==p.window&&(p.window.removeEventListener("resize",this._onWindowResize,!1),p.window.removeEventListener("orientationchange",this._onWindowResize,!1),p.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),p.window.removeEventListener("online",this._onWindowOnline,!1),p.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const g=this.painter.context.gl.getExtension("WEBGL_lose_context");g&&g.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),p.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new p.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(g){this._renderNextFrame=this._renderNextFrame||g,this.style&&!this._frame&&(this._frame=p.exported.frame(c=>{const h=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,h&&this._render(c)}))}_preloadTiles(g){const c=this.style?Object.values(this.style._sourceCaches):[];return p.asyncAll(c,(h,_)=>h._preloadTiles(g,_),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(g){this._trackResize&&this.resize({originalEvent:g})._update()}_onVisibilityChange(){"hidden"===p.window.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(g){this._showTerrainWireframe!==g&&(this._showTerrainWireframe=g,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(g){this._speedIndexTiming!==g&&(this._speedIndexTiming=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(g){this._showTileAABBs!==g&&(this._showTileAABBs=g,g&&this._update())}_setCacheLimits(g,c){p.setCacheLimits(g,c)}get version(){return p.version}},NavigationControl:class{constructor(g){this.options=p.extend({},cf,g),this._container=Xe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",c=>c.preventDefault()),this.options.showZoom&&(p.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",c=>{this._map&&this._map.zoomIn({},{originalEvent:c})}),Xe("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",c=>{this._map&&this._map.zoomOut({},{originalEvent:c})}),Xe("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(p.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",c=>{const h=this._map;h&&(this.options.visualizePitch?h.resetNorthPitch({},{originalEvent:c}):h.resetNorth({},{originalEvent:c}))}),this._compassIcon=Xe("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const g=this._map;if(!g)return;const c=g.getZoom(),h=c===g.getMaxZoom(),_=c===g.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())}_rotateCompassArrow(){const g=this._map;if(!g)return;const c=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(g.transform.pitch*(Math.PI/180)),.5)}) rotateX(${g.transform.pitch}deg) rotateZ(${g.transform.angle*(180/Math.PI)}deg)`:`rotate(${g.transform.angle*(180/Math.PI)}deg)`;g._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=c)})}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),g.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&g.on("pitch",this._rotateCompassArrow),g.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Km(g,this._compass,this.options.visualizePitch)),this._container}onRemove(){const g=this._map;g&&(this._container.remove(),this.options.showZoom&&g.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&g.off("pitch",this._rotateCompassArrow),g.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(g,c){const h=Xe("button",g,this._container);return h.type="button",h.addEventListener("click",c),h}_setButtonTitle(g,c){if(!this._map)return;const h=this._map._getUIString(`NavigationControl.${c}`);g.setAttribute("aria-label",h),g.firstElementChild&&g.firstElementChild.setAttribute("title",h)}},GeolocateControl:class extends p.Evented{constructor(g){super(),this.options=p.extend({geolocation:p.window.navigator.geolocation},Pd,g),p.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=la(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(g){return this._map=g,this._container=Xe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(g){const c=(h=!!this.options.geolocation)=>{this._supportsGeolocation=h,g(h)};void 0!==this._supportsGeolocation?g(this._supportsGeolocation):void 0!==p.window.navigator.permissions?p.window.navigator.permissions.query({name:"geolocation"}).then(h=>c("denied"!==h.state)).catch(()=>c()):c()}_isOutOfMapMaxBounds(g){const c=this._map.getMaxBounds(),h=g.coords;return!!c&&(h.longitude<c.getWest()||h.longitude>c.getEast()||h.latitude<c.getSouth()||h.latitude>c.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(g){if(this._map){if(this._isOutOfMapMaxBounds(g))return this._setErrorState(),this.fire(new p.Event("outofmaxbounds",g)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=g,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(g),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(g),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("geolocate",g)),this._finish()}}_updateCamera(g){const c=new p.LngLat(g.coords.longitude,g.coords.latitude),h=g.coords.accuracy,_=this._map.getBearing(),x=p.extend({bearing:_},this.options.fitBoundsOptions);this._map.fitBounds(c.toBounds(h),x,{geolocateSource:!0})}_updateMarker(g){if(g){const c=new p.LngLat(g.coords.longitude,g.coords.latitude);this._accuracyCircleMarker.setLngLat(c).addTo(this._map),this._userLocationDotMarker.setLngLat(c).addTo(this._map),this._accuracy=g.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const g=this._map.transform,c=p.mercatorZfromAltitude(1,g._center.lat)*g.worldSize,h=Math.ceil(2*this._accuracy*c);this._circleElement.style.width=`${h}px`,this._circleElement.style.height=`${h}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(g){if(this._map){if(this.options.trackUserLocation)if(1===g.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===g.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("error",g)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(g){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",c=>c.preventDefault()),this._geolocateButton=Xe("button","mapboxgl-ctrl-geolocate",this._container),Xe("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===g){p.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c)}else{const c=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Xe("div","mapboxgl-user-location"),this._dotElement.appendChild(Xe("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Xe("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new on({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Xe("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new on({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",c=>{c.geolocateSource||"ACTIVE_LOCK"!==this._watchState||c.originalEvent&&"resize"===c.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new p.Event("trackuserlocationend")))})}}_onDeviceOrientation(g){this._userLocationDotMarker&&(g.webkitCompassHeading?this._heading=g.webkitCompassHeading:!0===g.absolute&&(this._heading=-1*g.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return p.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new p.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new p.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new p.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let g;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(g={maximumAge:6e5,timeout:0},this._noTimeout=!0):(g=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,g),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const g=()=>{p.window.addEventListener("ondeviceorientationabsolute"in p.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==p.window.DeviceMotionEvent&&"function"==typeof p.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(c=>{"granted"===c&&g()}).catch(console.error):g()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),p.window.removeEventListener("deviceorientation",this._onDeviceOrientation),p.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:gn,ScaleControl:class{constructor(g){this.options=p.extend({},uf,g),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch(c){return!1}}(),p.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const g=this.options.maxWidth||100,c=this._map,h=c._containerHeight/2,_=c._containerWidth/2-g/2,x=c.unproject([_,h]),S=c.unproject([_+g,h]),D=x.distanceTo(S);if("imperial"===this.options.unit){const I=3.2808*D;I>5280?this._setScale(g,I/5280,"mile"):this._setScale(g,I,"foot")}else"nautical"===this.options.unit?this._setScale(g,D/1852,"nautical-mile"):D>=1e3?this._setScale(g,D/1e3,"kilometer"):this._setScale(g,D,"meter")}_setScale(g,c,h){this._map._requestDomTask(()=>{const _=function(S){const D=Math.pow(10,`${Math.floor(S)}`.length-1);let I=S/D;return I=I>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:function(R){const O=Math.pow(10,Math.ceil(-Math.log(R)/Math.LN10));return Math.round(R*O)/O}(I),D*I}(c),x=_/c;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==h?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:h}).format(_):`${_}&nbsp;${Wh[h]}`,this._container.style.width=g*x+"px"})}onAdd(g){return this._map=g,this._language=g.getLanguage(),this._container=Xe("div","mapboxgl-ctrl mapboxgl-ctrl-scale",g.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(g){this._language=g,this._update()}setUnit(g){this.options.unit=g,this._update()}},FullscreenControl:class{constructor(g){this._fullscreen=!1,g&&g.container&&(g.container instanceof p.window.HTMLElement?this._container=g.container:p.warnOnce("Full screen control 'container' must be a DOM element.")),p.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in p.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in p.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=Xe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",p.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,p.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!p.window.document.fullscreenEnabled&&!p.window.document.webkitFullscreenEnabled)}_setupUI(){const g=this._fullscreenButton=Xe("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Xe("span","mapboxgl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),p.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",g)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(p.window.document.fullscreenElement||p.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?p.window.document.exitFullscreen?p.window.document.exitFullscreen():p.window.document.webkitCancelFullScreen&&p.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends p.Evented{constructor(g){super(),this.options=p.extend(Object.create(Ma),g),p.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(g&&g.className?g.className.trim().split(/\s+/):[])}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&g.on("preclick",this._onClose),this.options.closeOnMove&&g.on("move",this._onClose),g.on("remove",this.remove),this._update(),g._addPopup(this),this._focusFirstElement(),this._trackPointer?(g.on("mousemove",this._onMouseEvent),g.on("mouseup",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")):g.on("move",this._update),this.fire(new p.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const g=this._map;return g&&(g.off("move",this._update),g.off("move",this._onClose),g.off("preclick",this._onClose),g.off("click",this._onClose),g.off("remove",this.remove),g.off("mousemove",this._onMouseEvent),g.off("mouseup",this._onMouseEvent),g.off("drag",this._onMouseEvent),g._canvasContainer&&g._canvasContainer.classList.remove("mapboxgl-track-pointer"),g._removePopup(this),this._map=void 0),this.fire(new p.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(g){this._lngLat=p.LngLat.convert(g),this._pos=null,this._trackPointer=!1,this._update();const c=this._map;return c&&(c.on("move",this._update),c.off("mousemove",this._onMouseEvent),c._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const g=this._map;return g&&(g.off("move",this._update),g.on("mousemove",this._onMouseEvent),g.on("drag",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(p.window.document.createTextNode(g))}setHTML(g){const c=p.window.document.createDocumentFragment(),h=p.window.document.createElement("body");let _;for(h.innerHTML=g;_=h.firstChild,_;)c.appendChild(_);return this.setDOMContent(c)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){let c=this._content;if(c)for(;c.hasChildNodes();)c.firstChild&&c.removeChild(c.firstChild);else c=this._content=Xe("div","mapboxgl-popup-content",this._container||void 0);if(c.appendChild(g),this.options.closeButton){const h=this._closeButton=Xe("button","mapboxgl-popup-close-button",c);h.type="button",h.setAttribute("aria-label","Close popup"),h.setAttribute("aria-hidden","true"),h.innerHTML="&#215;",h.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(g){return this._classList.add(g),this._updateClassList(),this}removeClassName(g){return this._classList.delete(g),this._updateClassList(),this}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){let c;return this._classList.delete(g)?c=!1:(this._classList.add(g),c=!0),this._updateClassList(),c}_onMouseEvent(g){this._update(g.point)}_getAnchor(g){if(this.options.anchor)return this.options.anchor;const c=this._map,h=this._container,_=this._pos;if(!c||!h||!_)return"bottom";const x=h.offsetWidth,S=h.offsetHeight,D=_.x<x/2,I=_.x>c.transform.width-x/2;if(_.y+g<S)return D?"top-left":I?"top-right":"top";if(_.y>c.transform.height-S){if(D)return"bottom-left";if(I)return"bottom-right"}return D?"left":I?"right":"bottom"}_updateClassList(){const g=this._container;if(!g)return;const c=[...this._classList];c.push("mapboxgl-popup"),this._anchor&&c.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&c.push("mapboxgl-popup-track-pointer"),g.className=c.join(" ")}_update(g){const c=this._map,h=this._content;if(!c||!this._lngLat&&!this._trackPointer||!h)return;let _=this._container;if(_||(_=this._container=Xe("div","mapboxgl-popup",c.getContainer()),this._tip=Xe("div","mapboxgl-popup-tip",_),_.appendChild(h)),this.options.maxWidth&&_.style.maxWidth!==this.options.maxWidth&&(_.style.maxWidth=this.options.maxWidth),c.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Fs(this._lngLat,this._pos,c.transform)),!this._trackPointer||g){const x=this._pos=this._trackPointer&&g?g:c.project(this._lngLat),S=af(this.options.offset),D=this._anchor=this._getAnchor(S.y),I=af(this.options.offset,D),R=x.add(I).round();c._requestDomTask(()=>{this._container&&D&&(this._container.style.transform=`${nc[D]} translate(${R.x}px,${R.y}px)`)})}if(!this._marker&&c._showingGlobe()){const x=p.isLngLatBehindGlobe(c.transform,this._lngLat)?0:1;this._setOpacity(x)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(p_);g&&g.focus()}_onClose(){this.remove()}_setOpacity(g){this._container&&(this._container.style.opacity=`${g}`),this._content&&(this._content.style.pointerEvents=g?"auto":"none")}},Marker:on,Style:Sa,LngLat:p.LngLat,LngLatBounds:p.LngLatBounds,Point:p.Point,MercatorCoordinate:p.MercatorCoordinate,FreeCameraOptions:a_,Evented:p.Evented,config:p.config,prewarm:function(){hu().acquire(Xa)},clearPrewarmedResources:function(){const g=hs;g&&(g.isPreloaded()&&1===g.numActive()?(g.release(Xa),hs=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return p.config.ACCESS_TOKEN},set accessToken(g){p.config.ACCESS_TOKEN=g},get baseApiUrl(){return p.config.API_URL},set baseApiUrl(g){p.config.API_URL=g},get workerCount(){return wo.workerCount},set workerCount(g){wo.workerCount=g},get maxParallelImageRequests(){return p.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(g){p.config.MAX_PARALLEL_IMAGE_REQUESTS=g},clearStorage(g){p.clearTileCache(g)},workerUrl:"",workerClass:null,setNow:p.exported.setNow,restoreNow:p.exported.restoreNow};return ic}),be}()},3502:(rn,hn,qe)=>{var be=qe(3172),Me=be.Buffer;function Te(te,Ye){for(var ne in te)Ye[ne]=te[ne]}function p(te,Ye,ne){return Me(te,Ye,ne)}Me.from&&Me.alloc&&Me.allocUnsafe&&Me.allocUnsafeSlow?rn.exports=be:(Te(be,hn),hn.Buffer=p),p.prototype=Object.create(Me.prototype),Te(Me,p),p.from=function(te,Ye,ne){if("number"==typeof te)throw new TypeError("Argument must not be a number");return Me(te,Ye,ne)},p.alloc=function(te,Ye,ne){if("number"!=typeof te)throw new TypeError("Argument must be a number");var Ve=Me(te);return void 0!==Ye?"string"==typeof ne?Ve.fill(Ye,ne):Ve.fill(Ye):Ve.fill(0),Ve},p.allocUnsafe=function(te){if("number"!=typeof te)throw new TypeError("Argument must be a number");return Me(te)},p.allocUnsafeSlow=function(te){if("number"!=typeof te)throw new TypeError("Argument must be a number");return be.SlowBuffer(te)}},1503:(rn,hn,qe)=>{!function(be){be.parser=function(fe,W){return new Te(fe,W)},be.SAXParser=Te,be.SAXStream=gt,be.createStream=function Xe(fe,W){return new gt(fe,W)},be.MAX_BUFFER_LENGTH=65536;var ne,Me=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];function Te(fe,W){if(!(this instanceof Te))return new Te(fe,W);var Pt=this;(function te(fe){for(var W=0,Pt=Me.length;W<Pt;W++)fe[Me[W]]=""})(Pt),Pt.q=Pt.c="",Pt.bufferCheckPosition=be.MAX_BUFFER_LENGTH,Pt.opt=W||{},Pt.opt.lowercase=Pt.opt.lowercase||Pt.opt.lowercasetags,Pt.looseCase=Pt.opt.lowercase?"toLowerCase":"toUpperCase",Pt.tags=[],Pt.closed=Pt.closedRoot=Pt.sawRoot=!1,Pt.tag=Pt.error=null,Pt.strict=!!fe,Pt.noscript=!(!fe&&!Pt.opt.noscript),Pt.state=re.BEGIN,Pt.strictEntities=Pt.opt.strictEntities,Pt.ENTITIES=Object.create(Pt.strictEntities?be.XML_ENTITIES:be.ENTITIES),Pt.attribList=[],Pt.opt.xmlns&&(Pt.ns=Object.create(Kt)),Pt.trackPosition=!1!==Pt.opt.position,Pt.trackPosition&&(Pt.position=Pt.line=Pt.column=0),lt(Pt,"onready")}be.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"],Object.create||(Object.create=function(fe){function W(){}return W.prototype=fe,new W}),Object.keys||(Object.keys=function(fe){var W=[];for(var Pt in fe)fe.hasOwnProperty(Pt)&&W.push(Pt);return W}),Te.prototype={end:function(){ri(this)},write:function Ci(fe){var W=this;if(this.error)throw this.error;if(W.closed)return Tt(W,"Cannot write after close. Assign an onready handler.");if(null===fe)return ri(W);"object"==typeof fe&&(fe=fe.toString());for(var Pt=0,Qe="";Qe=Di(fe,Pt++),W.c=Qe,Qe;)switch(W.trackPosition&&(W.position++,"\n"===Qe?(W.line++,W.column=0):W.column++),W.state){case re.BEGIN:if(W.state=re.BEGIN_WHITESPACE,"\ufeff"===Qe)continue;go(W,Qe);continue;case re.BEGIN_WHITESPACE:go(W,Qe);continue;case re.TEXT:if(W.sawRoot&&!W.closedRoot){for(var Ii=Pt-1;Qe&&"<"!==Qe&&"&"!==Qe;)(Qe=Di(fe,Pt++))&&W.trackPosition&&(W.position++,"\n"===Qe?(W.line++,W.column=0):W.column++);W.textNode+=fe.substring(Ii,Pt-1)}"<"!==Qe||W.sawRoot&&W.closedRoot&&!W.strict?(!we(Qe)&&(!W.sawRoot||W.closedRoot)&&kt(W,"Text data outside of root node."),"&"===Qe?W.state=re.TEXT_ENTITY:W.textNode+=Qe):(W.state=re.OPEN_WAKA,W.startTagPosition=W.position);continue;case re.SCRIPT:"<"===Qe?W.state=re.SCRIPT_ENDING:W.script+=Qe;continue;case re.SCRIPT_ENDING:"/"===Qe?W.state=re.CLOSE_TAG:(W.script+="<"+Qe,W.state=re.SCRIPT);continue;case re.OPEN_WAKA:"!"===Qe?(W.state=re.SGML_DECL,W.sgmlDecl=""):we(Qe)||(ae(_n,Qe)?(W.state=re.OPEN_TAG,W.tagName=Qe):"/"===Qe?(W.state=re.CLOSE_TAG,W.tagName=""):"?"===Qe?(W.state=re.PROC_INST,W.procInstName=W.procInstBody=""):(kt(W,"Unencoded <"),W.startTagPosition+1<W.position&&(Qe=new Array(W.position-W.startTagPosition).join(" ")+Qe),W.textNode+="<"+Qe,W.state=re.TEXT));continue;case re.SGML_DECL:"[CDATA["===(W.sgmlDecl+Qe).toUpperCase()?(mt(W,"onopencdata"),W.state=re.CDATA,W.sgmlDecl="",W.cdata=""):W.sgmlDecl+Qe==="--"?(W.state=re.COMMENT,W.comment="",W.sgmlDecl=""):"DOCTYPE"===(W.sgmlDecl+Qe).toUpperCase()?(W.state=re.DOCTYPE,(W.doctype||W.sawRoot)&&kt(W,"Inappropriately located doctype declaration"),W.doctype="",W.sgmlDecl=""):">"===Qe?(mt(W,"onsgmldeclaration",W.sgmlDecl),W.sgmlDecl="",W.state=re.TEXT):(ye(Qe)&&(W.state=re.SGML_DECL_QUOTED),W.sgmlDecl+=Qe);continue;case re.SGML_DECL_QUOTED:Qe===W.q&&(W.state=re.SGML_DECL,W.q=""),W.sgmlDecl+=Qe;continue;case re.DOCTYPE:">"===Qe?(W.state=re.TEXT,mt(W,"ondoctype",W.doctype),W.doctype=!0):(W.doctype+=Qe,"["===Qe?W.state=re.DOCTYPE_DTD:ye(Qe)&&(W.state=re.DOCTYPE_QUOTED,W.q=Qe));continue;case re.DOCTYPE_QUOTED:W.doctype+=Qe,Qe===W.q&&(W.q="",W.state=re.DOCTYPE);continue;case re.DOCTYPE_DTD:W.doctype+=Qe,"]"===Qe?W.state=re.DOCTYPE:ye(Qe)&&(W.state=re.DOCTYPE_DTD_QUOTED,W.q=Qe);continue;case re.DOCTYPE_DTD_QUOTED:W.doctype+=Qe,Qe===W.q&&(W.state=re.DOCTYPE_DTD,W.q="");continue;case re.COMMENT:"-"===Qe?W.state=re.COMMENT_ENDING:W.comment+=Qe;continue;case re.COMMENT_ENDING:"-"===Qe?(W.state=re.COMMENT_ENDED,W.comment=yt(W.opt,W.comment),W.comment&&mt(W,"oncomment",W.comment),W.comment=""):(W.comment+="-"+Qe,W.state=re.COMMENT);continue;case re.COMMENT_ENDED:">"!==Qe?(kt(W,"Malformed comment"),W.comment+="--"+Qe,W.state=re.COMMENT):W.state=re.TEXT;continue;case re.CDATA:"]"===Qe?W.state=re.CDATA_ENDING:W.cdata+=Qe;continue;case re.CDATA_ENDING:"]"===Qe?W.state=re.CDATA_ENDING_2:(W.cdata+="]"+Qe,W.state=re.CDATA);continue;case re.CDATA_ENDING_2:">"===Qe?(W.cdata&&mt(W,"oncdata",W.cdata),mt(W,"onclosecdata"),W.cdata="",W.state=re.TEXT):"]"===Qe?W.cdata+="]":(W.cdata+="]]"+Qe,W.state=re.CDATA);continue;case re.PROC_INST:"?"===Qe?W.state=re.PROC_INST_ENDING:we(Qe)?W.state=re.PROC_INST_BODY:W.procInstName+=Qe;continue;case re.PROC_INST_BODY:if(!W.procInstBody&&we(Qe))continue;"?"===Qe?W.state=re.PROC_INST_ENDING:W.procInstBody+=Qe;continue;case re.PROC_INST_ENDING:">"===Qe?(mt(W,"onprocessinginstruction",{name:W.procInstName,body:W.procInstBody}),W.procInstName=W.procInstBody="",W.state=re.TEXT):(W.procInstBody+="?"+Qe,W.state=re.PROC_INST_BODY);continue;case re.OPEN_TAG:ae(Sn,Qe)?W.tagName+=Qe:(cn(W),">"===Qe?yi(W):"/"===Qe?W.state=re.OPEN_TAG_SLASH:(we(Qe)||kt(W,"Invalid character in tag name"),W.state=re.ATTRIB));continue;case re.OPEN_TAG_SLASH:">"===Qe?(yi(W,!0),Zt(W)):(kt(W,"Forward-slash in opening tag not followed by >"),W.state=re.ATTRIB);continue;case re.ATTRIB:if(we(Qe))continue;">"===Qe?yi(W):"/"===Qe?W.state=re.OPEN_TAG_SLASH:ae(_n,Qe)?(W.attribName=Qe,W.attribValue="",W.state=re.ATTRIB_NAME):kt(W,"Invalid attribute name");continue;case re.ATTRIB_NAME:"="===Qe?W.state=re.ATTRIB_VALUE:">"===Qe?(kt(W,"Attribute without value"),W.attribValue=W.attribName,Li(W),yi(W)):we(Qe)?W.state=re.ATTRIB_NAME_SAW_WHITE:ae(Sn,Qe)?W.attribName+=Qe:kt(W,"Invalid attribute name");continue;case re.ATTRIB_NAME_SAW_WHITE:if("="===Qe)W.state=re.ATTRIB_VALUE;else{if(we(Qe))continue;kt(W,"Attribute without value"),W.tag.attributes[W.attribName]="",W.attribValue="",mt(W,"onattribute",{name:W.attribName,value:""}),W.attribName="",">"===Qe?yi(W):ae(_n,Qe)?(W.attribName=Qe,W.state=re.ATTRIB_NAME):(kt(W,"Invalid attribute name"),W.state=re.ATTRIB)}continue;case re.ATTRIB_VALUE:if(we(Qe))continue;ye(Qe)?(W.q=Qe,W.state=re.ATTRIB_VALUE_QUOTED):(kt(W,"Unquoted attribute value"),W.state=re.ATTRIB_VALUE_UNQUOTED,W.attribValue=Qe);continue;case re.ATTRIB_VALUE_QUOTED:if(Qe!==W.q){"&"===Qe?W.state=re.ATTRIB_VALUE_ENTITY_Q:W.attribValue+=Qe;continue}Li(W),W.q="",W.state=re.ATTRIB_VALUE_CLOSED;continue;case re.ATTRIB_VALUE_CLOSED:we(Qe)?W.state=re.ATTRIB:">"===Qe?yi(W):"/"===Qe?W.state=re.OPEN_TAG_SLASH:ae(_n,Qe)?(kt(W,"No whitespace between attributes"),W.attribName=Qe,W.attribValue="",W.state=re.ATTRIB_NAME):kt(W,"Invalid attribute name");continue;case re.ATTRIB_VALUE_UNQUOTED:if(!Ie(Qe)){"&"===Qe?W.state=re.ATTRIB_VALUE_ENTITY_U:W.attribValue+=Qe;continue}Li(W),">"===Qe?yi(W):W.state=re.ATTRIB;continue;case re.CLOSE_TAG:if(W.tagName)">"===Qe?Zt(W):ae(Sn,Qe)?W.tagName+=Qe:W.script?(W.script+="</"+W.tagName,W.tagName="",W.state=re.SCRIPT):(we(Qe)||kt(W,"Invalid tagname in closing tag"),W.state=re.CLOSE_TAG_SAW_WHITE);else{if(we(Qe))continue;dt(_n,Qe)?W.script?(W.script+="</"+Qe,W.state=re.SCRIPT):kt(W,"Invalid tagname in closing tag."):W.tagName=Qe}continue;case re.CLOSE_TAG_SAW_WHITE:if(we(Qe))continue;">"===Qe?Zt(W):kt(W,"Invalid characters in closing tag");continue;case re.TEXT_ENTITY:case re.ATTRIB_VALUE_ENTITY_Q:case re.ATTRIB_VALUE_ENTITY_U:var vi,qr;switch(W.state){case re.TEXT_ENTITY:vi=re.TEXT,qr="textNode";break;case re.ATTRIB_VALUE_ENTITY_Q:vi=re.ATTRIB_VALUE_QUOTED,qr="attribValue";break;case re.ATTRIB_VALUE_ENTITY_U:vi=re.ATTRIB_VALUE_UNQUOTED,qr="attribValue"}if(";"===Qe)if(W.opt.unparsedEntities){var Wr=xo(W);W.entity="",W.state=vi,W.write(Wr)}else W[qr]+=xo(W),W.entity="",W.state=vi;else ae(W.entity.length?an:st,Qe)?W.entity+=Qe:(kt(W,"Invalid character in entity name"),W[qr]+="&"+W.entity+Qe,W.entity="",W.state=vi);continue;default:throw new Error(W,"Unknown state: "+W.state)}return W.position>=W.bufferCheckPosition&&function p(fe){for(var W=Math.max(be.MAX_BUFFER_LENGTH,10),Pt=0,Qe=0,Ii=Me.length;Qe<Ii;Qe++){var Qn=fe[Me[Qe]].length;if(Qn>W)switch(Me[Qe]){case"textNode":je(fe);break;case"cdata":mt(fe,"oncdata",fe.cdata),fe.cdata="";break;case"script":mt(fe,"onscript",fe.script),fe.script="";break;default:Tt(fe,"Max buffer length exceeded: "+Me[Qe])}Pt=Math.max(Pt,Qn)}fe.bufferCheckPosition=be.MAX_BUFFER_LENGTH-Pt+fe.position}(W),W},resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){!function Ye(fe){je(fe),""!==fe.cdata&&(mt(fe,"oncdata",fe.cdata),fe.cdata=""),""!==fe.script&&(mt(fe,"onscript",fe.script),fe.script="")}(this)}};try{ne=qe(5398).Stream}catch(fe){ne=function(){}}ne||(ne=function(){});var Ve=be.EVENTS.filter(function(fe){return"error"!==fe&&"end"!==fe});function gt(fe,W){if(!(this instanceof gt))return new gt(fe,W);ne.apply(this),this._parser=new Te(fe,W),this.writable=!0,this.readable=!0;var Pt=this;this._parser.onend=function(){Pt.emit("end")},this._parser.onerror=function(Qe){Pt.emit("error",Qe),Pt._parser.error=null},this._decoder=null,Ve.forEach(function(Qe){Object.defineProperty(Pt,"on"+Qe,{get:function(){return Pt._parser["on"+Qe]},set:function(Ii){if(!Ii)return Pt.removeAllListeners(Qe),Pt._parser["on"+Qe]=Ii,Ii;Pt.on(Qe,Ii)},enumerable:!0,configurable:!1})})}(gt.prototype=Object.create(ne.prototype,{constructor:{value:gt}})).write=function(fe){if("function"==typeof Buffer&&"function"==typeof Buffer.isBuffer&&Buffer.isBuffer(fe)){if(!this._decoder){var W=qe(3054).s;this._decoder=new W("utf8")}fe=this._decoder.write(fe)}return this._parser.write(fe.toString()),this.emit("data",fe),!0},gt.prototype.end=function(fe){return fe&&fe.length&&this.write(fe),this._parser.end(),!0},gt.prototype.on=function(fe,W){var Pt=this;return!Pt._parser["on"+fe]&&-1!==Ve.indexOf(fe)&&(Pt._parser["on"+fe]=function(){var Qe=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);Qe.splice(0,0,fe),Pt.emit.apply(Pt,Qe)}),ne.prototype.on.call(Pt,fe,W)};var Ge="http://www.w3.org/XML/1998/namespace",xt="http://www.w3.org/2000/xmlns/",Kt={xml:Ge,xmlns:xt},_n=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,Sn=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,st=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,an=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function we(fe){return" "===fe||"\n"===fe||"\r"===fe||"\t"===fe}function ye(fe){return'"'===fe||"'"===fe}function Ie(fe){return">"===fe||we(fe)}function ae(fe,W){return fe.test(W)}function dt(fe,W){return!ae(fe,W)}var fe,W,Pt,re=0;for(var me in be.STATE={BEGIN:re++,BEGIN_WHITESPACE:re++,TEXT:re++,TEXT_ENTITY:re++,OPEN_WAKA:re++,SGML_DECL:re++,SGML_DECL_QUOTED:re++,DOCTYPE:re++,DOCTYPE_QUOTED:re++,DOCTYPE_DTD:re++,DOCTYPE_DTD_QUOTED:re++,COMMENT_STARTING:re++,COMMENT:re++,COMMENT_ENDING:re++,COMMENT_ENDED:re++,CDATA:re++,CDATA_ENDING:re++,CDATA_ENDING_2:re++,PROC_INST:re++,PROC_INST_BODY:re++,PROC_INST_ENDING:re++,OPEN_TAG:re++,OPEN_TAG_SLASH:re++,ATTRIB:re++,ATTRIB_NAME:re++,ATTRIB_NAME_SAW_WHITE:re++,ATTRIB_VALUE:re++,ATTRIB_VALUE_QUOTED:re++,ATTRIB_VALUE_CLOSED:re++,ATTRIB_VALUE_UNQUOTED:re++,ATTRIB_VALUE_ENTITY_Q:re++,ATTRIB_VALUE_ENTITY_U:re++,CLOSE_TAG:re++,CLOSE_TAG_SAW_WHITE:re++,SCRIPT:re++,SCRIPT_ENDING:re++},be.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},be.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(be.ENTITIES).forEach(function(fe){var W=be.ENTITIES[fe],Pt="number"==typeof W?String.fromCharCode(W):W;be.ENTITIES[fe]=Pt}),be.STATE)be.STATE[be.STATE[me]]=me;function lt(fe,W,Pt){fe[W]&&fe[W](Pt)}function mt(fe,W,Pt){fe.textNode&&je(fe),lt(fe,W,Pt)}function je(fe){fe.textNode=yt(fe.opt,fe.textNode),fe.textNode&&lt(fe,"ontext",fe.textNode),fe.textNode=""}function yt(fe,W){return fe.trim&&(W=W.trim()),fe.normalize&&(W=W.replace(/\s+/g," ")),W}function Tt(fe,W){return je(fe),fe.trackPosition&&(W+="\nLine: "+fe.line+"\nColumn: "+fe.column+"\nChar: "+fe.c),W=new Error(W),fe.error=W,lt(fe,"onerror",W),fe}function ri(fe){return fe.sawRoot&&!fe.closedRoot&&kt(fe,"Unclosed root tag"),fe.state!==re.BEGIN&&fe.state!==re.BEGIN_WHITESPACE&&fe.state!==re.TEXT&&Tt(fe,"Unexpected end"),je(fe),fe.c="",fe.closed=!0,lt(fe,"onend"),Te.call(fe,fe.strict,fe.opt),fe}function kt(fe,W){if("object"!=typeof fe||!(fe instanceof Te))throw new Error("bad call to strictFail");fe.strict&&Tt(fe,W)}function cn(fe){fe.strict||(fe.tagName=fe.tagName[fe.looseCase]());var W=fe.tags[fe.tags.length-1]||fe,Pt=fe.tag={name:fe.tagName,attributes:{}};fe.opt.xmlns&&(Pt.ns=W.ns),fe.attribList.length=0,mt(fe,"onopentagstart",Pt)}function Hi(fe,W){var Qe=fe.indexOf(":")<0?["",fe]:fe.split(":"),Ii=Qe[0],Qn=Qe[1];return W&&"xmlns"===fe&&(Ii="xmlns",Qn=""),{prefix:Ii,local:Qn}}function Li(fe){if(fe.strict||(fe.attribName=fe.attribName[fe.looseCase]()),-1!==fe.attribList.indexOf(fe.attribName)||fe.tag.attributes.hasOwnProperty(fe.attribName))fe.attribName=fe.attribValue="";else{if(fe.opt.xmlns){var W=Hi(fe.attribName,!0),Qe=W.local;if("xmlns"===W.prefix)if("xml"===Qe&&fe.attribValue!==Ge)kt(fe,"xml: prefix must be bound to "+Ge+"\nActual: "+fe.attribValue);else if("xmlns"===Qe&&fe.attribValue!==xt)kt(fe,"xmlns: prefix must be bound to "+xt+"\nActual: "+fe.attribValue);else{var Ii=fe.tag,Qn=fe.tags[fe.tags.length-1]||fe;Ii.ns===Qn.ns&&(Ii.ns=Object.create(Qn.ns)),Ii.ns[Qe]=fe.attribValue}fe.attribList.push([fe.attribName,fe.attribValue])}else fe.tag.attributes[fe.attribName]=fe.attribValue,mt(fe,"onattribute",{name:fe.attribName,value:fe.attribValue});fe.attribName=fe.attribValue=""}}function yi(fe,W){if(fe.opt.xmlns){var Pt=fe.tag,Qe=Hi(fe.tagName);Pt.prefix=Qe.prefix,Pt.local=Qe.local,Pt.uri=Pt.ns[Qe.prefix]||"",Pt.prefix&&!Pt.uri&&(kt(fe,"Unbound namespace prefix: "+JSON.stringify(fe.tagName)),Pt.uri=Qe.prefix),Pt.ns&&(fe.tags[fe.tags.length-1]||fe).ns!==Pt.ns&&Object.keys(Pt.ns).forEach(function(en){mt(fe,"onopennamespace",{prefix:en,uri:Pt.ns[en]})});for(var Qn=0,vi=fe.attribList.length;Qn<vi;Qn++){var qr=fe.attribList[Qn],Wr=qr[0],he=qr[1],V=Hi(Wr,!0),H=V.prefix,Ke=""===H?"":Pt.ns[H]||"",jt={name:Wr,value:he,prefix:H,local:V.local,uri:Ke};H&&"xmlns"!==H&&!Ke&&(kt(fe,"Unbound namespace prefix: "+JSON.stringify(H)),jt.uri=H),fe.tag.attributes[Wr]=jt,mt(fe,"onattribute",jt)}fe.attribList.length=0}fe.tag.isSelfClosing=!!W,fe.sawRoot=!0,fe.tags.push(fe.tag),mt(fe,"onopentag",fe.tag),W||(fe.state=fe.noscript||"script"!==fe.tagName.toLowerCase()?re.TEXT:re.SCRIPT,fe.tag=null,fe.tagName=""),fe.attribName=fe.attribValue="",fe.attribList.length=0}function Zt(fe){if(!fe.tagName)return kt(fe,"Weird empty close tag."),fe.textNode+="</>",void(fe.state=re.TEXT);if(fe.script){if("script"!==fe.tagName)return fe.script+="</"+fe.tagName+">",fe.tagName="",void(fe.state=re.SCRIPT);mt(fe,"onscript",fe.script),fe.script=""}var W=fe.tags.length,Pt=fe.tagName;fe.strict||(Pt=Pt[fe.looseCase]());for(var Qe=Pt;W--&&fe.tags[W].name!==Qe;)kt(fe,"Unexpected close tag");if(W<0)return kt(fe,"Unmatched closing tag: "+fe.tagName),fe.textNode+="</"+fe.tagName+">",void(fe.state=re.TEXT);fe.tagName=Pt;for(var Qn=fe.tags.length;Qn-- >W;){var vi=fe.tag=fe.tags.pop();fe.tagName=fe.tag.name,mt(fe,"onclosetag",fe.tagName);var qr={};for(var Wr in vi.ns)qr[Wr]=vi.ns[Wr];fe.opt.xmlns&&vi.ns!==(fe.tags[fe.tags.length-1]||fe).ns&&Object.keys(vi.ns).forEach(function(V){mt(fe,"onclosenamespace",{prefix:V,uri:vi.ns[V]})})}0===W&&(fe.closedRoot=!0),fe.tagName=fe.attribValue=fe.attribName="",fe.attribList.length=0,fe.state=re.TEXT}function xo(fe){var Qe,W=fe.entity,Pt=W.toLowerCase(),Ii="";return fe.ENTITIES[W]?fe.ENTITIES[W]:fe.ENTITIES[Pt]?fe.ENTITIES[Pt]:("#"===(W=Pt).charAt(0)&&("x"===W.charAt(1)?(W=W.slice(2),Ii=(Qe=parseInt(W,16)).toString(16)):(W=W.slice(1),Ii=(Qe=parseInt(W,10)).toString(10))),W=W.replace(/^0+/,""),isNaN(Qe)||Ii.toLowerCase()!==W?(kt(fe,"Invalid character entity"),"&"+fe.entity+";"):String.fromCodePoint(Qe))}function go(fe,W){"<"===W?(fe.state=re.OPEN_WAKA,fe.startTagPosition=fe.position):we(W)||(kt(fe,"Non-whitespace before first tag."),fe.textNode=W,fe.state=re.TEXT)}function Di(fe,W){var Pt="";return W<fe.length&&(Pt=fe.charAt(W)),Pt}re=be.STATE,String.fromCodePoint||(fe=String.fromCharCode,W=Math.floor,Pt=function(){var Qe=16384,Ii=[],qr=-1,Wr=arguments.length;if(!Wr)return"";for(var he="";++qr<Wr;){var V=Number(arguments[qr]);if(!isFinite(V)||V<0||V>1114111||W(V)!==V)throw RangeError("Invalid code point: "+V);V<=65535?Ii.push(V):Ii.push(55296+((V-=65536)>>10),V%1024+56320),(qr+1===Wr||Ii.length>Qe)&&(he+=fe.apply(null,Ii),Ii.length=0)}return he},Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:Pt,configurable:!0,writable:!0}):String.fromCodePoint=Pt)}(hn)},5398:(rn,hn,qe)=>{var be=qe(6570);function Me(){be.call(this)}Me.prototype=new be,rn.exports=Me,Me.Stream=Me,Me.prototype.pipe=function(Te,p){var te=this;function Ye(Ge){Te.writable&&!1===Te.write(Ge)&&te.pause&&te.pause()}function ne(){te.readable&&te.resume&&te.resume()}te.on("data",Ye),Te.on("drain",ne),!Te._isStdio&&(!p||!1!==p.end)&&(te.on("end",Xe),te.on("close",gt));var Ve=!1;function Xe(){Ve||(Ve=!0,Te.end())}function gt(){Ve||(Ve=!0,"function"==typeof Te.destroy&&Te.destroy())}function wt(Ge){if(Ue(),!this.hasListeners("error"))throw Ge}function Ue(){te.off("data",Ye),Te.off("drain",ne),te.off("end",Xe),te.off("close",gt),te.off("error",wt),Te.off("error",wt),te.off("end",Ue),te.off("close",Ue),Te.off("end",Ue),Te.off("close",Ue)}return te.on("error",wt),Te.on("error",wt),te.on("end",Ue),te.on("close",Ue),Te.on("end",Ue),Te.on("close",Ue),Te.emit("pipe",te),Te}},3054:(rn,hn,qe)=>{"use strict";var be=qe(3502).Buffer,Me=be.isEncoding||function(st){switch((st=""+st)&&st.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function te(st){var an;switch(this.encoding=function p(st){var an=function Te(st){if(!st)return"utf8";for(var an;;)switch(st){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return st;default:if(an)return;st=(""+st).toLowerCase(),an=!0}}(st);if("string"!=typeof an&&(be.isEncoding===Me||!Me(st)))throw new Error("Unknown encoding: "+st);return an||st}(st),this.encoding){case"utf16le":this.text=Ue,this.end=Ge,an=4;break;case"utf8":this.fillLast=Xe,an=4;break;case"base64":this.text=xt,this.end=Kt,an=3;break;default:return this.write=_n,void(this.end=Sn)}this.lastNeed=0,this.lastTotal=0,this.lastChar=be.allocUnsafe(an)}function Ye(st){return st<=127?0:st>>5==6?2:st>>4==14?3:st>>3==30?4:st>>6==2?-1:-2}function Xe(st){var an=this.lastTotal-this.lastNeed,we=function Ve(st,an,we){if(128!=(192&an[0]))return st.lastNeed=0,"\ufffd";if(st.lastNeed>1&&an.length>1){if(128!=(192&an[1]))return st.lastNeed=1,"\ufffd";if(st.lastNeed>2&&an.length>2&&128!=(192&an[2]))return st.lastNeed=2,"\ufffd"}}(this,st);return void 0!==we?we:this.lastNeed<=st.length?(st.copy(this.lastChar,an,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(st.copy(this.lastChar,an,0,st.length),void(this.lastNeed-=st.length))}function Ue(st,an){if((st.length-an)%2==0){var we=st.toString("utf16le",an);if(we){var ye=we.charCodeAt(we.length-1);if(ye>=55296&&ye<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=st[st.length-2],this.lastChar[1]=st[st.length-1],we.slice(0,-1)}return we}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=st[st.length-1],st.toString("utf16le",an,st.length-1)}function Ge(st){var an=st&&st.length?this.write(st):"";return this.lastNeed?an+this.lastChar.toString("utf16le",0,this.lastTotal-this.lastNeed):an}function xt(st,an){var we=(st.length-an)%3;return 0===we?st.toString("base64",an):(this.lastNeed=3-we,this.lastTotal=3,1===we?this.lastChar[0]=st[st.length-1]:(this.lastChar[0]=st[st.length-2],this.lastChar[1]=st[st.length-1]),st.toString("base64",an,st.length-we))}function Kt(st){var an=st&&st.length?this.write(st):"";return this.lastNeed?an+this.lastChar.toString("base64",0,3-this.lastNeed):an}function _n(st){return st.toString(this.encoding)}function Sn(st){return st&&st.length?this.write(st):""}hn.s=te,te.prototype.write=function(st){if(0===st.length)return"";var an,we;if(this.lastNeed){if(void 0===(an=this.fillLast(st)))return"";we=this.lastNeed,this.lastNeed=0}else we=0;return we<st.length?an?an+this.text(st,we):this.text(st,we):an||""},te.prototype.end=function wt(st){var an=st&&st.length?this.write(st):"";return this.lastNeed?an+"\ufffd":an},te.prototype.text=function gt(st,an){var we=function ne(st,an,we){var ye=an.length-1;if(ye<we)return 0;var Ie=Ye(an[ye]);return Ie>=0?(Ie>0&&(st.lastNeed=Ie-1),Ie):--ye<we||-2===Ie?0:(Ie=Ye(an[ye]))>=0?(Ie>0&&(st.lastNeed=Ie-2),Ie):--ye<we||-2===Ie?0:(Ie=Ye(an[ye]))>=0?(Ie>0&&(2===Ie?Ie=0:st.lastNeed=Ie-3),Ie):0}(this,st,an);if(!this.lastNeed)return st.toString("utf8",an);this.lastTotal=we;var ye=st.length-(we-this.lastNeed);return st.copy(this.lastChar,0,ye),st.toString("utf8",an,ye)},te.prototype.fillLast=function(st){if(this.lastNeed<=st.length)return st.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);st.copy(this.lastChar,this.lastTotal-this.lastNeed,0,st.length),this.lastNeed-=st.length}},599:function(rn){(function(){rn.exports={Disconnected:1,Preceding:2,Following:4,Contains:8,ContainedBy:16,ImplementationSpecific:32}}).call(this)},2269:function(rn){(function(){rn.exports={Element:1,Attribute:2,Text:3,CData:4,EntityReference:5,EntityDeclaration:6,ProcessingInstruction:7,Comment:8,Document:9,DocType:10,DocumentFragment:11,NotationDeclaration:12,Declaration:201,Raw:202,AttributeDeclaration:203,ElementDeclaration:204,Dummy:205}}).call(this)},3452:function(rn){(function(){var hn,qe,be,Me,Te,p,te,Ye={}.hasOwnProperty;hn=function(ne,...Ve){var Xe,gt,wt,Ue;if(Te(Object.assign))Object.assign.apply(null,arguments);else for(Xe=0,wt=Ve.length;Xe<wt;Xe++)if(null!=(Ue=Ve[Xe]))for(gt in Ue)!Ye.call(Ue,gt)||(ne[gt]=Ue[gt]);return ne},Te=function(ne){return!!ne&&"[object Function]"===Object.prototype.toString.call(ne)},p=function(ne){var Ve;return!!ne&&("function"==(Ve=typeof ne)||"object"===Ve)},be=function(ne){return Te(Array.isArray)?Array.isArray(ne):"[object Array]"===Object.prototype.toString.call(ne)},Me=function(ne){var Ve;if(be(ne))return!ne.length;for(Ve in ne)if(Ye.call(ne,Ve))return!1;return!0},te=function(ne){var Ve,Xe;return p(ne)&&(Xe=Object.getPrototypeOf(ne))&&(Ve=Xe.constructor)&&"function"==typeof Ve&&Ve instanceof Ve&&Function.prototype.toString.call(Ve)===Function.prototype.toString.call(Object)},qe=function(ne){return Te(ne.valueOf)?ne.valueOf():ne},rn.exports.assign=hn,rn.exports.isFunction=Te,rn.exports.isObject=p,rn.exports.isArray=be,rn.exports.isEmpty=Me,rn.exports.isPlainObject=te,rn.exports.getValue=qe}).call(this)},6316:function(rn){(function(){rn.exports={None:0,OpenTag:1,InsideTag:2,CloseTag:3}}).call(this)},5968:function(rn,hn,qe){(function(){var be;be=qe(2269),qe(8563),rn.exports=function(){class p{constructor(Ye,ne,Ve){if(this.parent=Ye,this.parent&&(this.options=this.parent.options,this.stringify=this.parent.stringify),null==ne)throw new Error("Missing attribute name. "+this.debugInfo(ne));this.name=this.stringify.name(ne),this.value=this.stringify.attValue(Ve),this.type=be.Attribute,this.isId=!1,this.schemaTypeInfo=null}clone(){return Object.create(this)}toString(Ye){return this.options.writer.attribute(this,this.options.writer.filterOptions(Ye))}debugInfo(Ye){return null==(Ye=Ye||this.name)?"parent: <"+this.parent.name+">":"attribute: {"+Ye+"}, parent: <"+this.parent.name+">"}isEqualNode(Ye){return!(Ye.namespaceURI!==this.namespaceURI||Ye.prefix!==this.prefix||Ye.localName!==this.localName||Ye.value!==this.value)}}return Object.defineProperty(p.prototype,"nodeType",{get:function(){return this.type}}),Object.defineProperty(p.prototype,"ownerElement",{get:function(){return this.parent}}),Object.defineProperty(p.prototype,"textContent",{get:function(){return this.value},set:function(te){return this.value=te||""}}),Object.defineProperty(p.prototype,"namespaceURI",{get:function(){return""}}),Object.defineProperty(p.prototype,"prefix",{get:function(){return""}}),Object.defineProperty(p.prototype,"localName",{get:function(){return this.name}}),Object.defineProperty(p.prototype,"specified",{get:function(){return!0}}),p}.call(this)}).call(this)},1361:function(rn,hn,qe){(function(){var be,Te;be=qe(2269),Te=qe(2182),rn.exports=class extends Te{constructor(te,Ye){if(super(te),null==Ye)throw new Error("Missing CDATA text. "+this.debugInfo());this.name="#cdata-section",this.type=be.CData,this.value=this.stringify.cdata(Ye)}clone(){return Object.create(this)}toString(te){return this.options.writer.cdata(this,this.options.writer.filterOptions(te))}}}).call(this)},2182:function(rn,hn,qe){(function(){var Me;Me=qe(8563),rn.exports=function(){class Te extends Me{constructor(te){super(te),this.value=""}clone(){return Object.create(this)}substringData(te,Ye){throw new Error("This DOM method is not implemented."+this.debugInfo())}appendData(te){throw new Error("This DOM method is not implemented."+this.debugInfo())}insertData(te,Ye){throw new Error("This DOM method is not implemented."+this.debugInfo())}deleteData(te,Ye){throw new Error("This DOM method is not implemented."+this.debugInfo())}replaceData(te,Ye,ne){throw new Error("This DOM method is not implemented."+this.debugInfo())}isEqualNode(te){return!(!super.isEqualNode(te)||te.data!==this.data)}}return Object.defineProperty(Te.prototype,"data",{get:function(){return this.value},set:function(p){return this.value=p||""}}),Object.defineProperty(Te.prototype,"length",{get:function(){return this.value.length}}),Object.defineProperty(Te.prototype,"textContent",{get:function(){return this.value},set:function(p){return this.value=p||""}}),Te}.call(this)}).call(this)},2516:function(rn,hn,qe){(function(){var be,Me;be=qe(2269),Me=qe(2182),rn.exports=class extends Me{constructor(te,Ye){if(super(te),null==Ye)throw new Error("Missing comment text. "+this.debugInfo());this.name="#comment",this.type=be.Comment,this.value=this.stringify.comment(Ye)}clone(){return Object.create(this)}toString(te){return this.options.writer.comment(this,this.options.writer.filterOptions(te))}}}).call(this)},5806:function(rn,hn,qe){(function(){var Me,Te;Me=qe(9276),Te=qe(3735),rn.exports=function(){class p{constructor(){this.defaultParams={"canonical-form":!1,"cdata-sections":!1,comments:!1,"datatype-normalization":!1,"element-content-whitespace":!0,entities:!0,"error-handler":new Me,infoset:!0,"validate-if-schema":!1,namespaces:!0,"namespace-declarations":!0,"normalize-characters":!1,"schema-location":"","schema-type":"","split-cdata-sections":!0,validate:!1,"well-formed":!0},this.params=Object.create(this.defaultParams)}getParameter(Ye){return this.params.hasOwnProperty(Ye)?this.params[Ye]:null}canSetParameter(Ye,ne){return!0}setParameter(Ye,ne){return null!=ne?this.params[Ye]=ne:delete this.params[Ye]}}return Object.defineProperty(p.prototype,"parameterNames",{get:function(){return new Te(Object.keys(this.defaultParams))}}),p}.call(this)}).call(this)},9276:function(rn){(function(){rn.exports=class{constructor(){}handleError(be){throw new Error(be)}}}).call(this)},9906:function(rn){(function(){rn.exports=class{hasFeature(be,Me){return!0}createDocumentType(be,Me,Te){throw new Error("This DOM method is not implemented.")}createDocument(be,Me,Te){throw new Error("This DOM method is not implemented.")}createHTMLDocument(be){throw new Error("This DOM method is not implemented.")}getFeature(be,Me){throw new Error("This DOM method is not implemented.")}}}).call(this)},3735:function(rn){(function(){rn.exports=function(){class qe{constructor(Me){this.arr=Me||[]}item(Me){return this.arr[Me]||null}contains(Me){return-1!==this.arr.indexOf(Me)}}return Object.defineProperty(qe.prototype,"length",{get:function(){return this.arr.length}}),qe}.call(this)}).call(this)},7274:function(rn,hn,qe){(function(){var be,Te;Te=qe(8563),be=qe(2269),rn.exports=class extends Te{constructor(te,Ye,ne,Ve,Xe,gt){if(super(te),null==Ye)throw new Error("Missing DTD element name. "+this.debugInfo());if(null==ne)throw new Error("Missing DTD attribute name. "+this.debugInfo(Ye));if(!Ve)throw new Error("Missing DTD attribute type. "+this.debugInfo(Ye));if(!Xe)throw new Error("Missing DTD attribute default. "+this.debugInfo(Ye));if(0!==Xe.indexOf("#")&&(Xe="#"+Xe),!Xe.match(/^(#REQUIRED|#IMPLIED|#FIXED|#DEFAULT)$/))throw new Error("Invalid default value type; expected: #REQUIRED, #IMPLIED, #FIXED or #DEFAULT. "+this.debugInfo(Ye));if(gt&&!Xe.match(/^(#FIXED|#DEFAULT)$/))throw new Error("Default value only applies to #FIXED or #DEFAULT. "+this.debugInfo(Ye));this.elementName=this.stringify.name(Ye),this.type=be.AttributeDeclaration,this.attributeName=this.stringify.name(ne),this.attributeType=this.stringify.dtdAttType(Ve),gt&&(this.defaultValue=this.stringify.dtdAttDefault(gt)),this.defaultValueType=Xe}toString(te){return this.options.writer.dtdAttList(this,this.options.writer.filterOptions(te))}}}).call(this)},2068:function(rn,hn,qe){(function(){var be,Te;Te=qe(8563),be=qe(2269),rn.exports=class extends Te{constructor(te,Ye,ne){if(super(te),null==Ye)throw new Error("Missing DTD element name. "+this.debugInfo());ne||(ne="(#PCDATA)"),Array.isArray(ne)&&(ne="("+ne.join(",")+")"),this.name=this.stringify.name(Ye),this.type=be.ElementDeclaration,this.value=this.stringify.dtdElementValue(ne)}toString(te){return this.options.writer.dtdElement(this,this.options.writer.filterOptions(te))}}}).call(this)},8349:function(rn,hn,qe){(function(){var be,Te,p;({isObject:p}=qe(3452)),Te=qe(8563),be=qe(2269),rn.exports=function(){class te extends Te{constructor(ne,Ve,Xe,gt){if(super(ne),null==Xe)throw new Error("Missing DTD entity name. "+this.debugInfo(Xe));if(null==gt)throw new Error("Missing DTD entity value. "+this.debugInfo(Xe));if(this.pe=!!Ve,this.name=this.stringify.name(Xe),this.type=be.EntityDeclaration,p(gt)){if(!gt.pubID&&!gt.sysID)throw new Error("Public and/or system identifiers are required for an external entity. "+this.debugInfo(Xe));if(gt.pubID&&!gt.sysID)throw new Error("System identifier is required for a public external entity. "+this.debugInfo(Xe));if(this.internal=!1,null!=gt.pubID&&(this.pubID=this.stringify.dtdPubID(gt.pubID)),null!=gt.sysID&&(this.sysID=this.stringify.dtdSysID(gt.sysID)),null!=gt.nData&&(this.nData=this.stringify.dtdNData(gt.nData)),this.pe&&this.nData)throw new Error("Notation declaration is not allowed in a parameter entity. "+this.debugInfo(Xe))}else this.value=this.stringify.dtdEntityValue(gt),this.internal=!0}toString(ne){return this.options.writer.dtdEntity(this,this.options.writer.filterOptions(ne))}}return Object.defineProperty(te.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(te.prototype,"systemId",{get:function(){return this.sysID}}),Object.defineProperty(te.prototype,"notationName",{get:function(){return this.nData||null}}),Object.defineProperty(te.prototype,"inputEncoding",{get:function(){return null}}),Object.defineProperty(te.prototype,"xmlEncoding",{get:function(){return null}}),Object.defineProperty(te.prototype,"xmlVersion",{get:function(){return null}}),te}.call(this)}).call(this)},3087:function(rn,hn,qe){(function(){var be,Te;Te=qe(8563),be=qe(2269),rn.exports=function(){class p extends Te{constructor(Ye,ne,Ve){if(super(Ye),null==ne)throw new Error("Missing DTD notation name. "+this.debugInfo(ne));if(!Ve.pubID&&!Ve.sysID)throw new Error("Public or system identifiers are required for an external entity. "+this.debugInfo(ne));this.name=this.stringify.name(ne),this.type=be.NotationDeclaration,null!=Ve.pubID&&(this.pubID=this.stringify.dtdPubID(Ve.pubID)),null!=Ve.sysID&&(this.sysID=this.stringify.dtdSysID(Ve.sysID))}toString(Ye){return this.options.writer.dtdNotation(this,this.options.writer.filterOptions(Ye))}}return Object.defineProperty(p.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(p.prototype,"systemId",{get:function(){return this.sysID}}),p}.call(this)}).call(this)},4789:function(rn,hn,qe){(function(){var be,Te,p;({isObject:p}=qe(3452)),Te=qe(8563),be=qe(2269),rn.exports=class extends Te{constructor(Ye,ne,Ve,Xe){super(Ye),p(ne)&&({version:ne,encoding:Ve,standalone:Xe}=ne),ne||(ne="1.0"),this.type=be.Declaration,this.version=this.stringify.xmlVersion(ne),null!=Ve&&(this.encoding=this.stringify.xmlEncoding(Ve)),null!=Xe&&(this.standalone=this.stringify.xmlStandalone(Xe))}toString(Ye){return this.options.writer.declaration(this,this.options.writer.filterOptions(Ye))}}}).call(this)},9195:function(rn,hn,qe){(function(){var be,Me,Te,p,te,ne,Ve,Xe;({isObject:Xe}=qe(3452)),Ve=qe(8563),be=qe(2269),Me=qe(7274),p=qe(8349),Te=qe(2068),te=qe(3087),ne=qe(5264),rn.exports=function(){class gt extends Ve{constructor(Ue,Ge,xt){var Kt,_n,Sn,st;if(super(Ue),this.type=be.DocType,Ue.children)for(_n=0,Sn=(st=Ue.children).length;_n<Sn;_n++)if((Kt=st[_n]).type===be.Element){this.name=Kt.name;break}this.documentObject=Ue,Xe(Ge)&&({pubID:Ge,sysID:xt}=Ge),null==xt&&([xt,Ge]=[Ge,xt]),null!=Ge&&(this.pubID=this.stringify.dtdPubID(Ge)),null!=xt&&(this.sysID=this.stringify.dtdSysID(xt))}element(Ue,Ge){var xt;return xt=new Te(this,Ue,Ge),this.children.push(xt),this}attList(Ue,Ge,xt,Kt,_n){var Sn;return Sn=new Me(this,Ue,Ge,xt,Kt,_n),this.children.push(Sn),this}entity(Ue,Ge){var xt;return xt=new p(this,!1,Ue,Ge),this.children.push(xt),this}pEntity(Ue,Ge){var xt;return xt=new p(this,!0,Ue,Ge),this.children.push(xt),this}notation(Ue,Ge){var xt;return xt=new te(this,Ue,Ge),this.children.push(xt),this}toString(Ue){return this.options.writer.docType(this,this.options.writer.filterOptions(Ue))}ele(Ue,Ge){return this.element(Ue,Ge)}att(Ue,Ge,xt,Kt,_n){return this.attList(Ue,Ge,xt,Kt,_n)}ent(Ue,Ge){return this.entity(Ue,Ge)}pent(Ue,Ge){return this.pEntity(Ue,Ge)}not(Ue,Ge){return this.notation(Ue,Ge)}up(){return this.root()||this.documentObject}isEqualNode(Ue){return!(!super.isEqualNode(Ue)||Ue.name!==this.name||Ue.publicId!==this.publicId||Ue.systemId!==this.systemId)}}return Object.defineProperty(gt.prototype,"entities",{get:function(){var wt,Ue,Ge,xt,Kt;for(xt={},Ue=0,Ge=(Kt=this.children).length;Ue<Ge;Ue++)(wt=Kt[Ue]).type===be.EntityDeclaration&&!wt.pe&&(xt[wt.name]=wt);return new ne(xt)}}),Object.defineProperty(gt.prototype,"notations",{get:function(){var wt,Ue,Ge,xt,Kt;for(xt={},Ue=0,Ge=(Kt=this.children).length;Ue<Ge;Ue++)(wt=Kt[Ue]).type===be.NotationDeclaration&&(xt[wt.name]=wt);return new ne(xt)}}),Object.defineProperty(gt.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(gt.prototype,"systemId",{get:function(){return this.sysID}}),Object.defineProperty(gt.prototype,"internalSubset",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),gt}.call(this)}).call(this)},519:function(rn,hn,qe){(function(){var be,Me,Te,te,Ye,ne,Ve;({isPlainObject:Ve}=qe(3452)),Te=qe(9906),Me=qe(5806),te=qe(8563),be=qe(2269),ne=qe(5041),Ye=qe(4354),rn.exports=function(){class Xe extends te{constructor(wt){super(null),this.name="#document",this.type=be.Document,this.documentURI=null,this.domConfig=new Me,wt||(wt={}),wt.writer||(wt.writer=new Ye),this.options=wt,this.stringify=new ne(wt)}end(wt){var Ue;return Ue={},wt?Ve(wt)&&(Ue=wt,wt=this.options.writer):wt=this.options.writer,wt.document(this,wt.filterOptions(Ue))}toString(wt){return this.options.writer.document(this,this.options.writer.filterOptions(wt))}createElement(wt){throw new Error("This DOM method is not implemented."+this.debugInfo())}createDocumentFragment(){throw new Error("This DOM method is not implemented."+this.debugInfo())}createTextNode(wt){throw new Error("This DOM method is not implemented."+this.debugInfo())}createComment(wt){throw new Error("This DOM method is not implemented."+this.debugInfo())}createCDATASection(wt){throw new Error("This DOM method is not implemented."+this.debugInfo())}createProcessingInstruction(wt,Ue){throw new Error("This DOM method is not implemented."+this.debugInfo())}createAttribute(wt){throw new Error("This DOM method is not implemented."+this.debugInfo())}createEntityReference(wt){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagName(wt){throw new Error("This DOM method is not implemented."+this.debugInfo())}importNode(wt,Ue){throw new Error("This DOM method is not implemented."+this.debugInfo())}createElementNS(wt,Ue){throw new Error("This DOM method is not implemented."+this.debugInfo())}createAttributeNS(wt,Ue){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagNameNS(wt,Ue){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementById(wt){throw new Error("This DOM method is not implemented."+this.debugInfo())}adoptNode(wt){throw new Error("This DOM method is not implemented."+this.debugInfo())}normalizeDocument(){throw new Error("This DOM method is not implemented."+this.debugInfo())}renameNode(wt,Ue,Ge){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByClassName(wt){throw new Error("This DOM method is not implemented."+this.debugInfo())}createEvent(wt){throw new Error("This DOM method is not implemented."+this.debugInfo())}createRange(){throw new Error("This DOM method is not implemented."+this.debugInfo())}createNodeIterator(wt,Ue,Ge){throw new Error("This DOM method is not implemented."+this.debugInfo())}createTreeWalker(wt,Ue,Ge){throw new Error("This DOM method is not implemented."+this.debugInfo())}}return Object.defineProperty(Xe.prototype,"implementation",{value:new Te}),Object.defineProperty(Xe.prototype,"doctype",{get:function(){var gt,wt,Ue,Ge;for(wt=0,Ue=(Ge=this.children).length;wt<Ue;wt++)if((gt=Ge[wt]).type===be.DocType)return gt;return null}}),Object.defineProperty(Xe.prototype,"documentElement",{get:function(){return this.rootObject||null}}),Object.defineProperty(Xe.prototype,"inputEncoding",{get:function(){return null}}),Object.defineProperty(Xe.prototype,"strictErrorChecking",{get:function(){return!1}}),Object.defineProperty(Xe.prototype,"xmlEncoding",{get:function(){return 0!==this.children.length&&this.children[0].type===be.Declaration?this.children[0].encoding:null}}),Object.defineProperty(Xe.prototype,"xmlStandalone",{get:function(){return 0!==this.children.length&&this.children[0].type===be.Declaration&&"yes"===this.children[0].standalone}}),Object.defineProperty(Xe.prototype,"xmlVersion",{get:function(){return 0!==this.children.length&&this.children[0].type===be.Declaration?this.children[0].version:"1.0"}}),Object.defineProperty(Xe.prototype,"URL",{get:function(){return this.documentURI}}),Object.defineProperty(Xe.prototype,"origin",{get:function(){return null}}),Object.defineProperty(Xe.prototype,"compatMode",{get:function(){return null}}),Object.defineProperty(Xe.prototype,"characterSet",{get:function(){return null}}),Object.defineProperty(Xe.prototype,"contentType",{get:function(){return null}}),Xe}.call(this)}).call(this)},1105:function(rn,hn,qe){(function(){var be,Me,Te,p,te,Ye,ne,Ve,Xe,gt,wt,Ue,xt,Kt,_n,Sn,st,an,we,ye,Ie,ae,dt={}.hasOwnProperty;({isObject:Ie,isFunction:ye,isPlainObject:ae,getValue:we}=qe(3452)),be=qe(2269),Ue=qe(519),xt=qe(3352),p=qe(1361),te=qe(2516),_n=qe(9942),an=qe(474),Kt=qe(4666),gt=qe(4789),wt=qe(9195),Ye=qe(7274),Ve=qe(8349),ne=qe(2068),Xe=qe(3087),Te=qe(5968),st=qe(5041),Sn=qe(4354),Me=qe(6316),rn.exports=class{constructor(me,lt,mt){var je;this.name="?xml",this.type=be.Document,me||(me={}),je={},me.writer?ae(me.writer)&&(je=me.writer,me.writer=new Sn):me.writer=new Sn,this.options=me,this.writer=me.writer,this.writerOptions=this.writer.filterOptions(je),this.stringify=new st(me),this.onDataCallback=lt||function(){},this.onEndCallback=mt||function(){},this.currentNode=null,this.currentLevel=-1,this.openTags={},this.documentStarted=!1,this.documentCompleted=!1,this.root=null}createChildNode(me){var mt,je,yt,Tt,ri,kt,cn;switch(me.type){case be.CData:this.cdata(me.value);break;case be.Comment:this.comment(me.value);break;case be.Element:for(mt in je={},kt=me.attribs)!dt.call(kt,mt)||(je[mt]=kt[mt].value);this.node(me.name,je);break;case be.Dummy:this.dummy();break;case be.Raw:this.raw(me.value);break;case be.Text:this.text(me.value);break;case be.ProcessingInstruction:this.instruction(me.target,me.value);break;default:throw new Error("This XML node type is not supported in a JS object: "+me.constructor.name)}for(Tt=0,ri=(cn=me.children).length;Tt<ri;Tt++)this.createChildNode(yt=cn[Tt]),yt.type===be.Element&&this.up();return this}dummy(){return this}node(me,lt,mt){if(null==me)throw new Error("Missing node name.");if(this.root&&-1===this.currentLevel)throw new Error("Document can only have one root node. "+this.debugInfo(me));return this.openCurrent(),me=we(me),null==lt&&(lt={}),lt=we(lt),Ie(lt)||([mt,lt]=[lt,mt]),this.currentNode=new xt(this,me,lt),this.currentNode.children=!1,this.currentLevel++,this.openTags[this.currentLevel]=this.currentNode,null!=mt&&this.text(mt),this}element(me,lt,mt){var je,yt,Tt,ri,kt,cn;if(this.currentNode&&this.currentNode.type===be.DocType)this.dtdElement(...arguments);else if(Array.isArray(me)||Ie(me)||ye(me))for(ri=this.options.noValidation,this.options.noValidation=!0,(cn=new Ue(this.options).element("TEMP_ROOT")).element(me),this.options.noValidation=ri,yt=0,Tt=(kt=cn.children).length;yt<Tt;yt++)this.createChildNode(je=kt[yt]),je.type===be.Element&&this.up();else this.node(me,lt,mt);return this}attribute(me,lt){var mt;if(!this.currentNode||this.currentNode.children)throw new Error("att() can only be used immediately after an ele() call in callback mode. "+this.debugInfo(me));if(null!=me&&(me=we(me)),Ie(me))for(mt in me)!dt.call(me,mt)||this.attribute(mt,me[mt]);else ye(lt)&&(lt=lt.apply()),this.options.keepNullAttributes&&null==lt?this.currentNode.attribs[me]=new Te(this,me,""):null!=lt&&(this.currentNode.attribs[me]=new Te(this,me,lt));return this}text(me){var lt;return this.openCurrent(),lt=new an(this,me),this.onData(this.writer.text(lt,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}cdata(me){var lt;return this.openCurrent(),lt=new p(this,me),this.onData(this.writer.cdata(lt,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}comment(me){var lt;return this.openCurrent(),lt=new te(this,me),this.onData(this.writer.comment(lt,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}raw(me){var lt;return this.openCurrent(),lt=new _n(this,me),this.onData(this.writer.raw(lt,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}instruction(me,lt){var mt,je,Tt,ri;if(this.openCurrent(),null!=me&&(me=we(me)),null!=lt&&(lt=we(lt)),Array.isArray(me))for(mt=0,Tt=me.length;mt<Tt;mt++)this.instruction(je=me[mt]);else if(Ie(me))for(je in me)!dt.call(me,je)||this.instruction(je,me[je]);else ye(lt)&&(lt=lt.apply()),ri=new Kt(this,me,lt),this.onData(this.writer.processingInstruction(ri,this.writerOptions,this.currentLevel+1),this.currentLevel+1);return this}declaration(me,lt,mt){var je;if(this.openCurrent(),this.documentStarted)throw new Error("declaration() must be the first node.");return je=new gt(this,me,lt,mt),this.onData(this.writer.declaration(je,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}doctype(me,lt,mt){if(this.openCurrent(),null==me)throw new Error("Missing root node name.");if(this.root)throw new Error("dtd() must come before the root node.");return this.currentNode=new wt(this,lt,mt),this.currentNode.rootNodeName=me,this.currentNode.children=!1,this.currentLevel++,this.openTags[this.currentLevel]=this.currentNode,this}dtdElement(me,lt){var mt;return this.openCurrent(),mt=new ne(this,me,lt),this.onData(this.writer.dtdElement(mt,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}attList(me,lt,mt,je,yt){var Tt;return this.openCurrent(),Tt=new Ye(this,me,lt,mt,je,yt),this.onData(this.writer.dtdAttList(Tt,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}entity(me,lt){var mt;return this.openCurrent(),mt=new Ve(this,!1,me,lt),this.onData(this.writer.dtdEntity(mt,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}pEntity(me,lt){var mt;return this.openCurrent(),mt=new Ve(this,!0,me,lt),this.onData(this.writer.dtdEntity(mt,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}notation(me,lt){var mt;return this.openCurrent(),mt=new Xe(this,me,lt),this.onData(this.writer.dtdNotation(mt,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}up(){if(this.currentLevel<0)throw new Error("The document node has no parent.");return this.currentNode?(this.currentNode.children?this.closeNode(this.currentNode):this.openNode(this.currentNode),this.currentNode=null):this.closeNode(this.openTags[this.currentLevel]),delete this.openTags[this.currentLevel],this.currentLevel--,this}end(){for(;this.currentLevel>=0;)this.up();return this.onEnd()}openCurrent(){if(this.currentNode)return this.currentNode.children=!0,this.openNode(this.currentNode)}openNode(me){var mt,je,yt;if(!me.isOpen){if(!this.root&&0===this.currentLevel&&me.type===be.Element&&(this.root=me),mt="",me.type===be.Element){for(je in this.writerOptions.state=Me.OpenTag,mt=this.writer.indent(me,this.writerOptions,this.currentLevel)+"<"+me.name,yt=me.attribs)!dt.call(yt,je)||(mt+=this.writer.attribute(yt[je],this.writerOptions,this.currentLevel));mt+=(me.children?">":"/>")+this.writer.endline(me,this.writerOptions,this.currentLevel),this.writerOptions.state=Me.InsideTag}else this.writerOptions.state=Me.OpenTag,mt=this.writer.indent(me,this.writerOptions,this.currentLevel)+"<!DOCTYPE "+me.rootNodeName,me.pubID&&me.sysID?mt+=' PUBLIC "'+me.pubID+'" "'+me.sysID+'"':me.sysID&&(mt+=' SYSTEM "'+me.sysID+'"'),me.children?(mt+=" [",this.writerOptions.state=Me.InsideTag):(this.writerOptions.state=Me.CloseTag,mt+=">"),mt+=this.writer.endline(me,this.writerOptions,this.currentLevel);return this.onData(mt,this.currentLevel),me.isOpen=!0}}closeNode(me){var lt;if(!me.isClosed)return"",this.writerOptions.state=Me.CloseTag,lt=me.type===be.Element?this.writer.indent(me,this.writerOptions,this.currentLevel)+"</"+me.name+">"+this.writer.endline(me,this.writerOptions,this.currentLevel):this.writer.indent(me,this.writerOptions,this.currentLevel)+"]>"+this.writer.endline(me,this.writerOptions,this.currentLevel),this.writerOptions.state=Me.None,this.onData(lt,this.currentLevel),me.isClosed=!0}onData(me,lt){return this.documentStarted=!0,this.onDataCallback(me,lt+1)}onEnd(){return this.documentCompleted=!0,this.onEndCallback()}debugInfo(me){return null==me?"":"node: <"+me+">"}ele(){return this.element(...arguments)}nod(me,lt,mt){return this.node(me,lt,mt)}txt(me){return this.text(me)}dat(me){return this.cdata(me)}com(me){return this.comment(me)}ins(me,lt){return this.instruction(me,lt)}dec(me,lt,mt){return this.declaration(me,lt,mt)}dtd(me,lt,mt){return this.doctype(me,lt,mt)}e(me,lt,mt){return this.element(me,lt,mt)}n(me,lt,mt){return this.node(me,lt,mt)}t(me){return this.text(me)}d(me){return this.cdata(me)}c(me){return this.comment(me)}r(me){return this.raw(me)}i(me,lt){return this.instruction(me,lt)}att(){return this.currentNode&&this.currentNode.type===be.DocType?this.attList(...arguments):this.attribute(...arguments)}a(){return this.currentNode&&this.currentNode.type===be.DocType?this.attList(...arguments):this.attribute(...arguments)}ent(me,lt){return this.entity(me,lt)}pent(me,lt){return this.pEntity(me,lt)}not(me,lt){return this.notation(me,lt)}}}).call(this)},4173:function(rn,hn,qe){(function(){var be,Te;Te=qe(8563),be=qe(2269),rn.exports=class extends Te{constructor(te){super(te),this.type=be.Dummy}clone(){return Object.create(this)}toString(te){return""}}}).call(this)},3352:function(rn,hn,qe){(function(){var be,Me,p,te,Ye,ne,Ve,Xe={}.hasOwnProperty;({isObject:Ve,isFunction:ne,getValue:Ye}=qe(3452)),te=qe(8563),be=qe(2269),Me=qe(5968),p=qe(5264),rn.exports=function(){class gt extends te{constructor(Ue,Ge,xt){var Kt,_n,Sn,st;if(super(Ue),null==Ge)throw new Error("Missing element name. "+this.debugInfo());if(this.name=this.stringify.name(Ge),this.type=be.Element,this.attribs={},this.schemaTypeInfo=null,null!=xt&&this.attribute(xt),Ue.type===be.Document&&(this.isRoot=!0,this.documentObject=Ue,Ue.rootObject=this,Ue.children))for(_n=0,Sn=(st=Ue.children).length;_n<Sn;_n++)if((Kt=st[_n]).type===be.DocType){Kt.name=this.name;break}}clone(){var Ge,xt,Kt;for(Ge in(xt=Object.create(this)).isRoot&&(xt.documentObject=null),xt.attribs={},Kt=this.attribs)!Xe.call(Kt,Ge)||(xt.attribs[Ge]=Kt[Ge].clone());return xt.children=[],this.children.forEach(function(_n){var Sn;return(Sn=_n.clone()).parent=xt,xt.children.push(Sn)}),xt}attribute(Ue,Ge){var xt;if(null!=Ue&&(Ue=Ye(Ue)),Ve(Ue))for(xt in Ue)!Xe.call(Ue,xt)||this.attribute(xt,Ue[xt]);else ne(Ge)&&(Ge=Ge.apply()),this.options.keepNullAttributes&&null==Ge?this.attribs[Ue]=new Me(this,Ue,""):null!=Ge&&(this.attribs[Ue]=new Me(this,Ue,Ge));return this}removeAttribute(Ue){var xt,Kt;if(null==Ue)throw new Error("Missing attribute name. "+this.debugInfo());if(Ue=Ye(Ue),Array.isArray(Ue))for(xt=0,Kt=Ue.length;xt<Kt;xt++)delete this.attribs[Ue[xt]];else delete this.attribs[Ue];return this}toString(Ue){return this.options.writer.element(this,this.options.writer.filterOptions(Ue))}att(Ue,Ge){return this.attribute(Ue,Ge)}a(Ue,Ge){return this.attribute(Ue,Ge)}getAttribute(Ue){return this.attribs.hasOwnProperty(Ue)?this.attribs[Ue].value:null}setAttribute(Ue,Ge){throw new Error("This DOM method is not implemented."+this.debugInfo())}getAttributeNode(Ue){return this.attribs.hasOwnProperty(Ue)?this.attribs[Ue]:null}setAttributeNode(Ue){throw new Error("This DOM method is not implemented."+this.debugInfo())}removeAttributeNode(Ue){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagName(Ue){throw new Error("This DOM method is not implemented."+this.debugInfo())}getAttributeNS(Ue,Ge){throw new Error("This DOM method is not implemented."+this.debugInfo())}setAttributeNS(Ue,Ge,xt){throw new Error("This DOM method is not implemented."+this.debugInfo())}removeAttributeNS(Ue,Ge){throw new Error("This DOM method is not implemented."+this.debugInfo())}getAttributeNodeNS(Ue,Ge){throw new Error("This DOM method is not implemented."+this.debugInfo())}setAttributeNodeNS(Ue){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagNameNS(Ue,Ge){throw new Error("This DOM method is not implemented."+this.debugInfo())}hasAttribute(Ue){return this.attribs.hasOwnProperty(Ue)}hasAttributeNS(Ue,Ge){throw new Error("This DOM method is not implemented."+this.debugInfo())}setIdAttribute(Ue,Ge){return this.attribs.hasOwnProperty(Ue)?this.attribs[Ue].isId:Ge}setIdAttributeNS(Ue,Ge,xt){throw new Error("This DOM method is not implemented."+this.debugInfo())}setIdAttributeNode(Ue,Ge){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagName(Ue){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagNameNS(Ue,Ge){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByClassName(Ue){throw new Error("This DOM method is not implemented."+this.debugInfo())}isEqualNode(Ue){var Ge,xt,Kt;if(!super.isEqualNode(Ue)||Ue.namespaceURI!==this.namespaceURI||Ue.prefix!==this.prefix||Ue.localName!==this.localName||Ue.attribs.length!==this.attribs.length)return!1;for(Ge=xt=0,Kt=this.attribs.length-1;0<=Kt?xt<=Kt:xt>=Kt;Ge=0<=Kt?++xt:--xt)if(!this.attribs[Ge].isEqualNode(Ue.attribs[Ge]))return!1;return!0}}return Object.defineProperty(gt.prototype,"tagName",{get:function(){return this.name}}),Object.defineProperty(gt.prototype,"namespaceURI",{get:function(){return""}}),Object.defineProperty(gt.prototype,"prefix",{get:function(){return""}}),Object.defineProperty(gt.prototype,"localName",{get:function(){return this.name}}),Object.defineProperty(gt.prototype,"id",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(gt.prototype,"className",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(gt.prototype,"classList",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(gt.prototype,"attributes",{get:function(){return(!this.attributeMap||!this.attributeMap.nodes)&&(this.attributeMap=new p(this.attribs)),this.attributeMap}}),gt}.call(this)}).call(this)},5264:function(rn){(function(){rn.exports=function(){class qe{constructor(Me){this.nodes=Me}clone(){return this.nodes=null}getNamedItem(Me){return this.nodes[Me]}setNamedItem(Me){var Te;return Te=this.nodes[Me.nodeName],this.nodes[Me.nodeName]=Me,Te||null}removeNamedItem(Me){var Te;return Te=this.nodes[Me],delete this.nodes[Me],Te||null}item(Me){return this.nodes[Object.keys(this.nodes)[Me]]||null}getNamedItemNS(Me,Te){throw new Error("This DOM method is not implemented.")}setNamedItemNS(Me){throw new Error("This DOM method is not implemented.")}removeNamedItemNS(Me,Te){throw new Error("This DOM method is not implemented.")}}return Object.defineProperty(qe.prototype,"length",{get:function(){return Object.keys(this.nodes).length||0}}),qe}.call(this)}).call(this)},8563:function(rn,hn,qe){(function(){var be,Me,Te,p,te,Ye,ne,Ve,wt,Ue,Ge,xt,Kt,_n,Sn,st,an={}.hasOwnProperty,we=[].splice;({isObject:st,isFunction:Sn,isEmpty:_n,getValue:Kt}=qe(3452)),Ve=null,Te=null,p=null,te=null,Ye=null,Ge=null,xt=null,Ue=null,ne=null,Me=null,wt=null,be=null,rn.exports=function(){class ye{constructor(ae){this.parent=ae,this.parent&&(this.options=this.parent.options,this.stringify=this.parent.stringify),this.value=null,this.children=[],this.baseURI=null,Ve||(Ve=qe(3352),Te=qe(1361),p=qe(2516),te=qe(4789),Ye=qe(9195),Ge=qe(9942),xt=qe(474),Ue=qe(4666),ne=qe(4173),Me=qe(2269),wt=qe(5112),qe(5264),be=qe(599))}setParent(ae){var re,me,lt,mt;for(this.parent=ae,ae&&(this.options=ae.options,this.stringify=ae.stringify),mt=[],re=0,me=(lt=this.children).length;re<me;re++)mt.push(lt[re].setParent(this));return mt}element(ae,dt,re){var me,mt,je,yt,Tt,ri,kt,cn;if(Tt=null,null===dt&&null==re&&([dt,re]=[{},null]),null==dt&&(dt={}),dt=Kt(dt),st(dt)||([re,dt]=[dt,re]),null!=ae&&(ae=Kt(ae)),Array.isArray(ae))for(mt=0,ri=ae.length;mt<ri;mt++)Tt=this.element(ae[mt]);else if(Sn(ae))Tt=this.element(ae.apply());else if(st(ae)){for(yt in ae)if(an.call(ae,yt))if(Sn(cn=ae[yt])&&(cn=cn.apply()),!this.options.ignoreDecorators&&this.stringify.convertAttKey&&0===yt.indexOf(this.stringify.convertAttKey))Tt=this.attribute(yt.substr(this.stringify.convertAttKey.length),cn);else if(!this.options.separateArrayItems&&Array.isArray(cn)&&_n(cn))Tt=this.dummy();else if(st(cn)&&_n(cn))Tt=this.element(yt);else if(this.options.keepNullNodes||null!=cn)if(!this.options.separateArrayItems&&Array.isArray(cn))for(je=0,kt=cn.length;je<kt;je++)(me={})[yt]=cn[je],Tt=this.element(me);else st(cn)?!this.options.ignoreDecorators&&this.stringify.convertTextKey&&0===yt.indexOf(this.stringify.convertTextKey)?Tt=this.element(cn):(Tt=this.element(yt)).element(cn):Tt=this.element(yt,cn);else Tt=this.dummy()}else Tt=this.options.keepNullNodes||null!==re?!this.options.ignoreDecorators&&this.stringify.convertTextKey&&0===ae.indexOf(this.stringify.convertTextKey)?this.text(re):!this.options.ignoreDecorators&&this.stringify.convertCDataKey&&0===ae.indexOf(this.stringify.convertCDataKey)?this.cdata(re):!this.options.ignoreDecorators&&this.stringify.convertCommentKey&&0===ae.indexOf(this.stringify.convertCommentKey)?this.comment(re):!this.options.ignoreDecorators&&this.stringify.convertRawKey&&0===ae.indexOf(this.stringify.convertRawKey)?this.raw(re):!this.options.ignoreDecorators&&this.stringify.convertPIKey&&0===ae.indexOf(this.stringify.convertPIKey)?this.instruction(ae.substr(this.stringify.convertPIKey.length),re):this.node(ae,dt,re):this.dummy();if(null==Tt)throw new Error("Could not create any elements with: "+ae+". "+this.debugInfo());return Tt}insertBefore(ae,dt,re){var me,lt,mt,je,yt;if(null!=ae&&ae.type)return je=dt,(mt=ae).setParent(this),je?(lt=children.indexOf(je),yt=children.splice(lt),children.push(mt),Array.prototype.push.apply(children,yt)):children.push(mt),mt;if(this.isRoot)throw new Error("Cannot insert elements at root level. "+this.debugInfo(ae));return lt=this.parent.children.indexOf(this),yt=this.parent.children.splice(lt),me=this.parent.element(ae,dt,re),Array.prototype.push.apply(this.parent.children,yt),me}insertAfter(ae,dt,re){var me,lt,mt;if(this.isRoot)throw new Error("Cannot insert elements at root level. "+this.debugInfo(ae));return lt=this.parent.children.indexOf(this),mt=this.parent.children.splice(lt+1),me=this.parent.element(ae,dt,re),Array.prototype.push.apply(this.parent.children,mt),me}remove(){var ae;if(this.isRoot)throw new Error("Cannot remove the root element. "+this.debugInfo());return ae=this.parent.children.indexOf(this),we.apply(this.parent.children,[ae,ae-ae+1].concat([])),this.parent}node(ae,dt,re){var me;return null!=ae&&(ae=Kt(ae)),dt||(dt={}),dt=Kt(dt),st(dt)||([re,dt]=[dt,re]),me=new Ve(this,ae,dt),null!=re&&me.text(re),this.children.push(me),me}text(ae){var dt;return st(ae)&&this.element(ae),dt=new xt(this,ae),this.children.push(dt),this}cdata(ae){var dt;return dt=new Te(this,ae),this.children.push(dt),this}comment(ae){var dt;return dt=new p(this,ae),this.children.push(dt),this}commentBefore(ae){var re,me;return re=this.parent.children.indexOf(this),me=this.parent.children.splice(re),this.parent.comment(ae),Array.prototype.push.apply(this.parent.children,me),this}commentAfter(ae){var re,me;return re=this.parent.children.indexOf(this),me=this.parent.children.splice(re+1),this.parent.comment(ae),Array.prototype.push.apply(this.parent.children,me),this}raw(ae){var dt;return dt=new Ge(this,ae),this.children.push(dt),this}dummy(){return new ne(this)}instruction(ae,dt){var re,lt,mt,je;if(null!=ae&&(ae=Kt(ae)),null!=dt&&(dt=Kt(dt)),Array.isArray(ae))for(mt=0,je=ae.length;mt<je;mt++)this.instruction(re=ae[mt]);else if(st(ae))for(re in ae)!an.call(ae,re)||this.instruction(re,ae[re]);else Sn(dt)&&(dt=dt.apply()),lt=new Ue(this,ae,dt),this.children.push(lt);return this}instructionBefore(ae,dt){var me,lt;return me=this.parent.children.indexOf(this),lt=this.parent.children.splice(me),this.parent.instruction(ae,dt),Array.prototype.push.apply(this.parent.children,lt),this}instructionAfter(ae,dt){var me,lt;return me=this.parent.children.indexOf(this),lt=this.parent.children.splice(me+1),this.parent.instruction(ae,dt),Array.prototype.push.apply(this.parent.children,lt),this}declaration(ae,dt,re){var me,lt;return me=this.document(),lt=new te(me,ae,dt,re),0===me.children.length?me.children.unshift(lt):me.children[0].type===Me.Declaration?me.children[0]=lt:me.children.unshift(lt),me.root()||me}dtd(ae,dt){var me,lt,mt,je,yt,Tt,ri,kt,cn;for(me=this.document(),lt=new Ye(me,ae,dt),mt=je=0,Tt=(kt=me.children).length;je<Tt;mt=++je)if(kt[mt].type===Me.DocType)return me.children[mt]=lt,lt;for(mt=yt=0,ri=(cn=me.children).length;yt<ri;mt=++yt)if(cn[mt].isRoot)return me.children.splice(mt,0,lt),lt;return me.children.push(lt),lt}up(){if(this.isRoot)throw new Error("The root node has no parent. Use doc() if you need to get the document object.");return this.parent}root(){var ae;for(ae=this;ae;){if(ae.type===Me.Document)return ae.rootObject;if(ae.isRoot)return ae;ae=ae.parent}}document(){var ae;for(ae=this;ae;){if(ae.type===Me.Document)return ae;ae=ae.parent}}end(ae){return this.document().end(ae)}prev(){var ae;if((ae=this.parent.children.indexOf(this))<1)throw new Error("Already at the first node. "+this.debugInfo());return this.parent.children[ae-1]}next(){var ae;if(-1===(ae=this.parent.children.indexOf(this))||ae===this.parent.children.length-1)throw new Error("Already at the last node. "+this.debugInfo());return this.parent.children[ae+1]}importDocument(ae){var dt,re,me,lt,mt;if((re=ae.root().clone()).parent=this,re.isRoot=!1,this.children.push(re),this.type===Me.Document&&(re.isRoot=!0,re.documentObject=this,this.rootObject=re,this.children))for(me=0,lt=(mt=this.children).length;me<lt;me++)if((dt=mt[me]).type===Me.DocType){dt.name=re.name;break}return this}debugInfo(ae){var dt,re;return null!=(ae=ae||this.name)||null!=(dt=this.parent)&&dt.name?null==ae?"parent: <"+this.parent.name+">":null!=(re=this.parent)&&re.name?"node: <"+ae+">, parent: <"+this.parent.name+">":"node: <"+ae+">":""}ele(ae,dt,re){return this.element(ae,dt,re)}nod(ae,dt,re){return this.node(ae,dt,re)}txt(ae){return this.text(ae)}dat(ae){return this.cdata(ae)}com(ae){return this.comment(ae)}ins(ae,dt){return this.instruction(ae,dt)}doc(){return this.document()}dec(ae,dt,re){return this.declaration(ae,dt,re)}e(ae,dt,re){return this.element(ae,dt,re)}n(ae,dt,re){return this.node(ae,dt,re)}t(ae){return this.text(ae)}d(ae){return this.cdata(ae)}c(ae){return this.comment(ae)}r(ae){return this.raw(ae)}i(ae,dt){return this.instruction(ae,dt)}u(){return this.up()}importXMLBuilder(ae){return this.importDocument(ae)}attribute(ae,dt){throw new Error("attribute() applies to element nodes only.")}att(ae,dt){return this.attribute(ae,dt)}a(ae,dt){return this.attribute(ae,dt)}removeAttribute(ae){throw new Error("attribute() applies to element nodes only.")}replaceChild(ae,dt){throw new Error("This DOM method is not implemented."+this.debugInfo())}removeChild(ae){throw new Error("This DOM method is not implemented."+this.debugInfo())}appendChild(ae){throw new Error("This DOM method is not implemented."+this.debugInfo())}hasChildNodes(){return 0!==this.children.length}cloneNode(ae){throw new Error("This DOM method is not implemented."+this.debugInfo())}normalize(){throw new Error("This DOM method is not implemented."+this.debugInfo())}isSupported(ae,dt){return!0}hasAttributes(){return 0!==this.attribs.length}compareDocumentPosition(ae){var re;return this===ae?0:this.document()!==ae.document()?(re=be.Disconnected|be.ImplementationSpecific,Math.random()<.5?re|=be.Preceding:re|=be.Following,re):this.isAncestor(ae)?be.Contains|be.Preceding:this.isDescendant(ae)?be.Contains|be.Following:this.isPreceding(ae)?be.Preceding:be.Following}isSameNode(ae){throw new Error("This DOM method is not implemented."+this.debugInfo())}lookupPrefix(ae){throw new Error("This DOM method is not implemented."+this.debugInfo())}isDefaultNamespace(ae){throw new Error("This DOM method is not implemented."+this.debugInfo())}lookupNamespaceURI(ae){throw new Error("This DOM method is not implemented."+this.debugInfo())}isEqualNode(ae){var dt,re,me;if(ae.nodeType!==this.nodeType||ae.children.length!==this.children.length)return!1;for(dt=re=0,me=this.children.length-1;0<=me?re<=me:re>=me;dt=0<=me?++re:--re)if(!this.children[dt].isEqualNode(ae.children[dt]))return!1;return!0}getFeature(ae,dt){throw new Error("This DOM method is not implemented."+this.debugInfo())}setUserData(ae,dt,re){throw new Error("This DOM method is not implemented."+this.debugInfo())}getUserData(ae){throw new Error("This DOM method is not implemented."+this.debugInfo())}contains(ae){return!!ae&&(ae===this||this.isDescendant(ae))}isDescendant(ae){var dt,me,lt,mt;for(me=0,lt=(mt=this.children).length;me<lt;me++)if(ae===(dt=mt[me])||dt.isDescendant(ae))return!0;return!1}isAncestor(ae){return ae.isDescendant(this)}isPreceding(ae){var dt,re;return dt=this.treePosition(ae),re=this.treePosition(this),-1!==dt&&-1!==re&&dt<re}isFollowing(ae){var dt,re;return dt=this.treePosition(ae),re=this.treePosition(this),-1!==dt&&-1!==re&&dt>re}treePosition(ae){var dt,re;return re=0,dt=!1,this.foreachTreeNode(this.document(),function(me){if(re++,!dt&&me===ae)return dt=!0}),dt?re:-1}foreachTreeNode(ae,dt){var re,me,lt,mt,je;for(ae||(ae=this.document()),me=0,lt=(mt=ae.children).length;me<lt;me++){if(je=dt(re=mt[me]))return je;if(je=this.foreachTreeNode(re,dt))return je}}}return Object.defineProperty(ye.prototype,"nodeName",{get:function(){return this.name}}),Object.defineProperty(ye.prototype,"nodeType",{get:function(){return this.type}}),Object.defineProperty(ye.prototype,"nodeValue",{get:function(){return this.value}}),Object.defineProperty(ye.prototype,"parentNode",{get:function(){return this.parent}}),Object.defineProperty(ye.prototype,"childNodes",{get:function(){return(!this.childNodeList||!this.childNodeList.nodes)&&(this.childNodeList=new wt(this.children)),this.childNodeList}}),Object.defineProperty(ye.prototype,"firstChild",{get:function(){return this.children[0]||null}}),Object.defineProperty(ye.prototype,"lastChild",{get:function(){return this.children[this.children.length-1]||null}}),Object.defineProperty(ye.prototype,"previousSibling",{get:function(){var Ie;return Ie=this.parent.children.indexOf(this),this.parent.children[Ie-1]||null}}),Object.defineProperty(ye.prototype,"nextSibling",{get:function(){var Ie;return Ie=this.parent.children.indexOf(this),this.parent.children[Ie+1]||null}}),Object.defineProperty(ye.prototype,"ownerDocument",{get:function(){return this.document()||null}}),Object.defineProperty(ye.prototype,"textContent",{get:function(){var Ie,ae,dt,re,me;if(this.nodeType===Me.Element||this.nodeType===Me.DocumentFragment){for(me="",ae=0,dt=(re=this.children).length;ae<dt;ae++)(Ie=re[ae]).textContent&&(me+=Ie.textContent);return me}return null},set:function(Ie){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),ye}.call(this)}).call(this)},5112:function(rn){(function(){rn.exports=function(){class qe{constructor(Me){this.nodes=Me}clone(){return this.nodes=null}item(Me){return this.nodes[Me]||null}}return Object.defineProperty(qe.prototype,"length",{get:function(){return this.nodes.length||0}}),qe}.call(this)}).call(this)},4666:function(rn,hn,qe){(function(){var be,Me;be=qe(2269),Me=qe(2182),rn.exports=class extends Me{constructor(te,Ye,ne){if(super(te),null==Ye)throw new Error("Missing instruction target. "+this.debugInfo());this.type=be.ProcessingInstruction,this.target=this.stringify.insTarget(Ye),this.name=this.target,ne&&(this.value=this.stringify.insValue(ne))}clone(){return Object.create(this)}toString(te){return this.options.writer.processingInstruction(this,this.options.writer.filterOptions(te))}isEqualNode(te){return!(!super.isEqualNode(te)||te.target!==this.target)}}}).call(this)},9942:function(rn,hn,qe){(function(){var be,Me;be=qe(2269),Me=qe(8563),rn.exports=class extends Me{constructor(te,Ye){if(super(te),null==Ye)throw new Error("Missing raw text. "+this.debugInfo());this.type=be.Raw,this.value=this.stringify.raw(Ye)}clone(){return Object.create(this)}toString(te){return this.options.writer.raw(this,this.options.writer.filterOptions(te))}}}).call(this)},7647:function(rn,hn,qe){(function(){var be,Me,p,te={}.hasOwnProperty;be=qe(2269),p=qe(3576),Me=qe(6316),rn.exports=class extends p{constructor(ne,Ve){super(Ve),this.stream=ne}endline(ne,Ve,Xe){return ne.isLastRootNode&&Ve.state===Me.CloseTag?"":super.endline(ne,Ve,Xe)}document(ne,Ve){var gt,wt,Ue,Ge,xt,Kt,_n,Sn;for(gt=wt=0,Ge=(Kt=ne.children).length;wt<Ge;gt=++wt)Kt[gt].isLastRootNode=gt===ne.children.length-1;for(Ve=this.filterOptions(Ve),Sn=[],Ue=0,xt=(_n=ne.children).length;Ue<xt;Ue++)Sn.push(this.writeChildNode(_n[Ue],Ve,0));return Sn}cdata(ne,Ve,Xe){return this.stream.write(super.cdata(ne,Ve,Xe))}comment(ne,Ve,Xe){return this.stream.write(super.comment(ne,Ve,Xe))}declaration(ne,Ve,Xe){return this.stream.write(super.declaration(ne,Ve,Xe))}docType(ne,Ve,Xe){var wt,Ue,Ge;if(Xe||(Xe=0),this.openNode(ne,Ve,Xe),Ve.state=Me.OpenTag,this.stream.write(this.indent(ne,Ve,Xe)),this.stream.write("<!DOCTYPE "+ne.root().name),ne.pubID&&ne.sysID?this.stream.write(' PUBLIC "'+ne.pubID+'" "'+ne.sysID+'"'):ne.sysID&&this.stream.write(' SYSTEM "'+ne.sysID+'"'),ne.children.length>0){for(this.stream.write(" ["),this.stream.write(this.endline(ne,Ve,Xe)),Ve.state=Me.InsideTag,wt=0,Ue=(Ge=ne.children).length;wt<Ue;wt++)this.writeChildNode(Ge[wt],Ve,Xe+1);Ve.state=Me.CloseTag,this.stream.write("]")}return Ve.state=Me.CloseTag,this.stream.write(Ve.spaceBeforeSlash+">"),this.stream.write(this.endline(ne,Ve,Xe)),Ve.state=Me.None,this.closeNode(ne,Ve,Xe)}element(ne,Ve,Xe){var Ge,xt,Kt,_n,Sn,st,we,ye,Ie,ae,dt,re;if(Xe||(Xe=0),this.openNode(ne,Ve,Xe),Ve.state=Me.OpenTag,we=this.indent(ne,Ve,Xe)+"<"+ne.name,Ve.pretty&&Ve.width>0)for(st in _n=we.length,Ie=ne.attribs)!te.call(Ie,st)||(_n+(ye=this.attribute(Ie[st],Ve,Xe)).length>Ve.width?(re=this.indent(ne,Ve,Xe+1)+ye,we+=this.endline(ne,Ve,Xe)+re,_n=re.length):(we+=re=" "+ye,_n+=re.length));else for(st in ae=ne.attribs)!te.call(ae,st)||(we+=this.attribute(ae[st],Ve,Xe));if(this.stream.write(we),xt=0===(Ge=ne.children.length)?null:ne.children[0],0===Ge||ne.children.every(function(me){return(me.type===be.Text||me.type===be.Raw||me.type===be.CData)&&""===me.value}))Ve.allowEmpty?(this.stream.write(">"),Ve.state=Me.CloseTag,this.stream.write("</"+ne.name+">")):(Ve.state=Me.CloseTag,this.stream.write(Ve.spaceBeforeSlash+"/>"));else if(!Ve.pretty||1!==Ge||xt.type!==be.Text&&xt.type!==be.Raw&&xt.type!==be.CData||null==xt.value){for(this.stream.write(">"+this.endline(ne,Ve,Xe)),Ve.state=Me.InsideTag,Kt=0,Sn=(dt=ne.children).length;Kt<Sn;Kt++)this.writeChildNode(dt[Kt],Ve,Xe+1);Ve.state=Me.CloseTag,this.stream.write(this.indent(ne,Ve,Xe)+"</"+ne.name+">")}else this.stream.write(">"),Ve.state=Me.InsideTag,Ve.suppressPrettyCount++,this.writeChildNode(xt,Ve,Xe+1),Ve.suppressPrettyCount--,Ve.state=Me.CloseTag,this.stream.write("</"+ne.name+">");return this.stream.write(this.endline(ne,Ve,Xe)),Ve.state=Me.None,this.closeNode(ne,Ve,Xe)}processingInstruction(ne,Ve,Xe){return this.stream.write(super.processingInstruction(ne,Ve,Xe))}raw(ne,Ve,Xe){return this.stream.write(super.raw(ne,Ve,Xe))}text(ne,Ve,Xe){return this.stream.write(super.text(ne,Ve,Xe))}dtdAttList(ne,Ve,Xe){return this.stream.write(super.dtdAttList(ne,Ve,Xe))}dtdElement(ne,Ve,Xe){return this.stream.write(super.dtdElement(ne,Ve,Xe))}dtdEntity(ne,Ve,Xe){return this.stream.write(super.dtdEntity(ne,Ve,Xe))}dtdNotation(ne,Ve,Xe){return this.stream.write(super.dtdNotation(ne,Ve,Xe))}}}).call(this)},4354:function(rn,hn,qe){(function(){var Me;Me=qe(3576),rn.exports=class extends Me{constructor(p){super(p)}document(p,te){var ne,Ve,Xe,gt;for(te=this.filterOptions(te),Xe="",ne=0,Ve=(gt=p.children).length;ne<Ve;ne++)Xe+=this.writeChildNode(gt[ne],te,0);return te.pretty&&Xe.slice(-te.newline.length)===te.newline&&(Xe=Xe.slice(0,-te.newline.length)),Xe}}}).call(this)},5041:function(rn){(function(){var qe={}.hasOwnProperty;rn.exports=function(){class be{constructor(Te){var p,te;for(p in this.assertLegalChar=this.assertLegalChar.bind(this),this.assertLegalName=this.assertLegalName.bind(this),Te||(Te={}),this.options=Te,this.options.version||(this.options.version="1.0"),te=Te.stringify||{})!qe.call(te,p)||(this[p]=te[p])}name(Te){return this.options.noValidation?Te:this.assertLegalName(""+Te||"")}text(Te){return this.options.noValidation?Te:this.assertLegalChar(this.textEscape(""+Te||""))}cdata(Te){return this.options.noValidation?Te:(Te=(Te=""+Te||"").replace("]]>","]]]]><![CDATA[>"),this.assertLegalChar(Te))}comment(Te){if(this.options.noValidation)return Te;if((Te=""+Te||"").match(/--/))throw new Error("Comment text cannot contain double-hypen: "+Te);return this.assertLegalChar(Te)}raw(Te){return this.options.noValidation?Te:""+Te||""}attValue(Te){return this.options.noValidation?Te:this.assertLegalChar(this.attEscape(Te=""+Te||""))}insTarget(Te){return this.options.noValidation?Te:this.assertLegalChar(""+Te||"")}insValue(Te){if(this.options.noValidation)return Te;if((Te=""+Te||"").match(/\?>/))throw new Error("Invalid processing instruction value: "+Te);return this.assertLegalChar(Te)}xmlVersion(Te){if(this.options.noValidation)return Te;if(!(Te=""+Te||"").match(/1\.[0-9]+/))throw new Error("Invalid version number: "+Te);return Te}xmlEncoding(Te){if(this.options.noValidation)return Te;if(!(Te=""+Te||"").match(/^[A-Za-z](?:[A-Za-z0-9._-])*$/))throw new Error("Invalid encoding: "+Te);return this.assertLegalChar(Te)}xmlStandalone(Te){return this.options.noValidation?Te:Te?"yes":"no"}dtdPubID(Te){return this.options.noValidation?Te:this.assertLegalChar(""+Te||"")}dtdSysID(Te){return this.options.noValidation?Te:this.assertLegalChar(""+Te||"")}dtdElementValue(Te){return this.options.noValidation?Te:this.assertLegalChar(""+Te||"")}dtdAttType(Te){return this.options.noValidation?Te:this.assertLegalChar(""+Te||"")}dtdAttDefault(Te){return this.options.noValidation?Te:this.assertLegalChar(""+Te||"")}dtdEntityValue(Te){return this.options.noValidation?Te:this.assertLegalChar(""+Te||"")}dtdNData(Te){return this.options.noValidation?Te:this.assertLegalChar(""+Te||"")}assertLegalChar(Te){var p,te;if(this.options.noValidation)return Te;if("1.0"===this.options.version){if(p=/[\0-\x08\x0B\f\x0E-\x1F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/g,void 0!==this.options.invalidCharReplacement)Te=Te.replace(p,this.options.invalidCharReplacement);else if(te=Te.match(p))throw new Error(`Invalid character in string: ${Te} at index ${te.index}`)}else if("1.1"===this.options.version)if(p=/[\0\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/g,void 0!==this.options.invalidCharReplacement)Te=Te.replace(p,this.options.invalidCharReplacement);else if(te=Te.match(p))throw new Error(`Invalid character in string: ${Te} at index ${te.index}`);return Te}assertLegalName(Te){if(this.options.noValidation)return Te;if(!(Te=this.assertLegalChar(Te)).match(/^([:A-Z_a-z\xC0-\xD6\xD8-\xF6\xF8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])([\x2D\.0-:A-Z_a-z\xB7\xC0-\xD6\xD8-\xF6\xF8-\u037D\u037F-\u1FFF\u200C\u200D\u203F\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])*$/))throw new Error(`Invalid character in name: ${Te}`);return Te}textEscape(Te){return this.options.noValidation?Te:Te.replace(this.options.noDoubleEncoding?/(?!&(lt|gt|amp|apos|quot);)&/g:/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r/g,"&#xD;")}attEscape(Te){return this.options.noValidation?Te:Te.replace(this.options.noDoubleEncoding?/(?!&(lt|gt|amp|apos|quot);)&/g:/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;")}}return be.prototype.convertAttKey="@",be.prototype.convertPIKey="?",be.prototype.convertTextKey="#text",be.prototype.convertCDataKey="#cdata",be.prototype.convertCommentKey="#comment",be.prototype.convertRawKey="#raw",be}.call(this)}).call(this)},474:function(rn,hn,qe){(function(){var be,Me;be=qe(2269),Me=qe(2182),rn.exports=function(){class p extends Me{constructor(Ye,ne){if(super(Ye),null==ne)throw new Error("Missing element text. "+this.debugInfo());this.name="#text",this.type=be.Text,this.value=this.stringify.text(ne)}clone(){return Object.create(this)}toString(Ye){return this.options.writer.text(this,this.options.writer.filterOptions(Ye))}splitText(Ye){throw new Error("This DOM method is not implemented."+this.debugInfo())}replaceWholeText(Ye){throw new Error("This DOM method is not implemented."+this.debugInfo())}}return Object.defineProperty(p.prototype,"isElementContentWhitespace",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(p.prototype,"wholeText",{get:function(){var te,Ye,ne;for(ne="",Ye=this.previousSibling;Ye;)ne=Ye.data+ne,Ye=Ye.previousSibling;for(ne+=this.data,te=this.nextSibling;te;)ne+=te.data,te=te.nextSibling;return ne}}),p}.call(this)}).call(this)},3576:function(rn,hn,qe){(function(){var be,Me,Sn,st={}.hasOwnProperty;({assign:Sn}=qe(3452)),be=qe(2269),qe(4789),qe(9195),qe(1361),qe(2516),qe(3352),qe(9942),qe(474),qe(4666),qe(4173),qe(7274),qe(2068),qe(8349),qe(3087),Me=qe(6316),rn.exports=class{constructor(we){var ye,Ie,ae;for(ye in we||(we={}),this.options=we,Ie=we.writer||{})!st.call(Ie,ye)||(ae=Ie[ye],this["_"+ye]=this[ye],this[ye]=ae)}filterOptions(we){var ye,Ie,ae,dt,re,me,lt,mt,je;return we||(we={}),we=Sn({},this.options,we),(ye={writer:this}).pretty=we.pretty||!1,ye.allowEmpty=we.allowEmpty||!1,ye.indent=null!=(Ie=we.indent)?Ie:"  ",ye.newline=null!=(ae=we.newline)?ae:"\n",ye.offset=null!=(dt=we.offset)?dt:0,ye.width=null!=(re=we.width)?re:0,ye.dontPrettyTextNodes=null!=(me=null!=(lt=we.dontPrettyTextNodes)?lt:we.dontprettytextnodes)?me:0,ye.spaceBeforeSlash=null!=(mt=null!=(je=we.spaceBeforeSlash)?je:we.spacebeforeslash)?mt:"",!0===ye.spaceBeforeSlash&&(ye.spaceBeforeSlash=" "),ye.suppressPrettyCount=0,ye.user={},ye.state=Me.None,ye}indent(we,ye,Ie){var ae;return!ye.pretty||ye.suppressPrettyCount?"":ye.pretty&&(ae=(Ie||0)+ye.offset+1)>0?new Array(ae).join(ye.indent):""}endline(we,ye,Ie){return!ye.pretty||ye.suppressPrettyCount?"":ye.newline}attribute(we,ye,Ie){var ae;return this.openAttribute(we,ye,Ie),ae=ye.pretty&&ye.width>0?we.name+'="'+we.value+'"':" "+we.name+'="'+we.value+'"',this.closeAttribute(we,ye,Ie),ae}cdata(we,ye,Ie){var ae;return this.openNode(we,ye,Ie),ye.state=Me.OpenTag,ae=this.indent(we,ye,Ie)+"<![CDATA[",ye.state=Me.InsideTag,ae+=we.value,ye.state=Me.CloseTag,ae+="]]>"+this.endline(we,ye,Ie),ye.state=Me.None,this.closeNode(we,ye,Ie),ae}comment(we,ye,Ie){var ae;return this.openNode(we,ye,Ie),ye.state=Me.OpenTag,ae=this.indent(we,ye,Ie)+"\x3c!-- ",ye.state=Me.InsideTag,ae+=we.value,ye.state=Me.CloseTag,ae+=" --\x3e"+this.endline(we,ye,Ie),ye.state=Me.None,this.closeNode(we,ye,Ie),ae}declaration(we,ye,Ie){var ae;return this.openNode(we,ye,Ie),ye.state=Me.OpenTag,ae=this.indent(we,ye,Ie)+"<?xml",ye.state=Me.InsideTag,ae+=' version="'+we.version+'"',null!=we.encoding&&(ae+=' encoding="'+we.encoding+'"'),null!=we.standalone&&(ae+=' standalone="'+we.standalone+'"'),ye.state=Me.CloseTag,ae+=ye.spaceBeforeSlash+"?>",ae+=this.endline(we,ye,Ie),ye.state=Me.None,this.closeNode(we,ye,Ie),ae}docType(we,ye,Ie){var dt,re,me,lt;if(Ie||(Ie=0),this.openNode(we,ye,Ie),ye.state=Me.OpenTag,me=this.indent(we,ye,Ie),me+="<!DOCTYPE "+we.root().name,we.pubID&&we.sysID?me+=' PUBLIC "'+we.pubID+'" "'+we.sysID+'"':we.sysID&&(me+=' SYSTEM "'+we.sysID+'"'),we.children.length>0){for(me+=" [",me+=this.endline(we,ye,Ie),ye.state=Me.InsideTag,dt=0,re=(lt=we.children).length;dt<re;dt++)me+=this.writeChildNode(lt[dt],ye,Ie+1);ye.state=Me.CloseTag,me+="]"}return ye.state=Me.CloseTag,me+=ye.spaceBeforeSlash+">",me+=this.endline(we,ye,Ie),ye.state=Me.None,this.closeNode(we,ye,Ie),me}element(we,ye,Ie){var re,me,lt,mt,je,yt,Tt,ri,kt,cn,Hi,Li,yi,Zt,xo,go,Di;if(Ie||(Ie=0),cn=!1,this.openNode(we,ye,Ie),ye.state=Me.OpenTag,Hi=this.indent(we,ye,Ie)+"<"+we.name,ye.pretty&&ye.width>0)for(kt in yt=Hi.length,yi=we.attribs)!st.call(yi,kt)||(yt+(Li=this.attribute(yi[kt],ye,Ie)).length>ye.width?(Di=this.indent(we,ye,Ie+1)+Li,Hi+=this.endline(we,ye,Ie)+Di,yt=Di.length):(Hi+=Di=" "+Li,yt+=Di.length));else for(kt in Zt=we.attribs)!st.call(Zt,kt)||(Hi+=this.attribute(Zt[kt],ye,Ie));if(lt=0===(me=we.children.length)?null:we.children[0],0===me||we.children.every(function(Ci){return(Ci.type===be.Text||Ci.type===be.Raw||Ci.type===be.CData)&&""===Ci.value}))ye.allowEmpty?(Hi+=">",ye.state=Me.CloseTag,Hi+="</"+we.name+">"+this.endline(we,ye,Ie)):(ye.state=Me.CloseTag,Hi+=ye.spaceBeforeSlash+"/>"+this.endline(we,ye,Ie));else if(!ye.pretty||1!==me||lt.type!==be.Text&&lt.type!==be.Raw&&lt.type!==be.CData||null==lt.value){if(ye.dontPrettyTextNodes)for(mt=0,Tt=(xo=we.children).length;mt<Tt;mt++)if(((re=xo[mt]).type===be.Text||re.type===be.Raw||re.type===be.CData)&&null!=re.value){ye.suppressPrettyCount++,cn=!0;break}for(Hi+=">"+this.endline(we,ye,Ie),ye.state=Me.InsideTag,je=0,ri=(go=we.children).length;je<ri;je++)Hi+=this.writeChildNode(re=go[je],ye,Ie+1);ye.state=Me.CloseTag,Hi+=this.indent(we,ye,Ie)+"</"+we.name+">",cn&&ye.suppressPrettyCount--,Hi+=this.endline(we,ye,Ie),ye.state=Me.None}else Hi+=">",ye.state=Me.InsideTag,ye.suppressPrettyCount++,cn=!0,Hi+=this.writeChildNode(lt,ye,Ie+1),ye.suppressPrettyCount--,cn=!1,ye.state=Me.CloseTag,Hi+="</"+we.name+">"+this.endline(we,ye,Ie);return this.closeNode(we,ye,Ie),Hi}writeChildNode(we,ye,Ie){switch(we.type){case be.CData:return this.cdata(we,ye,Ie);case be.Comment:return this.comment(we,ye,Ie);case be.Element:return this.element(we,ye,Ie);case be.Raw:return this.raw(we,ye,Ie);case be.Text:return this.text(we,ye,Ie);case be.ProcessingInstruction:return this.processingInstruction(we,ye,Ie);case be.Dummy:return"";case be.Declaration:return this.declaration(we,ye,Ie);case be.DocType:return this.docType(we,ye,Ie);case be.AttributeDeclaration:return this.dtdAttList(we,ye,Ie);case be.ElementDeclaration:return this.dtdElement(we,ye,Ie);case be.EntityDeclaration:return this.dtdEntity(we,ye,Ie);case be.NotationDeclaration:return this.dtdNotation(we,ye,Ie);default:throw new Error("Unknown XML node type: "+we.constructor.name)}}processingInstruction(we,ye,Ie){var ae;return this.openNode(we,ye,Ie),ye.state=Me.OpenTag,ae=this.indent(we,ye,Ie)+"<?",ye.state=Me.InsideTag,ae+=we.target,we.value&&(ae+=" "+we.value),ye.state=Me.CloseTag,ae+=ye.spaceBeforeSlash+"?>",ae+=this.endline(we,ye,Ie),ye.state=Me.None,this.closeNode(we,ye,Ie),ae}raw(we,ye,Ie){var ae;return this.openNode(we,ye,Ie),ye.state=Me.OpenTag,ae=this.indent(we,ye,Ie),ye.state=Me.InsideTag,ae+=we.value,ye.state=Me.CloseTag,ae+=this.endline(we,ye,Ie),ye.state=Me.None,this.closeNode(we,ye,Ie),ae}text(we,ye,Ie){var ae;return this.openNode(we,ye,Ie),ye.state=Me.OpenTag,ae=this.indent(we,ye,Ie),ye.state=Me.InsideTag,ae+=we.value,ye.state=Me.CloseTag,ae+=this.endline(we,ye,Ie),ye.state=Me.None,this.closeNode(we,ye,Ie),ae}dtdAttList(we,ye,Ie){var ae;return this.openNode(we,ye,Ie),ye.state=Me.OpenTag,ae=this.indent(we,ye,Ie)+"<!ATTLIST",ye.state=Me.InsideTag,ae+=" "+we.elementName+" "+we.attributeName+" "+we.attributeType,"#DEFAULT"!==we.defaultValueType&&(ae+=" "+we.defaultValueType),we.defaultValue&&(ae+=' "'+we.defaultValue+'"'),ye.state=Me.CloseTag,ae+=ye.spaceBeforeSlash+">"+this.endline(we,ye,Ie),ye.state=Me.None,this.closeNode(we,ye,Ie),ae}dtdElement(we,ye,Ie){var ae;return this.openNode(we,ye,Ie),ye.state=Me.OpenTag,ae=this.indent(we,ye,Ie)+"<!ELEMENT",ye.state=Me.InsideTag,ae+=" "+we.name+" "+we.value,ye.state=Me.CloseTag,ae+=ye.spaceBeforeSlash+">"+this.endline(we,ye,Ie),ye.state=Me.None,this.closeNode(we,ye,Ie),ae}dtdEntity(we,ye,Ie){var ae;return this.openNode(we,ye,Ie),ye.state=Me.OpenTag,ae=this.indent(we,ye,Ie)+"<!ENTITY",ye.state=Me.InsideTag,we.pe&&(ae+=" %"),ae+=" "+we.name,we.value?ae+=' "'+we.value+'"':(we.pubID&&we.sysID?ae+=' PUBLIC "'+we.pubID+'" "'+we.sysID+'"':we.sysID&&(ae+=' SYSTEM "'+we.sysID+'"'),we.nData&&(ae+=" NDATA "+we.nData)),ye.state=Me.CloseTag,ae+=ye.spaceBeforeSlash+">"+this.endline(we,ye,Ie),ye.state=Me.None,this.closeNode(we,ye,Ie),ae}dtdNotation(we,ye,Ie){var ae;return this.openNode(we,ye,Ie),ye.state=Me.OpenTag,ae=this.indent(we,ye,Ie)+"<!NOTATION",ye.state=Me.InsideTag,ae+=" "+we.name,we.pubID&&we.sysID?ae+=' PUBLIC "'+we.pubID+'" "'+we.sysID+'"':we.pubID?ae+=' PUBLIC "'+we.pubID+'"':we.sysID&&(ae+=' SYSTEM "'+we.sysID+'"'),ye.state=Me.CloseTag,ae+=ye.spaceBeforeSlash+">"+this.endline(we,ye,Ie),ye.state=Me.None,this.closeNode(we,ye,Ie),ae}openNode(we,ye,Ie){}closeNode(we,ye,Ie){}openAttribute(we,ye,Ie){}closeAttribute(we,ye,Ie){}}}).call(this)},7904:function(rn,hn,qe){(function(){var be,Me,Te,p,te,Ye,ne,Ve,Xe;({assign:Ve,isFunction:Xe}=qe(3452)),Te=qe(9906),p=qe(519),te=qe(1105),ne=qe(4354),Ye=qe(7647),be=qe(2269),Me=qe(6316),rn.exports.create=function(gt,wt,Ue,Ge){var xt,Kt;if(null==gt)throw new Error("Root element needs a name.");return Ge=Ve({},wt,Ue,Ge),Kt=(xt=new p(Ge)).element(gt),Ge.headless||(xt.declaration(Ge),(null!=Ge.pubID||null!=Ge.sysID)&&xt.dtd(Ge)),Kt},rn.exports.begin=function(gt,wt,Ue){return Xe(gt)&&([wt,Ue]=[gt,wt],gt={}),wt?new te(gt,wt,Ue):new p(gt)},rn.exports.stringWriter=function(gt){return new ne(gt)},rn.exports.streamWriter=function(gt,wt){return new Ye(gt,wt)},rn.exports.implementation=new Te,rn.exports.nodeType=be,rn.exports.writerState=Me}).call(this)}},rn=>{rn(rn.s=2241)}]);