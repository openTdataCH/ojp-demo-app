(self.webpackChunkojp_demo_app=self.webpackChunkojp_demo_app||[]).push([[179],{583:(rn,Ei,rt)=>{"use strict";function Fe(n){return"function"==typeof n}function Ue(n){const e=n(i=>{Error.call(i),i.stack=(new Error).stack});return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}const ze=Ue(n=>function(e){n(this),this.message=e?`${e.length} errors occurred during unsubscription:\n${e.map((i,r)=>`${r+1}) ${i.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=e});function p(n,t){if(n){const e=n.indexOf(t);0<=e&&n.splice(e,1)}}class me{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;const{_parentage:e}=this;if(e)if(this._parentage=null,Array.isArray(e))for(const s of e)s.remove(this);else e.remove(this);const{initialTeardown:i}=this;if(Fe(i))try{i()}catch(s){t=s instanceof ze?s.errors:[s]}const{_finalizers:r}=this;if(r){this._finalizers=null;for(const s of r)try{Ge(s)}catch(d){t=null!=t?t:[],d instanceof ze?t=[...t,...d.errors]:t.push(d)}}if(t)throw new ze(t)}}add(t){var e;if(t&&t!==this)if(this.closed)Ge(t);else{if(t instanceof me){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(e=this._finalizers)&&void 0!==e?e:[]).push(t)}}_hasParent(t){const{_parentage:e}=this;return e===t||Array.isArray(e)&&e.includes(t)}_addParent(t){const{_parentage:e}=this;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t}_removeParent(t){const{_parentage:e}=this;e===t?this._parentage=null:Array.isArray(e)&&p(e,t)}remove(t){const{_finalizers:e}=this;e&&p(e,t),t instanceof me&&t._removeParent(this)}}me.EMPTY=(()=>{const n=new me;return n.closed=!0,n})();const Et=me.EMPTY;function $e(n){return n instanceof me||n&&"closed"in n&&Fe(n.remove)&&Fe(n.add)&&Fe(n.unsubscribe)}function Ge(n){Fe(n)?n():n.unsubscribe()}const Ye={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Ft={setTimeout(n,t,...e){const{delegate:i}=Ft;return null!=i&&i.setTimeout?i.setTimeout(n,t,...e):setTimeout(n,t,...e)},clearTimeout(n){const{delegate:t}=Ft;return((null==t?void 0:t.clearTimeout)||clearTimeout)(n)},delegate:void 0};function kt(n){Ft.setTimeout(()=>{const{onUnhandledError:t}=Ye;if(!t)throw n;t(n)})}function Xe(){}const St=Ne("C",void 0,void 0);function Ne(n,t,e){return{kind:n,value:t,error:e}}let jn=null;function mt(n){if(Ye.useDeprecatedSynchronousErrorHandling){const t=!jn;if(t&&(jn={errorThrown:!1,error:null}),n(),t){const{errorThrown:e,error:i}=jn;if(jn=null,e)throw i}}else n()}class Ie extends me{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,$e(t)&&t.add(this)):this.destination=Ke}static create(t,e,i){return new nt(t,e,i)}next(t){this.isStopped?et(function dn(n){return Ne("N",n,void 0)}(t),this):this._next(t)}error(t){this.isStopped?et(function $t(n){return Ne("E",void 0,n)}(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?et(St,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const Se=Function.prototype.bind;function Ae(n,t){return Se.call(n,t)}class ee{constructor(t){this.partialObserver=t}next(t){const{partialObserver:e}=this;if(e.next)try{e.next(t)}catch(i){at(i)}}error(t){const{partialObserver:e}=this;if(e.error)try{e.error(t)}catch(i){at(i)}else at(t)}complete(){const{partialObserver:t}=this;if(t.complete)try{t.complete()}catch(e){at(e)}}}class nt extends Ie{constructor(t,e,i){let r;if(super(),Fe(t)||!t)r={next:null!=t?t:void 0,error:null!=e?e:void 0,complete:null!=i?i:void 0};else{let s;this&&Ye.useDeprecatedNextContext?(s=Object.create(t),s.unsubscribe=()=>this.unsubscribe(),r={next:t.next&&Ae(t.next,s),error:t.error&&Ae(t.error,s),complete:t.complete&&Ae(t.complete,s)}):r=t}this.destination=new ee(r)}}function at(n){Ye.useDeprecatedSynchronousErrorHandling?function gi(n){Ye.useDeprecatedSynchronousErrorHandling&&jn&&(jn.errorThrown=!0,jn.error=n)}(n):kt(n)}function et(n,t){const{onStoppedNotification:e}=Ye;e&&Ft.setTimeout(()=>e(n,t))}const Ke={closed:!0,next:Xe,error:function pe(n){throw n},complete:Xe},sn="function"==typeof Symbol&&Symbol.observable||"@@observable";function wn(n){return n}let en=(()=>{class n{constructor(e){e&&(this._subscribe=e)}lift(e){const i=new n;return i.source=this,i.operator=e,i}subscribe(e,i,r){const s=function qr(n){return n&&n instanceof Ie||function nr(n){return n&&Fe(n.next)&&Fe(n.error)&&Fe(n.complete)}(n)&&$e(n)}(e)?e:new nt(e,i,r);return mt(()=>{const{operator:d,source:m}=this;s.add(d?d.call(s,m):m?this._subscribe(s):this._trySubscribe(s))}),s}_trySubscribe(e){try{return this._subscribe(e)}catch(i){e.error(i)}}forEach(e,i){return new(i=ti(i))((r,s)=>{const d=new nt({next:m=>{try{e(m)}catch(v){s(v),d.unsubscribe()}},error:s,complete:r});this.subscribe(d)})}_subscribe(e){var i;return null===(i=this.source)||void 0===i?void 0:i.subscribe(e)}[sn](){return this}pipe(...e){return function Fi(n){return 0===n.length?wn:1===n.length?n[0]:function(e){return n.reduce((i,r)=>r(i),e)}}(e)(this)}toPromise(e){return new(e=ti(e))((i,r)=>{let s;this.subscribe(d=>s=d,d=>r(d),()=>i(s))})}}return n.create=t=>new n(t),n})();function ti(n){var t;return null!==(t=null!=n?n:Ye.Promise)&&void 0!==t?t:Promise}const ni=Ue(n=>function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let Qt=(()=>{class n extends en{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(e){const i=new Rs(this,this);return i.operator=e,i}_throwIfClosed(){if(this.closed)throw new ni}next(e){mt(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const i of this.currentObservers)i.next(e)}})}error(e){mt(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=e;const{observers:i}=this;for(;i.length;)i.shift().error(e)}})}complete(){mt(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:e}=this;for(;e.length;)e.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0}_trySubscribe(e){return this._throwIfClosed(),super._trySubscribe(e)}_subscribe(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)}_innerSubscribe(e){const{hasError:i,isStopped:r,observers:s}=this;return i||r?Et:(this.currentObservers=null,s.push(e),new me(()=>{this.currentObservers=null,p(s,e)}))}_checkFinalizedStatuses(e){const{hasError:i,thrownError:r,isStopped:s}=this;i?e.error(r):s&&e.complete()}asObservable(){const e=new en;return e.source=this,e}}return n.create=(t,e)=>new Rs(t,e),n})();class Rs extends Qt{constructor(t,e){super(),this.destination=t,this.source=e}next(t){var e,i;null===(i=null===(e=this.destination)||void 0===e?void 0:e.next)||void 0===i||i.call(e,t)}error(t){var e,i;null===(i=null===(e=this.destination)||void 0===e?void 0:e.error)||void 0===i||i.call(e,t)}complete(){var t,e;null===(e=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===e||e.call(t)}_subscribe(t){var e,i;return null!==(i=null===(e=this.source)||void 0===e?void 0:e.subscribe(t))&&void 0!==i?i:Et}}function Eo(n){return Fe(null==n?void 0:n.lift)}function di(n){return t=>{if(Eo(t))return t.lift(function(e){try{return n(e,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function Tt(n,t,e,i,r){return new Jt(n,t,e,i,r)}class Jt extends Ie{constructor(t,e,i,r,s,d){super(t),this.onFinalize=s,this.shouldUnsubscribe=d,this._next=e?function(m){try{e(m)}catch(v){t.error(v)}}:super._next,this._error=r?function(m){try{r(m)}catch(v){t.error(v)}finally{this.unsubscribe()}}:super._error,this._complete=i?function(){try{i()}catch(m){t.error(m)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:e}=this;super.unsubscribe(),!e&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}}}function Hn(n,t){return di((e,i)=>{let r=0;e.subscribe(Tt(i,s=>{i.next(n.call(t,s,r++))}))})}function an(n){return this instanceof an?(this.v=n,this):new an(n)}function Wo(n,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=e.apply(n,t||[]),s=[];return r={},d("next"),d("throw"),d("return"),r[Symbol.asyncIterator]=function(){return this},r;function d(j){i[j]&&(r[j]=function(W){return new Promise(function(ie,we){s.push([j,W,ie,we])>1||m(j,W)})})}function m(j,W){try{!function v(j){j.value instanceof an?Promise.resolve(j.value.v).then(D,A):L(s[0][2],j)}(i[j](W))}catch(ie){L(s[0][3],ie)}}function D(j){m("next",j)}function A(j){m("throw",j)}function L(j,W){j(W),s.shift(),s.length&&m(s[0][0],s[0][1])}}function la(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,t=n[Symbol.asyncIterator];return t?t.call(n):(n=function yo(n){var t="function"==typeof Symbol&&Symbol.iterator,e=t&&n[t],i=0;if(e)return e.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(n),e={},i("next"),i("throw"),i("return"),e[Symbol.asyncIterator]=function(){return this},e);function i(s){e[s]=n[s]&&function(d){return new Promise(function(m,v){!function r(s,d,m,v){Promise.resolve(v).then(function(D){s({value:D,done:m})},d)}(m,v,(d=n[s](d)).done,d.value)})}}}const Oe=n=>n&&"number"==typeof n.length&&"function"!=typeof n;function Ve(n){return Fe(null==n?void 0:n.then)}function le(n){return Fe(n[sn])}function mn(n){return Symbol.asyncIterator&&Fe(null==n?void 0:n[Symbol.asyncIterator])}function _i(n){return new TypeError(`You provided ${null!==n&&"object"==typeof n?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const un=function Ii(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function Wn(n){return Fe(null==n?void 0:n[un])}function Zr(n){return Wo(this,arguments,function*(){const e=n.getReader();try{for(;;){const{value:i,done:r}=yield an(e.read());if(r)return yield an(void 0);yield yield an(i)}}finally{e.releaseLock()}})}function Xo(n){return Fe(null==n?void 0:n.getReader)}function li(n){if(n instanceof en)return n;if(null!=n){if(le(n))return function re(n){return new en(t=>{const e=n[sn]();if(Fe(e.subscribe))return e.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(n);if(Oe(n))return function U(n){return new en(t=>{for(let e=0;e<n.length&&!t.closed;e++)t.next(n[e]);t.complete()})}(n);if(Ve(n))return function q(n){return new en(t=>{n.then(e=>{t.closed||(t.next(e),t.complete())},e=>t.error(e)).then(null,kt)})}(n);if(mn(n))return fe(n);if(Wn(n))return function oe(n){return new en(t=>{for(const e of n)if(t.next(e),t.closed)return;t.complete()})}(n);if(Xo(n))return function Te(n){return fe(Zr(n))}(n)}throw _i(n)}function fe(n){return new en(t=>{(function je(n,t){var e,i,r,s;return function _o(n,t,e,i){return new(e||(e=Promise))(function(s,d){function m(A){try{D(i.next(A))}catch(L){d(L)}}function v(A){try{D(i.throw(A))}catch(L){d(L)}}function D(A){A.done?s(A.value):function r(s){return s instanceof e?s:new e(function(d){d(s)})}(A.value).then(m,v)}D((i=i.apply(n,t||[])).next())})}(this,void 0,void 0,function*(){try{for(e=la(n);!(i=yield e.next()).done;)if(t.next(i.value),t.closed)return}catch(d){r={error:d}}finally{try{i&&!i.done&&(s=e.return)&&(yield s.call(e))}finally{if(r)throw r.error}}t.complete()})})(n,t).catch(e=>t.error(e))})}function de(n,t,e,i=0,r=!1){const s=t.schedule(function(){e(),r?n.add(this.schedule(null,i)):this.unsubscribe()},i);if(n.add(s),!r)return s}function ke(n,t,e=1/0){return Fe(t)?ke((i,r)=>Hn((s,d)=>t(i,s,r,d))(li(n(i,r))),e):("number"==typeof t&&(e=t),di((i,r)=>function be(n,t,e,i,r,s,d,m){const v=[];let D=0,A=0,L=!1;const j=()=>{L&&!v.length&&!D&&t.complete()},W=we=>D<i?ie(we):v.push(we),ie=we=>{s&&t.next(we),D++;let Re=!1;li(e(we,A++)).subscribe(Tt(t,We=>{null==r||r(We),s?W(We):t.next(We)},()=>{Re=!0},void 0,()=>{if(Re)try{for(D--;v.length&&D<i;){const We=v.shift();d?de(t,d,()=>ie(We)):ie(We)}j()}catch(We){t.error(We)}}))};return n.subscribe(Tt(t,W,()=>{L=!0,j()})),()=>{null==m||m()}}(i,r,n,e)))}function ht(n=1/0){return ke(wn,n)}const Vt=new en(n=>n.complete());function An(n){return n&&Fe(n.schedule)}function Dn(n){return n[n.length-1]}function Xn(n){return Fe(Dn(n))?n.pop():void 0}function pi(n){return An(Dn(n))?n.pop():void 0}function $n(n,t=0){return di((e,i)=>{e.subscribe(Tt(i,r=>de(i,n,()=>i.next(r),t),()=>de(i,n,()=>i.complete(),t),r=>de(i,n,()=>i.error(r),t)))})}function lr(n,t=0){return di((e,i)=>{i.add(n.schedule(()=>e.subscribe(i),t))})}function Ka(n,t){if(!n)throw new Error("Iterable cannot be null");return new en(e=>{de(e,t,()=>{const i=n[Symbol.asyncIterator]();de(e,t,()=>{i.next().then(r=>{r.done?e.complete():e.next(r.value)})},0,!0)})})}function vo(n,t){return t?function Hl(n,t){if(null!=n){if(le(n))return function _r(n,t){return li(n).pipe(lr(t),$n(t))}(n,t);if(Oe(n))return function xl(n,t){return new en(e=>{let i=0;return t.schedule(function(){i===n.length?e.complete():(e.next(n[i++]),e.closed||this.schedule())})})}(n,t);if(Ve(n))return function Ul(n,t){return li(n).pipe(lr(t),$n(t))}(n,t);if(mn(n))return Ka(n,t);if(Wn(n))return function ct(n,t){return new en(e=>{let i;return de(e,t,()=>{i=n[un](),de(e,t,()=>{let r,s;try{({value:r,done:s}=i.next())}catch(d){return void e.error(d)}s?e.complete():e.next(r)},0,!0)}),()=>Fe(null==i?void 0:i.return)&&i.return()})}(n,t);if(Xo(n))return function co(n,t){return Ka(Zr(n),t)}(n,t)}throw _i(n)}(n,t):li(n)}function rr(...n){const t=pi(n),e=function qi(n,t){return"number"==typeof Dn(n)?n.pop():t}(n,1/0),i=n;return i.length?1===i.length?li(i[0]):ht(e)(vo(i,t)):Vt}function yc(n={}){const{connector:t=(()=>new Qt),resetOnError:e=!0,resetOnComplete:i=!0,resetOnRefCountZero:r=!0}=n;return s=>{let d,m,v,D=0,A=!1,L=!1;const j=()=>{null==m||m.unsubscribe(),m=void 0},W=()=>{j(),d=v=void 0,A=L=!1},ie=()=>{const we=d;W(),null==we||we.unsubscribe()};return di((we,Re)=>{D++,!L&&!A&&j();const We=v=null!=v?v:t();Re.add(()=>{D--,0===D&&!L&&!A&&(m=sh(ie,r))}),We.subscribe(Re),!d&&D>0&&(d=new nt({next:xt=>We.next(xt),error:xt=>{L=!0,j(),m=sh(W,e,xt),We.error(xt)},complete:()=>{A=!0,j(),m=sh(W,i),We.complete()}}),li(we).subscribe(d))})(s)}}function sh(n,t,...e){if(!0===t)return void n();if(!1===t)return;const i=new nt({next:()=>{i.unsubscribe(),n()}});return t(...e).subscribe(i)}function cr(n){for(let t in n)if(n[t]===cr)return t;throw Error("Could not find renamed property on target object.")}function qt(n,t){for(const e in t)t.hasOwnProperty(e)&&!n.hasOwnProperty(e)&&(n[e]=t[e])}function xn(n){if("string"==typeof n)return n;if(Array.isArray(n))return"["+n.map(xn).join(", ")+"]";if(null==n)return""+n;if(n.overriddenName)return`${n.overriddenName}`;if(n.name)return`${n.name}`;const t=n.toString();if(null==t)return""+t;const e=t.indexOf("\n");return-1===e?t:t.substring(0,e)}function Ti(n,t){return null==n||""===n?null===t?"":t:null==t||""===t?n:n+" "+t}const Ja=cr({__forward_ref__:cr});function Ri(n){return n.__forward_ref__=Ri,n.toString=function(){return xn(this())},n}function Zt(n){return vc(n)?n():n}function vc(n){return"function"==typeof n&&n.hasOwnProperty(Ja)&&n.__forward_ref__===Ri}class Dt extends Error{constructor(t,e){super(function Jo(n,t){return`NG0${Math.abs(n)}${t?": "+t.trim():""}`}(t,e)),this.code=t}}function Cn(n){return"string"==typeof n?n:null==n?"":String(n)}function ou(n,t){throw new Dt(-201,!1)}function ur(n,t){null==n&&function Ki(n,t,e,i){throw new Error(`ASSERTION ERROR: ${n}`+(null==i?"":` [Expected=> ${e} ${i} ${t} <=Actual]`))}(t,n,null,"!=")}function Ut(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function ln(n){return{providers:n.providers||[],imports:n.imports||[]}}function el(n){return Zu(n,ch)||Zu(n,$l)}function Zu(n,t){return n.hasOwnProperty(t)?n[t]:null}function xc(n){return n&&(n.hasOwnProperty(uh)||n.hasOwnProperty(Ma))?n[uh]:null}const ch=cr({\u0275prov:cr}),uh=cr({\u0275inj:cr}),$l=cr({ngInjectableDef:cr}),Ma=cr({ngInjectorDef:cr});var Yn=(()=>((Yn=Yn||{})[Yn.Default=0]="Default",Yn[Yn.Host=1]="Host",Yn[Yn.Self=2]="Self",Yn[Yn.SkipSelf=4]="SkipSelf",Yn[Yn.Optional=8]="Optional",Yn))();let tl;function $s(n){const t=tl;return tl=n,t}function Aa(n,t,e){const i=el(n);return i&&"root"==i.providedIn?void 0===i.value?i.value=i.factory():i.value:e&Yn.Optional?null:void 0!==t?t:void ou(xn(n))}function ka(n){return{toString:n}.toString()}var ua=(()=>((ua=ua||{})[ua.OnPush=0]="OnPush",ua[ua.Default=1]="Default",ua))(),Gs=(()=>{return(n=Gs||(Gs={}))[n.Emulated=0]="Emulated",n[n.None=2]="None",n[n.ShadowDom=3]="ShadowDom",Gs;var n})();const Sr=(()=>"undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof global&&global||"undefined"!=typeof window&&window||"undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self)(),Gl={},Ji=[],lu=cr({\u0275cmp:cr}),da=cr({\u0275dir:cr}),Bi=cr({\u0275pipe:cr}),cu=cr({\u0275mod:cr}),ha=cr({\u0275fac:cr}),ql=cr({__NG_ELEMENT_ID__:cr});let dh=0;function kn(n){return ka(()=>{const e=!0===n.standalone,i={},r={type:n.type,providersResolver:null,decls:n.decls,vars:n.vars,factory:null,template:n.template||null,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:i,inputs:null,outputs:null,exportAs:n.exportAs||null,onPush:n.changeDetection===ua.OnPush,directiveDefs:null,pipeDefs:null,standalone:e,dependencies:e&&n.dependencies||null,getStandaloneInjector:null,selectors:n.selectors||Ji,viewQuery:n.viewQuery||null,features:n.features||null,data:n.data||{},encapsulation:n.encapsulation||Gs.Emulated,id:"c"+dh++,styles:n.styles||Ji,_:null,setInput:null,schemas:n.schemas||null,tView:null},s=n.dependencies,d=n.features;return r.inputs=zi(n.inputs,i),r.outputs=zi(n.outputs),d&&d.forEach(m=>m(r)),r.directiveDefs=s?()=>("function"==typeof s?s():s).map(ph).filter(Yu):null,r.pipeDefs=s?()=>("function"==typeof s?s():s).map(Lo).filter(Yu):null,r})}function ph(n){return Fr(n)||is(n)}function Yu(n){return null!==n}const Qu={};function gn(n){return ka(()=>{const t={type:n.type,bootstrap:n.bootstrap||Ji,declarations:n.declarations||Ji,imports:n.imports||Ji,exports:n.exports||Ji,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null};return null!=n.id&&(Qu[n.id]=n.type),t})}function zi(n,t){if(null==n)return Gl;const e={};for(const i in n)if(n.hasOwnProperty(i)){let r=n[i],s=r;Array.isArray(r)&&(s=r[1],r=r[0]),e[r]=i,t&&(t[r]=s)}return e}const vt=kn;function ns(n){return{type:n.type,name:n.name,factory:null,pure:!1!==n.pure,standalone:!0===n.standalone,onDestroy:n.type.prototype.ngOnDestroy||null}}function Fr(n){return n[lu]||null}function is(n){return n[da]||null}function Lo(n){return n[Bi]||null}function Os(n,t){const e=n[cu]||null;if(!e&&!0===t)throw new Error(`Type ${xn(n)} does not have '\u0275mod' property.`);return e}function os(n){return Array.isArray(n)&&"object"==typeof n[1]}function ss(n){return Array.isArray(n)&&!0===n[1]}function Hp(n){return 0!=(8&n.flags)}function gh(n){return 2==(2&n.flags)}function ed(n){return 1==(1&n.flags)}function pa(n){return null!==n.template}function wm(n){return 0!=(256&n[2])}function Tl(n,t){return n.hasOwnProperty(ha)?n[ha]:null}class id{constructor(t,e,i){this.previousValue=t,this.currentValue=e,this.firstChange=i}isFirstChange(){return this.firstChange}}function dr(){return Kl}function Kl(n){return n.type.prototype.ngOnChanges&&(n.setInput=_h),bh}function bh(){const n=il(this),t=null==n?void 0:n.current;if(t){const e=n.previous;if(e===Gl)n.previous=t;else for(let i in t)e[i]=t[i];n.current=null,this.ngOnChanges(t)}}function _h(n,t,e,i){const r=il(n)||function rd(n,t){return n[fu]=t}(n,{previous:Gl,current:null}),s=r.current||(r.current={}),d=r.previous,m=this.declaredInputs[e],v=d[m];s[m]=new id(v&&v.currentValue,t,d===Gl),n[i]=t}dr.ngInherit=!0;const fu="__ngSimpleChanges__";function il(n){return n[fu]||null}function to(n){for(;Array.isArray(n);)n=n[0];return n}function Jl(n,t){return to(t[n])}function wo(n,t){return to(t[n.index])}function mu(n,t){return n.data[t]}function Ec(n,t){return n[t]}function as(n,t){const e=t[n];return os(e)?e:e[0]}function xh(n){return 4==(4&n[2])}function wh(n){return 64==(64&n[2])}function Oa(n,t){return null==t?null:n[t]}function gu(n){n[18]=0}function Ch(n,t){n[5]+=t;let e=n,i=n[3];for(;null!==i&&(1===t&&1===e[5]||-1===t&&0===e[5]);)i[5]+=t,e=i,i=i[3]}const Ci={lFrame:Ih(null),bindingsEnabled:!0};function sd(){return Ci.bindingsEnabled}function Ot(){return Ci.lFrame.lView}function ji(){return Ci.lFrame.tView}function Wi(n){return Ci.lFrame.contextLView=n,n[8]}function no(n){return Ci.lFrame.contextLView=null,n}function So(){let n=Am();for(;null!==n&&64===n.type;)n=n.parent;return n}function Am(){return Ci.lFrame.currentTNode}function Fo(n,t){const e=Ci.lFrame;e.currentTNode=n,e.isParent=t}function cd(){return Ci.lFrame.isParent}function ec(){Ci.lFrame.isParent=!1}function ls(){const n=Ci.lFrame;let t=n.bindingRootIndex;return-1===t&&(t=n.bindingRootIndex=n.tView.bindingStartIndex),t}function Mc(){return Ci.lFrame.bindingIndex++}function rl(n){const t=Ci.lFrame,e=t.bindingIndex;return t.bindingIndex=t.bindingIndex+n,e}function Kp(n,t){const e=Ci.lFrame;e.bindingIndex=e.bindingRootIndex=n,hd(t)}function hd(n){Ci.lFrame.currentDirectiveIndex=n}function Ac(n){const t=Ci.lFrame.currentDirectiveIndex;return-1===t?null:n[t]}function pd(){return Ci.lFrame.currentQueryIndex}function kc(n){Ci.lFrame.currentQueryIndex=n}function Dh(n){const t=n[1];return 2===t.type?t.declTNode:1===t.type?n[6]:null}function fd(n,t,e){if(e&Yn.SkipSelf){let r=t,s=n;for(;!(r=r.parent,null!==r||e&Yn.Host||(r=Dh(s),null===r||(s=s[15],10&r.type))););if(null===r)return!1;t=r,n=s}const i=Ci.lFrame=Jp();return i.currentTNode=t,i.lView=n,!0}function Eh(n){const t=Jp(),e=n[1];Ci.lFrame=t,t.currentTNode=e.firstChild,t.lView=n,t.tView=e,t.contextLView=n,t.bindingIndex=e.bindingStartIndex,t.inI18n=!1}function Jp(){const n=Ci.lFrame,t=null===n?null:n.child;return null===t?Ih(n):t}function Ih(n){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return null!==n&&(n.child=t),t}function ef(){const n=Ci.lFrame;return Ci.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}const tf=ef;function md(){const n=ef();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function cs(){return Ci.lFrame.selectedIndex}function Il(n){Ci.lFrame.selectedIndex=n}function Qr(){const n=Ci.lFrame;return mu(n.tView,n.selectedIndex)}function Ml(){Ci.lFrame.currentNamespace="svg"}function Al(){!function g(){Ci.lFrame.currentNamespace=null}()}function _(n,t){for(let e=t.directiveStart,i=t.directiveEnd;e<i;e++){const s=n.data[e].type.prototype,{ngAfterContentInit:d,ngAfterContentChecked:m,ngAfterViewInit:v,ngAfterViewChecked:D,ngOnDestroy:A}=s;d&&(n.contentHooks||(n.contentHooks=[])).push(-e,d),m&&((n.contentHooks||(n.contentHooks=[])).push(e,m),(n.contentCheckHooks||(n.contentCheckHooks=[])).push(e,m)),v&&(n.viewHooks||(n.viewHooks=[])).push(-e,v),D&&((n.viewHooks||(n.viewHooks=[])).push(e,D),(n.viewCheckHooks||(n.viewCheckHooks=[])).push(e,D)),null!=A&&(n.destroyHooks||(n.destroyHooks=[])).push(e,A)}}function w(n,t,e){k(n,t,3,e)}function C(n,t,e,i){(3&n[2])===e&&k(n,t,e,i)}function I(n,t){let e=n[2];(3&e)===t&&(e&=2047,e+=1,n[2]=e)}function k(n,t,e,i){const s=null!=i?i:-1,d=t.length-1;let m=0;for(let v=void 0!==i?65535&n[18]:0;v<d;v++)if("number"==typeof t[v+1]){if(m=t[v],null!=i&&m>=i)break}else t[v]<0&&(n[18]+=65536),(m<s||-1==s)&&(R(n,e,t,v),n[18]=(4294901760&n[18])+v+2),v++}function R(n,t,e,i){const r=e[i]<0,s=e[i+1],m=n[r?-e[i]:e[i]];if(r){if(n[2]>>11<n[18]>>16&&(3&n[2])===t){n[2]+=2048;try{s.call(m)}finally{}}}else try{s.call(m)}finally{}}const F=-1;class N{constructor(t,e,i){this.factory=t,this.resolving=!1,this.canSeeViewProviders=e,this.injectImpl=i}}function J(n,t,e){let i=0;for(;i<e.length;){const r=e[i];if("number"==typeof r){if(0!==r)break;i++;const s=e[i++],d=e[i++],m=e[i++];n.setAttribute(t,d,m,s)}else{const s=r,d=e[++i];ve(s)?n.setProperty(t,s,d):n.setAttribute(t,s,d),i++}}return i}function _e(n){return 3===n||4===n||6===n}function ve(n){return 64===n.charCodeAt(0)}function he(n,t){if(null!==t&&0!==t.length)if(null===n||0===n.length)n=t.slice();else{let e=-1;for(let i=0;i<t.length;i++){const r=t[i];"number"==typeof r?e=r:0===e||Ce(n,e,r,null,-1===e||2===e?t[++i]:null)}}return n}function Ce(n,t,e,i,r){let s=0,d=n.length;if(-1===t)d=-1;else for(;s<n.length;){const m=n[s++];if("number"==typeof m){if(m===t){d=-1;break}if(m>t){d=s-1;break}}}for(;s<n.length;){const m=n[s];if("number"==typeof m)break;if(m===e){if(null===i)return void(null!==r&&(n[s+1]=r));if(i===n[s+1])return void(n[s+2]=r)}s++,null!==i&&s++,null!==r&&s++}-1!==d&&(n.splice(d,0,t),s=d+1),n.splice(s++,0,e),null!==i&&n.splice(s++,0,i),null!==r&&n.splice(s++,0,r)}function He(n){return n!==F}function it(n){return 32767&n}function wt(n,t){let e=function Qe(n){return n>>16}(n),i=t;for(;e>0;)i=i[15],e--;return i}let Le=!0;function ft(n){const t=Le;return Le=n,t}let Gt=0;const It={};function Lt(n,t){const e=Gn(n,t);if(-1!==e)return e;const i=t[1];i.firstCreatePass&&(n.injectorIndex=t.length,bn(i.data,n),bn(t,null),bn(i.blueprint,null));const r=Rn(n,t),s=n.injectorIndex;if(He(r)){const d=it(r),m=wt(r,t),v=m[1].data;for(let D=0;D<8;D++)t[s+D]=m[d+D]|v[d+D]}return t[s+8]=r,s}function bn(n,t){n.push(0,0,0,0,0,0,0,0,t)}function Gn(n,t){return-1===n.injectorIndex||n.parent&&n.parent.injectorIndex===n.injectorIndex||null===t[n.injectorIndex+8]?-1:n.injectorIndex}function Rn(n,t){if(n.parent&&-1!==n.parent.injectorIndex)return n.parent.injectorIndex;let e=0,i=null,r=t;for(;null!==r;){if(i=tc(r),null===i)return F;if(e++,r=r[15],-1!==i.injectorIndex)return i.injectorIndex|e<<16}return F}function yn(n,t,e){!function jt(n,t,e){let i;"string"==typeof e?i=e.charCodeAt(0)||0:e.hasOwnProperty(ql)&&(i=e[ql]),null==i&&(i=e[ql]=Gt++);const r=255&i;t.data[n+(r>>5)]|=1<<r}(n,t,e)}function Jn(n,t,e){if(e&Yn.Optional)return n;ou()}function bi(n,t,e,i){if(e&Yn.Optional&&void 0===i&&(i=null),0==(e&(Yn.Self|Yn.Host))){const r=n[9],s=$s(void 0);try{return r?r.get(t,i,e&Yn.Optional):Aa(t,i,e&Yn.Optional)}finally{$s(s)}}return Jn(i,0,e)}function hr(n,t,e,i=Yn.Default,r){if(null!==n){if(1024&t[2]){const d=function Ns(n,t,e,i,r){let s=n,d=t;for(;null!==s&&null!==d&&1024&d[2]&&!(256&d[2]);){const m=pr(s,d,e,i|Yn.Self,It);if(m!==It)return m;let v=s.parent;if(!v){const D=d[21];if(D){const A=D.get(e,It,i);if(A!==It)return A}v=tc(d),d=d[15]}s=v}return r}(n,t,e,i,It);if(d!==It)return d}const s=pr(n,t,e,i,It);if(s!==It)return s}return bi(t,e,i,r)}function pr(n,t,e,i,r){const s=function ol(n){if("string"==typeof n)return n.charCodeAt(0)||0;const t=n.hasOwnProperty(ql)?n[ql]:void 0;return"number"==typeof t?t>=0?255&t:po:t}(e);if("function"==typeof s){if(!fd(t,n,i))return i&Yn.Host?Jn(r,0,i):bi(t,e,i,r);try{const d=s(i);if(null!=d||i&Yn.Optional)return d;ou()}finally{tf()}}else if("number"==typeof s){let d=null,m=Gn(n,t),v=F,D=i&Yn.Host?t[16][6]:null;for((-1===m||i&Yn.SkipSelf)&&(v=-1===m?Rn(n,t):t[m+8],v!==F&&zr(i,!1)?(d=t[1],m=it(v),t=wt(v,t)):m=-1);-1!==m;){const A=t[1];if(Mr(s,m,A.data)){const L=or(m,t,e,d,i,D);if(L!==It)return L}v=t[m+8],v!==F&&zr(i,t[1].data[m+8]===D)&&Mr(s,m,t)?(d=A,m=it(v),t=wt(v,t)):m=-1}}return r}function or(n,t,e,i,r,s){const d=t[1],m=d.data[n+8],A=io(m,d,e,null==i?gh(m)&&Le:i!=d&&0!=(3&m.type),r&Yn.Host&&s===m);return null!==A?Mo(t,d,A,m):It}function io(n,t,e,i,r){const s=n.providerIndexes,d=t.data,m=1048575&s,v=n.directiveStart,A=s>>20,j=r?m+A:n.directiveEnd;for(let W=i?m:m+A;W<j;W++){const ie=d[W];if(W<v&&e===ie||W>=v&&ie.type===e)return W}if(r){const W=d[v];if(W&&pa(W)&&W.type===e)return v}return null}function Mo(n,t,e,i){let r=n[e];const s=t.data;if(function H(n){return n instanceof N}(r)){const d=r;d.resolving&&function Ia(n,t){const e=t?`. Dependency path: ${t.join(" > ")} > ${n}`:"";throw new Dt(-200,`Circular dependency in DI detected for ${n}${e}`)}(function yr(n){return"function"==typeof n?n.name||n.toString():"object"==typeof n&&null!=n&&"function"==typeof n.type?n.type.name||n.type.toString():Cn(n)}(s[e]));const m=ft(d.canSeeViewProviders);d.resolving=!0;const v=d.injectImpl?$s(d.injectImpl):null;fd(n,i,Yn.Default);try{r=n[e]=d.factory(void 0,s,n,i),t.firstCreatePass&&e>=i.directiveStart&&function h(n,t,e){const{ngOnChanges:i,ngOnInit:r,ngDoCheck:s}=t.type.prototype;if(i){const d=Kl(t);(e.preOrderHooks||(e.preOrderHooks=[])).push(n,d),(e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(n,d)}r&&(e.preOrderHooks||(e.preOrderHooks=[])).push(0-n,r),s&&((e.preOrderHooks||(e.preOrderHooks=[])).push(n,s),(e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(n,s))}(e,s[e],t)}finally{null!==v&&$s(v),ft(m),d.resolving=!1,tf()}}return r}function Mr(n,t,e){return!!(e[t+(n>>5)]&1<<n)}function zr(n,t){return!(n&Yn.Self||n&Yn.Host&&t)}class Pi{constructor(t,e){this._tNode=t,this._lView=e}get(t,e,i){return hr(this._tNode,this._lView,t,i,e)}}function po(){return new Pi(So(),Ot())}function ui(n){return ka(()=>{const t=n.prototype.constructor,e=t[ha]||vr(t),i=Object.prototype;let r=Object.getPrototypeOf(n.prototype).constructor;for(;r&&r!==i;){const s=r[ha]||vr(r);if(s&&s!==e)return s;r=Object.getPrototypeOf(r)}return s=>new s})}function vr(n){return vc(n)?()=>{const t=vr(Zt(n));return t&&t()}:Tl(n)}function tc(n){const t=n[1],e=t.type;return 2===e?t.declTNode:1===e?n[6]:null}function Vr(n){return function Nt(n,t){if("class"===t)return n.classes;if("style"===t)return n.styles;const e=n.attrs;if(e){const i=e.length;let r=0;for(;r<i;){const s=e[r];if(_e(s))break;if(0===s)r+=2;else if("number"==typeof s)for(r++;r<i&&"string"==typeof e[r];)r++;else{if(s===t)return e[r+1];r+=2}}}return null}(So(),n)}const La="__parameters__";function Qs(n,t,e){return ka(()=>{const i=function fa(n){return function(...e){if(n){const i=n(...e);for(const r in i)this[r]=i[r]}}}(t);function r(...s){if(this instanceof r)return i.apply(this,s),this;const d=new r(...s);return m.annotation=d,m;function m(v,D,A){const L=v.hasOwnProperty(La)?v[La]:Object.defineProperty(v,La,{value:[]})[La];for(;L.length<=A;)L.push(null);return(L[A]=L[A]||[]).push(d),v}}return e&&(r.prototype=Object.create(e.prototype)),r.prototype.ngMetadataName=n,r.annotationCls=r,r})}class bt{constructor(t,e){this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof e?this.__NG_ELEMENT_ID__=e:void 0!==e&&(this.\u0275prov=Ut({token:this,providedIn:e.providedIn||"root",factory:e.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}const pv=new bt("AnalyzeForEntryComponents");function ma(n,t){void 0===t&&(t=n);for(let e=0;e<n.length;e++){let i=n[e];Array.isArray(i)?(t===n&&(t=n.slice(0,e)),ma(i,t)):t!==n&&t.push(i)}return t}function Rc(n,t){n.forEach(e=>Array.isArray(e)?Rc(e,t):t(e))}function gv(n,t,e){t>=n.length?n.push(e):n.splice(t,0,e)}function Pc(n,t){return t>=n.length-1?n.pop():n.splice(t,1)[0]}function Ph(n,t){const e=[];for(let i=0;i<n;i++)e.push(t);return e}function Bs(n,t,e){let i=Oc(n,t);return i>=0?n[1|i]=e:(i=~i,function SS(n,t,e,i){let r=n.length;if(r==t)n.push(e,i);else if(1===r)n.push(i,n[0]),n[0]=e;else{for(r--,n.push(n[r-1],n[r]);r>t;)n[r]=n[r-2],r--;n[t]=e,n[t+1]=i}}(n,i,t,e)),i}function kl(n,t){const e=Oc(n,t);if(e>=0)return n[1|e]}function Oc(n,t){return function Sb(n,t,e){let i=0,r=n.length>>e;for(;r!==i;){const s=i+(r-i>>1),d=n[s<<e];if(t===d)return s<<e;d>t?r=s:i=s+1}return~(r<<e)}(n,t,1)}const al={},Lc="__NG_DI_FLAG__",Lm="ngTempTokenPath",AS=/\n/gm,Tb="__source";let bu;function ba(n){const t=bu;return bu=n,t}function RS(n,t=Yn.Default){if(void 0===bu)throw new Dt(-203,!1);return null===bu?Aa(n,void 0,t):bu.get(n,t&Yn.Optional?null:void 0,t)}function Be(n,t=Yn.Default){return(function Vp(){return tl}()||RS)(Zt(n),t)}function Mn(n,t=Yn.Default){return Be(n,t)}function nc(n){const t=[];for(let e=0;e<n.length;e++){const i=Zt(n[e]);if(Array.isArray(i)){if(0===i.length)throw new Dt(900,!1);let r,s=Yn.Default;for(let d=0;d<i.length;d++){const m=i[d],v=Xi(m);"number"==typeof v?-1===v?r=m.token:s|=v:r=m}t.push(Be(r,s))}else t.push(Be(i))}return t}function _u(n,t){return n[Lc]=t,n.prototype[Lc]=t,n}function Xi(n){return n[Lc]}const Cs=_u(Qs("Optional"),8),Ts=_u(Qs("SkipSelf"),4);let Bm,cf;function Pl(n){var t;return(null===(t=function kb(){if(void 0===cf&&(cf=null,Sr.trustedTypes))try{cf=Sr.trustedTypes.createPolicy("angular",{createHTML:n=>n,createScript:n=>n,createScriptURL:n=>n})}catch(n){}return cf}())||void 0===t?void 0:t.createHTML(n))||n}class xu{constructor(t){this.changingThisBreaksApplicationSecurity=t}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}class ic extends xu{getTypeName(){return"HTML"}}class Ob extends xu{getTypeName(){return"Style"}}class Fh extends xu{getTypeName(){return"Script"}}class df extends xu{getTypeName(){return"URL"}}class _d extends xu{getTypeName(){return"ResourceURL"}}function Js(n){return n instanceof xu?n.changingThisBreaksApplicationSecurity:n}function Na(n,t){const e=function Mv(n){return n instanceof xu&&n.getTypeName()||null}(n);if(null!=e&&e!==t){if("ResourceURL"===e&&"URL"===t)return!0;throw new Error(`Required a safe ${t}, got a ${e} (see https://g.co/ng/security#xss)`)}return e===t}class Nc{constructor(t){this.inertDocumentHelper=t}getInertBodyElement(t){t="<body><remove></remove>"+t;try{const e=(new window.DOMParser).parseFromString(Pl(t),"text/html").body;return null===e?this.inertDocumentHelper.getInertBodyElement(t):(e.removeChild(e.firstChild),e)}catch(e){return null}}}class Fb{constructor(t){if(this.defaultDoc=t,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert"),null==this.inertDocument.body){const e=this.inertDocument.createElement("html");this.inertDocument.appendChild(e);const i=this.inertDocument.createElement("body");e.appendChild(i)}}getInertBodyElement(t){const e=this.inertDocument.createElement("template");if("content"in e)return e.innerHTML=Pl(t),e;const i=this.inertDocument.createElement("body");return i.innerHTML=Pl(t),this.defaultDoc.documentMode&&this.stripCustomNsAttrs(i),i}stripCustomNsAttrs(t){const e=t.attributes;for(let r=e.length-1;0<r;r--){const d=e.item(r).name;("xmlns:ns1"===d||0===d.indexOf("ns1:"))&&t.removeAttribute(d)}let i=t.firstChild;for(;i;)i.nodeType===Node.ELEMENT_NODE&&this.stripCustomNsAttrs(i),i=i.nextSibling}}const pf=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi,Ba=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;function Bc(n){return(n=String(n)).match(pf)||n.match(Ba)?n:"unsafe:"+n}function Ao(n){const t={};for(const e of n.split(","))t[e]=!0;return t}function vd(...n){const t={};for(const e of n)for(const i in e)e.hasOwnProperty(i)&&(t[i]=!0);return t}const mo=Ao("area,br,col,hr,img,wbr"),Nb=Ao("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),Nh=Ao("rp,rt"),Um=vd(mo,vd(Nb,Ao("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),vd(Nh,Ao("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),vd(Nh,Nb)),Hm=Ao("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),zc=Ao("srcset"),Bb=vd(Hm,zc,Ao("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),Ao("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),Pv=Ao("script,style,template");class BS{constructor(){this.sanitizedSomething=!1,this.buf=[]}sanitizeChildren(t){let e=t.firstChild,i=!0;for(;e;)if(e.nodeType===Node.ELEMENT_NODE?i=this.startElement(e):e.nodeType===Node.TEXT_NODE?this.chars(e.nodeValue):this.sanitizedSomething=!0,i&&e.firstChild)e=e.firstChild;else for(;e;){e.nodeType===Node.ELEMENT_NODE&&this.endElement(e);let r=this.checkClobberedElement(e,e.nextSibling);if(r){e=r;break}e=this.checkClobberedElement(e,e.parentNode)}return this.buf.join("")}startElement(t){const e=t.nodeName.toLowerCase();if(!Um.hasOwnProperty(e))return this.sanitizedSomething=!0,!Pv.hasOwnProperty(e);this.buf.push("<"),this.buf.push(e);const i=t.attributes;for(let r=0;r<i.length;r++){const s=i.item(r),d=s.name,m=d.toLowerCase();if(!Bb.hasOwnProperty(m)){this.sanitizedSomething=!0;continue}let v=s.value;Hm[m]&&(v=Bc(v)),zc[m]&&(n=v,v=(n=String(n)).split(",").map(t=>Bc(t.trim())).join(", ")),this.buf.push(" ",d,'="',$m(v),'"')}var n;return this.buf.push(">"),!0}endElement(t){const e=t.nodeName.toLowerCase();Um.hasOwnProperty(e)&&!mo.hasOwnProperty(e)&&(this.buf.push("</"),this.buf.push(e),this.buf.push(">"))}chars(t){this.buf.push($m(t))}checkClobberedElement(t,e){if(e&&(t.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error(`Failed to sanitize html because the element is clobbered: ${t.outerHTML}`);return e}}const zb=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,Vb=/([^\#-~ |!])/g;function $m(n){return n.replace(/&/g,"&amp;").replace(zb,function(t){return"&#"+(1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320)+65536)+";"}).replace(Vb,function(t){return"&#"+t.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}let Zo;function jb(n,t){let e=null;try{Zo=Zo||function yd(n){const t=new Fb(n);return function Rv(){try{return!!(new window.DOMParser).parseFromString(Pl(""),"text/html")}catch(n){return!1}}()?new Nc(t):t}(n);let i=t?String(t):"";e=Zo.getInertBodyElement(i);let r=5,s=i;do{if(0===r)throw new Error("Failed to sanitize html because the input is unstable");r--,i=s,s=e.innerHTML,e=Zo.getInertBodyElement(i)}while(i!==s);return Pl((new BS).sanitizeChildren(Ub(e)||e))}finally{if(e){const i=Ub(e)||e;for(;i.firstChild;)i.removeChild(i.firstChild)}}}function Ub(n){return"content"in n&&function Ov(n){return n.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===n.nodeName}(n)?n.content:null}var Ar=(()=>((Ar=Ar||{})[Ar.NONE=0]="NONE",Ar[Ar.HTML=1]="HTML",Ar[Ar.STYLE=2]="STYLE",Ar[Ar.SCRIPT=3]="SCRIPT",Ar[Ar.URL=4]="URL",Ar[Ar.RESOURCE_URL=5]="RESOURCE_URL",Ar))();function xd(n){const t=function ff(){const n=Ot();return n&&n[12]}();return t?t.sanitize(Ar.URL,n)||"":Na(n,"URL")?Js(n):Bc(Cn(n))}function qm(n){return n.ngOriginalError}class va{constructor(){this._console=console}handleError(t){const e=this._findOriginalError(t);this._console.error("ERROR",t),e&&this._console.error("ORIGINAL ERROR",e)}_findOriginalError(t){let e=t&&qm(t);for(;e&&qm(e);)e=qm(e);return e||null}}const gf=new Map;let WS=0;const Xm="__ngContext__";function Es(n,t){os(t)?(n[Xm]=t[20],function XS(n){gf.set(n[20],n)}(t)):n[Xm]=t}function jc(n){const t=n[Xm];return"number"==typeof t?function ro(n){return gf.get(n)||null}(t):t||null}function bf(n){const t=jc(n);return t?os(t)?t:t.lView:null}const Zm=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(Sr))();function Uc(n){return n instanceof Function?n():n}var xa=(()=>((xa=xa||{})[xa.Important=1]="Important",xa[xa.DashCase=2]="DashCase",xa))();function e_(n,t){return undefined(n,t)}function vf(n){const t=n[3];return ss(t)?t[3]:t}function Uh(n){return jv(n[13])}function Hh(n){return jv(n[4])}function jv(n){for(;null!==n&&!ss(n);)n=n[4];return n}function oc(n,t,e,i,r){if(null!=i){let s,d=!1;ss(i)?s=i:os(i)&&(d=!0,i=i[0]);const m=to(i);0===n&&null!==e?null==r?Gh(t,e,m):cl(t,e,m,r||null,!0):1===n&&null!==e?cl(t,e,m,r||null,!0):2===n?function e0(n,t,e){const i=eg(n,t);i&&function Zv(n,t,e,i){n.removeChild(t,e,i)}(n,i,t,e)}(t,m,d):3===n&&t.destroyNode(m),null!=s&&function s1(n,t,e,i,r){const s=e[7];s!==to(e)&&oc(t,n,i,s,r);for(let m=10;m<e.length;m++){const v=e[m];Cf(v[1],v,n,t,i,s)}}(t,n,s,e,r)}}function Qm(n,t,e){return n.createElement(t,e)}function i_(n,t){const e=n[9],i=e.indexOf(t),r=t[3];512&t[2]&&(t[2]&=-513,Ch(r,-1)),e.splice(i,1)}function r_(n,t){if(n.length<=10)return;const e=10+t,i=n[e];if(i){const r=i[17];null!==r&&r!==n&&i_(r,i),t>0&&(n[e-1][4]=i[4]);const s=Pc(n,10+t);!function n1(n,t){Cf(n,t,t[11],2,null,null),t[0]=null,t[6]=null}(i[1],i);const d=s[19];null!==d&&d.detachView(s[1]),i[3]=null,i[4]=null,i[2]&=-65}return i}function Wv(n,t){if(!(128&t[2])){const e=t[11];e.destroyNode&&Cf(n,t,e,3,null,null),function $v(n){let t=n[13];if(!t)return Km(n[1],n);for(;t;){let e=null;if(os(t))e=t[13];else{const i=t[10];i&&(e=i)}if(!e){for(;t&&!t[4]&&t!==n;)os(t)&&Km(t[1],t),t=t[3];null===t&&(t=n),os(t)&&Km(t[1],t),e=t&&t[4]}t=e}}(t)}}function Km(n,t){if(!(128&t[2])){t[2]&=-65,t[2]|=128,function Xv(n,t){let e;if(null!=n&&null!=(e=n.destroyHooks))for(let i=0;i<e.length;i+=2){const r=t[e[i]];if(!(r instanceof N)){const s=e[i+1];if(Array.isArray(s))for(let d=0;d<s.length;d+=2){const m=r[s[d]],v=s[d+1];try{v.call(m)}finally{}}else try{s.call(r)}finally{}}}}(n,t),function Jm(n,t){const e=n.cleanup,i=t[7];let r=-1;if(null!==e)for(let s=0;s<e.length-1;s+=2)if("string"==typeof e[s]){const d=e[s+1],m="function"==typeof d?d(t):to(t[d]),v=i[r=e[s+2]],D=e[s+3];"boolean"==typeof D?m.removeEventListener(e[s],v,D):D>=0?i[r=D]():i[r=-D].unsubscribe(),s+=2}else{const d=i[r=e[s+1]];e[s].call(d)}if(null!==i){for(let s=r+1;s<i.length;s++)i[s]();t[7]=null}}(n,t),1===t[1].type&&t[11].destroy();const e=t[17];if(null!==e&&ss(t[3])){e!==t[3]&&i_(e,t);const i=t[19];null!==i&&i.detachView(n)}!function Wm(n){gf.delete(n[20])}(t)}}function Is(n,t,e){return function $h(n,t,e){let i=t;for(;null!==i&&40&i.type;)i=(t=i).parent;if(null===i)return e[0];if(2&i.flags){const r=n.data[i.directiveStart].encapsulation;if(r===Gs.None||r===Gs.Emulated)return null}return wo(i,e)}(n,t.parent,e)}function cl(n,t,e,i,r){n.insertBefore(t,e,i,r)}function Gh(n,t,e){n.appendChild(t,e)}function o_(n,t,e,i,r){null!==i?cl(n,t,e,i,r):Gh(n,t,e)}function eg(n,t){return n.parentNode(t)}function Yv(n,t,e){return Kv(n,t,e)}let Kv=function Qv(n,t,e){return 40&n.type?wo(n,e):null};function wf(n,t,e,i){const r=Is(n,i,t),s=t[11],m=Yv(i.parent||t[6],i,t);if(null!=r)if(Array.isArray(e))for(let v=0;v<e.length;v++)o_(s,r,e[v],m,!1);else o_(s,r,e,m,!1)}function Sf(n,t){if(null!==t){const e=t.type;if(3&e)return wo(t,n);if(4&e)return a_(-1,n[t.index]);if(8&e){const i=t.child;if(null!==i)return Sf(n,i);{const r=n[t.index];return ss(r)?a_(-1,r):to(r)}}if(32&e)return e_(t,n)()||to(n[t.index]);{const i=s_(n,t);return null!==i?Array.isArray(i)?i[0]:Sf(vf(n[16]),i):Sf(n,t.next)}}return null}function s_(n,t){return null!==t?n[16][6].projection[t.projection]:null}function a_(n,t){const e=10+n+1;if(e<t.length){const i=t[e],r=i[1].firstChild;if(null!==r)return Sf(i,r)}return t[7]}function l_(n,t,e,i,r,s,d){for(;null!=e;){const m=i[e.index],v=e.type;if(d&&0===t&&(m&&Es(to(m),i),e.flags|=4),64!=(64&e.flags))if(8&v)l_(n,t,e.child,i,r,s,!1),oc(t,n,r,m,s);else if(32&v){const D=e_(e,i);let A;for(;A=D();)oc(t,n,r,A,s);oc(t,n,r,m,s)}else 16&v?c_(n,t,i,e,r,s):oc(t,n,r,m,s);e=d?e.projectionNext:e.next}}function Cf(n,t,e,i,r,s){l_(e,i,n.firstChild,t,r,s,!1)}function c_(n,t,e,i,r,s){const d=e[16],v=d[6].projection[i.projection];if(Array.isArray(v))for(let D=0;D<v.length;D++)oc(t,n,r,v[D],s);else l_(n,t,v,d[3],r,s,!0)}function Ol(n,t,e){n.setAttribute(t,"style",e)}function Tf(n,t,e){""===e?n.removeAttribute(t,"class"):n.setAttribute(t,"class",e)}function Df(n,t,e){let i=n.length;for(;;){const r=n.indexOf(t,e);if(-1===r)return r;if(0===r||n.charCodeAt(r-1)<=32){const s=t.length;if(r+s===i||n.charCodeAt(r+s)<=32)return r}e=r+1}}const t0="ng-template";function a1(n,t,e){let i=0;for(;i<n.length;){let r=n[i++];if(e&&"class"===r){if(r=n[i],-1!==Df(r.toLowerCase(),t,0))return!0}else if(1===r){for(;i<n.length&&"string"==typeof(r=n[i++]);)if(r.toLowerCase()===t)return!0;return!1}}return!1}function Wh(n){return 4===n.type&&n.value!==t0}function l1(n,t,e){return t===(4!==n.type||e?n.value:t0)}function c1(n,t,e){let i=4;const r=n.attrs||[],s=function d_(n){for(let t=0;t<n.length;t++)if(_e(n[t]))return t;return n.length}(r);let d=!1;for(let m=0;m<t.length;m++){const v=t[m];if("number"!=typeof v){if(!d)if(4&i){if(i=2|1&i,""!==v&&!l1(n,v,e)||""===v&&1===t.length){if(ea(i))return!1;d=!0}}else{const D=8&i?v:t[++m];if(8&i&&null!==n.attrs){if(!a1(n.attrs,D,e)){if(ea(i))return!1;d=!0}continue}const L=n0(8&i?"class":v,r,Wh(n),e);if(-1===L){if(ea(i))return!1;d=!0;continue}if(""!==D){let j;j=L>s?"":r[L+1].toLowerCase();const W=8&i?j:null;if(W&&-1!==Df(W,D,0)||2&i&&D!==j){if(ea(i))return!1;d=!0}}}}else{if(!d&&!ea(i)&&!ea(v))return!1;if(d&&ea(v))continue;d=!1,i=v|1&i}}return ea(i)||d}function ea(n){return 0==(1&n)}function n0(n,t,e,i){if(null===t)return-1;let r=0;if(i||!e){let s=!1;for(;r<t.length;){const d=t[r];if(d===n)return r;if(3===d||6===d)s=!0;else{if(1===d||2===d){let m=t[++r];for(;"string"==typeof m;)m=t[++r];continue}if(4===d)break;if(0===d){r+=4;continue}}r+=s?1:2}return-1}return function r0(n,t){let e=n.indexOf(4);if(e>-1)for(e++;e<n.length;){const i=n[e];if("number"==typeof i)return-1;if(i===t)return e;e++}return-1}(t,n)}function u_(n,t,e=!1){for(let i=0;i<t.length;i++)if(c1(n,t[i],e))return!0;return!1}function o0(n,t){e:for(let e=0;e<t.length;e++){const i=t[e];if(n.length===i.length){for(let r=0;r<n.length;r++)if(n[r]!==i[r])continue e;return!0}}return!1}function sc(n,t){return n?":not("+t.trim()+")":t}function Xh(n){let t=n[0],e=1,i=2,r="",s=!1;for(;e<n.length;){let d=n[e];if("string"==typeof d)if(2&i){const m=n[++e];r+="["+d+(m.length>0?'="'+m+'"':"")+"]"}else 8&i?r+="."+d:4&i&&(r+=" "+d);else""!==r&&!ea(d)&&(t+=sc(s,r),r=""),i=d,s=s||!ea(i);e++}return""!==r&&(t+=sc(s,r)),t}const Ai={};function Je(n){a0(ji(),Ot(),cs()+n,!1)}function a0(n,t,e,i){if(!i)if(3==(3&t[2])){const s=n.preOrderCheckHooks;null!==s&&w(t,s,e)}else{const s=n.preOrderHooks;null!==s&&C(t,s,0,e)}Il(e)}const h_=new bt("ENVIRONMENT_INITIALIZER"),d0=new bt("INJECTOR_DEF_TYPES");function p_(...n){return{\u0275providers:tg(0,n)}}function tg(n,...t){const e=[],i=new Set;let r;return Rc(t,s=>{const d=s;ta(d,e,[],i)&&(r||(r=[]),r.push(d))}),void 0!==r&&f_(r,e),e}function f_(n,t){for(let e=0;e<n.length;e++){const{providers:r}=n[e];Rc(r,s=>{t.push(s)})}}function ta(n,t,e,i){if(!(n=Zt(n)))return!1;let r=null,s=xc(n);const d=!s&&Fr(n);if(s||d){if(d&&!d.standalone)return!1;r=n}else{const v=n.ngModule;if(s=xc(v),!s)return!1;r=v}const m=i.has(r);if(d){if(m)return!1;if(i.add(r),d.dependencies){const v="function"==typeof d.dependencies?d.dependencies():d.dependencies;for(const D of v)ta(D,t,e,i)}}else{if(!s)return!1;{if(null!=s.imports&&!m){let D;i.add(r);try{Rc(s.imports,A=>{ta(A,t,e,i)&&(D||(D=[]),D.push(A))})}finally{}void 0!==D&&f_(D,t)}if(!m){const D=Tl(r)||(()=>new r);t.push({provide:r,useFactory:D,deps:Ji},{provide:d0,useValue:r,multi:!0},{provide:h_,useValue:()=>Be(r),multi:!0})}const v=s.providers;null==v||m||Rc(v,A=>{t.push(A)})}}return r!==n&&void 0!==n.providers}const Yh=cr({provide:String,useValue:cr});function Mf(n){return null!==n&&"object"==typeof n&&Yh in n}function wu(n){return"function"==typeof n}const m_=new bt("INJECTOR",-1);class g_{get(t,e=al){if(e===al){const i=new Error(`NullInjectorError: No provider for ${xn(t)}!`);throw i.name="NullInjectorError",i}return e}}const ig=new bt("Set Injector scope."),Qh={},b_={};let rg;function __(){return void 0===rg&&(rg=new g_),rg}class Su{}class ac extends Su{constructor(t,e,i,r){super(),this.parent=e,this.source=i,this.scopes=r,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,sg(t,d=>this.processProvider(d)),this.records.set(m_,Kh(void 0,this)),r.has("environment")&&this.records.set(Su,Kh(void 0,this));const s=this.records.get(ig);null!=s&&"string"==typeof s.value&&this.scopes.add(s.value),this.injectorDefTypes=new Set(this.get(d0.multi,Ji,Yn.Self))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const t of this._ngOnDestroyHooks)t.ngOnDestroy();for(const t of this._onDestroyHooks)t()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),this._onDestroyHooks.length=0}}onDestroy(t){this._onDestroyHooks.push(t)}get(t,e=al,i=Yn.Default){this.assertNotDestroyed();const r=ba(this),s=$s(void 0);try{if(!(i&Yn.SkipSelf)){let m=this.records.get(t);if(void 0===m){const v=function b0(n){return"function"==typeof n||"object"==typeof n&&n instanceof bt}(t)&&el(t);m=v&&this.injectableDefInScope(v)?Kh(og(t),Qh):null,this.records.set(t,m)}if(null!=m)return this.hydrate(t,m)}return(i&Yn.Self?__():this.parent).get(t,e=i&Yn.Optional&&e===al?null:e)}catch(d){if("NullInjectorError"===d.name){if((d[Lm]=d[Lm]||[]).unshift(xn(t)),r)throw d;return function _v(n,t,e,i){const r=n[Lm];throw t[Tb]&&r.unshift(t[Tb]),n.message=function Db(n,t,e,i=null){n=n&&"\n"===n.charAt(0)&&"\u0275"==n.charAt(1)?n.slice(2):n;let r=xn(t);if(Array.isArray(t))r=t.map(xn).join(" -> ");else if("object"==typeof t){let s=[];for(let d in t)if(t.hasOwnProperty(d)){let m=t[d];s.push(d+":"+("string"==typeof m?JSON.stringify(m):xn(m)))}r=`{${s.join(", ")}}`}return`${e}${i?"("+i+")":""}[${r}]: ${n.replace(AS,"\n  ")}`}("\n"+n.message,r,e,i),n.ngTokenPath=r,n[Lm]=null,n}(d,t,"R3InjectorError",this.source)}throw d}finally{$s(s),ba(r)}}resolveInjectorInitializers(){const t=ba(this),e=$s(void 0);try{const i=this.get(h_.multi,Ji,Yn.Self);for(const r of i)r()}finally{ba(t),$s(e)}}toString(){const t=[],e=this.records;for(const i of e.keys())t.push(xn(i));return`R3Injector[${t.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Dt(205,!1)}processProvider(t){let e=wu(t=Zt(t))?t:Zt(t&&t.provide);const i=function m0(n){return Mf(n)?Kh(void 0,n.useValue):Kh(y_(n),Qh)}(t);if(wu(t)||!0!==t.multi)this.records.get(e);else{let r=this.records.get(e);r||(r=Kh(void 0,Qh,!0),r.factory=()=>nc(r.multi),this.records.set(e,r)),e=t,r.multi.push(t)}this.records.set(e,i)}hydrate(t,e){return e.value===Qh&&(e.value=b_,e.value=e.factory()),"object"==typeof e.value&&e.value&&function g0(n){return null!==n&&"object"==typeof n&&"function"==typeof n.ngOnDestroy}(e.value)&&this._ngOnDestroyHooks.add(e.value),e.value}injectableDefInScope(t){if(!t.providedIn)return!1;const e=Zt(t.providedIn);return"string"==typeof e?"any"===e||this.scopes.has(e):this.injectorDefTypes.has(e)}}function og(n){const t=el(n),e=null!==t?t.factory:Tl(n);if(null!==e)return e;if(n instanceof bt)throw new Dt(204,!1);if(n instanceof Function)return function f0(n){const t=n.length;if(t>0)throw Ph(t,"?"),new Dt(204,!1);const e=function hb(n){const t=n&&(n[ch]||n[$l]);if(t){const e=function zp(n){if(n.hasOwnProperty("name"))return n.name;const t=(""+n).match(/^function\s*([^\s(]+)/);return null===t?"":t[1]}(n);return console.warn(`DEPRECATED: DI is instantiating a token "${e}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${e}" class.`),t}return null}(n);return null!==e?()=>e.factory(n):()=>new n}(n);throw new Dt(204,!1)}function y_(n,t,e){let i;if(wu(n)){const r=Zt(n);return Tl(r)||og(r)}if(Mf(n))i=()=>Zt(n.useValue);else if(function h0(n){return!(!n||!n.useFactory)}(n))i=()=>n.useFactory(...nc(n.deps||[]));else if(function Af(n){return!(!n||!n.useExisting)}(n))i=()=>Be(Zt(n.useExisting));else{const r=Zt(n&&(n.useClass||n.provide));if(!function f1(n){return!!n.deps}(n))return Tl(r)||og(r);i=()=>new r(...nc(n.deps))}return i}function Kh(n,t,e=!1){return{factory:n,value:t,multi:e?[]:void 0}}function kf(n){return!!n.\u0275providers}function sg(n,t){for(const e of n)Array.isArray(e)?sg(e,t):kf(e)?sg(e.\u0275providers,t):t(e)}function v_(n,t=null,e=null,i){const r=ag(n,t,e,i);return r.resolveInjectorInitializers(),r}function ag(n,t=null,e=null,i,r=new Set){const s=[e||Ji,p_(n)];return i=i||("object"==typeof n?void 0:xn(n)),new ac(s,t||__(),i||null,r)}let xr=(()=>{class n{static create(e,i){var r;if(Array.isArray(e))return v_({name:""},i,e,"");{const s=null!==(r=e.name)&&void 0!==r?r:"";return v_({name:s},e.parent,e.providers,s)}}}return n.THROW_IF_NOT_FOUND=al,n.NULL=new g_,n.\u0275prov=Ut({token:n,providedIn:"any",factory:()=>Be(m_)}),n.__NG_ELEMENT_ID__=-1,n})();function $(n,t=Yn.Default){const e=Ot();return null===e?Be(n,t):hr(So(),e,Zt(n),t)}function zs(){throw new Error("invalid")}function rp(n,t){return n<<17|t<<2}function ul(n){return n>>17&32767}function pg(n){return 2|n}function Gc(n){return(131068&n)>>2}function A_(n,t){return-131069&n|t<<2}function qc(n){return 1|n}function O0(n,t){const e=n.contentQueries;if(null!==e)for(let i=0;i<e.length;i+=2){const r=e[i],s=e[i+1];if(-1!==s){const d=n.data[s];kc(r),d.contentQueries(2,t[s],s)}}}function za(n,t,e,i,r,s,d,m,v,D,A){const L=t.blueprint.slice();return L[0]=r,L[2]=76|i,(null!==A||n&&1024&n[2])&&(L[2]|=1024),gu(L),L[3]=L[15]=n,L[8]=e,L[10]=d||n&&n[10],L[11]=m||n&&n[11],L[12]=v||n&&n[12]||null,L[9]=D||n&&n[9]||null,L[6]=s,L[20]=function Bh(){return WS++}(),L[21]=A,L[16]=2==t.type?n[16]:L,L}function Va(n,t,e,i,r){let s=n.data[t];if(null===s)s=function hl(n,t,e,i,r){const s=Am(),d=cd(),v=n.data[t]=function Au(n,t,e,i,r,s){return{type:e,index:i,insertBeforeIndex:null,injectorIndex:t?t.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:r,attrs:s,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,d?s:s&&s.parent,e,t,i,r);return null===n.firstChild&&(n.firstChild=v),null!==s&&(d?null==s.child&&null!==v.parent&&(s.child=v):null===s.next&&(s.next=v)),v}(n,t,e,i,r),function dd(){return Ci.lFrame.inI18n}()&&(s.flags|=64);else if(64&s.type){s.type=e,s.value=i,s.attrs=r;const d=function ld(){const n=Ci.lFrame,t=n.currentTNode;return n.isParent?t:t.parent}();s.injectorIndex=null===d?-1:d.injectorIndex}return Fo(s,!0),s}function ja(n,t,e,i){if(0===e)return-1;const r=t.length;for(let s=0;s<e;s++)t.push(i),n.blueprint.push(i),n.data.push(null);return r}function kd(n,t,e){Eh(t);try{const i=n.viewQuery;null!==i&&ce(1,i,e);const r=n.template;null!==r&&j_(n,t,r,1,e),n.firstCreatePass&&(n.firstCreatePass=!1),n.staticContentQueries&&O0(n,t),n.staticViewQueries&&ce(2,n.viewQuery,e);const s=n.components;null!==s&&function dl(n,t){for(let e=0;e<t.length;e++)S(n,t[e])}(t,s)}catch(i){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),i}finally{t[2]&=-5,md()}}function lp(n,t,e,i){const r=t[2];if(128!=(128&r)){Eh(t);try{gu(t),function El(n){return Ci.lFrame.bindingIndex=n}(n.bindingStartIndex),null!==e&&j_(n,t,e,2,i);const d=3==(3&r);if(d){const D=n.preOrderCheckHooks;null!==D&&w(t,D,null)}else{const D=n.preOrderHooks;null!==D&&C(t,D,0,null),I(t,0)}if(function f(n){for(let t=Uh(n);null!==t;t=Hh(t)){if(!t[2])continue;const e=t[9];for(let i=0;i<e.length;i++){const r=e[i],s=r[3];0==(512&r[2])&&Ch(s,1),r[2]|=512}}}(t),function u(n){for(let t=Uh(n);null!==t;t=Hh(t))for(let e=10;e<t.length;e++){const i=t[e],r=i[1];wh(i)&&lp(r,i,r.template,i[8])}}(t),null!==n.contentQueries&&O0(n,t),d){const D=n.contentCheckHooks;null!==D&&w(t,D)}else{const D=n.contentHooks;null!==D&&C(t,D,1),I(t,1)}!function P0(n,t){const e=n.hostBindingOpCodes;if(null!==e)try{for(let i=0;i<e.length;i++){const r=e[i];if(r<0)Il(~r);else{const s=r,d=e[++i],m=e[++i];Kp(d,s),m(2,t[s])}}}finally{Il(-1)}}(n,t);const m=n.components;null!==m&&function L0(n,t){for(let e=0;e<t.length;e++)b(n,t[e])}(t,m);const v=n.viewQuery;if(null!==v&&ce(2,v,i),d){const D=n.viewCheckHooks;null!==D&&w(t,D)}else{const D=n.viewHooks;null!==D&&C(t,D,2),I(t,2)}!0===n.firstUpdatePass&&(n.firstUpdatePass=!1),t[2]&=-41,512&t[2]&&(t[2]&=-513,Ch(t[3],-1))}finally{md()}}}function F0(n,t,e,i){const r=t[10],d=xh(t);try{!d&&r.begin&&r.begin(),d&&kd(n,t,i),lp(n,t,e,i)}finally{!d&&r.end&&r.end()}}function j_(n,t,e,i,r){const s=cs(),d=2&i;try{Il(-1),d&&t.length>22&&a0(n,t,22,!1),e(i,r)}finally{Il(s)}}function _g(n,t,e){if(Hp(t)){const r=t.directiveEnd;for(let s=t.directiveStart;s<r;s++){const d=n.data[s];d.contentQueries&&d.contentQueries(1,e[s],s)}}}function U_(n,t,e){!sd()||(function z0(n,t,e,i){const r=e.directiveStart,s=e.directiveEnd;n.firstCreatePass||Lt(e,t),Es(i,t);const d=e.initialInputs;for(let m=r;m<s;m++){const v=n.data[m],D=pa(v);D&&k1(t,e,v);const A=Mo(t,n,m,e);Es(A,t),null!==d&&U0(0,m-r,A,v,0,d),D&&(as(e.index,t)[8]=A)}}(n,t,e,wo(e,t)),128==(128&e.flags)&&function V0(n,t,e){const i=e.directiveStart,r=e.directiveEnd,s=e.index,d=function km(){return Ci.lFrame.currentDirectiveIndex}();try{Il(s);for(let m=i;m<r;m++){const v=n.data[m],D=t[m];hd(m),(null!==v.hostBindings||0!==v.hostVars||null!==v.hostAttrs)&&cp(v,D)}}finally{Il(-1),hd(d)}}(n,t,e))}function yg(n,t,e=wo){const i=t.localNames;if(null!==i){let r=t.index+1;for(let s=0;s<i.length;s+=2){const d=i[s+1],m=-1===d?e(t,n):n[d];n[r++]=m}}}function H_(n){const t=n.tView;return null===t||t.incompleteFirstPass?n.tView=vg(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts):t}function vg(n,t,e,i,r,s,d,m,v,D){const A=22+i,L=A+r,j=function N0(n,t){const e=[];for(let i=0;i<t;i++)e.push(i<n?null:Ai);return e}(A,L),W="function"==typeof D?D():D;return j[1]={type:n,blueprint:j,template:e,queries:null,viewQuery:m,declTNode:t,data:j.slice().fill(null,A),bindingStartIndex:A,expandoStartIndex:L,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof s?s():s,pipeRegistry:"function"==typeof d?d():d,firstChild:null,schemas:v,consts:W,incompleteFirstPass:!1}}function $_(n,t,e,i){const r=ge(t);null===e?r.push(i):(r.push(e),n.firstCreatePass&&De(n).push(i,r.length-1))}function G_(n,t,e){for(let i in n)if(n.hasOwnProperty(i)){const r=n[i];(e=null===e?{}:e).hasOwnProperty(i)?e[i].push(t,r):e[i]=[t,r]}return e}function ps(n,t,e,i,r,s,d,m){const v=wo(t,e);let A,D=t.inputs;!m&&null!=D&&(A=D[i])?(Ze(n,e,A,i,r),gh(t)&&function q_(n,t){const e=as(t,n);16&e[2]||(e[2]|=32)}(e,t.index)):3&t.type&&(i=function M1(n){return"class"===n?"className":"for"===n?"htmlFor":"formaction"===n?"formAction":"innerHtml"===n?"innerHTML":"readonly"===n?"readOnly":"tabindex"===n?"tabIndex":n}(i),r=null!=d?d(r,t.value||"",i):r,s.setProperty(v,i,r))}function Of(n,t,e,i){let r=!1;if(sd()){const s=function wg(n,t,e){const i=n.directiveRegistry;let r=null;if(i)for(let s=0;s<i.length;s++){const d=i[s];u_(e,d.selectors,!1)&&(r||(r=[]),yn(Lt(e,t),n,d.type),pa(d)?(Z_(n,e),r.unshift(d)):r.push(d))}return r}(n,t,e),d=null===i?null:{"":-1};if(null!==s){r=!0,Y_(e,n.data.length,s.length);for(let A=0;A<s.length;A++){const L=s[A];L.providersResolver&&L.providersResolver(L)}let m=!1,v=!1,D=ja(n,t,s.length,null);for(let A=0;A<s.length;A++){const L=s[A];e.mergedAttrs=he(e.mergedAttrs,L.hostAttrs),Q_(n,e,t,D,L),A1(D,L,d),null!==L.contentQueries&&(e.flags|=8),(null!==L.hostBindings||null!==L.hostAttrs||0!==L.hostVars)&&(e.flags|=128);const j=L.type.prototype;!m&&(j.ngOnChanges||j.ngOnInit||j.ngDoCheck)&&((n.preOrderHooks||(n.preOrderHooks=[])).push(e.index),m=!0),!v&&(j.ngOnChanges||j.ngDoCheck)&&((n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e.index),v=!0),D++}!function xg(n,t){const i=t.directiveEnd,r=n.data,s=t.attrs,d=[];let m=null,v=null;for(let D=t.directiveStart;D<i;D++){const A=r[D],L=A.inputs,j=null===s||Wh(t)?null:a(L,s);d.push(j),m=G_(L,D,m),v=G_(A.outputs,D,v)}null!==m&&(m.hasOwnProperty("class")&&(t.flags|=16),m.hasOwnProperty("style")&&(t.flags|=32)),t.initialInputs=d,t.inputs=m,t.outputs=v}(n,e)}d&&function j0(n,t,e){if(t){const i=n.localNames=[];for(let r=0;r<t.length;r+=2){const s=e[t[r+1]];if(null==s)throw new Dt(-301,!1);i.push(t[r],s)}}}(e,i,d)}return e.mergedAttrs=he(e.mergedAttrs,e.attrs),r}function pl(n,t,e,i,r,s){const d=s.hostBindings;if(d){let m=n.hostBindingOpCodes;null===m&&(m=n.hostBindingOpCodes=[]);const v=~t.index;(function Rd(n){let t=n.length;for(;t>0;){const e=n[--t];if("number"==typeof e&&e<0)return e}return 0})(m)!=v&&m.push(v),m.push(i,r,d)}}function cp(n,t){null!==n.hostBindings&&n.hostBindings(1,t)}function Z_(n,t){t.flags|=2,(n.components||(n.components=[])).push(t.index)}function A1(n,t,e){if(e){if(t.exportAs)for(let i=0;i<t.exportAs.length;i++)e[t.exportAs[i]]=n;pa(t)&&(e[""]=n)}}function Y_(n,t,e){n.flags|=1,n.directiveStart=t,n.directiveEnd=t+e,n.providerIndexes=t}function Q_(n,t,e,i,r){n.data[i]=r;const s=r.factory||(r.factory=Tl(r.type)),d=new N(s,pa(r),$);n.blueprint[i]=d,e[i]=d,pl(n,t,0,i,ja(n,e,r.hostVars,Ai),r)}function k1(n,t,e){const i=wo(t,n),r=H_(e),s=n[10],d=E(n,za(n,r,null,e.onPush?32:16,i,t,s,s.createRenderer(i,e),null,null,null));n[t.index]=d}function fl(n,t,e,i,r,s){const d=wo(n,t);!function Sg(n,t,e,i,r,s,d){if(null==s)n.removeAttribute(t,r,e);else{const m=null==d?Cn(s):d(s,i||"",r);n.setAttribute(t,r,m,e)}}(t[11],d,s,n.value,e,i,r)}function U0(n,t,e,i,r,s){const d=s[t];if(null!==d){const m=i.setInput;for(let v=0;v<d.length;){const D=d[v++],A=d[v++],L=d[v++];null!==m?i.setInput(e,L,D,A):e[A]=L}}}function a(n,t){let e=null,i=0;for(;i<t.length;){const r=t[i];if(0!==r)if(5!==r){if("number"==typeof r)break;n.hasOwnProperty(r)&&(null===e&&(e=[]),e.push(r,n[r],t[i+1])),i+=2}else i+=2;else i+=4}return e}function l(n,t,e,i){return new Array(n,!0,!1,t,null,0,i,e,null,null)}function b(n,t){const e=as(t,n);if(wh(e)){const i=e[1];48&e[2]?lp(i,e,i.template,e[8]):e[5]>0&&y(e)}}function y(n){for(let i=Uh(n);null!==i;i=Hh(i))for(let r=10;r<i.length;r++){const s=i[r];if(512&s[2]){const d=s[1];lp(d,s,d.template,s[8])}else s[5]>0&&y(s)}const e=n[1].components;if(null!==e)for(let i=0;i<e.length;i++){const r=as(e[i],n);wh(r)&&r[5]>0&&y(r)}}function S(n,t){const e=as(t,n),i=e[1];(function T(n,t){for(let e=t.length;e<n.blueprint.length;e++)t.push(n.blueprint[e])})(i,e),kd(i,e,e[8])}function E(n,t){return n[13]?n[14][4]=t:n[13]=t,n[14]=t,t}function M(n){for(;n;){n[2]|=32;const t=vf(n);if(wm(n)&&!t)return n;n=t}return null}function V(n){!function O(n){for(let t=0;t<n.components.length;t++){const e=n.components[t],i=bf(e);if(null!==i){const r=i[1];F0(r,i,r.template,e)}}}(n[8])}function ce(n,t,e){kc(0),t(n,e)}const ue=(()=>Promise.resolve(null))();function ge(n){return n[7]||(n[7]=[])}function De(n){return n.cleanup||(n.cleanup=[])}function xe(n,t,e){return(null===n||pa(n))&&(e=function vh(n){for(;Array.isArray(n);){if("object"==typeof n[1])return n;n=n[0]}return null}(e[t.index])),e[11]}function tt(n,t){const e=n[9],i=e?e.get(va,null):null;i&&i.handleError(t)}function Ze(n,t,e,i,r){for(let s=0;s<e.length;){const d=e[s++],m=e[s++],v=t[d],D=n.data[d];null!==D.setInput?D.setInput(v,r,i,m):v[m]=r}}function lt(n,t,e){const i=Jl(t,n);!function n_(n,t,e){n.setValue(t,e)}(n[11],i,e)}function Mt(n,t,e){let i=e?n.styles:null,r=e?n.classes:null,s=0;if(null!==t)for(let d=0;d<t.length;d++){const m=t[d];"number"==typeof m?s=m:1==s?r=Ti(r,m):2==s&&(i=Ti(i,m+": "+t[++d]+";"))}e?n.styles=i:n.stylesWithoutHost=i,e?n.classes=r:n.classesWithoutHost=r}function Rt(){const n=So();_(Ot()[1],n)}function ut(n){let t=function nn(n){return Object.getPrototypeOf(n.prototype).constructor}(n.type),e=!0;const i=[n];for(;t;){let r;if(pa(n))r=t.\u0275cmp||t.\u0275dir;else{if(t.\u0275cmp)throw new Dt(903,!1);r=t.\u0275dir}if(r){if(e){i.push(r);const d=n;d.inputs=hn(n.inputs),d.declaredInputs=hn(n.declaredInputs),d.outputs=hn(n.outputs);const m=r.hostBindings;m&&fi(n,m);const v=r.viewQuery,D=r.contentQueries;if(v&&Yt(n,v),D&&Zn(n,D),qt(n.inputs,r.inputs),qt(n.declaredInputs,r.declaredInputs),qt(n.outputs,r.outputs),pa(r)&&r.data.animation){const A=n.data;A.animation=(A.animation||[]).concat(r.data.animation)}}const s=r.features;if(s)for(let d=0;d<s.length;d++){const m=s[d];m&&m.ngInherit&&m(n),m===ut&&(e=!1)}}t=Object.getPrototypeOf(t)}!function vn(n){let t=0,e=null;for(let i=n.length-1;i>=0;i--){const r=n[i];r.hostVars=t+=r.hostVars,r.hostAttrs=he(r.hostAttrs,e=he(e,r.hostAttrs))}}(i)}function hn(n){return n===Gl?{}:n===Ji?[]:n}function Yt(n,t){const e=n.viewQuery;n.viewQuery=e?(i,r)=>{t(i,r),e(i,r)}:t}function Zn(n,t){const e=n.contentQueries;n.contentQueries=e?(i,r,s)=>{t(i,r,s),e(i,r,s)}:t}function fi(n,t){const e=n.hostBindings;n.hostBindings=e?(i,r)=>{t(i,r),e(i,r)}:t}let Cr=null;function ri(){if(!Cr){const n=Sr.Symbol;if(n&&n.iterator)Cr=n.iterator;else{const t=Object.getOwnPropertyNames(Map.prototype);for(let e=0;e<t.length;++e){const i=t[e];"entries"!==i&&"size"!==i&&Map.prototype[i]===Map.prototype.entries&&(Cr=i)}}}return Cr}function Zi(n){return!!Tr(n)&&(Array.isArray(n)||!(n instanceof Map)&&ri()in n)}function Tr(n){return null!==n&&("function"==typeof n||"object"==typeof n)}function yi(n,t,e){return!Object.is(n[t],e)&&(n[t]=e,!0)}function Ht(n,t,e,i){const r=Ot();return yi(r,Mc(),t)&&(ji(),fl(Qr(),r,n,t,e,i)),Ht}function Hi(n,t,e,i){return yi(n,Mc(),e)?t+Cn(e)+i:Ai}function Br(n,t,e,i,r,s){const m=function jr(n,t,e,i){const r=yi(n,t,e);return yi(n,t+1,i)||r}(n,function Zs(){return Ci.lFrame.bindingIndex}(),e,r);return rl(2),m?t+Cn(e)+i+Cn(r)+s:Ai}function cn(n,t,e,i,r,s,d,m){const v=Ot(),D=ji(),A=n+22,L=D.firstCreatePass?function ty(n,t,e,i,r,s,d,m,v){const D=t.consts,A=Va(t,n,4,d||null,Oa(D,m));Of(t,e,A,Oa(D,v)),_(t,A);const L=A.tViews=vg(2,A,i,r,s,t.directiveRegistry,t.pipeRegistry,null,t.schemas,D);return null!==t.queries&&(t.queries.template(t,A),L.queries=t.queries.embeddedTView(A)),A}(A,D,v,t,e,i,r,s,d):D.data[A];Fo(L,!1);const j=v[11].createComment("");wf(D,v,j,L),Es(j,v),E(v,v[A]=l(j,v,j,L)),ed(L)&&U_(D,v,L),null!=d&&yg(v,L,m)}function Ua(n){return Ec(function Th(){return Ci.lFrame.contextLView}(),22+n)}function dt(n,t,e){const i=Ot();return yi(i,Mc(),t)&&ps(ji(),Qr(),i,n,t,i[11],e,!1),dt}function Vs(n,t,e,i,r){const d=r?"class":"style";Ze(n,e,t.inputs[d],d,i)}function Ee(n,t,e,i){const r=Ot(),s=ji(),d=22+n,m=r[11],v=r[d]=Qm(m,t,function c(){return Ci.lFrame.currentNamespace}()),D=s.firstCreatePass?function Sa(n,t,e,i,r,s,d){const m=t.consts,D=Va(t,n,2,r,Oa(m,s));return Of(t,e,D,Oa(m,d)),null!==D.attrs&&Mt(D,D.attrs,!1),null!==D.mergedAttrs&&Mt(D,D.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,D),D}(d,s,r,0,t,e,i):s.data[d];Fo(D,!0);const A=D.mergedAttrs;null!==A&&J(m,v,A);const L=D.classes;null!==L&&Tf(m,v,L);const j=D.styles;return null!==j&&Ol(m,v,j),64!=(64&D.flags)&&wf(s,r,v,D),0===function Zp(){return Ci.lFrame.elementDepthCount}()&&Es(v,r),function Ic(){Ci.lFrame.elementDepthCount++}(),ed(D)&&(U_(s,r,D),_g(s,D,r)),null!==i&&yg(r,D),Ee}function Pe(){let n=So();cd()?ec():(n=n.parent,Fo(n,!1));const t=n;!function Mm(){Ci.lFrame.elementDepthCount--}();const e=ji();return e.firstCreatePass&&(_(e,n),Hp(n)&&e.queries.elementEnd(n)),null!=t.classesWithoutHost&&function ne(n){return 0!=(16&n.flags)}(t)&&Vs(e,t,Ot(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function K(n){return 0!=(32&n.flags)}(t)&&Vs(e,t,Ot(),t.stylesWithoutHost,!1),Pe}function qn(n,t,e,i){return Ee(n,t,e,i),Pe(),qn}function Fd(n,t,e){const i=Ot(),r=ji(),s=n+22,d=r.firstCreatePass?function Ld(n,t,e,i,r){const s=t.consts,d=Oa(s,i),m=Va(t,n,8,"ng-container",d);return null!==d&&Mt(m,d,!0),Of(t,e,m,Oa(s,r)),null!==t.queries&&t.queries.elementStart(t,m),m}(s,r,i,t,e):r.data[s];Fo(d,!0);const m=i[s]=i[11].createComment("");return wf(r,i,m,d),Es(m,i),ed(d)&&(U_(r,i,d),_g(r,d,i)),null!=e&&yg(i,d),Fd}function Nd(){let n=So();const t=ji();return cd()?ec():(n=n.parent,Fo(n,!1)),t.firstCreatePass&&(_(t,n),Hp(n)&&t.queries.elementEnd(n)),Nd}function cc(n,t,e){return Fd(n,t,e),Nd(),cc}function ml(){return Ot()}function ny(n){return!!n&&"function"==typeof n.then}function ZE(n){return!!n&&"function"==typeof n.subscribe}const R1=ZE;function Wt(n,t,e,i){const r=Ot(),s=ji(),d=So();return YE(s,r,r[11],d,n,t,0,i),Wt}function iy(n,t){const e=So(),i=Ot(),r=ji();return YE(r,i,xe(Ac(r.data),e,i),e,n,t),iy}function YE(n,t,e,i,r,s,d,m){const v=ed(i),A=n.firstCreatePass&&De(n),L=t[8],j=ge(t);let W=!0;if(3&i.type||m){const Re=wo(i,t),We=m?m(Re):Re,xt=j.length,st=m?Tn=>m(to(Tn[i.index])):i.index;let Bt=null;if(!m&&v&&(Bt=function YF(n,t,e,i){const r=n.cleanup;if(null!=r)for(let s=0;s<r.length-1;s+=2){const d=r[s];if(d===e&&r[s+1]===i){const m=t[7],v=r[s+2];return m.length>v?m[v]:null}"string"==typeof d&&(s+=2)}return null}(n,t,r,i.index)),null!==Bt)(Bt.__ngLastListenerFn__||Bt).__ngNextListenerFn__=s,Bt.__ngLastListenerFn__=s,W=!1;else{s=KE(i,t,L,s,!1);const Tn=e.listen(We,r,s);j.push(s,Tn),A&&A.push(r,st,xt,xt+1)}}else s=KE(i,t,L,s,!1);const ie=i.outputs;let we;if(W&&null!==ie&&(we=ie[r])){const Re=we.length;if(Re)for(let We=0;We<Re;We+=2){const ai=t[we[We]][we[We+1]].subscribe(s),Gr=j.length;j.push(s,ai),A&&A.push(r,i.index,Gr,-(Gr+1))}}}function QE(n,t,e,i){try{return!1!==e(i)}catch(r){return tt(n,r),!1}}function KE(n,t,e,i,r){return function s(d){if(d===Function)return i;M(2&n.flags?as(n.index,t):t);let v=QE(t,0,i,d),D=s.__ngNextListenerFn__;for(;D;)v=QE(t,0,D,d)&&v,D=D.__ngNextListenerFn__;return r&&!1===v&&(d.preventDefault(),d.returnValue=!1),v}}function Fn(n=1){return function Mh(n){return(Ci.lFrame.contextLView=function Rm(n,t){for(;n>0;)t=t[15],n--;return t}(n,Ci.lFrame.contextLView))[8]}(n)}function QF(n,t){let e=null;const i=function kr(n){const t=n.attrs;if(null!=t){const e=t.indexOf(5);if(0==(1&e))return t[e+1]}return null}(n);for(let r=0;r<t.length;r++){const s=t[r];if("*"!==s){if(null===i?u_(n,s,!0):o0(i,s))return r}else e=r}return e}function Ro(n){const t=Ot()[16][6];if(!t.projection){const i=t.projection=Ph(n?n.length:1,null),r=i.slice();let s=t.child;for(;null!==s;){const d=n?QF(s,n):0;null!==d&&(r[d]?r[d].projectionNext=s:i[d]=s,r[d]=s),s=s.next}}}function Lr(n,t=0,e){const i=Ot(),r=ji(),s=Va(r,22+n,16,null,e||null);null===s.projection&&(s.projection=t),ec(),64!=(64&s.flags)&&function o1(n,t,e){c_(t[11],0,t,e,Is(n,e,t),Yv(e.parent||t[6],e,t))}(r,i,s)}function hp(n,t,e){return P1(n,"",t,"",e),hp}function P1(n,t,e,i,r){const s=Ot(),d=Hi(s,t,e,i);return d!==Ai&&ps(ji(),Qr(),s,n,d,s[11],r,!1),P1}function aI(n,t,e,i,r){const s=n[e+1],d=null===t;let m=i?ul(s):Gc(s),v=!1;for(;0!==m&&(!1===v||d);){const A=n[m+1];eN(n[m],t)&&(v=!0,n[m+1]=i?qc(A):pg(A)),m=i?ul(A):Gc(A)}v&&(n[e+1]=i?pg(s):qc(s))}function eN(n,t){return null===n||null==t||(Array.isArray(n)?n[1]:n)===t||!(!Array.isArray(n)||"string"!=typeof t)&&Oc(n,t)>=0}function Bd(n,t,e){return Zc(n,t,e,!1),Bd}function Oi(n,t){return Zc(n,t,null,!0),Oi}function Zc(n,t,e,i){const r=Ot(),s=ji(),d=rl(2);s.firstUpdatePass&&function mI(n,t,e,i){const r=n.data;if(null===r[e+1]){const s=r[cs()],d=function fI(n,t){return t>=n.expandoStartIndex}(n,e);(function yI(n,t){return 0!=(n.flags&(t?16:32))})(s,i)&&null===t&&!d&&(t=!1),t=function cN(n,t,e,i){const r=Ac(n);let s=i?t.residualClasses:t.residualStyles;if(null===r)0===(i?t.classBindings:t.styleBindings)&&(e=ry(e=O1(null,n,t,e,i),t.attrs,i),s=null);else{const d=t.directiveStylingLast;if(-1===d||n[d]!==r)if(e=O1(r,n,t,e,i),null===s){let v=function uN(n,t,e){const i=e?t.classBindings:t.styleBindings;if(0!==Gc(i))return n[ul(i)]}(n,t,i);void 0!==v&&Array.isArray(v)&&(v=O1(null,n,t,v[1],i),v=ry(v,t.attrs,i),function dN(n,t,e,i){n[ul(e?t.classBindings:t.styleBindings)]=i}(n,t,i,v))}else s=function hN(n,t,e){let i;const r=t.directiveEnd;for(let s=1+t.directiveStylingLast;s<r;s++)i=ry(i,n[s].hostAttrs,e);return ry(i,t.attrs,e)}(n,t,i)}return void 0!==s&&(i?t.residualClasses=s:t.residualStyles=s),e}(r,s,t,i),function KF(n,t,e,i,r,s){let d=s?t.classBindings:t.styleBindings,m=ul(d),v=Gc(d);n[i]=e;let A,D=!1;if(Array.isArray(e)){const L=e;A=L[1],(null===A||Oc(L,A)>0)&&(D=!0)}else A=e;if(r)if(0!==v){const j=ul(n[m+1]);n[i+1]=rp(j,m),0!==j&&(n[j+1]=A_(n[j+1],i)),n[m+1]=function E0(n,t){return 131071&n|t<<17}(n[m+1],i)}else n[i+1]=rp(m,0),0!==m&&(n[m+1]=A_(n[m+1],i)),m=i;else n[i+1]=rp(v,0),0===m?m=i:n[v+1]=A_(n[v+1],i),v=i;D&&(n[i+1]=pg(n[i+1])),aI(n,A,i,!0),aI(n,A,i,!1),function JF(n,t,e,i,r){const s=r?n.residualClasses:n.residualStyles;null!=s&&"string"==typeof t&&Oc(s,t)>=0&&(e[i+1]=qc(e[i+1]))}(t,A,n,i,s),d=rp(m,v),s?t.classBindings=d:t.styleBindings=d}(r,s,t,e,d,i)}}(s,n,d,i),t!==Ai&&yi(r,d,t)&&function bI(n,t,e,i,r,s,d,m){if(!(3&t.type))return;const v=n.data,D=v[m+1];$0(function k_(n){return 1==(1&n)}(D)?_I(v,t,e,r,Gc(D),d):void 0)||($0(s)||function Ed(n){return 2==(2&n)}(D)&&(s=_I(v,null,e,r,m,d)),function hs(n,t,e,i,r){if(t)r?n.addClass(e,i):n.removeClass(e,i);else{let s=-1===i.indexOf("-")?void 0:xa.DashCase;null==r?n.removeStyle(e,i,s):("string"==typeof r&&r.endsWith("!important")&&(r=r.slice(0,-10),s|=xa.Important),n.setStyle(e,i,r,s))}}(i,d,Jl(cs(),e),r,s))}(s,s.data[cs()],r,r[11],n,r[d+1]=function mN(n,t){return null==n||("string"==typeof t?n+=t:"object"==typeof n&&(n=xn(Js(n)))),n}(t,e),i,d)}function O1(n,t,e,i,r){let s=null;const d=e.directiveEnd;let m=e.directiveStylingLast;for(-1===m?m=e.directiveStart:m++;m<d&&(s=t[m],i=ry(i,s.hostAttrs,r),s!==n);)m++;return null!==n&&(e.directiveStylingLast=m),i}function ry(n,t,e){const i=e?1:2;let r=-1;if(null!==t)for(let s=0;s<t.length;s++){const d=t[s];"number"==typeof d?r=d:r===i&&(Array.isArray(n)||(n=void 0===n?[]:["",n]),Bs(n,d,!!e||t[++s]))}return void 0===n?null:n}function _I(n,t,e,i,r,s){const d=null===t;let m;for(;r>0;){const v=n[r],D=Array.isArray(v),A=D?v[1]:v,L=null===A;let j=e[r+1];j===Ai&&(j=L?Ji:void 0);let W=L?kl(j,i):A===i?j:void 0;if(D&&!$0(W)&&(W=kl(v,i)),$0(W)&&(m=W,d))return m;const ie=n[r+1];r=d?ul(ie):Gc(ie)}if(null!==t){let v=s?t.residualClasses:t.residualStyles;null!=v&&(m=kl(v,i))}return m}function $0(n){return void 0!==n}function Pt(n,t=""){const e=Ot(),i=ji(),r=n+22,s=i.firstCreatePass?Va(i,r,1,t,null):i.data[r],d=e[r]=function Sd(n,t){return n.createText(t)}(e[11],t);wf(i,e,d,s),Fo(s,!1)}function tr(n){return Do("",n,""),tr}function Do(n,t,e){const i=Ot(),r=Hi(i,n,t,e);return r!==Ai&&lt(i,cs(),r),Do}function G0(n,t,e,i,r){const s=Ot(),d=Br(s,n,t,e,i,r);return d!==Ai&&lt(s,cs(),d),G0}function uc(n,t,e){const i=Ot();return yi(i,Mc(),t)&&ps(ji(),Qr(),i,n,t,i[11],e,!0),uc}function oy(n,t,e){const i=Ot();if(yi(i,Mc(),t)){const s=ji(),d=Qr();ps(s,d,i,n,t,xe(Ac(s.data),d,i),e,!0)}return oy}const Lf=void 0;var LN=["en",[["a","p"],["AM","PM"],Lf],[["AM","PM"],Lf,Lf],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Lf,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Lf,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Lf,"{1} 'at' {0}",Lf],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function ON(n){const e=Math.floor(Math.abs(n)),i=n.toString().replace(/^[^.]*\.?/,"").length;return 1===e&&0===i?1:5}];let Eg={};function Ha(n){const t=function FN(n){return n.toLowerCase().replace(/_/g,"-")}(n);let e=NI(t);if(e)return e;const i=t.split("-")[0];if(e=NI(i),e)return e;if("en"===i)return LN;throw new Dt(701,!1)}function NI(n){return n in Eg||(Eg[n]=Sr.ng&&Sr.ng.common&&Sr.ng.common.locales&&Sr.ng.common.locales[n]),Eg[n]}var En=(()=>((En=En||{})[En.LocaleId=0]="LocaleId",En[En.DayPeriodsFormat=1]="DayPeriodsFormat",En[En.DayPeriodsStandalone=2]="DayPeriodsStandalone",En[En.DaysFormat=3]="DaysFormat",En[En.DaysStandalone=4]="DaysStandalone",En[En.MonthsFormat=5]="MonthsFormat",En[En.MonthsStandalone=6]="MonthsStandalone",En[En.Eras=7]="Eras",En[En.FirstDayOfWeek=8]="FirstDayOfWeek",En[En.WeekendRange=9]="WeekendRange",En[En.DateFormat=10]="DateFormat",En[En.TimeFormat=11]="TimeFormat",En[En.DateTimeFormat=12]="DateTimeFormat",En[En.NumberSymbols=13]="NumberSymbols",En[En.NumberFormats=14]="NumberFormats",En[En.CurrencyCode=15]="CurrencyCode",En[En.CurrencySymbol=16]="CurrencySymbol",En[En.CurrencyName=17]="CurrencyName",En[En.Currencies=18]="Currencies",En[En.Directionality=19]="Directionality",En[En.PluralCase=20]="PluralCase",En[En.ExtraData=21]="ExtraData",En))();const Ig="en-US";let BI=Ig;function N1(n,t,e,i,r){if(n=Zt(n),Array.isArray(n))for(let s=0;s<n.length;s++)N1(n[s],t,e,i,r);else{const s=ji(),d=Ot();let m=wu(n)?n:Zt(n.provide),v=y_(n);const D=So(),A=1048575&D.providerIndexes,L=D.directiveStart,j=D.providerIndexes>>20;if(wu(n)||!n.multi){const W=new N(v,r,$),ie=z1(m,t,r?A:A+j,L);-1===ie?(yn(Lt(D,d),s,m),B1(s,n,t.length),t.push(m),D.directiveStart++,D.directiveEnd++,r&&(D.providerIndexes+=1048576),e.push(W),d.push(W)):(e[ie]=W,d[ie]=W)}else{const W=z1(m,t,A+j,L),ie=z1(m,t,A,A+j),we=W>=0&&e[W],Re=ie>=0&&e[ie];if(r&&!Re||!r&&!we){yn(Lt(D,d),s,m);const We=function PB(n,t,e,i,r){const s=new N(n,e,$);return s.multi=[],s.index=t,s.componentProviders=0,cM(s,r,i&&!e),s}(r?RB:kB,e.length,r,i,v);!r&&Re&&(e[ie].providerFactory=We),B1(s,n,t.length,0),t.push(m),D.directiveStart++,D.directiveEnd++,r&&(D.providerIndexes+=1048576),e.push(We),d.push(We)}else B1(s,n,W>-1?W:ie,cM(e[r?ie:W],v,!r&&i));!r&&i&&Re&&e[ie].componentProviders++}}}function B1(n,t,e,i){const r=wu(t),s=function p0(n){return!!n.useClass}(t);if(r||s){const v=(s?Zt(t.useClass):t).prototype.ngOnDestroy;if(v){const D=n.destroyHooks||(n.destroyHooks=[]);if(!r&&t.multi){const A=D.indexOf(e);-1===A?D.push(e,[i,v]):D[A+1].push(i,v)}else D.push(e,v)}}}function cM(n,t,e){return e&&n.componentProviders++,n.multi.push(t)-1}function z1(n,t,e,i){for(let r=e;r<i;r++)if(t[r]===n)return r;return-1}function kB(n,t,e,i){return V1(this.multi,[])}function RB(n,t,e,i){const r=this.multi;let s;if(this.providerFactory){const d=this.providerFactory.componentProviders,m=Mo(e,e[1],this.providerFactory.index,i);s=m.slice(0,d),V1(r,s);for(let v=d;v<m.length;v++)s.push(m[v])}else s=[],V1(r,s);return s}function V1(n,t){for(let e=0;e<n.length;e++)t.push((0,n[e])());return t}function Kn(n,t=[]){return e=>{e.providersResolver=(i,r)=>function AB(n,t,e){const i=ji();if(i.firstCreatePass){const r=pa(n);N1(e,i.data,i.blueprint,r,!0),N1(t,i.data,i.blueprint,r,!1)}}(i,r?r(n):n,t)}}class LB{resolveComponentFactory(t){throw function OB(n){const t=Error(`No component factory found for ${xn(n)}. Did you add it to @NgModule.entryComponents?`);return t.ngComponent=n,t}(t)}}let Ff=(()=>{class n{}return n.NULL=new LB,n})();class pp{}class dM{}class hM{}function NB(){return Ag(So(),Ot())}function Ag(n,t){return new Pn(wo(n,t))}let Pn=(()=>{class n{constructor(e){this.nativeElement=e}}return n.__NG_ELEMENT_ID__=NB,n})();function BB(n){return n instanceof Pn?n.nativeElement:n}class uy{}let Ou=(()=>{class n{}return n.__NG_ELEMENT_ID__=()=>function zB(){const n=Ot(),e=as(So().index,n);return(os(e)?e:n)[11]}(),n})(),VB=(()=>{class n{}return n.\u0275prov=Ut({token:n,providedIn:"root",factory:()=>null}),n})();class Nf{constructor(t){this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}}const jB=new Nf("14.0.6"),j1={};function Y0(n,t,e,i,r=!1){for(;null!==e;){const s=t[e.index];if(null!==s&&i.push(to(s)),ss(s))for(let m=10;m<s.length;m++){const v=s[m],D=v[1].firstChild;null!==D&&Y0(v[1],v,D,i)}const d=e.type;if(8&d)Y0(n,t,e.child,i);else if(32&d){const m=e_(e,t);let v;for(;v=m();)i.push(v)}else if(16&d){const m=s_(t,e);if(Array.isArray(m))i.push(...m);else{const v=vf(t[16]);Y0(v[1],v,m,i,!0)}}e=r?e.projectionNext:e.next}return i}class dy{constructor(t,e){this._lView=t,this._cdRefInjectingView=e,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const t=this._lView,e=t[1];return Y0(e,t,e.firstChild,[])}get context(){return this._lView[8]}set context(t){this._lView[8]=t}get destroyed(){return 128==(128&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const t=this._lView[3];if(ss(t)){const e=t[8],i=e?e.indexOf(this):-1;i>-1&&(r_(t,i),Pc(e,i))}this._attachedToViewContainer=!1}Wv(this._lView[1],this._lView)}onDestroy(t){$_(this._lView[1],this._lView,null,t)}markForCheck(){M(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-65}reattach(){this._lView[2]|=64}detectChanges(){!function B(n,t,e){const i=t[10];i.begin&&i.begin();try{lp(n,t,n.template,e)}catch(r){throw tt(t,r),r}finally{i.end&&i.end()}}(this._lView[1],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Dt(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function Hv(n,t){Cf(n,t,t[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new Dt(902,!1);this._appRef=t}}class UB extends dy{constructor(t){super(t),this._view=t}detectChanges(){V(this._view)}checkNoChanges(){}get context(){return null}}class U1 extends Ff{constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){const e=Fr(t);return new H1(e,this.ngModule)}}function pM(n){const t=[];for(let e in n)n.hasOwnProperty(e)&&t.push({propName:n[e],templateName:e});return t}class $B{constructor(t,e){this.injector=t,this.parentInjector=e}get(t,e,i){const r=this.injector.get(t,j1,i);return r!==j1||e===j1?r:this.parentInjector.get(t,e,i)}}class H1 extends hM{constructor(t,e){super(),this.componentDef=t,this.ngModule=e,this.componentType=t.type,this.selector=function s0(n){return n.map(Xh).join(",")}(t.selectors),this.ngContentSelectors=t.ngContentSelectors?t.ngContentSelectors:[],this.isBoundToModule=!!e}get inputs(){return pM(this.componentDef.inputs)}get outputs(){return pM(this.componentDef.outputs)}create(t,e,i,r){let s=(r=r||this.ngModule)instanceof Su?r:null==r?void 0:r.injector;s&&null!==this.componentDef.getStandaloneInjector&&(s=this.componentDef.getStandaloneInjector(s)||s);const d=s?new $B(t,s):t,m=d.get(uy,null);if(null===m)throw new Dt(407,!1);const v=d.get(VB,null),D=m.createRenderer(null,this.componentDef),A=this.componentDef.selectors[0][0]||"div",L=i?function B0(n,t,e){return n.selectRootElement(t,e===Gs.ShadowDom)}(D,i,this.componentDef.encapsulation):Qm(m.createRenderer(null,this.componentDef),A,function HB(n){const t=n.toLowerCase();return"svg"===t?"svg":"math"===t?"math":null}(A)),j=this.componentDef.onPush?288:272,W=function Ct(n,t){return{components:[],scheduler:n||Zm,clean:ue,playerHandler:t||null,flags:0}}(),ie=vg(0,null,null,1,0,null,null,null,null,null),we=za(null,ie,W,j,null,null,m,D,v,d,null);let Re,We;Eh(we);try{const xt=function _t(n,t,e,i,r,s){const d=e[1];e[22]=n;const v=Va(d,22,2,"#host",null),D=v.mergedAttrs=t.hostAttrs;null!==D&&(Mt(v,D,!0),null!==n&&(J(r,n,D),null!==v.classes&&Tf(r,n,v.classes),null!==v.styles&&Ol(r,n,v.styles)));const A=i.createRenderer(n,t),L=za(e,H_(t),null,t.onPush?32:16,e[22],v,i,A,s||null,null,null);return d.firstCreatePass&&(yn(Lt(v,e),d,t.type),Z_(d,v),Y_(v,e.length,1)),E(e,L),e[22]=L}(L,this.componentDef,we,m,D);if(L)if(i)J(D,L,["ng-version",jB.full]);else{const{attrs:st,classes:Bt}=function u1(n){const t=[],e=[];let i=1,r=2;for(;i<n.length;){let s=n[i];if("string"==typeof s)2===r?""!==s&&t.push(s,n[++i]):8===r&&e.push(s);else{if(!ea(r))break;r=s}i++}return{attrs:t,classes:e}}(this.componentDef.selectors[0]);st&&J(D,L,st),Bt&&Bt.length>0&&Tf(D,L,Bt.join(" "))}if(We=mu(ie,22),void 0!==e){const st=We.projection=[];for(let Bt=0;Bt<this.ngContentSelectors.length;Bt++){const Tn=e[Bt];st.push(null!=Tn?Array.from(Tn):null)}}Re=function yt(n,t,e,i,r){const s=e[1],d=function X_(n,t,e){const i=So();n.firstCreatePass&&(e.providersResolver&&e.providersResolver(e),Q_(n,i,t,ja(n,t,1,null),e));const r=Mo(t,n,i.directiveStart,i);Es(r,t);const s=wo(i,t);return s&&Es(s,t),r}(s,e,t);if(i.components.push(d),n[8]=d,null!==r)for(const v of r)v(d,t);if(t.contentQueries){const v=So();t.contentQueries(1,d,v.directiveStart)}const m=So();return!s.firstCreatePass||null===t.hostBindings&&null===t.hostAttrs||(Il(m.index),pl(e[1],m,0,m.directiveStart,m.directiveEnd,t),cp(t,d)),d}(xt,this.componentDef,we,W,[Rt]),kd(ie,we,null)}finally{md()}return new qB(this.componentType,Re,Ag(We,we),we,We)}}class qB extends class FB{}{constructor(t,e,i,r,s){super(),this.location=i,this._rootLView=r,this._tNode=s,this.instance=e,this.hostView=this.changeDetectorRef=new UB(r),this.componentType=t}get injector(){return new Pi(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}}class fM extends pp{constructor(t,e){super(),this._parent=e,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new U1(this);const i=Os(t);this._bootstrapComponents=Uc(i.bootstrap),this._r3Injector=ag(t,e,[{provide:pp,useValue:this},{provide:Ff,useValue:this.componentFactoryResolver}],xn(t),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this.get(t)}get(t,e=xr.THROW_IF_NOT_FOUND,i=Yn.Default){return t===xr||t===pp||t===m_?this:this._r3Injector.get(t,e,i)}destroy(){const t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(e=>e()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}}class $1 extends dM{constructor(t){super(),this.moduleType=t}create(t){return new fM(this.moduleType,t)}}class XB extends pp{constructor(t,e,i){super(),this.componentFactoryResolver=new U1(this),this.instance=null;const r=new ac([...t,{provide:pp,useValue:this},{provide:Ff,useValue:this.componentFactoryResolver}],e||__(),i,new Set(["environment"]));this.injector=r,r.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(t){this.injector.onDestroy(t)}}function Q0(n,t=null,e=null){return new XB(n,t,e).injector}function q1(n,t,e,i){return xM(Ot(),ls(),n,t,e,i)}function xM(n,t,e,i,r,s){const d=t+e;return yi(n,d,r)?function fr(n,t,e){return n[t]=e}(n,d+1,s?i.call(s,r):i(r)):function hy(n,t){const e=n[t];return e===Ai?void 0:e}(n,d+1)}function kg(n,t){const e=ji();let i;const r=n+22;e.firstCreatePass?(i=function m3(n,t){if(t)for(let e=t.length-1;e>=0;e--){const i=t[e];if(n===i.name)return i}}(t,e.pipeRegistry),e.data[r]=i,i.onDestroy&&(e.destroyHooks||(e.destroyHooks=[])).push(r,i.onDestroy)):i=e.data[r];const s=i.factory||(i.factory=Tl(i.type)),d=$s($);try{const m=ft(!1),v=s();return ft(m),function ku(n,t,e,i){e>=n.data.length&&(n.data[e]=null,n.blueprint[e]=null),t[e]=i}(e,Ot(),r,v),v}finally{$s(d)}}function Rg(n,t,e){const i=n+22,r=Ot(),s=Ec(r,i);return function py(n,t){return n[1].data[t].pure}(r,i)?xM(r,ls(),t,s.transform,e,s):s.transform(e)}function W1(n){return t=>{setTimeout(n,void 0,t)}}const Xt=class v3 extends Qt{constructor(t=!1){super(),this.__isAsync=t}emit(t){super.next(t)}subscribe(t,e,i){var r,s,d;let m=t,v=e||(()=>null),D=i;if(t&&"object"==typeof t){const L=t;m=null===(r=L.next)||void 0===r?void 0:r.bind(L),v=null===(s=L.error)||void 0===s?void 0:s.bind(L),D=null===(d=L.complete)||void 0===d?void 0:d.bind(L)}this.__isAsync&&(v=W1(v),m&&(m=W1(m)),D&&(D=W1(D)));const A=super.subscribe({next:m,error:v,complete:D});return t instanceof me&&t.add(A),A}};function x3(){return this._results[ri()]()}class Bf{constructor(t=!1){this._emitDistinctChangesOnly=t,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const e=ri(),i=Bf.prototype;i[e]||(i[e]=x3)}get changes(){return this._changes||(this._changes=new Xt)}get(t){return this._results[t]}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,e){return this._results.reduce(t,e)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(t,e){const i=this;i.dirty=!1;const r=ma(t);(this._changesDetected=!function mv(n,t,e){if(n.length!==t.length)return!1;for(let i=0;i<n.length;i++){let r=n[i],s=t[i];if(e&&(r=e(r),s=e(s)),s!==r)return!1}return!0}(i._results,r,e))&&(i._results=r,i.length=r.length,i.last=r[this.length-1],i.first=r[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let eo=(()=>{class n{}return n.__NG_ELEMENT_ID__=C3,n})();const w3=eo,S3=class extends w3{constructor(t,e,i){super(),this._declarationLView=t,this._declarationTContainer=e,this.elementRef=i}createEmbeddedView(t,e){const i=this._declarationTContainer.tViews,r=za(this._declarationLView,i,t,16,null,i.declTNode,null,null,null,null,e||null);r[17]=this._declarationLView[this._declarationTContainer.index];const d=this._declarationLView[19];return null!==d&&(r[19]=d.createEmbeddedView(i)),kd(i,r,t),new dy(r)}};function C3(){return K0(So(),Ot())}function K0(n,t){return 4&n.type?new S3(t,n,Ag(n,t)):null}let Vo=(()=>{class n{}return n.__NG_ELEMENT_ID__=T3,n})();function T3(){return IM(So(),Ot())}const D3=Vo,DM=class extends D3{constructor(t,e,i){super(),this._lContainer=t,this._hostTNode=e,this._hostLView=i}get element(){return Ag(this._hostTNode,this._hostLView)}get injector(){return new Pi(this._hostTNode,this._hostLView)}get parentInjector(){const t=Rn(this._hostTNode,this._hostLView);if(He(t)){const e=wt(t,this._hostLView),i=it(t);return new Pi(e[1].data[i+8],e)}return new Pi(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){const e=EM(this._lContainer);return null!==e&&e[t]||null}get length(){return this._lContainer.length-10}createEmbeddedView(t,e,i){let r,s;"number"==typeof i?r=i:null!=i&&(r=i.index,s=i.injector);const d=t.createEmbeddedView(e||{},s);return this.insert(d,r),d}createComponent(t,e,i,r,s){const d=t&&!function Rh(n){return"function"==typeof n}(t);let m;if(d)m=e;else{const L=e||{};m=L.index,i=L.injector,r=L.projectableNodes,s=L.environmentInjector||L.ngModuleRef}const v=d?t:new H1(Fr(t)),D=i||this.parentInjector;if(!s&&null==v.ngModule){const j=(d?D:this.parentInjector).get(Su,null);j&&(s=j)}const A=v.create(D,r,void 0,s);return this.insert(A.hostView,m),A}insert(t,e){const i=t._lView,r=i[1];if(function Sh(n){return ss(n[3])}(i)){const A=this.indexOf(t);if(-1!==A)this.detach(A);else{const L=i[3],j=new DM(L,L[6],L[3]);j.detach(j.indexOf(t))}}const s=this._adjustIndex(e),d=this._lContainer;!function Gv(n,t,e,i){const r=10+i,s=e.length;i>0&&(e[r-1][4]=t),i<s-10?(t[4]=e[r],gv(e,10+i,t)):(e.push(t),t[4]=null),t[3]=e;const d=t[17];null!==d&&e!==d&&function qv(n,t){const e=n[9];t[16]!==t[3][3][16]&&(n[2]=!0),null===e?n[9]=[t]:e.push(t)}(d,t);const m=t[19];null!==m&&m.insertView(n),t[2]|=64}(r,i,d,s);const m=a_(s,d),v=i[11],D=eg(v,d[7]);return null!==D&&function Uv(n,t,e,i,r,s){i[0]=r,i[6]=t,Cf(n,i,e,1,r,s)}(r,d[6],v,i,D,m),t.attachToViewContainerRef(),gv(X1(d),s,t),t}move(t,e){return this.insert(t,e)}indexOf(t){const e=EM(this._lContainer);return null!==e?e.indexOf(t):-1}remove(t){const e=this._adjustIndex(t,-1),i=r_(this._lContainer,e);i&&(Pc(X1(this._lContainer),e),Wv(i[1],i))}detach(t){const e=this._adjustIndex(t,-1),i=r_(this._lContainer,e);return i&&null!=Pc(X1(this._lContainer),e)?new dy(i):null}_adjustIndex(t,e=0){return null==t?this.length+e:t}};function EM(n){return n[8]}function X1(n){return n[8]||(n[8]=[])}function IM(n,t){let e;const i=t[n.index];if(ss(i))e=i;else{let r;if(8&n.type)r=to(i);else{const s=t[11];r=s.createComment("");const d=wo(n,t);cl(s,eg(s,d),r,function r1(n,t){return n.nextSibling(t)}(s,d),!1)}t[n.index]=e=l(i,t,r,n),E(t,e)}return new DM(e,n,t)}class Z1{constructor(t){this.queryList=t,this.matches=null}clone(){return new Z1(this.queryList)}setDirty(){this.queryList.setDirty()}}class Y1{constructor(t=[]){this.queries=t}createEmbeddedView(t){const e=t.queries;if(null!==e){const i=null!==t.contentQueries?t.contentQueries[0]:e.length,r=[];for(let s=0;s<i;s++){const d=e.getByIndex(s);r.push(this.queries[d.indexInDeclarationView].clone())}return new Y1(r)}return null}insertView(t){this.dirtyQueriesWithMatches(t)}detachView(t){this.dirtyQueriesWithMatches(t)}dirtyQueriesWithMatches(t){for(let e=0;e<this.queries.length;e++)null!==PM(t,e).matches&&this.queries[e].setDirty()}}class MM{constructor(t,e,i=null){this.predicate=t,this.flags=e,this.read=i}}class Q1{constructor(t=[]){this.queries=t}elementStart(t,e){for(let i=0;i<this.queries.length;i++)this.queries[i].elementStart(t,e)}elementEnd(t){for(let e=0;e<this.queries.length;e++)this.queries[e].elementEnd(t)}embeddedTView(t){let e=null;for(let i=0;i<this.length;i++){const r=null!==e?e.length:0,s=this.getByIndex(i).embeddedTView(t,r);s&&(s.indexInDeclarationView=i,null!==e?e.push(s):e=[s])}return null!==e?new Q1(e):null}template(t,e){for(let i=0;i<this.queries.length;i++)this.queries[i].template(t,e)}getByIndex(t){return this.queries[t]}get length(){return this.queries.length}track(t){this.queries.push(t)}}class K1{constructor(t,e=-1){this.metadata=t,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=e}elementStart(t,e){this.isApplyingToNode(e)&&this.matchTNode(t,e)}elementEnd(t){this._declarationNodeIndex===t.index&&(this._appliesToNextNode=!1)}template(t,e){this.elementStart(t,e)}embeddedTView(t,e){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,e),new K1(this.metadata)):null}isApplyingToNode(t){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const e=this._declarationNodeIndex;let i=t.parent;for(;null!==i&&8&i.type&&i.index!==e;)i=i.parent;return e===(null!==i?i.index:-1)}return this._appliesToNextNode}matchTNode(t,e){const i=this.metadata.predicate;if(Array.isArray(i))for(let r=0;r<i.length;r++){const s=i[r];this.matchTNodeWithReadOption(t,e,M3(e,s)),this.matchTNodeWithReadOption(t,e,io(e,t,s,!1,!1))}else i===eo?4&e.type&&this.matchTNodeWithReadOption(t,e,-1):this.matchTNodeWithReadOption(t,e,io(e,t,i,!1,!1))}matchTNodeWithReadOption(t,e,i){if(null!==i){const r=this.metadata.read;if(null!==r)if(r===Pn||r===Vo||r===eo&&4&e.type)this.addMatch(e.index,-2);else{const s=io(e,t,r,!1,!1);null!==s&&this.addMatch(e.index,s)}else this.addMatch(e.index,i)}}addMatch(t,e){null===this.matches?this.matches=[t,e]:this.matches.push(t,e)}}function M3(n,t){const e=n.localNames;if(null!==e)for(let i=0;i<e.length;i+=2)if(e[i]===t)return e[i+1];return null}function k3(n,t,e,i){return-1===e?function A3(n,t){return 11&n.type?Ag(n,t):4&n.type?K0(n,t):null}(t,n):-2===e?function R3(n,t,e){return e===Pn?Ag(t,n):e===eo?K0(t,n):e===Vo?IM(t,n):void 0}(n,t,i):Mo(n,n[1],e,t)}function AM(n,t,e,i){const r=t[19].queries[i];if(null===r.matches){const s=n.data,d=e.matches,m=[];for(let v=0;v<d.length;v+=2){const D=d[v];m.push(D<0?null:k3(t,s[D],d[v+1],e.metadata.read))}r.matches=m}return r.matches}function J1(n,t,e,i){const r=n.queries.getByIndex(e),s=r.matches;if(null!==s){const d=AM(n,t,r,e);for(let m=0;m<s.length;m+=2){const v=s[m];if(v>0)i.push(d[m/2]);else{const D=s[m+1],A=t[-v];for(let L=10;L<A.length;L++){const j=A[L];j[17]===j[3]&&J1(j[1],j,D,i)}if(null!==A[9]){const L=A[9];for(let j=0;j<L.length;j++){const W=L[j];J1(W[1],W,D,i)}}}}}return i}function zn(n){const t=Ot(),e=ji(),i=pd();kc(i+1);const r=PM(e,i);if(n.dirty&&xh(t)===(2==(2&r.metadata.flags))){if(null===r.matches)n.reset([]);else{const s=r.crossesNgTemplate?J1(e,t,i,[]):AM(e,t,r,i);n.reset(s,BB),n.notifyOnChanges()}return!0}return!1}function mr(n,t,e){const i=ji();i.firstCreatePass&&(RM(i,new MM(n,t,e),-1),2==(2&t)&&(i.staticViewQueries=!0)),kM(i,Ot(),t)}function Ur(n,t,e,i){const r=ji();if(r.firstCreatePass){const s=So();RM(r,new MM(t,e,i),s.index),function O3(n,t){const e=n.contentQueries||(n.contentQueries=[]);t!==(e.length?e[e.length-1]:-1)&&e.push(n.queries.length-1,t)}(r,n),2==(2&e)&&(r.staticContentQueries=!0)}kM(r,Ot(),e)}function Vn(){return function P3(n,t){return n[19].queries[t].queryList}(Ot(),pd())}function kM(n,t,e){const i=new Bf(4==(4&e));$_(n,t,i,i.destroy),null===t[19]&&(t[19]=new Y1),t[19].queries.push(new Z1(i))}function RM(n,t,e){null===n.queries&&(n.queries=new Q1),n.queries.track(new K1(t,e))}function PM(n,t){return n.queries.getByIndex(t)}function fy(n,t){return K0(n,t)}function ex(...n){}const tx=new bt("Application Initializer");let nx=(()=>{class n{constructor(e){this.appInits=e,this.resolve=ex,this.reject=ex,this.initialized=!1,this.done=!1,this.donePromise=new Promise((i,r)=>{this.resolve=i,this.reject=r})}runInitializers(){if(this.initialized)return;const e=[],i=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let r=0;r<this.appInits.length;r++){const s=this.appInits[r]();if(ny(s))e.push(s);else if(R1(s)){const d=new Promise((m,v)=>{s.subscribe({complete:m,error:v})});e.push(d)}}Promise.all(e).then(()=>{i()}).catch(r=>{this.reject(r)}),0===e.length&&i(),this.initialized=!0}}return n.\u0275fac=function(e){return new(e||n)(Be(tx,8))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const Fg=new bt("AppId",{providedIn:"root",factory:function KM(){return`${rC()}${rC()}${rC()}`}});function rC(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const JM=new bt("Platform Initializer"),ix=new bt("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),eA=new bt("appBootstrapListener"),Lu=new bt("AnimationModuleType");let ez=(()=>{class n{log(e){console.log(e)}warn(e){console.warn(e)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})();const Fl=new bt("LocaleId",{providedIn:"root",factory:()=>Mn(Fl,Yn.Optional|Yn.SkipSelf)||function tz(){return"undefined"!=typeof $localize&&$localize.locale||Ig}()});class iz{constructor(t,e){this.ngModuleFactory=t,this.componentFactories=e}}let oC=(()=>{class n{compileModuleSync(e){return new $1(e)}compileModuleAsync(e){return Promise.resolve(this.compileModuleSync(e))}compileModuleAndAllComponentsSync(e){const i=this.compileModuleSync(e),s=Uc(Os(e).declarations).reduce((d,m)=>{const v=Fr(m);return v&&d.push(new H1(v)),d},[]);return new iz(i,s)}compileModuleAndAllComponentsAsync(e){return Promise.resolve(this.compileModuleAndAllComponentsSync(e))}clearCache(){}clearCacheFor(e){}getModuleId(e){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const sz=(()=>Promise.resolve(0))();function sC(n){"undefined"==typeof Zone?sz.then(()=>{n&&n.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",n)}class oi{constructor({enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:e=!1,shouldCoalesceRunChangeDetection:i=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Xt(!1),this.onMicrotaskEmpty=new Xt(!1),this.onStable=new Xt(!1),this.onError=new Xt(!1),"undefined"==typeof Zone)throw new Dt(908,!1);Zone.assertZonePatched();const r=this;r._nesting=0,r._outer=r._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(r._inner=r._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(r._inner=r._inner.fork(Zone.longStackTraceZoneSpec)),r.shouldCoalesceEventChangeDetection=!i&&e,r.shouldCoalesceRunChangeDetection=i,r.lastRequestAnimationFrameId=-1,r.nativeRequestAnimationFrame=function az(){let n=Sr.requestAnimationFrame,t=Sr.cancelAnimationFrame;if("undefined"!=typeof Zone&&n&&t){const e=n[Zone.__symbol__("OriginalDelegate")];e&&(n=e);const i=t[Zone.__symbol__("OriginalDelegate")];i&&(t=i)}return{nativeRequestAnimationFrame:n,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function uz(n){const t=()=>{!function cz(n){n.isCheckStableRunning||-1!==n.lastRequestAnimationFrameId||(n.lastRequestAnimationFrameId=n.nativeRequestAnimationFrame.call(Sr,()=>{n.fakeTopEventTask||(n.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{n.lastRequestAnimationFrameId=-1,lC(n),n.isCheckStableRunning=!0,aC(n),n.isCheckStableRunning=!1},void 0,()=>{},()=>{})),n.fakeTopEventTask.invoke()}),lC(n))}(n)};n._inner=n._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(e,i,r,s,d,m)=>{try{return iA(n),e.invokeTask(r,s,d,m)}finally{(n.shouldCoalesceEventChangeDetection&&"eventTask"===s.type||n.shouldCoalesceRunChangeDetection)&&t(),rA(n)}},onInvoke:(e,i,r,s,d,m,v)=>{try{return iA(n),e.invoke(r,s,d,m,v)}finally{n.shouldCoalesceRunChangeDetection&&t(),rA(n)}},onHasTask:(e,i,r,s)=>{e.hasTask(r,s),i===r&&("microTask"==s.change?(n._hasPendingMicrotasks=s.microTask,lC(n),aC(n)):"macroTask"==s.change&&(n.hasPendingMacrotasks=s.macroTask))},onHandleError:(e,i,r,s)=>(e.handleError(r,s),n.runOutsideAngular(()=>n.onError.emit(s)),!1)})}(r)}static isInAngularZone(){return"undefined"!=typeof Zone&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!oi.isInAngularZone())throw new Dt(909,!1)}static assertNotInAngularZone(){if(oi.isInAngularZone())throw new Dt(909,!1)}run(t,e,i){return this._inner.run(t,e,i)}runTask(t,e,i,r){const s=this._inner,d=s.scheduleEventTask("NgZoneEvent: "+r,t,lz,ex,ex);try{return s.runTask(d,e,i)}finally{s.cancelTask(d)}}runGuarded(t,e,i){return this._inner.runGuarded(t,e,i)}runOutsideAngular(t){return this._outer.run(t)}}const lz={};function aC(n){if(0==n._nesting&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function lC(n){n.hasPendingMicrotasks=!!(n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&-1!==n.lastRequestAnimationFrameId)}function iA(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function rA(n){n._nesting--,aC(n)}class dz{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Xt,this.onMicrotaskEmpty=new Xt,this.onStable=new Xt,this.onError=new Xt}run(t,e,i){return t.apply(e,i)}runGuarded(t,e,i){return t.apply(e,i)}runOutsideAngular(t){return t()}runTask(t,e,i,r){return t.apply(e,i)}}const oA=new bt(""),rx=new bt("");let gy,cC=(()=>{class n{constructor(e,i,r){this._ngZone=e,this.registry=i,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,gy||(function hz(n){gy=n}(r),r.addToWindow(i)),this._watchAngularEvents(),e.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{oi.assertNotInAngularZone(),sC(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())sC(()=>{for(;0!==this._callbacks.length;){let e=this._callbacks.pop();clearTimeout(e.timeoutId),e.doneCb(this._didWork)}this._didWork=!1});else{let e=this.getPendingTasks();this._callbacks=this._callbacks.filter(i=>!i.updateCb||!i.updateCb(e)||(clearTimeout(i.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(e=>({source:e.source,creationLocation:e.creationLocation,data:e.data})):[]}addCallback(e,i,r){let s=-1;i&&i>0&&(s=setTimeout(()=>{this._callbacks=this._callbacks.filter(d=>d.timeoutId!==s),e(this._didWork,this.getPendingTasks())},i)),this._callbacks.push({doneCb:e,timeoutId:s,updateCb:r})}whenStable(e,i,r){if(r&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(e,i,r),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(e){this.registry.registerApplication(e,this)}unregisterApplication(e){this.registry.unregisterApplication(e)}findProviders(e,i,r){return[]}}return n.\u0275fac=function(e){return new(e||n)(Be(oi),Be(uC),Be(rx))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})(),uC=(()=>{class n{constructor(){this._applications=new Map}registerApplication(e,i){this._applications.set(e,i)}unregisterApplication(e){this._applications.delete(e)}unregisterAllApplications(){this._applications.clear()}getTestability(e){return this._applications.get(e)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(e,i=!0){var r;return null!==(r=null==gy?void 0:gy.findTestabilityInTree(this,e,i))&&void 0!==r?r:null}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})(),Fu=null;const sA=new bt("AllowMultipleToken"),dC=new bt("PlatformDestroyListeners");class aA{constructor(t,e){this.name=t,this.token=e}}function cA(n,t,e=[]){const i=`Platform: ${t}`,r=new bt(i);return(s=[])=>{let d=hC();if(!d||d.injector.get(sA,!1)){const m=[...e,...s,{provide:r,useValue:!0}];n?n(m):function mz(n){if(Fu&&!Fu.get(sA,!1))throw new Dt(400,!1);Fu=n;const t=n.get(dA);(function lA(n){const t=n.get(JM,null);t&&t.forEach(e=>e())})(n)}(function uA(n=[],t){return xr.create({name:t,providers:[{provide:ig,useValue:"platform"},{provide:dC,useValue:new Set([()=>Fu=null])},...n]})}(m,i))}return function bz(n){const t=hC();if(!t)throw new Dt(401,!1);return t}()}}function hC(){var n;return null!==(n=null==Fu?void 0:Fu.get(dA))&&void 0!==n?n:null}let dA=(()=>{class n{constructor(e){this._injector=e,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(e,i){const r=function _z(n,t){let e;return e="noop"===n?new dz:("zone.js"===n?void 0:n)||new oi(t),e}(null==i?void 0:i.ngZone,function hA(n){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!(!n||!n.ngZoneEventCoalescing)||!1,shouldCoalesceRunChangeDetection:!(!n||!n.ngZoneRunCoalescing)||!1}}(i)),s=[{provide:oi,useValue:r}];return r.run(()=>{const d=xr.create({providers:s,parent:this.injector,name:e.moduleType.name}),m=e.create(d),v=m.injector.get(va,null);if(!v)throw new Dt(402,!1);return r.runOutsideAngular(()=>{const D=r.onError.subscribe({next:A=>{v.handleError(A)}});m.onDestroy(()=>{ox(this._modules,m),D.unsubscribe()})}),function pA(n,t,e){try{const i=e();return ny(i)?i.catch(r=>{throw t.runOutsideAngular(()=>n.handleError(r)),r}):i}catch(i){throw t.runOutsideAngular(()=>n.handleError(i)),i}}(v,r,()=>{const D=m.injector.get(nx);return D.runInitializers(),D.donePromise.then(()=>(function zI(n){ur(n,"Expected localeId to be defined"),"string"==typeof n&&(BI=n.toLowerCase().replace(/_/g,"-"))}(m.injector.get(Fl,Ig)||Ig),this._moduleDoBootstrap(m),m))})})}bootstrapModule(e,i=[]){const r=fA({},i);return function pz(n,t,e){const i=new $1(e);return Promise.resolve(i)}(0,0,e).then(s=>this.bootstrapModuleFactory(s,r))}_moduleDoBootstrap(e){const i=e.injector.get(Ng);if(e._bootstrapComponents.length>0)e._bootstrapComponents.forEach(r=>i.bootstrap(r));else{if(!e.instance.ngDoBootstrap)throw new Dt(403,!1);e.instance.ngDoBootstrap(i)}this._modules.push(e)}onDestroy(e){this._destroyListeners.push(e)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Dt(404,!1);this._modules.slice().forEach(i=>i.destroy()),this._destroyListeners.forEach(i=>i());const e=this._injector.get(dC,null);e&&(e.forEach(i=>i()),e.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return n.\u0275fac=function(e){return new(e||n)(Be(xr))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})();function fA(n,t){return Array.isArray(t)?t.reduce(fA,n):Object.assign(Object.assign({},n),t)}let Ng=(()=>{class n{constructor(e,i,r){this._zone=e,this._injector=i,this._exceptionHandler=r,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this._destroyed=!1,this._destroyListeners=[],this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const s=new en(m=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{m.next(this._stable),m.complete()})}),d=new en(m=>{let v;this._zone.runOutsideAngular(()=>{v=this._zone.onStable.subscribe(()=>{oi.assertNotInAngularZone(),sC(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,m.next(!0))})})});const D=this._zone.onUnstable.subscribe(()=>{oi.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{m.next(!1)}))});return()=>{v.unsubscribe(),D.unsubscribe()}});this.isStable=rr(s,d.pipe(yc()))}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(e,i){const r=e instanceof hM;if(!this._injector.get(nx).done)throw!r&&function Og(n){const t=Fr(n)||is(n)||Lo(n);return null!==t&&t.standalone}(e),new Dt(405,false);let d;d=r?e:this._injector.get(Ff).resolveComponentFactory(e),this.componentTypes.push(d.componentType);const m=function fz(n){return n.isBoundToModule}(d)?void 0:this._injector.get(pp),D=d.create(xr.NULL,[],i||d.selector,m),A=D.location.nativeElement,L=D.injector.get(oA,null);return null==L||L.registerApplication(A),D.onDestroy(()=>{this.detachView(D.hostView),ox(this.components,D),null==L||L.unregisterApplication(A)}),this._loadComponent(D),D}tick(){if(this._runningTick)throw new Dt(101,!1);try{this._runningTick=!0;for(let e of this._views)e.detectChanges()}catch(e){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(e))}finally{this._runningTick=!1}}attachView(e){const i=e;this._views.push(i),i.attachToAppRef(this)}detachView(e){const i=e;ox(this._views,i),i.detachFromAppRef()}_loadComponent(e){this.attachView(e.hostView),this.tick(),this.components.push(e),this._injector.get(eA,[]).concat(this._bootstrapListeners).forEach(r=>r(e))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(e=>e()),this._views.slice().forEach(e=>e.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(e){return this._destroyListeners.push(e),()=>ox(this._destroyListeners,e)}destroy(){if(this._destroyed)throw new Dt(406,!1);const e=this._injector;e.destroy&&!e.destroyed&&e.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return n.\u0275fac=function(e){return new(e||n)(Be(oi),Be(xr),Be(va))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function ox(n,t){const e=n.indexOf(t);e>-1&&n.splice(e,1)}let gA=!0,Dr=(()=>{class n{}return n.__NG_ELEMENT_ID__=xz,n})();function xz(n){return function wz(n,t,e){if(gh(n)&&!e){const i=as(n.index,t);return new dy(i,i)}return 47&n.type?new dy(t[16],t):null}(So(),Ot(),16==(16&n))}class xA{constructor(){}supports(t){return Zi(t)}create(t){return new Iz(t)}}const Ez=(n,t)=>t;class Iz{constructor(t){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||Ez}forEachItem(t){let e;for(e=this._itHead;null!==e;e=e._next)t(e)}forEachOperation(t){let e=this._itHead,i=this._removalsHead,r=0,s=null;for(;e||i;){const d=!i||e&&e.currentIndex<SA(i,r,s)?e:i,m=SA(d,r,s),v=d.currentIndex;if(d===i)r--,i=i._nextRemoved;else if(e=e._next,null==d.previousIndex)r++;else{s||(s=[]);const D=m-r,A=v-r;if(D!=A){for(let j=0;j<D;j++){const W=j<s.length?s[j]:s[j]=0,ie=W+j;A<=ie&&ie<D&&(s[j]=W+1)}s[d.previousIndex]=A-D}}m!==v&&t(d,m,v)}}forEachPreviousItem(t){let e;for(e=this._previousItHead;null!==e;e=e._nextPrevious)t(e)}forEachAddedItem(t){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)}forEachMovedItem(t){let e;for(e=this._movesHead;null!==e;e=e._nextMoved)t(e)}forEachRemovedItem(t){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)}forEachIdentityChange(t){let e;for(e=this._identityChangesHead;null!==e;e=e._nextIdentityChange)t(e)}diff(t){if(null==t&&(t=[]),!Zi(t))throw new Dt(900,!1);return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let r,s,d,e=this._itHead,i=!1;if(Array.isArray(t)){this.length=t.length;for(let m=0;m<this.length;m++)s=t[m],d=this._trackByFn(m,s),null!==e&&Object.is(e.trackById,d)?(i&&(e=this._verifyReinsertion(e,s,d,m)),Object.is(e.item,s)||this._addIdentityChange(e,s)):(e=this._mismatch(e,s,d,m),i=!0),e=e._next}else r=0,function Rr(n,t){if(Array.isArray(n))for(let e=0;e<n.length;e++)t(n[e]);else{const e=n[ri()]();let i;for(;!(i=e.next()).done;)t(i.value)}}(t,m=>{d=this._trackByFn(r,m),null!==e&&Object.is(e.trackById,d)?(i&&(e=this._verifyReinsertion(e,m,d,r)),Object.is(e.item,m)||this._addIdentityChange(e,m)):(e=this._mismatch(e,m,d,r),i=!0),e=e._next,r++}),this.length=r;return this._truncate(e),this.collection=t,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let t;for(t=this._previousItHead=this._itHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;null!==t;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;null!==t;t=t._nextMoved)t.previousIndex=t.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(t,e,i,r){let s;return null===t?s=this._itTail:(s=t._prev,this._remove(t)),null!==(t=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null))?(Object.is(t.item,e)||this._addIdentityChange(t,e),this._reinsertAfter(t,s,r)):null!==(t=null===this._linkedRecords?null:this._linkedRecords.get(i,r))?(Object.is(t.item,e)||this._addIdentityChange(t,e),this._moveAfter(t,s,r)):t=this._addAfter(new Mz(e,i),s,r),t}_verifyReinsertion(t,e,i,r){let s=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null);return null!==s?t=this._reinsertAfter(s,t._prev,r):t.currentIndex!=r&&(t.currentIndex=r,this._addToMoves(t,r)),t}_truncate(t){for(;null!==t;){const e=t._next;this._addToRemovals(this._unlink(t)),t=e}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(t,e,i){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(t);const r=t._prevRemoved,s=t._nextRemoved;return null===r?this._removalsHead=s:r._nextRemoved=s,null===s?this._removalsTail=r:s._prevRemoved=r,this._insertAfter(t,e,i),this._addToMoves(t,i),t}_moveAfter(t,e,i){return this._unlink(t),this._insertAfter(t,e,i),this._addToMoves(t,i),t}_addAfter(t,e,i){return this._insertAfter(t,e,i),this._additionsTail=null===this._additionsTail?this._additionsHead=t:this._additionsTail._nextAdded=t,t}_insertAfter(t,e,i){const r=null===e?this._itHead:e._next;return t._next=r,t._prev=e,null===r?this._itTail=t:r._prev=t,null===e?this._itHead=t:e._next=t,null===this._linkedRecords&&(this._linkedRecords=new wA),this._linkedRecords.put(t),t.currentIndex=i,t}_remove(t){return this._addToRemovals(this._unlink(t))}_unlink(t){null!==this._linkedRecords&&this._linkedRecords.remove(t);const e=t._prev,i=t._next;return null===e?this._itHead=i:e._next=i,null===i?this._itTail=e:i._prev=e,t}_addToMoves(t,e){return t.previousIndex===e||(this._movesTail=null===this._movesTail?this._movesHead=t:this._movesTail._nextMoved=t),t}_addToRemovals(t){return null===this._unlinkedRecords&&(this._unlinkedRecords=new wA),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}_addIdentityChange(t,e){return t.item=e,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=t:this._identityChangesTail._nextIdentityChange=t,t}}class Mz{constructor(t,e){this.item=t,this.trackById=e,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class Az{constructor(){this._head=null,this._tail=null}add(t){null===this._head?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}get(t,e){let i;for(i=this._head;null!==i;i=i._nextDup)if((null===e||e<=i.currentIndex)&&Object.is(i.trackById,t))return i;return null}remove(t){const e=t._prevDup,i=t._nextDup;return null===e?this._head=i:e._nextDup=i,null===i?this._tail=e:i._prevDup=e,null===this._head}}class wA{constructor(){this.map=new Map}put(t){const e=t.trackById;let i=this.map.get(e);i||(i=new Az,this.map.set(e,i)),i.add(t)}get(t,e){const r=this.map.get(t);return r?r.get(t,e):null}remove(t){const e=t.trackById;return this.map.get(e).remove(t)&&this.map.delete(e),t}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function SA(n,t,e){const i=n.previousIndex;if(null===i)return i;let r=0;return e&&i<e.length&&(r=e[i]),i+t+r}class CA{constructor(){}supports(t){return t instanceof Map||Tr(t)}create(){return new kz}}class kz{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(t){let e;for(e=this._mapHead;null!==e;e=e._next)t(e)}forEachPreviousItem(t){let e;for(e=this._previousMapHead;null!==e;e=e._nextPrevious)t(e)}forEachChangedItem(t){let e;for(e=this._changesHead;null!==e;e=e._nextChanged)t(e)}forEachAddedItem(t){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)}forEachRemovedItem(t){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)}diff(t){if(t){if(!(t instanceof Map||Tr(t)))throw new Dt(900,!1)}else t=new Map;return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let e=this._mapHead;if(this._appendAfter=null,this._forEach(t,(i,r)=>{if(e&&e.key===r)this._maybeAddToChanges(e,i),this._appendAfter=e,e=e._next;else{const s=this._getOrCreateRecordForKey(r,i);e=this._insertBeforeOrAppend(e,s)}}),e){e._prev&&(e._prev._next=null),this._removalsHead=e;for(let i=e;null!==i;i=i._nextRemoved)i===this._mapHead&&(this._mapHead=null),this._records.delete(i.key),i._nextRemoved=i._next,i.previousValue=i.currentValue,i.currentValue=null,i._prev=null,i._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(t,e){if(t){const i=t._prev;return e._next=t,e._prev=i,t._prev=e,i&&(i._next=e),t===this._mapHead&&(this._mapHead=e),this._appendAfter=t,t}return this._appendAfter?(this._appendAfter._next=e,e._prev=this._appendAfter):this._mapHead=e,this._appendAfter=e,null}_getOrCreateRecordForKey(t,e){if(this._records.has(t)){const r=this._records.get(t);this._maybeAddToChanges(r,e);const s=r._prev,d=r._next;return s&&(s._next=d),d&&(d._prev=s),r._next=null,r._prev=null,r}const i=new Rz(t);return this._records.set(t,i),i.currentValue=e,this._addToAdditions(i),i}_reset(){if(this.isDirty){let t;for(this._previousMapHead=this._mapHead,t=this._previousMapHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._changesHead;null!==t;t=t._nextChanged)t.previousValue=t.currentValue;for(t=this._additionsHead;null!=t;t=t._nextAdded)t.previousValue=t.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(t,e){Object.is(e,t.currentValue)||(t.previousValue=t.currentValue,t.currentValue=e,this._addToChanges(t))}_addToAdditions(t){null===this._additionsHead?this._additionsHead=this._additionsTail=t:(this._additionsTail._nextAdded=t,this._additionsTail=t)}_addToChanges(t){null===this._changesHead?this._changesHead=this._changesTail=t:(this._changesTail._nextChanged=t,this._changesTail=t)}_forEach(t,e){t instanceof Map?t.forEach(e):Object.keys(t).forEach(i=>e(t[i],i))}}class Rz{constructor(t){this.key=t,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function TA(){return new Nu([new xA])}let Nu=(()=>{class n{constructor(e){this.factories=e}static create(e,i){if(null!=i){const r=i.factories.slice();e=e.concat(r)}return new n(e)}static extend(e){return{provide:n,useFactory:i=>n.create(e,i||TA()),deps:[[n,new Ts,new Cs]]}}find(e){const i=this.factories.find(r=>r.supports(e));if(null!=i)return i;throw new Dt(901,!1)}}return n.\u0275prov=Ut({token:n,providedIn:"root",factory:TA}),n})();function DA(){return new by([new CA])}let by=(()=>{class n{constructor(e){this.factories=e}static create(e,i){if(i){const r=i.factories.slice();e=e.concat(r)}return new n(e)}static extend(e){return{provide:n,useFactory:i=>n.create(e,i||DA()),deps:[[n,new Ts,new Cs]]}}find(e){const i=this.factories.find(r=>r.supports(e));if(i)return i;throw new Dt(901,!1)}}return n.\u0275prov=Ut({token:n,providedIn:"root",factory:DA}),n})();const Lz=cA(null,"core",[]);let Fz=(()=>{class n{constructor(e){}}return n.\u0275fac=function(e){return new(e||n)(Be(Ng))},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({}),n})();function Vd(n){return"boolean"==typeof n?n:null!=n&&"false"!==n}let lx=null;function Bu(){return lx}const si=new bt("DocumentToken");let cx=(()=>{class n{historyGo(e){throw new Error("Not implemented")}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ut({token:n,factory:function(){return function Vz(){return Be(EA)}()},providedIn:"platform"}),n})();const jz=new bt("Location Initialized");let EA=(()=>{class n extends cx{constructor(e){super(),this._doc=e,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Bu().getBaseHref(this._doc)}onPopState(e){const i=Bu().getGlobalEventTarget(this._doc,"window");return i.addEventListener("popstate",e,!1),()=>i.removeEventListener("popstate",e)}onHashChange(e){const i=Bu().getGlobalEventTarget(this._doc,"window");return i.addEventListener("hashchange",e,!1),()=>i.removeEventListener("hashchange",e)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(e){this.location.pathname=e}pushState(e,i,r){IA()?this._history.pushState(e,i,r):this.location.hash=r}replaceState(e,i,r){IA()?this._history.replaceState(e,i,r):this.location.hash=r}forward(){this._history.forward()}back(){this._history.back()}historyGo(e=0){this._history.go(e)}getState(){return this._history.state}}return n.\u0275fac=function(e){return new(e||n)(Be(si))},n.\u0275prov=Ut({token:n,factory:function(){return function Uz(){return new EA(Be(si))}()},providedIn:"platform"}),n})();function IA(){return!!window.history.pushState}function bC(n,t){if(0==n.length)return t;if(0==t.length)return n;let e=0;return n.endsWith("/")&&e++,t.startsWith("/")&&e++,2==e?n+t.substring(1):1==e?n+t:n+"/"+t}function MA(n){const t=n.match(/#|\?|$/),e=t&&t.index||n.length;return n.slice(0,e-("/"===n[e-1]?1:0))+n.slice(e)}function jd(n){return n&&"?"!==n[0]?"?"+n:n}let Vf=(()=>{class n{historyGo(e){throw new Error("Not implemented")}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ut({token:n,factory:function(){return function Hz(){const n=Be(si).location;return new kA(Be(cx),n&&n.origin||"")}()},providedIn:"root"}),n})();const AA=new bt("appBaseHref");let kA=(()=>{class n extends Vf{constructor(e,i){if(super(),this._platformLocation=e,this._removeListenerFns=[],null==i&&(i=this._platformLocation.getBaseHrefFromDOM()),null==i)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=i}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}prepareExternalUrl(e){return bC(this._baseHref,e)}path(e=!1){const i=this._platformLocation.pathname+jd(this._platformLocation.search),r=this._platformLocation.hash;return r&&e?`${i}${r}`:i}pushState(e,i,r,s){const d=this.prepareExternalUrl(r+jd(s));this._platformLocation.pushState(e,i,d)}replaceState(e,i,r,s){const d=this.prepareExternalUrl(r+jd(s));this._platformLocation.replaceState(e,i,d)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){var i,r;null===(r=(i=this._platformLocation).historyGo)||void 0===r||r.call(i,e)}}return n.\u0275fac=function(e){return new(e||n)(Be(cx),Be(AA,8))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})(),$z=(()=>{class n extends Vf{constructor(e,i){super(),this._platformLocation=e,this._baseHref="",this._removeListenerFns=[],null!=i&&(this._baseHref=i)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}path(e=!1){let i=this._platformLocation.hash;return null==i&&(i="#"),i.length>0?i.substring(1):i}prepareExternalUrl(e){const i=bC(this._baseHref,e);return i.length>0?"#"+i:i}pushState(e,i,r,s){let d=this.prepareExternalUrl(r+jd(s));0==d.length&&(d=this._platformLocation.pathname),this._platformLocation.pushState(e,i,d)}replaceState(e,i,r,s){let d=this.prepareExternalUrl(r+jd(s));0==d.length&&(d=this._platformLocation.pathname),this._platformLocation.replaceState(e,i,d)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){var i,r;null===(r=(i=this._platformLocation).historyGo)||void 0===r||r.call(i,e)}}return n.\u0275fac=function(e){return new(e||n)(Be(cx),Be(AA,8))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})(),ux=(()=>{class n{constructor(e){this._subject=new Xt,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=e;const i=this._locationStrategy.getBaseHref();this._baseHref=MA(RA(i)),this._locationStrategy.onPopState(r=>{this._subject.emit({url:this.path(!0),pop:!0,state:r.state,type:r.type})})}ngOnDestroy(){var e;null===(e=this._urlChangeSubscription)||void 0===e||e.unsubscribe(),this._urlChangeListeners=[]}path(e=!1){return this.normalize(this._locationStrategy.path(e))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(e,i=""){return this.path()==this.normalize(e+jd(i))}normalize(e){return n.stripTrailingSlash(function qz(n,t){return n&&t.startsWith(n)?t.substring(n.length):t}(this._baseHref,RA(e)))}prepareExternalUrl(e){return e&&"/"!==e[0]&&(e="/"+e),this._locationStrategy.prepareExternalUrl(e)}go(e,i="",r=null){this._locationStrategy.pushState(r,"",e,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+jd(i)),r)}replaceState(e,i="",r=null){this._locationStrategy.replaceState(r,"",e,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+jd(i)),r)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(e=0){var i,r;null===(r=(i=this._locationStrategy).historyGo)||void 0===r||r.call(i,e)}onUrlChange(e){return this._urlChangeListeners.push(e),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(i=>{this._notifyUrlChangeListeners(i.url,i.state)})),()=>{var i;const r=this._urlChangeListeners.indexOf(e);this._urlChangeListeners.splice(r,1),0===this._urlChangeListeners.length&&(null===(i=this._urlChangeSubscription)||void 0===i||i.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(e="",i){this._urlChangeListeners.forEach(r=>r(e,i))}subscribe(e,i,r){return this._subject.subscribe({next:e,error:i,complete:r})}}return n.normalizeQueryParams=jd,n.joinWithSlash=bC,n.stripTrailingSlash=MA,n.\u0275fac=function(e){return new(e||n)(Be(Vf))},n.\u0275prov=Ut({token:n,factory:function(){return function Gz(){return new ux(Be(Vf))}()},providedIn:"root"}),n})();function RA(n){return n.replace(/\/index.html$/,"")}var Yo=(()=>((Yo=Yo||{})[Yo.Format=0]="Format",Yo[Yo.Standalone=1]="Standalone",Yo))(),sr=(()=>((sr=sr||{})[sr.Narrow=0]="Narrow",sr[sr.Abbreviated=1]="Abbreviated",sr[sr.Wide=2]="Wide",sr[sr.Short=3]="Short",sr))(),Po=(()=>((Po=Po||{})[Po.Short=0]="Short",Po[Po.Medium=1]="Medium",Po[Po.Long=2]="Long",Po[Po.Full=3]="Full",Po))(),xi=(()=>((xi=xi||{})[xi.Decimal=0]="Decimal",xi[xi.Group=1]="Group",xi[xi.List=2]="List",xi[xi.PercentSign=3]="PercentSign",xi[xi.PlusSign=4]="PlusSign",xi[xi.MinusSign=5]="MinusSign",xi[xi.Exponential=6]="Exponential",xi[xi.SuperscriptingExponent=7]="SuperscriptingExponent",xi[xi.PerMille=8]="PerMille",xi[xi.Infinity=9]="Infinity",xi[xi.NaN=10]="NaN",xi[xi.TimeSeparator=11]="TimeSeparator",xi[xi.CurrencyDecimal=12]="CurrencyDecimal",xi[xi.CurrencyGroup=13]="CurrencyGroup",xi))();function dx(n,t){return hc(Ha(n)[En.DateFormat],t)}function hx(n,t){return hc(Ha(n)[En.TimeFormat],t)}function px(n,t){return hc(Ha(n)[En.DateTimeFormat],t)}function dc(n,t){const e=Ha(n),i=e[En.NumberSymbols][t];if(void 0===i){if(t===xi.CurrencyDecimal)return e[En.NumberSymbols][xi.Decimal];if(t===xi.CurrencyGroup)return e[En.NumberSymbols][xi.Group]}return i}function OA(n){if(!n[En.ExtraData])throw new Error(`Missing extra locale data for the locale "${n[En.LocaleId]}". Use "registerLocaleData" to load new data. See the "I18n guide" on angular.io to know more.`)}function hc(n,t){for(let e=t;e>-1;e--)if(void 0!==n[e])return n[e];throw new Error("Locale data API: locale data undefined")}function yC(n){const[t,e]=n.split(":");return{hours:+t,minutes:+e}}const oV=/^(\d{4,})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,_y={},sV=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;var As=(()=>((As=As||{})[As.Short=0]="Short",As[As.ShortGMT=1]="ShortGMT",As[As.Long=2]="Long",As[As.Extended=3]="Extended",As))(),Di=(()=>((Di=Di||{})[Di.FullYear=0]="FullYear",Di[Di.Month=1]="Month",Di[Di.Date=2]="Date",Di[Di.Hours=3]="Hours",Di[Di.Minutes=4]="Minutes",Di[Di.Seconds=5]="Seconds",Di[Di.FractionalSeconds=6]="FractionalSeconds",Di[Di.Day=7]="Day",Di))(),Vi=(()=>((Vi=Vi||{})[Vi.DayPeriods=0]="DayPeriods",Vi[Vi.Days=1]="Days",Vi[Vi.Months=2]="Months",Vi[Vi.Eras=3]="Eras",Vi))();function aV(n,t,e,i){let r=function gV(n){if(NA(n))return n;if("number"==typeof n&&!isNaN(n))return new Date(n);if("string"==typeof n){if(n=n.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(n)){const[r,s=1,d=1]=n.split("-").map(m=>+m);return fx(r,s-1,d)}const e=parseFloat(n);if(!isNaN(n-e))return new Date(e);let i;if(i=n.match(oV))return function bV(n){const t=new Date(0);let e=0,i=0;const r=n[8]?t.setUTCFullYear:t.setFullYear,s=n[8]?t.setUTCHours:t.setHours;n[9]&&(e=Number(n[9]+n[10]),i=Number(n[9]+n[11])),r.call(t,Number(n[1]),Number(n[2])-1,Number(n[3]));const d=Number(n[4]||0)-e,m=Number(n[5]||0)-i,v=Number(n[6]||0),D=Math.floor(1e3*parseFloat("0."+(n[7]||0)));return s.call(t,d,m,v,D),t}(i)}const t=new Date(n);if(!NA(t))throw new Error(`Unable to convert "${n}" into a date`);return t}(n);t=Ud(e,t)||t;let m,d=[];for(;t;){if(m=sV.exec(t),!m){d.push(t);break}{d=d.concat(m.slice(1));const A=d.pop();if(!A)break;t=A}}let v=r.getTimezoneOffset();i&&(v=FA(i,v),r=function mV(n,t,e){const i=e?-1:1,r=n.getTimezoneOffset();return function fV(n,t){return(n=new Date(n.getTime())).setMinutes(n.getMinutes()+t),n}(n,i*(FA(t,r)-r))}(r,i,!0));let D="";return d.forEach(A=>{const L=function pV(n){if(xC[n])return xC[n];let t;switch(n){case"G":case"GG":case"GGG":t=lo(Vi.Eras,sr.Abbreviated);break;case"GGGG":t=lo(Vi.Eras,sr.Wide);break;case"GGGGG":t=lo(Vi.Eras,sr.Narrow);break;case"y":t=ms(Di.FullYear,1,0,!1,!0);break;case"yy":t=ms(Di.FullYear,2,0,!0,!0);break;case"yyy":t=ms(Di.FullYear,3,0,!1,!0);break;case"yyyy":t=ms(Di.FullYear,4,0,!1,!0);break;case"Y":t=_x(1);break;case"YY":t=_x(2,!0);break;case"YYY":t=_x(3);break;case"YYYY":t=_x(4);break;case"M":case"L":t=ms(Di.Month,1,1);break;case"MM":case"LL":t=ms(Di.Month,2,1);break;case"MMM":t=lo(Vi.Months,sr.Abbreviated);break;case"MMMM":t=lo(Vi.Months,sr.Wide);break;case"MMMMM":t=lo(Vi.Months,sr.Narrow);break;case"LLL":t=lo(Vi.Months,sr.Abbreviated,Yo.Standalone);break;case"LLLL":t=lo(Vi.Months,sr.Wide,Yo.Standalone);break;case"LLLLL":t=lo(Vi.Months,sr.Narrow,Yo.Standalone);break;case"w":t=vC(1);break;case"ww":t=vC(2);break;case"W":t=vC(1,!0);break;case"d":t=ms(Di.Date,1);break;case"dd":t=ms(Di.Date,2);break;case"c":case"cc":t=ms(Di.Day,1);break;case"ccc":t=lo(Vi.Days,sr.Abbreviated,Yo.Standalone);break;case"cccc":t=lo(Vi.Days,sr.Wide,Yo.Standalone);break;case"ccccc":t=lo(Vi.Days,sr.Narrow,Yo.Standalone);break;case"cccccc":t=lo(Vi.Days,sr.Short,Yo.Standalone);break;case"E":case"EE":case"EEE":t=lo(Vi.Days,sr.Abbreviated);break;case"EEEE":t=lo(Vi.Days,sr.Wide);break;case"EEEEE":t=lo(Vi.Days,sr.Narrow);break;case"EEEEEE":t=lo(Vi.Days,sr.Short);break;case"a":case"aa":case"aaa":t=lo(Vi.DayPeriods,sr.Abbreviated);break;case"aaaa":t=lo(Vi.DayPeriods,sr.Wide);break;case"aaaaa":t=lo(Vi.DayPeriods,sr.Narrow);break;case"b":case"bb":case"bbb":t=lo(Vi.DayPeriods,sr.Abbreviated,Yo.Standalone,!0);break;case"bbbb":t=lo(Vi.DayPeriods,sr.Wide,Yo.Standalone,!0);break;case"bbbbb":t=lo(Vi.DayPeriods,sr.Narrow,Yo.Standalone,!0);break;case"B":case"BB":case"BBB":t=lo(Vi.DayPeriods,sr.Abbreviated,Yo.Format,!0);break;case"BBBB":t=lo(Vi.DayPeriods,sr.Wide,Yo.Format,!0);break;case"BBBBB":t=lo(Vi.DayPeriods,sr.Narrow,Yo.Format,!0);break;case"h":t=ms(Di.Hours,1,-12);break;case"hh":t=ms(Di.Hours,2,-12);break;case"H":t=ms(Di.Hours,1);break;case"HH":t=ms(Di.Hours,2);break;case"m":t=ms(Di.Minutes,1);break;case"mm":t=ms(Di.Minutes,2);break;case"s":t=ms(Di.Seconds,1);break;case"ss":t=ms(Di.Seconds,2);break;case"S":t=ms(Di.FractionalSeconds,1);break;case"SS":t=ms(Di.FractionalSeconds,2);break;case"SSS":t=ms(Di.FractionalSeconds,3);break;case"Z":case"ZZ":case"ZZZ":t=gx(As.Short);break;case"ZZZZZ":t=gx(As.Extended);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":t=gx(As.ShortGMT);break;case"OOOO":case"ZZZZ":case"zzzz":t=gx(As.Long);break;default:return null}return xC[n]=t,t}(A);D+=L?L(r,e,v):"''"===A?"'":A.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),D}function fx(n,t,e){const i=new Date(0);return i.setFullYear(n,t,e),i.setHours(0,0,0),i}function Ud(n,t){const e=function Wz(n){return Ha(n)[En.LocaleId]}(n);if(_y[e]=_y[e]||{},_y[e][t])return _y[e][t];let i="";switch(t){case"shortDate":i=dx(n,Po.Short);break;case"mediumDate":i=dx(n,Po.Medium);break;case"longDate":i=dx(n,Po.Long);break;case"fullDate":i=dx(n,Po.Full);break;case"shortTime":i=hx(n,Po.Short);break;case"mediumTime":i=hx(n,Po.Medium);break;case"longTime":i=hx(n,Po.Long);break;case"fullTime":i=hx(n,Po.Full);break;case"short":const r=Ud(n,"shortTime"),s=Ud(n,"shortDate");i=mx(px(n,Po.Short),[r,s]);break;case"medium":const d=Ud(n,"mediumTime"),m=Ud(n,"mediumDate");i=mx(px(n,Po.Medium),[d,m]);break;case"long":const v=Ud(n,"longTime"),D=Ud(n,"longDate");i=mx(px(n,Po.Long),[v,D]);break;case"full":const A=Ud(n,"fullTime"),L=Ud(n,"fullDate");i=mx(px(n,Po.Full),[A,L])}return i&&(_y[e][t]=i),i}function mx(n,t){return t&&(n=n.replace(/\{([^}]+)}/g,function(e,i){return null!=t&&i in t?t[i]:e})),n}function Kc(n,t,e="-",i,r){let s="";(n<0||r&&n<=0)&&(r?n=1-n:(n=-n,s=e));let d=String(n);for(;d.length<t;)d="0"+d;return i&&(d=d.slice(d.length-t)),s+d}function ms(n,t,e=0,i=!1,r=!1){return function(s,d){let m=function cV(n,t){switch(n){case Di.FullYear:return t.getFullYear();case Di.Month:return t.getMonth();case Di.Date:return t.getDate();case Di.Hours:return t.getHours();case Di.Minutes:return t.getMinutes();case Di.Seconds:return t.getSeconds();case Di.FractionalSeconds:return t.getMilliseconds();case Di.Day:return t.getDay();default:throw new Error(`Unknown DateType value "${n}".`)}}(n,s);if((e>0||m>-e)&&(m+=e),n===Di.Hours)0===m&&-12===e&&(m=12);else if(n===Di.FractionalSeconds)return function lV(n,t){return Kc(n,3).substring(0,t)}(m,t);const v=dc(d,xi.MinusSign);return Kc(m,t,v,i,r)}}function lo(n,t,e=Yo.Format,i=!1){return function(r,s){return function uV(n,t,e,i,r,s){switch(e){case Vi.Months:return function Yz(n,t,e){const i=Ha(n),s=hc([i[En.MonthsFormat],i[En.MonthsStandalone]],t);return hc(s,e)}(t,r,i)[n.getMonth()];case Vi.Days:return function Zz(n,t,e){const i=Ha(n),s=hc([i[En.DaysFormat],i[En.DaysStandalone]],t);return hc(s,e)}(t,r,i)[n.getDay()];case Vi.DayPeriods:const d=n.getHours(),m=n.getMinutes();if(s){const D=function eV(n){const t=Ha(n);return OA(t),(t[En.ExtraData][2]||[]).map(i=>"string"==typeof i?yC(i):[yC(i[0]),yC(i[1])])}(t),A=function tV(n,t,e){const i=Ha(n);OA(i);const s=hc([i[En.ExtraData][0],i[En.ExtraData][1]],t)||[];return hc(s,e)||[]}(t,r,i),L=D.findIndex(j=>{if(Array.isArray(j)){const[W,ie]=j,we=d>=W.hours&&m>=W.minutes,Re=d<ie.hours||d===ie.hours&&m<ie.minutes;if(W.hours<ie.hours){if(we&&Re)return!0}else if(we||Re)return!0}else if(j.hours===d&&j.minutes===m)return!0;return!1});if(-1!==L)return A[L]}return function Xz(n,t,e){const i=Ha(n),s=hc([i[En.DayPeriodsFormat],i[En.DayPeriodsStandalone]],t);return hc(s,e)}(t,r,i)[d<12?0:1];case Vi.Eras:return function Qz(n,t){return hc(Ha(n)[En.Eras],t)}(t,i)[n.getFullYear()<=0?0:1];default:throw new Error(`unexpected translation type ${e}`)}}(r,s,n,t,e,i)}}function gx(n){return function(t,e,i){const r=-1*i,s=dc(e,xi.MinusSign),d=r>0?Math.floor(r/60):Math.ceil(r/60);switch(n){case As.Short:return(r>=0?"+":"")+Kc(d,2,s)+Kc(Math.abs(r%60),2,s);case As.ShortGMT:return"GMT"+(r>=0?"+":"")+Kc(d,1,s);case As.Long:return"GMT"+(r>=0?"+":"")+Kc(d,2,s)+":"+Kc(Math.abs(r%60),2,s);case As.Extended:return 0===i?"Z":(r>=0?"+":"")+Kc(d,2,s)+":"+Kc(Math.abs(r%60),2,s);default:throw new Error(`Unknown zone width "${n}"`)}}}function LA(n){return fx(n.getFullYear(),n.getMonth(),n.getDate()+(4-n.getDay()))}function vC(n,t=!1){return function(e,i){let r;if(t){const s=new Date(e.getFullYear(),e.getMonth(),1).getDay()-1,d=e.getDate();r=1+Math.floor((d+s)/7)}else{const s=LA(e),d=function hV(n){const t=fx(n,0,1).getDay();return fx(n,0,1+(t<=4?4:11)-t)}(s.getFullYear()),m=s.getTime()-d.getTime();r=1+Math.round(m/6048e5)}return Kc(r,n,dc(i,xi.MinusSign))}}function _x(n,t=!1){return function(e,i){return Kc(LA(e).getFullYear(),n,dc(i,xi.MinusSign),t)}}const xC={};function FA(n,t){n=n.replace(/:/g,"");const e=Date.parse("Jan 01, 1970 00:00:00 "+n)/6e4;return isNaN(e)?t:e}function NA(n){return n instanceof Date&&!isNaN(n.valueOf())}function jA(n,t){t=encodeURIComponent(t);for(const e of n.split(";")){const i=e.indexOf("="),[r,s]=-1==i?[e,""]:[e.slice(0,i),e.slice(i+1)];if(r.trim()===t)return decodeURIComponent(s)}return null}let Bg=(()=>{class n{constructor(e,i,r,s){this._iterableDiffers=e,this._keyValueDiffers=i,this._ngEl=r,this._renderer=s,this._iterableDiffer=null,this._keyValueDiffer=null,this._initialClasses=[],this._rawClass=null}set klass(e){this._removeClasses(this._initialClasses),this._initialClasses="string"==typeof e?e.split(/\s+/):[],this._applyClasses(this._initialClasses),this._applyClasses(this._rawClass)}set ngClass(e){this._removeClasses(this._rawClass),this._applyClasses(this._initialClasses),this._iterableDiffer=null,this._keyValueDiffer=null,this._rawClass="string"==typeof e?e.split(/\s+/):e,this._rawClass&&(Zi(this._rawClass)?this._iterableDiffer=this._iterableDiffers.find(this._rawClass).create():this._keyValueDiffer=this._keyValueDiffers.find(this._rawClass).create())}ngDoCheck(){if(this._iterableDiffer){const e=this._iterableDiffer.diff(this._rawClass);e&&this._applyIterableChanges(e)}else if(this._keyValueDiffer){const e=this._keyValueDiffer.diff(this._rawClass);e&&this._applyKeyValueChanges(e)}}_applyKeyValueChanges(e){e.forEachAddedItem(i=>this._toggleClass(i.key,i.currentValue)),e.forEachChangedItem(i=>this._toggleClass(i.key,i.currentValue)),e.forEachRemovedItem(i=>{i.previousValue&&this._toggleClass(i.key,!1)})}_applyIterableChanges(e){e.forEachAddedItem(i=>{if("string"!=typeof i.item)throw new Error(`NgClass can only toggle CSS classes expressed as strings, got ${xn(i.item)}`);this._toggleClass(i.item,!0)}),e.forEachRemovedItem(i=>this._toggleClass(i.item,!1))}_applyClasses(e){e&&(Array.isArray(e)||e instanceof Set?e.forEach(i=>this._toggleClass(i,!0)):Object.keys(e).forEach(i=>this._toggleClass(i,!!e[i])))}_removeClasses(e){e&&(Array.isArray(e)||e instanceof Set?e.forEach(i=>this._toggleClass(i,!1)):Object.keys(e).forEach(i=>this._toggleClass(i,!1)))}_toggleClass(e,i){(e=e.trim())&&e.split(/\s+/g).forEach(r=>{i?this._renderer.addClass(this._ngEl.nativeElement,r):this._renderer.removeClass(this._ngEl.nativeElement,r)})}}return n.\u0275fac=function(e){return new(e||n)($(Nu),$(by),$(Pn),$(Ou))},n.\u0275dir=vt({type:n,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"}}),n})();class AV{constructor(t,e,i,r){this.$implicit=t,this.ngForOf=e,this.index=i,this.count=r}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let Nl=(()=>{class n{constructor(e,i,r){this._viewContainer=e,this._template=i,this._differs=r,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(e){this._ngForOf=e,this._ngForOfDirty=!0}set ngForTrackBy(e){this._trackByFn=e}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(e){e&&(this._template=e)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const e=this._ngForOf;!this._differ&&e&&(this._differ=this._differs.find(e).create(this.ngForTrackBy))}if(this._differ){const e=this._differ.diff(this._ngForOf);e&&this._applyChanges(e)}}_applyChanges(e){const i=this._viewContainer;e.forEachOperation((r,s,d)=>{if(null==r.previousIndex)i.createEmbeddedView(this._template,new AV(r.item,this._ngForOf,-1,-1),null===d?void 0:d);else if(null==d)i.remove(null===s?void 0:s);else if(null!==s){const m=i.get(s);i.move(m,d),$A(m,r)}});for(let r=0,s=i.length;r<s;r++){const m=i.get(r).context;m.index=r,m.count=s,m.ngForOf=this._ngForOf}e.forEachIdentityChange(r=>{$A(i.get(r.currentIndex),r)})}static ngTemplateContextGuard(e,i){return!0}}return n.\u0275fac=function(e){return new(e||n)($(Vo),$(eo),$(Nu))},n.\u0275dir=vt({type:n,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),n})();function $A(n,t){n.context.$implicit=t.item}let na=(()=>{class n{constructor(e,i){this._viewContainer=e,this._context=new RV,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=i}set ngIf(e){this._context.$implicit=this._context.ngIf=e,this._updateView()}set ngIfThen(e){GA("ngIfThen",e),this._thenTemplateRef=e,this._thenViewRef=null,this._updateView()}set ngIfElse(e){GA("ngIfElse",e),this._elseTemplateRef=e,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(e,i){return!0}}return n.\u0275fac=function(e){return new(e||n)($(Vo),$(eo))},n.\u0275dir=vt({type:n,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),n})();class RV{constructor(){this.$implicit=null,this.ngIf=null}}function GA(n,t){if(t&&!t.createEmbeddedView)throw new Error(`${n} must be a TemplateRef, but received '${xn(t)}'.`)}class EC{constructor(t,e){this._viewContainerRef=t,this._templateRef=e,this._created=!1}create(){this._created=!0,this._viewContainerRef.createEmbeddedView(this._templateRef)}destroy(){this._created=!1,this._viewContainerRef.clear()}enforceState(t){t&&!this._created?this.create():!t&&this._created&&this.destroy()}}let zg=(()=>{class n{constructor(){this._defaultUsed=!1,this._caseCount=0,this._lastCaseCheckIndex=0,this._lastCasesMatched=!1}set ngSwitch(e){this._ngSwitch=e,0===this._caseCount&&this._updateDefaultCases(!0)}_addCase(){return this._caseCount++}_addDefault(e){this._defaultViews||(this._defaultViews=[]),this._defaultViews.push(e)}_matchCase(e){const i=e==this._ngSwitch;return this._lastCasesMatched=this._lastCasesMatched||i,this._lastCaseCheckIndex++,this._lastCaseCheckIndex===this._caseCount&&(this._updateDefaultCases(!this._lastCasesMatched),this._lastCaseCheckIndex=0,this._lastCasesMatched=!1),i}_updateDefaultCases(e){if(this._defaultViews&&e!==this._defaultUsed){this._defaultUsed=e;for(let i=0;i<this._defaultViews.length;i++)this._defaultViews[i].enforceState(e)}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=vt({type:n,selectors:[["","ngSwitch",""]],inputs:{ngSwitch:"ngSwitch"}}),n})(),vx=(()=>{class n{constructor(e,i,r){this.ngSwitch=r,r._addCase(),this._view=new EC(e,i)}ngDoCheck(){this._view.enforceState(this.ngSwitch._matchCase(this.ngSwitchCase))}}return n.\u0275fac=function(e){return new(e||n)($(Vo),$(eo),$(zg,9))},n.\u0275dir=vt({type:n,selectors:[["","ngSwitchCase",""]],inputs:{ngSwitchCase:"ngSwitchCase"}}),n})(),WA=(()=>{class n{constructor(e,i,r){this._ngEl=e,this._differs=i,this._renderer=r,this._ngStyle=null,this._differ=null}set ngStyle(e){this._ngStyle=e,!this._differ&&e&&(this._differ=this._differs.find(e).create())}ngDoCheck(){if(this._differ){const e=this._differ.diff(this._ngStyle);e&&this._applyChanges(e)}}_setStyle(e,i){const[r,s]=e.split("."),d=-1===r.indexOf("-")?void 0:xa.DashCase;null!=i?this._renderer.setStyle(this._ngEl.nativeElement,r,s?`${i}${s}`:i,d):this._renderer.removeStyle(this._ngEl.nativeElement,r,d)}_applyChanges(e){e.forEachRemovedItem(i=>this._setStyle(i.key,null)),e.forEachAddedItem(i=>this._setStyle(i.key,i.currentValue)),e.forEachChangedItem(i=>this._setStyle(i.key,i.currentValue))}}return n.\u0275fac=function(e){return new(e||n)($(Pn),$(by),$(Ou))},n.\u0275dir=vt({type:n,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"}}),n})(),XA=(()=>{class n{constructor(e){this._viewContainerRef=e,this._viewRef=null,this.ngTemplateOutletContext=null,this.ngTemplateOutlet=null,this.ngTemplateOutletInjector=null}ngOnChanges(e){if(e.ngTemplateOutlet||e.ngTemplateOutletInjector){const i=this._viewContainerRef;if(this._viewRef&&i.remove(i.indexOf(this._viewRef)),this.ngTemplateOutlet){const{ngTemplateOutlet:r,ngTemplateOutletContext:s,ngTemplateOutletInjector:d}=this;this._viewRef=i.createEmbeddedView(r,s,d?{injector:d}:void 0)}else this._viewRef=null}else this._viewRef&&e.ngTemplateOutletContext&&this.ngTemplateOutletContext&&(this._viewRef.context=this.ngTemplateOutletContext)}}return n.\u0275fac=function(e){return new(e||n)($(Vo))},n.\u0275dir=vt({type:n,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet",ngTemplateOutletInjector:"ngTemplateOutletInjector"},features:[dr]}),n})();function Jc(n,t){return new Dt(2100,!1)}class LV{createSubscription(t,e){return t.subscribe({next:e,error:i=>{throw i}})}dispose(t){t.unsubscribe()}}class FV{createSubscription(t,e){return t.then(e,i=>{throw i})}dispose(t){}}const NV=new FV,BV=new LV;let vy=(()=>{class n{constructor(e){this._latestValue=null,this._subscription=null,this._obj=null,this._strategy=null,this._ref=e}ngOnDestroy(){this._subscription&&this._dispose(),this._ref=null}transform(e){return this._obj?e!==this._obj?(this._dispose(),this.transform(e)):this._latestValue:(e&&this._subscribe(e),this._latestValue)}_subscribe(e){this._obj=e,this._strategy=this._selectStrategy(e),this._subscription=this._strategy.createSubscription(e,i=>this._updateLatestValue(e,i))}_selectStrategy(e){if(ny(e))return NV;if(ZE(e))return BV;throw Jc()}_dispose(){this._strategy.dispose(this._subscription),this._latestValue=null,this._subscription=null,this._obj=null}_updateLatestValue(e,i){e===this._obj&&(this._latestValue=i,this._ref.markForCheck())}}return n.\u0275fac=function(e){return new(e||n)($(Dr,16))},n.\u0275pipe=ns({name:"async",type:n,pure:!1}),n})();const VV=/(?:[0-9A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u0870-\u0887\u0889-\u088E\u08A0-\u08C9\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C5D\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u1711\u171F-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4C\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7CA\uA7D0\uA7D1\uA7D3\uA7D5-\uA7D9\uA7F2-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF40\uDF42-\uDF49\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67\uDF80-\uDF85\uDF87-\uDFB0\uDFB2-\uDFBA]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDE80-\uDEA9\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDF70-\uDF81\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC71\uDC72\uDC75\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A\uDF40-\uDF46]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEB0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDEE0-\uDEF2\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC80-\uDD43]|\uD80B[\uDF90-\uDFF0]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE70-\uDEBE\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD837[\uDF00-\uDF1E]|\uD838[\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDE90-\uDEAD\uDEC0-\uDEEB]|\uD839[\uDFE0-\uDFE6\uDFE8-\uDFEB\uDFED\uDFEE\uDFF0-\uDFFE]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF38\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])\S*/g;let ZA=(()=>{class n{transform(e){if(null==e)return null;if("string"!=typeof e)throw Jc();return e.replace(VV,i=>i[0].toUpperCase()+i.slice(1).toLowerCase())}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275pipe=ns({name:"titlecase",type:n,pure:!0}),n})();const UV=new bt("DATE_PIPE_DEFAULT_TIMEZONE");let YA=(()=>{class n{constructor(e,i){this.locale=e,this.defaultTimezone=i}transform(e,i="mediumDate",r,s){var d;if(null==e||""===e||e!=e)return null;try{return aV(e,i,s||this.locale,null!==(d=null!=r?r:this.defaultTimezone)&&void 0!==d?d:void 0)}catch(m){throw Jc()}}}return n.\u0275fac=function(e){return new(e||n)($(Fl,16),$(UV,24))},n.\u0275pipe=ns({name:"date",type:n,pure:!0}),n})(),wr=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({}),n})();const KA="browser";let ij=(()=>{class n{}return n.\u0275prov=Ut({token:n,providedIn:"root",factory:()=>new rj(Be(si),window)}),n})();class rj{constructor(t,e){this.document=t,this.window=e,this.offset=()=>[0,0]}setOffset(t){this.offset=Array.isArray(t)?()=>t:t}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(t){this.supportsScrolling()&&this.window.scrollTo(t[0],t[1])}scrollToAnchor(t){if(!this.supportsScrolling())return;const e=function oj(n,t){const e=n.getElementById(t)||n.getElementsByName(t)[0];if(e)return e;if("function"==typeof n.createTreeWalker&&n.body&&(n.body.createShadowRoot||n.body.attachShadow)){const i=n.createTreeWalker(n.body,NodeFilter.SHOW_ELEMENT);let r=i.currentNode;for(;r;){const s=r.shadowRoot;if(s){const d=s.getElementById(t)||s.querySelector(`[name="${t}"]`);if(d)return d}r=i.nextNode()}}return null}(this.document,t);e&&(this.scrollToElement(e),e.focus())}setHistoryScrollRestoration(t){if(this.supportScrollRestoration()){const e=this.window.history;e&&e.scrollRestoration&&(e.scrollRestoration=t)}}scrollToElement(t){const e=t.getBoundingClientRect(),i=e.left+this.window.pageXOffset,r=e.top+this.window.pageYOffset,s=this.offset();this.window.scrollTo(i-s[0],r-s[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const t=JA(this.window.history)||JA(Object.getPrototypeOf(this.window.history));return!(!t||!t.writable&&!t.set)}catch(t){return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch(t){return!1}}}function JA(n){return Object.getOwnPropertyDescriptor(n,"scrollRestoration")}class ek{}class AC extends class sj extends class zz{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function Bz(n){lx||(lx=n)}(new AC)}onAndCancel(t,e,i){return t.addEventListener(e,i,!1),()=>{t.removeEventListener(e,i,!1)}}dispatchEvent(t,e){t.dispatchEvent(e)}remove(t){t.parentNode&&t.parentNode.removeChild(t)}createElement(t,e){return(e=e||this.getDefaultDocument()).createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,e){return"window"===e?window:"document"===e?t:"body"===e?t.body:null}getBaseHref(t){const e=function aj(){return xy=xy||document.querySelector("base"),xy?xy.getAttribute("href"):null}();return null==e?null:function lj(n){xx=xx||document.createElement("a"),xx.setAttribute("href",n);const t=xx.pathname;return"/"===t.charAt(0)?t:`/${t}`}(e)}resetBaseElement(){xy=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return jA(document.cookie,t)}}let xx,xy=null;const tk=new bt("TRANSITION_ID"),uj=[{provide:tx,useFactory:function cj(n,t,e){return()=>{e.get(nx).donePromise.then(()=>{const i=Bu(),r=t.querySelectorAll(`style[ng-transition="${n}"]`);for(let s=0;s<r.length;s++)i.remove(r[s])})}},deps:[tk,si,xr],multi:!0}];let hj=(()=>{class n{build(){return new XMLHttpRequest}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();const wx=new bt("EventManagerPlugins");let Sx=(()=>{class n{constructor(e,i){this._zone=i,this._eventNameToPlugin=new Map,e.forEach(r=>r.manager=this),this._plugins=e.slice().reverse()}addEventListener(e,i,r){return this._findPluginFor(i).addEventListener(e,i,r)}addGlobalEventListener(e,i,r){return this._findPluginFor(i).addGlobalEventListener(e,i,r)}getZone(){return this._zone}_findPluginFor(e){const i=this._eventNameToPlugin.get(e);if(i)return i;const r=this._plugins;for(let s=0;s<r.length;s++){const d=r[s];if(d.supports(e))return this._eventNameToPlugin.set(e,d),d}throw new Error(`No event manager plugin found for event ${e}`)}}return n.\u0275fac=function(e){return new(e||n)(Be(wx),Be(oi))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();class nk{constructor(t){this._doc=t}addGlobalEventListener(t,e,i){const r=Bu().getGlobalEventTarget(this._doc,t);if(!r)throw new Error(`Unsupported event target ${r} for event ${e}`);return this.addEventListener(r,e,i)}}let ik=(()=>{class n{constructor(){this._stylesSet=new Set}addStyles(e){const i=new Set;e.forEach(r=>{this._stylesSet.has(r)||(this._stylesSet.add(r),i.add(r))}),this.onStylesAdded(i)}onStylesAdded(e){}getAllStyles(){return Array.from(this._stylesSet)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})(),wy=(()=>{class n extends ik{constructor(e){super(),this._doc=e,this._hostNodes=new Map,this._hostNodes.set(e.head,[])}_addStylesToHost(e,i,r){e.forEach(s=>{const d=this._doc.createElement("style");d.textContent=s,r.push(i.appendChild(d))})}addHost(e){const i=[];this._addStylesToHost(this._stylesSet,e,i),this._hostNodes.set(e,i)}removeHost(e){const i=this._hostNodes.get(e);i&&i.forEach(rk),this._hostNodes.delete(e)}onStylesAdded(e){this._hostNodes.forEach((i,r)=>{this._addStylesToHost(e,r,i)})}ngOnDestroy(){this._hostNodes.forEach(e=>e.forEach(rk))}}return n.\u0275fac=function(e){return new(e||n)(Be(si))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();function rk(n){Bu().remove(n)}const kC={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},RC=/%COMP%/g;function Cx(n,t,e){for(let i=0;i<t.length;i++){let r=t[i];Array.isArray(r)?Cx(n,r,e):(r=r.replace(RC,n),e.push(r))}return e}function ak(n){return t=>{if("__ngUnwrap__"===t)return n;!1===n(t)&&(t.preventDefault(),t.returnValue=!1)}}let Tx=(()=>{class n{constructor(e,i,r){this.eventManager=e,this.sharedStylesHost=i,this.appId=r,this.rendererByCompId=new Map,this.defaultRenderer=new PC(e)}createRenderer(e,i){if(!e||!i)return this.defaultRenderer;switch(i.encapsulation){case Gs.Emulated:{let r=this.rendererByCompId.get(i.id);return r||(r=new _j(this.eventManager,this.sharedStylesHost,i,this.appId),this.rendererByCompId.set(i.id,r)),r.applyToHost(e),r}case 1:case Gs.ShadowDom:return new yj(this.eventManager,this.sharedStylesHost,e,i);default:if(!this.rendererByCompId.has(i.id)){const r=Cx(i.id,i.styles,[]);this.sharedStylesHost.addStyles(r),this.rendererByCompId.set(i.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return n.\u0275fac=function(e){return new(e||n)(Be(Sx),Be(wy),Be(Fg))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();class PC{constructor(t){this.eventManager=t,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(t,e){return e?document.createElementNS(kC[e]||e,t):document.createElement(t)}createComment(t){return document.createComment(t)}createText(t){return document.createTextNode(t)}appendChild(t,e){(ck(t)?t.content:t).appendChild(e)}insertBefore(t,e,i){t&&(ck(t)?t.content:t).insertBefore(e,i)}removeChild(t,e){t&&t.removeChild(e)}selectRootElement(t,e){let i="string"==typeof t?document.querySelector(t):t;if(!i)throw new Error(`The selector "${t}" did not match any elements`);return e||(i.textContent=""),i}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,e,i,r){if(r){e=r+":"+e;const s=kC[r];s?t.setAttributeNS(s,e,i):t.setAttribute(e,i)}else t.setAttribute(e,i)}removeAttribute(t,e,i){if(i){const r=kC[i];r?t.removeAttributeNS(r,e):t.removeAttribute(`${i}:${e}`)}else t.removeAttribute(e)}addClass(t,e){t.classList.add(e)}removeClass(t,e){t.classList.remove(e)}setStyle(t,e,i,r){r&(xa.DashCase|xa.Important)?t.style.setProperty(e,i,r&xa.Important?"important":""):t.style[e]=i}removeStyle(t,e,i){i&xa.DashCase?t.style.removeProperty(e):t.style[e]=""}setProperty(t,e,i){t[e]=i}setValue(t,e){t.nodeValue=e}listen(t,e,i){return"string"==typeof t?this.eventManager.addGlobalEventListener(t,e,ak(i)):this.eventManager.addEventListener(t,e,ak(i))}}function ck(n){return"TEMPLATE"===n.tagName&&void 0!==n.content}class _j extends PC{constructor(t,e,i,r){super(t),this.component=i;const s=Cx(r+"-"+i.id,i.styles,[]);e.addStyles(s),this.contentAttr=function mj(n){return"_ngcontent-%COMP%".replace(RC,n)}(r+"-"+i.id),this.hostAttr=function gj(n){return"_nghost-%COMP%".replace(RC,n)}(r+"-"+i.id)}applyToHost(t){super.setAttribute(t,this.hostAttr,"")}createElement(t,e){const i=super.createElement(t,e);return super.setAttribute(i,this.contentAttr,""),i}}class yj extends PC{constructor(t,e,i,r){super(t),this.sharedStylesHost=e,this.hostEl=i,this.shadowRoot=i.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const s=Cx(r.id,r.styles,[]);for(let d=0;d<s.length;d++){const m=document.createElement("style");m.textContent=s[d],this.shadowRoot.appendChild(m)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(t,e){return super.appendChild(this.nodeOrShadowRoot(t),e)}insertBefore(t,e,i){return super.insertBefore(this.nodeOrShadowRoot(t),e,i)}removeChild(t,e){return super.removeChild(this.nodeOrShadowRoot(t),e)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}}let vj=(()=>{class n extends nk{constructor(e){super(e)}supports(e){return!0}addEventListener(e,i,r){return e.addEventListener(i,r,!1),()=>this.removeEventListener(e,i,r)}removeEventListener(e,i,r){return e.removeEventListener(i,r)}}return n.\u0275fac=function(e){return new(e||n)(Be(si))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();const uk=["alt","control","meta","shift"],wj={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},dk={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},Sj={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey};let Cj=(()=>{class n extends nk{constructor(e){super(e)}supports(e){return null!=n.parseEventName(e)}addEventListener(e,i,r){const s=n.parseEventName(i),d=n.eventCallback(s.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Bu().onAndCancel(e,s.domEventName,d))}static parseEventName(e){const i=e.toLowerCase().split("."),r=i.shift();if(0===i.length||"keydown"!==r&&"keyup"!==r)return null;const s=n._normalizeKey(i.pop());let d="";if(uk.forEach(v=>{const D=i.indexOf(v);D>-1&&(i.splice(D,1),d+=v+".")}),d+=s,0!=i.length||0===s.length)return null;const m={};return m.domEventName=r,m.fullKey=d,m}static getEventFullKey(e){let i="",r=function Tj(n){let t=n.key;if(null==t){if(t=n.keyIdentifier,null==t)return"Unidentified";t.startsWith("U+")&&(t=String.fromCharCode(parseInt(t.substring(2),16)),3===n.location&&dk.hasOwnProperty(t)&&(t=dk[t]))}return wj[t]||t}(e);return r=r.toLowerCase()," "===r?r="space":"."===r&&(r="dot"),uk.forEach(s=>{s!=r&&Sj[s](e)&&(i+=s+".")}),i+=r,i}static eventCallback(e,i,r){return s=>{n.getEventFullKey(s)===e&&r.runGuarded(()=>i(s))}}static _normalizeKey(e){return"esc"===e?"escape":e}}return n.\u0275fac=function(e){return new(e||n)(Be(si))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();const Mj=cA(Lz,"browser",[{provide:ix,useValue:KA},{provide:JM,useValue:function Dj(){AC.makeCurrent()},multi:!0},{provide:si,useFactory:function Ij(){return function Ev(n){Bm=n}(document),document},deps:[]}]),pk=new bt(""),fk=[{provide:rx,useClass:class dj{addToWindow(t){Sr.getAngularTestability=(i,r=!0)=>{const s=t.findTestabilityInTree(i,r);if(null==s)throw new Error("Could not find testability for element.");return s},Sr.getAllAngularTestabilities=()=>t.getAllTestabilities(),Sr.getAllAngularRootElements=()=>t.getAllRootElements(),Sr.frameworkStabilizers||(Sr.frameworkStabilizers=[]),Sr.frameworkStabilizers.push(i=>{const r=Sr.getAllAngularTestabilities();let s=r.length,d=!1;const m=function(v){d=d||v,s--,0==s&&i(d)};r.forEach(function(v){v.whenStable(m)})})}findTestabilityInTree(t,e,i){if(null==e)return null;const r=t.getTestability(e);return null!=r?r:i?Bu().isShadowRoot(e)?this.findTestabilityInTree(t,e.host,!0):this.findTestabilityInTree(t,e.parentElement,!0):null}},deps:[]},{provide:oA,useClass:cC,deps:[oi,uC,rx]},{provide:cC,useClass:cC,deps:[oi,uC,rx]}],mk=[{provide:ig,useValue:"root"},{provide:va,useFactory:function Ej(){return new va},deps:[]},{provide:wx,useClass:vj,multi:!0,deps:[si,oi,ix]},{provide:wx,useClass:Cj,multi:!0,deps:[si]},{provide:Tx,useClass:Tx,deps:[Sx,wy,Fg]},{provide:uy,useExisting:Tx},{provide:ik,useExisting:wy},{provide:wy,useClass:wy,deps:[si]},{provide:Sx,useClass:Sx,deps:[wx,oi]},{provide:ek,useClass:hj,deps:[]},[]];let gk=(()=>{class n{constructor(e){}static withServerTransition(e){return{ngModule:n,providers:[{provide:Fg,useValue:e.appId},{provide:tk,useExisting:Fg},uj]}}}return n.\u0275fac=function(e){return new(e||n)(Be(pk,12))},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({providers:[...mk,...fk],imports:[wr,Fz]}),n})(),bk=(()=>{class n{constructor(e){this._doc=e}getTitle(){return this._doc.title}setTitle(e){this._doc.title=e||""}}return n.\u0275fac=function(e){return new(e||n)(Be(si))},n.\u0275prov=Ut({token:n,factory:function(e){let i=null;return i=e?new e:function kj(){return new bk(Be(si))}(),i},providedIn:"root"}),n})();"undefined"!=typeof window&&window;let vk=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ut({token:n,factory:function(e){let i=null;return i=e?new(e||n):Be(xk),i},providedIn:"root"}),n})(),xk=(()=>{class n extends vk{constructor(e){super(),this._doc=e}sanitize(e,i){if(null==i)return null;switch(e){case Ar.NONE:return i;case Ar.HTML:return Na(i,"HTML")?Js(i):jb(this._doc,String(i)).toString();case Ar.STYLE:return Na(i,"Style")?Js(i):i;case Ar.SCRIPT:if(Na(i,"Script"))return Js(i);throw new Error("unsafe value used in a script context");case Ar.URL:return Na(i,"URL")?Js(i):Bc(String(i));case Ar.RESOURCE_URL:if(Na(i,"ResourceURL"))return Js(i);throw new Error("unsafe value used in a resource URL context (see https://g.co/ng/security#xss)");default:throw new Error(`Unexpected SecurityContext ${e} (see https://g.co/ng/security#xss)`)}}bypassSecurityTrustHtml(e){return function Av(n){return new ic(n)}(e)}bypassSecurityTrustStyle(e){return function LS(n){return new Ob(n)}(e)}bypassSecurityTrustScript(e){return function Lb(n){return new Fh(n)}(e)}bypassSecurityTrustUrl(e){return function kv(n){return new df(n)}(e)}bypassSecurityTrustResourceUrl(e){return function hf(n){return new _d(n)}(e)}}return n.\u0275fac=function(e){return new(e||n)(Be(si))},n.\u0275prov=Ut({token:n,factory:function(e){let i=null;return i=e?new e:function zj(n){return new xk(n.get(si))}(Be(xr)),i},providedIn:"root"}),n})();class wk{}const Hd="*";function ks(n,t){return{type:7,name:n,definitions:t,options:{}}}function Yi(n,t=null){return{type:4,styles:t,timings:n}}function Sk(n,t=null){return{type:3,steps:n,options:t}}function Ck(n,t=null){return{type:2,steps:n,options:t}}function Nn(n){return{type:6,styles:n,offset:null}}function gr(n,t,e){return{type:0,name:n,styles:t,options:e}}function Sy(n){return{type:5,steps:n}}function $i(n,t,e=null){return{type:1,expr:n,animation:t,options:e}}function FC(n=null){return{type:9,options:n}}function NC(n,t,e=null){return{type:11,selector:n,animation:t,options:e}}function Tk(n){Promise.resolve(null).then(n)}class Cy{constructor(t=0,e=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=t+e}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}onStart(t){this._originalOnStartFns.push(t),this._onStartFns.push(t)}onDone(t){this._originalOnDoneFns.push(t),this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){Tk(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(t=>t()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(t){this._position=this.totalTime?t*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(t){const e="start"==t?this._onStartFns:this._onDoneFns;e.forEach(i=>i()),e.length=0}}class Dk{constructor(t){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=t;let e=0,i=0,r=0;const s=this.players.length;0==s?Tk(()=>this._onFinish()):this.players.forEach(d=>{d.onDone(()=>{++e==s&&this._onFinish()}),d.onDestroy(()=>{++i==s&&this._onDestroy()}),d.onStart(()=>{++r==s&&this._onStart()})}),this.totalTime=this.players.reduce((d,m)=>Math.max(d,m.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this.players.forEach(t=>t.init())}onStart(t){this._onStartFns.push(t)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(t=>t()),this._onStartFns=[])}onDone(t){this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(t=>t.play())}pause(){this.players.forEach(t=>t.pause())}restart(){this.players.forEach(t=>t.restart())}finish(){this._onFinish(),this.players.forEach(t=>t.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(t=>t.destroy()),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}reset(){this.players.forEach(t=>t.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(t){const e=t*this.totalTime;this.players.forEach(i=>{const r=i.totalTime?Math.min(1,e/i.totalTime):1;i.setPosition(r)})}getPosition(){const t=this.players.reduce((e,i)=>null===e||i.totalTime>e.totalTime?i:e,null);return null!=t?t.getPosition():0}beforeDestroy(){this.players.forEach(t=>{t.beforeDestroy&&t.beforeDestroy()})}triggerCallback(t){const e="start"==t?this._onStartFns:this._onDoneFns;e.forEach(i=>i()),e.length=0}}function Ek(n){return new Dt(3e3,!1)}function x6(){return"undefined"!=typeof window&&void 0!==window.document}function zC(){return"undefined"!=typeof process&&"[object process]"==={}.toString.call(process)}function mp(n){switch(n.length){case 0:return new Cy;case 1:return n[0];default:return new Dk(n)}}function Ik(n,t,e,i,r=new Map,s=new Map){const d=[],m=[];let v=-1,D=null;if(i.forEach(A=>{const L=A.get("offset"),j=L==v,W=j&&D||new Map;A.forEach((ie,we)=>{let Re=we,We=ie;if("offset"!==we)switch(Re=t.normalizePropertyName(Re,d),We){case"!":We=r.get(we);break;case Hd:We=s.get(we);break;default:We=t.normalizeStyleValue(we,Re,We,d)}W.set(Re,We)}),j||m.push(W),D=W,v=L}),d.length)throw function c6(n){return new Dt(3502,!1)}();return m}function VC(n,t,e,i){switch(t){case"start":n.onStart(()=>i(e&&jC(e,"start",n)));break;case"done":n.onDone(()=>i(e&&jC(e,"done",n)));break;case"destroy":n.onDestroy(()=>i(e&&jC(e,"destroy",n)))}}function jC(n,t,e){const i=e.totalTime,s=UC(n.element,n.triggerName,n.fromState,n.toState,t||n.phaseName,null==i?n.totalTime:i,!!e.disabled),d=n._data;return null!=d&&(s._data=d),s}function UC(n,t,e,i,r="",s=0,d){return{element:n,triggerName:t,fromState:e,toState:i,phaseName:r,totalTime:s,disabled:!!d}}function Bl(n,t,e){let i=n.get(t);return i||n.set(t,i=e),i}function Mk(n){const t=n.indexOf(":");return[n.substring(1,t),n.slice(t+1)]}let HC=(n,t)=>!1,Ak=(n,t,e)=>[],kk=null;function $C(n){const t=n.parentNode||n.host;return t===kk?null:t}(zC()||"undefined"!=typeof Element)&&(x6()?(kk=(()=>document.documentElement)(),HC=(n,t)=>{for(;t;){if(t===n)return!0;t=$C(t)}return!1}):HC=(n,t)=>n.contains(t),Ak=(n,t,e)=>{if(e)return Array.from(n.querySelectorAll(t));const i=n.querySelector(t);return i?[i]:[]});let jf=null,Rk=!1;const Pk=HC,Ok=Ak;let Lk=(()=>{class n{validateStyleProperty(e){return function S6(n){jf||(jf=function C6(){return"undefined"!=typeof document?document.body:null}()||{},Rk=!!jf.style&&"WebkitAppearance"in jf.style);let t=!0;return jf.style&&!function w6(n){return"ebkit"==n.substring(1,6)}(n)&&(t=n in jf.style,!t&&Rk&&(t="Webkit"+n.charAt(0).toUpperCase()+n.slice(1)in jf.style)),t}(e)}matchesElement(e,i){return!1}containsElement(e,i){return Pk(e,i)}getParentElement(e){return $C(e)}query(e,i,r){return Ok(e,i,r)}computeStyle(e,i,r){return r||""}animate(e,i,r,s,d,m=[],v){return new Cy(r,s)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})(),GC=(()=>{class n{}return n.NOOP=new Lk,n})();const qC="ng-enter",Dx="ng-leave",Ex="ng-trigger",Ix=".ng-trigger",Nk="ng-animating",WC=".ng-animating";function gp(n){if("number"==typeof n)return n;const t=n.match(/^(-?[\.\d]+)(m?s)/);return!t||t.length<2?0:XC(parseFloat(t[1]),t[2])}function XC(n,t){return"s"===t?1e3*n:n}function Mx(n,t,e){return n.hasOwnProperty("duration")?n:function E6(n,t,e){let r,s=0,d="";if("string"==typeof n){const m=n.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===m)return t.push(Ek()),{duration:0,delay:0,easing:""};r=XC(parseFloat(m[1]),m[2]);const v=m[3];null!=v&&(s=XC(parseFloat(v),m[4]));const D=m[5];D&&(d=D)}else r=n;if(!e){let m=!1,v=t.length;r<0&&(t.push(function jj(){return new Dt(3100,!1)}()),m=!0),s<0&&(t.push(function Uj(){return new Dt(3101,!1)}()),m=!0),m&&t.splice(v,0,Ek())}return{duration:r,delay:s,easing:d}}(n,t,e)}function Ty(n,t={}){return Object.keys(n).forEach(e=>{t[e]=n[e]}),t}function Bk(n){const t=new Map;return Object.keys(n).forEach(e=>{t.set(e,n[e])}),t}function bp(n,t=new Map,e){if(e)for(let[i,r]of e)t.set(i,r);for(let[i,r]of n)t.set(i,r);return t}function Vk(n,t,e){return e?t+":"+e+";":""}function jk(n){let t="";for(let e=0;e<n.style.length;e++){const i=n.style.item(e);t+=Vk(0,i,n.style.getPropertyValue(i))}for(const e in n.style)n.style.hasOwnProperty(e)&&!e.startsWith("_")&&(t+=Vk(0,k6(e),n.style[e]));n.setAttribute("style",t)}function zu(n,t,e){n.style&&(t.forEach((i,r)=>{const s=YC(r);e&&!e.has(r)&&e.set(r,n.style[s]),n.style[s]=i}),zC()&&jk(n))}function Uf(n,t){n.style&&(t.forEach((e,i)=>{const r=YC(i);n.style[r]=""}),zC()&&jk(n))}function Dy(n){return Array.isArray(n)?1==n.length?n[0]:Ck(n):n}const ZC=new RegExp("{{\\s*(.+?)\\s*}}","g");function Uk(n){let t=[];if("string"==typeof n){let e;for(;e=ZC.exec(n);)t.push(e[1]);ZC.lastIndex=0}return t}function Ax(n,t,e){const i=n.toString(),r=i.replace(ZC,(s,d)=>{let m=t[d];return null==m&&(e.push(function $j(n){return new Dt(3003,!1)}()),m=""),m.toString()});return r==i?n:r}function kx(n){const t=[];let e=n.next();for(;!e.done;)t.push(e.value),e=n.next();return t}const A6=/-+([a-z0-9])/g;function YC(n){return n.replace(A6,(...t)=>t[1].toUpperCase())}function k6(n){return n.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function zl(n,t,e){switch(t.type){case 7:return n.visitTrigger(t,e);case 0:return n.visitState(t,e);case 1:return n.visitTransition(t,e);case 2:return n.visitSequence(t,e);case 3:return n.visitGroup(t,e);case 4:return n.visitAnimate(t,e);case 5:return n.visitKeyframes(t,e);case 6:return n.visitStyle(t,e);case 8:return n.visitReference(t,e);case 9:return n.visitAnimateChild(t,e);case 10:return n.visitAnimateRef(t,e);case 11:return n.visitQuery(t,e);case 12:return n.visitStagger(t,e);default:throw function Gj(n){return new Dt(3004,!1)}()}}function Hk(n,t){return window.getComputedStyle(n)[t]}function N6(n,t){const e=[];return"string"==typeof n?n.split(/\s*,\s*/).forEach(i=>function B6(n,t,e){if(":"==n[0]){const v=function z6(n,t){switch(n){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(e,i)=>parseFloat(i)>parseFloat(e);case":decrement":return(e,i)=>parseFloat(i)<parseFloat(e);default:return t.push(function o6(n){return new Dt(3016,!1)}()),"* => *"}}(n,e);if("function"==typeof v)return void t.push(v);n=v}const i=n.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==i||i.length<4)return e.push(function r6(n){return new Dt(3015,!1)}()),t;const r=i[1],s=i[2],d=i[3];t.push($k(r,d));"<"==s[0]&&!("*"==r&&"*"==d)&&t.push($k(d,r))}(i,e,t)):e.push(n),e}const Lx=new Set(["true","1"]),Fx=new Set(["false","0"]);function $k(n,t){const e=Lx.has(n)||Fx.has(n),i=Lx.has(t)||Fx.has(t);return(r,s)=>{let d="*"==n||n==r,m="*"==t||t==s;return!d&&e&&"boolean"==typeof r&&(d=r?Lx.has(n):Fx.has(n)),!m&&i&&"boolean"==typeof s&&(m=s?Lx.has(t):Fx.has(t)),d&&m}}const V6=new RegExp("s*:selfs*,?","g");function QC(n,t,e,i){return new j6(n).build(t,e,i)}class j6{constructor(t){this._driver=t}build(t,e,i){const r=new $6(e);return this._resetContextStyleTimingState(r),zl(this,Dy(t),r)}_resetContextStyleTimingState(t){t.currentQuerySelector="",t.collectedStyles=new Map,t.collectedStyles.set("",new Map),t.currentTime=0}visitTrigger(t,e){let i=e.queryCount=0,r=e.depCount=0;const s=[],d=[];return"@"==t.name.charAt(0)&&e.errors.push(function Wj(){return new Dt(3006,!1)}()),t.definitions.forEach(m=>{if(this._resetContextStyleTimingState(e),0==m.type){const v=m,D=v.name;D.toString().split(/\s*,\s*/).forEach(A=>{v.name=A,s.push(this.visitState(v,e))}),v.name=D}else if(1==m.type){const v=this.visitTransition(m,e);i+=v.queryCount,r+=v.depCount,d.push(v)}else e.errors.push(function Xj(){return new Dt(3007,!1)}())}),{type:7,name:t.name,states:s,transitions:d,queryCount:i,depCount:r,options:null}}visitState(t,e){const i=this.visitStyle(t.styles,e),r=t.options&&t.options.params||null;if(i.containsDynamicStyles){const s=new Set,d=r||{};i.styles.forEach(m=>{m instanceof Map&&m.forEach(v=>{Uk(v).forEach(D=>{d.hasOwnProperty(D)||s.add(D)})})}),s.size&&(kx(s.values()),e.errors.push(function Zj(n,t){return new Dt(3008,!1)}()))}return{type:0,name:t.name,style:i,options:r?{params:r}:null}}visitTransition(t,e){e.queryCount=0,e.depCount=0;const i=zl(this,Dy(t.animation),e);return{type:1,matchers:N6(t.expr,e.errors),animation:i,queryCount:e.queryCount,depCount:e.depCount,options:Hf(t.options)}}visitSequence(t,e){return{type:2,steps:t.steps.map(i=>zl(this,i,e)),options:Hf(t.options)}}visitGroup(t,e){const i=e.currentTime;let r=0;const s=t.steps.map(d=>{e.currentTime=i;const m=zl(this,d,e);return r=Math.max(r,e.currentTime),m});return e.currentTime=r,{type:3,steps:s,options:Hf(t.options)}}visitAnimate(t,e){const i=function q6(n,t){if(n.hasOwnProperty("duration"))return n;if("number"==typeof n)return KC(Mx(n,t).duration,0,"");const e=n;if(e.split(/\s+/).some(s=>"{"==s.charAt(0)&&"{"==s.charAt(1))){const s=KC(0,0,"");return s.dynamic=!0,s.strValue=e,s}const r=Mx(e,t);return KC(r.duration,r.delay,r.easing)}(t.timings,e.errors);e.currentAnimateTimings=i;let r,s=t.styles?t.styles:Nn({});if(5==s.type)r=this.visitKeyframes(s,e);else{let d=t.styles,m=!1;if(!d){m=!0;const D={};i.easing&&(D.easing=i.easing),d=Nn(D)}e.currentTime+=i.duration+i.delay;const v=this.visitStyle(d,e);v.isEmptyStep=m,r=v}return e.currentAnimateTimings=null,{type:4,timings:i,style:r,options:null}}visitStyle(t,e){const i=this._makeStyleAst(t,e);return this._validateStyleAst(i,e),i}_makeStyleAst(t,e){const i=[],r=Array.isArray(t.styles)?t.styles:[t.styles];for(let m of r)"string"==typeof m?m===Hd?i.push(m):e.errors.push(new Dt(3002,!1)):i.push(Bk(m));let s=!1,d=null;return i.forEach(m=>{if(m instanceof Map&&(m.has("easing")&&(d=m.get("easing"),m.delete("easing")),!s))for(let v of m.values())if(v.toString().indexOf("{{")>=0){s=!0;break}}),{type:6,styles:i,easing:d,offset:t.offset,containsDynamicStyles:s,options:null}}_validateStyleAst(t,e){const i=e.currentAnimateTimings;let r=e.currentTime,s=e.currentTime;i&&s>0&&(s-=i.duration+i.delay),t.styles.forEach(d=>{"string"!=typeof d&&d.forEach((m,v)=>{const D=e.collectedStyles.get(e.currentQuerySelector),A=D.get(v);let L=!0;A&&(s!=r&&s>=A.startTime&&r<=A.endTime&&(e.errors.push(function Qj(n,t,e,i,r){return new Dt(3010,!1)}()),L=!1),s=A.startTime),L&&D.set(v,{startTime:s,endTime:r}),e.options&&function M6(n,t,e){const i=t.params||{},r=Uk(n);r.length&&r.forEach(s=>{i.hasOwnProperty(s)||e.push(function Hj(n){return new Dt(3001,!1)}())})}(m,e.options,e.errors)})})}visitKeyframes(t,e){const i={type:5,styles:[],options:null};if(!e.currentAnimateTimings)return e.errors.push(function Kj(){return new Dt(3011,!1)}()),i;let s=0;const d=[];let m=!1,v=!1,D=0;const A=t.steps.map(We=>{const xt=this._makeStyleAst(We,e);let st=null!=xt.offset?xt.offset:function G6(n){if("string"==typeof n)return null;let t=null;if(Array.isArray(n))n.forEach(e=>{if(e instanceof Map&&e.has("offset")){const i=e;t=parseFloat(i.get("offset")),i.delete("offset")}});else if(n instanceof Map&&n.has("offset")){const e=n;t=parseFloat(e.get("offset")),e.delete("offset")}return t}(xt.styles),Bt=0;return null!=st&&(s++,Bt=xt.offset=st),v=v||Bt<0||Bt>1,m=m||Bt<D,D=Bt,d.push(Bt),xt});v&&e.errors.push(function Jj(){return new Dt(3012,!1)}()),m&&e.errors.push(function e6(){return new Dt(3200,!1)}());const L=t.steps.length;let j=0;s>0&&s<L?e.errors.push(function t6(){return new Dt(3202,!1)}()):0==s&&(j=1/(L-1));const W=L-1,ie=e.currentTime,we=e.currentAnimateTimings,Re=we.duration;return A.forEach((We,xt)=>{const st=j>0?xt==W?1:j*xt:d[xt],Bt=st*Re;e.currentTime=ie+we.delay+Bt,we.duration=Bt,this._validateStyleAst(We,e),We.offset=st,i.styles.push(We)}),i}visitReference(t,e){return{type:8,animation:zl(this,Dy(t.animation),e),options:Hf(t.options)}}visitAnimateChild(t,e){return e.depCount++,{type:9,options:Hf(t.options)}}visitAnimateRef(t,e){return{type:10,animation:this.visitReference(t.animation,e),options:Hf(t.options)}}visitQuery(t,e){const i=e.currentQuerySelector,r=t.options||{};e.queryCount++,e.currentQuery=t;const[s,d]=function U6(n){const t=!!n.split(/\s*,\s*/).find(e=>":self"==e);return t&&(n=n.replace(V6,"")),n=n.replace(/@\*/g,Ix).replace(/@\w+/g,e=>Ix+"-"+e.slice(1)).replace(/:animating/g,WC),[n,t]}(t.selector);e.currentQuerySelector=i.length?i+" "+s:s,Bl(e.collectedStyles,e.currentQuerySelector,new Map);const m=zl(this,Dy(t.animation),e);return e.currentQuery=null,e.currentQuerySelector=i,{type:11,selector:s,limit:r.limit||0,optional:!!r.optional,includeSelf:d,animation:m,originalSelector:t.selector,options:Hf(t.options)}}visitStagger(t,e){e.currentQuery||e.errors.push(function n6(){return new Dt(3013,!1)}());const i="full"===t.timings?{duration:0,delay:0,easing:"full"}:Mx(t.timings,e.errors,!0);return{type:12,animation:zl(this,Dy(t.animation),e),timings:i,options:null}}}class $6{constructor(t){this.errors=t,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}}function Hf(n){return n?(n=Ty(n)).params&&(n.params=function H6(n){return n?Ty(n):null}(n.params)):n={},n}function KC(n,t,e){return{duration:n,delay:t,easing:e}}function JC(n,t,e,i,r,s,d=null,m=!1){return{type:1,element:n,keyframes:t,preStyleProps:e,postStyleProps:i,duration:r,delay:s,totalTime:r+s,easing:d,subTimeline:m}}class Nx{constructor(){this._map=new Map}get(t){return this._map.get(t)||[]}append(t,e){let i=this._map.get(t);i||this._map.set(t,i=[]),i.push(...e)}has(t){return this._map.has(t)}clear(){this._map.clear()}}const Z6=new RegExp(":enter","g"),Q6=new RegExp(":leave","g");function eT(n,t,e,i,r,s=new Map,d=new Map,m,v,D=[]){return(new K6).buildKeyframes(n,t,e,i,r,s,d,m,v,D)}class K6{buildKeyframes(t,e,i,r,s,d,m,v,D,A=[]){D=D||new Nx;const L=new tT(t,e,D,r,s,A,[]);L.options=v;const j=v.delay?gp(v.delay):0;L.currentTimeline.delayNextStep(j),L.currentTimeline.setStyles([d],null,L.errors,v),zl(this,i,L);const W=L.timelines.filter(ie=>ie.containsAnimation());if(W.length&&m.size){let ie;for(let we=W.length-1;we>=0;we--){const Re=W[we];if(Re.element===e){ie=Re;break}}ie&&!ie.allowOnlyTimelineStyles()&&ie.setStyles([m],null,L.errors,v)}return W.length?W.map(ie=>ie.buildKeyframes()):[JC(e,[],[],[],0,j,"",!1)]}visitTrigger(t,e){}visitState(t,e){}visitTransition(t,e){}visitAnimateChild(t,e){const i=e.subInstructions.get(e.element);if(i){const r=e.createSubContext(t.options),s=e.currentTimeline.currentTime,d=this._visitSubInstructions(i,r,r.options);s!=d&&e.transformIntoNewTimeline(d)}e.previousNode=t}visitAnimateRef(t,e){const i=e.createSubContext(t.options);i.transformIntoNewTimeline(),this.visitReference(t.animation,i),e.transformIntoNewTimeline(i.currentTimeline.currentTime),e.previousNode=t}_visitSubInstructions(t,e,i){let s=e.currentTimeline.currentTime;const d=null!=i.duration?gp(i.duration):null,m=null!=i.delay?gp(i.delay):null;return 0!==d&&t.forEach(v=>{const D=e.appendInstructionToTimeline(v,d,m);s=Math.max(s,D.duration+D.delay)}),s}visitReference(t,e){e.updateOptions(t.options,!0),zl(this,t.animation,e),e.previousNode=t}visitSequence(t,e){const i=e.subContextCount;let r=e;const s=t.options;if(s&&(s.params||s.delay)&&(r=e.createSubContext(s),r.transformIntoNewTimeline(),null!=s.delay)){6==r.previousNode.type&&(r.currentTimeline.snapshotCurrentStyles(),r.previousNode=Bx);const d=gp(s.delay);r.delayNextStep(d)}t.steps.length&&(t.steps.forEach(d=>zl(this,d,r)),r.currentTimeline.applyStylesToKeyframe(),r.subContextCount>i&&r.transformIntoNewTimeline()),e.previousNode=t}visitGroup(t,e){const i=[];let r=e.currentTimeline.currentTime;const s=t.options&&t.options.delay?gp(t.options.delay):0;t.steps.forEach(d=>{const m=e.createSubContext(t.options);s&&m.delayNextStep(s),zl(this,d,m),r=Math.max(r,m.currentTimeline.currentTime),i.push(m.currentTimeline)}),i.forEach(d=>e.currentTimeline.mergeTimelineCollectedStyles(d)),e.transformIntoNewTimeline(r),e.previousNode=t}_visitTiming(t,e){if(t.dynamic){const i=t.strValue;return Mx(e.params?Ax(i,e.params,e.errors):i,e.errors)}return{duration:t.duration,delay:t.delay,easing:t.easing}}visitAnimate(t,e){const i=e.currentAnimateTimings=this._visitTiming(t.timings,e),r=e.currentTimeline;i.delay&&(e.incrementTime(i.delay),r.snapshotCurrentStyles());const s=t.style;5==s.type?this.visitKeyframes(s,e):(e.incrementTime(i.duration),this.visitStyle(s,e),r.applyStylesToKeyframe()),e.currentAnimateTimings=null,e.previousNode=t}visitStyle(t,e){const i=e.currentTimeline,r=e.currentAnimateTimings;!r&&i.hasCurrentStyleProperties()&&i.forwardFrame();const s=r&&r.easing||t.easing;t.isEmptyStep?i.applyEmptyStep(s):i.setStyles(t.styles,s,e.errors,e.options),e.previousNode=t}visitKeyframes(t,e){const i=e.currentAnimateTimings,r=e.currentTimeline.duration,s=i.duration,m=e.createSubContext().currentTimeline;m.easing=i.easing,t.styles.forEach(v=>{m.forwardTime((v.offset||0)*s),m.setStyles(v.styles,v.easing,e.errors,e.options),m.applyStylesToKeyframe()}),e.currentTimeline.mergeTimelineCollectedStyles(m),e.transformIntoNewTimeline(r+s),e.previousNode=t}visitQuery(t,e){const i=e.currentTimeline.currentTime,r=t.options||{},s=r.delay?gp(r.delay):0;s&&(6===e.previousNode.type||0==i&&e.currentTimeline.hasCurrentStyleProperties())&&(e.currentTimeline.snapshotCurrentStyles(),e.previousNode=Bx);let d=i;const m=e.invokeQuery(t.selector,t.originalSelector,t.limit,t.includeSelf,!!r.optional,e.errors);e.currentQueryTotal=m.length;let v=null;m.forEach((D,A)=>{e.currentQueryIndex=A;const L=e.createSubContext(t.options,D);s&&L.delayNextStep(s),D===e.element&&(v=L.currentTimeline),zl(this,t.animation,L),L.currentTimeline.applyStylesToKeyframe(),d=Math.max(d,L.currentTimeline.currentTime)}),e.currentQueryIndex=0,e.currentQueryTotal=0,e.transformIntoNewTimeline(d),v&&(e.currentTimeline.mergeTimelineCollectedStyles(v),e.currentTimeline.snapshotCurrentStyles()),e.previousNode=t}visitStagger(t,e){const i=e.parentContext,r=e.currentTimeline,s=t.timings,d=Math.abs(s.duration),m=d*(e.currentQueryTotal-1);let v=d*e.currentQueryIndex;switch(s.duration<0?"reverse":s.easing){case"reverse":v=m-v;break;case"full":v=i.currentStaggerTime}const A=e.currentTimeline;v&&A.delayNextStep(v);const L=A.currentTime;zl(this,t.animation,e),e.previousNode=t,i.currentStaggerTime=r.currentTime-L+(r.startTime-i.currentTimeline.startTime)}}const Bx={};class tT{constructor(t,e,i,r,s,d,m,v){this._driver=t,this.element=e,this.subInstructions=i,this._enterClassName=r,this._leaveClassName=s,this.errors=d,this.timelines=m,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=Bx,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=v||new zx(this._driver,e,0),m.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(t,e){if(!t)return;const i=t;let r=this.options;null!=i.duration&&(r.duration=gp(i.duration)),null!=i.delay&&(r.delay=gp(i.delay));const s=i.params;if(s){let d=r.params;d||(d=this.options.params={}),Object.keys(s).forEach(m=>{(!e||!d.hasOwnProperty(m))&&(d[m]=Ax(s[m],d,this.errors))})}}_copyOptions(){const t={};if(this.options){const e=this.options.params;if(e){const i=t.params={};Object.keys(e).forEach(r=>{i[r]=e[r]})}}return t}createSubContext(t=null,e,i){const r=e||this.element,s=new tT(this._driver,r,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(r,i||0));return s.previousNode=this.previousNode,s.currentAnimateTimings=this.currentAnimateTimings,s.options=this._copyOptions(),s.updateOptions(t),s.currentQueryIndex=this.currentQueryIndex,s.currentQueryTotal=this.currentQueryTotal,s.parentContext=this,this.subContextCount++,s}transformIntoNewTimeline(t){return this.previousNode=Bx,this.currentTimeline=this.currentTimeline.fork(this.element,t),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(t,e,i){const r={duration:null!=e?e:t.duration,delay:this.currentTimeline.currentTime+(null!=i?i:0)+t.delay,easing:""},s=new J6(this._driver,t.element,t.keyframes,t.preStyleProps,t.postStyleProps,r,t.stretchStartingKeyframe);return this.timelines.push(s),r}incrementTime(t){this.currentTimeline.forwardTime(this.currentTimeline.duration+t)}delayNextStep(t){t>0&&this.currentTimeline.delayNextStep(t)}invokeQuery(t,e,i,r,s,d){let m=[];if(r&&m.push(this.element),t.length>0){t=(t=t.replace(Z6,"."+this._enterClassName)).replace(Q6,"."+this._leaveClassName);let D=this._driver.query(this.element,t,1!=i);0!==i&&(D=i<0?D.slice(D.length+i,D.length):D.slice(0,i)),m.push(...D)}return!s&&0==m.length&&d.push(function i6(n){return new Dt(3014,!1)}()),m}}class zx{constructor(t,e,i,r){this._driver=t,this.element=e,this.startTime=i,this._elementTimelineStylesLookup=r,this.duration=0,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(e),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(e,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(t){const e=1===this._keyframes.size&&this._pendingStyles.size;this.duration||e?(this.forwardTime(this.currentTime+t),e&&this.snapshotCurrentStyles()):this.startTime+=t}fork(t,e){return this.applyStylesToKeyframe(),new zx(this._driver,t,e||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(t){this.applyStylesToKeyframe(),this.duration=t,this._loadKeyframe()}_updateStyle(t,e){this._localTimelineStyles.set(t,e),this._globalTimelineStyles.set(t,e),this._styleSummary.set(t,{time:this.currentTime,value:e})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(t){t&&this._previousKeyframe.set("easing",t);for(let[e,i]of this._globalTimelineStyles)this._backFill.set(e,i||Hd),this._currentKeyframe.set(e,Hd);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(t,e,i,r){e&&this._previousKeyframe.set("easing",e);const s=r&&r.params||{},d=function e5(n,t){const e=new Map;let i;return n.forEach(r=>{if("*"===r){i=i||t.keys();for(let s of i)e.set(s,Hd)}else bp(r,e)}),e}(t,this._globalTimelineStyles);for(let[m,v]of d){const D=Ax(v,s,i);this._pendingStyles.set(m,D),this._localTimelineStyles.has(m)||this._backFill.set(m,this._globalTimelineStyles.get(m)||Hd),this._updateStyle(m,D)}}applyStylesToKeyframe(){0!=this._pendingStyles.size&&(this._pendingStyles.forEach((t,e)=>{this._currentKeyframe.set(e,t)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((t,e)=>{this._currentKeyframe.has(e)||this._currentKeyframe.set(e,t)}))}snapshotCurrentStyles(){for(let[t,e]of this._localTimelineStyles)this._pendingStyles.set(t,e),this._updateStyle(t,e)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const t=[];for(let e in this._currentKeyframe)t.push(e);return t}mergeTimelineCollectedStyles(t){t._styleSummary.forEach((e,i)=>{const r=this._styleSummary.get(i);(!r||e.time>r.time)&&this._updateStyle(i,e.value)})}buildKeyframes(){this.applyStylesToKeyframe();const t=new Set,e=new Set,i=1===this._keyframes.size&&0===this.duration;let r=[];this._keyframes.forEach((m,v)=>{const D=bp(m,new Map,this._backFill);D.forEach((A,L)=>{"!"===A?t.add(L):A===Hd&&e.add(L)}),i||D.set("offset",v/this.duration),r.push(D)});const s=t.size?kx(t.values()):[],d=e.size?kx(e.values()):[];if(i){const m=r[0],v=new Map(m);m.set("offset",0),v.set("offset",1),r=[m,v]}return JC(this.element,r,s,d,this.duration,this.startTime,this.easing,!1)}}class J6 extends zx{constructor(t,e,i,r,s,d,m=!1){super(t,e,d.delay),this.keyframes=i,this.preStyleProps=r,this.postStyleProps=s,this._stretchStartingKeyframe=m,this.timings={duration:d.duration,delay:d.delay,easing:d.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let t=this.keyframes,{delay:e,duration:i,easing:r}=this.timings;if(this._stretchStartingKeyframe&&e){const s=[],d=i+e,m=e/d,v=bp(t[0]);v.set("offset",0),s.push(v);const D=bp(t[0]);D.set("offset",Wk(m)),s.push(D);const A=t.length-1;for(let L=1;L<=A;L++){let j=bp(t[L]);const W=j.get("offset");j.set("offset",Wk((e+W*i)/d)),s.push(j)}i=d,e=0,r="",t=s}return JC(this.element,t,this.preStyleProps,this.postStyleProps,i,e,r,!0)}}function Wk(n,t=3){const e=Math.pow(10,t-1);return Math.round(n*e)/e}class nT{}const t5=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]);class n5 extends nT{normalizePropertyName(t,e){return YC(t)}normalizeStyleValue(t,e,i,r){let s="";const d=i.toString().trim();if(t5.has(e)&&0!==i&&"0"!==i)if("number"==typeof i)s="px";else{const m=i.match(/^[+-]?[\d\.]+([a-z]*)$/);m&&0==m[1].length&&r.push(function qj(n,t){return new Dt(3005,!1)}())}return d+s}}function Xk(n,t,e,i,r,s,d,m,v,D,A,L,j){return{type:0,element:n,triggerName:t,isRemovalTransition:r,fromState:e,fromStyles:s,toState:i,toStyles:d,timelines:m,queriedElements:v,preStyleProps:D,postStyleProps:A,totalTime:L,errors:j}}const iT={};class Zk{constructor(t,e,i){this._triggerName=t,this.ast=e,this._stateStyles=i}match(t,e,i,r){return function r5(n,t,e,i,r){return n.some(s=>s(t,e,i,r))}(this.ast.matchers,t,e,i,r)}buildStyles(t,e,i){let r=this._stateStyles.get("*");return void 0!==t&&(r=this._stateStyles.get(null==t?void 0:t.toString())||r),r?r.buildStyles(e,i):new Map}build(t,e,i,r,s,d,m,v,D,A){var L;const j=[],W=this.ast.options&&this.ast.options.params||iT,we=this.buildStyles(i,m&&m.params||iT,j),Re=v&&v.params||iT,We=this.buildStyles(r,Re,j),xt=new Set,st=new Map,Bt=new Map,Tn="void"===r,ai={params:o5(Re,W),delay:null===(L=this.ast.options)||void 0===L?void 0:L.delay},Gr=A?[]:eT(t,e,this.ast.animation,s,d,we,We,ai,D,j);let Ko=0;if(Gr.forEach(Za=>{Ko=Math.max(Za.duration+Za.delay,Ko)}),j.length)return Xk(e,this._triggerName,i,r,Tn,we,We,[],[],st,Bt,Ko,j);Gr.forEach(Za=>{const ih=Za.element,rh=Bl(st,ih,new Set);Za.preStyleProps.forEach(Gu=>rh.add(Gu));const oh=Bl(Bt,ih,new Set);Za.postStyleProps.forEach(Gu=>oh.add(Gu)),ih!==e&&xt.add(ih)});const iu=kx(xt.values());return Xk(e,this._triggerName,i,r,Tn,we,We,Gr,iu,st,Bt,Ko)}}function o5(n,t){const e=Ty(t);for(const i in n)n.hasOwnProperty(i)&&null!=n[i]&&(e[i]=n[i]);return e}class s5{constructor(t,e,i){this.styles=t,this.defaultParams=e,this.normalizer=i}buildStyles(t,e){const i=new Map,r=Ty(this.defaultParams);return Object.keys(t).forEach(s=>{const d=t[s];null!==d&&(r[s]=d)}),this.styles.styles.forEach(s=>{"string"!=typeof s&&s.forEach((d,m)=>{d&&(d=Ax(d,r,e));const v=this.normalizer.normalizePropertyName(m,e);d=this.normalizer.normalizeStyleValue(m,v,d,e),i.set(v,d)})}),i}}class l5{constructor(t,e,i){this.name=t,this.ast=e,this._normalizer=i,this.transitionFactories=[],this.states=new Map,e.states.forEach(r=>{this.states.set(r.name,new s5(r.style,r.options&&r.options.params||{},i))}),Yk(this.states,"true","1"),Yk(this.states,"false","0"),e.transitions.forEach(r=>{this.transitionFactories.push(new Zk(t,r,this.states))}),this.fallbackTransition=function c5(n,t,e){return new Zk(n,{type:1,animation:{type:2,steps:[],options:null},matchers:[(d,m)=>!0],options:null,queryCount:0,depCount:0},t)}(t,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(t,e,i,r){return this.transitionFactories.find(d=>d.match(t,e,i,r))||null}matchStyles(t,e,i){return this.fallbackTransition.buildStyles(t,e,i)}}function Yk(n,t,e){n.has(t)?n.has(e)||n.set(e,n.get(t)):n.has(e)&&n.set(t,n.get(e))}const u5=new Nx;class d5{constructor(t,e,i){this.bodyNode=t,this._driver=e,this._normalizer=i,this._animations=new Map,this._playersById=new Map,this.players=[]}register(t,e){const i=[],s=QC(this._driver,e,i,[]);if(i.length)throw function u6(n){return new Dt(3503,!1)}();this._animations.set(t,s)}_buildPlayer(t,e,i){const r=t.element,s=Ik(0,this._normalizer,0,t.keyframes,e,i);return this._driver.animate(r,s,t.duration,t.delay,t.easing,[],!0)}create(t,e,i={}){const r=[],s=this._animations.get(t);let d;const m=new Map;if(s?(d=eT(this._driver,e,s,qC,Dx,new Map,new Map,i,u5,r),d.forEach(A=>{const L=Bl(m,A.element,new Map);A.postStyleProps.forEach(j=>L.set(j,null))})):(r.push(function d6(){return new Dt(3300,!1)}()),d=[]),r.length)throw function h6(n){return new Dt(3504,!1)}();m.forEach((A,L)=>{A.forEach((j,W)=>{A.set(W,this._driver.computeStyle(L,W,Hd))})});const D=mp(d.map(A=>{const L=m.get(A.element);return this._buildPlayer(A,new Map,L)}));return this._playersById.set(t,D),D.onDestroy(()=>this.destroy(t)),this.players.push(D),D}destroy(t){const e=this._getPlayer(t);e.destroy(),this._playersById.delete(t);const i=this.players.indexOf(e);i>=0&&this.players.splice(i,1)}_getPlayer(t){const e=this._playersById.get(t);if(!e)throw function p6(n){return new Dt(3301,!1)}();return e}listen(t,e,i,r){const s=UC(e,"","","");return VC(this._getPlayer(t),i,s,r),()=>{}}command(t,e,i,r){if("register"==i)return void this.register(t,r[0]);if("create"==i)return void this.create(t,e,r[0]||{});const s=this._getPlayer(t);switch(i){case"play":s.play();break;case"pause":s.pause();break;case"reset":s.reset();break;case"restart":s.restart();break;case"finish":s.finish();break;case"init":s.init();break;case"setPosition":s.setPosition(parseFloat(r[0]));break;case"destroy":this.destroy(t)}}}const Qk="ng-animate-queued",rT="ng-animate-disabled",g5=[],Kk={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},b5={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},pc="__ng_removed";class oT{constructor(t,e=""){this.namespaceId=e;const i=t&&t.hasOwnProperty("value");if(this.value=function x5(n){return null!=n?n:null}(i?t.value:t),i){const s=Ty(t);delete s.value,this.options=s}else this.options={};this.options.params||(this.options.params={})}get params(){return this.options.params}absorbOptions(t){const e=t.params;if(e){const i=this.options.params;Object.keys(e).forEach(r=>{null==i[r]&&(i[r]=e[r])})}}}const Ey="void",sT=new oT(Ey);class _5{constructor(t,e,i){this.id=t,this.hostElement=e,this._engine=i,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+t,fc(e,this._hostClassName)}listen(t,e,i,r){if(!this._triggers.has(e))throw function f6(n,t){return new Dt(3302,!1)}();if(null==i||0==i.length)throw function m6(n){return new Dt(3303,!1)}();if(!function w5(n){return"start"==n||"done"==n}(i))throw function g6(n,t){return new Dt(3400,!1)}();const s=Bl(this._elementListeners,t,[]),d={name:e,phase:i,callback:r};s.push(d);const m=Bl(this._engine.statesByElement,t,new Map);return m.has(e)||(fc(t,Ex),fc(t,Ex+"-"+e),m.set(e,sT)),()=>{this._engine.afterFlush(()=>{const v=s.indexOf(d);v>=0&&s.splice(v,1),this._triggers.has(e)||m.delete(e)})}}register(t,e){return!this._triggers.has(t)&&(this._triggers.set(t,e),!0)}_getTrigger(t){const e=this._triggers.get(t);if(!e)throw function b6(n){return new Dt(3401,!1)}();return e}trigger(t,e,i,r=!0){const s=this._getTrigger(e),d=new aT(this.id,e,t);let m=this._engine.statesByElement.get(t);m||(fc(t,Ex),fc(t,Ex+"-"+e),this._engine.statesByElement.set(t,m=new Map));let v=m.get(e);const D=new oT(i,this.id);if(!(i&&i.hasOwnProperty("value"))&&v&&D.absorbOptions(v.options),m.set(e,D),v||(v=sT),D.value!==Ey&&v.value===D.value){if(!function T5(n,t){const e=Object.keys(n),i=Object.keys(t);if(e.length!=i.length)return!1;for(let r=0;r<e.length;r++){const s=e[r];if(!t.hasOwnProperty(s)||n[s]!==t[s])return!1}return!0}(v.params,D.params)){const we=[],Re=s.matchStyles(v.value,v.params,we),We=s.matchStyles(D.value,D.params,we);we.length?this._engine.reportError(we):this._engine.afterFlush(()=>{Uf(t,Re),zu(t,We)})}return}const j=Bl(this._engine.playersByElement,t,[]);j.forEach(we=>{we.namespaceId==this.id&&we.triggerName==e&&we.queued&&we.destroy()});let W=s.matchTransition(v.value,D.value,t,D.params),ie=!1;if(!W){if(!r)return;W=s.fallbackTransition,ie=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:e,transition:W,fromState:v,toState:D,player:d,isFallbackTransition:ie}),ie||(fc(t,Qk),d.onStart(()=>{Vg(t,Qk)})),d.onDone(()=>{let we=this.players.indexOf(d);we>=0&&this.players.splice(we,1);const Re=this._engine.playersByElement.get(t);if(Re){let We=Re.indexOf(d);We>=0&&Re.splice(We,1)}}),this.players.push(d),j.push(d),d}deregister(t){this._triggers.delete(t),this._engine.statesByElement.forEach(e=>e.delete(t)),this._elementListeners.forEach((e,i)=>{this._elementListeners.set(i,e.filter(r=>r.name!=t))})}clearElementCache(t){this._engine.statesByElement.delete(t),this._elementListeners.delete(t);const e=this._engine.playersByElement.get(t);e&&(e.forEach(i=>i.destroy()),this._engine.playersByElement.delete(t))}_signalRemovalForInnerTriggers(t,e){const i=this._engine.driver.query(t,Ix,!0);i.forEach(r=>{if(r[pc])return;const s=this._engine.fetchNamespacesByElement(r);s.size?s.forEach(d=>d.triggerLeaveAnimation(r,e,!1,!0)):this.clearElementCache(r)}),this._engine.afterFlushAnimationsDone(()=>i.forEach(r=>this.clearElementCache(r)))}triggerLeaveAnimation(t,e,i,r){const s=this._engine.statesByElement.get(t),d=new Map;if(s){const m=[];if(s.forEach((v,D)=>{if(d.set(D,v.value),this._triggers.has(D)){const A=this.trigger(t,D,Ey,r);A&&m.push(A)}}),m.length)return this._engine.markElementAsRemoved(this.id,t,!0,e,d),i&&mp(m).onDone(()=>this._engine.processLeaveNode(t)),!0}return!1}prepareLeaveAnimationListeners(t){const e=this._elementListeners.get(t),i=this._engine.statesByElement.get(t);if(e&&i){const r=new Set;e.forEach(s=>{const d=s.name;if(r.has(d))return;r.add(d);const v=this._triggers.get(d).fallbackTransition,D=i.get(d)||sT,A=new oT(Ey),L=new aT(this.id,d,t);this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:d,transition:v,fromState:D,toState:A,player:L,isFallbackTransition:!0})})}}removeNode(t,e){const i=this._engine;if(t.childElementCount&&this._signalRemovalForInnerTriggers(t,e),this.triggerLeaveAnimation(t,e,!0))return;let r=!1;if(i.totalAnimations){const s=i.players.length?i.playersByQueriedElement.get(t):[];if(s&&s.length)r=!0;else{let d=t;for(;d=d.parentNode;)if(i.statesByElement.get(d)){r=!0;break}}}if(this.prepareLeaveAnimationListeners(t),r)i.markElementAsRemoved(this.id,t,!1,e);else{const s=t[pc];(!s||s===Kk)&&(i.afterFlush(()=>this.clearElementCache(t)),i.destroyInnerAnimations(t),i._onRemovalComplete(t,e))}}insertNode(t,e){fc(t,this._hostClassName)}drainQueuedTransitions(t){const e=[];return this._queue.forEach(i=>{const r=i.player;if(r.destroyed)return;const s=i.element,d=this._elementListeners.get(s);d&&d.forEach(m=>{if(m.name==i.triggerName){const v=UC(s,i.triggerName,i.fromState.value,i.toState.value);v._data=t,VC(i.player,m.phase,v,m.callback)}}),r.markedForDestroy?this._engine.afterFlush(()=>{r.destroy()}):e.push(i)}),this._queue=[],e.sort((i,r)=>{const s=i.transition.ast.depCount,d=r.transition.ast.depCount;return 0==s||0==d?s-d:this._engine.driver.containsElement(i.element,r.element)?1:-1})}destroy(t){this.players.forEach(e=>e.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,t)}elementContainsData(t){let e=!1;return this._elementListeners.has(t)&&(e=!0),e=!!this._queue.find(i=>i.element===t)||e,e}}class y5{constructor(t,e,i){this.bodyNode=t,this.driver=e,this._normalizer=i,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(r,s)=>{}}_onRemovalComplete(t,e){this.onRemovalComplete(t,e)}get queuedPlayers(){const t=[];return this._namespaceList.forEach(e=>{e.players.forEach(i=>{i.queued&&t.push(i)})}),t}createNamespace(t,e){const i=new _5(t,e,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,e)?this._balanceNamespaceList(i,e):(this.newHostElements.set(e,i),this.collectEnterElement(e)),this._namespaceLookup[t]=i}_balanceNamespaceList(t,e){const i=this._namespaceList,r=this.namespacesByHostElement;if(i.length-1>=0){let d=!1,m=this.driver.getParentElement(e);for(;m;){const v=r.get(m);if(v){const D=i.indexOf(v);i.splice(D+1,0,t),d=!0;break}m=this.driver.getParentElement(m)}d||i.unshift(t)}else i.push(t);return r.set(e,t),t}register(t,e){let i=this._namespaceLookup[t];return i||(i=this.createNamespace(t,e)),i}registerTrigger(t,e,i){let r=this._namespaceLookup[t];r&&r.register(e,i)&&this.totalAnimations++}destroy(t,e){if(!t)return;const i=this._fetchNamespace(t);this.afterFlush(()=>{this.namespacesByHostElement.delete(i.hostElement),delete this._namespaceLookup[t];const r=this._namespaceList.indexOf(i);r>=0&&this._namespaceList.splice(r,1)}),this.afterFlushAnimationsDone(()=>i.destroy(e))}_fetchNamespace(t){return this._namespaceLookup[t]}fetchNamespacesByElement(t){const e=new Set,i=this.statesByElement.get(t);if(i)for(let r of i.values())if(r.namespaceId){const s=this._fetchNamespace(r.namespaceId);s&&e.add(s)}return e}trigger(t,e,i,r){if(Vx(e)){const s=this._fetchNamespace(t);if(s)return s.trigger(e,i,r),!0}return!1}insertNode(t,e,i,r){if(!Vx(e))return;const s=e[pc];if(s&&s.setForRemoval){s.setForRemoval=!1,s.setForMove=!0;const d=this.collectedLeaveElements.indexOf(e);d>=0&&this.collectedLeaveElements.splice(d,1)}if(t){const d=this._fetchNamespace(t);d&&d.insertNode(e,i)}r&&this.collectEnterElement(e)}collectEnterElement(t){this.collectedEnterElements.push(t)}markElementAsDisabled(t,e){e?this.disabledNodes.has(t)||(this.disabledNodes.add(t),fc(t,rT)):this.disabledNodes.has(t)&&(this.disabledNodes.delete(t),Vg(t,rT))}removeNode(t,e,i,r){if(Vx(e)){const s=t?this._fetchNamespace(t):null;if(s?s.removeNode(e,r):this.markElementAsRemoved(t,e,!1,r),i){const d=this.namespacesByHostElement.get(e);d&&d.id!==t&&d.removeNode(e,r)}}else this._onRemovalComplete(e,r)}markElementAsRemoved(t,e,i,r,s){this.collectedLeaveElements.push(e),e[pc]={namespaceId:t,setForRemoval:r,hasAnimation:i,removedBeforeQueried:!1,previousTriggersValues:s}}listen(t,e,i,r,s){return Vx(e)?this._fetchNamespace(t).listen(e,i,r,s):()=>{}}_buildInstruction(t,e,i,r,s){return t.transition.build(this.driver,t.element,t.fromState.value,t.toState.value,i,r,t.fromState.options,t.toState.options,e,s)}destroyInnerAnimations(t){let e=this.driver.query(t,Ix,!0);e.forEach(i=>this.destroyActiveAnimationsForElement(i)),0!=this.playersByQueriedElement.size&&(e=this.driver.query(t,WC,!0),e.forEach(i=>this.finishActiveQueriedAnimationOnElement(i)))}destroyActiveAnimationsForElement(t){const e=this.playersByElement.get(t);e&&e.forEach(i=>{i.queued?i.markedForDestroy=!0:i.destroy()})}finishActiveQueriedAnimationOnElement(t){const e=this.playersByQueriedElement.get(t);e&&e.forEach(i=>i.finish())}whenRenderingDone(){return new Promise(t=>{if(this.players.length)return mp(this.players).onDone(()=>t());t()})}processLeaveNode(t){var e;const i=t[pc];if(i&&i.setForRemoval){if(t[pc]=Kk,i.namespaceId){this.destroyInnerAnimations(t);const r=this._fetchNamespace(i.namespaceId);r&&r.clearElementCache(t)}this._onRemovalComplete(t,i.setForRemoval)}!(null===(e=t.classList)||void 0===e)&&e.contains(rT)&&this.markElementAsDisabled(t,!1),this.driver.query(t,".ng-animate-disabled",!0).forEach(r=>{this.markElementAsDisabled(r,!1)})}flush(t=-1){let e=[];if(this.newHostElements.size&&(this.newHostElements.forEach((i,r)=>this._balanceNamespaceList(i,r)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let i=0;i<this.collectedEnterElements.length;i++)fc(this.collectedEnterElements[i],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const i=[];try{e=this._flushAnimations(i,t)}finally{for(let r=0;r<i.length;r++)i[r]()}}else for(let i=0;i<this.collectedLeaveElements.length;i++)this.processLeaveNode(this.collectedLeaveElements[i]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(i=>i()),this._flushFns=[],this._whenQuietFns.length){const i=this._whenQuietFns;this._whenQuietFns=[],e.length?mp(e).onDone(()=>{i.forEach(r=>r())}):i.forEach(r=>r())}}reportError(t){throw function _6(n){return new Dt(3402,!1)}()}_flushAnimations(t,e){const i=new Nx,r=[],s=new Map,d=[],m=new Map,v=new Map,D=new Map,A=new Set;this.disabledNodes.forEach(Bn=>{A.add(Bn);const ci=this.driver.query(Bn,".ng-animate-queued",!0);for(let wi=0;wi<ci.length;wi++)A.add(ci[wi])});const L=this.bodyNode,j=Array.from(this.statesByElement.keys()),W=tR(j,this.collectedEnterElements),ie=new Map;let we=0;W.forEach((Bn,ci)=>{const wi=qC+we++;ie.set(ci,wi),Bn.forEach(ar=>fc(ar,wi))});const Re=[],We=new Set,xt=new Set;for(let Bn=0;Bn<this.collectedLeaveElements.length;Bn++){const ci=this.collectedLeaveElements[Bn],wi=ci[pc];wi&&wi.setForRemoval&&(Re.push(ci),We.add(ci),wi.hasAnimation?this.driver.query(ci,".ng-star-inserted",!0).forEach(ar=>We.add(ar)):xt.add(ci))}const st=new Map,Bt=tR(j,Array.from(We));Bt.forEach((Bn,ci)=>{const wi=Dx+we++;st.set(ci,wi),Bn.forEach(ar=>fc(ar,wi))}),t.push(()=>{W.forEach((Bn,ci)=>{const wi=ie.get(ci);Bn.forEach(ar=>Vg(ar,wi))}),Bt.forEach((Bn,ci)=>{const wi=st.get(ci);Bn.forEach(ar=>Vg(ar,wi))}),Re.forEach(Bn=>{this.processLeaveNode(Bn)})});const Tn=[],ai=[];for(let Bn=this._namespaceList.length-1;Bn>=0;Bn--)this._namespaceList[Bn].drainQueuedTransitions(e).forEach(wi=>{const ar=wi.player,Go=wi.element;if(Tn.push(ar),this.collectedEnterElements.length){const Ea=Go[pc];if(Ea&&Ea.setForMove){if(Ea.previousTriggersValues&&Ea.previousTriggersValues.has(wi.triggerName)){const pm=Ea.previousTriggersValues.get(wi.triggerName),bc=this.statesByElement.get(wi.element);if(bc&&bc.has(wi.triggerName)){const fS=bc.get(wi.triggerName);fS.value=pm,bc.set(wi.triggerName,fS)}}return void ar.destroy()}}const qu=!L||!this.driver.containsElement(L,Go),jl=st.get(Go),Fp=ie.get(Go),Oo=this._buildInstruction(wi,i,Fp,jl,qu);if(Oo.errors&&Oo.errors.length)return void ai.push(Oo);if(qu)return ar.onStart(()=>Uf(Go,Oo.fromStyles)),ar.onDestroy(()=>zu(Go,Oo.toStyles)),void r.push(ar);if(wi.isFallbackTransition)return ar.onStart(()=>Uf(Go,Oo.fromStyles)),ar.onDestroy(()=>zu(Go,Oo.toStyles)),void r.push(ar);const XF=[];Oo.timelines.forEach(Ea=>{Ea.stretchStartingKeyframe=!0,this.disabledNodes.has(Ea.element)||XF.push(Ea)}),Oo.timelines=XF,i.append(Go,Oo.timelines),d.push({instruction:Oo,player:ar,element:Go}),Oo.queriedElements.forEach(Ea=>Bl(m,Ea,[]).push(ar)),Oo.preStyleProps.forEach((Ea,pm)=>{if(Ea.size){let bc=v.get(pm);bc||v.set(pm,bc=new Set),Ea.forEach((fS,ME)=>bc.add(ME))}}),Oo.postStyleProps.forEach((Ea,pm)=>{let bc=D.get(pm);bc||D.set(pm,bc=new Set),Ea.forEach((fS,ME)=>bc.add(ME))})});if(ai.length){const Bn=[];ai.forEach(ci=>{Bn.push(function y6(n,t){return new Dt(3505,!1)}())}),Tn.forEach(ci=>ci.destroy()),this.reportError(Bn)}const Gr=new Map,Ko=new Map;d.forEach(Bn=>{const ci=Bn.element;i.has(ci)&&(Ko.set(ci,ci),this._beforeAnimationBuild(Bn.player.namespaceId,Bn.instruction,Gr))}),r.forEach(Bn=>{const ci=Bn.element;this._getPreviousPlayers(ci,!1,Bn.namespaceId,Bn.triggerName,null).forEach(ar=>{Bl(Gr,ci,[]).push(ar),ar.destroy()})});const iu=Re.filter(Bn=>iR(Bn,v,D)),Za=new Map;eR(Za,this.driver,xt,D,Hd).forEach(Bn=>{iR(Bn,v,D)&&iu.push(Bn)});const rh=new Map;W.forEach((Bn,ci)=>{eR(rh,this.driver,new Set(Bn),v,"!")}),iu.forEach(Bn=>{var ci,wi;const ar=Za.get(Bn),Go=rh.get(Bn);Za.set(Bn,new Map([...Array.from(null!==(ci=null==ar?void 0:ar.entries())&&void 0!==ci?ci:[]),...Array.from(null!==(wi=null==Go?void 0:Go.entries())&&void 0!==wi?wi:[])]))});const oh=[],Gu=[],db={};d.forEach(Bn=>{const{element:ci,player:wi,instruction:ar}=Bn;if(i.has(ci)){if(A.has(ci))return wi.onDestroy(()=>zu(ci,ar.toStyles)),wi.disabled=!0,wi.overrideTotalTime(ar.totalTime),void r.push(wi);let Go=db;if(Ko.size>1){let jl=ci;const Fp=[];for(;jl=jl.parentNode;){const Oo=Ko.get(jl);if(Oo){Go=Oo;break}Fp.push(jl)}Fp.forEach(Oo=>Ko.set(Oo,Go))}const qu=this._buildAnimation(wi.namespaceId,ar,Gr,s,rh,Za);if(wi.setRealPlayer(qu),Go===db)oh.push(wi);else{const jl=this.playersByElement.get(Go);jl&&jl.length&&(wi.parentPlayer=mp(jl)),r.push(wi)}}else Uf(ci,ar.fromStyles),wi.onDestroy(()=>zu(ci,ar.toStyles)),Gu.push(wi),A.has(ci)&&r.push(wi)}),Gu.forEach(Bn=>{const ci=s.get(Bn.element);if(ci&&ci.length){const wi=mp(ci);Bn.setRealPlayer(wi)}}),r.forEach(Bn=>{Bn.parentPlayer?Bn.syncPlayerEvents(Bn.parentPlayer):Bn.destroy()});for(let Bn=0;Bn<Re.length;Bn++){const ci=Re[Bn],wi=ci[pc];if(Vg(ci,Dx),wi&&wi.hasAnimation)continue;let ar=[];if(m.size){let qu=m.get(ci);qu&&qu.length&&ar.push(...qu);let jl=this.driver.query(ci,WC,!0);for(let Fp=0;Fp<jl.length;Fp++){let Oo=m.get(jl[Fp]);Oo&&Oo.length&&ar.push(...Oo)}}const Go=ar.filter(qu=>!qu.destroyed);Go.length?S5(this,ci,Go):this.processLeaveNode(ci)}return Re.length=0,oh.forEach(Bn=>{this.players.push(Bn),Bn.onDone(()=>{Bn.destroy();const ci=this.players.indexOf(Bn);this.players.splice(ci,1)}),Bn.play()}),oh}elementContainsData(t,e){let i=!1;const r=e[pc];return r&&r.setForRemoval&&(i=!0),this.playersByElement.has(e)&&(i=!0),this.playersByQueriedElement.has(e)&&(i=!0),this.statesByElement.has(e)&&(i=!0),this._fetchNamespace(t).elementContainsData(e)||i}afterFlush(t){this._flushFns.push(t)}afterFlushAnimationsDone(t){this._whenQuietFns.push(t)}_getPreviousPlayers(t,e,i,r,s){let d=[];if(e){const m=this.playersByQueriedElement.get(t);m&&(d=m)}else{const m=this.playersByElement.get(t);if(m){const v=!s||s==Ey;m.forEach(D=>{D.queued||!v&&D.triggerName!=r||d.push(D)})}}return(i||r)&&(d=d.filter(m=>!(i&&i!=m.namespaceId||r&&r!=m.triggerName))),d}_beforeAnimationBuild(t,e,i){const s=e.element,d=e.isRemovalTransition?void 0:t,m=e.isRemovalTransition?void 0:e.triggerName;for(const v of e.timelines){const D=v.element,A=D!==s,L=Bl(i,D,[]);this._getPreviousPlayers(D,A,d,m,e.toState).forEach(W=>{const ie=W.getRealPlayer();ie.beforeDestroy&&ie.beforeDestroy(),W.destroy(),L.push(W)})}Uf(s,e.fromStyles)}_buildAnimation(t,e,i,r,s,d){const m=e.triggerName,v=e.element,D=[],A=new Set,L=new Set,j=e.timelines.map(ie=>{const we=ie.element;A.add(we);const Re=we[pc];if(Re&&Re.removedBeforeQueried)return new Cy(ie.duration,ie.delay);const We=we!==v,xt=function C5(n){const t=[];return nR(n,t),t}((i.get(we)||g5).map(Gr=>Gr.getRealPlayer())).filter(Gr=>!!Gr.element&&Gr.element===we),st=s.get(we),Bt=d.get(we),Tn=Ik(0,this._normalizer,0,ie.keyframes,st,Bt),ai=this._buildPlayer(ie,Tn,xt);if(ie.subTimeline&&r&&L.add(we),We){const Gr=new aT(t,m,we);Gr.setRealPlayer(ai),D.push(Gr)}return ai});D.forEach(ie=>{Bl(this.playersByQueriedElement,ie.element,[]).push(ie),ie.onDone(()=>function v5(n,t,e){let i=n.get(t);if(i){if(i.length){const r=i.indexOf(e);i.splice(r,1)}0==i.length&&n.delete(t)}return i}(this.playersByQueriedElement,ie.element,ie))}),A.forEach(ie=>fc(ie,Nk));const W=mp(j);return W.onDestroy(()=>{A.forEach(ie=>Vg(ie,Nk)),zu(v,e.toStyles)}),L.forEach(ie=>{Bl(r,ie,[]).push(W)}),W}_buildPlayer(t,e,i){return e.length>0?this.driver.animate(t.element,e,t.duration,t.delay,t.easing,i):new Cy(t.duration,t.delay)}}class aT{constructor(t,e,i){this.namespaceId=t,this.triggerName=e,this.element=i,this._player=new Cy,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(t){this._containsRealPlayer||(this._player=t,this._queuedCallbacks.forEach((e,i)=>{e.forEach(r=>VC(t,i,void 0,r))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(t.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(t){this.totalTime=t}syncPlayerEvents(t){const e=this._player;e.triggerCallback&&t.onStart(()=>e.triggerCallback("start")),t.onDone(()=>this.finish()),t.onDestroy(()=>this.destroy())}_queueEvent(t,e){Bl(this._queuedCallbacks,t,[]).push(e)}onDone(t){this.queued&&this._queueEvent("done",t),this._player.onDone(t)}onStart(t){this.queued&&this._queueEvent("start",t),this._player.onStart(t)}onDestroy(t){this.queued&&this._queueEvent("destroy",t),this._player.onDestroy(t)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(t){this.queued||this._player.setPosition(t)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(t){const e=this._player;e.triggerCallback&&e.triggerCallback(t)}}function Vx(n){return n&&1===n.nodeType}function Jk(n,t){const e=n.style.display;return n.style.display=null!=t?t:"none",e}function eR(n,t,e,i,r){const s=[];e.forEach(v=>s.push(Jk(v)));const d=[];i.forEach((v,D)=>{const A=new Map;v.forEach(L=>{const j=t.computeStyle(D,L,r);A.set(L,j),(!j||0==j.length)&&(D[pc]=b5,d.push(D))}),n.set(D,A)});let m=0;return e.forEach(v=>Jk(v,s[m++])),d}function tR(n,t){const e=new Map;if(n.forEach(m=>e.set(m,[])),0==t.length)return e;const r=new Set(t),s=new Map;function d(m){if(!m)return 1;let v=s.get(m);if(v)return v;const D=m.parentNode;return v=e.has(D)?D:r.has(D)?1:d(D),s.set(m,v),v}return t.forEach(m=>{const v=d(m);1!==v&&e.get(v).push(m)}),e}function fc(n,t){var e;null===(e=n.classList)||void 0===e||e.add(t)}function Vg(n,t){var e;null===(e=n.classList)||void 0===e||e.remove(t)}function S5(n,t,e){mp(e).onDone(()=>n.processLeaveNode(t))}function nR(n,t){for(let e=0;e<n.length;e++){const i=n[e];i instanceof Dk?nR(i.players,t):t.push(i)}}function iR(n,t,e){const i=e.get(n);if(!i)return!1;let r=t.get(n);return r?i.forEach(s=>r.add(s)):t.set(n,i),e.delete(n),!0}class jx{constructor(t,e,i){this.bodyNode=t,this._driver=e,this._normalizer=i,this._triggerCache={},this.onRemovalComplete=(r,s)=>{},this._transitionEngine=new y5(t,e,i),this._timelineEngine=new d5(t,e,i),this._transitionEngine.onRemovalComplete=(r,s)=>this.onRemovalComplete(r,s)}registerTrigger(t,e,i,r,s){const d=t+"-"+r;let m=this._triggerCache[d];if(!m){const v=[],A=QC(this._driver,s,v,[]);if(v.length)throw function l6(n,t){return new Dt(3404,!1)}();m=function a5(n,t,e){return new l5(n,t,e)}(r,A,this._normalizer),this._triggerCache[d]=m}this._transitionEngine.registerTrigger(e,r,m)}register(t,e){this._transitionEngine.register(t,e)}destroy(t,e){this._transitionEngine.destroy(t,e)}onInsert(t,e,i,r){this._transitionEngine.insertNode(t,e,i,r)}onRemove(t,e,i,r){this._transitionEngine.removeNode(t,e,r||!1,i)}disableAnimations(t,e){this._transitionEngine.markElementAsDisabled(t,e)}process(t,e,i,r){if("@"==i.charAt(0)){const[s,d]=Mk(i);this._timelineEngine.command(s,e,d,r)}else this._transitionEngine.trigger(t,e,i,r)}listen(t,e,i,r,s){if("@"==i.charAt(0)){const[d,m]=Mk(i);return this._timelineEngine.listen(d,e,m,s)}return this._transitionEngine.listen(t,e,i,r,s)}flush(t=-1){this._transitionEngine.flush(t)}get players(){return this._transitionEngine.players.concat(this._timelineEngine.players)}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}}let E5=(()=>{class n{constructor(e,i,r){this._element=e,this._startStyles=i,this._endStyles=r,this._state=0;let s=n.initialStylesByElement.get(e);s||n.initialStylesByElement.set(e,s=new Map),this._initialStyles=s}start(){this._state<1&&(this._startStyles&&zu(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(zu(this._element,this._initialStyles),this._endStyles&&(zu(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(n.initialStylesByElement.delete(this._element),this._startStyles&&(Uf(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(Uf(this._element,this._endStyles),this._endStyles=null),zu(this._element,this._initialStyles),this._state=3)}}return n.initialStylesByElement=new WeakMap,n})();function lT(n){let t=null;return n.forEach((e,i)=>{(function I5(n){return"display"===n||"position"===n})(i)&&(t=t||new Map,t.set(i,e))}),t}class rR{constructor(t,e,i,r){this.element=t,this.keyframes=e,this.options=i,this._specialStyles=r,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=i.duration,this._delay=i.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const t=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,t,this.options),this._finalKeyframe=t.length?t[t.length-1]:new Map,this.domPlayer.addEventListener("finish",()=>this._onFinish())}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(t){const e=[];return t.forEach(i=>{e.push(Object.fromEntries(i))}),e}_triggerWebAnimation(t,e,i){return t.animate(this._convertKeyframesToObject(e),i)}onStart(t){this._originalOnStartFns.push(t),this._onStartFns.push(t)}onDone(t){this._originalOnDoneFns.push(t),this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(t=>t()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}setPosition(t){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=t*this.time}getPosition(){return this.domPlayer.currentTime/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const t=new Map;this.hasStarted()&&this._finalKeyframe.forEach((i,r)=>{"offset"!==r&&t.set(r,this._finished?i:Hk(this.element,r))}),this.currentSnapshot=t}triggerCallback(t){const e="start"===t?this._onStartFns:this._onDoneFns;e.forEach(i=>i()),e.length=0}}class M5{validateStyleProperty(t){return!0}validateAnimatableStyleProperty(t){return!0}matchesElement(t,e){return!1}containsElement(t,e){return Pk(t,e)}getParentElement(t){return $C(t)}query(t,e,i){return Ok(t,e,i)}computeStyle(t,e,i){return window.getComputedStyle(t)[e]}animate(t,e,i,r,s,d=[]){const v={duration:i,delay:r,fill:0==r?"both":"forwards"};s&&(v.easing=s);const D=new Map,A=d.filter(W=>W instanceof rR);(function R6(n,t){return 0===n||0===t})(i,r)&&A.forEach(W=>{W.currentSnapshot.forEach((ie,we)=>D.set(we,ie))});let L=function I6(n){return n.length?n[0]instanceof Map?n:n.map(t=>Bk(t)):[]}(e).map(W=>bp(W));L=function P6(n,t,e){if(e.size&&t.length){let i=t[0],r=[];if(e.forEach((s,d)=>{i.has(d)||r.push(d),i.set(d,s)}),r.length)for(let s=1;s<t.length;s++){let d=t[s];r.forEach(m=>d.set(m,Hk(n,m)))}}return t}(t,L,D);const j=function D5(n,t){let e=null,i=null;return Array.isArray(t)&&t.length?(e=lT(t[0]),t.length>1&&(i=lT(t[t.length-1]))):t instanceof Map&&(e=lT(t)),e||i?new E5(n,e,i):null}(t,L);return new rR(t,L,v,j)}}let A5=(()=>{class n extends wk{constructor(e,i){super(),this._nextAnimationId=0,this._renderer=e.createRenderer(i.body,{id:"0",encapsulation:Gs.None,styles:[],data:{animation:[]}})}build(e){const i=this._nextAnimationId.toString();this._nextAnimationId++;const r=Array.isArray(e)?Ck(e):e;return oR(this._renderer,null,i,"register",[r]),new k5(i,this._renderer)}}return n.\u0275fac=function(e){return new(e||n)(Be(uy),Be(si))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();class k5 extends class Vj{}{constructor(t,e){super(),this._id=t,this._renderer=e}create(t,e){return new R5(this._id,t,e||{},this._renderer)}}class R5{constructor(t,e,i,r){this.id=t,this.element=e,this._renderer=r,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",i)}_listen(t,e){return this._renderer.listen(this.element,`@@${this.id}:${t}`,e)}_command(t,...e){return oR(this._renderer,this.element,this.id,t,e)}onDone(t){this._listen("done",t)}onStart(t){this._listen("start",t)}onDestroy(t){this._listen("destroy",t)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset"),this._started=!1}setPosition(t){this._command("setPosition",t)}getPosition(){var t,e;return null!==(e=null===(t=this._renderer.engine.players[+this.id])||void 0===t?void 0:t.getPosition())&&void 0!==e?e:0}}function oR(n,t,e,i,r){return n.setProperty(t,`@@${e}:${i}`,r)}const sR="@.disabled";let P5=(()=>{class n{constructor(e,i,r){this.delegate=e,this.engine=i,this._zone=r,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,this.promise=Promise.resolve(0),i.onRemovalComplete=(s,d)=>{const m=null==d?void 0:d.parentNode(s);m&&d.removeChild(m,s)}}createRenderer(e,i){const s=this.delegate.createRenderer(e,i);if(!(e&&i&&i.data&&i.data.animation)){let A=this._rendererCache.get(s);return A||(A=new aR("",s,this.engine),this._rendererCache.set(s,A)),A}const d=i.id,m=i.id+"-"+this._currentId;this._currentId++,this.engine.register(m,e);const v=A=>{Array.isArray(A)?A.forEach(v):this.engine.registerTrigger(d,m,e,A.name,A)};return i.data.animation.forEach(v),new O5(this,m,s,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){this.promise.then(()=>{this._microtaskId++})}scheduleListenerCallback(e,i,r){e>=0&&e<this._microtaskId?this._zone.run(()=>i(r)):(0==this._animationCallbacksBuffer.length&&Promise.resolve(null).then(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(s=>{const[d,m]=s;d(m)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([i,r]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}return n.\u0275fac=function(e){return new(e||n)(Be(uy),Be(jx),Be(oi))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();class aR{constructor(t,e,i){this.namespaceId=t,this.delegate=e,this.engine=i,this.destroyNode=this.delegate.destroyNode?r=>e.destroyNode(r):null}get data(){return this.delegate.data}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.delegate.destroy()}createElement(t,e){return this.delegate.createElement(t,e)}createComment(t){return this.delegate.createComment(t)}createText(t){return this.delegate.createText(t)}appendChild(t,e){this.delegate.appendChild(t,e),this.engine.onInsert(this.namespaceId,e,t,!1)}insertBefore(t,e,i,r=!0){this.delegate.insertBefore(t,e,i),this.engine.onInsert(this.namespaceId,e,t,r)}removeChild(t,e,i){this.engine.onRemove(this.namespaceId,e,this.delegate,i)}selectRootElement(t,e){return this.delegate.selectRootElement(t,e)}parentNode(t){return this.delegate.parentNode(t)}nextSibling(t){return this.delegate.nextSibling(t)}setAttribute(t,e,i,r){this.delegate.setAttribute(t,e,i,r)}removeAttribute(t,e,i){this.delegate.removeAttribute(t,e,i)}addClass(t,e){this.delegate.addClass(t,e)}removeClass(t,e){this.delegate.removeClass(t,e)}setStyle(t,e,i,r){this.delegate.setStyle(t,e,i,r)}removeStyle(t,e,i){this.delegate.removeStyle(t,e,i)}setProperty(t,e,i){"@"==e.charAt(0)&&e==sR?this.disableAnimations(t,!!i):this.delegate.setProperty(t,e,i)}setValue(t,e){this.delegate.setValue(t,e)}listen(t,e,i){return this.delegate.listen(t,e,i)}disableAnimations(t,e){this.engine.disableAnimations(t,e)}}class O5 extends aR{constructor(t,e,i,r){super(e,i,r),this.factory=t,this.namespaceId=e}setProperty(t,e,i){"@"==e.charAt(0)?"."==e.charAt(1)&&e==sR?this.disableAnimations(t,i=void 0===i||!!i):this.engine.process(this.namespaceId,t,e.slice(1),i):this.delegate.setProperty(t,e,i)}listen(t,e,i){if("@"==e.charAt(0)){const r=function L5(n){switch(n){case"body":return document.body;case"document":return document;case"window":return window;default:return n}}(t);let s=e.slice(1),d="";return"@"!=s.charAt(0)&&([s,d]=function F5(n){const t=n.indexOf(".");return[n.substring(0,t),n.slice(t+1)]}(s)),this.engine.listen(this.namespaceId,r,s,d,m=>{this.factory.scheduleListenerCallback(m._data||-1,i,m)})}return this.delegate.listen(t,e,i)}}const lR=[{provide:wk,useClass:A5},{provide:nT,useFactory:function B5(){return new n5}},{provide:jx,useClass:(()=>{class n extends jx{constructor(e,i,r,s){super(e.body,i,r)}ngOnDestroy(){this.flush()}}return n.\u0275fac=function(e){return new(e||n)(Be(si),Be(GC),Be(nT),Be(Ng))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})()},{provide:uy,useFactory:function z5(n,t,e){return new P5(n,t,e)},deps:[Tx,jx,oi]}],cR=[{provide:GC,useFactory:()=>new M5},{provide:Lu,useValue:"BrowserAnimations"},...lR],V5=[{provide:GC,useClass:Lk},{provide:Lu,useValue:"NoopAnimations"},...lR];let j5=(()=>{class n{static withConfig(e){return{ngModule:n,providers:e.disableAnimations?V5:cR}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({providers:cR,imports:[gk]}),n})();function ei(...n){return vo(n,pi(n))}function jg(n,t){return Fe(t)?ke(n,t,1):ke(n,1)}function Er(n,t){return di((e,i)=>{let r=0;e.subscribe(Tt(i,s=>n.call(t,s,r++)&&i.next(s)))})}class uR{}class dR{}class $d{constructor(t){this.normalizedNames=new Map,this.lazyUpdate=null,t?this.lazyInit="string"==typeof t?()=>{this.headers=new Map,t.split("\n").forEach(e=>{const i=e.indexOf(":");if(i>0){const r=e.slice(0,i),s=r.toLowerCase(),d=e.slice(i+1).trim();this.maybeSetNormalizedName(r,s),this.headers.has(s)?this.headers.get(s).push(d):this.headers.set(s,[d])}})}:()=>{this.headers=new Map,Object.keys(t).forEach(e=>{let i=t[e];const r=e.toLowerCase();"string"==typeof i&&(i=[i]),i.length>0&&(this.headers.set(r,i),this.maybeSetNormalizedName(e,r))})}:this.headers=new Map}has(t){return this.init(),this.headers.has(t.toLowerCase())}get(t){this.init();const e=this.headers.get(t.toLowerCase());return e&&e.length>0?e[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(t){return this.init(),this.headers.get(t.toLowerCase())||null}append(t,e){return this.clone({name:t,value:e,op:"a"})}set(t,e){return this.clone({name:t,value:e,op:"s"})}delete(t,e){return this.clone({name:t,value:e,op:"d"})}maybeSetNormalizedName(t,e){this.normalizedNames.has(e)||this.normalizedNames.set(e,t)}init(){this.lazyInit&&(this.lazyInit instanceof $d?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(t=>this.applyUpdate(t)),this.lazyUpdate=null))}copyFrom(t){t.init(),Array.from(t.headers.keys()).forEach(e=>{this.headers.set(e,t.headers.get(e)),this.normalizedNames.set(e,t.normalizedNames.get(e))})}clone(t){const e=new $d;return e.lazyInit=this.lazyInit&&this.lazyInit instanceof $d?this.lazyInit:this,e.lazyUpdate=(this.lazyUpdate||[]).concat([t]),e}applyUpdate(t){const e=t.name.toLowerCase();switch(t.op){case"a":case"s":let i=t.value;if("string"==typeof i&&(i=[i]),0===i.length)return;this.maybeSetNormalizedName(t.name,e);const r=("a"===t.op?this.headers.get(e):void 0)||[];r.push(...i),this.headers.set(e,r);break;case"d":const s=t.value;if(s){let d=this.headers.get(e);if(!d)return;d=d.filter(m=>-1===s.indexOf(m)),0===d.length?(this.headers.delete(e),this.normalizedNames.delete(e)):this.headers.set(e,d)}else this.headers.delete(e),this.normalizedNames.delete(e)}}forEach(t){this.init(),Array.from(this.normalizedNames.keys()).forEach(e=>t(this.normalizedNames.get(e),this.headers.get(e)))}}class U5{encodeKey(t){return hR(t)}encodeValue(t){return hR(t)}decodeKey(t){return decodeURIComponent(t)}decodeValue(t){return decodeURIComponent(t)}}const $5=/%(\d[a-f0-9])/gi,G5={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function hR(n){return encodeURIComponent(n).replace($5,(t,e)=>{var i;return null!==(i=G5[e])&&void 0!==i?i:t})}function Hx(n){return`${n}`}class _p{constructor(t={}){if(this.updates=null,this.cloneFrom=null,this.encoder=t.encoder||new U5,t.fromString){if(t.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function H5(n,t){const e=new Map;return n.length>0&&n.replace(/^\?/,"").split("&").forEach(r=>{const s=r.indexOf("="),[d,m]=-1==s?[t.decodeKey(r),""]:[t.decodeKey(r.slice(0,s)),t.decodeValue(r.slice(s+1))],v=e.get(d)||[];v.push(m),e.set(d,v)}),e}(t.fromString,this.encoder)}else t.fromObject?(this.map=new Map,Object.keys(t.fromObject).forEach(e=>{const i=t.fromObject[e],r=Array.isArray(i)?i.map(Hx):[Hx(i)];this.map.set(e,r)})):this.map=null}has(t){return this.init(),this.map.has(t)}get(t){this.init();const e=this.map.get(t);return e?e[0]:null}getAll(t){return this.init(),this.map.get(t)||null}keys(){return this.init(),Array.from(this.map.keys())}append(t,e){return this.clone({param:t,value:e,op:"a"})}appendAll(t){const e=[];return Object.keys(t).forEach(i=>{const r=t[i];Array.isArray(r)?r.forEach(s=>{e.push({param:i,value:s,op:"a"})}):e.push({param:i,value:r,op:"a"})}),this.clone(e)}set(t,e){return this.clone({param:t,value:e,op:"s"})}delete(t,e){return this.clone({param:t,value:e,op:"d"})}toString(){return this.init(),this.keys().map(t=>{const e=this.encoder.encodeKey(t);return this.map.get(t).map(i=>e+"="+this.encoder.encodeValue(i)).join("&")}).filter(t=>""!==t).join("&")}clone(t){const e=new _p({encoder:this.encoder});return e.cloneFrom=this.cloneFrom||this,e.updates=(this.updates||[]).concat(t),e}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(t=>this.map.set(t,this.cloneFrom.map.get(t))),this.updates.forEach(t=>{switch(t.op){case"a":case"s":const e=("a"===t.op?this.map.get(t.param):void 0)||[];e.push(Hx(t.value)),this.map.set(t.param,e);break;case"d":if(void 0===t.value){this.map.delete(t.param);break}{let i=this.map.get(t.param)||[];const r=i.indexOf(Hx(t.value));-1!==r&&i.splice(r,1),i.length>0?this.map.set(t.param,i):this.map.delete(t.param)}}}),this.cloneFrom=this.updates=null)}}class q5{constructor(){this.map=new Map}set(t,e){return this.map.set(t,e),this}get(t){return this.map.has(t)||this.map.set(t,t.defaultValue()),this.map.get(t)}delete(t){return this.map.delete(t),this}has(t){return this.map.has(t)}keys(){return this.map.keys()}}function pR(n){return"undefined"!=typeof ArrayBuffer&&n instanceof ArrayBuffer}function fR(n){return"undefined"!=typeof Blob&&n instanceof Blob}function mR(n){return"undefined"!=typeof FormData&&n instanceof FormData}class Iy{constructor(t,e,i,r){let s;if(this.url=e,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=t.toUpperCase(),function W5(n){switch(n){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||r?(this.body=void 0!==i?i:null,s=r):s=i,s&&(this.reportProgress=!!s.reportProgress,this.withCredentials=!!s.withCredentials,s.responseType&&(this.responseType=s.responseType),s.headers&&(this.headers=s.headers),s.context&&(this.context=s.context),s.params&&(this.params=s.params)),this.headers||(this.headers=new $d),this.context||(this.context=new q5),this.params){const d=this.params.toString();if(0===d.length)this.urlWithParams=e;else{const m=e.indexOf("?");this.urlWithParams=e+(-1===m?"?":m<e.length-1?"&":"")+d}}else this.params=new _p,this.urlWithParams=e}serializeBody(){return null===this.body?null:pR(this.body)||fR(this.body)||mR(this.body)||function X5(n){return"undefined"!=typeof URLSearchParams&&n instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof _p?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||mR(this.body)?null:fR(this.body)?this.body.type||null:pR(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof _p?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(t={}){var e;const i=t.method||this.method,r=t.url||this.url,s=t.responseType||this.responseType,d=void 0!==t.body?t.body:this.body,m=void 0!==t.withCredentials?t.withCredentials:this.withCredentials,v=void 0!==t.reportProgress?t.reportProgress:this.reportProgress;let D=t.headers||this.headers,A=t.params||this.params;const L=null!==(e=t.context)&&void 0!==e?e:this.context;return void 0!==t.setHeaders&&(D=Object.keys(t.setHeaders).reduce((j,W)=>j.set(W,t.setHeaders[W]),D)),t.setParams&&(A=Object.keys(t.setParams).reduce((j,W)=>j.set(W,t.setParams[W]),A)),new Iy(i,r,d,{params:A,headers:D,context:L,reportProgress:v,responseType:s,withCredentials:m})}}var gs=(()=>((gs=gs||{})[gs.Sent=0]="Sent",gs[gs.UploadProgress=1]="UploadProgress",gs[gs.ResponseHeader=2]="ResponseHeader",gs[gs.DownloadProgress=3]="DownloadProgress",gs[gs.Response=4]="Response",gs[gs.User=5]="User",gs))();class cT{constructor(t,e=200,i="OK"){this.headers=t.headers||new $d,this.status=void 0!==t.status?t.status:e,this.statusText=t.statusText||i,this.url=t.url||null,this.ok=this.status>=200&&this.status<300}}class uT extends cT{constructor(t={}){super(t),this.type=gs.ResponseHeader}clone(t={}){return new uT({headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class $x extends cT{constructor(t={}){super(t),this.type=gs.Response,this.body=void 0!==t.body?t.body:null}clone(t={}){return new $x({body:void 0!==t.body?t.body:this.body,headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class gR extends cT{constructor(t){super(t,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${t.url||"(unknown url)"}`:`Http failure response for ${t.url||"(unknown url)"}: ${t.status} ${t.statusText}`,this.error=t.error||null}}function dT(n,t){return{body:t,headers:n.headers,context:n.context,observe:n.observe,params:n.params,reportProgress:n.reportProgress,responseType:n.responseType,withCredentials:n.withCredentials}}let bR=(()=>{class n{constructor(e){this.handler=e}request(e,i,r={}){let s;if(e instanceof Iy)s=e;else{let v,D;v=r.headers instanceof $d?r.headers:new $d(r.headers),r.params&&(D=r.params instanceof _p?r.params:new _p({fromObject:r.params})),s=new Iy(e,i,void 0!==r.body?r.body:null,{headers:v,context:r.context,params:D,reportProgress:r.reportProgress,responseType:r.responseType||"json",withCredentials:r.withCredentials})}const d=ei(s).pipe(jg(v=>this.handler.handle(v)));if(e instanceof Iy||"events"===r.observe)return d;const m=d.pipe(Er(v=>v instanceof $x));switch(r.observe||"body"){case"body":switch(s.responseType){case"arraybuffer":return m.pipe(Hn(v=>{if(null!==v.body&&!(v.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return v.body}));case"blob":return m.pipe(Hn(v=>{if(null!==v.body&&!(v.body instanceof Blob))throw new Error("Response is not a Blob.");return v.body}));case"text":return m.pipe(Hn(v=>{if(null!==v.body&&"string"!=typeof v.body)throw new Error("Response is not a string.");return v.body}));default:return m.pipe(Hn(v=>v.body))}case"response":return m;default:throw new Error(`Unreachable: unhandled observe type ${r.observe}}`)}}delete(e,i={}){return this.request("DELETE",e,i)}get(e,i={}){return this.request("GET",e,i)}head(e,i={}){return this.request("HEAD",e,i)}jsonp(e,i){return this.request("JSONP",e,{params:(new _p).append(i,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(e,i={}){return this.request("OPTIONS",e,i)}patch(e,i,r={}){return this.request("PATCH",e,dT(r,i))}post(e,i,r={}){return this.request("POST",e,dT(r,i))}put(e,i,r={}){return this.request("PUT",e,dT(r,i))}}return n.\u0275fac=function(e){return new(e||n)(Be(uR))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();class _R{constructor(t,e){this.next=t,this.interceptor=e}handle(t){return this.interceptor.intercept(t,this.next)}}const yR=new bt("HTTP_INTERCEPTORS");let Z5=(()=>{class n{intercept(e,i){return i.handle(e)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();const Y5=/^\)\]\}',?\n/;let vR=(()=>{class n{constructor(e){this.xhrFactory=e}handle(e){if("JSONP"===e.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new en(i=>{const r=this.xhrFactory.build();if(r.open(e.method,e.urlWithParams),e.withCredentials&&(r.withCredentials=!0),e.headers.forEach((W,ie)=>r.setRequestHeader(W,ie.join(","))),e.headers.has("Accept")||r.setRequestHeader("Accept","application/json, text/plain, */*"),!e.headers.has("Content-Type")){const W=e.detectContentTypeHeader();null!==W&&r.setRequestHeader("Content-Type",W)}if(e.responseType){const W=e.responseType.toLowerCase();r.responseType="json"!==W?W:"text"}const s=e.serializeBody();let d=null;const m=()=>{if(null!==d)return d;const W=r.statusText||"OK",ie=new $d(r.getAllResponseHeaders()),we=function Q5(n){return"responseURL"in n&&n.responseURL?n.responseURL:/^X-Request-URL:/m.test(n.getAllResponseHeaders())?n.getResponseHeader("X-Request-URL"):null}(r)||e.url;return d=new uT({headers:ie,status:r.status,statusText:W,url:we}),d},v=()=>{let{headers:W,status:ie,statusText:we,url:Re}=m(),We=null;204!==ie&&(We=void 0===r.response?r.responseText:r.response),0===ie&&(ie=We?200:0);let xt=ie>=200&&ie<300;if("json"===e.responseType&&"string"==typeof We){const st=We;We=We.replace(Y5,"");try{We=""!==We?JSON.parse(We):null}catch(Bt){We=st,xt&&(xt=!1,We={error:Bt,text:We})}}xt?(i.next(new $x({body:We,headers:W,status:ie,statusText:we,url:Re||void 0})),i.complete()):i.error(new gR({error:We,headers:W,status:ie,statusText:we,url:Re||void 0}))},D=W=>{const{url:ie}=m(),we=new gR({error:W,status:r.status||0,statusText:r.statusText||"Unknown Error",url:ie||void 0});i.error(we)};let A=!1;const L=W=>{A||(i.next(m()),A=!0);let ie={type:gs.DownloadProgress,loaded:W.loaded};W.lengthComputable&&(ie.total=W.total),"text"===e.responseType&&!!r.responseText&&(ie.partialText=r.responseText),i.next(ie)},j=W=>{let ie={type:gs.UploadProgress,loaded:W.loaded};W.lengthComputable&&(ie.total=W.total),i.next(ie)};return r.addEventListener("load",v),r.addEventListener("error",D),r.addEventListener("timeout",D),r.addEventListener("abort",D),e.reportProgress&&(r.addEventListener("progress",L),null!==s&&r.upload&&r.upload.addEventListener("progress",j)),r.send(s),i.next({type:gs.Sent}),()=>{r.removeEventListener("error",D),r.removeEventListener("abort",D),r.removeEventListener("load",v),r.removeEventListener("timeout",D),e.reportProgress&&(r.removeEventListener("progress",L),null!==s&&r.upload&&r.upload.removeEventListener("progress",j)),r.readyState!==r.DONE&&r.abort()}})}}return n.\u0275fac=function(e){return new(e||n)(Be(ek))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();const hT=new bt("XSRF_COOKIE_NAME"),pT=new bt("XSRF_HEADER_NAME");class xR{}let K5=(()=>{class n{constructor(e,i,r){this.doc=e,this.platform=i,this.cookieName=r,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const e=this.doc.cookie||"";return e!==this.lastCookieString&&(this.parseCount++,this.lastToken=jA(e,this.cookieName),this.lastCookieString=e),this.lastToken}}return n.\u0275fac=function(e){return new(e||n)(Be(si),Be(ix),Be(hT))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})(),fT=(()=>{class n{constructor(e,i){this.tokenService=e,this.headerName=i}intercept(e,i){const r=e.url.toLowerCase();if("GET"===e.method||"HEAD"===e.method||r.startsWith("http://")||r.startsWith("https://"))return i.handle(e);const s=this.tokenService.getToken();return null!==s&&!e.headers.has(this.headerName)&&(e=e.clone({headers:e.headers.set(this.headerName,s)})),i.handle(e)}}return n.\u0275fac=function(e){return new(e||n)(Be(xR),Be(pT))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})(),J5=(()=>{class n{constructor(e,i){this.backend=e,this.injector=i,this.chain=null}handle(e){if(null===this.chain){const i=this.injector.get(yR,[]);this.chain=i.reduceRight((r,s)=>new _R(r,s),this.backend)}return this.chain.handle(e)}}return n.\u0275fac=function(e){return new(e||n)(Be(dR),Be(xr))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})(),e4=(()=>{class n{static disable(){return{ngModule:n,providers:[{provide:fT,useClass:Z5}]}}static withOptions(e={}){return{ngModule:n,providers:[e.cookieName?{provide:hT,useValue:e.cookieName}:[],e.headerName?{provide:pT,useValue:e.headerName}:[]]}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({providers:[fT,{provide:yR,useExisting:fT,multi:!0},{provide:xR,useClass:K5},{provide:hT,useValue:"XSRF-TOKEN"},{provide:pT,useValue:"X-XSRF-TOKEN"}]}),n})(),t4=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({providers:[bR,{provide:uR,useClass:J5},vR,{provide:dR,useExisting:vR}],imports:[e4.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]}),n})();const{isArray:n4}=Array,{getPrototypeOf:r4,prototype:o4,keys:s4}=Object;function wR(n){if(1===n.length){const t=n[0];if(n4(t))return{args:t,keys:null};if(function a4(n){return n&&"object"==typeof n&&r4(n)===o4}(t)){const e=s4(t);return{args:e.map(i=>t[i]),keys:e}}}return{args:n,keys:null}}const{isArray:l4}=Array;function mT(n){return Hn(t=>function c4(n,t){return l4(t)?n(...t):n(t)}(n,t))}function SR(n,t){return n.reduce((e,i,r)=>(e[i]=t[r],e),{})}function CR(...n){const t=Xn(n),{args:e,keys:i}=wR(n),r=new en(s=>{const{length:d}=e;if(!d)return void s.complete();const m=new Array(d);let v=d,D=d;for(let A=0;A<d;A++){let L=!1;li(e[A]).subscribe(Tt(s,j=>{L||(L=!0,D--),m[A]=j},()=>v--,void 0,()=>{(!v||!L)&&(D||s.next(i?SR(i,m):m),s.complete())}))}});return t?r.pipe(mT(t)):r}let TR=(()=>{class n{constructor(e,i){this._renderer=e,this._elementRef=i,this.onChange=r=>{},this.onTouched=()=>{}}setProperty(e,i){this._renderer.setProperty(this._elementRef.nativeElement,e,i)}registerOnTouched(e){this.onTouched=e}registerOnChange(e){this.onChange=e}setDisabledState(e){this.setProperty("disabled",e)}}return n.\u0275fac=function(e){return new(e||n)($(Ou),$(Pn))},n.\u0275dir=vt({type:n}),n})(),$f=(()=>{class n extends TR{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=ui(n)))(i||n)}}(),n.\u0275dir=vt({type:n,features:[ut]}),n})();const Ga=new bt("NgValueAccessor"),d4={provide:Ga,useExisting:Ri(()=>Gd),multi:!0},p4=new bt("CompositionEventMode");let Gd=(()=>{class n extends TR{constructor(e,i,r){super(e,i),this._compositionMode=r,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function h4(){const n=Bu()?Bu().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}())}writeValue(e){this.setProperty("value",null==e?"":e)}_handleInput(e){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(e)}_compositionStart(){this._composing=!0}_compositionEnd(e){this._composing=!1,this._compositionMode&&this.onChange(e)}}return n.\u0275fac=function(e){return new(e||n)($(Ou),$(Pn),$(p4,8))},n.\u0275dir=vt({type:n,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(e,i){1&e&&Wt("input",function(s){return i._handleInput(s.target.value)})("blur",function(){return i.onTouched()})("compositionstart",function(){return i._compositionStart()})("compositionend",function(s){return i._compositionEnd(s.target.value)})},features:[Kn([d4]),ut]}),n})();function yp(n){return null==n||("string"==typeof n||Array.isArray(n))&&0===n.length}function ER(n){return null!=n&&"number"==typeof n.length}const js=new bt("NgValidators"),vp=new bt("NgAsyncValidators"),m4=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class IR{static min(t){return function MR(n){return t=>{if(yp(t.value)||yp(n))return null;const e=parseFloat(t.value);return!isNaN(e)&&e<n?{min:{min:n,actual:t.value}}:null}}(t)}static max(t){return function AR(n){return t=>{if(yp(t.value)||yp(n))return null;const e=parseFloat(t.value);return!isNaN(e)&&e>n?{max:{max:n,actual:t.value}}:null}}(t)}static required(t){return kR(t)}static requiredTrue(t){return RR(t)}static email(t){return function PR(n){return yp(n.value)||m4.test(n.value)?null:{email:!0}}(t)}static minLength(t){return function OR(n){return t=>yp(t.value)||!ER(t.value)?null:t.value.length<n?{minlength:{requiredLength:n,actualLength:t.value.length}}:null}(t)}static maxLength(t){return function LR(n){return t=>ER(t.value)&&t.value.length>n?{maxlength:{requiredLength:n,actualLength:t.value.length}}:null}(t)}static pattern(t){return function FR(n){if(!n)return Gx;let t,e;return"string"==typeof n?(e="","^"!==n.charAt(0)&&(e+="^"),e+=n,"$"!==n.charAt(n.length-1)&&(e+="$"),t=new RegExp(e)):(e=n.toString(),t=n),i=>{if(yp(i.value))return null;const r=i.value;return t.test(r)?null:{pattern:{requiredPattern:e,actualValue:r}}}}(t)}static nullValidator(t){return null}static compose(t){return UR(t)}static composeAsync(t){return HR(t)}}function kR(n){return yp(n.value)?{required:!0}:null}function RR(n){return!0===n.value?null:{required:!0}}function Gx(n){return null}function NR(n){return null!=n}function BR(n){return ny(n)?vo(n):n}function zR(n){let t={};return n.forEach(e=>{t=null!=e?Object.assign(Object.assign({},t),e):t}),0===Object.keys(t).length?null:t}function VR(n,t){return t.map(e=>e(n))}function jR(n){return n.map(t=>function g4(n){return!n.validate}(t)?t:e=>t.validate(e))}function UR(n){if(!n)return null;const t=n.filter(NR);return 0==t.length?null:function(e){return zR(VR(e,t))}}function gT(n){return null!=n?UR(jR(n)):null}function HR(n){if(!n)return null;const t=n.filter(NR);return 0==t.length?null:function(e){return CR(VR(e,t).map(BR)).pipe(Hn(zR))}}function bT(n){return null!=n?HR(jR(n)):null}function $R(n,t){return null===n?[t]:Array.isArray(n)?[...n,t]:[n,t]}function GR(n){return n._rawValidators}function qR(n){return n._rawAsyncValidators}function _T(n){return n?Array.isArray(n)?n:[n]:[]}function qx(n,t){return Array.isArray(n)?n.includes(t):n===t}function WR(n,t){const e=_T(t);return _T(n).forEach(r=>{qx(e,r)||e.push(r)}),e}function XR(n,t){return _T(t).filter(e=>!qx(n,e))}class ZR{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(t){this._rawValidators=t||[],this._composedValidatorFn=gT(this._rawValidators)}_setAsyncValidators(t){this._rawAsyncValidators=t||[],this._composedAsyncValidatorFn=bT(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(t){this._onDestroyCallbacks.push(t)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(t=>t()),this._onDestroyCallbacks=[]}reset(t){this.control&&this.control.reset(t)}hasError(t,e){return!!this.control&&this.control.hasError(t,e)}getError(t,e){return this.control?this.control.getError(t,e):null}}class Vl extends ZR{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class qa extends ZR{get formDirective(){return null}get path(){return null}}let Gf=(()=>{class n extends class YR{constructor(t){this._cd=t}get isTouched(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.touched)}get isUntouched(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.untouched)}get isPristine(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.pristine)}get isDirty(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.dirty)}get isValid(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.valid)}get isInvalid(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.invalid)}get isPending(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.pending)}get isSubmitted(){var t;return!(null===(t=this._cd)||void 0===t||!t.submitted)}}{constructor(e){super(e)}}return n.\u0275fac=function(e){return new(e||n)($(Vl,2))},n.\u0275dir=vt({type:n,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(e,i){2&e&&Oi("ng-untouched",i.isUntouched)("ng-touched",i.isTouched)("ng-pristine",i.isPristine)("ng-dirty",i.isDirty)("ng-valid",i.isValid)("ng-invalid",i.isInvalid)("ng-pending",i.isPending)},features:[ut]}),n})();const My="VALID",Xx="INVALID",Ug="PENDING",Ay="DISABLED";function wT(n){return(Zx(n)?n.validators:n)||null}function KR(n){return Array.isArray(n)?gT(n):n||null}function ST(n,t){return(Zx(t)?t.asyncValidators:n)||null}function JR(n){return Array.isArray(n)?bT(n):n||null}function Zx(n){return null!=n&&!Array.isArray(n)&&"object"==typeof n}class nP{constructor(t,e){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=t,this._rawAsyncValidators=e,this._composedValidatorFn=KR(this._rawValidators),this._composedAsyncValidatorFn=JR(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(t){this._rawValidators=this._composedValidatorFn=t}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(t){this._rawAsyncValidators=this._composedAsyncValidatorFn=t}get parent(){return this._parent}get valid(){return this.status===My}get invalid(){return this.status===Xx}get pending(){return this.status==Ug}get disabled(){return this.status===Ay}get enabled(){return this.status!==Ay}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(t){this._rawValidators=t,this._composedValidatorFn=KR(t)}setAsyncValidators(t){this._rawAsyncValidators=t,this._composedAsyncValidatorFn=JR(t)}addValidators(t){this.setValidators(WR(t,this._rawValidators))}addAsyncValidators(t){this.setAsyncValidators(WR(t,this._rawAsyncValidators))}removeValidators(t){this.setValidators(XR(t,this._rawValidators))}removeAsyncValidators(t){this.setAsyncValidators(XR(t,this._rawAsyncValidators))}hasValidator(t){return qx(this._rawValidators,t)}hasAsyncValidator(t){return qx(this._rawAsyncValidators,t)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(t={}){this.touched=!0,this._parent&&!t.onlySelf&&this._parent.markAsTouched(t)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(t=>t.markAllAsTouched())}markAsUntouched(t={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(e=>{e.markAsUntouched({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}markAsDirty(t={}){this.pristine=!1,this._parent&&!t.onlySelf&&this._parent.markAsDirty(t)}markAsPristine(t={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(e=>{e.markAsPristine({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}markAsPending(t={}){this.status=Ug,!1!==t.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!t.onlySelf&&this._parent.markAsPending(t)}disable(t={}){const e=this._parentMarkedDirty(t.onlySelf);this.status=Ay,this.errors=null,this._forEachChild(i=>{i.disable(Object.assign(Object.assign({},t),{onlySelf:!0}))}),this._updateValue(),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Object.assign(Object.assign({},t),{skipPristineCheck:e})),this._onDisabledChange.forEach(i=>i(!0))}enable(t={}){const e=this._parentMarkedDirty(t.onlySelf);this.status=My,this._forEachChild(i=>{i.enable(Object.assign(Object.assign({},t),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent}),this._updateAncestors(Object.assign(Object.assign({},t),{skipPristineCheck:e})),this._onDisabledChange.forEach(i=>i(!1))}_updateAncestors(t){this._parent&&!t.onlySelf&&(this._parent.updateValueAndValidity(t),t.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(t){this._parent=t}getRawValue(){return this.value}updateValueAndValidity(t={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===My||this.status===Ug)&&this._runAsyncValidator(t.emitEvent)),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!t.onlySelf&&this._parent.updateValueAndValidity(t)}_updateTreeValidity(t={emitEvent:!0}){this._forEachChild(e=>e._updateTreeValidity(t)),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Ay:My}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(t){if(this.asyncValidator){this.status=Ug,this._hasOwnPendingAsyncValidator=!0;const e=BR(this.asyncValidator(this));this._asyncValidationSubscription=e.subscribe(i=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(i,{emitEvent:t})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(t,e={}){this.errors=t,this._updateControlsErrors(!1!==e.emitEvent)}get(t){let e=t;return null==e||(Array.isArray(e)||(e=e.split(".")),0===e.length)?null:e.reduce((i,r)=>i&&i._find(r),this)}getError(t,e){const i=e?this.get(e):this;return i&&i.errors?i.errors[t]:null}hasError(t,e){return!!this.getError(t,e)}get root(){let t=this;for(;t._parent;)t=t._parent;return t}_updateControlsErrors(t){this.status=this._calculateStatus(),t&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(t)}_initObservables(){this.valueChanges=new Xt,this.statusChanges=new Xt}_calculateStatus(){return this._allControlsDisabled()?Ay:this.errors?Xx:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Ug)?Ug:this._anyControlsHaveStatus(Xx)?Xx:My}_anyControlsHaveStatus(t){return this._anyControls(e=>e.status===t)}_anyControlsDirty(){return this._anyControls(t=>t.dirty)}_anyControlsTouched(){return this._anyControls(t=>t.touched)}_updatePristine(t={}){this.pristine=!this._anyControlsDirty(),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}_updateTouched(t={}){this.touched=this._anyControlsTouched(),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}_registerOnCollectionChange(t){this._onCollectionChange=t}_setUpdateStrategy(t){Zx(t)&&null!=t.updateOn&&(this._updateOn=t.updateOn)}_parentMarkedDirty(t){return!t&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(t){return null}}class CT extends nP{constructor(t,e,i){super(wT(e),ST(i,e)),this.controls=t,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(t,e){return this.controls[t]?this.controls[t]:(this.controls[t]=e,e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange),e)}addControl(t,e,i={}){this.registerControl(t,e),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}removeControl(t,e={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}setControl(t,e,i={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],e&&this.registerControl(t,e),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}contains(t){return this.controls.hasOwnProperty(t)&&this.controls[t].enabled}setValue(t,e={}){(function tP(n,t,e){n._forEachChild((i,r)=>{if(void 0===e[r])throw new Dt(1002,"")})})(this,0,t),Object.keys(t).forEach(i=>{(function eP(n,t,e){const i=n.controls;if(!(t?Object.keys(i):i).length)throw new Dt(1e3,"");if(!i[e])throw new Dt(1001,"")})(this,!0,i),this.controls[i].setValue(t[i],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(t,e={}){null!=t&&(Object.keys(t).forEach(i=>{const r=this.controls[i];r&&r.patchValue(t[i],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(t={},e={}){this._forEachChild((i,r)=>{i.reset(t[r],{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e),this._updateTouched(e),this.updateValueAndValidity(e)}getRawValue(){return this._reduceChildren({},(t,e,i)=>(t[i]=e.getRawValue(),t))}_syncPendingControls(){let t=this._reduceChildren(!1,(e,i)=>!!i._syncPendingControls()||e);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_forEachChild(t){Object.keys(this.controls).forEach(e=>{const i=this.controls[e];i&&t(i,e)})}_setUpControls(){this._forEachChild(t=>{t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(t){for(const[e,i]of Object.entries(this.controls))if(this.contains(e)&&t(i))return!0;return!1}_reduceValue(){return this._reduceChildren({},(e,i,r)=>((i.enabled||this.disabled)&&(e[r]=i.value),e))}_reduceChildren(t,e){let i=t;return this._forEachChild((r,s)=>{i=e(i,r,s)}),i}_allControlsDisabled(){for(const t of Object.keys(this.controls))if(this.controls[t].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(t){return this.controls.hasOwnProperty(t)?this.controls[t]:null}}function ky(n,t){var e,i;TT(n,t),t.valueAccessor.writeValue(n.value),n.disabled&&(null===(i=(e=t.valueAccessor).setDisabledState)||void 0===i||i.call(e,!0)),function D4(n,t){t.valueAccessor.registerOnChange(e=>{n._pendingValue=e,n._pendingChange=!0,n._pendingDirty=!0,"change"===n.updateOn&&iP(n,t)})}(n,t),function I4(n,t){const e=(i,r)=>{t.valueAccessor.writeValue(i),r&&t.viewToModelUpdate(i)};n.registerOnChange(e),t._registerOnDestroy(()=>{n._unregisterOnChange(e)})}(n,t),function E4(n,t){t.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,"blur"===n.updateOn&&n._pendingChange&&iP(n,t),"submit"!==n.updateOn&&n.markAsTouched()})}(n,t),function T4(n,t){if(t.valueAccessor.setDisabledState){const e=i=>{t.valueAccessor.setDisabledState(i)};n.registerOnDisabledChange(e),t._registerOnDestroy(()=>{n._unregisterOnDisabledChange(e)})}}(n,t)}function Qx(n,t,e=!0){const i=()=>{};t.valueAccessor&&(t.valueAccessor.registerOnChange(i),t.valueAccessor.registerOnTouched(i)),Jx(n,t),n&&(t._invokeOnDestroyCallbacks(),n._registerOnCollectionChange(()=>{}))}function Kx(n,t){n.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(t)})}function TT(n,t){const e=GR(n);null!==t.validator?n.setValidators($R(e,t.validator)):"function"==typeof e&&n.setValidators([e]);const i=qR(n);null!==t.asyncValidator?n.setAsyncValidators($R(i,t.asyncValidator)):"function"==typeof i&&n.setAsyncValidators([i]);const r=()=>n.updateValueAndValidity();Kx(t._rawValidators,r),Kx(t._rawAsyncValidators,r)}function Jx(n,t){let e=!1;if(null!==n){if(null!==t.validator){const r=GR(n);if(Array.isArray(r)&&r.length>0){const s=r.filter(d=>d!==t.validator);s.length!==r.length&&(e=!0,n.setValidators(s))}}if(null!==t.asyncValidator){const r=qR(n);if(Array.isArray(r)&&r.length>0){const s=r.filter(d=>d!==t.asyncValidator);s.length!==r.length&&(e=!0,n.setAsyncValidators(s))}}}const i=()=>{};return Kx(t._rawValidators,i),Kx(t._rawAsyncValidators,i),e}function iP(n,t){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),t.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function rP(n,t){TT(n,t)}function DT(n,t){if(!n.hasOwnProperty("model"))return!1;const e=n.model;return!!e.isFirstChange()||!Object.is(t,e.currentValue)}function sP(n,t){n._syncPendingControls(),t.forEach(e=>{const i=e.control;"submit"===i.updateOn&&i._pendingChange&&(e.viewToModelUpdate(i._pendingValue),i._pendingChange=!1)})}function ET(n,t){if(!t)return null;let e,i,r;return Array.isArray(t),t.forEach(s=>{s.constructor===Gd?e=s:function k4(n){return Object.getPrototypeOf(n.constructor)===$f}(s)?i=s:r=s}),r||i||e||null}const P4={provide:qa,useExisting:Ri(()=>Hg)},Ry=(()=>Promise.resolve(null))();let Hg=(()=>{class n extends qa{constructor(e,i){super(),this.submitted=!1,this._directives=new Set,this.ngSubmit=new Xt,this.form=new CT({},gT(e),bT(i))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(e){Ry.then(()=>{const i=this._findContainer(e.path);e.control=i.registerControl(e.name,e.control),ky(e.control,e),e.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(e)})}getControl(e){return this.form.get(e.path)}removeControl(e){Ry.then(()=>{const i=this._findContainer(e.path);i&&i.removeControl(e.name),this._directives.delete(e)})}addFormGroup(e){Ry.then(()=>{const i=this._findContainer(e.path),r=new CT({});rP(r,e),i.registerControl(e.name,r),r.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(e){Ry.then(()=>{const i=this._findContainer(e.path);i&&i.removeControl(e.name)})}getFormGroup(e){return this.form.get(e.path)}updateModel(e,i){Ry.then(()=>{this.form.get(e.path).setValue(i)})}setValue(e){this.control.setValue(e)}onSubmit(e){return this.submitted=!0,sP(this.form,this._directives),this.ngSubmit.emit(e),!1}onReset(){this.resetForm()}resetForm(e){this.form.reset(e),this.submitted=!1}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(e){return e.pop(),e.length?this.form.get(e):this.form}}return n.\u0275fac=function(e){return new(e||n)($(js,10),$(vp,10))},n.\u0275dir=vt({type:n,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(e,i){1&e&&Wt("submit",function(s){return i.onSubmit(s)})("reset",function(){return i.onReset()})},inputs:{options:["ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Kn([P4]),ut]}),n})();function aP(n,t){const e=n.indexOf(t);e>-1&&n.splice(e,1)}function lP(n){return"object"==typeof n&&null!==n&&2===Object.keys(n).length&&"value"in n&&"disabled"in n}const ew=class extends nP{constructor(t=null,e,i){super(wT(e),ST(i,e)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(t),this._setUpdateStrategy(e),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Zx(e)&&(e.nonNullable||e.initialValueIsDefault)&&(this.defaultValue=lP(t)?t.value:t)}setValue(t,e={}){this.value=this._pendingValue=t,this._onChange.length&&!1!==e.emitModelToViewChange&&this._onChange.forEach(i=>i(this.value,!1!==e.emitViewToModelChange)),this.updateValueAndValidity(e)}patchValue(t,e={}){this.setValue(t,e)}reset(t=this.defaultValue,e={}){this._applyFormState(t),this.markAsPristine(e),this.markAsUntouched(e),this.setValue(this.value,e),this._pendingChange=!1}_updateValue(){}_anyControls(t){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(t){this._onChange.push(t)}_unregisterOnChange(t){aP(this._onChange,t)}registerOnDisabledChange(t){this._onDisabledChange.push(t)}_unregisterOnDisabledChange(t){aP(this._onDisabledChange,t)}_forEachChild(t){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(t){lP(t)?(this.value=this._pendingValue=t.value,t.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=t}},F4={provide:Vl,useExisting:Ri(()=>$g)},dP=(()=>Promise.resolve(null))();let $g=(()=>{class n extends Vl{constructor(e,i,r,s,d){super(),this._changeDetectorRef=d,this.control=new ew,this._registered=!1,this.update=new Xt,this._parent=e,this._setValidators(i),this._setAsyncValidators(r),this.valueAccessor=ET(0,s)}ngOnChanges(e){if(this._checkForErrors(),!this._registered||"name"in e){if(this._registered&&(this._checkName(),this.formDirective)){const i=e.name.previousValue;this.formDirective.removeControl({name:i,path:this._getPath(i)})}this._setUpControl()}"isDisabled"in e&&this._updateDisabled(e),DT(e,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){ky(this.control,this),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(e){dP.then(()=>{var i;this.control.setValue(e,{emitViewToModelChange:!1}),null===(i=this._changeDetectorRef)||void 0===i||i.markForCheck()})}_updateDisabled(e){const i=e.isDisabled.currentValue,r=0!==i&&Vd(i);dP.then(()=>{var s;r&&!this.control.disabled?this.control.disable():!r&&this.control.disabled&&this.control.enable(),null===(s=this._changeDetectorRef)||void 0===s||s.markForCheck()})}_getPath(e){return this._parent?function Yx(n,t){return[...t.path,n]}(e,this._parent):[e]}}return n.\u0275fac=function(e){return new(e||n)($(qa,9),$(js,10),$(vp,10),$(Ga,10),$(Dr,8))},n.\u0275dir=vt({type:n,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[Kn([F4]),ut,dr]}),n})(),pP=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({}),n})();const IT=new bt("NgModelWithFormControlWarning"),U4={provide:Vl,useExisting:Ri(()=>tw)};let tw=(()=>{class n extends Vl{constructor(e,i,r,s){super(),this._ngModelWarningConfig=s,this.update=new Xt,this._ngModelWarningSent=!1,this._setValidators(e),this._setAsyncValidators(i),this.valueAccessor=ET(0,r)}set isDisabled(e){}ngOnChanges(e){if(this._isControlChanged(e)){const i=e.form.previousValue;i&&Qx(i,this,!1),ky(this.form,this),this.form.updateValueAndValidity({emitEvent:!1})}DT(e,this.viewModel)&&(this.form.setValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.form&&Qx(this.form,this,!1)}get path(){return[]}get control(){return this.form}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_isControlChanged(e){return e.hasOwnProperty("form")}}return n._ngModelWarningSentOnce=!1,n.\u0275fac=function(e){return new(e||n)($(js,10),$(vp,10),$(Ga,10),$(IT,8))},n.\u0275dir=vt({type:n,selectors:[["","formControl",""]],inputs:{form:["formControl","form"],isDisabled:["disabled","isDisabled"],model:["ngModel","model"]},outputs:{update:"ngModelChange"},exportAs:["ngForm"],features:[Kn([U4]),ut,dr]}),n})();const H4={provide:qa,useExisting:Ri(()=>Gg)};let Gg=(()=>{class n extends qa{constructor(e,i){super(),this.validators=e,this.asyncValidators=i,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new Xt,this._setValidators(e),this._setAsyncValidators(i)}ngOnChanges(e){this._checkFormPresent(),e.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(Jx(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(e){const i=this.form.get(e.path);return ky(i,e),i.updateValueAndValidity({emitEvent:!1}),this.directives.push(e),i}getControl(e){return this.form.get(e.path)}removeControl(e){Qx(e.control||null,e,!1),function R4(n,t){const e=n.indexOf(t);e>-1&&n.splice(e,1)}(this.directives,e)}addFormGroup(e){this._setUpFormContainer(e)}removeFormGroup(e){this._cleanUpFormContainer(e)}getFormGroup(e){return this.form.get(e.path)}addFormArray(e){this._setUpFormContainer(e)}removeFormArray(e){this._cleanUpFormContainer(e)}getFormArray(e){return this.form.get(e.path)}updateModel(e,i){this.form.get(e.path).setValue(i)}onSubmit(e){return this.submitted=!0,sP(this.form,this.directives),this.ngSubmit.emit(e),!1}onReset(){this.resetForm()}resetForm(e){this.form.reset(e),this.submitted=!1}_updateDomValue(){this.directives.forEach(e=>{const i=e.control,r=this.form.get(e.path);i!==r&&(Qx(i||null,e),(n=>n instanceof ew)(r)&&(ky(r,e),e.control=r))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(e){const i=this.form.get(e.path);rP(i,e),i.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(e){if(this.form){const i=this.form.get(e.path);i&&function M4(n,t){return Jx(n,t)}(i,e)&&i.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){TT(this.form,this),this._oldForm&&Jx(this._oldForm,this)}_checkFormPresent(){}}return n.\u0275fac=function(e){return new(e||n)($(js,10),$(vp,10))},n.\u0275dir=vt({type:n,selectors:[["","formGroup",""]],hostBindings:function(e,i){1&e&&Wt("submit",function(s){return i.onSubmit(s)})("reset",function(){return i.onReset()})},inputs:{form:["formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Kn([H4]),ut,dr]}),n})(),qf=(()=>{class n{constructor(){this._validator=Gx}ngOnChanges(e){if(this.inputName in e){const i=this.normalizeInput(e[this.inputName].currentValue);this._enabled=this.enabled(i),this._validator=this._enabled?this.createValidator(i):Gx,this._onChange&&this._onChange()}}validate(e){return this._validator(e)}registerOnValidatorChange(e){this._onChange=e}enabled(e){return null!=e}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=vt({type:n,features:[dr]}),n})();const tU={provide:js,useExisting:Ri(()=>PT),multi:!0},nU={provide:js,useExisting:Ri(()=>OT),multi:!0};let PT=(()=>{class n extends qf{constructor(){super(...arguments),this.inputName="required",this.normalizeInput=Vd,this.createValidator=e=>kR}enabled(e){return e}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=ui(n)))(i||n)}}(),n.\u0275dir=vt({type:n,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(e,i){2&e&&Ht("required",i._enabled?"":null)},inputs:{required:"required"},features:[Kn([tU]),ut]}),n})(),OT=(()=>{class n extends PT{constructor(){super(...arguments),this.createValidator=e=>RR}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=ui(n)))(i||n)}}(),n.\u0275dir=vt({type:n,selectors:[["input","type","checkbox","required","","formControlName",""],["input","type","checkbox","required","","formControl",""],["input","type","checkbox","required","","ngModel",""]],hostVars:1,hostBindings:function(e,i){2&e&&Ht("required",i._enabled?"":null)},features:[Kn([nU]),ut]}),n})(),IP=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({imports:[pP]}),n})(),aU=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({imports:[IP]}),n})(),lU=(()=>{class n{static withConfig(e){return{ngModule:n,providers:[{provide:IT,useValue:e.warnOnNgModelWithFormControl}]}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({imports:[IP]}),n})();class ia extends Qt{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){const e=super._subscribe(t);return!e.closed&&t.next(this._value),e}getValue(){const{hasError:t,thrownError:e,_value:i}=this;if(t)throw e;return this._throwIfClosed(),i}next(t){super.next(this._value=t)}}function Py(...n){const t=pi(n),e=Xn(n),{args:i,keys:r}=wR(n);if(0===i.length)return vo([],t);const s=new en(function uU(n,t,e=wn){return i=>{MP(t,()=>{const{length:r}=n,s=new Array(r);let d=r,m=r;for(let v=0;v<r;v++)MP(t,()=>{const D=vo(n[v],t);let A=!1;D.subscribe(Tt(i,L=>{s[v]=L,A||(A=!0,m--),m||i.next(e(s.slice()))},()=>{--d||i.complete()}))},i)},i)}}(i,t,r?d=>SR(r,d):wn));return e?s.pipe(mT(e)):s}function MP(n,t,e){n?de(e,n,t):t()}function qg(n,t){const e=Fe(n)?n:()=>n,i=r=>r.error(e());return new en(t?r=>t.schedule(i,0,r):i)}const Oy=Ue(n=>function(){n(this),this.name="EmptyError",this.message="no elements in sequence"});function Ly(...n){return function dU(){return ht(1)}()(vo(n,pi(n)))}function Wf(n){return new en(t=>{li(n()).subscribe(t)})}function LT(){return di((n,t)=>{let e=null;n._refCount++;const i=Tt(t,void 0,void 0,void 0,()=>{if(!n||n._refCount<=0||0<--n._refCount)return void(e=null);const r=n._connection,s=e;e=null,r&&(!s||r===s)&&r.unsubscribe(),t.unsubscribe()});n.subscribe(i),i.closed||(e=n.connect())})}class AP extends en{constructor(t,e){super(),this.source=t,this.subjectFactory=e,this._subject=null,this._refCount=0,this._connection=null,Eo(t)&&(this.lift=t.lift)}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){const t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:t}=this;this._subject=this._connection=null,null==t||t.unsubscribe()}connect(){let t=this._connection;if(!t){t=this._connection=new me;const e=this.getSubject();t.add(this.source.subscribe(Tt(e,void 0,()=>{this._teardown(),e.complete()},i=>{this._teardown(),e.error(i)},()=>this._teardown()))),t.closed&&(this._connection=null,t=me.EMPTY)}return t}refCount(){return LT()(this)}}function bl(n,t){return di((e,i)=>{let r=null,s=0,d=!1;const m=()=>d&&!r&&i.complete();e.subscribe(Tt(i,v=>{null==r||r.unsubscribe();let D=0;const A=s++;li(n(v,A)).subscribe(r=Tt(i,L=>i.next(t?t(v,L,A,D++):L),()=>{r=null,m()}))},()=>{d=!0,m()}))})}function Hr(n){return n<=0?()=>Vt:di((t,e)=>{let i=0;t.subscribe(Tt(e,r=>{++i<=n&&(e.next(r),n<=i&&e.complete())}))})}function Us(...n){const t=pi(n);return di((e,i)=>{(t?Ly(n,e,t):Ly(n,e)).subscribe(i)})}function hU(n,t,e,i,r){return(s,d)=>{let m=e,v=t,D=0;s.subscribe(Tt(d,A=>{const L=D++;v=m?n(v,A,L):(m=!0,A),i&&d.next(v)},r&&(()=>{m&&d.next(v),d.complete()})))}}function kP(n,t){return di(hU(n,t,arguments.length>=2,!0))}function xp(n){return di((t,e)=>{let s,i=null,r=!1;i=t.subscribe(Tt(e,void 0,void 0,d=>{s=li(n(d,xp(n)(t))),i?(i.unsubscribe(),i=null,s.subscribe(e)):r=!0})),r&&(i.unsubscribe(),i=null,s.subscribe(e))})}function FT(n){return n<=0?()=>Vt:di((t,e)=>{let i=[];t.subscribe(Tt(e,r=>{i.push(r),n<i.length&&i.shift()},()=>{for(const r of i)e.next(r);e.complete()},void 0,()=>{i=null}))})}function RP(n=pU){return di((t,e)=>{let i=!1;t.subscribe(Tt(e,r=>{i=!0,e.next(r)},()=>i?e.complete():e.error(n())))})}function pU(){return new Oy}function NT(n){return di((t,e)=>{let i=!1;t.subscribe(Tt(e,r=>{i=!0,e.next(r)},()=>{i||e.next(n),e.complete()}))})}function Xf(n,t){const e=arguments.length>=2;return i=>i.pipe(n?Er((r,s)=>n(r,s,i)):wn,Hr(1),e?NT(t):RP(()=>new Oy))}function jo(n,t,e){const i=Fe(n)||t||e?{next:n,error:t,complete:e}:n;return i?di((r,s)=>{var d;null===(d=i.subscribe)||void 0===d||d.call(i);let m=!0;r.subscribe(Tt(s,v=>{var D;null===(D=i.next)||void 0===D||D.call(i,v),s.next(v)},()=>{var v;m=!1,null===(v=i.complete)||void 0===v||v.call(i),s.complete()},v=>{var D;m=!1,null===(D=i.error)||void 0===D||D.call(i,v),s.error(v)},()=>{var v,D;m&&(null===(v=i.unsubscribe)||void 0===v||v.call(i)),null===(D=i.finalize)||void 0===D||D.call(i)}))}):wn}function Fy(n){return Hn(()=>n)}function nw(n){return di((t,e)=>{try{t.subscribe(e)}finally{e.add(n)}})}class qd{constructor(t,e){this.id=t,this.url=e}}class BT extends qd{constructor(t,e,i="imperative",r=null){super(t,e),this.type=0,this.navigationTrigger=i,this.restoredState=r}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Zf extends qd{constructor(t,e,i){super(t,e),this.urlAfterRedirects=i,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class iw extends qd{constructor(t,e,i){super(t,e),this.reason=i,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class PP extends qd{constructor(t,e,i){super(t,e),this.error=i,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class mU extends qd{constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class gU extends qd{constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class bU extends qd{constructor(t,e,i,r,s){super(t,e),this.urlAfterRedirects=i,this.state=r,this.shouldActivate=s,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class _U extends qd{constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class yU extends qd{constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class vU{constructor(t){this.route=t,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class xU{constructor(t){this.route=t,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class wU{constructor(t){this.snapshot=t,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class SU{constructor(t){this.snapshot=t,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class CU{constructor(t){this.snapshot=t,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class TU{constructor(t){this.snapshot=t,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class OP{constructor(t,e,i){this.routerEvent=t,this.position=e,this.anchor=i,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const Qi="primary";class EU{constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){const e=this.params[t];return Array.isArray(e)?e[0]:e}return null}getAll(t){if(this.has(t)){const e=this.params[t];return Array.isArray(e)?e:[e]}return[]}get keys(){return Object.keys(this.params)}}function Wg(n){return new EU(n)}const zT="Redirecting to ",LP="ngNavigationCancelingError";function VT(n){const t=Error("NavigationCancelingError: "+(n||""));return t[LP]=!0,t}function MU(n,t,e){const i=e.path.split("/");if(i.length>n.length||"full"===e.pathMatch&&(t.hasChildren()||i.length<n.length))return null;const r={};for(let s=0;s<i.length;s++){const d=i[s],m=n[s];if(d.startsWith(":"))r[d.substring(1)]=m;else if(d!==m.path)return null}return{consumed:n.slice(0,i.length),posParams:r}}function Vu(n,t){const e=n?Object.keys(n):void 0,i=t?Object.keys(t):void 0;if(!e||!i||e.length!=i.length)return!1;let r;for(let s=0;s<e.length;s++)if(r=e[s],!FP(n[r],t[r]))return!1;return!0}function FP(n,t){if(Array.isArray(n)&&Array.isArray(t)){if(n.length!==t.length)return!1;const e=[...n].sort(),i=[...t].sort();return e.every((r,s)=>i[s]===r)}return n===t}function NP(n){return Array.prototype.concat.apply([],n)}function BP(n){return n.length>0?n[n.length-1]:null}function ra(n,t){for(const e in n)n.hasOwnProperty(e)&&t(n[e],e)}function wp(n){return R1(n)?n:ny(n)?vo(Promise.resolve(n)):ei(n)}const RU={exact:function jP(n,t,e){if(!Qf(n.segments,t.segments)||!rw(n.segments,t.segments,e)||n.numberOfChildren!==t.numberOfChildren)return!1;for(const i in t.children)if(!n.children[i]||!jP(n.children[i],t.children[i],e))return!1;return!0},subset:UP},zP={exact:function PU(n,t){return Vu(n,t)},subset:function OU(n,t){return Object.keys(t).length<=Object.keys(n).length&&Object.keys(t).every(e=>FP(n[e],t[e]))},ignored:()=>!0};function VP(n,t,e){return RU[e.paths](n.root,t.root,e.matrixParams)&&zP[e.queryParams](n.queryParams,t.queryParams)&&!("exact"===e.fragment&&n.fragment!==t.fragment)}function UP(n,t,e){return HP(n,t,t.segments,e)}function HP(n,t,e,i){if(n.segments.length>e.length){const r=n.segments.slice(0,e.length);return!(!Qf(r,e)||t.hasChildren()||!rw(r,e,i))}if(n.segments.length===e.length){if(!Qf(n.segments,e)||!rw(n.segments,e,i))return!1;for(const r in t.children)if(!n.children[r]||!UP(n.children[r],t.children[r],i))return!1;return!0}{const r=e.slice(0,n.segments.length),s=e.slice(n.segments.length);return!!(Qf(n.segments,r)&&rw(n.segments,r,i)&&n.children[Qi])&&HP(n.children[Qi],t,s,i)}}function rw(n,t,e){return t.every((i,r)=>zP[e](n[r].parameters,i.parameters))}class Yf{constructor(t,e,i){this.root=t,this.queryParams=e,this.fragment=i}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Wg(this.queryParams)),this._queryParamMap}toString(){return NU.serialize(this)}}class br{constructor(t,e){this.segments=t,this.children=e,this.parent=null,ra(e,(i,r)=>i.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return ow(this)}}class Ny{constructor(t,e){this.path=t,this.parameters=e}get parameterMap(){return this._parameterMap||(this._parameterMap=Wg(this.parameters)),this._parameterMap}toString(){return XP(this)}}function Qf(n,t){return n.length===t.length&&n.every((e,i)=>e.path===t[i].path)}class $P{}class GP{parse(t){const e=new qU(t);return new Yf(e.parseRootSegment(),e.parseQueryParams(),e.parseFragment())}serialize(t){const e=`/${By(t.root,!0)}`,i=function VU(n){const t=Object.keys(n).map(e=>{const i=n[e];return Array.isArray(i)?i.map(r=>`${sw(e)}=${sw(r)}`).join("&"):`${sw(e)}=${sw(i)}`}).filter(e=>!!e);return t.length?`?${t.join("&")}`:""}(t.queryParams);return`${e}${i}${"string"==typeof t.fragment?`#${function BU(n){return encodeURI(n)}(t.fragment)}`:""}`}}const NU=new GP;function ow(n){return n.segments.map(t=>XP(t)).join("/")}function By(n,t){if(!n.hasChildren())return ow(n);if(t){const e=n.children[Qi]?By(n.children[Qi],!1):"",i=[];return ra(n.children,(r,s)=>{s!==Qi&&i.push(`${s}:${By(r,!1)}`)}),i.length>0?`${e}(${i.join("//")})`:e}{const e=function FU(n,t){let e=[];return ra(n.children,(i,r)=>{r===Qi&&(e=e.concat(t(i,r)))}),ra(n.children,(i,r)=>{r!==Qi&&(e=e.concat(t(i,r)))}),e}(n,(i,r)=>r===Qi?[By(n.children[Qi],!1)]:[`${r}:${By(i,!1)}`]);return 1===Object.keys(n.children).length&&null!=n.children[Qi]?`${ow(n)}/${e[0]}`:`${ow(n)}/(${e.join("//")})`}}function qP(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function sw(n){return qP(n).replace(/%3B/gi,";")}function UT(n){return qP(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function aw(n){return decodeURIComponent(n)}function WP(n){return aw(n.replace(/\+/g,"%20"))}function XP(n){return`${UT(n.path)}${function zU(n){return Object.keys(n).map(t=>`;${UT(t)}=${UT(n[t])}`).join("")}(n.parameters)}`}const jU=/^[^\/()?;=#]+/;function lw(n){const t=n.match(jU);return t?t[0]:""}const UU=/^[^=?&#]+/,$U=/^[^&#]+/;class qU{constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new br([],{}):new br([],this.parseChildren())}parseQueryParams(){const t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let e={};this.peekStartsWith("/(")&&(this.capture("/"),e=this.parseParens(!0));let i={};return this.peekStartsWith("(")&&(i=this.parseParens(!1)),(t.length>0||Object.keys(e).length>0)&&(i[Qi]=new br(t,e)),i}parseSegment(){const t=lw(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new Dt(4009,!1);return this.capture(t),new Ny(aw(t),this.parseMatrixParams())}parseMatrixParams(){const t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){const e=lw(this.remaining);if(!e)return;this.capture(e);let i="";if(this.consumeOptional("=")){const r=lw(this.remaining);r&&(i=r,this.capture(i))}t[aw(e)]=aw(i)}parseQueryParam(t){const e=function HU(n){const t=n.match(UU);return t?t[0]:""}(this.remaining);if(!e)return;this.capture(e);let i="";if(this.consumeOptional("=")){const d=function GU(n){const t=n.match($U);return t?t[0]:""}(this.remaining);d&&(i=d,this.capture(i))}const r=WP(e),s=WP(i);if(t.hasOwnProperty(r)){let d=t[r];Array.isArray(d)||(d=[d],t[r]=d),d.push(s)}else t[r]=s}parseParens(t){const e={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const i=lw(this.remaining),r=this.remaining[i.length];if("/"!==r&&")"!==r&&";"!==r)throw new Dt(4010,!1);let s;i.indexOf(":")>-1?(s=i.slice(0,i.indexOf(":")),this.capture(s),this.capture(":")):t&&(s=Qi);const d=this.parseChildren();e[s]=1===Object.keys(d).length?d[Qi]:new br([],d),this.consumeOptional("//")}return e}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)}capture(t){if(!this.consumeOptional(t))throw new Dt(4011,!1)}}class ZP{constructor(t){this._root=t}get root(){return this._root.value}parent(t){const e=this.pathFromRoot(t);return e.length>1?e[e.length-2]:null}children(t){const e=HT(t,this._root);return e?e.children.map(i=>i.value):[]}firstChild(t){const e=HT(t,this._root);return e&&e.children.length>0?e.children[0].value:null}siblings(t){const e=$T(t,this._root);return e.length<2?[]:e[e.length-2].children.map(r=>r.value).filter(r=>r!==t)}pathFromRoot(t){return $T(t,this._root).map(e=>e.value)}}function HT(n,t){if(n===t.value)return t;for(const e of t.children){const i=HT(n,e);if(i)return i}return null}function $T(n,t){if(n===t.value)return[t];for(const e of t.children){const i=$T(n,e);if(i.length)return i.unshift(t),i}return[]}class Wd{constructor(t,e){this.value=t,this.children=e}toString(){return`TreeNode(${this.value})`}}function Xg(n){const t={};return n&&n.children.forEach(e=>t[e.value.outlet]=e),t}class YP extends ZP{constructor(t,e){super(t),this.snapshot=e,GT(this,t)}toString(){return this.snapshot.toString()}}function QP(n,t){const e=function WU(n,t){const d=new cw([],{},{},"",{},Qi,t,null,n.root,-1,{});return new JP("",new Wd(d,[]))}(n,t),i=new ia([new Ny("",{})]),r=new ia({}),s=new ia({}),d=new ia({}),m=new ia(""),v=new Zg(i,r,d,m,s,Qi,t,e.root);return v.snapshot=e.root,new YP(new Wd(v,[]),e)}class Zg{constructor(t,e,i,r,s,d,m,v){this.url=t,this.params=e,this.queryParams=i,this.fragment=r,this.data=s,this.outlet=d,this.component=m,this._futureSnapshot=v}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(Hn(t=>Wg(t)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(Hn(t=>Wg(t)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function KP(n,t="emptyOnly"){const e=n.pathFromRoot;let i=0;if("always"!==t)for(i=e.length-1;i>=1;){const r=e[i],s=e[i-1];if(r.routeConfig&&""===r.routeConfig.path)i--;else{if(s.component)break;i--}}return function XU(n){return n.reduce((t,e)=>{var i;return{params:Object.assign(Object.assign({},t.params),e.params),data:Object.assign(Object.assign({},t.data),e.data),resolve:Object.assign(Object.assign(Object.assign(Object.assign({},e.data),t.resolve),null===(i=e.routeConfig)||void 0===i?void 0:i.data),e._resolvedData)}},{params:{},data:{},resolve:{}})}(e.slice(i))}class cw{constructor(t,e,i,r,s,d,m,v,D,A,L,j){this.url=t,this.params=e,this.queryParams=i,this.fragment=r,this.data=s,this.outlet=d,this.component=m,this.routeConfig=v,this._urlSegment=D,this._lastPathIndex=A,this._correctedLastPathIndex=null!=j?j:A,this._resolve=L}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Wg(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Wg(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(i=>i.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class JP extends ZP{constructor(t,e){super(e),this.url=t,GT(this,e)}toString(){return eO(this._root)}}function GT(n,t){t.value._routerState=n,t.children.forEach(e=>GT(n,e))}function eO(n){const t=n.children.length>0?` { ${n.children.map(eO).join(", ")} } `:"";return`${n.value}${t}`}function qT(n){if(n.snapshot){const t=n.snapshot,e=n._futureSnapshot;n.snapshot=e,Vu(t.queryParams,e.queryParams)||n.queryParams.next(e.queryParams),t.fragment!==e.fragment&&n.fragment.next(e.fragment),Vu(t.params,e.params)||n.params.next(e.params),function AU(n,t){if(n.length!==t.length)return!1;for(let e=0;e<n.length;++e)if(!Vu(n[e],t[e]))return!1;return!0}(t.url,e.url)||n.url.next(e.url),Vu(t.data,e.data)||n.data.next(e.data)}else n.snapshot=n._futureSnapshot,n.data.next(n._futureSnapshot.data)}function WT(n,t){const e=Vu(n.params,t.params)&&function LU(n,t){return Qf(n,t)&&n.every((e,i)=>Vu(e.parameters,t[i].parameters))}(n.url,t.url);return e&&!(!n.parent!=!t.parent)&&(!n.parent||WT(n.parent,t.parent))}function zy(n,t,e){if(e&&n.shouldReuseRoute(t.value,e.value.snapshot)){const i=e.value;i._futureSnapshot=t.value;const r=function YU(n,t,e){return t.children.map(i=>{for(const r of e.children)if(n.shouldReuseRoute(i.value,r.value.snapshot))return zy(n,i,r);return zy(n,i)})}(n,t,e);return new Wd(i,r)}{if(n.shouldAttach(t.value)){const s=n.retrieve(t.value);if(null!==s){const d=s.route;return d.value._futureSnapshot=t.value,d.children=t.children.map(m=>zy(n,m)),d}}const i=function QU(n){return new Zg(new ia(n.url),new ia(n.params),new ia(n.queryParams),new ia(n.fragment),new ia(n.data),n.outlet,n.component,n)}(t.value),r=t.children.map(s=>zy(n,s));return new Wd(i,r)}}function uw(n){return"object"==typeof n&&null!=n&&!n.outlets&&!n.segmentPath}function Vy(n){return"object"==typeof n&&null!=n&&n.outlets}function ZT(n,t,e,i,r){let s={};if(i&&ra(i,(m,v)=>{s[v]=Array.isArray(m)?m.map(D=>`${D}`):`${m}`}),n===t)return new Yf(e,s,r);const d=tO(n,t,e);return new Yf(d,s,r)}function tO(n,t,e){const i={};return ra(n.children,(r,s)=>{i[s]=r===t?e:tO(r,t,e)}),new br(n.segments,i)}class nO{constructor(t,e,i){if(this.isAbsolute=t,this.numberOfDoubleDots=e,this.commands=i,t&&i.length>0&&uw(i[0]))throw new Dt(4003,false);const r=i.find(Vy);if(r&&r!==BP(i))throw new Dt(4004,false)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class YT{constructor(t,e,i){this.segmentGroup=t,this.processChildren=e,this.index=i}}function iO(n,t,e){if(n||(n=new br([],{})),0===n.segments.length&&n.hasChildren())return dw(n,t,e);const i=function iH(n,t,e){let i=0,r=t;const s={match:!1,pathIndex:0,commandIndex:0};for(;r<n.segments.length;){if(i>=e.length)return s;const d=n.segments[r],m=e[i];if(Vy(m))break;const v=`${m}`,D=i<e.length-1?e[i+1]:null;if(r>0&&void 0===v)break;if(v&&D&&"object"==typeof D&&void 0===D.outlets){if(!oO(v,D,d))return s;i+=2}else{if(!oO(v,{},d))return s;i++}r++}return{match:!0,pathIndex:r,commandIndex:i}}(n,t,e),r=e.slice(i.commandIndex);if(i.match&&i.pathIndex<n.segments.length){const s=new br(n.segments.slice(0,i.pathIndex),{});return s.children[Qi]=new br(n.segments.slice(i.pathIndex),n.children),dw(s,0,r)}return i.match&&0===r.length?new br(n.segments,{}):i.match&&!n.hasChildren()?QT(n,t,e):i.match?dw(n,0,r):QT(n,t,e)}function dw(n,t,e){if(0===e.length)return new br(n.segments,{});{const i=function nH(n){return Vy(n[0])?n[0].outlets:{[Qi]:n}}(e),r={};return ra(i,(s,d)=>{"string"==typeof s&&(s=[s]),null!==s&&(r[d]=iO(n.children[d],t,s))}),ra(n.children,(s,d)=>{void 0===i[d]&&(r[d]=s)}),new br(n.segments,r)}}function QT(n,t,e){const i=n.segments.slice(0,t);let r=0;for(;r<e.length;){const s=e[r];if(Vy(s)){const v=rH(s.outlets);return new br(i,v)}if(0===r&&uw(e[0])){i.push(new Ny(n.segments[t].path,rO(e[0]))),r++;continue}const d=Vy(s)?s.outlets[Qi]:`${s}`,m=r<e.length-1?e[r+1]:null;d&&m&&uw(m)?(i.push(new Ny(d,rO(m))),r+=2):(i.push(new Ny(d,{})),r++)}return new br(i,{})}function rH(n){const t={};return ra(n,(e,i)=>{"string"==typeof e&&(e=[e]),null!==e&&(t[i]=QT(new br([],{}),0,e))}),t}function rO(n){const t={};return ra(n,(e,i)=>t[i]=`${e}`),t}function oO(n,t,e){return n==e.path&&Vu(t,e.parameters)}class oH{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.injector=null,this.children=new jy,this.attachRef=null}}class jy{constructor(){this.contexts=new Map}onChildOutletCreated(t,e){const i=this.getOrCreateContext(t);i.outlet=e,this.contexts.set(t,i)}onChildOutletDestroyed(t){const e=this.getContext(t);e&&(e.outlet=null,e.attachRef=null)}onOutletDeactivated(){const t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let e=this.getContext(t);return e||(e=new oH,this.contexts.set(t,e)),e}getContext(t){return this.contexts.get(t)||null}}const hw=!1;let KT=(()=>{class n{constructor(e,i,r,s,d){this.parentContexts=e,this.location=i,this.changeDetector=s,this.environmentInjector=d,this.activated=null,this._activatedRoute=null,this.activateEvents=new Xt,this.deactivateEvents=new Xt,this.attachEvents=new Xt,this.detachEvents=new Xt,this.name=r||Qi,e.onChildOutletCreated(this.name,this)}ngOnDestroy(){var e;(null===(e=this.parentContexts.getContext(this.name))||void 0===e?void 0:e.outlet)===this&&this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const e=this.parentContexts.getContext(this.name);e&&e.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.injector))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Dt(4012,hw);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Dt(4012,hw);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Dt(4012,hw);this.location.detach();const e=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(e.instance),e}attach(e,i){this.activated=e,this._activatedRoute=i,this.location.insert(e.hostView),this.attachEvents.emit(e.instance)}deactivate(){if(this.activated){const e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}activateWith(e,i){if(this.isActivated)throw new Dt(4013,hw);this._activatedRoute=e;const r=this.location,d=e._futureSnapshot.component,m=this.parentContexts.getOrCreateContext(this.name).children,v=new sH(e,m,r.injector);if(i&&function aH(n){return!!n.resolveComponentFactory}(i)){const D=i.resolveComponentFactory(d);this.activated=r.createComponent(D,r.length,v)}else this.activated=r.createComponent(d,{index:r.length,injector:v,environmentInjector:null!=i?i:this.environmentInjector});this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return n.\u0275fac=function(e){return new(e||n)($(jy),$(Vo),Vr("name"),$(Dr),$(Su))},n.\u0275dir=vt({type:n,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"]}),n})();class sH{constructor(t,e,i){this.route=t,this.childContexts=e,this.parent=i}get(t,e){return t===Zg?this.route:t===jy?this.childContexts:this.parent.get(t,e)}}let sO=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=kn({type:n,selectors:[["ng-component"]],decls:1,vars:0,template:function(e,i){1&e&&qn(0,"router-outlet")},dependencies:[KT],encapsulation:2}),n})();function aO(n,t){var e;return n.providers&&!n._injector&&(n._injector=Q0(n.providers,t,`Route: ${n.path}`)),null!==(e=n._injector)&&void 0!==e?e:t}function eD(n){const t=n.children&&n.children.map(eD),e=t?Object.assign(Object.assign({},n),{children:t}):Object.assign({},n);return!e.component&&!e.loadComponent&&(t||e.loadChildren)&&e.outlet&&e.outlet!==Qi&&(e.component=sO),e}function mc(n){return n.outlet||Qi}function lO(n,t){const e=n.filter(i=>mc(i)===t);return e.push(...n.filter(i=>mc(i)!==t)),e}function cO(n){var t;if(!n)return null;if(null!==(t=n.routeConfig)&&void 0!==t&&t._injector)return n.routeConfig._injector;for(let e=n.parent;e;e=e.parent){const i=e.routeConfig;if(null!=i&&i._loadedInjector)return i._loadedInjector;if(null!=i&&i._injector)return i._injector}return null}class hH{constructor(t,e,i,r){this.routeReuseStrategy=t,this.futureState=e,this.currState=i,this.forwardEvent=r}activate(t){const e=this.futureState._root,i=this.currState?this.currState._root:null;this.deactivateChildRoutes(e,i,t),qT(this.futureState.root),this.activateChildRoutes(e,i,t)}deactivateChildRoutes(t,e,i){const r=Xg(e);t.children.forEach(s=>{const d=s.value.outlet;this.deactivateRoutes(s,r[d],i),delete r[d]}),ra(r,(s,d)=>{this.deactivateRouteAndItsChildren(s,i)})}deactivateRoutes(t,e,i){const r=t.value,s=e?e.value:null;if(r===s)if(r.component){const d=i.getContext(r.outlet);d&&this.deactivateChildRoutes(t,e,d.children)}else this.deactivateChildRoutes(t,e,i);else s&&this.deactivateRouteAndItsChildren(e,i)}deactivateRouteAndItsChildren(t,e){t.value.component&&this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,e):this.deactivateRouteAndOutlet(t,e)}detachAndStoreRouteSubtree(t,e){const i=e.getContext(t.value.outlet),r=i&&t.value.component?i.children:e,s=Xg(t);for(const d of Object.keys(s))this.deactivateRouteAndItsChildren(s[d],r);if(i&&i.outlet){const d=i.outlet.detach(),m=i.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:d,route:t,contexts:m})}}deactivateRouteAndOutlet(t,e){const i=e.getContext(t.value.outlet),r=i&&t.value.component?i.children:e,s=Xg(t);for(const d of Object.keys(s))this.deactivateRouteAndItsChildren(s[d],r);i&&i.outlet&&(i.outlet.deactivate(),i.children.onOutletDeactivated(),i.attachRef=null,i.resolver=null,i.route=null)}activateChildRoutes(t,e,i){const r=Xg(e);t.children.forEach(s=>{this.activateRoutes(s,r[s.value.outlet],i),this.forwardEvent(new TU(s.value.snapshot))}),t.children.length&&this.forwardEvent(new SU(t.value.snapshot))}activateRoutes(t,e,i){var r;const s=t.value,d=e?e.value:null;if(qT(s),s===d)if(s.component){const m=i.getOrCreateContext(s.outlet);this.activateChildRoutes(t,e,m.children)}else this.activateChildRoutes(t,e,i);else if(s.component){const m=i.getOrCreateContext(s.outlet);if(this.routeReuseStrategy.shouldAttach(s.snapshot)){const v=this.routeReuseStrategy.retrieve(s.snapshot);this.routeReuseStrategy.store(s.snapshot,null),m.children.onOutletReAttached(v.contexts),m.attachRef=v.componentRef,m.route=v.route.value,m.outlet&&m.outlet.attach(v.componentRef,v.route.value),qT(v.route.value),this.activateChildRoutes(t,null,m.children)}else{const v=cO(s.snapshot),D=null!==(r=null==v?void 0:v.get(Ff))&&void 0!==r?r:null;m.attachRef=null,m.route=s,m.resolver=D,m.injector=v,m.outlet&&m.outlet.activateWith(s,m.injector),this.activateChildRoutes(t,null,m.children)}}else this.activateChildRoutes(t,null,i)}}function pw(n){return"function"==typeof n}function Kf(n){return n instanceof Yf}const Uy=Symbol("INITIAL_VALUE");function Hy(){return bl(n=>Py(n.map(t=>t.pipe(Hr(1),Us(Uy)))).pipe(kP((t,e)=>{let i=!1;return e.reduce((r,s,d)=>r!==Uy?r:(s===Uy&&(i=!0),i||!1!==s&&d!==e.length-1&&!Kf(s)?r:s),t)},Uy),Er(t=>t!==Uy),Hn(t=>Kf(t)?t:!0===t),Hr(1)))}const uO={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function fw(n,t,e){var i;if(""===t.path)return"full"===t.pathMatch&&(n.hasChildren()||e.length>0)?Object.assign({},uO):{matched:!0,consumedSegments:[],remainingSegments:e,parameters:{},positionalParamSegments:{}};const s=(t.matcher||MU)(e,n,t);if(!s)return Object.assign({},uO);const d={};ra(s.posParams,(v,D)=>{d[D]=v.path});const m=s.consumed.length>0?Object.assign(Object.assign({},d),s.consumed[s.consumed.length-1].parameters):d;return{matched:!0,consumedSegments:s.consumed,remainingSegments:e.slice(s.consumed.length),parameters:m,positionalParamSegments:null!==(i=s.posParams)&&void 0!==i?i:{}}}function mw(n,t,e,i,r="corrected"){if(e.length>0&&function vH(n,t,e){return e.some(i=>gw(n,t,i)&&mc(i)!==Qi)}(n,e,i)){const d=new br(t,function yH(n,t,e,i){const r={};r[Qi]=i,i._sourceSegment=n,i._segmentIndexShift=t.length;for(const s of e)if(""===s.path&&mc(s)!==Qi){const d=new br([],{});d._sourceSegment=n,d._segmentIndexShift=t.length,r[mc(s)]=d}return r}(n,t,i,new br(e,n.children)));return d._sourceSegment=n,d._segmentIndexShift=t.length,{segmentGroup:d,slicedSegments:[]}}if(0===e.length&&function xH(n,t,e){return e.some(i=>gw(n,t,i))}(n,e,i)){const d=new br(n.segments,function _H(n,t,e,i,r,s){const d={};for(const m of i)if(gw(n,e,m)&&!r[mc(m)]){const v=new br([],{});v._sourceSegment=n,v._segmentIndexShift="legacy"===s?n.segments.length:t.length,d[mc(m)]=v}return Object.assign(Object.assign({},r),d)}(n,t,e,i,n.children,r));return d._sourceSegment=n,d._segmentIndexShift=t.length,{segmentGroup:d,slicedSegments:e}}const s=new br(n.segments,n.children);return s._sourceSegment=n,s._segmentIndexShift=t.length,{segmentGroup:s,slicedSegments:e}}function gw(n,t,e){return(!(n.hasChildren()||t.length>0)||"full"!==e.pathMatch)&&""===e.path}function dO(n,t,e,i){return!!(mc(n)===i||i!==Qi&&gw(t,e,n))&&("**"===n.path||fw(t,n,e).matched)}function hO(n,t,e){return 0===t.length&&!n.children[e]}const bw=!1;class _w{constructor(t){this.segmentGroup=t||null}}class pO{constructor(t){this.urlTree=t}}function $y(n){return qg(new _w(n))}function fO(n){return qg(new pO(n))}class TH{constructor(t,e,i,r,s){this.injector=t,this.configLoader=e,this.urlSerializer=i,this.urlTree=r,this.config=s,this.allowRedirects=!0}apply(){const t=mw(this.urlTree.root,[],[],this.config).segmentGroup,e=new br(t.segments,t.children);return this.expandSegmentGroup(this.injector,this.config,e,Qi).pipe(Hn(s=>this.createUrlTree(tD(s),this.urlTree.queryParams,this.urlTree.fragment))).pipe(xp(s=>{if(s instanceof pO)return this.allowRedirects=!1,this.match(s.urlTree);throw s instanceof _w?this.noMatchError(s):s}))}match(t){return this.expandSegmentGroup(this.injector,this.config,t.root,Qi).pipe(Hn(r=>this.createUrlTree(tD(r),t.queryParams,t.fragment))).pipe(xp(r=>{throw r instanceof _w?this.noMatchError(r):r}))}noMatchError(t){return new Dt(4002,bw)}createUrlTree(t,e,i){const r=t.segments.length>0?new br([],{[Qi]:t}):t;return new Yf(r,e,i)}expandSegmentGroup(t,e,i,r){return 0===i.segments.length&&i.hasChildren()?this.expandChildren(t,e,i).pipe(Hn(s=>new br([],s))):this.expandSegment(t,i,e,i.segments,r,!0)}expandChildren(t,e,i){const r=[];for(const s of Object.keys(i.children))"primary"===s?r.unshift(s):r.push(s);return vo(r).pipe(jg(s=>{const d=i.children[s],m=lO(e,s);return this.expandSegmentGroup(t,m,d,s).pipe(Hn(v=>({segment:v,outlet:s})))}),kP((s,d)=>(s[d.outlet]=d.segment,s),{}),function fU(n,t){const e=arguments.length>=2;return i=>i.pipe(n?Er((r,s)=>n(r,s,i)):wn,FT(1),e?NT(t):RP(()=>new Oy))}())}expandSegment(t,e,i,r,s,d){return vo(i).pipe(jg(m=>this.expandSegmentAgainstRoute(t,e,i,m,r,s,d).pipe(xp(D=>{if(D instanceof _w)return ei(null);throw D}))),Xf(m=>!!m),xp((m,v)=>{if(m instanceof Oy||"EmptyError"===m.name)return hO(e,r,s)?ei(new br([],{})):$y(e);throw m}))}expandSegmentAgainstRoute(t,e,i,r,s,d,m){return dO(r,e,s,d)?void 0===r.redirectTo?this.matchSegmentAgainstRoute(t,e,r,s,d):m&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(t,e,i,r,s,d):$y(e):$y(e)}expandSegmentAgainstRouteUsingRedirect(t,e,i,r,s,d){return"**"===r.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(t,i,r,d):this.expandRegularSegmentAgainstRouteUsingRedirect(t,e,i,r,s,d)}expandWildCardWithParamsAgainstRouteUsingRedirect(t,e,i,r){const s=this.applyRedirectCommands([],i.redirectTo,{});return i.redirectTo.startsWith("/")?fO(s):this.lineralizeSegments(i,s).pipe(ke(d=>{const m=new br(d,{});return this.expandSegment(t,m,e,d,r,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(t,e,i,r,s,d){const{matched:m,consumedSegments:v,remainingSegments:D,positionalParamSegments:A}=fw(e,r,s);if(!m)return $y(e);const L=this.applyRedirectCommands(v,r.redirectTo,A);return r.redirectTo.startsWith("/")?fO(L):this.lineralizeSegments(r,L).pipe(ke(j=>this.expandSegment(t,e,i,j.concat(D),d,!1)))}matchSegmentAgainstRoute(t,e,i,r,s){if("**"===i.path)return t=aO(i,t),i.loadChildren?(i._loadedRoutes?ei({routes:i._loadedRoutes,injector:i._loadedInjector}):this.configLoader.loadChildren(t,i)).pipe(Hn(L=>(i._loadedRoutes=L.routes,i._loadedInjector=L.injector,new br(r,{})))):ei(new br(r,{}));const{matched:d,consumedSegments:m,remainingSegments:v}=fw(e,i,r);return d?(t=aO(i,t),this.getChildConfig(t,i,r).pipe(ke(A=>{var L;const j=null!==(L=A.injector)&&void 0!==L?L:t,W=A.routes,{segmentGroup:ie,slicedSegments:we}=mw(e,m,v,W),Re=new br(ie.segments,ie.children);if(0===we.length&&Re.hasChildren())return this.expandChildren(j,W,Re).pipe(Hn(Bt=>new br(m,Bt)));if(0===W.length&&0===we.length)return ei(new br(m,{}));const We=mc(i)===s;return this.expandSegment(j,Re,W,we,We?Qi:s,!0).pipe(Hn(st=>new br(m.concat(st.segments),st.children)))}))):$y(e)}getChildConfig(t,e,i){return e.children?ei({routes:e.children,injector:t}):e.loadChildren?void 0!==e._loadedRoutes?ei({routes:e._loadedRoutes,injector:e._loadedInjector}):this.runCanLoadGuards(t,e,i).pipe(ke(r=>r?this.configLoader.loadChildren(t,e).pipe(jo(s=>{e._loadedRoutes=s.routes,e._loadedInjector=s.injector})):function SH(n){return qg(VT(bw))}())):ei({routes:[],injector:t})}runCanLoadGuards(t,e,i){const r=e.canLoad;return r&&0!==r.length?ei(r.map(d=>{const m=t.get(d);return wp(function fH(n){return n&&pw(n.canLoad)}(m)?m.canLoad(e,i):m(e,i))})).pipe(Hy(),jo(d=>{if(!Kf(d))return;const m=VT(zT+this.urlSerializer.serialize(d));throw m.url=d,m}),Hn(d=>!0===d)):ei(!0)}lineralizeSegments(t,e){let i=[],r=e.root;for(;;){if(i=i.concat(r.segments),0===r.numberOfChildren)return ei(i);if(r.numberOfChildren>1||!r.children[Qi])return qg(new Dt(4e3,bw));r=r.children[Qi]}}applyRedirectCommands(t,e,i){return this.applyRedirectCreatreUrlTree(e,this.urlSerializer.parse(e),t,i)}applyRedirectCreatreUrlTree(t,e,i,r){const s=this.createSegmentGroup(t,e.root,i,r);return new Yf(s,this.createQueryParams(e.queryParams,this.urlTree.queryParams),e.fragment)}createQueryParams(t,e){const i={};return ra(t,(r,s)=>{if("string"==typeof r&&r.startsWith(":")){const m=r.substring(1);i[s]=e[m]}else i[s]=r}),i}createSegmentGroup(t,e,i,r){const s=this.createSegments(t,e.segments,i,r);let d={};return ra(e.children,(m,v)=>{d[v]=this.createSegmentGroup(t,m,i,r)}),new br(s,d)}createSegments(t,e,i,r){return e.map(s=>s.path.startsWith(":")?this.findPosParam(t,s,r):this.findOrReturn(s,i))}findPosParam(t,e,i){const r=i[e.path.substring(1)];if(!r)throw new Dt(4001,bw);return r}findOrReturn(t,e){let i=0;for(const r of e){if(r.path===t.path)return e.splice(i),r;i++}return t}}function tD(n){const t={};for(const i of Object.keys(n.children)){const s=tD(n.children[i]);(s.segments.length>0||s.hasChildren())&&(t[i]=s)}return function DH(n){if(1===n.numberOfChildren&&n.children[Qi]){const t=n.children[Qi];return new br(n.segments.concat(t.segments),t.children)}return n}(new br(n.segments,t))}class mO{constructor(t){this.path=t,this.route=this.path[this.path.length-1]}}class yw{constructor(t,e){this.component=t,this.route=e}}function IH(n,t,e){const i=n._root;return Gy(i,t?t._root:null,e,[i.value])}function vw(n,t,e){const i=cO(t);return(null!=i?i:e).get(n)}function Gy(n,t,e,i,r={canDeactivateChecks:[],canActivateChecks:[]}){const s=Xg(t);return n.children.forEach(d=>{(function AH(n,t,e,i,r={canDeactivateChecks:[],canActivateChecks:[]}){const s=n.value,d=t?t.value:null,m=e?e.getContext(n.value.outlet):null;if(d&&s.routeConfig===d.routeConfig){const v=function kH(n,t,e){if("function"==typeof e)return e(n,t);switch(e){case"pathParamsChange":return!Qf(n.url,t.url);case"pathParamsOrQueryParamsChange":return!Qf(n.url,t.url)||!Vu(n.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!WT(n,t)||!Vu(n.queryParams,t.queryParams);default:return!WT(n,t)}}(d,s,s.routeConfig.runGuardsAndResolvers);v?r.canActivateChecks.push(new mO(i)):(s.data=d.data,s._resolvedData=d._resolvedData),Gy(n,t,s.component?m?m.children:null:e,i,r),v&&m&&m.outlet&&m.outlet.isActivated&&r.canDeactivateChecks.push(new yw(m.outlet.component,d))}else d&&qy(t,m,r),r.canActivateChecks.push(new mO(i)),Gy(n,null,s.component?m?m.children:null:e,i,r)})(d,s[d.value.outlet],e,i.concat([d.value]),r),delete s[d.value.outlet]}),ra(s,(d,m)=>qy(d,e.getContext(m),r)),r}function qy(n,t,e){const i=Xg(n),r=n.value;ra(i,(s,d)=>{qy(s,r.component?t?t.children.getContext(d):null:t,e)}),e.canDeactivateChecks.push(new yw(r.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,r))}class VH{}function gO(n){return new en(t=>t.error(n))}class UH{constructor(t,e,i,r,s,d){this.rootComponentType=t,this.config=e,this.urlTree=i,this.url=r,this.paramsInheritanceStrategy=s,this.relativeLinkResolution=d}recognize(){const t=mw(this.urlTree.root,[],[],this.config.filter(d=>void 0===d.redirectTo),this.relativeLinkResolution).segmentGroup,e=this.processSegmentGroup(this.config,t,Qi);if(null===e)return null;const i=new cw([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},Qi,this.rootComponentType,null,this.urlTree.root,-1,{}),r=new Wd(i,e),s=new JP(this.url,r);return this.inheritParamsAndData(s._root),s}inheritParamsAndData(t){const e=t.value,i=KP(e,this.paramsInheritanceStrategy);e.params=Object.freeze(i.params),e.data=Object.freeze(i.data),t.children.forEach(r=>this.inheritParamsAndData(r))}processSegmentGroup(t,e,i){return 0===e.segments.length&&e.hasChildren()?this.processChildren(t,e):this.processSegment(t,e,e.segments,i)}processChildren(t,e){const i=[];for(const s of Object.keys(e.children)){const d=e.children[s],m=lO(t,s),v=this.processSegmentGroup(m,d,s);if(null===v)return null;i.push(...v)}const r=bO(i);return function HH(n){n.sort((t,e)=>t.value.outlet===Qi?-1:e.value.outlet===Qi?1:t.value.outlet.localeCompare(e.value.outlet))}(r),r}processSegment(t,e,i,r){for(const s of t){const d=this.processSegmentAgainstRoute(s,e,i,r);if(null!==d)return d}return hO(e,i,r)?[]:null}processSegmentAgainstRoute(t,e,i,r){var s,d,m,v;if(t.redirectTo||!dO(t,e,i,r))return null;let D,A=[],L=[];if("**"===t.path){const We=i.length>0?BP(i).parameters:{},xt=yO(e)+i.length;D=new cw(i,We,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,xO(t),mc(t),null!==(d=null!==(s=t.component)&&void 0!==s?s:t._loadedComponent)&&void 0!==d?d:null,t,_O(e),xt,wO(t),xt)}else{const We=fw(e,t,i);if(!We.matched)return null;A=We.consumedSegments,L=We.remainingSegments;const xt=yO(e)+A.length;D=new cw(A,We.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,xO(t),mc(t),null!==(v=null!==(m=t.component)&&void 0!==m?m:t._loadedComponent)&&void 0!==v?v:null,t,_O(e),xt,wO(t),xt)}const j=function $H(n){return n.children?n.children:n.loadChildren?n._loadedRoutes:[]}(t),{segmentGroup:W,slicedSegments:ie}=mw(e,A,L,j.filter(We=>void 0===We.redirectTo),this.relativeLinkResolution);if(0===ie.length&&W.hasChildren()){const We=this.processChildren(j,W);return null===We?null:[new Wd(D,We)]}if(0===j.length&&0===ie.length)return[new Wd(D,[])];const we=mc(t)===r,Re=this.processSegment(j,W,ie,we?Qi:r);return null===Re?null:[new Wd(D,Re)]}}function GH(n){const t=n.value.routeConfig;return t&&""===t.path&&void 0===t.redirectTo}function bO(n){const t=[],e=new Set;for(const i of n){if(!GH(i)){t.push(i);continue}const r=t.find(s=>i.value.routeConfig===s.value.routeConfig);void 0!==r?(r.children.push(...i.children),e.add(r)):t.push(i)}for(const i of e){const r=bO(i.children);t.push(new Wd(i.value,r))}return t.filter(i=>!e.has(i))}function _O(n){let t=n;for(;t._sourceSegment;)t=t._sourceSegment;return t}function yO(n){var t,e;let i=n,r=null!==(t=i._segmentIndexShift)&&void 0!==t?t:0;for(;i._sourceSegment;)i=i._sourceSegment,r+=null!==(e=i._segmentIndexShift)&&void 0!==e?e:0;return r-1}function xO(n){return n.data||{}}function wO(n){return n.resolve||{}}const iD=Symbol("RouteTitle");function SO(n){return"string"==typeof n.title||null===n.title}function rD(n){return bl(t=>{const e=n(t);return e?vo(e).pipe(Hn(()=>t)):ei(t)})}class e8 extends class JH{shouldDetach(t){return!1}store(t,e){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,e){return t.routeConfig===e.routeConfig}}{}const oD=new bt("ROUTES");let sD=(()=>{class n{constructor(e,i){this.injector=e,this.compiler=i,this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap}loadComponent(e){if(this.componentLoaders.get(e))return this.componentLoaders.get(e);if(e._loadedComponent)return ei(e._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(e);const i=wp(e.loadComponent()).pipe(jo(s=>{this.onLoadEndListener&&this.onLoadEndListener(e),e._loadedComponent=s}),nw(()=>{this.componentLoaders.delete(e)})),r=new AP(i,()=>new Qt).pipe(LT());return this.componentLoaders.set(e,r),r}loadChildren(e,i){if(this.childrenLoaders.get(i))return this.childrenLoaders.get(i);if(i._loadedRoutes)return ei({routes:i._loadedRoutes,injector:i._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(i);const s=this.loadModuleFactoryOrRoutes(i.loadChildren).pipe(Hn(m=>{this.onLoadEndListener&&this.onLoadEndListener(i);let v,D,A=!1;Array.isArray(m)?D=m:(v=m.create(e).injector,D=NP(v.get(oD,[],Yn.Self|Yn.Optional)));return{routes:D.map(eD),injector:v}}),nw(()=>{this.childrenLoaders.delete(i)})),d=new AP(s,()=>new Qt).pipe(LT());return this.childrenLoaders.set(i,d),d}loadModuleFactoryOrRoutes(e){return wp(e()).pipe(ke(i=>i instanceof dM||Array.isArray(i)?ei(i):vo(this.compiler.compileModuleAsync(i))))}}return n.\u0275fac=function(e){return new(e||n)(Be(xr),Be(oC))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();class n8{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,e){return t}}function i8(n){throw n}function r8(n,t,e){return t.parse("/")}const o8={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},s8={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Ca=(()=>{class n{constructor(e,i,r,s,d,m,v){this.rootComponentType=e,this.urlSerializer=i,this.rootContexts=r,this.location=s,this.config=v,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new Qt,this.errorHandler=i8,this.malformedUriErrorHandler=r8,this.navigated=!1,this.lastSuccessfulId=-1,this.afterPreactivation=()=>ei(void 0),this.urlHandlingStrategy=new n8,this.routeReuseStrategy=new e8,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.configLoader=d.get(sD),this.configLoader.onLoadEndListener=j=>this.triggerEvent(new xU(j)),this.configLoader.onLoadStartListener=j=>this.triggerEvent(new vU(j)),this.ngModule=d.get(pp),this.console=d.get(ez);const L=d.get(oi);this.isNgZoneEnabled=L instanceof oi&&oi.isInAngularZone(),this.resetConfig(v),this.currentUrlTree=function kU(){return new Yf(new br([],{}),{},null)}(),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=QP(this.currentUrlTree,this.rootComponentType),this.transitions=new ia({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){var e;return null===(e=this.location.getState())||void 0===e?void 0:e.\u0275routerPageId}setupNavigations(e){const i=this.events;return e.pipe(Er(r=>0!==r.id),Hn(r=>Object.assign(Object.assign({},r),{extractedUrl:this.urlHandlingStrategy.extract(r.rawUrl)})),bl(r=>{let s=!1,d=!1;return ei(r).pipe(jo(m=>{this.currentNavigation={id:m.id,initialUrl:m.rawUrl,extractedUrl:m.extractedUrl,trigger:m.source,extras:m.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),bl(m=>{const v=this.browserUrlTree.toString(),D=!this.navigated||m.extractedUrl.toString()!==v||v!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||D)&&this.urlHandlingStrategy.shouldProcessUrl(m.rawUrl))return DO(m.source)&&(this.browserUrlTree=m.extractedUrl),ei(m).pipe(bl(L=>{const j=this.transitions.getValue();return i.next(new BT(L.id,this.serializeUrl(L.extractedUrl),L.source,L.restoredState)),j!==this.transitions.getValue()?Vt:Promise.resolve(L)}),function EH(n,t,e,i){return bl(r=>function CH(n,t,e,i,r){return new TH(n,t,e,i,r).apply()}(n,t,e,r.extractedUrl,i).pipe(Hn(s=>Object.assign(Object.assign({},r),{urlAfterRedirects:s}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),jo(L=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:L.urlAfterRedirects})}),function qH(n,t,e,i,r){return ke(s=>function jH(n,t,e,i,r="emptyOnly",s="legacy"){try{const d=new UH(n,t,e,i,r,s).recognize();return null===d?gO(new VH):ei(d)}catch(d){return gO(d)}}(n,t,s.urlAfterRedirects,e(s.urlAfterRedirects),i,r).pipe(Hn(d=>Object.assign(Object.assign({},s),{targetSnapshot:d}))))}(this.rootComponentType,this.config,L=>this.serializeUrl(L),this.paramsInheritanceStrategy,this.relativeLinkResolution),jo(L=>{if("eager"===this.urlUpdateStrategy){if(!L.extras.skipLocationChange){const W=this.urlHandlingStrategy.merge(L.urlAfterRedirects,L.rawUrl);this.setBrowserUrl(W,L)}this.browserUrlTree=L.urlAfterRedirects}const j=new mU(L.id,this.serializeUrl(L.extractedUrl),this.serializeUrl(L.urlAfterRedirects),L.targetSnapshot);i.next(j)}));if(D&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:j,extractedUrl:W,source:ie,restoredState:we,extras:Re}=m,We=new BT(j,this.serializeUrl(W),ie,we);i.next(We);const xt=QP(W,this.rootComponentType).snapshot;return ei(Object.assign(Object.assign({},m),{targetSnapshot:xt,urlAfterRedirects:W,extras:Object.assign(Object.assign({},Re),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=m.rawUrl,m.resolve(null),Vt}),jo(m=>{const v=new gU(m.id,this.serializeUrl(m.extractedUrl),this.serializeUrl(m.urlAfterRedirects),m.targetSnapshot);this.triggerEvent(v)}),Hn(m=>Object.assign(Object.assign({},m),{guards:IH(m.targetSnapshot,m.currentSnapshot,this.rootContexts)})),function RH(n,t){return ke(e=>{const{targetSnapshot:i,currentSnapshot:r,guards:{canActivateChecks:s,canDeactivateChecks:d}}=e;return 0===d.length&&0===s.length?ei(Object.assign(Object.assign({},e),{guardsResult:!0})):function PH(n,t,e,i){return vo(n).pipe(ke(r=>function zH(n,t,e,i,r){const s=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return s&&0!==s.length?ei(s.map(m=>{const v=vw(m,t,r);return wp(function bH(n){return n&&pw(n.canDeactivate)}(v)?v.canDeactivate(n,t,e,i):v(n,t,e,i)).pipe(Xf())})).pipe(Hy()):ei(!0)}(r.component,r.route,e,t,i)),Xf(r=>!0!==r,!0))}(d,i,r,n).pipe(ke(m=>m&&function pH(n){return"boolean"==typeof n}(m)?function OH(n,t,e,i){return vo(t).pipe(jg(r=>Ly(function FH(n,t){return null!==n&&t&&t(new wU(n)),ei(!0)}(r.route.parent,i),function LH(n,t){return null!==n&&t&&t(new CU(n)),ei(!0)}(r.route,i),function BH(n,t,e){const i=t[t.length-1],s=t.slice(0,t.length-1).reverse().map(d=>function MH(n){const t=n.routeConfig?n.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:n,guards:t}:null}(d)).filter(d=>null!==d).map(d=>Wf(()=>ei(d.guards.map(v=>{const D=vw(v,d.node,e);return wp(function gH(n){return n&&pw(n.canActivateChild)}(D)?D.canActivateChild(i,n):D(i,n)).pipe(Xf())})).pipe(Hy())));return ei(s).pipe(Hy())}(n,r.path,e),function NH(n,t,e){const i=t.routeConfig?t.routeConfig.canActivate:null;if(!i||0===i.length)return ei(!0);const r=i.map(s=>Wf(()=>{const d=vw(s,t,e);return wp(function mH(n){return n&&pw(n.canActivate)}(d)?d.canActivate(t,n):d(t,n)).pipe(Xf())}));return ei(r).pipe(Hy())}(n,r.route,e))),Xf(r=>!0!==r,!0))}(i,s,n,t):ei(m)),Hn(m=>Object.assign(Object.assign({},e),{guardsResult:m})))})}(this.ngModule.injector,m=>this.triggerEvent(m)),jo(m=>{if(Kf(m.guardsResult)){const D=VT(`Redirecting to "${this.serializeUrl(m.guardsResult)}"`);throw D.url=m.guardsResult,D}const v=new bU(m.id,this.serializeUrl(m.extractedUrl),this.serializeUrl(m.urlAfterRedirects),m.targetSnapshot,!!m.guardsResult);this.triggerEvent(v)}),Er(m=>!!m.guardsResult||(this.restoreHistory(m),this.cancelNavigationTransition(m,""),!1)),rD(m=>{if(m.guards.canActivateChecks.length)return ei(m).pipe(jo(v=>{const D=new _U(v.id,this.serializeUrl(v.extractedUrl),this.serializeUrl(v.urlAfterRedirects),v.targetSnapshot);this.triggerEvent(D)}),bl(v=>{let D=!1;return ei(v).pipe(function WH(n,t){return ke(e=>{const{targetSnapshot:i,guards:{canActivateChecks:r}}=e;if(!r.length)return ei(e);let s=0;return vo(r).pipe(jg(d=>function XH(n,t,e,i){const r=n.routeConfig,s=n._resolve;return void 0!==(null==r?void 0:r.title)&&!SO(r)&&(s[iD]=r.title),function ZH(n,t,e,i){const r=function YH(n){return[...Object.keys(n),...Object.getOwnPropertySymbols(n)]}(n);if(0===r.length)return ei({});const s={};return vo(r).pipe(ke(d=>function QH(n,t,e,i){const r=vw(n,t,i);return wp(r.resolve?r.resolve(t,e):r(t,e))}(n[d],t,e,i).pipe(Xf(),jo(m=>{s[d]=m}))),FT(1),Fy(s),xp(d=>d instanceof Oy?Vt:qg(d)))}(s,n,t,i).pipe(Hn(d=>(n._resolvedData=d,n.data=KP(n,e).resolve,r&&SO(r)&&(n.data[iD]=r.title),null)))}(d.route,i,n,t)),jo(()=>s++),FT(1),ke(d=>s===r.length?ei(e):Vt))})}(this.paramsInheritanceStrategy,this.ngModule.injector),jo({next:()=>D=!0,complete:()=>{D||(this.restoreHistory(v),this.cancelNavigationTransition(v,"At least one route resolver didn't emit any value."))}}))}),jo(v=>{const D=new yU(v.id,this.serializeUrl(v.extractedUrl),this.serializeUrl(v.urlAfterRedirects),v.targetSnapshot);this.triggerEvent(D)}))}),rD(m=>{const v=D=>{var A;const L=[];(null===(A=D.routeConfig)||void 0===A?void 0:A.loadComponent)&&!D.routeConfig._loadedComponent&&L.push(this.configLoader.loadComponent(D.routeConfig).pipe(jo(j=>{D.component=j}),Hn(()=>{})));for(const j of D.children)L.push(...v(j));return L};return Py(v(m.targetSnapshot.root)).pipe(NT(),Hr(1))}),rD(()=>this.afterPreactivation()),Hn(m=>{const v=function ZU(n,t,e){const i=zy(n,t._root,e?e._root:void 0);return new YP(i,t)}(this.routeReuseStrategy,m.targetSnapshot,m.currentRouterState);return Object.assign(Object.assign({},m),{targetRouterState:v})}),jo(m=>{this.currentUrlTree=m.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(m.urlAfterRedirects,m.rawUrl),this.routerState=m.targetRouterState,"deferred"===this.urlUpdateStrategy&&(m.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,m),this.browserUrlTree=m.urlAfterRedirects)}),((n,t,e)=>Hn(i=>(new hH(t,i.targetRouterState,i.currentRouterState,e).activate(n),i)))(this.rootContexts,this.routeReuseStrategy,m=>this.triggerEvent(m)),jo({next(){s=!0},complete(){s=!0}}),nw(()=>{var m;s||d||this.cancelNavigationTransition(r,`Navigation ID ${r.id} is not equal to the current navigation id ${this.navigationId}`),(null===(m=this.currentNavigation)||void 0===m?void 0:m.id)===r.id&&(this.currentNavigation=null)}),xp(m=>{if(d=!0,function IU(n){return n&&n[LP]}(m)){const v=Kf(m.url);v||(this.navigated=!0,this.restoreHistory(r,!0));const D=new iw(r.id,this.serializeUrl(r.extractedUrl),m.message);if(i.next(D),v){const A=this.urlHandlingStrategy.merge(m.url,this.rawUrlTree),L={skipLocationChange:r.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||DO(r.source)};this.scheduleNavigation(A,"imperative",null,L,{resolve:r.resolve,reject:r.reject,promise:r.promise})}else r.resolve(!1)}else{this.restoreHistory(r,!0);const v=new PP(r.id,this.serializeUrl(r.extractedUrl),m);i.next(v);try{r.resolve(this.errorHandler(m))}catch(D){r.reject(D)}}return Vt}))}))}resetRootComponentType(e){this.rootComponentType=e,this.routerState.root.component=this.rootComponentType}setTransition(e){this.transitions.next(Object.assign(Object.assign({},this.transitions.value),e))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(e=>{const i="popstate"===e.type?"popstate":"hashchange";"popstate"===i&&setTimeout(()=>{var r;const s={replaceUrl:!0},d=null!==(r=e.state)&&void 0!==r&&r.navigationId?e.state:null;if(d){const v=Object.assign({},d);delete v.navigationId,delete v.\u0275routerPageId,0!==Object.keys(v).length&&(s.state=v)}const m=this.parseUrl(e.url);this.scheduleNavigation(m,i,d,s)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(e){this.events.next(e)}resetConfig(e){this.config=e.map(eD),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(e,i={}){const{relativeTo:r,queryParams:s,fragment:d,queryParamsHandling:m,preserveFragment:v}=i,D=r||this.routerState.root,A=v?this.currentUrlTree.fragment:d;let L=null;switch(m){case"merge":L=Object.assign(Object.assign({},this.currentUrlTree.queryParams),s);break;case"preserve":L=this.currentUrlTree.queryParams;break;default:L=s||null}return null!==L&&(L=this.removeEmptyProps(L)),function KU(n,t,e,i,r){var s;if(0===e.length)return ZT(t.root,t.root,t.root,i,r);const m=function JU(n){if("string"==typeof n[0]&&1===n.length&&"/"===n[0])return new nO(!0,0,n);let t=0,e=!1;const i=n.reduce((r,s,d)=>{if("object"==typeof s&&null!=s){if(s.outlets){const m={};return ra(s.outlets,(v,D)=>{m[D]="string"==typeof v?v.split("/"):v}),[...r,{outlets:m}]}if(s.segmentPath)return[...r,s.segmentPath]}return"string"!=typeof s?[...r,s]:0===d?(s.split("/").forEach((m,v)=>{0==v&&"."===m||(0==v&&""===m?e=!0:".."===m?t++:""!=m&&r.push(m))}),r):[...r,s]},[]);return new nO(e,t,i)}(e);return m.toRoot()?ZT(t.root,t.root,new br([],{}),i,r):function v(A){var L;const j=function eH(n,t,e,i){return n.isAbsolute?new YT(t.root,!0,0):-1===i?new YT(e,e===t.root,0):function tH(n,t,e){let i=n,r=t,s=e;for(;s>r;){if(s-=r,i=i.parent,!i)throw new Dt(4005,!1);r=i.segments.length}return new YT(i,!1,r-s)}(e,i+(uw(n.commands[0])?0:1),n.numberOfDoubleDots)}(m,t,null===(L=n.snapshot)||void 0===L?void 0:L._urlSegment,A),W=j.processChildren?dw(j.segmentGroup,j.index,m.commands):iO(j.segmentGroup,j.index,m.commands);return ZT(t.root,j.segmentGroup,W,i,r)}(null===(s=n.snapshot)||void 0===s?void 0:s._lastPathIndex)}(D,this.currentUrlTree,e,L,null!=A?A:null)}navigateByUrl(e,i={skipLocationChange:!1}){const r=Kf(e)?e:this.parseUrl(e),s=this.urlHandlingStrategy.merge(r,this.rawUrlTree);return this.scheduleNavigation(s,"imperative",null,i)}navigate(e,i={skipLocationChange:!1}){return function a8(n){for(let t=0;t<n.length;t++){if(null==n[t])throw new Dt(4008,!1)}}(e),this.navigateByUrl(this.createUrlTree(e,i),i)}serializeUrl(e){return this.urlSerializer.serialize(e)}parseUrl(e){let i;try{i=this.urlSerializer.parse(e)}catch(r){i=this.malformedUriErrorHandler(r,this.urlSerializer,e)}return i}isActive(e,i){let r;if(r=!0===i?Object.assign({},o8):!1===i?Object.assign({},s8):i,Kf(e))return VP(this.currentUrlTree,e,r);const s=this.parseUrl(e);return VP(this.currentUrlTree,s,r)}removeEmptyProps(e){return Object.keys(e).reduce((i,r)=>{const s=e[r];return null!=s&&(i[r]=s),i},{})}processNavigations(){this.navigations.subscribe(e=>{var i;this.navigated=!0,this.lastSuccessfulId=e.id,this.currentPageId=e.targetPageId,this.events.next(new Zf(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,null===(i=this.titleStrategy)||void 0===i||i.updateTitle(this.routerState.snapshot),e.resolve(!0)},e=>{this.console.warn(`Unhandled Navigation Error: ${e}`)})}scheduleNavigation(e,i,r,s,d){var m,v;if(this.disposed)return Promise.resolve(!1);let D,A,L;d?(D=d.resolve,A=d.reject,L=d.promise):L=new Promise((ie,we)=>{D=ie,A=we});const j=++this.navigationId;let W;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(r=this.location.getState()),W=r&&r.\u0275routerPageId?r.\u0275routerPageId:s.replaceUrl||s.skipLocationChange?null!==(m=this.browserPageId)&&void 0!==m?m:0:(null!==(v=this.browserPageId)&&void 0!==v?v:0)+1):W=0,this.setTransition({id:j,targetPageId:W,source:i,restoredState:r,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:e,extras:s,resolve:D,reject:A,promise:L,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),L.catch(ie=>Promise.reject(ie))}setBrowserUrl(e,i){const r=this.urlSerializer.serialize(e),s=Object.assign(Object.assign({},i.extras.state),this.generateNgRouterState(i.id,i.targetPageId));this.location.isCurrentPathEqualTo(r)||i.extras.replaceUrl?this.location.replaceState(r,"",s):this.location.go(r,"",s)}restoreHistory(e,i=!1){var r,s;if("computed"===this.canceledNavigationResolution){const d=this.currentPageId-e.targetPageId;"popstate"!==e.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null===(r=this.currentNavigation)||void 0===r?void 0:r.finalUrl)||0===d?this.currentUrlTree===(null===(s=this.currentNavigation)||void 0===s?void 0:s.finalUrl)&&0===d&&(this.resetState(e),this.browserUrlTree=e.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(d)}else"replace"===this.canceledNavigationResolution&&(i&&this.resetState(e),this.resetUrlToCurrentUrlTree())}resetState(e){this.routerState=e.currentRouterState,this.currentUrlTree=e.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,e.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(e,i){const r=new iw(e.id,this.serializeUrl(e.extractedUrl),i);this.triggerEvent(r),e.resolve(!1)}generateNgRouterState(e,i){return"computed"===this.canceledNavigationResolution?{navigationId:e,\u0275routerPageId:i}:{navigationId:e}}}return n.\u0275fac=function(e){zs()},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();function DO(n){return"imperative"!==n}let aD=(()=>{class n{constructor(e,i,r,s,d){this.router=e,this.route=i,this.tabIndexAttribute=r,this.renderer=s,this.el=d,this.commands=null,this.onChanges=new Qt,this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(e){if(null!=this.tabIndexAttribute)return;const i=this.renderer,r=this.el.nativeElement;null!==e?i.setAttribute(r,"tabindex",e):i.removeAttribute(r,"tabindex")}ngOnChanges(e){this.onChanges.next(this)}set routerLink(e){null!=e?(this.commands=Array.isArray(e)?e:[e],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(){if(null===this.urlTree)return!0;const e={skipLocationChange:Vd(this.skipLocationChange),replaceUrl:Vd(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,e),!0}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:Vd(this.preserveFragment)})}}return n.\u0275fac=function(e){return new(e||n)($(Ca),$(Zg),Vr("tabindex"),$(Ou),$(Pn))},n.\u0275dir=vt({type:n,selectors:[["","routerLink","",5,"a",5,"area"]],hostBindings:function(e,i){1&e&&Wt("click",function(){return i.onClick()})},inputs:{queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo",routerLink:"routerLink"},features:[dr]}),n})(),xw=(()=>{class n{constructor(e,i,r){this.router=e,this.route=i,this.locationStrategy=r,this.commands=null,this.href=null,this.onChanges=new Qt,this.subscription=e.events.subscribe(s=>{s instanceof Zf&&this.updateTargetUrlAndHref()})}set routerLink(e){this.commands=null!=e?Array.isArray(e)?e:[e]:null}ngOnChanges(e){this.updateTargetUrlAndHref(),this.onChanges.next(this)}ngOnDestroy(){this.subscription.unsubscribe()}onClick(e,i,r,s,d){if(0!==e||i||r||s||d||"string"==typeof this.target&&"_self"!=this.target||null===this.urlTree)return!0;const m={skipLocationChange:Vd(this.skipLocationChange),replaceUrl:Vd(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,m),!1}updateTargetUrlAndHref(){this.href=null!==this.urlTree?this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:Vd(this.preserveFragment)})}}return n.\u0275fac=function(e){return new(e||n)($(Ca),$(Zg),$(Vf))},n.\u0275dir=vt({type:n,selectors:[["a","routerLink",""],["area","routerLink",""]],hostVars:2,hostBindings:function(e,i){1&e&&Wt("click",function(s){return i.onClick(s.button,s.ctrlKey,s.shiftKey,s.altKey,s.metaKey)}),2&e&&Ht("target",i.target)("href",i.href,xd)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo",routerLink:"routerLink"},features:[dr]}),n})(),EO=(()=>{class n{constructor(e,i,r,s,d,m){this.router=e,this.element=i,this.renderer=r,this.cdr=s,this.link=d,this.linkWithHref=m,this.classes=[],this.isActive=!1,this.routerLinkActiveOptions={exact:!1},this.isActiveChange=new Xt,this.routerEventsSubscription=e.events.subscribe(v=>{v instanceof Zf&&this.update()})}ngAfterContentInit(){ei(this.links.changes,this.linksWithHrefs.changes,ei(null)).pipe(ht()).subscribe(e=>{this.update(),this.subscribeToEachLinkOnChanges()})}subscribeToEachLinkOnChanges(){var e;null===(e=this.linkInputChangesSubscription)||void 0===e||e.unsubscribe();const i=[...this.links.toArray(),...this.linksWithHrefs.toArray(),this.link,this.linkWithHref].filter(r=>!!r).map(r=>r.onChanges);this.linkInputChangesSubscription=vo(i).pipe(ht()).subscribe(r=>{this.isActive!==this.isLinkActive(this.router)(r)&&this.update()})}set routerLinkActive(e){const i=Array.isArray(e)?e:e.split(" ");this.classes=i.filter(r=>!!r)}ngOnChanges(e){this.update()}ngOnDestroy(){var e;this.routerEventsSubscription.unsubscribe(),null===(e=this.linkInputChangesSubscription)||void 0===e||e.unsubscribe()}update(){!this.links||!this.linksWithHrefs||!this.router.navigated||Promise.resolve().then(()=>{const e=this.hasActiveLinks();this.isActive!==e&&(this.isActive=e,this.cdr.markForCheck(),this.classes.forEach(i=>{e?this.renderer.addClass(this.element.nativeElement,i):this.renderer.removeClass(this.element.nativeElement,i)}),e&&void 0!==this.ariaCurrentWhenActive?this.renderer.setAttribute(this.element.nativeElement,"aria-current",this.ariaCurrentWhenActive.toString()):this.renderer.removeAttribute(this.element.nativeElement,"aria-current"),this.isActiveChange.emit(e))})}isLinkActive(e){const i=function l8(n){return!!n.paths}(this.routerLinkActiveOptions)?this.routerLinkActiveOptions:this.routerLinkActiveOptions.exact||!1;return r=>!!r.urlTree&&e.isActive(r.urlTree,i)}hasActiveLinks(){const e=this.isLinkActive(this.router);return this.link&&e(this.link)||this.linkWithHref&&e(this.linkWithHref)||this.links.some(e)||this.linksWithHrefs.some(e)}}return n.\u0275fac=function(e){return new(e||n)($(Ca),$(Pn),$(Ou),$(Dr),$(aD,8),$(xw,8))},n.\u0275dir=vt({type:n,selectors:[["","routerLinkActive",""]],contentQueries:function(e,i,r){if(1&e&&(Ur(r,aD,5),Ur(r,xw,5)),2&e){let s;zn(s=Vn())&&(i.links=s),zn(s=Vn())&&(i.linksWithHrefs=s)}},inputs:{routerLinkActiveOptions:"routerLinkActiveOptions",ariaCurrentWhenActive:"ariaCurrentWhenActive",routerLinkActive:"routerLinkActive"},outputs:{isActiveChange:"isActiveChange"},exportAs:["routerLinkActive"],features:[dr]}),n})();class IO{buildTitle(t){var e;let i,r=t.root;for(;void 0!==r;)i=null!==(e=this.getResolvedTitleForRoute(r))&&void 0!==e?e:i,r=r.children.find(s=>s.outlet===Qi);return i}getResolvedTitleForRoute(t){return t.data[iD]}}let c8=(()=>{class n extends IO{constructor(e){super(),this.title=e}updateTitle(e){const i=this.buildTitle(e);void 0!==i&&this.title.setTitle(i)}}return n.\u0275fac=function(e){return new(e||n)(Be(bk))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class MO{}let AO=(()=>{class n{constructor(e,i,r,s,d){this.router=e,this.injector=r,this.preloadingStrategy=s,this.loader=d}setUpPreloading(){this.subscription=this.router.events.pipe(Er(e=>e instanceof Zf),jg(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(e,i){var r,s,d;const m=[];for(const v of i){v.providers&&!v._injector&&(v._injector=Q0(v.providers,e,`Route: ${v.path}`));const D=null!==(r=v._injector)&&void 0!==r?r:e,A=null!==(s=v._loadedInjector)&&void 0!==s?s:D;v.loadChildren&&!v._loadedRoutes||v.loadComponent&&!v._loadedComponent?m.push(this.preloadConfig(D,v)):(v.children||v._loadedRoutes)&&m.push(this.processRoutes(A,null!==(d=v.children)&&void 0!==d?d:v._loadedRoutes))}return vo(m).pipe(ht())}preloadConfig(e,i){return this.preloadingStrategy.preload(i,()=>{let r;r=i.loadChildren&&void 0===i.canLoad?this.loader.loadChildren(e,i):ei(null);const s=r.pipe(ke(d=>{var m;return null===d?ei(void 0):(i._loadedRoutes=d.routes,i._loadedInjector=d.injector,this.processRoutes(null!==(m=d.injector)&&void 0!==m?m:e,d.routes))}));return i.loadComponent&&!i._loadedComponent?vo([s,this.loader.loadComponent(i)]).pipe(ht()):s})}}return n.\u0275fac=function(e){return new(e||n)(Be(Ca),Be(oC),Be(Su),Be(MO),Be(sD))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();const kO=new bt("");let u8=(()=>{class n{constructor(e,i,r={}){this.router=e,this.viewportScroller=i,this.options=r,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},r.scrollPositionRestoration=r.scrollPositionRestoration||"disabled",r.anchorScrolling=r.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(e=>{e instanceof BT?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=e.navigationTrigger,this.restoredId=e.restoredState?e.restoredState.navigationId:0):e instanceof Zf&&(this.lastId=e.id,this.scheduleScrollEvent(e,this.router.parseUrl(e.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(e=>{e instanceof OP&&(e.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(e.position):e.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(e.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(e,i){this.router.triggerEvent(new OP(e,"popstate"===this.lastSource?this.store[this.restoredId]:null,i))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return n.\u0275fac=function(e){zs()},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();const lD=new bt("ROUTER_CONFIGURATION",{providedIn:"root",factory:()=>({})}),RO=new bt("ROUTER_FORROOT_GUARD"),PO=new bt(""),d8=[ux,{provide:$P,useClass:GP},{provide:Ca,useFactory:function b8(n,t,e,i,r,s,d={},m,v,D,A){const L=new Ca(null,n,t,e,i,r,NP(s));return D&&(L.urlHandlingStrategy=D),A&&(L.routeReuseStrategy=A),L.titleStrategy=null!=v?v:m,function _8(n,t){n.errorHandler&&(t.errorHandler=n.errorHandler),n.malformedUriErrorHandler&&(t.malformedUriErrorHandler=n.malformedUriErrorHandler),n.onSameUrlNavigation&&(t.onSameUrlNavigation=n.onSameUrlNavigation),n.paramsInheritanceStrategy&&(t.paramsInheritanceStrategy=n.paramsInheritanceStrategy),n.relativeLinkResolution&&(t.relativeLinkResolution=n.relativeLinkResolution),n.urlUpdateStrategy&&(t.urlUpdateStrategy=n.urlUpdateStrategy),n.canceledNavigationResolution&&(t.canceledNavigationResolution=n.canceledNavigationResolution)}(d,L),L},deps:[$P,jy,ux,xr,oC,oD,lD,c8,[IO,new Cs],[class t8{},new Cs],[class KH{},new Cs]]},jy,{provide:Zg,useFactory:function y8(n){return n.routerState.root},deps:[Ca]},sD];function h8(){return new aA("Router",Ca)}let ww=(()=>{class n{constructor(e,i){}static forRoot(e,i){return{ngModule:n,providers:[d8,[],OO(e),{provide:RO,useFactory:g8,deps:[[Ca,new Cs,new Ts]]},{provide:lD,useValue:i||{}},null!=i&&i.useHash?{provide:Vf,useClass:$z}:{provide:Vf,useClass:kA},{provide:kO,useFactory:()=>{const n=Mn(Ca),t=Mn(ij),e=Mn(lD);return e.scrollOffset&&t.setOffset(e.scrollOffset),new u8(n,t,e)}},null!=i&&i.preloadingStrategy?D8(i.preloadingStrategy):[],{provide:aA,multi:!0,useFactory:h8},null!=i&&i.initialNavigation?x8(i):[],[{provide:LO,useFactory:v8},{provide:eA,multi:!0,useExisting:LO}]]}}static forChild(e){return{ngModule:n,providers:[OO(e)]}}}return n.\u0275fac=function(e){return new(e||n)(Be(RO,8),Be(Ca,8))},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({}),n})();function g8(n){return"guarded"}function OO(n){return[{provide:pv,multi:!0,useValue:n},{provide:oD,multi:!0,useValue:n}]}function v8(){const n=Mn(xr);return t=>{var e,i;const r=n.get(Ng);if(t!==r.components[0])return;const s=n.get(Ca),d=n.get(FO);null===n.get(cD,null,Yn.Optional)&&s.initialNavigation(),null===(e=n.get(PO,null,Yn.Optional))||void 0===e||e.setUpPreloading(),null===(i=n.get(kO,null,Yn.Optional))||void 0===i||i.init(),s.resetRootComponentType(r.componentTypes[0]),d.next(),d.complete()}}const LO=new bt("");function x8(n){return["disabled"===n.initialNavigation?[{provide:tx,multi:!0,useFactory:()=>{const n=Mn(Ca);return()=>{n.setUpLocationChangeListener()}}},{provide:cD,useValue:"disabled"}]:[],"enabledBlocking"===n.initialNavigation?[{provide:cD,useValue:"enabledBlocking"},{provide:tx,multi:!0,deps:[xr],useFactory:n=>{const t=n.get(jz,Promise.resolve(null));let e=!1;return()=>t.then(()=>new Promise(r=>{const s=n.get(Ca),d=n.get(FO);(function i(r){const s=n.get(Ca);s.events.pipe(Er(d=>d instanceof Zf||d instanceof iw||d instanceof PP),Hn(d=>{if(d instanceof Zf)return!0;const m=s.navigationId!==d.id,v=d instanceof iw&&-1!==d.reason.indexOf(zT);return!(!m&&!v)&&null}),Er(d=>null!==d),Hr(1)).subscribe(()=>{r()})})(()=>{r(!0),e=!0}),s.afterPreactivation=()=>(r(!0),e||d.closed?ei(void 0):d),s.initialNavigation()}))}}]:[]]}const FO=new bt("",{factory:()=>new Qt}),cD=new bt("");function D8(n){return[AO,{provide:PO,useExisting:AO},{provide:MO,useExisting:n}]}const Sp={app_stages:{PROD:{key:"PROD",apiEndpoint:"https://api.opentransportdata.swiss/ojp2020",authBearerKey:"57c5dbbbf1fe4d0001000018e0f7158cb2b347e3a6745e3ef949e7bf"},INT:{key:"INT",apiEndpoint:"https://odpch-test.cloud.tyk.io/ojp-passiv-int/",authBearerKey:"57c5dadd5e6307000100005e473137db130241e5866ecdbce5f74ccb"},TEST:{key:"TEST",apiEndpoint:"https://odpch-test.cloud.tyk.io/ojp-test/",authBearerKey:"57c5dadd5e6307000100005ead6b87d5ec4f48d3ad5f9414e92907d4"},"LA Beta":{key:"LA Beta",apiEndpoint:"https://odpch-test.cloud.tyk.io/la_test_active_server/",authBearerKey:"57c5dadd5e6307000100005e0e0520340d05419b8c1f13c17a20a8ab"}},map_app_map_layers:{stops:{LIR_Restriction_Type:"stop",minZoom:13,layer_ids:["stops-circle","stops-label"],click_layer_ids:"SAME_AS_LAYER_IDS"},addresses:{LIR_Restriction_Type:"address",minZoom:17,layer_ids:["address-circle"],click_layer_ids:"SAME_AS_LAYER_IDS"},sharing_cars:{LIR_Restriction_Type:"poi_amenity",LIR_POI_Type:"car_sharing",minZoom:12,layer_ids:["car-rental-icon"],click_layer_ids:"SAME_AS_LAYER_IDS"},sharing_bicycles:{LIR_Restriction_Type:"poi_amenity",LIR_POI_Type:"bicycle_rental",minZoom:14,layer_ids:["bike-icon"],click_layer_ids:"SAME_AS_LAYER_IDS"},sharing_scooters:{LIR_Restriction_Type:"poi_amenity",LIR_POI_Type:"escooter_rental",minZoom:14,layer_ids:["scooter-icon"],click_layer_ids:"SAME_AS_LAYER_IDS"},charging_stations:{LIR_Restriction_Type:"poi_amenity",LIR_POI_Type:"charging_station",minZoom:12,layer_ids:["charging-station-icon"],click_layer_ids:"SAME_AS_LAYER_IDS"},"pois-ALL":{LIR_Restriction_Type:"poi_all",LIR_POI_Type:["service","shopping","leisure","catering","public","parkride","accommodation"],minZoom:16,layer_ids:["poi-all"],click_layer_ids:"SAME_AS_LAYER_IDS"}}},Wy={ContinousLeg:"#009933",TransferLeg:"#0000ff",TimedLeg:"#D04D44"},E8=["ContinousLeg","TimedLeg","TransferLeg"],Yg={Unknown:"#ffafcc",LongDistanceRail:"#D04D44",SBahn:"#3D69CA",Bus:"#5F8EF4",PostAuto:"#EBBE24",OnDemand:"#D77D00",Aerial:"#8B4513",Funicular:"#006400",Walk:"#009933","Self-Drive Car":"#ff004f","Shared Mobility":"#32CD32",Guidance:"#6f0000",Transfer:"#088F8F"},I8=["LongDistanceRail","SBahn","Bus","PostAuto","OnDemand","Aerial","Walk","Guidance","Transfer","Self-Drive Car","Shared Mobility"];class _l{static formatDate(t){return[t.getFullYear(),"-",("00"+(t.getMonth()+1)).slice(-2),"-",("00"+t.getDate()).slice(-2)," ",("00"+t.getHours()).slice(-2),":",("00"+t.getMinutes()).slice(-2),":",("00"+t.getSeconds()).slice(-2)].join("")}static formatTimeHHMM(t,e=":"){return _l.formatDate(t).substring(11,16)}static formatDistance(t){return t>1e3?(t/1e3).toFixed(1)+"km":t+"m"}}var Uo=(()=>{return(n=Uo||(Uo={})).LegType="leg.type",n.DrawType="draw.type",n.PointType="point.type",n.LineType="line.type",Uo;var n})();class gc{static FilterBeelines(){return this.FilterByDrawType("Beeline")}static FilterWalkingLegs(){return["all",this.FilterByDrawType("LegLine"),this.FilterByLineType("Walk")]}static FilterLegPoints(){return this.FilterByDrawType("LegPoint")}static ColorCaseByLegLineType(){const t=["case"];return I8.forEach(e=>{t.push(["==",["get",Uo.LineType],e]),t.push(Yg[e])}),t.push("#FF1493"),t}static FilterByLegType(t){return["==",["get",Uo.LegType],t]}static FilterByDrawType(t){return["==",["get",Uo.DrawType],t]}static FilterByPointType(t){return["==",["get",Uo.PointType],t]}static FilterByLineType(t){return["==",["get",Uo.LineType],t]}static FilterTimedLegTracks(){return["all",this.FilterByDrawType("LegLine")]}static ColorCaseByLegType(){const t=["case"];return E8.forEach(e=>{t.push(["==",["get",Uo.LegType],e]),t.push(Wy[e])}),t.push("#FF1493"),t}}var M8=rt(823),NO=rt.n(M8);const BO={siri:"http://www.siri.org.uk/siri",ojp:"http://www.vdv.de/ojp"};class on{static queryNodes(t,e){return NO().useNamespaces(BO)(t,e)}static queryNode(t,e){const i=on.queryNodes(t,e);return 0===i.length?null:i[0]}static queryText(t,e){const r=NO().useNamespaces(BO)(t,e,!0);return r?r.textContent:null}}class Zd{constructor(t,e){this.hours=t,this.minutes=e,this.totalMinutes=60*t+e}static initFromContextNode(t,e="ojp:Duration"){if(null===t)return null;let i=on.queryText(e,t);if(null===i)return null;i=i.replace("PT","");let r=0;const s=i.match(/([0-9]+?)H/);s&&(r=parseInt(s[1]));let d=0;const m=i.match(/([0-9]+?)M/);return m&&(d=parseInt(m[1])),new Zd(r,d)}static initFromTotalMinutes(t){const e=Math.floor(t/60);return new Zd(e,t-60*e)}formatDuration(){const t=[];return this.hours>0&&t.push(this.hours+"h "),t.push(this.minutes+"min"),t.join("")}}class A8{constructor(t){this.sections=t}computeAggregatedTrips(){let t=[],e=[],i=0,r=0;const s=this.sections.length>1;return this.sections.forEach((d,m)=>{if(m===this.sections.length-1)d.response.trips.forEach(D=>{if(s){let A=this.computeFirstValidTrip();D.stats.startDatetime=A?A.stats.startDatetime:new Date,D.stats.transferNo+=this.sections.length-1,D.stats.distanceMeters+=i,D.stats.duration=Zd.initFromTotalMinutes(r+D.stats.duration.totalMinutes)}D.legs=e.concat(D.legs)}),t=d.response.trips;else if(d.response.trips.length>0){const A=d.response.trips[0];e=e.concat(A.legs),i+=A.stats.distanceMeters,r+=A.stats.duration.totalMinutes}}),t}computeFirstValidTrip(){for(let t of this.sections)if(t.response.trips.length>0)return t.response.trips[0];return null}}var k8=rt(898),oa=rt.n(k8);class Ta{constructor(t,e){this.longitude=t,this.latitude=e,this.properties=null}static initFromContextNode(t){const e=on.queryText("ojp:GeoPosition/siri:Longitude",t),i=on.queryText("ojp:GeoPosition/siri:Latitude",t);if(null===e||null===i)return null;const r=parseFloat(e),s=parseFloat(i);return 0===r||0===s?null:new Ta(r,s)}static initWithFeature(t){if("Point"!==t.geometry.type)return null;const e=t.geometry.coordinates,s=new Ta(e[0],e[1]);return s.properties=t.properties,s}asLngLat(){return new(oa().LngLat)(this.longitude,this.latitude)}asLatLngString(t=!0){let e="";return e=t?this.latitude.toFixed(6)+","+this.longitude.toFixed(6):this.latitude+","+this.longitude,e}asPosition(){return[this.longitude,this.latitude]}distanceFrom(t){const i=(t.latitude-this.latitude)*Math.PI/180,r=(t.longitude-this.longitude)*Math.PI/180,s=Math.sin(i/2)*Math.sin(i/2)+Math.cos(this.latitude*Math.PI/180)*Math.cos(t.latitude*Math.PI/180)*Math.sin(r/2)*Math.sin(r/2),d=2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s));return Math.round(6371*d*1e3)}}class Cp{constructor(t,e,i,r="StopPlace"){this.stopPlaceRef=t,this.stopPlaceName=e,this.topographicPlaceRef=i,this.stopType=r}static initFromContextNode(t){let i=on.queryText("ojp:StopPlace/ojp:StopPlaceRef",t),r=on.queryText("ojp:StopPlace/ojp:StopPlaceName/ojp:Text",t);if(i&&r||(i=on.queryText("ojp:StopPoint/siri:StopPointRef",t),r=on.queryText("ojp:StopPoint/ojp:StopPointName/ojp:Text",t)),!i||!r)return null;const s=on.queryText("ojp:StopPlace/ojp:TopographicPlaceRef",t);return new Cp(i,r,s)}static initFromServiceNode(t,e){const i=on.queryText("ojp:"+e+"StopPointRef",t),r=on.queryText("ojp:"+e+"Text/ojp:Text",t);return i&&r?new Cp(i,r,null,"StopPlace"):null}}class Sw{constructor(t,e,i){this.addressCode=t,this.addressName=e,this.topographicPlaceRef=i}static initFromContextNode(t){const e=on.queryText("ojp:Address/ojp:AddressCode",t);if(null===e)return null;const i=on.queryText("ojp:Address/ojp:AddressName/ojp:Text",t),r=on.queryText("ojp:Address/ojp:TopographicPlaceRef",t);return new Sw(e,i,r)}}const uD={service:["atm","hairdresser"],shopping:["all","clothes","optician"],catering:["all"],accommodation:["all"]};class dD{constructor(t,e,i,r,s){this.code=t,this.name=e,this.category=i,this.subCategory=r,this.categoryTags=s}static initFromContextNode(t){const e=on.queryText("ojp:PointOfInterest/ojp:PointOfInterestCode",t),i=on.queryText("ojp:PointOfInterest/ojp:PointOfInterestName/ojp:Text",t);if(!e||!i)return null;const r=[],s=[];on.queryNodes("ojp:PointOfInterest/ojp:PointOfInterestCategory",t).forEach(A=>{const L=on.queryText("ojp:OsmTag/ojp:Value",A);L&&r.push(L);const j=on.queryText("ojp:OsmTag/ojp:Tag",A);j&&s.push(j)});let m=null,v=null;return 2===r.length&&(m=r[1],v=r[0]),1===r.length&&(m=r[0]),null===m?null:new dD(e,i,m,v,r)}computePoiMapIcon(){const t="poi-unknown";return this.category in uD?this.subCategory&&uD[this.category].indexOf(this.subCategory)>-1?"poi-"+this.category+"-"+this.subCategory:uD[this.category].indexOf("all")>-1?"poi-"+this.category+"-all":t:t}}class Ho{constructor(){this.address=null,this.stopPointRef=null,this.locationName=null,this.stopPlace=null,this.geoPosition=null,this.poi=null,this.attributes={}}static initWithOJPContextNode(t){var e;const i=new Ho;i.address=Sw.initFromContextNode(t),i.stopPointRef=on.queryText("siri:StopPointRef",t),i.stopPlace=Cp.initFromContextNode(t),i.geoPosition=Ta.initFromContextNode(t),i.poi=dD.initFromContextNode(t);let r=on.queryText("ojp:LocationName/ojp:Text",t);return null===r&&(r=on.queryText("ojp:StopPointName/ojp:Text",t)),i.locationName=r,i.attributes={},on.queryNodes("ojp:Attribute/*",t).forEach(d=>{const m=d.nodeName.split(":"),v=1===m.length?m[0]:m[1],D=on.queryText("ojp:Attribute/"+d.nodeName,t);D&&(i.attributes[v]=D.trim())}),null===i.stopPointRef&&(null===(e=i.stopPlace)||void 0===e?void 0:e.stopPlaceRef)&&(i.stopPointRef=i.stopPlace.stopPlaceRef),i}static initWithStopPlaceRef(t,e=""){const i=new Ho;return i.stopPlace=new Cp(t,e,null),i}static initWithLngLat(t,e){const i=new Ho;return i.geoPosition=new Ta(t,e),i}static initWithFeature(t){var e,i,r,s;const d=Ta.initWithFeature(t);if(null===d)return null;const m=t.properties;if(null===m)return null;const v=new Ho;v.geoPosition=d,v.locationName=null!==(e=m.locationName)&&void 0!==e?e:null;const D=m["stopPlace.stopPlaceRef"];if(D){const L=null!==(i=m["stopPlace.stopPlaceName"])&&void 0!==i?i:null;v.stopPlace=new Cp(D,L,null)}const A=m.addressCode;if(A){const L=null!==(r=m.addressName)&&void 0!==r?r:null,j=null!==(s=m.topographicPlaceRef)&&void 0!==s?s:null;v.address=new Sw(A,L,j)}return v}static initFromLiteralCoords(t){const e=(t=t.trim().replace(/\s/g,"")).match(/^([0-9\.]+?),([0-9\.]+?)$/);if(null===e)return null;let i=parseFloat(e[1]),r=parseFloat(e[2]);return i>r&&(i=parseFloat(e[2]),r=parseFloat(e[1])),Ho.initWithLngLat(i,r)}asGeoJSONFeature(){var t,e,i,r,s,d,m,v,D,A,L,j,W,ie,we;if(null===this.geoPosition)return null;const Re={};(null!==(e=null===(t=this.stopPlace)||void 0===t?void 0:t.stopPlaceRef)&&void 0!==e?e:null)&&(Re["stopPlace.stopPlaceRef"]=null!==(r=null===(i=this.stopPlace)||void 0===i?void 0:i.stopPlaceRef)&&void 0!==r?r:"",Re["stopPlace.stopPlaceName"]=null!==(d=null===(s=this.stopPlace)||void 0===s?void 0:s.stopPlaceName)&&void 0!==d?d:"",Re["stopPlace.topographicPlaceRef"]=null!==(v=null===(m=this.stopPlace)||void 0===m?void 0:m.topographicPlaceRef)&&void 0!==v?v:""),this.address&&(Re.addressCode=null!==(A=null===(D=this.address)||void 0===D?void 0:D.addressCode)&&void 0!==A?A:"",Re.addressName=null!==(j=null===(L=this.address)||void 0===L?void 0:L.addressName)&&void 0!==j?j:"",Re.topographicPlaceRef=null!==(ie=null===(W=this.address)||void 0===W?void 0:W.topographicPlaceRef)&&void 0!==ie?ie:""),this.poi&&(Re["poi.name"]=this.poi.name,Re["poi.code"]=this.poi.code,Re["poi.category"]=this.poi.category,Re["poi.subcategory"]=this.poi.subCategory,Re["poi.osm.tags"]=this.poi.categoryTags.join(",")),Re.locationName=null!==(we=this.locationName)&&void 0!==we?we:"";for(let st in this.attributes)Re["OJP.Attr."+st]=this.attributes[st];return{type:"Feature",properties:Re,geometry:{type:"Point",coordinates:[this.geoPosition.longitude,this.geoPosition.latitude]}}}computeLocationName(){var t;return this.stopPlace?this.stopPlace.stopPlaceName:null!==(t=this.locationName)&&void 0!==t?t:null}findClosestLocation(t){const e=this.geoPosition;if(null===e)return null;let i=null;return t.forEach(r=>{const s=r.geoPosition;if(null===s)return;const d=e.distanceFrom(s);(null===i||d<i.distance)&&(i={location:r,distance:d})}),i}}class Tp{constructor(t){Array.isArray(t)||(t=[t]);const e=Math.min.apply(null,t.map(d=>d.longitude)),i=Math.min.apply(null,t.map(d=>d.latitude)),r=Math.max.apply(null,t.map(d=>d.longitude)),s=Math.max.apply(null,t.map(d=>d.latitude));this.southWest=new Ta(e,i),this.northEast=new Ta(r,s)}static initFromGeoPosition(t,e,i){const r=.1*e/7612,s=.1*i/11119,d=new Ta(t.longitude-r/2,t.latitude-s/2),m=new Ta(t.longitude+r/2,t.latitude+s/2);return new Tp([d,m])}extend(t){Array.isArray(t)||(t=[t]),t.forEach(e=>{const i=Math.min(this.southWest.longitude,e.longitude),r=Math.min(this.southWest.latitude,e.latitude),s=Math.max(this.northEast.longitude,e.longitude),d=Math.max(this.northEast.latitude,e.latitude);this.southWest=new Ta(i,r),this.northEast=new Ta(s,d)})}asFeatureBBOX(){return[this.southWest.longitude,this.southWest.latitude,this.northEast.longitude,this.northEast.latitude]}asLngLatBounds(){const t=new(oa().LngLatBounds);return t.extend(this.southWest.asLngLat()),t.extend(this.northEast.asLngLat()),t}isValid(){return this.southWest.longitude!==1/0}containsGeoPosition(t){return!(t.longitude<this.southWest.longitude||t.latitude<this.southWest.latitude||t.longitude>this.northEast.longitude||t.latitude>this.northEast.latitude)}}class hD{constructor(t,e){if(this.timetableTime=t,this.estimatedTime=e,e){const i=(e.getTime()-t.getTime())/1e3;this.delayMinutes=Math.floor(i/60)}else this.delayMinutes=null}static initWithContextNode(t){const e=on.queryText("ojp:TimetabledTime",t);if(null===e)return null;const i=new Date(Date.parse(e));let r=null;const s=on.queryText("ojp:EstimatedTime",t);return s&&(r=new Date(Date.parse(s))),new hD(i,r)}}class Yd{constructor(t,e,i,r,s,d){this.stopPointType=t,this.location=e,this.arrivalData=i,this.departureData=r,this.plannedPlatform=s,this.actualPlatform=null,this.sequenceOrder=d}static initWithContextNode(t,e){if(null===on.queryText("siri:StopPointRef",e))return null;const r=Ho.initWithOJPContextNode(e),s=Yd.computeStopPointTime("ServiceArrival",e),d=Yd.computeStopPointTime("ServiceDeparture",e),m=on.queryText("ojp:PlannedQuay/ojp:Text",e),v=on.queryText("ojp:Order",e),D=null===v?null:parseInt(v,10),A=new Yd(t,r,s,d,m,D);return A.actualPlatform=on.queryText("ojp:EstimatedQuay/ojp:Text",e),A}static computeStopPointTime(t,e){const r=on.queryNode("ojp:"+t,e);return null===r?null:hD.initWithContextNode(r)}}class pD{constructor(t,e,i){this.ptMode=t,this.name=e,this.shortName=i,this.isDemandMode=!1}static initFromServiceNode(t){const e=on.queryText("ojp:Mode/ojp:PtMode",t);if(null===e)return null;const i=on.queryText("ojp:Mode/ojp:Name/ojp:Text",t),r=on.queryText("ojp:Mode/ojp:ShortName/ojp:Text",t),s=new pD(e,i,r),d=on.queryText("ojp:Mode/siri:BusSubmode",t);return s.isDemandMode="demandAndResponseBus"===d,s}isRail(){return"rail"===this.ptMode}hasPrecisePolyline(){if(this.isDemandMode)return!0;const e=this.computePublicTransportPictogram();return-1===["picto-bus","picto-bus-fallback","picto-tram"].indexOf(e)}computePublicTransportPictogram(){return"bus"===this.ptMode?"picto-bus":this.isRail()?"picto-railway":"tram"===this.ptMode?"picto-tram":"CC"===this.shortName?"picto-rack-railway":"FUN"===this.shortName?"picto-funicular":"PB"===this.shortName?"picto-cablecar":"GB"===this.shortName?"picto-gondola":"SL"===this.shortName?"picto-chairlift":"water"===this.ptMode?"picto-boat":this.isDemandMode?"car-sharing":"picto-bus-fallback"}}class Cw{constructor(t,e,i){this.journeyRef=t,this.ptMode=e,this.agencyID=i,this.originStopPlace=null,this.destinationStopPlace=null,this.serviceLineNumber=null,this.journeyNumber=null}static initFromContextNode(t){const e=on.queryNode("ojp:Service",t);if(null===e)return null;const i=on.queryText("ojp:JourneyRef",e),r=pD.initFromServiceNode(e),s=on.queryText("ojp:OperatorRef",e),d=null==s?void 0:s.replace("ojp:","");if(!(i&&r&&d))return null;const m=new Cw(i,r,d);return m.originStopPlace=Cp.initFromServiceNode(e,"Origin"),m.destinationStopPlace=Cp.initFromServiceNode(e,"Destination"),m.serviceLineNumber=on.queryText("ojp:PublishedLineName/ojp:Text",e),m.journeyNumber=on.queryText("ojp:Extension/ojp:PublishedJourneyNumber/ojp:Text",t),m}computeLegLineType(){return"801"===this.agencyID?"PostAuto":this.ptMode.isRail()?"LongDistanceRail":this.ptMode.isDemandMode?"OnDemand":"Bus"}formatServiceName(){var t,e,i,r;if(this.ptMode.isDemandMode)return null!==(t=this.serviceLineNumber)&&void 0!==t?t:"OnDemand";const s=[];return this.serviceLineNumber?(this.ptMode.isRail()||s.push(null!==(e=this.ptMode.shortName)&&void 0!==e?e:this.ptMode.ptMode),s.push(this.serviceLineNumber),s.push(null!==(i=this.journeyNumber)&&void 0!==i?i:"")):s.push(null!==(r=this.ptMode.shortName)&&void 0!==r?r:this.ptMode.ptMode),s.push("("+this.agencyID+")"),s.join(" ")}}class fD{constructor(t,e){this.stopPoint=t,this.journeyService=e,this.prevStopPoints=[],this.nextStopPoints=[]}static initFromContextNode(t){const e=on.queryNode("ojp:ThisCall/ojp:CallAtStop",t);if(null===e)return null;const i=Yd.initWithContextNode("Intermediate",e);if(null===i)return null;const r=Cw.initFromContextNode(t);if(null===r)return null;const s=new fD(i,r);return["PreviousCall","OnwardCall"].forEach(m=>{const D=on.queryNodes("ojp:"+m+"/ojp:CallAtStop",t);if(0===D.length)return;let L="PreviousCall"===m?s.prevStopPoints:s.nextStopPoints;D.forEach(j=>{const W=Yd.initWithContextNode("Intermediate",j);W&&L.push(W)})}),s}patchStopEventLocations(t){let e=[this.stopPoint];["prev","next"].forEach(r=>{e=e.concat("prev"===r?this.prevStopPoints:this.nextStopPoints)}),e.forEach(r=>{const s=r.location.stopPointRef;s&&s in t&&(r.location=t[s])})}asStationBoard(){var t,e,i;return{stopEvent:this,serviceLineNumber:this.computeServiceLineNumber(),servicePtMode:null!==(t=this.journeyService.ptMode.shortName)&&void 0!==t?t:"N/A",tripNumber:this.journeyService.journeyNumber,tripHeading:null!==(i=null===(e=this.journeyService.destinationStopPlace)||void 0===e?void 0:e.stopPlaceName)&&void 0!==i?i:"N/A",tripOperator:this.journeyService.agencyID,mapStationBoardTime:{Arrivals:this.computeStopTimeData(this.stopPoint.arrivalData),Departures:this.computeStopTimeData(this.stopPoint.departureData)},stopPlatform:this.stopPoint.plannedPlatform,stopPlatformActual:this.stopPoint.actualPlatform}}computeServiceLineNumber(){var t;const e=null!==(t=this.journeyService.ptMode.shortName)&&void 0!==t?t:"N/A";return this.journeyService.serviceLineNumber||e}computeStopTimeData(t){var e;if(null===t)return null;const i=null!==t.delayMinutes,r=_l.formatTimeHHMM(t.timetableTime),s=t.estimatedTime?_l.formatTimeHHMM(t.estimatedTime):"n/a",d=!!t.estimatedTime&&r!==s,m=this.computeStopTime(t.timetableTime);return null===m?null:{stopTime:m,stopTimeActual:this.computeStopTime(null!==(e=t.estimatedTime)&&void 0!==e?e:null),stopDelayText:this.computeDelayTime(t),hasDelay:i,hasDelayDifferentTime:d}}computeStopTime(t){return null===t?null:_l.formatTimeHHMM(t)}computeDelayTime(t){var e;const i=null!==(e=t.delayMinutes)&&void 0!==e?e:null;if(null===i)return null;if(0===i)return"ON TIME";const r=[];return r.push(" "),r.push(i>0?"+":""),r.push(""+i),r.push("'"),r.join("")}}var R8=rt(904),P8=rt.n(R8);class Xy{constructor(t){this.stageConfig=t,this.serviceRequestNode=this.computeServiceRequestNode(),this.logRequests=!1,this.lastRequestData={requestXmlS:null,requestDatetime:null,responseXmlS:null,responseDatetime:null}}computeServiceRequestNode(){const t=P8().create("OJP",{encoding:"utf-8"});t.att("xmlns","http://www.siri.org.uk/siri"),t.att("xmlns:xsi","http://www.w3.org/2001/XMLSchema-instance"),t.att("xmlns:xsd","http://www.w3.org/2001/XMLSchema"),t.att("xmlns:ojp","http://www.vdv.de/ojp"),t.att("xsi:schemaLocation","http://www.siri.org.uk/siri ../ojp-xsd-v1.0/OJP.xsd"),t.att("version","1.0");const e=t.ele("OJPRequest").ele("ServiceRequest");return e.ele("RequestorRef","OJP SDK v1.0"),e}fetchOJPResponse(t,e){const i=this.stageConfig.apiEndpoint,s=fetch(i,{headers:{"Content-Type":"text/xml",Authorization:"Bearer "+this.stageConfig.authBearerKey},body:t,method:"POST"});this.logRequests&&(console.log("OJP Request: /POST - "+i),console.log(t));const d={requestXmlS:t,requestDatetime:new Date,responseXmlS:null,responseDatetime:null};this.lastRequestData=d,s.then(m=>{m.text().then(v=>{d.responseXmlS=v,d.responseDatetime=new Date,e(v,null)}).catch(v=>{e("",{error:"ParseTextError",message:v})})}).catch(m=>{e("",{error:"FetchError",message:"API Endpoint Error: "+m})})}}class O8{constructor(t,e){this.requestData=t,this.response=e}}class Tw{constructor(t,e){this.coordinates=t,this.bbox=e}static initFromTrackSectionNode(t){const e=[];if(on.queryNodes("ojp:LinkProjection/ojp:Position",t).forEach(d=>{const m=on.queryText("siri:Longitude",d),v=on.queryText("siri:Latitude",d);if(m&&v){const D=new Ta(parseFloat(m),parseFloat(v));e.push(D)}}),e.length<2)return null;const r=new Tp(e);return new Tw(e,r)}asGeoJSONFeature(){const t={type:"Feature",bbox:this.bbox.asFeatureBBOX(),properties:{},geometry:{type:"LineString",coordinates:[]}};return this.coordinates.forEach(e=>{t.geometry.coordinates.push([e.longitude,e.latitude])}),t}}class mD{constructor(t){this.sections=t}static initFromTripLeg(t){const e=on.queryNodes("ojp:PathGuidance/ojp:PathGuidanceSection",t);let i=[];return e.forEach((s,d)=>{const m=gD.initFromSectionNode(s);m&&i.push(m)}),new mD(i)}}class gD{constructor(){this.trackSection=null,this.guidanceAdvice=null,this.turnAction=null}static initFromSectionNode(t){const e=new gD,i=on.queryNode("ojp:TrackSection",t);return i&&(e.trackSection=bD.initFromTrackSectionNode(i)),e.guidanceAdvice=on.queryText("ojp:GuidanceAdvice",t),e.turnAction=on.queryText("ojp:TurnAction",t),e}}class bD{constructor(){this.linkProjection=null,this.roadName=null,this.duration=null,this.length=null}static initFromTrackSectionNode(t){const e=new bD;e.linkProjection=Tw.initFromTrackSectionNode(t),e.roadName=on.queryText("ojp:RoadName",t),e.duration=on.queryText("ojp:Duration",t);const i=on.queryText("ojp:Length",t);return i&&(e.length=parseInt(i,10)),e}}class Dw{constructor(t){this.trackSections=t;let e=0;this.hasGeoData=!1,t.forEach(i=>{i.linkProjection&&(this.hasGeoData=!0),i.duration&&(e+=i.duration.totalMinutes)}),this.duration=null,e>0&&(this.duration=Zd.initFromTotalMinutes(e))}static initFromLegNode(t){const e=on.queryNode("ojp:LegTrack",t);if(null===e)return null;let i=[];return on.queryNodes("ojp:TrackSection",e).forEach(d=>{const m=_D.initFromContextNode(d);m&&i.push(m)}),new Dw(i)}fromGeoPosition(){if(0===this.trackSections.length)return null;const e=this.trackSections[0].linkProjection;return null===e?null:e.coordinates[0]}toGeoPosition(){if(0===this.trackSections.length)return null;const e=this.trackSections[this.trackSections.length-1].linkProjection;return null===e?null:e.coordinates[e.coordinates.length-1]}}class _D{constructor(t,e){this.fromLocation=t,this.toLocation=e,this.duration=null,this.length=null,this.linkProjection=null}static initFromContextNode(t){const e=on.queryNode("ojp:TrackStart",t),i=on.queryNode("ojp:TrackEnd",t);if(null===e||null===i)return null;const r=Ho.initWithOJPContextNode(e),s=Ho.initWithOJPContextNode(i),d=new _D(r,s);d.duration=Zd.initFromContextNode(t);const m=on.queryText("ojp:Length",t);return m&&(d.length=parseInt(m,10)),d.linkProjection=Tw.initFromTrackSectionNode(t),d}}class zO{constructor(t,e,i,r){this.legType=t,this.legID=e,this.fromLocation=i,this.toLocation=r,this.legTrack=null,this.legDuration=null}patchLocations(t){[this.fromLocation,this.toLocation].forEach(e=>{var i;this.patchLocation(e,t),!e.geoPosition&&null!==(i=this.legTrack)&&void 0!==i&&i.hasGeoData&&(e===this.fromLocation?this.fromLocation.geoPosition=this.legTrack.fromGeoPosition():this.toLocation.geoPosition=this.legTrack.toGeoPosition())})}patchLocation(t,e){if(t.geoPosition)return;const i=t.stopPointRef;if(i&&i in e){const r=e[i];t.locationName=r.locationName,t.stopPlace=r.stopPlace,t.geoPosition=r.geoPosition}}computeGeoJSONFeatures(){let t=[];if(this.useBeeline()){const r=this.computeBeelineFeature();r&&t.push(r)}const i=this.computeLinePointFeatures();return t=t.concat(i),t=t.concat(this.computeSpecificJSONFeatures()),t.forEach(r=>{r.properties&&(r.properties["leg.idx"]=this.legID-1,r.properties[Uo.LegType]=this.computeLegType())}),t}useBeeline(){var t;return!(null!==(t=this.legTrack)&&void 0!==t&&t.hasGeoData)}computeLegType(){return"TimedLeg"==this.legType?"TimedLeg":"TransferLeg"==this.legType?"TransferLeg":"ContinousLeg"==this.legType?"ContinousLeg":"n/a"}computeSpecificJSONFeatures(){return[]}computeLegColor(){var t;return null!==(t=Wy[this.legType])&&void 0!==t?t:Wy.TimedLeg}computeLinePointsData(){const t=[];return[this.fromLocation,this.toLocation].forEach(i=>{var r,s;const d=i.asGeoJSONFeature();if(null!=d&&d.properties){const m=i===this.fromLocation,v=m?"From":"To",D=m?null===(r=this.legTrack)||void 0===r?void 0:r.fromGeoPosition():null===(s=this.legTrack)||void 0===s?void 0:s.toGeoPosition();D&&(d.geometry.coordinates=D.asPosition()),t.push({type:v,feature:d})}}),t}computeLinePointFeatures(){const t=[],e=this.computeLegLineType();return this.computeLinePointsData().forEach(r=>{const d=r.feature;null!==d.properties&&(d.properties[Uo.PointType]=r.type,d.properties[Uo.DrawType]="LegPoint",d.properties[Uo.LineType]=e,d.bbox=[d.geometry.coordinates[0],d.geometry.coordinates[1],d.geometry.coordinates[0],d.geometry.coordinates[1]],t.push(d))}),t}computeLegLineType(){return"Unknown"}computeBeelineFeature(){const t=this.computeBeelineGeoPositions();if(t.length<2)return null;const e=[];t.forEach(v=>{e.push(v.asPosition())});const i={};i[Uo.DrawType]="Beeline";const s=this.computeLegLineType();i[Uo.LineType]=s;const d=new Tp(t);return{type:"Feature",properties:i,geometry:{type:"LineString",coordinates:e},bbox:d.asFeatureBBOX()}}computeBeelineGeoPositions(){const t=[];return[this.fromLocation,this.toLocation].forEach(i=>{i.geoPosition&&t.push(i.geoPosition)}),t}}class Ew extends zO{constructor(t,e,i,r,s){super(t,e,r,s),this.legTransportMode=null,this.legDistance=i,this.pathGuidance=null,this.walkDuration=null}static initFromTripLeg(t,e,i){if(null===e)return null;const r=on.queryNode("ojp:LegStart",e),s=on.queryNode("ojp:LegEnd",e);if(null===r||null===s)return null;const d=Ho.initWithOJPContextNode(r),m=Ho.initWithOJPContextNode(s);let v=on.queryText("ojp:Length",e);null===v&&(v="0");const D=parseInt(v),A=new Ew(i,t,D,d,m);return A.legDuration=Zd.initFromContextNode(e),A.pathGuidance=mD.initFromTripLeg(e),A.legTransportMode=A.computeLegTransportMode(e),A.legTrack=Dw.initFromLegNode(e),"TransferLeg"===i&&(A.walkDuration=Zd.initFromContextNode(e,"ojp:WalkDuration")),A}computeLegTransportMode(t){const e=on.queryText("ojp:Service/ojp:IndividualMode",t);return null===e?null:"walk"===e?"walk":"self-drive-car"===e?"car_self_driving":"cycle"===e?"cycle":null}isDriveCarLeg(){return"car_self_driving"===this.legTransportMode}isSharedMobility(){return null!==this.legTransportMode&&-1!==["cycle","bicycle_rental","car_sharing","escooter_rental"].indexOf(this.legTransportMode)}isWalking(){return"walk"===this.legTransportMode}computeSpecificJSONFeatures(){var t,e;const i=[];return null===(t=this.pathGuidance)||void 0===t||t.sections.forEach((r,s)=>{var d,m,v,D,A,L,j,W,ie,we;const Re=null===(m=null===(d=r.trackSection)||void 0===d?void 0:d.linkProjection)||void 0===m?void 0:m.asGeoJSONFeature();null!=Re&&Re.properties&&(Re.properties[Uo.DrawType]="LegLine",Re.properties[Uo.LineType]="Guidance",Re.properties["PathGuidanceSection.idx"]=s,Re.properties["PathGuidanceSection.TrackSection.RoadName"]=null!==(D=null===(v=r.trackSection)||void 0===v?void 0:v.roadName)&&void 0!==D?D:"",Re.properties["PathGuidanceSection.TrackSection.Duration"]=null!==(L=null===(A=r.trackSection)||void 0===A?void 0:A.duration)&&void 0!==L?L:"",Re.properties["PathGuidanceSection.TrackSection.Length"]=null!==(W=null===(j=r.trackSection)||void 0===j?void 0:j.length)&&void 0!==W?W:"",Re.properties["PathGuidanceSection.GuidanceAdvice"]=null!==(ie=r.guidanceAdvice)&&void 0!==ie?ie:"",Re.properties["PathGuidanceSection.TurnAction"]=null!==(we=r.turnAction)&&void 0!==we?we:"")}),null===(e=this.legTrack)||void 0===e||e.trackSections.forEach(r=>{var s;const d=null===(s=r.linkProjection)||void 0===s?void 0:s.asGeoJSONFeature();null!=d&&d.properties&&(d.properties[Uo.DrawType]="LegLine",d.properties[Uo.LineType]=this.computeLegLineType(),i.push(d))}),i}computeLegLineType(){if("ContinousLeg"===this.legType){if(this.isDriveCarLeg())return"Self-Drive Car";if(this.isSharedMobility())return"Shared Mobility"}return"TransferLeg"===this.legType?"Transfer":"Walk"}computeLinePointsData(){return"TransferLeg"===this.legType?[]:super.computeLinePointsData()}computeLegColor(){return this.isDriveCarLeg()?Yg["Self-Drive Car"]:this.isSharedMobility()?Yg["Shared Mobility"]:"TransferLeg"===this.legType?Yg.Transfer:Yg.Walk}formatDistance(){return this.legDistance>1e3?(this.legDistance/1e3).toFixed(1)+" km":this.legDistance+" m"}}class Zy extends zO{constructor(t,e,i,r,s=[]){super("TimedLeg",t,i.location,r.location),this.service=e,this.fromStopPoint=i,this.toStopPoint=r,this.intermediateStopPoints=s}static initFromTripLeg(t,e){var i;if(null===e)return null;const r=Cw.initFromContextNode(e);if(null===r)return null;const s=on.queryNode("ojp:LegBoard",e),d=on.queryNode("ojp:LegAlight",e);if(null===s||null===d)return null;const m=Yd.initWithContextNode("From",s),v=Yd.initWithContextNode("To",d);if(null===m||null===v)return null;const D=[];(null!==(i=on.queryNodes("ojp:LegIntermediates",e))&&void 0!==i?i:[]).forEach(j=>{const W=Yd.initWithContextNode("Intermediate",j);W&&D.push(W)});const L=new Zy(t,r,m,v,D);return L.legTrack=Dw.initFromLegNode(e),L.legTrack&&null===L.legDuration&&(L.legDuration=L.legTrack.duration),L}patchLocations(t){super.patchLocations(t),this.intermediateStopPoints.forEach(e=>{this.patchLocation(e.location,t)})}computeDepartureTime(){return this.computeStopPointTime(this.fromStopPoint.departureData)}computeArrivalTime(){return this.computeStopPointTime(this.toStopPoint.arrivalData)}computeStopPointTime(t){var e;return null===t?null:null!==(e=t.estimatedTime)&&void 0!==e?e:t.timetableTime}computeSpecificJSONFeatures(){var t;let e=[];const i=this.service.computeLegLineType();return!this.useBeeline()&&(null===(t=this.legTrack)||void 0===t||t.trackSections.forEach(s=>{var d;const m=null===(d=s.linkProjection)||void 0===d?void 0:d.asGeoJSONFeature();null!=m&&m.properties&&(m.properties[Uo.DrawType]="LegLine",m.properties[Uo.LineType]=i,e.push(m))})),e}computeLegLineType(){return this.service.computeLegLineType()}computeLinePointsData(){const t=super.computeLinePointsData();return this.intermediateStopPoints.forEach(e=>{const i=e.location.asGeoJSONFeature();null!=i&&i.properties&&t.push({type:"Intermediate",feature:i})}),t}computeLegColor(){var t;const e=super.computeLegColor(),i=this.service.computeLegLineType();return null!==(t=Yg[i])&&void 0!==t?t:e}computeBeelineGeoPositions(){const t=[],e=[];return e.push(this.fromStopPoint),this.intermediateStopPoints.forEach(i=>{e.push(i)}),e.push(this.toStopPoint),e.forEach(i=>{i.location.geoPosition&&t.push(i.location.geoPosition)}),t}useBeeline(){const t=this.service.ptMode.hasPrecisePolyline();return super.useBeeline()||!t}}class Yy{constructor(t,e,i){this.id=t,this.legs=e,this.stats=i}static initFromTripResultNode(t,e){const i=on.queryText("ojp:Trip/ojp:TripId",t);if(null===i)return null;const r=on.queryNode("ojp:Trip",t),s=Zd.initFromContextNode(r);if(null===s)return null;const d=on.queryText("ojp:Trip/ojp:Distance",t);if(null===d)return null;const m=on.queryText("ojp:Trip/ojp:Transfers",t);if(null===m)return null;const v=on.queryText("ojp:Trip/ojp:StartTime",t),D=on.queryText("ojp:Trip/ojp:EndTime",t);if(null===v||null===D)return null;const A=new Date(Date.parse(v)),L=new Date(Date.parse(D)),j={duration:s,distanceMeters:parseInt(d),transferNo:parseInt(m),startDatetime:A,endDatetime:L};let W=[];return on.queryNodes("ojp:Trip/ojp:TripLeg",t).forEach(We=>{const xt=class L8{static initWithContextNode(t){const e=on.queryText("ojp:LegId",t);if(null===e)return null;const i=parseInt(e,10),r=on.queryNode("ojp:ContinuousLeg",t),s=Ew.initFromTripLeg(i,r,"ContinousLeg");if(s)return s;const d=on.queryNode("ojp:TimedLeg",t),m=Zy.initFromTripLeg(i,d);if(m)return m;const v=on.queryNode("ojp:TransferLeg",t);return Ew.initFromTripLeg(i,v,"TransferLeg")||(console.log("Cant factory leg #"+i),console.log(t),null)}}.initWithContextNode(We);null!==xt&&W.push(xt)}),"walk"===e&&W.find(xt=>"ContinousLeg"!==xt.legType)||("car_self_driving"===e||"car_sharing"===e)&&!Yy.hasLegWithTransportMode(W,"car_self_driving")||-1!==["cycle","bicycle_rental","escooter_rental"].indexOf(e)&&!1===Yy.hasLegWithTransportMode(W,"cycle")?null:new Yy(i,W,j)}static hasLegWithTransportMode(t,e){var i;return null!==(null!==(i=t.find(s=>"ContinousLeg"===s.legType&&s.legTransportMode===e))&&void 0!==i?i:null)}computeDepartureTime(){var t;const e=this.legs.filter(d=>d instanceof Zy);if(0===e.length)return console.log("No TimedLeg found for this trip"),console.log(this),null;const r=e[0].fromStopPoint.departureData;return null===r?null:null!==(t=r.estimatedTime)&&void 0!==t?t:r.timetableTime}computeArrivalTime(){var t;const e=this.legs.filter(d=>d instanceof Zy);if(0===e.length)return console.log("No TimedLeg found for this trip"),console.log(this),new Date;const r=e[e.length-1].toStopPoint.arrivalData;return null===r?null:null!==(t=r.estimatedTime)&&void 0!==t?t:r.timetableTime}computeGeoJSON(){let t=[];return this.legs.forEach(i=>{const r=i.computeGeoJSONFeatures();t=t.concat(r)}),{type:"FeatureCollection",features:t}}computeFromLocation(){return 0===this.legs.length?null:this.legs[0].fromLocation}computeToLocation(){return 0===this.legs.length?null:this.legs[this.legs.length-1].toLocation}computeBBOX(){var t,e;const i=new Tp([]),r=null===(t=this.computeFromLocation())||void 0===t?void 0:t.geoPosition;r&&i.extend(r);const s=null===(e=this.computeToLocation())||void 0===e?void 0:e.geoPosition;return s&&i.extend(s),i}debugTrip(){console.log("DEBUG - TRIP"),console.log(this),this.legs.forEach((t,e)=>{const i=t.computeGeoJSONFeatures();console.log("DEBUG - leg "+e),console.log(t),i.forEach(r=>{console.log(r)})})}}class Dp{constructor(t,e,i,r){this.hasValidResponse=t,this.responseXMLText=e,this.contextLocations=i,this.trips=r}static initWithXML(t,e){const i=(new DOMParser).parseFromString(t,"application/xml"),s="true"===on.queryText("//siri:OJPResponse/siri:ServiceDelivery/siri:Status",i),d=Dp.parseContextLocations(i),m=Dp.parseTrips(i,d,e);return new Dp(s,t,d,m)}static parseContextLocations(t){let e=[];return on.queryNodes("//ojp:TripResponseContext/ojp:Places/ojp:Location",t).forEach(r=>{const s=Ho.initWithOJPContextNode(r);e.push(s)}),e}static parseTrips(t,e,i){let r=[];const s={};return e.forEach(m=>{var v;const D=null===(v=m.stopPlace)||void 0===v?void 0:v.stopPlaceRef;D&&(s[D]=m)}),on.queryNodes("//ojp:TripResult",t).forEach(m=>{const v=Yy.initFromTripResultNode(m,i);v&&(v.legs.forEach(D=>{D.patchLocations(s)}),r.push(v))}),r}}class VO extends Xy{constructor(t,e){super(t),this.requestParams=e}fetchResponse(t){this.buildTripRequestNode();const e=this.serviceRequestNode.end();super.fetchOJPResponse(e,(i,r)=>{const s=Dp.initWithXML(i,this.requestParams.transportMode);null===r&&!s.hasValidResponse&&(r={error:"ParseTripsXMLError",message:"Invalid TripsRequest Response XML"}),t(s,r)})}computeRequestXmlString(){return this.buildTripRequestNode(),this.serviceRequestNode.end({pretty:!0})}buildTripRequestNode(){const e=(new Date).toISOString();this.serviceRequestNode.ele("RequestTimestamp",e);const i=this.serviceRequestNode.ele("ojp:OJPTripRequest");i.ele("RequestTimestamp",e);const s="monomodal"===this.requestParams.modeType,d=this.requestParams.transportMode,m=["From","To"];m.forEach(A=>{var L,j,W,ie;const we="From"===A,We=(we?this.requestParams.fromTripLocation:this.requestParams.toTripLocation).location,st=i.ele("ojp:"+(we?"Origin":"Destination")),Bt=st.ele("ojp:PlaceRef");if(null!==(L=We.stopPlace)&&void 0!==L&&L.stopPlaceRef){const Tn=null!==(j=We.locationName)&&void 0!==j?j:"n/a";let ai=null!==(ie=null===(W=We.stopPlace)||void 0===W?void 0:W.stopPlaceRef)&&void 0!==ie?ie:"";Bt.ele("StopPointRef",ai),Bt.ele("ojp:LocationName").ele("ojp:Text",Tn)}else if(We.geoPosition){const Tn=Bt.ele("ojp:GeoPosition");Tn.ele("Longitude",We.geoPosition.longitude),Tn.ele("Latitude",We.geoPosition.latitude);const ai=We.geoPosition.asLatLngString();Bt.ele("ojp:LocationName").ele("ojp:Text",ai)}if(we){const Tn=this.requestParams.departureDate.toISOString();if(st.ele("ojp:DepArrTime",Tn),s&&("walk"===d||"cycle"===d)){const ai=st.ele("ojp:IndividualTransportOptions");ai.ele("ojp:Mode",d),ai.ele("ojp:MaxDuration","PT3000M")}}});const v=i.ele("ojp:Params"),D=this.computeNumberOfResultsParam();if(v.ele("ojp:NumberOfResults",D),v.ele("ojp:IncludeTrackSections",!0),v.ele("ojp:IncludeLegProjection",!0),v.ele("ojp:IncludeTurnDescription",!0),v.ele("ojp:IncludeIntermediateStops",!0),s)"walk"===d&&v.ele("ojp:ItModesToCover","walk"),"car_self_driving"===d&&v.ele("ojp:ItModesToCover","self-drive-car"),"cycle"===d&&v.ele("ojp:ItModesToCover","cycle"),-1!==["bicycle_rental","car_sharing","escooter_rental"].indexOf(d)&&v.ele("ojp:Extension").ele("ojp:ItModesToCover",d);else{const A=v.ele("ojp:Extension");m.forEach(L=>{const j="From"===L;if(j&&"mode_at_end"===this.requestParams.modeType||!j&&"mode_at_start"===this.requestParams.modeType)return;const W=j?this.requestParams.fromTripLocation:this.requestParams.toTripLocation,we=A.ele("ojp:"+(j?"Origin":"Destination"));we.ele("ojp:MinDuration","PT"+W.minDuration+"M"),we.ele("ojp:MaxDuration","PT"+W.maxDuration+"M"),we.ele("ojp:MinDistance",W.minDistance),we.ele("ojp:MaxDistance",W.maxDistance),W.customTransportMode&&we.ele("ojp:Mode",W.customTransportMode)})}}computeNumberOfResultsParam(){return"TEST LA"===this.stageConfig.key?1:"monomodal"===this.requestParams.modeType&&-1!==["walk","cycle","car_self_driving","bicycle_rental","escooter_rental","car_sharing"].indexOf(this.requestParams.transportMode)?0:5}}class Iw{constructor(t,e,i){this.fromTripLocation=t,this.toTripLocation=e,this.departureDate=i,this.modeType="monomodal",this.transportMode="public_transport"}static initWithLocationsAndDate(t,e,i){return null===t||null===e||!t.location.geoPosition&&!t.location.stopPlace||!e.location.geoPosition&&!e.location.stopPlace?null:new Iw(t,e,i)}}class F8 extends Xy{constructor(t,e){super(t),this.requestParams=e,this.lastJourneyResponse=null}fetchResponse(t){const e=new A8([]),i=this.requestParams.departureDate;this.lastJourneyResponse=null,this.computeTripResponse(0,i,e,t)}computeTripResponse(t,e,i,r){const s=t===this.requestParams.tripModeTypes.length-1,v=Iw.initWithLocationsAndDate(this.requestParams.tripLocations[t],this.requestParams.tripLocations[t+1],e);if(null===v)return void console.error("JourneyRequest - TripsRequestParams null for trip idx "+t);v.modeType=this.requestParams.tripModeTypes[t],v.transportMode=this.requestParams.transportModes[t];const D=new VO(this.stageConfig,v);D.fetchResponse((A,L)=>{if(L)return void r([],L);if(D.lastRequestData){const W=new O8(D.lastRequestData,A);i.sections.push(W)}const j=A.trips.length>0;if(j||(console.error("ERROR: no trips found for section "+t+" MODE - "+v.modeType+" + "+v.transportMode),console.log(A)),s){const W=i.computeAggregatedTrips();this.lastJourneyResponse=i,r(W,null)}else j&&(e=A.trips[0].stats.endDatetime),this.computeTripResponse(t+1,e,i,r)})}}class yD{constructor(t,e,i,r){this.tripLocations=t,this.tripModeTypes=e,this.transportModes=i,this.departureDate=r}static initWithLocationsAndDate(t,e,i,r,s,d){if(null===t||null===e)return null;if(!t.location.geoPosition&&!t.location.stopPlace||!e.location.geoPosition&&!e.location.stopPlace)return console.error("JourneyRequestParams.initWithLocationsAndDate - broken from, to"),console.log(t),console.log(e),null;let m=!1;if(i.forEach(A=>{null===A.location.geoPosition&&(m=!0)}),m)return console.error("JourneyRequestParams.initWithLocationsAndDate - broken via"),console.log(i),null;if(i.length+1!==r.length)return console.error("JourneyRequestParams.initWithLocationsAndDate - wrong via/mot types"),console.log(i),console.log(r),null;let v=[];return v.push(t),v=v.concat(i),v.push(e),new yD(v,r,s,d)}}class eu extends Xy{constructor(t,e){super(t),this.requestParams=e}static initWithLocationName(t,e){return new eu(t,{locationName:e})}static initWithStopPlaceRef(t,e){return new eu(t,{stopPlaceRef:e})}static initWithBBOXAndType(t,e,i,r,s,d,m=1e3,v=null){return new eu(t,{bboxWest:e,bboxNorth:i,bboxEast:r,bboxSouth:s,numberOfResults:m,geoRestrictionType:d,poiOsmTags:v})}fetchResponse(){this.buildRequestNode();const t=this.serviceRequestNode.end();return new Promise((i,r)=>{super.fetchOJPResponse(t,(s,d)=>{const m=(new DOMParser).parseFromString(s,"application/xml"),D="true"===on.queryText("//siri:OJPResponse/siri:ServiceDelivery/siri:Status",m),A=[];if(!D)return null===d&&!D&&(d={error:"ParseLocationInformationRequestXMLError",message:"Invalid LocationInformationRequest Response XML"}),void r(d);on.queryNodes("//ojp:OJPLocationInformationDelivery/ojp:Location",m).forEach(j=>{const W=on.queryNode("ojp:Location",j);if(null===W)return;const ie=Ho.initWithOJPContextNode(W);A.push(ie)}),i(A)})})}buildRequestNode(){var t,e,i,r,s,d,m;const D=(new Date).toISOString();this.serviceRequestNode.ele("RequestTimestamp",D);const A=this.serviceRequestNode.ele("ojp:OJPLocationInformationRequest");A.ele("RequestTimestamp",D);let L=null;const j=null!==(t=this.requestParams.locationName)&&void 0!==t?t:null;j&&(L=A.ele("ojp:InitialInput"),L.ele("ojp:LocationName",j));const W=null!==(e=this.requestParams.stopPlaceRef)&&void 0!==e?e:null;if(W){const Tn=A.ele("ojp:PlaceRef");Tn.ele("ojp:StopPlaceRef",W),Tn.ele("ojp:LocationName").ele("ojp:Text","")}const ie=null!==(i=this.requestParams.bboxWest)&&void 0!==i?i:null,we=null!==(r=this.requestParams.bboxNorth)&&void 0!==r?r:null,Re=null!==(s=this.requestParams.bboxEast)&&void 0!==s?s:null,We=null!==(d=this.requestParams.bboxSouth)&&void 0!==d?d:null;if(ie&&we&&Re&&We){null===L&&(L=A.ele("ojp:InitialInput"));const Tn=L.ele("ojp:GeoRestriction").ele("ojp:Rectangle"),ai=Tn.ele("ojp:UpperLeft");ai.ele("Longitude",ie.toFixed(6)),ai.ele("Latitude",we.toFixed(6));const Gr=Tn.ele("ojp:LowerRight");Gr.ele("Longitude",Re.toFixed(6)),Gr.ele("Latitude",We.toFixed(6))}const xt=A.ele("ojp:Restrictions"),st=null!==(m=this.requestParams.numberOfResults)&&void 0!==m?m:10;xt.ele("ojp:NumberOfResults",st);const Bt=this.computeRestrictionType();if(Bt&&(xt.ele("ojp:Type",Bt),("poi_amenity"===this.requestParams.geoRestrictionType||"poi_all"===this.requestParams.geoRestrictionType)&&this.requestParams.poiOsmTags)){const ai=xt.ele("ojp:PointOfInterestFilter").ele("ojp:PointOfInterestCategory"),Gr="poi_amenity"===this.requestParams.geoRestrictionType?"amenity":"POI";this.requestParams.poiOsmTags.forEach(Ko=>{const iu=ai.ele("ojp:OsmTag");iu.ele("ojp:Tag",Gr),iu.ele("ojp:Value",Ko)})}}computeRestrictionType(){return"poi_all"===this.requestParams.geoRestrictionType||"poi_amenity"===this.requestParams.geoRestrictionType?"poi":this.requestParams.geoRestrictionType}}class N8{constructor(t,e,i,r){this.stopPlaceRef=t,this.geoPosition=e,this.depArrTime=r,this.numberOfResults=10,this.stopEventType=i,this.includePreviousCalls=!1,this.includeOnwardCalls=!1,this.includeRealtimeData=!0}buildRequestXML(t){const e=(new Date).toISOString(),i=this.depArrTime.toISOString();t.ele("RequestTimestamp",e);const r=t.ele("ojp:OJPStopEventRequest");r.ele("RequestTimestamp",e);const s=r.ele("ojp:Location");if(this.stopPlaceRef){const v=s.ele("ojp:PlaceRef");v.ele("ojp:StopPlaceRef",this.stopPlaceRef),v.ele("ojp:LocationName").ele("ojp:Text","")}s.ele("ojp:DepArrTime",i);const d=r.ele("ojp:Params");return d.ele("ojp:NumberOfResults",this.numberOfResults),d.ele("ojp:StopEventType",this.stopEventType),d.ele("ojp:IncludePreviousCalls",this.includePreviousCalls),d.ele("ojp:IncludeOnwardCalls",this.includeOnwardCalls),d.ele("ojp:IncludeRealtimeData",this.includeRealtimeData),t.end()}}class vD extends Xy{constructor(t,e){e.includePreviousCalls=!0,e.includeOnwardCalls=!0,super(t),this.requestParams=e}fetchResponse(){const e=this.requestParams.buildRequestXML(this.serviceRequestNode);return new Promise((r,s)=>{super.fetchOJPResponse(e,(d,m)=>{const v=this.handleResponseData(d,m);r(v)})})}handleResponseData(t,e){const i=[],r=(new DOMParser).parseFromString(t,"application/xml"),s=this.parseMapContextLocations(r);return on.queryNodes("//ojp:OJPStopEventDelivery/ojp:StopEventResult/ojp:StopEvent",r).forEach(m=>{const v=fD.initFromContextNode(m);v&&(v.patchStopEventLocations(s),i.push(v))}),i}parseMapContextLocations(t){const e={};return on.queryNodes("//ojp:OJPStopEventDelivery/ojp:StopEventResponseContext/ojp:Places/ojp:Location",t).forEach(r=>{var s,d;const m=Ho.initWithOJPContextNode(r),v=null!==(d=null===(s=m.stopPlace)||void 0===s?void 0:s.stopPlaceRef)&&void 0!==d?d:null;v&&(e[v]=m)}),e}static initWithStopPlaceRef(t,e,i,r){const s=new N8(e,null,i,r);return new vD(t,s)}}class Ep{constructor(t){this.location=t,this.minDuration=2,this.maxDuration=30,this.minDistance=100,this.maxDistance=2e4,this.customTransportMode=null}}let Qd=(()=>{class n{constructor(){this.newMapBoundsRequested=new Xt,this.newMapCenterAndZoomRequested=new Xt,this.initialMapCenter=null,this.initialMapZoom=null}tryToCenterAndZoomToLocation(e,i=16){var r,s;if(null===e)return;const d=null!==(s=null===(r=e.geoPosition)||void 0===r?void 0:r.asLngLat())&&void 0!==s?s:null;null!==d&&this.newMapCenterAndZoomRequested.emit({lnglat:d,zoom:i})}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),ju=(()=>{class n{constructor(e){this.mapService=e,this.defaultsInited=new Xt,this.locationsUpdated=new Xt,this.geoLocationsUpdated=new Xt,this.tripsUpdated=new Xt,this.activeTripSelected=new Xt,this.viaAtIndexRemoved=new Xt,this.viaAtIndexUpdated=new Xt,this.searchParamsReset=new Xt,this.queryParams=new URLSearchParams(document.location.search),this.fromTripLocation=null,this.toTripLocation=null,this.viaTripLocations=[],this.journeyTripsPlaceholder=["-"],this.tripModeTypes=["monomodal"],this.tripTransportModes=["public_transport"],this.lastJourneyResponse=null,this.departureDate=this.computeInitialDate(),this.currentAppStage="PROD",this.permalinkURLAddress=null}initDefaults(){var e,i,r,s,d;let m=this.queryParams.get("stage");m&&(this.currentAppStage=this.computeAppStageFromString(m));const D=null!==(e=this.queryParams.get("from"))&&void 0!==e?e:"8507000",A=null!==(i=this.queryParams.get("to"))&&void 0!==i?i:"8503000",L=[],j=["From","To"];j.forEach(xt=>{const Bt="From"===xt?D:A,Tn=Ho.initFromLiteralCoords(Bt);if(Tn){const ai=new Promise((Gr,Ko)=>{Gr([Tn])});L.push(ai)}else{const ai=this.getStageConfig(),Ko=eu.initWithStopPlaceRef(ai,Bt).fetchResponse();L.push(Ko)}});const W=new Tp([]),ie=null!==(r=this.queryParams.get("via"))&&void 0!==r?r:null;(null===ie?[]:ie.split(";")).forEach(xt=>{const st=Ho.initFromLiteralCoords(xt);if(st){const Bt=new Ep(st);this.viaTripLocations.push(Bt),st.geoPosition&&W.extend(st.geoPosition)}}),this.journeyTripsPlaceholder=[],this.tripModeTypes=[];const Re=null!==(s=this.queryParams.get("mode_types"))&&void 0!==s?s:null;Re?Re.split(";").forEach(xt=>{this.tripModeTypes.push(xt),this.journeyTripsPlaceholder.push("-")}):(this.journeyTripsPlaceholder=["-"],this.tripModeTypes=["monomodal"]),this.tripTransportModes=[];const We=null!==(d=this.queryParams.get("transport_modes"))&&void 0!==d?d:null;We?We.split(";").forEach(xt=>{this.tripTransportModes.push(xt)}):this.tripTransportModes=["public_transport"],Promise.all(L).then(xt=>{if(j.forEach(st=>{const Bt="From"===st,Tn=Bt?xt[0]:xt[1];if(0===Tn.length)return;const ai=Tn[0];Bt?this.fromTripLocation=new Ep(ai):this.toTripLocation=new Ep(ai),ai.geoPosition&&W.extend(ai.geoPosition)}),this.locationsUpdated.emit(),this.geoLocationsUpdated.emit(),this.updatePermalinkAddress(),W.isValid()&&(this.queryParams.has("from")||this.queryParams.has("to"))&&!this.mapService.initialMapCenter){const Bt={bounds:W.asLngLatBounds()};this.mapService.newMapBoundsRequested.emit(Bt)}this.defaultsInited.emit()})}refetchEndpointsByName(){const e=[],i=new Promise((s,d)=>{s(null)}),r=["From","To"];r.forEach(s=>{const v="From"===s?this.fromTripLocation:this.toTripLocation;if(null===v)return void e.push(i);if(null===v.location.computeLocationName())return void e.push(i);const A=v.location.geoPosition;if(null===A)return void e.push(i);const L=Tp.initFromGeoPosition(A,200,200),j=this.getStageConfig(),ie=eu.initWithBBOXAndType(j,L.southWest.longitude,L.northEast.latitude,L.northEast.longitude,L.southWest.latitude,"stop",300).fetchResponse();e.push(ie)}),Promise.all(e).then(s=>{r.forEach(d=>{const m="From"===d,v=m?s[0]:s[1];if(null===v)return;const D=m?this.fromTripLocation:this.toTripLocation;if(null===D)return void e.push(i);const A=D.location.findClosestLocation(v);null!==A&&(m?this.fromTripLocation=new Ep(A.location):this.toTripLocation=new Ep(A.location),this.updatePermalinkAddress(),this.locationsUpdated.emit(),this.geoLocationsUpdated.emit())})})}switchEndpoints(){const e=Object.assign({},this.fromTripLocation);this.fromTripLocation=Object.assign({},this.toTripLocation),this.toTripLocation=Object.assign({},e),this.updatePermalinkAddress(),this.locationsUpdated.emit(),this.geoLocationsUpdated.emit()}computeAppStageFromString(e){const i=["INT","LA Beta","PROD","TEST"],r=i.map(m=>m.toLowerCase()),s=e.trim(),d=r.indexOf(s.toLowerCase());return-1!==d?i[d]:"PROD"}updateTripEndpoint(e,i,r){let s=null;if("From"===i&&(s=this.fromTripLocation),"To"===i&&(s=this.toTripLocation),s&&(s.location=e),"Via"===i){const d=new Ep(e);this.viaTripLocations.push(d),this.journeyTripsPlaceholder.push("-"),this.tripModeTypes.push("monomodal"),this.tripTransportModes.push("public_transport")}this.locationsUpdated.emit(),this.geoLocationsUpdated.emit(),this.activeTripSelected.emit(null),this.searchParamsReset.emit(),this.updatePermalinkAddress()}updateViaPoint(e,i){this.viaTripLocations[i].location=e,this.viaAtIndexUpdated.emit({location:e,idx:i}),this.activeTripSelected.emit(null),this.searchParamsReset.emit(),this.updatePermalinkAddress()}updateTrips(e){this.tripsUpdated.emit(e),this.activeTripSelected.emit(e.length>0?e[0]:null)}removeViaAtIndex(e){this.viaTripLocations.splice(e,1),this.tripModeTypes.splice(e,1),this.journeyTripsPlaceholder.splice(e,1),this.tripTransportModes.splice(e,1),0===this.viaTripLocations.length&&(this.journeyTripsPlaceholder=["-"],this.tripModeTypes=["monomodal"],this.tripTransportModes=["public_transport"]),this.viaAtIndexRemoved.emit(e),this.activeTripSelected.emit(null),this.searchParamsReset.emit(),this.updatePermalinkAddress()}computeJourneyRequestParams(){return yD.initWithLocationsAndDate(this.fromTripLocation,this.toTripLocation,this.viaTripLocations,this.tripModeTypes,this.tripTransportModes,this.departureDate)}computeTripRequestXML(e){const i=this.getStageConfig(),r=Iw.initWithLocationsAndDate(this.fromTripLocation,this.toTripLocation,e);return null===r?"BROKEN TripsRequestParams":new VO(i,r).computeRequestXmlString()}updatePermalinkAddress(){const e=new URLSearchParams;["From","To"].forEach(m=>{var v,D,A,L;const j="From"===m?this.fromTripLocation:this.toTripLocation,W=m.toLowerCase(),ie=null!==(D=null===(v=null==j?void 0:j.location.stopPlace)||void 0===v?void 0:v.stopPlaceRef)&&void 0!==D?D:null;if(ie)e.append(W,ie);else{const we=null!==(L=null===(A=null==j?void 0:j.location.geoPosition)||void 0===A?void 0:A.asLatLngString(!0))&&void 0!==L?L:null;we&&e.append(W,we)}});const r=[];this.viaTripLocations.forEach(m=>{var v,D;const A=m.location,L=null!==(D=null===(v=null==A?void 0:A.geoPosition)||void 0===v?void 0:v.asLatLngString(!0))&&void 0!==D?D:null;L&&r.push(L)}),r.length>0&&e.append("via",r.join(";")),e.append("mode_types",this.tripModeTypes.join(";")),e.append("transport_modes",this.tripTransportModes.join(";"));const s=_l.formatDate(this.departureDate);e.append("trip_datetime",s.substring(0,16));const d=this.currentAppStage.toLowerCase();e.append("stage",d),this.permalinkURLAddress="search?"+e.toString()}computeInitialDate(){var e;const i=new Date,r=null!==(e=this.queryParams.get("trip_datetime"))&&void 0!==e?e:null;return null===r?i:new Date(Date.parse(r))}getStageConfig(e=this.currentAppStage){var i;const r=null!==(i=Sp.app_stages[e])&&void 0!==i?i:null;return null===r?(console.error("ERROR - cant find stage"+e+" using PROD"),Sp.app_stages.PROD):r}updateAppStage(e){this.currentAppStage=e,this.updatePermalinkAddress()}updateDepartureDateTime(e){this.departureDate=e,this.updatePermalinkAddress()}updateTripMode(e,i,r){this.tripModeTypes[r]=e,this.tripTransportModes[r]=i,this.updatePermalinkAddress()}computeTripLocationsToUpdate(e){const i=[],r=[this.fromTripLocation];this.viaTripLocations.forEach(v=>{r.push(v)}),r.push(this.toTripLocation);const s=this.tripModeTypes[e],d=r[e];d&&("mode_at_start"===s||"mode_at_start_end"===s)&&i.push(d);const m=r[e+1];return m&&("mode_at_end"===s||"mode_at_start_end"===s)&&i.push(m),i}updateTripLocationRestrictions(e,i,r,s,d){this.computeTripLocationsToUpdate(d).forEach(v=>{v.minDuration=e,v.maxDuration=i,v.minDistance=r,v.maxDistance=s})}updateTripLocationCustomMode(e){const i=this.computeTripLocationsToUpdate(e),r=this.tripModeTypes[e];i.forEach(s=>{s.customTransportMode="monomodal"===r?null:this.tripTransportModes[e]})}updateParamsFromTrip(e){if(!(e.legs.length>0))return;const s=e.legs[e.legs.length-1];this.fromTripLocation=new Ep(e.legs[0].fromLocation),this.toTripLocation=new Ep(s.toLocation),this.viaTripLocations=[],this.journeyTripsPlaceholder=["-"],this.tripModeTypes=["monomodal"],this.tripTransportModes=["public_transport"],this.geoLocationsUpdated.emit(),this.updatePermalinkAddress()}}return n.\u0275fac=function(e){return new(e||n)(Be(Qd))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function Qn(n){return null!=n&&"false"!=`${n}`}function Kd(n,t=0){return function B8(n){return!isNaN(parseFloat(n))&&!isNaN(Number(n))}(n)?Number(n):t}function Mw(n){return Array.isArray(n)?n:[n]}function bs(n){return null==n?"":"string"==typeof n?n:`${n}px`}function Jf(n){return n instanceof Pn?n.nativeElement:n}function xD(n,t=/\s+/){const e=[];if(null!=n){const i=Array.isArray(n)?n:`${n}`.split(t);for(const r of i){const s=`${r}`.trim();s&&e.push(s)}}return e}class z8{constructor(t=!1,e,i=!0,r){this._multiple=t,this._emitChanges=i,this.compareWith=r,this._selection=new Set,this._deselectedToEmit=[],this._selectedToEmit=[],this.changed=new Qt,e&&e.length&&(t?e.forEach(s=>this._markSelected(s)):this._markSelected(e[0]),this._selectedToEmit.length=0)}get selected(){return this._selected||(this._selected=Array.from(this._selection.values())),this._selected}select(...t){this._verifyValueAssignment(t),t.forEach(i=>this._markSelected(i));const e=this._hasQueuedChanges();return this._emitChangeEvent(),e}deselect(...t){this._verifyValueAssignment(t),t.forEach(i=>this._unmarkSelected(i));const e=this._hasQueuedChanges();return this._emitChangeEvent(),e}setSelection(...t){this._verifyValueAssignment(t);const e=this.selected,i=new Set(t);t.forEach(s=>this._markSelected(s)),e.filter(s=>!i.has(s)).forEach(s=>this._unmarkSelected(s));const r=this._hasQueuedChanges();return this._emitChangeEvent(),r}toggle(t){return this.isSelected(t)?this.deselect(t):this.select(t)}clear(t=!0){this._unmarkAll();const e=this._hasQueuedChanges();return t&&this._emitChangeEvent(),e}isSelected(t){if(this.compareWith){for(const e of this._selection)if(this.compareWith(e,t))return!0;return!1}return this._selection.has(t)}isEmpty(){return 0===this._selection.size}hasValue(){return!this.isEmpty()}sort(t){this._multiple&&this.selected&&this._selected.sort(t)}isMultipleSelection(){return this._multiple}_emitChangeEvent(){this._selected=null,(this._selectedToEmit.length||this._deselectedToEmit.length)&&(this.changed.next({source:this,added:this._selectedToEmit,removed:this._deselectedToEmit}),this._deselectedToEmit=[],this._selectedToEmit=[])}_markSelected(t){this.isSelected(t)||(this._multiple||this._unmarkAll(),this.isSelected(t)||this._selection.add(t),this._emitChanges&&this._selectedToEmit.push(t))}_unmarkSelected(t){this.isSelected(t)&&(this._selection.delete(t),this._emitChanges&&this._deselectedToEmit.push(t))}_unmarkAll(){this.isEmpty()||this._selection.forEach(t=>this._unmarkSelected(t))}_verifyValueAssignment(t){}_hasQueuedChanges(){return!(!this._deselectedToEmit.length&&!this._selectedToEmit.length)}}let SD=(()=>{class n{constructor(){this._listeners=[]}notify(e,i){for(let r of this._listeners)r(e,i)}listen(e){return this._listeners.push(e),()=>{this._listeners=this._listeners.filter(i=>e!==i)}}ngOnDestroy(){this._listeners=[]}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),V8=0;const CD=new bt("CdkAccordion");let j8=(()=>{class n{constructor(){this._stateChanges=new Qt,this._openCloseAllActions=new Qt,this.id="cdk-accordion-"+V8++,this._multi=!1}get multi(){return this._multi}set multi(e){this._multi=Qn(e)}openAll(){this._multi&&this._openCloseAllActions.next(!0)}closeAll(){this._openCloseAllActions.next(!1)}ngOnChanges(e){this._stateChanges.next(e)}ngOnDestroy(){this._stateChanges.complete(),this._openCloseAllActions.complete()}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=vt({type:n,selectors:[["cdk-accordion"],["","cdkAccordion",""]],inputs:{multi:"multi"},exportAs:["cdkAccordion"],features:[Kn([{provide:CD,useExisting:n}]),dr]}),n})(),U8=0,H8=(()=>{class n{constructor(e,i,r){this.accordion=e,this._changeDetectorRef=i,this._expansionDispatcher=r,this._openCloseAllSubscription=me.EMPTY,this.closed=new Xt,this.opened=new Xt,this.destroyed=new Xt,this.expandedChange=new Xt,this.id="cdk-accordion-child-"+U8++,this._expanded=!1,this._disabled=!1,this._removeUniqueSelectionListener=()=>{},this._removeUniqueSelectionListener=r.listen((s,d)=>{this.accordion&&!this.accordion.multi&&this.accordion.id===d&&this.id!==s&&(this.expanded=!1)}),this.accordion&&(this._openCloseAllSubscription=this._subscribeToOpenCloseAllActions())}get expanded(){return this._expanded}set expanded(e){e=Qn(e),this._expanded!==e&&(this._expanded=e,this.expandedChange.emit(e),e?(this.opened.emit(),this._expansionDispatcher.notify(this.id,this.accordion?this.accordion.id:this.id)):this.closed.emit(),this._changeDetectorRef.markForCheck())}get disabled(){return this._disabled}set disabled(e){this._disabled=Qn(e)}ngOnDestroy(){this.opened.complete(),this.closed.complete(),this.destroyed.emit(),this.destroyed.complete(),this._removeUniqueSelectionListener(),this._openCloseAllSubscription.unsubscribe()}toggle(){this.disabled||(this.expanded=!this.expanded)}close(){this.disabled||(this.expanded=!1)}open(){this.disabled||(this.expanded=!0)}_subscribeToOpenCloseAllActions(){return this.accordion._openCloseAllActions.subscribe(e=>{this.disabled||(this.expanded=e)})}}return n.\u0275fac=function(e){return new(e||n)($(CD,12),$(Dr),$(SD))},n.\u0275dir=vt({type:n,selectors:[["cdk-accordion-item"],["","cdkAccordionItem",""]],inputs:{expanded:"expanded",disabled:"disabled"},outputs:{closed:"closed",opened:"opened",destroyed:"destroyed",expandedChange:"expandedChange"},exportAs:["cdkAccordionItem"],features:[Kn([{provide:CD,useValue:void 0}])]}),n})(),$8=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({}),n})();class TD{attach(t){return this._attachedHost=t,t.attach(this)}detach(){let t=this._attachedHost;null!=t&&(this._attachedHost=null,t.detach())}get isAttached(){return null!=this._attachedHost}setAttachedHost(t){this._attachedHost=t}}class Uu extends TD{constructor(t,e,i,r){super(),this.component=t,this.viewContainerRef=e,this.injector=i,this.componentFactoryResolver=r}}class em extends TD{constructor(t,e,i,r){super(),this.templateRef=t,this.viewContainerRef=e,this.context=i,this.injector=r}get origin(){return this.templateRef.elementRef}attach(t,e=this.context){return this.context=e,super.attach(t)}detach(){return this.context=void 0,super.detach()}}class G8 extends TD{constructor(t){super(),this.element=t instanceof Pn?t.nativeElement:t}}class Qy{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(t){return t instanceof Uu?(this._attachedPortal=t,this.attachComponentPortal(t)):t instanceof em?(this._attachedPortal=t,this.attachTemplatePortal(t)):this.attachDomPortal&&t instanceof G8?(this._attachedPortal=t,this.attachDomPortal(t)):void 0}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(t){this._disposeFn=t}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}}class q8 extends Qy{constructor(t,e,i,r,s){super(),this.outletElement=t,this._componentFactoryResolver=e,this._appRef=i,this._defaultInjector=r,this.attachDomPortal=d=>{const m=d.element,v=this._document.createComment("dom-portal");m.parentNode.insertBefore(v,m),this.outletElement.appendChild(m),this._attachedPortal=d,super.setDisposeFn(()=>{v.parentNode&&v.parentNode.replaceChild(m,v)})},this._document=s}attachComponentPortal(t){const i=(t.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(t.component);let r;return t.viewContainerRef?(r=t.viewContainerRef.createComponent(i,t.viewContainerRef.length,t.injector||t.viewContainerRef.injector),this.setDisposeFn(()=>r.destroy())):(r=i.create(t.injector||this._defaultInjector||xr.NULL),this._appRef.attachView(r.hostView),this.setDisposeFn(()=>{this._appRef.viewCount>0&&this._appRef.detachView(r.hostView),r.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(r)),this._attachedPortal=t,r}attachTemplatePortal(t){let e=t.viewContainerRef,i=e.createEmbeddedView(t.templateRef,t.context,{injector:t.injector});return i.rootNodes.forEach(r=>this.outletElement.appendChild(r)),i.detectChanges(),this.setDisposeFn(()=>{let r=e.indexOf(i);-1!==r&&e.remove(r)}),this._attachedPortal=t,i}dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(t){return t.hostView.rootNodes[0]}}let DD,Hu=(()=>{class n extends Qy{constructor(e,i,r){super(),this._componentFactoryResolver=e,this._viewContainerRef=i,this._isInitialized=!1,this.attached=new Xt,this.attachDomPortal=s=>{const d=s.element,m=this._document.createComment("dom-portal");s.setAttachedHost(this),d.parentNode.insertBefore(m,d),this._getRootNode().appendChild(d),this._attachedPortal=s,super.setDisposeFn(()=>{m.parentNode&&m.parentNode.replaceChild(d,m)})},this._document=r}get portal(){return this._attachedPortal}set portal(e){this.hasAttached()&&!e&&!this._isInitialized||(this.hasAttached()&&super.detach(),e&&super.attach(e),this._attachedPortal=e||null)}get attachedRef(){return this._attachedRef}ngOnInit(){this._isInitialized=!0}ngOnDestroy(){super.dispose(),this._attachedPortal=null,this._attachedRef=null}attachComponentPortal(e){e.setAttachedHost(this);const i=null!=e.viewContainerRef?e.viewContainerRef:this._viewContainerRef,s=(e.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(e.component),d=i.createComponent(s,i.length,e.injector||i.injector);return i!==this._viewContainerRef&&this._getRootNode().appendChild(d.hostView.rootNodes[0]),super.setDisposeFn(()=>d.destroy()),this._attachedPortal=e,this._attachedRef=d,this.attached.emit(d),d}attachTemplatePortal(e){e.setAttachedHost(this);const i=this._viewContainerRef.createEmbeddedView(e.templateRef,e.context,{injector:e.injector});return super.setDisposeFn(()=>this._viewContainerRef.clear()),this._attachedPortal=e,this._attachedRef=i,this.attached.emit(i),i}_getRootNode(){const e=this._viewContainerRef.element.nativeElement;return e.nodeType===e.ELEMENT_NODE?e:e.parentNode}}return n.\u0275fac=function(e){return new(e||n)($(Ff),$(Vo),$(si))},n.\u0275dir=vt({type:n,selectors:[["","cdkPortalOutlet",""]],inputs:{portal:["cdkPortalOutlet","portal"]},outputs:{attached:"attached"},exportAs:["cdkPortalOutlet"],features:[ut]}),n})(),sa=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({}),n})();class HO{constructor(t,e){this._parentInjector=t,this._customTokens=e}get(t,e){const i=this._customTokens.get(t);return void 0!==i?i:this._parentInjector.get(t,e)}}try{DD="undefined"!=typeof Intl&&Intl.v8BreakIterator}catch(n){DD=!1}let Kg,_s=(()=>{class n{constructor(e){this._platformId=e,this.isBrowser=this._platformId?function nj(n){return n===KA}(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!DD)&&"undefined"!=typeof CSS&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}}return n.\u0275fac=function(e){return new(e||n)(Be(ix))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const GO=["color","button","checkbox","date","datetime-local","email","file","hidden","image","month","number","password","radio","range","reset","search","submit","tel","text","time","url","week"];function qO(){if(Kg)return Kg;if("object"!=typeof document||!document)return Kg=new Set(GO),Kg;let n=document.createElement("input");return Kg=new Set(GO.filter(t=>(n.setAttribute("type",t),n.type===t))),Kg}let Ky,tm,ED;function Ip(n){return function W8(){if(null==Ky&&"undefined"!=typeof window)try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>Ky=!0}))}finally{Ky=Ky||!1}return Ky}()?n:!!n.capture}function X8(){if(null==tm){if("object"!=typeof document||!document||"function"!=typeof Element||!Element)return tm=!1,tm;if("scrollBehavior"in document.documentElement.style)tm=!0;else{const n=Element.prototype.scrollTo;tm=!!n&&!/\{\s*\[native code\]\s*\}/.test(n.toString())}}return tm}function tu(){let n="undefined"!=typeof document&&document?document.activeElement:null;for(;n&&n.shadowRoot;){const t=n.shadowRoot.activeElement;if(t===n)break;n=t}return n}function Mp(n){return n.composedPath?n.composedPath()[0]:n.target}function ID(){return"undefined"!=typeof __karma__&&!!__karma__||"undefined"!=typeof jasmine&&!!jasmine||"undefined"!=typeof jest&&!!jest||"undefined"!=typeof Mocha&&!!Mocha}function aa(n,...t){return t.length?t.some(e=>n[e]):n.altKey||n.shiftKey||n.ctrlKey||n.metaKey}class l$ extends me{constructor(t,e){super()}schedule(t,e=0){return this}}const kw={setInterval(n,t,...e){const{delegate:i}=kw;return null!=i&&i.setInterval?i.setInterval(n,t,...e):setInterval(n,t,...e)},clearInterval(n){const{delegate:t}=kw;return((null==t?void 0:t.clearInterval)||clearInterval)(n)},delegate:void 0};class PD extends l${constructor(t,e){super(t,e),this.scheduler=t,this.work=e,this.pending=!1}schedule(t,e=0){if(this.closed)return this;this.state=t;const i=this.id,r=this.scheduler;return null!=i&&(this.id=this.recycleAsyncId(r,i,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(r,this.id,e),this}requestAsyncId(t,e,i=0){return kw.setInterval(t.flush.bind(t,this),i)}recycleAsyncId(t,e,i=0){if(null!=i&&this.delay===i&&!1===this.pending)return e;kw.clearInterval(e)}execute(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const i=this._execute(t,e);if(i)return i;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,e){let r,i=!1;try{this.work(t)}catch(s){i=!0,r=s||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),r}unsubscribe(){if(!this.closed){const{id:t,scheduler:e}=this,{actions:i}=e;this.work=this.state=this.scheduler=null,this.pending=!1,p(i,this),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null,super.unsubscribe()}}}const YO={now:()=>(YO.delegate||Date).now(),delegate:void 0};class Jy{constructor(t,e=Jy.now){this.schedulerActionCtor=t,this.now=e}schedule(t,e=0,i){return new this.schedulerActionCtor(this,t).schedule(i,e)}}Jy.now=YO.now;class OD extends Jy{constructor(t,e=Jy.now){super(t,e),this.actions=[],this._active=!1,this._scheduled=void 0}flush(t){const{actions:e}=this;if(this._active)return void e.push(t);let i;this._active=!0;do{if(i=t.execute(t.state,t.delay))break}while(t=e.shift());if(this._active=!1,i){for(;t=e.shift();)t.unsubscribe();throw i}}}const Rw=new OD(PD),c$=Rw;function ev(n,t=Rw){return di((e,i)=>{let r=null,s=null,d=null;const m=()=>{if(r){r.unsubscribe(),r=null;const D=s;s=null,i.next(D)}};function v(){const D=d+n,A=t.now();if(A<D)return r=this.schedule(void 0,D-A),void i.add(r);m()}e.subscribe(Tt(i,D=>{s=D,d=t.now(),r||(r=t.schedule(v,n),i.add(r))},()=>{m(),i.complete()},void 0,()=>{s=r=null}))})}function QO(n){return Er((t,e)=>n<=e)}function Ap(n,t=wn){return n=null!=n?n:u$,di((e,i)=>{let r,s=!0;e.subscribe(Tt(i,d=>{const m=t(d);(s||!n(r,m))&&(s=!1,r=m,i.next(d))}))})}function u$(n,t){return n===t}function Li(n){return di((t,e)=>{li(n).subscribe(Tt(e,()=>e.complete(),Xe)),!e.closed&&t.subscribe(e)})}let KO=(()=>{class n{create(e){return"undefined"==typeof MutationObserver?null:new MutationObserver(e)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),d$=(()=>{class n{constructor(e){this._mutationObserverFactory=e,this._observedElements=new Map}ngOnDestroy(){this._observedElements.forEach((e,i)=>this._cleanupObserver(i))}observe(e){const i=Jf(e);return new en(r=>{const d=this._observeElement(i).subscribe(r);return()=>{d.unsubscribe(),this._unobserveElement(i)}})}_observeElement(e){if(this._observedElements.has(e))this._observedElements.get(e).count++;else{const i=new Qt,r=this._mutationObserverFactory.create(s=>i.next(s));r&&r.observe(e,{characterData:!0,childList:!0,subtree:!0}),this._observedElements.set(e,{observer:r,stream:i,count:1})}return this._observedElements.get(e).stream}_unobserveElement(e){this._observedElements.has(e)&&(this._observedElements.get(e).count--,this._observedElements.get(e).count||this._cleanupObserver(e))}_cleanupObserver(e){if(this._observedElements.has(e)){const{observer:i,stream:r}=this._observedElements.get(e);i&&i.disconnect(),r.complete(),this._observedElements.delete(e)}}}return n.\u0275fac=function(e){return new(e||n)(Be(KO))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),JO=(()=>{class n{constructor(e,i,r){this._contentObserver=e,this._elementRef=i,this._ngZone=r,this.event=new Xt,this._disabled=!1,this._currentSubscription=null}get disabled(){return this._disabled}set disabled(e){this._disabled=Qn(e),this._disabled?this._unsubscribe():this._subscribe()}get debounce(){return this._debounce}set debounce(e){this._debounce=Kd(e),this._subscribe()}ngAfterContentInit(){!this._currentSubscription&&!this.disabled&&this._subscribe()}ngOnDestroy(){this._unsubscribe()}_subscribe(){this._unsubscribe();const e=this._contentObserver.observe(this._elementRef);this._ngZone.runOutsideAngular(()=>{this._currentSubscription=(this.debounce?e.pipe(ev(this.debounce)):e).subscribe(this.event)})}_unsubscribe(){var e;null===(e=this._currentSubscription)||void 0===e||e.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)($(d$),$(Pn),$(oi))},n.\u0275dir=vt({type:n,selectors:[["","cdkObserveContent",""]],inputs:{disabled:["cdkObserveContentDisabled","disabled"],debounce:"debounce"},outputs:{event:"cdkObserveContent"},exportAs:["cdkObserveContent"]}),n})(),Pw=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({providers:[KO]}),n})();const e2=new Set;let eb,h$=(()=>{class n{constructor(e){this._platform=e,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):f$}matchMedia(e){return(this._platform.WEBKIT||this._platform.BLINK)&&function p$(n){if(!e2.has(n))try{eb||(eb=document.createElement("style"),eb.setAttribute("type","text/css"),document.head.appendChild(eb)),eb.sheet&&(eb.sheet.insertRule(`@media ${n} {body{ }}`,0),e2.add(n))}catch(t){console.error(t)}}(e),this._matchMedia(e)}}return n.\u0275fac=function(e){return new(e||n)(Be(_s))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function f$(n){return{matches:"all"===n||""===n,media:n,addListener:()=>{},removeListener:()=>{}}}let LD=(()=>{class n{constructor(e,i){this._mediaMatcher=e,this._zone=i,this._queries=new Map,this._destroySubject=new Qt}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(e){return t2(Mw(e)).some(r=>this._registerQuery(r).mql.matches)}observe(e){let s=Py(t2(Mw(e)).map(d=>this._registerQuery(d).observable));return s=Ly(s.pipe(Hr(1)),s.pipe(QO(1),ev(0))),s.pipe(Hn(d=>{const m={matches:!1,breakpoints:{}};return d.forEach(({matches:v,query:D})=>{m.matches=m.matches||v,m.breakpoints[D]=v}),m}))}_registerQuery(e){if(this._queries.has(e))return this._queries.get(e);const i=this._mediaMatcher.matchMedia(e),s={observable:new en(d=>{const m=v=>this._zone.run(()=>d.next(v));return i.addListener(m),()=>{i.removeListener(m)}}).pipe(Us(i),Hn(({matches:d})=>({query:e,matches:d})),Li(this._destroySubject)),mql:i};return this._queries.set(e,s),s}}return n.\u0275fac=function(e){return new(e||n)(Be(h$),Be(oi))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function t2(n){return n.map(t=>t.split(",")).reduce((t,e)=>t.concat(e)).map(t=>t.trim())}function Ow(n,t){return(n.getAttribute(t)||"").match(/\S+/g)||[]}const r2="cdk-describedby-message",Lw="cdk-describedby-host";let FD=0,o2=(()=>{class n{constructor(e,i){this._platform=i,this._messageRegistry=new Map,this._messagesContainer=null,this._id=""+FD++,this._document=e,this._id=Mn(Fg)+"-"+FD++}describe(e,i,r){if(!this._canBeDescribed(e,i))return;const s=ND(i,r);"string"!=typeof i?(s2(i,this._id),this._messageRegistry.set(s,{messageElement:i,referenceCount:0})):this._messageRegistry.has(s)||this._createMessageElement(i,r),this._isElementDescribedByMessage(e,s)||this._addMessageReference(e,s)}removeDescription(e,i,r){var s;if(!i||!this._isElementNode(e))return;const d=ND(i,r);if(this._isElementDescribedByMessage(e,d)&&this._removeMessageReference(e,d),"string"==typeof i){const m=this._messageRegistry.get(d);m&&0===m.referenceCount&&this._deleteMessageElement(d)}0===(null===(s=this._messagesContainer)||void 0===s?void 0:s.childNodes.length)&&(this._messagesContainer.remove(),this._messagesContainer=null)}ngOnDestroy(){var e;const i=this._document.querySelectorAll(`[${Lw}="${this._id}"]`);for(let r=0;r<i.length;r++)this._removeCdkDescribedByReferenceIds(i[r]),i[r].removeAttribute(Lw);null===(e=this._messagesContainer)||void 0===e||e.remove(),this._messagesContainer=null,this._messageRegistry.clear()}_createMessageElement(e,i){const r=this._document.createElement("div");s2(r,this._id),r.textContent=e,i&&r.setAttribute("role",i),this._createMessagesContainer(),this._messagesContainer.appendChild(r),this._messageRegistry.set(ND(e,i),{messageElement:r,referenceCount:0})}_deleteMessageElement(e){var i,r;null===(r=null===(i=this._messageRegistry.get(e))||void 0===i?void 0:i.messageElement)||void 0===r||r.remove(),this._messageRegistry.delete(e)}_createMessagesContainer(){if(this._messagesContainer)return;const e="cdk-describedby-message-container",i=this._document.querySelectorAll(`.${e}[platform="server"]`);for(let s=0;s<i.length;s++)i[s].remove();const r=this._document.createElement("div");r.style.visibility="hidden",r.classList.add(e),r.classList.add("cdk-visually-hidden"),this._platform&&!this._platform.isBrowser&&r.setAttribute("platform","server"),this._document.body.appendChild(r),this._messagesContainer=r}_removeCdkDescribedByReferenceIds(e){const i=Ow(e,"aria-describedby").filter(r=>0!=r.indexOf(r2));e.setAttribute("aria-describedby",i.join(" "))}_addMessageReference(e,i){const r=this._messageRegistry.get(i);(function m$(n,t,e){const i=Ow(n,t);i.some(r=>r.trim()==e.trim())||(i.push(e.trim()),n.setAttribute(t,i.join(" ")))})(e,"aria-describedby",r.messageElement.id),e.setAttribute(Lw,this._id),r.referenceCount++}_removeMessageReference(e,i){const r=this._messageRegistry.get(i);r.referenceCount--,function g$(n,t,e){const r=Ow(n,t).filter(s=>s!=e.trim());r.length?n.setAttribute(t,r.join(" ")):n.removeAttribute(t)}(e,"aria-describedby",r.messageElement.id),e.removeAttribute(Lw)}_isElementDescribedByMessage(e,i){const r=Ow(e,"aria-describedby"),s=this._messageRegistry.get(i),d=s&&s.messageElement.id;return!!d&&-1!=r.indexOf(d)}_canBeDescribed(e,i){if(!this._isElementNode(e))return!1;if(i&&"object"==typeof i)return!0;const r=null==i?"":`${i}`.trim(),s=e.getAttribute("aria-label");return!(!r||s&&s.trim()===r)}_isElementNode(e){return e.nodeType===this._document.ELEMENT_NODE}}return n.\u0275fac=function(e){return new(e||n)(Be(si),Be(_s))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function ND(n,t){return"string"==typeof n?`${t||""}/${n}`:n}function s2(n,t){n.id||(n.id=`${r2}-${t}-${FD++}`)}class a2{constructor(t){this._items=t,this._activeItemIndex=-1,this._activeItem=null,this._wrap=!1,this._letterKeyStream=new Qt,this._typeaheadSubscription=me.EMPTY,this._vertical=!0,this._allowedModifierKeys=[],this._homeAndEnd=!1,this._skipPredicateFn=e=>e.disabled,this._pressedLetters=[],this.tabOut=new Qt,this.change=new Qt,t instanceof Bf&&t.changes.subscribe(e=>{if(this._activeItem){const r=e.toArray().indexOf(this._activeItem);r>-1&&r!==this._activeItemIndex&&(this._activeItemIndex=r)}})}skipPredicate(t){return this._skipPredicateFn=t,this}withWrap(t=!0){return this._wrap=t,this}withVerticalOrientation(t=!0){return this._vertical=t,this}withHorizontalOrientation(t){return this._horizontal=t,this}withAllowedModifierKeys(t){return this._allowedModifierKeys=t,this}withTypeAhead(t=200){return this._typeaheadSubscription.unsubscribe(),this._typeaheadSubscription=this._letterKeyStream.pipe(jo(e=>this._pressedLetters.push(e)),ev(t),Er(()=>this._pressedLetters.length>0),Hn(()=>this._pressedLetters.join(""))).subscribe(e=>{const i=this._getItemsArray();for(let r=1;r<i.length+1;r++){const s=(this._activeItemIndex+r)%i.length,d=i[s];if(!this._skipPredicateFn(d)&&0===d.getLabel().toUpperCase().trim().indexOf(e)){this.setActiveItem(s);break}}this._pressedLetters=[]}),this}withHomeAndEnd(t=!0){return this._homeAndEnd=t,this}setActiveItem(t){const e=this._activeItem;this.updateActiveItem(t),this._activeItem!==e&&this.change.next(this._activeItemIndex)}onKeydown(t){const e=t.keyCode,r=["altKey","ctrlKey","metaKey","shiftKey"].every(s=>!t[s]||this._allowedModifierKeys.indexOf(s)>-1);switch(e){case 9:return void this.tabOut.next();case 40:if(this._vertical&&r){this.setNextItemActive();break}return;case 38:if(this._vertical&&r){this.setPreviousItemActive();break}return;case 39:if(this._horizontal&&r){"rtl"===this._horizontal?this.setPreviousItemActive():this.setNextItemActive();break}return;case 37:if(this._horizontal&&r){"rtl"===this._horizontal?this.setNextItemActive():this.setPreviousItemActive();break}return;case 36:if(this._homeAndEnd&&r){this.setFirstItemActive();break}return;case 35:if(this._homeAndEnd&&r){this.setLastItemActive();break}return;default:return void((r||aa(t,"shiftKey"))&&(t.key&&1===t.key.length?this._letterKeyStream.next(t.key.toLocaleUpperCase()):(e>=65&&e<=90||e>=48&&e<=57)&&this._letterKeyStream.next(String.fromCharCode(e))))}this._pressedLetters=[],t.preventDefault()}get activeItemIndex(){return this._activeItemIndex}get activeItem(){return this._activeItem}isTyping(){return this._pressedLetters.length>0}setFirstItemActive(){this._setActiveItemByIndex(0,1)}setLastItemActive(){this._setActiveItemByIndex(this._items.length-1,-1)}setNextItemActive(){this._activeItemIndex<0?this.setFirstItemActive():this._setActiveItemByDelta(1)}setPreviousItemActive(){this._activeItemIndex<0&&this._wrap?this.setLastItemActive():this._setActiveItemByDelta(-1)}updateActiveItem(t){const e=this._getItemsArray(),i="number"==typeof t?t:e.indexOf(t),r=e[i];this._activeItem=null==r?null:r,this._activeItemIndex=i}_setActiveItemByDelta(t){this._wrap?this._setActiveInWrapMode(t):this._setActiveInDefaultMode(t)}_setActiveInWrapMode(t){const e=this._getItemsArray();for(let i=1;i<=e.length;i++){const r=(this._activeItemIndex+t*i+e.length)%e.length;if(!this._skipPredicateFn(e[r]))return void this.setActiveItem(r)}}_setActiveInDefaultMode(t){this._setActiveItemByIndex(this._activeItemIndex+t,t)}_setActiveItemByIndex(t,e){const i=this._getItemsArray();if(i[t]){for(;this._skipPredicateFn(i[t]);)if(!i[t+=e])return;this.setActiveItem(t)}}_getItemsArray(){return this._items instanceof Bf?this._items.toArray():this._items}}class l2 extends a2{setActiveItem(t){this.activeItem&&this.activeItem.setInactiveStyles(),super.setActiveItem(t),this.activeItem&&this.activeItem.setActiveStyles()}}class BD extends a2{constructor(){super(...arguments),this._origin="program"}setFocusOrigin(t){return this._origin=t,this}setActiveItem(t){super.setActiveItem(t),this.activeItem&&this.activeItem.focus(this._origin)}}let rm=(()=>{class n{constructor(e){this._platform=e}isDisabled(e){return e.hasAttribute("disabled")}isVisible(e){return function _$(n){return!!(n.offsetWidth||n.offsetHeight||"function"==typeof n.getClientRects&&n.getClientRects().length)}(e)&&"visible"===getComputedStyle(e).visibility}isTabbable(e){if(!this._platform.isBrowser)return!1;const i=function b$(n){try{return n.frameElement}catch(t){return null}}(function D$(n){return n.ownerDocument&&n.ownerDocument.defaultView||window}(e));if(i&&(-1===u2(i)||!this.isVisible(i)))return!1;let r=e.nodeName.toLowerCase(),s=u2(e);return e.hasAttribute("contenteditable")?-1!==s:!("iframe"===r||"object"===r||this._platform.WEBKIT&&this._platform.IOS&&!function C$(n){let t=n.nodeName.toLowerCase(),e="input"===t&&n.type;return"text"===e||"password"===e||"select"===t||"textarea"===t}(e))&&("audio"===r?!!e.hasAttribute("controls")&&-1!==s:"video"===r?-1!==s&&(null!==s||this._platform.FIREFOX||e.hasAttribute("controls")):e.tabIndex>=0)}isFocusable(e,i){return function T$(n){return!function v$(n){return function w$(n){return"input"==n.nodeName.toLowerCase()}(n)&&"hidden"==n.type}(n)&&(function y$(n){let t=n.nodeName.toLowerCase();return"input"===t||"select"===t||"button"===t||"textarea"===t}(n)||function x$(n){return function S$(n){return"a"==n.nodeName.toLowerCase()}(n)&&n.hasAttribute("href")}(n)||n.hasAttribute("contenteditable")||c2(n))}(e)&&!this.isDisabled(e)&&((null==i?void 0:i.ignoreVisibility)||this.isVisible(e))}}return n.\u0275fac=function(e){return new(e||n)(Be(_s))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function c2(n){if(!n.hasAttribute("tabindex")||void 0===n.tabIndex)return!1;let t=n.getAttribute("tabindex");return!(!t||isNaN(parseInt(t,10)))}function u2(n){if(!c2(n))return null;const t=parseInt(n.getAttribute("tabindex")||"",10);return isNaN(t)?-1:t}class d2{constructor(t,e,i,r,s=!1){this._element=t,this._checker=e,this._ngZone=i,this._document=r,this._hasAttached=!1,this.startAnchorListener=()=>this.focusLastTabbableElement(),this.endAnchorListener=()=>this.focusFirstTabbableElement(),this._enabled=!0,s||this.attachAnchors()}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(t,this._startAnchor),this._toggleAnchorTabIndex(t,this._endAnchor))}destroy(){const t=this._startAnchor,e=this._endAnchor;t&&(t.removeEventListener("focus",this.startAnchorListener),t.remove()),e&&(e.removeEventListener("focus",this.endAnchorListener),e.remove()),this._startAnchor=this._endAnchor=null,this._hasAttached=!1}attachAnchors(){return!!this._hasAttached||(this._ngZone.runOutsideAngular(()=>{this._startAnchor||(this._startAnchor=this._createAnchor(),this._startAnchor.addEventListener("focus",this.startAnchorListener)),this._endAnchor||(this._endAnchor=this._createAnchor(),this._endAnchor.addEventListener("focus",this.endAnchorListener))}),this._element.parentNode&&(this._element.parentNode.insertBefore(this._startAnchor,this._element),this._element.parentNode.insertBefore(this._endAnchor,this._element.nextSibling),this._hasAttached=!0),this._hasAttached)}focusInitialElementWhenReady(t){return new Promise(e=>{this._executeOnStable(()=>e(this.focusInitialElement(t)))})}focusFirstTabbableElementWhenReady(t){return new Promise(e=>{this._executeOnStable(()=>e(this.focusFirstTabbableElement(t)))})}focusLastTabbableElementWhenReady(t){return new Promise(e=>{this._executeOnStable(()=>e(this.focusLastTabbableElement(t)))})}_getRegionBoundary(t){const e=this._element.querySelectorAll(`[cdk-focus-region-${t}], [cdkFocusRegion${t}], [cdk-focus-${t}]`);return"start"==t?e.length?e[0]:this._getFirstTabbableElement(this._element):e.length?e[e.length-1]:this._getLastTabbableElement(this._element)}focusInitialElement(t){const e=this._element.querySelector("[cdk-focus-initial], [cdkFocusInitial]");if(e){if(!this._checker.isFocusable(e)){const i=this._getFirstTabbableElement(e);return null==i||i.focus(t),!!i}return e.focus(t),!0}return this.focusFirstTabbableElement(t)}focusFirstTabbableElement(t){const e=this._getRegionBoundary("start");return e&&e.focus(t),!!e}focusLastTabbableElement(t){const e=this._getRegionBoundary("end");return e&&e.focus(t),!!e}hasAttached(){return this._hasAttached}_getFirstTabbableElement(t){if(this._checker.isFocusable(t)&&this._checker.isTabbable(t))return t;const e=t.children;for(let i=0;i<e.length;i++){const r=e[i].nodeType===this._document.ELEMENT_NODE?this._getFirstTabbableElement(e[i]):null;if(r)return r}return null}_getLastTabbableElement(t){if(this._checker.isFocusable(t)&&this._checker.isTabbable(t))return t;const e=t.children;for(let i=e.length-1;i>=0;i--){const r=e[i].nodeType===this._document.ELEMENT_NODE?this._getLastTabbableElement(e[i]):null;if(r)return r}return null}_createAnchor(){const t=this._document.createElement("div");return this._toggleAnchorTabIndex(this._enabled,t),t.classList.add("cdk-visually-hidden"),t.classList.add("cdk-focus-trap-anchor"),t.setAttribute("aria-hidden","true"),t}_toggleAnchorTabIndex(t,e){t?e.setAttribute("tabindex","0"):e.removeAttribute("tabindex")}toggleAnchors(t){this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(t,this._startAnchor),this._toggleAnchorTabIndex(t,this._endAnchor))}_executeOnStable(t){this._ngZone.isStable?t():this._ngZone.onStable.pipe(Hr(1)).subscribe(t)}}let tb=(()=>{class n{constructor(e,i,r){this._checker=e,this._ngZone=i,this._document=r}create(e,i=!1){return new d2(e,this._checker,this._ngZone,this._document,i)}}return n.\u0275fac=function(e){return new(e||n)(Be(rm),Be(oi),Be(si))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),E$=(()=>{class n{constructor(e,i,r){this._elementRef=e,this._focusTrapFactory=i,this._previouslyFocusedElement=null,this.focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement,!0)}get enabled(){return this.focusTrap.enabled}set enabled(e){this.focusTrap.enabled=Qn(e)}get autoCapture(){return this._autoCapture}set autoCapture(e){this._autoCapture=Qn(e)}ngOnDestroy(){this.focusTrap.destroy(),this._previouslyFocusedElement&&(this._previouslyFocusedElement.focus(),this._previouslyFocusedElement=null)}ngAfterContentInit(){this.focusTrap.attachAnchors(),this.autoCapture&&this._captureFocus()}ngDoCheck(){this.focusTrap.hasAttached()||this.focusTrap.attachAnchors()}ngOnChanges(e){const i=e.autoCapture;i&&!i.firstChange&&this.autoCapture&&this.focusTrap.hasAttached()&&this._captureFocus()}_captureFocus(){this._previouslyFocusedElement=tu(),this.focusTrap.focusInitialElementWhenReady()}}return n.\u0275fac=function(e){return new(e||n)($(Pn),$(tb),$(si))},n.\u0275dir=vt({type:n,selectors:[["","cdkTrapFocus",""]],inputs:{enabled:["cdkTrapFocus","enabled"],autoCapture:["cdkTrapFocusAutoCapture","autoCapture"]},exportAs:["cdkTrapFocus"],features:[dr]}),n})();class I$ extends d2{constructor(t,e,i,r,s,d,m){super(t,e,i,r,m.defer),this._focusTrapManager=s,this._inertStrategy=d,this._focusTrapManager.register(this)}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this._enabled?this._focusTrapManager.register(this):this._focusTrapManager.deregister(this)}destroy(){this._focusTrapManager.deregister(this),super.destroy()}_enable(){this._inertStrategy.preventFocus(this),this.toggleAnchors(!0)}_disable(){this._inertStrategy.allowFocus(this),this.toggleAnchors(!1)}}const M$=new bt("FOCUS_TRAP_INERT_STRATEGY");class A${constructor(){this._listener=null}preventFocus(t){this._listener&&t._document.removeEventListener("focus",this._listener,!0),this._listener=e=>this._trapFocus(t,e),t._ngZone.runOutsideAngular(()=>{t._document.addEventListener("focus",this._listener,!0)})}allowFocus(t){!this._listener||(t._document.removeEventListener("focus",this._listener,!0),this._listener=null)}_trapFocus(t,e){var i;const r=e.target,s=t._element;r&&!s.contains(r)&&(null===(i=r.closest)||void 0===i||!i.call(r,"div.cdk-overlay-pane"))&&setTimeout(()=>{t.enabled&&!s.contains(t._document.activeElement)&&t.focusFirstTabbableElement()})}}let k$=(()=>{class n{constructor(){this._focusTrapStack=[]}register(e){this._focusTrapStack=this._focusTrapStack.filter(r=>r!==e);let i=this._focusTrapStack;i.length&&i[i.length-1]._disable(),i.push(e),e._enable()}deregister(e){e._disable();const i=this._focusTrapStack,r=i.indexOf(e);-1!==r&&(i.splice(r,1),i.length&&i[i.length-1]._enable())}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),h2=(()=>{class n{constructor(e,i,r,s,d){this._checker=e,this._ngZone=i,this._focusTrapManager=r,this._document=s,this._inertStrategy=d||new A$}create(e,i={defer:!1}){let r;return r="boolean"==typeof i?{defer:i}:i,new I$(e,this._checker,this._ngZone,this._document,this._focusTrapManager,this._inertStrategy,r)}}return n.\u0275fac=function(e){return new(e||n)(Be(rm),Be(oi),Be(k$),Be(si),Be(M$,8))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const O$=new bt("cdk-input-modality-detector-options"),L$={ignoreKeys:[18,17,224,91,16]},nb=Ip({passive:!0,capture:!0});let F$=(()=>{class n{constructor(e,i,r,s){this._platform=e,this._mostRecentTarget=null,this._modality=new ia(null),this._lastTouchMs=0,this._onKeydown=d=>{var m,v;null!==(v=null===(m=this._options)||void 0===m?void 0:m.ignoreKeys)&&void 0!==v&&v.some(D=>D===d.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=Mp(d))},this._onMousedown=d=>{Date.now()-this._lastTouchMs<650||(this._modality.next(function R$(n){return 0===n.buttons||0===n.offsetX&&0===n.offsetY}(d)?"keyboard":"mouse"),this._mostRecentTarget=Mp(d))},this._onTouchstart=d=>{!function P$(n){const t=n.touches&&n.touches[0]||n.changedTouches&&n.changedTouches[0];return!(!t||-1!==t.identifier||null!=t.radiusX&&1!==t.radiusX||null!=t.radiusY&&1!==t.radiusY)}(d)?(this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=Mp(d)):this._modality.next("keyboard")},this._options=Object.assign(Object.assign({},L$),s),this.modalityDetected=this._modality.pipe(QO(1)),this.modalityChanged=this.modalityDetected.pipe(Ap()),e.isBrowser&&i.runOutsideAngular(()=>{r.addEventListener("keydown",this._onKeydown,nb),r.addEventListener("mousedown",this._onMousedown,nb),r.addEventListener("touchstart",this._onTouchstart,nb)})}get mostRecentModality(){return this._modality.value}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,nb),document.removeEventListener("mousedown",this._onMousedown,nb),document.removeEventListener("touchstart",this._onTouchstart,nb))}}return n.\u0275fac=function(e){return new(e||n)(Be(_s),Be(oi),Be(si),Be(O$,8))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const N$=new bt("liveAnnouncerElement",{providedIn:"root",factory:function B$(){return null}}),z$=new bt("LIVE_ANNOUNCER_DEFAULT_OPTIONS");let f2=(()=>{class n{constructor(e,i,r,s){this._ngZone=i,this._defaultOptions=s,this._document=r,this._liveElement=e||this._createLiveElement()}announce(e,...i){const r=this._defaultOptions;let s,d;return 1===i.length&&"number"==typeof i[0]?d=i[0]:[s,d]=i,this.clear(),clearTimeout(this._previousTimeout),s||(s=r&&r.politeness?r.politeness:"polite"),null==d&&r&&(d=r.duration),this._liveElement.setAttribute("aria-live",s),this._ngZone.runOutsideAngular(()=>(this._currentPromise||(this._currentPromise=new Promise(m=>this._currentResolve=m)),clearTimeout(this._previousTimeout),this._previousTimeout=setTimeout(()=>{this._liveElement.textContent=e,"number"==typeof d&&(this._previousTimeout=setTimeout(()=>this.clear(),d)),this._currentResolve(),this._currentPromise=this._currentResolve=void 0},100),this._currentPromise))}clear(){this._liveElement&&(this._liveElement.textContent="")}ngOnDestroy(){var e,i;clearTimeout(this._previousTimeout),null===(e=this._liveElement)||void 0===e||e.remove(),this._liveElement=null,null===(i=this._currentResolve)||void 0===i||i.call(this),this._currentPromise=this._currentResolve=void 0}_createLiveElement(){const e="cdk-live-announcer-element",i=this._document.getElementsByClassName(e),r=this._document.createElement("div");for(let s=0;s<i.length;s++)i[s].remove();return r.classList.add(e),r.classList.add("cdk-visually-hidden"),r.setAttribute("aria-atomic","true"),r.setAttribute("aria-live","polite"),this._document.body.appendChild(r),r}}return n.\u0275fac=function(e){return new(e||n)(Be(N$,8),Be(oi),Be(si),Be(z$,8))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const V$=new bt("cdk-focus-monitor-default-options"),Fw=Ip({passive:!0,capture:!0});let Da=(()=>{class n{constructor(e,i,r,s,d){this._ngZone=e,this._platform=i,this._inputModalityDetector=r,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=window.setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new Qt,this._rootNodeFocusAndBlurListener=m=>{for(let D=Mp(m);D;D=D.parentElement)"focus"===m.type?this._onFocus(m,D):this._onBlur(m,D)},this._document=s,this._detectionMode=(null==d?void 0:d.detectionMode)||0}monitor(e,i=!1){const r=Jf(e);if(!this._platform.isBrowser||1!==r.nodeType)return ei(null);const s=function Y8(n){if(function Z8(){if(null==ED){const n="undefined"!=typeof document?document.head:null;ED=!(!n||!n.createShadowRoot&&!n.attachShadow)}return ED}()){const t=n.getRootNode?n.getRootNode():null;if("undefined"!=typeof ShadowRoot&&ShadowRoot&&t instanceof ShadowRoot)return t}return null}(r)||this._getDocument(),d=this._elementInfo.get(r);if(d)return i&&(d.checkChildren=!0),d.subject;const m={checkChildren:i,subject:new Qt,rootNode:s};return this._elementInfo.set(r,m),this._registerGlobalListeners(m),m.subject}stopMonitoring(e){const i=Jf(e),r=this._elementInfo.get(i);r&&(r.subject.complete(),this._setClasses(i),this._elementInfo.delete(i),this._removeGlobalListeners(r))}focusVia(e,i,r){const s=Jf(e);s===this._getDocument().activeElement?this._getClosestElementsInfo(s).forEach(([m,v])=>this._originChanged(m,i,v)):(this._setOrigin(i),"function"==typeof s.focus&&s.focus(r))}ngOnDestroy(){this._elementInfo.forEach((e,i)=>this.stopMonitoring(i))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(e){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(e)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:e&&this._isLastInteractionFromInputLabel(e)?"mouse":"program"}_shouldBeAttributedToTouch(e){return 1===this._detectionMode||!(null==e||!e.contains(this._inputModalityDetector._mostRecentTarget))}_setClasses(e,i){e.classList.toggle("cdk-focused",!!i),e.classList.toggle("cdk-touch-focused","touch"===i),e.classList.toggle("cdk-keyboard-focused","keyboard"===i),e.classList.toggle("cdk-mouse-focused","mouse"===i),e.classList.toggle("cdk-program-focused","program"===i)}_setOrigin(e,i=!1){this._ngZone.runOutsideAngular(()=>{this._origin=e,this._originFromTouchInteraction="touch"===e&&i,0===this._detectionMode&&(clearTimeout(this._originTimeoutId),this._originTimeoutId=setTimeout(()=>this._origin=null,this._originFromTouchInteraction?650:1))})}_onFocus(e,i){const r=this._elementInfo.get(i),s=Mp(e);!r||!r.checkChildren&&i!==s||this._originChanged(i,this._getFocusOrigin(s),r)}_onBlur(e,i){const r=this._elementInfo.get(i);!r||r.checkChildren&&e.relatedTarget instanceof Node&&i.contains(e.relatedTarget)||(this._setClasses(i),this._emitOrigin(r,null))}_emitOrigin(e,i){e.subject.observers.length&&this._ngZone.run(()=>e.subject.next(i))}_registerGlobalListeners(e){if(!this._platform.isBrowser)return;const i=e.rootNode,r=this._rootNodeFocusListenerCount.get(i)||0;r||this._ngZone.runOutsideAngular(()=>{i.addEventListener("focus",this._rootNodeFocusAndBlurListener,Fw),i.addEventListener("blur",this._rootNodeFocusAndBlurListener,Fw)}),this._rootNodeFocusListenerCount.set(i,r+1),1==++this._monitoredElementCount&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(Li(this._stopInputModalityDetector)).subscribe(s=>{this._setOrigin(s,!0)}))}_removeGlobalListeners(e){const i=e.rootNode;if(this._rootNodeFocusListenerCount.has(i)){const r=this._rootNodeFocusListenerCount.get(i);r>1?this._rootNodeFocusListenerCount.set(i,r-1):(i.removeEventListener("focus",this._rootNodeFocusAndBlurListener,Fw),i.removeEventListener("blur",this._rootNodeFocusAndBlurListener,Fw),this._rootNodeFocusListenerCount.delete(i))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(e,i,r){this._setClasses(e,i),this._emitOrigin(r,i),this._lastFocusOrigin=i}_getClosestElementsInfo(e){const i=[];return this._elementInfo.forEach((r,s)=>{(s===e||r.checkChildren&&s.contains(e))&&i.push([s,r])}),i}_isLastInteractionFromInputLabel(e){const{_mostRecentTarget:i,mostRecentModality:r}=this._inputModalityDetector;if("mouse"!==r||!i||i===e||"INPUT"!==e.nodeName&&"TEXTAREA"!==e.nodeName||e.disabled)return!1;const s=e.labels;if(s)for(let d=0;d<s.length;d++)if(s[d].contains(i))return!0;return!1}}return n.\u0275fac=function(e){return new(e||n)(Be(oi),Be(_s),Be(F$),Be(si,8),Be(V$,8))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),j$=(()=>{class n{constructor(e,i){this._elementRef=e,this._focusMonitor=i,this.cdkFocusChange=new Xt}ngAfterViewInit(){const e=this._elementRef.nativeElement;this._monitorSubscription=this._focusMonitor.monitor(e,1===e.nodeType&&e.hasAttribute("cdkMonitorSubtreeFocus")).subscribe(i=>this.cdkFocusChange.emit(i))}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._monitorSubscription&&this._monitorSubscription.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)($(Pn),$(Da))},n.\u0275dir=vt({type:n,selectors:[["","cdkMonitorElementFocus",""],["","cdkMonitorSubtreeFocus",""]],outputs:{cdkFocusChange:"cdkFocusChange"}}),n})();const m2="cdk-high-contrast-black-on-white",g2="cdk-high-contrast-white-on-black",zD="cdk-high-contrast-active";let b2=(()=>{class n{constructor(e,i){this._platform=e,this._document=i,this._breakpointSubscription=Mn(LD).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return 0;const e=this._document.createElement("div");e.style.backgroundColor="rgb(1,2,3)",e.style.position="absolute",this._document.body.appendChild(e);const i=this._document.defaultView||window,r=i&&i.getComputedStyle?i.getComputedStyle(e):null,s=(r&&r.backgroundColor||"").replace(/ /g,"");switch(e.remove(),s){case"rgb(0,0,0)":return 2;case"rgb(255,255,255)":return 1}return 0}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const e=this._document.body.classList;e.remove(zD,m2,g2),this._hasCheckedHighContrastMode=!0;const i=this.getHighContrastMode();1===i?e.add(zD,m2):2===i&&e.add(zD,g2)}}}return n.\u0275fac=function(e){return new(e||n)(Be(_s),Be(si))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),om=(()=>{class n{constructor(e){e._applyBodyHighContrastModeCssClasses()}}return n.\u0275fac=function(e){return new(e||n)(Be(b2))},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({imports:[Pw]}),n})();const U$=["*",[["sbb-option"],["ng-container"],["sbb-option-hint"],["sbb-autocomplete-hint"]]],H$=["*","sbb-option, ng-container, sbb-option-hint, sbb-autocomplete-hint"];function $$(n,t){if(1&n&&qn(0,"sbb-pseudo-checkbox",2),2&n){const e=Fn();dt("disabled",e.disabled)("state",e.selected?"checked":"unchecked")}}function G$(n,t){if(1&n&&(Ee(0,"span",3),Pt(1),Pe()),2&n){const e=Fn();Je(1),Do("(",e.group.label,")")}}const q$=["*"],W$=(new Nf("14.1.2"),"undefined"!=typeof globalThis&&globalThis),X$="undefined"!=typeof window&&window,Z$="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,VD=W$||"undefined"!=typeof global&&global||X$||Z$,jD=function(n,...t){if(jD.translate){const i=jD.translate(n,t);n=i[0],t=i[1]}let e=v2(n[0],n.raw[0]);for(let i=1;i<n.length;i++)e+=t[i-1]+v2(n[i],n.raw[i]);return e};function v2(n,t){return":"===t.charAt(0)?n.substring(function Y$(n,t){for(let e=1,i=1;e<n.length;e++,i++)if("\\"===t[i])i++;else if(":"===n[e])return e;throw new Error(`Unterminated $localize metadata block in "${t}".`)}(n,t)+1):n}const UD=new ia("standard");function sm(n){return class extends n{constructor(...t){super(...t),this.variant=UD}get variantSnapshot(){return UD.value}}}const K$=new bt("sbb-sanity-checks",{providedIn:"root",factory:function Q$(){return!0}});let Gi=(()=>{class n{constructor(e,i,r){this._sanityChecks=i,this._document=r,this._hasDoneGlobalChecks=!1,UD.next(this._document.documentElement.classList.contains("sbb-lean")?"lean":"standard"),e._applyBodyHighContrastModeCssClasses(),function J$(){"function"!=typeof VD.$localize&&(VD.$localize=Object.assign(jD,VD.$localize))}(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(e){return!ID()&&("boolean"==typeof this._sanityChecks?this._sanityChecks:!!this._sanityChecks[e])}}return n.\u0275fac=function(e){return new(e||n)(Be(b2),Be(K$,8),Be(si))},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({}),n})();function Wa(n){return class extends n{constructor(...t){super(...t),this._disabled=!1}get disabled(){return this._disabled}set disabled(t){this._disabled=Qn(t)}}}function Nw(n){return class extends n{constructor(...t){super(...t),this.errorState=!1}updateErrorState(){const t=this.errorState,s=(this.errorStateMatcher||this._defaultErrorStateMatcher).isErrorState(this.ngControl?this.ngControl.control:null,this._parentFormGroup||this._parentForm);s!==t&&(this.errorState=s,this.stateChanges.next())}}}function x2(n){return class extends n{constructor(...t){super(...t),this._isInitialized=!1,this._pendingSubscribers=[],this.initialized=new en(e=>{this._isInitialized?this._notifySubscriber(e):this._pendingSubscribers.push(e)})}_markInitialized(){this._isInitialized=!0,this._pendingSubscribers.forEach(this._notifySubscriber),this._pendingSubscribers=null}_notifySubscriber(t){t.next(),t.complete()}}}function ib(n,t=0){return class extends n{constructor(...e){super(...e),this._tabIndex=t,this.defaultTabIndex=t}get tabIndex(){return this.disabled?-1:this._tabIndex}set tabIndex(e){this._tabIndex=null!=e?Kd(e):this.defaultTabIndex}}}class kp{deserialize(t){return null==t||this.isDateInstance(t)&&this.isValid(t)?t:this.invalid()}setLocale(t){this._locale=t}compareDate(t,e){return this.getYear(t)-this.getYear(e)||this.getMonth(t)-this.getMonth(e)||this.getDate(t)-this.getDate(e)}sameDate(t,e){if(t&&e){const i=this.isValid(t),r=this.isValid(e);return i&&r?!this.compareDate(t,e):i===r}return t===e}clampDate(t,e,i){return e&&this.compareDate(t,e)<0?e:i&&this.compareDate(t,i)>0?i:t}}const Bw=new bt("sbb-date-formats"),eG={dateInput:"EEEEEE, dd.MM.yyyy",dateA11yLabel:"dd MM yyyy"},w2=new bt("SBB_DATEPICKER_2DIGIT_YEAR_PIVOT"),tG=/^\d{4}-\d{2}-\d{2}(?:T\d{2}:\d{2}:\d{2}(?:\.\d+)?(?:Z|(?:(?:\+|-)\d{2}:\d{2}))?)?$/;function HD(n,t){const e=Array(n);for(let i=0;i<n;i++)e[i]=t(i);return e}let S2=(()=>{class n extends kp{constructor(e,i){super(),this._locale=e,this._titleCasePipe=new ZA,this._datePipe=new YA(e),this._yearPivot="number"==typeof i?i:(new Date).getFullYear()-1975}getYear(e){return e.getFullYear()}getMonth(e){return e.getMonth()}getDate(e){return e.getDate()}getDayOfWeek(e){return e.getDay()}getMonthName(e){return this._datePipe.transform(e,"LLLL")}getMonthNames(e){let i;switch(e){case"long":i="LLLL";break;case"narrow":i="LLLLL";break;default:i="LLL"}return HD(12,r=>this._datePipe.transform(new Date(2017,r,1),i))}getDateNames(){return HD(31,e=>this._datePipe.transform(new Date(2017,0,e+1),"d"))}getDayOfWeekNames(e){let i;switch(e){case"long":i="EEEE";break;case"narrow":i="EEEEE";break;default:i="EEE"}return HD(7,r=>this._datePipe.transform(new Date(2017,0,r+1),i))}getYearName(e){return this._datePipe.transform(e,"yyyy")}getFirstDayOfWeek(){return 1}getNumDaysInMonth(e){const i=new Date(0);return i.setFullYear(e.getFullYear(),e.getMonth()+1,0),i.setHours(0,0,0,0),i.getDate()}clone(e){return new Date(e.valueOf())}createDate(e,i,r){if(i<0||i>11)throw Error(`Invalid month index "${i}". Month index has to be between 0 and 11.`);if(r<1)throw Error(`Invalid date "${r}". Date has to be greater than 0.`);const s=this._createDateWithOverflow(e,i,r);if(s.getMonth()!==i)throw Error(`Invalid date "${r}" for month with index "${i}".`);return s}today(){const e=new Date;return e.setHours(0,0,0,0),e}parse(e){return"number"==typeof e?new Date(e):"string"==typeof e?this._parseStringDate(e):null}format(e,i){if(!this.isValid(e))throw Error("NativeDateAdapter: Cannot format invalid date.");return this._titleCasePipe.transform(this._datePipe.transform(e,i))}addCalendarYears(e,i){return this.addCalendarMonths(e,12*i)}addCalendarMonths(e,i){const r=e.getMonth()+i,s=new Date(0);s.setFullYear(e.getFullYear(),r,1),s.setHours(0,0,0,0);const d=this.getNumDaysInMonth(s),m=this.clone(e);return m.setMonth(r,Math.min(d,e.getDate())),m}addCalendarDays(e,i){const r=this.clone(e);return r.setDate(r.getDate()+i),r}toIso8601(e){return this._datePipe.transform(e,"yyyy-MM-dd")}deserialize(e){if("string"==typeof e){if(!e)return null;if(tG.test(e)){const i=new Date(e);if(this.isValid(i))return i}}return super.deserialize(e)}isDateInstance(e){return e instanceof Date}isValid(e){return!isNaN(e.valueOf())}invalid(){return new Date(NaN)}_parseStringDate(e){const i=/^(\w+,[ ]?)?(\d+)\.(\d+)\.(\d+)$/.exec(e);if(!i)return null;const r=this._createDateWithOverflow(+i[4],+i[3]-1,+i[2]);return this._normalizeYear(r)}_normalizeYear(e){if(e.getFullYear()<0||e.getFullYear()>=100)return e;const i=e.getFullYear()<=this._yearPivot?2e3:1900;return new Date(e.getFullYear()+i,e.getMonth(),e.getDate())}_createDateWithOverflow(e,i,r){const s=new Date(e,i,r);return e>=0&&e<100&&s.setFullYear(this.getYear(s)-1900),s}}return n.\u0275fac=function(e){return new(e||n)(Be(Fl),Be(w2,8))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})(),$D=(()=>{class n{isErrorState(e,i){return!!(e&&e.invalid&&(e.touched||i&&i.submitted))}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const zw=new bt("SBB_OPTION_PARENT_COMPONENT"),nG=Wa(class{});let iG=0;const C2=new bt("SbbOptgroup");let T2=(()=>{class n extends nG{constructor(e){var i;super(),this._labelId="sbb-optgroup-label-"+iG++,this._inert=null!==(i=null==e?void 0:e.inertGroups)&&void 0!==i&&i}}return n.\u0275fac=function(e){return new(e||n)($(zw,8))},n.\u0275cmp=kn({type:n,selectors:[["sbb-optgroup"]],hostAttrs:[1,"sbb-optgroup","sbb-menu-group"],hostVars:5,hostBindings:function(e,i){2&e&&(Ht("role",i._inert?null:"group")("aria-disabled",i._inert?null:i.disabled.toString())("aria-labelledby",i._inert?null:i._labelId),Oi("sbb-disabled",i.disabled))},inputs:{disabled:"disabled",label:"label"},exportAs:["sbbOptgroup"],features:[Kn([{provide:C2,useExisting:n}]),ut],ngContentSelectors:H$,decls:4,vars:2,consts:[[1,"sbb-label","sbb-optgroup-label",3,"id"]],template:function(e,i){1&e&&(Ro(U$),Ee(0,"label",0),Pt(1),Lr(2),Pe(),Lr(3,1)),2&e&&(dt("id",i._labelId),Je(1),Do("",i.label," "))},encapsulation:2,changeDetection:0}),n})(),rG=(()=>{class n{constructor(){this.state="unchecked",this.disabled=!1}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=kn({type:n,selectors:[["sbb-pseudo-checkbox"]],hostAttrs:[1,"sbb-pseudo-checkbox"],hostVars:6,hostBindings:function(e,i){2&e&&Oi("sbb-selection-disabled",i.disabled)("sbb-selection-checked","checked"===i.state)("sbb-selection-indeterminate","indeterminate"===i.state)},inputs:{state:"state",disabled:"disabled"},decls:4,vars:0,consts:[[1,"sbb-selection-container"],[1,"sbb-selection-container-checked"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","focusable","false"],["fill","none","fill-rule","evenodd","stroke","#000","stroke-width","1","points","6 12 10 16 19 7.01"]],template:function(e,i){1&e&&(Ee(0,"div",0)(1,"span",1),Ml(),Ee(2,"svg",2),qn(3,"polyline",3),Pe()()())},encapsulation:2,changeDetection:0}),n})(),oG=0;class D2{constructor(t,e=!1){this.source=t,this.isUserInput=e}}let tv=(()=>{class n{constructor(e,i,r,s,d){this._element=e,this._document=i,this._changeDetectorRef=r,this._parent=s,this.group=d,this._selected=!1,this._active=!1,this._disabled=!1,this._mostRecentViewValue="",this._highlighted=!1,this.id="sbb-option-"+oG++,this.onSelectionChange=new Xt,this._stateChanges=new Qt}get multiple(){return this._parent&&this._parent.multiple}get selected(){return this._selected}get disabled(){return this.group&&this.group.disabled||this._disabled}set disabled(e){this._disabled=Qn(e),this._changeDetectorRef.markForCheck()}get active(){return this._active}get viewValue(){return(this._getHostElement().textContent||"").trim()}select(){this.selected||(this._selected=!0,this._changeDetectorRef.markForCheck(),this._emitSelectionChangeEvent())}deselect(){this._selected&&(this._selected=!1,this._changeDetectorRef.markForCheck(),this._emitSelectionChangeEvent())}focus(e,i){const r=this._getHostElement();"function"==typeof r.focus&&r.focus(i)}setActiveStyles(){this.active||(this._active=!0,this._changeDetectorRef.markForCheck())}setInactiveStyles(){this.active&&(this._active=!1,this._changeDetectorRef.markForCheck())}getLabel(){return this.viewValue}_handleKeydown(e){(13===e.keyCode||32===e.keyCode)&&!aa(e)&&(this._selectViaInteraction(),e.preventDefault())}_selectViaInteraction(){this.disabled||(this._selected=!this.multiple||!this.selected,this._changeDetectorRef.markForCheck(),this._emitSelectionChangeEvent(!0))}_getAriaSelected(){return this.selected||!this.multiple&&null}_getTabIndex(){return this.disabled?"-1":"0"}_getHostElement(){return this._element.nativeElement}ngAfterViewChecked(){if(this._selected){const e=this.viewValue;e!==this._mostRecentViewValue&&(this._mostRecentViewValue=e,this._stateChanges.next())}}ngOnDestroy(){this._stateChanges.complete()}_highlight(e,i){if(void 0===this._originalInnerHtml)this._originalInnerHtml=this._element.nativeElement.innerHTML;else{if(e===this._highlightValue)return;this._highlighted&&(this._element.nativeElement.innerHTML=this._originalInnerHtml,this._highlighted=!1)}if(this._highlightValue=e,e&&this._originalInnerHtml){const r=i||(v=>v),s=(e=r(e)).replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),d=new RegExp(`${s}+`,"i"),m=this._findAllTextNodesWithMatch(d,r);m.forEach(v=>this._highlightNode(v,d,r)),this._highlighted=!!m.length}}_findAllTextNodesWithMatch(e,i,r=this._element.nativeElement){const s=[],d=r.childNodes;for(let m=0;m<d.length;m++){const v=d[m];3===v.nodeType&&e.test(i(v.textContent||""))?s.push(v):v.childNodes.length&&s.push(...this._findAllTextNodesWithMatch(e,i,v))}return s}_highlightNode(e,i,r){const s=[],d=this._document;i.lastIndex=0;let v,m=e.textContent||"";do{if(v=r(m).match(i),!v){s.push(d.createTextNode(m));continue}v.index&&(s.push(d.createTextNode(m.substring(0,v.index))),m=m.substring(v.index));const A=d.createElement("strong");A.textContent=m.substring(0,v[0].length),s.push(A),m=m.substring(v[0].length)}while(v);const D=e.parentNode;s.forEach(A=>D.insertBefore(A,e)),D.removeChild(e)}_emitSelectionChangeEvent(e=!1){this.onSelectionChange.emit(new D2(this,e))}}return n.\u0275fac=function(e){return new(e||n)($(Pn),$(si),$(Dr),$(zw,8),$(C2,8))},n.\u0275cmp=kn({type:n,selectors:[["sbb-option"]],hostAttrs:["role","option",1,"sbb-option","sbb-menu-item","sbb-link-reset"],hostVars:12,hostBindings:function(e,i){1&e&&Wt("keydown",function(s){return i._handleKeydown(s)})("click",function(){return i._selectViaInteraction()}),2&e&&(uc("id",i.id),Ht("tabindex",i._getTabIndex())("aria-selected",i._getAriaSelected())("aria-disabled",i.disabled.toString()),Oi("sbb-selected",i.selected)("sbb-option-multiple",i.multiple)("sbb-focused",i.active)("sbb-disabled",i.disabled))},inputs:{value:"value",id:"id",disabled:"disabled"},outputs:{onSelectionChange:"onSelectionChange"},exportAs:["sbbOption"],ngContentSelectors:q$,decls:3,vars:2,consts:[[3,"disabled","state",4,"ngIf"],["class","cdk-visually-hidden",4,"ngIf"],[3,"disabled","state"],[1,"cdk-visually-hidden"]],template:function(e,i){1&e&&(Ro(),cn(0,$$,1,2,"sbb-pseudo-checkbox",0),Lr(1),cn(2,G$,2,1,"span",1)),2&e&&(dt("ngIf",i.multiple),Je(2),dt("ngIf",i.group&&i.group._inert))},dependencies:[na,rG],styles:[".sbb-option.sbb-menu-item{cursor:default}.sbb-pseudo-checkbox{display:inline-block;margin-right:calc(0.5333333333rem * var(--sbb-scaling-factor));margin-bottom:calc(-0.3rem * var(--sbb-scaling-factor));overflow:hidden;line-height:0}.sbb-pseudo-checkbox .sbb-selection-container{margin:0}"],encapsulation:2,changeDetection:0}),n})();function E2(n,t,e,i){return n<e?n:n+t>e+i?Math.max(0,n-i+t):e}let aG=0,lG=(()=>{class n{constructor(){this.id="sbb-option-hint-"+aG++}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=vt({type:n,selectors:[["sbb-option-hint"]],hostAttrs:[1,"sbb-option-hint","sbb-label"],hostVars:1,hostBindings:function(e,i){2&e&&Ht("id",i.id)}}),n})(),Vw=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({imports:[wr,Gi]}),n})();const cG=["*"];let jw;function nv(n){var t;return(null===(t=function uG(){if(void 0===jw&&(jw=null,"undefined"!=typeof window)){const n=window;void 0!==n.trustedTypes&&(jw=n.trustedTypes.createPolicy("sbb-esta#angular",{createHTML:t=>t}))}return jw}())||void 0===t?void 0:t.createHTML(n))||n}function I2(n){return Error(`Unable to find icon with the name "${n}"`)}function M2(n){return Error(`The URL provided to SbbIconRegistry was not trusted as a resource URL via Angular's DomSanitizer. Attempted URL was "${n}".`)}function A2(n){return Error(`The literal provided to SbbIconRegistry was not trusted as safe HTML by Angular's DomSanitizer. Attempted literal was "${n}".`)}class Rp{constructor(t,e,i){this.url=t,this.svgText=e,this.options=i}}let hG=(()=>{class n{constructor(e,i,r,s){this._httpClient=e,this._sanitizer=i,this._errorHandler=s,this._svgIconConfigs=new Map,this._iconSetConfigs=new Map,this._cachedIconsByUrl=new Map,this._inProgressUrlFetches=new Map,this._fontCssClassesByAlias=new Map,this._resolvers=[],this._defaultFontSetClass=["sbb-icons"],this._sbbCdnSupportedNamespaces=["kom","fpl"],this._document=r}addSvgIcon(e,i,r){return this.addSvgIconInNamespace("",e,i,r)}addSvgIconLiteral(e,i,r){return this.addSvgIconLiteralInNamespace("",e,i,r)}addSvgIconInNamespace(e,i,r,s){return this._addSvgIconConfig(e,i,new Rp(r,null,s))}addSvgIconResolver(e){return this._resolvers.push(e),this}addSvgIconLiteralInNamespace(e,i,r,s){const d=this._sanitizer.sanitize(Ar.HTML,r);if(!d)throw A2(r);const m=nv(d);return this._addSvgIconConfig(e,i,new Rp("",m,s))}addSvgIconSet(e,i){return this.addSvgIconSetInNamespace("",e,i)}addSvgIconSetLiteral(e,i){return this.addSvgIconSetLiteralInNamespace("",e,i)}addSvgIconSetInNamespace(e,i,r){return this._addSvgIconSetConfig(e,new Rp(i,null,r))}addSvgIconSetLiteralInNamespace(e,i,r){const s=this._sanitizer.sanitize(Ar.HTML,i);if(!s)throw A2(i);const d=nv(s);return this._addSvgIconSetConfig(e,new Rp("",d,r))}registerFontClassAlias(e,i=e){return this._fontCssClassesByAlias.set(e,i),this}classNameForFontAlias(e){return this._fontCssClassesByAlias.get(e)||e}setDefaultFontSetClass(...e){return this._defaultFontSetClass=e,this}getDefaultFontSetClass(){return this._defaultFontSetClass}getSvgIconFromUrl(e){const i=this._sanitizer.sanitize(Ar.RESOURCE_URL,e);if(!i)throw M2(e);const r=this._cachedIconsByUrl.get(i);return r?ei(Uw(r)):this._loadSvgIconFromConfig(new Rp(e,null)).pipe(jo(s=>this._cachedIconsByUrl.set(i,s)),Hn(s=>Uw(s)))}getNamedSvgIcon(e,i=""){const r=k2(i,e);let s=this._svgIconConfigs.get(r);if(s)return this._getSvgFromConfig(s);if(s=this._getIconConfigFromResolvers(i,e),s)return this._svgIconConfigs.set(r,s),this._getSvgFromConfig(s);const d=this._iconSetConfigs.get(i);return d?this._getSvgFromIconSetConfigs(e,d):qg(I2(r))}ngOnDestroy(){this._resolvers=[],this._svgIconConfigs.clear(),this._iconSetConfigs.clear(),this._cachedIconsByUrl.clear()}_getSvgFromConfig(e){return e.svgText?ei(Uw(this._svgElementFromConfig(e))):this._loadSvgIconFromConfig(e).pipe(Hn(i=>Uw(i)))}_getSvgFromIconSetConfigs(e,i){const r=this._extractIconWithNameFromAnySet(e,i);return r?ei(r):CR(i.filter(d=>!d.svgText).map(d=>this._loadSvgIconSetFromConfig(d).pipe(xp(m=>{const D=`Loading icon set URL: ${this._sanitizer.sanitize(Ar.RESOURCE_URL,d.url)} failed: ${m.message}`;return this._errorHandler.handleError(new Error(D)),ei(null)})))).pipe(Hn(()=>{const d=this._extractIconWithNameFromAnySet(e,i);if(!d)throw I2(e);return d}))}_extractIconWithNameFromAnySet(e,i){for(let r=i.length-1;r>=0;r--){const s=i[r];if(s.svgText&&s.svgText.toString().indexOf(e)>-1){const d=this._svgElementFromConfig(s),m=this._extractSvgIconFromSet(d,e,s.options);if(m)return m}}return null}_loadSvgIconFromConfig(e){return this._fetchIcon(e).pipe(jo(i=>e.svgText=i),Hn(()=>this._svgElementFromConfig(e)))}_loadSvgIconSetFromConfig(e){return e.svgText?ei(null):this._fetchIcon(e).pipe(jo(i=>e.svgText=i))}_extractSvgIconFromSet(e,i,r){const s=e.querySelector(`[id="${i}"]`);if(!s)return null;const d=s.cloneNode(!0);if(d.removeAttribute("id"),"svg"===d.nodeName.toLowerCase())return this._setSvgAttributes(d,r);if("symbol"===d.nodeName.toLowerCase())return this._setSvgAttributes(this._toSvgElement(d),r);const m=this._svgElementFromString(nv("<svg></svg>"));return m.appendChild(d),this._setSvgAttributes(m,r)}_svgElementFromString(e){const i=this._document.createElement("DIV");i.innerHTML=e;const r=i.querySelector("svg");if(!r)throw Error("<svg> tag not found");return r}_toSvgElement(e){const i=this._svgElementFromString(nv("<svg></svg>")),r=e.attributes;for(let s=0;s<r.length;s++){const{name:d,value:m}=r[s];"id"!==d&&i.setAttribute(d,m)}for(let s=0;s<e.childNodes.length;s++)e.childNodes[s].nodeType===this._document.ELEMENT_NODE&&i.appendChild(e.childNodes[s].cloneNode(!0));return i}_setSvgAttributes(e,i){return e.setAttribute("fit",""),e.setAttribute("preserveAspectRatio","xMidYMid meet"),e.setAttribute("focusable","false"),i&&i.viewBox&&e.setAttribute("viewBox",i.viewBox),e}_fetchIcon(e){var i;const{url:r,options:s}=e,d=null!==(i=null==s?void 0:s.withCredentials)&&void 0!==i&&i;if(!this._httpClient)throw function dG(){return Error("Could not find HttpClient provider for use with Sbb Angular icons. Please include the HttpClientModule from @angular/common/http in your app imports.")}();if(null==r)throw Error(`Cannot fetch icon from URL "${r}".`);const m=this._sanitizer.sanitize(Ar.RESOURCE_URL,r);if(!m)throw M2(r);const v=this._inProgressUrlFetches.get(m);if(v)return v;const D=this._httpClient.get(m,{responseType:"text",withCredentials:d}).pipe(Hn(A=>nv(A)),nw(()=>this._inProgressUrlFetches.delete(m)),yc());return this._inProgressUrlFetches.set(m,D),D}_addSvgIconConfig(e,i,r){return this._svgIconConfigs.set(k2(e,i),r),this}_addSvgIconSetConfig(e,i){const r=this._iconSetConfigs.get(e);return r?r.push(i):this._iconSetConfigs.set(e,[i]),this}_svgElementFromConfig(e){if(!e.svgElement){const i=this._svgElementFromString(e.svgText);this._setSvgAttributes(i,e.options),e.svgElement=i}return e.svgElement}_getIconConfigFromResolvers(e,i){for(let r=0;r<this._resolvers.length;r++){const s=this._resolvers[r](i,e);if(s)return pG(s)?new Rp(s.url,null,s.options):new Rp(s,null)}if(-1!==this._sbbCdnSupportedNamespaces.indexOf(e)){const r=this._sanitizer.bypassSecurityTrustResourceUrl(`https://icons.app.sbb.ch/${e}/${i}.svg`);return new Rp(r,null)}}}return n.\u0275fac=function(e){return new(e||n)(Be(bR,8),Be(vk),Be(si,8),Be(va))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function Uw(n){return n.cloneNode(!0)}function k2(n,t){return n+":"+t}function pG(n){return!(!n.url||!n.options)}const fG=new bt("sbb-icon-location",{providedIn:"root",factory:function mG(){const n=Mn(si),t=n?n.location:null;return{getPathname:()=>t?t.pathname+t.search:""}}}),R2=["clip-path","color-profile","src","cursor","fill","filter","marker","marker-start","marker-mid","marker-end","mask","stroke"],gG=R2.map(n=>`[${n}]`).join(", "),bG=/^url\(['"]?#(.*?)['"]?\)$/;let Xa=(()=>{class n{constructor(e,i,r,s,d){this._elementRef=e,this._iconRegistry=i,this._location=s,this._errorHandler=d,this._inline=!1,this._previousFontSetClass=[],this._currentIconFetch=me.EMPTY,r||this._elementRef.nativeElement.setAttribute("aria-hidden","true")}get inline(){return this._inline}set inline(e){this._inline=Qn(e)}get svgIcon(){return this._svgIcon}set svgIcon(e){e!==this._svgIcon&&(e?this._updateSvgIcon(e):this._svgIcon&&this._clearSvgElement(),this._svgIcon=e)}get fontSet(){return this._fontSet}set fontSet(e){const i=this._cleanupFontValue(e);i!==this._fontSet&&(this._fontSet=i,this._updateFontIconClasses())}get fontIcon(){return this._fontIcon}set fontIcon(e){const i=this._cleanupFontValue(e);i!==this._fontIcon&&(this._fontIcon=i,this._updateFontIconClasses())}_splitIconName(e){if(!e)return["",""];const i=e.split(":");switch(i.length){case 1:return["",i[0]];case 2:return i;default:throw Error(`Invalid icon name: "${e}"`)}}ngOnInit(){this._updateFontIconClasses()}ngAfterViewChecked(){const e=this._elementsWithExternalReferences;if(e&&e.size){const i=this._location.getPathname();i!==this._previousPath&&(this._previousPath=i,this._prependPathToReferences(i))}}ngOnDestroy(){this._currentIconFetch.unsubscribe(),this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear()}_usingFontIcon(){return!this.svgIcon}_setSvgElement(e){this._clearSvgElement();const i=this._location.getPathname();this._previousPath=i,this._cacheChildrenWithExternalReferences(e),this._prependPathToReferences(i),this._elementRef.nativeElement.appendChild(e)}_clearSvgElement(){const e=this._elementRef.nativeElement;let i=e.childNodes.length;for(this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear();i--;){const r=e.childNodes[i];(1!==r.nodeType||"svg"===r.nodeName.toLowerCase())&&r.remove()}}_updateFontIconClasses(){if(!this._usingFontIcon())return;const e=this._elementRef.nativeElement,i=(this.fontSet?[this._iconRegistry.classNameForFontAlias(this.fontSet)]:this._iconRegistry.getDefaultFontSetClass()).filter(r=>r.length>0);this._previousFontSetClass.forEach(r=>e.classList.remove(r)),i.forEach(r=>e.classList.add(r)),this._previousFontSetClass=i,this.fontIcon!==this._previousFontIconClass&&(this._previousFontIconClass&&e.classList.remove(this._previousFontIconClass),this.fontIcon&&e.classList.add(this.fontIcon),this._previousFontIconClass=this.fontIcon)}_cleanupFontValue(e){return"string"==typeof e?e.trim().split(" ")[0]:e}_prependPathToReferences(e){const i=this._elementsWithExternalReferences;i&&i.forEach((r,s)=>{r.forEach(d=>{s.setAttribute(d.name,`url('${e}#${d.value}')`)})})}_cacheChildrenWithExternalReferences(e){const i=e.querySelectorAll(gG),r=this._elementsWithExternalReferences=this._elementsWithExternalReferences||new Map;for(let s=0;s<i.length;s++)R2.forEach(d=>{const m=i[s],v=m.getAttribute(d),D=v?v.match(bG):null;if(D){let A=r.get(m);A||(A=[],r.set(m,A)),A.push({name:d,value:D[1]})}})}_updateSvgIcon(e){if(this._svgNamespace=null,this._svgName=null,this._currentIconFetch.unsubscribe(),e){const[i,r]=this._splitIconName(e);i&&(this._svgNamespace=i),r&&(this._svgName=r),this._currentIconFetch=this._iconRegistry.getNamedSvgIcon(r,i).pipe(Hr(1)).subscribe(s=>this._setSvgElement(s),s=>{this._errorHandler.handleError(new Error(`Error retrieving icon ${i}:${r}! ${s.message}`))})}}}return n.\u0275fac=function(e){return new(e||n)($(Pn),$(hG),Vr("aria-hidden"),$(fG),$(va))},n.\u0275cmp=kn({type:n,selectors:[["sbb-icon"]],hostAttrs:["role","img",1,"sbb-icon","notranslate"],hostVars:5,hostBindings:function(e,i){2&e&&(Ht("data-sbb-icon-type",i._usingFontIcon()?"font":"svg")("data-sbb-icon-name",i._svgName||i.fontIcon)("data-sbb-icon-namespace",i._svgNamespace||i.fontSet),Oi("sbb-icon-inline",i.inline))},inputs:{color:"color",inline:"inline",svgIcon:"svgIcon",fontSet:"fontSet",fontIcon:"fontIcon"},exportAs:["sbbIcon"],ngContentSelectors:cG,decls:1,vars:0,template:function(e,i){1&e&&(Ro(),Lr(0))},styles:[".sbb-icon{background-repeat:no-repeat;display:inline-block;line-height:0;overflow:hidden}.sbb-icon svg:not(.color-immutable) [fill]:not([fill=none]){fill:currentColor}.sbb-icon svg:not(.color-immutable) [stroke]:not([stroke=none]){stroke:currentColor}.sbb-icon svg:not(.color-immutable)>:where(path,polygon,polyline):where(:not([stroke]):not([fill])),.sbb-icon svg:not(.color-immutable) :where(:not([stroke]):not([fill])) :where(path,polygon,polyline):where(:not([stroke]):not([fill])){fill:currentColor}.sbb-icon.sbb-icon-inline{vertical-align:middle;margin-block-start:calc(-.2666666667rem*var(--sbb-scaling-factor));margin-block-end:calc(-.1333333333rem*var(--sbb-scaling-factor))}:where(.sbb-icon-fit) .sbb-icon,.sbb-icon:where(.sbb-icon-fit),:where(.sbb-icon-fit,.sbb-icon-scaled) .sbb-icon svg,.sbb-icon:where(.sbb-icon-fit,.sbb-icon-scaled) svg{width:100%;height:100%}:where(.sbb-icon-scaled) .sbb-icon,.sbb-icon:where(.sbb-icon-scaled){width:var(--sbb-icon-size-default);height:var(--sbb-icon-size-default)}"],encapsulation:2,changeDetection:0}),n})(),bo=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({imports:[Gi]}),n})();const _G=["body"];function yG(n,t){}const vG=[[["sbb-expansion-panel-header"]],"*"],xG=["sbb-expansion-panel-header","*"];function wG(n,t){1&n&&qn(0,"sbb-icon",5),2&n&&dt("@indicatorRotate",Fn(2)._getExpandedState())}function SG(n,t){1&n&&qn(0,"sbb-icon",9)}function CG(n,t){1&n&&qn(0,"sbb-icon",10)}function TG(n,t){1&n&&(Fd(0,6),cn(1,SG,1,0,"sbb-icon",7),cn(2,CG,1,0,"sbb-icon",8),Nd()),2&n&&(dt("ngSwitch",Fn(2)._isExpanded()),Je(1),dt("ngSwitchCase",!1),Je(1),dt("ngSwitchCase",!0))}function DG(n,t){1&n&&(Ee(0,"span",2),kg(1,"async"),cn(2,wG,1,1,"sbb-icon",3),cn(3,TG,3,3,"ng-container",4),Pe()),2&n&&(dt("ngSwitch",Rg(1,3,Fn().panel.variant)),Je(2),dt("ngSwitchCase","lean"),Je(1),dt("ngSwitchCase","standard"))}const EG=["*"],GD=new bt("SBB_ACCORDION"),P2="225ms cubic-bezier(0.4,0.0,0.2,1)",O2={indicatorRotate:ks("indicatorRotate",[gr("collapsed, void",Nn({transform:"rotate(90deg)"})),gr("expanded",Nn({transform:"rotate(-90deg)"})),$i("expanded <=> collapsed, void => collapsed",Yi(P2))]),bodyExpansion:ks("bodyExpansion",[gr("collapsed, void",Nn({height:"0px",visibility:"hidden"})),gr("expanded",Nn({height:"*",visibility:"visible"})),$i("expanded <=> collapsed, void => collapsed",Yi(P2))])},L2=new bt("SBB_EXPANSION_PANEL");let IG=(()=>{class n{constructor(e,i){this._template=e,this._expansionPanel=i}}return n.\u0275fac=function(e){return new(e||n)($(eo),$(L2,8))},n.\u0275dir=vt({type:n,selectors:[["ng-template","sbbExpansionPanelContent",""]]}),n})();const MG=sm(H8);let AG=0,am=(()=>{class n extends MG{constructor(e,i,r,s,d){super(i,r,s),this._viewContainerRef=e,this._hideToggle=!1,this.afterExpand=new Xt,this.afterCollapse=new Xt,this._inputChanges=new Qt,this._headerId="sbb-expansion-panel-header-"+AG++,this._bodyAnimationDone=new Qt,this.accordion=i,this._document=d,this._bodyAnimationDone.pipe(Ap((m,v)=>m.fromState===v.fromState&&m.toState===v.toState)).subscribe(m=>{"void"!==m.fromState&&("expanded"===m.toState?this.afterExpand.emit():"collapsed"===m.toState&&this.afterCollapse.emit())})}get hideToggle(){return this._hideToggle||this.accordion&&this.accordion.hideToggle}set hideToggle(e){this._hideToggle=Qn(e)}_getExpandedState(){return this.expanded?"expanded":"collapsed"}toggle(){this.expanded=!this.expanded}close(){this.expanded=!1}open(){this.expanded=!0}ngAfterContentInit(){this._lazyContent&&this._lazyContent._expansionPanel===this&&this.opened.pipe(Us(null),Er(()=>this.expanded&&!this._portal),Hr(1)).subscribe(()=>{this._portal=new em(this._lazyContent._template,this._viewContainerRef)})}ngOnChanges(e){this._inputChanges.next(e)}ngOnDestroy(){super.ngOnDestroy(),this._bodyAnimationDone.complete(),this._inputChanges.complete()}_containsFocus(){if(this._body){const e=this._document.activeElement,i=this._body.nativeElement;return e===i||i.contains(e)}return!1}}return n.\u0275fac=function(e){return new(e||n)($(Vo),$(GD,12),$(Dr),$(SD),$(si))},n.\u0275cmp=kn({type:n,selectors:[["sbb-expansion-panel"]],contentQueries:function(e,i,r){if(1&e&&Ur(r,IG,5),2&e){let s;zn(s=Vn())&&(i._lazyContent=s.first)}},viewQuery:function(e,i){if(1&e&&mr(_G,5),2&e){let r;zn(r=Vn())&&(i._body=r.first)}},hostAttrs:[1,"sbb-expansion-panel"],hostVars:2,hostBindings:function(e,i){2&e&&Oi("sbb-expanded",i.expanded)},inputs:{disabled:"disabled",expanded:"expanded",hideToggle:"hideToggle"},outputs:{afterExpand:"afterExpand",afterCollapse:"afterCollapse"},exportAs:["sbbExpansionPanel"],features:[Kn([{provide:GD,useValue:void 0},{provide:L2,useExisting:n}]),ut,dr],ngContentSelectors:xG,decls:6,vars:4,consts:[["role","region",1,"sbb-expansion-panel-content",3,"id"],["body",""],[1,"sbb-expansion-panel-body","sbb-expansion-panel-horizontal-padding"],[3,"cdkPortalOutlet"]],template:function(e,i){1&e&&(Ro(vG),Lr(0),Ee(1,"div",0,1),Wt("@bodyExpansion.done",function(s){return i._bodyAnimationDone.next(s)}),Ee(3,"div",2),Lr(4,1),cn(5,yG,0,0,"ng-template",3),Pe()()),2&e&&(Je(1),dt("@bodyExpansion",i._getExpandedState())("id",i.id),Ht("aria-labelledby",i._headerId),Je(4),dt("cdkPortalOutlet",i._portal))},dependencies:[Hu],styles:['.sbb-expansion-panel{box-sizing:content-box;display:block;margin:0;transition:border-color var(--sbb-transition-fast-start);border:var(--sbb-border-width-thin) solid var(--sbb-color-milk)}.sbb-expansion-panel+.sbb-expansion-panel{margin-top:calc(var(--sbb-border-width-thin)*2)}.sbb-expansion-panel.sbb-expanded{border-color:var(--sbb-color-cloud)}.sbb-expansion-panel.sbb-expanded.sbb-expansion-panel-full-width{border-left-color:rgba(0,0,0,0);border-right-color:rgba(0,0,0,0);border-left-width:0;border-right-width:0;padding-left:var(--sbb-border-width-thin);padding-right:var(--sbb-border-width-thin)}.sbb-expansion-panel-horizontal-padding{padding-left:calc(var(--sbb-expansion-panel-padding-horizontal) - var(--sbb-border-width-thin));padding-right:calc(var(--sbb-expansion-panel-padding-horizontal) - var(--sbb-border-width-thin))}.sbb-expansion-panel-header{cursor:pointer;display:flex;align-items:center;position:relative;background-color:var(--sbb-color-milk);outline:none;padding-top:var(--sbb-expansion-panel-header-padding-top);padding-bottom:var(--sbb-expansion-panel-header-padding-bottom)}:where(html.sbb-lean) .sbb-expansion-panel-header{padding-bottom:calc(0.8rem - var(--sbb-border-width-thin))}.sbb-expansion-panel-header.sbb-expanded::after{content:"";display:block;position:absolute;height:0;bottom:0;width:calc(100% - var(--sbb-expansion-panel-padding-horizontal)*2 + var(--sbb-border-width-thin)*2);left:calc(var(--sbb-expansion-panel-padding-horizontal) - var(--sbb-border-width-thin));border-bottom:var(--sbb-border-width-thin) solid var(--sbb-color-cloud)}.sbb-expansion-panel-header:is(.sbb-expanded,.sbb-expanded:is(:focus,:hover)){background:inherit}.sbb-expansion-panel-header.sbb-disabled{cursor:default;opacity:.75}.sbb-expansion-panel-header-indicator{flex:0 0 auto;line-height:0;height:var(--sbb-icon-size-default);width:var(--sbb-icon-size-default);margin-left:1.6rem;color:var(--sbb-color-black);margin-top:-0.5em;margin-bottom:-0.5em}:where(html:not(.sbb-lean)) .sbb-expansion-panel-header-indicator{border:var(--sbb-border-width-thin) solid var(--sbb-color-storm);border-radius:50%;padding:calc(0.2666666667rem * var(--sbb-scaling-factor) - var(--sbb-border-width-thin))}@media all and (min-width: 40.1875em)and (max-width: 64.0525em){:where(html:not(.sbb-lean)) .sbb-expansion-panel-header-indicator{margin-left:2.6666666667rem}}@media all and (min-width: 40.1875em){:where(html:not(.sbb-lean)) .sbb-expansion-panel-header-indicator{height:calc(2.1333333333rem * var(--sbb-scaling-factor));width:calc(2.1333333333rem * var(--sbb-scaling-factor))}}@media all and (min-width: 160.0625em){:where(html:not(.sbb-lean)) .sbb-expansion-panel-header-indicator{margin-left:2.4rem}}@media all and (min-width: 240.0625em){:where(html:not(.sbb-lean)) .sbb-expansion-panel-header-indicator{margin-left:2.9333333333rem}}.sbb-expansion-panel-header-content{display:flex;flex:1;overflow:hidden;font-family:var(--sbb-font-light);font-size:var(--sbb-font-size-large);line-height:var(--sbb-expansion-panel-line-height)}.sbb-expansion-panel-content{display:flex;flex-direction:column;overflow:visible}.sbb-expansion-panel-content[style*="visibility: hidden"] *{visibility:hidden !important}.sbb-expansion-panel-content.ng-animating,.sbb-expansion-panel:not(.sbb-expanded) .sbb-expansion-panel-content{overflow:hidden}.sbb-expansion-panel-body{font-size:var(--sbb-font-size);line-height:var(--sbb-line-height);padding-top:var(--sbb-divider-medium);padding-bottom:var(--sbb-divider-medium)}.sbb-expansion-panel-body>*:first-child{margin-top:0}'],encapsulation:2,data:{animation:[O2.bodyExpansion]},changeDetection:0}),n})();const RG=ib(class kG{});let Hw=(()=>{class n extends RG{constructor(e,i,r,s,d,m){super(),this.panel=e,this._element=i,this._focusMonitor=r,this._changeDetectorRef=s,this._document=d,this._parentChangeSubscription=me.EMPTY;const v=e.accordion?e.accordion._stateChanges.pipe(Er(D=>!!D.hideToggle)):Vt;this.tabIndex=parseInt(m||"",10)||0,this._parentChangeSubscription=rr(e.opened,e.closed,v,e._inputChanges.pipe(Er(D=>!(!D.hideToggle&&!D.disabled)))).subscribe(()=>this._changeDetectorRef.markForCheck()),e.closed.pipe(Er(()=>e._containsFocus())).subscribe(()=>r.focusVia(i,"program"))}get disabled(){return this.panel.disabled}_toggle(){this.disabled||this.panel.toggle()}_isExpanded(){return this.panel.expanded}_getExpandedState(){return this.panel._getExpandedState()}_getPanelId(){return this.panel.id}_showToggle(){return!this.panel.hideToggle&&!this.panel.disabled}_keydown(e){switch(e.keyCode){case 32:case 13:!aa(e)&&this._isFocused()&&(e.preventDefault(),this._toggle());break;default:return void(this.panel.accordion&&this.panel.accordion._handleHeaderKeydown(e))}}focus(e,i){e?this._focusMonitor.focusVia(this._element,e,i):this._element.nativeElement.focus(i)}ngAfterViewInit(){this._focusMonitor.monitor(this._element).subscribe(e=>{e&&this.panel.accordion&&this.panel.accordion._handleHeaderFocus(this)})}ngOnDestroy(){this._parentChangeSubscription.unsubscribe(),this._focusMonitor.stopMonitoring(this._element)}_isFocused(){var e;return(null===(e=this._document)||void 0===e?void 0:e.activeElement)===this._element.nativeElement}}return n.\u0275fac=function(e){return new(e||n)($(am,1),$(Pn),$(Da),$(Dr),$(si),Vr("tabindex"))},n.\u0275cmp=kn({type:n,selectors:[["sbb-expansion-panel-header"]],hostAttrs:["role","button",1,"sbb-expansion-panel-header","sbb-expansion-panel-horizontal-padding"],hostVars:9,hostBindings:function(e,i){1&e&&Wt("click",function(){return i._toggle()})("keydown",function(s){return i._keydown(s)}),2&e&&(Ht("id",i.panel._headerId)("tabindex",i.tabIndex)("aria-controls",i._getPanelId())("aria-expanded",i._isExpanded())("aria-disabled",i.disabled),Oi("sbb-expanded",i._isExpanded())("sbb-disabled",i.disabled))},inputs:{tabIndex:"tabIndex"},features:[ut],ngContentSelectors:EG,decls:3,vars:1,consts:[[1,"sbb-expansion-panel-header-content"],["class","sbb-expansion-panel-header-indicator sbb-icon-fit",3,"ngSwitch",4,"ngIf"],[1,"sbb-expansion-panel-header-indicator","sbb-icon-fit",3,"ngSwitch"],["svgIcon","kom:chevron-right-small",4,"ngSwitchCase"],[3,"ngSwitch",4,"ngSwitchCase"],["svgIcon","kom:chevron-right-small"],[3,"ngSwitch"],["svgIcon","kom:plus-small",4,"ngSwitchCase"],["svgIcon","kom:minus-small",4,"ngSwitchCase"],["svgIcon","kom:plus-small"],["svgIcon","kom:minus-small"]],template:function(e,i){1&e&&(Ro(),Ee(0,"span",0),Lr(1),Pe(),cn(2,DG,4,5,"span",1)),2&e&&(Je(2),dt("ngIf",i._showToggle()))},dependencies:[na,zg,vx,Xa,vy],encapsulation:2,data:{animation:[O2.indicatorRotate]},changeDetection:0}),n})(),qD=(()=>{class n extends j8{constructor(){super(...arguments),this._ownHeaders=new Bf,this._hideToggle=!1}get hideToggle(){return this._hideToggle}set hideToggle(e){this._hideToggle=Qn(e)}ngAfterContentInit(){this._headers.changes.pipe(Us(this._headers)).subscribe(e=>{this._ownHeaders.reset(e.filter(i=>i.panel.accordion===this)),this._ownHeaders.notifyOnChanges()}),this._keyManager=new BD(this._ownHeaders).withWrap().withHomeAndEnd()}_handleHeaderKeydown(e){this._keyManager.onKeydown(e)}_handleHeaderFocus(e){this._keyManager.updateActiveItem(e)}ngOnDestroy(){super.ngOnDestroy(),this._ownHeaders.destroy()}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=ui(n)))(i||n)}}(),n.\u0275dir=vt({type:n,selectors:[["sbb-accordion"]],contentQueries:function(e,i,r){if(1&e&&Ur(r,Hw,5),2&e){let s;zn(s=Vn())&&(i._headers=s)}},hostAttrs:[1,"sbb-accordion"],inputs:{hideToggle:"hideToggle"},exportAs:["sbbAccordion"],features:[Kn([{provide:GD,useExisting:n}]),ut]}),n})(),F2=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({imports:[wr,$8,sa,Gi,bo]}),n})();const PG=["addListener","removeListener"],OG=["addEventListener","removeEventListener"],LG=["on","off"];function nu(n,t,e,i){if(Fe(e)&&(i=e,e=void 0),i)return nu(n,t,e).pipe(mT(i));const[r,s]=function BG(n){return Fe(n.addEventListener)&&Fe(n.removeEventListener)}(n)?OG.map(d=>m=>n[d](t,m,e)):function FG(n){return Fe(n.addListener)&&Fe(n.removeListener)}(n)?PG.map(N2(n,t)):function NG(n){return Fe(n.on)&&Fe(n.off)}(n)?LG.map(N2(n,t)):[];if(!r&&Oe(n))return ke(d=>nu(d,t,e))(li(n));if(!r)throw new TypeError("Invalid event target");return new en(d=>{const m=(...v)=>d.next(1<v.length?v:v[0]);return r(m),()=>s(m)})}function N2(n,t){return e=>i=>n[e](t,i)}const iv={schedule(n){let t=requestAnimationFrame,e=cancelAnimationFrame;const{delegate:i}=iv;i&&(t=i.requestAnimationFrame,e=i.cancelAnimationFrame);const r=t(s=>{e=void 0,n(s)});return new me(()=>null==e?void 0:e(r))},requestAnimationFrame(...n){const{delegate:t}=iv;return((null==t?void 0:t.requestAnimationFrame)||requestAnimationFrame)(...n)},cancelAnimationFrame(...n){const{delegate:t}=iv;return((null==t?void 0:t.cancelAnimationFrame)||cancelAnimationFrame)(...n)},delegate:void 0};new class VG extends OD{flush(t){this._active=!0;const e=this._scheduled;this._scheduled=void 0;const{actions:i}=this;let r;t=t||i.shift();do{if(r=t.execute(t.state,t.delay))break}while((t=i[0])&&t.id===e&&i.shift());if(this._active=!1,r){for(;(t=i[0])&&t.id===e&&i.shift();)t.unsubscribe();throw r}}}(class zG extends PD{constructor(t,e){super(t,e),this.scheduler=t,this.work=e}requestAsyncId(t,e,i=0){return null!==i&&i>0?super.requestAsyncId(t,e,i):(t.actions.push(this),t._scheduled||(t._scheduled=iv.requestAnimationFrame(()=>t.flush(void 0))))}recycleAsyncId(t,e,i=0){if(null!=i&&i>0||null==i&&this.delay>0)return super.recycleAsyncId(t,e,i);t.actions.some(r=>r.id===e)||(iv.cancelAnimationFrame(e),t._scheduled=void 0)}});let WD,UG=1;const $w={};function B2(n){return n in $w&&(delete $w[n],!0)}const HG={setImmediate(n){const t=UG++;return $w[t]=!0,WD||(WD=Promise.resolve()),WD.then(()=>B2(t)&&n()),t},clearImmediate(n){B2(n)}},{setImmediate:$G,clearImmediate:GG}=HG,Gw={setImmediate(...n){const{delegate:t}=Gw;return((null==t?void 0:t.setImmediate)||$G)(...n)},clearImmediate(n){const{delegate:t}=Gw;return((null==t?void 0:t.clearImmediate)||GG)(n)},delegate:void 0};new class WG extends OD{flush(t){this._active=!0;const e=this._scheduled;this._scheduled=void 0;const{actions:i}=this;let r;t=t||i.shift();do{if(r=t.execute(t.state,t.delay))break}while((t=i[0])&&t.id===e&&i.shift());if(this._active=!1,r){for(;(t=i[0])&&t.id===e&&i.shift();)t.unsubscribe();throw r}}}(class qG extends PD{constructor(t,e){super(t,e),this.scheduler=t,this.work=e}requestAsyncId(t,e,i=0){return null!==i&&i>0?super.requestAsyncId(t,e,i):(t.actions.push(this),t._scheduled||(t._scheduled=Gw.setImmediate(t.flush.bind(t,void 0))))}recycleAsyncId(t,e,i=0){if(null!=i&&i>0||null==i&&this.delay>0)return super.recycleAsyncId(t,e,i);t.actions.some(r=>r.id===e)||(Gw.clearImmediate(e),t._scheduled=void 0)}});function XD(n=0,t,e=c$){let i=-1;return null!=t&&(An(t)?e=t:i=t),new en(r=>{let s=function YG(n){return n instanceof Date&&!isNaN(n)}(n)?+n-e.now():n;s<0&&(s=0);let d=0;return e.schedule(function(){r.closed||(r.next(d++),0<=i?this.schedule(void 0,i):r.complete())},s)})}function z2(n,t=Rw){return function ZG(n){return di((t,e)=>{let i=!1,r=null,s=null,d=!1;const m=()=>{if(null==s||s.unsubscribe(),s=null,i){i=!1;const D=r;r=null,e.next(D)}d&&e.complete()},v=()=>{s=null,d&&e.complete()};t.subscribe(Tt(e,D=>{i=!0,r=D,s||li(n(D)).subscribe(s=Tt(e,m,v))},()=>{d=!0,(!i||!s||s.closed)&&e.complete()}))})}(()=>XD(n,t))}const QG=new bt("cdk-dir-doc",{providedIn:"root",factory:function KG(){return Mn(si)}}),JG=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;let Pp=(()=>{class n{constructor(e){if(this.value="ltr",this.change=new Xt,e){const r=e.documentElement?e.documentElement.dir:null;this.value=function eq(n){const t=(null==n?void 0:n.toLowerCase())||"";return"auto"===t&&"undefined"!=typeof navigator&&(null==navigator?void 0:navigator.language)?JG.test(navigator.language)?"rtl":"ltr":"rtl"===t?"rtl":"ltr"}((e.body?e.body.dir:null)||r||"ltr")}}ngOnDestroy(){this.change.complete()}}return n.\u0275fac=function(e){return new(e||n)(Be(QG,8))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),qw=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({}),n})(),V2=(()=>{class n{constructor(e,i,r){this._ngZone=e,this._platform=i,this._scrolled=new Qt,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=r}register(e){this.scrollContainers.has(e)||this.scrollContainers.set(e,e.elementScrolled().subscribe(()=>this._scrolled.next(e)))}deregister(e){const i=this.scrollContainers.get(e);i&&(i.unsubscribe(),this.scrollContainers.delete(e))}scrolled(e=20){return this._platform.isBrowser?new en(i=>{this._globalSubscription||this._addGlobalListener();const r=e>0?this._scrolled.pipe(z2(e)).subscribe(i):this._scrolled.subscribe(i);return this._scrolledCount++,()=>{r.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):ei()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((e,i)=>this.deregister(i)),this._scrolled.complete()}ancestorScrolled(e,i){const r=this.getAncestorScrollContainers(e);return this.scrolled(i).pipe(Er(s=>!s||r.indexOf(s)>-1))}getAncestorScrollContainers(e){const i=[];return this.scrollContainers.forEach((r,s)=>{this._scrollableContainsElement(s,e)&&i.push(s)}),i}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(e,i){let r=Jf(i),s=e.getElementRef().nativeElement;do{if(r==s)return!0}while(r=r.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>nu(this._getWindow().document,"scroll").subscribe(()=>this._scrolled.next()))}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}}return n.\u0275fac=function(e){return new(e||n)(Be(oi),Be(_s),Be(si,8))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),$u=(()=>{class n{constructor(e,i,r){this._platform=e,this._change=new Qt,this._changeListener=s=>{this._change.next(s)},this._document=r,i.runOutsideAngular(()=>{if(e.isBrowser){const s=this._getWindow();s.addEventListener("resize",this._changeListener),s.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){const e=this._getWindow();e.removeEventListener("resize",this._changeListener),e.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();const e={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),e}getViewportRect(){const e=this.getViewportScrollPosition(),{width:i,height:r}=this.getViewportSize();return{top:e.top,left:e.left,bottom:e.top+r,right:e.left+i,height:r,width:i}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};const e=this._document,i=this._getWindow(),r=e.documentElement,s=r.getBoundingClientRect();return{top:-s.top||e.body.scrollTop||i.scrollY||r.scrollTop||0,left:-s.left||e.body.scrollLeft||i.scrollX||r.scrollLeft||0}}change(e=20){return e>0?this._change.pipe(z2(e)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){const e=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:e.innerWidth,height:e.innerHeight}:{width:0,height:0}}}return n.\u0275fac=function(e){return new(e||n)(Be(_s),Be(oi),Be(si,8))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),lm=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({}),n})(),ZD=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({imports:[qw,lm,qw,lm]}),n})();const j2=X8();class rq{constructor(t,e){this._viewportRuler=t,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=e}attach(){}enable(){if(this._canBeEnabled()){const t=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=t.style.left||"",this._previousHTMLStyles.top=t.style.top||"",t.style.left=bs(-this._previousScrollPosition.left),t.style.top=bs(-this._previousScrollPosition.top),t.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){const t=this._document.documentElement,i=t.style,r=this._document.body.style,s=i.scrollBehavior||"",d=r.scrollBehavior||"";this._isEnabled=!1,i.left=this._previousHTMLStyles.left,i.top=this._previousHTMLStyles.top,t.classList.remove("cdk-global-scrollblock"),j2&&(i.scrollBehavior=r.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),j2&&(i.scrollBehavior=s,r.scrollBehavior=d)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;const e=this._document.body,i=this._viewportRuler.getViewportSize();return e.scrollHeight>i.height||e.scrollWidth>i.width}}class oq{constructor(t,e,i,r){this._scrollDispatcher=t,this._ngZone=e,this._viewportRuler=i,this._config=r,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(t){this._overlayRef=t}enable(){if(this._scrollSubscription)return;const t=this._scrollDispatcher.scrolled(0);this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=t.subscribe(()=>{const e=this._viewportRuler.getViewportScrollPosition().top;Math.abs(e-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=t.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}class U2{enable(){}disable(){}attach(){}}function YD(n,t){return t.some(e=>n.bottom<e.top||n.top>e.bottom||n.right<e.left||n.left>e.right)}function H2(n,t){return t.some(e=>n.top<e.top||n.bottom>e.bottom||n.left<e.left||n.right>e.right)}class sq{constructor(t,e,i,r){this._scrollDispatcher=t,this._viewportRuler=e,this._ngZone=i,this._config=r,this._scrollSubscription=null}attach(t){this._overlayRef=t}enable(){this._scrollSubscription||(this._scrollSubscription=this._scrollDispatcher.scrolled(this._config?this._config.scrollThrottle:0).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){const e=this._overlayRef.overlayElement.getBoundingClientRect(),{width:i,height:r}=this._viewportRuler.getViewportSize();YD(e,[{width:i,height:r,bottom:r,right:i,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}}))}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}let aq=(()=>{class n{constructor(e,i,r,s){this._scrollDispatcher=e,this._viewportRuler=i,this._ngZone=r,this.noop=()=>new U2,this.close=d=>new oq(this._scrollDispatcher,this._ngZone,this._viewportRuler,d),this.block=()=>new rq(this._viewportRuler,this._document),this.reposition=d=>new sq(this._scrollDispatcher,this._viewportRuler,this._ngZone,d),this._document=s}}return n.\u0275fac=function(e){return new(e||n)(Be(V2),Be($u),Be(oi),Be(si))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class cm{constructor(t){if(this.scrollStrategy=new U2,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,t){const e=Object.keys(t);for(const i of e)void 0!==t[i]&&(this[i]=t[i])}}}class lq{constructor(t,e){this.connectionPair=t,this.scrollableViewProperties=e}}class Op{constructor(t,e,i,r,s,d,m,v,D,A=!1){this._portalOutlet=t,this._host=e,this._pane=i,this._config=r,this._ngZone=s,this._keyboardDispatcher=d,this._document=m,this._location=v,this._outsideClickDispatcher=D,this._animationsDisabled=A,this._backdropElement=null,this._backdropClick=new Qt,this._attachments=new Qt,this._detachments=new Qt,this._locationChanges=me.EMPTY,this._backdropClickHandler=L=>this._backdropClick.next(L),this._backdropTransitionendHandler=L=>{this._disposeBackdrop(L.target)},this._keydownEvents=new Qt,this._outsidePointerEvents=new Qt,r.scrollStrategy&&(this._scrollStrategy=r.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=r.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(t){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);const e=this._portalOutlet.attach(t);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe(Hr(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),e}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();const t=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),t}dispose(){var t;const e=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),null===(t=this._host)||void 0===t||t.remove(),this._previousHostParent=this._pane=this._host=null,e&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(t){t!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=t,this.hasAttached()&&(t.attach(this),this.updatePosition()))}updateSize(t){this._config=Object.assign(Object.assign({},this._config),t),this._updateElementSize()}setDirection(t){this._config=Object.assign(Object.assign({},this._config),{direction:t}),this._updateElementDirection()}addPanelClass(t){this._pane&&this._toggleClasses(this._pane,t,!0)}removePanelClass(t){this._pane&&this._toggleClasses(this._pane,t,!1)}getDirection(){const t=this._config.direction;return t?"string"==typeof t?t:t.value:"ltr"}updateScrollStrategy(t){t!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=t,this.hasAttached()&&(t.attach(this),t.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;const t=this._pane.style;t.width=bs(this._config.width),t.height=bs(this._config.height),t.minWidth=bs(this._config.minWidth),t.minHeight=bs(this._config.minHeight),t.maxWidth=bs(this._config.maxWidth),t.maxHeight=bs(this._config.maxHeight)}_togglePointerEvents(t){this._pane.style.pointerEvents=t?"":"none"}_attachBackdrop(){const t="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._animationsDisabled&&this._backdropElement.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),this._animationsDisabled||"undefined"==typeof requestAnimationFrame?this._backdropElement.classList.add(t):this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(t)})})}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){const t=this._backdropElement;if(t){if(this._animationsDisabled)return void this._disposeBackdrop(t);t.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{t.addEventListener("transitionend",this._backdropTransitionendHandler)}),t.style.pointerEvents="none",this._backdropTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(()=>{this._disposeBackdrop(t)},500))}}_toggleClasses(t,e,i){const r=Mw(e||[]).filter(s=>!!s);r.length&&(i?t.classList.add(...r):t.classList.remove(...r))}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{const t=this._ngZone.onStable.pipe(Li(rr(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||0===this._pane.children.length)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),t.unsubscribe())})})}_disposeScrollStrategy(){const t=this._scrollStrategy;t&&(t.disable(),t.detach&&t.detach())}_disposeBackdrop(t){t&&(t.removeEventListener("click",this._backdropClickHandler),t.removeEventListener("transitionend",this._backdropTransitionendHandler),t.remove(),this._backdropElement===t&&(this._backdropElement=null)),this._backdropTimeout&&(clearTimeout(this._backdropTimeout),this._backdropTimeout=void 0)}}let rb=(()=>{class n{constructor(e,i){this._platform=i,this._document=e}ngOnDestroy(){var e;null===(e=this._containerElement)||void 0===e||e.remove()}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){const e="cdk-overlay-container";if(this._platform.isBrowser||ID()){const r=this._document.querySelectorAll(`.${e}[platform="server"], .${e}[platform="test"]`);for(let s=0;s<r.length;s++)r[s].remove()}const i=this._document.createElement("div");i.classList.add(e),ID()?i.setAttribute("platform","test"):this._platform.isBrowser||i.setAttribute("platform","server"),this._document.body.appendChild(i),this._containerElement=i}}return n.\u0275fac=function(e){return new(e||n)(Be(si),Be(_s))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const $2="cdk-overlay-connected-position-bounding-box",cq=/([A-Za-z%]+)$/;class uq{constructor(t,e,i,r,s){this._viewportRuler=e,this._document=i,this._platform=r,this._overlayContainer=s,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new Qt,this._resizeSubscription=me.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(t)}get positions(){return this._preferredPositions}attach(t){this._validatePositions(),t.hostElement.classList.add($2),this._overlayRef=t,this._boundingBox=t.hostElement,this._pane=t.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition)return void this.reapplyLastPosition();this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const t=this._originRect,e=this._overlayRect,i=this._viewportRect,r=this._containerRect,s=[];let d;for(let m of this._preferredPositions){let v=this._getOriginPoint(t,r,m),D=this._getOverlayPoint(v,e,m),A=this._getOverlayFit(D,e,i,m);if(A.isCompletelyWithinViewport)return this._isPushed=!1,void this._applyPosition(m,v);this._canFitWithFlexibleDimensions(A,D,i)?s.push({position:m,origin:v,overlayRect:e,boundingBoxRect:this._calculateBoundingBoxRect(v,m)}):(!d||d.overlayFit.visibleArea<A.visibleArea)&&(d={overlayFit:A,overlayPoint:D,originPoint:v,position:m,overlayRect:e})}if(s.length){let m=null,v=-1;for(const D of s){const A=D.boundingBoxRect.width*D.boundingBoxRect.height*(D.position.weight||1);A>v&&(v=A,m=D)}return this._isPushed=!1,void this._applyPosition(m.position,m.origin)}if(this._canPush)return this._isPushed=!0,void this._applyPosition(d.position,d.originPoint);this._applyPosition(d.position,d.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&um(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove($2),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;const t=this._lastPosition;if(t){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const e=this._getOriginPoint(this._originRect,this._containerRect,t);this._applyPosition(t,e)}else this.apply()}withScrollableContainers(t){return this._scrollables=t,this}withPositions(t){return this._preferredPositions=t,-1===t.indexOf(this._lastPosition)&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(t){return this._viewportMargin=t,this}withFlexibleDimensions(t=!0){return this._hasFlexibleDimensions=t,this}withGrowAfterOpen(t=!0){return this._growAfterOpen=t,this}withPush(t=!0){return this._canPush=t,this}withLockedPosition(t=!0){return this._positionLocked=t,this}setOrigin(t){return this._origin=t,this}withDefaultOffsetX(t){return this._offsetX=t,this}withDefaultOffsetY(t){return this._offsetY=t,this}withTransformOriginOn(t){return this._transformOriginSelector=t,this}_getOriginPoint(t,e,i){let r,s;if("center"==i.originX)r=t.left+t.width/2;else{const d=this._isRtl()?t.right:t.left,m=this._isRtl()?t.left:t.right;r="start"==i.originX?d:m}return e.left<0&&(r-=e.left),s="center"==i.originY?t.top+t.height/2:"top"==i.originY?t.top:t.bottom,e.top<0&&(s-=e.top),{x:r,y:s}}_getOverlayPoint(t,e,i){let r,s;return r="center"==i.overlayX?-e.width/2:"start"===i.overlayX?this._isRtl()?-e.width:0:this._isRtl()?0:-e.width,s="center"==i.overlayY?-e.height/2:"top"==i.overlayY?0:-e.height,{x:t.x+r,y:t.y+s}}_getOverlayFit(t,e,i,r){const s=q2(e);let{x:d,y:m}=t,v=this._getOffset(r,"x"),D=this._getOffset(r,"y");v&&(d+=v),D&&(m+=D);let j=0-m,W=m+s.height-i.height,ie=this._subtractOverflows(s.width,0-d,d+s.width-i.width),we=this._subtractOverflows(s.height,j,W),Re=ie*we;return{visibleArea:Re,isCompletelyWithinViewport:s.width*s.height===Re,fitsInViewportVertically:we===s.height,fitsInViewportHorizontally:ie==s.width}}_canFitWithFlexibleDimensions(t,e,i){if(this._hasFlexibleDimensions){const r=i.bottom-e.y,s=i.right-e.x,d=G2(this._overlayRef.getConfig().minHeight),m=G2(this._overlayRef.getConfig().minWidth),D=t.fitsInViewportHorizontally||null!=m&&m<=s;return(t.fitsInViewportVertically||null!=d&&d<=r)&&D}return!1}_pushOverlayOnScreen(t,e,i){if(this._previousPushAmount&&this._positionLocked)return{x:t.x+this._previousPushAmount.x,y:t.y+this._previousPushAmount.y};const r=q2(e),s=this._viewportRect,d=Math.max(t.x+r.width-s.width,0),m=Math.max(t.y+r.height-s.height,0),v=Math.max(s.top-i.top-t.y,0),D=Math.max(s.left-i.left-t.x,0);let A=0,L=0;return A=r.width<=s.width?D||-d:t.x<this._viewportMargin?s.left-i.left-t.x:0,L=r.height<=s.height?v||-m:t.y<this._viewportMargin?s.top-i.top-t.y:0,this._previousPushAmount={x:A,y:L},{x:t.x+A,y:t.y+L}}_applyPosition(t,e){if(this._setTransformOrigin(t),this._setOverlayElementStyles(e,t),this._setBoundingBoxStyles(e,t),t.panelClass&&this._addPanelClasses(t.panelClass),this._lastPosition=t,this._positionChanges.observers.length){const i=this._getScrollVisibility(),r=new lq(t,i);this._positionChanges.next(r)}this._isInitialRender=!1}_setTransformOrigin(t){if(!this._transformOriginSelector)return;const e=this._boundingBox.querySelectorAll(this._transformOriginSelector);let i,r=t.overlayY;i="center"===t.overlayX?"center":this._isRtl()?"start"===t.overlayX?"right":"left":"start"===t.overlayX?"left":"right";for(let s=0;s<e.length;s++)e[s].style.transformOrigin=`${i} ${r}`}_calculateBoundingBoxRect(t,e){const i=this._viewportRect,r=this._isRtl();let s,d,m,A,L,j;if("top"===e.overlayY)d=t.y,s=i.height-d+this._viewportMargin;else if("bottom"===e.overlayY)m=i.height-t.y+2*this._viewportMargin,s=i.height-m+this._viewportMargin;else{const W=Math.min(i.bottom-t.y+i.top,t.y),ie=this._lastBoundingBoxSize.height;s=2*W,d=t.y-W,s>ie&&!this._isInitialRender&&!this._growAfterOpen&&(d=t.y-ie/2)}if("end"===e.overlayX&&!r||"start"===e.overlayX&&r)j=i.width-t.x+this._viewportMargin,A=t.x-this._viewportMargin;else if("start"===e.overlayX&&!r||"end"===e.overlayX&&r)L=t.x,A=i.right-t.x;else{const W=Math.min(i.right-t.x+i.left,t.x),ie=this._lastBoundingBoxSize.width;A=2*W,L=t.x-W,A>ie&&!this._isInitialRender&&!this._growAfterOpen&&(L=t.x-ie/2)}return{top:d,left:L,bottom:m,right:j,width:A,height:s}}_setBoundingBoxStyles(t,e){const i=this._calculateBoundingBoxRect(t,e);!this._isInitialRender&&!this._growAfterOpen&&(i.height=Math.min(i.height,this._lastBoundingBoxSize.height),i.width=Math.min(i.width,this._lastBoundingBoxSize.width));const r={};if(this._hasExactPosition())r.top=r.left="0",r.bottom=r.right=r.maxHeight=r.maxWidth="",r.width=r.height="100%";else{const s=this._overlayRef.getConfig().maxHeight,d=this._overlayRef.getConfig().maxWidth;r.height=bs(i.height),r.top=bs(i.top),r.bottom=bs(i.bottom),r.width=bs(i.width),r.left=bs(i.left),r.right=bs(i.right),r.alignItems="center"===e.overlayX?"center":"end"===e.overlayX?"flex-end":"flex-start",r.justifyContent="center"===e.overlayY?"center":"bottom"===e.overlayY?"flex-end":"flex-start",s&&(r.maxHeight=bs(s)),d&&(r.maxWidth=bs(d))}this._lastBoundingBoxSize=i,um(this._boundingBox.style,r)}_resetBoundingBoxStyles(){um(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){um(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(t,e){const i={},r=this._hasExactPosition(),s=this._hasFlexibleDimensions,d=this._overlayRef.getConfig();if(r){const A=this._viewportRuler.getViewportScrollPosition();um(i,this._getExactOverlayY(e,t,A)),um(i,this._getExactOverlayX(e,t,A))}else i.position="static";let m="",v=this._getOffset(e,"x"),D=this._getOffset(e,"y");v&&(m+=`translateX(${v}px) `),D&&(m+=`translateY(${D}px)`),i.transform=m.trim(),d.maxHeight&&(r?i.maxHeight=bs(d.maxHeight):s&&(i.maxHeight="")),d.maxWidth&&(r?i.maxWidth=bs(d.maxWidth):s&&(i.maxWidth="")),um(this._pane.style,i)}_getExactOverlayY(t,e,i){let r={top:"",bottom:""},s=this._getOverlayPoint(e,this._overlayRect,t);return this._isPushed&&(s=this._pushOverlayOnScreen(s,this._overlayRect,i)),"bottom"===t.overlayY?r.bottom=this._document.documentElement.clientHeight-(s.y+this._overlayRect.height)+"px":r.top=bs(s.y),r}_getExactOverlayX(t,e,i){let d,r={left:"",right:""},s=this._getOverlayPoint(e,this._overlayRect,t);return this._isPushed&&(s=this._pushOverlayOnScreen(s,this._overlayRect,i)),d=this._isRtl()?"end"===t.overlayX?"left":"right":"end"===t.overlayX?"right":"left","right"===d?r.right=this._document.documentElement.clientWidth-(s.x+this._overlayRect.width)+"px":r.left=bs(s.x),r}_getScrollVisibility(){const t=this._getOriginRect(),e=this._pane.getBoundingClientRect(),i=this._scrollables.map(r=>r.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:H2(t,i),isOriginOutsideView:YD(t,i),isOverlayClipped:H2(e,i),isOverlayOutsideView:YD(e,i)}}_subtractOverflows(t,...e){return e.reduce((i,r)=>i-Math.max(r,0),t)}_getNarrowedViewportRect(){const t=this._document.documentElement.clientWidth,e=this._document.documentElement.clientHeight,i=this._viewportRuler.getViewportScrollPosition();return{top:i.top+this._viewportMargin,left:i.left+this._viewportMargin,right:i.left+t-this._viewportMargin,bottom:i.top+e-this._viewportMargin,width:t-2*this._viewportMargin,height:e-2*this._viewportMargin}}_isRtl(){return"rtl"===this._overlayRef.getDirection()}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(t,e){return"x"===e?null==t.offsetX?this._offsetX:t.offsetX:null==t.offsetY?this._offsetY:t.offsetY}_validatePositions(){}_addPanelClasses(t){this._pane&&Mw(t).forEach(e=>{""!==e&&-1===this._appliedPanelClasses.indexOf(e)&&(this._appliedPanelClasses.push(e),this._pane.classList.add(e))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(t=>{this._pane.classList.remove(t)}),this._appliedPanelClasses=[])}_getOriginRect(){const t=this._origin;if(t instanceof Pn)return t.nativeElement.getBoundingClientRect();if(t instanceof Element)return t.getBoundingClientRect();const e=t.width||0,i=t.height||0;return{top:t.y,bottom:t.y+i,left:t.x,right:t.x+e,height:i,width:e}}}function um(n,t){for(let e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}function G2(n){if("number"!=typeof n&&null!=n){const[t,e]=n.split(cq);return e&&"px"!==e?null:parseFloat(t)}return n||null}function q2(n){return{top:Math.floor(n.top),right:Math.floor(n.right),bottom:Math.floor(n.bottom),left:Math.floor(n.left),width:Math.floor(n.width),height:Math.floor(n.height)}}const W2="cdk-global-overlay-wrapper";class dq{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._alignItems="",this._xPosition="",this._xOffset="",this._width="",this._height="",this._isDisposed=!1}attach(t){const e=t.getConfig();this._overlayRef=t,this._width&&!e.width&&t.updateSize({width:this._width}),this._height&&!e.height&&t.updateSize({height:this._height}),t.hostElement.classList.add(W2),this._isDisposed=!1}top(t=""){return this._bottomOffset="",this._topOffset=t,this._alignItems="flex-start",this}left(t=""){return this._xOffset=t,this._xPosition="left",this}bottom(t=""){return this._topOffset="",this._bottomOffset=t,this._alignItems="flex-end",this}right(t=""){return this._xOffset=t,this._xPosition="right",this}start(t=""){return this._xOffset=t,this._xPosition="start",this}end(t=""){return this._xOffset=t,this._xPosition="end",this}width(t=""){return this._overlayRef?this._overlayRef.updateSize({width:t}):this._width=t,this}height(t=""){return this._overlayRef?this._overlayRef.updateSize({height:t}):this._height=t,this}centerHorizontally(t=""){return this.left(t),this._xPosition="center",this}centerVertically(t=""){return this.top(t),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;const t=this._overlayRef.overlayElement.style,e=this._overlayRef.hostElement.style,i=this._overlayRef.getConfig(),{width:r,height:s,maxWidth:d,maxHeight:m}=i,v=!("100%"!==r&&"100vw"!==r||d&&"100%"!==d&&"100vw"!==d),D=!("100%"!==s&&"100vh"!==s||m&&"100%"!==m&&"100vh"!==m),A=this._xPosition,L=this._xOffset,j="rtl"===this._overlayRef.getConfig().direction;let W="",ie="",we="";v?we="flex-start":"center"===A?(we="center",j?ie=L:W=L):j?"left"===A||"end"===A?(we="flex-end",W=L):("right"===A||"start"===A)&&(we="flex-start",ie=L):"left"===A||"start"===A?(we="flex-start",W=L):("right"===A||"end"===A)&&(we="flex-end",ie=L),t.position=this._cssPosition,t.marginLeft=v?"0":W,t.marginTop=D?"0":this._topOffset,t.marginBottom=this._bottomOffset,t.marginRight=v?"0":ie,e.justifyContent=we,e.alignItems=D?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;const t=this._overlayRef.overlayElement.style,e=this._overlayRef.hostElement,i=e.style;e.classList.remove(W2),i.justifyContent=i.alignItems=t.marginTop=t.marginBottom=t.marginLeft=t.marginRight=t.position="",this._overlayRef=null,this._isDisposed=!0}}let hq=(()=>{class n{constructor(e,i,r,s){this._viewportRuler=e,this._document=i,this._platform=r,this._overlayContainer=s}global(){return new dq}flexibleConnectedTo(e){return new uq(e,this._viewportRuler,this._document,this._platform,this._overlayContainer)}}return n.\u0275fac=function(e){return new(e||n)(Be($u),Be(si),Be(_s),Be(rb))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),X2=(()=>{class n{constructor(e){this._attachedOverlays=[],this._document=e}ngOnDestroy(){this.detach()}add(e){this.remove(e),this._attachedOverlays.push(e)}remove(e){const i=this._attachedOverlays.indexOf(e);i>-1&&this._attachedOverlays.splice(i,1),0===this._attachedOverlays.length&&this.detach()}}return n.\u0275fac=function(e){return new(e||n)(Be(si))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),pq=(()=>{class n extends X2{constructor(e,i){super(e),this._ngZone=i,this._keydownListener=r=>{const s=this._attachedOverlays;for(let d=s.length-1;d>-1;d--)if(s[d]._keydownEvents.observers.length>0){const m=s[d]._keydownEvents;this._ngZone?this._ngZone.run(()=>m.next(r)):m.next(r);break}}}add(e){super.add(e),this._isAttached||(this._ngZone?this._ngZone.runOutsideAngular(()=>this._document.body.addEventListener("keydown",this._keydownListener)):this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}}return n.\u0275fac=function(e){return new(e||n)(Be(si),Be(oi,8))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),fq=(()=>{class n extends X2{constructor(e,i,r){super(e),this._platform=i,this._ngZone=r,this._cursorStyleIsSet=!1,this._pointerDownListener=s=>{this._pointerDownEventTarget=Mp(s)},this._clickListener=s=>{const d=Mp(s),m="click"===s.type&&this._pointerDownEventTarget?this._pointerDownEventTarget:d;this._pointerDownEventTarget=null;const v=this._attachedOverlays.slice();for(let D=v.length-1;D>-1;D--){const A=v[D];if(A._outsidePointerEvents.observers.length<1||!A.hasAttached())continue;if(A.overlayElement.contains(d)||A.overlayElement.contains(m))break;const L=A._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>L.next(s)):L.next(s)}}}add(e){if(super.add(e),!this._isAttached){const i=this._document.body;this._ngZone?this._ngZone.runOutsideAngular(()=>this._addEventListeners(i)):this._addEventListeners(i),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=i.style.cursor,i.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){const e=this._document.body;e.removeEventListener("pointerdown",this._pointerDownListener,!0),e.removeEventListener("click",this._clickListener,!0),e.removeEventListener("auxclick",this._clickListener,!0),e.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(e.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}_addEventListeners(e){e.addEventListener("pointerdown",this._pointerDownListener,!0),e.addEventListener("click",this._clickListener,!0),e.addEventListener("auxclick",this._clickListener,!0),e.addEventListener("contextmenu",this._clickListener,!0)}}return n.\u0275fac=function(e){return new(e||n)(Be(si),Be(_s),Be(oi,8))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),mq=0,$o=(()=>{class n{constructor(e,i,r,s,d,m,v,D,A,L,j,W){this.scrollStrategies=e,this._overlayContainer=i,this._componentFactoryResolver=r,this._positionBuilder=s,this._keyboardDispatcher=d,this._injector=m,this._ngZone=v,this._document=D,this._directionality=A,this._location=L,this._outsideClickDispatcher=j,this._animationsModuleType=W}create(e){const i=this._createHostElement(),r=this._createPaneElement(i),s=this._createPortalOutlet(r),d=new cm(e);return d.direction=d.direction||this._directionality.value,new Op(s,i,r,d,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher,"NoopAnimations"===this._animationsModuleType)}position(){return this._positionBuilder}_createPaneElement(e){const i=this._document.createElement("div");return i.id="cdk-overlay-"+mq++,i.classList.add("cdk-overlay-pane"),e.appendChild(i),i}_createHostElement(){const e=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(e),e}_createPortalOutlet(e){return this._appRef||(this._appRef=this._injector.get(Ng)),new q8(e,this._componentFactoryResolver,this._appRef,this._injector,this._document)}}return n.\u0275fac=function(e){return new(e||n)(Be(aq),Be(rb),Be(Ff),Be(hq),Be(pq),Be(xr),Be(oi),Be(si),Be(Pp),Be(ux),Be(fq),Be(Lu,8))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();const gq=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom"},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"}],Z2=new bt("cdk-connected-overlay-scroll-strategy");let Y2=(()=>{class n{constructor(e){this.elementRef=e}}return n.\u0275fac=function(e){return new(e||n)($(Pn))},n.\u0275dir=vt({type:n,selectors:[["","cdk-overlay-origin",""],["","overlay-origin",""],["","cdkOverlayOrigin",""]],exportAs:["cdkOverlayOrigin"]}),n})(),Q2=(()=>{class n{constructor(e,i,r,s,d){this._overlay=e,this._dir=d,this._hasBackdrop=!1,this._lockPosition=!1,this._growAfterOpen=!1,this._flexibleDimensions=!1,this._push=!1,this._backdropSubscription=me.EMPTY,this._attachSubscription=me.EMPTY,this._detachSubscription=me.EMPTY,this._positionSubscription=me.EMPTY,this.viewportMargin=0,this.open=!1,this.disableClose=!1,this.backdropClick=new Xt,this.positionChange=new Xt,this.attach=new Xt,this.detach=new Xt,this.overlayKeydown=new Xt,this.overlayOutsideClick=new Xt,this._templatePortal=new em(i,r),this._scrollStrategyFactory=s,this.scrollStrategy=this._scrollStrategyFactory()}get offsetX(){return this._offsetX}set offsetX(e){this._offsetX=e,this._position&&this._updatePositionStrategy(this._position)}get offsetY(){return this._offsetY}set offsetY(e){this._offsetY=e,this._position&&this._updatePositionStrategy(this._position)}get hasBackdrop(){return this._hasBackdrop}set hasBackdrop(e){this._hasBackdrop=Qn(e)}get lockPosition(){return this._lockPosition}set lockPosition(e){this._lockPosition=Qn(e)}get flexibleDimensions(){return this._flexibleDimensions}set flexibleDimensions(e){this._flexibleDimensions=Qn(e)}get growAfterOpen(){return this._growAfterOpen}set growAfterOpen(e){this._growAfterOpen=Qn(e)}get push(){return this._push}set push(e){this._push=Qn(e)}get overlayRef(){return this._overlayRef}get dir(){return this._dir?this._dir.value:"ltr"}ngOnDestroy(){this._attachSubscription.unsubscribe(),this._detachSubscription.unsubscribe(),this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe(),this._overlayRef&&this._overlayRef.dispose()}ngOnChanges(e){this._position&&(this._updatePositionStrategy(this._position),this._overlayRef.updateSize({width:this.width,minWidth:this.minWidth,height:this.height,minHeight:this.minHeight}),e.origin&&this.open&&this._position.apply()),e.open&&(this.open?this._attachOverlay():this._detachOverlay())}_createOverlay(){(!this.positions||!this.positions.length)&&(this.positions=gq);const e=this._overlayRef=this._overlay.create(this._buildConfig());this._attachSubscription=e.attachments().subscribe(()=>this.attach.emit()),this._detachSubscription=e.detachments().subscribe(()=>this.detach.emit()),e.keydownEvents().subscribe(i=>{this.overlayKeydown.next(i),27===i.keyCode&&!this.disableClose&&!aa(i)&&(i.preventDefault(),this._detachOverlay())}),this._overlayRef.outsidePointerEvents().subscribe(i=>{this.overlayOutsideClick.next(i)})}_buildConfig(){const e=this._position=this.positionStrategy||this._createPositionStrategy(),i=new cm({direction:this._dir,positionStrategy:e,scrollStrategy:this.scrollStrategy,hasBackdrop:this.hasBackdrop});return(this.width||0===this.width)&&(i.width=this.width),(this.height||0===this.height)&&(i.height=this.height),(this.minWidth||0===this.minWidth)&&(i.minWidth=this.minWidth),(this.minHeight||0===this.minHeight)&&(i.minHeight=this.minHeight),this.backdropClass&&(i.backdropClass=this.backdropClass),this.panelClass&&(i.panelClass=this.panelClass),i}_updatePositionStrategy(e){const i=this.positions.map(r=>({originX:r.originX,originY:r.originY,overlayX:r.overlayX,overlayY:r.overlayY,offsetX:r.offsetX||this.offsetX,offsetY:r.offsetY||this.offsetY,panelClass:r.panelClass||void 0}));return e.setOrigin(this._getFlexibleConnectedPositionStrategyOrigin()).withPositions(i).withFlexibleDimensions(this.flexibleDimensions).withPush(this.push).withGrowAfterOpen(this.growAfterOpen).withViewportMargin(this.viewportMargin).withLockedPosition(this.lockPosition).withTransformOriginOn(this.transformOriginSelector)}_createPositionStrategy(){const e=this._overlay.position().flexibleConnectedTo(this._getFlexibleConnectedPositionStrategyOrigin());return this._updatePositionStrategy(e),e}_getFlexibleConnectedPositionStrategyOrigin(){return this.origin instanceof Y2?this.origin.elementRef:this.origin}_attachOverlay(){this._overlayRef?this._overlayRef.getConfig().hasBackdrop=this.hasBackdrop:this._createOverlay(),this._overlayRef.hasAttached()||this._overlayRef.attach(this._templatePortal),this.hasBackdrop?this._backdropSubscription=this._overlayRef.backdropClick().subscribe(e=>{this.backdropClick.emit(e)}):this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe(),this.positionChange.observers.length>0&&(this._positionSubscription=this._position.positionChanges.pipe(function iq(n,t=!1){return di((e,i)=>{let r=0;e.subscribe(Tt(i,s=>{const d=n(s,r++);(d||t)&&i.next(s),!d&&i.complete()}))})}(()=>this.positionChange.observers.length>0)).subscribe(e=>{this.positionChange.emit(e),0===this.positionChange.observers.length&&this._positionSubscription.unsubscribe()}))}_detachOverlay(){this._overlayRef&&this._overlayRef.detach(),this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)($($o),$(eo),$(Vo),$(Z2),$(Pp,8))},n.\u0275dir=vt({type:n,selectors:[["","cdk-connected-overlay",""],["","connected-overlay",""],["","cdkConnectedOverlay",""]],inputs:{origin:["cdkConnectedOverlayOrigin","origin"],positions:["cdkConnectedOverlayPositions","positions"],positionStrategy:["cdkConnectedOverlayPositionStrategy","positionStrategy"],offsetX:["cdkConnectedOverlayOffsetX","offsetX"],offsetY:["cdkConnectedOverlayOffsetY","offsetY"],width:["cdkConnectedOverlayWidth","width"],height:["cdkConnectedOverlayHeight","height"],minWidth:["cdkConnectedOverlayMinWidth","minWidth"],minHeight:["cdkConnectedOverlayMinHeight","minHeight"],backdropClass:["cdkConnectedOverlayBackdropClass","backdropClass"],panelClass:["cdkConnectedOverlayPanelClass","panelClass"],viewportMargin:["cdkConnectedOverlayViewportMargin","viewportMargin"],scrollStrategy:["cdkConnectedOverlayScrollStrategy","scrollStrategy"],open:["cdkConnectedOverlayOpen","open"],disableClose:["cdkConnectedOverlayDisableClose","disableClose"],transformOriginSelector:["cdkConnectedOverlayTransformOriginOn","transformOriginSelector"],hasBackdrop:["cdkConnectedOverlayHasBackdrop","hasBackdrop"],lockPosition:["cdkConnectedOverlayLockPosition","lockPosition"],flexibleDimensions:["cdkConnectedOverlayFlexibleDimensions","flexibleDimensions"],growAfterOpen:["cdkConnectedOverlayGrowAfterOpen","growAfterOpen"],push:["cdkConnectedOverlayPush","push"]},outputs:{backdropClick:"backdropClick",positionChange:"positionChange",attach:"attach",detach:"detach",overlayKeydown:"overlayKeydown",overlayOutsideClick:"overlayOutsideClick"},exportAs:["cdkConnectedOverlay"],features:[dr]}),n})();const _q={provide:Z2,deps:[$o],useFactory:function bq(n){return()=>n.scrollStrategies.reposition()}};let yl=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({providers:[$o,_q],imports:[qw,sa,ZD,ZD]}),n})();const yq=["tooltip"];function vq(n,t){1&n&&cc(0)}function xq(n,t){if(1&n&&(Fd(0),cn(1,vq,1,0,"ng-container",7),Nd()),2&n){const e=t.ngIf;Je(1),dt("ngTemplateOutlet",e)}}function wq(n,t){1&n&&Pt(0),2&n&&tr(Fn().message)}function Sq(n,t){if(1&n){const e=ml();Ee(0,"button",8),Wt("click",function(){return Wi(e),no(Fn().hide(0))}),qn(1,"sbb-icon",9),Pe()}}function Cq(n,t){1&n&&Lr(0)}const Tq=["*"],QD="tooltip-panel",K2=Ip({passive:!0}),J2=new bt("sbb-tooltip-scroll-strategy"),Mq={provide:J2,deps:[$o],useFactory:function Iq(n){return()=>n.scrollStrategies.reposition({scrollThrottle:20})}},Aq=new bt("sbb-tooltip-default-options",{providedIn:"root",factory:function kq(){return{showDelay:0,hideDelay:0,touchendHideDelay:1500,autoFocus:!0,restoreFocus:!0}}});class eL{constructor(t){this.instance=t}}let Rq=(()=>{class n{constructor(e,i,r,s,d,m,v,D,A,L,j){this._overlay=e,this._elementRef=i,this._scrollDispatcher=r,this._viewContainerRef=s,this._ngZone=d,this._platform=m,this._ariaDescriber=v,this._focusMonitor=D,this._defaultOptions=L,this._disabled=!1,this._viewInitialized=!1,this._pointerExitEventsInitialized=!1,this._viewportMargin=8,this._cssClassPrefix="sbb",this.trigger="hover",this._showDelay=this._defaultOptions.showDelay,this._hideDelay=this._defaultOptions.hideDelay,this.touchGestures="auto",this._message="",this.tooltipPanelClass="",this._passiveListeners=[],this._destroyed=new Qt,this.opened=new Xt,this.dismissed=new Xt,this._scrollStrategy=A,this._document=j,null!=L&&L.touchGestures&&(this.touchGestures=L.touchGestures)}get disabled(){return this._disabled}set disabled(e){this._disabled=Qn(e),this._disabled?this.hide(0):this._setupPointerEnterEventsIfNeeded()}get showDelay(){return this._showDelay}set showDelay(e){this._showDelay=Kd(e)}get hideDelay(){return this._hideDelay}set hideDelay(e){this._hideDelay=Kd(e),this._tooltipInstance&&(this._tooltipInstance._mouseLeaveHideDelay=this._hideDelay)}get message(){return this._message}set message(e){"string"==typeof this._message&&this._ariaDescriber.removeDescription(this._elementRef.nativeElement,this._message,"tooltip"),this._message=e instanceof eo?e:null!=e?String(e).trim():"",!this._message&&this._isTooltipVisible()?this.hide(0):(this._setupPointerEnterEventsIfNeeded(),this._updateTooltipMessage(),"string"==typeof this._message&&this._ngZone.runOutsideAngular(()=>{Promise.resolve().then(()=>{this._ariaDescriber.describe(this._elementRef.nativeElement,this._message,"tooltip")})}))}get tooltipClass(){return this._tooltipClass}set tooltipClass(e){this._tooltipClass=e,this._tooltipInstance&&this._setTooltipClass(this._tooltipClass)}_preventClickBubbling(e){!this.disabled&&"click"===this.trigger&&e.stopPropagation()}ngAfterViewInit(){this._viewInitialized=!0,this._setupPointerEnterEventsIfNeeded(),this._focusMonitor.monitor(this._elementRef).pipe(Er(()=>"hover"===this.trigger),Li(this._destroyed)).subscribe(e=>{e?"keyboard"===e&&this._ngZone.run(()=>this.show()):this._ngZone.run(()=>this.hide(0))})}ngOnDestroy(){const e=this._elementRef.nativeElement;clearTimeout(this._touchstartTimeout),this._overlayRef&&(this._overlayRef.dispose(),this._tooltipInstance=null),this._passiveListeners.forEach(([i,r])=>{e.removeEventListener(i,r,K2)}),this._passiveListeners.length=0,this._destroyed.next(),this._destroyed.complete(),"string"==typeof this._message&&this._ariaDescriber.removeDescription(e,this._message,"tooltip"),this._focusMonitor.stopMonitoring(e)}show(e=this.showDelay){var i,r;if(this.disabled||!this.message||this._isTooltipVisible()&&!this._tooltipInstance._showTimeoutId&&!this._tooltipInstance._hideTimeoutId)return;const s=this._createOverlay();this._detach(),this._portal=this._portal||new Uu(this._tooltipComponent,this._viewContainerRef),this._tooltipInstance=s.attach(this._portal).instance,this._tooltipInstance._triggerElement=this._elementRef.nativeElement,this._tooltipInstance._mouseLeaveHideDelay=this._hideDelay,this.message instanceof eo&&this._ariaDescriber.describe(this._elementRef.nativeElement,this._tooltipInstance._elementRef.nativeElement),this._tooltipInstance.afterShown().pipe(Li(this._destroyed)).subscribe(()=>this.opened.emit(new eL(this))),this._tooltipInstance.afterHidden().pipe(Li(this._destroyed)).subscribe(()=>{this.dismissed.emit(new eL(this)),this._detach()}),this._setTooltipClass(this._tooltipClass),this._updateTooltipMessage(),"click"===this.trigger?(this._tooltipInstance._config={autoFocus:null===(i=this._defaultOptions.autoFocus)||void 0===i||i,restoreFocus:null===(r=this._defaultOptions.restoreFocus)||void 0===r||r},this._tooltipInstance._initializeWithAttachedContent(),this._tooltipInstance._triggeredByClick=!0):(this._tooltipInstance._config=void 0,this._tooltipInstance._triggeredByClick=!1),this._tooltipInstance.show(e)}hide(e=this.hideDelay){this._tooltipInstance&&this._tooltipInstance.hide(e)}toggle(){this._isTooltipVisible()?this.hide():this.show()}_isTooltipVisible(){return!!this._tooltipInstance&&this._tooltipInstance.isVisible()}_createOverlay(){var e;if(this._overlayRef)return this._overlayRef;const i=this._scrollDispatcher.getAncestorScrollContainers(this._elementRef),r=`${this._cssClassPrefix}-${QD}-`,s=this._overlay.position().flexibleConnectedTo(this._elementRef).withTransformOriginOn(`.${this._cssClassPrefix}-tooltip`).withFlexibleDimensions(!1).withViewportMargin(this._viewportMargin).withScrollableContainers(i).withPositions([{originX:"center",originY:"bottom",overlayX:"center",overlayY:"top",offsetY:2},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top",offsetX:5,offsetY:2,panelClass:`${r}left`},{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top",offsetX:-5,offsetY:2,panelClass:`${r}right`},{originX:"center",originY:"top",overlayX:"center",overlayY:"bottom",offsetY:-2},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom",offsetX:5,offsetY:-2,panelClass:`${r}left`},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom",offsetX:-5,offsetY:-2,panelClass:`${r}right`}]);return s.positionChanges.pipe(Li(this._destroyed)).subscribe(d=>{this._updateCurrentPositionClass(d.connectionPair),this._tooltipInstance&&d.scrollableViewProperties.isOriginOutsideView&&this._tooltipInstance.isVisible()&&this._ngZone.run(()=>this.hide(0))}),this._overlayRef=this._overlay.create({positionStrategy:s,panelClass:xD(this.tooltipPanelClass).concat(`${this._cssClassPrefix}-${QD}`),scrollStrategy:this._scrollStrategy()}),this._overlayRef.detachments().pipe(Li(this._destroyed)).subscribe(()=>this._detach()),this._overlayRef.keydownEvents().pipe(Li(this._destroyed)).subscribe(d=>{this._isTooltipVisible()&&27===d.keyCode&&!aa(d)&&(d.preventDefault(),d.stopPropagation(),this._ngZone.run(()=>this.hide(0)))}),this._overlayRef.outsidePointerEvents().pipe(Li(this._destroyed)).subscribe(()=>{var d;return null===(d=this._tooltipInstance)||void 0===d?void 0:d._handleBodyInteraction()}),!(null===(e=this._defaultOptions)||void 0===e)&&e.disableTooltipInteractivity&&this._overlayRef.addPanelClass(`${this._cssClassPrefix}-tooltip-panel-non-interactive`),this._overlayRef}_detach(){this._overlayRef&&this._overlayRef.hasAttached()&&(this.message instanceof eo&&this._tooltipInstance&&this._ariaDescriber.removeDescription(this._elementRef.nativeElement,this._tooltipInstance._elementRef.nativeElement),this._overlayRef.detach()),this._tooltipInstance=null}_updateTooltipMessage(){this._tooltipInstance&&(this._tooltipInstance.message=this.message,this._tooltipInstance._markForCheck(),this._ngZone.onMicrotaskEmpty.pipe(Hr(1),Li(this._destroyed)).subscribe(()=>{this._tooltipInstance&&this._overlayRef.updatePosition()}))}_setTooltipClass(e){this._tooltipInstance&&(this._tooltipInstance.tooltipClass=e,this._tooltipInstance._markForCheck())}_updateCurrentPositionClass(e){const{overlayY:i,originX:r,originY:s}=e;let d;if(d="center"===i?"start"===r?"left":"right":"bottom"===i&&"top"===s?"above":"below",d!==this._currentPosition){const m=this._overlayRef;if(m){const v=`${this._cssClassPrefix}-${QD}-`;m.removePanelClass(v+this._currentPosition),m.addPanelClass(v+d)}this._currentPosition=d}}_setupPointerEnterEventsIfNeeded(){this._disabled||!this.message||!this._viewInitialized||this._passiveListeners.length||("click"===this.trigger?this._passiveListeners.push(["click",()=>this.show(0)]):this._platformSupportsMouseEvents()?this._passiveListeners.push(["mouseenter",()=>{this._setupPointerExitEventsIfNeeded(),this.show()}]):"off"!==this.touchGestures&&(this._disableNativeGesturesIfNecessary(),this._passiveListeners.push(["touchstart",()=>{this._setupPointerExitEventsIfNeeded(),clearTimeout(this._touchstartTimeout),this._touchstartTimeout=setTimeout(()=>this.show(),500)}])),this._addListeners(this._passiveListeners))}_setupPointerExitEventsIfNeeded(){if(this._pointerExitEventsInitialized)return;this._pointerExitEventsInitialized=!0;const e=[];if(this._platformSupportsMouseEvents())e.push(["mouseleave",i=>{var r;const s=i.relatedTarget;(!s||null===(r=this._overlayRef)||void 0===r||!r.overlayElement.contains(s))&&this.hide()}],["wheel",i=>this._wheelListener(i)]);else if("off"!==this.touchGestures){this._disableNativeGesturesIfNecessary();const i=()=>{clearTimeout(this._touchstartTimeout),this.hide(this._defaultOptions.touchendHideDelay)};e.push(["touchend",i],["touchcancel",i])}this._addListeners(e),this._passiveListeners.push(...e)}_addListeners(e){e.forEach(([i,r])=>{this._elementRef.nativeElement.addEventListener(i,r,K2)})}_platformSupportsMouseEvents(){return!this._platform.IOS&&!this._platform.ANDROID}_wheelListener(e){if(this._isTooltipVisible()){const i=this._document.elementFromPoint(e.clientX,e.clientY),r=this._elementRef.nativeElement;i!==r&&!r.contains(i)&&this.hide()}}_disableNativeGesturesIfNecessary(){const e=this.touchGestures;if("off"!==e){const i=this._elementRef.nativeElement,r=i.style;("on"===e||"INPUT"!==i.nodeName&&"TEXTAREA"!==i.nodeName)&&(r.userSelect=r.msUserSelect=r.webkitUserSelect=r.MozUserSelect="none"),("on"===e||!i.draggable)&&(r.webkitUserDrag="none"),r.touchAction="none",r.webkitTapHighlightColor="transparent"}}}return n.\u0275fac=function(e){zs()},n.\u0275dir=vt({type:n,hostBindings:function(e,i){1&e&&Wt("click",function(s){return i._preventClickBubbling(s)})},inputs:{trigger:["sbbTooltipTrigger","trigger"],disabled:["sbbTooltipDisabled","disabled"],showDelay:["sbbTooltipShowDelay","showDelay"],hideDelay:["sbbTooltipHideDelay","hideDelay"],touchGestures:["sbbTooltipTouchGestures","touchGestures"],message:["sbbTooltip","message"],tooltipClass:["sbbTooltipClass","tooltipClass"],tooltipPanelClass:["sbbTooltipPanelClass","tooltipPanelClass"]},outputs:{opened:"opened",dismissed:"dismissed"}}),n})(),tL=(()=>{class n extends Rq{constructor(e,i,r,s,d,m,v,D,A,L,j){super(e,i,r,s,d,m,v,D,A,L,j),this._tooltipComponent=Oq}}return n.\u0275fac=function(e){return new(e||n)($($o),$(Pn),$(V2),$(Vo),$(oi),$(_s),$(o2),$(Da),$(J2),$(Aq,8),$(si))},n.\u0275dir=vt({type:n,selectors:[["","sbbTooltip",""]],hostVars:3,hostBindings:function(e,i){2&e&&(Ht("aria-expanded","click"===i.trigger?i._isTooltipVisible():null),Oi("sbb-tooltip-trigger","click"===i.trigger))},exportAs:["sbbTooltip"],features:[ut]}),n})(),Pq=(()=>{class n{constructor(e,i,r,s,d,m){this._elementRef=e,this._focusTrapFactory=i,this._changeDetectorRef=r,this._focusMonitor=s,this._visibility="initial",this._closeInteractionType=null,this._config={},this._closeOnInteraction=!1,this._elementFocusedBeforeDialogWasOpened=null,this._isVisible=!1,this._onShow=new Qt,this._onHide=new Qt,this._triggeredByClick=!1,this._animationsDisabled="NoopAnimations"===m,this._document=d}show(e){clearTimeout(this._hideTimeoutId),this._closeOnInteraction=!0,this._showTimeoutId=setTimeout(()=>{this._showTimeoutId=void 0,this._toggleVisibility(!0)},e)}hide(e){clearTimeout(this._showTimeoutId),this._hideTimeoutId=setTimeout(()=>{this._toggleVisibility(!1),this._hideTimeoutId=void 0,this._markForCheck()},e)}afterShown(){return this._onShow}afterHidden(){return this._onHide}isVisible(){return this._isVisible}ngOnDestroy(){clearTimeout(this._showTimeoutId),clearTimeout(this._hideTimeoutId),this._onShow.complete(),this._onHide.complete(),this._triggerElement=null}_handleBodyInteraction(){this._closeOnInteraction&&this.hide(0)}_initializeWithAttachedContent(){this._setupFocusTrap(),this._capturePreviouslyFocusedElement(),this._focusDialogContainer()}_markForCheck(){this._changeDetectorRef.markForCheck()}_handleMouseLeave({relatedTarget:e}){!this._triggeredByClick&&(!e||!this._triggerElement.contains(e))&&this.hide(this._mouseLeaveHideDelay)}_handleAnimationEnd({animationName:e}){(e===this._showAnimation||e===this._hideAnimation)&&this._finalizeAnimation(e===this._showAnimation)}_finalizeAnimation(e){e?this._closeOnInteraction=!0:this.isVisible()||this._onHide.next(),e&&this.isVisible()&&this._config&&this._trapFocus(),!e&&!this.isVisible()&&this._restoreFocus()}_toggleVisibility(e){const i=this._tooltip.nativeElement,r=this._showAnimation,s=this._hideAnimation;if(i.classList.remove(e?s:r),i.classList.add(e?r:s),this._isVisible=e,e&&!this._animationsDisabled&&"function"==typeof getComputedStyle){const d=getComputedStyle(i);("0s"===d.getPropertyValue("animation-duration")||"none"===d.getPropertyValue("animation-name"))&&(this._animationsDisabled=!0)}e&&this._onShow.next(),this._animationsDisabled&&(i.classList.add("_sbb-animation-noopable"),this._finalizeAnimation(e))}_trapFocus(){var e;null!==(e=this._config)&&void 0!==e&&e.autoFocus?this._focusTrap.focusInitialElementWhenReady():this._containsFocus()||this._elementRef.nativeElement.focus()}_restoreFocus(){var e;const i=this._elementFocusedBeforeDialogWasOpened;if((null===(e=this._config)||void 0===e?void 0:e.restoreFocus)&&i&&"function"==typeof i.focus){const r=tu(),s=this._elementRef.nativeElement;(!r||r===this._document.body||r===s||s.contains(r))&&(this._focusMonitor.focusVia(i,this._closeInteractionType),this._closeInteractionType=null)}this._focusTrap&&this._focusTrap.destroy()}_setupFocusTrap(){this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement)}_capturePreviouslyFocusedElement(){this._document&&(this._elementFocusedBeforeDialogWasOpened=tu())}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){const e=this._elementRef.nativeElement,i=tu();return e===i||e.contains(i)}}return n.\u0275fac=function(e){return new(e||n)($(Pn),$(h2),$(Dr),$(Da),$(si,8),$(Lu,8))},n.\u0275dir=vt({type:n}),n})(),Oq=(()=>{class n extends Pq{constructor(e,i,r,s,d,m,v){super(e,i,r,s,d,v),this._breakpointObserver=m,this._isHandset=this._breakpointObserver.observe("(max-width: 642.99px) and (orientation: portrait), (max-width: 1024.99px) and (orientation: landscape)"),this._showAnimation="sbb-tooltip-container-show",this._hideAnimation="sbb-tooltip-container-hide"}get _templateRef(){return this.message instanceof eo?this.message:null}}return n.\u0275fac=function(e){return new(e||n)($(Pn),$(h2),$(Dr),$(Da),$(si,8),$(LD),$(Lu,8))},n.\u0275cmp=kn({type:n,selectors:[["sbb-tooltip-component"]],viewQuery:function(e,i){if(1&e&&mr(yq,7),2&e){let r;zn(r=Vn())&&(i._tooltip=r.first)}},hostAttrs:["aria-hidden","true",1,"sbb-tooltip-component"],hostVars:2,hostBindings:function(e,i){1&e&&Wt("mouseleave",function(s){return i._handleMouseLeave(s)}),2&e&&Bd("zoom",i.isVisible()?1:null)},features:[ut],decls:9,vars:10,consts:[[1,"sbb-tooltip-container",3,"animationend"],["tooltip",""],[1,"sbb-tooltip",3,"ngClass"],[1,"sbb-tooltip-content"],[4,"ngIf","ngIfElse"],["stringMessage",""],["type","button","class","sbb-tooltip-icon sbb-tooltip-close-button sbb-icon-fit sbb-button-reset-frameless",3,"click",4,"ngIf"],[4,"ngTemplateOutlet"],["type","button",1,"sbb-tooltip-icon","sbb-tooltip-close-button","sbb-icon-fit","sbb-button-reset-frameless",3,"click"],["svgIcon","kom:cross-small"]],template:function(e,i){if(1&e&&(Ee(0,"div",0,1),Wt("animationend",function(s){return i._handleAnimationEnd(s)}),kg(2,"async"),Ee(3,"div",2)(4,"div",3),cn(5,xq,2,1,"ng-container",4),cn(6,wq,1,1,"ng-template",null,5,fy),Pe(),cn(8,Sq,2,0,"button",6),Pe()()),2&e){const r=Ua(7);let s;Oi("sbb-tooltip-handset",null==(s=Rg(2,8,i._isHandset))?null:s.matches),Je(3),Oi("sbb-tooltip-has-close-button",i._triggeredByClick),dt("ngClass",i.tooltipClass),Je(2),dt("ngIf",i._templateRef)("ngIfElse",r),Je(3),dt("ngIf",i._triggeredByClick)}},dependencies:[Bg,na,XA,Xa,vy],styles:['.sbb-tooltip-component{display:block;filter:drop-shadow(0 var(--sbb-box-shadow-width) 0 var(--sbb-box-shadow-color))}.sbb-tooltip-container{height:100%;font-size:var(--sbb-font-size);line-height:var(--sbb-line-height);opacity:0}.sbb-tooltip-container._sbb-animation-noopable{animation:none;opacity:1}.sbb-tooltip-container::after,.sbb-tooltip-container::before{top:calc(.5*var(--sbb-border-width));left:0;right:0;margin-left:auto;margin-right:auto;content:"";height:var(--sbb-tooltip-content-arrow-size);width:var(--sbb-tooltip-content-arrow-size);position:absolute;pointer-events:none;transform:rotate(45deg);border:var(--sbb-border-width) solid rgba(0,0,0,0)}.sbb-tooltip-panel-above .sbb-tooltip-container::after,.sbb-tooltip-panel-above .sbb-tooltip-container::before{top:auto;bottom:calc(.5*var(--sbb-tooltip-shadow-arrow-size));transform:rotate(225deg)}.sbb-tooltip-panel-left .sbb-tooltip-container::after,.sbb-tooltip-panel-left .sbb-tooltip-container::before{margin-right:var(--sbb-tooltip-arrow-horizontal-space)}.sbb-tooltip-panel-right .sbb-tooltip-container::after,.sbb-tooltip-panel-right .sbb-tooltip-container::before{margin-left:var(--sbb-tooltip-arrow-horizontal-space)}.sbb-tooltip-container::before{border-color:var(--sbb-color-weak-accent);z-index:1}.sbb-tooltip-container::after{background-color:var(--sbb-tooltip-background-color);background-clip:padding-box;z-index:2;--sbb-tooltip-arrow-padding-offset: 0rem;clip-path:polygon(0 0, calc(var(--sbb-tooltip-content-arrow-size) - var(--sbb-tooltip-arrow-padding-offset)) 0, 0 calc(var(--sbb-tooltip-content-arrow-size) - var(--sbb-tooltip-arrow-padding-offset)))}html.sbb-lean .sbb-tooltip-container::after{--sbb-tooltip-arrow-padding-offset: 0.0666666667rem}.sbb-tooltip-panel-above .sbb-tooltip-container{margin-bottom:calc(0.8rem * var(--sbb-scaling-factor))}@keyframes sbb-tooltip-container-show{0%{opacity:0}100%{opacity:1}}@keyframes sbb-tooltip-container-hide{0%{opacity:1}100%{opacity:0}}.sbb-tooltip-container-show{animation:sbb-tooltip-container-show var(--sbb-transition-duration-fast) cubic-bezier(0, 0, 0.2, 1) forwards}.sbb-tooltip-container-hide{animation:sbb-tooltip-container-hide 75ms cubic-bezier(0, 0, 0.2, 1) forwards}.sbb-tooltip{max-width:calc(30.6666666667rem * var(--sbb-scaling-factor));padding:var(--sbb-tooltip-padding);position:relative;overflow:hidden;color:var(--sbb-color-grey);text-overflow:ellipsis;background-color:var(--sbb-tooltip-background-color);border:var(--sbb-border-width) solid var(--sbb-color-weak-accent);border-radius:var(--sbb-border-radius);z-index:2}.cdk-high-contrast-active .sbb-tooltip{outline:solid 1px}.sbb-tooltip-panel-below .sbb-tooltip{margin-top:var(--sbb-tooltip-arrow-offset)}:where(html.sbb-lean) .sbb-tooltip{color:var(--sbb-color-text)}.sbb-tooltip-zero-padding{--sbb-tooltip-padding: 0}.sbb-tooltip-has-close-button{padding-right:calc(4.7333333333rem * var(--sbb-scaling-factor))}:where(html.sbb-lean) .sbb-tooltip-has-close-button{padding-right:3.2rem}.sbb-tooltip-zero-padding .sbb-tooltip-has-close-button{padding-right:0}.sbb-tooltip-close-button{color:var(--sbb-color-weak-accent);position:absolute;width:var(--sbb-icon-size-default);height:var(--sbb-icon-size-default);top:var(--sbb-tooltip-padding);right:var(--sbb-tooltip-padding);line-height:0}:where(html:not(.sbb-lean)) .sbb-tooltip-close-button{border:var(--sbb-border-width-thin) solid var(--sbb-color-storm);border-radius:50%}.sbb-tooltip-panel-non-interactive{pointer-events:none}'],encapsulation:2,changeDetection:0}),n})();const Lq=Wa(class{});let Fq=1,Nq=(()=>{class n extends Lq{constructor(){super(...arguments),this.id="sbb-tooltip-id-"+Fq++,this.trigger="click",this._destroyed=new Qt,this.svgIcon="kom:circle-question-mark-small",this.opened=new Xt,this.dismissed=new Xt}get hoverShowDelay(){return this._hoverShowDelay}set hoverShowDelay(e){this._hoverShowDelay=Kd(e,0)}get hoverHideDelay(){return this._hoverHideDelay}set hoverHideDelay(e){this._hoverHideDelay=Kd(e,0)}ngOnInit(){this._tooltip.opened.pipe(Li(this._destroyed)).subscribe(e=>this.opened.emit(e)),this._tooltip.dismissed.pipe(Li(this._destroyed)).subscribe(e=>this.dismissed.emit(e))}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}show(){this._tooltip.show(0)}hide(){this._tooltip.hide(0)}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=ui(n)))(i||n)}}(),n.\u0275cmp=kn({type:n,selectors:[["sbb-tooltip"]],viewQuery:function(e,i){if(1&e&&mr(tL,7),2&e){let r;zn(r=Vn())&&(i._tooltip=r.first)}},hostAttrs:[1,"sbb-tooltip-wrapper"],hostVars:2,hostBindings:function(e,i){2&e&&Ht("id",i.id)("aria-expanded",i._tooltip._isTooltipVisible())},inputs:{disabled:"disabled",id:"id",trigger:"trigger",hoverShowDelay:"hoverShowDelay",hoverHideDelay:"hoverHideDelay",svgIcon:"svgIcon",sbbTooltipClass:"sbbTooltipClass",sbbTooltipPanelClass:"sbbTooltipPanelClass"},outputs:{opened:"opened",dismissed:"dismissed"},features:[ut],ngContentSelectors:Tq,decls:5,vars:9,consts:[["type","button",1,"sbb-tooltip-icon","sbb-tooltip-trigger","sbb-icon-scaled","sbb-button-reset-frameless",3,"sbbTooltip","sbbTooltipTrigger","sbbTooltipShowDelay","sbbTooltipHideDelay","sbbTooltipClass","sbbTooltipPanelClass","click"],["tooltip","sbbTooltip"],[3,"svgIcon"],["tooltipTemplate",""]],template:function(e,i){if(1&e){const r=ml();Ro(),Ee(0,"button",0,1),Wt("click",function(){return Wi(r),no(Ua(1).show(0))}),qn(2,"sbb-icon",2),Pe(),cn(3,Cq,1,0,"ng-template",null,3,fy)}if(2&e){const r=Ua(1),s=Ua(4);Oi("sbb-tooltip-trigger-active",r._isTooltipVisible()),dt("sbbTooltip",s)("sbbTooltipTrigger",i.trigger)("sbbTooltipShowDelay",i.hoverShowDelay)("sbbTooltipHideDelay",i.hoverHideDelay)("sbbTooltipClass",i.sbbTooltipClass)("sbbTooltipPanelClass",i.sbbTooltipPanelClass),Je(2),dt("svgIcon",i.svgIcon)}},dependencies:[Xa,tL],encapsulation:2,changeDetection:0}),n})(),nL=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({providers:[Mq],imports:[om,wr,yl,sa,Gi,bo,lm]}),n})();function Bq(n,t){1&n&&cc(0)}function zq(n,t){if(1&n&&(Ee(0,"span"),Pt(1),Pe()),2&n){const e=Fn(2);Je(1),Do(", Platform ",e.legInfoDataModel.fromLocationData.platformText,"")}}function Vq(n,t){if(1&n&&(Ee(0,"span"),Pt(1),Pe()),2&n){const e=Fn(2);Je(1),Do(", Platform ",e.legInfoDataModel.toLocationData.platformText,"")}}function jq(n,t){if(1&n){const e=ml();Ee(0,"div",15)(1,"div",16),Wt("click",function(){return Wi(e),no(Fn().handleClickOnLocation("From"))}),Ee(2,"span"),Pt(3),Pe(),cn(4,zq,2,1,"span",17),Pe(),Ee(5,"div",18)(6,"span"),Pt(7),Pe(),Ee(8,"span",19),Pt(9),Pe()()(),Ee(10,"div",11),qn(11,"div",20),Pe(),Ee(12,"div",15)(13,"div",16),Wt("click",function(){return Wi(e),no(Fn().handleClickOnLocation("To"))}),Ee(14,"span"),Pt(15),Pe(),cn(16,Vq,2,1,"span",17),Pe(),Ee(17,"div",18)(18,"span"),Pt(19),Pe(),Ee(20,"span",19),Pt(21),Pe()()()}if(2&n){const e=Fn();Je(3),tr(e.legInfoDataModel.fromLocationData.locationText),Je(1),dt("ngIf",e.legInfoDataModel.fromLocationData.platformText),Je(3),tr(e.legInfoDataModel.fromLocationData.timeText),Je(2),tr(e.legInfoDataModel.fromLocationData.delayText),Je(6),tr(e.legInfoDataModel.toLocationData.locationText),Je(1),dt("ngIf",e.legInfoDataModel.toLocationData.platformText),Je(3),tr(e.legInfoDataModel.toLocationData.timeText),Je(2),tr(e.legInfoDataModel.toLocationData.delayText)}}function Uq(n,t){if(1&n&&(Ee(0,"li"),Pt(1),Pe()),2&n){const e=t.$implicit;Je(1),Do(" ",e," ")}}function Hq(n,t){if(1&n&&(Ee(0,"sbb-tooltip",27)(1,"ul",28),cn(2,Uq,2,1,"li",29),Pe()()),2&n){const e=Fn(2);Je(2),dt("ngForOf",e.legInfoDataModel.guidanceTextLines)}}function $q(n,t){1&n&&(Ee(0,"div",11),qn(1,"div",30),Pe())}function Gq(n,t){if(1&n){const e=ml();Ee(0,"div",21)(1,"div",22)(2,"div",23)(3,"div",24),Wt("click",function(){return Wi(e),no(Fn().handleClickOnLocation("From"))}),Pt(4),Pe(),cn(5,Hq,3,1,"sbb-tooltip",25),cn(6,$q,2,0,"div",26),Ee(7,"div",24),Wt("click",function(){return Wi(e),no(Fn().handleClickOnLocation("To"))}),Pt(8),Pe()()(),Ee(9,"div",18)(10,"div"),Pt(11),Pe()()()}if(2&n){const e=Fn();Je(4),tr(e.legInfoDataModel.fromLocationData.locationText),Je(1),dt("ngIf",e.legInfoDataModel.hasGuidance),Je(1),dt("ngIf",0==e.legInfoDataModel.hasGuidance),Je(2),tr(e.legInfoDataModel.toLocationData.locationText),Je(3),tr(e.legInfoDataModel.walkingDurationText)}}const qq=function(n){return{"background-color":n}};let Wq=(()=>{class n{constructor(e){this.mapService=e,this.legInfoDataModel={}}ngOnInit(){this.leg&&this.initLegInfo(this.leg)}computeLegLeadText(){if(void 0===this.leg)return"n/a";if("TransferLeg"===this.leg.legType){const e="Transfer",i=this.leg;let r="";return i.walkDuration&&(r=" "+i.walkDuration.formatDuration()),e+r}if("ContinousLeg"===this.leg.legType){const i=this.computeLegLeadTextContinousLeg(this.leg);let r="";return this.leg.legDuration&&(r=" "+this.leg.legDuration.formatDuration()),i+r}if("TimedLeg"===this.leg.legType){const i=this.leg.service.formatServiceName();let r="";return this.leg.legDuration&&(r=" "+this.leg.legDuration.formatDuration()),i+r}return this.leg.legType}computeLegLeadTextContinousLeg(e){return"walk"===e.legTransportMode?"Walk":e.isDriveCarLeg()?"Drive":e.isSharedMobility()?"Ride":"Walk (DEFAULT)"}computeLegPillClassName(){return this.leg?"ContinousLeg"===this.leg.legType?"continous-leg-pill":"TimedLeg"===this.leg.legType?"timed-leg-pill":"TransferLeg"===this.leg.legType?"transfer-leg-pill":"":""}handleTapOnPill(){if(!this.leg)return;const e=this.leg.computeGeoJSONFeatures(),i=new Tp([]);if(e.forEach(m=>{const v=m.bbox;if(v){const D=new Ta(v[0],v[1]);i.extend(D);const A=new Ta(v[2],v[3]);i.extend(A)}}),!i.isValid())return console.error("Invalid BBOX for leg"),void console.log(this.leg);const r=i.asLngLatBounds();if(r.getSouthWest().distanceTo(r.getNorthEast())<20){const m={lnglat:r.getCenter(),zoom:16};this.mapService.newMapCenterAndZoomRequested.emit(m)}else this.mapService.newMapBoundsRequested.emit({bounds:r})}computeLegColor(){var e,i;return null!==(i=null===(e=this.leg)||void 0===e?void 0:e.computeLegColor())&&void 0!==i?i:Wy.TimedLeg}initLegInfo(e){var i,r,s,d;this.legInfoDataModel.legColor=this.computeLegColor(),this.legInfoDataModel.leadingText=this.computeLegLeadText();const m="TransferLeg"===e.legType;this.legInfoDataModel.guidanceTextLines=[],m&&(null!==(r=null===(i=e.pathGuidance)||void 0===i?void 0:i.sections)&&void 0!==r?r:[]).forEach(W=>{var ie,we,Re,We,xt,st;if(null===W.guidanceAdvice)return;const Bt=[null!==(ie=W.guidanceAdvice)&&void 0!==ie?ie:"","(",null!==(we=W.turnAction)&&void 0!==we?we:"",") - ",null!==(We=null===(Re=W.trackSection)||void 0===Re?void 0:Re.roadName)&&void 0!==We?We:""],Tn=null!==(st=null===(xt=W.trackSection)||void 0===xt?void 0:xt.length)&&void 0!==st?st:0;Tn>0&&(Bt.push(" ("),Bt.push(""+Tn),Bt.push("m)"));const ai=Bt.join("");this.legInfoDataModel.guidanceTextLines.push(ai)});let v="TransferLeg"===e.legType;if("ContinousLeg"===e.legType){const L=e;v=L.isWalking(),v&&(this.legInfoDataModel.walkingDistanceText=L.formatDistance())}this.legInfoDataModel.isWalking=v,v&&(this.legInfoDataModel.walkingDurationText=null!==(d=null===(s=e.legDuration)||void 0===s?void 0:s.formatDuration())&&void 0!==d?d:""),this.legInfoDataModel.hasGuidance=this.legInfoDataModel.guidanceTextLines.length>0;const A=this.computeLegIconFilename(e);this.legInfoDataModel.legIconPath="assets/pictograms/"+A+".png",this.legInfoDataModel.isTimed="TimedLeg"===e.legType,this.legInfoDataModel.fromLocationData=this.computeLocationData(e,"From"),this.legInfoDataModel.toLocationData=this.computeLocationData(e,"To")}computeLegIconFilename(e){if("TransferLeg"===e.legType)return"picto-walk";if("TimedLeg"===e.legType)return e.service.ptMode.computePublicTransportPictogram();if("ContinousLeg"===e.legType){const i=e;return i.isDriveCarLeg()?"car-sharing":i.isSharedMobility()?"velo-scooter-sharing":"picto-walk"}return"picto-bus-fallback"}computeLocationData(e,i){var r,s;const d="From"===i,v={locationText:null!==(r=(d?e.fromLocation:e.toLocation).locationName)&&void 0!==r?r:"",platformText:null,timeText:null,delayText:null};if("TimedLeg"===e.legType){const D=e,A=d?D.fromStopPoint:D.toStopPoint,L=d?A.departureData:A.arrivalData,j=null!==(s=null==L?void 0:L.estimatedTime)&&void 0!==s?s:null==L?void 0:L.timetableTime;if(j){v.timeText=_l.formatTimeHHMM(j);const W=null==L?void 0:L.delayMinutes;if(W){const ie=[];ie.push(" "),ie.push(W>0?"+":""),ie.push(""+W),ie.push("'"),v.delayText=ie.join("")}}v.platformText=A.plannedPlatform}return v}handleClickOnLocation(e){this.leg&&this.mapService.tryToCenterAndZoomToLocation("From"===e?this.leg.fromLocation:this.leg.toLocation)}}return n.\u0275fac=function(e){return new(e||n)($(Qd))},n.\u0275cmp=kn({type:n,selectors:[["result-trip-leg"]],inputs:{leg:"leg"},decls:22,vars:9,consts:[[1,"mb-2","d-flex","flex-row"],[1,"flex-grow-1"],[1,"badge","leg-pill","pill-hover","leg-leading-text",3,"ngStyle","click"],[1,"flex-grow-0","leg-right-side"],[1,"badge","leg-pill","pill-hover","bg-primary",3,"click"],[1,"mb-2","d-flex","flex-row","align-items-center"],[1,"flex-grow-0","leg-left-side"],[1,"d-flex","flex-column","leg-icon-wrapper"],[1,"text-center"],[1,"leg-icon",3,"src"],[4,"ngIf","ngIfThen","ngIfElse"],[1,"mb-2"],[1,"border-bottom",2,"height","8px"],["timedLegTemplate",""],["walkingLegTemplate",""],[1,"d-flex","flex-row"],[1,"flex-grow-1","leg-location","location-hover",3,"click"],[4,"ngIf"],[1,"flex-grow-0","leg-time","leg-right-side"],[1,"time-delay"],[1,"border-bottom",2,"height","8px","margin-left","4px"],[1,"d-flex","flex-row","align-items-center"],[1,"flex-grow-1","leg-location"],[1,"d-flex","flex-column","leg-location"],[1,"location-hover",3,"click"],["svgIcon","kom:arrow-change-horizontal-medium",4,"ngIf"],["class","mb-2",4,"ngIf"],["svgIcon","kom:arrow-change-horizontal-medium"],[1,"tooltip-list"],[4,"ngFor","ngForOf"],[1,"border-bottom",2,"height","8px","margin-left","4px","margin-right","8px"]],template:function(e,i){if(1&e&&(Ee(0,"div",0)(1,"div",1)(2,"div",2),Wt("click",function(){return i.handleTapOnPill()}),Pt(3),Pe()(),Ee(4,"div",3)(5,"div",4),Wt("click",function(){return i.handleTapOnPill()}),Pt(6,"MAP"),Pe()()(),Ee(7,"div",5)(8,"div",6)(9,"div",7)(10,"div",8),qn(11,"img",9),Pe(),Ee(12,"div",8),Pt(13),Pe()()(),Ee(14,"div",1),cn(15,Bq,1,0,"ng-container",10),Pe()(),Ee(16,"div",11),qn(17,"div",12),Pe(),cn(18,jq,22,8,"ng-template",null,13,fy),cn(20,Gq,12,5,"ng-template",null,14,fy)),2&e){const r=Ua(19),s=Ua(21);Je(2),dt("ngStyle",q1(7,qq,i.legInfoDataModel.legColor)),Je(1),tr(i.legInfoDataModel.leadingText),Je(8),hp("src",i.legInfoDataModel.legIconPath,xd),Je(2),tr(i.legInfoDataModel.walkingDistanceText),Je(2),dt("ngIf",i.legInfoDataModel.isWalking)("ngIfThen",s)("ngIfElse",r)}},dependencies:[Nl,na,WA,Nq],styles:[".pill-hover[_ngcontent-%COMP%]:hover, .location-hover[_ngcontent-%COMP%]:hover{cursor:pointer}.tooltip-list[_ngcontent-%COMP%]{margin-top:16px;margin-bottom:8px}.leg-left-side[_ngcontent-%COMP%]{width:50px}.leg-right-side[_ngcontent-%COMP%]{width:auto}.leg-leading-text[_ngcontent-%COMP%]{margin-bottom:2px}.leg-icon[_ngcontent-%COMP%]{width:40px;height:40px}.leg-location[_ngcontent-%COMP%]{background-color:transparent;margin-left:4px}.leg-time-wrapper[_ngcontent-%COMP%]{background-color:transparent}.leg-time[_ngcontent-%COMP%]{font-size:15px}.time-delay[_ngcontent-%COMP%]{color:#c45f00}"]}),n})();function Xq(n,t){1&n&&qn(0,"result-trip-leg",4),2&n&&dt("leg",t.$implicit)}let Zq=(()=>{class n{constructor(e){this.userTripService=e,this.tripHeaderStats={}}ngOnInit(){var e;this.trip&&this.initTripHeaderStats(this.trip),this.tripPanel&&0===this.idx&&this.tripPanel.open(),null===(e=this.tripPanel)||void 0===e||e.afterExpand.subscribe(r=>{this.trip&&this.userTripService.activeTripSelected.emit(this.trip)})}initTripHeaderStats(e){var i;this.tripHeaderStats.title="Trip "+((null!==(i=this.idx)&&void 0!==i?i:0)+1),this.tripHeaderStats.tripChangesInfo=0===e.stats.transferNo?"direct":1===e.stats.transferNo?e.stats.transferNo+" transfer":e.stats.transferNo+" transfers",this.tripHeaderStats.tripFromTime=_l.formatTimeHHMM(e.stats.startDatetime),this.tripHeaderStats.tripToTime=_l.formatTimeHHMM(e.stats.endDatetime),this.tripHeaderStats.tripDurationS=e.stats.duration.formatDuration(),this.tripHeaderStats.tripDistanceS=_l.formatDistance(e.stats.distanceMeters)}}return n.\u0275fac=function(e){return new(e||n)($(ju))},n.\u0275cmp=kn({type:n,selectors:[["journey-result-row"]],viewQuery:function(e,i){if(1&e&&mr(am,7),2&e){let r;zn(r=Vn())&&(i.tripPanel=r.first)}},inputs:{trip:"trip",idx:"idx"},decls:15,vars:8,consts:[[3,"hideToggle"],[1,"d-flex","justify-content-between","w-100","trip-info"],[1,"trip-info-header"],[3,"leg",4,"ngFor","ngForOf"],[3,"leg"]],template:function(e,i){1&e&&(Ee(0,"sbb-expansion-panel",0)(1,"sbb-expansion-panel-header")(2,"div",1)(3,"div")(4,"div",2),Pt(5),Pe(),Ee(6,"div"),Pt(7),Pe()(),Ee(8,"div",2)(9,"div"),Pt(10),Pe(),Ee(11,"div"),Pt(12),Pe()()()(),Ee(13,"div"),cn(14,Xq,1,1,"result-trip-leg",3),Pe()()),2&e&&(dt("hideToggle",!0),Je(5),G0("",i.tripHeaderStats.title," - ",i.tripHeaderStats.tripChangesInfo,""),Je(2),G0("",i.tripHeaderStats.tripDurationS," - ",i.tripHeaderStats.tripDistanceS,""),Je(3),tr(i.tripHeaderStats.tripFromTime),Je(2),tr(i.tripHeaderStats.tripToTime),Je(2),dt("ngForOf",null==i.trip?null:i.trip.legs))},dependencies:[Nl,am,Hw,Wq],styles:[".trip-info[_ngcontent-%COMP%]{font-size:14px}.trip-info-header[_ngcontent-%COMP%]{font-size:16px}"]}),n})();function Yq(n,t){if(1&n&&qn(0,"journey-result-row",1),2&n){const i=t.index;dt("trip",t.$implicit)("idx",i)}}let Qq=(()=>{class n{constructor(e){this.userTripService=e,this.trips=[]}ngOnInit(){this.userTripService.tripsUpdated.subscribe(e=>{this.trips=e}),this.userTripService.searchParamsReset.subscribe(()=>{this.trips=[]})}}return n.\u0275fac=function(e){return new(e||n)($(ju))},n.\u0275cmp=kn({type:n,selectors:[["journey-results"]],decls:2,vars:1,consts:[[3,"trip","idx",4,"ngFor","ngForOf"],[3,"trip","idx"]],template:function(e,i){1&e&&(Ee(0,"sbb-accordion"),cn(1,Yq,1,2,"journey-result-row",0),Pe()),2&e&&(Je(1),dt("ngForOf",i.trips))},dependencies:[Nl,qD,Zq],encapsulation:2}),n})();class dm{static formatMapboxLngLatAsLatLng(t){return t.lat.toFixed(6)+","+t.lng.toFixed(6)}static computePointLngLatFromFeature(t){if("Point"!==t.geometry.type)return null;const e=t.geometry.coordinates;return oa().LngLat.convert(e)}static bboxPxFromLngLatWidthPx(t,e,i,r=null){null===r&&(r=i);const s=t.project(e);return[[s.x-i/2,s.y+r/2],[s.x+i/2,s.y-r/2]]}static areBoundsInsideOtherBounds(t,e){return!(t.getWest()<e.getWest()||t.getNorth()>e.getNorth()||t.getEast()>e.getEast()||t.getSouth()<e.getSouth())}static queryNearbyFeatureByLayerIDs(t,e,i){const r=dm.bboxPxFromLngLatWidthPx(t,e,30),s=t.queryRenderedFeatures(r,{layers:i});let d=null;return s.forEach(m=>{const v=dm.computePointLngLatFromFeature(m);if(null===v)return;const D=e.distanceTo(v);(null===d||D<d.distance)&&(d={feature:m,distance:D})}),d}}class iL{constructor(t){this.map=t,this.container=null,this.debugCenterEl=null,this.debugZoomEl=null}onAdd(t){return this.map=t,this.container=document.createElement("div"),this.container.className="mapboxgl-ctrl mapboxgl-ctrl-group map-control",this.container.innerHTML=document.getElementById("map-debug-control").innerHTML,t.on("move",()=>{this.updateDebugCenter()}),t.on("zoom",()=>{this.updateDebugZoom()}),setTimeout(()=>{this.debugCenterEl=document.getElementById("map_debug_center"),this.debugZoomEl=document.getElementById("map_debug_zoom"),this.updateDebugZoom(),this.updateDebugCenter()},200),this.container}onRemove(){this.map=null,this.container=null}updateDebugZoom(){!this.map||!this.debugZoomEl||(this.debugZoomEl.innerText=this.map.getZoom().toFixed(2).toString())}updateDebugCenter(){if(!this.map||!this.debugCenterEl)return;const t=this.map.getCenter().toArray().map(e=>e.toFixed(6));this.debugCenterEl.innerText=t.join(",")}}class rL{static prettyPrintXML(t){var e=(new DOMParser).parseFromString(t,"application/xml"),i=(new DOMParser).parseFromString(['<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform">','  <xsl:strip-space elements="*"/>','  <xsl:template match="para[content-style][not(text())]">','    <xsl:value-of select="normalize-space(.)"/>',"  </xsl:template>",'  <xsl:template match="node()|@*">','    <xsl:copy><xsl:apply-templates select="node()|@*"/></xsl:copy>',"  </xsl:template>",'  <xsl:output indent="yes"/>',"</xsl:stylesheet>"].join("\n"),"application/xml");try{var r=new XSLTProcessor;r.importStylesheet(i);var s=r.transformToDocument(e);return(new XMLSerializer).serializeToString(s)}catch(m){return console.error("XML_Helpers.prettyPrintXML - fails, see TODO"),t}}}function Kq(n,t){}function Jq(n,t){}function eW(n,t){1&n&&(Ee(0,"button",1),qn(1,"sbb-icon",2),Pe()),2&n&&dt("aria-label",Fn().closeAriaLabel)}const tW=["*"];class Ww{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.ariaModal=!0,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.closeOnNavigation=!0,this.closeOnDestroy=!0}}let oL=(()=>{class n extends Qy{constructor(e,i,r,s,d,m,v,D){super(),this._elementRef=e,this._focusTrapFactory=i,this._config=s,this._interactivityChecker=d,this._ngZone=m,this._overlayRef=v,this._focusMonitor=D,this._elementFocusedBeforeDialogWasOpened=null,this._closeInteractionType=null,this.attachDomPortal=A=>{this._portalOutlet.hasAttached();const L=this._portalOutlet.attachDomPortal(A);return this._contentAttached(),L},this._ariaLabelledBy=this._config.ariaLabelledBy||null,this._document=r}_contentAttached(){this._initializeFocusTrap(),this._handleBackdropClicks(),this._captureInitialFocus()}_captureInitialFocus(){this._trapFocus()}ngOnDestroy(){this._restoreFocus()}attachComponentPortal(e){this._portalOutlet.hasAttached();const i=this._portalOutlet.attachComponentPortal(e);return this._contentAttached(),i}attachTemplatePortal(e){this._portalOutlet.hasAttached();const i=this._portalOutlet.attachTemplatePortal(e);return this._contentAttached(),i}_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(e,i){this._interactivityChecker.isFocusable(e)||(e.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{const r=()=>{e.removeEventListener("blur",r),e.removeEventListener("mousedown",r),e.removeAttribute("tabindex")};e.addEventListener("blur",r),e.addEventListener("mousedown",r)})),e.focus(i)}_focusByCssSelector(e,i){let r=this._elementRef.nativeElement.querySelector(e);r&&this._forceFocus(r,i)}_trapFocus(){const e=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||e.focus();break;case!0:case"first-tabbable":this._focusTrap.focusInitialElementWhenReady().then(i=>{i||this._focusDialogContainer()});break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this._config.autoFocus)}}_restoreFocus(){const e=this._config.restoreFocus;let i=null;if("string"==typeof e?i=this._document.querySelector(e):"boolean"==typeof e?i=e?this._elementFocusedBeforeDialogWasOpened:null:e&&(i=e),this._config.restoreFocus&&i&&"function"==typeof i.focus){const r=tu(),s=this._elementRef.nativeElement;(!r||r===this._document.body||r===s||s.contains(r))&&(this._focusMonitor?(this._focusMonitor.focusVia(i,this._closeInteractionType),this._closeInteractionType=null):i.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){const e=this._elementRef.nativeElement,i=tu();return e===i||e.contains(i)}_initializeFocusTrap(){this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=tu())}_handleBackdropClicks(){this._overlayRef.backdropClick().subscribe(()=>{this._config.disableClose&&this._recaptureFocus()})}}return n.\u0275fac=function(e){return new(e||n)($(Pn),$(tb),$(si,8),$(Ww),$(rm),$(oi),$(Op),$(Da))},n.\u0275cmp=kn({type:n,selectors:[["cdk-dialog-container"]],viewQuery:function(e,i){if(1&e&&mr(Hu,7),2&e){let r;zn(r=Vn())&&(i._portalOutlet=r.first)}},hostAttrs:["tabindex","-1",1,"cdk-dialog-container"],hostVars:6,hostBindings:function(e,i){2&e&&Ht("id",i._config.id||null)("role",i._config.role)("aria-modal",i._config.ariaModal)("aria-labelledby",i._config.ariaLabel?null:i._ariaLabelledBy)("aria-label",i._config.ariaLabel)("aria-describedby",i._config.ariaDescribedBy||null)},features:[ut],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(e,i){1&e&&cn(0,Kq,0,0,"ng-template",0)},dependencies:[Hu],styles:[".cdk-dialog-container{display:block;width:100%;height:100%;min-height:inherit;max-height:inherit}"],encapsulation:2}),n})();class KD{constructor(t,e){this.overlayRef=t,this.config=e,this.closed=new Qt,this.disableClose=e.disableClose,this.backdropClick=t.backdropClick(),this.keydownEvents=t.keydownEvents(),this.outsidePointerEvents=t.outsidePointerEvents(),this.id=e.id,this.keydownEvents.subscribe(i=>{27===i.keyCode&&!this.disableClose&&!aa(i)&&(i.preventDefault(),this.close(void 0,{focusOrigin:"keyboard"}))}),this.backdropClick.subscribe(()=>{this.disableClose||this.close(void 0,{focusOrigin:"mouse"})})}close(t,e){if(this.containerInstance){const i=this.closed;this.containerInstance._closeInteractionType=(null==e?void 0:e.focusOrigin)||"program",this.overlayRef.dispose(),i.next(t),i.complete(),this.componentInstance=this.containerInstance=null}}updatePosition(){return this.overlayRef.updatePosition(),this}updateSize(t="",e=""){return this.overlayRef.updateSize({width:t,height:e}),this}addPanelClass(t){return this.overlayRef.addPanelClass(t),this}removePanelClass(t){return this.overlayRef.removePanelClass(t),this}}const sL=new bt("DialogScrollStrategy"),nW=new bt("DialogData"),iW=new bt("DefaultDialogConfig"),oW={provide:sL,deps:[$o],useFactory:function rW(n){return()=>n.scrollStrategies.block()}};let sW=0,aL=(()=>{class n{constructor(e,i,r,s,d,m){this._overlay=e,this._injector=i,this._defaultOptions=r,this._parentDialog=s,this._overlayContainer=d,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new Qt,this._afterOpenedAtThisLevel=new Qt,this._ariaHiddenElements=new Map,this.afterAllClosed=Wf(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(Us(void 0))),this._scrollStrategy=m}get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}open(e,i){const r=this._defaultOptions||new Ww;(i=Object.assign(Object.assign({},r),i)).id=i.id||"cdk-dialog-"+sW++,i.id&&this.getDialogById(i.id);const s=this._getOverlayConfig(i),d=this._overlay.create(s),m=new KD(d,i),v=this._attachContainer(d,m,i);return m.containerInstance=v,this._attachDialogContent(e,m,v,i),this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(m),m.closed.subscribe(()=>this._removeOpenDialog(m,!0)),this.afterOpened.next(m),m}closeAll(){JD(this.openDialogs,e=>e.close())}getDialogById(e){return this.openDialogs.find(i=>i.id===e)}ngOnDestroy(){JD(this._openDialogsAtThisLevel,e=>{!1===e.config.closeOnDestroy&&this._removeOpenDialog(e,!1)}),JD(this._openDialogsAtThisLevel,e=>e.close()),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete(),this._openDialogsAtThisLevel=[]}_getOverlayConfig(e){const i=new cm({positionStrategy:e.positionStrategy||this._overlay.position().global().centerHorizontally().centerVertically(),scrollStrategy:e.scrollStrategy||this._scrollStrategy(),panelClass:e.panelClass,hasBackdrop:e.hasBackdrop,direction:e.direction,minWidth:e.minWidth,minHeight:e.minHeight,maxWidth:e.maxWidth,maxHeight:e.maxHeight,width:e.width,height:e.height,disposeOnNavigation:e.closeOnNavigation});return e.backdropClass&&(i.backdropClass=e.backdropClass),i}_attachContainer(e,i,r){var s,d;const m=null!==(s=r.injector)&&void 0!==s?s:null===(d=r.viewContainerRef)||void 0===d?void 0:d.injector,v=[{provide:Ww,useValue:r},{provide:KD,useValue:i},{provide:Op,useValue:e}];let D;r.container?"function"==typeof r.container?D=r.container:(D=r.container.type,v.push(...r.container.providers(r))):D=oL;const A=new Uu(D,r.viewContainerRef,xr.create({parent:m||this._injector,providers:v}),r.componentFactoryResolver);return e.attach(A).instance}_attachDialogContent(e,i,r,s){const d=this._createInjector(s,i,r);if(e instanceof eo){let m={$implicit:s.data,dialogRef:i};s.templateContext&&(m=Object.assign(Object.assign({},m),"function"==typeof s.templateContext?s.templateContext():s.templateContext)),r.attachTemplatePortal(new em(e,null,m,d))}else{const m=r.attachComponentPortal(new Uu(e,s.viewContainerRef,d,s.componentFactoryResolver));i.componentInstance=m.instance}}_createInjector(e,i,r){const s=e&&e.viewContainerRef&&e.viewContainerRef.injector,d=[{provide:nW,useValue:e.data},{provide:KD,useValue:i}];return e.providers&&("function"==typeof e.providers?d.push(...e.providers(i,e,r)):d.push(...e.providers)),e.direction&&(!s||!s.get(Pp,null,Yn.Optional))&&d.push({provide:Pp,useValue:{value:e.direction,change:ei()}}),xr.create({parent:s||this._injector,providers:d})}_removeOpenDialog(e,i){const r=this.openDialogs.indexOf(e);r>-1&&(this.openDialogs.splice(r,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((s,d)=>{s?d.setAttribute("aria-hidden",s):d.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),i&&this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){const e=this._overlayContainer.getContainerElement();if(e.parentElement){const i=e.parentElement.children;for(let r=i.length-1;r>-1;r--){const s=i[r];s!==e&&"SCRIPT"!==s.nodeName&&"STYLE"!==s.nodeName&&!s.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(s,s.getAttribute("aria-hidden")),s.setAttribute("aria-hidden","true"))}}}_getAfterAllClosed(){const e=this._parentDialog;return e?e._getAfterAllClosed():this._afterAllClosedAtThisLevel}}return n.\u0275fac=function(e){return new(e||n)(Be($o),Be(xr),Be(iW,8),Be(n,12),Be(rb),Be(sL))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();function JD(n,t){let e=n.length;for(;e--;)t(n[e])}let aW=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({providers:[aL,oW],imports:[yl,sa,om,sa]}),n})();const ob={params:{enterAnimationDuration:"150ms",exitAnimationDuration:"75ms"}},lW={dialogContainer:ks("dialogContainer",[gr("void, exit",Nn({opacity:0,transform:"scale(0.7)"})),gr("enter",Nn({transform:"none"})),$i("* => enter",Sk([Yi("{{enterAnimationDuration}} cubic-bezier(0, 0, 0.2, 1)",Nn({transform:"none",opacity:1})),NC("@*",FC(),{optional:!0})]),ob),$i("* => void, * => exit",Sk([Yi("{{exitAnimationDuration}} cubic-bezier(0.4, 0.0, 0.2, 1)",Nn({opacity:0})),NC("@*",FC(),{optional:!0})]),ob)])};class rv{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.maxWidth="80vw",this.maxHeight="96vh",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.autoFocus=!0,this.restoreFocus=!0,this.delayFocusTrap=!1,this.closeOnNavigation=!0,this.enterAnimationDuration=ob.params.enterAnimationDuration,this.exitAnimationDuration=ob.params.exitAnimationDuration}}let lL=(()=>{class n extends oL{constructor(e,i,r,s,d,m,v,D){super(e,i,r,s,d,m,v,D),this._animationStateChanged=new Xt,this._state="enter"}_captureInitialFocus(){this._config.delayFocusTrap||this._trapFocus()}_getAnimationState(){return{value:this._state,params:{enterAnimationDuration:this._config.enterAnimationDuration||ob.params.enterAnimationDuration,exitAnimationDuration:this._config.exitAnimationDuration||ob.params.exitAnimationDuration}}}_openAnimationDone(e){this._config.delayFocusTrap&&this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:e})}}return n.\u0275fac=function(e){return new(e||n)($(Pn),$(tb),$(si,8),$(rv),$(rm),$(oi),$(Op),$(Da))},n.\u0275cmp=kn({type:n,selectors:[["ng-component"]],features:[ut],decls:0,vars:0,template:function(e,i){},encapsulation:2}),n})(),cW=(()=>{class n extends lL{constructor(e,i,r,s,d,m,v,D,A){super(e,i,r,s,d,m,v,A),this._changeDetectorRef=D}_onAnimationDone({toState:e,totalTime:i}){"enter"===e?this._openAnimationDone(i):"exit"===e&&this._animationStateChanged.next({state:"closed",totalTime:i})}_onAnimationStart({toState:e,totalTime:i}){"enter"===e?this._animationStateChanged.next({state:"opening",totalTime:i}):("exit"===e||"void"===e)&&this._animationStateChanged.next({state:"closing",totalTime:i})}_startExitAnimation(){this._state="exit",this._changeDetectorRef.markForCheck()}}return n.\u0275fac=function(e){return new(e||n)($(Pn),$(tb),$(si,8),$(rv),$(rm),$(oi),$(Op),$(Dr),$(Da))},n.\u0275cmp=kn({type:n,selectors:[["sbb-dialog-container"]],hostAttrs:["tabindex","-1","aria-modal","true",1,"sbb-dialog-container"],hostVars:6,hostBindings:function(e,i){1&e&&iy("@dialogContainer.done",function(s){return i._onAnimationDone(s)})("@dialogContainer.start",function(s){return i._onAnimationStart(s)}),2&e&&(uc("id",i._config.id),Ht("role",i._config.role)("aria-labelledby",i._config.ariaLabel?null:i._ariaLabelledBy)("aria-label",i._config.ariaLabel)("aria-describedby",i._config.ariaDescribedBy||null),oy("@dialogContainer",i._getAnimationState()))},features:[ut],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(e,i){1&e&&cn(0,Jq,0,0,"ng-template",0)},dependencies:[Hu],styles:[".sbb-overlay-background{background-color:var(--sbb-color-white-alpha70);align-items:center}.sbb-dialog-container{display:flex;flex-direction:column;border:var(--sbb-border-width) solid var(--sbb-color-weak-accent);box-sizing:border-box;overflow:hidden;outline:0;background-color:var(--sbb-color-background);box-shadow:var(--sbb-box-shadow-below);width:100%;height:100%;min-height:inherit;max-height:inherit}.cdk-high-contrast-active .sbb-dialog-container{outline:solid .0666666667rem}.sbb-dialog-container>*:only-child:not(.sbb-dialog-content){width:100%;height:100%;display:flex;flex-direction:column}.sbb-dialog-content{display:block;padding:var(--sbb-dialog-padding);flex:1 1 auto;max-height:80vh;overflow:auto;-webkit-overflow-scrolling:touch}.sbb-dialog-content>*:first-child{margin-top:0}.sbb-dialog-title{font-size:var(--sbb-font-size);padding:calc(1rem * var(--sbb-scaling-factor)) calc(2.6666666667rem * var(--sbb-scaling-factor)) calc(1rem * var(--sbb-scaling-factor)) var(--sbb-dialog-padding);flex:0 0 auto;display:block;position:relative;box-shadow:var(--sbb-box-shadow-horizontal-border-top);overflow:hidden;white-space:nowrap;text-overflow:ellipsis;min-height:calc(3.5333333333rem * var(--sbb-scaling-factor))}.sbb-dialog-title-close-button{position:absolute;right:calc(1.0666666667rem * var(--sbb-scaling-factor));cursor:pointer;line-height:0}.sbb-dialog-title-close-button:is(:hover,:focus){color:var(--sbb-color-call-to-action-hover)}.sbb-dialog-actions{padding:calc(0.4666666667rem * var(--sbb-scaling-factor)) calc(1.0666666667rem * var(--sbb-scaling-factor));display:flex;flex:0 0 auto;flex-wrap:wrap;gap:var(--sbb-button-gap);align-items:center;box-sizing:content-box;box-shadow:var(--sbb-box-shadow-horizontal-border-bottom)}.sbb-dialog-actions.sbb-dialog-actions-align-start,.sbb-dialog-actions[align=start],.sbb-dialog-actions[align=left]{justify-content:flex-start}.sbb-dialog-actions.sbb-dialog-actions-align-center,.sbb-dialog-actions[align=center]{justify-content:center}.sbb-dialog-actions.sbb-dialog-actions-align-end,.sbb-dialog-actions[align=end]{justify-content:flex-end}"],encapsulation:2,data:{animation:[lW.dialogContainer]}}),n})();class Xw{constructor(t,e,i){this.ref=t,this._containerInstance=i,this._afterOpened=new Qt,this._beforeClosed=new Qt,this._state=0,this.disableClose=e.disableClose,this.id=t.id,i._animationStateChanged.pipe(Er(r=>"opened"===r.state),Hr(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),i._animationStateChanged.pipe(Er(r=>"closed"===r.state),Hr(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._finishDialogClose()}),t.overlayRef.detachments().subscribe(()=>{this._beforeClosed.next(this._result),this._beforeClosed.complete(),this._finishDialogClose()}),rr(this.backdropClick(),this.keydownEvents().pipe(Er(r=>27===r.keyCode&&!this.disableClose&&!aa(r)))).subscribe(r=>{this.disableClose||(r.preventDefault(),cL(this,"keydown"===r.type?"keyboard":"mouse"))})}close(t){this._result=t,this._containerInstance._animationStateChanged.pipe(Er(e=>"closing"===e.state),Hr(1)).subscribe(e=>{this._beforeClosed.next(t),this._beforeClosed.complete(),this.ref.overlayRef.detachBackdrop(),this._closeFallbackTimeout=setTimeout(()=>this._finishDialogClose(),e.totalTime+100)}),this._state=1,this._containerInstance._startExitAnimation()}afterOpened(){return this._afterOpened}afterClosed(){return this.ref.closed}beforeClosed(){return this._beforeClosed}backdropClick(){return this.ref.backdropClick}keydownEvents(){return this.ref.keydownEvents}updatePosition(t){const e=this.ref.config.positionStrategy;return t&&(t.left||t.right)?t.left?e.left(t.left):e.right(t.right):e.centerHorizontally(),t&&(t.top||t.bottom)?t.top?e.top(t.top):e.bottom(t.bottom):e.centerVertically(),this.ref.updatePosition(),this}updateSize(t="",e=""){return this.ref.updateSize(t,e),this}addPanelClass(t){return this.ref.addPanelClass(t),this}removePanelClass(t){return this.ref.removePanelClass(t),this}getState(){return this._state}_finishDialogClose(){this._state=2,this.ref.close(this._result,{focusOrigin:this._closeInteractionType}),this.componentInstance=null}}function cL(n,t,e){return n._closeInteractionType=t,n.close(e)}const uW=new bt("SbbDialogData"),dW=new bt("sbb-dialog-default-options"),uL=new bt("sbb-dialog-scroll-strategy"),pW={provide:uL,deps:[$o],useFactory:function hW(n){return()=>n.scrollStrategies.block()}};let fW=0,dL=(()=>{class n{constructor(e,i,r,s,d,m,v,D,A){this._overlay=e,this._defaultOptions=r,this._parentDialog=s,this._dialogRefConstructor=v,this._dialogContainerType=D,this._dialogDataToken=A,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new Qt,this._afterOpenedAtThisLevel=new Qt,this._idPrefix="sbb-dialog-",this.afterAllClosed=Wf(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(Us(void 0))),this._scrollStrategy=m,this._dialog=i.get(aL)}get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}_getAfterAllClosed(){const e=this._parentDialog;return e?e._getAfterAllClosed():this._afterAllClosedAtThisLevel}open(e,i){let r;(i=Object.assign(Object.assign({},this._defaultOptions||new rv),i)).id=i.id||`${this._idPrefix}${fW++}`,i.scrollStrategy=i.scrollStrategy||this._scrollStrategy(),i.backdropClass=i.backdropClass||"sbb-overlay-background";const s=this._dialog.open(e,Object.assign(Object.assign({},i),{positionStrategy:this._overlay.position().global().centerHorizontally().centerVertically(),disableClose:!0,closeOnDestroy:!1,container:{type:this._dialogContainerType,providers:()=>[{provide:rv,useValue:i},{provide:Ww,useValue:i}]},templateContext:()=>({dialogRef:r,lightboxRef:r}),providers:(d,m,v)=>(r=new this._dialogRefConstructor(d,i,v),r.updatePosition(null==i?void 0:i.position),[{provide:this._dialogContainerType,useValue:v},{provide:this._dialogDataToken,useValue:m.data},{provide:this._dialogRefConstructor,useValue:r}])}));return r.componentInstance=s.componentInstance,this.openDialogs.push(r),this.afterOpened.next(r),r.afterClosed().subscribe(()=>{const d=this.openDialogs.indexOf(r);d>-1&&(this.openDialogs.splice(d,1),this.openDialogs.length||this._getAfterAllClosed().next())}),r}closeAll(){this._closeDialogs(this.openDialogs)}getDialogById(e){return this.openDialogs.find(i=>i.id===e)}ngOnDestroy(){this._closeDialogs(this._openDialogsAtThisLevel),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete()}_closeDialogs(e){let i=e.length;for(;i--;)e[i].close()}}return n.\u0275fac=function(e){zs()},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})(),Lp=(()=>{class n extends dL{constructor(e,i,r,s,d,m){super(e,i,r,d,m,s,Xw,cW,uW)}}return n.\u0275fac=function(e){return new(e||n)(Be($o),Be(xr),Be(dW,8),Be(uL),Be(n,12),Be(rb))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})(),mW=0,eE=(()=>{class n{constructor(e,i,r){this._dialogRef=e,this._elementRef=i,this._dialog=r,this.ariaLabel=$localize`:Aria label to close a dialog@@sbbDialogCloseDialog:Close dialog`,this.type="button",this._canCloseInterceptor=()=>!0}ngOnInit(){this._dialogRef||(this._dialogRef=mL(this._elementRef,this._dialog.openDialogs))}ngOnChanges(e){const i=e._sbbDialogClose||e._sbbDialogCloseResult;i&&(this.dialogResult=i.currentValue)}_onButtonClick(e){!this._canCloseInterceptor()||cL(this._dialogRef,0===e.screenX&&0===e.screenY?"keyboard":"mouse",this.dialogResult)}}return n.\u0275fac=function(e){return new(e||n)($(Xw,8),$(Pn),$(Lp))},n.\u0275dir=vt({type:n,selectors:[["","sbb-dialog-close",""],["","sbbDialogClose",""]],hostVars:2,hostBindings:function(e,i){1&e&&Wt("click",function(s){return i._onButtonClick(s)}),2&e&&Ht("aria-label",i.ariaLabel||null)("type",i.type)},inputs:{ariaLabel:["aria-label","ariaLabel"],type:"type",dialogResult:["sbb-dialog-close","dialogResult"],_sbbDialogClose:["sbbDialogClose","_sbbDialogClose"]},exportAs:["sbbDialogClose"],features:[dr]}),n})(),gW=(()=>{class n{constructor(e,i,r,s){this._dialogRef=e,this._elementRef=i,this._dialog=r,this._changeDetectorRef=s,this.id="sbb-dialog-title-"+mW++,this.closeAriaLabel=$localize`:Aria label to close a dialog@@sbbDialogCloseDialog:Close dialog`,this._closeEnabled=!0}ngOnInit(){this._dialogRef||(this._dialogRef=mL(this._elementRef,this._dialog.openDialogs)),this._dialogRef&&Promise.resolve().then(()=>{const e=this._dialogRef._containerInstance;!e||(e._config.disableClose&&(this._closeEnabled=!1,this._changeDetectorRef.markForCheck()),e._ariaLabelledBy||(e._ariaLabelledBy=this.id))})}}return n.\u0275fac=function(e){return new(e||n)($(Xw,8),$(Pn),$(Lp),$(Dr))},n.\u0275dir=vt({type:n,inputs:{id:"id",closeAriaLabel:"closeAriaLabel"}}),n})(),hL=(()=>{class n extends gW{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=ui(n)))(i||n)}}(),n.\u0275cmp=kn({type:n,selectors:[["sbb-dialog-title"],["","sbb-dialog-title",""],["","sbbDialogTitle",""]],hostAttrs:[1,"sbb-dialog-title"],hostVars:1,hostBindings:function(e,i){2&e&&uc("id",i.id)},exportAs:["sbbDialogTitle"],features:[ut],ngContentSelectors:tW,decls:2,vars:1,consts:[["sbb-dialog-close","","class","sbb-dialog-title-close-button sbb-button-reset-frameless",3,"aria-label",4,"ngIf"],["sbb-dialog-close","",1,"sbb-dialog-title-close-button","sbb-button-reset-frameless",3,"aria-label"],["svgIcon","kom:cross-small"]],template:function(e,i){1&e&&(Ro(),Lr(0),cn(1,eW,2,1,"button",0)),2&e&&(Je(1),dt("ngIf",i._closeEnabled))},dependencies:[na,Xa,eE],encapsulation:2,changeDetection:0}),n})(),pL=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=vt({type:n,selectors:[["","sbb-dialog-content",""],["sbb-dialog-content"],["","sbbDialogContent",""]],hostAttrs:[1,"sbb-dialog-content","sbb-scrollbar"]}),n})(),fL=(()=>{class n{constructor(){this.align="end"}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=vt({type:n,selectors:[["","sbb-dialog-actions",""],["sbb-dialog-actions"],["","sbbDialogActions",""]],hostAttrs:[1,"sbb-dialog-actions"],hostVars:6,hostBindings:function(e,i){2&e&&Oi("sbb-dialog-actions-align-start","start"===i.align)("sbb-dialog-actions-align-center","center"===i.align)("sbb-dialog-actions-align-end","end"===i.align)},inputs:{align:"align"}}),n})();function mL(n,t){let e=n.nativeElement.parentElement;for(;e&&!e.classList.contains("sbb-dialog-container")&&!e.classList.contains("sbb-lightbox-container");)e=e.parentElement;return e?t.find(i=>i.id===e.id):null}let gL=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({providers:[Lp,pW],imports:[wr,aW,yl,sa,Gi,bo]}),n})(),tE=(()=>{class n{constructor(){this.requestXmlS="n/a",this.responseXmlS="n/a"}updateRequestData(e){this.requestXmlS=e&&e.requestXmlS?rL.prettyPrintXML(e.requestXmlS):"n/a",this.responseXmlS=e&&e.responseXmlS?rL.prettyPrintXML(e.responseXmlS):"n/a"}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=kn({type:n,selectors:[["debug-xml-popover"]],decls:15,vars:2,consts:[["sbbDialogTitle",""],["sbbDialogContent",""],[2,"width","500px"],["rows","7",1,"w-100"],["sbbDialogActions",""],["type","button","sbbDialogClose","",1,"btn","btn-secondary"]],template:function(e,i){1&e&&(Ee(0,"div",0),Pt(1,"Debug XML"),Pe(),Ee(2,"div",1)(3,"div",2)(4,"div"),Pt(5," Request XML "),Ee(6,"textarea",3),Pt(7),Pe()(),Ee(8,"div"),Pt(9," Response XML "),Ee(10,"textarea",3),Pt(11),Pe()()()(),Ee(12,"div",4)(13,"button",5),Pt(14," Close "),Pe()()),2&e&&(Je(7),tr(i.requestXmlS),Je(4),tr(i.responseXmlS))},dependencies:[eE,hL,pL,fL],encapsulation:2}),n})();const bW=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"circle","minzoom":0,"paint":{"circle-color":"#0000FF","circle-radius":4,"circle-stroke-width":1,"circle-stroke-color":"#fff"}}'),_W=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":14.5,"layout":{"text-field":"{stopPlace.stopPlaceName} \\n {stopPlace.stopPlaceRefLabel}","text-size":12,"text-justify":"left","text-anchor":"top-left","text-offset":[0.2,0.2]},"paint":{"text-halo-color":"rgba(241, 231, 231, 1)","text-halo-width":1}}'),yW=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"circle","minzoom":0,"paint":{"circle-color":"#eb0000","circle-radius":4,"circle-stroke-width":1,"circle-stroke-color":"#fff"}}'),bL={"stops-circle":bW,"stops-label":_W,"charging-station-icon":JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":0,"layout":{"icon-image":"poi-charging-station","icon-allow-overlap":true,"icon-size":0.5}}'),"address-circle":yW,"car-rental-icon":JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":0,"layout":{"icon-image":"car-15","icon-allow-overlap":true,"icon-size":1.4}}'),"bike-icon":JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":0,"layout":{"icon-image":"bicycle-15","icon-allow-overlap":true,"icon-size":1.4}}'),"scooter-icon":JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":0,"layout":{"icon-image":"poi-scooter","icon-allow-overlap":true,"icon-size":0.4}}'),"poi-all":JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":0,"layout":{"icon-image":["get","style.icon-image"],"icon-allow-overlap":true,"icon-size":0.4}}')};var ov=(()=>{return(n=ov||(ov={})).OJP_GeoRestrictionType="OJP.GeoRestrictionType",n.OJP_GeoRestrictionPoiOSMTag="OJP.GeoRestrictionPoiOSMTag",ov;var n})();class _L{constructor(t,e,i,r){this.layerKey=t,this.map=e,this.geoRestrictionType=i.LIR_Restriction_Type,this.geoRestrictionPoiOSMTags=i.LIR_POI_Type?Array.isArray(i.LIR_POI_Type)?i.LIR_POI_Type:[i.LIR_POI_Type]:null,this.minZoom=i.minZoom,this.features=[],this.mapSourceID=t+"-map-src",this.userTripService=r,this.isEnabled=!1,this.lastOJPRequest=null,this.addMapSourceAndLayers()}addMapSourceAndLayers(){var t;this.map.addSource(this.mapSourceID,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this.layerKey in Sp.map_app_map_layers?(null!==(t=Sp.map_app_map_layers[this.layerKey].layer_ids)&&void 0!==t?t:[this.layerKey]).forEach(r=>{if(!(r in bL))return void console.error("ERROR - AppMapLayer.addMapSourceAndLayers no layer def for "+r);const d=JSON.parse(JSON.stringify(bL[r]));d.id=r,d.source=this.mapSourceID,this.map.addLayer(d)}):console.error("ERROR - AppMapLayer.addMapSourceAndLayers no layers defined for "+this.layerKey)}shouldLoadNewFeatures(){return!(!this.isEnabled||this.map.getZoom()<this.minZoom)}refreshFeatures(){if(!this.shouldLoadNewFeatures())return void this.removeAllFeatures();const t="poi_all"===this.geoRestrictionType?1e3:300,e=this.map.getBounds(),i=this.userTripService.getStageConfig(),r=eu.initWithBBOXAndType(i,e.getWest(),e.getNorth(),e.getEast(),e.getSouth(),this.geoRestrictionType,t,this.geoRestrictionPoiOSMTags);this.lastOJPRequest=r;const s=Sp.map_app_map_layers[this.layerKey];r.fetchResponse().then(d=>{this.shouldLoadNewFeatures()||this.removeAllFeatures();const m=[];d.forEach(v=>{const D=this.computeFeatureFromLocation(v);null!==D&&(v.poi&&D.properties&&"poi_all"===s.LIR_Restriction_Type&&(D.properties["style.icon-image"]=v.poi.computePoiMapIcon()),m.push(D))}),this.setSourceFeatures(m)}).catch(d=>{console.log("AppMapLayer: "+this.layerKey+" backend ERROR"),console.log(d)})}removeAllFeatures(){0!==this.features.length&&this.setSourceFeatures([])}handleMapClick(t){var e,i;if(!this.shouldLoadNewFeatures())return!1;const r=Sp.map_app_map_layers[this.layerKey];let s=null!==(e=r.click_layer_ids)&&void 0!==e?e:[];if(0===s.length)return!1;"SAME_AS_LAYER_IDS"===s&&(s=null!==(i=r.layer_ids)&&void 0!==i?i:[this.layerKey]);const d=dm.queryNearbyFeatureByLayerIDs(this.map,t.lngLat,s);if(d){const m=Ho.initWithFeature(d.feature);return m&&this.showPickupPopup(m),!0}return!1}showPickupPopup(t){var e,i;const r=null!==(i=null===(e=t.geoPosition)||void 0===e?void 0:e.asLngLat())&&void 0!==i?i:null;if(null===r)return;const s=this.computePopupHTML(t);if(null===s)return;const d=document.createElement("div");d.innerHTML=s;const m=new(oa().Popup)({focusAfterOpen:!1,maxWidth:"400px"});d.addEventListener("click",v=>{const A=v.target.getAttribute("data-endpoint-type");null!==A&&(this.userTripService.updateTripEndpoint(t,A,"MapPopupClick"),m.remove())}),m.setLngLat(r).setDOMContent(d).addTo(this.map)}computePopupHTML(t){var e,i,r,s;if("poi_all"===this.geoRestrictionType){const L=this.computePOIPopupHTML(t);if(L)return L}const d=document.getElementById("map-endpoint-picker-popup");if(null===d)return null;let m=d.innerHTML;m=m.replace("[GEO_RESTRICTION_TYPE]",this.geoRestrictionType);const v=null!==(s=null!==(i=null===(e=t.geoPosition)||void 0===e?void 0:e.properties)&&void 0!==i?i:null===(r=t.asGeoJSONFeature())||void 0===r?void 0:r.properties)&&void 0!==s?s:null;if(null==v)return m=m.replace("[GEOJSON_PROPERTIES_TABLE]","ERROR: cant read GeoJSON properties"),m;const D=[];for(let L in v){let j=v[L];if("string"==typeof j){const ie=new String(j);ie.startsWith("http")&&(j='<a href="'+ie+'" target="_blank">'+ie+"</a>")}D.push("<tr><td>"+L+"</td><td>"+j+"</td></tr>")}const A='<table class="table">'+D.join("")+"</table>";return m=m.replace("[GEOJSON_PROPERTIES_TABLE]",A),m}computePOIPopupHTML(t){var e,i;const r=document.getElementById("map-poi-picker-popup");if(null===r)return null;const s=null!==(i=null===(e=t.geoPosition)||void 0===e?void 0:e.properties)&&void 0!==i?i:null;if(null===s)return null;let d=r.innerHTML;d=d.replace("[POI_NAME]",s["poi.name"]);const m=[];m.push("<tr><td>Code</td><td>"+s["poi.code"].substring(0,20)+"...</td></tr>"),m.push("<tr><td>Category</td><td>"+s["poi.category"]+"</td></tr>"),m.push("<tr><td>SubCategory</td><td>"+s["poi.subcategory"]+"</td></tr>");const v='<table class="table">'+m.join("")+"</table>";return d=d.replace("[GEOJSON_PROPERTIES_TABLE]",v),d}setSourceFeatures(t){this.features=t,this.map.getSource(this.mapSourceID).setData({type:"FeatureCollection",features:t})}computeFeatureFromLocation(t){var e;const i=t.asGeoJSONFeature();return"stop"===this.geoRestrictionType&&this._patchStopFeature(i),null!=i&&i.properties&&(i.properties[ov.OJP_GeoRestrictionType]=this.geoRestrictionType,i.properties[ov.OJP_GeoRestrictionPoiOSMTag]=null===(e=this.geoRestrictionPoiOSMTags)||void 0===e?void 0:e.join(",")),i}_patchStopFeature(t){if(null===t||null===t.properties)return;const e=t.properties["stopPlace.stopPlaceRef"];let i=e.slice();i.length>32&&(i=e.substring(0,32)+"..."),t.properties["stopPlace.stopPlaceRefLabel"]=i}}class yL{constructor(t,e,i){this.debugXmlPopover=e,this.prevMapBoundsHash="",this.map=t,this.layersData=[],this.userTripService=i}onAdd(t){this.map=t;const e=document.createElement("div");return e.className="mapboxgl-ctrl mapboxgl-ctrl-group map-control",e.innerHTML=document.getElementById("map-layers-legend-control").innerHTML,this.addLayers(e,t),this.addPOICompositeLayers(e,t),t.on("zoom",i=>{this.onZoomChanged(t)}),this.onZoomChanged(t),t.on("idle",i=>{this.handleMapIdleEvents(t)}),t.on("click",i=>{this.handleMapClickEvents(i,t)}),e}onRemove(){this.map=null}addLayers(t,e){t.querySelectorAll(".map-layer-data").forEach(i=>{var r;const s=i.getAttribute("data-map-layer-key");if(null===s)return;const d=i.querySelector(".map-layer-checkbox");if(null===d)return;const m=i.querySelector(".layer-xml-info"),v=null!==(r=Sp.map_app_map_layers[s])&&void 0!==r?r:null;if(null===v)return console.error("ERROR - MapLayersLegendControl - cant find layerKey "+s+" in APP_CONFIG"),d.disabled=!0,i.insertAdjacentHTML("beforeend",'<span class="badge bg-danger text-white">ERROR</span>'),void(m&&m.classList.add("d-none"));const D=new _L(s,e,v,this.userTripService);D.isEnabled=d.checked,m&&this.addLayerInfoClickHandler(m,D),d.addEventListener("change",L=>{D.isEnabled=d.checked,d.checked?D.refreshFeatures():D.removeAllFeatures()}),this.layersData.push({inputEls:[d],xmlInfoEl:m,layer:D})})}addLayerInfoClickHandler(t,e){t.addEventListener("click",i=>{const r=e.lastOJPRequest;if(r){const s=this.debugXmlPopover.open(tE,{position:{top:"10px"}});s.afterOpened().subscribe(()=>{s.componentInstance.updateRequestData(r.lastRequestData)})}})}addPOICompositeLayers(t,e){t.querySelectorAll(".map-composite-pois").forEach(i=>{this.addPOICompositeLayer(i,e)})}addPOICompositeLayer(t,e){const i="pois-ALL",r=JSON.parse(JSON.stringify(Sp.map_app_map_layers[i])),s=[],d=[];t.querySelectorAll(".map-layer-poi").forEach(A=>{const L=A,j=L.getAttribute("data-osm-tag");null!==j&&(d.push(L),L.checked&&s.push(j),L.addEventListener("change",W=>{const ie=[];d.forEach(we=>{const Re=we.getAttribute("data-osm-tag");we.checked&&Re&&ie.push(Re)}),m.geoRestrictionPoiOSMTags=ie,m.isEnabled=ie.length>0,m.refreshFeatures(),D.xmlInfoEl&&(m.isEnabled?D.xmlInfoEl.classList.remove("d-none"):D.xmlInfoEl.classList.add("d-none"))}))}),r.LIR_POI_Type=s;const m=new _L(i,e,r,this.userTripService);m.isEnabled=s.length>0;const v=t.querySelector(".layer-xml-info");this.addLayerInfoClickHandler(v,m);const D={layer:m,inputEls:d,xmlInfoEl:v};this.layersData.push(D)}handleMapIdleEvents(t){const e=t.getBounds().toString();this.prevMapBoundsHash!==e&&(this.prevMapBoundsHash=e,this.layersData.forEach(r=>{r.layer.refreshFeatures()}))}onZoomChanged(t){this.layersData.forEach(e=>{var i;const r=e.layer.minZoom,s=t.getZoom()<r;null===(i=e.inputEls)||void 0===i||i.forEach(d=>{d.disabled=s}),e.xmlInfoEl&&(s?e.xmlInfoEl.classList.add("d-none"):e.xmlInfoEl.classList.remove("d-none"))})}handleMapClickEvents(t,e){let i=!1;this.layersData.forEach(r=>{i||r.layer.handleMapClick(t)&&(i=!0)})}}const TW=JSON.parse('{"id":"ojp-trip-leg-beeline","type":"line","source":"[SOURCE]","filter":["[CASE_FILTER_BY_DRAW_TYPE]"],"layout":{"line-join":"round","line-cap":"round","visibility":"visible"},"paint":{"line-width":4,"line-opacity":0.4,"line-color":["[CASE_COLOR_BY_LEG_TYPE]"]}}'),DW=JSON.parse('{"id":"ojp-trip-timed-leg-point-circle","type":"circle","source":"[SOURCE]","filter":["[FILTER BY DRAW_TYPE == TimedLegPoint]"],"layout":{},"paint":{"circle-radius":["IF POINT_TYPE: FROM",4,"IF POINT_TYPE: TO",8,"OTHERWISE",2],"circle-color":["IF POINT_TYPE: TO","COLOR BY TIMED_LEG","OTHERWISE","#FFF"],"circle-stroke-color":["IF POINT_TYPE: TO","#FFF","OTHERWISE","COLOR BY TIMED_LEG"],"circle-stroke-width":["IF POINT_TYPE: FROM",4,"IF POINT_TYPE: TO",1,"OTHERWISE",3]}}'),EW=JSON.parse('{"id":"ojp-trip-timed-leg-track","type":"line","source":"[SOURCE]","filter":["[FILTER BY DRAW_TYPE == TimedLegLine]"],"layout":{"line-join":"round","line-cap":"round","visibility":"visible"},"paint":{"line-width":4,"line-opacity":1,"line-color":["[CASE COLOR BY TIMED_LEG"]}}'),IW=JSON.parse('{"id":"ojp-trip-walking-leg-line","type":"line","source":"[SOURCE]","filter":["all","[FILTER BY DRAW_TYPE == ContinousLegLine]","[FILTER BY LINE_TYPE == Walk]"],"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":"#009933","line-width":4,"line-dasharray":[0.2,2]}}');class MW{constructor(t){this.mapSourceId="trip-data",this.features=[],this.map=t,this.addMapSourceAndLayers()}renderTrip(t){if(t){const e=t.computeGeoJSON();this.setSourceFeatures(e.features)}else this.removeAllFeatures()}addMapSourceAndLayers(){this.map.addSource(this.mapSourceId,{type:"geojson",data:{type:"FeatureCollection",features:[]}});const t=TW;t.filter=gc.FilterBeelines(),t.paint&&(t.paint["line-color"]=gc.ColorCaseByLegLineType());const e=gc.ColorCaseByLegLineType(),i=DW;if(i.filter=gc.FilterLegPoints(),i.paint){const m=["case",gc.FilterByPointType("From"),4,gc.FilterByPointType("To"),8,2];i.paint["circle-radius"]=m;const v=["case",gc.FilterByPointType("To"),e,"#FFF"];i.paint["circle-color"]=v;const D=["case",gc.FilterByPointType("To"),"#FFF",e];i.paint["circle-stroke-color"]=D;const A=["case",gc.FilterByPointType("From"),4,gc.FilterByPointType("To"),1,3];i.paint["circle-stroke-width"]=A}const r=EW;r.filter=gc.FilterTimedLegTracks(),r.paint&&(r.paint["line-color"]=e);const s=IW;s.filter=gc.FilterWalkingLegs(),s.paint&&(s.paint["line-color"]=Wy.ContinousLeg),[t,r,s,i].forEach(m=>{const v=m;v.source=this.mapSourceId,this.map.addLayer(v)})}removeAllFeatures(){0!==this.features.length&&this.setSourceFeatures([])}setSourceFeatures(t){this.features=t,this.map.getSource(this.mapSourceId).setData({type:"FeatureCollection",features:t})}}let AW=(()=>{class n{constructor(e,i,r){this.userTripService=e,this.mapService=i,this.debugXmlPopover=r,this.fromMarker=new(oa().Marker),this.toMarker=new(oa().Marker),["From","To"].forEach(d=>{var m=document.createElement("div");m.className="marker-journey-endpoint marker-journey-endpoint-"+d;const v=new(oa().Marker)({element:m,draggable:!0,anchor:"bottom"});v.on("dragend",D=>{this.handleMarkerDrag(v,d)}),"From"===d&&(this.fromMarker=v),"To"===d&&(this.toMarker=v)}),this.viaMarkers=[],this.mapLoadingPromise=null,this.popupContextMenu=new(oa().Popup)({focusAfterOpen:!1}),this.tripRenderController=null}ngOnInit(){this.userTripService.geoLocationsUpdated.subscribe(e=>{this.updateMarkers()}),this.userTripService.activeTripSelected.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{var s;null===(s=this.tripRenderController)||void 0===s||s.renderTrip(e)})}),this.mapService.newMapBoundsRequested.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{var s,d;const m=e.bounds,v=null!==(s=e.padding)&&void 0!==s?s:100;null!==(d=e.onlyIfOutside)&&void 0!==d&&d&&dm.areBoundsInsideOtherBounds(m,r.getBounds())||r.fitBounds(m,{padding:v,duration:0})})}),this.mapService.newMapCenterAndZoomRequested.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{r.jumpTo({center:e.lnglat,zoom:e.zoom})})}),this.userTripService.viaAtIndexRemoved.subscribe(e=>{e>this.viaMarkers.length-1||(this.viaMarkers[e].remove(),this.viaMarkers.splice(e,1))}),this.initMap()}initMap(){const e=new(oa().LngLatBounds)([[5.9559,45.818],[10.4921,47.8084]]),i=new(oa().Map)({container:"map_canvas",style:"mapbox://styles/mapbox/light-v10",bounds:e,accessToken:"pk.eyJ1IjoidmFzaWxlIiwiYSI6ImNra2k2dWFkeDFrbG0ycXF0Nmg0Z2tsNXAifQ.nK-i-3cpWmji7HvK1Ilynw"});this.mapService.initialMapCenter?(i.setCenter(this.mapService.initialMapCenter),this.mapService.initialMapZoom&&i.setZoom(this.mapService.initialMapZoom)):i.fitBounds(e,{padding:50,duration:0}),this.mapLoadingPromise=new Promise((r,s)=>{i.on("load",d=>{r(i),this.onMapLoad(i)})})}updateMarkers(){["From","To"].forEach(s=>{var d;const m="From"===s,v=m?this.userTripService.fromTripLocation:this.userTripService.toTripLocation;this.updateMarkerLocation(m?this.fromMarker:this.toMarker,null!==(d=null==v?void 0:v.location)&&void 0!==d?d:null)});const i=this.viaMarkers.length,r=this.userTripService.viaTripLocations.length;if(i>r){let s=this.viaMarkers;r>0&&(s=this.viaMarkers.splice(r,i-r)),s.forEach(d=>{d.remove()})}this.userTripService.viaTripLocations.forEach((s,d)=>{var m;let v=null!==(m=this.viaMarkers[d])&&void 0!==m?m:null;null===v&&(v=this.createViaMarker(s.location),this.viaMarkers.push(v)),this.updateMarkerLocation(v,s.location)})}handleMarkerDrag(e,i){const r=e.getLngLat();let s=Ho.initWithLngLat(r.lng,r.lat);this.userTripService.updateTripEndpoint(s,i,"MapDragend")}onMapLoad(e){this.addMapControls(e),e.on("contextmenu",i=>{this.showPickupPopup(e,i.lngLat)}),e.on("styleimagemissing",i=>{e.loadImage("./assets/map-style-icons/"+i.id+".png",(s,d)=>{s?console.error(s):!e.hasImage(i.id)&&d&&e.addImage(i.id,d)})}),this.tripRenderController=new MW(e)}showPickupPopup(e,i){let r=document.getElementById("map-endpoint-coords-picker-popup").innerHTML;const s=dm.formatMapboxLngLatAsLatLng(i);r=r.replace("[PICKER_COORDS]",s);const d=document.createElement("div");d.innerHTML=r,d.addEventListener("click",m=>{const D=m.target.getAttribute("data-endpoint-type");if(null===D)return void console.error("expected data-endpoint-type attribute");const A=Ho.initWithLngLat(i.lng,i.lat);this.userTripService.updateTripEndpoint(A,D,"MapPopupClick"),this.popupContextMenu.remove()}),this.popupContextMenu.setLngLat(i).setDOMContent(d).addTo(e)}addMapControls(e){const i=new(oa().NavigationControl)({showCompass:!1,visualizePitch:!1});e.addControl(i,"bottom-right");const r=new(oa().ScaleControl)({maxWidth:200,unit:"metric"});e.addControl(r);const s=new iL(e);e.addControl(s,"top-left");const d=new yL(e,this.debugXmlPopover,this.userTripService);e.addControl(d,"top-right")}updateMarkerLocation(e,i){var r,s,d;const m=null!==(s=null===(r=null==i?void 0:i.geoPosition)||void 0===r?void 0:r.asLngLat())&&void 0!==s?s:null;if(null===m)return void e.remove();const v=void 0===e.getLngLat();e.setLngLat(m),v&&(null===(d=this.mapLoadingPromise)||void 0===d||d.then(D=>{e.addTo(D)}))}createViaMarker(e){var i;const r=document.createElement("div");r.className="marker-journey-endpoint marker-journey-endpoint-Via";let s=!1;null===(null===(i=e.geoPosition)||void 0===i?void 0:i.properties)&&(s=!0);const d=new(oa().Marker)({element:r,anchor:"bottom",draggable:s}),m=this.viaMarkers.length;return d.on("dragend",v=>{const D=d.getLngLat();let A=Ho.initWithLngLat(D.lng,D.lat);this.userTripService.updateViaPoint(A,m)}),d}}return n.\u0275fac=function(e){return new(e||n)($(ju),$(Qd),$(Lp))},n.\u0275cmp=kn({type:n,selectors:[["app-map"]],decls:48,vars:0,consts:[["id","map_canvas",1,"map_wrapper"],[1,"d-none"],["id","map-endpoint-coords-picker-popup"],[1,"popup-picker","p-2"],[1,"popup-picker-header","mb-2"],[1,"popup-picker-body"],["type","button","data-endpoint-type","From",1,"btn","btn-primary","btn-sm"],["type","button","data-endpoint-type","To",1,"btn","btn-primary","btn-sm"],["type","button","data-endpoint-type","Via",1,"btn","btn-primary","btn-sm"],["id","map-endpoint-stop-picker-popup"],["id","map-endpoint-picker-popup"],["id","map-poi-picker-popup"]],template:function(e,i){1&e&&(qn(0,"div",0),Ee(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),Pt(5," Coords: [PICKER_COORDS] "),Pe(),Ee(6,"div",5)(7,"button",6),Pt(8,"From"),Pe(),Ee(9,"button",7),Pt(10,"To"),Pe(),Ee(11,"button",8),Pt(12,"Via"),Pe()()()(),Ee(13,"div",9)(14,"div",3)(15,"div",4),Pt(16," [STOP_NAME] ([STOP_ID]) "),Pe(),Ee(17,"div",5)(18,"button",6),Pt(19,"From"),Pe(),Ee(20,"button",7),Pt(21,"To"),Pe(),Ee(22,"button",8),Pt(23,"Via"),Pe()()()(),Ee(24,"div",10)(25,"div",3)(26,"div",4),Pt(27," TYPE: [GEO_RESTRICTION_TYPE] "),Pe(),Ee(28,"div",5),Pt(29," [GEOJSON_PROPERTIES_TABLE] "),Ee(30,"button",6),Pt(31,"From"),Pe(),Ee(32,"button",7),Pt(33,"To"),Pe(),Ee(34,"button",8),Pt(35,"Via"),Pe()()()(),Ee(36,"div",11)(37,"div",3)(38,"div",4),Pt(39," [POI_NAME] "),Pe(),Ee(40,"div",5),Pt(41," [GEOJSON_PROPERTIES_TABLE] "),Ee(42,"button",6),Pt(43,"From"),Pe(),Ee(44,"button",7),Pt(45,"To"),Pe(),Ee(46,"button",8),Pt(47,"Via"),Pe()()()()())},styles:[".map_wrapper[_ngcontent-%COMP%]{height:600px;border:1px solid #e5e5e5}.popup-picker-body[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:2px}"]}),n})();function kW(n,t){1&n&&qn(0,"span",11)}let RW=(()=>{class n{constructor(e){this.userTripService=e,this.tripCustomRequestSaved=new Xt,this.tripCustomResponseSaved=new Xt,this.inputTripRequestXmlS="... loading",this.inputTripRequestResponseXmlS="Paste custom OJP TripRequest Response XML here...",this.isRunningTripRequest=!1}parseCustomRequestXML(){this.isRunningTripRequest=!0;const e=this.userTripService.getStageConfig();new Xy(e).fetchOJPResponse(this.inputTripRequestXmlS,r=>{this.isRunningTripRequest=!1,this.tripCustomRequestSaved.emit(r)})}parseCustomResponseXML(){this.tripCustomResponseSaved.emit(this.inputTripRequestResponseXmlS)}}return n.\u0275fac=function(e){return new(e||n)($(ju))},n.\u0275cmp=kn({type:n,selectors:[["input-xml-popover"]],outputs:{tripCustomRequestSaved:"tripCustomRequestSaved",tripCustomResponseSaved:"tripCustomResponseSaved"},decls:26,vars:5,consts:[["sbbDialogTitle",""],["sbbDialogContent",""],[2,"width","500px"],[1,"d-flex","justify-content-between"],["target","_blank","href","https://opentransportdata.swiss/en/cookbook/ojptriprequest/"],["rows","7",1,"w-100",3,"ngModel","ngModelChange"],[1,"d-flex"],["type","button",1,"btn","btn-primary",3,"disabled","click"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],["sbbDialogActions",""],["type","button","sbbDialogClose","",1,"btn","btn-secondary"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"]],template:function(e,i){1&e&&(Ee(0,"div",0),Pt(1,"Custom Trip Request / Response XML"),Pe(),Ee(2,"div",1)(3,"div",2)(4,"div",3)(5,"div"),Pt(6,"Trip Request XML"),Pe(),Ee(7,"div")(8,"a",4),Pt(9,"Cookbook opentransportdata.swiss"),Pe()()(),Ee(10,"textarea",5),Wt("ngModelChange",function(s){return i.inputTripRequestXmlS=s}),Pe(),Ee(11,"div",6)(12,"button",7),Wt("click",function(){return i.parseCustomRequestXML()}),cn(13,kW,1,0,"span",8),Pt(14," Execute OJPTripRequest "),Pe()(),qn(15,"hr"),Ee(16,"div",3)(17,"div"),Pt(18,"Trip Request Response XML"),Pe()(),Ee(19,"textarea",5),Wt("ngModelChange",function(s){return i.inputTripRequestResponseXmlS=s}),Pe(),Ee(20,"div",6)(21,"button",7),Wt("click",function(){return i.parseCustomResponseXML()}),Pt(22," Display Trips "),Pe()()()(),Ee(23,"div",9)(24,"button",10),Pt(25," Close "),Pe()()),2&e&&(Je(10),dt("ngModel",i.inputTripRequestXmlS),Je(2),dt("disabled",i.isRunningTripRequest),Je(1),dt("ngIf",i.isRunningTripRequest),Je(6),dt("ngModel",i.inputTripRequestResponseXmlS),Je(2),dt("disabled",i.isRunningTripRequest))},dependencies:[na,Gd,Gf,$g,eE,hL,pL,fL],encapsulation:2}),n})();function PW(n,t){}const vL=new bt("SbbNotificationToastData");class Zw{constructor(){this.politeness="assertive",this.duration=0,this.data=null,this.verticalPosition="bottom",this.type="success"}}const OW={notificationState:ks("state",[gr("void, hidden",Nn({transform:"scale(0.8)",opacity:0})),gr("visible",Nn({transform:"scale(1)",opacity:1})),$i("* => visible",Yi("150ms cubic-bezier(0, 0, 0.2, 1)")),$i("* => void, * => hidden",Yi("75ms cubic-bezier(0.4, 0.0, 1, 1)",Nn({opacity:0})))])};let LW=(()=>{class n extends Qy{constructor(e,i,r,s){super(),this._ngZone=e,this._elementRef=i,this._changeDetectorRef=r,this.config=s,this._destroyed=!1,this._onExit=new Qt,this._onEnter=new Qt,this._animationState="void",this.attachDomPortal=d=>{this._assertNotAttached();const m=this._portalOutlet.attachDomPortal(d);return this._afterPortalAttached(),m},this._role="assertive"!==s.politeness||s.announcementMessage?"off"===s.politeness?null:"status":"alert"}get _svgIcon(){switch(this.config.type){case"success":return"kom:tick-small";case"error":case"warn":return"kom:sign-exclamation-point-small";default:return"kom:circle-information-small"}}attachComponentPortal(e){this._assertNotAttached();const i=this._portalOutlet.attachComponentPortal(e);return this._afterPortalAttached(),i}attachTemplatePortal(e){this._assertNotAttached();const i=this._portalOutlet.attachTemplatePortal(e);return this._afterPortalAttached(),i}onAnimationEnd(e){const{fromState:i,toState:r}=e;if(("void"===r&&"void"!==i||"hidden"===r)&&this._completeExit(),"visible"===r){const s=this._onEnter;this._ngZone.run(()=>{s.next(),s.complete()})}}enter(){this._destroyed||(this._animationState="visible",this._changeDetectorRef.detectChanges())}exit(){return this._animationState="hidden",this._elementRef.nativeElement.setAttribute("sbb-exit",""),this._onExit}ngOnDestroy(){this._destroyed=!0,this._completeExit()}_completeExit(){this._ngZone.onMicrotaskEmpty.pipe(Hr(1)).subscribe(()=>{this._onExit.next(),this._onExit.complete()})}_afterPortalAttached(){const e=this._elementRef.nativeElement,i=this.config.panelClass;i&&(Array.isArray(i)?i.forEach(r=>e.classList.add(r)):e.classList.add(i)),e.classList.add("sbb-notification-toast-center")}_assertNotAttached(){if(this._portalOutlet.hasAttached())throw Error("Attempting to attach notification content after content is already attached")}}return n.\u0275fac=function(e){return new(e||n)($(oi),$(Pn),$(Dr),$(Zw))},n.\u0275dir=vt({type:n,viewQuery:function(e,i){if(1&e&&mr(Hu,7),2&e){let r;zn(r=Vn())&&(i._portalOutlet=r.first)}},features:[ut]}),n})(),FW=(()=>{class n extends LW{_afterPortalAttached(){super._afterPortalAttached(),"top"===this.config.verticalPosition&&this._elementRef.nativeElement.classList.add("sbb-notification-toast-top")}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=ui(n)))(i||n)}}(),n.\u0275cmp=kn({type:n,selectors:[["sbb-notification-toast-container"]],hostAttrs:[1,"sbb-notification-toast"],hostVars:10,hostBindings:function(e,i){1&e&&iy("@state.done",function(s){return i.onAnimationEnd(s)}),2&e&&(Ht("role",i._role),oy("@state",i._animationState),Oi("sbb-notification-toast-success","success"===i.config.type)("sbb-notification-toast-info","info"===i.config.type)("sbb-notification-toast-warn","warn"===i.config.type)("sbb-notification-toast-error","error"===i.config.type))},features:[ut],decls:6,vars:1,consts:[[1,"sbb-notification-toast-icon-wrapper","sbb-icon-fit"],[3,"svgIcon"],[1,"sbb-notification-toast-content"],["cdkPortalOutlet",""],["type","button",1,"sbb-notification-toast-icon-wrapper","sbb-notification-toast-icon-close-wrapper","sbb-icon-fit",3,"click"],["svgIcon","kom:cross-small"]],template:function(e,i){1&e&&(Ee(0,"span",0),qn(1,"sbb-icon",1),Pe(),Ee(2,"div",2),cn(3,PW,0,0,"ng-template",3),Pe(),Ee(4,"button",4),Wt("click",function(){return i.exit()}),qn(5,"sbb-icon",5),Pe()),2&e&&(Je(1),dt("svgIcon",i._svgIcon))},dependencies:[Hu,Xa],styles:[".sbb-notification-toast{display:flex;min-height:calc(3.2rem * var(--sbb-scaling-factor));border-radius:var(--sbb-border-radius);color:var(--sbb-color-white);background-color:var(--sbb-color-background);font-size:var(--sbb-font-size);line-height:var(--sbb-line-height);padding-top:calc(0.8rem * var(--sbb-scaling-factor) - var(--sbb-border-width-thin));padding-bottom:calc(\n    0.8rem * var(--sbb-scaling-factor) - var(--sbb-border-width-thin) - var(\n        --sbb-line-height\n      ) + var(--sbb-icon-size-default)\n  );margin:calc(1.3333333333rem * var(--sbb-scaling-factor))}:where(html.sbb-lean) .sbb-notification-toast{padding-bottom:calc(\n      0.8rem * var(--sbb-scaling-factor) - var(--sbb-border-width-thin)\n    )}.sbb-notification-toast-mobile .sbb-notification-toast{margin:calc(0.5333333333rem * var(--sbb-scaling-factor));max-width:100%;min-width:0;width:100%}.sbb-notification-toast-mobile{width:100%}.sbb-notification-toast-error{background-color:var(--sbb-color-error)}:is(.sbb-notification-toast-error,.sbb-notification-toast-error :is(a,button)){color:var(--sbb-color-white)}.sbb-notification-toast-success{border:var(--sbb-border-width-thin) solid var(--sbb-color-green)}:is(.sbb-notification-toast-success,.sbb-notification-toast-success :is(a,button)){color:var(--sbb-color-green)}.sbb-notification-toast-info{border:var(--sbb-border-width-thin) solid var(--sbb-color-grey)}:is(.sbb-notification-toast-info,.sbb-notification-toast-info :is(a,button)){color:var(--sbb-color-grey)}.sbb-notification-toast-warn{background-color:var(--sbb-color-orange)}:is(.sbb-notification-toast-warn,.sbb-notification-toast-warn :is(a,button)){color:var(--sbb-color-white)}.sbb-notification-toast-content{margin-left:calc(0.5333333333rem * var(--sbb-scaling-factor));margin-right:calc(1.6rem * var(--sbb-scaling-factor))}.sbb-notification-toast-icon-wrapper{min-width:var(--sbb-icon-size-default);width:var(--sbb-icon-size-default);height:var(--sbb-icon-size-default);margin-left:calc(1.0666666667rem * var(--sbb-scaling-factor));border:none;background:none;padding:0;align-self:flex-start}.sbb-notification-toast-icon-close-wrapper{cursor:pointer;margin-left:auto;margin-right:calc(1.4666666667rem * var(--sbb-scaling-factor))}"],encapsulation:2,data:{animation:[OW.notificationState]}}),n})();const NW=Math.pow(2,31)-1;class nE{constructor(t,e){this._overlayRef=e,this._afterDismissed=new Qt,this._afterOpened=new Qt,this.containerInstance=t,t._onExit.subscribe(()=>this._finishDismiss())}dismiss(){this._afterDismissed.closed||this.containerInstance.exit(),clearTimeout(this._durationTimeoutId)}_dismissAfter(t){this._durationTimeoutId=setTimeout(()=>this.dismiss(),Math.min(t,NW))}_open(){this._afterOpened.closed||(this._afterOpened.next(),this._afterOpened.complete())}_finishDismiss(){this._overlayRef.dispose(),this._afterDismissed.next(null),this._afterDismissed.complete()}afterDismissed(){return this._afterDismissed.asObservable()}afterOpened(){return this.containerInstance._onEnter}}let BW=(()=>{class n{constructor(e,i){this.notificationToastRef=e,this.data=i}dismiss(){this.notificationToastRef.dismiss()}}return n.\u0275fac=function(e){return new(e||n)($(nE),$(vL))},n.\u0275cmp=kn({type:n,selectors:[["sbb-simple-notification"]],decls:2,vars:1,template:function(e,i){1&e&&(Ee(0,"span"),Pt(1),Pe()),2&e&&(Je(1),tr(i.data.message))},encapsulation:2,changeDetection:0}),n})(),iE=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({imports:[wr,sa,yl,Gi,bo]}),n})();const zW=new bt("notification-default-options",{providedIn:"root",factory:function VW(){return new Zw}});let jW=(()=>{class n{constructor(e,i,r,s,d,m){this._overlay=e,this._injector=i,this._live=r,this._breakpointObserver=s,this._parentNotification=d,this._defaultConfig=m,this._notificationRefAtThisLevel=null,this._simpleNotificationToastComponent=BW,this._notificationToastContainerComponent=FW,this._mobileDeviceCssClass="sbb-notification-toast-mobile"}get _openedNotificationRef(){const e=this._parentNotification;return e?e._openedNotificationRef:this._notificationRefAtThisLevel}set _openedNotificationRef(e){this._parentNotification?this._parentNotification._openedNotificationRef=e:this._notificationRefAtThisLevel=e}openFromComponent(e,i){return this._attach(e,i)}openFromTemplate(e,i){return this._attach(e,i)}open(e,i){const r=Object.assign(Object.assign({},this._defaultConfig),i);return r.data={message:e},r.announcementMessage===e&&(r.announcementMessage=void 0),this.openFromComponent(this._simpleNotificationToastComponent,r)}dismiss(){this._openedNotificationRef&&this._openedNotificationRef.dismiss()}ngOnDestroy(){this._notificationRefAtThisLevel&&this._notificationRefAtThisLevel.dismiss()}_attachNotificationToastContainer(e,i){var r;const s=null===(r=null==i?void 0:i.viewContainerRef)||void 0===r?void 0:r.injector,d=new HO(s||this._injector,new WeakMap([[Zw,i]])),m=new Uu(this._notificationToastContainerComponent,i.viewContainerRef,d),v=e.attach(m);return v.instance.config=i,v.instance}_attach(e,i){const r=Object.assign(Object.assign(Object.assign({},new Zw),this._defaultConfig),i),s=this._createOverlay(r),d=this._attachNotificationToastContainer(s,r),m=new nE(d,s);if(e instanceof eo){const v=new em(e,null,{$implicit:r.data,notificationRef:m});m.instance=d.attachTemplatePortal(v)}else{const v=this._createInjector(r,m),D=new Uu(e,void 0,v),A=d.attachComponentPortal(D);m.instance=A.instance}return this._breakpointObserver.observe("(max-width: 642.99px) and (orientation: portrait)").pipe(Li(s.detachments())).subscribe(v=>{const D=s.overlayElement.classList;v.matches?D.add(this._mobileDeviceCssClass):D.remove(this._mobileDeviceCssClass)}),this._animateNotification(m,r),this._openedNotificationRef=m,this._openedNotificationRef}_animateNotification(e,i){e.afterDismissed().subscribe(()=>{this._openedNotificationRef===e&&(this._openedNotificationRef=null),i.announcementMessage&&this._live.clear()}),this._openedNotificationRef?(this._openedNotificationRef.afterDismissed().subscribe(()=>{e.containerInstance.enter()}),this._openedNotificationRef.dismiss()):e.containerInstance.enter(),i.duration&&i.duration>0&&e.afterOpened().subscribe(()=>e._dismissAfter(i.duration)),i.announcementMessage&&this._live.announce(i.announcementMessage,i.politeness)}_createOverlay(e){const i=new cm,r=this._overlay.position().global();return r.centerHorizontally(),"top"===e.verticalPosition?r.top("0"):r.bottom("0"),i.positionStrategy=r,this._overlay.create(i)}_createInjector(e,i){var r;const s=null===(r=null==e?void 0:e.viewContainerRef)||void 0===r?void 0:r.injector;return new HO(s||this._injector,new WeakMap([[nE,i],[vL,e.data]]))}}return n.\u0275fac=function(e){return new(e||n)(Be($o),Be(xr),Be(f2),Be(LD),Be(n,12),Be(zW))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:iE}),n})();function xL(...n){const t=Xn(n);return di((e,i)=>{const r=n.length,s=new Array(r);let d=n.map(()=>!1),m=!1;for(let v=0;v<r;v++)li(n[v]).subscribe(Tt(i,D=>{s[v]=D,!m&&!d[v]&&(d[v]=!0,(m=d.every(wn))&&(d=null))},Xe));e.subscribe(Tt(i,v=>{if(m){const D=[v,...s];i.next(t?t(...D):D)}}))})}const UW=["sbb-button",""];function HW(n,t){1&n&&qn(0,"sbb-icon",2),2&n&&dt("svgIcon",Fn().svgIcon)}function $W(n,t){1&n&&qn(0,"sbb-icon",3),2&n&&dt("svgIcon",Fn().svgIcon)}const GW=["*"],qW=["sbb-button","sbb-alt-button","sbb-secondary-button","sbb-ghost-button","sbb-frameless-button","sbb-link"],WW=["sbb-button","sbb-secondary-button","sbb-frameless-button","sbb-link"],XW=["sbb-button","sbb-alt-button","sbb-secondary-button","sbb-ghost-button"],wL={"sbb-button":"kom:arrow-right-small","sbb-secondary-button":"kom:arrow-right-small","sbb-frameless-button":"kom:plus-small","sbb-link":"kom:arrow-right-small"},ZW=Wa(sm(class{constructor(n){this._elementRef=n}}));let SL=(()=>{class n extends ZW{constructor(e,i,r){super(e),this._focusMonitor=i,this._animationMode=r,this._hasIconIndicator=this._hasHostAttributes(...WW),this._hasIconButtonClass=!1,this._iconRefs=new Bf;for(const s of qW)this._hasHostAttributes(s)&&(this._getHostElement().classList.add(s),s in wL&&(this.svgIcon=wL[s]));e.nativeElement.classList.add("sbb-button-base")}ngAfterContentInit(){this._isIconButton=this._iconRefs.changes.pipe(Us(this._iconRefs),Hn(e=>this._hasHostAttributes(...XW)&&""===this._elementRef.nativeElement.textContent.trim()&&1===e.length)),this._isIconButton.subscribe(e=>this._hasIconButtonClass=e),this._leftIconVisible=this.variant.pipe(xL(this._isIconButton),Hn(([e,i])=>!i&&"standard"===e&&this._hasIconIndicator)),this._rightIconVisible=this.variant.pipe(xL(this._isIconButton),Hn(([e,i])=>!i&&("standard"===e&&this._hasIconIndicator||"lean"===e&&this._hasHostAttributes("sbb-link"))))}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}focus(e,i){e?this._focusMonitor.focusVia(this._getHostElement(),e,i):this._getHostElement().focus(i)}_getHostElement(){return this._elementRef.nativeElement}_hasHostAttributes(...e){return e.some(i=>this._getHostElement().hasAttribute(i))}}return n.\u0275fac=function(e){return new(e||n)($(Pn),$(Da),$(Lu,8))},n.\u0275cmp=kn({type:n,selectors:[["button","sbb-button",""],["button","sbb-alt-button",""],["button","sbb-secondary-button",""],["button","sbb-ghost-button",""],["button","sbb-frameless-button",""],["button","sbb-link",""]],contentQueries:function(e,i,r){if(1&e&&Ur(r,Xa,4,Pn),2&e){let s;zn(s=Vn())&&(i._iconRefs=s)}},hostVars:7,hostBindings:function(e,i){2&e&&(Ht("disabled",i.disabled||null),Oi("_sbb-animation-noopable","NoopAnimations"===i._animationMode)("sbb-disabled",i.disabled)("sbb-icon-button",i._hasIconButtonClass))},inputs:{disabled:"disabled",svgIcon:"svgIcon"},exportAs:["sbbButton"],features:[ut],attrs:UW,ngContentSelectors:GW,decls:5,vars:6,consts:[["class","sbb-button-indicator-icon sbb-button-left-icon",3,"svgIcon",4,"ngIf"],["class","sbb-button-indicator-icon sbb-button-right-icon",3,"svgIcon",4,"ngIf"],[1,"sbb-button-indicator-icon","sbb-button-left-icon",3,"svgIcon"],[1,"sbb-button-indicator-icon","sbb-button-right-icon",3,"svgIcon"]],template:function(e,i){1&e&&(Ro(),cn(0,HW,1,1,"sbb-icon",0),kg(1,"async"),Lr(2),cn(3,$W,1,1,"sbb-icon",1),kg(4,"async")),2&e&&(dt("ngIf",Rg(1,2,i._leftIconVisible)&&i.svgIcon),Je(3),dt("ngIf",Rg(4,4,i._rightIconVisible)&&i.svgIcon))},dependencies:[na,Xa,vy],encapsulation:2,changeDetection:0}),n})(),rE=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({imports:[wr,Gi,bo]}),n})();const QW=["connectionContainer"];function KW(n,t){if(1&n&&(Fd(0),Ee(1,"span"),Pt(2),Pe(),Nd()),2&n){const e=Fn();Je(2),tr(e.label)}}function JW(n,t){1&n&&Lr(0,1,["*ngSwitchCase","true"])}function e7(n,t){1&n&&Lr(0,2,["*ngIf","_hasErrors()"])}const t7=["*",[["sbb-label"]],[["sbb-error"],["","sbbError",""]]],n7=["*","sbb-label","sbb-error,[sbbError]"],i7=new bt("SbbError");class sv{}let oE=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=vt({type:n,selectors:[["sbb-label"]],hostAttrs:[1,"sbb-label"]}),n})(),r7=0;const Yw=new bt("SBB_FORM_FIELD");let av=(()=>{class n{constructor(e,i){this._elementRef=e,this._changeDetectorRef=i,this._destroyed=new Qt,this._labelId="sbb-form-field-label-"+r7++}get _control(){return this._explicitFormFieldControl||this._controlNonStatic||this._controlStatic}set _control(e){this._explicitFormFieldControl=e}getLabelId(){return this._hasLabel()||this.label?this._labelId:null}ngAfterContentInit(){this._validateControlChild();const e=this._control;e.controlType&&this._elementRef.nativeElement.classList.add(`sbb-form-field-type-${e.controlType}`),e.stateChanges.pipe(Us(null)).subscribe(()=>{this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()}),e.ngControl&&e.ngControl.valueChanges&&e.ngControl.valueChanges.pipe(Li(this._destroyed)).subscribe(()=>this._changeDetectorRef.markForCheck()),this._errorChildren.changes.pipe(Us(null)).subscribe(()=>{this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()})}ngAfterContentChecked(){this._validateControlChild()}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}_shouldForward(e){const i=this._control?this._control.ngControl:null;return i&&i[e]}_hasLabel(){return!(!this._labelChildNonStatic&&!this._labelChildStatic)}_hasErrors(){return!!(this._errorChildren&&this._errorChildren.length&&this._control.errorState)}_syncDescribedByIds(){if(this._control){const e=[];this._control.userAriaDescribedBy&&"string"==typeof this._control.userAriaDescribedBy&&e.push(...this._control.userAriaDescribedBy.split(" ")),this._errorChildren&&e.push(...this._errorChildren.map(i=>i.id)),this._control.setDescribedByIds(e)}}_validateControlChild(){}getConnectedOverlayOrigin(){return this._connectionContainerRef||this._elementRef}}return n.\u0275fac=function(e){return new(e||n)($(Pn),$(Dr))},n.\u0275cmp=kn({type:n,selectors:[["sbb-form-field"]],contentQueries:function(e,i,r){if(1&e&&(Ur(r,sv,5),Ur(r,sv,7),Ur(r,oE,5),Ur(r,oE,7),Ur(r,i7,5)),2&e){let s;zn(s=Vn())&&(i._controlNonStatic=s.first),zn(s=Vn())&&(i._controlStatic=s.first),zn(s=Vn())&&(i._labelChildNonStatic=s.first),zn(s=Vn())&&(i._labelChildStatic=s.first),zn(s=Vn())&&(i._errorChildren=s)}},viewQuery:function(e,i){if(1&e&&mr(QW,7),2&e){let r;zn(r=Vn())&&(i._connectionContainerRef=r.first)}},hostAttrs:[1,"sbb-form-field"],hostVars:20,hostBindings:function(e,i){2&e&&Oi("sbb-form-field-invalid",null==i._control?null:i._control.errorState)("sbb-form-field-disabled",null==i._control?null:i._control.disabled)("sbb-focused",null==i._control?null:i._control.focused)("ng-untouched",i._shouldForward("untouched"))("ng-touched",i._shouldForward("touched"))("ng-pristine",i._shouldForward("pristine"))("ng-dirty",i._shouldForward("dirty"))("ng-valid",i._shouldForward("valid"))("ng-invalid",i._shouldForward("invalid"))("ng-pending",i._shouldForward("pending"))},inputs:{label:"label"},exportAs:["sbbFormField"],features:[Kn([{provide:Yw,useExisting:n}])],ngContentSelectors:n7,decls:10,vars:9,consts:[[1,"sbb-form-field-wrapper"],[1,"sbb-form-field-label-wrapper",3,"click"],[1,"sbb-label","sbb-form-field-label",3,"id","ngSwitch"],[4,"ngSwitchCase"],[1,"sbb-form-field-input-wrapper"],["connectionContainer",""],[1,"sbb-form-field-error-wrapper"],[4,"ngIf"]],template:function(e,i){1&e&&(Ro(t7),Ee(0,"div",0)(1,"div",1),Wt("click",function(s){return i._control.onContainerClick&&i._control.onContainerClick(s)}),Ee(2,"label",2),cn(3,KW,3,1,"ng-container",3),cn(4,JW,1,0,"ng-content",3),Pe()(),Ee(5,"div",4,5),Lr(7),Pe(),Ee(8,"div",6),cn(9,e7,1,0,"ng-content",7),Pe()()),2&e&&(Je(2),Oi("sbb-form-field-empty",i._control.empty),dt("id",i._labelId)("ngSwitch",i._hasLabel()),Ht("for",i._control.id)("aria-owns",i._control.id),Je(1),dt("ngSwitchCase",!1),Je(1),dt("ngSwitchCase",!0),Je(5),dt("ngIf",i._hasErrors()))},dependencies:[na,zg,vx],styles:[".sbb-form-field{display:inline-block;position:relative;width:var(--sbb-form-field-width)}.sbb-form-field-short{width:33.333%}@media all and (min-width: 26.3125em){.sbb-form-field-short{width:25%}}@media all and (min-width: 64.0625em){.sbb-form-field-short{width:16.66666%}}.sbb-form-field-medium{width:100%}@media all and (min-width: 40.1875em){.sbb-form-field-medium{width:50%}}.sbb-form-field-long{width:100%}.sbb-form-field-wrapper{padding-bottom:calc(1.5333333333rem * var(--sbb-scaling-factor))}:where(html.sbb-lean) .sbb-form-field-wrapper{padding-bottom:1.0666666667rem}.sbb-form-field-flexible-errors .sbb-form-field-wrapper{padding-bottom:0}.sbb-form-field-label-wrapper{margin-bottom:var(--sbb-form-label-wrapper-margin-bottom);padding-left:var(--sbb-form-label-wrapper-padding-left)}.sbb-form-field .sbb-input-element{width:100%;max-width:100%}.sbb-form-field textarea.sbb-input-element{resize:vertical;overflow:auto}.sbb-form-field textarea.sbb-input-element.cdk-textarea-autosize{resize:none}.sbb-form-field-error-wrapper{position:absolute;box-sizing:border-box;width:100%;overflow:hidden}.sbb-form-field-flexible-errors .sbb-form-field-error-wrapper{position:relative}:is(.sbb-form-field-error-wrapper,.sbb-form-field-label-wrapper) :is(.sbb-icon,.sbb-tooltip-icon),:is(.sbb-form-field-error-wrapper,.sbb-form-field-label-wrapper) .sbb-icon svg{vertical-align:bottom;width:calc(1.0666666667rem * var(--sbb-scaling-factor));height:calc(1.0666666667rem * var(--sbb-scaling-factor))}:is(.sbb-form-field-error-wrapper,.sbb-form-field-label-wrapper) .sbb-tooltip-icon:not(:hover):not(:focus){color:inherit}:is(.sbb-form-field-error-wrapper,.sbb-form-field-label-wrapper) .sbb-tooltip-trigger{margin-left:calc(0.5333333333rem * var(--sbb-scaling-factor))}.sbb-form-group,.sbb-form-group-center,.sbb-form-group-wrap,.sbb-form-group-vertical{display:flex;gap:var(--sbb-divider-thin)}:is(.sbb-form-group,.sbb-form-group-center,.sbb-form-group-wrap){align-items:flex-start}.sbb-form-group-wrap{flex-wrap:wrap}.sbb-form-group-center{justify-content:center}:is(.sbb-form-group,.sbb-form-group-center,.sbb-form-group-wrap):where(:not(.sbb-form-group-vertical)) :is(.sbb-button,.sbb-alt-button,.sbb-secondary-button,.sbb-ghost-button,.sbb-icon-button){margin-top:calc(var(--sbb-form-label-line-height) + var(--sbb-form-label-wrapper-margin-bottom))}.sbb-form-group-vertical{flex-direction:column}.sbb-form-group-vertical.sbb-form-group-center{justify-content:inherit;align-items:center}.sbb-form-group-vertical>:is(.sbb-button,.sbb-alt-button,.sbb-secondary-button,.sbb-ghost-button,.sbb-icon-button){width:var(--sbb-form-field-width)}:where(html:not(.sbb-lean)) .sbb-form-group-vertical>:is(.sbb-button,.sbb-alt-button,.sbb-secondary-button,.sbb-ghost-button,.sbb-icon-button) .sbb-button-right-icon{right:unset !important}"],encapsulation:2,changeDetection:0}),n})(),Qw=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({imports:[wr,Gi]}),n})();const CL=Ip({passive:!0});let o7=(()=>{class n{constructor(e,i){this._platform=e,this._ngZone=i,this._monitoredElements=new Map}monitor(e){if(!this._platform.isBrowser)return Vt;const i=Jf(e),r=this._monitoredElements.get(i);if(r)return r.subject;const s=new Qt,d="cdk-text-field-autofilled",m=v=>{"cdk-text-field-autofill-start"!==v.animationName||i.classList.contains(d)?"cdk-text-field-autofill-end"===v.animationName&&i.classList.contains(d)&&(i.classList.remove(d),this._ngZone.run(()=>s.next({target:v.target,isAutofilled:!1}))):(i.classList.add(d),this._ngZone.run(()=>s.next({target:v.target,isAutofilled:!0})))};return this._ngZone.runOutsideAngular(()=>{i.addEventListener("animationstart",m,CL),i.classList.add("cdk-text-field-autofill-monitored")}),this._monitoredElements.set(i,{subject:s,unlisten:()=>{i.removeEventListener("animationstart",m,CL)}}),s}stopMonitoring(e){const i=Jf(e),r=this._monitoredElements.get(i);r&&(r.unlisten(),r.subject.complete(),i.classList.remove("cdk-text-field-autofill-monitored"),i.classList.remove("cdk-text-field-autofilled"),this._monitoredElements.delete(i))}ngOnDestroy(){this._monitoredElements.forEach((e,i)=>this.stopMonitoring(i))}}return n.\u0275fac=function(e){return new(e||n)(Be(_s),Be(oi))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),sE=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({}),n})();const TL=new bt("SBB_INPUT_VALUE_ACCESSOR");let s7=0;const a7=["button","checkbox","file","hidden","image","radio","range","reset","submit"],l7=Nw(class{constructor(n,t,e,i){this._defaultErrorStateMatcher=n,this._parentForm=t,this._parentFormGroup=e,this.ngControl=i,this.stateChanges=new Qt}});let sb=(()=>{class n extends l7{constructor(e,i,r,s,d,m,v,D,A){super(m,s,d,r),this._elementRef=e,this._platform=i,this.ngControl=r,this._autofillMonitor=D,this.focused=!1,this.controlType="sbb-input",this.autofilled=!1,this._disabled=!1,this.id="sbb-native-input-"+s7++,this._required=!1,this._type="text",this._readonly=!1,this._neverEmptyInputTypes=["date","datetime","datetime-local","month","time","week"].filter(W=>qO().has(W)),this._iOSKeyupListener=W=>{const ie=W.target;!ie.value&&0===ie.selectionStart&&0===ie.selectionEnd&&(ie.setSelectionRange(1,1),ie.setSelectionRange(0,0))};const L=this._elementRef.nativeElement,j=L.nodeName.toLowerCase();this._inputValueAccessor=v||L,this._previousNativeValue=this.value,i.IOS&&A.runOutsideAngular(()=>{e.nativeElement.addEventListener("keyup",this._iOSKeyupListener)}),this._isNativeSelect="select"===j,this._isTextarea="textarea"===j,this._isNativeSelect&&(this.controlType=L.multiple?"sbb-native-select-multiple":"sbb-native-select")}get disabled(){return this.ngControl&&null!==this.ngControl.disabled?this.ngControl.disabled:this._disabled}set disabled(e){this._disabled=Qn(e),this.focused&&(this.focused=!1,this.stateChanges.next())}get required(){return this._required}set required(e){this._required=Qn(e)}get type(){return this._type}set type(e){this._type=e||"text",this._validateType(),!this._isTextarea&&qO().has(this._type)&&(this._elementRef.nativeElement.type=this._type)}get value(){return this._inputValueAccessor.value}set value(e){e!==this.value&&(this._inputValueAccessor.value=e,this.stateChanges.next())}get readonly(){return this._readonly}set readonly(e){this._readonly=Qn(e)}get empty(){return!(this._isNeverEmpty()||this._elementRef.nativeElement.value||this._isBadInput()||this.autofilled)}ngAfterViewInit(){this._platform.isBrowser&&this._autofillMonitor.monitor(this._elementRef.nativeElement).subscribe(e=>{this.autofilled=e.isAutofilled,this.stateChanges.next()}),this._platform.IOS&&this._elementRef.nativeElement.removeEventListener("keyup",this._iOSKeyupListener)}ngOnChanges(){this.stateChanges.next()}ngOnDestroy(){this.stateChanges.complete(),this._platform.isBrowser&&this._autofillMonitor.stopMonitoring(this._elementRef.nativeElement)}ngDoCheck(){this.ngControl&&this.updateErrorState(),this._dirtyCheckNativeValue()}focus(e){this._elementRef.nativeElement.focus(e)}_focusChanged(e){e!==this.focused&&(this.focused=e,this.stateChanges.next())}_dirtyCheckNativeValue(){const e=this._elementRef.nativeElement.value;this._previousNativeValue!==e&&(this._previousNativeValue=e,this.stateChanges.next())}_validateType(){a7.indexOf(this._type)}_isNeverEmpty(){return this._neverEmptyInputTypes.indexOf(this._type)>-1}_isBadInput(){const e=this._elementRef.nativeElement.validity;return e&&e.badInput}setDescribedByIds(e){e.length?this._elementRef.nativeElement.setAttribute("aria-describedby",e.join(" ")):this._elementRef.nativeElement.removeAttribute("aria-describedby")}onContainerClick(){this.focused||this.focus()}}return n.\u0275fac=function(e){return new(e||n)($(Pn),$(_s),$(Vl,10),$(Hg,8),$(Gg,8),$($D),$(TL,10),$(o7),$(oi))},n.\u0275dir=vt({type:n,selectors:[["input","sbbInput",""],["select","sbbInput",""],["textarea","sbbInput",""]],hostAttrs:[1,"sbb-input-element"],hostVars:9,hostBindings:function(e,i){1&e&&Wt("focus",function(){return i._focusChanged(!0)})("blur",function(){return i._focusChanged(!1)}),2&e&&(uc("disabled",i.disabled)("required",i.required),Ht("id",i.id)("name",i.name||null)("readonly",i.readonly&&!i._isNativeSelect||null)("aria-invalid",i.empty&&i.required?null:i.errorState)("aria-required",i.required)("placeholder",i.readonly?"-":i.placeholder||null)("tabindex",i.empty&&i.readonly?-1:null))},inputs:{disabled:"disabled",id:"id",placeholder:"placeholder",name:"name",required:"required",type:"type",errorStateMatcher:"errorStateMatcher",userAriaDescribedBy:["aria-describedby","userAriaDescribedBy"],value:"value",readonly:"readonly"},exportAs:["sbbInput"],features:[Kn([{provide:sv,useExisting:n}]),ut,dr]}),n})(),DL=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({imports:[sE,Gi,Qw,sE,Qw]}),n})();const c7=["sbb-calendar-body",""];function u7(n,t){1&n&&qn(0,"td",4),2&n&&Ht("colspan",Fn(2).firstRowOffset)}function d7(n,t){if(1&n){const e=ml();Ee(0,"td",5)(1,"button",6),Wt("click",function(){const s=Wi(e).$implicit;return no(Fn(2).cellClicked(s))})("focus",function(r){const d=Wi(e).$implicit;return no(Fn(2)._emitActiveDateChange(d,r))}),Ee(2,"div",7),Pt(3),Pe()()()}if(2&n){const e=t.$implicit,i=t.index,r=Fn().index,s=Fn();Bd("width",100/s.numCols,"%"),Ht("data-sbb-row",r)("data-sbb-col",i),Je(1),Oi("sbb-calendar-body-disabled",!e.enabled)("sbb-calendar-body-active",s.isActiveCell(r,i))("sbb-calendar-body-range-background","range"===e.rangeBackground)("sbb-calendar-body-range-background-offset-start",null!==e.rangeBackground&&0===r&&s.firstRowOffset&&0===i)("sbb-calendar-body-selected-begin","begin"===e.rangeBackground)("sbb-calendar-body-selected-end","end"===e.rangeBackground)("sbb-calendar-body-selected",s.selectedValue===e.value)("sbb-calendar-body-today",s.todayValue===e.value),dt("tabindex",s.isActiveCell(r,i)?0:-1),Ht("aria-label",e.ariaLabel)("aria-disabled",!e.enabled||null)("aria-pressed",s.selectedValue===e.value)("aria-current",s.todayValue===e.value?"date":null),Je(2),tr(e.displayValue)}}function h7(n,t){if(1&n&&(Ee(0,"tr",1),cn(1,u7,1,1,"td",2),cn(2,d7,4,26,"td",3),Pe()),2&n){const e=t.$implicit,i=t.index,r=Fn();Je(1),dt("ngIf",0===i&&r.firstRowOffset),Je(1),dt("ngForOf",e)}}function p7(n,t){if(1&n&&(Ee(0,"th")(1,"span",5),Pt(2),Pe(),Ee(3,"span",6),Pt(4),Pe()()),2&n){const e=t.$implicit;Je(2),tr(e.long),Je(2),tr(e.narrow)}}function f7(n,t){}function m7(n,t){if(1&n){const e=ml();Ee(0,"button",3),Wt("click",function(){return Wi(e),no(Fn().prevDay())}),qn(1,"sbb-icon",4),Pe()}if(2&n){const e=Fn();dt("disabled",e.disabled),Ht("aria-label",e.prevDayAriaLabel)}}function g7(n,t){1&n&&qn(0,"sbb-datepicker-toggle")}function b7(n,t){if(1&n){const e=ml();Ee(0,"button",5),Wt("click",function(){return Wi(e),no(Fn().nextDay())}),qn(1,"sbb-icon",6),Pe()}if(2&n){const e=Fn();dt("disabled",e.disabled),Ht("aria-label",e.nextDayAriaLabel)}}const _7=["*"];class y7{constructor(t,e,i,r,s){this.value=t,this.displayValue=e,this.ariaLabel=i,this.enabled=r,this.rangeBackground=s}}let EL=(()=>{class n{constructor(e,i){this._elementRef=e,this._ngZone=i,this._focusActiveCellAfterViewChecked=!1,this.numCols=7,this.allowDisabledSelection=!1,this.activeCell=0,this.selectedValueChange=new Xt,this.activeDateChange=new Xt}ngAfterViewChecked(){this._focusActiveCellAfterViewChecked&&(this.focusActiveCell(),this._focusActiveCellAfterViewChecked=!1)}cellClicked(e){!this.allowDisabledSelection&&!e.enabled||this.selectedValueChange.emit(e.value)}_emitActiveDateChange(e,i){e.enabled&&this.activeDateChange.emit(e.value)}get firstRowOffset(){return this.rows&&this.rows.length&&this.rows[0].length?this.numCols-this.rows[0].length:0}isActiveCell(e,i){let r=e*this.numCols+i;return e&&(r-=this.firstRowOffset),r===this.activeCell}focusActiveCell(){this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.asObservable().pipe(Hr(1)).subscribe(()=>{setTimeout(()=>{const e=this._elementRef.nativeElement.querySelector(".sbb-calendar-body-active");e&&e.focus()})})})}_scheduleFocusActiveCellAfterViewChecked(){this._focusActiveCellAfterViewChecked=!0}}return n.\u0275fac=function(e){return new(e||n)($(Pn),$(oi))},n.\u0275cmp=kn({type:n,selectors:[["","sbb-calendar-body",""]],hostAttrs:["role","grid",1,"sbb-calendar-body"],hostVars:1,hostBindings:function(e,i){2&e&&Ht("aria-readonly",!0)},inputs:{label:"label",rows:"rows",todayValue:"todayValue",selectedValue:"selectedValue",labelMinRequiredCells:"labelMinRequiredCells",numCols:"numCols",allowDisabledSelection:"allowDisabledSelection",activeCell:"activeCell"},outputs:{selectedValueChange:"selectedValueChange",activeDateChange:"activeDateChange"},exportAs:["sbbCalendarBody"],attrs:c7,decls:1,vars:1,consts:[["role","row",4,"ngFor","ngForOf"],["role","row"],["class","sbb-calendar-body-label",4,"ngIf"],["role","gridcell","class","sbb-calendar-body-cell-container",3,"width",4,"ngFor","ngForOf"],[1,"sbb-calendar-body-label"],["role","gridcell",1,"sbb-calendar-body-cell-container"],["type","button",1,"sbb-calendar-body-cell","sbb-button-reset-frameless",3,"tabindex","click","focus"],[1,"sbb-calendar-body-cell-content"]],template:function(e,i){1&e&&cn(0,h7,3,2,"tr",0),2&e&&dt("ngForOf",i.rows)},dependencies:[Nl,na],encapsulation:2,changeDetection:0}),n})();function hm(n){return Error(`SbbDatepicker: No provider found for ${n}.`)}class IL{constructor(t,e){this.start=t,this.end=e}}const aE=new bt("SBB_DATEPICKER");let ML=(()=>{class n{constructor(e,i,r,s,d){if(this._dateAdapter=e,this.locale=i,this._changeDetectorRef=r,this._dateFormats=s,this.selectedChange=new Xt,this.userSelection=new Xt,this.activeDateChange=new Xt,this.dateRange=null,!this._dateAdapter)throw hm("DateAdapter");if(!this._dateFormats)throw hm("SBB_DATE_FORMATS");d&&d.connected&&d.datepickerInput.value&&d.connected.datepickerInput.value?this.dateRange=new IL(d.datepickerInput.value,d.connected.datepickerInput.value):d&&d.main&&d.datepickerInput.value&&d.main.datepickerInput.value&&(this.dateRange=new IL(d.main.datepickerInput.value,d.datepickerInput.value));const m=this._dateAdapter.getFirstDayOfWeek(),v=this._dateAdapter.getDayOfWeekNames("narrow"),A=this._dateAdapter.getDayOfWeekNames("long").map((L,j)=>({long:L,narrow:v[j]}));this.weekdays=A.slice(m).concat(A.slice(0,m)),this._activeDate=this._dateAdapter.today()}get activeDate(){return this._activeDate}set activeDate(e){const i=this._activeDate,r=this._getValidDateOrNull(this._dateAdapter.deserialize(e))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(r,this.minDate,this.maxDate),this._hasSameMonthAndYear(i,this._activeDate)||this.init()}get selected(){return this._selected}set selected(e){this._selected=this._getValidDateOrNull(this._dateAdapter.deserialize(e)),this.selectedDate=this._getDateInCurrentMonth(this._selected)}get minDate(){return this._minDate}set minDate(e){this._minDate=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get maxDate(){return this._maxDate}set maxDate(e){this._maxDate=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}ngAfterContentInit(){this.init()}dateSelected(e){if(this.selectedDate!==e){const i=this._getDateFromDayOfMonth(e);this.selectedChange.emit(i)}this.userSelection.emit()}_updateActiveDate(e){const i=this._activeDate;this.activeDate=this._getDateFromDayOfMonth(e),this._dateAdapter.compareDate(i,this.activeDate)&&this.activeDateChange.emit(this._activeDate)}handleCalendarBodyKeydown(e){const i=this._activeDate;switch(e.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,1);break;case 38:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,-7);break;case 40:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,7);break;case 36:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,1-this._dateAdapter.getDate(this._activeDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,this._dateAdapter.getNumDaysInMonth(this._activeDate)-this._dateAdapter.getDate(this._activeDate));break;case 33:this.activeDate=e.altKey?this._dateAdapter.addCalendarYears(this._activeDate,-1):this._dateAdapter.addCalendarMonths(this._activeDate,-1);break;case 34:this.activeDate=e.altKey?this._dateAdapter.addCalendarYears(this._activeDate,1):this._dateAdapter.addCalendarMonths(this._activeDate,1);break;case 13:return void((!this.dateFilter||this.dateFilter(this._activeDate))&&(this.dateSelected(this._dateAdapter.getDate(this._activeDate)),this.userSelection.emit(),e.preventDefault()));default:return}this._dateAdapter.compareDate(i,this.activeDate)&&(this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked()),e.preventDefault()}init(){this.selectedDate=this._getDateInCurrentMonth(this.selected),this.todayDate=this._getDateInCurrentMonth(this._dateAdapter.today()),this.monthLabel=this._dateAdapter.getMonthNames("short")[this._dateAdapter.getMonth(this.activeDate)].toLocaleUpperCase();const e=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),1);this.firstWeekOffset=(7+this._dateAdapter.getDayOfWeek(e)-this._dateAdapter.getFirstDayOfWeek())%7,this._createWeekCells(),this._changeDetectorRef.markForCheck()}focusActiveCell(){this.sbbCalendarBody.focusActiveCell()}_focusActiveCellAfterViewChecked(){this.sbbCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_getDateFromDayOfMonth(e){return this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),e)}_createWeekCells(){const e=this._dateAdapter.getNumDaysInMonth(this.activeDate),i=this._dateAdapter.getDateNames();this.weeks=[[]];for(let r=0,s=this.firstWeekOffset;r<e;r++,s++){7===s&&(this.weeks.push([]),s=0);const d=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),r+1),m=this._shouldEnableDate(d),v=this._dateAdapter.format(d,this._dateFormats.dateA11yLabel),D=this._shouldApplyRangeBackground(d);this.weeks[this.weeks.length-1].push(new y7(r+1,i[r],v,m,D))}}_shouldApplyRangeBackground(e){return this.dateRange&&this.dateRange.start&&this.dateRange.end&&!this._dateAdapter.sameDate(this.dateRange.start,this.dateRange.end)?this._dateAdapter.compareDate(e,this.dateRange.start)>0&&this._dateAdapter.compareDate(e,this.dateRange.end)<0?"range":this._isRangeLimit(e):null}_isRangeLimit(e){return 0===this._dateAdapter.compareDate(e,this.dateRange.start)?"begin":0===this._dateAdapter.compareDate(e,this.dateRange.end)?"end":null}_shouldEnableDate(e){return!!e&&(!this.dateFilter||this.dateFilter(e))&&(!this.minDate||this._dateAdapter.compareDate(e,this.minDate)>=0)&&(!this.maxDate||this._dateAdapter.compareDate(e,this.maxDate)<=0)}_getDateInCurrentMonth(e){return e&&this._hasSameMonthAndYear(e,this.activeDate)?this._dateAdapter.getDate(e):null}_hasSameMonthAndYear(e,i){return!(!e||!i||this._dateAdapter.getMonth(e)!==this._dateAdapter.getMonth(i)||this._dateAdapter.getYear(e)!==this._dateAdapter.getYear(i))}_getValidDateOrNull(e){return this._dateAdapter.isDateInstance(e)&&this._dateAdapter.isValid(e)?e:null}}return n.\u0275fac=function(e){return new(e||n)($(kp,8),$(Fl),$(Dr),$(Bw,8),$(aE,8))},n.\u0275cmp=kn({type:n,selectors:[["sbb-month-view"]],viewQuery:function(e,i){if(1&e&&mr(EL,7),2&e){let r;zn(r=Vn())&&(i.sbbCalendarBody=r.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter"},outputs:{selectedChange:"selectedChange",userSelection:"userSelection",activeDateChange:"activeDateChange"},exportAs:["sbbMonthView"],decls:7,vars:7,consts:[[1,"sbb-calendar-table"],[1,"sbb-calendar-table-header"],[4,"ngFor","ngForOf"],["colspan","7","aria-hidden","true",1,"sbb-calendar-table-header-divider"],["sbb-calendar-body","",3,"label","rows","todayValue","selectedValue","labelMinRequiredCells","activeCell","selectedValueChange","activeDateChange","keydown"],[1,"cdk-visually-hidden"],["aria-hidden","true"]],template:function(e,i){1&e&&(Ee(0,"table",0)(1,"thead",1)(2,"tr"),cn(3,p7,5,2,"th",2),Pe(),Ee(4,"tr"),qn(5,"th",3),Pe()(),Ee(6,"tbody",4),Wt("selectedValueChange",function(s){return i.dateSelected(s)})("activeDateChange",function(s){return i._updateActiveDate(s)})("keydown",function(s){return i.handleCalendarBodyKeydown(s)}),Pe()()),2&e&&(Je(3),dt("ngForOf",i.weekdays),Je(3),hp("label",i.monthLabel),dt("rows",i.weeks)("todayValue",i.todayDate)("selectedValue",i.selectedDate)("labelMinRequiredCells",3)("activeCell",i._dateAdapter.getDate(i.activeDate)-1))},dependencies:[Nl,EL],encapsulation:2,changeDetection:0}),n})(),v7=(()=>{class n{constructor(e,i,r){this._dateAdapter=e,this._labelSwitchToPreviousMonth=$localize`:Button label to switch to the previous month@@sbbDatepickerSwitchToPreviousMonth:Change to the previous month`,this._labelSwitchToNextMonth=$localize`:Button label to switch to the next month@@sbbDatepickerSwitchToNextMonth:Change to the next month`,this._labelSwitchToPreviousYear=$localize`:Button label to switch to the previous year@@sbbDatepickerSwitchToPreviousYear:Change to the previous year`,this._labelSwitchToNextYear=$localize`:Button label to switch to the next year@@sbbDatepickerSwitchToNextYear:Change to the next year`,this.calendar=i,this.calendar.stateChanges.subscribe(()=>r.markForCheck())}get monthText(){return this._dateAdapter.getMonthName(this.calendar.activeDate)}get yearText(){return this._dateAdapter.getYearName(this.calendar.activeDate)}previousMonthClicked(){const e=this._dateAdapter.addCalendarMonths(this.calendar.activeDate,-1);this._assignActiveDate(e)}nextMonthClicked(){const e=this._dateAdapter.addCalendarMonths(this.calendar.activeDate,1);this._assignActiveDate(e)}previousMonthEnabled(){return!this.calendar.minDate||!this._isSameMonthView(this.calendar.activeDate,this.calendar.minDate)}nextMonthEnabled(){return!this.calendar.maxDate||!this._isSameMonthView(this.calendar.activeDate,this.calendar.maxDate)}_isSameMonthView(e,i){return this._dateAdapter.getYear(e)===this._dateAdapter.getYear(i)&&this._dateAdapter.getMonth(e)===this._dateAdapter.getMonth(i)}previousYearClicked(){const e=this._dateAdapter.addCalendarYears(this.calendar.activeDate,-1);this._assignActiveDate(e)}nextYearClicked(){const e=this._dateAdapter.addCalendarYears(this.calendar.activeDate,1);this._assignActiveDate(e)}previousYearEnabled(){return!this.calendar.minDate||!this._isSameYearView(this.calendar.activeDate,this.calendar.minDate)}nextYearEnabled(){return!this.calendar.maxDate||!this._isSameYearView(this.calendar.activeDate,this.calendar.maxDate)}_isSameYearView(e,i){return this._dateAdapter.getYear(e)===this._dateAdapter.getYear(i)}_assignActiveDate(e){this.calendar.activeDate=this.calendar.minDate&&this._dateAdapter.compareDate(this.calendar.minDate,e)>0?this.calendar.minDate:this.calendar.maxDate&&this._dateAdapter.compareDate(this.calendar.maxDate,e)<0?this.calendar.maxDate:e}}return n.\u0275fac=function(e){return new(e||n)($(kp,8),$(Ri(()=>cE)),$(Dr))},n.\u0275cmp=kn({type:n,selectors:[["sbb-calendar-header"]],hostAttrs:[1,"sbb-calendar-header","sbb-icon-scaled"],exportAs:["sbbCalendarHeader"],decls:15,vars:12,consts:[[1,"sbb-calendar-controls"],[1,"sbb-calendar-controls-months"],["type","button",1,"sbb-calendar-controls-button","sbb-calendar-controls-button-previous",3,"disabled","click"],["svgIcon","kom:chevron-small-left-small"],["aria-live","polite",1,"sbb-calendar-controls-label"],["type","button",1,"sbb-calendar-controls-button","sbb-calendar-controls-button-next",3,"disabled","click"],["svgIcon","kom:chevron-small-right-small"],[1,"sbb-calendar-controls-years"]],template:function(e,i){1&e&&(Ee(0,"div",0)(1,"div",1)(2,"button",2),Wt("click",function(){return i.previousMonthClicked()}),qn(3,"sbb-icon",3),Pe(),Ee(4,"span",4),Pt(5),Pe(),Ee(6,"button",5),Wt("click",function(){return i.nextMonthClicked()}),qn(7,"sbb-icon",6),Pe()(),Ee(8,"div",7)(9,"button",2),Wt("click",function(){return i.previousYearClicked()}),qn(10,"sbb-icon",3),Pe(),Ee(11,"span",4),Pt(12),Pe(),Ee(13,"button",5),Wt("click",function(){return i.nextYearClicked()}),qn(14,"sbb-icon",6),Pe()()()),2&e&&(Je(2),dt("disabled",!i.previousMonthEnabled()),Ht("aria-label",i._labelSwitchToPreviousMonth),Je(2),Ht("aria-label",i.monthText),Je(1),tr(i.monthText),Je(1),dt("disabled",!i.nextMonthEnabled()),Ht("aria-label",i._labelSwitchToNextMonth),Je(3),dt("disabled",!i.previousYearEnabled()),Ht("aria-label",i._labelSwitchToPreviousYear),Je(2),Ht("aria-label",i.yearText),Je(1),tr(i.yearText),Je(1),dt("disabled",!i.nextYearEnabled()),Ht("aria-label",i._labelSwitchToNextYear))},dependencies:[Xa],encapsulation:2,changeDetection:0}),n})(),cE=(()=>{class n{constructor(e,i,r){if(this._dateAdapter=e,this._dateFormats=i,this._changeDetectorRef=r,this._moveFocusOnNextTick=!1,this.selectedChange=new Xt,this.userSelection=new Xt,this.stateChanges=new Qt,!this._dateAdapter)throw hm("DateAdapter");if(!this._dateFormats)throw hm("SBB_DATE_FORMATS")}get startAt(){return this._startAt}set startAt(e){this._startAt=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get selected(){return this._selected}set selected(e){this._selected=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get minDate(){return this._minDate}set minDate(e){this._minDate=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get maxDate(){return this._maxDate}set maxDate(e){this._maxDate=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get activeDate(){return this._clampedActiveDate}set activeDate(e){this._clampedActiveDate=this._dateAdapter.clampDate(e,this.minDate,this.maxDate),this.stateChanges.next()}ngAfterContentInit(){this.calendarHeaderPortal=new Uu(this.headerComponent||v7),this.activeDate=this.startAt||this._dateAdapter.today()}ngAfterViewChecked(){this._moveFocusOnNextTick&&(this._moveFocusOnNextTick=!1,this.focusActiveCell())}ngOnDestroy(){this.stateChanges.complete()}ngOnChanges(e){const i=e.minDate&&!this._dateAdapter.sameDate(e.minDate.previousValue,e.minDate.currentValue)?e.minDate:void 0,r=e.maxDate&&!this._dateAdapter.sameDate(e.maxDate.previousValue,e.maxDate.currentValue)?e.maxDate:void 0,s=i||r||e.dateFilter;if(s&&!s.firstChange){const d=this._getCurrentViewComponent();d&&(this._changeDetectorRef.detectChanges(),d.init())}this.stateChanges.next()}focusActiveCell(){this._getCurrentViewComponent().focusActiveCell()}dateSelected(e){e&&!this._dateAdapter.sameDate(e,this.selected)&&this.selectedChange.emit(e)}userSelected(){this.userSelection.emit()}_getValidDateOrNull(e){return this._dateAdapter.isDateInstance(e)&&this._dateAdapter.isValid(e)?e:null}_getCurrentViewComponent(){return this.monthView}}return n.\u0275fac=function(e){return new(e||n)($(kp,8),$(Bw,8),$(Dr))},n.\u0275cmp=kn({type:n,selectors:[["sbb-calendar"]],viewQuery:function(e,i){if(1&e&&mr(ML,7),2&e){let r;zn(r=Vn())&&(i.monthView=r.first)}},hostAttrs:[1,"sbb-calendar"],inputs:{headerComponent:"headerComponent",startAt:"startAt",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter"},outputs:{selectedChange:"selectedChange",userSelection:"userSelection"},exportAs:["sbbCalendar"],features:[dr],decls:3,vars:6,consts:[[3,"cdkPortalOutlet"],["cdkMonitorSubtreeFocus","","tabindex","-1",1,"sbb-calendar-content"],[3,"activeDate","selected","dateFilter","maxDate","minDate","activeDateChange","selectedChange","userSelection"]],template:function(e,i){1&e&&(cn(0,f7,0,0,"ng-template",0),Ee(1,"div",1)(2,"sbb-month-view",2),Wt("activeDateChange",function(s){return i.activeDate=s})("selectedChange",function(s){return i.dateSelected(s)})("userSelection",function(){return i.userSelected()}),Pe()()),2&e&&(dt("cdkPortalOutlet",i.calendarHeaderPortal),Je(2),dt("activeDate",i.activeDate)("selected",i.selected)("dateFilter",i.dateFilter)("maxDate",i.maxDate)("minDate",i.minDate))},dependencies:[Hu,j$,ML],encapsulation:2,changeDetection:0}),n})(),x7=(()=>{class n{ngAfterViewInit(){this.calendar.focusActiveCell()}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=kn({type:n,selectors:[["sbb-datepicker-content"]],viewQuery:function(e,i){if(1&e&&mr(cE,7),2&e){let r;zn(r=Vn())&&(i.calendar=r.first)}},hostAttrs:[1,"sbb-datepicker-content"],exportAs:["sbbDatepickerContent"],decls:1,vars:10,consts:[["cdkTrapFocus","","role","dialog",1,"sbb-datepicker-content-container",3,"id","ngClass","startAt","minDate","maxDate","dateFilter","headerComponent","selected","selectedChange","userSelection"]],template:function(e,i){if(1&e&&(Ee(0,"sbb-calendar",0),Wt("selectedChange",function(s){return i.datepicker.select(s)})("userSelection",function(){return i.datepicker.close()}),Pe()),2&e){let r;dt("id",i.datepicker.id)("ngClass",i.datepicker.panelClass)("startAt",i.datepicker.startAt)("minDate",i.datepicker.minDate)("maxDate",i.datepicker.maxDate)("dateFilter",i.datepicker.dateFilter)("headerComponent",i.datepicker.calendarHeaderComponent)("selected",i.datepicker.selected),Ht("aria-modal",!0)("aria-labelledby",null!==(r=i._dialogLabelId)&&void 0!==r?r:void 0)}},dependencies:[Bg,E$,cE],styles:['.sbb-datepicker-content{position:relative;top:var(--sbb-datepicker-content-offset);font-size:var(--sbb-font-size)}.sbb-datepicker-panel-above .sbb-datepicker-content{top:auto;bottom:var(--sbb-datepicker-content-offset)}.sbb-datepicker-content::after{top:var(--sbb-datepicker-calendar-arrow-offset);left:calc(var(--sbb-datepicker-button-offset) + var(--sbb-border-width));content:"";height:var(--sbb-datepicker-calendar-arrow-width);width:var(--sbb-datepicker-calendar-arrow-width);position:absolute;pointer-events:none;transform:rotate(-135deg);background-color:var(--sbb-color-background);border:var(--sbb-border-width) solid rgba(0,0,0,0);border-right-color:var(--sbb-color-weak-accent);border-bottom-color:var(--sbb-color-weak-accent);clip-path:polygon(-0.4px 100%, 100% -0.4px, 100% 100%)}.sbb-datepicker-with-arrows .sbb-datepicker-content::after{left:calc(var(--sbb-datepicker-button-offset) + var(--sbb-border-width) + var(--sbb-icon-size-default) + var(--sbb-datepicker-button-gap))}.sbb-datepicker-panel-above .sbb-datepicker-content::after{top:auto;bottom:var(--sbb-datepicker-calendar-arrow-offset);transform:rotate(45deg);clip-path:var(--sbb-box-shadow-arrow-clip-path);box-shadow:var(--sbb-box-shadow-arrow-width) var(--sbb-box-shadow-arrow-width) 0 var(--sbb-box-shadow-arrow-width) var(--sbb-box-shadow-color)}.sbb-calendar{display:block;max-width:100%;width:var(--sbb-datepicker-calendar-width);height:var(--sbb-datepicker-calendar-height);background-color:var(--sbb-color-background);border:var(--sbb-border-width) solid var(--sbb-color-weak-accent);border-radius:var(--sbb-border-radius);box-shadow:var(--sbb-box-shadow-below)}.sbb-calendar-header{display:block;border-bottom:var(--sbb-border-width-thin) solid var(--sbb-datepicker-calendar-line-color)}.sbb-calendar-controls{display:flex;height:var(--sbb-datepicker-calendar-header-height);align-items:center}.sbb-calendar-controls-months,.sbb-calendar-controls-years{display:flex;height:var(--sbb-datepicker-calendar-header-height);flex:1 0 50%;text-align:center;position:relative}.sbb-calendar-controls-months::after{content:"";display:block;position:absolute;width:0;height:100%;top:0;right:0;border-right:var(--sbb-border-width-thin) solid var(--sbb-datepicker-calendar-line-color)}.sbb-calendar-controls-button{background:none;max-width:none;min-width:0;padding:0;margin:0;border:none;display:flex;align-items:center;justify-content:center;flex-shrink:0;flex-grow:0;outline:0;padding-left:var(--sbb-datepicker-calendar-controls-padding);padding-right:var(--sbb-datepicker-calendar-controls-padding);height:var(--sbb-datepicker-calendar-header-height);cursor:pointer;color:var(--sbb-datepicker-calendar-header-color)}.sbb-calendar-controls-button:is(:hover,:focus,:active){color:var(--sbb-color-call-to-action-hover)}.sbb-calendar-controls-button:disabled{cursor:default;opacity:0}.sbb-calendar-controls-button-previous{float:left;padding-right:0}.sbb-calendar-controls-button-next{float:right;padding-left:0}.sbb-calendar-controls-label{flex-grow:1;flex-shrink:1;font-family:var(--sbb-font-light);font-size:1.4rem;line-height:3.2;color:var(--sbb-datepicker-calendar-header-color)}@media all and (min-width: 40.1875em){:where(html:not(.sbb-lean)) .sbb-calendar-controls-label{font-size:var(--sbb-font-size-large)}}:where(html.sbb-lean) .sbb-calendar-controls-label{font-size:var(--sbb-font-size);line-height:2.4rem}.sbb-calendar-content{padding:0 var(--sbb-datepicker-calendar-table-content-padding-width)}.sbb-calendar-table{width:100%;border-spacing:0;border-collapse:collapse;margin:0;position:relative}.sbb-calendar-table :is(td,th){color:var(--sbb-color-weak-accent);font-size:var(--sbb-font-size);line-height:1.5}.sbb-calendar-table-header::after{content:"";display:block;position:absolute;top:calc(2.2rem * var(--sbb-scaling-factor));border-bottom:var(--sbb-border-width-thin) solid var(--sbb-datepicker-calendar-line-color);width:calc(100% + var(--sbb-datepicker-calendar-table-content-padding-width)*2);left:calc(var(--sbb-datepicker-calendar-table-content-padding-width)*-1)}.sbb-calendar-table-header tr th{font-family:var(--sbb-font-roman);font-weight:400;font-size:var(--sbb-font-size-small);text-transform:uppercase;padding:calc(0.4666666667rem * var(--sbb-scaling-factor));color:var(--sbb-datepicker-calendar-header-color)}.sbb-calendar-table-header-divider{height:calc(1rem * var(--sbb-scaling-factor))}.sbb-calendar-body-cell-container{position:relative;height:0;padding:0;line-height:0;text-align:center}.sbb-calendar-body-cell{position:relative;top:0;left:0;width:100%;height:100%;background:none;text-align:center;outline:none;font-family:inherit;margin:0;cursor:pointer}.sbb-calendar-body-cell:is(.sbb-calendar-body-range-background,.sbb-calendar-body-selected-begin,.sbb-calendar-body-selected-end)::before{position:absolute;top:12.5%;left:12.5%;display:flex;align-items:center;justify-content:center;width:var(--sbb-datepicker-calendar-body-cell-size);height:var(--sbb-datepicker-calendar-body-cell-size);line-height:1;padding-left:calc(0.0666666667rem * var(--sbb-scaling-factor));padding-bottom:calc(0.0666666667rem * var(--sbb-scaling-factor));content:"";background-color:var(--sbb-datepicker-calendar-table-range-bg-color);width:100%;left:0}:is(.sbb-calendar-body-cell-container:is(:last-child,:first-child)>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell:is(.sbb-calendar-body-selected-begin,.sbb-calendar-body-selected-end,.sbb-calendar-body-range-background-offset-start))::before{width:50%}:is(.sbb-calendar-body-cell-container:first-child>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell:is(.sbb-calendar-body-selected-begin,.sbb-calendar-body-range-background-offset-start))::before{left:auto;right:0}:is(.sbb-calendar-body-cell-container:is(:last-child,:first-child)>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell.sbb-calendar-body-range-background-offset-start)::after{position:absolute;top:12.5%;left:12.5%;display:flex;align-items:center;justify-content:center;width:var(--sbb-datepicker-calendar-body-cell-size);height:var(--sbb-datepicker-calendar-body-cell-size);line-height:1;padding-left:calc(0.0666666667rem * var(--sbb-scaling-factor));padding-bottom:calc(0.0666666667rem * var(--sbb-scaling-factor));content:"";background-color:var(--sbb-datepicker-calendar-table-range-bg-color)}:is(.sbb-calendar-body-cell-container:first-child>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell.sbb-calendar-body-range-background-offset-start)::after{border-radius:50% 0 0 50%}.sbb-calendar-body-cell-container:last-child>.sbb-calendar-body-cell.sbb-calendar-body-range-background::after{border-radius:0 50% 50% 0}:is(.sbb-calendar-body-cell-container:first-child:last-child>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell-container:last-child>.sbb-calendar-body-cell:is(.sbb-calendar-body-range-background-offset-start,.sbb-calendar-body-selected-begin),.sbb-calendar-body-cell-container:first-child>.sbb-calendar-body-cell.sbb-calendar-body-selected-end,.sbb-calendar-body-cell.sbb-calendar-body-range-background-offset-start.sbb-calendar-body-selected-end)::before{display:none}:is(.sbb-calendar-body-cell-container:first-child:last-child>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell-container:last-child>.sbb-calendar-body-cell:is(.sbb-calendar-body-range-background-offset-start,.sbb-calendar-body-selected-begin),.sbb-calendar-body-cell-container:first-child>.sbb-calendar-body-cell.sbb-calendar-body-selected-end,.sbb-calendar-body-cell.sbb-calendar-body-range-background-offset-start.sbb-calendar-body-selected-end)::after{border-radius:50%}.sbb-calendar-body-cell,.sbb-calendar-body-label{padding-top:var(--sbb-datepicker-calendar-body-cell-padding);padding-bottom:var(--sbb-datepicker-calendar-body-cell-padding)}.sbb-calendar-body-cell.sbb-calendar-body-disabled{color:var(--sbb-color-cement);cursor:default}:where(html.sbb-lean) .sbb-calendar-body-cell.sbb-calendar-body-disabled{color:var(--sbb-color-storm)}.sbb-calendar-body-cell.sbb-calendar-body-disabled::after{content:"";width:calc(2.1333333333rem * var(--sbb-scaling-factor));height:calc(0.0666666667rem * var(--sbb-scaling-factor));top:calc(1.6666666667rem * var(--sbb-scaling-factor));left:calc(50% - var(--sbb-datepicker-calendar-body-cell-disabled-offset));background-color:var(--sbb-color-cement);display:block;position:absolute;transform:rotate(-45deg)}:where(html.sbb-lean) .sbb-calendar-body-cell.sbb-calendar-body-disabled::after{background-color:var(--sbb-color-storm);width:1.6rem;top:1.2rem}.sbb-calendar-body-today{font-family:var(--sbb-font-bold);color:var(--sbb-color-black)}.sbb-calendar-body-cell-content{position:absolute;top:12.5%;left:12.5%;display:flex;align-items:center;justify-content:center;width:var(--sbb-datepicker-calendar-body-cell-size);height:var(--sbb-datepicker-calendar-body-cell-size);line-height:1;padding-left:calc(0.0666666667rem * var(--sbb-scaling-factor));padding-bottom:calc(0.0666666667rem * var(--sbb-scaling-factor));border:var(--sbb-border-width) solid rgba(0,0,0,0);border-radius:50%;z-index:1}.sbb-calendar-body-cell:not(.sbb-calendar-body-disabled):is(:hover,:focus) .sbb-calendar-body-cell-content{background-color:var(--sbb-color-background);color:var(--sbb-color-call-to-action-hover);border-color:var(--sbb-color-call-to-action-hover)}:is(.sbb-calendar-body-cell:not(.sbb-calendar-body-disabled).sbb-calendar-body-selected,.sbb-calendar-body-selected-begin,.sbb-calendar-body-selected-end) .sbb-calendar-body-cell-content{background-color:var(--sbb-color-background);color:var(--sbb-color-weak-accent);border-color:var(--sbb-color-weak-accent)}'],encapsulation:2,changeDetection:0}),n})(),w7=(()=>{class n{constructor(e,i,r){this._changeDetectorRef=e,this._datepicker=i,this._labelShowCalendar=$localize`:Open calendar@@sbbDatepickerOpenCalendar:Show calendar`,this._stateChanges=me.EMPTY;const s=Number(r);this.tabIndex=s||0===s?s:null}get disabled(){return void 0===this._disabled?this._datepicker.disabled:this._disabled}set disabled(e){this._disabled=Qn(e)}ngOnChanges(e){e.datepicker&&this._watchStateChanges()}ngOnDestroy(){this._stateChanges.unsubscribe()}ngAfterContentInit(){this._watchStateChanges()}open(e){this._datepicker&&!this.disabled&&(this._datepicker.open(),e.stopPropagation())}_watchStateChanges(){const e=this._datepicker?this._datepicker.disabledChange:ei(),i=this._datepicker&&this._datepicker.datepickerInput?this._datepicker.datepickerInput.disabledChange:ei(),r=this._datepicker?rr(this._datepicker.openedStream,this._datepicker.closedStream):ei();this._stateChanges.unsubscribe(),this._stateChanges=rr(e,i,r).subscribe(()=>this._changeDetectorRef.markForCheck())}}return n.\u0275fac=function(e){return new(e||n)($(Dr),$(aE),Vr("tabindex"))},n.\u0275cmp=kn({type:n,selectors:[["sbb-datepicker-toggle"]],hostAttrs:[1,"sbb-datepicker-toggle"],hostVars:3,hostBindings:function(e,i){2&e&&(Ht("tabindex",null),Oi("sbb-datepicker-toggle-active",i._datepicker&&i._datepicker.opened))},inputs:{tabIndex:"tabIndex",disabled:"disabled"},features:[dr],decls:2,vars:3,consts:[["aria-haspopup","true","type","button",1,"sbb-datepicker-toggle-button","sbb-icon-scaled",3,"disabled","click"],["svgIcon","kom:calendar-small"]],template:function(e,i){1&e&&(Ee(0,"button",0),Wt("click",function(s){return i.open(s)}),qn(1,"sbb-icon",1),Pe()),2&e&&(dt("disabled",i.disabled),Ht("aria-label",i._labelShowCalendar)("tabindex",i.disabled?-1:i.tabIndex))},dependencies:[Xa],encapsulation:2,changeDetection:0}),n})(),S7=0;const AL=new bt("sbb-datepicker-scroll-strategy"),T7={provide:AL,deps:[$o],useFactory:function C7(n){return()=>n.scrollStrategies.reposition()}};let uE=(()=>{class n{constructor(e,i,r,s,d,m,v){if(this._overlay=e,this._ngZone=i,this._viewContainerRef=r,this._changeDetectorRef=s,this._scrollStrategy=d,this._dateAdapter=m,this.locale=v,this._arrows=!1,this._toggle=!0,this.openedStream=new Xt,this.closedStream=new Xt,this._opened=!1,this.id="sbb-datepicker-"+S7++,this._validSelected=null,this.nextDayAriaLabel=$localize`:Next day button's aria-label@@sbbDatePickerNextDayAriaLabel:Next day`,this.prevDayAriaLabel=$localize`:Previous day button's aria-label@@sbbDatePickerPrevDayAriaLabel:Previous day`,this._focusedElementBeforeOpen=null,this._inputSubscription=me.EMPTY,this._inputChangeSubscription=me.EMPTY,this._connectedDatepickerSubscription=me.EMPTY,this._posStrategySubscription=me.EMPTY,this.disabledChange=new Qt,this.selectedChanged=new Qt,!this._dateAdapter)throw hm("DateAdapter");this._dateAdapter.setLocale(v)}get startAt(){return this._startAt||(this.datepickerInput?this.datepickerInput.value:null)}set startAt(e){this._startAt=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get disabled(){return void 0===this._disabled&&this.datepickerInput?this.datepickerInput.disabled:!!this._disabled}set disabled(e){const i=Qn(e);i!==this._disabled&&(this._disabled=i,this.disabledChange.next(i))}set connected(e){e!==this._connected&&this._connected&&(this._connected.main=null),e&&(e.main=this),this._connected=e}get connected(){return this._connected}get arrows(){return this._arrows}set arrows(e){this._arrows=Qn(e)}get arrowsVisible(){var e;return this.arrows&&!(null!==(e=this.datepickerInput)&&void 0!==e&&e.readonly)}get toggle(){return this._toggle}set toggle(e){this._toggle=Qn(e)}set notoggle(e){this._toggle=!Qn(e)}get toggleVisible(){var e;return this.toggle&&!(null!==(e=this.datepickerInput)&&void 0!==e&&e.readonly)}get opened(){return this._opened}set opened(e){Qn(e)?this.open():this.close()}get selected(){return this._validSelected}set selected(e){this._validSelected=e,this._changeDetectorRef.markForCheck()}get minDate(){return this.datepickerInput&&this.datepickerInput.min}get maxDate(){return this.datepickerInput&&this.datepickerInput.max}get dateFilter(){return this.datepickerInput&&this.datepickerInput.dateFilter}get prevDayActive(){return this.arrowsVisible&&this.datepickerInput&&!!this.datepickerInput.value&&(!this.minDate||this._dateAdapter.compareDate(this.datepickerInput.value,this.minDate)>0)}get nextDayActive(){return this.arrowsVisible&&this.datepickerInput&&!!this.datepickerInput.value&&(!this.maxDate||this._dateAdapter.compareDate(this.datepickerInput.value,this.maxDate)<0)}ngOnDestroy(){this.close(),this._inputSubscription.unsubscribe(),this._inputChangeSubscription.unsubscribe(),this._connectedDatepickerSubscription.unsubscribe(),this.disabledChange.complete(),this.popupRef&&(this._posStrategySubscription.unsubscribe(),this.popupRef.dispose(),this._popupComponentRef=null)}select(e){const i=this.selected;this.selected=e,this._dateAdapter.sameDate(i,this.selected)||this.selectedChanged.next(e)}nextDay(){this.selected&&(this.selected=this._dateAdapter.addCalendarDays(this.selected,1),this.selectedChanged.next(this.selected))}prevDay(){this.selected&&(this.selected=this._dateAdapter.addCalendarDays(this.selected,-1),this.selectedChanged.next(this.selected))}registerInput(e){if(this.datepickerInput)throw Error("A SbbDatepicker can only be associated with a single input.");this.datepickerInput=e,this._inputSubscription=this.datepickerInput.valueChange.subscribe(i=>this.selected=i),this._inputChangeSubscription=rr(this.datepickerInput.disabledChange,this.datepickerInput.readonlyChange).subscribe(()=>this._changeDetectorRef.markForCheck()),this._connectedDatepickerSubscription=rr(this.openedStream.pipe(Fy("opened")),this.selectedChanged.pipe(Fy("selected")),this.closedStream.pipe(Fy("closed"))).pipe(function YW(n,t=null){return t=null!=t?t:n,di((e,i)=>{let r=[],s=0;e.subscribe(Tt(i,d=>{let m=null;s++%t==0&&r.push([]);for(const v of r)v.push(d),n<=v.length&&(m=null!=m?m:[],m.push(v));if(m)for(const v of m)p(r,v),i.next(v)},()=>{for(const d of r)i.next(d);i.complete()},void 0,()=>{r=null}))})}(3,1),Er(([i,r,s])=>!!this.connected&&!!this.datepickerInput.value&&"opened"===i&&"selected"===r&&"closed"===s&&(!this.connected.datepickerInput.value||this._dateAdapter.compareDate(this.datepickerInput.value,this.connected.datepickerInput.value)>0)),jo(()=>{this.connected.datepickerInput.value&&(this.connected.datepickerInput.value=null,this.connected.datepickerInput._cvaOnChange(null))})).subscribe(()=>this.connected.open())}open(){if(!this._opened&&!this.disabled){if(!this.datepickerInput)throw Error("Attempted to open an SbbDatepicker with no associated input.");this._focusedElementBeforeOpen=tu(),this._openAsPopup(),this._opened=!0,this.openedStream.emit()}}close(){if(!this._opened)return;this.popupRef&&this.popupRef.hasAttached()&&this.popupRef.detach(),this._calendarPortal&&this._calendarPortal.isAttached&&this._calendarPortal.detach();const e=()=>{this._opened&&(this._opened=!1,this.closedStream.emit(),this._focusedElementBeforeOpen=null)};this._focusedElementBeforeOpen&&"function"==typeof this._focusedElementBeforeOpen.focus?(this._focusedElementBeforeOpen.focus(),setTimeout(e)):e()}_getPanelClasses(){return["sbb-datepicker-panel",this.arrows?"sbb-datepicker-with-arrows":"sbb-datepicker-no-arrows"]}_openAsPopup(){this._calendarPortal||(this._calendarPortal=new Uu(x7,this._viewContainerRef)),this.popupRef?this.popupRef.getConfig().panelClass=this._getPanelClasses():this._createPopup(),this.popupRef.hasAttached()||(this._popupComponentRef=this.popupRef.attach(this._calendarPortal),this._popupComponentRef.instance.datepicker=this,this._popupComponentRef.instance._dialogLabelId=this.datepickerInput.getOverlayLabelId(),this._ngZone.onStable.asObservable().pipe(Hr(1)).subscribe(()=>{this.popupRef.updatePosition()}))}_createPopup(){const e=new cm({positionStrategy:this._createPopupPositionStrategy(),hasBackdrop:!0,backdropClass:"sbb-overlay-transparent-backdrop",scrollStrategy:this._scrollStrategy(),panelClass:this._getPanelClasses()});this.popupRef=this._overlay.create(e),rr(this.popupRef.backdropClick(),this.popupRef.detachments(),this.popupRef.keydownEvents().pipe(Er(i=>27===i.keyCode||this.datepickerInput&&i.altKey&&38===i.keyCode))).subscribe(()=>this.close())}_createPopupPositionStrategy(){const e=this._overlay.position().flexibleConnectedTo(this.datepickerInput.getConnectedOverlayOrigin()).withTransformOriginOn(".sbb-datepicker-content").withFlexibleDimensions(!1).withViewportMargin(8).withPush(!1).withPositions([{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom"}]);return this._posStrategySubscription=e.positionChanges.subscribe(i=>{"top"===i.connectionPair.originY?this.popupRef.hostElement.classList.add("sbb-datepicker-panel-above"):this.popupRef.hostElement.classList.remove("sbb-datepicker-panel-above")}),e}_getValidDateOrNull(e){return this._dateAdapter.isDateInstance(e)&&this._dateAdapter.isValid(e)?e:null}}return n.\u0275fac=function(e){return new(e||n)($($o),$(oi),$(Vo),$(Dr),$(AL),$(kp,8),$(Fl))},n.\u0275cmp=kn({type:n,selectors:[["sbb-datepicker"]],hostAttrs:[1,"sbb-datepicker"],hostVars:6,hostBindings:function(e,i){2&e&&Oi("sbb-datepicker-arrows-enabled",i.arrowsVisible)("sbb-datepicker-toggle-enabled",i.toggleVisible)("sbb-datepicker-disabled",i.disabled)},inputs:{calendarHeaderComponent:"calendarHeaderComponent",startAt:"startAt",disabled:"disabled",panelClass:"panelClass",connected:"connected",arrows:"arrows",toggle:"toggle",notoggle:"notoggle",opened:"opened",nextDayAriaLabel:"nextDayAriaLabel",prevDayAriaLabel:"prevDayAriaLabel"},outputs:{openedStream:"opened",closedStream:"closed"},exportAs:["sbbDatepicker"],features:[Kn([{provide:aE,useExisting:n}])],ngContentSelectors:_7,decls:4,vars:3,consts:[["type","button","class","sbb-datepicker-arrow-button sbb-datepicker-arrow-button-left sbb-icon-scaled",3,"disabled","click",4,"ngIf"],[4,"ngIf"],["type","button","class","sbb-datepicker-arrow-button sbb-datepicker-arrow-button-right sbb-icon-scaled",3,"disabled","click",4,"ngIf"],["type","button",1,"sbb-datepicker-arrow-button","sbb-datepicker-arrow-button-left","sbb-icon-scaled",3,"disabled","click"],["svgIcon","kom:chevron-small-left-small"],["type","button",1,"sbb-datepicker-arrow-button","sbb-datepicker-arrow-button-right","sbb-icon-scaled",3,"disabled","click"],["svgIcon","kom:chevron-small-right-small"]],template:function(e,i){1&e&&(Ro(),cn(0,m7,2,2,"button",0),cn(1,g7,1,0,"sbb-datepicker-toggle",1),Lr(2),cn(3,b7,2,2,"button",2)),2&e&&(dt("ngIf",i.prevDayActive),Je(1),dt("ngIf",i.toggleVisible),Je(2),dt("ngIf",i.nextDayActive))},dependencies:[na,Xa,w7],styles:[".sbb-datepicker{display:inline-block;position:relative;color:var(--sbb-color-weak-accent)}.sbb-form-field .sbb-datepicker{width:100%}.sbb-datepicker-disabled{color:var(--sbb-color-grey)}.sbb-datepicker>.sbb-date-input{width:100%}:is(.sbb-datepicker-toggle-enabled,.sbb-datepicker-arrows-enabled)>.sbb-date-input{padding-left:var(--sbb-datepicker-toggle-or-arrows-padding)}.sbb-datepicker-arrows-enabled>.sbb-date-input{padding-right:var(--sbb-datepicker-toggle-or-arrows-padding)}.sbb-datepicker-arrows-enabled.sbb-datepicker-toggle-enabled>.sbb-date-input{padding-left:var(--sbb-datepicker-toggle-and-arrows-padding)}:is(.sbb-datepicker-arrow-button,.sbb-datepicker-toggle-button){background:none;max-width:none;min-width:0;padding:0;margin:0;border:none;position:absolute;top:50%;transform:translateY(-50%);outline:0;color:inherit;line-height:0}:is(.sbb-datepicker-arrow-button,.sbb-datepicker-toggle-button):not(:disabled){cursor:pointer}:is(.sbb-datepicker-arrow-button,.sbb-datepicker-toggle-button):not(:disabled):is(:hover,:focus,:active){color:var(--sbb-color-call-to-action-hover)}.sbb-datepicker-arrow-button-left,.sbb-datepicker-toggle-button{left:var(--sbb-datepicker-button-offset)}.sbb-datepicker-arrows-enabled .sbb-datepicker-toggle-button{left:var(--sbb-datepicker-adjacent-button-offset)}.sbb-datepicker-arrow-button-right{right:var(--sbb-datepicker-button-offset)}"],encapsulation:2,changeDetection:0}),n})();class Kw{constructor(t,e){this.target=t,this.targetElement=e,this.value=this.target.value}}const D7={provide:Ga,useExisting:Ri(()=>Jw),multi:!0},E7={provide:js,useExisting:Ri(()=>Jw),multi:!0};let Jw=(()=>{class n{constructor(e,i,r,s,d){if(this._elementRef=e,this._dateAdapter=i,this._dateFormats=r,this._datepicker=s,this._formField=d,this._disabled=!1,this._readonly=!1,this.dateChange=new Xt,this.dateInput=new Xt,this.inputBlurred=new Xt,this.valueChange=new Xt,this.disabledChange=new Xt,this.readonlyChange=new Xt,this._datepickerSubscription=me.EMPTY,this._lastValueValid=!1,this._onTouched=()=>{},this._cvaOnChange=()=>{},this._validatorOnChange=()=>{},this._parseValidator=()=>this._lastValueValid?null:{sbbDateParse:{text:this._elementRef.nativeElement.value}},this._minValidator=m=>{const v=this._getValidDateOrNull(this._dateAdapter.deserialize(m.value));return!this.min||!v||this._dateAdapter.compareDate(this.min,v)<=0?null:{sbbDateMin:{min:this.min,actual:v}}},this._maxValidator=m=>{const v=this._getValidDateOrNull(this._dateAdapter.deserialize(m.value));return!this.max||!v||this._dateAdapter.compareDate(this.max,v)>=0?null:{sbbDateMax:{max:this.max,actual:v}}},this._filterValidator=m=>{const v=this._getValidDateOrNull(this._dateAdapter.deserialize(m.value));return this._dateFilter&&v&&!this._dateFilter(v)?{sbbDateFilter:!0}:null},this._validator=IR.compose([this._parseValidator,this._minValidator,this._maxValidator,this._filterValidator]),!this._dateAdapter)throw hm("DateAdapter");if(!this._dateFormats)throw hm("SBB_DATE_FORMATS")}set dateFilter(e){this._dateFilter=e,this._validatorOnChange()}get dateFilter(){return this._dateFilter}get value(){return this._value}set value(e){e=this._dateAdapter.deserialize(e),this._lastValueValid=!e||this._dateAdapter.isValid(e),e=this._getValidDateOrNull(e);const i=this.value;this._value=e,this._formatValue(e),this._dateAdapter.sameDate(i,e)||this.valueChange.emit(e)}get min(){return this._min||(this._datepicker&&this._datepicker.main&&this._datepicker.main.datepickerInput&&this._datepicker.main.datepickerInput.value?this._datepicker.main.datepickerInput.value:null)}set min(e){this._min=this._getValidDateOrNull(this._dateAdapter.deserialize(e)),this._validatorOnChange()}get max(){return this._max}set max(e){this._max=this._getValidDateOrNull(this._dateAdapter.deserialize(e)),this._validatorOnChange()}get disabled(){return this._disabled}set disabled(e){const i=Qn(e),r=this._elementRef.nativeElement;this._disabled!==i&&(this._disabled=i,this.disabledChange.emit(i)),i&&r.blur&&r.blur()}get readonly(){return this._readonly}set readonly(e){this._readonly=Qn(e),this.readonlyChange.next(this._readonly)}ngOnInit(){!this._datepicker||(this._datepicker.registerInput(this),this._datepickerSubscription.unsubscribe(),this._datepickerSubscription=this._datepicker.selectedChanged.subscribe(e=>{this.value=e,this._cvaOnChange(e),this._onTouched(),this.dateInput.emit(new Kw(this,this._elementRef.nativeElement)),this.dateChange.emit(new Kw(this,this._elementRef.nativeElement))}))}ngOnDestroy(){this._datepickerSubscription.unsubscribe(),this.valueChange.complete(),this.disabledChange.complete()}registerOnValidatorChange(e){this._validatorOnChange=e}validate(e){return this._validator?this._validator(e):null}getConnectedOverlayOrigin(){return this._elementRef}writeValue(e){this.value=e}registerOnChange(e){this._cvaOnChange=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this.disabled=e}_onKeydown(e){this._datepicker&&e.altKey&&40===e.keyCode&&(this._datepicker.open(),e.preventDefault())}_onInput(e){let i=this._dateAdapter.parse(e);this._lastValueValid=!i||this._dateAdapter.isValid(i),i=this._getValidDateOrNull(i),this._dateAdapter.sameDate(i,this._value)?this._validatorOnChange():(this._value=i,this._cvaOnChange(i),this.valueChange.emit(i),this.dateInput.emit(new Kw(this,this._elementRef.nativeElement)))}_onChange(){this.dateChange.emit(new Kw(this,this._elementRef.nativeElement))}_onBlur(){this.value&&this._formatValue(this.value),this._onTouched(),this.inputBlurred.emit()}_formatValue(e){this._elementRef.nativeElement.value=null!=e?this._dateAdapter.format(e,this._dateFormats.dateInput):""}_getValidDateOrNull(e){return this._dateAdapter.isDateInstance(e)&&this._dateAdapter.isValid(e)?e:null}getOverlayLabelId(){return this._formField?this._formField.getLabelId():this._elementRef.nativeElement.getAttribute("aria-labelledby")}}return n.\u0275fac=function(e){return new(e||n)($(Pn),$(kp,8),$(Bw,8),$(uE,8),$(Yw,8))},n.\u0275dir=vt({type:n,selectors:[["input","sbbDateInput",""]],hostAttrs:[1,"sbb-date-input"],hostVars:5,hostBindings:function(e,i){1&e&&Wt("keydown",function(s){return i._onKeydown(s)})("input",function(s){return i._onInput(s.target.value)})("change",function(){return i._onChange()})("blur",function(){return i._onBlur()}),2&e&&(uc("disabled",i.disabled),Ht("aria-haspopup",i._datepicker?"dialog":null)("aria-owns",(null==i._datepicker?null:i._datepicker.opened)&&i._datepicker.id||null)("min",i.min?i._dateAdapter.toIso8601(i.min):null)("max",i.max?i._dateAdapter.toIso8601(i.max):null))},inputs:{dateFilter:"dateFilter",value:"value",min:"min",max:"max",disabled:"disabled",readonly:"readonly"},outputs:{dateChange:"dateChange",dateInput:"dateInput",inputBlurred:"inputBlurred"},exportAs:["sbbDateInput"],features:[Kn([D7,E7,{provide:TL,useExisting:n}])]}),n})(),kL=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({providers:[T7,{provide:kp,useClass:S2},{provide:Bw,useValue:eG}],imports:[wr,sa,om,yl,Gi,bo]}),n})();const I7=["input"],M7=["*"];let A7=0;const k7={provide:Ga,useExisting:Ri(()=>hE),multi:!0};class RL{constructor(t,e){this.source=t,this.value=e}}const PL=new bt("SbbRadioGroup"),dE=new bt("SbbRadioButton");let R7=(()=>{class n{constructor(e){this._changeDetector=e,this.change=new Xt,this._value=null,this._name="sbb-radio-group-"+A7++,this._selected=null,this._isInitialized=!1,this._disabled=!1,this._required=!1,this._controlValueAccessorChangeFn=()=>{},this._onTouched=()=>{}}get name(){return this._name}set name(e){this._name=e,this._updateRadioButtonNames()}get value(){return this._value}set value(e){this._value!==e&&(this._value=e,this._updateSelectedRadioFromValue(),this._checkSelectedRadioButton())}get selected(){return this._selected}set selected(e){this._selected=e,this.value=e?e.value:null,this._checkSelectedRadioButton()}get disabled(){return this._disabled}set disabled(e){this._disabled=Qn(e),this._markRadiosForCheck()}get required(){return this._required}set required(e){this._required=Qn(e),this._markRadiosForCheck()}_checkSelectedRadioButton(){this._selected&&!this._selected.checked&&(this._selected.checked=!0)}ngAfterContentInit(){this._isInitialized=!0}_touch(){this._onTouched&&this._onTouched()}_emitChangeEvent(){this._isInitialized&&this.change.emit(new RL(this._selected,this._value))}_markRadiosForCheck(){this._radios&&this._radios.forEach(e=>e._markForCheck())}writeValue(e){this.value=e,this._changeDetector.markForCheck()}registerOnChange(e){this._controlValueAccessorChangeFn=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this.disabled=e,this._changeDetector.markForCheck()}_updateRadioButtonNames(){this._radios&&this._radios.forEach(e=>{e.name=this.name,e._markForCheck()})}_updateSelectedRadioFromValue(){this._radios&&(null===this._selected||this._selected.value!==this._value)&&(this._selected=null,this._radios.forEach(i=>{i.checked=this.value===i.value,i.checked&&(this._selected=i)}))}}return n.\u0275fac=function(e){return new(e||n)($(Dr))},n.\u0275dir=vt({type:n,contentQueries:function(e,i,r){if(1&e&&Ur(r,dE,5),2&e){let s;zn(s=Vn())&&(i._radios=s)}},hostAttrs:[1,"sbb-radio-group-base"],inputs:{name:"name",value:"value",selected:"selected",disabled:"disabled",required:"required"},outputs:{change:"change"}}),n})(),hE=(()=>{class n extends R7{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=ui(n)))(i||n)}}(),n.\u0275dir=vt({type:n,selectors:[["sbb-radio-group"]],contentQueries:function(e,i,r){if(1&e&&Ur(r,dE,5),2&e){let s;zn(s=Vn())&&(i._radios=s)}},hostAttrs:["role","radiogroup",1,"sbb-radio-group"],exportAs:["sbbRadioGroup"],features:[Kn([k7,{provide:PL,useExisting:n}]),ut]}),n})();const O7=ib(class P7{});let L7=0,F7=(()=>{class n extends O7{constructor(e,i,r,s,d,m){super(),this._elementRef=i,this._changeDetector=r,this._focusMonitor=s,this._radioDispatcher=d,this._uniqueId="sbb-radio-button-"+ ++L7,this.id=this._uniqueId,this.change=new Xt,this._checked=!1,this._value=null,this._removeUniqueSelectionListener=()=>{},this.radioGroup=e,m&&(this.tabIndex=Kd(m,0)),this._removeUniqueSelectionListener=d.listen((v,D)=>{v!==this.id&&D===this.name&&(this.checked=!1)})}get checked(){return this._checked}set checked(e){const i=Qn(e);this._checked!==i&&(this._checked=i,i&&this.radioGroup&&this.radioGroup.value!==this.value?this.radioGroup.selected=this:!i&&this.radioGroup&&this.radioGroup.value===this.value&&(this.radioGroup.selected=null),i&&this._radioDispatcher.notify(this.id,this.name),this._changeDetector.markForCheck())}get value(){return this._value}set value(e){this._value!==e&&(this._value=e,null!==this.radioGroup&&(this.checked||(this.checked=this.radioGroup.value===e),this.checked&&(this.radioGroup.selected=this)))}get disabled(){return this._disabled||null!==this.radioGroup&&this.radioGroup.disabled}set disabled(e){this._setDisabled(Qn(e))}get required(){return this._required||this.radioGroup&&this.radioGroup.required}set required(e){this._required=Qn(e)}get inputId(){return`${this.id||this._uniqueId}-input`}focus(e,i){i?this._focusMonitor.focusVia(this._inputElement,i,e):this._inputElement.nativeElement.focus(e)}_markForCheck(){this._changeDetector.markForCheck()}ngOnInit(){this.radioGroup&&(this.checked=this.radioGroup.value===this._value,this.checked&&(this.radioGroup.selected=this),this.name=this.radioGroup.name)}ngDoCheck(){this._updateTabIndex()}ngAfterViewInit(){this._updateTabIndex(),this._focusMonitor.monitor(this._elementRef,!0).subscribe(e=>{!e&&this.radioGroup&&this.radioGroup._touch()})}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._removeUniqueSelectionListener()}_emitChangeEvent(){this.change.emit(new RL(this,this._value))}_onInputClick(e){e.stopPropagation()}_onInputChange(e){null==e||e.stopPropagation();const i=this.radioGroup&&this.value!==this.radioGroup.value;this.checked=!0,this._emitChangeEvent(),this.radioGroup&&(this.radioGroup._controlValueAccessorChangeFn(this.value),i&&this.radioGroup._emitChangeEvent())}_setDisabled(e){this._disabled!==e&&(this._disabled=e,this._changeDetector.markForCheck())}_updateTabIndex(){var e;const i=this.radioGroup;let r;if(r=i&&i.selected&&!this.disabled?i.selected===this?this.tabIndex:-1:this.tabIndex,r!==this._previousTabIndex){const s=null===(e=this._inputElement)||void 0===e?void 0:e.nativeElement;s&&(s.setAttribute("tabindex",r+""),this._previousTabIndex=r)}}}return n.\u0275fac=function(e){zs()},n.\u0275dir=vt({type:n,viewQuery:function(e,i){if(1&e&&mr(I7,5),2&e){let r;zn(r=Vn())&&(i._inputElement=r.first)}},hostVars:1,hostBindings:function(e,i){2&e&&Ht("id",i.id)},inputs:{id:"id",name:"name",ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],ariaDescribedby:["aria-describedby","ariaDescribedby"],checked:"checked",value:"value",disabled:"disabled",required:"required"},outputs:{change:"change"},features:[ut]}),n})(),OL=(()=>{class n extends F7{constructor(e,i,r,s,d,m){super(e,i,r,s,d,m)}}return n.\u0275fac=function(e){return new(e||n)($(PL,8),$(Pn),$(Dr),$(Da),$(SD),Vr("tabindex"))},n.\u0275cmp=kn({type:n,selectors:[["sbb-radio-button"]],hostAttrs:[1,"sbb-radio-button","sbb-selection-item"],hostVars:9,hostBindings:function(e,i){1&e&&Wt("focus",function(){return i._inputElement.nativeElement.focus()}),2&e&&(Ht("tabindex",null)("id",i.id)("aria-label",null)("aria-labelledby",null)("aria-describedby",null),Oi("sbb-selection-checked",i.checked)("sbb-selection-disabled",i.disabled))},inputs:{tabIndex:"tabIndex"},exportAs:["sbbRadioButton"],features:[Kn([{provide:dE,useExisting:n}]),ut],ngContentSelectors:M7,decls:9,vars:11,consts:[[1,"sbb-selection-item-label"],["type","radio",1,"sbb-selection-input","sbb-radio-input","sbb-transparent-parent-overlay",3,"id","checked","disabled","tabIndex","required","change","click"],["input",""],[1,"sbb-selection-container"],[1,"sbb-selection-container-checked"],[1,"sbb-selection-content"],[2,"display","none"]],template:function(e,i){1&e&&(Ro(),Ee(0,"label",0)(1,"input",1,2),Wt("change",function(s){return i._onInputChange(s)})("click",function(s){return i._onInputClick(s)}),Pe(),Ee(3,"div",3),qn(4,"div",4),Pe(),Ee(5,"div",5)(6,"span",6),Pt(7,"\xa0"),Pe(),Lr(8),Pe()()),2&e&&(Ht("for",i.inputId),Je(1),dt("id",i.inputId)("checked",i.checked)("disabled",i.disabled)("tabIndex",i.tabIndex)("required",i.required),Ht("name",i.name)("value",i.value)("aria-label",i.ariaLabel)("aria-labelledby",i.ariaLabelledby)("aria-describedby",i.ariaDescribedby))},encapsulation:2,changeDetection:0}),n})(),pE=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({imports:[Gi]}),n})();const N7=/[0-9]{3,4}/,B7=/([0-9]{1,2})[.:,\-;_hH]?([0-9]{1,2})?/,z7=/([0-9]{1,2})([0-9]{2})/;let FL=(()=>{class n{constructor(e,i,r,s,d){this._elementRef=e,this._renderer=i,this._control=r,this._input=d,this._document=s,this.placeholder="HH:MM"}get placeholder(){return this._placeholder}set placeholder(e){this._placeholder=null!=e?e:"HH:MM",this._input&&(this._input.placeholder=this._placeholder)}_onBlur(e){const i=this._validateInput(e);if(!i||i.length<=2)return;const r=this._parseHour(i[1]),s=this._parseMinute(i[2]);if(this._control&&this._control.control)this._control.control.setValue(`${r}:${s}`);else{this._renderer.setProperty(this._elementRef.nativeElement,"value",`${r}:${s}`);const d=this._document.createEvent("Event");d.initEvent("input",!0,!0),this._elementRef.nativeElement.dispatchEvent(d)}}_validateInput(e){return N7.test(e)?e.match(z7):e?e.match(B7):null}_parseHour(e){return e.length>1?e:"0"+e}_parseMinute(e){return(e=e||"00").length>1?e:"0"+e}}return n.\u0275fac=function(e){return new(e||n)($(Pn),$(Ou),$(Vl,10),$(si),$(sb,8))},n.\u0275dir=vt({type:n,selectors:[["input","sbbTimeInput",""]],hostAttrs:["type","text","pattern","[0-9]*","inputmode","numeric",1,"sbb-time-input","sbb-input-element"],hostVars:1,hostBindings:function(e,i){1&e&&Wt("blur",function(s){return i._onBlur(s.target.value)}),2&e&&Ht("placeholder",i.placeholder)},inputs:{placeholder:"placeholder"},exportAs:["sbbTimeInput"]}),n})(),NL=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({imports:[Gi]}),n})();function BL(n,t){return t?e=>Ly(t.pipe(Hr(1),function V7(){return di((n,t)=>{n.subscribe(Tt(t,Xe))})}()),e.pipe(BL(n))):ke((e,i)=>n(e,i).pipe(Hr(1),Fy(e)))}const U7=["panel"];function H7(n,t){if(1&n&&(Ee(0,"div",0,1),Lr(2),Pe()),2&n){const e=t.id,i=Fn();dt("id",i.id)("ngClass",i._classList),Ht("aria-label",i.ariaLabel||null)("aria-labelledby",i._getPanelAriaLabelledby(e))}}const $7=["*"];let G7=0;class q7{constructor(t,e){this.source=t,this.option=e}}const zL=new bt("sbb-autocomplete-default-options",{providedIn:"root",factory:function W7(){return{autoActiveFirstOption:!1,autoSelectActiveOption:!1}}});let VL=(()=>{class n{constructor(e,i,r,s){this._changeDetectorRef=e,this._elementRef=i,this._activeOptionChanges=me.EMPTY,this._visibleClass="sbb-autocomplete-visible",this._hiddenClass="sbb-autocomplete-hidden",this._showPanel=new ia(!1),this._isOpen=!1,this.displayWith=null,this.localeNormalizer=null,this.optionSelected=new Xt,this.opened=new Xt,this.closed=new Xt,this.optionActivated=new Xt,this._classList={},this._showHintIfNoOptions=!1,this.id="sbb-autocomplete-"+G7++,this.inertGroups=(null==s?void 0:s.SAFARI)||!1,this._autoActiveFirstOption=!!r.autoActiveFirstOption,this._autoSelectActiveOption=!!r.autoSelectActiveOption}get showPanel(){return this._showPanel.value}get isOpen(){return this._isOpen&&this.showPanel}get autoActiveFirstOption(){return this._autoActiveFirstOption}set autoActiveFirstOption(e){this._autoActiveFirstOption=Qn(e)}get autoSelectActiveOption(){return this._autoSelectActiveOption}set autoSelectActiveOption(e){this._autoSelectActiveOption=Qn(e)}set classList(e){this._classList=e&&e.length?xD(e).reduce((i,r)=>(i[r]=!0,i),{}):{},this._setVisibilityClasses(this._classList),this._elementRef.nativeElement.className=""}get showHintIfNoOptions(){return this._showHintIfNoOptions}set showHintIfNoOptions(e){this._showHintIfNoOptions=Qn(e)}ngAfterContentInit(){this._keyManager=new l2(this.options).withWrap(),this._activeOptionChanges=this._keyManager.change.subscribe(e=>{this.isOpen&&this.optionActivated.emit({source:this,option:this.options.toArray()[e]||null})}),this._setVisibility()}ngOnDestroy(){this._activeOptionChanges.unsubscribe()}_setScrollTop(e){this.panel&&(this.panel.nativeElement.scrollTop=e)}_getScrollTop(){return this.panel?this.panel.nativeElement.scrollTop:0}_setVisibility(){this._showPanel.next(!!this.options.length||!!this.hints.length&&this.showHintIfNoOptions),this._setVisibilityClasses(this._classList),this._changeDetectorRef.markForCheck()}_emitSelectEvent(e){const i=new q7(this,e);this.optionSelected.emit(i)}_getPanelAriaLabelledby(e){return this.ariaLabel?null:this.ariaLabelledby?(e?e+" ":"")+this.ariaLabelledby:e}_setVisibilityClasses(e){e[this._visibleClass]=this.showPanel,e[this._hiddenClass]=!this.showPanel}}return n.\u0275fac=function(e){return new(e||n)($(Dr),$(Pn),$(zL),$(_s))},n.\u0275cmp=kn({type:n,selectors:[["sbb-autocomplete"]],contentQueries:function(e,i,r){if(1&e&&(Ur(r,tv,5),Ur(r,T2,5),Ur(r,lG,5)),2&e){let s;zn(s=Vn())&&(i.options=s),zn(s=Vn())&&(i.optionGroups=s),zn(s=Vn())&&(i.hints=s)}},viewQuery:function(e,i){if(1&e&&(mr(eo,7),mr(U7,5)),2&e){let r;zn(r=Vn())&&(i.template=r.first),zn(r=Vn())&&(i.panel=r.first)}},hostAttrs:[1,"sbb-autocomplete"],inputs:{ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],displayWith:"displayWith",localeNormalizer:"localeNormalizer",autoActiveFirstOption:"autoActiveFirstOption",autoSelectActiveOption:"autoSelectActiveOption",panelWidth:"panelWidth",classList:["class","classList"],showHintIfNoOptions:"showHintIfNoOptions"},outputs:{optionSelected:"optionSelected",opened:"opened",closed:"closed",optionActivated:"optionActivated"},exportAs:["sbbAutocomplete"],features:[Kn([{provide:zw,useExisting:n}])],ngContentSelectors:$7,decls:1,vars:0,consts:[["role","listbox",1,"sbb-panel","sbb-panel-padded","sbb-autocomplete-panel","sbb-scrollbar",3,"id","ngClass"],["panel",""]],template:function(e,i){1&e&&(Ro(),cn(0,H7,3,4,"ng-template"))},dependencies:[Bg],styles:[".sbb-autocomplete-visible{visibility:visible}.sbb-autocomplete-hidden{visibility:hidden;padding:0 !important}:where(html:not(.sbb-lean)) .sbb-autocomplete-panel .sbb-menu-group .sbb-menu-item{padding-left:calc(0.9333333333rem * var(--sbb-scaling-factor))}"],encapsulation:2,changeDetection:0}),n})();const jL=new bt("sbb-autocomplete-scroll-strategy"),Z7={provide:jL,deps:[$o],useFactory:function X7(n){return()=>n.scrollStrategies.reposition()}};let eS=(()=>{class n{constructor(e,i,r,s,d,m,v,D,A,L){this._element=e,this._overlay=i,this._viewContainerRef=r,this._zone=s,this._changeDetectorRef=d,this._formField=v,this._document=D,this._viewportRuler=A,this._defaults=L,this._componentDestroyed=!1,this._autocompleteDisabled=!1,this._viewportSubscription=me.EMPTY,this._positionSubscription=me.EMPTY,this._highlightSubscription=me.EMPTY,this._connectedElementClassSubscription=me.EMPTY,this._inputValue=new ia(""),this._canOpenOnNextFocus=!0,this._closeKeyEventStream=new Qt,this._windowBlurHandler=()=>{this._canOpenOnNextFocus=this._document.activeElement!==this._element.nativeElement||this.panelOpen},this._onChange=()=>{},this._onTouched=()=>{},this.position="auto",this.autocompleteAttribute="off",this._aboveClass="sbb-autocomplete-panel-above",this._overlayAttached=!1,this.optionSelections=Wf(()=>{const j=this.autocomplete?this.autocomplete.options:null;return j?j.changes.pipe(Us(j),bl(()=>rr(...j.map(W=>W.onSelectionChange)))):this._zone.onStable.pipe(Hr(1),bl(()=>this.optionSelections))}),this._scrollStrategy=m}get autocomplete(){return this._autocomplete}set autocomplete(e){if(this._autocomplete=e,this._highlightSubscription.unsubscribe(),this._connectedElementClassSubscription.unsubscribe(),!e)return;const i=e.options?ei(null):this._zone.onStable.pipe(Hr(1));this._highlightSubscription=i.pipe(bl(()=>Py([this._inputValue,e.options.changes.pipe(Us(e.options.toArray()))])),Er(r=>!!r[1]&&!!r[1].length)).subscribe(([r,s])=>{s.forEach(d=>d._highlight(r,this.autocomplete.localeNormalizer))}),this._connectedElementClassSubscription=this.autocomplete._showPanel.pipe(Ap(),Er(r=>!r)).subscribe(()=>{this._getConnectedElement().nativeElement.classList.remove("sbb-input-with-open-panel"),this._getConnectedElement().nativeElement.classList.remove("sbb-input-with-open-panel-above")})}get autocompleteDisabled(){return this._autocompleteDisabled}set autocompleteDisabled(e){this._autocompleteDisabled=Qn(e)}ngAfterViewInit(){const e=this._getWindow();void 0!==e&&this._zone.runOutsideAngular(()=>e.addEventListener("blur",this._windowBlurHandler))}ngOnChanges(e){e.position&&this._positionStrategy&&(this._setStrategyPositions(this._positionStrategy),this.panelOpen&&this._overlayRef.updatePosition())}ngOnDestroy(){const e=this._getWindow();void 0!==e&&e.removeEventListener("blur",this._windowBlurHandler),this._viewportSubscription.unsubscribe(),this._positionSubscription.unsubscribe(),this._highlightSubscription.unsubscribe(),this._connectedElementClassSubscription.unsubscribe(),this._componentDestroyed=!0,this._destroyPanel(),this._closeKeyEventStream.complete()}get panelOpen(){return this._overlayAttached&&this.autocomplete.showPanel}openPanel(){this._attachOverlay()}closePanel(){!this._overlayAttached||(this.panelOpen&&this._zone.run(()=>{this.autocomplete.closed.emit()}),this.autocomplete._isOpen=this._overlayAttached=!1,this._pendingAutoselectedOption=null,this._overlayRef&&this._overlayRef.hasAttached()&&(this._overlayRef.detach(),this._closingActionsSubscription.unsubscribe()),this._getConnectedElement().nativeElement.classList.remove("sbb-input-with-open-panel"),this._getConnectedElement().nativeElement.classList.remove("sbb-input-with-open-panel-above"),this._componentDestroyed||this._changeDetectorRef.detectChanges())}updatePosition(){this._overlayAttached&&this._overlayRef.updatePosition()}get panelClosingActions(){return rr(this.optionSelections,this.autocomplete._keyManager.tabOut.pipe(Er(()=>this._overlayAttached)),this._closeKeyEventStream,this._getOutsideClickStream(),this._overlayRef?this._overlayRef.detachments().pipe(Er(()=>this._overlayAttached)):ei()).pipe(Hn(e=>e instanceof D2?e:null))}get activeOption(){return this.autocomplete&&this.autocomplete._keyManager?this.autocomplete._keyManager.activeItem:null}_getOutsideClickStream(){return rr(nu(this._document,"click"),nu(this._document,"auxclick"),nu(this._document,"touchend")).pipe(Er(e=>{const i=Mp(e),r=this._formField?this._formField._elementRef.nativeElement:null,s=this.connectedTo?this.connectedTo.elementRef.nativeElement:null;return this._overlayAttached&&i!==this._element.nativeElement&&this._document.activeElement!==this._element.nativeElement&&(!r||!r.contains(i))&&(!s||!s.contains(i))&&!!this._overlayRef&&!this._overlayRef.overlayElement.contains(i)}))}writeValue(e){Promise.resolve(null).then(()=>this._assignOptionValue(e))}registerOnChange(e){this._onChange=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this._element.nativeElement.disabled=e}_handleKeydown(e){const i=e.keyCode,r=aa(e);if(27===i&&!r&&e.preventDefault(),this.activeOption&&13===i&&this.panelOpen&&!r)this.activeOption._selectViaInteraction(),this._resetActiveItem(),e.preventDefault();else if(this.autocomplete){const s=this.autocomplete._keyManager.activeItem,d=38===i||40===i;9===i||d&&!r&&this.panelOpen?this.autocomplete._keyManager.onKeydown(e):d&&this._canOpen()&&this.openPanel(),(d||this.autocomplete._keyManager.activeItem!==s)&&(this._scrollToOption(this.autocomplete._keyManager.activeItemIndex||0),this.autocomplete.autoSelectActiveOption&&this.activeOption&&(this._pendingAutoselectedOption||(this._valueBeforeAutoSelection=this._element.nativeElement.value),this._pendingAutoselectedOption=this.activeOption,this._assignOptionValue(this.activeOption.value)))}}_handleInput(e){const i=e.target;let r=i.value;"number"===i.type&&(r=""===r?null:parseFloat(r)),this._previousValue!==r&&(this._previousValue=r,this._pendingAutoselectedOption=null,this._onChange(r),this._inputValue.next(i.value),this._canOpen()&&this._document.activeElement===e.target&&this.openPanel())}_handleFocus(){this._canOpenOnNextFocus?this._canOpen()&&(this._previousValue=this._element.nativeElement.value,this._attachOverlay()):this._canOpenOnNextFocus=!0}_handleClick(){this._canOpen()&&!this.panelOpen&&this.openPanel()}_updateSize(){var e;null===(e=this._overlayRef)||void 0===e||e.updateSize({width:this._getPanelWidth()})}_subscribeToClosingActions(){const e=this._zone.onStable.pipe(Hr(1)),i=this.autocomplete.options.changes.pipe(jo(()=>this._positionStrategy.reapplyLastPosition()),function j7(n,t=Rw){const e=XD(n,t);return BL(()=>e)}(0));return rr(e,i).pipe(bl(()=>(this._zone.run(()=>{const r=this.panelOpen;if(this._resetActiveItem(),this.autocomplete._setVisibility(),this._changeDetectorRef.detectChanges(),this.panelOpen){const s=this.autocomplete.panel.nativeElement.scrollTop;this._overlayRef.updatePosition(),this.autocomplete.panel.nativeElement.scrollTop=s}r!==this.panelOpen&&(this.panelOpen?this.autocomplete.opened.emit():this.autocomplete.closed.emit())}),this.panelClosingActions)),Hr(1)).subscribe(r=>this._setValueAndClose(r))}_destroyPanel(){this._overlayRef&&(this.closePanel(),this._overlayRef.dispose(),this._overlayRef=null)}_assignOptionValue(e){const i=this.autocomplete&&this.autocomplete.displayWith?this.autocomplete.displayWith(e):e;this._updateNativeInputValue(null!=i?i:"")}_updateNativeInputValue(e){this._formField&&this._formField._control?this._formField._control.value=e:this._element.nativeElement.value=e,this._previousValue=e,this._inputValue.next(e)}_setValueAndClose(e){const i=e?e.source:this._pendingAutoselectedOption;i&&(this._clearPreviousSelectedOption(i),this._assignOptionValue(i.value),this._onChange(i.value),this.autocomplete._emitSelectEvent(i),this._element.nativeElement.focus()),this.closePanel()}_clearPreviousSelectedOption(e){this.autocomplete.options.forEach(i=>{i!==e&&i.selected&&i.deselect()})}_attachOverlay(){var e;let i=this._overlayRef;i?(this._positionStrategy.setOrigin(this._getConnectedElement()),i.updateSize({width:this._getPanelWidth()})):(this._portal=new em(this.autocomplete.template,this._viewContainerRef,{id:null===(e=this._formField)||void 0===e?void 0:e.getLabelId()}),i=this._overlay.create(this._getOverlayConfig()),this._overlayRef=i,this._positionStrategy&&(this._positionSubscription.unsubscribe(),this._positionSubscription=Py([this._positionStrategy.positionChanges,this.autocomplete._showPanel]).subscribe(([s,d])=>{this.autocomplete.panel&&d&&(this._getConnectedElement().nativeElement.classList.add("sbb-input-with-open-panel"),"top"===s.connectionPair.originY?(this.autocomplete.panel.nativeElement.classList.add("sbb-panel-above"),this._getConnectedElement().nativeElement.classList.add("sbb-input-with-open-panel-above")):(this.autocomplete.panel.nativeElement.classList.remove("sbb-panel-above"),this._getConnectedElement().nativeElement.classList.remove("sbb-input-with-open-panel-above")))})),this._handleOverlayEvents(i),this._viewportSubscription=this._viewportRuler.change().subscribe(()=>{this.panelOpen&&i&&i.updateSize({width:this._getPanelWidth()})})),i&&!i.hasAttached()&&(i.attach(this._portal),this._closingActionsSubscription=this._subscribeToClosingActions());const r=this.panelOpen;this.autocomplete._setVisibility(),this.autocomplete._isOpen=this._overlayAttached=!0,this.panelOpen&&r!==this.panelOpen&&this.autocomplete.opened.emit()}_getOverlayConfig(){var e;return new cm({positionStrategy:this._getOverlayPosition(),scrollStrategy:this._scrollStrategy(),width:this._getPanelWidth(),panelClass:xD(null===(e=this._defaults)||void 0===e?void 0:e.overlayPanelClass).concat("sbb-overlay-panel"),minHeight:0})}_getOverlayPosition(){const e=this._overlay.position().flexibleConnectedTo(this._getConnectedElement()).withFlexibleDimensions(!0).withPush(!1);return this._setStrategyPositions(e),this._positionStrategy=e,e}_setStrategyPositions(e){const i=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"}],r=this._aboveClass,s=[{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom",panelClass:r},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom",panelClass:r}];let d;d="above"===this.position?s:"below"===this.position?i:[...i,...s],e.withPositions(d)}_getConnectedElement(){return this.connectedTo?this.connectedTo.elementRef:this._formField?this._formField.getConnectedOverlayOrigin():this._element}_getPanelWidth(){return this.autocomplete.panelWidth||this._getHostWidth()}_getHostWidth(){return this._getConnectedElement().nativeElement.getBoundingClientRect().width}_resetActiveItem(){const e=this.autocomplete;e.autoActiveFirstOption?e._keyManager.setFirstItemActive():e._keyManager.setActiveItem(-1)}_canOpen(){const e=this._element.nativeElement;return!e.readOnly&&!e.disabled&&!this.autocompleteDisabled}_getWindow(){var e;return(null===(e=this._document)||void 0===e?void 0:e.defaultView)||window}_scrollToOption(e){const i=this.autocomplete,r=function sG(n,t,e){if(e.length){const i=t.toArray(),r=e.toArray();let s=0;for(let d=0;d<n+1;d++)i[d].group&&i[d].group===r[s]&&s++;return s}return 0}(e,i.options,i.optionGroups);if(0===e&&1===r)i._setScrollTop(0);else if(i.panel){const s=i.options.toArray()[e];if(s){const d=s._getHostElement(),m=E2(d.offsetTop,d.offsetHeight,i._getScrollTop(),i.panel.nativeElement.offsetHeight);i._setScrollTop(m)}}}_handleOverlayEvents(e){e.keydownEvents().subscribe(i=>{var r;(27===i.keyCode&&!aa(i)||38===i.keyCode&&aa(i,"altKey"))&&(this._pendingAutoselectedOption&&(this._updateNativeInputValue(null!==(r=this._valueBeforeAutoSelection)&&void 0!==r?r:""),this._pendingAutoselectedOption=null),this._closeKeyEventStream.next(),this._resetActiveItem(),i.stopPropagation(),i.preventDefault())})}}return n.\u0275fac=function(e){return new(e||n)($(Pn),$($o),$(Vo),$(oi),$(Dr),$(jL),$(Yw,9),$(si,8),$($u),$(zL,8))},n.\u0275dir=vt({type:n,selectors:[["input","sbbAutocomplete",""]],hostAttrs:[1,"sbb-autocomplete-trigger"],hostVars:9,hostBindings:function(e,i){1&e&&Wt("focusin",function(){return i._handleFocus()})("blur",function(){return i._onTouched()})("input",function(s){return i._handleInput(s)})("keydown",function(s){return i._handleKeydown(s)})("click",function(){return i._handleClick()}),2&e&&(Ht("autocomplete",i.autocompleteAttribute)("role",i.autocompleteDisabled?null:"combobox")("aria-autocomplete",i.autocompleteDisabled?null:"list")("aria-activedescendant",i.panelOpen&&i.activeOption?i.activeOption.id:null)("aria-expanded",i.autocompleteDisabled?null:i.panelOpen.toString())("aria-owns",i.autocompleteDisabled||!i.panelOpen||null==i.autocomplete?null:i.autocomplete.id)("aria-haspopup",i.autocompleteDisabled?null:"listbox"),Oi("sbb-focused",i.panelOpen))},inputs:{autocomplete:["sbbAutocomplete","autocomplete"],position:["sbbAutocompletePosition","position"],connectedTo:["sbbAutocompleteConnectedTo","connectedTo"],autocompleteAttribute:["autocomplete","autocompleteAttribute"],autocompleteDisabled:["sbbAutocompleteDisabled","autocompleteDisabled"]},exportAs:["sbbAutocompleteTrigger"],features:[Kn([{provide:Ga,useExisting:Ri(()=>n),multi:!0}]),dr]}),n})(),UL=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({providers:[Z7],imports:[wr,om,yl,Gi,Vw,Vw,yl]}),n})();function Y7(n,t){if(1&n&&(Ee(0,"sbb-option",8),Pt(1),Pe()),2&n){const e=t.$implicit;dt("value",t.index),Je(1),Do(" ",e.computeLocationName()," ")}}let Q7=(()=>{class n{constructor(e,i){this.mapService=e,this.userTripService=i,this.shouldFetchNewData=!0,this.inputControl=new ew(""),this.placeholder="",this.endpointType="From",this.inputValue="",this.selectedLocation=new Xt,this.lookupLocations=[]}ngOnInit(){this.inputControl.valueChanges.pipe(ev(500),Ap()).subscribe(e=>{if(null===e||!this.shouldFetchNewData||e.length<2)return;const i=Ho.initFromLiteralCoords(e);if(i)return this.lookupLocations=[],void this.handleCoordsPick(i);this.fetchJourneyPoints(e)})}ngOnChanges(e){"inputValue"in e&&this.inputControl.setValue(e.inputValue.currentValue,{emitEvent:!1})}onOpenAutocomplete(){this.shouldFetchNewData=!0}onOptionSelected(e){this.shouldFetchNewData=!1;const r=this.lookupLocations[e.option.value],s=r.computeLocationName();this.inputControl.setValue(s),this.selectedLocation.emit(r)}fetchJourneyPoints(e){let i=this.userTripService.getStageConfig();eu.initWithLocationName(i,e).fetchResponse().then(s=>{this.lookupLocations=s})}handleTapOnMapButton(){var e;const i="From"===this.endpointType?this.userTripService.fromTripLocation:this.userTripService.toTripLocation,r=null!==(e=null==i?void 0:i.location)&&void 0!==e?e:null;this.mapService.tryToCenterAndZoomToLocation(r)}handleCoordsPick(e){const i=e.geoPosition;if(null===i)return;const r=i.asLatLngString(!1);this.inputControl.setValue(r),this.selectedLocation.emit(e)}}return n.\u0275fac=function(e){return new(e||n)($(Qd),$(ju))},n.\u0275cmp=kn({type:n,selectors:[["journey-point-input"]],inputs:{placeholder:"placeholder",endpointType:"endpointType",inputValue:"inputValue"},outputs:{selectedLocation:"selectedLocation"},features:[dr],decls:9,vars:5,consts:[[1,"w-100","trip-endpoint"],[1,"endpoint-label",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","12","height","12","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-map"],["fill-rule","evenodd","d","M15.817.113A.5.5 0 0 1 16 .5v14a.5.5 0 0 1-.402.49l-5 1a.502.502 0 0 1-.196 0L5.5 15.01l-4.902.98A.5.5 0 0 1 0 15.5v-14a.5.5 0 0 1 .402-.49l5-1a.5.5 0 0 1 .196 0L10.5.99l4.902-.98a.5.5 0 0 1 .415.103zM10 1.91l-4-.8v12.98l4 .8V1.91zm1 12.98 4-.8V1.11l-4 .8v12.98zm-6-.8V1.11l-4 .8v12.98l4-.8z"],["sbbInput","","type","text",1,"trip-endpoint",3,"placeholder","formControl","sbbAutocomplete"],[3,"optionSelected","opened"],["journeyPoint","sbbAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(e,i){if(1&e&&(Ee(0,"sbb-form-field",0)(1,"div",1),Wt("click",function(){return i.handleTapOnMapButton()}),Ml(),Ee(2,"svg",2),qn(3,"path",3),Pe(),Pt(4),Pe(),Al(),qn(5,"input",4),Pe(),Ee(6,"sbb-autocomplete",5,6),Wt("optionSelected",function(s){return i.onOptionSelected(s)})("opened",function(){return i.onOpenAutocomplete()}),cn(8,Y7,2,2,"sbb-option",7),Pe()),2&e){const r=Ua(7);Je(4),Do(" ",i.placeholder," "),Je(1),dt("placeholder",i.placeholder)("formControl",i.inputControl)("sbbAutocomplete",r),Je(3),dt("ngForOf",i.lookupLocations)}},dependencies:[Nl,Gd,Gf,tw,tv,VL,eS,av,sb],styles:[".endpoint-label[_ngcontent-%COMP%]{font-size:12px}.endpoint-label[_ngcontent-%COMP%]:hover{cursor:pointer}"]}),n})();const K7=["panel"];function J7(n,t){if(1&n&&(Ee(0,"span",7),Pt(1),Pe()),2&n){const e=Fn();Je(1),tr(e.readonly?"-":e.placeholder||"\xa0")}}function e9(n,t){if(1&n&&(Ee(0,"span",8)(1,"span"),Pt(2),Pe()()),2&n){const e=Fn();Je(2),tr(e.triggerValue||"\xa0")}}function t9(n,t){1&n&&qn(0,"sbb-icon",9)}function n9(n,t){1&n&&qn(0,"sbb-icon",10)}function i9(n,t){if(1&n){const e=ml();Ee(0,"div",11,12),Wt("@transformPanel.done",function(r){return Wi(e),no(Fn()._panelDoneAnimatingStream.next(r.toState))})("keydown",function(r){return Wi(e),no(Fn()._handleKeydown(r))}),Lr(2),Pe()}if(2&n){const e=Fn();Bd("transform-origin",e._transformOrigin)("font-size",e._triggerFontSize,"px"),Oi("sbb-select-multiple",e.multiple),dt("ngClass",e.panelClass)("@transformPanel",e.multiple?"showing-multiple":"showing"),Ht("id",e.id+"-panel")("aria-multiselectable",e.multiple)("aria-label",e.ariaLabel||null)("aria-labelledby",e._getPanelAriaLabelledby())}}const r9=["*"],o9={transformPanel:ks("transformPanel",[gr("void",Nn({opacity:0})),gr("showing",Nn({opacity:1})),gr("showing-multiple",Nn({opacity:1})),$i("void => *",Yi("120ms cubic-bezier(0, 0, 0.2, 1)")),$i("* => void",Yi("100ms 25ms linear",Nn({opacity:0})))])};let HL=0;const $L=new bt("sbb-select-scroll-strategy"),a9=new bt("SBB_SELECT_CONFIG"),l9={provide:$L,deps:[$o],useFactory:function s9(n){return()=>n.scrollStrategies.reposition()}};class c9{constructor(t,e){this.source=t,this.value=e}}const u9=ib(Wa(Nw(sm(class{constructor(n,t,e,i){this._defaultErrorStateMatcher=n,this._parentForm=t,this._parentFormGroup=e,this.ngControl=i,this.stateChanges=new Qt}}))));let d9=(()=>{class n extends u9{constructor(e,i,r,s,d,m,v,D,A,L,j,W,ie){var we;super(s,m,v,A),this._viewportRuler=e,this._changeDetectorRef=i,this._ngZone=r,this._elementRef=d,this._parentFormField=D,this.ngControl=A,this._liveAnnouncer=W,this._defaultOptions=ie,this._scrollTop=0,this._triggerFontSize=0,this._transformOrigin="top",this._offsetY=0,this._positions=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom"}],this._panelOpen=!1,this._compareWith=(Re,We)=>Re===We,this._uid="sbb-select-"+HL++,this._triggerAriaLabelledBy=null,this._destroy=new Qt,this._onChange=()=>{},this._onTouched=()=>{},this._valueId="sbb-select-value-"+HL++,this._panelDoneAnimatingStream=new Qt,this._overlayPanelClass=(null===(we=this._defaultOptions)||void 0===we?void 0:we.overlayPanelClass)||"sbb-overlay-panel",this._focused=!1,this.controlType="sbb-select",this._multiple=!1,this._readonly=!1,this.ariaLabel="",this.optionSelectionChanges=Wf(()=>{const Re=this.options;return Re?Re.changes.pipe(Us(Re),bl(()=>rr(...Re.map(We=>We.onSelectionChange)))):this._ngZone.onStable.pipe(Hr(1),bl(()=>this.optionSelectionChanges))}),this.openedChange=new Xt,this._openedStream=this.openedChange.pipe(Er(Re=>Re),Hn(()=>{})),this._closedStream=this.openedChange.pipe(Er(Re=>!Re),Hn(()=>{})),this.selectionChange=new Xt,this.valueChange=new Xt,this.ngControl&&(this.ngControl.valueAccessor=this),null!=(null==ie?void 0:ie.typeaheadDebounceInterval)&&(this._typeaheadDebounceInterval=ie.typeaheadDebounceInterval),this._scrollStrategyFactory=j,this._scrollStrategy=this._scrollStrategyFactory(),this.tabIndex=parseInt(L,10)||0,this.id=this.id,this._overlayOrigin=new Y2(d)}get focused(){return this._focused||this._panelOpen}get placeholder(){return this._placeholder}set placeholder(e){this._placeholder=e,this.stateChanges.next()}get required(){var e,i,r,s;return null!==(s=null!==(e=this._required)&&void 0!==e?e:null===(r=null===(i=this.ngControl)||void 0===i?void 0:i.control)||void 0===r?void 0:r.hasValidator(IR.required))&&void 0!==s&&s}set required(e){this._required=Qn(e),this.stateChanges.next()}get multiple(){return this._multiple}set multiple(e){this._multiple=Qn(e)}get readonly(){return this._readonly}set readonly(e){this._readonly=Qn(e),this.stateChanges.next()}get compareWith(){return this._compareWith}set compareWith(e){this._compareWith=e,this._selectionModel&&this._initializeSelection()}get value(){return this._value}set value(e){this._assignValue(e)&&this._onChange(e)}get typeaheadDebounceInterval(){return this._typeaheadDebounceInterval}set typeaheadDebounceInterval(e){this._typeaheadDebounceInterval=Kd(e)}get id(){return this._id}set id(e){this._id=e||this._uid,this.stateChanges.next()}ngOnInit(){this._selectionModel=new z8(this.multiple),this.stateChanges.next(),this._panelDoneAnimatingStream.pipe(Ap(),Li(this._destroy)).subscribe(()=>this._panelDoneAnimating(this.panelOpen)),this._viewportRuler.change().pipe(Li(this._destroy)).subscribe(()=>{this.panelOpen&&(this._triggerRect=this._elementRef.nativeElement.getBoundingClientRect(),this._changeDetectorRef.markForCheck())})}ngAfterContentInit(){this._initKeyManager(),this._selectionModel.changed.pipe(Li(this._destroy)).subscribe(e=>{e.added.forEach(i=>i.select()),e.removed.forEach(i=>i.deselect())}),this.options.changes.pipe(Us(null),Li(this._destroy)).subscribe(()=>{this._resetOptions(),this._initializeSelection()})}ngDoCheck(){const e=this._getTriggerAriaLabelledby(),i=this.ngControl;if(e!==this._triggerAriaLabelledBy){const r=this._elementRef.nativeElement;this._triggerAriaLabelledBy=e,e?r.setAttribute("aria-labelledby",e):r.removeAttribute("aria-labelledby")}this.ngControl&&(this._previousControl!==i.control&&(void 0!==this._previousControl&&null!==i.disabled&&i.disabled!==this.disabled&&(this.disabled=i.disabled),this._previousControl=i.control),this.updateErrorState())}ngOnChanges(e){(e.disabled||e.userAriaDescribedBy)&&this.stateChanges.next(),e.typeaheadDebounceInterval&&this._keyManager&&this._keyManager.withTypeAhead(this._typeaheadDebounceInterval)}ngOnDestroy(){this._destroy.next(),this._destroy.complete(),this.stateChanges.complete()}toggle(){this.panelOpen?this.close():this.open()}open(){this._canOpen()&&(this._panelOpen=!0,this._keyManager.withHorizontalOrientation(null),this._highlightCorrectOption(),this._changeDetectorRef.markForCheck(),this._triggerRect=this._elementRef.nativeElement.getBoundingClientRect(),this._triggerFontSize=parseInt(getComputedStyle(this._elementRef.nativeElement).fontSize||"0",10),this._ngZone.onStable.pipe(Hr(1)).subscribe(()=>{this._triggerFontSize&&this.overlayDir.overlayRef&&this.overlayDir.overlayRef.overlayElement&&(this.overlayDir.overlayRef.overlayElement.style.fontSize=`${this._triggerFontSize}px`),this._calculateOverlayPosition()}))}close(){this._panelOpen&&(this._panelOpen=!1,this._keyManager.withHorizontalOrientation("ltr"),this._changeDetectorRef.markForCheck(),this._onTouched())}writeValue(e){this._assignValue(e)}registerOnChange(e){this._onChange=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this.disabled=e,this._changeDetectorRef.markForCheck(),this.stateChanges.next()}get panelOpen(){return this._panelOpen}get selected(){var e,i;return this.multiple?(null===(e=this._selectionModel)||void 0===e?void 0:e.selected)||[]:null===(i=this._selectionModel)||void 0===i?void 0:i.selected[0]}get triggerValue(){return this.empty?"":this._multiple?this._selectionModel.selected.map(i=>i.viewValue).join(", "):this._selectionModel.selected[0].viewValue}_handleKeydown(e){this.disabled||(this.panelOpen?this._handleOpenKeydown(e):this._handleClosedKeydown(e))}_handleClosedKeydown(e){const i=e.keyCode,r=40===i||38===i||37===i||39===i,s=13===i||32===i,d=this._keyManager;if(!d.isTyping()&&s&&!aa(e)||(this.multiple||e.altKey)&&r)e.preventDefault(),this.open();else if(!this.multiple){const m=this.selected;d.onKeydown(e);const v=this.selected;v&&m!==v&&this._liveAnnouncer.announce(v.viewValue,1e4)}}_handleOpenKeydown(e){const i=this._keyManager,r=e.keyCode,s=40===r||38===r,d=i.isTyping();if(s&&e.altKey)e.preventDefault(),this.close();else if(d||13!==r&&32!==r||!i.activeItem||aa(e))if(!d&&this._multiple&&65===r&&e.ctrlKey){e.preventDefault();const m=this.options.some(v=>!v.disabled&&!v.selected);this.options.forEach(v=>{v.disabled||(m?v.select():v.deselect())})}else{const m=i.activeItemIndex;i.onKeydown(e),this._multiple&&s&&e.shiftKey&&i.activeItem&&i.activeItemIndex!==m&&i.activeItem._selectViaInteraction()}else e.preventDefault(),i.activeItem._selectViaInteraction()}_onFocus(){this.disabled||(this._focused=!0,this.stateChanges.next())}_onBlur(){this._focused=!1,!this.disabled&&!this.panelOpen&&(this._onTouched(),this._changeDetectorRef.markForCheck(),this.stateChanges.next())}_onAttached(){this.overlayDir.positionChange.pipe(Hr(1)).subscribe(e=>{"top"===e.connectionPair.originY?(this.panel.nativeElement.classList.add("sbb-panel-above"),this._elementRef.nativeElement.classList.add("sbb-input-with-open-panel-above")):(this.panel.nativeElement.classList.remove("sbb-panel-above"),this._elementRef.nativeElement.classList.remove("sbb-input-with-open-panel-above")),this._changeDetectorRef.detectChanges(),this._positioningSettled()})}get empty(){return!this._selectionModel||this._selectionModel.isEmpty()}_initializeSelection(){Promise.resolve().then(()=>{this.ngControl&&(this._value=this.ngControl.value),this._setSelectionByValue(this._value),this.stateChanges.next()})}_setSelectionByValue(e){if(this._selectionModel.selected.forEach(i=>i.setInactiveStyles()),this._selectionModel.clear(),this.multiple&&e)Array.isArray(e),e.forEach(i=>this._selectOptionByValue(i)),this._sortValues();else{const i=this._selectOptionByValue(e);i?this._keyManager.updateActiveItem(i):this.panelOpen||this._keyManager.updateActiveItem(-1)}this._changeDetectorRef.markForCheck()}_selectOptionByValue(e){const i=this.options.find(r=>{if(this._selectionModel.isSelected(r))return!1;try{return null!=r.value&&this._compareWith(r.value,e)}catch(s){return!1}});return i&&this._selectionModel.select(i),i}_assignValue(e){return!!(e!==this._value||this._multiple&&Array.isArray(e))&&(this.options&&this._setSelectionByValue(e),this._value=e,!0)}_initKeyManager(){this._keyManager=new l2(this.options).withTypeAhead(this._typeaheadDebounceInterval).withVerticalOrientation().withHorizontalOrientation("ltr").withHomeAndEnd().withAllowedModifierKeys(["shiftKey"]),this._keyManager.tabOut.pipe(Li(this._destroy)).subscribe(()=>{this.panelOpen&&(!this.multiple&&this._keyManager.activeItem&&this._keyManager.activeItem._selectViaInteraction(),this.focus(),this.close())}),this._keyManager.change.pipe(Li(this._destroy)).subscribe(()=>{this._panelOpen&&this.panel?this._scrollOptionIntoView(this._keyManager.activeItemIndex||0):!this._panelOpen&&!this.multiple&&this._keyManager.activeItem&&this._keyManager.activeItem._selectViaInteraction()})}_resetOptions(){const e=rr(this.options.changes,this._destroy);this.optionSelectionChanges.pipe(Li(e)).subscribe(i=>{this._onSelect(i.source,i.isUserInput),i.isUserInput&&!this.multiple&&this._panelOpen&&(this.close(),this.focus())}),rr(...this.options.map(i=>i._stateChanges)).pipe(Li(e)).subscribe(()=>{this._changeDetectorRef.markForCheck(),this.stateChanges.next()})}_onSelect(e,i){const r=this._selectionModel.isSelected(e);null!=e.value||this._multiple?(r!==e.selected&&(e.selected?this._selectionModel.select(e):this._selectionModel.deselect(e)),i&&this._keyManager.setActiveItem(e),this.multiple&&(this._sortValues(),i&&this.focus())):(e.deselect(),this._selectionModel.clear(),null!=this.value&&this._propagateChanges(e.value)),r!==this._selectionModel.isSelected(e)&&this._propagateChanges(),this.stateChanges.next()}_sortValues(){if(this.multiple){const e=this.options.toArray();this._selectionModel.sort((i,r)=>this.sortComparator?this.sortComparator(i,r,e):e.indexOf(i)-e.indexOf(r)),this.stateChanges.next()}}_propagateChanges(e){let i=null;i=this.multiple?this.selected.map(r=>r.value):this.selected?this.selected.value:e,this._value=i,this.valueChange.emit(i),this._onChange(i),this.selectionChange.emit(new c9(this,i)),this._changeDetectorRef.markForCheck()}_highlightCorrectOption(){this._keyManager&&(this.empty?this._keyManager.setFirstItemActive():this._keyManager.setActiveItem(this._selectionModel.selected[0]))}_canOpen(){var e;return!this._panelOpen&&!this.disabled&&(null===(e=this.options)||void 0===e?void 0:e.length)>0&&!this.readonly}focus(e){this._elementRef.nativeElement.focus(e)}_getPanelAriaLabelledby(){var e;if(this.ariaLabel)return null;const i=null===(e=this._parentFormField)||void 0===e?void 0:e.getLabelId();return this.ariaLabelledby?(i?i+" ":"")+this.ariaLabelledby:i}_getAriaActiveDescendant(){return this.panelOpen&&this._keyManager&&this._keyManager.activeItem?this._keyManager.activeItem.id:null}_getTriggerAriaLabelledby(){var e;if(this.ariaLabel)return null;const i=null===(e=this._parentFormField)||void 0===e?void 0:e.getLabelId();let r=(i?i+" ":"")+this._valueId;return this.ariaLabelledby&&(r+=" "+this.ariaLabelledby),r}_panelDoneAnimating(e){this.panelOpen?this._scrollTop=0:(this.overlayDir.offsetX=0,this._changeDetectorRef.markForCheck()),e||this._elementRef.nativeElement.classList.remove("sbb-input-with-open-panel-above"),this.openedChange.emit(e)}setDescribedByIds(e){e.length?this._elementRef.nativeElement.setAttribute("aria-describedby",e.join(" ")):this._elementRef.nativeElement.removeAttribute("aria-describedby")}onContainerClick(){this.focus(),this.open()}_calculateOverlayScroll(e,i,r){const s=e._getHostElement().offsetHeight,d=e._getHostElement().offsetTop;return Math.min(Math.max(0,d-i+s/2),r)}_scrollOptionIntoView(e){if(0===e)this.panel.nativeElement.scrollTop=0;else{const i=this.options.toArray()[e];if(i){const r=i._getHostElement();this.panel.nativeElement.scrollTop=E2(r.offsetTop,r.offsetHeight,this.panel.nativeElement.scrollTop,this.panel.nativeElement.offsetHeight)}}}_positioningSettled(){this.panel.nativeElement.scrollTop=this._scrollTop}_calculateOverlayPosition(){if(!this.panel)return;const e=this.panel.nativeElement.clientHeight,r=this.panel.nativeElement.scrollHeight-e,s=this._selectionModel.selected[0];this._scrollTop=this.empty||-1===this.options.toArray().indexOf(s)?0:this._calculateOverlayScroll(s,e/2,r)}}return n.\u0275fac=function(e){return new(e||n)($($u),$(Dr),$(oi),$($D),$(Pn),$(Hg,8),$(Gg,8),$(Yw,8),$(Vl,10),Vr("tabindex"),$($L),$(f2),$(a9,8))},n.\u0275cmp=kn({type:n,selectors:[["sbb-select"]],contentQueries:function(e,i,r){if(1&e&&(Ur(r,tv,5),Ur(r,T2,5)),2&e){let s;zn(s=Vn())&&(i.options=s),zn(s=Vn())&&(i.optionGroups=s)}},viewQuery:function(e,i){if(1&e&&(mr(K7,5),mr(Q2,5)),2&e){let r;zn(r=Vn())&&(i.panel=r.first),zn(r=Vn())&&(i.overlayDir=r.first)}},hostAttrs:["role","combobox","aria-autocomplete","none","aria-haspopup","true",1,"sbb-select","sbb-input-element"],hostVars:26,hostBindings:function(e,i){1&e&&Wt("click",function(){return i.toggle()})("keydown",function(s){return i._handleKeydown(s)})("focus",function(){return i._onFocus()})("blur",function(){return i._onBlur()}),2&e&&(Ht("id",i.id)("tabindex",i.readonly?-1:i.tabIndex)("aria-controls",i.panelOpen?i.id+"-panel":null)("aria-owns",i.panelOpen?i.id+"-panel":null)("aria-expanded",i.panelOpen)("aria-label",i.ariaLabel||null)("aria-required",i.required.toString())("aria-disabled",i.disabled.toString())("aria-invalid",i.errorState)("aria-activedescendant",i._getAriaActiveDescendant()),Oi("sbb-disabled",i.disabled)("sbb-select-invalid",i.errorState)("sbb-select-required",i.required)("sbb-select-empty",i.empty)("sbb-select-multiple",i.multiple)("sbb-readonly",i.readonly)("sbb-focused",i.focused)("sbb-input-with-open-panel",i.panelOpen))},inputs:{disabled:"disabled",tabIndex:"tabIndex",userAriaDescribedBy:["aria-describedby","userAriaDescribedBy"],panelClass:"panelClass",placeholder:"placeholder",required:"required",multiple:"multiple",readonly:"readonly",compareWith:"compareWith",value:"value",ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],errorStateMatcher:"errorStateMatcher",typeaheadDebounceInterval:"typeaheadDebounceInterval",sortComparator:"sortComparator",id:"id"},outputs:{openedChange:"openedChange",_openedStream:"opened",_closedStream:"closed",selectionChange:"selectionChange",valueChange:"valueChange"},exportAs:["sbbSelect"],features:[Kn([{provide:sv,useExisting:n},{provide:zw,useExisting:n}]),ut,dr],ngContentSelectors:r9,decls:8,vars:20,consts:[["aria-hidden","true",1,"sbb-select-value",3,"ngSwitch"],["class","sbb-select-placeholder",4,"ngSwitchCase"],["class","sbb-select-value-text",4,"ngSwitchCase"],[3,"ngSwitch"],["class","sbb-icon-scaled sbb-select-arrow-icon","svgIcon","kom:chevron-small-down-small",4,"ngSwitchCase"],["class","sbb-icon-scaled sbb-select-arrow-icon sbb-select-arrow-icon-lean","svgIcon","kom:chevron-right-small",4,"ngSwitchCase"],["cdk-connected-overlay","","cdkConnectedOverlayLockPosition","","cdkConnectedOverlayFlexibleDimensions","","cdkConnectedOverlayHasBackdrop","","cdkConnectedOverlayBackdropClass","cdk-overlay-transparent-backdrop",3,"cdkConnectedOverlayPanelClass","cdkConnectedOverlayScrollStrategy","cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayPositions","cdkConnectedOverlayWidth","cdkConnectedOverlayOffsetX","cdkConnectedOverlayOffsetY","cdkConnectedOverlayMinHeight","backdropClick","attach","detach"],[1,"sbb-select-placeholder"],[1,"sbb-select-value-text"],["svgIcon","kom:chevron-small-down-small",1,"sbb-icon-scaled","sbb-select-arrow-icon"],["svgIcon","kom:chevron-right-small",1,"sbb-icon-scaled","sbb-select-arrow-icon","sbb-select-arrow-icon-lean"],["role","listbox","tabindex","-1",1,"sbb-panel","sbb-panel-padded","sbb-select-panel","sbb-scrollbar",3,"ngClass","keydown"],["panel",""]],template:function(e,i){1&e&&(Ro(),Ee(0,"div",0),cn(1,J7,2,1,"span",1),cn(2,e9,3,1,"span",2),Pe(),Fd(3,3),kg(4,"async"),cn(5,t9,1,0,"sbb-icon",4),cn(6,n9,1,0,"sbb-icon",5),Nd(),cn(7,i9,3,12,"ng-template",6),Wt("backdropClick",function(){return i.close()})("attach",function(){return i._onAttached()})("detach",function(){return i.close()})),2&e&&(Oi("sbb-select-value-empty",i.empty),dt("ngSwitch",i.empty),Ht("id",i._valueId),Je(1),dt("ngSwitchCase",!0),Je(1),dt("ngSwitchCase",!1),Je(1),dt("ngSwitch",Rg(4,18,i.variant)),Je(2),dt("ngSwitchCase","standard"),Je(1),dt("ngSwitchCase","lean"),Je(1),dt("cdkConnectedOverlayPanelClass",i._overlayPanelClass)("cdkConnectedOverlayScrollStrategy",i._scrollStrategy)("cdkConnectedOverlayOrigin",i._overlayOrigin)("cdkConnectedOverlayOpen",i.panelOpen)("cdkConnectedOverlayPositions",i._positions)("cdkConnectedOverlayWidth",null==i._triggerRect?null:i._triggerRect.width)("cdkConnectedOverlayOffsetX",0)("cdkConnectedOverlayOffsetY",i._offsetY)("cdkConnectedOverlayMinHeight",30))},dependencies:[Bg,zg,vx,Q2,Xa,vy],styles:[".sbb-select{display:inline-block;cursor:pointer;position:relative;text-align:left;padding-right:calc(2.9333333333rem * var(--sbb-scaling-factor))}:where(html.sbb-lean) .sbb-select{padding-right:2.5333333333rem}.sbb-select:is([readonly],.sbb-readonly){cursor:default}.sbb-form-field .sbb-select,.sbb-table th.sbb-header-cell.sbb-table-filter .sbb-select{display:block}.sbb-select-value{overflow:hidden;text-overflow:ellipsis}:where(html.sbb-lean) .sbb-select-value-empty{color:var(--sbb-color-storm)}.sbb-select-arrow-icon{position:absolute;top:50%;transform:translateY(-50%);right:calc(0.6rem * var(--sbb-scaling-factor));color:var(--sbb-color-grey)}:where(html.sbb-lean) .sbb-select-arrow-icon{right:.4rem}.sbb-select:is([readonly],.sbb-readonly) .sbb-select-arrow-icon{display:none}.sbb-select-arrow-icon>svg{transition:transform 120ms cubic-bezier(0, 0, 0.2, 1)}.sbb-input-with-open-panel .sbb-select-arrow-icon>svg{transform:rotate(180deg)}.sbb-icon.sbb-select-arrow-icon-lean>svg{transform:rotate(90deg)}.sbb-input-with-open-panel .sbb-icon.sbb-select-arrow-icon-lean>svg{transform:rotate(-90deg)}.sbb-select-panel :is(.sbb-menu-group+.sbb-menu-group,.sbb-menu-item+.sbb-menu-group,.sbb-menu-group+.sbb-menu-item){border-top:none}:where(html:not(.sbb-lean)) .sbb-select-panel.sbb-select-multiple .sbb-menu-group .sbb-menu-item{padding-left:calc(0.9333333333rem * var(--sbb-scaling-factor))}"],encapsulation:2,data:{animation:[o9.transformPanel]},changeDetection:0}),n})(),GL=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({providers:[l9],imports:[wr,yl,Gi,bo,Vw,Vw,yl]}),n})();const h9=["settingsContainer"];function p9(n,t){if(1&n&&(Ee(0,"sbb-option",17),Pt(1),Pe()),2&n){const e=t.$implicit,i=Fn();dt("value",e.modeType),Je(1),tr(i.computeTripModeTypeText(e.modeType))}}function f9(n,t){if(1&n){const e=ml();Ee(0,"div",18),Wt("click",function(){return Wi(e),no(Fn().showRequestXmlPopover())}),Ee(1,"span",19),Pt(2,"XML"),Pe()()}}function m9(n,t){if(1&n&&(Ee(0,"sbb-option",17),Pt(1),Pe()),2&n){const e=t.$implicit,i=Fn();dt("value",e),Je(1),tr(i.computeTripTransportModeText(e))}}function g9(n,t){if(1&n){const e=ml();Ee(0,"div",20)(1,"div",21),Wt("click",function(){return Wi(e),no(Fn().handleTapOnMapButton())}),Ml(),Ee(2,"svg",22),qn(3,"path",23),Pe(),Pt(4," Via "),Pe(),Al(),Ee(5,"div",24)(6,"div"),Pt(7),Pe(),qn(8,"div",25),Ee(9,"button",26),Wt("click",function(){return Wi(e),no(Fn().removeVia())}),Ml(),Ee(10,"svg",27),qn(11,"path",28)(12,"path",29),Pe(),Pt(13," Remove "),Pe()()()}if(2&n){const e=Fn();Je(7),tr(e.computeViaName())}}let b9=(()=>{class n{constructor(e,i,r){this.debugXmlPopover=e,this.userTripService=i,this.mapService=r,this.tripTransportModeData=[{modeType:"monomodal",transportModes:["public_transport","walk","cycle","car_self_driving","bicycle_rental","escooter_rental","car_sharing"]},{modeType:"mode_at_start",transportModes:["walk","cycle","car_self_driving","bicycle_rental","escooter_rental","car_sharing"]},{modeType:"mode_at_end",transportModes:["walk","bicycle_rental","escooter_rental","car_sharing"]},{modeType:"mode_at_start_end",transportModes:["walk","bicycle_rental","escooter_rental","car_sharing"]}],this.tripModeType=this.tripTransportModeData[0].modeType,this.tripTransportModes=JSON.parse(JSON.stringify(this.tripTransportModeData[0].transportModes)),this.tripTransportMode=this.tripTransportModes[0],this.tripModeTypeIdx=0,this.tripMotTypeDataModel={},this.settingsCollapseID="mode_custom_mode_settings_NOT_READY_YET",this.endpointMinDurationS="2",this.endpointMaxDurationS="30",this.endpointMinDistanceS="100",this.endpointMaxDistanceS="20000"}ngOnInit(){var e;this.tripModeType=this.userTripService.tripModeTypes[this.tripModeTypeIdx];const i=null!==(e=this.tripTransportModeData.find(r=>r.modeType===this.tripModeType))&&void 0!==e?e:this.tripTransportModeData[0];this.tripTransportModes=JSON.parse(JSON.stringify(i.transportModes)),this.tripTransportMode=this.userTripService.tripTransportModes[this.tripModeTypeIdx],this.tripMotTypeDataModel.isNotLastSegment=!this.isLastSegment(),this.tripMotTypeDataModel.sectionRequestData=null,this.userTripService.activeTripSelected.subscribe(r=>{this.updateRequestDataModel()}),this.userTripService.defaultsInited.subscribe(r=>{this.userTripService.updateTripLocationCustomMode(this.tripModeTypeIdx)}),this.settingsCollapseID="mode_custom_mode_settings_"+this.tripModeTypeIdx}isLastSegment(){return this.tripModeTypeIdx===this.userTripService.tripModeTypes.length-1}handleTapOnMapButton(){var e;const i=null!==(e=this.userTripService.viaTripLocations[this.tripModeTypeIdx])&&void 0!==e?e:null;this.mapService.tryToCenterAndZoomToLocation(i.location)}computeViaName(){var e,i,r;const s=null!==(e=this.userTripService.viaTripLocations[this.tripModeTypeIdx])&&void 0!==e?e:null;return null===s?"":null!==(r=null===(i=s.location.geoPosition)||void 0===i?void 0:i.asLatLngString())&&void 0!==r?r:""}removeVia(){this.userTripService.removeViaAtIndex(this.tripModeTypeIdx)}onTripModeChange(){var e;const i=null!==(e=this.tripTransportModeData.find(r=>r.modeType===this.tripModeType))&&void 0!==e?e:null;null!==i&&(this.tripTransportModes=JSON.parse(JSON.stringify(i.transportModes)),this.tripTransportMode=this.tripTransportModes[0],this.userTripService.updateTripMode(this.tripModeType,this.tripTransportMode,this.tripModeTypeIdx),this.userTripService.updateTripLocationCustomMode(this.tripModeTypeIdx))}onTransportModeChange(){this.userTripService.updateTripMode(this.tripModeType,this.tripTransportMode,this.tripModeTypeIdx),this.userTripService.updateTripLocationCustomMode(this.tripModeTypeIdx),"public_transport"===this.tripTransportMode&&this.settingsContainer.nativeElement.classList.remove("show")}updateRequestDataModel(){var e;this.tripMotTypeDataModel.isNotLastSegment=!this.isLastSegment();const i=this.userTripService.lastJourneyResponse;if(null===i)return void(this.tripMotTypeDataModel.sectionRequestData=null);const r=null!==(e=i.sections[this.tripModeTypeIdx])&&void 0!==e?e:null;this.tripMotTypeDataModel.sectionRequestData=null!==r?r.requestData:null}showRequestXmlPopover(){const e=this.debugXmlPopover.open(tE,{position:{top:"10px"}});e.afterOpened().subscribe(()=>{e.componentInstance.updateRequestData(this.tripMotTypeDataModel.sectionRequestData)})}computeTripModeTypeText(e){var i;return null!==(i={monomodal:"Monomodal",mode_at_start:"Mode at Start",mode_at_end:"Mode at End",mode_at_start_end:"Mode at Start & End"}[e])&&void 0!==i?i:"n/a"}computeTripTransportModeText(e){var i;return null!==(i={public_transport:"Public Transport",walk:"Walking",cycle:"Own Bicycle",escooter_rental:"eScooter Sharing",car_sharing:"Car Sharing",car_self_driving:"Own Car",bicycle_rental:"Bicycle Sharing",charging_station:"Charging Stations"}[e])&&void 0!==i?i:"n/a"}onRestrictionsChange(){const e=parseInt(this.endpointMinDurationS,10),i=parseInt(this.endpointMaxDurationS,10),r=parseInt(this.endpointMinDistanceS,10),s=parseInt(this.endpointMaxDistanceS,10);this.userTripService.updateTripLocationRestrictions(e,i,r,s,this.tripModeTypeIdx)}}return n.\u0275fac=function(e){return new(e||n)($(Lp),$(ju),$(Qd))},n.\u0275cmp=kn({type:n,selectors:[["trip-mode-type"]],viewQuery:function(e,i){if(1&e&&mr(h9,5),2&e){let r;zn(r=Vn())&&(i.settingsContainer=r.first)}},inputs:{tripModeTypeIdx:"tripModeTypeIdx"},decls:39,vars:14,consts:[[1,"trip-mot-type-container"],[1,"d-flex","align-items-center","via-mot"],[1,"flex-grow-1"],[1,"w-100"],[3,"ngModel","ngModelChange","selectionChange"],[3,"value",4,"ngFor","ngForOf"],["class","xml-info",3,"click",4,"ngIf"],[1,"mobility-settings"],["sbb-secondary-button","","type","button","data-bs-toggle","collapse","aria-expanded","false",3,"disabled"],["svgIcon","kom:combined-mobility-small"],[1,"mobility-settings-left-v2","endpoint-settings-wrapper","collapse",3,"id"],["settingsContainer",""],[1,"endpoint-settings","d-none2"],[1,"d-flex","align-items-center","mb-2"],["sbbInput","",2,"width","50px",3,"ngModel","ngModelChange","change"],["sbbInput","",2,"width","70px",3,"ngModel","ngModelChange","change"],["class","via-content",4,"ngIf"],[3,"value"],[1,"xml-info",3,"click"],[1,"layer-xml-info","badge","bg-info","text-dark"],[1,"via-content"],[1,"via-label",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","12","height","12","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-map"],["fill-rule","evenodd","d","M15.817.113A.5.5 0 0 1 16 .5v14a.5.5 0 0 1-.402.49l-5 1a.502.502 0 0 1-.196 0L5.5 15.01l-4.902.98A.5.5 0 0 1 0 15.5v-14a.5.5 0 0 1 .402-.49l5-1a.5.5 0 0 1 .196 0L10.5.99l4.902-.98a.5.5 0 0 1 .415.103zM10 1.91l-4-.8v12.98l4 .8V1.91zm1 12.98 4-.8V1.11l-4 .8v12.98zm-6-.8V1.11l-4 .8v12.98l4-.8z"],[1,"d-flex","align-items-center"],[2,"width","8px"],["type","button",1,"btn","btn-sm","btn-outline-danger",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-x-circle"],["d","M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"],["d","M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"]],template:function(e,i){1&e&&(Ee(0,"div",0)(1,"div",1)(2,"div",2)(3,"sbb-form-field",3)(4,"sbb-label"),Pt(5,"Choose Multimodal / Monomodal"),Pe(),Ee(6,"sbb-select",4),Wt("ngModelChange",function(s){return i.tripModeType=s})("selectionChange",function(){return i.onTripModeChange()}),cn(7,p9,2,2,"sbb-option",5),Pe()()(),cn(8,f9,3,0,"div",6),Pe(),Ee(9,"div",1)(10,"div",2)(11,"sbb-form-field",3)(12,"sbb-label"),Pt(13,"Choose MOT (Mode of Transport)"),Pe(),Ee(14,"sbb-select",4),Wt("ngModelChange",function(s){return i.tripTransportMode=s})("selectionChange",function(){return i.onTransportModeChange()}),cn(15,m9,2,2,"sbb-option",5),Pe()()(),Ee(16,"div",7)(17,"button",8),qn(18,"sbb-icon",9),Pe()()(),Ee(19,"div",10,11)(21,"div",12)(22,"div",13)(23,"div",2),Pt(24," Duration (mins) "),Pe(),Ee(25,"div")(26,"input",14),Wt("ngModelChange",function(s){return i.endpointMinDurationS=s})("change",function(){return i.onRestrictionsChange()}),Pe(),Ee(27,"span"),Pt(28," to "),Pe(),Ee(29,"input",14),Wt("ngModelChange",function(s){return i.endpointMaxDurationS=s})("change",function(){return i.onRestrictionsChange()}),Pe()()(),Ee(30,"div",13)(31,"div",2),Pt(32," Distance (meters) "),Pe(),Ee(33,"div")(34,"input",14),Wt("ngModelChange",function(s){return i.endpointMinDistanceS=s})("change",function(){return i.onRestrictionsChange()}),Pe(),Ee(35,"span"),Pt(36," to "),Pe(),Ee(37,"input",15),Wt("ngModelChange",function(s){return i.endpointMaxDistanceS=s})("change",function(){return i.onRestrictionsChange()}),Pe()()()()(),cn(38,g9,14,1,"div",16),Pe()),2&e&&(Je(6),dt("ngModel",i.tripModeType),Je(1),dt("ngForOf",i.tripTransportModeData),Je(1),dt("ngIf",i.tripMotTypeDataModel.sectionRequestData),Je(6),dt("ngModel",i.tripTransportMode),Je(1),dt("ngForOf",i.tripTransportModes),Je(2),hp("disabled","monomodal"===i.tripModeType),Ht("data-bs-target","#"+i.settingsCollapseID+("monomodal"===i.tripModeType?"_DISABLED":""))("aria-controls",i.settingsCollapseID),Je(2),hp("id",i.settingsCollapseID),Je(7),dt("ngModel",i.endpointMinDurationS),Je(3),dt("ngModel",i.endpointMaxDurationS),Je(5),dt("ngModel",i.endpointMinDistanceS),Je(3),dt("ngModel",i.endpointMaxDistanceS),Je(1),dt("ngIf",i.tripMotTypeDataModel.isNotLastSegment))},dependencies:[Nl,na,Gd,Gf,$g,tv,SL,av,oE,Xa,sb,d9],styles:[".trip-mot-type-container[_ngcontent-%COMP%]{margin-top:0;margin-bottom:0}.via-content[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:16px}.via-mot[_ngcontent-%COMP%]{margin-left:12px}.via-label[_ngcontent-%COMP%]{font-size:12px}.via-label[_ngcontent-%COMP%]:hover{cursor:pointer}.xml-info[_ngcontent-%COMP%]{cursor:pointer;margin-left:5px}.mobility-settings[_ngcontent-%COMP%]{margin-left:5px;margin-top:3px}.mobility-settings-left-v2[_ngcontent-%COMP%]{margin-left:10px}.endpoint-settings[_ngcontent-%COMP%]{margin-bottom:18px;margin-left:12px;margin-right:12px;padding:0 14px;border-color:#cacaca;border-style:solid;border-width:0 1px 1px 1px;border-radius:2px}"]}),n})();function _9(n,t){1&n&&qn(0,"trip-mode-type",29),2&n&&dt("tripModeTypeIdx",t.index)}function y9(n,t){if(1&n){const e=ml();Ee(0,"sbb-radio-button",30),Wt("change",function(r){return Wi(e),no(Fn().onChangeStageAPI(r))}),Pt(1),Pe()}if(2&n){const e=t.$implicit,i=Fn();dt("value",e)("checked",i.userTripService.currentAppStage==e),Je(1),Do(" ",e," ")}}function v9(n,t){1&n&&qn(0,"span",31)}function x9(n,t){if(1&n&&(Ee(0,"div")(1,"span",32),Pt(2),Pe()()),2&n){const e=Fn();Je(2),tr(e.requestDuration)}}function w9(n,t){if(1&n&&(Ee(0,"div")(1,"a",33),Pt(2,"Permalink"),Pe()()),2&n){const e=Fn();Je(1),hp("href",e.userTripService.permalinkURLAddress,xd)}}let S9=(()=>{class n{constructor(e,i,r,s){this.notificationToast=e,this.tripXmlPopover=i,this.userTripService=r,this.mapService=s,this.appStageOptions=[];const d=this.userTripService.departureDate;this.searchDate=d,this.searchTime=_l.formatTimeHHMM(d),this.fromLocationText="",this.toLocationText="",this.appStageOptions=["PROD","INT","TEST","LA Beta"],this.isSearching=!1,this.tripRequestFormattedXML="RequestXML",this.tripResponseFormattedXML="ResponseXML",this.requestDuration=null,this.lastCustomTripRequestXML=null,this.useMocks=!1}ngOnInit(){this.userTripService.initDefaults(),this.userTripService.locationsUpdated.subscribe(e=>{this.updateLocationTexts(),this.expandSearchPanel()}),this.userTripService.tripsUpdated.subscribe(e=>{e.length>0?this.collapseSearchPanel():this.expandSearchPanel()}),this.userTripService.searchParamsReset.subscribe(()=>{this.expandSearchPanel(),this.requestDuration=null}),this.userTripService.defaultsInited.subscribe(e=>{var i;null!==(i=new URLSearchParams(document.location.search).get("do_search"))&&void 0!==i&&i&&this.handleTapOnSearch()}),this.useMocks&&this.initLocationsFromMocks()}updateLocationTexts(){["From","To"].forEach(i=>{var r,s,d,m,v;const D="From"===i?this.userTripService.fromTripLocation:this.userTripService.toTripLocation,A=null!==(r=null==D?void 0:D.location)&&void 0!==r?r:null;if(null===A)return;let L="";L=(null!==(d=null===(s=A.stopPlace)||void 0===s?void 0:s.stopPlaceName)&&void 0!==d?d:null)||(null!==(v=null===(m=A.geoPosition)||void 0===m?void 0:m.asLatLngString())&&void 0!==v?v:""),"From"===i?this.fromLocationText=L:this.toLocationText=L})}initLocationsFromMocks(){let i="n/a";i="assets/mocks/ojp-trips-response/on-demand-response.xml";const r=fetch(i);console.log("USE MOCKS: "+i),r.then(s=>{s.text().then(d=>{const m=Dp.initWithXML(d,"public_transport");console.log("MOCK RESPONSE from "+i),console.log(m),this.handleCustomTripResponse(m);const v=i.split("/");if(this.requestDuration="MOCK from "+v[v.length-1],m.trips.length>0){const j={bounds:m.trips[0].computeBBOX().asLngLatBounds()};this.mapService.newMapBoundsRequested.emit(j)}})})}onLocationSelected(e,i){this.userTripService.updateTripEndpoint(e,i,"SearchForm")}onChangeStageAPI(e){this.userTripService.updateAppStage(e.value),this.userTripService.refetchEndpointsByName()}onChangeDateTime(){this.userTripService.updateDepartureDateTime(this.computeFormDepartureDate())}computeFormDepartureDate(){const e=this.searchDate,i=this.searchTime.split(":");if(2===i.length){const r=parseInt(i[0]),s=parseInt(i[1]);e.setHours(r),e.setMinutes(s)}return e}shouldDisableSearchButton(){return!!this.isSearching}handleTapOnSearch(){this.userTripService.updateDepartureDateTime(this.computeFormDepartureDate());const e=this.userTripService.computeJourneyRequestParams();if(null===e)return void console.error("Whooops, JourneyRequestParams cant be null");this.notificationToast.dismiss();const i=this.userTripService.getStageConfig(),r=new F8(i,e);this.isSearching=!0;const s=new Date;r.fetchResponse((d,m)=>{if(m)return this.notificationToast.open(m.message,{type:"error",verticalPosition:"top"}),this.isSearching=!1,this.userTripService.lastJourneyResponse=null,this.requestDuration=null,void this.userTripService.updateTrips([]);0===d.length&&this.notificationToast.open("No trips found",{type:"info",verticalPosition:"top"});const D=(((new Date).getTime()-s.getTime())/1e3).toFixed(2);this.requestDuration=D+" sec",this.isSearching=!1,this.userTripService.lastJourneyResponse=r.lastJourneyResponse,this.userTripService.updateTrips(d)})}expandSearchPanel(){var e;null===(e=this.searchPanel)||void 0===e||e.open()}collapseSearchPanel(){var e;null===(e=this.searchPanel)||void 0===e||e.close()}loadInputTripXMLPopover(){const e=this.tripXmlPopover.open(RW,{position:{top:"20px"}});e.afterOpened().subscribe(()=>{const i=e.componentInstance;i.inputTripRequestXmlS=this.userTripService.computeTripRequestXML(this.computeFormDepartureDate()),i.tripCustomRequestSaved.subscribe(r=>{this.lastCustomTripRequestXML=i.inputTripRequestXmlS;const s=Dp.initWithXML(r,"public_transport");0!==s.trips.length?(e.close(),this.handleCustomTripResponse(s)):i.inputTripRequestResponseXmlS=r}),i.tripCustomResponseSaved.subscribe(r=>{const s=Dp.initWithXML(r,"public_transport");0!==s.trips.length&&(e.close(),this.handleCustomTripResponse(s))})})}handleCustomTripResponse(e){this.requestDuration="USER XML",this.isSearching=!1,this.userTripService.lastJourneyResponse=null,this.userTripService.updateTrips(e.trips),this.collapseSearchPanel(),this.updateSearchForm(e)}updateSearchForm(e){const i=e.trips[0];null!==i&&(this.userTripService.updateParamsFromTrip(i),this.updateLocationTexts())}swapEndpoints(){this.userTripService.switchEndpoints()}}return n.\u0275fac=function(e){return new(e||n)($(jW),$(Lp),$(ju),$(Qd))},n.\u0275cmp=kn({type:n,selectors:[["app-search-form"]],viewQuery:function(e,i){if(1&e&&mr(am,7),2&e){let r;zn(r=Vn())&&(i.searchPanel=r.first)}},decls:42,vars:15,consts:[[1,"row","mb-1"],[1,"col"],[3,"expanded"],[1,"d-flex"],[1,"flex-grow-1","journey-endpoint"],[3,"endpointType","inputValue","placeholder","selectedLocation"],[3,"tripModeTypeIdx",4,"ngFor","ngForOf"],[1,"d-flex","align-items-center"],[1,"swap-endpoints"],["sbb-secondary-button","","data-bs-toggle","collapse","aria-expanded","false",3,"click"],["svgIcon","kom:arrow-change-horizontal-medium"],["label","Choose Day"],["arrows",""],["sbbInput","","sbbDateInput","",3,"ngModel","ngModelChange","dateChange"],[2,"margin-left","8px"],["label","Time"],["sbbInput","","sbbTimeInput","",3,"ngModel","ngModelChange","change"],[1,"mb-2","d-flex"],[1,"sbb-radio-group-horizontal"],[3,"value","checked","change",4,"ngFor","ngForOf"],[2,"margin-right","4px"],["type","button",1,"btn","btn-primary",3,"disabled","click"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],[1,"ms-auto"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"row","mb-2"],[1,"d-flex","flex-row-reverse"],[4,"ngIf"],[2,"width","7px"],[3,"tripModeTypeIdx"],[3,"value","checked","change"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"],[1,"badge","bg-success"],["target","_blank",3,"href"]],template:function(e,i){1&e&&(Ee(0,"div",0)(1,"div",1)(2,"sbb-accordion")(3,"sbb-expansion-panel",2)(4,"sbb-expansion-panel-header"),Pt(5,"Search"),Pe(),Ee(6,"div",3)(7,"div",4)(8,"journey-point-input",5),Wt("selectedLocation",function(s){return i.onLocationSelected(s,"From")}),Pe()()(),cn(9,_9,1,1,"trip-mode-type",6),Ee(10,"div",7)(11,"div",4)(12,"journey-point-input",5),Wt("selectedLocation",function(s){return i.onLocationSelected(s,"To")}),Pe()(),Ee(13,"div",8)(14,"button",9),Wt("click",function(){return i.swapEndpoints()}),qn(15,"sbb-icon",10),Pe()()(),Ee(16,"div",3)(17,"div")(18,"sbb-form-field",11)(19,"sbb-datepicker",12)(20,"input",13),Wt("ngModelChange",function(s){return i.searchDate=s})("dateChange",function(){return i.onChangeDateTime()}),Pe()()()(),Ee(21,"div",14)(22,"sbb-form-field",15)(23,"input",16),Wt("ngModelChange",function(s){return i.searchTime=s})("change",function(){return i.onChangeDateTime()}),Pe()()()(),Ee(24,"div",17)(25,"div")(26,"sbb-radio-group",18),cn(27,y9,2,3,"sbb-radio-button",19),Pe()()(),Ee(28,"div",3)(29,"div",20)(30,"button",21),Wt("click",function(){return i.handleTapOnSearch()}),cn(31,v9,1,0,"span",22),Pt(32," Search Journeys "),Pe()(),Ee(33,"div",23)(34,"button",24),Wt("click",function(){return i.loadInputTripXMLPopover()}),Pt(35," Debug XML "),Pe()()()()()()(),Ee(36,"div",25)(37,"div",1)(38,"div",26),cn(39,x9,3,1,"div",27),qn(40,"div",28),cn(41,w9,3,1,"div",27),Pe()()()),2&e&&(Je(3),dt("expanded",!0),Je(5),dt("endpointType","From")("inputValue",i.fromLocationText)("placeholder","From"),Je(1),dt("ngForOf",i.userTripService.journeyTripsPlaceholder),Je(3),dt("endpointType","To")("inputValue",i.toLocationText)("placeholder","To"),Je(8),dt("ngModel",i.searchDate),Je(3),dt("ngModel",i.searchTime),Je(4),dt("ngForOf",i.appStageOptions),Je(3),dt("disabled",i.shouldDisableSearchButton()),Je(1),dt("ngIf",i.isSearching),Je(8),dt("ngIf",null!==i.requestDuration),Je(2),dt("ngIf",null!==i.userTripService.permalinkURLAddress))},dependencies:[Nl,na,Gd,Gf,$g,qD,am,Hw,SL,uE,Jw,av,Xa,sb,OL,hE,FL,Q7,b9],styles:[".debug-xml[_ngcontent-%COMP%]:hover{cursor:pointer}.swap-endpoints[_ngcontent-%COMP%]{margin-left:5px;margin-top:10px}"]}),n})(),C9=(()=>{class n{ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=kn({type:n,selectors:[["journey-search"]],decls:6,vars:0,consts:[[1,"row"],[1,"col-md-4"],[1,"col-md-8"]],template:function(e,i){1&e&&(Ee(0,"div",0)(1,"div",1),qn(2,"app-search-form")(3,"journey-results"),Pe(),Ee(4,"div",2),qn(5,"app-map"),Pe()())},dependencies:[Qq,AW,S9],encapsulation:2}),n})();const T9=JSON.parse('{"id":"ojp-service-track-line","type":"line","source":"[SOURCE_ID]","filter":["all",["==",["geometry-type"],"LineString"]],"layout":{"line-join":"round","line-cap":"round"},"paint":{"line-width":4,"line-opacity":1,"line-color":["case",["==",["get","line-type"],"prev"],"#D3D3D3","#3D69CA"]}}'),D9=JSON.parse('{"id":"ojp-service-track-stop","type":"circle","source":"[SOURCE_ID]","filter":["all",["==",["geometry-type"],"Point"]],"layout":{},"paint":{"circle-radius":["case",["==",["get","point-size"],"large"],6,4],"circle-color":["case",["==",["get","line-type"],"prev"],"#D3D3D3","#3D69CA"],"circle-stroke-color":"#FFF","circle-stroke-width":["case",["==",["get","point-size"],"large"],3,1]}}');class E9{constructor(t){this.map=t,this.sourceID="stop-event-service-data",this.addMapLayers(t)}addMapLayers(t){t.addSource(this.sourceID,{type:"geojson",data:{type:"FeatureCollection",features:[]}});const i=T9;i.source=this.sourceID,t.addLayer(i);const r=D9;r.source=this.sourceID,t.addLayer(r)}drawStopEvent(t){let e=[];const i={prev:[],next:[]},r={prev:[],next:[]},s=["prev","next"];s.forEach(v=>{const D="prev"===v;let A=D?t.prevStopPoints:t.nextStopPoints;A.forEach((L,j)=>{const W=L.location.geoPosition;if(null===W)return;i[v].push(W.asPosition());const ie=0===j,we=j===A.length-1,Re=L.location.asGeoJSONFeature();Re&&Re.properties&&(Re.properties["point-type"]=v,Re.properties["point-size"]=D?ie?"large":"normal":we?"large":"normal",r[v].push(Re))})});const d=t.stopPoint.location.geoPosition;if(d){i.prev.push(d.asPosition()),i.next.unshift(d.asPosition());const v=t.stopPoint.location.asGeoJSONFeature();v&&v.properties&&(v.properties["point-type"]="next",v.properties["point-size"]="large",r.next.push(v))}s.forEach(v=>{const D=i[v];D.length<2||(e.push({type:"Feature",properties:{"line-type":v},geometry:{type:"LineString",coordinates:D}}),e=e.concat(r[v]))}),this.udateStopEventSource({type:"FeatureCollection",features:e})}resetStopEventLayers(){this.udateStopEventSource({type:"FeatureCollection",features:[]})}udateStopEventSource(t){const e=this.map.getSource(this.sourceID);if(null===e)return console.error("ERROR - cant find the source "+this.sourceID),void console.log(this.map.getStyle());e.setData(t)}}let fE=(()=>{class n{constructor(){this.stationBoardDataUpdated=new Xt,this.stationBoardEntrySelected=new Xt,this.stationOnMapClicked=new Xt}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ut({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),I9=(()=>{class n{constructor(e,i,r,s){this.userTripService=e,this.mapService=i,this.debugXmlPopover=r,this.stationBoardService=s,this.mapLoadingPromise=null,this.stopEventServiceRenderer=null}ngOnInit(){this.initMap(),this.mapService.newMapCenterAndZoomRequested.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{r.jumpTo({center:e.lnglat,zoom:e.zoom})})}),this.stationBoardService.stationBoardEntrySelected.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{this.updateMapForEntry(e)})})}initMap(){const e=new(oa().LngLatBounds)([[5.9559,45.818],[10.4921,47.8084]]),i=new(oa().Map)({container:"map_canvas_station_board",style:"mapbox://styles/mapbox/light-v10",bounds:e,accessToken:"pk.eyJ1IjoidmFzaWxlIiwiYSI6ImNra2k2dWFkeDFrbG0ycXF0Nmg0Z2tsNXAifQ.nK-i-3cpWmji7HvK1Ilynw"});this.mapService.initialMapCenter?(i.setCenter(this.mapService.initialMapCenter),this.mapService.initialMapZoom&&i.setZoom(this.mapService.initialMapZoom)):i.fitBounds(e,{padding:50,duration:0}),this.mapLoadingPromise=new Promise((r,s)=>{i.on("load",d=>{r(i),this.onMapLoad(i)})})}onMapLoad(e){this.addMapControls(e),this.addMapListeners(e),this.stopEventServiceRenderer=new E9(e)}addMapControls(e){const i=new(oa().NavigationControl)({showCompass:!1,visualizePitch:!1});e.addControl(i,"bottom-right");const r=new(oa().ScaleControl)({maxWidth:200,unit:"metric"});e.addControl(r);const s=new iL(e);e.addControl(s,"top-left");const d=new yL(e,this.debugXmlPopover,this.userTripService);e.addControl(d,"top-right")}updateMapForEntry(e){var i,r;null===e?null===(i=this.stopEventServiceRenderer)||void 0===i||i.resetStopEventLayers():null===(r=this.stopEventServiceRenderer)||void 0===r||r.drawStopEvent(e)}addMapListeners(e){e.on("styleimagemissing",i=>{e.loadImage("./assets/map-style-icons/"+i.id+".png",(s,d)=>{s?console.error(s):!e.hasImage(i.id)&&d&&e.addImage(i.id,d)})}),e.on("click",i=>{const r=dm.queryNearbyFeatureByLayerIDs(e,i.lngLat,["stops-circle","stops-label"]);null!=r&&r.feature&&this.stationBoardService.stationOnMapClicked.emit(null==r?void 0:r.feature)})}}return n.\u0275fac=function(e){return new(e||n)($(ju),$(Qd),$(Lp),$(fE))},n.\u0275cmp=kn({type:n,selectors:[["station-board-map"]],decls:1,vars:0,consts:[["id","map_canvas_station_board",1,"map_wrapper"]],template:function(e,i){1&e&&qn(0,"div",0)},styles:[".map_wrapper[_ngcontent-%COMP%]{height:600px;border:1px solid #e5e5e5}"]}),n})();const M9=["stationBoardWrapper"];function A9(n,t){if(1&n&&(Ee(0,"div")(1,"div"),Pt(2),Pe()()),2&n){const e=Fn(2).$implicit;Je(2),Do("Pl. ",e.stopPlatform,"")}}function k9(n,t){if(1&n&&(Ee(0,"div")(1,"div"),Pt(2,"Pl. "),Ee(3,"del"),Pt(4),Pe(),Pt(5),Pe()()),2&n){const e=Fn(2).$implicit;Je(4),Do(" ",e.stopPlatform,""),Je(1),Do(" ",e.stopPlatformActual,"")}}function R9(n,t){if(1&n&&(Ee(0,"div",14),cn(1,A9,3,1,"div",13),cn(2,k9,6,2,"div",13),Pe()),2&n){const e=Fn().$implicit;Je(1),dt("ngIf",!e.stopPlatformActual),Je(1),dt("ngIf",e.stopPlatformActual)}}function P9(n,t){if(1&n&&(Ee(0,"div")(1,"div",15),Pt(2),Pe()()),2&n){const e=Fn().$implicit,i=Fn();Je(2),tr(e.mapStationBoardTime[i.stationBoardType].stopTime)}}function O9(n,t){if(1&n&&(Ee(0,"div")(1,"del"),Pt(2),Pe()()),2&n){const e=Fn(2).$implicit,i=Fn();Je(2),tr(e.mapStationBoardTime[i.stationBoardType].stopTime)}}function L9(n,t){if(1&n&&(Ee(0,"div"),cn(1,O9,3,1,"div",13),Ee(2,"div",15),Pt(3),Pe(),Ee(4,"div",16),Pt(5),Pe()()),2&n){const e=Fn().$implicit,i=Fn();Je(1),dt("ngIf",i.hasDelayDifferentTime(e)),Je(2),tr(e.mapStationBoardTime[i.stationBoardType].stopTimeActual),Je(2),tr(e.mapStationBoardTime[i.stationBoardType].stopDelayText)}}const F9=function(n){return{"item-selected":n}};function N9(n,t){if(1&n&&(Ee(0,"div",2)(1,"div",3)(2,"div",4)(3,"div",5)(4,"div",6),Pt(5),Pe(),Ee(6,"div",7),Pt(7),Pe()(),Ee(8,"div",8)(9,"div",9),Pt(10),Pe(),cn(11,R9,3,2,"div",10),Ee(12,"div",11)(13,"span"),Pt(14),Pe(),Pt(15," - "),Ee(16,"span"),Pt(17),Pe()()(),Ee(18,"div",12),cn(19,P9,3,1,"div",13),cn(20,L9,6,3,"div",13),Pe()()()()),2&n){const e=t.$implicit,i=t.index,r=Fn();dt("ngClass",q1(10,F9,i===r.selectedIDx)),Ht("data-index",i),Je(5),tr(e.serviceLineNumber),Je(2),tr(e.tripNumber),Je(3),tr(e.tripHeading),Je(1),dt("ngIf",e.stopPlatform),Je(3),Do("Operator: ",e.tripOperator,""),Je(3),Do("Type: ",e.servicePtMode,""),Je(2),dt("ngIf",!r.hasDelay(e)),Je(1),dt("ngIf",r.hasDelay(e))}}let B9=(()=>{class n{constructor(e){this.stationBoardService=e,this.stopEventsData=[],this.selectedIDx=null,this.stationBoardType="Departures"}ngOnInit(){this.stationBoardService.stationBoardDataUpdated.subscribe(e=>{this.stationBoardType=e.type;const i=e.items;this.stopEventsData=[],i.forEach(r=>{const s=r.asStationBoard();this.stopEventsData.push(s)}),i.length>0?this.selectDataRowAtIndex(0):this.stationBoardService.stationBoardEntrySelected.emit(null)})}ngAfterViewInit(){var e;(null===(e=this.stationBoardWrapperRef)||void 0===e?void 0:e.nativeElement).addEventListener("click",i=>{var r,s;const d=i.target;if(null===d)return;const m=null!==(s=null===(r=d.closest(".card-item"))||void 0===r?void 0:r.getAttribute("data-index"))&&void 0!==s?s:null;if(null===m)return;const v=parseInt(m,10);this.selectedIDx!==v&&this.selectDataRowAtIndex(v)})}selectDataRowAtIndex(e){this.selectedIDx=e,this.stationBoardService.stationBoardEntrySelected.emit(this.stopEventsData[e].stopEvent)}hasDelay(e){return e.mapStationBoardTime[this.stationBoardType].hasDelay}hasDelayDifferentTime(e){return e.mapStationBoardTime[this.stationBoardType].hasDelayDifferentTime}}return n.\u0275fac=function(e){return new(e||n)($(fE))},n.\u0275cmp=kn({type:n,selectors:[["station-board-result"]],viewQuery:function(e,i){if(1&e&&mr(M9,5),2&e){let r;zn(r=Vn())&&(i.stationBoardWrapperRef=r.first)}},decls:3,vars:1,consts:[["stationBoardWrapper",""],["class","card card card-item mb-2",3,"ngClass",4,"ngFor","ngForOf"],[1,"card","card","card-item","mb-2",3,"ngClass"],[1,"card-body"],[1,"d-flex","dep-content","align-items-center"],[1,"service-line-number-wrapper"],[1,"service-line-number","text-center"],[1,"trip-info","text-center"],[1,"flex-fill","dep-center"],[1,"trip-heading"],["class","stop-platform-text",4,"ngIf"],[1,"trip-debug"],[1,"text-center"],[4,"ngIf"],[1,"stop-platform-text"],[1,"departure-time"],[1,"departure-delay"]],template:function(e,i){1&e&&(Ee(0,"div",null,0),cn(2,N9,21,12,"div",1),Pe()),2&e&&(Je(2),dt("ngForOf",i.stopEventsData))},dependencies:[Bg,Nl,na],styles:[".service-line-number-wrapper[_ngcontent-%COMP%]{padding:0 16px 0 4px}.service-line-number[_ngcontent-%COMP%]{font-size:24px}.service-pt-mode[_ngcontent-%COMP%]{font-size:12px}.trip-heading[_ngcontent-%COMP%]{margin-top:2px;font-size:20px}.trip-info[_ngcontent-%COMP%]{font-size:12px}.stop-platform-wrapper[_ngcontent-%COMP%]{margin-right:4px}.stop-platform-text[_ngcontent-%COMP%]{font-size:14px}.stop-platform[_ngcontent-%COMP%]{font-size:18px}.departure-time[_ngcontent-%COMP%]{width:80px;font-size:20px}.departure-delay[_ngcontent-%COMP%]{color:#c45f00}.trip-debug[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{font-size:12px}.card-item[_ngcontent-%COMP%]{cursor:pointer}.item-selected[_ngcontent-%COMP%]{background-color:#f5f5f5}"]}),n})();function z9(n,t){if(1&n&&(Ee(0,"sbb-option",5),Pt(1),Pe()),2&n){const e=t.$implicit,i=Fn();dt("value",e.stopPlaceRef),Je(1),Do(" ",i.renderLookupName(e)," ")}}let qL=(()=>{class n{constructor(e,i){this.userTripService=e,this.mapService=i,this.locationSelected=new Xt,this.appStageConfig=this.userTripService.getStageConfig("PROD"),this.searchInputControl=new ew(""),this.stopLookups=[n.AroundMeStopLookup],this.currentStopLookup=null,this.isBusySearching=!1,this.hackIgnoreInputChangesFlag=!1}static get AroundMeStopLookup(){return{stopPlaceRef:"AROUND_ME",stopName:"Current Location",special_type:"around_me",location:null}}ngOnInit(){this.searchInputControl.valueChanges.pipe(ev(500),Ap()).subscribe(e=>{this.onInputChangeAfterIdle()})}renderLookupName(e){let i=e.stopName;return e.distance&&(i+=" ("+e.distance+" m)"),i}onInputChangeAfterIdle(){const e=this.searchInputControl.value.trim();this.hackIgnoreInputChangesFlag?this.hackIgnoreInputChangesFlag=!1:0!==e.length?e.length<3||this.fetchLookupLocations(e):this.stopLookups=[n.AroundMeStopLookup]}fetchLookupLocations(e){this.isBusySearching=!0,eu.initWithLocationName(this.appStageConfig,e).fetchResponse().then(r=>{this.parseLocations(r),this.isBusySearching=!1})}parseLocations(e,i=null){this.stopLookups=[],e.forEach(r=>{var s;const d=null===(s=r.stopPlace)||void 0===s?void 0:s.stopPlaceRef;if(null===d)return;const v={stopPlaceRef:d,stopName:r.computeLocationName(),location:r};r.geoPosition&&i&&(v.distance=r.geoPosition.distanceFrom(i)),this.stopLookups.push(v)}),i&&this.stopLookups.sort((r,s)=>null==r.distance||null==s.distance?0:r.distance-s.distance),this.stopLookups=this.stopLookups.slice(0,10)}onStopLookupSelected(e){var i;const r=e.option.value;let s=null!==(i=this.stopLookups.find(m=>m.stopPlaceRef===r))&&void 0!==i?i:null;if(null===s)return void console.log("WHOOPS - cant find the stop for: "+r);if("around_me"===s.special_type)return void this.handleGeolocationLookup();this.currentStopLookup=s,this.hackIgnoreInputChangesFlag=!0,this.searchInputControl.setValue(s.stopName);const d=s.location;d&&this.locationSelected.emit(d)}handleGeolocationLookup(){navigator.geolocation?(this.hackIgnoreInputChangesFlag=!0,this.searchInputControl.setValue("... looking up location"),navigator.geolocation.getCurrentPosition(e=>{this.handleNewGeoPosition(e,i=>{var r;const s=new Ta(e.coords.longitude,e.coords.latitude);this.parseLocations(i,s),null===(r=this.autocompleteInputTrigger)||void 0===r||r.openPanel()})})):console.log("no navigator.geolocation enabled")}handleNewGeoPosition(e,i){eu.initWithBBOXAndType(this.appStageConfig,e.coords.longitude-.025,e.coords.latitude+.025,e.coords.longitude+.025,e.coords.latitude-.025,"stop",300,null).fetchResponse().then(L=>{i(L)})}updateLocationText(e){var i,r;const s=null!==(r=null===(i=e.stopPlace)||void 0===i?void 0:i.stopPlaceName)&&void 0!==r?r:null;null!==s&&(this.hackIgnoreInputChangesFlag=!0,this.searchInputControl.setValue(s))}}return n.\u0275fac=function(e){return new(e||n)($(ju),$(Qd))},n.\u0275cmp=kn({type:n,selectors:[["station-board-input"]],viewQuery:function(e,i){if(1&e&&mr(eS,7),2&e){let r;zn(r=Vn())&&(i.autocompleteInputTrigger=r.first)}},inputs:{appStageConfig:"appStageConfig"},outputs:{locationSelected:"locationSelected"},decls:6,vars:4,consts:[["label","Station",1,"w-100"],["sbbInput","","type","text",3,"placeholder","formControl","sbbAutocomplete"],[3,"optionSelected"],["autocompleteTemplate","sbbAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(e,i){if(1&e&&(Ee(0,"div")(1,"sbb-form-field",0),qn(2,"input",1),Pe(),Ee(3,"sbb-autocomplete",2,3),Wt("optionSelected",function(s){return i.onStopLookupSelected(s)}),cn(5,z9,2,2,"sbb-option",4),Pe()()),2&e){const r=Ua(4);Je(2),dt("placeholder","Type to search for stations")("formControl",i.searchInputControl)("sbbAutocomplete",r),Je(3),dt("ngForOf",i.stopLookups)}},dependencies:[Nl,Gd,Gf,tw,tv,VL,eS,av,sb],encapsulation:2}),n})();function V9(n,t){if(1&n){const e=ml();Ee(0,"div",22),Wt("click",function(){return Wi(e),no(Fn().showRequestXmlPopover())}),Ee(1,"span",23),Pt(2,"XML"),Pe()()}}function j9(n,t){if(1&n&&(Ee(0,"sbb-radio-button",24),Pt(1),Pe()),2&n){const e=t.$implicit;dt("value",e),Je(1),Do(" ",e," ")}}function U9(n,t){if(1&n&&(Ee(0,"sbb-radio-button",24),Pt(1),Pe()),2&n){const e=t.$implicit;dt("value",e),Je(1),Do(" ",e," ")}}function H9(n,t){1&n&&qn(0,"span",25)}let $9=(()=>{class n{constructor(e,i,r,s){this.debugXmlPopover=e,this.mapService=i,this.stationBoardService=r,this.userTripService=s,this.queryParams=new URLSearchParams(document.location.search),this.appStageOptions=["PROD","INT","TEST","LA Beta"],this.stationBoardTypes=["Departures","Arrivals"],this.appStage=this.appStageOptions[0],this.stationBoardType=this.computeStationBoardType(),this.searchLocation=null,this.searchDate=this.computeSearchDateTime(),this.searchTime=_l.formatTimeHHMM(this.searchDate),this.isSearching=!1,this.permalinkURLAddress="",this.updatePermalinkURLAddress(),this.requestData=null}ngOnInit(){const e=this.queryParams.get("stop_id");e&&(this.fetchStopEventsForStopRef(e),this.lookupStopPlaceRef(e)),this.stationBoardService.stationOnMapClicked.subscribe(i=>{this.handleMapClick(i)})}onLocationSelected(e){this.searchLocation=e,this.mapService.tryToCenterAndZoomToLocation(e),this.updatePermalinkURLAddress(),this.resetResultList()}onDateTimeChanged(){const e=this.searchTime.split(":");if(2===e.length){const i=parseInt(e[0],10),r=parseInt(e[1],10);this.searchDate.setHours(i),this.searchDate.setMinutes(r)}this.updatePermalinkURLAddress()}onTypeChanged(){this.updatePermalinkURLAddress()}isSearchButtonDisabled(){return!(!this.isSearching&&null!==this.searchLocation)}searchButtonClicked(){var e,i,r;const s=null!==(r=null===(i=null===(e=this.searchLocation)||void 0===e?void 0:e.stopPlace)||void 0===i?void 0:i.stopPlaceRef)&&void 0!==r?r:null;null===s?console.error("ERROR - no stopPlaceRef available"):this.fetchStopEventsForStopRef(s)}computeSearchDateTime(){let e=new Date;const i=this.queryParams.get("day");i&&(e=new Date(Date.parse(i)));const r=this.queryParams.get("time"),s=new Date;let d=s.getHours(),m=s.getMinutes();if(r){const v=r.split(":");2===v.length&&(d=parseInt(v[0],10),m=parseInt(v[1],10))}return e.setHours(d),e.setMinutes(m),e}computeStationBoardType(){return"arr"===this.queryParams.get("type")?"Arrivals":"Departures"}updatePermalinkURLAddress(){var e,i,r;const s=new URLSearchParams;"Arrivals"===this.stationBoardType&&s.set("type","arr");const d=null!==(r=null===(i=null===(e=this.searchLocation)||void 0===e?void 0:e.stopPlace)||void 0===i?void 0:i.stopPlaceRef)&&void 0!==r?r:null;d&&s.set("stop_id",d);const m=_l.formatDate(new Date),v=_l.formatDate(this.searchDate),D=m.substring(0,10),A=v.substring(0,10);A!==D&&s.set("day",A);const L=m.substring(11,16),j=v.substring(11,16);L!==j&&s.set("time",j);const W="board?"+s.toString();this.permalinkURLAddress=W}fetchStopEventsForStopRef(e){const i="Arrivals"===this.stationBoardType?"arrival":"departure",r=this.computeStopBoardDate(),s=this.userTripService.getStageConfig(this.appStage),d=vD.initWithStopPlaceRef(s,e,i,r);d.fetchResponse().then(m=>{this.requestData=d.lastRequestData,this.parseStopEvents(m)})}parseStopEvents(e){var i;e.length>0&&(null===(i=this.searchPanel)||void 0===i||i.close()),this.stationBoardService.stationBoardDataUpdated.emit({type:this.stationBoardType,items:e})}lookupStopPlaceRef(e){const i=this.userTripService.getStageConfig(this.appStage);eu.initWithStopPlaceRef(i,e).fetchResponse().then(d=>{if(0===d.length)return void console.error("ERROR - cant find stopPlaceRef with ID: "+e);const m=d[0];this.searchLocation=m,this.mapService.tryToCenterAndZoomToLocation(m),this.updatePermalinkURLAddress(),this.autocompleteInputComponent&&this.autocompleteInputComponent.updateLocationText(m)})}handleMapClick(e){var i;const r=Ho.initWithFeature(e);null!==r&&(this.searchLocation=r,this.autocompleteInputComponent&&this.autocompleteInputComponent.updateLocationText(r),this.resetResultList(),this.updatePermalinkURLAddress(),null===(i=this.searchPanel)||void 0===i||i.open())}resetResultList(){this.stationBoardService.stationBoardDataUpdated.emit({type:this.stationBoardType,items:[]})}computeStopBoardDate(){const e=this.searchDate,i=this.searchTime.split(":");if(2===i.length){const r=parseInt(i[0]),s=parseInt(i[1]);e.setHours(r),e.setMinutes(s)}return e}showRequestXmlPopover(){const e=this.debugXmlPopover.open(tE,{position:{top:"10px"}});e.afterOpened().subscribe(()=>{e.componentInstance.updateRequestData(this.requestData)})}}return n.\u0275fac=function(e){return new(e||n)($(Lp),$(Qd),$(fE),$(ju))},n.\u0275cmp=kn({type:n,selectors:[["station-board-search"]],viewQuery:function(e,i){if(1&e&&(mr(am,7),mr(qL,5)),2&e){let r;zn(r=Vn())&&(i.searchPanel=r.first),zn(r=Vn())&&(i.autocompleteInputComponent=r.first)}},decls:36,vars:12,consts:[[1,"row","mb-2"],[1,"col"],[3,"expanded"],[1,"d-flex","align-items-center"],[1,"flex-grow-1"],[3,"appStageConfig","locationSelected"],["class","xml-info",3,"click",4,"ngIf"],[1,"mb-3","d-flex"],[1,"sbb-radio-group-horizontal",3,"ngModel","ngModelChange","change"],[3,"value",4,"ngFor","ngForOf"],[1,"d-flex"],["label","Choose Day"],["arrows",""],["sbbInput","","sbbDateInput","",3,"ngModel","ngModelChange","dateChange"],[2,"margin-left","8px"],["label","Time"],["sbbInput","","sbbTimeInput","",3,"ngModel","ngModelChange","change"],[1,"sbb-radio-group-horizontal",3,"ngModel","ngModelChange"],["type","button",1,"btn","btn-primary",3,"disabled","click"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],[1,"d-flex","flex-row-reverse"],["target","_blank",3,"href"],[1,"xml-info",3,"click"],[1,"layer-xml-info","badge","bg-info","text-dark"],[3,"value"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"]],template:function(e,i){1&e&&(Ee(0,"div",0)(1,"div",1)(2,"sbb-accordion")(3,"sbb-expansion-panel",2)(4,"sbb-expansion-panel-header"),Pt(5,"Search"),Pe(),Ee(6,"div",3)(7,"div",4)(8,"station-board-input",5),Wt("locationSelected",function(s){return i.onLocationSelected(s)}),Pe()(),cn(9,V9,3,0,"div",6),Pe(),Ee(10,"div",7)(11,"div")(12,"sbb-radio-group",8),Wt("ngModelChange",function(s){return i.stationBoardType=s})("change",function(){return i.onTypeChanged()}),cn(13,j9,2,2,"sbb-radio-button",9),Pe()()(),Ee(14,"div",10)(15,"div")(16,"sbb-form-field",11)(17,"sbb-datepicker",12)(18,"input",13),Wt("ngModelChange",function(s){return i.searchDate=s})("dateChange",function(){return i.onDateTimeChanged()}),Pe()()()(),Ee(19,"div",14)(20,"sbb-form-field",15)(21,"input",16),Wt("ngModelChange",function(s){return i.searchTime=s})("change",function(){return i.onDateTimeChanged()}),Pe()()()(),Ee(22,"div",7)(23,"div")(24,"sbb-radio-group",17),Wt("ngModelChange",function(s){return i.appStage=s}),cn(25,U9,2,2,"sbb-radio-button",9),Pe()()(),Ee(26,"div",10)(27,"div")(28,"button",18),Wt("click",function(){return i.searchButtonClicked()}),cn(29,H9,1,0,"span",19),Pt(30," Search "),Pe()()()()()()(),Ee(31,"div",0)(32,"div",1)(33,"div",20)(34,"a",21),Pt(35,"Permalink"),Pe()()()()),2&e&&(Je(3),dt("expanded",!0),Je(5),dt("appStageConfig",i.userTripService.getStageConfig(i.appStage)),Je(1),dt("ngIf",i.requestData),Je(3),dt("ngModel",i.stationBoardType),Je(1),dt("ngForOf",i.stationBoardTypes),Je(5),dt("ngModel",i.searchDate),Je(3),dt("ngModel",i.searchTime),Je(3),dt("ngModel",i.appStage),Je(1),dt("ngForOf",i.appStageOptions),Je(3),dt("disabled",i.isSearchButtonDisabled()),Je(1),dt("ngIf",i.isSearching),Je(5),hp("href",i.permalinkURLAddress,xd))},dependencies:[Nl,na,Gd,Gf,$g,qD,am,Hw,uE,Jw,av,sb,OL,hE,FL,qL],styles:[".xml-info[_ngcontent-%COMP%]{cursor:pointer;margin-left:5px}"]}),n})();const G9=[{path:"search",component:C9},{path:"board",component:(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=kn({type:n,selectors:[["station-board"]],decls:6,vars:0,consts:[[1,"row"],[1,"col-md-4"],[1,"col-md-8"]],template:function(e,i){1&e&&(Ee(0,"div",0)(1,"div",1),qn(2,"station-board-search")(3,"station-board-result"),Pe(),Ee(4,"div",2),qn(5,"station-board-map"),Pe()())},dependencies:[I9,B9,$9],encapsulation:2}),n})()},{path:"",redirectTo:"/search",pathMatch:"full"}];let q9=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({imports:[ww.forRoot(G9),ww]}),n})();const WL=["*"],W9=["tabListContainer"],X9=["tabList"],Z9=["tabListInner"],Y9=["nextPaginator"],Q9=["previousPaginator"],tX=["sbb-tab-nav-bar",""];new bt("SbbTabContent"),new bt("SbbTabLabel"),new bt("SBB_TAB"),Wa(class{}),new bt("SBB_TAB_GROUP"),ks("translateTab",[gr("hidden",Nn({visibility:"hidden"})),$i("* => void, * => hidden",[Nn({opacity:1}),Yi("{{animationDurationHide}} ease",Nn({opacity:0}))]),$i("hidden => show",[Nn({opacity:0,visibility:"visible"}),Yi("{{animationDuration}} ease",Nn({opacity:1}))]),$i("void => show",Yi("0s"))]),new bt("SBB_TABS_CONFIG"),Wa(class{});const mE=Ip({passive:!0}),rX=sm(class{});let oX=(()=>{class n extends rX{constructor(e,i,r,s,d,m){super(),this._elementRef=e,this._changeDetectorRef=i,this._viewportRuler=r,this._ngZone=s,this._platform=d,this._animationMode=m,this._scrollShadowTrigger=new Qt,this._scrollDistance=0,this._selectedIndexChanged=!1,this._destroyed=new Qt,this._showPaginationControls=!1,this._disableScrollAfter=!0,this._disableScrollBefore=!0,this._stopScrolling=new Qt,this._disablePagination=!1,this._selectedIndex=0,this.selectFocusedIndex=new Xt,this.indexFocused=new Xt,s.runOutsideAngular(()=>{nu(e.nativeElement,"mouseleave").pipe(Li(this._destroyed)).subscribe(()=>{this._stopInterval()})})}get disablePagination(){return this._disablePagination}set disablePagination(e){this._disablePagination=Qn(e)}get selectedIndex(){return this._selectedIndex}set selectedIndex(e){e=Kd(e),this._selectedIndex!==e&&(this._selectedIndexChanged=!0,this._selectedIndex=e,this._keyManager&&this._keyManager.updateActiveItem(e))}ngAfterViewInit(){nu(this._previousPaginator.nativeElement,"touchstart",mE).pipe(Li(this._destroyed)).subscribe(()=>{this._handlePaginatorPress("before")}),nu(this._nextPaginator.nativeElement,"touchstart",mE).pipe(Li(this._destroyed)).subscribe(()=>{this._handlePaginatorPress("after")})}ngAfterContentInit(){const e=this._viewportRuler.change(150),i=()=>this.updatePagination();this._keyManager=new BD(this._items).withHorizontalOrientation("ltr").withHomeAndEnd().withWrap(),this._keyManager.updateActiveItem(this._selectedIndex),this._ngZone.onStable.pipe(Hr(1)).subscribe(i),rr(e,this._items.changes,this.variant).pipe(Li(this._destroyed)).subscribe(()=>{this._ngZone.run(()=>{Promise.resolve().then(()=>{this._scrollDistance=Math.max(0,Math.min(this._getMaxScrollDistance(),this._scrollDistance)),i()})})}),this._keyManager.change.pipe(Li(this._destroyed)).subscribe(r=>{this.indexFocused.emit(r),this._setTabFocus(r)}),this._ngZone.runOutsideAngular(()=>{this.variant.pipe(Er(r=>"standard"===r),bl(()=>rr(nu(this._tabListContainer.nativeElement,"scroll",mE),this._scrollShadowTrigger,e)),Us(null),Hn(()=>this._calculateScrollState()),Ap(),Li(this._destroyed)).subscribe(r=>this._applyScrollShadows(r))}),this._ngZone.runOutsideAngular(()=>{this.variant.pipe(Li(this._destroyed)).subscribe(r=>{"lean"===r?this._tabListContainer.nativeElement.scrollLeft=0:this._tabList.nativeElement.style.removeProperty("transform")})})}ngAfterContentChecked(){this._tabLabelCount!==this._items.length&&(this.updatePagination(),this._tabLabelCount=this._items.length,this._changeDetectorRef.markForCheck()),this._selectedIndexChanged&&(this._scrollToLabel(this._selectedIndex),this._checkScrollingControls(),this._selectedIndexChanged=!1,this._changeDetectorRef.markForCheck()),this._scrollDistanceChanged&&(this._updateTabScrollPosition(),this._scrollDistanceChanged=!1,this._changeDetectorRef.markForCheck())}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete(),this._stopScrolling.complete()}_handleKeydown(e){if(!aa(e))switch(e.keyCode){case 13:case 32:this.focusIndex!==this.selectedIndex&&(this.selectFocusedIndex.emit(this.focusIndex),this._itemSelected(e));break;default:this._keyManager.onKeydown(e)}}_onContentChanges(){const e=this._elementRef.nativeElement.textContent;e!==this._currentTextContent&&(this._currentTextContent=e||"",this._ngZone.run(()=>{this.updatePagination(),this._changeDetectorRef.markForCheck()}))}updatePagination(){this._checkPaginationEnabled(),this._checkScrollingControls(),this._updateTabScrollPosition()}get focusIndex(){return this._keyManager?this._keyManager.activeItemIndex:0}set focusIndex(e){!this._isValidIndex(e)||this.focusIndex===e||!this._keyManager||this._keyManager.setActiveItem(e)}_isValidIndex(e){if(!this._items)return!0;const i=this._items?this._items.toArray()[e]:null;return!!i&&!i.disabled}_setTabFocus(e){this._showPaginationControls&&this._scrollToLabel(e),this._items&&this._items.length&&(this._items.toArray()[e].focus(),this._tabListContainer.nativeElement.scrollLeft=0)}_updateTabScrollPosition(){this.disablePagination||"standard"===this.variantSnapshot||(this._tabList.nativeElement.style.transform=`translateX(${Math.round(-this.scrollDistance)}px)`,(this._platform.TRIDENT||this._platform.EDGE)&&(this._tabListContainer.nativeElement.scrollLeft=0))}get scrollDistance(){return this._scrollDistance}set scrollDistance(e){this._scrollTo(e)}_scrollHeader(e){return this._scrollTo(this._scrollDistance+("before"===e?-1:1)*this._tabListContainer.nativeElement.offsetWidth/3)}_handlePaginatorClick(e){this._stopInterval(),this._scrollHeader(e)}_scrollToLabel(e){if(this.disablePagination||"standard"===this.variantSnapshot)return;const i=this._items?this._items.toArray()[e]:null;if(!i)return;const r=this._tabListContainer.nativeElement.offsetWidth,{offsetLeft:s,offsetWidth:d}=i.elementRef.nativeElement,v=s+d,D=this.scrollDistance,A=this.scrollDistance+r;s<D?this.scrollDistance-=D-s+60:v>A&&(this.scrollDistance+=v-A+60)}_checkPaginationEnabled(){if(this.disablePagination||"standard"===this.variantSnapshot)this._showPaginationControls=!1;else{const e=this._tabListInner.nativeElement.scrollWidth-this._elementRef.nativeElement.offsetWidth>1;e||(this.scrollDistance=0),e!==this._showPaginationControls&&this._changeDetectorRef.markForCheck(),this._showPaginationControls=e}}_checkScrollingControls(){this.disablePagination||"standard"===this.variantSnapshot?this._disableScrollAfter=this._disableScrollBefore=!0:(this._disableScrollBefore=0===this.scrollDistance,this._disableScrollAfter=this.scrollDistance===this._getMaxScrollDistance(),this._changeDetectorRef.markForCheck())}_getMaxScrollDistance(){return this._tabListInner.nativeElement.scrollWidth-this._tabListContainer.nativeElement.offsetWidth||0}_stopInterval(){this._stopScrolling.next()}_handlePaginatorPress(e,i){i&&null!=i.button&&0!==i.button||(this._stopInterval(),XD(650,100).pipe(Li(rr(this._stopScrolling,this._destroyed))).subscribe(()=>{const{maxScrollDistance:r,distance:s}=this._scrollHeader(e);(0===s||s>=r)&&this._stopInterval()}))}_scrollTo(e){if(this.disablePagination||"standard"===this.variantSnapshot)return{maxScrollDistance:0,distance:0};const i=this._getMaxScrollDistance();return this._scrollDistance=Math.max(0,Math.min(i,e)),this._scrollDistanceChanged=!0,this._checkScrollingControls(),{maxScrollDistance:i,distance:this._scrollDistance}}_calculateScrollState(){const e=this._tabListContainer.nativeElement;if(e.scrollWidth===e.offsetWidth)return"hidden";const i=0===e.scrollLeft;return i||e.scrollWidth-e.scrollLeft-e.offsetWidth<=1?i?"left":"right":"middle"}_applyScrollShadows(e){const i=this._elementRef.nativeElement;"hidden"===e||"left"===e?i.classList.remove("sbb-tab-header-left-shadow"):i.classList.add("sbb-tab-header-left-shadow"),"hidden"===e||"right"===e?i.classList.remove("sbb-tab-header-right-shadow"):i.classList.add("sbb-tab-header-right-shadow")}}return n.\u0275fac=function(e){return new(e||n)($(Pn),$(Dr),$($u),$(oi),$(_s),$(Lu,8))},n.\u0275dir=vt({type:n,inputs:{disablePagination:"disablePagination"},features:[ut]}),n})(),ZL=0,YL=(()=>{class n extends oX{constructor(e,i,r,s,d,m){super(e,r,s,i,d,m)}_itemSelected(){}ngAfterContentInit(){this._items.changes.pipe(Us(null),Li(this._destroyed)).subscribe(()=>{this.updateActiveLink()}),super.ngAfterContentInit()}updateActiveLink(){if(!this._items)return;const e=this._items.toArray();for(let i=0;i<e.length;i++)if(e[i].active)return this.selectedIndex=i,this._changeDetectorRef.markForCheck(),void(this.tabPanel&&(this.tabPanel._activeTabId=e[i].id));this.selectedIndex=-1}_getRole(){return this.tabPanel?"tablist":this._elementRef.nativeElement.getAttribute("role")}}return n.\u0275fac=function(e){return new(e||n)($(Pn),$(oi),$(Dr),$($u),$(_s),$(Lu,8))},n.\u0275dir=vt({type:n,inputs:{tabPanel:"tabPanel"},features:[ut]}),n})(),QL=(()=>{class n extends YL{constructor(e,i,r,s,d,m){super(e,i,r,s,d,m)}}return n.\u0275fac=function(e){return new(e||n)($(Pn),$(oi),$(Dr),$($u),$(_s),$(Lu,8))},n.\u0275cmp=kn({type:n,selectors:[["","sbb-tab-nav-bar",""]],contentQueries:function(e,i,r){if(1&e&&Ur(r,KL,5),2&e){let s;zn(s=Vn())&&(i._items=s)}},viewQuery:function(e,i){if(1&e&&(mr(W9,7),mr(X9,7),mr(Z9,7),mr(Y9,5),mr(Q9,5)),2&e){let r;zn(r=Vn())&&(i._tabListContainer=r.first),zn(r=Vn())&&(i._tabList=r.first),zn(r=Vn())&&(i._tabListInner=r.first),zn(r=Vn())&&(i._nextPaginator=r.first),zn(r=Vn())&&(i._previousPaginator=r.first)}},hostAttrs:[1,"sbb-tab-nav-bar","sbb-tab-header"],hostVars:3,hostBindings:function(e,i){2&e&&(Ht("role",i._getRole()),Oi("sbb-tab-header-pagination-controls-enabled",i._showPaginationControls&&"lean"===i.variantSnapshot))},exportAs:["sbbTabNavBar","sbbTabNav"],features:[ut],attrs:tX,ngContentSelectors:WL,decls:13,vars:8,consts:[["aria-hidden","true","type","button","tabindex","-1",1,"sbb-tab-header-pagination","sbb-tab-header-pagination-before","sbb-button-reset-frameless",3,"disabled","click","mousedown","touchend"],["previousPaginator",""],["svgIcon","kom:chevron-left-small",1,"sbb-tab-header-pagination-chevron"],[1,"sbb-tab-link-container","sbb-scrollbar",3,"keydown"],["tabListContainer",""],[1,"sbb-tab-list",3,"cdkObserveContent"],["tabList",""],[1,"sbb-tab-links"],["tabListInner",""],["aria-hidden","true","type","button","tabindex","-1",1,"sbb-tab-header-pagination","sbb-tab-header-pagination-after","sbb-button-reset-frameless",3,"disabled","mousedown","click","touchend"],["nextPaginator",""],["svgIcon","kom:chevron-right-small",1,"sbb-tab-header-pagination-chevron"]],template:function(e,i){1&e&&(Ro(),Ee(0,"button",0,1),Wt("click",function(){return i._handlePaginatorClick("before")})("mousedown",function(s){return i._handlePaginatorPress("before",s)})("touchend",function(){return i._stopInterval()}),qn(2,"sbb-icon",2),Pe(),Ee(3,"div",3,4),Wt("keydown",function(s){return i._handleKeydown(s)}),Ee(5,"div",5,6),Wt("cdkObserveContent",function(){return i._onContentChanges()}),Ee(7,"div",7,8),Lr(9),Pe()()(),Ee(10,"button",9,10),Wt("mousedown",function(s){return i._handlePaginatorPress("after",s)})("click",function(){return i._handlePaginatorClick("after")})("touchend",function(){return i._stopInterval()}),qn(12,"sbb-icon",11),Pe()),2&e&&(Oi("sbb-tab-header-pagination-disabled",i._disableScrollBefore),dt("disabled",i._disableScrollBefore||null),Je(5),Oi("_sbb-animation-noopable","NoopAnimations"===i._animationMode),Je(5),Oi("sbb-tab-header-pagination-disabled",i._disableScrollAfter),dt("disabled",i._disableScrollAfter||null))},dependencies:[JO,Xa],styles:['.sbb-tab-header{display:flex;overflow:hidden;position:relative;flex-shrink:0}.sbb-tab-header-pagination{-webkit-user-select:none;user-select:none;position:relative;display:none;justify-content:center;align-items:center;min-width:2.1333333333rem;cursor:pointer;z-index:2;-webkit-tap-highlight-color:rgba(0,0,0,0);touch-action:none;color:var(--sbb-color-granite);box-shadow:0 .1333333333rem .2666666667rem -.0666666667rem rgba(0,0,0,.2),0 .2666666667rem .3333333333rem rgba(0,0,0,.1411764706),0 .0666666667rem .6666666667rem rgba(0,0,0,.1215686275)}.sbb-tab-header-pagination::after{content:"";display:block;position:absolute;bottom:0;height:0;margin:0 auto;border-bottom:var(--sbb-border-width-thin) solid var(--sbb-color-text)}:where(html:not(.sbb-lean)) .sbb-tab-header-pagination::after{transition:width var(--sbb-transition-duration-default),left var(--sbb-transition-duration-default);left:0;right:0;width:0}:where(html.sbb-lean) .sbb-tab-header-pagination::after{left:var(--sbb-border-width-negative);right:var(--sbb-border-width-negative);border-color:var(--sbb-color-graphite)}.sbb-tab-header-pagination-controls-enabled .sbb-tab-header-pagination{display:flex}.sbb-tab-header-pagination:hover:not(.sbb-tab-header-pagination-disabled){color:var(--sbb-color-call-to-action-hover)}.sbb-tab-header-pagination::after{right:0;left:0}.sbb-tab-header-pagination.sbb-tab-header-pagination-after.sbb-tab-header-pagination-disabled::after{left:-.0666666667rem}.sbb-tab-header-pagination-disabled .sbb-tab-header-pagination-chevron{opacity:.4}.sbb-tab-header-pagination-disabled{box-shadow:none;cursor:default}.sbb-tab-list{flex-grow:1;position:relative;transition:transform var(--sbb-transition-duration-slow) var(--sbb-transition-timing-fast-start);will-change:transform}.sbb-tab-header{position:relative}:where(html:not(.sbb-lean)) .sbb-tab-header::before,:where(html:not(.sbb-lean)) .sbb-tab-header::after{position:absolute;top:0;content:"";z-index:2;width:.8rem;height:calc(100% - .5rem);transition:transform var(--sbb-transition-duration-fast) var(--sbb-transition-timing-default);pointer-events:none}@media all and (min-width: 40.1875em){:where(html:not(.sbb-lean)) .sbb-tab-header::before,:where(html:not(.sbb-lean)) .sbb-tab-header::after{width:calc(1.6rem * var(--sbb-scaling-factor))}}:where(html:not(.sbb-lean)) .sbb-tab-header::before{left:0;transform:translateX(-100%);background:linear-gradient(270deg, hsla(0deg, 0%, 100%, 0.37) 0, var(--sbb-color-background))}:where(html:not(.sbb-lean)) .sbb-tab-header.sbb-tab-header-left-shadow::before{transform:translateX(0)}:where(html:not(.sbb-lean)) .sbb-tab-header::after{right:0;transform:translateX(100%);background:linear-gradient(90deg, hsla(0deg, 0%, 100%, 0.37) 0, var(--sbb-color-background))}:where(html:not(.sbb-lean)) .sbb-tab-header.sbb-tab-header-right-shadow::after{transform:translateX(0)}.sbb-tab-links{display:flex;padding-top:calc(0.1333333333rem * var(--sbb-scaling-factor))}:where(html.sbb-lean) .sbb-tab-links{padding-top:0}:where(html.sbb-lean) .sbb-tab-links::after{content:"";width:100%;flex-grow:1;flex-shrink:1;border-bottom:var(--sbb-border-width) solid var(--sbb-color-graphite)}.sbb-tab-link-container{display:flex;position:relative;flex-grow:1;overflow-x:auto;z-index:1;padding-bottom:1.3333333333rem}:where(html.sbb-lean) .sbb-tab-link-container{overflow:hidden;padding-bottom:0}.sbb-tab-link{margin-right:2.1333333333rem;cursor:pointer;box-sizing:border-box;text-align:center;display:inline-flex;justify-content:center;align-items:center;white-space:nowrap;font-family:var(--sbb-font-light);font-size:1.3333333333rem;color:var(--sbb-color-text);line-height:1em;padding-bottom:1.3333333333rem;outline:none;vertical-align:top;text-decoration:none;position:relative;overflow:hidden;-webkit-tap-highlight-color:rgba(0,0,0,0)}.sbb-tab-link::after{content:"";display:block;position:absolute;bottom:0;height:0;margin:0 auto;border-bottom:var(--sbb-border-width-thin) solid var(--sbb-color-text)}:where(html:not(.sbb-lean)) .sbb-tab-link::after{transition:width var(--sbb-transition-duration-default),left var(--sbb-transition-duration-default);left:0;right:0;width:0}:where(html.sbb-lean) .sbb-tab-link::after{left:var(--sbb-border-width-negative);right:var(--sbb-border-width-negative);border-color:var(--sbb-color-graphite)}@media all and (min-width: 40.1875em){:where(html:not(.sbb-lean)) .sbb-tab-link{margin-right:calc(2.8rem * var(--sbb-scaling-factor));font-size:calc(1.7333333333rem * var(--sbb-scaling-factor))}}:where(html.sbb-lean) .sbb-tab-link{font-size:var(--sbb-font-size);line-height:1.3333333333rem;padding:.4rem 1rem .6rem;background-color:var(--sbb-color-background);margin-right:0;border:var(--sbb-border-width) solid rgba(0,0,0,0);border-bottom:none;border-radius:var(--sbb-border-radius) var(--sbb-border-radius) 0 0}.sbb-tab-link:last-child{margin-right:0 !important}:where(html:not(.sbb-lean)) .sbb-tab-link.sbb-tab-label-active::after{width:100%}:where(html.sbb-lean) .sbb-tab-link.sbb-tab-label-active{border-color:var(--sbb-color-graphite)}:where(html.sbb-lean) .sbb-tab-link.sbb-tab-label-active::after{display:none}.sbb-tab-link:not(.sbb-tab-label-active):not(.sbb-tab-disabled):is(:focus,:hover){color:var(--sbb-color-call-to-action-hover)}.sbb-tab-link:not(.sbb-tab-label-active):not(.sbb-tab-disabled):is(:focus,:hover)::after{border-bottom-color:var(--sbb-color-call-to-action-hover)}:where(html:not(.sbb-lean)) .sbb-tab-link:not(.sbb-tab-label-active):not(.sbb-tab-disabled):is(:focus,:hover)::after{width:100%}.sbb-tab-link.sbb-tab-label-active:is(:hover,:focus){color:currentColor;cursor:default}:where(html.sbb-lean) .sbb-tab-link.sbb-tab-label-active:focus-visible{outline:var(--sbb-border-width) solid var(--sbb-color-black);outline-offset:calc(-1*var(--sbb-border-width))}.sbb-tab-link.sbb-tab-disabled{color:var(--sbb-color-storm)}.sbb-tab-link.sbb-tab-disabled:is(:hover,:focus){cursor:default}:where(html:not(.sbb-lean)) .sbb-tab-link.sbb-tab-disabled::after{width:0 !important}.sbb-tab-link .sbb-tab-label-content{display:inline-flex;justify-content:center;align-items:center;white-space:nowrap}:where(html.sbb-lean) .sbb-tab-link .sbb-badge:not(.sbb-badge-hidden){padding-right:.7333333333rem}:where(html.sbb-lean) .sbb-tab-link .sbb-badge-content{transform:scale(0.8)}[sbb-stretch-tabs] .sbb-tab-link{flex-basis:0;flex-grow:1}:where(html.sbb-lean) .sbb-tab-link{overflow:unset}.sbb-tab-link.sbb-tab-disabled{pointer-events:none}:is(.sbb-tab-nav-panel,.sbb-tab-nav-bar-body){display:block;position:relative;overflow:hidden;transition:height var(--sbb-transition-duration-slow)}:where(html.sbb-lean) :is(.sbb-tab-nav-panel,.sbb-tab-nav-bar-body){border:var(--sbb-border-width) solid var(--sbb-color-graphite);border-top:none;background-color:var(--sbb-color-background)}:where(html.sbb-lean) :is(.sbb-tab-nav-panel,.sbb-tab-nav-bar-body){padding:1rem}'],encapsulation:2}),n})();const sX=ib(Wa(class{}));let aX=(()=>{class n extends sX{constructor(e,i,r,s){super(),this._tabNavBar=e,this.elementRef=i,this._focusMonitor=s,this._isActive=!1,this.id="sbb-tab-link-"+ZL++,this.tabIndex=parseInt(r,10)||0}get active(){return this._isActive}set active(e){const i=Qn(e);i!==this._isActive&&(this._isActive=i,this._tabNavBar.updateActiveLink())}focus(){this.elementRef.nativeElement.focus()}ngAfterViewInit(){this._focusMonitor.monitor(this.elementRef)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this.elementRef)}_handleFocus(){this._tabNavBar.focusIndex=this._tabNavBar._items.toArray().indexOf(this)}_handleKeydown(e){this._tabNavBar.tabPanel&&32===e.keyCode&&this.elementRef.nativeElement.click()}_getAriaControls(){var e;return this._tabNavBar.tabPanel?null===(e=this._tabNavBar.tabPanel)||void 0===e?void 0:e.id:this.elementRef.nativeElement.getAttribute("aria-controls")}_getAriaSelected(){return this._tabNavBar.tabPanel?this.active?"true":"false":this.elementRef.nativeElement.getAttribute("aria-selected")}_getAriaCurrent(){return this.active&&!this._tabNavBar.tabPanel?"page":null}_getRole(){return this._tabNavBar.tabPanel?"tab":this.elementRef.nativeElement.getAttribute("role")}_getTabIndex(){return this._tabNavBar.tabPanel?this._isActive?0:-1:this.tabIndex}}return n.\u0275fac=function(e){return new(e||n)($(YL),$(Pn),Vr("tabindex"),$(Da))},n.\u0275dir=vt({type:n,inputs:{active:"active",id:"id"},features:[ut]}),n})(),KL=(()=>{class n extends aX{constructor(e,i,r,s){super(e,i,r,s)}}return n.\u0275fac=function(e){return new(e||n)($(QL),$(Pn),Vr("tabindex"),$(Da))},n.\u0275dir=vt({type:n,selectors:[["","sbb-tab-link",""],["","sbbTabLink",""]],hostAttrs:[1,"sbb-tab-link","sbb-link-reset"],hostVars:11,hostBindings:function(e,i){1&e&&Wt("focus",function(){return i._handleFocus()})("keydown",function(s){return i._handleKeydown(s)}),2&e&&(Ht("aria-controls",i._getAriaControls())("aria-current",i._getAriaCurrent())("aria-disabled",i.disabled)("aria-selected",i._getAriaSelected())("id",i.id)("tabIndex",i._getTabIndex())("role",i._getRole()),Oi("sbb-tab-disabled",i.disabled)("sbb-tab-label-active",i.active))},inputs:{disabled:"disabled",tabIndex:"tabIndex"},exportAs:["sbbTabLink"],features:[ut]}),n})(),lX=(()=>{class n{constructor(){this.id="sbb-tab-nav-panel-"+ZL++}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=kn({type:n,selectors:[["sbb-tab-nav-panel"]],hostAttrs:["role","tabpanel",1,"sbb-tab-nav-panel"],hostVars:2,hostBindings:function(e,i){2&e&&Ht("aria-labelledby",i._activeTabId)("id",i.id)},inputs:{id:"id"},exportAs:["sbbTabNavPanel"],ngContentSelectors:WL,decls:1,vars:0,template:function(e,i){1&e&&(Ro(),Lr(0))},encapsulation:2,changeDetection:0}),n})(),JL=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({imports:[wr,sa,Pw,om,lm,Gi,bo]}),n})();function cX(n,t){if(1&n&&(Ee(0,"a",4,5),Pt(2),Pe()),2&n){const e=t.$implicit,i=Ua(1);dt("routerLink",e.link)("active",i.isActive),Je(2),Do(" ",e.label," ")}}let uX=(()=>{class n{constructor(){this.appTabs=[{label:"Journey Search",link:"search"},{label:"Station Board",link:"board"}]}ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=kn({type:n,selectors:[["app-root"]],decls:6,vars:2,consts:[[1,"app-root"],["sbb-tab-nav-bar","",3,"tabPanel"],["sbb-tab-link","","routerLinkActive","",3,"routerLink","active",4,"ngFor","ngForOf"],["tabPanel",""],["sbb-tab-link","","routerLinkActive","",3,"routerLink","active"],["rla","routerLinkActive"]],template:function(e,i){if(1&e&&(Ee(0,"div",0)(1,"nav",1),cn(2,cX,3,3,"a",2),Pe(),Ee(3,"sbb-tab-nav-panel",null,3),qn(5,"router-outlet"),Pe()()),2&e){const r=Ua(4);Je(1),dt("tabPanel",r),Je(1),dt("ngForOf",i.appTabs)}},dependencies:[Nl,KT,xw,EO,QL,lX,KL],styles:[".app-root[_ngcontent-%COMP%]{background-color:#fff;border:1px solid #CACACA;margin-left:calc(-.5 * var(--bs-gutter-x));margin-right:calc(-.5 * var(--bs-gutter-x));padding:8px}"]}),n})();ks("showDismiss",[gr("void, dismissed",Nn({height:0,paddingTop:0,paddingBottom:0,borderTopWidth:0,borderBottomWidth:0})),gr("visible",Nn({height:"*",paddingTop:"*",paddingBottom:"*",borderTopWidth:"*",borderBottomWidth:"*"})),$i("void => visible",Yi("0.25s cubic-bezier(0.4,0.0,0.2,1)")),$i("visible => dismissed",Yi("0.25s cubic-bezier(0.4,0.0,0.2,1)"))]);let eF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({imports:[wr,ww,Gi,bo]}),n})();Wa(class{});let gE=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({imports:[om,Gi]}),n})();ks("transformMenu",[gr("void",Nn({opacity:0})),gr("enter-usermenu",Nn({width:"{{width}}",maxHeight:"100%"}),{params:{width:"288px"}}),$i("void => enter",Yi("120ms cubic-bezier(0, 0, 0.2, 1)",Nn({opacity:1}))),$i("enter => void",Yi("100ms linear",Nn({opacity:0}))),$i("void => enter-usermenu",Yi("300ms cubic-bezier(.785,.135,.15,.86)",Sy([Nn({width:"var(--sbb-menu-trigger-width)",height:"var(--sbb-menu-trigger-height)",offset:0}),Nn({width:"{{width}}",height:"*",opacity:1,maxHeight:"100%",offset:1})]))),$i("enter-usermenu => void",Yi("300ms cubic-bezier(.785,.135,.15,.86)",Nn({opacity:0,width:"var(--sbb-menu-trigger-width)",height:"var(--sbb-menu-trigger-height)"})))]),new bt("SbbMenuContent"),new bt("SBB_MENU_PANEL"),Wa(class{}),new bt("sbb-menu-default-options",{providedIn:"root",factory:function mX(){return{overlapTrigger:!1,xPosition:"after",yPosition:"below",backdropClass:"cdk-overlay-transparent-backdrop"}}}),new bt("sbb-menu-inherited-trigger-context");const _X={provide:new bt("sbb-menu-scroll-strategy"),deps:[$o],useFactory:function bX(n){return()=>n.scrollStrategies.reposition()}};Ip({passive:!0}),sm(class{});let tS=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({providers:[_X],imports:[wr,yl,sa,Gi,bo,lm]}),n})(),tF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({imports:[wr,Gi,tS,bo]}),n})();new bt("recaptcha-settings");let nF=(()=>{class n{get nativeWindow(){return function xX(){return window}()}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();const wX=new bt("recaptcha-language"),SX=new bt("recaptcha-base-url"),CX=new bt("recaptcha-nonce-tag");let TX=(()=>{class n{constructor(e,i,r,s,d){this._windowRef=e,this._language=r||null,this._baseUrl=s||null,this._nonce=d||null,this._document=i,this._init(),this.ready=n._ready.pipe(Er(m=>!!m))}_init(){if(n._ready)return;this._windowRef.nativeWindow.ng2recaptchaloaded=()=>{n._ready.next(grecaptcha)},n._ready=new ia(null);const e=this._document.createElement("script");e.innerHTML="",e.src=`${this._baseUrl||"https://www.google.com/recaptcha/api.js"}?render=explicit&onload=ng2recaptchaloaded${this._language?"&hl="+this._language:""}`,this._nonce&&(e.nonce=this._nonce),e.async=!0,e.defer=!0,this._document.head.appendChild(e)}}return n._ready=null,n.\u0275fac=function(e){return new(e||n)(Be(nF),Be(si),Be(wX,8),Be(SX,8),Be(CX,8))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})(),iF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({providers:[TX,nF],imports:[wr,Gi]}),n})();const DX=["input"],EX=["*"],IX=new bt("sbb-checkbox-default-options",{providedIn:"root",factory:function rF(){return{clickAction:"check-indeterminate"}}});const MX={provide:js,useExisting:Ri(()=>AX),multi:!0};let AX=(()=>{class n extends OT{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=ui(n)))(i||n)}}(),n.\u0275dir=vt({type:n,selectors:[["sbb-checkbox","required","","formControlName",""],["sbb-checkbox","required","","formControl",""],["sbb-checkbox","required","","ngModel",""]],features:[Kn([MX]),ut]}),n})(),kX=0;const RX={clickAction:"check-indeterminate"},PX={provide:Ga,useExisting:Ri(()=>FX),multi:!0};class OX{}const LX=ib(Wa(class{}));let oF=(()=>{class n extends LX{constructor(e,i,r,s,d){super(),this._elementRef=e,this._changeDetectorRef=i,this._focusMonitor=r,this._options=d,this.ariaLabel="",this.ariaLabelledby=null,this._uniqueId="sbb-checkbox-"+ ++kX,this.id=this._uniqueId,this.labelPosition="after",this.name=null,this.change=new Xt,this.indeterminateChange=new Xt,this._onTouched=()=>{},this._controlValueAccessorChangeFn=()=>{},this._checked=!1,this._disabled=!1,this._indeterminate=!1,this._options=this._options||RX,this.tabIndex=parseInt(s,10)||0}get inputId(){return`${this.id||this._uniqueId}-input`}get required(){return this._required}set required(e){this._required=Qn(e)}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(e=>{e||Promise.resolve().then(()=>{this._onTouched(),this._changeDetectorRef.markForCheck()})}),this._syncIndeterminate(this._indeterminate)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}get checked(){return this._checked}set checked(e){const i=Qn(e);i!==this.checked&&(this._checked=i,this._changeDetectorRef.markForCheck())}get disabled(){return this._disabled}set disabled(e){const i=Qn(e);i!==this.disabled&&(this._disabled=i,this._changeDetectorRef.markForCheck())}get indeterminate(){return this._indeterminate}set indeterminate(e){const i=e!==this._indeterminate;this._indeterminate=Qn(e),i&&this.indeterminateChange.emit(this._indeterminate),this._syncIndeterminate(this._indeterminate)}_onLabelTextChange(){this._changeDetectorRef.detectChanges()}writeValue(e){this.checked=!!e}registerOnChange(e){this._controlValueAccessorChangeFn=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this.disabled=e}_getAriaChecked(){return this.checked?"true":this.indeterminate?"mixed":"false"}_emitChangeEvent(){const e=new OX;e.source=this,e.checked=this.checked,this._controlValueAccessorChangeFn(this.checked),this.change.emit(e)}toggle(){this.checked=!this.checked,this._controlValueAccessorChangeFn(this.checked)}_onInputClick(e){var i;const r=null===(i=this._options)||void 0===i?void 0:i.clickAction;e.stopPropagation(),this.disabled||"noop"===r?!this.disabled&&"noop"===r&&(this._inputElement.nativeElement.checked=this.checked,this._inputElement.nativeElement.indeterminate=this.indeterminate):(this.indeterminate&&"check"!==r&&Promise.resolve().then(()=>{this._indeterminate=!1,this.indeterminateChange.emit(this._indeterminate)}),this._checked=!this._checked,this._emitChangeEvent())}focus(e,i){e?this._focusMonitor.focusVia(this._inputElement,e,i):this._inputElement.nativeElement.focus(i)}_onInteractionEvent(e){e.stopPropagation()}_syncIndeterminate(e){const i=this._inputElement;i&&(i.nativeElement.indeterminate=e)}}return n.\u0275fac=function(e){return new(e||n)($(Pn),$(Dr),$(Da),Vr("tabindex"),$(IX,8))},n.\u0275dir=vt({type:n,viewQuery:function(e,i){if(1&e&&mr(DX,5),2&e){let r;zn(r=Vn())&&(i._inputElement=r.first)}},inputs:{ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],ariaDescribedby:["aria-describedby","ariaDescribedby"],id:"id",required:"required",labelPosition:"labelPosition",name:"name",value:"value",checked:"checked",disabled:"disabled",indeterminate:"indeterminate"},outputs:{change:"change",indeterminateChange:"indeterminateChange"},features:[ut]}),n})(),FX=(()=>{class n extends oF{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=ui(n)))(i||n)}}(),n.\u0275cmp=kn({type:n,selectors:[["sbb-checkbox"]],hostAttrs:[1,"sbb-checkbox","sbb-selection-item"],hostVars:10,hostBindings:function(e,i){2&e&&(uc("id",i.id),Ht("tabindex",null)("aria-label",null)("aria-labelledby",null),Oi("sbb-selection-indeterminate",i.indeterminate)("sbb-selection-checked",i.checked)("sbb-selection-disabled",i.disabled))},inputs:{tabIndex:"tabIndex"},exportAs:["sbbCheckbox"],features:[Kn([PX]),ut],ngContentSelectors:EX,decls:11,vars:12,consts:[[1,"sbb-selection-item-label"],["type","checkbox",1,"cdk-visually-hidden","sbb-selection-input","sbb-checkbox-input","sbb-transparent-parent-overlay",3,"id","required","checked","disabled","tabIndex","change","click"],["input",""],[1,"sbb-selection-container"],[1,"sbb-selection-container-checked"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","focusable","false"],["fill","none","fill-rule","evenodd","stroke","#000","stroke-width","1","points","6 12 10 16 19 7.01"],[1,"sbb-selection-content",3,"cdkObserveContent"],[2,"display","none"]],template:function(e,i){1&e&&(Ro(),Ee(0,"label",0)(1,"input",1,2),Wt("change",function(s){return i._onInteractionEvent(s)})("click",function(s){return i._onInputClick(s)}),Pe(),Ee(3,"div",3)(4,"span",4),Ml(),Ee(5,"svg",5),qn(6,"polyline",6),Pe()()(),Al(),Ee(7,"div",7),Wt("cdkObserveContent",function(){return i._onLabelTextChange()}),Ee(8,"span",8),Pt(9,"\xa0"),Pe(),Lr(10),Pe()()),2&e&&(Ht("for",i.inputId),Je(1),dt("id",i.inputId)("required",i.required)("checked",i.checked)("disabled",i.disabled)("tabIndex",i.tabIndex),Ht("value",i.value)("name",i.name)("aria-label",i.ariaLabel||null)("aria-labelledby",i.ariaLabelledby)("aria-checked",i._getAriaChecked())("aria-describedby",i.ariaDescribedby))},dependencies:[JO],encapsulation:2,changeDetection:0}),n})(),sF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({imports:[Pw,Gi]}),n})();const NX=["*",[["sbb-checkbox-panel-subtitle"]],[["sbb-checkbox-panel-warning"]],[["sbb-checkbox-panel-note"]]],BX=["*","sbb-checkbox-panel-subtitle","sbb-checkbox-panel-warning","sbb-checkbox-panel-note"],zX={provide:Ga,useExisting:Ri(()=>VX),multi:!0};let VX=(()=>{class n extends oF{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=ui(n)))(i||n)}}(),n.\u0275cmp=kn({type:n,selectors:[["sbb-checkbox-panel"]],hostAttrs:[1,"sbb-checkbox-panel","sbb-selection-panel-item","sbb-checkbox","sbb-selection-item"],hostVars:8,hostBindings:function(e,i){2&e&&(uc("id",i.id),Ht("tabindex",null),Oi("sbb-selection-indeterminate",i.indeterminate)("sbb-selection-checked",i.checked)("sbb-selection-disabled",i.disabled))},inputs:{tabIndex:"tabIndex"},exportAs:["sbbCheckboxPanel"],features:[Kn([zX]),ut],ngContentSelectors:BX,decls:16,vars:12,consts:[[1,"sbb-selection-item-label"],["type","checkbox",1,"cdk-visually-hidden","sbb-selection-input","sbb-checkbox-input","sbb-transparent-parent-overlay",3,"id","required","checked","disabled","tabIndex","change","click"],["input",""],[1,"sbb-selection-container"],[1,"sbb-selection-container-checked"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","focusable","false"],["fill","none","fill-rule","evenodd","stroke","#000","stroke-width","1","points","6 12 10 16 19 7.01"],[1,"sbb-selection-content"],[1,"sbb-selection-inner-content"],[2,"display","none"]],template:function(e,i){1&e&&(Ro(NX),Ee(0,"label",0)(1,"input",1,2),Wt("change",function(s){return i._onInteractionEvent(s)})("click",function(s){return i._onInputClick(s)}),Pe(),Ee(3,"div",3)(4,"span",4),Ml(),Ee(5,"svg",5),qn(6,"polyline",6),Pe()()(),Al(),Ee(7,"div",7)(8,"div",8)(9,"span",9),Pt(10,"\xa0"),Pe(),Ee(11,"span"),Lr(12),Pe(),Lr(13,1),Pe(),Lr(14,2),Lr(15,3),Pe()()),2&e&&(Ht("for",i.inputId),Je(1),dt("id",i.inputId)("required",i.required)("checked",i.checked)("disabled",i.disabled)("tabIndex",i.tabIndex),Ht("value",i.value)("name",i.name)("aria-label",i.ariaLabel||null)("aria-labelledby",i.ariaLabelledby)("aria-checked",i._getAriaChecked())("aria-describedby",i.ariaDescribedby))},encapsulation:2,changeDetection:0}),n})(),aF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({imports:[wr,Gi]}),n})();new bt("SBB_CHIP_LIST"),new bt("SBB_CHIP"),new bt("SbbChipRemove"),new bt("SbbChipTrailingIcon"),ib(class UX{constructor(t){this._elementRef=t}},-1);const fF=new bt("sbb-chips-default-options");Nw(class{constructor(n,t,e,i){this._defaultErrorStateMatcher=n,this._parentForm=t,this._parentFormGroup=e,this.ngControl=i,this.stateChanges=new Qt}});let mF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({providers:[{provide:fF,useValue:{separatorKeyCodes:[13]}}],imports:[wr,Gi,bo]}),n})();new bt("FILE_SELECTOR_OPTIONS");const Qo={TEXT:["text/*"],IMAGE:["image/*"],IMAGE_JPG:["image/jpeg","image/pjpeg"],IMAGE_PNG:["image/png"],IMAGE_SVG:["image/svg+xml"],IMAGE_GIF:["image/gif"],AUDIO:["audio/*"],AUDIO_MP4:["audio/mp4"],AUDIO_MP3:["audio/mpeg","audio/mp3"],AUDIO_OGG:["audio/ogg"],AUDIO_WAVE:["audio/wave"],AUDIO_WAV:["audio/wav","audio/x-wav","audio/x-pn-wav","audio/webm"],VIDEO:["video/*"],VIDEO_MP4:["video/mp4"],VIDEO_MPEG:["video/mpeg"],VIDEO_OGG:["video/ogg"],VIDEO_MOV:["video/quicktime"],VIDEO_WEBM:["video/webm"],VIDEO_AVI:["video/x-msvideo"],VIDEO_WMV:["video/x-ms-wmv"],PDF:["application/pdf"],MS_WORD_DOC:["application/msword","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.wordprocessingml.template","application/vnd.ms-word.document.macroEnabled.12","application/vnd.ms-word.template.macroEnabled.12"],MS_EXCEL:["application/vnd.ms-excel","application/vnd.ms-excel","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.openxmlformats-officedocument.spreadsheetml.template","application/vnd.ms-excel.sheet.macroEnabled.12","application/vnd.ms-excel.template.macroEnabled.12","application/vnd.ms-excel.addin.macroEnabled.12","application/vnd.ms-excel.sheet.binary.macroEnabled.12"],MS_POWERPOINT:["application/vnd.ms-powerpoint","application/vnd.ms-powerpoint","application/vnd.ms-powerpoint","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.presentationml.template","application/vnd.openxmlformats-officedocument.presentationml.slideshow","application/vnd.ms-powerpoint.addin.macroEnabled.12","application/vnd.ms-powerpoint.presentation.macroEnabled.12","application/vnd.ms-powerpoint.presentation.macroEnabled.12","application/vnd.ms-powerpoint.slideshow.macroEnabled.12"],ZIP:["application/x-gtar","application/x-gcompress","application/compress","application/x-tar","application/x-rar-compressed","application/octet-stream","application/x-zip-compressed","application/zip-compressed","application/x-7z-compressed","application/gzip","application/zip","application/x-bzip2"]};(new Map).set("doc",[...Qo.MS_WORD_DOC,...Qo.MS_EXCEL,...Qo.MS_POWERPOINT]).set("audio",[...Qo.AUDIO_MP4,...Qo.AUDIO_MP3,...Qo.AUDIO_OGG,...Qo.AUDIO_WAVE,...Qo.AUDIO_WAV]).set("image",[...Qo.IMAGE_GIF,...Qo.IMAGE_JPG,...Qo.IMAGE_PNG,...Qo.IMAGE_SVG]).set("pdf",Qo.PDF).set("video",[...Qo.VIDEO_MP4,...Qo.VIDEO_MPEG,...Qo.VIDEO_OGG,...Qo.VIDEO_MOV,...Qo.VIDEO_WEBM,...Qo.VIDEO_AVI,...Qo.VIDEO_WMV]).set("zip",Qo.ZIP),Wa(class{constructor(n){this._elementRef=n}});let gF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({imports:[wr,Gi,bo]}),n})();new bt("SBB_HEADER"),ks("menu",[gr("open",Nn({left:0})),gr("void",Nn({left:-305,visibility:"hidden"})),$i("open => void, void => open",[Yi("0.3s ease-in-out")])]);const aZ={provide:new bt("sbb-header-menu-scroll-strategy"),deps:[$o],useFactory:function sZ(n){return()=>n.scrollStrategies.reposition()}};Ip({passive:!0}),Wa(class{});let bF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({providers:[aZ],imports:[wr,Pw,yl,sa,Gi,bo]}),n})();function lZ(n,t){}function cZ(n,t){}class _E{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.ariaModal=!0,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.closeOnNavigation=!0,this.closeOnDestroy=!0}}let uZ=(()=>{class n extends Qy{constructor(e,i,r,s,d,m,v,D){super(),this._elementRef=e,this._focusTrapFactory=i,this._config=s,this._interactivityChecker=d,this._ngZone=m,this._overlayRef=v,this._focusMonitor=D,this._elementFocusedBeforeDialogWasOpened=null,this._closeInteractionType=null,this.attachDomPortal=A=>{this._portalOutlet.hasAttached();const L=this._portalOutlet.attachDomPortal(A);return this._contentAttached(),L},this._ariaLabelledBy=this._config.ariaLabelledBy||null,this._document=r}_contentAttached(){this._initializeFocusTrap(),this._handleBackdropClicks(),this._captureInitialFocus()}_captureInitialFocus(){this._trapFocus()}ngOnDestroy(){this._restoreFocus()}attachComponentPortal(e){this._portalOutlet.hasAttached();const i=this._portalOutlet.attachComponentPortal(e);return this._contentAttached(),i}attachTemplatePortal(e){this._portalOutlet.hasAttached();const i=this._portalOutlet.attachTemplatePortal(e);return this._contentAttached(),i}_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(e,i){this._interactivityChecker.isFocusable(e)||(e.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{const r=()=>{e.removeEventListener("blur",r),e.removeEventListener("mousedown",r),e.removeAttribute("tabindex")};e.addEventListener("blur",r),e.addEventListener("mousedown",r)})),e.focus(i)}_focusByCssSelector(e,i){let r=this._elementRef.nativeElement.querySelector(e);r&&this._forceFocus(r,i)}_trapFocus(){const e=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||e.focus();break;case!0:case"first-tabbable":this._focusTrap.focusInitialElementWhenReady().then(i=>{i||this._focusDialogContainer()});break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this._config.autoFocus)}}_restoreFocus(){const e=this._config.restoreFocus;let i=null;if("string"==typeof e?i=this._document.querySelector(e):"boolean"==typeof e?i=e?this._elementFocusedBeforeDialogWasOpened:null:e&&(i=e),this._config.restoreFocus&&i&&"function"==typeof i.focus){const r=tu(),s=this._elementRef.nativeElement;(!r||r===this._document.body||r===s||s.contains(r))&&(this._focusMonitor?(this._focusMonitor.focusVia(i,this._closeInteractionType),this._closeInteractionType=null):i.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){const e=this._elementRef.nativeElement,i=tu();return e===i||e.contains(i)}_initializeFocusTrap(){this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=tu())}_handleBackdropClicks(){this._overlayRef.backdropClick().subscribe(()=>{this._config.disableClose&&this._recaptureFocus()})}}return n.\u0275fac=function(e){return new(e||n)($(Pn),$(tb),$(si,8),$(_E),$(rm),$(oi),$(Op),$(Da))},n.\u0275cmp=kn({type:n,selectors:[["cdk-dialog-container"]],viewQuery:function(e,i){if(1&e&&mr(Hu,7),2&e){let r;zn(r=Vn())&&(i._portalOutlet=r.first)}},hostAttrs:["tabindex","-1",1,"cdk-dialog-container"],hostVars:6,hostBindings:function(e,i){2&e&&Ht("id",i._config.id||null)("role",i._config.role)("aria-modal",i._config.ariaModal)("aria-labelledby",i._config.ariaLabel?null:i._ariaLabelledBy)("aria-label",i._config.ariaLabel)("aria-describedby",i._config.ariaDescribedBy||null)},features:[ut],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(e,i){1&e&&cn(0,lZ,0,0,"ng-template",0)},dependencies:[Hu],styles:[".cdk-dialog-container{display:block;width:100%;height:100%;min-height:inherit;max-height:inherit}"],encapsulation:2}),n})();class yE{constructor(t,e){this.overlayRef=t,this.config=e,this.closed=new Qt,this.disableClose=e.disableClose,this.backdropClick=t.backdropClick(),this.keydownEvents=t.keydownEvents(),this.outsidePointerEvents=t.outsidePointerEvents(),this.id=e.id,this.keydownEvents.subscribe(i=>{27===i.keyCode&&!this.disableClose&&!aa(i)&&(i.preventDefault(),this.close(void 0,{focusOrigin:"keyboard"}))}),this.backdropClick.subscribe(()=>{this.disableClose||this.close(void 0,{focusOrigin:"mouse"})})}close(t,e){if(this.containerInstance){const i=this.closed;this.containerInstance._closeInteractionType=(null==e?void 0:e.focusOrigin)||"program",this.overlayRef.dispose(),i.next(t),i.complete(),this.componentInstance=this.containerInstance=null}}updatePosition(){return this.overlayRef.updatePosition(),this}updateSize(t="",e=""){return this.overlayRef.updateSize({width:t,height:e}),this}addPanelClass(t){return this.overlayRef.addPanelClass(t),this}removePanelClass(t){return this.overlayRef.removePanelClass(t),this}}const _F=new bt("DialogScrollStrategy"),dZ=new bt("DialogData"),hZ=new bt("DefaultDialogConfig"),fZ={provide:_F,deps:[$o],useFactory:function pZ(n){return()=>n.scrollStrategies.block()}};let mZ=0,gZ=(()=>{class n{constructor(e,i,r,s,d,m){this._overlay=e,this._injector=i,this._defaultOptions=r,this._parentDialog=s,this._overlayContainer=d,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new Qt,this._afterOpenedAtThisLevel=new Qt,this._ariaHiddenElements=new Map,this.afterAllClosed=Wf(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(Us(void 0))),this._scrollStrategy=m}get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}open(e,i){const r=this._defaultOptions||new _E;(i=Object.assign(Object.assign({},r),i)).id=i.id||"cdk-dialog-"+mZ++,i.id&&this.getDialogById(i.id);const s=this._getOverlayConfig(i),d=this._overlay.create(s),m=new yE(d,i),v=this._attachContainer(d,m,i);return m.containerInstance=v,this._attachDialogContent(e,m,v,i),this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(m),m.closed.subscribe(()=>this._removeOpenDialog(m,!0)),this.afterOpened.next(m),m}closeAll(){vE(this.openDialogs,e=>e.close())}getDialogById(e){return this.openDialogs.find(i=>i.id===e)}ngOnDestroy(){vE(this._openDialogsAtThisLevel,e=>{!1===e.config.closeOnDestroy&&this._removeOpenDialog(e,!1)}),vE(this._openDialogsAtThisLevel,e=>e.close()),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete(),this._openDialogsAtThisLevel=[]}_getOverlayConfig(e){const i=new cm({positionStrategy:e.positionStrategy||this._overlay.position().global().centerHorizontally().centerVertically(),scrollStrategy:e.scrollStrategy||this._scrollStrategy(),panelClass:e.panelClass,hasBackdrop:e.hasBackdrop,direction:e.direction,minWidth:e.minWidth,minHeight:e.minHeight,maxWidth:e.maxWidth,maxHeight:e.maxHeight,width:e.width,height:e.height,disposeOnNavigation:e.closeOnNavigation});return e.backdropClass&&(i.backdropClass=e.backdropClass),i}_attachContainer(e,i,r){var s,d;const m=null!==(s=r.injector)&&void 0!==s?s:null===(d=r.viewContainerRef)||void 0===d?void 0:d.injector,v=[{provide:_E,useValue:r},{provide:yE,useValue:i},{provide:Op,useValue:e}];let D;r.container?"function"==typeof r.container?D=r.container:(D=r.container.type,v.push(...r.container.providers(r))):D=uZ;const A=new Uu(D,r.viewContainerRef,xr.create({parent:m||this._injector,providers:v}),r.componentFactoryResolver);return e.attach(A).instance}_attachDialogContent(e,i,r,s){const d=this._createInjector(s,i,r);if(e instanceof eo){let m={$implicit:s.data,dialogRef:i};s.templateContext&&(m=Object.assign(Object.assign({},m),"function"==typeof s.templateContext?s.templateContext():s.templateContext)),r.attachTemplatePortal(new em(e,null,m,d))}else{const m=r.attachComponentPortal(new Uu(e,s.viewContainerRef,d,s.componentFactoryResolver));i.componentInstance=m.instance}}_createInjector(e,i,r){const s=e&&e.viewContainerRef&&e.viewContainerRef.injector,d=[{provide:dZ,useValue:e.data},{provide:yE,useValue:i}];return e.providers&&("function"==typeof e.providers?d.push(...e.providers(i,e,r)):d.push(...e.providers)),e.direction&&(!s||!s.get(Pp,null,Yn.Optional))&&d.push({provide:Pp,useValue:{value:e.direction,change:ei()}}),xr.create({parent:s||this._injector,providers:d})}_removeOpenDialog(e,i){const r=this.openDialogs.indexOf(e);r>-1&&(this.openDialogs.splice(r,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((s,d)=>{s?d.setAttribute("aria-hidden",s):d.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),i&&this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){const e=this._overlayContainer.getContainerElement();if(e.parentElement){const i=e.parentElement.children;for(let r=i.length-1;r>-1;r--){const s=i[r];s!==e&&"SCRIPT"!==s.nodeName&&"STYLE"!==s.nodeName&&!s.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(s,s.getAttribute("aria-hidden")),s.setAttribute("aria-hidden","true"))}}}_getAfterAllClosed(){const e=this._parentDialog;return e?e._getAfterAllClosed():this._afterAllClosedAtThisLevel}}return n.\u0275fac=function(e){return new(e||n)(Be($o),Be(xr),Be(hZ,8),Be(n,12),Be(rb),Be(_F))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})();function vE(n,t){let e=n.length;for(;e--;)t(n[e])}let bZ=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({providers:[gZ,fZ],imports:[yl,sa,om,sa]}),n})();const nS={params:{enterAnimationDuration:"150ms",exitAnimationDuration:"75ms"}},_Z={lightboxContainer:ks("lightboxContainer",[gr("void, exit",Nn({opacity:0,transform:"scale(0.7)"})),gr("enter",Nn({transform:"none"})),$i("* => enter",Yi("{{enterAnimationDuration}} cubic-bezier(0, 0, 0.2, 1)",Nn({transform:"none",opacity:1})),nS),$i("* => void, * => exit",Yi("{{exitAnimationDuration}} cubic-bezier(0.4, 0.0, 0.2, 1)",Nn({opacity:0})),nS)])};let yZ=(()=>{class n extends lL{constructor(e,i,r,s,d,m,v,D,A){super(e,i,r,s,d,m,v,A),this._changeDetectorRef=D}_onAnimationDone({toState:e,totalTime:i}){"enter"===e?(this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:i})):"exit"===e&&this._animationStateChanged.next({state:"closed",totalTime:i})}_onAnimationStart({toState:e,totalTime:i}){"enter"===e?this._animationStateChanged.next({state:"opening",totalTime:i}):("exit"===e||"void"===e)&&this._animationStateChanged.next({state:"closing",totalTime:i})}_startExitAnimation(){this._state="exit",this._changeDetectorRef.markForCheck()}}return n.\u0275fac=function(e){return new(e||n)($(Pn),$(tb),$(si,8),$(rv),$(rm),$(oi),$(Op),$(Dr),$(Da))},n.\u0275cmp=kn({type:n,selectors:[["sbb-lightbox-container"]],hostAttrs:["tabindex","-1","aria-modal","true",1,"sbb-lightbox-container"],hostVars:6,hostBindings:function(e,i){1&e&&iy("@lightboxContainer.done",function(s){return i._onAnimationDone(s)})("@lightboxContainer.start",function(s){return i._onAnimationStart(s)}),2&e&&(uc("id",i._config.id),Ht("role",i._config.role)("aria-labelledby",i._config.ariaLabel?null:i._ariaLabelledBy)("aria-label",i._config.ariaLabel)("aria-describedby",i._config.ariaDescribedBy||null),oy("@lightboxContainer",i._getAnimationState()))},features:[ut],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(e,i){1&e&&cn(0,cZ,0,0,"ng-template",0)},dependencies:[Hu],styles:[".sbb-overlay-background{background-color:var(--sbb-color-white-alpha70);align-items:center}.sbb-lightbox-container{display:flex;flex-direction:column;box-sizing:border-box;overflow:hidden;outline:0;background-color:var(--sbb-color-background);width:100%;height:100%;min-height:100vh;max-height:100vw}.cdk-high-contrast-active .sbb-lightbox-container{outline:solid .0666666667rem}.sbb-lightbox-container>*:only-child:not(.sbb-lightbox-content){width:100%;height:100%;display:flex;flex-direction:column}.sbb-lightbox-content{display:block;padding:var(--sbb-divider-big) var(--sbb-lightbox-padding-horizontal);flex:1 1 auto;overflow:auto;-webkit-overflow-scrolling:touch}.sbb-lightbox-content>*:first-child{margin-top:0}.sbb-lightbox-title{padding:calc(1.4rem * var(--sbb-scaling-factor)) 3.7333333333rem calc(1.1333333333rem * var(--sbb-scaling-factor)) 1.3333333333rem;flex:0 0 auto;font-size:var(--sbb-font-size);line-height:var(--sbb-line-height);display:block;position:relative;box-shadow:var(--sbb-box-shadow-horizontal-border-top);overflow:hidden;white-space:nowrap;text-overflow:ellipsis;min-height:calc(4.2666666667rem * var(--sbb-scaling-factor))}@media all and (min-width: 40.1875em){.sbb-lightbox-title{padding-left:1.6rem;padding-right:4rem}}@media all and (min-width: 64.0625em){.sbb-lightbox-title{padding-left:calc(5.3333333333rem * var(--sbb-scaling-factor));padding-right:calc(6.1333333333rem * var(--sbb-scaling-factor))}}@media all and (min-width: 160.0625em)and (max-width: 240.0525em){:where(html:not(.sbb-lean)) .sbb-lightbox-title{padding-top:1.8666666667rem;padding-bottom:1.8666666667rem}}.sbb-lightbox-title-close-button{position:absolute;right:1.3333333333rem;cursor:pointer;line-height:0;color:var(--sbb-color-storm);outline:0}.sbb-lightbox-title-close-button:is(:hover,:focus){color:var(--sbb-color-call-to-action-hover)}@media all and (min-width: 40.1875em){.sbb-lightbox-title-close-button{right:1.6rem}}@media all and (min-width: 64.0625em){.sbb-lightbox-title-close-button{right:calc(3.7333333333rem * var(--sbb-scaling-factor))}}.sbb-lightbox-actions{padding:var(--sbb-lightbox-actions-padding-vertical) var(--sbb-lightbox-padding-horizontal);display:flex;flex:0 0 auto;flex-flow:column wrap;gap:var(--sbb-button-gap);align-items:center;justify-content:space-between;box-sizing:content-box;box-shadow:var(--sbb-box-shadow-horizontal-border-bottom)}@media all and (min-width: 40.1875em){.sbb-lightbox-actions{flex-direction:row}}"],encapsulation:2,data:{animation:[_Z.lightboxContainer]}}),n})();class vZ extends Xw{constructor(t,e,i){super(t,e,i),this.closeRequest=new Qt,t.overlayRef.keydownEvents().pipe(Er(r=>27===r.keyCode&&!!this.disableClose&&!aa(r))).subscribe(()=>this.closeRequest.next(null)),t.overlayRef.detachments().subscribe(()=>{this.closeRequest.complete()})}updatePosition(){return this}updateSize(){return this}}const xZ=new bt("SbbLightboxData"),wZ=new bt("sbb-lightbox-default-options"),yF=new bt("sbb-lightbox-scroll-strategy"),CZ={provide:yF,deps:[$o],useFactory:function SZ(n){return()=>n.scrollStrategies.block()}};let TZ=0,DZ=(()=>{class n extends dL{constructor(e,i,r,s,d,m){super(e,i,r,d,m,s,vZ,yZ,xZ),this._idPrefix="sbb-lightbox-"}get openLightboxes(){return this.openDialogs}open(e,i){const r=Object.assign(Object.assign({},i),{width:"100vw",minWidth:"100vw",maxWidth:"100vw",height:"100vh",minHeight:"100vh",maxHeight:"100vh"});return r.id=r.id||`${this._idPrefix}${TZ++}`,super.open(e,r)}getDialogById(e){return this.openDialogs.find(i=>i.id===e)}getLightboxById(e){return this.getDialogById(e)}}return n.\u0275fac=function(e){return new(e||n)(Be($o),Be(xr),Be(wZ,8),Be(yF),Be(n,12),Be(rb))},n.\u0275prov=Ut({token:n,factory:n.\u0275fac}),n})(),vF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({providers:[DZ,CZ],imports:[bZ,wr,yl,sa,Gi,bo]}),n})(),xF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({imports:[wr,Gi]}),n})();ks("showDismiss",[gr("void, dismissed",Nn({height:0,paddingTop:0,paddingBottom:0,borderTopWidth:0,borderBottomWidth:0})),gr("visible",Nn({height:"*",paddingTop:"*",paddingBottom:"*",borderTopWidth:"*",borderBottomWidth:"*"})),$i("visible => dismissed",Yi("0.25s cubic-bezier(0.4,0.0,0.2,1)"))]),sm(class{});let wF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({imports:[wr,Gi,bo]}),n})();new bt("SBB_PAGINATOR_DEFAULT_OPTIONS"),Wa(x2(class{}));let SF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({imports:[wr,ww,Gi,bo]}),n})(),kZ=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({imports:[qw]}),n})();ks("stepTransition",[$i("* => previous, * => next",[Nn({opacity:1}),Yi("150ms ease",Nn({opacity:0}))]),$i("previous => current, next => current",[Nn({opacity:0}),Yi("500ms ease",Nn({opacity:1}))]),$i("void => current",Yi("0s"))]);let CF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({imports:[wr,sa,kZ,Gi,bo]}),n})(),TF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({imports:[wr,Gi,pE]}),n})();ks("growShrink",[gr("void",Nn({opacity:0,width:"0px"})),gr("open",Nn({opacity:1,width:"*"})),$i("void => *",Yi("300ms ease")),$i("* => void",Yi("300ms 25ms linear"))]);const FZ={provide:new bt("sbb-select-scroll-strategy"),deps:[$o],useFactory:function LZ(n){return()=>n.scrollStrategies.reposition()}};["start","center","end"].map(n=>({originX:n,originY:"top",overlayX:n,overlayY:"top"}));let DF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({providers:[FZ],imports:[wr,sa,yl,Gi,rE,bo]}),n})();new bt("SBB_SIDEBAR_CONTAINER"),ks("transform",[gr("open, open-instant",Nn({transform:"none",visibility:"visible"})),gr("void",Nn({"box-shadow":"none",visibility:"hidden"})),$i("void => open-instant",Yi("0ms")),$i("void <=> open, open-instant => void",Yi("300ms cubic-bezier(0.785, 0.135, 0.15, 0.86)"))]);let EF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({imports:[wr,lm,Gi,bo,lm]}),n})(),IF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({imports:[wr,Gi,bo]}),n})(),QZ=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({imports:[ZD]}),n})();new bt("SBB_SORT_DEFAULT_OPTIONS"),x2(Wa(class{}));const ub="225ms cubic-bezier(0.4,0.0,0.2,1)";ks("indicator",[gr("active-asc, asc",Nn({transform:"scaleY(-1)"})),gr("active-desc, desc",Nn({transform:"scaleY(1)"})),$i("active-asc <=> active-desc",Yi(ub)),$i("asc <=> desc",Yi("0ms"))]),ks("arrowOpacity",[gr("desc-to-active, asc-to-active, active",Nn({opacity:1})),gr("desc-to-hint, asc-to-hint, hint",Nn({opacity:.54})),gr("hint-to-desc, active-to-desc, desc, hint-to-asc, active-to-asc, asc, void",Nn({opacity:0})),$i("* => asc, * => desc, * => active, * => hint, * => void",Yi("0ms")),$i("* <=> *",Yi(ub))]),ks("arrowPosition",[$i("* => desc-to-hint, * => desc-to-active",Yi(ub,Sy([Nn({transform:"translateY(-25%)"}),Nn({transform:"translateY(0)"})]))),$i("* => hint-to-desc, * => active-to-desc",Yi(ub,Sy([Nn({transform:"translateY(0)"}),Nn({transform:"translateY(25%)"})]))),$i("* => asc-to-hint, * => asc-to-active",Yi(ub,Sy([Nn({transform:"translateY(25%)"}),Nn({transform:"translateY(0)"})]))),$i("* => hint-to-asc, * => active-to-asc",Yi(ub,Sy([Nn({transform:"translateY(0)"}),Nn({transform:"translateY(-25%)"})]))),gr("desc-to-hint, asc-to-hint, hint, desc-to-active, asc-to-active, active",Nn({transform:"translateY(0)"})),gr("hint-to-desc, active-to-desc, desc",Nn({transform:"translateY(-25%)"})),gr("hint-to-asc, active-to-asc, asc",Nn({transform:"translateY(25%)"}))]),ks("allowChildren",[$i("* <=> *",[NC("@*",FC(),{optional:!0})])]),Wa(class{}),Ip({passive:!0});let jF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({imports:[QZ,wr,Gi]}),n})(),UF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({imports:[wr,Gi,gE]}),n})();Nw(class{constructor(n,t,e,i){this._defaultErrorStateMatcher=n,this._parentForm=t,this._parentFormGroup=e,this.ngControl=i,this.stateChanges=new Qt}});let HF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({imports:[wr,sE,Gi]}),n})(),$F=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({imports:[wr,Gi]}),n})();const GF="225ms cubic-bezier(0.785, 0.135, 0.15, 0.86)";ks("translateHeight",[gr("void",Nn({height:0,paddingTop:0,paddingBottom:0})),gr("auto",Nn({height:"*",paddingTop:"*",paddingBottom:"*"})),$i("fixed => auto, initial => auto, * => void",[Nn({height:"{{currentHeight}}px"}),Yi(GF)]),$i("void => fixed, void => auto",Yi(GF)),$i("void => initial",Yi(0))]);let qF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({imports:[wr,sa,Gi,bo]}),n})();sm(class{});let WF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({imports:[wr,Gi,bo,tS]}),n})();const FY=[F2,eF,UL,gE,tF,rE,iF,sF,aF,mF,kL,gL,gF,Qw,bF,bo,DL,vF,xF,tS,wF,iE,SF,CF,pE,TF,DF,GL,EF,IF,jF,JL,UF,HF,$F,NL,qF,nL,WF];let NY=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n}),n.\u0275inj=ln({imports:[FY,F2,eF,UL,gE,tF,rE,iF,sF,aF,mF,kL,gL,gF,Qw,bF,bo,DL,vF,xF,tS,wF,iE,SF,CF,pE,TF,DF,GL,EF,IF,jF,JL,UF,HF,$F,NL,qF,nL,WF]}),n})(),BY=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=gn({type:n,bootstrap:[uX]}),n.\u0275inj=ln({imports:[gk,j5,t4,q9,aU,lU,NY]}),n})();(function vz(){gA=!1})(),Mj().bootstrapModule(BY).catch(n=>console.error(n))},898:function(rn){rn.exports=function(){"use strict";var Ei,rt,Fe;function Ue(p,me){if(Ei)if(rt){var Et="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Ei+")(sharedChunk); ("+rt+")(sharedChunk); self.onerror = null;",$e={};Ei($e),Fe=me($e),"undefined"!=typeof window&&window&&window.URL&&window.URL.createObjectURL&&(Fe.workerUrl=window.URL.createObjectURL(new Blob([Et],{type:"text/javascript"})))}else rt=me;else Ei=me}return Ue(0,function(p){var me="undefined"!=typeof self?self:{},Et="2.11.0";let $e;const Ge={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==$e){const a=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{$e=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):a}catch(o){$e=a}}return $e},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Ye={supported:!1,testSupport:function(a){!Xe&&kt&&(St?$t(a):Ft=a)}};let Ft,kt,Xe=!1,St=!1;function $t(a){const o=a.createTexture();a.bindTexture(a.TEXTURE_2D,o);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,kt),a.isContextLost())return;Ye.supported=!0}catch(l){}a.deleteTexture(o),Xe=!0}me.document&&(kt=me.document.createElement("img"),kt.onload=function(){Ft&&$t(Ft),Ft=null,St=!0},kt.onerror=function(){Xe=!0,Ft=null},kt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const dn="01";var Ne=jn;function jn(a,o,l,u){this.cx=3*a,this.bx=3*(l-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(u-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=o,this.p2x=l,this.p2y=u}jn.prototype={sampleCurveX:function(a){return((this.ax*a+this.bx)*a+this.cx)*a},sampleCurveY:function(a){return((this.ay*a+this.by)*a+this.cy)*a},sampleCurveDerivativeX:function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},solveCurveX:function(a,o){if(void 0===o&&(o=1e-6),a<0)return 0;if(a>1)return 1;for(var l=a,u=0;u<8;u++){var f=this.sampleCurveX(l)-a;if(Math.abs(f)<o)return l;var b=this.sampleCurveDerivativeX(l);if(Math.abs(b)<1e-6)break;l-=f/b}var y=0,S=1;for(l=a,u=0;u<20&&(f=this.sampleCurveX(l),!(Math.abs(f-a)<o));u++)a>f?y=l:S=l,l=.5*(S-y)+y;return l},solve:function(a,o){return this.sampleCurveY(this.solveCurveX(a,o))}};var mt=gi;function gi(a,o){this.x=a,this.y=o}gi.prototype={clone:function(){return new gi(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,o){return this.clone()._rotateAround(a,o)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var o=a.x-this.x,l=a.y-this.y;return o*o+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,o){return Math.atan2(this.x*o-this.y*a,this.x*a+this.y*o)},_matMult:function(a){var o=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=o,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var o=Math.cos(a),l=Math.sin(a),u=l*this.x+o*this.y;return this.x=o*this.x-l*this.y,this.y=u,this},_rotateAround:function(a,o){var l=Math.cos(a),u=Math.sin(a),f=o.y+u*(this.x-o.x)+l*(this.y-o.y);return this.x=o.x+l*(this.x-o.x)-u*(this.y-o.y),this.y=f,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},gi.convert=function(a){return a instanceof gi?a:Array.isArray(a)?new gi(a[0],a[1]):a};const Ie=Math.PI/180,Se=180/Math.PI;function Ae(a){return a*Ie}function ee(a){return a*Se}const nt=[[0,0],[1,0],[1,1],[0,1]];function at(a){if(a<=0)return 0;if(a>=1)return 1;const o=a*a,l=o*a;return 4*(a<.5?l:3*(a-o)+l-.75)}function pe(a,o,l,u){const f=new Ne(a,o,l,u);return function(b){return f.solve(b)}}const et=pe(.25,.1,.25,1);function Ke(a,o,l){return Math.min(l,Math.max(o,a))}function sn(a,o,l){return(l=Ke((l-a)/(o-a),0,1))*l*(3-2*l)}function wn(a,o,l){const u=l-o,f=((a-o)%u+u)%u+o;return f===o?l:f}function Un(a,o,l){if(!a.length)return l(null,[]);let u=a.length;const f=new Array(a.length);let b=null;a.forEach((y,S)=>{o(y,(T,E)=>{T&&(b=T),f[S]=E,0==--u&&l(b,f)})})}function Fi(a){const o=[];for(const l in a)o.push(a[l]);return o}function en(a,...o){for(const l of o)for(const u in l)a[u]=l[u];return a}let ti=1;function nr(){return ti++}function qr(){return function a(o){return o?(o^Math.random()*(16>>o/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()}function ni(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))}function Qt(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)}function Rs(a,o){a.forEach(l=>{o[l]&&(o[l]=o[l].bind(o))})}function Eo(a,o){return-1!==a.indexOf(o,a.length-o.length)}function di(a,o,l){const u={};for(const f in a)u[f]=o.call(l||this,a[f],f,a);return u}function Tt(a,o,l){const u={};for(const f in a)o.call(l||this,a[f],f,a)&&(u[f]=a[f]);return u}function Jt(a){return Array.isArray(a)?a.map(Jt):"object"==typeof a&&a?di(a,Jt):a}const Hn={};function Ni(a){Hn[a]||("undefined"!=typeof console&&console.warn(a),Hn[a]=!0)}function ir(a,o,l){return(l.y-a.y)*(o.x-a.x)>(o.y-a.y)*(l.x-a.x)}function zt(a){let o=0;for(let l,u,f=0,b=a.length,y=b-1;f<b;y=f++)l=a[f],u=a[y],o+=(u.x-l.x)*(l.y+u.y);return o}function Sn(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function ru(a){const o={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,u,f,b)=>{const y=f||b;return o[u]=!y||y.toLowerCase(),""}),o["max-age"]){const l=parseInt(o["max-age"],10);isNaN(l)?delete o["max-age"]:o["max-age"]=l}return o}let Ya=null;function In(a){if(null==Ya){const o=a.navigator?a.navigator.userAgent:null;Ya=!!a.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return Ya}function _o(a){try{const o=me[a];return o.setItem("_mapbox_test_",1),o.removeItem("_mapbox_test_"),!0}catch(o){return!1}}function vl(a,o){return[a[4*o],a[4*o+1],a[4*o+2],a[4*o+3]]}const pn="mapbox-tiles";let Wr,yo,ys=500,qo=50;function vs(){try{return me.caches}catch(a){}}function On(){vs()&&!Wr&&(Wr=me.caches.open(pn))}function an(a){const o=a.indexOf("?");if(o<0)return a;const u=function(f){const b=f.indexOf("?");return b>0?f.slice(b+1).split("&"):[]}(a).filter(f=>{const b=f.split("=");return"language"===b[0]||"worldview"===b[0]});return u.length?`${a.slice(0,o)}?${u.join("&")}`:a.slice(0,o)}let Wo=1/0;const Xr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(Xr);class la extends Error{constructor(o,l,u){401===l&&mn(u)&&(o+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(o),this.status=l,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const ca=Sn()?()=>self.worker&&self.worker.referrer:()=>("blob:"===me.location.protocol?me.parent:me).location.href,hi=function(a,o){if(!(/^file:/.test(l=a.url)||/^file:/.test(ca())&&!/^\w+:/.test(l))){if(me.fetch&&me.Request&&me.AbortController&&me.Request.prototype.hasOwnProperty("signal"))return function(u,f){const b=new me.AbortController,y=new me.Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:ca(),signal:b.signal});let S=!1,T=!1;const E=(M=y.url).indexOf("sku=")>0&&mn(M);var M;"json"===u.type&&y.headers.set("Accept","application/json");const P=(B,V,G)=>{if(T)return;if(B&&"SecurityError"!==B.message&&Ni(B),V&&G)return O(V);const Z=Date.now();me.fetch(y).then(ce=>{if(ce.ok){const ye=E?ce.clone():null;return O(ce,ye,Z)}return f(new la(ce.statusText,ce.status,u.url))}).catch(ce=>{20!==ce.code&&f(new Error(ce.message))})},O=(B,V,G)=>{("arrayBuffer"===u.type?B.arrayBuffer():"json"===u.type?B.json():B.text()).then(Z=>{T||(V&&G&&function(ce,ye,ue){if(On(),!Wr)return;const ge={status:ye.status,statusText:ye.statusText,headers:new me.Headers};ye.headers.forEach((tt,Ze)=>ge.headers.set(Ze,tt));const De=ru(ye.headers.get("Cache-Control")||"");if(De["no-store"])return;De["max-age"]&&ge.headers.set("Expires",new Date(ue+1e3*De["max-age"]).toUTCString());const xe=ge.headers.get("Expires");xe&&(new Date(xe).getTime()-ue<42e4||function(tt,Ze){if(void 0===yo)try{new Response(new ReadableStream),yo=!0}catch(lt){yo=!1}yo?Ze(tt.body):tt.blob().then(Ze)}(ye,tt=>{const Ze=new me.Response(tt,ge);On(),Wr&&Wr.then(lt=>lt.put(an(ce.url),Ze)).catch(lt=>Ni(lt.message))}))}(y,V,G),S=!0,f(null,Z,B.headers.get("Cache-Control"),B.headers.get("Expires")))}).catch(Z=>{T||f(new Error(Z.message))})};return E?function(B,V){if(On(),!Wr)return V(null);const G=an(B.url);Wr.then(Z=>{Z.match(G).then(ce=>{const ye=function(ue){if(!ue)return!1;const ge=new Date(ue.headers.get("Expires")||0),De=ru(ue.headers.get("Cache-Control")||"");return ge>Date.now()&&!De["no-cache"]}(ce);Z.delete(G),ye&&Z.put(G,ce.clone()),V(null,ce,ye)}).catch(V)}).catch(V)}(y,P):P(null,null),{cancel:()=>{T=!0,S||b.abort()}}}(a,o);if(Sn()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,o,void 0,!0)}var l;return function(u,f){const b=new me.XMLHttpRequest;b.open(u.method||"GET",u.url,!0),"arrayBuffer"===u.type&&(b.responseType="arraybuffer");for(const y in u.headers)b.setRequestHeader(y,u.headers[y]);return"json"===u.type&&(b.responseType="text",b.setRequestHeader("Accept","application/json")),b.withCredentials="include"===u.credentials,b.onerror=()=>{f(new Error(b.statusText))},b.onload=()=>{if((b.status>=200&&b.status<300||0===b.status)&&null!==b.response){let y=b.response;if("json"===u.type)try{y=JSON.parse(b.response)}catch(S){return f(S)}f(null,y,b.getResponseHeader("Cache-Control"),b.getResponseHeader("Expires"))}else f(new la(b.statusText,b.status,u.url))},b.send(u.body),{cancel:()=>b.abort()}}(a,o)},Qa=function(a,o){return hi(en(a,{type:"arrayBuffer"}),o)};function _c(a){const o=me.document.createElement("a");return o.href=a,o.protocol===me.document.location.protocol&&o.host===me.document.location.host}const x="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let z,ae;z=[],ae=0;const Oe=function(a,o){if(Ye.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),ae>=Ge.MAX_PARALLEL_IMAGE_REQUESTS){const b={requestParameters:a,callback:o,cancelled:!1,cancel(){this.cancelled=!0}};return z.push(b),b}ae++;let l=!1;const u=()=>{if(!l)for(l=!0,ae--;z.length&&ae<Ge.MAX_PARALLEL_IMAGE_REQUESTS;){const b=z.shift(),{requestParameters:y,callback:S,cancelled:T}=b;T||(b.cancel=Oe(y,S).cancel)}},f=Qa(a,(b,y,S,T)=>{u(),b?o(b):y&&(me.createImageBitmap?function(E,M){const P=new me.Blob([new Uint8Array(E)],{type:"image/png"});me.createImageBitmap(P).then(O=>{M(null,O)}).catch(O=>{M(new Error(`Could not load image because of ${O.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(y,(E,M)=>o(E,M,S,T)):function(E,M){const P=new me.Image,O=me.URL;P.onload=()=>{M(null,P),O.revokeObjectURL(P.src),P.onload=null,me.requestAnimationFrame(()=>{P.src=x})},P.onerror=()=>M(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const B=new me.Blob([new Uint8Array(E)],{type:"image/png"});P.src=E.byteLength?O.createObjectURL(B):x}(y,(E,M)=>o(E,M,S,T)))});return{cancel:()=>{f.cancel(),u()}}},Ve="NO_ACCESS_TOKEN";function le(a){return 0===a.indexOf("mapbox:")}function mn(a){return Ge.API_URL_REGEX.test(a)}function _i(a){return Ge.API_STYLE_REGEX.test(a)&&!Ii(a)}function Ii(a){return Ge.API_SPRITE_REGEX.test(a)}const un=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Wn(a){const o=a.match(un);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function Zr(a){const o=a.params.length?`?${a.params.join("&")}`:"";return`${a.protocol}://${a.authority}${a.path}${o}`}function Xo(a){if(!a)return null;const o=a.split(".");if(!o||3!==o.length)return null;try{return JSON.parse(decodeURIComponent(me.atob(o[1]).split("").map(l=>"%"+("00"+l.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(l){return null}}class li{constructor(o){this.type=o,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(o){const l=Xo(Ge.ACCESS_TOKEN);let u="";return u=l&&l.u?me.btoa(encodeURIComponent(l.u).replace(/%([0-9A-F]{2})/g,(f,b)=>String.fromCharCode(Number("0x"+b)))):Ge.ACCESS_TOKEN||"",o?`mapbox.eventData.${o}:${u}`:`mapbox.eventData:${u}`}fetchEventData(){const o=_o("localStorage"),l=this.getStorageKey(),u=this.getStorageKey("uuid");if(o)try{const f=me.localStorage.getItem(l);f&&(this.eventData=JSON.parse(f));const b=me.localStorage.getItem(u);b&&(this.anonId=b)}catch(f){Ni("Unable to read from LocalStorage")}}saveEventData(){const o=_o("localStorage"),l=this.getStorageKey(),u=this.getStorageKey("uuid");if(o)try{me.localStorage.setItem(u,this.anonId),Object.keys(this.eventData).length>=1&&me.localStorage.setItem(l,JSON.stringify(this.eventData))}catch(f){Ni("Unable to write to LocalStorage")}}processRequests(o){}postEvent(o,l,u,f){if(!Ge.EVENTS_URL)return;const b=Wn(Ge.EVENTS_URL);b.params.push(`access_token=${f||Ge.ACCESS_TOKEN||""}`);const y={event:this.type,created:new Date(o).toISOString()},S=l?en(y,l):y,T={url:Zr(b),headers:{"Content-Type":"text/plain"},body:JSON.stringify([S])};var M;this.pendingRequest=(M=E=>{this.pendingRequest=null,u(E),this.saveEventData(),this.processRequests(f)},hi(en(T,{method:"POST"}),M))}queueRequest(o,l){this.queue.push(o),this.processRequests(l)}}const re=new class extends li{constructor(a){super("appUserTurnstile"),this._customAccessToken=a}postTurnstileEvent(a,o){Ge.EVENTS_URL&&Ge.ACCESS_TOKEN&&Array.isArray(a)&&a.some(l=>le(l)||mn(l))&&this.queueRequest(Date.now(),o)}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const o=Xo(Ge.ACCESS_TOKEN),l=o?o.u:Ge.ACCESS_TOKEN;let u=l!==this.eventData.tokenU;Qt(this.anonId)||(this.anonId=qr(),u=!0);const f=this.queue.shift();if(this.eventData.lastSuccess){const b=new Date(this.eventData.lastSuccess),y=new Date(f),S=(f-this.eventData.lastSuccess)/864e5;u=u||S>=1||S<-1||b.getDate()!==y.getDate()}else u=!0;u?this.postEvent(f,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Et,skuId:dn,"enabled.telemetry":!1,userId:this.anonId},b=>{b||(this.eventData.lastSuccess=f,this.eventData.tokenU=l)},a):this.processRequests()}},U=re.postTurnstileEvent.bind(re),q=new class extends li{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(a,o,l,u){this.skuToken=o,this.errorCb=u,Ge.EVENTS_URL&&(l||Ge.ACCESS_TOKEN?this.queueRequest({id:a,timestamp:Date.now()},l):this.errorCb(new Error(Ve)))}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;const{id:o,timestamp:l}=this.queue.shift();o&&this.success[o]||(this.anonId||this.fetchEventData(),Qt(this.anonId)||(this.anonId=qr()),this.postEvent(l,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Et,skuId:dn,skuToken:this.skuToken,userId:this.anonId},u=>{u?this.errorCb(u):o&&(this.success[o]=!0)},a))}},oe=q.postMapLoadEvent.bind(q),fe=new class extends li{constructor(){super("gljs.performance")}postPerformanceEvent(a,o){Ge.EVENTS_URL&&(a||Ge.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:o},a)}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:o,performanceData:l}=this.queue.shift(),u=function(f){const b=me.performance.getEntriesByType("resource"),y=me.performance.getEntriesByType("mark"),S=function(O){const B={};if(O)for(const V in O)if("other"!==V)for(const G of O[V]){const Z=`${V}RequestCount`,ce=`${V}ResolveRangeMin`,ye=`${V}ResolveRangeMax`;B[ce]=Math.min(B[ce]||1/0,G.startTime),B[ye]=Math.max(B[ye]||-1/0,G.responseEnd),void 0===B[Z]&&(B[Z]=0),++B[Z]}return B}(function(O,B){const V={};if(O)for(const G of O){const Z=B(G);void 0===V[Z]&&(V[Z]=[]),V[Z].push(G)}return V}(b,Vt)),T=me.devicePixelRatio,E=me.navigator.connection||me.navigator.mozConnection||me.navigator.webkitConnection,M={counters:[],metadata:[],attributes:[]},P=(O,B,V)=>{null!=V&&O.push({name:B,value:V.toString()})};for(const O in S)P(M.counters,O,S[O]);if(f.interactionRange[0]!==1/0&&f.interactionRange[1]!==-1/0&&(P(M.counters,"interactionRangeMin",f.interactionRange[0]),P(M.counters,"interactionRangeMax",f.interactionRange[1])),y)for(const O of Object.keys(ke)){const B=ke[O],V=y.find(G=>G.name===B);V&&P(M.counters,B,V.startTime)}return P(M.attributes,"style",function(O){if(O)for(const B of O){const V=B.name.split("?")[0];if(_i(V)){const G=V.split("/").slice(-2);if(2===G.length)return`mapbox://styles/${G[0]}/${G[1]}`}}}(b)),P(M.attributes,"terrainEnabled",f.terrainEnabled?"true":"false"),P(M.attributes,"fogEnabled",f.fogEnabled?"true":"false"),P(M.attributes,"projection",f.projection.name),P(M.attributes,"zoom",f.zoom),P(M.metadata,"devicePixelRatio",T),P(M.metadata,"connectionEffectiveType",E?E.effectiveType:void 0),P(M.metadata,"navigatorUserAgent",me.navigator.userAgent),P(M.metadata,"screenWidth",me.screen.width),P(M.metadata,"screenHeight",me.screen.height),P(M.metadata,"windowWidth",me.innerWidth),P(M.metadata,"windowHeight",me.innerHeight),P(M.metadata,"mapWidth",f.width/T),P(M.metadata,"mapHeight",f.height/T),P(M.metadata,"webglRenderer",f.renderer),P(M.metadata,"webglVendor",f.vendor),P(M.metadata,"sdkVersion",Et),P(M.metadata,"sdkIdentifier","mapbox-gl-js"),M}(l);for(const f of u.metadata);for(const f of u.counters);for(const f of u.attributes);this.postEvent(o,u,()=>{},a)}},Te=fe.postPerformanceEvent.bind(fe),je=new class extends li{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(a,o,l,u){if(!Ge.API_URL||!Ge.SESSION_PATH)return;const f=Wn(Ge.API_URL+Ge.SESSION_PATH);f.params.push(`sku=${o||""}`),f.params.push(`access_token=${u||Ge.ACCESS_TOKEN||""}`);const b={url:Zr(f),headers:{"Content-Type":"text/plain"}};var S;this.pendingRequest=(S=y=>{this.pendingRequest=null,l(y),this.saveEventData(),this.processRequests(u)},hi(en(b,{method:"GET"}),S))}getSessionAPI(a,o,l,u){this.skuToken=o,this.errorCb=u,Ge.SESSION_PATH&&Ge.API_URL&&(l||Ge.ACCESS_TOKEN?this.queueRequest({id:a,timestamp:Date.now()},l):this.errorCb(new Error(Ve)))}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;const{id:o,timestamp:l}=this.queue.shift();o&&this.success[o]||this.getSession(l,this.skuToken,u=>{u?this.errorCb(u):o&&(this.success[o]=!0)},a)}},de=je.getSessionAPI.bind(je),be=new Set,ke={create:"create",load:"load",fullLoad:"fullLoad"},ht={mark(a){me.performance.mark(a)},measure(a,o,l){me.performance.measure(a,o,l)}};function Vt(a){const o=a.name.split("?")[0];return o.includes("mapbox-gl.js")?"javascript":o.includes("mapbox-gl.css")?"css":Ge.API_FONTS_REGEX.test(o)?"fontRange":Ii(o)?"sprite":_i(o)?"style":Ge.API_TILEJSON_REGEX.test(o)?"tilejson":"other"}const At=me.performance;function Ln(a){const o=a?a.url.toString():void 0;return At.getEntriesByName(o)}let An,Dn,Xn,pi;const qi={now:()=>void 0!==Xn?Xn:me.performance.now(),setNow(a){Xn=a},restoreNow(){Xn=void 0},frame(a){const o=me.requestAnimationFrame(a);return{cancel:()=>me.cancelAnimationFrame(o)}},getImageData(a,o=0){const{width:l,height:u}=a;pi||(pi=me.document.createElement("canvas"));const f=pi.getContext("2d");if(!f)throw new Error("failed to create canvas 2d context");return(l>pi.width||u>pi.height)&&(pi.width=l,pi.height=u),f.clearRect(-o,-o,l+2*o,u+2*o),f.drawImage(a,0,0,l,u),f.getImageData(-o,-o,l+2*o,u+2*o)},resolveURL:a=>(An||(An=me.document.createElement("a")),An.href=a,An.href),get devicePixelRatio(){return me.devicePixelRatio},get prefersReducedMotion(){return!!me.matchMedia&&(null==Dn&&(Dn=me.matchMedia("(prefers-reduced-motion: reduce)")),Dn.matches)}};function $n(a,o,l){l[a]&&-1!==l[a].indexOf(o)||(l[a]=l[a]||[],l[a].push(o))}function lr(a,o,l){if(l&&l[a]){const u=l[a].indexOf(o);-1!==u&&l[a].splice(u,1)}}class _r{constructor(o,l={}){en(this,l),this.type=o}}class Ul extends _r{constructor(o,l={}){super("error",en({error:o},l))}}class xl{on(o,l){return this._listeners=this._listeners||{},$n(o,l,this._listeners),this}off(o,l){return lr(o,l,this._listeners),lr(o,l,this._oneTimeListeners),this}once(o,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},$n(o,l,this._oneTimeListeners),this):new Promise(u=>this.once(o,u))}fire(o,l){"string"==typeof o&&(o=new _r(o,l||{}));const u=o.type;if(this.listens(u)){o.target=this;const f=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(const S of f)S.call(this,o);const b=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(const S of b)lr(u,S,this._oneTimeListeners),S.call(this,o);const y=this._eventedParent;y&&(en(o,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),y.fire(o))}else o instanceof Ul&&console.error(o.error);return this}listens(o){return!!(this._listeners&&this._listeners[o]&&this._listeners[o].length>0||this._oneTimeListeners&&this._oneTimeListeners[o]&&this._oneTimeListeners[o].length>0||this._eventedParent&&this._eventedParent.listens(o))}setEventedParent(o,l){return this._eventedParent=o,this._eventedParentData=l,this}}var ct=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Ka(a,...o){for(const l of o)for(const u in l)a[u]=l[u];return a}function co(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function Hl(a){if(Array.isArray(a))return a.map(Hl);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const o={};for(const l in a)o[l]=Hl(a[l]);return o}return co(a)}class vo extends Error{constructor(o,l){super(l),this.message=l,this.key=o}}var rr=vo;class yc{constructor(o,l=[]){this.parent=o,this.bindings={};for(const[u,f]of l)this.bindings[u]=f}concat(o){return new yc(this,o)}get(o){if(this.bindings[o])return this.bindings[o];if(this.parent)return this.parent.get(o);throw new Error(`${o} not found in scope.`)}has(o){return!!this.bindings[o]||!!this.parent&&this.parent.has(o)}}var sh=yc;const cr={kind:"null"},qt={kind:"number"},xn={kind:"string"},Ti={kind:"boolean"},Ja={kind:"color"},Ri={kind:"object"},Zt={kind:"value"},vc={kind:"collator"},Wu={kind:"formatted"},Dt={kind:"resolvedImage"};function Jo(a,o){return{kind:"array",itemType:a,N:o}}function Cn(a){if("array"===a.kind){const o=Cn(a.itemType);return"number"==typeof a.N?`array<${o}, ${a.N}>`:"value"===a.itemType.kind?"array":`array<${o}>`}return a.kind}const yr=[cr,qt,xn,Ti,Ja,Wu,Ri,Jo(Zt),Dt];function Ia(a,o){if("error"===o.kind)return null;if("array"===a.kind){if("array"===o.kind&&(0===o.N&&"value"===o.itemType.kind||!Ia(a.itemType,o.itemType))&&("number"!=typeof a.N||a.N===o.N))return null}else{if(a.kind===o.kind)return null;if("value"===a.kind)for(const l of yr)if(!Ia(l,o))return null}return`Expected ${Cn(a)} but found ${Cn(o)} instead.`}function Np(a,o){return o.some(l=>l.kind===a.kind)}function Ps(a,o){return o.some(l=>"null"===l?null===a:"array"===l?Array.isArray(a):"object"===l?a&&!Array.isArray(a)&&"object"==typeof a:l===typeof a)}var ou,es={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Bp(a){return(a=Math.round(a))<0?0:a>255?255:a}function Xu(a){return Bp("%"===a[a.length-1]?parseFloat(a)/100*255:parseInt(a))}function ah(a){return(o="%"===a[a.length-1]?parseFloat(a)/100:parseFloat(a))<0?0:o>1?1:o;var o}function xs(a,o,l){return l<0?l+=1:l>1&&(l-=1),6*l<1?a+(o-a)*l*6:2*l<1?o:3*l<2?a+(o-a)*(2/3-l)*6:a}try{ou={}.parseCSSColor=function(a){var o,l=a.replace(/ /g,"").toLowerCase();if(l in es)return es[l].slice();if("#"===l[0])return 4===l.length?(o=parseInt(l.substr(1),16))>=0&&o<=4095?[(3840&o)>>4|(3840&o)>>8,240&o|(240&o)>>4,15&o|(15&o)<<4,1]:null:7===l.length&&(o=parseInt(l.substr(1),16))>=0&&o<=16777215?[(16711680&o)>>16,(65280&o)>>8,255&o,1]:null;var u=l.indexOf("("),f=l.indexOf(")");if(-1!==u&&f+1===l.length){var b=l.substr(0,u),y=l.substr(u+1,f-(u+1)).split(","),S=1;switch(b){case"rgba":if(4!==y.length)return null;S=ah(y.pop());case"rgb":return 3!==y.length?null:[Xu(y[0]),Xu(y[1]),Xu(y[2]),S];case"hsla":if(4!==y.length)return null;S=ah(y.pop());case"hsl":if(3!==y.length)return null;var T=(parseFloat(y[0])%360+360)%360/360,E=ah(y[1]),M=ah(y[2]),P=M<=.5?M*(E+1):M+E-M*E,O=2*M-P;return[Bp(255*xs(O,P,T+1/3)),Bp(255*xs(O,P,T)),Bp(255*xs(O,P,T-1/3)),S];default:return null}}return null}}catch(a){}class ws{constructor(o,l,u,f=1){this.r=o,this.g=l,this.b=u,this.a=f}static parse(o){if(!o)return;if(o instanceof ws)return o;if("string"!=typeof o)return;const l=ou(o);return l?new ws(l[0]/255*l[3],l[1]/255*l[3],l[2]/255*l[3],l[3]):void 0}toString(){const[o,l,u,f]=this.toArray();return`rgba(${Math.round(o)},${Math.round(l)},${Math.round(u)},${f})`}toArray(){const{r:o,g:l,b:u,a:f}=this;return 0===f?[0,0,0,0]:[255*o/f,255*l/f,255*u/f,f]}toArray01(){const{r:o,g:l,b:u,a:f}=this;return 0===f?[0,0,0,0]:[o/f,l/f,u/f,f]}toArray01PremultipliedAlpha(){const{r:o,g:l,b:u,a:f}=this;return[o,l,u,f]}}ws.black=new ws(0,0,0,1),ws.white=new ws(1,1,1,1),ws.transparent=new ws(0,0,0,0),ws.red=new ws(1,0,0,1),ws.blue=new ws(0,0,1,1);var uo=ws;class fm{constructor(o,l,u){this.sensitivity=o?l?"variant":"case":l?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(o,l){return this.collator.compare(o,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class mm{constructor(o,l,u,f,b){this.text=o.normalize?o.normalize():o,this.image=l,this.scale=u,this.fontStack=f,this.textColor=b}}class Ss{constructor(o){this.sections=o}static fromString(o){return new Ss([new mm(o,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(o=>0!==o.text.length||o.image&&0!==o.image.name.length)}static factory(o){return o instanceof Ss?o:Ss.fromString(o)}toString(){return 0===this.sections.length?"":this.sections.map(o=>o.text).join("")}serialize(){const o=["format"];for(const l of this.sections){if(l.image){o.push(["image",l.image.name]);continue}o.push(l.text);const u={};l.fontStack&&(u["text-font"]=["literal",l.fontStack.split(",")]),l.scale&&(u["font-scale"]=l.scale),l.textColor&&(u["text-color"]=["rgba"].concat(l.textColor.toArray())),o.push(u)}return o}}class Hs{constructor(o){this.name=o.name,this.available=o.available}toString(){return this.name}static fromString(o){return o?new Hs({name:o,available:!1}):null}serialize(){return["image",this.name]}}function gm(a,o,l,u){return"number"==typeof a&&a>=0&&a<=255&&"number"==typeof o&&o>=0&&o<=255&&"number"==typeof l&&l>=0&&l<=255?void 0===u||"number"==typeof u&&u>=0&&u<=1?null:`Invalid rgba value [${[a,o,l,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof u?[a,o,l,u]:[a,o,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function su(a){if(null===a||"string"==typeof a||"boolean"==typeof a||"number"==typeof a||a instanceof uo||a instanceof fm||a instanceof Ss||a instanceof Hs)return!0;if(Array.isArray(a)){for(const o of a)if(!su(o))return!1;return!0}if("object"==typeof a){for(const o in a)if(!su(a[o]))return!1;return!0}return!1}function ur(a){if(null===a)return cr;if("string"==typeof a)return xn;if("boolean"==typeof a)return Ti;if("number"==typeof a)return qt;if(a instanceof uo)return Ja;if(a instanceof fm)return vc;if(a instanceof Ss)return Wu;if(a instanceof Hs)return Dt;if(Array.isArray(a)){const o=a.length;let l;for(const u of a){const f=ur(u);if(l){if(l===f)continue;l=Zt;break}l=f}return Jo(l||Zt,o)}return Ri}function Ki(a){const o=typeof a;return null===a?"":"string"===o||"number"===o||"boolean"===o?String(a):a instanceof uo||a instanceof Ss||a instanceof Hs?a.toString():JSON.stringify(a)}class bm{constructor(o,l){this.type=o,this.value=l}static parse(o,l){if(2!==o.length)return l.error(`'literal' expression requires exactly one argument, but found ${o.length-1} instead.`);if(!su(o[1]))return l.error("invalid value");const u=o[1];let f=ur(u);const b=l.expectedType;return"array"!==f.kind||0!==f.N||!b||"array"!==b.kind||"number"==typeof b.N&&0!==b.N||(f=b),new bm(f,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof uo?["rgba"].concat(this.value.toArray()):this.value instanceof Ss?this.value.serialize():this.value}}var lh=bm,ts=class{constructor(a){this.name="ExpressionEvaluationError",this.message=a}toJSON(){return this.message}};const Ut={string:xn,number:qt,boolean:Ti,object:Ri};class _m{constructor(o,l){this.type=o,this.args=l}static parse(o,l){if(o.length<2)return l.error("Expected at least one argument.");let u,f=1;const b=o[0];if("array"===b){let S,T;if(o.length>2){const E=o[1];if("string"!=typeof E||!(E in Ut)||"object"===E)return l.error('The item type argument of "array" must be one of string, number, boolean',1);S=Ut[E],f++}else S=Zt;if(o.length>3){if(null!==o[2]&&("number"!=typeof o[2]||o[2]<0||o[2]!==Math.floor(o[2])))return l.error('The length argument to "array" must be a positive integer literal',2);T=o[2],f++}u=Jo(S,T)}else u=Ut[b];const y=[];for(;f<o.length;f++){const S=l.parse(o[f],f,Zt);if(!S)return null;y.push(S)}return new _m(u,y)}evaluate(o){for(let l=0;l<this.args.length;l++){const u=this.args[l].evaluate(o);if(!Ia(this.type,ur(u)))return u;if(l===this.args.length-1)throw new ts(`Expected value to be of type ${Cn(this.type)}, but found ${Cn(ur(u))} instead.`)}return null}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){const o=this.type,l=[o.kind];if("array"===o.kind){const u=o.itemType;if("string"===u.kind||"number"===u.kind||"boolean"===u.kind){l.push(u.kind);const f=o.N;("number"==typeof f||this.args.length>1)&&l.push(f)}}return l.concat(this.args.map(u=>u.serialize()))}}var ln=_m;class el{constructor(o){this.type=Wu,this.sections=o}static parse(o,l){if(o.length<2)return l.error("Expected at least one argument.");const u=o[1];if(!Array.isArray(u)&&"object"==typeof u)return l.error("First argument must be an image or text section.");const f=[];let b=!1;for(let y=1;y<=o.length-1;++y){const S=o[y];if(b&&"object"==typeof S&&!Array.isArray(S)){b=!1;let T=null;if(S["font-scale"]&&(T=l.parse(S["font-scale"],1,qt),!T))return null;let E=null;if(S["text-font"]&&(E=l.parse(S["text-font"],1,Jo(xn)),!E))return null;let M=null;if(S["text-color"]&&(M=l.parse(S["text-color"],1,Ja),!M))return null;const P=f[f.length-1];P.scale=T,P.font=E,P.textColor=M}else{const T=l.parse(o[y],1,Zt);if(!T)return null;const E=T.type.kind;if("string"!==E&&"value"!==E&&"null"!==E&&"resolvedImage"!==E)return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");b=!0,f.push({content:T,scale:null,font:null,textColor:null})}}return new el(f)}evaluate(o){return new Ss(this.sections.map(l=>{const u=l.content.evaluate(o);return ur(u)===Dt?new mm("",u,null,null,null):new mm(Ki(u),null,l.scale?l.scale.evaluate(o):null,l.font?l.font.evaluate(o).join(","):null,l.textColor?l.textColor.evaluate(o):null)}))}eachChild(o){for(const l of this.sections)o(l.content),l.scale&&o(l.scale),l.font&&o(l.font),l.textColor&&o(l.textColor)}outputDefined(){return!1}serialize(){const o=["format"];for(const l of this.sections){o.push(l.content.serialize());const u={};l.scale&&(u["font-scale"]=l.scale.serialize()),l.font&&(u["text-font"]=l.font.serialize()),l.textColor&&(u["text-color"]=l.textColor.serialize()),o.push(u)}return o}}class Zu{constructor(o){this.type=Dt,this.input=o}static parse(o,l){if(2!==o.length)return l.error("Expected two arguments.");const u=l.parse(o[1],1,xn);return u?new Zu(u):l.error("No image name provided.")}evaluate(o){const l=this.input.evaluate(o),u=Hs.fromString(l);return u&&o.availableImages&&(u.available=o.availableImages.indexOf(l)>-1),u}eachChild(o){o(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const hb={"to-boolean":Ti,"to-color":Ja,"to-number":qt,"to-string":xn};class zp{constructor(o,l){this.type=o,this.args=l}static parse(o,l){if(o.length<2)return l.error("Expected at least one argument.");const u=o[0];if(("to-boolean"===u||"to-string"===u)&&2!==o.length)return l.error("Expected one argument.");const f=hb[u],b=[];for(let y=1;y<o.length;y++){const S=l.parse(o[y],y,Zt);if(!S)return null;b.push(S)}return new zp(f,b)}evaluate(o){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(o));if("color"===this.type.kind){let l,u;for(const f of this.args){if(l=f.evaluate(o),u=null,l instanceof uo)return l;if("string"==typeof l){const b=o.parseColor(l);if(b)return b}else if(Array.isArray(l)&&(u=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:gm(l[0],l[1],l[2],l[3]),!u))return new uo(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new ts(u||`Could not parse color from value '${"string"==typeof l?l:String(JSON.stringify(l))}'`)}if("number"===this.type.kind){let l=null;for(const u of this.args){if(l=u.evaluate(o),null===l)return 0;const f=Number(l);if(!isNaN(f))return f}throw new ts(`Could not convert ${JSON.stringify(l)} to number.`)}return"formatted"===this.type.kind?Ss.fromString(Ki(this.args[0].evaluate(o))):"resolvedImage"===this.type.kind?Hs.fromString(Ki(this.args[0].evaluate(o))):Ki(this.args[0].evaluate(o))}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){if("formatted"===this.type.kind)return new el([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Zu(this.args[0]).serialize();const o=[`to-${this.type.kind}`];return this.eachChild(l=>{o.push(l.serialize())}),o}}var xc=zp;const ch=["Unknown","Point","LineString","Polygon"];var uh=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?ch[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const a=this.featureDistanceData.center,o=this.featureDistanceData.scale,{x:l,y:u}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(l*o-a[0])+this.featureDistanceData.bearing[1]*(u*o-a[1])}return 0}parseColor(a){let o=this._parseColorCache[a];return o||(o=this._parseColorCache[a]=uo.parse(a)),o}};class $l{constructor(o,l,u,f){this.name=o,this.type=l,this._evaluate=u,this.args=f}evaluate(o){return this._evaluate(o,this.args)}eachChild(o){this.args.forEach(o)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(o=>o.serialize()))}static parse(o,l){const u=o[0],f=$l.definitions[u];if(!f)return l.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const b=Array.isArray(f)?f[0]:f.type,y=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,S=y.filter(([E])=>!Array.isArray(E)||E.length===o.length-1);let T=null;for(const[E,M]of S){T=new ph(l.registry,l.path,null,l.scope);const P=[];let O=!1;for(let B=1;B<o.length;B++){const V=o[B],G=Array.isArray(E)?E[B-1]:E.type,Z=T.parse(V,1+P.length,G);if(!Z){O=!0;break}P.push(Z)}if(!O)if(Array.isArray(E)&&E.length!==P.length)T.error(`Expected ${E.length} arguments, but found ${P.length} instead.`);else{for(let B=0;B<P.length;B++){const V=Array.isArray(E)?E[B]:E.type,G=P[B];T.concat(B+1).checkSubtype(V,G.type)}if(0===T.errors.length)return new $l(u,b,M,P)}}if(1===S.length)l.errors.push(...T.errors);else{const E=(S.length?S:y).map(([P])=>{return O=P,Array.isArray(O)?`(${O.map(Cn).join(", ")})`:`(${Cn(O.type)}...)`;var O}).join(" | "),M=[];for(let P=1;P<o.length;P++){const O=l.parse(o[P],1+M.length);if(!O)return null;M.push(Cn(O.type))}l.error(`Expected arguments of type ${E}, but found (${M.join(", ")}) instead.`)}return null}static register(o,l){$l.definitions=l;for(const u in l)o[u]=$l}}var Ma=$l;class Yn{constructor(o,l,u){this.type=vc,this.locale=u,this.caseSensitive=o,this.diacriticSensitive=l}static parse(o,l){if(2!==o.length)return l.error("Expected one argument.");const u=o[1];if("object"!=typeof u||Array.isArray(u))return l.error("Collator options argument must be an object.");const f=l.parse(void 0!==u["case-sensitive"]&&u["case-sensitive"],1,Ti);if(!f)return null;const b=l.parse(void 0!==u["diacritic-sensitive"]&&u["diacritic-sensitive"],1,Ti);if(!b)return null;let y=null;return u.locale&&(y=l.parse(u.locale,1,xn),!y)?null:new Yn(f,b,y)}evaluate(o){return new fm(this.caseSensitive.evaluate(o),this.diacriticSensitive.evaluate(o),this.locale?this.locale.evaluate(o):null)}eachChild(o){o(this.caseSensitive),o(this.diacriticSensitive),this.locale&&o(this.locale)}outputDefined(){return!1}serialize(){const o={};return o["case-sensitive"]=this.caseSensitive.serialize(),o["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(o.locale=this.locale.serialize()),["collator",o]}}const tl=8192;function Vp(a,o){a[0]=Math.min(a[0],o[0]),a[1]=Math.min(a[1],o[1]),a[2]=Math.max(a[2],o[0]),a[3]=Math.max(a[3],o[1])}function $s(a,o){return!(a[0]<=o[0]||a[2]>=o[2]||a[1]<=o[1]||a[3]>=o[3])}function Aa(a,o){const l=(180+a[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,f=Math.pow(2,o.z);return[Math.round(l*f*tl),Math.round(u*f*tl)]}function pb(a,o,l){const u=a[0]-o[0],f=a[1]-o[1],b=a[0]-l[0],y=a[1]-l[1];return u*y-b*f==0&&u*b<=0&&f*y<=0}function ka(a,o){let l=!1;for(let y=0,S=o.length;y<S;y++){const T=o[y];for(let E=0,M=T.length;E<M-1;E++){if(pb(a,T[E],T[E+1]))return!1;(f=T[E])[1]>(u=a)[1]!=(b=T[E+1])[1]>u[1]&&u[0]<(b[0]-f[0])*(u[1]-f[1])/(b[1]-f[1])+f[0]&&(l=!l)}}var u,f,b;return l}function ua(a,o){for(let l=0;l<o.length;l++)if(ka(a,o[l]))return!0;return!1}function ym(a,o,l,u){const f=u[0]-l[0],b=u[1]-l[1],y=(a[0]-l[0])*b-f*(a[1]-l[1]),S=(o[0]-l[0])*b-f*(o[1]-l[1]);return y>0&&S<0||y<0&&S>0}function fb(a,o,l){for(const E of l)for(let M=0;M<E.length-1;++M)if((S=[(y=E[M+1])[0]-(b=E[M])[0],y[1]-b[1]])[0]*(T=[(f=o)[0]-(u=a)[0],f[1]-u[1]])[1]-S[1]*T[0]!=0&&ym(u,f,b,y)&&ym(b,y,u,f))return!0;var u,f,b,y,S,T;return!1}function Gs(a,o){for(let l=0;l<a.length;++l)if(!ka(a[l],o))return!1;for(let l=0;l<a.length-1;++l)if(fb(a[l],a[l+1],o))return!1;return!0}function Sr(a,o){for(let l=0;l<o.length;l++)if(Gs(a,o[l]))return!0;return!1}function au(a,o,l){const u=[];for(let f=0;f<a.length;f++){const b=[];for(let y=0;y<a[f].length;y++){const S=Aa(a[f][y],l);Vp(o,S),b.push(S)}u.push(b)}return u}function vm(a,o,l){const u=[];for(let f=0;f<a.length;f++){const b=au(a[f],o,l);u.push(b)}return u}function Gl(a,o,l,u){if(a[0]<l[0]||a[0]>l[2]){const f=.5*u;let b=a[0]-l[0]>f?-u:l[0]-a[0]>f?u:0;0===b&&(b=a[0]-l[2]>f?-u:l[2]-a[0]>f?u:0),a[0]+=b}Vp(o,a)}function Ji(a,o,l,u){const f=Math.pow(2,u.z)*tl,b=[u.x*tl,u.y*tl],y=[];if(!a)return y;for(const S of a)for(const T of S){const E=[T.x+b[0],T.y+b[1]];Gl(E,o,l,f),y.push(E)}return y}function lu(a,o,l,u){const f=Math.pow(2,u.z)*tl,b=[u.x*tl,u.y*tl],y=[];if(!a)return y;for(const T of a){const E=[];for(const M of T){const P=[M.x+b[0],M.y+b[1]];Vp(o,P),E.push(P)}y.push(E)}if(o[2]-o[0]<=f/2){(S=o)[0]=S[1]=1/0,S[2]=S[3]=-1/0;for(const T of y)for(const E of T)Gl(E,o,l,f)}var S;return y}class da{constructor(o,l){this.type=Ti,this.geojson=o,this.geometries=l}static parse(o,l){if(2!==o.length)return l.error(`'within' expression requires exactly one argument, but found ${o.length-1} instead.`);if(su(o[1])){const u=o[1];if("FeatureCollection"===u.type)for(let f=0;f<u.features.length;++f){const b=u.features[f].geometry.type;if("Polygon"===b||"MultiPolygon"===b)return new da(u,u.features[f].geometry)}else if("Feature"===u.type){const f=u.geometry.type;if("Polygon"===f||"MultiPolygon"===f)return new da(u,u.geometry)}else if("Polygon"===u.type||"MultiPolygon"===u.type)return new da(u,u)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(o){if(null!=o.geometry()&&null!=o.canonicalID()){if("Point"===o.geometryType())return function(l,u){const f=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],y=l.canonicalID();if(!y)return!1;if("Polygon"===u.type){const S=au(u.coordinates,b,y),T=Ji(l.geometry(),f,b,y);if(!$s(f,b))return!1;for(const E of T)if(!ka(E,S))return!1}if("MultiPolygon"===u.type){const S=vm(u.coordinates,b,y),T=Ji(l.geometry(),f,b,y);if(!$s(f,b))return!1;for(const E of T)if(!ua(E,S))return!1}return!0}(o,this.geometries);if("LineString"===o.geometryType())return function(l,u){const f=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],y=l.canonicalID();if(!y)return!1;if("Polygon"===u.type){const S=au(u.coordinates,b,y),T=lu(l.geometry(),f,b,y);if(!$s(f,b))return!1;for(const E of T)if(!Gs(E,S))return!1}if("MultiPolygon"===u.type){const S=vm(u.coordinates,b,y),T=lu(l.geometry(),f,b,y);if(!$s(f,b))return!1;for(const E of T)if(!Sr(E,S))return!1}return!0}(o,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Bi=da;function cu(a){if(a instanceof Ma&&("get"===a.name&&1===a.args.length||"feature-state"===a.name||"has"===a.name&&1===a.args.length||"properties"===a.name||"geometry-type"===a.name||"id"===a.name||/^filter-/.test(a.name))||a instanceof Bi)return!1;let o=!0;return a.eachChild(l=>{o&&!cu(l)&&(o=!1)}),o}function ha(a){if(a instanceof Ma&&"feature-state"===a.name)return!1;let o=!0;return a.eachChild(l=>{o&&!ha(l)&&(o=!1)}),o}function ql(a,o){if(a instanceof Ma&&o.indexOf(a.name)>=0)return!1;let l=!0;return a.eachChild(u=>{l&&!ql(u,o)&&(l=!1)}),l}class dh{constructor(o,l){this.type=l.type,this.name=o,this.boundExpression=l}static parse(o,l){if(2!==o.length||"string"!=typeof o[1])return l.error("'var' expression requires exactly one string literal argument.");const u=o[1];return l.scope.has(u)?new dh(u,l.scope.get(u)):l.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(o){return this.boundExpression.evaluate(o)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var kn=dh;class hh{constructor(o,l=[],u,f=new sh,b=[]){this.registry=o,this.path=l,this.key=l.map(y=>`[${y}]`).join(""),this.scope=f,this.errors=b,this.expectedType=u}parse(o,l,u,f,b={}){return l?this.concat(l,u,f)._parse(o,b):this._parse(o,b)}_parse(o,l){function u(f,b,y){return"assert"===y?new ln(b,[f]):"coerce"===y?new xc(b,[f]):f}if(null!==o&&"string"!=typeof o&&"boolean"!=typeof o&&"number"!=typeof o||(o=["literal",o]),Array.isArray(o)){if(0===o.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const f=o[0];if("string"!=typeof f)return this.error(`Expression name must be a string, but found ${typeof f} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const b=this.registry[f];if(b){let y=b.parse(o,this);if(!y)return null;if(this.expectedType){const S=this.expectedType,T=y.type;if("string"!==S.kind&&"number"!==S.kind&&"boolean"!==S.kind&&"object"!==S.kind&&"array"!==S.kind||"value"!==T.kind)if("color"!==S.kind&&"formatted"!==S.kind&&"resolvedImage"!==S.kind||"value"!==T.kind&&"string"!==T.kind){if(this.checkSubtype(S,T))return null}else y=u(y,S,l.typeAnnotation||"coerce");else y=u(y,S,l.typeAnnotation||"assert")}if(!(y instanceof lh)&&"resolvedImage"!==y.type.kind&&Yu(y)){const S=new uh;try{y=new lh(y.type,y.evaluate(S))}catch(T){return this.error(T.message),null}}return y}return this.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===o?"'undefined' value invalid. Use null instead.":"object"==typeof o?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof o} instead.`)}concat(o,l,u){const f="number"==typeof o?this.path.concat(o):this.path,b=u?this.scope.concat(u):this.scope;return new hh(this.registry,f,l||null,b,this.errors)}error(o,...l){const u=`${this.key}${l.map(f=>`[${f}]`).join("")}`;this.errors.push(new rr(u,o))}checkSubtype(o,l){const u=Ia(o,l);return u&&this.error(u),u}}var ph=hh;function Yu(a){if(a instanceof kn)return Yu(a.boundExpression);if(a instanceof Ma&&"error"===a.name||a instanceof Yn||a instanceof Bi)return!1;const o=a instanceof xc||a instanceof ln;let l=!0;return a.eachChild(u=>{l=o?l&&Yu(u):l&&u instanceof lh}),!!l&&cu(a)&&ql(a,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Qu(a,o){const l=a.length-1;let u,f,b=0,y=l,S=0;for(;b<=y;)if(S=Math.floor((b+y)/2),u=a[S],f=a[S+1],u<=o){if(S===l||o<f)return S;b=S+1}else{if(!(u>o))throw new ts("Input is not a number.");y=S-1}return 0}class gn{constructor(o,l,u){this.type=o,this.input=l,this.labels=[],this.outputs=[];for(const[f,b]of u)this.labels.push(f),this.outputs.push(b)}static parse(o,l){if(o.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return l.error("Expected an even number of arguments.");const u=l.parse(o[1],1,qt);if(!u)return null;const f=[];let b=null;l.expectedType&&"value"!==l.expectedType.kind&&(b=l.expectedType);for(let y=1;y<o.length;y+=2){const S=1===y?-1/0:o[y],T=o[y+1],E=y,M=y+1;if("number"!=typeof S)return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(f.length&&f[f.length-1][0]>=S)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const P=l.parse(T,M,b);if(!P)return null;b=b||P.type,f.push([S,P])}return new gn(b,u,f)}evaluate(o){const l=this.labels,u=this.outputs;if(1===l.length)return u[0].evaluate(o);const f=this.input.evaluate(o);if(f<=l[0])return u[0].evaluate(o);const b=l.length;return f>=l[b-1]?u[b-1].evaluate(o):u[Qu(l,f)].evaluate(o)}eachChild(o){o(this.input);for(const l of this.outputs)o(l)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}serialize(){const o=["step",this.input.serialize()];for(let l=0;l<this.labels.length;l++)l>0&&o.push(this.labels[l]),o.push(this.outputs[l].serialize());return o}}var uu=gn;function zi(a,o,l){return a*(1-l)+o*l}var vt=Object.freeze({__proto__:null,number:zi,color:function(a,o,l){return new uo(zi(a.r,o.r,l),zi(a.g,o.g,l),zi(a.b,o.b,l),zi(a.a,o.a,l))},array:function(a,o,l){return a.map((u,f)=>zi(u,o[f],l))}});const is=4/29,Lo=6/29,Os=3*Lo*Lo,Ku=Math.PI/180,fh=180/Math.PI;function wc(a){return a>.008856451679035631?Math.pow(a,1/3):a/Os+is}function Sc(a){return a>Lo?a*a*a:Os*(a-is)}function wl(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function Io(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function jp(a){const o=Io(a.r),l=Io(a.g),u=Io(a.b),f=wc((.4124564*o+.3575761*l+.1804375*u)/.95047),b=wc((.2126729*o+.7151522*l+.072175*u)/1);return{l:116*b-16,a:500*(f-b),b:200*(b-wc((.0193339*o+.119192*l+.9503041*u)/1.08883)),alpha:a.a}}function qs(a){let o=(a.l+16)/116,l=isNaN(a.a)?o:o+a.a/500,u=isNaN(a.b)?o:o-a.b/200;return o=1*Sc(o),l=.95047*Sc(l),u=1.08883*Sc(u),new uo(wl(3.2404542*l-1.5371385*o-.4985314*u),wl(-.969266*l+1.8760108*o+.041556*u),wl(.0556434*l-.2040259*o+1.0572252*u),a.alpha)}function _n(a,o,l){const u=o-a;return a+l*(u>180||u<-180?u-360*Math.round(u/360):u)}const Si={forward:jp,reverse:qs,interpolate:function(a,o,l){return{l:zi(a.l,o.l,l),a:zi(a.a,o.a,l),b:zi(a.b,o.b,l),alpha:zi(a.alpha,o.alpha,l)}}},Pr={forward:function(a){const{l:o,a:l,b:u}=jp(a),f=Math.atan2(u,l)*fh;return{h:f<0?f+360:f,c:Math.sqrt(l*l+u*u),l:o,alpha:a.a}},reverse:function(a){const o=a.h*Ku,l=a.c;return qs({l:a.l,a:Math.cos(o)*l,b:Math.sin(o)*l,alpha:a.alpha})},interpolate:function(a,o,l){return{h:_n(a.h,o.h,l),c:zi(a.c,o.c,l),l:zi(a.l,o.l,l),alpha:zi(a.alpha,o.alpha,l)}}};var Ls=Object.freeze({__proto__:null,lab:Si,hcl:Pr});class nl{constructor(o,l,u,f,b){this.type=o,this.operator=l,this.interpolation=u,this.input=f,this.labels=[],this.outputs=[];for(const[y,S]of b)this.labels.push(y),this.outputs.push(S)}static interpolationFactor(o,l,u,f){let b=0;if("exponential"===o.name)b=ho(l,o.base,u,f);else if("linear"===o.name)b=ho(l,1,u,f);else if("cubic-bezier"===o.name){const y=o.controlPoints;b=new Ne(y[0],y[1],y[2],y[3]).solve(ho(l,1,u,f))}return b}static parse(o,l){let[u,f,b,...y]=o;if(!Array.isArray(f)||0===f.length)return l.error("Expected an interpolation type expression.",1);if("linear"===f[0])f={name:"linear"};else if("exponential"===f[0]){const E=f[1];if("number"!=typeof E)return l.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:E}}else{if("cubic-bezier"!==f[0])return l.error(`Unknown interpolation type ${String(f[0])}`,1,0);{const E=f.slice(1);if(4!==E.length||E.some(M=>"number"!=typeof M||M<0||M>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:E}}}if(o.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(b=l.parse(b,2,qt),!b)return null;const S=[];let T=null;"interpolate-hcl"===u||"interpolate-lab"===u?T=Ja:l.expectedType&&"value"!==l.expectedType.kind&&(T=l.expectedType);for(let E=0;E<y.length;E+=2){const M=y[E],P=y[E+1],O=E+3,B=E+4;if("number"!=typeof M)return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',O);if(S.length&&S[S.length-1][0]>=M)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',O);const V=l.parse(P,B,T);if(!V)return null;T=T||V.type,S.push([M,V])}return"number"===T.kind||"color"===T.kind||"array"===T.kind&&"number"===T.itemType.kind&&"number"==typeof T.N?new nl(T,u,f,b,S):l.error(`Type ${Cn(T)} is not interpolatable.`)}evaluate(o){const l=this.labels,u=this.outputs;if(1===l.length)return u[0].evaluate(o);const f=this.input.evaluate(o);if(f<=l[0])return u[0].evaluate(o);const b=l.length;if(f>=l[b-1])return u[b-1].evaluate(o);const y=Qu(l,f),S=nl.interpolationFactor(this.interpolation,f,l[y],l[y+1]),T=u[y].evaluate(o),E=u[y+1].evaluate(o);return"interpolate"===this.operator?vt[this.type.kind.toLowerCase()](T,E,S):"interpolate-hcl"===this.operator?Pr.reverse(Pr.interpolate(Pr.forward(T),Pr.forward(E),S)):Si.reverse(Si.interpolate(Si.forward(T),Si.forward(E),S))}eachChild(o){o(this.input);for(const l of this.outputs)o(l)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}serialize(){let o;o="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const l=[this.operator,o,this.input.serialize()];for(let u=0;u<this.labels.length;u++)l.push(this.labels[u],this.outputs[u].serialize());return l}}function ho(a,o,l,u){const f=u-l,b=a-l;return 0===f?0:1===o?b/f:(Math.pow(o,b)-1)/(Math.pow(o,f)-1)}var rs=nl;class Yr{constructor(o,l){this.type=o,this.args=l}static parse(o,l){if(o.length<2)return l.error("Expectected at least one argument.");let u=null;const f=l.expectedType;f&&"value"!==f.kind&&(u=f);const b=[];for(const S of o.slice(1)){const T=l.parse(S,1+b.length,u,void 0,{typeAnnotation:"omit"});if(!T)return null;u=u||T.type,b.push(T)}const y=f&&b.some(S=>Ia(f,S.type));return new Yr(y?Zt:u,b)}evaluate(o){let l,u=null,f=0;for(const b of this.args){if(f++,u=b.evaluate(o),u&&u instanceof Hs&&!u.available&&(l||(l=u),u=null,f===this.args.length))return l;if(null!==u)break}return u}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){const o=["coalesce"];return this.eachChild(l=>{o.push(l.serialize())}),o}}var du=Yr;class Wl{constructor(o,l){this.type=l.type,this.bindings=[].concat(o),this.result=l}evaluate(o){return this.result.evaluate(o)}eachChild(o){for(const l of this.bindings)o(l[1]);o(this.result)}static parse(o,l){if(o.length<4)return l.error(`Expected at least 3 arguments, but found ${o.length-1} instead.`);const u=[];for(let b=1;b<o.length-1;b+=2){const y=o[b];if("string"!=typeof y)return l.error(`Expected string, but found ${typeof y} instead.`,b);if(/[^a-zA-Z0-9_]/.test(y))return l.error("Variable names must contain only alphanumeric characters or '_'.",b);const S=l.parse(o[b+1],b+1);if(!S)return null;u.push([y,S])}const f=l.parse(o[o.length-1],o.length-1,l.expectedType,u);return f?new Wl(u,f):null}outputDefined(){return this.result.outputDefined()}serialize(){const o=["let"];for(const[l,u]of this.bindings)o.push(l,u.serialize());return o.push(this.result.serialize()),o}}var Mi=Wl;class Cc{constructor(o,l,u){this.type=o,this.index=l,this.input=u}static parse(o,l){if(3!==o.length)return l.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const u=l.parse(o[1],1,qt),f=l.parse(o[2],2,Jo(l.expectedType||Zt));return u&&f?new Cc(f.type.itemType,u,f):null}evaluate(o){const l=this.index.evaluate(o),u=this.input.evaluate(o);if(l<0)throw new ts(`Array index out of bounds: ${l} < 0.`);if(l>=u.length)throw new ts(`Array index out of bounds: ${l} > ${u.length-1}.`);if(l!==Math.floor(l))throw new ts(`Array index must be an integer, but found ${l} instead.`);return u[l]}eachChild(o){o(this.index),o(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Tc=Cc;class Ju{constructor(o,l){this.type=Ti,this.needle=o,this.haystack=l}static parse(o,l){if(3!==o.length)return l.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const u=l.parse(o[1],1,Zt),f=l.parse(o[2],2,Zt);return u&&f?Np(u.type,[Ti,xn,qt,cr,Zt])?new Ju(u,f):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Cn(u.type)} instead`):null}evaluate(o){const l=this.needle.evaluate(o),u=this.haystack.evaluate(o);if(null==u)return!1;if(!Ps(l,["boolean","string","number","null"]))throw new ts(`Expected first argument to be of type boolean, string, number or null, but found ${Cn(ur(l))} instead.`);if(!Ps(u,["string","array"]))throw new ts(`Expected second argument to be of type array or string, but found ${Cn(ur(u))} instead.`);return u.indexOf(l)>=0}eachChild(o){o(this.needle),o(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Dc=Ju;class xo{constructor(o,l,u){this.type=qt,this.needle=o,this.haystack=l,this.fromIndex=u}static parse(o,l){if(o.length<=2||o.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const u=l.parse(o[1],1,Zt),f=l.parse(o[2],2,Zt);if(!u||!f)return null;if(!Np(u.type,[Ti,xn,qt,cr,Zt]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Cn(u.type)} instead`);if(4===o.length){const b=l.parse(o[3],3,qt);return b?new xo(u,f,b):null}return new xo(u,f)}evaluate(o){const l=this.needle.evaluate(o),u=this.haystack.evaluate(o);if(!Ps(l,["boolean","string","number","null"]))throw new ts(`Expected first argument to be of type boolean, string, number or null, but found ${Cn(ur(l))} instead.`);if(!Ps(u,["string","array"]))throw new ts(`Expected second argument to be of type array or string, but found ${Cn(ur(u))} instead.`);if(this.fromIndex){const f=this.fromIndex.evaluate(o);return u.indexOf(l,f)}return u.indexOf(l)}eachChild(o){o(this.needle),o(this.haystack),this.fromIndex&&o(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const o=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),o]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var hu=xo;class Sl{constructor(o,l,u,f,b,y){this.inputType=o,this.type=l,this.input=u,this.cases=f,this.outputs=b,this.otherwise=y}static parse(o,l){if(o.length<5)return l.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if(o.length%2!=1)return l.error("Expected an even number of arguments.");let u,f;l.expectedType&&"value"!==l.expectedType.kind&&(f=l.expectedType);const b={},y=[];for(let E=2;E<o.length-1;E+=2){let M=o[E];const P=o[E+1];Array.isArray(M)||(M=[M]);const O=l.concat(E);if(0===M.length)return O.error("Expected at least one branch label.");for(const V of M){if("number"!=typeof V&&"string"!=typeof V)return O.error("Branch labels must be numbers or strings.");if("number"==typeof V&&Math.abs(V)>Number.MAX_SAFE_INTEGER)return O.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof V&&Math.floor(V)!==V)return O.error("Numeric branch labels must be integer values.");if(u){if(O.checkSubtype(u,ur(V)))return null}else u=ur(V);if(void 0!==b[String(V)])return O.error("Branch labels must be unique.");b[String(V)]=y.length}const B=l.parse(P,E,f);if(!B)return null;f=f||B.type,y.push(B)}const S=l.parse(o[1],1,Zt);if(!S)return null;const T=l.parse(o[o.length-1],o.length-1,f);return T?"value"!==S.type.kind&&l.concat(1).checkSubtype(u,S.type)?null:new Sl(u,f,S,b,y,T):null}evaluate(o){const l=this.input.evaluate(o);return(ur(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(o)}eachChild(o){o(this.input),this.outputs.forEach(o),o(this.otherwise)}outputDefined(){return this.outputs.every(o=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){const o=["match",this.input.serialize()],l=Object.keys(this.cases).sort(),u=[],f={};for(const y of l){const S=f[this.cases[y]];void 0===S?(f[this.cases[y]]=u.length,u.push([this.cases[y],[y]])):u[S][1].push(y)}const b=y=>"number"===this.inputType.kind?Number(y):y;for(const[y,S]of u)o.push(1===S.length?b(S[0]):S.map(b)),o.push(this.outputs[y].serialize());return o.push(this.otherwise.serialize()),o}}var Ra=Sl;class Xl{constructor(o,l,u){this.type=o,this.branches=l,this.otherwise=u}static parse(o,l){if(o.length<4)return l.error(`Expected at least 3 arguments, but found only ${o.length-1}.`);if(o.length%2!=0)return l.error("Expected an odd number of arguments.");let u;l.expectedType&&"value"!==l.expectedType.kind&&(u=l.expectedType);const f=[];for(let y=1;y<o.length-1;y+=2){const S=l.parse(o[y],y,Ti);if(!S)return null;const T=l.parse(o[y+1],y+1,u);if(!T)return null;f.push([S,T]),u=u||T.type}const b=l.parse(o[o.length-1],o.length-1,u);return b?new Xl(u,f,b):null}evaluate(o){for(const[l,u]of this.branches)if(l.evaluate(o))return u.evaluate(o);return this.otherwise.evaluate(o)}eachChild(o){for(const[l,u]of this.branches)o(l),o(u);o(this.otherwise)}outputDefined(){return this.branches.every(([o,l])=>l.outputDefined())&&this.otherwise.outputDefined()}serialize(){const o=["case"];return this.eachChild(l=>{o.push(l.serialize())}),o}}var xm=Xl;class Ir{constructor(o,l,u,f){this.type=o,this.input=l,this.beginIndex=u,this.endIndex=f}static parse(o,l){if(o.length<=2||o.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const u=l.parse(o[1],1,Zt),f=l.parse(o[2],2,qt);if(!u||!f)return null;if(!Np(u.type,[Jo(Zt),xn,Zt]))return l.error(`Expected first argument to be of type array or string, but found ${Cn(u.type)} instead`);if(4===o.length){const b=l.parse(o[3],3,qt);return b?new Ir(u.type,u,f,b):null}return new Ir(u.type,u,f)}evaluate(o){const l=this.input.evaluate(o),u=this.beginIndex.evaluate(o);if(!Ps(l,["string","array"]))throw new ts(`Expected first argument to be of type array or string, but found ${Cn(ur(l))} instead.`);if(this.endIndex){const f=this.endIndex.evaluate(o);return l.slice(u,f)}return l.slice(u)}eachChild(o){o(this.input),o(this.beginIndex),this.endIndex&&o(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const o=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),o]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var mh=Ir;function Up(a,o){return"=="===a||"!="===a?"boolean"===o.kind||"string"===o.kind||"number"===o.kind||"null"===o.kind||"value"===o.kind:"string"===o.kind||"number"===o.kind||"value"===o.kind}function os(a,o,l,u){return 0===u.compare(o,l)}function ss(a,o,l){const u="=="!==a&&"!="!==a;return class ZF{constructor(b,y,S){this.type=Ti,this.lhs=b,this.rhs=y,this.collator=S,this.hasUntypedArgument="value"===b.type.kind||"value"===y.type.kind}static parse(b,y){if(3!==b.length&&4!==b.length)return y.error("Expected two or three arguments.");const S=b[0];let T=y.parse(b[1],1,Zt);if(!T)return null;if(!Up(S,T.type))return y.concat(1).error(`"${S}" comparisons are not supported for type '${Cn(T.type)}'.`);let E=y.parse(b[2],2,Zt);if(!E)return null;if(!Up(S,E.type))return y.concat(2).error(`"${S}" comparisons are not supported for type '${Cn(E.type)}'.`);if(T.type.kind!==E.type.kind&&"value"!==T.type.kind&&"value"!==E.type.kind)return y.error(`Cannot compare types '${Cn(T.type)}' and '${Cn(E.type)}'.`);u&&("value"===T.type.kind&&"value"!==E.type.kind?T=new ln(E.type,[T]):"value"!==T.type.kind&&"value"===E.type.kind&&(E=new ln(T.type,[E])));let M=null;if(4===b.length){if("string"!==T.type.kind&&"string"!==E.type.kind&&"value"!==T.type.kind&&"value"!==E.type.kind)return y.error("Cannot use collator to compare non-string types.");if(M=y.parse(b[3],3,vc),!M)return null}return new ZF(T,E,M)}evaluate(b){const y=this.lhs.evaluate(b),S=this.rhs.evaluate(b);if(u&&this.hasUntypedArgument){const T=ur(y),E=ur(S);if(T.kind!==E.kind||"string"!==T.kind&&"number"!==T.kind)throw new ts(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${T.kind}, ${E.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const T=ur(y),E=ur(S);if("string"!==T.kind||"string"!==E.kind)return o(b,y,S)}return this.collator?l(b,y,S,this.collator.evaluate(b)):o(b,y,S)}eachChild(b){b(this.lhs),b(this.rhs),this.collator&&b(this.collator)}outputDefined(){return!0}serialize(){const b=[a];return this.eachChild(y=>{b.push(y.serialize())}),b}}}const Hp=ss("==",function(a,o,l){return o===l},os),gh=ss("!=",function(a,o,l){return o!==l},function(a,o,l,u){return!os(0,o,l,u)}),ed=ss("<",function(a,o,l){return o<l},function(a,o,l,u){return u.compare(o,l)<0}),pa=ss(">",function(a,o,l){return o>l},function(a,o,l,u){return u.compare(o,l)>0}),wm=ss("<=",function(a,o,l){return o<=l},function(a,o,l,u){return u.compare(o,l)<=0}),Sm=ss(">=",function(a,o,l){return o>=l},function(a,o,l,u){return u.compare(o,l)>=0});class $p{constructor(o,l,u,f,b,y){this.type=xn,this.number=o,this.locale=l,this.currency=u,this.unit=f,this.minFractionDigits=b,this.maxFractionDigits=y}static parse(o,l){if(3!==o.length)return l.error("Expected two arguments.");const u=l.parse(o[1],1,qt);if(!u)return null;const f=o[2];if("object"!=typeof f||Array.isArray(f))return l.error("NumberFormat options argument must be an object.");let b=null;if(f.locale&&(b=l.parse(f.locale,1,xn),!b))return null;let y=null;if(f.currency&&(y=l.parse(f.currency,1,xn),!y))return null;let S=null;if(f.unit&&(S=l.parse(f.unit,1,xn),!S))return null;let T=null;if(f["min-fraction-digits"]&&(T=l.parse(f["min-fraction-digits"],1,qt),!T))return null;let E=null;return f["max-fraction-digits"]&&(E=l.parse(f["max-fraction-digits"],1,qt),!E)?null:new $p(u,b,y,S,T,E)}evaluate(o){return new Intl.NumberFormat(this.locale?this.locale.evaluate(o):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(o):void 0,unit:this.unit?this.unit.evaluate(o):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(o):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(o):void 0}).format(this.number.evaluate(o))}eachChild(o){o(this.number),this.locale&&o(this.locale),this.currency&&o(this.currency),this.unit&&o(this.unit),this.minFractionDigits&&o(this.minFractionDigits),this.maxFractionDigits&&o(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const o={};return this.locale&&(o.locale=this.locale.serialize()),this.currency&&(o.currency=this.currency.serialize()),this.unit&&(o.unit=this.unit.serialize()),this.minFractionDigits&&(o["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(o["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),o]}}class Gp{constructor(o){this.type=qt,this.input=o}static parse(o,l){if(2!==o.length)return l.error(`Expected 1 argument, but found ${o.length-1} instead.`);const u=l.parse(o[1],1);return u?"array"!==u.type.kind&&"string"!==u.type.kind&&"value"!==u.type.kind?l.error(`Expected argument of type string or array, but found ${Cn(u.type)} instead.`):new Gp(u):null}evaluate(o){const l=this.input.evaluate(o);if("string"==typeof l||Array.isArray(l))return l.length;throw new ts(`Expected value to be of type string or array, but found ${Cn(ur(l))} instead.`)}eachChild(o){o(this.input)}outputDefined(){return!1}serialize(){const o=["length"];return this.eachChild(l=>{o.push(l.serialize())}),o}}const mb={"==":Hp,"!=":gh,">":pa,"<":ed,">=":Sm,"<=":wm,array:ln,at:Tc,boolean:ln,case:xm,coalesce:du,collator:Yn,format:el,image:Zu,in:Dc,"index-of":hu,interpolate:rs,"interpolate-hcl":rs,"interpolate-lab":rs,length:Gp,let:Mi,literal:lh,match:Ra,number:ln,"number-format":$p,object:ln,slice:mh,step:uu,string:ln,"to-boolean":xc,"to-color":xc,"to-number":xc,"to-string":xc,var:kn,within:Bi};function gb(a,[o,l,u,f]){o=o.evaluate(a),l=l.evaluate(a),u=u.evaluate(a);const b=f?f.evaluate(a):1,y=gm(o,l,u,b);if(y)throw new ts(y);return new uo(o/255*b,l/255*b,u/255*b,b)}function bb(a,o){return a in o}function Cm(a,o){const l=o[a];return void 0===l?null:l}function pu(a){return{type:a}}Ma.register(mb,{error:[{kind:"error"},[xn],(a,[o])=>{throw new ts(o.evaluate(a))}],typeof:[xn,[Zt],(a,[o])=>Cn(ur(o.evaluate(a)))],"to-rgba":[Jo(qt,4),[Ja],(a,[o])=>o.evaluate(a).toArray()],rgb:[Ja,[qt,qt,qt],gb],rgba:[Ja,[qt,qt,qt,qt],gb],has:{type:Ti,overloads:[[[xn],(a,[o])=>bb(o.evaluate(a),a.properties())],[[xn,Ri],(a,[o,l])=>bb(o.evaluate(a),l.evaluate(a))]]},get:{type:Zt,overloads:[[[xn],(a,[o])=>Cm(o.evaluate(a),a.properties())],[[xn,Ri],(a,[o,l])=>Cm(o.evaluate(a),l.evaluate(a))]]},"feature-state":[Zt,[xn],(a,[o])=>Cm(o.evaluate(a),a.featureState||{})],properties:[Ri,[],a=>a.properties()],"geometry-type":[xn,[],a=>a.geometryType()],id:[Zt,[],a=>a.id()],zoom:[qt,[],a=>a.globals.zoom],pitch:[qt,[],a=>a.globals.pitch||0],"distance-from-center":[qt,[],a=>a.distanceFromCenter()],"heatmap-density":[qt,[],a=>a.globals.heatmapDensity||0],"line-progress":[qt,[],a=>a.globals.lineProgress||0],"sky-radial-progress":[qt,[],a=>a.globals.skyRadialProgress||0],accumulated:[Zt,[],a=>void 0===a.globals.accumulated?null:a.globals.accumulated],"+":[qt,pu(qt),(a,o)=>{let l=0;for(const u of o)l+=u.evaluate(a);return l}],"*":[qt,pu(qt),(a,o)=>{let l=1;for(const u of o)l*=u.evaluate(a);return l}],"-":{type:qt,overloads:[[[qt,qt],(a,[o,l])=>o.evaluate(a)-l.evaluate(a)],[[qt],(a,[o])=>-o.evaluate(a)]]},"/":[qt,[qt,qt],(a,[o,l])=>o.evaluate(a)/l.evaluate(a)],"%":[qt,[qt,qt],(a,[o,l])=>o.evaluate(a)%l.evaluate(a)],ln2:[qt,[],()=>Math.LN2],pi:[qt,[],()=>Math.PI],e:[qt,[],()=>Math.E],"^":[qt,[qt,qt],(a,[o,l])=>Math.pow(o.evaluate(a),l.evaluate(a))],sqrt:[qt,[qt],(a,[o])=>Math.sqrt(o.evaluate(a))],log10:[qt,[qt],(a,[o])=>Math.log(o.evaluate(a))/Math.LN10],ln:[qt,[qt],(a,[o])=>Math.log(o.evaluate(a))],log2:[qt,[qt],(a,[o])=>Math.log(o.evaluate(a))/Math.LN2],sin:[qt,[qt],(a,[o])=>Math.sin(o.evaluate(a))],cos:[qt,[qt],(a,[o])=>Math.cos(o.evaluate(a))],tan:[qt,[qt],(a,[o])=>Math.tan(o.evaluate(a))],asin:[qt,[qt],(a,[o])=>Math.asin(o.evaluate(a))],acos:[qt,[qt],(a,[o])=>Math.acos(o.evaluate(a))],atan:[qt,[qt],(a,[o])=>Math.atan(o.evaluate(a))],min:[qt,pu(qt),(a,o)=>Math.min(...o.map(l=>l.evaluate(a)))],max:[qt,pu(qt),(a,o)=>Math.max(...o.map(l=>l.evaluate(a)))],abs:[qt,[qt],(a,[o])=>Math.abs(o.evaluate(a))],round:[qt,[qt],(a,[o])=>{const l=o.evaluate(a);return l<0?-Math.round(-l):Math.round(l)}],floor:[qt,[qt],(a,[o])=>Math.floor(o.evaluate(a))],ceil:[qt,[qt],(a,[o])=>Math.ceil(o.evaluate(a))],"filter-==":[Ti,[xn,Zt],(a,[o,l])=>a.properties()[o.value]===l.value],"filter-id-==":[Ti,[Zt],(a,[o])=>a.id()===o.value],"filter-type-==":[Ti,[xn],(a,[o])=>a.geometryType()===o.value],"filter-<":[Ti,[xn,Zt],(a,[o,l])=>{const u=a.properties()[o.value],f=l.value;return typeof u==typeof f&&u<f}],"filter-id-<":[Ti,[Zt],(a,[o])=>{const l=a.id(),u=o.value;return typeof l==typeof u&&l<u}],"filter->":[Ti,[xn,Zt],(a,[o,l])=>{const u=a.properties()[o.value],f=l.value;return typeof u==typeof f&&u>f}],"filter-id->":[Ti,[Zt],(a,[o])=>{const l=a.id(),u=o.value;return typeof l==typeof u&&l>u}],"filter-<=":[Ti,[xn,Zt],(a,[o,l])=>{const u=a.properties()[o.value],f=l.value;return typeof u==typeof f&&u<=f}],"filter-id-<=":[Ti,[Zt],(a,[o])=>{const l=a.id(),u=o.value;return typeof l==typeof u&&l<=u}],"filter->=":[Ti,[xn,Zt],(a,[o,l])=>{const u=a.properties()[o.value],f=l.value;return typeof u==typeof f&&u>=f}],"filter-id->=":[Ti,[Zt],(a,[o])=>{const l=a.id(),u=o.value;return typeof l==typeof u&&l>=u}],"filter-has":[Ti,[Zt],(a,[o])=>o.value in a.properties()],"filter-has-id":[Ti,[],a=>null!==a.id()&&void 0!==a.id()],"filter-type-in":[Ti,[Jo(xn)],(a,[o])=>o.value.indexOf(a.geometryType())>=0],"filter-id-in":[Ti,[Jo(Zt)],(a,[o])=>o.value.indexOf(a.id())>=0],"filter-in-small":[Ti,[xn,Jo(Zt)],(a,[o,l])=>l.value.indexOf(a.properties()[o.value])>=0],"filter-in-large":[Ti,[xn,Jo(Zt)],(a,[o,l])=>function(u,f,b,y){for(;b<=y;){const S=b+y>>1;if(f[S]===u)return!0;f[S]>u?y=S-1:b=S+1}return!1}(a.properties()[o.value],l.value,0,l.value.length-1)],all:{type:Ti,overloads:[[[Ti,Ti],(a,[o,l])=>o.evaluate(a)&&l.evaluate(a)],[pu(Ti),(a,o)=>{for(const l of o)if(!l.evaluate(a))return!1;return!0}]]},any:{type:Ti,overloads:[[[Ti,Ti],(a,[o,l])=>o.evaluate(a)||l.evaluate(a)],[pu(Ti),(a,o)=>{for(const l of o)if(l.evaluate(a))return!0;return!1}]]},"!":[Ti,[Ti],(a,[o])=>!o.evaluate(a)],"is-supported-script":[Ti,[xn],(a,[o])=>{const l=a.globals&&a.globals.isSupportedScript;return!l||l(o.evaluate(a))}],upcase:[xn,[xn],(a,[o])=>o.evaluate(a).toUpperCase()],downcase:[xn,[xn],(a,[o])=>o.evaluate(a).toLowerCase()],concat:[xn,pu(Zt),(a,o)=>o.map(l=>Ki(l.evaluate(a))).join("")],"resolved-locale":[xn,[vc],(a,[o])=>o.evaluate(a).resolvedLocale()]});var td=mb;function Tm(a){return{result:"success",value:a}}function Zl(a){return{result:"error",value:a}}function nd(a){return"data-driven"===a["property-type"]||"cross-faded-data-driven"===a["property-type"]}function _b(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function Cl(a){return!!a.expression&&a.expression.interpolated}function er(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":null===a?"null":typeof a}function Yl(a){return"object"==typeof a&&null!==a&&!Array.isArray(a)}function dv(a){return a}function qp(a,o){const l="color"===o.type,u=a.stops&&"object"==typeof a.stops[0][0],f=u||!(u||void 0!==a.property),b=a.type||(Cl(o)?"exponential":"interval");if(l&&((a=Ka({},a)).stops&&(a.stops=a.stops.map(E=>[E[0],uo.parse(E[1])])),a.default=uo.parse(a.default?a.default:o.default)),a.colorSpace&&"rgb"!==a.colorSpace&&!Ls[a.colorSpace])throw new Error(`Unknown color space: ${a.colorSpace}`);let y,S,T;if("exponential"===b)y=Em;else if("interval"===b)y=Dm;else if("categorical"===b){y=hv,S=Object.create(null);for(const E of a.stops)S[E[0]]=E[1];T=typeof a.stops[0][0]}else{if("identity"!==b)throw new Error(`Unknown function type "${b}"`);y=Tl}if(u){const E={},M=[];for(let B=0;B<a.stops.length;B++){const V=a.stops[B],G=V[0].zoom;void 0===E[G]&&(E[G]={zoom:G,type:a.type,property:a.property,default:a.default,stops:[]},M.push(G)),E[G].stops.push([V[0].value,V[1]])}const P=[];for(const B of M)P.push([E[B].zoom,qp(E[B],o)]);const O={name:"linear"};return{kind:"composite",interpolationType:O,interpolationFactor:rs.interpolationFactor.bind(void 0,O),zoomStops:P.map(B=>B[0]),evaluate:({zoom:B},V)=>Em({stops:P,base:a.base},o,B).evaluate(B,V)}}if(f){const E="exponential"===b?{name:"exponential",base:void 0!==a.base?a.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:rs.interpolationFactor.bind(void 0,E),zoomStops:a.stops.map(M=>M[0]),evaluate:({zoom:M})=>y(a,o,M,S,T)}}return{kind:"source",evaluate(E,M){const P=M&&M.properties?M.properties[a.property]:void 0;return void 0===P?Ql(a.default,o.default):y(a,o,P,S,T)}}}function Ql(a,o,l){return void 0!==a?a:void 0!==o?o:void 0!==l?l:void 0}function hv(a,o,l,u,f){return Ql(typeof l===f?u[l]:void 0,a.default,o.default)}function Dm(a,o,l){if("number"!==er(l))return Ql(a.default,o.default);const u=a.stops.length;if(1===u||l<=a.stops[0][0])return a.stops[0][1];if(l>=a.stops[u-1][0])return a.stops[u-1][1];const f=Qu(a.stops.map(b=>b[0]),l);return a.stops[f][1]}function Em(a,o,l){const u=void 0!==a.base?a.base:1;if("number"!==er(l))return Ql(a.default,o.default);const f=a.stops.length;if(1===f||l<=a.stops[0][0])return a.stops[0][1];if(l>=a.stops[f-1][0])return a.stops[f-1][1];const b=Qu(a.stops.map(M=>M[0]),l),y=function(M,P,O,B){const V=B-O,G=M-O;return 0===V?0:1===P?G/V:(Math.pow(P,G)-1)/(Math.pow(P,V)-1)}(l,u,a.stops[b][0],a.stops[b+1][0]),S=a.stops[b][1],T=a.stops[b+1][1];let E=vt[o.type]||dv;if(a.colorSpace&&"rgb"!==a.colorSpace){const M=Ls[a.colorSpace];E=(P,O)=>M.reverse(M.interpolate(M.forward(P),M.forward(O),y))}return"function"==typeof S.evaluate?{evaluate(...M){const P=S.evaluate.apply(void 0,M),O=T.evaluate.apply(void 0,M);if(void 0!==P&&void 0!==O)return E(P,O,y)}}:E(S,T,y)}function Tl(a,o,l){return"color"===o.type?l=uo.parse(l):"formatted"===o.type?l=Ss.fromString(l.toString()):"resolvedImage"===o.type?l=Hs.fromString(l.toString()):er(l)===o.type||"enum"===o.type&&o.values[l]||(l=void 0),Ql(l,a.default,o.default)}class id{constructor(o,l){var u;this.expression=o,this._warningHistory={},this._evaluator=new uh,this._defaultValue=l?"color"===(u=l).type&&(Yl(u.default)||Array.isArray(u.default))?new uo(0,0,0,0):"color"===u.type?uo.parse(u.default)||null:void 0===u.default?null:u.default:null,this._enumValues=l&&"enum"===l.type?l.values:null}evaluateWithoutErrorHandling(o,l,u,f,b,y,S,T){return this._evaluator.globals=o,this._evaluator.feature=l,this._evaluator.featureState=u,this._evaluator.canonical=f||null,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=y,this._evaluator.featureTileCoord=S||null,this._evaluator.featureDistanceData=T||null,this.expression.evaluate(this._evaluator)}evaluate(o,l,u,f,b,y,S,T){this._evaluator.globals=o,this._evaluator.feature=l||null,this._evaluator.featureState=u||null,this._evaluator.canonical=f||null,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=y||null,this._evaluator.featureTileCoord=S||null,this._evaluator.featureDistanceData=T||null;try{const E=this.expression.evaluate(this._evaluator);if(null==E||"number"==typeof E&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new ts(`Expected value to be one of ${Object.keys(this._enumValues).map(M=>JSON.stringify(M)).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,"undefined"!=typeof console&&console.warn(E.message)),this._defaultValue}}}function dr(a){return Array.isArray(a)&&a.length>0&&"string"==typeof a[0]&&a[0]in td}function Kl(a,o){const l=new ph(td,[],o?function(f){const b={color:Ja,string:xn,number:qt,enum:xn,boolean:Ti,formatted:Wu,resolvedImage:Dt};return"array"===f.type?Jo(b[f.value]||Zt,f.length):b[f.type]}(o):void 0),u=l.parse(a,void 0,void 0,void 0,o&&"string"===o.type?{typeAnnotation:"coerce"}:void 0);return u?Tm(new id(u,o)):Zl(l.errors)}class bh{constructor(o,l){this.kind=o,this._styleExpression=l,this.isStateDependent="constant"!==o&&!ha(l.expression)}evaluateWithoutErrorHandling(o,l,u,f,b,y){return this._styleExpression.evaluateWithoutErrorHandling(o,l,u,f,b,y)}evaluate(o,l,u,f,b,y){return this._styleExpression.evaluate(o,l,u,f,b,y)}}class _h{constructor(o,l,u,f){this.kind=o,this.zoomStops=u,this._styleExpression=l,this.isStateDependent="camera"!==o&&!ha(l.expression),this.interpolationType=f}evaluateWithoutErrorHandling(o,l,u,f,b,y){return this._styleExpression.evaluateWithoutErrorHandling(o,l,u,f,b,y)}evaluate(o,l,u,f,b,y){return this._styleExpression.evaluate(o,l,u,f,b,y)}interpolationFactor(o,l,u){return this.interpolationType?rs.interpolationFactor(this.interpolationType,o,l,u):0}}function fu(a,o){if("error"===(a=Kl(a,o)).result)return a;const l=a.value.expression,u=cu(l);if(!u&&!nd(o))return Zl([new rr("","data expressions not supported")]);const f=ql(l,["zoom","pitch","distance-from-center"]);if(!f&&!_b(o))return Zl([new rr("","zoom expressions not supported")]);const b=rd(l);return b||f?b instanceof rr?Zl([b]):b instanceof rs&&!Cl(o)?Zl([new rr("",'"interpolate" expressions cannot be used with this property')]):Tm(b?new _h(u?"camera":"composite",a.value,b.labels,b instanceof rs?b.interpolation:void 0):new bh(u?"constant":"source",a.value)):Zl([new rr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class il{constructor(o,l){this._parameters=o,this._specification=l,Ka(this,qp(this._parameters,this._specification))}static deserialize(o){return new il(o._parameters,o._specification)}static serialize(o){return{_parameters:o._parameters,_specification:o._specification}}}function rd(a){let o=null;if(a instanceof Mi)o=rd(a.result);else if(a instanceof du){for(const l of a.args)if(o=rd(l),o)break}else(a instanceof uu||a instanceof rs)&&a.input instanceof Ma&&"zoom"===a.input.name&&(o=a);return o instanceof rr||a.eachChild(l=>{const u=rd(l);u instanceof rr?o=u:!o&&u?o=new rr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):o&&u&&o!==u&&(o=new rr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),o}class Kt{constructor(o,l,u,f){this.message=(o?`${o}: `:"")+u,f&&(this.identifier=f),null!=l&&l.__line__&&(this.line=l.__line__)}}function Ws(a){const o=a.key,l=a.value,u=a.valueSpec||{},f=a.objectElementValidators||{},b=a.style,y=a.styleSpec;let S=[];const T=er(l);if("object"!==T)return[new Kt(o,l,`object expected, ${T} found`)];for(const E in l){const M=E.split(".")[0],P=u[M]||u["*"];let O;f[M]?O=f[M]:u[M]?O=Wi:f["*"]?O=f["*"]:u["*"]&&(O=Wi),O?S=S.concat(O({key:(o&&`${o}.`)+E,value:l[E],valueSpec:P,style:b,styleSpec:y,object:l,objectKey:E},l)):S.push(new Kt(o,l[E],`unknown property "${E}"`))}for(const E in u)f[E]||u[E].required&&void 0===u[E].default&&void 0===l[E]&&S.push(new Kt(o,l,`missing required property "${E}"`));return S}function Fs(a){const o=a.value,l=a.valueSpec,u=a.style,f=a.styleSpec,b=a.key,y=a.arrayElementValidator||Wi;if("array"!==er(o))return[new Kt(b,o,`array expected, ${er(o)} found`)];if(l.length&&o.length!==l.length)return[new Kt(b,o,`array length ${l.length} expected, length ${o.length} found`)];if(l["min-length"]&&o.length<l["min-length"])return[new Kt(b,o,`array length at least ${l["min-length"]} expected, length ${o.length} found`)];let S={type:l.value,values:l.values,minimum:l.minimum,maximum:l.maximum,function:void 0};f.$version<7&&(S.function=l.function),"object"===er(l.value)&&(S=l.value);let T=[];for(let E=0;E<o.length;E++)T=T.concat(y({array:o,arrayIndex:E,value:o[E],valueSpec:S,style:u,styleSpec:f,key:`${b}[${E}]`}));return T}function yh(a){const o=a.key,l=a.value,u=a.valueSpec;let f=er(l);if("number"===f&&l!=l&&(f="NaN"),"number"!==f)return[new Kt(o,l,`number expected, ${f} found`)];if("minimum"in u){let b=u.minimum;if("array"===er(u.minimum)&&(b=u.minimum[a.arrayIndex]),l<b)return[new Kt(o,l,`${l} is less than the minimum value ${b}`)]}if("maximum"in u){let b=u.maximum;if("array"===er(u.maximum)&&(b=u.maximum[a.arrayIndex]),l>b)return[new Kt(o,l,`${l} is greater than the maximum value ${b}`)]}return[]}function Wp(a){const o=a.valueSpec,l=co(a.value.type);let u,f,b,y={};const S="categorical"!==l&&void 0===a.value.property,T=!S,E="array"===er(a.value.stops)&&"array"===er(a.value.stops[0])&&"object"===er(a.value.stops[0][0]),M=Ws({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(B){if("identity"===l)return[new Kt(B.key,B.value,'identity function may not have a "stops" property')];let V=[];const G=B.value;return V=V.concat(Fs({key:B.key,value:G,valueSpec:B.valueSpec,style:B.style,styleSpec:B.styleSpec,arrayElementValidator:P})),"array"===er(G)&&0===G.length&&V.push(new Kt(B.key,G,"array must have at least one stop")),V},default:function(B){return Wi({key:B.key,value:B.value,valueSpec:o,style:B.style,styleSpec:B.styleSpec})}}});return"identity"===l&&S&&M.push(new Kt(a.key,a.value,'missing required property "property"')),"identity"===l||a.value.stops||M.push(new Kt(a.key,a.value,'missing required property "stops"')),"exponential"===l&&a.valueSpec.expression&&!Cl(a.valueSpec)&&M.push(new Kt(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(T&&!nd(a.valueSpec)?M.push(new Kt(a.key,a.value,"property functions not supported")):S&&!_b(a.valueSpec)&&M.push(new Kt(a.key,a.value,"zoom functions not supported"))),"categorical"!==l&&!E||void 0!==a.value.property||M.push(new Kt(a.key,a.value,'"property" property is required')),M;function P(B){let V=[];const G=B.value,Z=B.key;if("array"!==er(G))return[new Kt(Z,G,`array expected, ${er(G)} found`)];if(2!==G.length)return[new Kt(Z,G,`array length 2 expected, length ${G.length} found`)];if(E){if("object"!==er(G[0]))return[new Kt(Z,G,`object expected, ${er(G[0])} found`)];if(void 0===G[0].zoom)return[new Kt(Z,G,"object stop key must have zoom")];if(void 0===G[0].value)return[new Kt(Z,G,"object stop key must have value")];const ce=co(G[0].zoom);if("number"!=typeof ce)return[new Kt(Z,G[0].zoom,"stop zoom values must be numbers")];if(b&&b>ce)return[new Kt(Z,G[0].zoom,"stop zoom values must appear in ascending order")];ce!==b&&(b=ce,f=void 0,y={}),V=V.concat(Ws({key:`${Z}[0]`,value:G[0],valueSpec:{zoom:{}},style:B.style,styleSpec:B.styleSpec,objectElementValidators:{zoom:yh,value:O}}))}else V=V.concat(O({key:`${Z}[0]`,value:G[0],valueSpec:{},style:B.style,styleSpec:B.styleSpec},G));return dr(Hl(G[1]))?V.concat([new Kt(`${Z}[1]`,G[1],"expressions are not allowed in function stops.")]):V.concat(Wi({key:`${Z}[1]`,value:G[1],valueSpec:o,style:B.style,styleSpec:B.styleSpec}))}function O(B,V){const G=er(B.value),Z=co(B.value),ce=null!==B.value?B.value:V;if(u){if(G!==u)return[new Kt(B.key,ce,`${G} stop domain type must match previous stop domain type ${u}`)]}else u=G;if("number"!==G&&"string"!==G&&"boolean"!==G&&"number"!=typeof Z&&"string"!=typeof Z&&"boolean"!=typeof Z)return[new Kt(B.key,ce,"stop domain value must be a number, string, or boolean")];if("number"!==G&&"categorical"!==l){let ye=`number expected, ${G} found`;return nd(o)&&void 0===l&&(ye+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Kt(B.key,ce,ye)]}return"categorical"!==l||"number"!==G||"number"==typeof Z&&isFinite(Z)&&Math.floor(Z)===Z?"categorical"!==l&&"number"===G&&"number"==typeof Z&&"number"==typeof f&&void 0!==f&&Z<f?[new Kt(B.key,ce,"stop domain values must appear in ascending order")]:(f=Z,"categorical"===l&&Z in y?[new Kt(B.key,ce,"stop domain values must be unique")]:(y[Z]=!0,[])):[new Kt(B.key,ce,`integer expected, found ${String(Z)}`)]}}function Pa(a){const o=("property"===a.expressionContext?fu:Kl)(Hl(a.value),a.valueSpec);if("error"===o.result)return o.value.map(u=>new Kt(`${a.key}${u.key}`,a.value,u.message));const l=o.value.expression||o.value._styleExpression.expression;if("property"===a.expressionContext&&"text-font"===a.propertyKey&&!l.outputDefined())return[new Kt(a.key,a.value,`Invalid data expression for "${a.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===a.expressionContext&&"layout"===a.propertyType&&!ha(l))return[new Kt(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===a.expressionContext)return Im(l,a);if(a.expressionContext&&0===a.expressionContext.indexOf("cluster")){if(!ql(l,["zoom","feature-state"]))return[new Kt(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===a.expressionContext&&!cu(l))return[new Kt(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Im(a,o){const l=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(o.valueSpec&&o.valueSpec.expression)for(const f of o.valueSpec.expression.parameters)l.delete(f);if(0===l.size)return[];const u=[];return a instanceof Ma&&l.has(a.name)?[new Kt(o.key,o.value,`["${a.name}"] expression is not supported in a filter for a ${o.object.type} layer with id: ${o.object.id}`)]:(a.eachChild(f=>{u.push(...Im(f,o))}),u)}function Xp(a){const o=a.key,l=a.value,u=a.valueSpec,f=[];return Array.isArray(u.values)?-1===u.values.indexOf(co(l))&&f.push(new Kt(o,l,`expected one of [${u.values.join(", ")}], ${JSON.stringify(l)} found`)):-1===Object.keys(u.values).indexOf(co(l))&&f.push(new Kt(o,l,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(l)} found`)),f}function to(a){if(!0===a||!1===a)return!0;if(!Array.isArray(a)||0===a.length)return!1;switch(a[0]){case"has":return a.length>=2&&"$id"!==a[1]&&"$type"!==a[1];case"in":return a.length>=3&&("string"!=typeof a[1]||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==a.length||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const o of a.slice(1))if(!to(o)&&"boolean"!=typeof o)return!1;return!0;default:return!0}}function vh(a,o="fill"){if(null==a)return{filter:()=>!0,needGeometry:!1,needFeature:!1};to(a)||(a=as(a));const l=a;let u=!0;try{u=function(E){if(!wo(E))return E;let M=Hl(E);return Jl(M),M=yb(M),M}(l)}catch(E){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(l,null,2)}\n        `)}const f=ct[`filter_${o}`],b=Kl(u,f);let y=null;if("error"===b.result)throw new Error(b.value.map(E=>`${E.key}: ${E.message}`).join(", "));y=(E,M,P)=>b.value.evaluate(E,M,{},P);let S=null,T=null;if(u!==l){const E=Kl(l,f);if("error"===E.result)throw new Error(E.value.map(M=>`${M.key}: ${M.message}`).join(", "));S=(M,P,O,B,V)=>E.value.evaluate(M,P,{},O,void 0,void 0,B,V),T=!cu(E.value.expression)}return{filter:y,dynamicFilter:S||void 0,needGeometry:Ec(u),needFeature:!!T}}function yb(a){if(!Array.isArray(a))return a;const o=function(l){if(Xs.has(l[0]))for(let u=1;u<l.length;u++)if(wo(l[u]))return!0;return l}(a);return!0===o?o:o.map(l=>yb(l))}function Jl(a){let o=!1;const l=[];if("case"===a[0]){for(let u=1;u<a.length-1;u+=2)o=o||wo(a[u]),l.push(a[u+1]);l.push(a[a.length-1])}else if("match"===a[0]){o=o||wo(a[1]);for(let u=2;u<a.length-1;u+=2)l.push(a[u+1]);l.push(a[a.length-1])}else if("step"===a[0]){o=o||wo(a[1]);for(let u=1;u<a.length-1;u+=2)l.push(a[u+1])}o&&(a.length=0,a.push("any",...l));for(let u=1;u<a.length;u++)Jl(a[u])}function wo(a){if(!Array.isArray(a))return!1;if("pitch"===(o=a[0])||"distance-from-center"===o)return!0;var o;for(let l=1;l<a.length;l++)if(wo(a[l]))return!0;return!1}const Xs=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function mu(a,o){return a<o?-1:a>o?1:0}function Ec(a){if(!Array.isArray(a))return!1;if("within"===a[0])return!0;for(let o=1;o<a.length;o++)if(Ec(a[o]))return!0;return!1}function as(a){if(!a)return!0;const o=a[0];return a.length<=1?"any"!==o:"=="===o?xh(a[1],a[2],"=="):"!="===o?Oa(xh(a[1],a[2],"==")):"<"===o||">"===o||"<="===o||">="===o?xh(a[1],a[2],o):"any"===o?(l=a.slice(1),["any"].concat(l.map(as))):"all"===o?["all"].concat(a.slice(1).map(as)):"none"===o?["all"].concat(a.slice(1).map(as).map(Oa)):"in"===o?wh(a[1],a.slice(2)):"!in"===o?Oa(wh(a[1],a.slice(2))):"has"===o?Sh(a[1]):"!has"===o?Oa(Sh(a[1])):"within"!==o||a;var l}function xh(a,o,l){switch(a){case"$type":return[`filter-type-${l}`,o];case"$id":return[`filter-id-${l}`,o];default:return[`filter-${l}`,a,o]}}function wh(a,o){if(0===o.length)return!1;switch(a){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(l=>typeof l!=typeof o[0])?["filter-in-large",a,["literal",o.sort(mu)]]:["filter-in-small",a,["literal",o]]}}function Sh(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function Oa(a){return["!",a]}function gu(a){return to(Hl(a.value))?Pa(Ka({},a,{expressionContext:"filter",valueSpec:a.styleSpec[`filter_${a.layerType||"fill"}`]})):Ch(a)}function Ch(a){const o=a.value,l=a.key;if("array"!==er(o))return[new Kt(l,o,`array expected, ${er(o)} found`)];const u=a.styleSpec;let f,b=[];if(o.length<1)return[new Kt(l,o,"filter array must have at least 1 element")];switch(b=b.concat(Xp({key:`${l}[0]`,value:o[0],valueSpec:u.filter_operator,style:a.style,styleSpec:a.styleSpec})),co(o[0])){case"<":case"<=":case">":case">=":o.length>=2&&"$type"===co(o[1])&&b.push(new Kt(l,o,`"$type" cannot be use with operator "${o[0]}"`));case"==":case"!=":3!==o.length&&b.push(new Kt(l,o,`filter array for operator "${o[0]}" must have 3 elements`));case"in":case"!in":o.length>=2&&(f=er(o[1]),"string"!==f&&b.push(new Kt(`${l}[1]`,o[1],`string expected, ${f} found`)));for(let y=2;y<o.length;y++)f=er(o[y]),"$type"===co(o[1])?b=b.concat(Xp({key:`${l}[${y}]`,value:o[y],valueSpec:u.geometry_type,style:a.style,styleSpec:a.styleSpec})):"string"!==f&&"number"!==f&&"boolean"!==f&&b.push(new Kt(`${l}[${y}]`,o[y],`string, number, or boolean expected, ${f} found`));break;case"any":case"all":case"none":for(let y=1;y<o.length;y++)b=b.concat(Ch({key:`${l}[${y}]`,value:o[y],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":f=er(o[1]),2!==o.length?b.push(new Kt(l,o,`filter array for "${o[0]}" operator must have 2 elements`)):"string"!==f&&b.push(new Kt(`${l}[1]`,o[1],`string expected, ${f} found`));break;case"within":f=er(o[1]),2!==o.length?b.push(new Kt(l,o,`filter array for "${o[0]}" operator must have 2 elements`)):"object"!==f&&b.push(new Kt(`${l}[1]`,o[1],`object expected, ${f} found`))}return b}function Ci(a,o){const l=a.key,u=a.style,f=a.styleSpec,b=a.value,y=a.objectKey,S=f[`${o}_${a.layerType}`];if(!S)return[];const T=y.match(/^(.*)-transition$/);if("paint"===o&&T&&S[T[1]]&&S[T[1]].transition)return Wi({key:l,value:b,valueSpec:f.transition,style:u,styleSpec:f});const E=a.valueSpec||S[y];if(!E)return[new Kt(l,b,`unknown property "${y}"`)];let M;if("string"===er(b)&&nd(E)&&!E.tokens&&(M=/^{([^}]+)}$/.exec(b)))return[new Kt(l,b,`"${y}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(M[1])} }\`.`)];const P=[];return"symbol"===a.layerType&&("text-field"===y&&u&&!u.glyphs&&P.push(new Kt(l,b,'use of "text-field" requires a style "glyphs" property')),"text-font"===y&&Yl(Hl(b))&&"identity"===co(b.type)&&P.push(new Kt(l,b,'"text-font" does not support identity functions'))),P.concat(Wi({key:a.key,value:b,valueSpec:E,style:u,styleSpec:f,expressionContext:"property",propertyType:o,propertyKey:y}))}function od(a){return Ci(a,"paint")}function vb(a){return Ci(a,"layout")}function Zp(a){let o=[];const l=a.value,u=a.key,f=a.style,b=a.styleSpec;l.type||l.ref||o.push(new Kt(u,l,'either "type" or "ref" is required'));let y=co(l.type);const S=co(l.ref);if(l.id){const T=co(l.id);for(let E=0;E<a.arrayIndex;E++){const M=f.layers[E];co(M.id)===T&&o.push(new Kt(u,l.id,`duplicate layer id "${l.id}", previously used at line ${M.id.__line__}`))}}if("ref"in l){let T;["type","source","source-layer","filter","layout"].forEach(E=>{E in l&&o.push(new Kt(u,l[E],`"${E}" is prohibited for ref layers`))}),f.layers.forEach(E=>{co(E.id)===S&&(T=E)}),T?T.ref?o.push(new Kt(u,l.ref,"ref cannot reference another ref layer")):y=co(T.type):"string"==typeof S&&o.push(new Kt(u,l.ref,`ref layer "${S}" not found`))}else if("background"!==y&&"sky"!==y)if(l.source){const T=f.sources&&f.sources[l.source],E=T&&co(T.type);T?"vector"===E&&"raster"===y?o.push(new Kt(u,l.source,`layer "${l.id}" requires a raster source`)):"raster"===E&&"raster"!==y?o.push(new Kt(u,l.source,`layer "${l.id}" requires a vector source`)):"vector"!==E||l["source-layer"]?"raster-dem"===E&&"hillshade"!==y?o.push(new Kt(u,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==y||!l.paint||!l.paint["line-gradient"]&&!l.paint["line-trim-offset"]||"geojson"===E&&T.lineMetrics||o.push(new Kt(u,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):o.push(new Kt(u,l,`layer "${l.id}" must specify a "source-layer"`)):o.push(new Kt(u,l.source,`source "${l.source}" not found`))}else o.push(new Kt(u,l,'missing required property "source"'));return o=o.concat(Ws({key:u,value:l,valueSpec:b.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Wi({key:`${u}.type`,value:l.type,valueSpec:b.layer.type,style:a.style,styleSpec:a.styleSpec,object:l,objectKey:"type"}),filter:T=>gu(Ka({layerType:y},T)),layout:T=>Ws({layer:l,key:T.key,value:T.value,valueSpec:{},style:T.style,styleSpec:T.styleSpec,objectElementValidators:{"*":E=>vb(Ka({layerType:y},E))}}),paint:T=>Ws({layer:l,key:T.key,value:T.value,valueSpec:{},style:T.style,styleSpec:T.styleSpec,objectElementValidators:{"*":E=>od(Ka({layerType:y},E))}})}})),o}function Ic(a){const o=a.value,l=a.key,u=er(o);return"string"!==u?[new Kt(l,o,`string expected, ${u} found`)]:[]}const Mm={promoteId:function({key:a,value:o}){if("string"===er(o))return Ic({key:a,value:o});{const l=[];for(const u in o)l.push(...Ic({key:`${a}.${u}`,value:o[u]}));return l}}};function sd(a){const o=a.value,l=a.key,u=a.styleSpec,f=a.style;if(!o.type)return[new Kt(l,o,'"type" is required')];const b=co(o.type);let y;switch(b){case"vector":case"raster":case"raster-dem":return y=Ws({key:l,value:o,valueSpec:u[`source_${b.replace("-","_")}`],style:a.style,styleSpec:u,objectElementValidators:Mm}),y;case"geojson":if(y=Ws({key:l,value:o,valueSpec:u.source_geojson,style:f,styleSpec:u,objectElementValidators:Mm}),o.cluster)for(const S in o.clusterProperties){const[T,E]=o.clusterProperties[S],M="string"==typeof T?[T,["accumulated"],["get",S]]:T;y.push(...Pa({key:`${l}.${S}.map`,value:E,expressionContext:"cluster-map"})),y.push(...Pa({key:`${l}.${S}.reduce`,value:M,expressionContext:"cluster-reduce"}))}return y;case"video":return Ws({key:l,value:o,valueSpec:u.source_video,style:f,styleSpec:u});case"image":return Ws({key:l,value:o,valueSpec:u.source_image,style:f,styleSpec:u});case"canvas":return[new Kt(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Xp({key:`${l}.type`,value:o.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:f,styleSpec:u})}}function ad(a){const o=a.value,l=a.styleSpec,u=l.light,f=a.style;let b=[];const y=er(o);if(void 0===o)return b;if("object"!==y)return b=b.concat([new Kt("light",o,`object expected, ${y} found`)]),b;for(const S in o){const T=S.match(/^(.*)-transition$/);b=b.concat(T&&u[T[1]]&&u[T[1]].transition?Wi({key:S,value:o[S],valueSpec:l.transition,style:f,styleSpec:l}):u[S]?Wi({key:S,value:o[S],valueSpec:u[S],style:f,styleSpec:l}):[new Kt(S,o[S],`unknown property "${S}"`)])}return b}function Yp(a){const o=a.value,l=a.key,u=a.style,f=a.styleSpec,b=f.terrain;let y=[];const S=er(o);if(void 0===o)return y;if("object"!==S)return y=y.concat([new Kt("terrain",o,`object expected, ${S} found`)]),y;for(const T in o){const E=T.match(/^(.*)-transition$/);y=y.concat(E&&b[E[1]]&&b[E[1]].transition?Wi({key:T,value:o[T],valueSpec:f.transition,style:u,styleSpec:f}):b[T]?Wi({key:T,value:o[T],valueSpec:b[T],style:u,styleSpec:f}):[new Kt(T,o[T],`unknown property "${T}"`)])}if(o.source){const T=u.sources&&u.sources[o.source],E=T&&co(T.type);T?"raster-dem"!==E&&y.push(new Kt(l,o.source,`terrain cannot be used with a source of type ${String(E)}, it only be used with a "raster-dem" source type`)):y.push(new Kt(l,o.source,`source "${o.source}" not found`))}else y.push(new Kt(l,o,'terrain is missing required property "source"'));return y}function Ot(a){const o=a.value,l=a.style,u=a.styleSpec,f=u.fog;let b=[];const y=er(o);if(void 0===o)return b;if("object"!==y)return b=b.concat([new Kt("fog",o,`object expected, ${y} found`)]),b;for(const S in o){const T=S.match(/^(.*)-transition$/);b=b.concat(T&&f[T[1]]&&f[T[1]].transition?Wi({key:S,value:o[S],valueSpec:u.transition,style:l,styleSpec:u}):f[S]?Wi({key:S,value:o[S],valueSpec:f[S],style:l,styleSpec:u}):[new Kt(S,o[S],`unknown property "${S}"`)])}return b}const ji={"*":()=>[],array:Fs,boolean:function(a){const o=a.value,l=a.key,u=er(o);return"boolean"!==u?[new Kt(l,o,`boolean expected, ${u} found`)]:[]},number:yh,color:function(a){const o=a.key,l=a.value,u=er(l);return"string"!==u?[new Kt(o,l,`color expected, ${u} found`)]:null===ou(l)?[new Kt(o,l,`color expected, "${l}" found`)]:[]},enum:Xp,filter:gu,function:Wp,layer:Zp,object:Ws,source:sd,light:ad,terrain:Yp,fog:Ot,string:Ic,formatted:function(a){return 0===Ic(a).length?[]:Pa(a)},resolvedImage:function(a){return 0===Ic(a).length?[]:Pa(a)},projection:function(a){const o=a.value,l=a.styleSpec,u=l.projection,f=a.style;let b=[];const y=er(o);if("object"===y)for(const S in o)b=b.concat(Wi({key:S,value:o[S],valueSpec:u[S],style:f,styleSpec:l}));else"string"!==y&&(b=b.concat([new Kt("projection",o,`object or string expected, ${y} found`)]));return b}};function Wi(a){const o=a.value,l=a.valueSpec,u=a.styleSpec;return l.expression&&Yl(co(o))?Wp(a):l.expression&&dr(Hl(o))?Pa(a):l.type&&ji[l.type]?ji[l.type](a):Ws(Ka({},a,{valueSpec:l.type?u[l.type]:l}))}function no(a){const o=a.value,l=a.key,u=Ic(a);return u.length||(-1===o.indexOf("{fontstack}")&&u.push(new Kt(l,o,'"glyphs" url must include a "{fontstack}" token')),-1===o.indexOf("{range}")&&u.push(new Kt(l,o,'"glyphs" url must include a "{range}" token'))),u}function So(a,o=ct){return Fo(Wi({key:"",value:a,valueSpec:o.$root,styleSpec:o,style:a,objectElementValidators:{glyphs:no,"*":()=>[]}}))}const Am=a=>Fo(od(a)),ld=a=>Fo(vb(a));function Fo(a){return a.slice().sort((o,l)=>o.line&&l.line?o.line-l.line:0)}function cd(a,o){let l=!1;if(o&&o.length)for(const u of o)a.fire(new Ul(new Error(u.message))),l=!0;return l}var ec=Dl;function Dl(a,o,l){var u=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var f=new Int32Array(this.arrayBuffer);a=f[0],this.d=(o=f[1])+2*(l=f[2]);for(var b=0;b<this.d*this.d;b++){var y=f[3+b],S=f[3+b+1];u.push(y===S?null:f.subarray(y,S))}var T=f[3+u.length+1];this.keys=f.subarray(f[3+u.length],T),this.bboxes=f.subarray(T),this.insert=this._insertReadonly}else{this.d=o+2*l;for(var E=0;E<this.d*this.d;E++)u.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=a,this.padding=l,this.scale=o/a,this.uid=0;var M=l/o*a;this.min=-M,this.max=a+M}Dl.prototype.insert=function(a,o,l,u,f){this._forEachCell(o,l,u,f,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(o),this.bboxes.push(l),this.bboxes.push(u),this.bboxes.push(f)},Dl.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Dl.prototype._insertCell=function(a,o,l,u,f,b){this.cells[f].push(b)},Dl.prototype.query=function(a,o,l,u,f){var b=this.min,y=this.max;if(a<=b&&o<=b&&y<=l&&y<=u&&!f)return Array.prototype.slice.call(this.keys);var S=[];return this._forEachCell(a,o,l,u,this._queryCell,S,{},f),S},Dl.prototype._queryCell=function(a,o,l,u,f,b,y,S){var T=this.cells[f];if(null!==T)for(var E=this.keys,M=this.bboxes,P=0;P<T.length;P++){var O=T[P];if(void 0===y[O]){var B=4*O;(S?S(M[B+0],M[B+1],M[B+2],M[B+3]):a<=M[B+2]&&o<=M[B+3]&&l>=M[B+0]&&u>=M[B+1])?(y[O]=!0,b.push(E[O])):y[O]=!1}}},Dl.prototype._forEachCell=function(a,o,l,u,f,b,y,S){for(var T=this._convertToCellCoord(a),E=this._convertToCellCoord(o),M=this._convertToCellCoord(l),P=this._convertToCellCoord(u),O=T;O<=M;O++)for(var B=E;B<=P;B++){var V=this.d*B+O;if((!S||S(this._convertFromCellCoord(O),this._convertFromCellCoord(B),this._convertFromCellCoord(O+1),this._convertFromCellCoord(B+1)))&&f.call(this,a,o,l,u,V,b,y,S))return}},Dl.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},Dl.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},Dl.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,o=3+this.cells.length+1+1,l=0,u=0;u<this.cells.length;u++)l+=this.cells[u].length;var f=new Int32Array(o+l+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;for(var b=o,y=0;y<a.length;y++){var S=a[y];f[3+y]=b,f.set(S,b),b+=S.length}return f[3+a.length]=b,f.set(this.keys,b),f[3+a.length+1]=b+=this.keys.length,f.set(this.bboxes,b),b+=this.bboxes.length,f.buffer};const Th={};function tn(a,o,l={}){Object.defineProperty(a,"_classRegistryKey",{value:o,writeable:!1}),Th[o]={klass:a,omit:l.omit||[]}}tn(Object,"Object"),ec.serialize=function(a,o){const l=a.toArrayBuffer();return o&&o.push(l),{buffer:l}},ec.deserialize=function(a){return new ec(a.buffer)},Object.defineProperty(ec,"name",{value:"Grid"}),tn(ec,"Grid"),tn(uo,"Color"),tn(Error,"Error"),tn(la,"AJAXError"),tn(Hs,"ResolvedImage"),tn(il,"StylePropertyFunction"),tn(id,"StyleExpression",{omit:["_evaluator"]}),tn(_h,"ZoomDependentExpression"),tn(bh,"ZoomConstantExpression"),tn(Ma,"CompoundExpression",{omit:["_evaluate"]});for(const a in td)Th[td[a]._classRegistryKey]||tn(td[a],`Expression${a}`);function ud(a){return a&&"undefined"!=typeof ArrayBuffer&&(a instanceof ArrayBuffer||a.constructor&&"ArrayBuffer"===a.constructor.name)}function ls(a){return me.ImageBitmap&&a instanceof me.ImageBitmap}function Zs(a,o){if(null==a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(ud(a)||ls(a))return o&&o.push(a),a;if(ArrayBuffer.isView(a)){const l=a;return o&&o.push(l.buffer),l}if(a instanceof me.ImageData)return o&&o.push(a.data.buffer),a;if(Array.isArray(a)){const l=[];for(const u of a)l.push(Zs(u,o));return l}if("object"==typeof a){const l=a.constructor,u=l._classRegistryKey;if(!u)throw new Error(`can't serialize object of unregistered class ${u}`);const f=l.serialize?l.serialize(a,o):{};if(!l.serialize){for(const b in a)a.hasOwnProperty(b)&&(Th[u].omit.indexOf(b)>=0||(f[b]=Zs(a[b],o)));a instanceof Error&&(f.message=a.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==u&&(f.$name=u),f}throw new Error("can't serialize object of type "+typeof a)}function El(a){if(null==a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||ud(a)||ls(a)||ArrayBuffer.isView(a)||a instanceof me.ImageData)return a;if(Array.isArray(a))return a.map(El);if("object"==typeof a){const o=a.$name||"Object",{klass:l}=Th[o];if(!l)throw new Error(`can't deserialize unregistered class ${o}`);if(l.deserialize)return l.deserialize(a);const u=Object.create(l.prototype);for(const f of Object.keys(a))"$name"!==f&&(u[f]=El(a[f]));return u}throw new Error("can't deserialize object of type "+typeof a)}class Mc{constructor(){this.first=!0}update(o,l){const u=Math.floor(o);return this.first?(this.first=!1,this.lastIntegerZoom=u,this.lastIntegerZoomTime=0,this.lastZoom=o,this.lastFloorZoom=u,!0):(this.lastFloorZoom>u?(this.lastIntegerZoom=u+1,this.lastIntegerZoomTime=l):this.lastFloorZoom<u&&(this.lastIntegerZoom=u,this.lastIntegerZoomTime=l),o!==this.lastZoom&&(this.lastZoom=o,this.lastFloorZoom=u,!0))}}const rl=a=>a>=1536&&a<=1791,dd=a=>a>=1872&&a<=1919,Qp=a=>a>=2208&&a<=2303,Kp=a=>a>=11904&&a<=12031,km=a=>a>=12032&&a<=12255,hd=a=>a>=12272&&a<=12287,Ac=a=>a>=12288&&a<=12351,pd=a=>a>=12352&&a<=12447,kc=a=>a>=12448&&a<=12543,Dh=a=>a>=12544&&a<=12591,fd=a=>a>=12704&&a<=12735,Eh=a=>a>=12736&&a<=12783,Jp=a=>a>=12784&&a<=12799,Ih=a=>a>=12800&&a<=13055,ef=a=>a>=13056&&a<=13311,tf=a=>a>=13312&&a<=19903,md=a=>a>=19968&&a<=40959,Mh=a=>a>=40960&&a<=42127,Rm=a=>a>=42128&&a<=42191,cs=a=>a>=44032&&a<=55215,Il=a=>a>=63744&&a<=64255,Qr=a=>a>=64336&&a<=65023,Ml=a=>a>=65040&&a<=65055,Ah=a=>a>=65072&&a<=65103,Al=a=>a>=65104&&a<=65135,g=a=>a>=65136&&a<=65279,c=a=>a>=65280&&a<=65519;function h(a){for(const o of a)if(C(o.charCodeAt(0)))return!0;return!1}function _(a){for(const o of a)if(!w(o.charCodeAt(0)))return!1;return!0}function w(a){return!(rl(a)||dd(a)||Qp(a)||Qr(a)||g(a))}function C(a){return!(746!==a&&747!==a&&(a<4352||!(fd(a)||Dh(a)||Ah(a)&&!(a>=65097&&a<=65103)||Il(a)||ef(a)||Kp(a)||Eh(a)||!(!Ac(a)||a>=12296&&a<=12305||a>=12308&&a<=12319||12336===a)||tf(a)||md(a)||Ih(a)||(o=a,o>=12592&&o<=12687)||(o=>o>=43360&&o<=43391)(a)||(o=>o>=55216&&o<=55295)(a)||(o=>o>=4352&&o<=4607)(a)||cs(a)||pd(a)||hd(a)||(o=>o>=12688&&o<=12703)(a)||km(a)||Jp(a)||kc(a)&&12540!==a||!(!c(a)||65288===a||65289===a||65293===a||a>=65306&&a<=65310||65339===a||65341===a||65343===a||a>=65371&&a<=65503||65507===a||a>=65512&&a<=65519)||!(!Al(a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||(o=>o>=5120&&o<=5759)(a)||(o=>o>=6320&&o<=6399)(a)||Ml(a)||(o=>o>=19904&&o<=19967)(a)||Mh(a)||Rm(a))));var o}function I(a){return!(C(a)||(o=a,(l=o)>=128&&l<=255&&(167===o||169===o||174===o||177===o||188===o||189===o||190===o||215===o||247===o)||(l=>l>=8192&&l<=8303)(o)&&(8214===o||8224===o||8225===o||8240===o||8241===o||8251===o||8252===o||8258===o||8263===o||8264===o||8265===o||8273===o)||(l=>l>=8448&&l<=8527)(o)||(l=>l>=8528&&l<=8591)(o)||(l=>l>=8960&&l<=9215)(o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||9003===o||o>=9085&&o<=9114||o>=9150&&o<=9165||9167===o||o>=9169&&o<=9179||o>=9186&&o<=9215)||(l=>l>=9216&&l<=9279)(o)&&9251!==o||(l=>l>=9280&&l<=9311)(o)||(l=>l>=9312&&l<=9471)(o)||(l=>l>=9632&&l<=9727)(o)||(l=>l>=9728&&l<=9983)(o)&&!(o>=9754&&o<=9759)||(l=>l>=11008&&l<=11263)(o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||Ac(o)||kc(o)||(l=>l>=57344&&l<=63743)(o)||Ah(o)||Al(o)||c(o)||8734===o||8756===o||8757===o||o>=9984&&o<=10087||o>=10102&&o<=10131||65532===o||65533===o));var o,l}function k(a){return a>=1424&&a<=2303||Qr(a)||g(a)}function R(a,o){return!(!o&&k(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||(l=a,l>=6016&&l<=6143));var l}function F(a){for(const o of a)if(k(o.charCodeAt(0)))return!0;return!1}const N="deferred",H="loading",X="loaded";let te=null,Q="unavailable",ne=null;const K=function(a){a&&"string"==typeof a&&a.indexOf("NetworkError")>-1&&(Q="error"),te&&te(a)};function Y(){se.fire(new _r("pluginStateChange",{pluginStatus:Q,pluginURL:ne}))}const se=new xl,J=function(){return Q},_e=function(){if(Q!==N||!ne)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Q=H,Y(),ne&&Qa({url:ne},a=>{a?K(a):(Q=X,Y())})},ve={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Q===X||null!=ve.applyArabicShaping,isLoading:()=>Q===H,setState(a){Q=a.pluginStatus,ne=a.pluginURL},isParsed:()=>null!=ve.applyArabicShaping&&null!=ve.processBidirectionalText&&null!=ve.processStyledBidirectionalText,getPluginURL:()=>ne};class he{constructor(o,l){this.zoom=o,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.zoomHistory=l.zoomHistory,this.transition=l.transition,this.pitch=l.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Mc,this.transition={},this.pitch=0)}isSupportedScript(o){return function(l,u){for(const f of l)if(!R(f.charCodeAt(0),u))return!1;return!0}(o,ve.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const o=this.zoom,l=o-Math.floor(o),u=this.crossFadingFactor();return o>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:l+(1-l)*u}:{fromScale:.5,toScale:1,t:1-(1-u)*l}}}class Ce{constructor(o,l){this.property=o,this.value=l,this.expression=function(u,f){if(Yl(u))return new il(u,f);if(dr(u)){const b=fu(u,f);if("error"===b.result)throw new Error(b.value.map(y=>`${y.key}: ${y.message}`).join(", "));return b.value}{let b=u;return"string"==typeof u&&"color"===f.type&&(b=uo.parse(u)),{kind:"constant",evaluate:()=>b}}}(void 0===l?o.specification.default:l,o.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(o,l,u){return this.property.possiblyEvaluate(this,o,l,u)}}class He{constructor(o){this.property=o,this.value=new Ce(o,void 0)}transitioned(o,l){return new Qe(this.property,this.value,l,en({},o.transition,this.transition),o.now)}untransitioned(){return new Qe(this.property,this.value,null,{},0)}}class it{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitionablePropertyValues)}getValue(o){return Jt(this._values[o].value.value)}setValue(o,l){this._values.hasOwnProperty(o)||(this._values[o]=new He(this._values[o].property)),this._values[o].value=new Ce(this._values[o].property,null===l?void 0:Jt(l))}getTransition(o){return Jt(this._values[o].transition)}setTransition(o,l){this._values.hasOwnProperty(o)||(this._values[o]=new He(this._values[o].property)),this._values[o].transition=Jt(l)||void 0}serialize(){const o={};for(const l of Object.keys(this._values)){const u=this.getValue(l);void 0!==u&&(o[l]=u);const f=this.getTransition(l);void 0!==f&&(o[`${l}-transition`]=f)}return o}transitioned(o,l){const u=new wt(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].transitioned(o,l._values[f]);return u}untransitioned(){const o=new wt(this._properties);for(const l of Object.keys(this._values))o._values[l]=this._values[l].untransitioned();return o}}class Qe{constructor(o,l,u,f,b){const y=f.delay||0,S=f.duration||0;b=b||0,this.property=o,this.value=l,this.begin=b+y,this.end=this.begin+S,o.specification.transition&&(f.delay||f.duration)&&(this.prior=u)}possiblyEvaluate(o,l,u){const f=o.now||0,b=this.value.possiblyEvaluate(o,l,u),y=this.prior;if(y){if(f>this.end)return this.prior=null,b;if(this.value.isDataDriven())return this.prior=null,b;if(f<this.begin)return y.possiblyEvaluate(o,l,u);{const S=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(o,l,u),b,at(S))}}return b}}class wt{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitioningPropertyValues)}possiblyEvaluate(o,l,u){const f=new gt(this._properties);for(const b of Object.keys(this._values))f._values[b]=this._values[b].possiblyEvaluate(o,l,u);return f}hasTransition(){for(const o of Object.keys(this._values))if(this._values[o].prior)return!0;return!1}}class Le{constructor(o){this._properties=o,this._values=Object.create(o.defaultPropertyValues)}getValue(o){return Jt(this._values[o].value)}setValue(o,l){this._values[o]=new Ce(this._values[o].property,null===l?void 0:Jt(l))}serialize(){const o={};for(const l of Object.keys(this._values)){const u=this.getValue(l);void 0!==u&&(o[l]=u)}return o}possiblyEvaluate(o,l,u){const f=new gt(this._properties);for(const b of Object.keys(this._values))f._values[b]=this._values[b].possiblyEvaluate(o,l,u);return f}}class ft{constructor(o,l,u){this.property=o,this.value=l,this.parameters=u}isConstant(){return"constant"===this.value.kind}constantOr(o){return"constant"===this.value.kind?this.value.value:o}evaluate(o,l,u,f){return this.property.evaluate(this.value,this.parameters,o,l,u,f)}}class gt{constructor(o){this._properties=o,this._values=Object.create(o.defaultPossiblyEvaluatedValues)}get(o){return this._values[o]}}class qe{constructor(o){this.specification=o}possiblyEvaluate(o,l){return o.expression.evaluate(l)}interpolate(o,l,u){const f=vt[this.specification.type];return f?f(o,l,u):o}}class Me{constructor(o,l){this.specification=o,this.overrides=l}possiblyEvaluate(o,l,u,f){return new ft(this,"constant"===o.expression.kind||"camera"===o.expression.kind?{kind:"constant",value:o.expression.evaluate(l,null,{},u,f)}:o.expression,l)}interpolate(o,l,u){if("constant"!==o.value.kind||"constant"!==l.value.kind)return o;if(void 0===o.value.value||void 0===l.value.value)return new ft(this,{kind:"constant",value:void 0},o.parameters);const f=vt[this.specification.type];return f?new ft(this,{kind:"constant",value:f(o.value.value,l.value.value,u)},o.parameters):o}evaluate(o,l,u,f,b,y){return"constant"===o.kind?o.value:o.evaluate(l,u,f,b,y)}}class Gt extends Me{possiblyEvaluate(o,l,u,f){if(void 0===o.value)return new ft(this,{kind:"constant",value:void 0},l);if("constant"===o.expression.kind){const b=o.expression.evaluate(l,null,{},u,f),y="resolvedImage"===o.property.specification.type&&"string"!=typeof b?b.name:b,S=this._calculate(y,y,y,l);return new ft(this,{kind:"constant",value:S},l)}if("camera"===o.expression.kind){const b=this._calculate(o.expression.evaluate({zoom:l.zoom-1}),o.expression.evaluate({zoom:l.zoom}),o.expression.evaluate({zoom:l.zoom+1}),l);return new ft(this,{kind:"constant",value:b},l)}return new ft(this,o.expression,l)}evaluate(o,l,u,f,b,y){if("source"===o.kind){const S=o.evaluate(l,u,f,b,y);return this._calculate(S,S,S,l)}return"composite"===o.kind?this._calculate(o.evaluate({zoom:Math.floor(l.zoom)-1},u,f),o.evaluate({zoom:Math.floor(l.zoom)},u,f),o.evaluate({zoom:Math.floor(l.zoom)+1},u,f),l):o.value}_calculate(o,l,u,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:o,to:l,other:u}:{from:u,to:l,other:o}}interpolate(o){return o}}class It{constructor(o){this.specification=o}possiblyEvaluate(o,l,u,f){if(void 0!==o.value){if("constant"===o.expression.kind){const b=o.expression.evaluate(l,null,{},u,f);return this._calculate(b,b,b,l)}return this._calculate(o.expression.evaluate(new he(Math.floor(l.zoom-1),l)),o.expression.evaluate(new he(Math.floor(l.zoom),l)),o.expression.evaluate(new he(Math.floor(l.zoom+1),l)),l)}}_calculate(o,l,u,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:o,to:l}:{from:u,to:l}}interpolate(o){return o}}class jt{constructor(o){this.specification=o}possiblyEvaluate(o,l,u,f){return!!o.expression.evaluate(l,null,{},u,f)}interpolate(){return!1}}class Lt{constructor(o){this.properties=o,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const l=new he(0,{});for(const u in o){const f=o[u];f.specification.overridable&&this.overridableProperties.push(u);const b=this.defaultPropertyValues[u]=new Ce(f,void 0),y=this.defaultTransitionablePropertyValues[u]=new He(f);this.defaultTransitioningPropertyValues[u]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=b.possiblyEvaluate(l)}}}function bn(a,o){return 256*(a=Ke(Math.floor(a),0,255))+Ke(Math.floor(o),0,255)}tn(Me,"DataDrivenProperty"),tn(qe,"DataConstantProperty"),tn(Gt,"CrossFadedDataDrivenProperty"),tn(It,"CrossFadedProperty"),tn(jt,"ColorRampProperty");const Gn={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Rn{constructor(o,l){this._structArray=o,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class yn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(o,l){return o._trim(),l&&(o.isTransferred=!0,l.push(o.arrayBuffer)),{length:o.length,arrayBuffer:o.arrayBuffer}}static deserialize(o){const l=Object.create(this.prototype);return l.arrayBuffer=o.arrayBuffer,l.length=o.length,l.capacity=o.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(o){this.reserve(o),this.length=o}reserve(o){if(o>this.capacity){this.capacity=Math.max(o,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Nt(a,o=1){let l=0,u=0;return{members:a.map(f=>{const b=Gn[f.type].BYTES_PER_ELEMENT,y=l=Jn(l,Math.max(o,b)),S=f.components||1;return u=Math.max(u,b),l+=b*S,{name:f.name,type:f.type,components:S,offset:y}}),size:Jn(l,Math.max(u,o)),alignment:o}}function Jn(a,o){return Math.ceil(a/o)*o}class bi extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l){const u=this.length;return this.resize(u+1),this.emplace(u,o,l)}emplace(o,l,u){const f=2*o;return this.int16[f+0]=l,this.int16[f+1]=u,o}}bi.prototype.bytesPerElement=4,tn(bi,"StructArrayLayout2i4");class hr extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,u){const f=this.length;return this.resize(f+1),this.emplace(f,o,l,u)}emplace(o,l,u,f){const b=3*o;return this.int16[b+0]=l,this.int16[b+1]=u,this.int16[b+2]=f,o}}hr.prototype.bytesPerElement=6,tn(hr,"StructArrayLayout3i6");class pr extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,u,f){const b=this.length;return this.resize(b+1),this.emplace(b,o,l,u,f)}emplace(o,l,u,f,b){const y=4*o;return this.int16[y+0]=l,this.int16[y+1]=u,this.int16[y+2]=f,this.int16[y+3]=b,o}}pr.prototype.bytesPerElement=8,tn(pr,"StructArrayLayout4i8");class or extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b,y,S){const T=this.length;return this.resize(T+1),this.emplace(T,o,l,u,f,b,y,S)}emplace(o,l,u,f,b,y,S,T){const E=6*o,M=12*o,P=3*o;return this.int16[E+0]=l,this.int16[E+1]=u,this.uint8[M+4]=f,this.uint8[M+5]=b,this.uint8[M+6]=y,this.uint8[M+7]=S,this.float32[P+2]=T,o}}or.prototype.bytesPerElement=12,tn(or,"StructArrayLayout2i4ub1f12");class io extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,u,f){const b=this.length;return this.resize(b+1),this.emplace(b,o,l,u,f)}emplace(o,l,u,f,b){const y=4*o;return this.float32[y+0]=l,this.float32[y+1]=u,this.float32[y+2]=f,this.float32[y+3]=b,o}}io.prototype.bytesPerElement=16,tn(io,"StructArrayLayout4f16");class Mo extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b,y,S,T,E,M){const P=this.length;return this.resize(P+1),this.emplace(P,o,l,u,f,b,y,S,T,E,M)}emplace(o,l,u,f,b,y,S,T,E,M,P){const O=10*o;return this.uint16[O+0]=l,this.uint16[O+1]=u,this.uint16[O+2]=f,this.uint16[O+3]=b,this.uint16[O+4]=y,this.uint16[O+5]=S,this.uint16[O+6]=T,this.uint16[O+7]=E,this.uint16[O+8]=M,this.uint16[O+9]=P,o}}Mo.prototype.bytesPerElement=20,tn(Mo,"StructArrayLayout10ui20");class ol extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b,y,S,T){const E=this.length;return this.resize(E+1),this.emplace(E,o,l,u,f,b,y,S,T)}emplace(o,l,u,f,b,y,S,T,E){const M=8*o;return this.uint16[M+0]=l,this.uint16[M+1]=u,this.uint16[M+2]=f,this.uint16[M+3]=b,this.uint16[M+4]=y,this.uint16[M+5]=S,this.uint16[M+6]=T,this.uint16[M+7]=E,o}}ol.prototype.bytesPerElement=16,tn(ol,"StructArrayLayout8ui16");class Mr extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b,y){const S=this.length;return this.resize(S+1),this.emplace(S,o,l,u,f,b,y)}emplace(o,l,u,f,b,y,S){const T=6*o;return this.int16[T+0]=l,this.int16[T+1]=u,this.int16[T+2]=f,this.int16[T+3]=b,this.int16[T+4]=y,this.int16[T+5]=S,o}}Mr.prototype.bytesPerElement=12,tn(Mr,"StructArrayLayout6i12");class zr extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b,y,S,T,E,M,P,O){const B=this.length;return this.resize(B+1),this.emplace(B,o,l,u,f,b,y,S,T,E,M,P,O)}emplace(o,l,u,f,b,y,S,T,E,M,P,O,B){const V=12*o;return this.int16[V+0]=l,this.int16[V+1]=u,this.int16[V+2]=f,this.int16[V+3]=b,this.uint16[V+4]=y,this.uint16[V+5]=S,this.uint16[V+6]=T,this.uint16[V+7]=E,this.int16[V+8]=M,this.int16[V+9]=P,this.int16[V+10]=O,this.int16[V+11]=B,o}}zr.prototype.bytesPerElement=24,tn(zr,"StructArrayLayout4i4ui4i24");class Pi extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b,y){const S=this.length;return this.resize(S+1),this.emplace(S,o,l,u,f,b,y)}emplace(o,l,u,f,b,y,S){const T=10*o,E=5*o;return this.int16[T+0]=l,this.int16[T+1]=u,this.int16[T+2]=f,this.float32[E+2]=b,this.float32[E+3]=y,this.float32[E+4]=S,o}}Pi.prototype.bytesPerElement=20,tn(Pi,"StructArrayLayout3i3f20");class po extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.uint32[1*o+0]=l,o}}po.prototype.bytesPerElement=4,tn(po,"StructArrayLayout1ul4");class ui extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b,y,S,T,E,M,P,O,B){const V=this.length;return this.resize(V+1),this.emplace(V,o,l,u,f,b,y,S,T,E,M,P,O,B)}emplace(o,l,u,f,b,y,S,T,E,M,P,O,B,V){const G=20*o,Z=10*o;return this.int16[G+0]=l,this.int16[G+1]=u,this.int16[G+2]=f,this.int16[G+3]=b,this.int16[G+4]=y,this.float32[Z+3]=S,this.float32[Z+4]=T,this.float32[Z+5]=E,this.float32[Z+6]=M,this.int16[G+14]=P,this.uint32[Z+8]=O,this.uint16[G+18]=B,this.uint16[G+19]=V,o}}ui.prototype.bytesPerElement=40,tn(ui,"StructArrayLayout5i4f1i1ul2ui40");class vr extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b,y,S){const T=this.length;return this.resize(T+1),this.emplace(T,o,l,u,f,b,y,S)}emplace(o,l,u,f,b,y,S,T){const E=8*o;return this.int16[E+0]=l,this.int16[E+1]=u,this.int16[E+2]=f,this.int16[E+4]=b,this.int16[E+5]=y,this.int16[E+6]=S,this.int16[E+7]=T,o}}vr.prototype.bytesPerElement=16,tn(vr,"StructArrayLayout3i2i2i16");class Ns extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b){const y=this.length;return this.resize(y+1),this.emplace(y,o,l,u,f,b)}emplace(o,l,u,f,b,y){const S=4*o,T=8*o;return this.float32[S+0]=l,this.float32[S+1]=u,this.float32[S+2]=f,this.int16[T+6]=b,this.int16[T+7]=y,o}}Ns.prototype.bytesPerElement=16,tn(Ns,"StructArrayLayout2f1f2i16");class tc extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,u,f){const b=this.length;return this.resize(b+1),this.emplace(b,o,l,u,f)}emplace(o,l,u,f,b){const y=12*o,S=3*o;return this.uint8[y+0]=l,this.uint8[y+1]=u,this.float32[S+1]=f,this.float32[S+2]=b,o}}tc.prototype.bytesPerElement=12,tn(tc,"StructArrayLayout2ub2f12");class Vr extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,u){const f=this.length;return this.resize(f+1),this.emplace(f,o,l,u)}emplace(o,l,u,f){const b=3*o;return this.float32[b+0]=l,this.float32[b+1]=u,this.float32[b+2]=f,o}}Vr.prototype.bytesPerElement=12,tn(Vr,"StructArrayLayout3f12");class Co extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,u){const f=this.length;return this.resize(f+1),this.emplace(f,o,l,u)}emplace(o,l,u,f){const b=3*o;return this.uint16[b+0]=l,this.uint16[b+1]=u,this.uint16[b+2]=f,o}}Co.prototype.bytesPerElement=6,tn(Co,"StructArrayLayout3ui6");class La extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b,y,S,T,E,M,P,O,B,V,G,Z,ce,ye,ue,ge,De){const xe=this.length;return this.resize(xe+1),this.emplace(xe,o,l,u,f,b,y,S,T,E,M,P,O,B,V,G,Z,ce,ye,ue,ge,De)}emplace(o,l,u,f,b,y,S,T,E,M,P,O,B,V,G,Z,ce,ye,ue,ge,De,xe){const tt=30*o,Ze=15*o,lt=60*o;return this.int16[tt+0]=l,this.int16[tt+1]=u,this.int16[tt+2]=f,this.float32[Ze+2]=b,this.float32[Ze+3]=y,this.uint16[tt+8]=S,this.uint16[tt+9]=T,this.uint32[Ze+5]=E,this.uint32[Ze+6]=M,this.uint32[Ze+7]=P,this.uint16[tt+16]=O,this.uint16[tt+17]=B,this.uint16[tt+18]=V,this.float32[Ze+10]=G,this.float32[Ze+11]=Z,this.uint8[lt+48]=ce,this.uint8[lt+49]=ye,this.uint8[lt+50]=ue,this.uint32[Ze+13]=ge,this.int16[tt+28]=De,this.uint8[lt+58]=xe,o}}La.prototype.bytesPerElement=60,tn(La,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Ys extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b,y,S,T,E,M,P,O,B,V,G,Z,ce,ye,ue,ge,De,xe,tt,Ze,lt,Mt,ot,_t,yt,Ct){const Rt=this.length;return this.resize(Rt+1),this.emplace(Rt,o,l,u,f,b,y,S,T,E,M,P,O,B,V,G,Z,ce,ye,ue,ge,De,xe,tt,Ze,lt,Mt,ot,_t,yt,Ct)}emplace(o,l,u,f,b,y,S,T,E,M,P,O,B,V,G,Z,ce,ye,ue,ge,De,xe,tt,Ze,lt,Mt,ot,_t,yt,Ct,Rt){const pt=38*o,nn=19*o;return this.int16[pt+0]=l,this.int16[pt+1]=u,this.int16[pt+2]=f,this.float32[nn+2]=b,this.float32[nn+3]=y,this.int16[pt+8]=S,this.int16[pt+9]=T,this.int16[pt+10]=E,this.int16[pt+11]=M,this.int16[pt+12]=P,this.int16[pt+13]=O,this.uint16[pt+14]=B,this.uint16[pt+15]=V,this.uint16[pt+16]=G,this.uint16[pt+17]=Z,this.uint16[pt+18]=ce,this.uint16[pt+19]=ye,this.uint16[pt+20]=ue,this.uint16[pt+21]=ge,this.uint16[pt+22]=De,this.uint16[pt+23]=xe,this.uint16[pt+24]=tt,this.uint16[pt+25]=Ze,this.uint16[pt+26]=lt,this.uint16[pt+27]=Mt,this.uint16[pt+28]=ot,this.uint32[nn+15]=_t,this.float32[nn+16]=yt,this.float32[nn+17]=Ct,this.float32[nn+18]=Rt,o}}Ys.prototype.bytesPerElement=76,tn(Ys,"StructArrayLayout3i2f6i15ui1ul3f76");class No extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.float32[1*o+0]=l,o}}No.prototype.bytesPerElement=4,tn(No,"StructArrayLayout1f4");class fa extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,u,f,b){const y=this.length;return this.resize(y+1),this.emplace(y,o,l,u,f,b)}emplace(o,l,u,f,b,y){const S=5*o;return this.float32[S+0]=l,this.float32[S+1]=u,this.float32[S+2]=f,this.float32[S+3]=b,this.float32[S+4]=y,o}}fa.prototype.bytesPerElement=20,tn(fa,"StructArrayLayout5f20");class Qs extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,u,f){const b=this.length;return this.resize(b+1),this.emplace(b,o,l,u,f)}emplace(o,l,u,f,b){const y=6*o;return this.uint32[3*o+0]=l,this.uint16[y+2]=u,this.uint16[y+3]=f,this.uint16[y+4]=b,o}}Qs.prototype.bytesPerElement=12,tn(Qs,"StructArrayLayout1ul3ui12");class sl extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l){const u=this.length;return this.resize(u+1),this.emplace(u,o,l)}emplace(o,l,u){const f=2*o;return this.uint16[f+0]=l,this.uint16[f+1]=u,o}}sl.prototype.bytesPerElement=4,tn(sl,"StructArrayLayout2ui4");class nf extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.uint16[1*o+0]=l,o}}nf.prototype.bytesPerElement=2,tn(nf,"StructArrayLayout1ui2");class bt extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l){const u=this.length;return this.resize(u+1),this.emplace(u,o,l)}emplace(o,l,u){const f=2*o;return this.float32[f+0]=l,this.float32[f+1]=u,o}}bt.prototype.bytesPerElement=8,tn(bt,"StructArrayLayout2f8");class pv extends Rn{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}pv.prototype.size=12;class mS extends Mr{get(o){return new pv(this,o)}}tn(mS,"FillExtrusionExtArray");class gS extends Rn{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}gS.prototype.size=40;class fv extends ui{get(o){return new gS(this,o)}}tn(fv,"CollisionBoxArray");class bS extends Rn{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(o){this._structArray.uint8[this._pos1+49]=o}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(o){this._structArray.uint8[this._pos1+50]=o}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(o){this._structArray.uint32[this._pos4+13]=o}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(o){this._structArray.uint8[this._pos1+58]=o}}bS.prototype.size=60;class _S extends La{get(o){return new bS(this,o)}}tn(_S,"PlacedSymbolArray");class yS extends Rn{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(o){this._structArray.uint32[this._pos4+15]=o}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}yS.prototype.size=76;class kh extends Ys{get(o){return new yS(this,o)}}tn(kh,"SymbolInstanceArray");class vS extends No{getoffsetX(o){return this.float32[1*o+0]}}tn(vS,"GlyphOffsetArray");class xS extends hr{getx(o){return this.int16[3*o+0]}gety(o){return this.int16[3*o+1]}gettileUnitDistanceFromAnchor(o){return this.int16[3*o+2]}}tn(xS,"SymbolLineVertexArray");class Bo extends Rn{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Bo.prototype.size=12;class Pm extends Qs{get(o){return new Bo(this,o)}}tn(Pm,"FeatureIndexArray");class Rh extends Rn{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}Rh.prototype.size=4;class wS extends sl{get(o){return new Rh(this,o)}}tn(wS,"FillExtrusionCentroidArray");class mv extends Rn{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}mv.prototype.size=12;class ma extends Mr{get(o){return new mv(this,o)}}tn(ma,"CircleGlobeExtArray");const Rc=Nt([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),gv=Nt([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var Pc={exports:{}},bv=function(a,o){var l,u,f,b,y,S,T,E;for(u=a.length-(l=3&a.length),f=o,y=3432918353,S=461845907,E=0;E<u;)T=255&a.charCodeAt(E)|(255&a.charCodeAt(++E))<<8|(255&a.charCodeAt(++E))<<16|(255&a.charCodeAt(++E))<<24,++E,f=27492+(65535&(b=5*(65535&(f=(f^=T=(65535&(T=(T=(65535&T)*y+(((T>>>16)*y&65535)<<16)&4294967295)<<15|T>>>17))*S+(((T>>>16)*S&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(b>>>16)&65535)<<16);switch(T=0,l){case 3:T^=(255&a.charCodeAt(E+2))<<16;case 2:T^=(255&a.charCodeAt(E+1))<<8;case 1:f^=T=(65535&(T=(T=(65535&(T^=255&a.charCodeAt(E)))*y+(((T>>>16)*y&65535)<<16)&4294967295)<<15|T>>>17))*S+(((T>>>16)*S&65535)<<16)&4294967295}return f^=a.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0},SS=function(a,o){for(var l,u=a.length,f=o^u,b=0;u>=4;)l=1540483477*(65535&(l=255&a.charCodeAt(b)|(255&a.charCodeAt(++b))<<8|(255&a.charCodeAt(++b))<<16|(255&a.charCodeAt(++b))<<24))+((1540483477*(l>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),u-=4,++b;switch(u){case 3:f^=(255&a.charCodeAt(b+2))<<16;case 2:f^=(255&a.charCodeAt(b+1))<<8;case 1:f=1540483477*(65535&(f^=255&a.charCodeAt(b)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0};Pc.exports=bv,Pc.exports.murmur3=bv,Pc.exports.murmur2=SS;class wb{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(o,l,u,f){this.ids.push(CS(o)),this.positions.push(l,u,f)}getPositions(o){const l=CS(o);let u=0,f=this.ids.length-1;for(;u<f;){const y=u+f>>1;this.ids[y]>=l?f=y:u=y+1}const b=[];for(;this.ids[u]===l;)b.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return b}static serialize(o,l){const u=new Float64Array(o.ids),f=new Uint32Array(o.positions);return Om(u,f,0,u.length-1),l&&l.push(u.buffer,f.buffer),{ids:u,positions:f}}static deserialize(o){const l=new wb;return l.ids=o.ids,l.positions=o.positions,l.indexed=!0,l}}function CS(a){const o=+a;return!isNaN(o)&&Number.MIN_SAFE_INTEGER<=o&&o<=Number.MAX_SAFE_INTEGER?o:Pc.exports(String(a))}function Om(a,o,l,u){for(;l<u;){const f=a[l+u>>1];let b=l-1,y=u+1;for(;;){do{b++}while(a[b]<f);do{y--}while(a[y]>f);if(b>=y)break;Bs(a,b,y),Bs(o,3*b,3*y),Bs(o,3*b+1,3*y+1),Bs(o,3*b+2,3*y+2)}y-l<u-y?(Om(a,o,l,y),l=y+1):(Om(a,o,y+1,u),u=y)}}function Bs(a,o,l){const u=a[o];a[o]=a[l],a[l]=u}tn(wb,"FeaturePositionMap");class kl{constructor(o){this.gl=o.gl,this.initialized=!1}fetchUniformLocation(o,l){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(o,l),this.initialized=!0),!!this.location}}class Oc extends kl{constructor(o){super(o),this.current=0}set(o,l,u){this.fetchUniformLocation(o,l)&&this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class TS extends kl{constructor(o){super(o),this.current=[0,0,0,0]}set(o,l,u){this.fetchUniformLocation(o,l)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3])))}}class Sb extends kl{constructor(o){super(o),this.current=uo.transparent}set(o,l,u){this.fetchUniformLocation(o,l)&&(u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a)))}}const DS=new Float32Array(16),ES=new Float32Array(9),IS=new Float32Array(4);function Cb(a){return[bn(255*a.r,255*a.g),bn(255*a.b,255*a.a)]}class rf{constructor(o,l,u){this.value=o,this.uniformNames=l.map(f=>`u_${f}`),this.type=u}setUniform(o,l,u,f,b){l.set(o,b,f.constantOr(this.value))}getBinding(o,l){return"color"===this.type?new Sb(o):new Oc(o)}}class Oh{constructor(o,l){this.uniformNames=l.map(u=>`u_${u}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(o,l){this.pixelRatioFrom=l.pixelRatio||1,this.pixelRatioTo=o.pixelRatio||1,this.patternFrom=l.tl.concat(l.br),this.patternTo=o.tl.concat(o.br)}setUniform(o,l,u,f,b){const y="u_pattern_to"===b||"u_dash_to"===b?this.patternTo:"u_pattern_from"===b||"u_dash_from"===b?this.patternFrom:"u_pixel_ratio_to"===b?this.pixelRatioTo:"u_pixel_ratio_from"===b?this.pixelRatioFrom:null;y&&l.set(o,b,y)}getBinding(o,l){return"u_pattern_from"===l||"u_pattern_to"===l||"u_dash_from"===l||"u_dash_to"===l?new TS(o):new Oc(o)}}class Rl{constructor(o,l,u,f){this.expression=o,this.type=u,this.maxValue=0,this.paintVertexAttributes=l.map(b=>({name:`a_${b}`,type:"Float32",components:"color"===u?2:1,offset:0})),this.paintVertexArray=new f}populatePaintArray(o,l,u,f,b,y){const S=this.paintVertexArray.length,T=this.expression.evaluate(new he(0),l,{},b,f,y);this.paintVertexArray.resize(o),this._setPaintValue(S,o,T)}updatePaintArray(o,l,u,f,b){const y=this.expression.evaluate({zoom:0},u,f,void 0,b);this._setPaintValue(o,l,y)}_setPaintValue(o,l,u){if("color"===this.type){const f=Cb(u);for(let b=o;b<l;b++)this.paintVertexArray.emplace(b,f[0],f[1])}else{for(let f=o;f<l;f++)this.paintVertexArray.emplace(f,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ga{constructor(o,l,u,f,b,y){this.expression=o,this.uniformNames=l.map(S=>`u_${S}_t`),this.type=u,this.useIntegerZoom=f,this.zoom=b,this.maxValue=0,this.paintVertexAttributes=l.map(S=>({name:`a_${S}`,type:"Float32",components:"color"===u?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(o,l,u,f,b,y){const S=this.expression.evaluate(new he(this.zoom),l,{},b,f,y),T=this.expression.evaluate(new he(this.zoom+1),l,{},b,f,y),E=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValue(E,o,S,T)}updatePaintArray(o,l,u,f,b){const y=this.expression.evaluate({zoom:this.zoom},u,f,void 0,b),S=this.expression.evaluate({zoom:this.zoom+1},u,f,void 0,b);this._setPaintValue(o,l,y,S)}_setPaintValue(o,l,u,f){if("color"===this.type){const b=Cb(u),y=Cb(f);for(let S=o;S<l;S++)this.paintVertexArray.emplace(S,b[0],b[1],y[0],y[1])}else{for(let b=o;b<l;b++)this.paintVertexArray.emplace(b,u,f);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(f))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(o,l,u,f,b){const y=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,S=Ke(this.expression.interpolationFactor(y,this.zoom,this.zoom+1),0,1);l.set(o,b,S)}getBinding(o,l){return new Oc(o)}}class gd{constructor(o,l,u,f,b,y,S){this.expression=o,this.type=u,this.useIntegerZoom=f,this.zoom=b,this.layerId=S,this.paintVertexAttributes=("array"===u?gv:Rc).members;for(let T=0;T<l.length;++T);this.zoomInPaintVertexArray=new y,this.zoomOutPaintVertexArray=new y}populatePaintArray(o,l,u){const f=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(o),this.zoomOutPaintVertexArray.resize(o),this._setPaintValues(f,o,l.patterns&&l.patterns[this.layerId],u)}updatePaintArray(o,l,u,f,b,y){this._setPaintValues(o,l,u.patterns&&u.patterns[this.layerId],y)}_setPaintValues(o,l,u,f){if(!f||!u)return;const{min:b,mid:y,max:S}=u,T=f[b],E=f[y],M=f[S];if(T&&E&&M)for(let P=o;P<l;P++)this._setPaintValue(this.zoomInPaintVertexArray,P,E,T),this._setPaintValue(this.zoomOutPaintVertexArray,P,E,M)}_setPaintValue(o,l,u,f){o.emplace(l,u.tl[0],u.tl[1],u.br[0],u.br[1],f.tl[0],f.tl[1],f.br[0],f.br[1],u.pixelRatio,f.pixelRatio)}upload(o){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=o.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=o.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class al{constructor(o,l,u=(()=>!0)){this.binders={},this._buffers=[];const f=[];for(const b in o.paint._values){if(!u(b))continue;const y=o.paint.get(b);if(!(y instanceof ft&&nd(y.property.specification)))continue;const S=MS(b,o.type),T=y.value,E=y.property.specification.type,M=y.property.useIntegerZoom,P=y.property.specification["property-type"],O="cross-faded"===P||"cross-faded-data-driven"===P,B="line-dasharray"===String(b)&&"constant"!==o.layout.get("line-cap").value.kind;if("constant"!==T.kind||B)if("source"===T.kind||B||O){const V=Tb(b,E,"source");this.binders[b]=O?new gd(T,S,E,M,l,V,o.id):new Rl(T,S,E,V),f.push(`/a_${b}`)}else{const V=Tb(b,E,"composite");this.binders[b]=new ga(T,S,E,M,l,V),f.push(`/z_${b}`)}else this.binders[b]=O?new Oh(T.value,S):new rf(T.value,S,E),f.push(`/u_${b}`)}this.cacheKey=f.sort().join("")}getMaxValue(o){const l=this.binders[o];return l instanceof Rl||l instanceof ga?l.maxValue:0}populatePaintArrays(o,l,u,f,b,y){for(const S in this.binders){const T=this.binders[S];(T instanceof Rl||T instanceof ga||T instanceof gd)&&T.populatePaintArray(o,l,u,f,b,y)}}setConstantPatternPositions(o,l){for(const u in this.binders){const f=this.binders[u];f instanceof Oh&&f.setConstantPatternPositions(o,l)}}updatePaintArrays(o,l,u,f,b,y){let S=!1;for(const T in o){const E=l.getPositions(T);for(const M of E){const P=u.feature(M.index);for(const O in this.binders){const B=this.binders[O];if((B instanceof Rl||B instanceof ga||B instanceof gd)&&!0===B.expression.isStateDependent){const V=f.paint.get(O);B.expression=V.value,B.updatePaintArray(M.start,M.end,P,o[T],b,y),S=!0}}}}return S}defines(){const o=[];for(const l in this.binders){const u=this.binders[l];(u instanceof rf||u instanceof Oh)&&o.push(...u.uniformNames.map(f=>`#define HAS_UNIFORM_${f}`))}return o}getBinderAttributes(){const o=[];for(const l in this.binders){const u=this.binders[l];if(u instanceof Rl||u instanceof ga||u instanceof gd)for(let f=0;f<u.paintVertexAttributes.length;f++)o.push(u.paintVertexAttributes[f].name)}return o}getBinderUniforms(){const o=[];for(const l in this.binders){const u=this.binders[l];if(u instanceof rf||u instanceof Oh||u instanceof ga)for(const f of u.uniformNames)o.push(f)}return o}getPaintVertexBuffers(){return this._buffers}getUniforms(o){const l=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof rf||f instanceof Oh||f instanceof ga)for(const b of f.uniformNames)l.push({name:b,property:u,binding:f.getBinding(o,b)})}return l}setUniforms(o,l,u,f,b){for(const{name:y,property:S,binding:T}of u)this.binders[S].setUniform(o,T,b,f.get(S),y)}updatePaintBuffers(o){this._buffers=[];for(const l in this.binders){const u=this.binders[l];if(o&&u instanceof gd){const f=2===o.fromScale?u.zoomInPaintVertexBuffer:u.zoomOutPaintVertexBuffer;f&&this._buffers.push(f)}else(u instanceof Rl||u instanceof ga)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer)}}upload(o){for(const l in this.binders){const u=this.binders[l];(u instanceof Rl||u instanceof ga||u instanceof gd)&&u.upload(o)}this.updatePaintBuffers()}destroy(){for(const o in this.binders){const l=this.binders[o];(l instanceof Rl||l instanceof ga||l instanceof gd)&&l.destroy()}}}class Lc{constructor(o,l,u=(()=>!0)){this.programConfigurations={};for(const f of o)this.programConfigurations[f.id]=new al(f,l,u);this.needsUpload=!1,this._featureMap=new wb,this._bufferOffset=0}populatePaintArrays(o,l,u,f,b,y,S){for(const T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(o,l,f,b,y,S);void 0!==l.id&&this._featureMap.add(l.id,u,this._bufferOffset,o),this._bufferOffset=o,this.needsUpload=!0}updatePaintArrays(o,l,u,f,b){for(const y of u)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(o,this._featureMap,l,y,f,b)||this.needsUpload}get(o){return this.programConfigurations[o]}upload(o){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(o);this.needsUpload=!1}}destroy(){for(const o in this.programConfigurations)this.programConfigurations[o].destroy()}}const Lm={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function MS(a,o){return Lm[a]||[a.replace(`${o}-`,"").replace(/-/g,"_")]}const AS={"line-pattern":{source:Mo,composite:Mo},"fill-pattern":{source:Mo,composite:Mo},"fill-extrusion-pattern":{source:Mo,composite:Mo},"line-dasharray":{source:ol,composite:ol}},kS={color:{source:bt,composite:io},number:{source:No,composite:bt}};function Tb(a,o,l){const u=AS[a];return u&&u[l]||kS[o][l]}tn(rf,"ConstantBinder"),tn(Oh,"CrossFadedConstantBinder"),tn(Rl,"SourceExpressionBinder"),tn(gd,"CrossFadedCompositeBinder"),tn(ga,"CompositeExpressionBinder"),tn(al,"ProgramConfiguration",{omit:["_buffers"]}),tn(Lc,"ProgramConfigurationSet");const bu="-transition";class ba extends xl{constructor(o,l){if(super(),this.id=o.id,this.type=o.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==o.type&&(this.metadata=o.metadata,this.minzoom=o.minzoom,this.maxzoom=o.maxzoom,"background"!==o.type&&"sky"!==o.type&&(this.source=o.source,this.sourceLayer=o["source-layer"],this.filter=o.filter),l.layout&&(this._unevaluatedLayout=new Le(l.layout)),l.paint)){this._transitionablePaint=new it(l.paint);for(const u in o.paint)this.setPaintProperty(u,o.paint[u],{validate:!1});for(const u in o.layout)this.setLayoutProperty(u,o.layout[u],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new gt(l.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(o){return"visibility"===o?this.visibility:this._unevaluatedLayout.getValue(o)}setLayoutProperty(o,l,u={}){null!=l&&this._validate(ld,`layers.${this.id}.layout.${o}`,o,l,u)||("visibility"!==o?this._unevaluatedLayout.setValue(o,l):this.visibility=l)}getPaintProperty(o){return Eo(o,bu)?this._transitionablePaint.getTransition(o.slice(0,-bu.length)):this._transitionablePaint.getValue(o)}setPaintProperty(o,l,u={}){if(null!=l&&this._validate(Am,`layers.${this.id}.paint.${o}`,o,l,u))return!1;if(Eo(o,bu))return this._transitionablePaint.setTransition(o.slice(0,-bu.length),l||void 0),!1;{const f=this._transitionablePaint._values[o],b="cross-faded-data-driven"===f.property.specification["property-type"],y=f.value.isDataDriven(),S=f.value;this._transitionablePaint.setValue(o,l),this._handleSpecialPaintPropertyUpdate(o);const T=this._transitionablePaint._values[o].value;return T.isDataDriven()||y||b||this._handleOverridablePaintPropertyUpdate(o,S,T)}}_handleSpecialPaintPropertyUpdate(o){}getProgramIds(){return null}getProgramConfiguration(o){return null}_handleOverridablePaintPropertyUpdate(o,l,u){return!1}isHidden(o){return!!(this.minzoom&&o<this.minzoom)||!!(this.maxzoom&&o>=this.maxzoom)||"none"===this.visibility}updateTransitions(o){this._transitioningPaint=this._transitionablePaint.transitioned(o,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(o,l){o.getCrossfadeParameters&&(this._crossfadeParameters=o.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(o,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(o,void 0,l)}serialize(){const o={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(o.layout=o.layout||{},o.layout.visibility=this.visibility),Tt(o,(l,u)=>!(void 0===l||"layout"===u&&!Object.keys(l).length||"paint"===u&&!Object.keys(l).length))}_validate(o,l,u,f,b={}){return(!b||!1!==b.validate)&&cd(this,o.call(So,{key:l,layerType:this.type,objectKey:u,value:f,styleSpec:ct,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const o in this.paint._values){const l=this.paint.get(o);if(l instanceof ft&&nd(l.property.specification)&&("source"===l.value.kind||"composite"===l.value.kind)&&l.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=vh(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const RS=Nt([{name:"a_pos",components:2,type:"Int16"}],4),Be=Nt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class fo{constructor(o=[]){this.segments=o}prepareSegment(o,l,u,f){let b=this.segments[this.segments.length-1];return o>fo.MAX_VERTEX_ARRAY_LENGTH&&Ni(`Max vertices per segment is ${fo.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${o}`),(!b||b.vertexLength+o>fo.MAX_VERTEX_ARRAY_LENGTH||b.sortKey!==f)&&(b={vertexOffset:l.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},void 0!==f&&(b.sortKey=f),this.segments.push(b)),b}get(){return this.segments}destroy(){for(const o of this.segments)for(const l in o.vaos)o.vaos[l].destroy()}static simpleSegment(o,l,u,f){return new fo([{vertexOffset:o,primitiveOffset:l,vertexLength:u,primitiveLength:f,vaos:{},sortKey:0}])}}fo.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,tn(fo,"SegmentVector");var Mn=8192;class nc{constructor(o,l){o&&(l?this.setSouthWest(o).setNorthEast(l):4===o.length?this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]]):this.setSouthWest(o[0]).setNorthEast(o[1]))}setNorthEast(o){return this._ne=o instanceof Xi?new Xi(o.lng,o.lat):Xi.convert(o),this}setSouthWest(o){return this._sw=o instanceof Xi?new Xi(o.lng,o.lat):Xi.convert(o),this}extend(o){const l=this._sw,u=this._ne;let f,b;if(o instanceof Xi)f=o,b=o;else{if(!(o instanceof nc))return Array.isArray(o)?4===o.length||o.every(Array.isArray)?this.extend(nc.convert(o)):this.extend(Xi.convert(o)):"object"==typeof o&&null!==o&&o.hasOwnProperty("lat")&&o.hasOwnProperty("lon")?this.extend(Xi.convert(o)):this;if(f=o._sw,b=o._ne,!f||!b)return this}return l||u?(l.lng=Math.min(f.lng,l.lng),l.lat=Math.min(f.lat,l.lat),u.lng=Math.max(b.lng,u.lng),u.lat=Math.max(b.lat,u.lat)):(this._sw=new Xi(f.lng,f.lat),this._ne=new Xi(b.lng,b.lat)),this}getCenter(){return new Xi((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Xi(this.getWest(),this.getNorth())}getSouthEast(){return new Xi(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(o){const{lng:l,lat:u}=Xi.convert(o);let f=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&f}static convert(o){return!o||o instanceof nc?o:new nc(o)}}const _u=6371008.8;class Xi{constructor(o,l){if(isNaN(o)||isNaN(l))throw new Error(`Invalid LngLat object: (${o}, ${l})`);if(this.lng=+o,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Xi(wn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(o){const l=Math.PI/180,u=this.lat*l,f=o.lat*l,b=Math.sin(u)*Math.sin(f)+Math.cos(u)*Math.cos(f)*Math.cos((o.lng-this.lng)*l);return _u*Math.acos(Math.min(b,1))}toBounds(o=0){const l=360*o/40075017,u=l/Math.cos(Math.PI/180*this.lat);return new nc(new Xi(this.lng-u,this.lat-l),new Xi(this.lng+u,this.lat+l))}static convert(o){if(o instanceof Xi)return o;if(Array.isArray(o)&&(2===o.length||3===o.length))return new Xi(Number(o[0]),Number(o[1]));if(!Array.isArray(o)&&"object"==typeof o&&null!==o)return new Xi(Number("lng"in o?o.lng:o.lon),Number(o.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const _v=2*Math.PI*_u;function Db(a){return _v*Math.cos(a*Math.PI/180)}function ll(a){return(180+a)/360}function Cs(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function Fa(a,o){return a/Db(o)}function Ts(a){return 360*a-180}function us(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function Eb(a,o){return a*Db(us(o))}const _a=85.051129;function sf(a){return 1/Math.cos(a*Math.PI/180)}class bd{constructor(o,l,u=0){this.x=+o,this.y=+l,this.z=+u}static fromLngLat(o,l=0){const u=Xi.convert(o);return new bd(ll(u.lng),Cs(u.lat),Fa(l,u.lat))}toLngLat(){return new Xi(Ts(this.x),us(this.y))}toAltitude(){return Eb(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/_v*sf(us(this.y))}}function Ib(a,o,l,u,f,b,y,S,T){const E=(o+u)/2,M=(l+f)/2,P=new mt(E,M);S(P),function(O,B,V,G,Z,ce){const ye=V-Z,ue=G-ce;return Math.abs((G-B)*ye-(V-O)*ue)/Math.hypot(ye,ue)}(P.x,P.y,b.x,b.y,y.x,y.y)>=T?(Ib(a,o,l,E,M,b,P,S,T),Ib(a,E,M,u,f,P,y,S,T)):a.push(y)}function yv(a,o,l){let u=a[0],f=u.x,b=u.y;o(u);const y=[u];for(let S=1;S<a.length;S++){const T=a[S],{x:E,y:M}=T;o(T),Ib(y,f,b,E,M,u,T,o,l),f=E,b=M,u=T}return y}function yu(a,o,l,u){if(u(o,l)){const f=o.add(l)._mult(.5);yu(a,o,f,u),yu(a,f,l,u)}else a.push(l)}function af(a,o){let l=a[0];const u=[l];for(let f=1;f<a.length;f++){const b=a[f];yu(u,l,b,o),l=b}return u}const Mb=Math.pow(2,14)-1,PS=-Mb-1;function vv(a,o){const l=Math.round(a.x*o),u=Math.round(a.y*o);return a.x=Ke(l,PS,Mb),a.y=Ke(u,PS,Mb),(l<a.x||l>a.x+1||u<a.y||u>a.y+1)&&Ni("Geometry exceeds allowed extent, reduce your vector tile buffer size"),a}function Fc(a,o,l){const u=a.loadGeometry(),f=a.extent,b=Mn/f;if(o&&l&&l.projection.isReprojectedInTileSpace){const y=1<<o.z,{scale:S,x:T,y:E,projection:M}=l,P=O=>{const B=Ts((o.x+O.x/f)/y),V=us((o.y+O.y/f)/y),G=M.project(B,V);O.x=(G.x*S-T)*f,O.y=(G.y*S-E)*f};for(let O=0;O<u.length;O++)if(1!==a.type)u[O]=yv(u[O],P,1);else{const B=[];for(const V of u[O])V.x<0||V.x>=f||V.y<0||V.y>=f||(P(V),B.push(V));u[O]=B}}for(const y of u)for(const S of y)vv(S,b);return u}function Lh(a,o){return{type:a.type,id:a.id,properties:a.properties,geometry:o?Fc(a):[]}}function Fm(a,o,l,u,f){a.emplaceBack(2*o+(u+1)/2,2*l+(f+1)/2)}function Nm(a,o,l){a.emplaceBack(o.x,o.y,o.z,16384*l[0],16384*l[1],16384*l[2])}class Ab{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.id),this.index=o.index,this.hasPattern=!1,this.projection=o.projection,this.layoutVertexArray=new bi,this.indexArray=new Co,this.segments=new fo,this.programConfigurations=new Lc(o.layers,o.zoom),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(o,l,u,f){const b=this.layers[0],y=[];let S=null;"circle"===b.type&&(S=b.layout.get("circle-sort-key"));for(const{feature:E,id:M,index:P,sourceLayerIndex:O}of o){const B=this.layers[0]._featureFilter.needGeometry,V=Lh(E,B);if(!this.layers[0]._featureFilter.filter(new he(this.zoom),V,u))continue;const G=S?S.evaluate(V,{},u):void 0,Z={id:M,properties:E.properties,type:E.type,sourceLayerIndex:O,index:P,geometry:B?V.geometry:Fc(E,u,f),patterns:{},sortKey:G};y.push(Z)}S&&y.sort((E,M)=>E.sortKey-M.sortKey);let T=null;"globe"===f.projection.name&&(this.globeExtVertexArray=new ma,T=f.projection);for(const E of y){const{geometry:M,index:P,sourceLayerIndex:O}=E,B=o[P].feature;this.addFeature(E,M,P,l.availableImages,u,T),l.featureIndex.insert(B,M,P,O,this.index)}}update(o,l,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,l,this.stateDependentLayers,u,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,RS.members),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=o.createVertexBuffer(this.globeExtVertexArray,Be.members))),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(o,l,u,f,b,y){for(const S of l)for(const T of S){const E=T.x,M=T.y;if(E<0||E>=Mn||M<0||M>=Mn)continue;if(y){const B=y.projectTilePoint(E,M,b),V=y.upVector(b,E,M),G=this.globeExtVertexArray;Nm(G,B,V),Nm(G,B,V),Nm(G,B,V),Nm(G,B,V)}const P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,o.sortKey),O=P.vertexLength;Fm(this.layoutVertexArray,E,M,-1,-1),Fm(this.layoutVertexArray,E,M,1,-1),Fm(this.layoutVertexArray,E,M,1,1),Fm(this.layoutVertexArray,E,M,-1,1),this.indexArray.emplaceBack(O,O+1,O+2),this.indexArray.emplaceBack(O,O+2,O+3),P.vertexLength+=4,P.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,u,{},f,b)}}function lf(a,o){for(let l=0;l<a.length;l++)if(vu(o,a[l]))return!0;for(let l=0;l<o.length;l++)if(vu(a,o[l]))return!0;return!!Cv(a,o)}function xv(a,o,l){return!!vu(a,o)||!!Dv(o,a,l)}function wv(a,o){if(1===a.length)return Ev(o,a[0]);for(let l=0;l<o.length;l++){const u=o[l];for(let f=0;f<u.length;f++)if(vu(a,u[f]))return!0}for(let l=0;l<a.length;l++)if(Ev(o,a[l]))return!0;for(let l=0;l<o.length;l++)if(Cv(a,o[l]))return!0;return!1}function Sv(a,o,l){if(a.length>1){if(Cv(a,o))return!0;for(let u=0;u<o.length;u++)if(Dv(o[u],a,l))return!0}for(let u=0;u<a.length;u++)if(Dv(a[u],o,l))return!0;return!1}function Cv(a,o){if(0===a.length||0===o.length)return!1;for(let l=0;l<a.length-1;l++){const u=a[l],f=a[l+1];for(let b=0;b<o.length-1;b++)if(Tv(u,f,o[b],o[b+1]))return!0}return!1}function Tv(a,o,l,u){return ir(a,l,u)!==ir(o,l,u)&&ir(a,o,l)!==ir(a,o,u)}function Dv(a,o,l){const u=l*l;if(1===o.length)return a.distSqr(o[0])<u;for(let f=1;f<o.length;f++)if(Bm(a,o[f-1],o[f])<u)return!0;return!1}function Bm(a,o,l){const u=o.distSqr(l);if(0===u)return a.distSqr(o);const f=((a.x-o.x)*(l.x-o.x)+(a.y-o.y)*(l.y-o.y))/u;return a.distSqr(f<0?o:f>1?l:l.sub(o)._mult(f)._add(o))}function Ev(a,o){let l,u,f,b=!1;for(let y=0;y<a.length;y++){l=a[y];for(let S=0,T=l.length-1;S<l.length;T=S++)u=l[S],f=l[T],u.y>o.y!=f.y>o.y&&o.x<(f.x-u.x)*(o.y-u.y)/(f.y-u.y)+u.x&&(b=!b)}return b}function vu(a,o){let l=!1;for(let u=0,f=a.length-1;u<a.length;f=u++){const b=a[u],y=a[f];b.y>o.y!=y.y>o.y&&o.x<(y.x-b.x)*(o.y-b.y)/(y.y-b.y)+b.x&&(l=!l)}return l}function cf(a,o,l,u,f){for(const y of a)if(o<=y.x&&l<=y.y&&u>=y.x&&f>=y.y)return!0;const b=[new mt(o,l),new mt(o,f),new mt(u,f),new mt(u,l)];if(a.length>2)for(const y of b)if(vu(a,y))return!0;for(let y=0;y<a.length-1;y++)if(kb(a[y],a[y+1],b))return!0;return!1}function kb(a,o,l){const u=l[0],f=l[2];if(a.x<u.x&&o.x<u.x||a.x>f.x&&o.x>f.x||a.y<u.y&&o.y<u.y||a.y>f.y&&o.y>f.y)return!1;const b=ir(a,o,l[0]);return b!==ir(a,o,l[1])||b!==ir(a,o,l[2])||b!==ir(a,o,l[3])}function Pl(a,o,l){const u=o.paint.get(a).value;return"constant"===u.kind?u.value:l.programConfigurations.get(o.id).getMaxValue(a)}function zm(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function Iv(a,o,l,u,f){if(!o[0]&&!o[1])return a;const b=mt.convert(o)._mult(f);"viewport"===l&&b._rotate(-u);const y=[];for(let S=0;S<a.length;S++)y.push(a[S].sub(b));return y}function OS(a,o,l,u){const f=mt.convert(a)._mult(u);return"viewport"===o&&f._rotate(-l),f}tn(Ab,"CircleBucket",{omit:["layers"]});const Vm=new Lt({"circle-sort-key":new Me(ct.layout_circle["circle-sort-key"])});var Rb={paint:new Lt({"circle-radius":new Me(ct.paint_circle["circle-radius"]),"circle-color":new Me(ct.paint_circle["circle-color"]),"circle-blur":new Me(ct.paint_circle["circle-blur"]),"circle-opacity":new Me(ct.paint_circle["circle-opacity"]),"circle-translate":new qe(ct.paint_circle["circle-translate"]),"circle-translate-anchor":new qe(ct.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new qe(ct.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new qe(ct.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Me(ct.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Me(ct.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Me(ct.paint_circle["circle-stroke-opacity"])}),layout:Vm},uf=1e-6,Ks="undefined"!=typeof Float32Array?Float32Array:Array;function Pb(){var a=new Ks(9);return Ks!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function xu(a,o,l){var u=o[0],f=o[1],b=o[2],y=o[3],S=o[4],T=o[5],E=o[6],M=o[7],P=o[8],O=l[0],B=l[1],V=l[2],G=l[3],Z=l[4],ce=l[5],ye=l[6],ue=l[7],ge=l[8];return a[0]=O*u+B*y+V*E,a[1]=O*f+B*S+V*M,a[2]=O*b+B*T+V*P,a[3]=G*u+Z*y+ce*E,a[4]=G*f+Z*S+ce*M,a[5]=G*b+Z*T+ce*P,a[6]=ye*u+ue*y+ge*E,a[7]=ye*f+ue*S+ge*M,a[8]=ye*b+ue*T+ge*P,a}function ic(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function Ob(a,o){var l=o[0],u=o[1],f=o[2],b=o[3],y=o[4],S=o[5],T=o[6],E=o[7],M=o[8],P=o[9],O=o[10],B=o[11],V=o[12],G=o[13],Z=o[14],ce=o[15],ye=l*S-u*y,ue=l*T-f*y,ge=l*E-b*y,De=u*T-f*S,xe=u*E-b*S,tt=f*E-b*T,Ze=M*G-P*V,lt=M*Z-O*V,Mt=M*ce-B*V,ot=P*Z-O*G,_t=P*ce-B*G,yt=O*ce-B*Z,Ct=ye*yt-ue*_t+ge*ot+De*Mt-xe*lt+tt*Ze;return Ct?(a[0]=(S*yt-T*_t+E*ot)*(Ct=1/Ct),a[1]=(f*_t-u*yt-b*ot)*Ct,a[2]=(G*tt-Z*xe+ce*De)*Ct,a[3]=(O*xe-P*tt-B*De)*Ct,a[4]=(T*Mt-y*yt-E*lt)*Ct,a[5]=(l*yt-f*Mt+b*lt)*Ct,a[6]=(Z*ge-V*tt-ce*ue)*Ct,a[7]=(M*tt-O*ge+B*ue)*Ct,a[8]=(y*_t-S*Mt+E*Ze)*Ct,a[9]=(u*Mt-l*_t-b*Ze)*Ct,a[10]=(V*xe-G*ge+ce*ye)*Ct,a[11]=(P*ge-M*xe-B*ye)*Ct,a[12]=(S*lt-y*ot-T*Ze)*Ct,a[13]=(l*ot-u*lt+f*Ze)*Ct,a[14]=(G*ue-V*De-Z*ye)*Ct,a[15]=(M*De-P*ue+O*ye)*Ct,a):null}function Fh(a,o,l){var u=o[0],f=o[1],b=o[2],y=o[3],S=o[4],T=o[5],E=o[6],M=o[7],P=o[8],O=o[9],B=o[10],V=o[11],G=o[12],Z=o[13],ce=o[14],ye=o[15],ue=l[0],ge=l[1],De=l[2],xe=l[3];return a[0]=ue*u+ge*S+De*P+xe*G,a[1]=ue*f+ge*T+De*O+xe*Z,a[2]=ue*b+ge*E+De*B+xe*ce,a[3]=ue*y+ge*M+De*V+xe*ye,a[4]=(ue=l[4])*u+(ge=l[5])*S+(De=l[6])*P+(xe=l[7])*G,a[5]=ue*f+ge*T+De*O+xe*Z,a[6]=ue*b+ge*E+De*B+xe*ce,a[7]=ue*y+ge*M+De*V+xe*ye,a[8]=(ue=l[8])*u+(ge=l[9])*S+(De=l[10])*P+(xe=l[11])*G,a[9]=ue*f+ge*T+De*O+xe*Z,a[10]=ue*b+ge*E+De*B+xe*ce,a[11]=ue*y+ge*M+De*V+xe*ye,a[12]=(ue=l[12])*u+(ge=l[13])*S+(De=l[14])*P+(xe=l[15])*G,a[13]=ue*f+ge*T+De*O+xe*Z,a[14]=ue*b+ge*E+De*B+xe*ce,a[15]=ue*y+ge*M+De*V+xe*ye,a}function df(a,o,l){var u,f,b,y,S,T,E,M,P,O,B,V,G=l[0],Z=l[1],ce=l[2];return o===a?(a[12]=o[0]*G+o[4]*Z+o[8]*ce+o[12],a[13]=o[1]*G+o[5]*Z+o[9]*ce+o[13],a[14]=o[2]*G+o[6]*Z+o[10]*ce+o[14],a[15]=o[3]*G+o[7]*Z+o[11]*ce+o[15]):(f=o[1],b=o[2],y=o[3],S=o[4],T=o[5],E=o[6],M=o[7],P=o[8],O=o[9],B=o[10],V=o[11],a[0]=u=o[0],a[1]=f,a[2]=b,a[3]=y,a[4]=S,a[5]=T,a[6]=E,a[7]=M,a[8]=P,a[9]=O,a[10]=B,a[11]=V,a[12]=u*G+S*Z+P*ce+o[12],a[13]=f*G+T*Z+O*ce+o[13],a[14]=b*G+E*Z+B*ce+o[14],a[15]=y*G+M*Z+V*ce+o[15]),a}function _d(a,o,l){var u=l[0],f=l[1],b=l[2];return a[0]=o[0]*u,a[1]=o[1]*u,a[2]=o[2]*u,a[3]=o[3]*u,a[4]=o[4]*f,a[5]=o[5]*f,a[6]=o[6]*f,a[7]=o[7]*f,a[8]=o[8]*b,a[9]=o[9]*b,a[10]=o[10]*b,a[11]=o[11]*b,a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15],a}function Js(a,o,l){var u=Math.sin(l),f=Math.cos(l),b=o[4],y=o[5],S=o[6],T=o[7],E=o[8],M=o[9],P=o[10],O=o[11];return o!==a&&(a[0]=o[0],a[1]=o[1],a[2]=o[2],a[3]=o[3],a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15]),a[4]=b*f+E*u,a[5]=y*f+M*u,a[6]=S*f+P*u,a[7]=T*f+O*u,a[8]=E*f-b*u,a[9]=M*f-y*u,a[10]=P*f-S*u,a[11]=O*f-T*u,a}function Na(a,o,l){var u=Math.sin(l),f=Math.cos(l),b=o[0],y=o[1],S=o[2],T=o[3],E=o[8],M=o[9],P=o[10],O=o[11];return o!==a&&(a[4]=o[4],a[5]=o[5],a[6]=o[6],a[7]=o[7],a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15]),a[0]=b*f-E*u,a[1]=y*f-M*u,a[2]=S*f-P*u,a[3]=T*f-O*u,a[8]=b*u+E*f,a[9]=y*u+M*f,a[10]=S*u+P*f,a[11]=T*u+O*f,a}function Mv(a,o){return a[0]=o[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=o[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=o[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function Av(a,o,l){var u,f,b,y=l[0],S=l[1],T=l[2],E=Math.hypot(y,S,T);return E<uf?null:(y*=E=1/E,S*=E,T*=E,u=Math.sin(o),f=Math.cos(o),a[0]=y*y*(b=1-f)+f,a[1]=S*y*b+T*u,a[2]=T*y*b-S*u,a[3]=0,a[4]=y*S*b-T*u,a[5]=S*S*b+f,a[6]=T*S*b+y*u,a[7]=0,a[8]=y*T*b+S*u,a[9]=S*T*b-y*u,a[10]=T*T*b+f,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a)}Math.hypot||(Math.hypot=function(){for(var a=0,o=arguments.length;o--;)a+=arguments[o]*arguments[o];return Math.sqrt(a)});var LS=Fh;function Lb(){var a=new Ks(3);return Ks!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function kv(a){var o=new Ks(3);return o[0]=a[0],o[1]=a[1],o[2]=a[2],o}function hf(a){return Math.hypot(a[0],a[1],a[2])}function yd(a,o,l){var u=new Ks(3);return u[0]=a,u[1]=o,u[2]=l,u}function Nc(a,o,l){return a[0]=o[0]+l[0],a[1]=o[1]+l[1],a[2]=o[2]+l[2],a}function Fb(a,o,l){return a[0]=o[0]-l[0],a[1]=o[1]-l[1],a[2]=o[2]-l[2],a}function Rv(a,o,l){return a[0]=o[0]*l[0],a[1]=o[1]*l[1],a[2]=o[2]*l[2],a}function pf(a,o,l){return a[0]=Math.min(o[0],l[0]),a[1]=Math.min(o[1],l[1]),a[2]=Math.min(o[2],l[2]),a}function jm(a,o,l){return a[0]=Math.max(o[0],l[0]),a[1]=Math.max(o[1],l[1]),a[2]=Math.max(o[2],l[2]),a}function Ba(a,o,l){return a[0]=o[0]*l,a[1]=o[1]*l,a[2]=o[2]*l,a}function Bc(a,o,l,u){return a[0]=o[0]+l[0]*u,a[1]=o[1]+l[1]*u,a[2]=o[2]+l[2]*u,a}function Ds(a,o){var l=o[0],u=o[1],f=o[2],b=l*l+u*u+f*f;return b>0&&(b=1/Math.sqrt(b)),a[0]=o[0]*b,a[1]=o[1]*b,a[2]=o[2]*b,a}function Ao(a,o){return a[0]*o[0]+a[1]*o[1]+a[2]*o[2]}function vd(a,o,l){var u=o[0],f=o[1],b=o[2],y=l[0],S=l[1],T=l[2];return a[0]=f*T-b*S,a[1]=b*y-u*T,a[2]=u*S-f*y,a}function mo(a,o,l){var u=o[0],f=o[1],b=o[2],y=l[3]*u+l[7]*f+l[11]*b+l[15];return a[0]=(l[0]*u+l[4]*f+l[8]*b+l[12])/(y=y||1),a[1]=(l[1]*u+l[5]*f+l[9]*b+l[13])/y,a[2]=(l[2]*u+l[6]*f+l[10]*b+l[14])/y,a}function Nb(a,o,l){var u=l[0],f=l[1],b=l[2],y=o[0],S=o[1],T=o[2],E=f*T-b*S,M=b*y-u*T,P=u*S-f*y,O=f*P-b*M,B=b*E-u*P,V=u*M-f*E,G=2*l[3];return M*=G,P*=G,B*=2,V*=2,a[0]=y+(E*=G)+(O*=2),a[1]=S+M+B,a[2]=T+P+V,a}var Nh,rc=Fb,AE=Rv,kE=hf;function Um(a,o,l){return a[0]=o[0]*l,a[1]=o[1]*l,a[2]=o[2]*l,a[3]=o[3]*l,a}function Hm(a,o){var l=o[0],u=o[1],f=o[2],b=o[3],y=l*l+u*u+f*f+b*b;return y>0&&(y=1/Math.sqrt(y)),a[0]=l*y,a[1]=u*y,a[2]=f*y,a[3]=b*y,a}function zc(a,o,l){var u=o[0],f=o[1],b=o[2],y=o[3];return a[0]=l[0]*u+l[4]*f+l[8]*b+l[12]*y,a[1]=l[1]*u+l[5]*f+l[9]*b+l[13]*y,a[2]=l[2]*u+l[6]*f+l[10]*b+l[14]*y,a[3]=l[3]*u+l[7]*f+l[11]*b+l[15]*y,a}function FS(){var a=new Ks(4);return Ks!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function NS(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a}function Bb(a,o,l){l*=.5;var u=o[0],f=o[1],b=o[2],y=o[3],S=Math.sin(l),T=Math.cos(l);return a[0]=u*T+y*S,a[1]=f*T+b*S,a[2]=b*T-f*S,a[3]=y*T-u*S,a}function Pv(a,o,l){l*=.5;var u=o[0],f=o[1],b=o[2],y=o[3],S=Math.sin(l),T=Math.cos(l);return a[0]=u*T-b*S,a[1]=f*T+y*S,a[2]=b*T+u*S,a[3]=y*T-f*S,a}Lb(),Nh=new Ks(4),Ks!=Float32Array&&(Nh[0]=0,Nh[1]=0,Nh[2]=0,Nh[3]=0);var BS=Hm;Lb(),yd(1,0,0),yd(0,1,0),FS(),FS(),Pb();class zb{constructor(o,l){this.pos=o,this.dir=l}intersectsPlane(o,l,u){const f=Ao(l,this.dir);if(Math.abs(f)<1e-6)return!1;const b=((o[0]-this.pos[0])*l[0]+(o[1]-this.pos[1])*l[1]+(o[2]-this.pos[2])*l[2])/f;return u[0]=this.pos[0]+this.dir[0]*b,u[1]=this.pos[1]+this.dir[1]*b,u[2]=this.pos[2]+this.dir[2]*b,!0}closestPointOnSphere(o,l,u){if(G=(B=this.pos)[0],Z=B[1],ce=B[2],ye=(V=o)[0],ue=V[1],ge=V[2],Math.abs(G-ye)<=uf*Math.max(1,Math.abs(G),Math.abs(ye))&&Math.abs(Z-ue)<=uf*Math.max(1,Math.abs(Z),Math.abs(ue))&&Math.abs(ce-ge)<=uf*Math.max(1,Math.abs(ce),Math.abs(ge))||0===l)return u[0]=u[1]=u[2]=0,!1;var B,V,G,Z,ce,ye,ue,ge;const[f,b,y]=this.dir,S=this.pos[0]-o[0],T=this.pos[1]-o[1],E=this.pos[2]-o[2],M=f*f+b*b+y*y,P=2*(S*f+T*b+E*y),O=P*P-4*M*(S*S+T*T+E*E-l*l);if(O<0){const B=Math.max(-P/2,0),V=S+f*B,G=T+b*B,Z=E+y*B,ce=Math.hypot(V,G,Z);return u[0]=V*l/ce,u[1]=G*l/ce,u[2]=Z*l/ce,!1}{const B=(-P-Math.sqrt(O))/(2*M);if(B<0){const V=Math.hypot(S,T,E);return u[0]=S*l/V,u[1]=T*l/V,u[2]=E*l/V,!1}return u[0]=S+f*B,u[1]=T+b*B,u[2]=E+y*B,!0}}}class Vb{constructor(o,l,u,f,b){this.TL=o,this.TR=l,this.BR=u,this.BL=f,this.horizon=b}static fromInvProjectionMatrix(o,l,u){const f=[-1,1,1],b=[1,1,1],y=[1,-1,1],S=[-1,-1,1],T=mo(f,f,o),E=mo(b,b,o),M=mo(y,y,o),P=mo(S,S,o);return new Vb(T,E,M,P,l/u)}}class $m{constructor(o,l){this.points=o,this.planes=l}static fromInvProjectionMatrix(o,l,u,f){const b=Math.pow(2,u),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(T=>{const E=zc([],T,o),M=1/E[3]/l*b;return(P=E)[0]=(O=E)[0]*(B=[M,M,f?1/E[3]:M,M])[0],P[1]=O[1]*B[1],P[2]=O[2]*B[2],P[3]=O[3]*B[3],P;var P,O,B}),S=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(T=>{const E=Ds([],vd([],rc([],y[T[0]],y[T[1]]),rc([],y[T[2]],y[T[1]]))),M=-Ao(E,y[T[1]]);return E.concat(M)});return new $m(y,S)}}class Zo{static fromPoints(o){const l=[1/0,1/0,1/0],u=[-1/0,-1/0,-1/0];for(const f of o)pf(l,l,f),jm(u,u,f);return new Zo(l,u)}static applyTransform(o,l){const u=o.getCorners();for(let f=0;f<u.length;++f)mo(u[f],u[f],l);return Zo.fromPoints(u)}constructor(o,l){this.min=o,this.max=l,this.center=Ba([],Nc([],this.min,this.max),.5)}quadrant(o){const l=[o%2==0,o<2],u=kv(this.min),f=kv(this.max);for(let b=0;b<l.length;b++)u[b]=l[b]?this.min[b]:this.center[b],f[b]=l[b]?this.center[b]:this.max[b];return f[2]=this.max[2],new Zo(u,f)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}distanceZ(o){return Math.max(Math.min(this.max[2],o[2]),this.min[2])-o[2]}getCorners(){const o=this.min,l=this.max;return[[o[0],o[1],o[2]],[l[0],o[1],o[2]],[l[0],l[1],o[2]],[o[0],l[1],o[2]],[o[0],o[1],l[2]],[l[0],o[1],l[2]],[l[0],l[1],l[2]],[o[0],l[1],l[2]]]}intersects(o){const l=this.getCorners();let u=!0;for(let f=0;f<o.planes.length;f++){const b=o.planes[f];let y=0;for(let S=0;S<l.length;S++)y+=Ao(b,l[S])+b[3]>=0;if(0===y)return 0;y!==l.length&&(u=!1)}if(u)return 2;for(let f=0;f<3;f++){let b=Number.MAX_VALUE,y=-Number.MAX_VALUE;for(let S=0;S<o.points.length;S++){const T=o.points[S][f]-this.min[f];b=Math.min(b,T),y=Math.max(y,T)}if(y<0||b>this.max[f]-this.min[f])return 0}return 1}}function jb(a,o,l,u,f,b,y,S,T){if(b&&a.queryGeometry.isAboveHorizon)return!1;b&&(T*=a.pixelToTileUnitsFactor);const E=a.tileID.canonical,M=l.projection.upVectorScale(E,l.center.lat,l.worldSize).metersToTile;for(const P of o)for(const O of P){const B=O.add(S),V=f&&l.elevation?l.elevation.exaggeration()*f.getElevationAt(B.x,B.y,!0):0,G=l.projection.projectTilePoint(B.x,B.y,E);if(V>0){const ue=l.projection.upVector(E,B.x,B.y);G.x+=ue[0]*M*V,G.y+=ue[1]*M*V,G.z+=ue[2]*M*V}const Z=b?B:Ub(G.x,G.y,G.z,u),ce=b?a.tilespaceRays.map(ue=>zS(ue,V)):a.queryGeometry.screenGeometry,ye=zc([],[G.x,G.y,G.z,1],u);if(!y&&b?T*=ye[3]/l.cameraToCenterDistance:y&&!b&&(T*=l.cameraToCenterDistance/ye[3]),b){const ue=us((O.y/Mn+E.y)/(1<<E.z));T/=l.projection.pixelsPerMeter(ue,1)/Fa(1,ue)}if(xv(ce,Z,T))return!0}return!1}function Ub(a,o,l,u){const f=zc([],[a,o,l,1],u);return new mt(f[0]/f[3],f[1]/f[3])}const Ov=yd(0,0,0),Ar=yd(0,0,1);function zS(a,o){const l=Lb();return Ov[2]=o,a.intersectsPlane(Ov,Ar,l),new mt(l[0],l[1])}class Lv extends Ab{}function xd(a,{width:o,height:l},u,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==o*l*u)throw new RangeError("mismatched image size")}else f=new Uint8Array(o*l*u);return a.width=o,a.height=l,a.data=f,a}function Hb(a,o,l){const{width:u,height:f}=o;u===a.width&&f===a.height||($b(a,o,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,u),height:Math.min(a.height,f)},l),a.width=u,a.height=f,a.data=o.data)}function $b(a,o,l,u,f,b){if(0===f.width||0===f.height)return o;if(f.width>a.width||f.height>a.height||l.x>a.width-f.width||l.y>a.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>o.width||f.height>o.height||u.x>o.width-f.width||u.y>o.height-f.height)throw new RangeError("out of range destination coordinates for image copy");const y=a.data,S=o.data;for(let T=0;T<f.height;T++){const E=((l.y+T)*a.width+l.x)*b,M=((u.y+T)*o.width+u.x)*b;for(let P=0;P<f.width*b;P++)S[M+P]=y[E+P]}return o}tn(Lv,"HeatmapBucket",{omit:["layers"]});class Vc{constructor(o,l){xd(this,o,1,l)}resize(o){Hb(this,new Vc(o),1)}clone(){return new Vc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,l,u,f,b){$b(o,l,u,f,b,1)}}class ya{constructor(o,l){xd(this,o,4,l)}resize(o){Hb(this,new ya(o),4)}replace(o,l){l?this.data.set(o):this.data=o instanceof Uint8ClampedArray?new Uint8Array(o.buffer):o}clone(){return new ya({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,l,u,f,b){$b(o,l,u,f,b,4)}}tn(Vc,"AlphaImage"),tn(ya,"RGBAImage");var VS={paint:new Lt({"heatmap-radius":new Me(ct.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Me(ct.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new qe(ct.paint_heatmap["heatmap-intensity"]),"heatmap-color":new jt(ct.paint_heatmap["heatmap-color"]),"heatmap-opacity":new qe(ct.paint_heatmap["heatmap-opacity"])})};function Gb(a){const o={},l=a.resolution||256,u=a.clips?a.clips.length:1,f=a.image||new ya({width:l,height:u}),b=(y,S,T)=>{o[a.evaluationKey]=T;const E=a.expression.evaluate(o);f.data[y+S+0]=Math.floor(255*E.r/E.a),f.data[y+S+1]=Math.floor(255*E.g/E.a),f.data[y+S+2]=Math.floor(255*E.b/E.a),f.data[y+S+3]=Math.floor(255*E.a)};if(a.clips)for(let y=0,S=0;y<u;++y,S+=4*l)for(let T=0,E=0;T<l;T++,E+=4){const M=T/(l-1),{start:P,end:O}=a.clips[y];b(S,E,P*(1-M)+O*M)}else for(let y=0,S=0;y<l;y++,S+=4)b(0,S,y/(l-1));return f}var RE={paint:new Lt({"hillshade-illumination-direction":new qe(ct.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new qe(ct.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new qe(ct.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new qe(ct.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new qe(ct.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new qe(ct.paint_hillshade["hillshade-accent-color"])})};const PE=Nt([{name:"a_pos",components:2,type:"Int16"}],4),{members:ff}=PE;var wd={exports:{}};function Gm(a,o,l){l=l||2;var u,f,b,y,S,T,E,M=o&&o.length,P=M?o[0]*l:a.length,O=qm(a,0,P,l,!0),B=[];if(!O||O.next===O.prev)return B;if(M&&(O=function(G,Z,ce,ye){var ue,ge,De,xe=[];for(ue=0,ge=Z.length;ue<ge;ue++)(De=qm(G,Z[ue]*ye,ue<ge-1?Z[ue+1]*ye:G.length,ye,!1))===De.next&&(De.steiner=!0),xe.push(WS(De));for(xe.sort($S),ue=0;ue<xe.length;ue++)ce=GS(xe[ue],ce);return ce}(a,o,O,l)),a.length>80*l){u=b=a[0],f=y=a[1];for(var V=l;V<P;V+=l)(S=a[V])<u&&(u=S),(T=a[V+1])<f&&(f=T),S>b&&(b=S),T>y&&(y=T);E=0!==(E=Math.max(b-u,y-f))?32767/E:0}return mf(O,B,l,u,f,E,0),B}function qm(a,o,l,u,f){var b,y;if(f===qb(a,o,l,u)>0)for(b=o;b<l;b+=u)y=Es(b,a[b],a[b+1],y);else for(b=l-u;b>=o;b-=u)y=Es(b,a[b],a[b+1],y);return y&&Wm(y,y.next)&&(jc(y),y=y.next),y}function va(a,o){if(!a)return a;o||(o=a);var l,u=a;do{if(l=!1,u.steiner||!Wm(u,u.next)&&0!==ro(u.prev,u,u.next))u=u.next;else{if(jc(u),(u=o=u.prev)===u.next)break;l=!0}}while(l||u!==o);return o}function mf(a,o,l,u,f,b,y){if(a){!y&&b&&function(M,P,O,B){var V=M;do{0===V.z&&(V.z=gf(V.x,V.y,P,O,B)),V.prevZ=V.prev,V.nextZ=V.next,V=V.next}while(V!==M);V.prevZ.nextZ=null,V.prevZ=null,function(G){var Z,ce,ye,ue,ge,De,xe,tt,Ze=1;do{for(ce=G,G=null,ge=null,De=0;ce;){for(De++,ye=ce,xe=0,Z=0;Z<Ze&&(xe++,ye=ye.nextZ);Z++);for(tt=Ze;xe>0||tt>0&&ye;)0!==xe&&(0===tt||!ye||ce.z<=ye.z)?(ue=ce,ce=ce.nextZ,xe--):(ue=ye,ye=ye.nextZ,tt--),ge?ge.nextZ=ue:G=ue,ue.prevZ=ge,ge=ue;ce=ye}ge.nextZ=null,Ze*=2}while(De>1)}(V)}(a,u,f,b);for(var S,T,E=a;a.prev!==a.next;)if(S=a.prev,T=a.next,b?US(a,u,f,b):jS(a))o.push(S.i/l|0),o.push(a.i/l|0),o.push(T.i/l|0),jc(a),a=T.next,E=T.next;else if((a=T)===E){y?1===y?mf(a=Fv(va(a),o,l),o,l,u,f,b,2):2===y&&HS(a,o,l,u,f,b):mf(va(a),o,l,u,f,b,1);break}}}function jS(a){var o=a.prev,l=a,u=a.next;if(ro(o,l,u)>=0)return!1;for(var f=o.x,b=l.x,y=u.x,S=o.y,T=l.y,E=u.y,M=f<b?f<y?f:y:b<y?b:y,P=S<T?S<E?S:E:T<E?T:E,O=f>b?f>y?f:y:b>y?b:y,B=S>T?S>E?S:E:T>E?T:E,V=u.next;V!==o;){if(V.x>=M&&V.x<=O&&V.y>=P&&V.y<=B&&Bh(f,S,b,T,y,E,V.x,V.y)&&ro(V.prev,V,V.next)>=0)return!1;V=V.next}return!0}function US(a,o,l,u){var f=a.prev,b=a,y=a.next;if(ro(f,b,y)>=0)return!1;for(var S=f.x,T=b.x,E=y.x,M=f.y,P=b.y,O=y.y,B=S<T?S<E?S:E:T<E?T:E,V=M<P?M<O?M:O:P<O?P:O,G=S>T?S>E?S:E:T>E?T:E,Z=M>P?M>O?M:O:P>O?P:O,ce=gf(B,V,o,l,u),ye=gf(G,Z,o,l,u),ue=a.prevZ,ge=a.nextZ;ue&&ue.z>=ce&&ge&&ge.z<=ye;){if(ue.x>=B&&ue.x<=G&&ue.y>=V&&ue.y<=Z&&ue!==f&&ue!==y&&Bh(S,M,T,P,E,O,ue.x,ue.y)&&ro(ue.prev,ue,ue.next)>=0||(ue=ue.prevZ,ge.x>=B&&ge.x<=G&&ge.y>=V&&ge.y<=Z&&ge!==f&&ge!==y&&Bh(S,M,T,P,E,O,ge.x,ge.y)&&ro(ge.prev,ge,ge.next)>=0))return!1;ge=ge.nextZ}for(;ue&&ue.z>=ce;){if(ue.x>=B&&ue.x<=G&&ue.y>=V&&ue.y<=Z&&ue!==f&&ue!==y&&Bh(S,M,T,P,E,O,ue.x,ue.y)&&ro(ue.prev,ue,ue.next)>=0)return!1;ue=ue.prevZ}for(;ge&&ge.z<=ye;){if(ge.x>=B&&ge.x<=G&&ge.y>=V&&ge.y<=Z&&ge!==f&&ge!==y&&Bh(S,M,T,P,E,O,ge.x,ge.y)&&ro(ge.prev,ge,ge.next)>=0)return!1;ge=ge.nextZ}return!0}function Fv(a,o,l){var u=a;do{var f=u.prev,b=u.next.next;!Wm(f,b)&&Nv(f,u,u.next,b)&&Vh(f,b)&&Vh(b,f)&&(o.push(f.i/l|0),o.push(u.i/l|0),o.push(b.i/l|0),jc(u),jc(u.next),u=a=b),u=u.next}while(u!==a);return va(u)}function HS(a,o,l,u,f,b){var y=a;do{for(var S=y.next.next;S!==y.prev;){if(y.i!==S.i&&XS(y,S)){var T=Xm(y,S);return y=va(y,y.next),T=va(T,T.next),mf(y,o,l,u,f,b,0),void mf(T,o,l,u,f,b,0)}S=S.next}y=y.next}while(y!==a)}function $S(a,o){return a.x-o.x}function GS(a,o){var l=function(f,b){var y,S=b,T=f.x,E=f.y,M=-1/0;do{if(E<=S.y&&E>=S.next.y&&S.next.y!==S.y){var P=S.x+(E-S.y)*(S.next.x-S.x)/(S.next.y-S.y);if(P<=T&&P>M&&(M=P,y=S.x<S.next.x?S:S.next,P===T))return y}S=S.next}while(S!==b);if(!y)return null;var O,B=y,V=y.x,G=y.y,Z=1/0;S=y;do{T>=S.x&&S.x>=V&&T!==S.x&&Bh(E<G?T:M,E,V,G,E<G?M:T,E,S.x,S.y)&&(O=Math.abs(E-S.y)/(T-S.x),Vh(S,f)&&(O<Z||O===Z&&(S.x>y.x||S.x===y.x&&qS(y,S)))&&(y=S,Z=O)),S=S.next}while(S!==B);return y}(a,o);if(!l)return o;var u=Xm(l,a);return va(u,u.next),va(l,l.next)}function qS(a,o){return ro(a.prev,a,o.prev)<0&&ro(o.next,a,a.next)<0}function gf(a,o,l,u,f){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-l)*f|0)|a<<8))|a<<4))|a<<2))|a<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-u)*f|0)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function WS(a){var o=a,l=a;do{(o.x<l.x||o.x===l.x&&o.y<l.y)&&(l=o),o=o.next}while(o!==a);return l}function Bh(a,o,l,u,f,b,y,S){return(f-y)*(o-S)>=(a-y)*(b-S)&&(a-y)*(u-S)>=(l-y)*(o-S)&&(l-y)*(b-S)>=(f-y)*(u-S)}function XS(a,o){return a.next.i!==o.i&&a.prev.i!==o.i&&!function(l,u){var f=l;do{if(f.i!==l.i&&f.next.i!==l.i&&f.i!==u.i&&f.next.i!==u.i&&Nv(f,f.next,l,u))return!0;f=f.next}while(f!==l);return!1}(a,o)&&(Vh(a,o)&&Vh(o,a)&&function(l,u){var f=l,b=!1,y=(l.x+u.x)/2,S=(l.y+u.y)/2;do{f.y>S!=f.next.y>S&&f.next.y!==f.y&&y<(f.next.x-f.x)*(S-f.y)/(f.next.y-f.y)+f.x&&(b=!b),f=f.next}while(f!==l);return b}(a,o)&&(ro(a.prev,a,o.prev)||ro(a,o.prev,o))||Wm(a,o)&&ro(a.prev,a,a.next)>0&&ro(o.prev,o,o.next)>0)}function ro(a,o,l){return(o.y-a.y)*(l.x-o.x)-(o.x-a.x)*(l.y-o.y)}function Wm(a,o){return a.x===o.x&&a.y===o.y}function Nv(a,o,l,u){var f=zh(ro(a,o,l)),b=zh(ro(a,o,u)),y=zh(ro(l,u,a)),S=zh(ro(l,u,o));return f!==b&&y!==S||!(0!==f||!ds(a,l,o))||!(0!==b||!ds(a,u,o))||!(0!==y||!ds(l,a,u))||!(0!==S||!ds(l,o,u))}function ds(a,o,l){return o.x<=Math.max(a.x,l.x)&&o.x>=Math.min(a.x,l.x)&&o.y<=Math.max(a.y,l.y)&&o.y>=Math.min(a.y,l.y)}function zh(a){return a>0?1:a<0?-1:0}function Vh(a,o){return ro(a.prev,a,a.next)<0?ro(a,o,a.next)>=0&&ro(a,a.prev,o)>=0:ro(a,o,a.prev)<0||ro(a,a.next,o)<0}function Xm(a,o){var l=new bf(a.i,a.x,a.y),u=new bf(o.i,o.x,o.y),f=a.next,b=o.prev;return a.next=o,o.prev=a,l.next=f,f.prev=l,u.next=l,l.prev=u,b.next=u,u.prev=b,u}function Es(a,o,l,u){var f=new bf(a,o,l);return u?(f.next=u.next,f.prev=u,u.next.prev=f,u.next=f):(f.prev=f,f.next=f),f}function jc(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function bf(a,o,l){this.i=a,this.x=o,this.y=l,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function qb(a,o,l,u){for(var f=0,b=o,y=l-u;b<l;b+=u)f+=(a[y]-a[b])*(a[b+1]+a[y+1]),y=b;return f}function ZS(a,o,l,u,f){Wb(a,o,l||0,u||a.length-1,f||Bv)}function Wb(a,o,l,u,f){for(;u>l;){if(u-l>600){var b=u-l+1,y=o-l+1,S=Math.log(b),T=.5*Math.exp(2*S/3),E=.5*Math.sqrt(S*T*(b-T)/b)*(y-b/2<0?-1:1);Wb(a,o,Math.max(l,Math.floor(o-y*T/b+E)),Math.min(u,Math.floor(o+(b-y)*T/b+E)),f)}var M=a[o],P=l,O=u;for(_f(a,l,o),f(a[u],M)>0&&_f(a,l,u);P<O;){for(_f(a,P,O),P++,O--;f(a[P],M)<0;)P++;for(;f(a[O],M)>0;)O--}0===f(a[l],M)?_f(a,l,O):_f(a,++O,u),O<=o&&(l=O+1),o<=O&&(u=O-1)}}function _f(a,o,l){var u=a[o];a[o]=a[l],a[l]=u}function Bv(a,o){return a<o?-1:a>o?1:0}function Xb(a,o){const l=a.length;if(l<=1)return[a];const u=[];let f,b;for(let y=0;y<l;y++){const S=zt(a[y]);0!==S&&(a[y].area=Math.abs(S),void 0===b&&(b=S<0),b===S<0?(f&&u.push(f),f=[a[y]]):f.push(a[y]))}if(f&&u.push(f),o>1)for(let y=0;y<u.length;y++)u[y].length<=o||(ZS(u[y],o,1,u[y].length-1,zv),u[y]=u[y].slice(0,o));return u}function zv(a,o){return o.area-a.area}function Zb(a,o,l){const u=l.patternDependencies;let f=!1;for(const b of o){const y=b.paint.get(`${a}-pattern`);y.isConstant()||(f=!0);const S=y.constantOr(null);S&&(f=!0,u[S.to]=!0,u[S.from]=!0)}return f}function Yb(a,o,l,u,f){const b=f.patternDependencies;for(const y of o){const S=y.paint.get(`${a}-pattern`).value;if("constant"!==S.kind){let T=S.evaluate({zoom:u-1},l,{},f.availableImages),E=S.evaluate({zoom:u},l,{},f.availableImages),M=S.evaluate({zoom:u+1},l,{},f.availableImages);T=T&&T.name?T.name:T,E=E&&E.name?E.name:E,M=M&&M.name?M.name:M,b[T]=!0,b[E]=!0,b[M]=!0,l.patterns[y.id]={min:T,mid:E,max:M}}}return l}wd.exports=Gm,wd.exports.default=Gm,Gm.deviation=function(a,o,l,u){var f=o&&o.length,b=Math.abs(qb(a,0,f?o[0]*l:a.length,l));if(f)for(var y=0,S=o.length;y<S;y++)b-=Math.abs(qb(a,o[y]*l,y<S-1?o[y+1]*l:a.length,l));var T=0;for(y=0;y<u.length;y+=3){var E=u[y]*l,M=u[y+1]*l,P=u[y+2]*l;T+=Math.abs((a[E]-a[P])*(a[M+1]-a[E+1])-(a[E]-a[M])*(a[P+1]-a[E+1]))}return 0===b&&0===T?0:Math.abs((T-b)/b)},Gm.flatten=function(a){for(var o=a[0][0].length,l={vertices:[],holes:[],dimensions:o},u=0,f=0;f<a.length;f++){for(var b=0;b<a[f].length;b++)for(var y=0;y<o;y++)l.vertices.push(a[f][b][y]);f>0&&l.holes.push(u+=a[f-1].length)}return l};class Zm{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.id),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new bi,this.indexArray=new Co,this.indexArray2=new sl,this.programConfigurations=new Lc(o.layers,o.zoom),this.segments=new fo,this.segments2=new fo,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.projection=o.projection}populate(o,l,u,f){this.hasPattern=Zb("fill",this.layers,l);const b=this.layers[0].layout.get("fill-sort-key"),y=[];for(const{feature:S,id:T,index:E,sourceLayerIndex:M}of o){const P=this.layers[0]._featureFilter.needGeometry,O=Lh(S,P);if(!this.layers[0]._featureFilter.filter(new he(this.zoom),O,u))continue;const B=b?b.evaluate(O,{},u,l.availableImages):void 0,V={id:T,properties:S.properties,type:S.type,sourceLayerIndex:M,index:E,geometry:P?O.geometry:Fc(S,u,f),patterns:{},sortKey:B};y.push(V)}b&&y.sort((S,T)=>S.sortKey-T.sortKey);for(const S of y){const{geometry:T,index:E,sourceLayerIndex:M}=S;if(this.hasPattern){const P=Yb("fill",this.layers,S,this.zoom,l);this.patternFeatures.push(P)}else this.addFeature(S,T,E,u,{},l.availableImages);l.featureIndex.insert(o[E].feature,T,E,M,this.index)}}update(o,l,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,l,this.stateDependentLayers,u,f)}addFeatures(o,l,u,f,b){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,l,u,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,ff),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.indexBuffer2=o.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(o,l,u,f,b,y=[]){for(const S of Xb(l,500)){let T=0;for(const V of S)T+=V.length;const E=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray),M=E.vertexLength,P=[],O=[];for(const V of S){if(0===V.length)continue;V!==S[0]&&O.push(P.length/2);const G=this.segments2.prepareSegment(V.length,this.layoutVertexArray,this.indexArray2),Z=G.vertexLength;this.layoutVertexArray.emplaceBack(V[0].x,V[0].y),this.indexArray2.emplaceBack(Z+V.length-1,Z),P.push(V[0].x),P.push(V[0].y);for(let ce=1;ce<V.length;ce++)this.layoutVertexArray.emplaceBack(V[ce].x,V[ce].y),this.indexArray2.emplaceBack(Z+ce-1,Z+ce),P.push(V[ce].x),P.push(V[ce].y);G.vertexLength+=V.length,G.primitiveLength+=V.length}const B=wd.exports(P,O);for(let V=0;V<B.length;V+=3)this.indexArray.emplaceBack(M+B[V],M+B[V+1],M+B[V+2]);E.vertexLength+=T,E.primitiveLength+=B.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,u,b,y,f)}}tn(Zm,"FillBucket",{omit:["layers","patternFeatures"]});const YS=new Lt({"fill-sort-key":new Me(ct.layout_fill["fill-sort-key"])});var QS={paint:new Lt({"fill-antialias":new qe(ct.paint_fill["fill-antialias"]),"fill-opacity":new Me(ct.paint_fill["fill-opacity"]),"fill-color":new Me(ct.paint_fill["fill-color"]),"fill-outline-color":new Me(ct.paint_fill["fill-outline-color"]),"fill-translate":new qe(ct.paint_fill["fill-translate"]),"fill-translate-anchor":new qe(ct.paint_fill["fill-translate-anchor"]),"fill-pattern":new Gt(ct.paint_fill["fill-pattern"])}),layout:YS};const KS=Nt([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),jh=Nt([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Uc=Nt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:JS}=KS;var Qb={},OE=mt,Kb=yf;function yf(a,o,l,u,f){this.properties={},this.extent=l,this.type=0,this._pbf=a,this._geometry=-1,this._keys=u,this._values=f,a.readFields(xa,this,o)}function xa(a,o,l){1==a?o.id=l.readVarint():2==a?function(u,f){for(var b=u.readVarint()+u.pos;u.pos<b;){var y=f._keys[u.readVarint()],S=f._values[u.readVarint()];f.properties[y]=S}}(l,o):3==a?o.type=l.readVarint():4==a&&(o._geometry=l.pos)}function Jb(a){for(var o,l,u=0,f=0,b=a.length,y=b-1;f<b;y=f++)u+=((l=a[y]).x-(o=a[f]).x)*(o.y+l.y);return u}yf.types=["Unknown","Point","LineString","Polygon"],yf.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var o,l=a.readVarint()+a.pos,u=1,f=0,b=0,y=0,S=[];a.pos<l;){if(f<=0){var T=a.readVarint();u=7&T,f=T>>3}if(f--,1===u||2===u)b+=a.readSVarint(),y+=a.readSVarint(),1===u&&(o&&S.push(o),o=[]),o.push(new OE(b,y));else{if(7!==u)throw new Error("unknown command "+u);o&&o.push(o[0].clone())}}return o&&S.push(o),S},yf.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var o=a.readVarint()+a.pos,l=1,u=0,f=0,b=0,y=1/0,S=-1/0,T=1/0,E=-1/0;a.pos<o;){if(u<=0){var M=a.readVarint();l=7&M,u=M>>3}if(u--,1===l||2===l)(f+=a.readSVarint())<y&&(y=f),f>S&&(S=f),(b+=a.readSVarint())<T&&(T=b),b>E&&(E=b);else if(7!==l)throw new Error("unknown command "+l)}return[y,T,S,E]},yf.prototype.toGeoJSON=function(a,o,l){var u,f,b=this.extent*Math.pow(2,l),y=this.extent*a,S=this.extent*o,T=this.loadGeometry(),E=yf.types[this.type];function M(B){for(var V=0;V<B.length;V++){var G=B[V];B[V]=[360*(G.x+y)/b-180,360/Math.PI*Math.atan(Math.exp((180-360*(G.y+S)/b)*Math.PI/180))-90]}}switch(this.type){case 1:var P=[];for(u=0;u<T.length;u++)P[u]=T[u][0];M(T=P);break;case 2:for(u=0;u<T.length;u++)M(T[u]);break;case 3:for(T=function(B){var V=B.length;if(V<=1)return[B];for(var G,Z,ce=[],ye=0;ye<V;ye++){var ue=Jb(B[ye]);0!==ue&&(void 0===Z&&(Z=ue<0),Z===ue<0?(G&&ce.push(G),G=[B[ye]]):G.push(B[ye]))}return G&&ce.push(G),ce}(T),u=0;u<T.length;u++)for(f=0;f<T[u].length;f++)M(T[u][f])}1===T.length?T=T[0]:E="Multi"+E;var O={type:"Feature",geometry:{type:E,coordinates:T},properties:this.properties};return"id"in this&&(O.id=this.id),O};var e_=Kb,Vv=t_;function t_(a,o){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(e1,this,o),this.length=this._features.length}function e1(a,o,l){15===a?o.version=l.readVarint():1===a?o.name=l.readString():5===a?o.extent=l.readVarint():2===a?o._features.push(l.pos):3===a?o._keys.push(l.readString()):4===a&&o._values.push(function(u){for(var f=null,b=u.readVarint()+u.pos;u.pos<b;){var y=u.readVarint()>>3;f=1===y?u.readString():2===y?u.readFloat():3===y?u.readDouble():4===y?u.readVarint64():5===y?u.readVarint():6===y?u.readSVarint():7===y?u.readBoolean():null}return f}(l))}t_.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var o=this._pbf.readVarint()+this._pbf.pos;return new e_(this._pbf,o,this.extent,this._keys,this._values)};var vf=Vv;function t1(a,o,l){if(3===a){var u=new vf(l,l.readVarint()+l.pos);u.length&&(o[u.name]=u)}}var Ym=Qb.VectorTile=function(a,o){this.layers=a.readFields(t1,{},o)},Uh=Qb.VectorTileFeature=Kb;function Hh(a,o,l,u){const f=[],b=0===u?(y,S,T,E,M,P)=>{y.push(new mt(P,T+(P-S)/(E-S)*(M-T)))}:(y,S,T,E,M,P)=>{y.push(new mt(S+(P-T)/(M-T)*(E-S),P))};for(const y of a){const S=[];for(const T of y){if(T.length<=2)continue;const E=[];for(let O=0;O<T.length-1;O++){const B=T[O].x,V=T[O].y,G=T[O+1].x,Z=T[O+1].y,ce=0===u?B:V,ye=0===u?G:Z;ce<o?ye>o&&b(E,B,V,G,Z,o):ce>l?ye<l&&b(E,B,V,G,Z,l):E.push(T[O]),ye<o&&ce>=o&&b(E,B,V,G,Z,o),ye>l&&ce<=l&&b(E,B,V,G,Z,l)}let M=T[T.length-1];const P=0===u?M.x:M.y;P>=o&&P<=l&&E.push(M),E.length&&(M=E[E.length-1],E[0].x===M.x&&E[0].y===M.y||E.push(E[0]),S.push(E))}S.length&&f.push(S)}return f}Qb.VectorTileLayer=Vv;const jv=Uh.types,LE=Math.pow(2,13);function oc(a,o,l,u,f,b,y,S){a.emplaceBack((o<<1)+y,(l<<1)+b,(Math.floor(u*LE)<<1)+f,Math.round(S))}function Sd(a,o,l){a.emplaceBack(o.x,o.y,o.z,16384*l[0],16384*l[1],16384*l[2])}class n_{constructor(){this.acc=new mt(0,0),this.polyCount=[]}startRing(o){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new mt(o.x,o.y),this.max=new mt(o.x,o.y))}append(o,l){this.currentPolyCount.edges++,this.acc._add(o);const u=this.min,f=this.max;o.x<u.x?u.x=o.x:o.x>f.x&&(f.x=o.x),o.y<u.y?u.y=o.y:o.y>f.y&&(f.y=o.y),((0===o.x||o.x===Mn)&&o.x===l.x)!=((0===o.y||o.y===Mn)&&o.y===l.y)&&this.processBorderOverlap(o,l),l.x<0!=o.x<0&&this.addBorderIntersection(0,zi(l.y,o.y,(0-l.x)/(o.x-l.x))),l.x>Mn!=o.x>Mn&&this.addBorderIntersection(1,zi(l.y,o.y,(Mn-l.x)/(o.x-l.x))),l.y<0!=o.y<0&&this.addBorderIntersection(2,zi(l.x,o.x,(0-l.y)/(o.y-l.y))),l.y>Mn!=o.y>Mn&&this.addBorderIntersection(3,zi(l.x,o.x,(Mn-l.y)/(o.y-l.y)))}addBorderIntersection(o,l){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const u=this.borders[o];l<u[0]&&(u[0]=l),l>u[1]&&(u[1]=l)}processBorderOverlap(o,l){if(o.x===l.x){if(o.y===l.y)return;const u=0===o.x?0:1;this.addBorderIntersection(u,l.y),this.addBorderIntersection(u,o.y)}else{const u=0===o.y?2:3;this.addBorderIntersection(u,l.x),this.addBorderIntersection(u,o.x)}}centroid(){const o=this.polyCount.reduce((l,u)=>l+u.edges,0);return 0!==o?this.acc.div(o)._round():new mt(0,0)}span(){return new mt(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((o,l)=>o+ +(l[0]!==Number.MAX_VALUE),0)}}class xf{constructor(o){this.zoom=o.zoom,this.canonical=o.canonical,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.id),this.index=o.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=o.projection,this.layoutVertexArray=new pr,this.centroidVertexArray=new wS,this.indexArray=new Co,this.programConfigurations=new Lc(o.layers,o.zoom),this.segments=new fo,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.enableTerrain=o.enableTerrain}populate(o,l,u,f){this.features=[],this.hasPattern=Zb("fill-extrusion",this.layers,l),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(b){const y=Math.exp(Math.PI*(1-b.y/(1<<b.z)*2));return 80150034*y/(y*y+1)/Mn/(1<<b.z)}(u),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:b,id:y,index:S,sourceLayerIndex:T}of o){const E=this.layers[0]._featureFilter.needGeometry,M=Lh(b,E);if(!this.layers[0]._featureFilter.filter(new he(this.zoom),M,u))continue;const P={id:y,sourceLayerIndex:T,index:S,geometry:E?M.geometry:Fc(b,u,f),properties:b.properties,type:b.type,patterns:{}},O=this.layoutVertexArray.length;this.hasPattern?this.features.push(Yb("fill-extrusion",this.layers,P,this.zoom,l)):this.addFeature(P,P.geometry,S,u,{},l.availableImages,f),l.featureIndex.insert(b,P.geometry,S,T,this.index,O)}this.sortBorders()}addFeatures(o,l,u,f,b){for(const y of this.features){const{geometry:S}=y;this.addFeature(y,S,y.index,l,u,f,b)}this.sortBorders()}update(o,l,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,l,this.stateDependentLayers,u,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,JS),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=o.createVertexBuffer(this.layoutVertexExtArray,Uc.members,!0))),this.programConfigurations.upload(o),this.uploaded=!0}uploadCentroid(o){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=o.createVertexBuffer(this.centroidVertexArray,jh.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(o,l,u,f,b,y,S){const T=[new mt(0,0),new mt(Mn,Mn)],E=S.projection,M="globe"===E.name,P=this.enableTerrain&&!M?new n_:null,O="Polygon"===jv[o.type];M&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new mS);const B=Xb(l,500);for(let ce=B.length-1;ce>=0;ce--){const ye=B[ce];(0===ye.length||(V=ye[0]).every(ue=>ue.x<=0)||V.every(ue=>ue.x>=Mn)||V.every(ue=>ue.y<=0)||V.every(ue=>ue.y>=Mn))&&B.splice(ce,1)}var V;let G;if(M)G=i_(B,T,f);else{G=[];for(const ce of B)G.push({polygon:ce,bounds:T})}const Z=O?this.edgeRadius:0;for(const{polygon:ce,bounds:ye}of G){let ue=0,ge=0;for(const xe of ce)O&&!xe[0].equals(xe[xe.length-1])&&xe.push(xe[0]),ge+=O?xe.length-1:xe.length;const De=this.segments.prepareSegment((O?5:4)*ge,this.layoutVertexArray,this.indexArray);if(O){const xe=[],tt=[];ue=De.vertexLength;for(const lt of ce){let Mt,ot;lt.length&&lt!==ce[0]&&tt.push(xe.length/2),Mt=lt[1].sub(lt[0])._perp()._unit();for(let _t=1;_t<lt.length;_t++){const yt=lt[_t],Ct=lt[_t===lt.length-1?1:_t+1];let{x:Rt,y:pt}=yt;if(Z){ot=Ct.sub(yt)._perp()._unit();const nn=Mt.add(ot)._unit(),ut=Z*Math.min(4,1/(Mt.x*nn.x+Mt.y*nn.y));Rt+=ut*nn.x,pt+=ut*nn.y,Mt=ot}oc(this.layoutVertexArray,Rt,pt,0,0,1,1,0),De.vertexLength++,xe.push(yt.x,yt.y),M&&Sd(this.layoutVertexExtArray,E.projectTilePoint(Rt,pt,f),E.upVector(f,Rt,pt))}}const Ze=wd.exports(xe,tt);for(let lt=0;lt<Ze.length;lt+=3)this.indexArray.emplaceBack(ue+Ze[lt],ue+Ze[lt+2],ue+Ze[lt+1]),De.primitiveLength++}for(const xe of ce){P&&xe.length&&P.startRing(xe[0]);let tt,Ze,lt,Mt=xe.length>4&&$v(xe[xe.length-2],xe[0],xe[1]),ot=Z?n1(xe[xe.length-2],xe[0],xe[1],Z):0;Ze=xe[1].sub(xe[0])._perp()._unit();let _t=!0;for(let yt=1,Ct=0;yt<xe.length;yt++){let Rt=xe[yt-1],pt=xe[yt];const nn=xe[yt===xe.length-1?1:yt+1];if(P&&O&&P.currentPolyCount.top++,Hv(pt,Rt,ye)){Z&&(Ze=nn.sub(pt)._perp()._unit(),_t=!_t);continue}P&&P.append(pt,Rt);const ut=pt.sub(Rt)._perp(),vn=ut.x/(Math.abs(ut.x)+Math.abs(ut.y)),hn=ut.y>0?1:0,Yt=Rt.dist(pt);if(Ct+Yt>32768&&(Ct=0),Z){lt=nn.sub(pt)._perp()._unit();let Ui=Uv(Rt,pt,nn,Qm(Ze,lt),Z);isNaN(Ui)&&(Ui=0);const ii=pt.sub(Rt)._unit();Rt=Rt.add(ii.mult(ot))._round(),pt=pt.add(ii.mult(-Ui))._round(),ot=Ui,Ze=lt}const Zn=De.vertexLength,fi=xe.length>4&&$v(Rt,pt,nn);let mi=Gv(Ct,Mt,_t);if(oc(this.layoutVertexArray,Rt.x,Rt.y,vn,hn,0,0,mi),oc(this.layoutVertexArray,Rt.x,Rt.y,vn,hn,0,1,mi),Ct+=Yt,mi=Gv(Ct,fi,!_t),Mt=fi,oc(this.layoutVertexArray,pt.x,pt.y,vn,hn,0,0,mi),oc(this.layoutVertexArray,pt.x,pt.y,vn,hn,0,1,mi),De.vertexLength+=4,this.indexArray.emplaceBack(Zn+0,Zn+1,Zn+2),this.indexArray.emplaceBack(Zn+1,Zn+3,Zn+2),De.primitiveLength+=2,Z){const Ui=ue+(1===yt?xe.length-2:yt-2),ii=1===yt?ue:Ui+1;if(this.indexArray.emplaceBack(Zn+1,Ui,Zn+3),this.indexArray.emplaceBack(Ui,ii,Zn+3),De.primitiveLength+=2,void 0===tt&&(tt=Zn),!Hv(nn,xe[yt],ye)){const Cr=yt===xe.length-1?tt:De.vertexLength;this.indexArray.emplaceBack(Zn+2,Zn+3,Cr),this.indexArray.emplaceBack(Zn+3,Cr+1,Cr),this.indexArray.emplaceBack(Zn+3,ii,Cr+1),De.primitiveLength+=3}_t=!_t}if(M){const Ui=this.layoutVertexExtArray,ii=E.projectTilePoint(Rt.x,Rt.y,f),Cr=E.projectTilePoint(pt.x,pt.y,f),ri=E.upVector(f,Rt.x,Rt.y),ki=E.upVector(f,pt.x,pt.y);Sd(Ui,ii,ri),Sd(Ui,ii,ri),Sd(Ui,Cr,ki),Sd(Ui,Cr,ki)}}O&&(ue+=xe.length-1)}}if(P&&P.polyCount.length>0){if(P.borders){P.vertexArrayOffset=this.centroidVertexArray.length;const ce=P.borders,ye=this.featuresOnBorder.push(P)-1;for(let ue=0;ue<4;ue++)ce[ue][0]!==Number.MAX_VALUE&&this.borders[ue].push(ye)}this.encodeCentroid(P.borders?void 0:P.centroid(),P)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,u,b,y,f)}sortBorders(){for(let o=0;o<4;o++)this.borders[o].sort((l,u)=>this.featuresOnBorder[l].borders[o][0]-this.featuresOnBorder[u].borders[o][0])}encodeCentroid(o,l,u=!0){let f,b;if(o)if(0!==o.y){const S=l.span()._mult(this.tileToMeter);f=(Math.max(o.x,1)<<3)+Math.min(7,Math.round(S.x/10)),b=(Math.max(o.y,1)<<3)+Math.min(7,Math.round(S.y/10))}else f=Math.ceil(7*(o.x+450)),b=0;else f=0,b=+u;let y=u?this.centroidVertexArray.length:l.vertexArrayOffset;for(const S of l.polyCount){u&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*S.edges+S.top);for(let T=0;T<S.top;T++)this.centroidVertexArray.emplace(y++,f,b);for(let T=0;T<2*S.edges;T++)this.centroidVertexArray.emplace(y++,0,b),this.centroidVertexArray.emplace(y++,f,b)}}}function Qm(a,o){const l=a.add(o)._unit();return a.x*l.x+a.y*l.y}function n1(a,o,l,u){const f=o.sub(a)._perp()._unit(),b=l.sub(o)._perp()._unit();return Uv(a,o,l,Qm(f,b),u)}function Uv(a,o,l,u,f){const b=Math.sqrt(1-u*u);return Math.min(a.dist(o)/3,o.dist(l)/3,f*b/u)}function Hv(a,o,l){return a.x<l[0].x&&o.x<l[0].x||a.x>l[1].x&&o.x>l[1].x||a.y<l[0].y&&o.y<l[0].y||a.y>l[1].y&&o.y>l[1].y}function $v(a,o,l){if(a.x<0||a.x>=Mn||o.x<0||o.x>=Mn||l.x<0||l.x>=Mn)return!1;const u=l.sub(o),f=u.perp(),b=a.sub(o);return(u.x*b.x+u.y*b.y)/Math.sqrt((u.x*u.x+u.y*u.y)*(b.x*b.x+b.y*b.y))>-.866&&f.x*b.x+f.y*b.y<0}function Gv(a,o,l){const u=o?2|a:-3&a;return l?1|u:-2&u}function qv(){const a=Math.PI/32,o=Math.tan(a),l=_u;return l*Math.sqrt(1+2*o*o)-l}function i_(a,o,l){const u=1<<l.z,f=Ts(l.x/u),b=Ts((l.x+1)/u),y=us(l.y/u),S=us((l.y+1)/u);return function(T,E,M,P,O=0,B){const V=[];if(!T.length||!M||!P)return V;const G=(xe,tt)=>{for(const Ze of xe)V.push({polygon:Ze,bounds:tt})},Z=Math.ceil(Math.log2(M)),ce=Math.ceil(Math.log2(P)),ye=Z-ce,ue=[];for(let xe=0;xe<Math.abs(ye);xe++)ue.push(ye>0?0:1);for(let xe=0;xe<Math.min(Z,ce);xe++)ue.push(0),ue.push(1);let ge=T;if(ge=Hh(ge,E[0].y-O,E[1].y+O,1),ge=Hh(ge,E[0].x-O,E[1].x+O,0),!ge.length)return V;const De=[];for(ue.length?De.push({polygons:ge,bounds:E,depth:0}):G(ge,E);De.length;){const xe=De.pop(),tt=xe.depth,Ze=ue[tt],lt=xe.bounds[0],Mt=xe.bounds[1],ot=0===Ze?lt.x:lt.y,_t=0===Ze?Mt.x:Mt.y,yt=B?B(Ze,ot,_t):.5*(ot+_t),Ct=Hh(xe.polygons,ot-O,yt+O,Ze),Rt=Hh(xe.polygons,yt-O,_t+O,Ze);if(Ct.length){const pt=[lt,new mt(0===Ze?yt:Mt.x,1===Ze?yt:Mt.y)];ue.length>tt+1?De.push({polygons:Ct,bounds:pt,depth:tt+1}):G(Ct,pt)}if(Rt.length){const pt=[new mt(0===Ze?yt:lt.x,1===Ze?yt:lt.y),Mt];ue.length>tt+1?De.push({polygons:Rt,bounds:pt,depth:tt+1}):G(Rt,pt)}}return V}(a,o,Math.ceil((b-f)/11.25),Math.ceil((y-S)/11.25),1,(T,E,M)=>{if(0===T)return.5*(E+M);{const P=us((l.y+E/Mn)/u);return(Cs(.5*(us((l.y+M/Mn)/u)+P))*u-l.y)*Mn}})}tn(xf,"FillExtrusionBucket",{omit:["layers","features"]}),tn(n_,"PartMetadata");const r_=new Lt({"fill-extrusion-edge-radius":new qe(ct["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Wv={paint:new Lt({"fill-extrusion-opacity":new qe(ct["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Me(ct["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new qe(ct["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new qe(ct["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Gt(ct["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Me(ct["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Me(ct["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new qe(ct["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new qe(ct["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new qe(ct["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:r_};function Km(a,o,l){var u=2*Math.PI*6378137/256/Math.pow(2,l);return[a*u-2*Math.PI*6378137/2,o*u-2*Math.PI*6378137/2]}class Jm{constructor(o,l,u){this.z=o,this.x=l,this.y=u,this.key=$h(0,o,o,l,u)}equals(o){return this.z===o.z&&this.x===o.x&&this.y===o.y}url(o,l){const u=(y=this.y,S=this.z,T=Km(256*(b=this.x),256*(y=Math.pow(2,S)-y-1),S),E=Km(256*(b+1),256*(y+1),S),T[0]+","+T[1]+","+E[0]+","+E[1]),f=function(b,y,S){let T,E="";for(let M=b;M>0;M--)T=1<<M-1,E+=(y&T?1:0)+(S&T?2:0);return E}(this.z,this.x,this.y);var b,y,S,T,E;return o[(this.x+this.y)%o.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===l?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",f).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Xv{constructor(o,l){this.wrap=o,this.canonical=l,this.key=$h(o,l.z,l.z,l.x,l.y)}}class Is{constructor(o,l,u,f,b){this.overscaledZ=o,this.wrap=l,this.canonical=new Jm(u,+f,+b),this.key=0===l&&o===u?this.canonical.key:$h(l,o,u,f,b)}equals(o){return this.overscaledZ===o.overscaledZ&&this.wrap===o.wrap&&this.canonical.equals(o.canonical)}scaledTo(o){const l=this.canonical.z-o;return o>this.canonical.z?new Is(o,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Is(o,this.wrap,o,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(o,l=!0){if(this.overscaledZ===o&&l)return this.key;if(o>this.canonical.z)return $h(this.wrap*+l,o,this.canonical.z,this.canonical.x,this.canonical.y);{const u=this.canonical.z-o;return $h(this.wrap*+l,o,o,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(o){if(o.wrap!==this.wrap)return!1;const l=this.canonical.z-o.canonical.z;return 0===o.overscaledZ||o.overscaledZ<this.overscaledZ&&o.canonical.x===this.canonical.x>>l&&o.canonical.y===this.canonical.y>>l}children(o){if(this.overscaledZ>=o)return[new Is(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,u=2*this.canonical.x,f=2*this.canonical.y;return[new Is(l,this.wrap,l,u,f),new Is(l,this.wrap,l,u+1,f),new Is(l,this.wrap,l,u,f+1),new Is(l,this.wrap,l,u+1,f+1)]}isLessThan(o){return this.wrap<o.wrap||!(this.wrap>o.wrap)&&(this.overscaledZ<o.overscaledZ||!(this.overscaledZ>o.overscaledZ)&&(this.canonical.x<o.canonical.x||!(this.canonical.x>o.canonical.x)&&this.canonical.y<o.canonical.y))}wrapped(){return new Is(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(o){return new Is(this.overscaledZ,o,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Xv(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function $h(a,o,l,u,f){const b=1<<Math.min(l,22);let y=b*(f%b)+u%b;return a&&l<22&&(y+=b*b*((a<0?-2*a-1:2*a)%(1<<2*(22-l)))),16*(32*y+l)+(o-l)}tn(Jm,"CanonicalTileID"),tn(Is,"OverscaledTileID",{omit:["projMatrix"]});class cl extends mt{constructor(o,l,u){super(o,l),this.z=u}}function Gh(a,o){return a.x*o.x+a.y*o.y}function o_(a,o){if(1===a.length){let l=0;const u=o[l++];let f;for(;!f||u.equals(f);)if(f=o[l++],!f)return 1/0;for(;l<o.length;l++){const b=o[l],y=a[0],S=f.sub(u),T=b.sub(u),E=y.sub(u),M=Gh(S,S),P=Gh(S,T),O=Gh(T,T),B=Gh(E,S),V=Gh(E,T),G=M*O-P*P,Z=(O*B-P*V)/G,ce=(M*V-P*B)/G,ye=u.z*(1-Z-ce)+f.z*Z+b.z*ce;if(isFinite(ye))return ye}return 1/0}{let l=1/0;for(const u of o)l=Math.min(l,u.z);return l}}function Zv(a,o,l,u,f,b,y,S){const T=y*f.getElevationAt(a,o,!0,!0),E=0!==b[0],M=E?0===b[1]?y*(b[0]/7-450):y*function(P,O,B){const V=Math.floor(O[0]/8),G=Math.floor(O[1]/8),Z=10*(O[0]-8*V),ce=10*(O[1]-8*G),ye=P.getElevationAt(V,G,!0,!0),ue=P.getMeterToDEM(B),ge=Math.floor(.5*(Z*ue-1)),De=Math.floor(.5*(ce*ue-1)),xe=P.tileCoordToPixel(V,G),tt=2*ge+1,Ze=2*De+1,lt=(ut=tt,vn=Ze,[(Rt=P).getElevationAtPixel(pt=xe.x-ge,nn=xe.y-De,!0),Rt.getElevationAtPixel(pt+vn,nn,!0),Rt.getElevationAtPixel(pt,nn+vn,!0),Rt.getElevationAtPixel(pt+ut,nn+vn,!0)]),Mt=Math.abs(lt[0]-lt[1]),ot=Math.abs(lt[2]-lt[3]),_t=Math.abs(lt[0]-lt[2])+Math.abs(lt[1]-lt[3]),yt=Math.min(.25,.5*ue*(Mt+ot)/tt),Ct=Math.min(.25,.5*ue*_t/Ze);var Rt,pt,nn,ut,vn;return ye+Math.max(yt*Z,Ct*ce)}(f,b,S):T;return{base:T+(0===l)?-1:l,top:E?Math.max(M+u,T+l+2):T+u}}const FE=Nt([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:eg}=FE,r1=Nt([{name:"a_packed",components:4,type:"Float32"}]),{members:Yv}=r1,Qv=Uh.types,Kv=Math.cos(Math.PI/180*37.5);class qh{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.id),this.index=o.index,this.projection=o.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new or,this.layoutVertexArray2=new io,this.indexArray=new Co,this.programConfigurations=new Lc(o.layers,o.zoom),this.segments=new fo,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(o,l,u,f){this.hasPattern=Zb("line",this.layers,l);const b=this.layers[0].layout.get("line-sort-key"),y=[];for(const{feature:M,id:P,index:O,sourceLayerIndex:B}of o){const V=this.layers[0]._featureFilter.needGeometry,G=Lh(M,V);if(!this.layers[0]._featureFilter.filter(new he(this.zoom),G,u))continue;const Z=b?b.evaluate(G,{},u):void 0,ce={id:P,properties:M.properties,type:M.type,sourceLayerIndex:B,index:O,geometry:V?G.geometry:Fc(M,u,f),patterns:{},sortKey:Z};y.push(ce)}b&&y.sort((M,P)=>M.sortKey-P.sortKey);const{lineAtlas:S,featureIndex:T}=l,E=this.addConstantDashes(S);for(const M of y){const{geometry:P,index:O,sourceLayerIndex:B}=M;if(E&&this.addFeatureDashes(M,S),this.hasPattern){const V=Yb("line",this.layers,M,this.zoom,l);this.patternFeatures.push(V)}else this.addFeature(M,P,O,u,S.positions,l.availableImages);T.insert(o[O].feature,P,O,B,this.index)}}addConstantDashes(o){let l=!1;for(const u of this.layers){const f=u.paint.get("line-dasharray").value,b=u.layout.get("line-cap").value;if("constant"!==f.kind||"constant"!==b.kind)l=!0;else{const y=b.value,S=f.value;if(!S)continue;o.addDash(S.from,y),o.addDash(S.to,y),S.other&&o.addDash(S.other,y)}}return l}addFeatureDashes(o,l){const u=this.zoom;for(const f of this.layers){const b=f.paint.get("line-dasharray").value,y=f.layout.get("line-cap").value;if("constant"===b.kind&&"constant"===y.kind)continue;let S,T,E,M,P,O;if("constant"===b.kind){const Z=b.value;if(!Z)continue;S=Z.other||Z.to,T=Z.to,E=Z.from}else S=b.evaluate({zoom:u-1},o),T=b.evaluate({zoom:u},o),E=b.evaluate({zoom:u+1},o);"constant"===y.kind?M=P=O=y.value:(M=y.evaluate({zoom:u-1},o),P=y.evaluate({zoom:u},o),O=y.evaluate({zoom:u+1},o)),l.addDash(S,M),l.addDash(T,P),l.addDash(E,O);const B=l.getKey(S,M),V=l.getKey(T,P),G=l.getKey(E,O);o.patterns[f.id]={min:B,mid:V,max:G}}}update(o,l,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,l,this.stateDependentLayers,u,f)}addFeatures(o,l,u,f,b){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,l,u,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=o.createVertexBuffer(this.layoutVertexArray2,Yv)),this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,eg),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(o){if(o.properties&&o.properties.hasOwnProperty("mapbox_clip_start")&&o.properties.hasOwnProperty("mapbox_clip_end"))return{start:+o.properties.mapbox_clip_start,end:+o.properties.mapbox_clip_end}}addFeature(o,l,u,f,b,y){const S=this.layers[0].layout,T=S.get("line-join").evaluate(o,{}),E=S.get("line-cap").evaluate(o,{}),M=S.get("line-miter-limit"),P=S.get("line-round-limit");this.lineClips=this.lineFeatureClips(o);for(const O of l)this.addLine(O,o,T,E,M,P);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,u,b,y,f)}addLine(o,l,u,f,b,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ce=0;ce<o.length-1;ce++)this.totalDistance+=o[ce].dist(o[ce+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const S="Polygon"===Qv[l.type];let T=o.length;for(;T>=2&&o[T-1].equals(o[T-2]);)T--;let E=0;for(;E<T-1&&o[E].equals(o[E+1]);)E++;if(T<(S?3:2))return;"bevel"===u&&(b=1.05);const M=this.overscaling<=16?122880/(512*this.overscaling):0,P=this.segments.prepareSegment(10*T,this.layoutVertexArray,this.indexArray);let O,B,V,G,Z;this.e1=this.e2=-1,S&&(O=o[T-2],Z=o[E].sub(O)._unit()._perp());for(let ce=E;ce<T;ce++){if(V=ce===T-1?S?o[E+1]:void 0:o[ce+1],V&&o[ce].equals(V))continue;Z&&(G=Z),O&&(B=O),O=o[ce],Z=V?V.sub(O)._unit()._perp():G,G=G||Z;let ye=G.add(Z);0===ye.x&&0===ye.y||ye._unit();const ue=G.x*Z.x+G.y*Z.y,ge=ye.x*Z.x+ye.y*Z.y,De=0!==ge?1/ge:1/0,xe=2*Math.sqrt(2-2*ge),tt=ge<Kv&&B&&V,Ze=G.x*Z.y-G.y*Z.x>0;if(tt&&ce>E){const ot=O.dist(B);if(ot>2*M){const _t=O.sub(O.sub(B)._mult(M/ot)._round());this.updateDistance(B,_t),this.addCurrentVertex(_t,G,0,0,P),B=_t}}const lt=B&&V;let Mt=lt?u:S?"butt":f;if(lt&&"round"===Mt&&(De<y?Mt="miter":De<=2&&(Mt="fakeround")),"miter"===Mt&&De>b&&(Mt="bevel"),"bevel"===Mt&&(De>2&&(Mt="flipbevel"),De<b&&(Mt="miter")),B&&this.updateDistance(B,O),"miter"===Mt)ye._mult(De),this.addCurrentVertex(O,ye,0,0,P);else if("flipbevel"===Mt){if(De>100)ye=Z.mult(-1);else{const ot=De*G.add(Z).mag()/G.sub(Z).mag();ye._perp()._mult(ot*(Ze?-1:1))}this.addCurrentVertex(O,ye,0,0,P),this.addCurrentVertex(O,ye.mult(-1),0,0,P)}else if("bevel"===Mt||"fakeround"===Mt){const ot=-Math.sqrt(De*De-1),_t=Ze?ot:0,yt=Ze?0:ot;if(B&&this.addCurrentVertex(O,G,_t,yt,P),"fakeround"===Mt){const Ct=Math.round(180*xe/Math.PI/20);for(let Rt=1;Rt<Ct;Rt++){let pt=Rt/Ct;if(.5!==pt){const ut=pt-.5;pt+=pt*ut*(pt-1)*((1.0904+ue*(ue*(3.55645-1.43519*ue)-3.2452))*ut*ut+(.848013+ue*(.215638*ue-1.06021)))}const nn=Z.sub(G)._mult(pt)._add(G)._unit()._mult(Ze?-1:1);this.addHalfVertex(O,nn.x,nn.y,!1,Ze,0,P)}}V&&this.addCurrentVertex(O,Z,-_t,-yt,P)}else if("butt"===Mt)this.addCurrentVertex(O,ye,0,0,P);else if("square"===Mt){const ot=B?1:-1;B||this.addCurrentVertex(O,ye,ot,ot,P),this.addCurrentVertex(O,ye,0,0,P),B&&this.addCurrentVertex(O,ye,ot,ot,P)}else"round"===Mt&&(B&&(this.addCurrentVertex(O,G,0,0,P),this.addCurrentVertex(O,G,1,1,P,!0)),V&&(this.addCurrentVertex(O,Z,-1,-1,P,!0),this.addCurrentVertex(O,Z,0,0,P)));if(tt&&ce<T-1){const ot=O.dist(V);if(ot>2*M){const _t=O.add(V.sub(O)._mult(M/ot)._round());this.updateDistance(O,_t),this.addCurrentVertex(_t,Z,0,0,P),O=_t}}}}addCurrentVertex(o,l,u,f,b,y=!1){const S=l.y*f-l.x,T=-l.y-l.x*f;this.addHalfVertex(o,l.x+l.y*u,l.y-l.x*u,y,!1,u,b),this.addHalfVertex(o,S,T,y,!0,-f,b)}addHalfVertex({x:o,y:l},u,f,b,y,S,T){this.layoutVertexArray.emplaceBack((o<<1)+(b?1:0),(l<<1)+(y?1:0),Math.round(63*u)+128,Math.round(63*f)+128,1+(0===S?0:S<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const E=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,E),T.primitiveLength++),y?this.e2=E:this.e1=E}updateScaledDistance(){if(this.lineClips){const o=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=o*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(o,l){this.distance+=o.dist(l),this.updateScaledDistance()}}tn(qh,"LineBucket",{omit:["layers","patternFeatures"]});const Jv=new Lt({"line-cap":new Me(ct.layout_line["line-cap"]),"line-join":new Me(ct.layout_line["line-join"]),"line-miter-limit":new qe(ct.layout_line["line-miter-limit"]),"line-round-limit":new qe(ct.layout_line["line-round-limit"]),"line-sort-key":new Me(ct.layout_line["line-sort-key"])});var wf={paint:new Lt({"line-opacity":new Me(ct.paint_line["line-opacity"]),"line-color":new Me(ct.paint_line["line-color"]),"line-translate":new qe(ct.paint_line["line-translate"]),"line-translate-anchor":new qe(ct.paint_line["line-translate-anchor"]),"line-width":new Me(ct.paint_line["line-width"]),"line-gap-width":new Me(ct.paint_line["line-gap-width"]),"line-offset":new Me(ct.paint_line["line-offset"]),"line-blur":new Me(ct.paint_line["line-blur"]),"line-dasharray":new Gt(ct.paint_line["line-dasharray"]),"line-pattern":new Gt(ct.paint_line["line-pattern"]),"line-gradient":new jt(ct.paint_line["line-gradient"]),"line-trim-offset":new qe(ct.paint_line["line-trim-offset"])}),layout:Jv};const Sf=new class extends Me{possiblyEvaluate(a,o){return o=new he(Math.floor(o.zoom),{now:o.now,fadeDuration:o.fadeDuration,zoomHistory:o.zoomHistory,transition:o.transition}),super.possiblyEvaluate(a,o)}evaluate(a,o,l,u){return o=en({},o,{zoom:Math.floor(o.zoom)}),super.evaluate(a,o,l,u)}}(wf.paint.properties["line-width"].specification);function s_(a,o){return o>0?o+2*a:a}Sf.useIntegerZoom=!0;const a_=Nt([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),e0=Nt([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),l_=Nt([{name:"a_projected_pos",components:4,type:"Float32"}],4);Nt([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Cf=Nt([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),o1=Nt([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Nt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const c_=Nt([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),s1=Nt([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Nt([{name:"triangle",components:3,type:"Uint16"}]),Nt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Nt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Nt([{type:"Float32",name:"offsetX"}]),Nt([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const Ol=128;function Tf(a,o){const{expression:l}=o;if("constant"===l.kind)return{kind:"constant",layoutSize:l.evaluate(new he(a+1))};if("source"===l.kind)return{kind:"source"};{const{zoomStops:u,interpolationType:f}=l;let b=0;for(;b<u.length&&u[b]<=a;)b++;b=Math.max(0,b-1);let y=b;for(;y<u.length&&u[y]<a+1;)y++;y=Math.min(u.length-1,y);const S=u[b],T=u[y];return"composite"===l.kind?{kind:"composite",minZoom:S,maxZoom:T,interpolationType:f}:{kind:"camera",minZoom:S,maxZoom:T,minSize:l.evaluate(new he(S)),maxSize:l.evaluate(new he(T)),interpolationType:f}}}function Df(a,{uSize:o,uSizeT:l},{lowerSize:u,upperSize:f}){return"source"===a.kind?u/Ol:"composite"===a.kind?zi(u/Ol,f/Ol,l):o}function Ef(a,o){let l=0,u=0;if("constant"===a.kind)u=a.layoutSize;else if("source"!==a.kind){const{interpolationType:f,minZoom:b,maxZoom:y}=a,S=f?Ke(rs.interpolationFactor(f,o,b,y),0,1):0;"camera"===a.kind?u=zi(a.minSize,a.maxSize,S):l=S}return{uSizeT:l,uSize:u}}var t0=Object.freeze({__proto__:null,getSizeData:Tf,evaluateSizeForFeature:Df,evaluateSizeForZoom:Ef,SIZE_PACK_FACTOR:Ol});function a1(a,o,l){return a.sections.forEach(u=>{u.text=function(f,b,y){const S=b.layout.get("text-transform").evaluate(y,{});return"uppercase"===S?f=f.toLocaleUpperCase():"lowercase"===S&&(f=f.toLocaleLowerCase()),ve.applyArabicShaping&&(f=ve.applyArabicShaping(f)),f}(u.text,o,l)}),a}const Wh={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function l1(a){return"\ufe36"===a||"\ufe48"===a||"\ufe38"===a||"\ufe44"===a||"\ufe42"===a||"\ufe3e"===a||"\ufe3c"===a||"\ufe3a"===a||"\ufe18"===a||"\ufe40"===a||"\ufe10"===a||"\ufe13"===a||"\ufe14"===a||"\uff40"===a||"\uffe3"===a||"\ufe11"===a||"\ufe12"===a}function c1(a){return"\ufe35"===a||"\ufe47"===a||"\ufe37"===a||"\ufe43"===a||"\ufe41"===a||"\ufe3d"===a||"\ufe3b"===a||"\ufe39"===a||"\ufe17"===a||"\ufe3f"===a}var ea=kr,n0=function(a,o,l,u,f){var b,y,S=8*f-u-1,T=(1<<S)-1,E=T>>1,M=-7,P=l?f-1:0,O=l?-1:1,B=a[o+P];for(P+=O,b=B&(1<<-M)-1,B>>=-M,M+=S;M>0;b=256*b+a[o+P],P+=O,M-=8);for(y=b&(1<<-M)-1,b>>=-M,M+=u;M>0;y=256*y+a[o+P],P+=O,M-=8);if(0===b)b=1-E;else{if(b===T)return y?NaN:1/0*(B?-1:1);y+=Math.pow(2,u),b-=E}return(B?-1:1)*y*Math.pow(2,b-u)},u_=function(a,o,l,u,f,b){var y,S,T,E=8*b-f-1,M=(1<<E)-1,P=M>>1,O=23===f?Math.pow(2,-24)-Math.pow(2,-77):0,B=u?0:b-1,V=u?1:-1,G=o<0||0===o&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(S=isNaN(o)?1:0,y=M):(y=Math.floor(Math.log(o)/Math.LN2),o*(T=Math.pow(2,-y))<1&&(y--,T*=2),(o+=y+P>=1?O/T:O*Math.pow(2,1-P))*T>=2&&(y++,T/=2),y+P>=M?(S=0,y=M):y+P>=1?(S=(o*T-1)*Math.pow(2,f),y+=P):(S=o*Math.pow(2,P-1)*Math.pow(2,f),y=0));f>=8;a[l+B]=255&S,B+=V,S/=256,f-=8);for(y=y<<f|S,E+=f;E>0;a[l+B]=255&y,B+=V,y/=256,E-=8);a[l+B-V]|=128*G};function kr(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}kr.Varint=0,kr.Fixed64=1,kr.Bytes=2,kr.Fixed32=5;var d_=4294967296,r0=1/d_,o0="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function sc(a){return a.type===kr.Bytes?a.readVarint()+a.pos:a.pos+1}function s0(a,o,l){var u=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));l.realloc(u);for(var f=l.pos-1;f>=a;f--)l.buf[f+u]=l.buf[f]}function u1(a,o){for(var l=0;l<a.length;l++)o.writeVarint(a[l])}function Ai(a,o){for(var l=0;l<a.length;l++)o.writeSVarint(a[l])}function Je(a,o){for(var l=0;l<a.length;l++)o.writeFloat(a[l])}function a0(a,o){for(var l=0;l<a.length;l++)o.writeDouble(a[l])}function l0(a,o){for(var l=0;l<a.length;l++)o.writeBoolean(a[l])}function d1(a,o){for(var l=0;l<a.length;l++)o.writeFixed32(a[l])}function h1(a,o){for(var l=0;l<a.length;l++)o.writeSFixed32(a[l])}function c0(a,o){for(var l=0;l<a.length;l++)o.writeFixed64(a[l])}function p1(a,o){for(var l=0;l<a.length;l++)o.writeSFixed64(a[l])}function If(a,o){return(a[o]|a[o+1]<<8|a[o+2]<<16)+16777216*a[o+3]}function Zh(a,o,l){a[l]=o,a[l+1]=o>>>8,a[l+2]=o>>>16,a[l+3]=o>>>24}function u0(a,o){return(a[o]|a[o+1]<<8|a[o+2]<<16)+(a[o+3]<<24)}function NE(a,o,l){o.glyphs=[],1===a&&l.readMessage(h_,o)}function h_(a,o,l){if(3===a){const{id:u,bitmap:f,width:b,height:y,left:S,top:T,advance:E}=l.readMessage(d0,{});o.glyphs.push({id:u,bitmap:new Vc({width:b+6,height:y+6},f),metrics:{width:b,height:y,left:S,top:T,advance:E}})}else 4===a?o.ascender=l.readSVarint():5===a&&(o.descender=l.readSVarint())}function d0(a,o,l){1===a?o.id=l.readVarint():2===a?o.bitmap=l.readBytes():3===a?o.width=l.readVarint():4===a?o.height=l.readVarint():5===a?o.left=l.readSVarint():6===a?o.top=l.readSVarint():7===a&&(o.advance=l.readVarint())}function p_(a){let o=0,l=0;for(const y of a)o+=y.w*y.h,l=Math.max(l,y.w);a.sort((y,S)=>S.h-y.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),l),h:1/0}];let f=0,b=0;for(const y of a)for(let S=u.length-1;S>=0;S--){const T=u[S];if(!(y.w>T.w||y.h>T.h)){if(y.x=T.x,y.y=T.y,b=Math.max(b,y.y+y.h),f=Math.max(f,y.x+y.w),y.w===T.w&&y.h===T.h){const E=u.pop();S<u.length&&(u[S]=E)}else y.h===T.h?(T.x+=y.w,T.w-=y.w):y.w===T.w?(T.y+=y.h,T.h-=y.h):(u.push({x:T.x+y.w,y:T.y,w:T.w-y.w,h:y.h}),T.y+=y.h,T.h-=y.h);break}}return{w:f,h:b,fill:o/(f*b)||0}}kr.prototype={destroy:function(){this.buf=null},readFields:function(a,o,l){for(l=l||this.length;this.pos<l;){var u=this.readVarint(),f=u>>3,b=this.pos;this.type=7&u,a(f,o,this),this.pos===b&&this.skip(u)}return o},readMessage:function(a,o){return this.readFields(a,o,this.readVarint()+this.pos)},readFixed32:function(){var a=If(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=u0(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=If(this.buf,this.pos)+If(this.buf,this.pos+4)*d_;return this.pos+=8,a},readSFixed64:function(){var a=If(this.buf,this.pos)+u0(this.buf,this.pos+4)*d_;return this.pos+=8,a},readFloat:function(){var a=n0(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=n0(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var o,l,u=this.buf;return o=127&(l=u[this.pos++]),l<128?o:(o|=(127&(l=u[this.pos++]))<<7,l<128?o:(o|=(127&(l=u[this.pos++]))<<14,l<128?o:(o|=(127&(l=u[this.pos++]))<<21,l<128?o:function(f,b,y){var S,T,E=y.buf;if(S=(112&(T=E[y.pos++]))>>4,T<128||(S|=(127&(T=E[y.pos++]))<<3,T<128)||(S|=(127&(T=E[y.pos++]))<<10,T<128)||(S|=(127&(T=E[y.pos++]))<<17,T<128)||(S|=(127&(T=E[y.pos++]))<<24,T<128)||(S|=(1&(T=E[y.pos++]))<<31,T<128))return function Xh(a,o,l){return l?4294967296*o+(a>>>0):4294967296*(o>>>0)+(a>>>0)}(f,S,b);throw new Error("Expected varint not more than 10 bytes")}(o|=(15&(l=u[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var a=this.readVarint()+this.pos,o=this.pos;return this.pos=a,a-o>=12&&o0?o0.decode(this.buf.subarray(o,a)):function(l,u,f){for(var b="",y=u;y<f;){var S,T,E,M=l[y],P=null,O=M>239?4:M>223?3:M>191?2:1;if(y+O>f)break;1===O?M<128&&(P=M):2===O?128==(192&(S=l[y+1]))&&(P=(31&M)<<6|63&S)<=127&&(P=null):3===O?(T=l[y+2],128==(192&(S=l[y+1]))&&128==(192&T)&&((P=(15&M)<<12|(63&S)<<6|63&T)<=2047||P>=55296&&P<=57343)&&(P=null)):4===O&&(T=l[y+2],E=l[y+3],128==(192&(S=l[y+1]))&&128==(192&T)&&128==(192&E)&&((P=(15&M)<<18|(63&S)<<12|(63&T)<<6|63&E)<=65535||P>=1114112)&&(P=null)),null===P?(P=65533,O=1):P>65535&&(P-=65536,b+=String.fromCharCode(P>>>10&1023|55296),P=56320|1023&P),b+=String.fromCharCode(P),y+=O}return b}(this.buf,o,a)},readBytes:function(){var a=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,a);return this.pos=a,o},readPackedVarint:function(a,o){if(this.type!==kr.Bytes)return a.push(this.readVarint(o));var l=sc(this);for(a=a||[];this.pos<l;)a.push(this.readVarint(o));return a},readPackedSVarint:function(a){if(this.type!==kr.Bytes)return a.push(this.readSVarint());var o=sc(this);for(a=a||[];this.pos<o;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==kr.Bytes)return a.push(this.readBoolean());var o=sc(this);for(a=a||[];this.pos<o;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==kr.Bytes)return a.push(this.readFloat());var o=sc(this);for(a=a||[];this.pos<o;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==kr.Bytes)return a.push(this.readDouble());var o=sc(this);for(a=a||[];this.pos<o;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==kr.Bytes)return a.push(this.readFixed32());var o=sc(this);for(a=a||[];this.pos<o;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==kr.Bytes)return a.push(this.readSFixed32());var o=sc(this);for(a=a||[];this.pos<o;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==kr.Bytes)return a.push(this.readFixed64());var o=sc(this);for(a=a||[];this.pos<o;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==kr.Bytes)return a.push(this.readSFixed64());var o=sc(this);for(a=a||[];this.pos<o;)a.push(this.readSFixed64());return a},skip:function(a){var o=7&a;if(o===kr.Varint)for(;this.buf[this.pos++]>127;);else if(o===kr.Bytes)this.pos=this.readVarint()+this.pos;else if(o===kr.Fixed32)this.pos+=4;else{if(o!==kr.Fixed64)throw new Error("Unimplemented type: "+o);this.pos+=8}},writeTag:function(a,o){this.writeVarint(a<<3|o)},realloc:function(a){for(var o=this.length||16;o<this.pos+a;)o*=2;if(o!==this.length){var l=new Uint8Array(o);l.set(this.buf),this.buf=l,this.length=o}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),Zh(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),Zh(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),Zh(this.buf,-1&a,this.pos),Zh(this.buf,Math.floor(a*r0),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),Zh(this.buf,-1&a,this.pos),Zh(this.buf,Math.floor(a*r0),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(o,l){var u,f,b,S;if(o>=0?(u=o%4294967296|0,f=o/4294967296|0):(f=~(-o/4294967296),4294967295^(u=~(-o%4294967296))?u=u+1|0:(u=0,f=f+1|0)),o>=0x10000000000000000||o<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),b=u,(S=l).buf[S.pos++]=127&b|128,b>>>=7,S.buf[S.pos++]=127&b|128,b>>>=7,S.buf[S.pos++]=127&b|128,b>>>=7,S.buf[S.pos++]=127&b|128,S.buf[S.pos]=127&(b>>>=7),function(b,y){var S=(7&b)<<4;y.buf[y.pos++]|=S|((b>>>=3)?128:0),b&&(y.buf[y.pos++]=127&b|((b>>>=7)?128:0),b&&(y.buf[y.pos++]=127&b|((b>>>=7)?128:0),b&&(y.buf[y.pos++]=127&b|((b>>>=7)?128:0),b&&(y.buf[y.pos++]=127&b|((b>>>=7)?128:0),b&&(y.buf[y.pos++]=127&b)))))}(f,l)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(Boolean(a))},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var o=this.pos;this.pos=function(u,f,b){for(var y,S,T=0;T<f.length;T++){if((y=f.charCodeAt(T))>55295&&y<57344){if(!S){y>56319||T+1===f.length?(u[b++]=239,u[b++]=191,u[b++]=189):S=y;continue}if(y<56320){u[b++]=239,u[b++]=191,u[b++]=189,S=y;continue}y=S-55296<<10|y-56320|65536,S=null}else S&&(u[b++]=239,u[b++]=191,u[b++]=189,S=null);y<128?u[b++]=y:(y<2048?u[b++]=y>>6|192:(y<65536?u[b++]=y>>12|224:(u[b++]=y>>18|240,u[b++]=y>>12&63|128),u[b++]=y>>6&63|128),u[b++]=63&y|128)}return b}(this.buf,a,this.pos);var l=this.pos-o;l>=128&&s0(o,l,this),this.pos=o-1,this.writeVarint(l),this.pos+=l},writeFloat:function(a){this.realloc(4),u_(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),u_(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var o=a.length;this.writeVarint(o),this.realloc(o);for(var l=0;l<o;l++)this.buf[this.pos++]=a[l]},writeRawMessage:function(a,o){this.pos++;var l=this.pos;a(o,this);var u=this.pos-l;u>=128&&s0(l,u,this),this.pos=l-1,this.writeVarint(u),this.pos+=u},writeMessage:function(a,o,l){this.writeTag(a,kr.Bytes),this.writeRawMessage(o,l)},writePackedVarint:function(a,o){o.length&&this.writeMessage(a,u1,o)},writePackedSVarint:function(a,o){o.length&&this.writeMessage(a,Ai,o)},writePackedBoolean:function(a,o){o.length&&this.writeMessage(a,l0,o)},writePackedFloat:function(a,o){o.length&&this.writeMessage(a,Je,o)},writePackedDouble:function(a,o){o.length&&this.writeMessage(a,a0,o)},writePackedFixed32:function(a,o){o.length&&this.writeMessage(a,d1,o)},writePackedSFixed32:function(a,o){o.length&&this.writeMessage(a,h1,o)},writePackedFixed64:function(a,o){o.length&&this.writeMessage(a,c0,o)},writePackedSFixed64:function(a,o){o.length&&this.writeMessage(a,p1,o)},writeBytesField:function(a,o){this.writeTag(a,kr.Bytes),this.writeBytes(o)},writeFixed32Field:function(a,o){this.writeTag(a,kr.Fixed32),this.writeFixed32(o)},writeSFixed32Field:function(a,o){this.writeTag(a,kr.Fixed32),this.writeSFixed32(o)},writeFixed64Field:function(a,o){this.writeTag(a,kr.Fixed64),this.writeFixed64(o)},writeSFixed64Field:function(a,o){this.writeTag(a,kr.Fixed64),this.writeSFixed64(o)},writeVarintField:function(a,o){this.writeTag(a,kr.Varint),this.writeVarint(o)},writeSVarintField:function(a,o){this.writeTag(a,kr.Varint),this.writeSVarint(o)},writeStringField:function(a,o){this.writeTag(a,kr.Bytes),this.writeString(o)},writeFloatField:function(a,o){this.writeTag(a,kr.Fixed32),this.writeFloat(o)},writeDoubleField:function(a,o){this.writeTag(a,kr.Fixed64),this.writeDouble(o)},writeBooleanField:function(a,o){this.writeVarintField(a,Boolean(o))}};class tg{constructor(o,{pixelRatio:l,version:u,stretchX:f,stretchY:b,content:y}){this.paddedRect=o,this.pixelRatio=l,this.stretchX=f,this.stretchY=b,this.content=y,this.version=u}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class f_{constructor(o,l){const u={},f={};this.haveRenderCallbacks=[];const b=[];this.addImages(o,u,b),this.addImages(l,f,b);const{w:y,h:S}=p_(b),T=new ya({width:y||1,height:S||1});for(const E in o){const M=o[E],P=u[E].paddedRect;ya.copy(M.data,T,{x:0,y:0},{x:P.x+1,y:P.y+1},M.data)}for(const E in l){const M=l[E],P=f[E].paddedRect,O=P.x+1,B=P.y+1,V=M.data.width,G=M.data.height;ya.copy(M.data,T,{x:0,y:0},{x:O,y:B},M.data),ya.copy(M.data,T,{x:0,y:G-1},{x:O,y:B-1},{width:V,height:1}),ya.copy(M.data,T,{x:0,y:0},{x:O,y:B+G},{width:V,height:1}),ya.copy(M.data,T,{x:V-1,y:0},{x:O-1,y:B},{width:1,height:G}),ya.copy(M.data,T,{x:0,y:0},{x:O+V,y:B},{width:1,height:G})}this.image=T,this.iconPositions=u,this.patternPositions=f}addImages(o,l,u){for(const f in o){const b=o[f],y={x:0,y:0,w:b.data.width+2,h:b.data.height+2};u.push(y),l[f]=new tg(y,b),b.hasRenderCallback&&this.haveRenderCallbacks.push(f)}}patchUpdatedImages(o,l){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(u=>o.hasImage(u)),o.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const u in o.updatedImages)this.patchUpdatedImage(this.iconPositions[u],o.getImage(u),l),this.patchUpdatedImage(this.patternPositions[u],o.getImage(u),l)}patchUpdatedImage(o,l,u){if(!o||!l||o.version===l.version)return;o.version=l.version;const[f,b]=o.tl;u.update(l.data,void 0,{x:f,y:b})}}tn(tg,"ImagePosition"),tn(f_,"ImageAtlas");const ta={horizontal:1,vertical:2,horizontalOnly:3};class ng{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(o,l){const u=new ng;return u.scale=o||1,u.fontStack=l,u}static forImage(o){const l=new ng;return l.imageName=o,l}}class Yh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(o,l){const u=new Yh;for(let f=0;f<o.sections.length;f++){const b=o.sections[f];b.image?u.addImageSection(b):u.addTextSection(b,l)}return u}length(){return this.text.length}getSection(o){return this.sections[this.sectionIndex[o]]}getSections(){return this.sections}getSectionIndex(o){return this.sectionIndex[o]}getCharCode(o){return this.text.charCodeAt(o)}verticalizePunctuation(o){this.text=function(l,u){let f="";for(let b=0;b<l.length;b++){const y=l.charCodeAt(b+1)||null,S=l.charCodeAt(b-1)||null;f+=!u&&(y&&I(y)&&!Wh[l[b+1]]||S&&I(S)&&!Wh[l[b-1]])||!Wh[l[b]]?l[b]:Wh[l[b]]}return f}(this.text,o)}trim(){let o=0;for(let u=0;u<this.text.length&&Af[this.text.charCodeAt(u)];u++)o++;let l=this.text.length;for(let u=this.text.length-1;u>=0&&u>=o&&Af[this.text.charCodeAt(u)];u--)l--;this.text=this.text.substring(o,l),this.sectionIndex=this.sectionIndex.slice(o,l)}substring(o,l){const u=new Yh;return u.text=this.text.substring(o,l),u.sectionIndex=this.sectionIndex.slice(o,l),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((o,l)=>Math.max(o,this.sections[l].scale),0)}addTextSection(o,l){this.text+=o.text,this.sections.push(ng.forText(o.scale,o.fontStack||l));const u=this.sections.length-1;for(let f=0;f<o.text.length;++f)this.sectionIndex.push(u)}addImageSection(o){const l=o.image?o.image.name:"";if(0===l.length)return void Ni("Can't add FormattedSection with an empty image.");const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(ng.forImage(l)),this.sectionIndex.push(this.sections.length-1)):Ni("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Mf(a,o,l,u,f,b,y,S,T,E,M,P,O,B,V,G){const Z=Yh.fromFeature(a,f);let ce;P===ta.vertical&&Z.verticalizePunctuation(O);const{processBidirectionalText:ye,processStyledBidirectionalText:ue}=ve;if(ye&&1===Z.sections.length){ce=[];const xe=ye(Z.toString(),Qh(Z,E,b,o,u,B,V));for(const tt of xe){const Ze=new Yh;Ze.text=tt,Ze.sections=Z.sections;for(let lt=0;lt<tt.length;lt++)Ze.sectionIndex.push(0);ce.push(Ze)}}else if(ue){ce=[];const xe=ue(Z.text,Z.sectionIndex,Qh(Z,E,b,o,u,B,V));for(const tt of xe){const Ze=new Yh;Ze.text=tt[0],Ze.sectionIndex=tt[1],Ze.sections=Z.sections,ce.push(Ze)}}else ce=function(xe,tt){const Ze=[],lt=xe.text;let Mt=0;for(const ot of tt)Ze.push(xe.substring(Mt,ot)),Mt=ot;return Mt<lt.length&&Ze.push(xe.substring(Mt,lt.length)),Ze}(Z,Qh(Z,E,b,o,u,B,V));const ge=[],De={positionedLines:ge,text:Z.toString(),top:M[1],bottom:M[1],left:M[0],right:M[0],writingMode:P,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(xe,tt,Ze,lt,Mt,ot,_t,yt,Ct,Rt,pt,nn){let ut=0,vn=0,hn=0;const Yt="right"===yt?1:"left"===yt?0:.5;let Zn=!1;for(const ri of Mt){const ki=ri.getSections();for(const Zi of ki){if(Zi.imageName)continue;const Or=tt[Zi.fontStack];if(Or&&(Zn=void 0!==Or.ascender&&void 0!==Or.descender,!Zn))break}if(!Zn)break}let fi=0;for(const ri of Mt){ri.trim();const ki=ri.getMaxScale(),Zi=24*(ki-1),Or={positionedGlyphs:[],lineOffset:0};xe.positionedLines[fi]=Or;const Rr=Or.positionedGlyphs;let Tr=0;if(!ri.length()){vn+=ot,++fi;continue}let Nr=0,fr=0;for(let yi=0;yi<ri.length();yi++){const jr=ri.getSection(yi),Kr=ri.getSectionIndex(yi),vi=ri.getCharCode(yi);let Ht=jr.scale,Jr=null,Hi=null,Br=null,To=24,oo=0;const so=!(Ct===ta.horizontal||!pt&&!C(vi)||pt&&(Af[vi]||(mi=vi,rl(mi)||dd(mi)||Qp(mi)||Qr(mi)||g(mi))));if(jr.imageName){const ko=lt[jr.imageName];if(!ko)continue;Br=jr.imageName,xe.iconsInText=xe.iconsInText||!0,Hi=ko.paddedRect;const ao=ko.displaySize;Ht=24*Ht/nn,Jr={width:ao[0],height:ao[1],left:1,top:-3,advance:so?ao[1]:ao[0],localGlyph:!1},oo=Zn?-Jr.height*Ht:24*ki-17-ao[1]*Ht,To=Jr.advance;const wa=(so?ao[0]:ao[1])*Ht-24*ki;wa>0&&wa>Tr&&(Tr=wa)}else{const ko=Ze[jr.fontStack];if(!ko)continue;ko[vi]&&(Hi=ko[vi]);const ao=tt[jr.fontStack];if(!ao)continue;const wa=ao.glyphs[vi];if(!wa)continue;if(Jr=wa.metrics,To=8203!==vi?24:0,Zn){const Pd=void 0!==ao.ascender?Math.abs(ao.ascender):0,up=void 0!==ao.descender?Math.abs(ao.descender):0,dp=(Pd+up)*Ht;Nr<dp&&(Nr=dp,fr=(Pd-up)/2*Ht),oo=-Pd*Ht}else oo=24*(ki-Ht)-17}so?(xe.verticalizable=!0,Rr.push({glyph:vi,imageName:Br,x:ut,y:vn+oo,vertical:so,scale:Ht,localGlyph:Jr.localGlyph,fontStack:jr.fontStack,sectionIndex:Kr,metrics:Jr,rect:Hi}),ut+=To*Ht+Rt):(Rr.push({glyph:vi,imageName:Br,x:ut,y:vn+oo,vertical:so,scale:Ht,localGlyph:Jr.localGlyph,fontStack:jr.fontStack,sectionIndex:Kr,metrics:Jr,rect:Hi}),ut+=Jr.advance*Ht+Rt)}0!==Rr.length&&(hn=Math.max(ut-Rt,hn),Zn?rg(Rr,Yt,Tr,fr,ot*ki/2):rg(Rr,Yt,Tr,0,ot/2)),ut=0;const go=ot*ki+Tr;Or.lineOffset=Math.max(Tr,Zi),vn+=go,++fi}var mi;const Ui=vn,{horizontalAlign:ii,verticalAlign:Cr}=b_(_t);(function(ri,ki,Zi,Or,Rr,Tr){const Nr=(ki-Zi)*Rr,fr=-Tr*Or;for(const go of ri)for(const yi of go.positionedGlyphs)yi.x+=Nr,yi.y+=fr})(xe.positionedLines,Yt,ii,Cr,hn,Ui),xe.top+=-Cr*Ui,xe.bottom=xe.top+Ui,xe.left+=-ii*hn,xe.right=xe.left+hn,xe.hasBaseline=Zn}(De,o,l,u,ce,y,S,T,P,E,O,G),!function(xe){for(const tt of xe)if(0!==tt.positionedGlyphs.length)return!1;return!0}(ge)&&De}const Af={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},h0={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function wu(a,o,l,u,f,b){if(o.imageName){const y=u[o.imageName];return y?y.displaySize[0]*o.scale*24/b+f:0}{const y=l[o.fontStack],S=y&&y.glyphs[a];return S?S.metrics.advance*o.scale+f:0}}function p0(a,o,l,u){const f=Math.pow(a-o,2);return u?a<o?f/2:2*f:f+Math.abs(l)*l}function m_(a,o,l){let u=0;return 10===a&&(u-=1e4),l&&(u+=150),40!==a&&65288!==a||(u+=50),41!==o&&65289!==o||(u+=50),u}function g_(a,o,l,u,f,b){let y=null,S=p0(o,l,f,b);for(const T of u){const E=p0(o-T.x,l,f,b)+T.badness;E<=S&&(y=T,S=E)}return{index:a,x:o,priorBreak:y,badness:S}}function ig(a){return a?ig(a.priorBreak).concat(a.index):[]}function Qh(a,o,l,u,f,b,y){if("point"!==b)return[];if(!a)return[];const S=[],T=function(O,B,V,G,Z,ce){let ye=0;for(let ue=0;ue<O.length();ue++){const ge=O.getSection(ue);ye+=wu(O.getCharCode(ue),ge,G,Z,B,ce)}return ye/Math.max(1,Math.ceil(ye/V))}(a,o,l,u,f,y),E=a.text.indexOf("\u200b")>=0;let M=0;for(let O=0;O<a.length();O++){const B=a.getSection(O),V=a.getCharCode(O);if(Af[V]||(M+=wu(V,B,u,f,o,y)),O<a.length()-1){const G=!((P=V)<11904||!(fd(P)||Dh(P)||Ah(P)||Il(P)||ef(P)||Kp(P)||Eh(P)||Ac(P)||tf(P)||md(P)||Ih(P)||c(P)||pd(P)||hd(P)||km(P)||Jp(P)||kc(P)||Ml(P)||Rm(P)||Mh(P)));(h0[V]||G||B.imageName)&&S.push(g_(O+1,M,T,S,m_(V,a.getCharCode(O+1),G&&E),!1))}}var P;return ig(g_(a.length(),M,T,S,0,!0))}function b_(a){let o=.5,l=.5;switch(a){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:o,verticalAlign:l}}function rg(a,o,l,u,f){if(!(o||l||u||f))return;const b=a.length-1,y=a[b],S=(y.x+y.metrics.advance*y.scale)*o;for(let T=0;T<=b;T++)a[T].x-=S,a[T].y+=l+u+f}function __(a,o,l){const{horizontalAlign:u,verticalAlign:f}=b_(l),b=o[0]-a.displaySize[0]*u,y=o[1]-a.displaySize[1]*f;return{image:a,top:y,bottom:y+a.displaySize[1],left:b,right:b+a.displaySize[0]}}function Su(a,o,l,u,f,b){const y=a.image;let S;if(y.content){const Z=y.content,ce=y.pixelRatio||1;S=[Z[0]/ce,Z[1]/ce,y.displaySize[0]-Z[2]/ce,y.displaySize[1]-Z[3]/ce]}const T=o.left*b,E=o.right*b;let M,P,O,B;"width"===l||"both"===l?(B=f[0]+T-u[3],P=f[0]+E+u[1]):(B=f[0]+(T+E-y.displaySize[0])/2,P=B+y.displaySize[0]);const V=o.top*b,G=o.bottom*b;return"height"===l||"both"===l?(M=f[1]+V-u[0],O=f[1]+G+u[2]):(M=f[1]+(V+G-y.displaySize[1])/2,O=M+y.displaySize[1]),{image:y,top:M,right:P,bottom:O,left:B,collisionPadding:S}}class ac extends mt{constructor(o,l,u,f,b){super(o,l),this.angle=f,this.z=u,void 0!==b&&(this.segment=b)}clone(){return new ac(this.x,this.y,this.z,this.angle,this.segment)}}function og(a,o,l,u,f){if(void 0===o.segment)return!0;let b=o,y=o.segment+1,S=0;for(;S>-l/2;){if(y--,y<0)return!1;S-=a[y].dist(b),b=a[y]}S+=a[y].dist(a[y+1]),y++;const T=[];let E=0;for(;S<l/2;){const M=a[y],P=a[y+1];if(!P)return!1;let O=a[y-1].angleTo(M)-M.angleTo(P);for(O=Math.abs((O+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:S,angleDelta:O}),E+=O;S-T[0].distance>u;)E-=T.shift().angleDelta;if(E>f)return!1;y++,S+=M.dist(P)}return!0}function f0(a){let o=0;for(let l=0;l<a.length-1;l++)o+=a[l].dist(a[l+1]);return o}function m0(a,o,l){return a?.6*o*l:0}function y_(a,o){return Math.max(a?a.right-a.left:0,o?o.right-o.left:0)}function Kh(a,o,l,u,f,b){const y=m0(l,f,b),S=y_(l,u)*b;let T=0;const E=f0(a)/2;for(let M=0;M<a.length-1;M++){const P=a[M],O=a[M+1],B=P.dist(O);if(T+B>E){const V=(E-T)/B,G=zi(P.x,O.x,V),Z=zi(P.y,O.y,V),ce=new ac(G,Z,0,O.angleTo(P),M);return!y||og(a,ce,S,y,o)?ce:void 0}T+=B}}function f1(a,o,l,u,f,b,y,S,T){const E=m0(u,b,y),M=y_(u,f),P=M*y,O=0===a[0].x||a[0].x===T||0===a[0].y||a[0].y===T;return o-P<o/4&&(o=P+o/4),g0(a,O?o/2*S%o:(M/2+2*b)*y*S%o,o,E,l,P,O,!1,T)}function g0(a,o,l,u,f,b,y,S,T){const E=b/2,M=f0(a);let P=0,O=o-l,B=[];for(let V=0;V<a.length-1;V++){const G=a[V],Z=a[V+1],ce=G.dist(Z),ye=Z.angleTo(G);for(;O+l<P+ce;){O+=l;const ue=(O-P)/ce,ge=zi(G.x,Z.x,ue),De=zi(G.y,Z.y,ue);if(ge>=0&&ge<T&&De>=0&&De<T&&O-E>=0&&O+E<=M){const xe=new ac(ge,De,0,ye,V);xe._round(),u&&!og(a,xe,b,u,f)||B.push(xe)}}P+=ce}return S||B.length||y||(B=g0(a,P/2,l,u,f,b,y,!0,T)),B}function b0(a,o,l,u,f){const b=[];for(let y=0;y<a.length;y++){const S=a[y];let T;for(let E=0;E<S.length-1;E++){let M=S[E],P=S[E+1];M.x<o&&P.x<o||(M.x<o?M=new mt(o,M.y+(o-M.x)/(P.x-M.x)*(P.y-M.y))._round():P.x<o&&(P=new mt(o,M.y+(o-M.x)/(P.x-M.x)*(P.y-M.y))._round()),M.y<l&&P.y<l||(M.y<l?M=new mt(M.x+(l-M.y)/(P.y-M.y)*(P.x-M.x),l)._round():P.y<l&&(P=new mt(M.x+(l-M.y)/(P.y-M.y)*(P.x-M.x),l)._round()),M.x>=u&&P.x>=u||(M.x>=u?M=new mt(u,M.y+(u-M.x)/(P.x-M.x)*(P.y-M.y))._round():P.x>=u&&(P=new mt(u,M.y+(u-M.x)/(P.x-M.x)*(P.y-M.y))._round()),M.y>=f&&P.y>=f||(M.y>=f?M=new mt(M.x+(f-M.y)/(P.y-M.y)*(P.x-M.x),f)._round():P.y>=f&&(P=new mt(M.x+(f-M.y)/(P.y-M.y)*(P.x-M.x),f)._round()),T&&M.equals(T[T.length-1])||(T=[M],b.push(T)),T.push(P)))))}}return b}tn(ac,"Anchor");const kf=1e20;function sg(a,o,l,u,f,b,y,S,T){for(let E=o;E<o+u;E++)v_(a,l*b+E,b,f,y,S,T);for(let E=l;E<l+f;E++)v_(a,E*b+o,1,u,y,S,T)}function v_(a,o,l,u,f,b,y){b[0]=0,y[0]=-kf,y[1]=kf,f[0]=a[o];for(let S=1,T=0,E=0;S<u;S++){f[S]=a[o+S*l];const M=S*S;do{const P=b[T];E=(f[S]-f[P]+M-P*P)/(S-P)/2}while(E<=y[T]&&--T>-1);T++,b[T]=S,y[T]=E,y[T+1]=kf}for(let S=0,T=0;S<u;S++){for(;y[T+1]<S;)T++;const E=b[T],M=S-E;a[o+S*l]=f[E]+M*M}}const ag={none:0,ideographs:1,all:2};class xr{constructor(o,l,u){this.requestManager=o,this.localGlyphMode=l,this.localFontFamily=u,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(o){this.url=o}getGlyphs(o,l){const u=[];for(const f in o)for(const b of o[f])u.push({stack:f,id:b});Un(u,({stack:f,id:b},y)=>{let S=this.entries[f];S||(S=this.entries[f]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let T=S.glyphs[b];if(void 0!==T)return void y(null,{stack:f,id:b,glyph:T});if(T=this._tinySDF(S,f,b),T)return S.glyphs[b]=T,void y(null,{stack:f,id:b,glyph:T});const E=Math.floor(b/256);if(256*E>65535)return void y(new Error("glyphs > 65535 not supported"));if(S.ranges[E])return void y(null,{stack:f,id:b,glyph:T});let M=S.requests[E];M||(M=S.requests[E]=[],xr.loadGlyphRange(f,E,this.url,this.requestManager,(P,O)=>{if(O){S.ascender=O.ascender,S.descender=O.descender;for(const B in O.glyphs)this._doesCharSupportLocalGlyph(+B)||(S.glyphs[+B]=O.glyphs[+B]);S.ranges[E]=!0}for(const B of M)B(P,O);delete S.requests[E]})),M.push((P,O)=>{P?y(P):O&&y(null,{stack:f,id:b,glyph:O.glyphs[b]||null})})},(f,b)=>{if(f)l(f);else if(b){const y={};for(const{stack:S,id:T,glyph:E}of b)void 0===y[S]&&(y[S]={}),void 0===y[S].glyphs&&(y[S].glyphs={}),y[S].glyphs[T]=E&&{id:E.id,bitmap:E.bitmap.clone(),metrics:E.metrics},y[S].ascender=this.entries[S].ascender,y[S].descender=this.entries[S].descender;l(null,y)}})}_doesCharSupportLocalGlyph(o){return this.localGlyphMode!==ag.none&&(this.localGlyphMode===ag.all?!!this.localFontFamily:!!this.localFontFamily&&(md(o)||cs(o)||pd(o)||kc(o)||Ac(o)))}_tinySDF(o,l,u){const f=this.localFontFamily;if(!f||!this._doesCharSupportLocalGlyph(u))return;let b=o.tinySDF;if(!b){let G="400";/bold/i.test(l)?G="900":/medium/i.test(l)?G="500":/light/i.test(l)&&(G="200"),b=o.tinySDF=new xr.TinySDF({fontFamily:f,fontWeight:G,fontSize:48,buffer:6,radius:16}),b.fontWeight=G}if(this.localGlyphs[b.fontWeight][u])return this.localGlyphs[b.fontWeight][u];const y=String.fromCharCode(u),{data:S,width:T,height:E,glyphWidth:M,glyphHeight:P,glyphLeft:O,glyphTop:B,glyphAdvance:V}=b.draw(y);return this.localGlyphs[b.fontWeight][u]={id:u,bitmap:new Vc({width:T,height:E},S),metrics:{width:M/2,height:P/2,left:O/2,top:B/2-27,advance:V/2,localGlyph:!0}}}}function _0(a,o,l,u){const f=[],b=a.image,y=b.pixelRatio,S=b.paddedRect.w-2,T=b.paddedRect.h-2,E=a.right-a.left,M=a.bottom-a.top,P=b.stretchX||[[0,S]],O=b.stretchY||[[0,T]],B=(ot,_t)=>ot+_t[1]-_t[0],V=P.reduce(B,0),G=O.reduce(B,0),Z=S-V,ce=T-G;let ye=0,ue=V,ge=0,De=G,xe=0,tt=Z,Ze=0,lt=ce;if(b.content&&u){const ot=b.content;ye=Jh(P,0,ot[0]),ge=Jh(O,0,ot[1]),ue=Jh(P,ot[0],ot[2]),De=Jh(O,ot[1],ot[3]),xe=ot[0]-ye,Ze=ot[1]-ge,tt=ot[2]-ot[0]-ue,lt=ot[3]-ot[1]-De}const Mt=(ot,_t,yt,Ct)=>{const Rt=cg(ot.stretch-ye,ue,E,a.left),pt=x_(ot.fixed-xe,tt,ot.stretch,V),nn=cg(_t.stretch-ge,De,M,a.top),ut=x_(_t.fixed-Ze,lt,_t.stretch,G),vn=cg(yt.stretch-ye,ue,E,a.left),hn=x_(yt.fixed-xe,tt,yt.stretch,V),Yt=cg(Ct.stretch-ge,De,M,a.top),Zn=x_(Ct.fixed-Ze,lt,Ct.stretch,G),fi=new mt(Rt,nn),mi=new mt(vn,nn),Ui=new mt(vn,Yt),ii=new mt(Rt,Yt),Cr=new mt(pt/y,ut/y),ri=new mt(hn/y,Zn/y),ki=o*Math.PI/180;if(ki){const Rr=Math.sin(ki),Tr=Math.cos(ki),Nr=[Tr,-Rr,Rr,Tr];fi._matMult(Nr),mi._matMult(Nr),ii._matMult(Nr),Ui._matMult(Nr)}const Zi=ot.stretch+ot.fixed,Or=_t.stretch+_t.fixed;return{tl:fi,tr:mi,bl:ii,br:Ui,tex:{x:b.paddedRect.x+1+Zi,y:b.paddedRect.y+1+Or,w:yt.stretch+yt.fixed-Zi,h:Ct.stretch+Ct.fixed-Or},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Cr,pixelOffsetBR:ri,minFontScaleX:tt/y/E,minFontScaleY:lt/y/M,isSDF:l}};if(u&&(b.stretchX||b.stretchY)){const ot=lg(P,Z,V),_t=lg(O,ce,G);for(let yt=0;yt<ot.length-1;yt++){const Ct=ot[yt],Rt=ot[yt+1];for(let pt=0;pt<_t.length-1;pt++)f.push(Mt(Ct,_t[pt],Rt,_t[pt+1]))}}else f.push(Mt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:S+1},{fixed:0,stretch:T+1}));return f}function Jh(a,o,l){let u=0;for(const f of a)u+=Math.max(o,Math.min(l,f[1]))-Math.max(o,Math.min(l,f[0]));return u}function lg(a,o,l){const u=[{fixed:-1,stretch:0}];for(const[f,b]of a){const y=u[u.length-1];u.push({fixed:f-y.stretch,stretch:y.stretch}),u.push({fixed:f-y.stretch,stretch:y.stretch+(b-f)})}return u.push({fixed:o+1,stretch:l}),u}function cg(a,o,l,u){return a/o*l+u}function x_(a,o,l,u){return a-o*l/u}function BE(a,o,l,u){const f=o+a.positionedLines[u].lineOffset;return 0===u?l+f/2:l+(f+(o+a.positionedLines[u-1].lineOffset))/2}xr.loadGlyphRange=function(a,o,l,u,f){const b=256*o,y=b+255,S=u.transformRequest(u.normalizeGlyphsURL(l).replace("{fontstack}",a).replace("{range}",`${b}-${y}`),Xr.Glyphs);Qa(S,(T,E)=>{if(T)f(T);else if(E){const M={},P=new ea(E).readFields(NE,{});for(const O of P.glyphs)M[O.id]=O;f(null,{glyphs:M,ascender:P.ascender,descender:P.descender})}})},xr.TinySDF=class{constructor({fontSize:a=24,buffer:o=3,radius:l=8,cutoff:u=.25,fontFamily:f="sans-serif",fontWeight:b="normal",fontStyle:y="normal"}={}){this.buffer=o,this.cutoff=u,this.radius=l;const S=this.size=a+4*o,T=this._createCanvas(S),E=this.ctx=T.getContext("2d",{willReadFrequently:!0});E.font=`${y} ${b} ${a}px ${f}`,E.textBaseline="alphabetic",E.textAlign="left",E.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(a){const o=document.createElement("canvas");return o.width=o.height=a,o}draw(a){const{width:o,actualBoundingBoxAscent:l,actualBoundingBoxDescent:u,actualBoundingBoxLeft:f,actualBoundingBoxRight:b}=this.ctx.measureText(a),y=Math.ceil(l),S=Math.min(this.size-this.buffer,Math.ceil(b-f)),T=Math.min(this.size-this.buffer,y+Math.ceil(u)),E=S+2*this.buffer,M=T+2*this.buffer,P=Math.max(E*M,0),O=new Uint8ClampedArray(P),B={data:O,width:E,height:M,glyphWidth:S,glyphHeight:T,glyphTop:y,glyphLeft:0,glyphAdvance:o};if(0===S||0===T)return B;const{ctx:V,buffer:G,gridInner:Z,gridOuter:ce}=this;V.clearRect(G,G,S,T),V.fillText(a,G,G+y);const ye=V.getImageData(G,G,S,T);ce.fill(kf,0,P),Z.fill(0,0,P);for(let ue=0;ue<T;ue++)for(let ge=0;ge<S;ge++){const De=ye.data[4*(ue*S+ge)+3]/255;if(0===De)continue;const xe=(ue+G)*E+ge+G;if(1===De)ce[xe]=0,Z[xe]=kf;else{const tt=.5-De;ce[xe]=tt>0?tt*tt:0,Z[xe]=tt<0?tt*tt:0}}sg(ce,0,0,E,M,E,this.f,this.v,this.z),sg(Z,G,G,S,T,E,this.f,this.v,this.z);for(let ue=0;ue<P;ue++){const ge=Math.sqrt(ce[ue])-Math.sqrt(Z[ue]);O[ue]=Math.round(255-255*(ge/this.radius+this.cutoff))}return B}};class zE{constructor(o=[],l=m1){if(this.data=o,this.length=this.data.length,this.compare=l,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(o){this.data.push(o),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const o=this.data[0],l=this.data.pop();return this.length--,this.length>0&&(this.data[0]=l,this._down(0)),o}peek(){return this.data[0]}_up(o){const{data:l,compare:u}=this,f=l[o];for(;o>0;){const b=o-1>>1,y=l[b];if(u(f,y)>=0)break;l[o]=y,o=b}l[o]=f}_down(o){const{data:l,compare:u}=this,f=this.length>>1,b=l[o];for(;o<f;){let y=1+(o<<1),S=l[y];const T=y+1;if(T<this.length&&u(l[T],S)<0&&(y=T,S=l[T]),u(S,b)>=0)break;l[o]=S,o=y}l[o]=b}}function m1(a,o){return a<o?-1:a>o?1:0}function y0(a,o=1,l=!1){let u=1/0,f=1/0,b=-1/0,y=-1/0;const S=a[0];for(let B=0;B<S.length;B++){const V=S[B];(!B||V.x<u)&&(u=V.x),(!B||V.y<f)&&(f=V.y),(!B||V.x>b)&&(b=V.x),(!B||V.y>y)&&(y=V.y)}const T=Math.min(b-u,y-f);let E=T/2;const M=new zE([],VE);if(0===T)return new mt(u,f);for(let B=u;B<b;B+=T)for(let V=f;V<y;V+=T)M.push(new ep(B+E,V+E,E,a));let P=function(B){let V=0,G=0,Z=0;const ce=B[0];for(let ye=0,ue=ce.length,ge=ue-1;ye<ue;ge=ye++){const De=ce[ye],xe=ce[ge],tt=De.x*xe.y-xe.x*De.y;G+=(De.x+xe.x)*tt,Z+=(De.y+xe.y)*tt,V+=3*tt}return new ep(G/V,Z/V,0,B)}(a),O=M.length;for(;M.length;){const B=M.pop();(B.d>P.d||!P.d)&&(P=B,l&&console.log("found best %d after %d probes",Math.round(1e4*B.d)/1e4,O)),B.max-P.d<=o||(E=B.h/2,M.push(new ep(B.p.x-E,B.p.y-E,E,a)),M.push(new ep(B.p.x+E,B.p.y-E,E,a)),M.push(new ep(B.p.x-E,B.p.y+E,E,a)),M.push(new ep(B.p.x+E,B.p.y+E,E,a)),O+=4)}return l&&(console.log(`num probes: ${O}`),console.log(`best distance: ${P.d}`)),P.p}function VE(a,o){return o.max-a.max}function ep(a,o,l,u){this.p=new mt(a,o),this.h=l,this.d=function(f,b){let y=!1,S=1/0;for(let T=0;T<b.length;T++){const E=b[T];for(let M=0,P=E.length,O=P-1;M<P;O=M++){const B=E[M],V=E[O];B.y>f.y!=V.y>f.y&&f.x<(V.x-B.x)*(f.y-B.y)/(V.y-B.y)+B.x&&(y=!y),S=Math.min(S,Bm(f,B,V))}}return(y?1:-1)*Math.sqrt(S)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}const Cu=Number.POSITIVE_INFINITY,g1=Math.sqrt(2);function w_(a,o){return o[1]!==Cu?function(l,u,f){let b=0,y=0;switch(u=Math.abs(u),f=Math.abs(f),l){case"top-right":case"top-left":case"top":y=f-7;break;case"bottom-right":case"bottom-left":case"bottom":y=7-f}switch(l){case"top-right":case"bottom-right":case"right":b=-u;break;case"top-left":case"bottom-left":case"left":b=u}return[b,y]}(a,o[0],o[1]):function(l,u){let f=0,b=0;u<0&&(u=0);const y=u/g1;switch(l){case"top-right":case"top-left":b=y-7;break;case"bottom-right":case"bottom-left":b=7-y;break;case"bottom":b=7-u;break;case"top":b=u-7}switch(l){case"top-right":case"bottom-right":f=-y;break;case"top-left":case"bottom-left":f=y;break;case"left":f=u;break;case"right":f=-u}return[f,b]}(a,o[0])}function ug(a,o,l,u,f,b,y,S,T,E){a.createArrays(),a.tilePixelRatio=Mn/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;const M=a.layers[0].layout,P=a.layers[0]._unevaluatedLayout._values,O={};if("composite"===a.textSizeData.kind){const{minZoom:G,maxZoom:Z}=a.textSizeData;O.compositeTextSizes=[P["text-size"].possiblyEvaluate(new he(G),S),P["text-size"].possiblyEvaluate(new he(Z),S)]}if("composite"===a.iconSizeData.kind){const{minZoom:G,maxZoom:Z}=a.iconSizeData;O.compositeIconSizes=[P["icon-size"].possiblyEvaluate(new he(G),S),P["icon-size"].possiblyEvaluate(new he(Z),S)]}O.layoutTextSize=P["text-size"].possiblyEvaluate(new he(T+1),S),O.layoutIconSize=P["icon-size"].possiblyEvaluate(new he(T+1),S),O.textMaxSize=P["text-size"].possiblyEvaluate(new he(18),S);const B="map"===M.get("text-rotation-alignment")&&"point"!==M.get("symbol-placement"),V=M.get("text-size");for(const G of a.features){const Z=M.get("text-font").evaluate(G,{},S).join(","),ce=V.evaluate(G,{},S),ye=O.layoutTextSize.evaluate(G,{},S),ue=(O.layoutIconSize.evaluate(G,{},S),{horizontal:{},vertical:void 0}),ge=G.text;let De,xe=[0,0];if(ge){const lt=ge.toString(),Mt=24*M.get("text-letter-spacing").evaluate(G,{},S),ot=24*M.get("text-line-height").evaluate(G,{},S),_t=_(lt)?Mt:0,yt=M.get("text-anchor").evaluate(G,{},S),Ct=M.get("text-variable-anchor");if(!Ct){const hn=M.get("text-radial-offset").evaluate(G,{},S);xe=hn?w_(yt,[24*hn,Cu]):M.get("text-offset").evaluate(G,{},S).map(Yt=>24*Yt)}let Rt=B?"center":M.get("text-justify").evaluate(G,{},S);const pt=M.get("symbol-placement"),nn="point"===pt,ut="point"===pt?24*M.get("text-max-width").evaluate(G,{},S):0,vn=hn=>{a.allowVerticalPlacement&&h(lt)&&(ue.vertical=Mf(ge,o,l,f,Z,ut,ot,yt,hn,_t,xe,ta.vertical,!0,pt,ye,ce))};if(!B&&Ct){const hn="auto"===Rt?Ct.map(Zn=>S_(Zn)):[Rt];let Yt=!1;for(let Zn=0;Zn<hn.length;Zn++){const fi=hn[Zn];if(!ue.horizontal[fi])if(Yt)ue.horizontal[fi]=ue.horizontal[0];else{const mi=Mf(ge,o,l,f,Z,ut,ot,"center",fi,_t,xe,ta.horizontal,!1,pt,ye,ce);mi&&(ue.horizontal[fi]=mi,Yt=1===mi.positionedLines.length)}}vn("left")}else{if("auto"===Rt&&(Rt=S_(yt)),nn||M.get("text-writing-mode").indexOf("horizontal")>=0||!h(lt)){const hn=Mf(ge,o,l,f,Z,ut,ot,yt,Rt,_t,xe,ta.horizontal,!1,pt,ye,ce);hn&&(ue.horizontal[Rt]=hn)}vn("point"===pt?"left":Rt)}}let tt=!1;if(G.icon&&G.icon.name){const lt=u[G.icon.name];lt&&(De=__(f[G.icon.name],M.get("icon-offset").evaluate(G,{},S),M.get("icon-anchor").evaluate(G,{},S)),tt=lt.sdf,void 0===a.sdfIcons?a.sdfIcons=lt.sdf:a.sdfIcons!==lt.sdf&&Ni("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(lt.pixelRatio!==a.pixelRatio||0!==M.get("icon-rotate").constantOr(1))&&(a.iconsNeedLinear=!0))}const Ze=w0(ue.horizontal)||ue.vertical;a.iconsInText||(a.iconsInText=!!Ze&&Ze.iconsInText),(Ze||De)&&v0(a,G,ue,De,u,O,ye,0,xe,tt,y,S,E)}b&&a.generateCollisionDebugBuffers(T,a.collisionBoxArray)}function S_(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function v0(a,o,l,u,f,b,y,S,T,E,M,P,O){let B=b.textMaxSize.evaluate(o,{},P);void 0===B&&(B=y);const V=a.layers[0].layout,G=V.get("icon-offset").evaluate(o,{},P),Z=w0(l.horizontal)||l.vertical,ce="globe"===O.name,ye=y/24,ue=a.tilePixelRatio*B/24,ge=(_t=a.overscaling,a.zoom>18&&_t>2&&(_t>>=1),Math.max(Mn/(512*_t),1)*V.get("symbol-spacing")),De=V.get("text-padding")*a.tilePixelRatio,xe=V.get("icon-padding")*a.tilePixelRatio,tt=Ae(V.get("text-max-angle")),Ze="map"===V.get("text-rotation-alignment")&&"point"!==V.get("symbol-placement"),lt="map"===V.get("icon-rotation-alignment")&&"point"!==V.get("symbol-placement"),Mt=V.get("symbol-placement"),ot=ge/2;var _t;const yt=V.get("icon-text-fit");let Ct;u&&"none"!==yt&&(a.allowVerticalPlacement&&l.vertical&&(Ct=Su(u,l.vertical,yt,V.get("icon-text-fit-padding"),G,ye)),Z&&(u=Su(u,Z,yt,V.get("icon-text-fit-padding"),G,ye)));const Rt=(pt,nn,ut)=>{if(nn.x<0||nn.x>=Mn||nn.y<0||nn.y>=Mn)return;let vn=null;if(ce){const{x:hn,y:Yt,z:Zn}=O.projectTilePoint(nn.x,nn.y,ut);vn={anchor:new ac(hn,Yt,Zn,0,void 0),up:O.upVector(ut,nn.x,nn.y)}}!function(hn,Yt,Zn,fi,mi,Ui,ii,Cr,ri,ki,Zi,Or,Rr,Tr,Nr,fr,go,yi,jr,Kr,vi,Ht,Jr,Hi,Br){const To=hn.addToLineVertexArray(Yt,fi);let oo,so,ko,ao,wa,Pd,up,dp=0,K_=0,J_=0,ey=0,Cg=-1,Tg=-1;const Ll={};let H0=Pc.exports("");const Od=Zn?Zn.anchor:Yt;let ty=0,cn=0;if(void 0===ri._unevaluatedLayout.getValue("text-radial-offset")?[ty,cn]=ri.layout.get("text-offset").evaluate(vi,{},Br).map(Vs=>24*Vs):(ty=24*ri.layout.get("text-radial-offset").evaluate(vi,{},Br),cn=Cu),hn.allowVerticalPlacement&&mi.vertical){const Vs=mi.vertical;if(Nr)Pd=C_(Vs),Cr&&(up=C_(Cr));else{const Sa=ri.layout.get("text-rotate").evaluate(vi,{},Br)+90;ko=dg(ki,Od,Yt,Zi,Or,Rr,Vs,Tr,Sa,fr),Cr&&(ao=dg(ki,Od,Yt,Zi,Or,Rr,Cr,yi,Sa))}}if(Ui){const Vs=ri.layout.get("icon-rotate").evaluate(vi,{},Br),Sa="none"!==ri.layout.get("icon-text-fit"),Ee=_0(Ui,Vs,Jr,Sa),Pe=Cr?_0(Cr,Vs,Jr,Sa):void 0;so=dg(ki,Od,Yt,Zi,Or,Rr,Ui,yi,Vs),dp=4*Ee.length;const qn=hn.iconSizeData;let Ld=null;"source"===qn.kind?(Ld=[Ol*ri.layout.get("icon-size").evaluate(vi,{},Br)],Ld[0]>Tu&&Ni(`${hn.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===qn.kind&&(Ld=[Ol*Ht.compositeIconSizes[0].evaluate(vi,{},Br),Ol*Ht.compositeIconSizes[1].evaluate(vi,{},Br)],(Ld[0]>Tu||Ld[1]>Tu)&&Ni(`${hn.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),hn.addSymbols(hn.icon,Ee,Ld,Kr,jr,vi,!1,Zn,Yt,To.lineStartIndex,To.lineLength,-1,Hi,Br),Cg=hn.icon.placedSymbolArray.length-1,Pe&&(K_=4*Pe.length,hn.addSymbols(hn.icon,Pe,Ld,Kr,jr,vi,ta.vertical,Zn,Yt,To.lineStartIndex,To.lineLength,-1,Hi,Br),Tg=hn.icon.placedSymbolArray.length-1)}for(const Vs in mi.horizontal){const Sa=mi.horizontal[Vs];oo||(H0=Pc.exports(Sa.text),Nr?wa=C_(Sa):oo=dg(ki,Od,Yt,Zi,Or,Rr,Sa,Tr,ri.layout.get("text-rotate").evaluate(vi,{},Br),fr));const Ee=1===Sa.positionedLines.length;if(J_+=x0(hn,Zn,Yt,Sa,ii,ri,Nr,vi,fr,To,mi.vertical?ta.horizontal:ta.horizontalOnly,Ee?Object.keys(mi.horizontal):[Vs],Ll,Cg,Ht,Hi,Br),Ee)break}mi.vertical&&(ey+=x0(hn,Zn,Yt,mi.vertical,ii,ri,Nr,vi,fr,To,ta.vertical,["vertical"],Ll,Tg,Ht,Hi,Br));let ku=-1;const Ua=(Vs,Sa)=>Vs?Math.max(Vs,Sa):Sa;ku=Ua(wa,ku),ku=Ua(Pd,ku),ku=Ua(up,ku);const dt=ku>-1?1:0;hn.glyphOffsetArray.length>=Ad.MAX_GLYPHS&&Ni("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==vi.sortKey&&hn.addToSortKeyRanges(hn.symbolInstances.length,vi.sortKey),hn.symbolInstances.emplaceBack(Od.x,Od.y,Od.z,Yt.x,Yt.y,Ll.right>=0?Ll.right:-1,Ll.center>=0?Ll.center:-1,Ll.left>=0?Ll.left:-1,Ll.vertical>=0?Ll.vertical:-1,Cg,Tg,H0,void 0!==oo?oo:hn.collisionBoxArray.length,void 0!==oo?oo+1:hn.collisionBoxArray.length,void 0!==ko?ko:hn.collisionBoxArray.length,void 0!==ko?ko+1:hn.collisionBoxArray.length,void 0!==so?so:hn.collisionBoxArray.length,void 0!==so?so+1:hn.collisionBoxArray.length,ao||hn.collisionBoxArray.length,ao?ao+1:hn.collisionBoxArray.length,Zi,J_,ey,dp,K_,dt,0,ty,cn,ku)}(a,nn,vn,pt,l,u,f,Ct,a.layers[0],a.collisionBoxArray,o.index,o.sourceLayerIndex,a.index,De,Ze,T,0,xe,lt,G,o,b,E,M,P)};if("line"===Mt)for(const pt of b0(o.geometry,0,0,Mn,Mn)){const nn=f1(pt,ge,tt,l.vertical||Z,u,24,ue,a.overscaling,Mn);for(const ut of nn){const vn=Z;vn&&S0(a,vn.text,ot,ut)||Rt(pt,ut,P)}}else if("line-center"===Mt){for(const pt of o.geometry)if(pt.length>1){const nn=Kh(pt,tt,l.vertical||Z,u,24,ue);nn&&Rt(pt,nn,P)}}else if("Polygon"===o.type)for(const pt of Xb(o.geometry,0)){const nn=y0(pt,16);Rt(pt[0],new ac(nn.x,nn.y,0,0,void 0),P)}else if("LineString"===o.type)for(const pt of o.geometry)Rt(pt,new ac(pt[0].x,pt[0].y,0,0,void 0),P);else if("Point"===o.type)for(const pt of o.geometry)for(const nn of pt)Rt([nn],new ac(nn.x,nn.y,0,0,void 0),P)}const Tu=32640;function x0(a,o,l,u,f,b,y,S,T,E,M,P,O,B,V,G,Z){const ce=function(ge,De,xe,tt,Ze,lt,Mt,ot){const _t=[];if(0===De.positionedLines.length)return _t;const yt=tt.layout.get("text-rotate").evaluate(lt,{})*Math.PI/180,Ct=function(vn){const hn=vn[0],Yt=vn[1],Zn=hn*Yt;return Zn>0?[hn,-Yt]:Zn<0?[-hn,Yt]:0===hn?[Yt,hn]:[Yt,-hn]}(xe);let Rt=Math.abs(De.top-De.bottom);for(const vn of De.positionedLines)Rt-=vn.lineOffset;const pt=De.positionedLines.length,nn=Rt/pt;let ut=De.top-xe[1];for(let vn=0;vn<pt;++vn){const hn=De.positionedLines[vn];ut=BE(De,nn,ut,vn);for(const Yt of hn.positionedGlyphs){if(!Yt.rect)continue;const Zn=Yt.rect||{};let fi=4,mi=!0,Ui=1,ii=0;if(Yt.imageName){const Hi=Mt[Yt.imageName];if(!Hi)continue;if(Hi.sdf){Ni("SDF images are not supported in formatted text and will be ignored.");continue}mi=!1,Ui=Hi.pixelRatio,fi=1/Ui}const Cr=(Ze||ot)&&Yt.vertical,ri=Yt.metrics.advance*Yt.scale/2,ki=Yt.metrics,Zi=Yt.rect;if(null===Zi)continue;ot&&De.verticalizable&&(ii=Yt.imageName?ri-Yt.metrics.width*Yt.scale/2:0);const Or=Ze?[Yt.x+ri,Yt.y]:[0,0];let Rr=[0,0],Tr=[0,0],Nr=!1;Ze||(Cr?(Tr=[Yt.x+ri+Ct[0],Yt.y+Ct[1]-ii],Nr=!0):Rr=[Yt.x+ri+xe[0],Yt.y+xe[1]-ii]);const fr=Zi.w*Yt.scale/(Ui*(Yt.localGlyph?2:1)),go=Zi.h*Yt.scale/(Ui*(Yt.localGlyph?2:1));let yi,jr,Kr,vi;if(Cr){const Hi=Yt.y-ut,Br=new mt(-ri,ri-Hi),To=-Math.PI/2,oo=new mt(...Tr);yi=new mt(-ri+Rr[0],Rr[1]),yi._rotateAround(To,Br)._add(oo),yi.x+=-Hi+ri,yi.y-=(ki.left-fi)*Yt.scale;const so=Yt.imageName?ki.advance*Yt.scale:24*Yt.scale,ko=String.fromCharCode(Yt.glyph);l1(ko)?yi.x+=(1-fi)*Yt.scale:c1(ko)?yi.x+=so-ki.height*Yt.scale+(-fi-1)*Yt.scale:yi.x+=Yt.imageName||ki.width+2*fi===Zi.w&&ki.height+2*fi===Zi.h?(so-go)/2:(so-(ki.height+2*fi)*Yt.scale)/2,jr=new mt(yi.x,yi.y-fr),Kr=new mt(yi.x+go,yi.y),vi=new mt(yi.x+go,yi.y-fr)}else{const Hi=(ki.left-fi)*Yt.scale-ri+Rr[0],Br=(-ki.top-fi)*Yt.scale+Rr[1],To=Hi+fr,oo=Br+go;yi=new mt(Hi,Br),jr=new mt(To,Br),Kr=new mt(Hi,oo),vi=new mt(To,oo)}if(yt){let Hi;Hi=Ze?new mt(0,0):Nr?new mt(Ct[0],Ct[1]):new mt(xe[0],xe[1]),yi._rotateAround(yt,Hi),jr._rotateAround(yt,Hi),Kr._rotateAround(yt,Hi),vi._rotateAround(yt,Hi)}const Ht=new mt(0,0),Jr=new mt(0,0);_t.push({tl:yi,tr:jr,bl:Kr,br:vi,tex:Zn,writingMode:De.writingMode,glyphOffset:Or,sectionIndex:Yt.sectionIndex,isSDF:mi,pixelOffsetTL:Ht,pixelOffsetBR:Jr,minFontScaleX:0,minFontScaleY:0})}}return _t}(0,u,T,b,y,S,f,a.allowVerticalPlacement),ye=a.textSizeData;let ue=null;"source"===ye.kind?(ue=[Ol*b.layout.get("text-size").evaluate(S,{},Z)],ue[0]>Tu&&Ni(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===ye.kind&&(ue=[Ol*V.compositeTextSizes[0].evaluate(S,{},Z),Ol*V.compositeTextSizes[1].evaluate(S,{},Z)],(ue[0]>Tu||ue[1]>Tu)&&Ni(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),a.addSymbols(a.text,ce,ue,T,y,S,M,o,l,E.lineStartIndex,E.lineLength,B,G,Z);for(const ge of P)O[ge]=a.text.placedSymbolArray.length-1;return 4*ce.length}function w0(a){for(const o in a)return a[o];return null}function dg(a,o,l,u,f,b,y,S,T,E){let M=y.top,P=y.bottom,O=y.left,B=y.right;const V=y.collisionPadding;if(V&&(O-=V[0],M-=V[1],B+=V[2],P+=V[3]),T){const G=new mt(O,M),Z=new mt(B,M),ce=new mt(O,P),ye=new mt(B,P),ue=Ae(T);let ge=new mt(0,0);E&&(ge=new mt(E[0],E[1])),G._rotateAround(ue,ge),Z._rotateAround(ue,ge),ce._rotateAround(ue,ge),ye._rotateAround(ue,ge),O=Math.min(G.x,Z.x,ce.x,ye.x),B=Math.max(G.x,Z.x,ce.x,ye.x),M=Math.min(G.y,Z.y,ce.y,ye.y),P=Math.max(G.y,Z.y,ce.y,ye.y)}return a.emplaceBack(o.x,o.y,o.z,l.x,l.y,O,M,B,P,S,u,f,b),a.length-1}function C_(a){a.collisionPadding&&(a.top-=a.collisionPadding[1],a.bottom+=a.collisionPadding[3]);const o=a.bottom-a.top;return o>0?Math.max(10,o):null}function S0(a,o,l,u){const f=a.compareText;if(o in f){const b=f[o];for(let y=b.length-1;y>=0;y--)if(u.dist(b[y])<l)return!0}else f[o]=[];return f[o].push(u),!1}const b1=Nt([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:T_}=b1,D_=Nt([{name:"a_pos_3",components:3,type:"Int16"}]);var Cd=Nt([{name:"a_pos",type:"Int16",components:2}]);const Du=Mn/Math.PI/2,Rf=2*Fa(1,0)*Du*Math.PI,Pf=[64,32,16],$=-Du,zs=Du,_1=[new Zo([$,$,$],[zs,zs,zs]),new Zo([$,$,$],[0,0,zs]),new Zo([0,$,$],[zs,0,zs]),new Zo([$,0,$],[0,zs,zs]),new Zo([0,0,$],[zs,zs,zs])];function C0(a,o,l,u=!0){const f=Ba([],a._camera.position,a.worldSize),b=[o,l,1,1];zc(b,b,a.pixelMatrixInverse),Um(b,b,1/b[3]);const y=Ds([],rc([],b,f)),S=a.globeMatrix,T=[S[12],S[13],S[14]],E=rc([],T,f),M=hf(E),P=Ds([],E),O=a.worldSize/(2*Math.PI),B=Ao(P,y),V=Math.asin(O/M);if(V<Math.acos(B)){if(!u)return null;const Mt=[],ot=[];Ba(Mt,y,M/B),Ds(ot,rc(ot,Mt,E)),Ds(y,Nc(y,E,Ba(y,ot,Math.tan(V)*M)))}const G=[];new zb(f,y).closestPointOnSphere(T,O,G);const Z=Ds([],vl(S,0)),ce=Ds([],vl(S,1)),ye=Ds([],vl(S,2)),ue=Ao(Z,G),ge=Ao(ce,G),De=Ao(ye,G),xe=ee(Math.asin(-ge/O));let tt=ee(Math.atan2(ue,De));tt=a.center.lng+function(Mt,ot){const _t=(ot-Mt+180)%360-180;return _t<-180?_t+360:_t}(a.center.lng,tt);const Ze=ll(tt),lt=Ke(Cs(xe),0,1);return new bd(Ze,lt)}class E_{constructor(o,l,u){this.a=rc([],o,u),this.b=rc([],l,u),this.center=u;const f=Ds([],this.a),b=Ds([],this.b);this.angle=Math.acos(Ao(f,b))}}function T0(a,o){if(0===a.angle)return null;let l;return l=0===a.a[o]?1/a.angle*.5*Math.PI:1/a.angle*Math.atan(a.b[o]/a.a[o]/Math.sin(a.angle)-1/Math.tan(a.angle)),l<0||l>1?null:function(u,f,b,y){const S=Math.sin(b);return u*(Math.sin((1-y)*b)/S)+f*(Math.sin(y*b)/S)}(a.a[o],a.b[o],a.angle,Ke(l,0,1))+a.center[o]}function Hc(a){if(a.z<=1)return _1[a.z+2*a.y+a.x];const o=D0(I_(a));return Zo.fromPoints(o)}function $c(a,o,l){return Ba(a,a,1-l),Bc(a,a,o,l)}function y1(a,o){const l=Ed(o.zoom);if(0===l)return Hc(a);const u=I_(a),f=D0(u),b=ll(u.getWest())*o.worldSize,y=ll(u.getEast())*o.worldSize,S=Cs(u.getNorth())*o.worldSize,T=Cs(u.getSouth())*o.worldSize,E=[b,S,0],M=[y,S,0],P=[b,T,0],O=[y,T,0],B=Ob([],o.globeMatrix);return mo(E,E,B),mo(M,M,B),mo(P,P,B),mo(O,O,B),f[0]=$c(f[0],P,l),f[1]=$c(f[1],O,l),f[2]=$c(f[2],M,l),f[3]=$c(f[3],E,l),Zo.fromPoints(f)}function v1(a,o,l){for(const u of a)mo(u,u,o),Ba(u,u,l)}function I_({x:a,y:o,z:l}){const u=1/(1<<l),f=new Xi(Ts(a*u),us((o+1)*u)),b=new Xi(Ts((a+1)*u),us(o*u));return new nc(f,b)}function D0(a){const o=Ae(a.getNorth()),l=Ae(a.getSouth()),u=Math.cos(o),f=Math.cos(l),b=Math.sin(o),y=Math.sin(l),S=a.getWest(),T=a.getEast();return[Td(f,y,S),Td(f,y,T),Td(u,b,T),Td(u,b,S)]}function Td(a,o,l,u=Du){return l=Ae(l),[a*Math.sin(l)*u,-o*u,a*Math.cos(l)*u]}function Dd(a,o,l){return Td(Math.cos(Ae(a)),Math.sin(Ae(a)),o,l)}function np(a,o,l,u){const f=1<<l.z,b=(a/Mn+l.x)/f;return Dd(us((o/Mn+l.y)/f),Ts(b),u)}function hg({min:a,max:o}){return 16383/Math.max(o[0]-a[0],o[1]-a[1],o[2]-a[2])}const M_=new Float64Array(16);function ip(a){const o=hg(a),l=Mv(M_,[o,o,o]);return df(l,l,((u=[])[0]=-(f=a.min)[0],u[1]=-f[1],u[2]=-f[2],u));var u,f}function rp(a){const o=(u=a.min,(l=M_)[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=u[0],l[13]=u[1],l[14]=u[2],l[15]=1,l);var l,u;const f=1/hg(a);return _d(o,o,[f,f,f])}function ul(a,o,l,u,f){const b=function(T){const E=Mn/(2*Math.PI);return T/(2*Math.PI)/E}(l),y=[a,o,-l/(2*Math.PI)],S=ic(new Float64Array(16));return df(S,S,y),_d(S,S,[b,b,b]),Js(S,S,Ae(-f)),Na(S,S,Ae(-u)),S}function Ed(a){return sn(5,6,a)}function E0(a,o){const l=Dd(o.lat,o.lng);return y=(f=Fb([],function(V){const G=Dd(V._center.lat,V._center.lng);let Z=vd([],yd(0,1,0),G);const ce=Av([],-V.angle,G);Z=mo(Z,Z,ce),Av(ce,-V._pitch,Z);const ye=Ds([],G);return Ba(ye,ye,V.cameraToCenterDistance/V.pixelsPerMeter*Rf),mo(ye,ye,ce),Nc([],G,ye)}(a),l))[0],S=f[1],T=f[2],E=(b=l)[0],M=b[1],P=b[2],B=(O=Math.sqrt(y*y+S*S+T*T)*Math.sqrt(E*E+M*M+P*P))&&Ao(f,b)/O,Math.acos(Math.min(Math.max(B,-1),1));var f,b,y,S,T,E,M,P,O,B}const pg=Ae(85),Gc=Math.cos(pg),A_=Math.sin(pg);function k_(a,o){const l=a.fovAboveCenter,u=a.elevation?a.elevation.getMinElevationBelowMSL()*o:0,f=(a._camera.position[2]*a.worldSize-u)/Math.cos(a._pitch),b=Math.sin(l)*f/Math.sin(Math.max(Math.PI/2-a._pitch-l,.01)),y=Math.sin(a._pitch)*b+f;return Math.min(1.01*y,f*(1/a._horizonShift))}function qc(a,o){if(!o.isReprojectedInTileSpace)return{scale:1<<a.z,x:a.x,y:a.y,x2:a.x+1,y2:a.y+1,projection:o};const l=Math.pow(2,-a.z),u=a.x*l,f=(a.x+1)*l,b=a.y*l,y=(a.y+1)*l,S=Ts(u),T=Ts(f),E=us(b),M=us(y),P=o.project(S,E),O=o.project(T,E),B=o.project(T,M),V=o.project(S,M);let G=Math.min(P.x,O.x,B.x,V.x),Z=Math.min(P.y,O.y,B.y,V.y),ce=Math.max(P.x,O.x,B.x,V.x),ye=Math.max(P.y,O.y,B.y,V.y);const ue=l/16;function ge(xe,tt,Ze,lt,Mt,ot){const _t=(Ze+Mt)/2,yt=(lt+ot)/2,Ct=o.project(Ts(_t),us(yt)),Rt=Math.max(0,G-Ct.x,Z-Ct.y,Ct.x-ce,Ct.y-ye);G=Math.min(G,Ct.x),ce=Math.max(ce,Ct.x),Z=Math.min(Z,Ct.y),ye=Math.max(ye,Ct.y),Rt>ue&&(ge(xe,Ct,Ze,lt,_t,yt),ge(Ct,tt,_t,yt,Mt,ot))}ge(P,O,u,b,f,b),ge(O,B,f,b,f,y),ge(B,V,f,y,u,y),ge(V,P,u,y,u,b),G-=ue,Z-=ue,ce+=ue,ye+=ue;const De=1/Math.max(ce-G,ye-Z);return{scale:De,x:G*De,y:Z*De,x2:ce*De,y2:ye*De,projection:o}}const UE=ic(new Float32Array(16));class Wc{constructor(o){this.spec=o,this.name=o.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(o,l){return{x:0,y:0,z:0}}unproject(o,l){return new Xi(0,0)}projectTilePoint(o,l,u){return{x:o,y:l,z:0}}locationPoint(o,l,u=!0){return o._coordinatePoint(o.locationCoordinate(l),u)}pixelsPerMeter(o,l){return Fa(1,o)*l}pixelSpaceConversion(o,l,u){return 1}farthestPixelDistance(o){return k_(o,o.pixelsPerMeter)}pointCoordinate(o,l,u,f){const b=o.horizonLineFromTop(!1),y=new mt(l,Math.max(b,u));return o.rayIntersectionCoordinate(o.pointRayIntersection(y,f))}pointCoordinate3D(o,l,u){const f=new mt(l,u);if(o.elevation)return o.elevation.pointCoordinate(f);{const b=this.pointCoordinate(o,f.x,f.y,0);return[b.x,b.y,b.z]}}isPointAboveHorizon(o,l){if(o.elevation)return!this.pointCoordinate3D(o,l.x,l.y);const u=o.horizonLineFromTop();return l.y<u}createInversionMatrix(o,l){return UE}createTileMatrix(o,l,u){let f,b,y;const S=u.canonical,T=ic(new Float64Array(16));if(this.isReprojectedInTileSpace){const E=qc(S,this);f=1,b=E.x+u.wrap*E.scale,y=E.y,_d(T,T,[f/E.scale,f/E.scale,o.pixelsPerMeter/l])}else f=l/o.zoomScale(S.z),b=(S.x+Math.pow(2,S.z)*u.wrap)*f,y=S.y*f;return df(T,T,[b,y,0]),_d(T,T,[f/Mn,f/Mn,1]),T}upVector(o,l,u){return[0,0,1]}upVectorScale(o,l,u){return{metersToTile:1}}}class HE extends Wc{constructor(o){super(o),this.range=[4,7],this.center=o.center||[-96,37.5];const[l,u]=this.parallels=o.parallels||[29.5,45.5],f=Math.sin(Ae(l));this.n=(f+Math.sin(Ae(u)))/2,this.c=1+f*(2*this.n-f),this.r0=Math.sqrt(this.c)/this.n}project(o,l){const{n:u,c:f,r0:b}=this,y=Ae(o-this.center[0]),S=Ae(l),T=Math.sqrt(f-2*u*Math.sin(S))/u;return{x:T*Math.sin(y*u),y:T*Math.cos(y*u)-b,z:0}}unproject(o,l){const{n:u,c:f,r0:b}=this,y=b+l;let S=Math.atan2(o,Math.abs(y))*Math.sign(y);y*u<0&&(S-=Math.PI*Math.sign(o)*Math.sign(y));const T=Ae(this.center[0])*u;S=wn(S,-Math.PI-T,Math.PI-T);const E=Ke(ee(S/u)+this.center[0],-180,180),M=Math.asin(Ke((f-(o*o+y*y)*u*u)/(2*u),-1,1)),P=Ke(ee(M),-85.051129,_a);return new Xi(E,P)}}const Eu=1.340264,Iu=-.081106,Id=893e-6,Md=.003796,op=Math.sqrt(3)/2;class $E extends Wc{project(o,l){l=l/180*Math.PI,o=o/180*Math.PI;const u=Math.asin(op*Math.sin(l)),f=u*u,b=f*f*f;return{x:.5*(o*Math.cos(u)/(op*(Eu+3*Iu*f+b*(7*Id+9*Md*f)))/Math.PI+.5),y:1-.5*(u*(Eu+Iu*f+b*(Id+Md*f))/Math.PI+1),z:0}}unproject(o,l){o=(2*o-.5)*Math.PI;let u=l=(2*(1-l)-1)*Math.PI,f=u*u,b=f*f*f;for(let M,P,O,B=0;B<12&&(P=u*(Eu+Iu*f+b*(Id+Md*f))-l,O=Eu+3*Iu*f+b*(7*Id+9*Md*f),M=P/O,u=Ke(u-M,-Math.PI/3,Math.PI/3),f=u*u,b=f*f*f,!(Math.abs(M)<1e-12));++B);const y=op*o*(Eu+3*Iu*f+b*(7*Id+9*Md*f))/Math.cos(u),S=Math.asin(Math.sin(u)/op),T=Ke(180*y/Math.PI,-180,180),E=Ke(180*S/Math.PI,-85.051129,_a);return new Xi(T,E)}}class x1 extends Wc{constructor(o){super(o),this.wrap=!0,this.supportsWorldCopies=!0}project(o,l){return{x:.5+o/360,y:.5-l/360,z:0}}unproject(o,l){const u=360*(o-.5),f=Ke(360*(.5-l),-85.051129,_a);return new Xi(u,f)}}const sp=Math.PI/2;function fg(a){return Math.tan((sp+a)/2)}class w1 extends Wc{constructor(o){super(o),this.center=o.center||[0,30];const[l,u]=this.parallels=o.parallels||[30,30];let f=Ae(l),b=Ae(u);this.southernCenter=f+b<0,this.southernCenter&&(f=-f,b=-b);const y=Math.cos(f),S=fg(f);this.n=f===b?Math.sin(f):Math.log(y/Math.cos(b))/Math.log(fg(b)/S),this.f=y*Math.pow(fg(f),this.n)/this.n}project(o,l){l=Ae(l),this.southernCenter&&(l=-l),o=Ae(o-this.center[0]);const u=1e-6,{n:f,f:b}=this;b>0?l<-sp+u&&(l=-sp+u):l>sp-u&&(l=sp-u);const y=b/Math.pow(fg(l),f);let S=y*Math.sin(f*o),T=b-y*Math.cos(f*o);return S=.5*(S/Math.PI+.5),T=.5*(T/Math.PI+.5),{x:S,y:this.southernCenter?T:1-T,z:0}}unproject(o,l){o=(2*o-.5)*Math.PI,this.southernCenter&&(l=1-l),l=(2*(1-l)-.5)*Math.PI;const{n:u,f}=this,b=f-l,y=Math.sign(b),S=Math.sign(u)*Math.sqrt(o*o+b*b);let T=Math.atan2(o,Math.abs(b))*y;b*u<0&&(T-=Math.PI*Math.sign(o)*y);const E=Ke(ee(T/u)+this.center[0],-180,180),M=Ke(ee(2*Math.atan(Math.pow(f/S,1/u))-sp),-85.051129,_a);return new Xi(E,this.southernCenter?-M:M)}}class R_ extends Wc{constructor(o){super(o),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(o,l){return{x:ll(o),y:Cs(l),z:0}}unproject(o,l){const u=Ts(o),f=us(l);return new Xi(u,f)}}const S1=Ae(_a);class C1 extends Wc{project(o,l){const u=(l=Ae(l))*l,f=u*u;return{x:.5*((o=Ae(o))*(.8707-.131979*u+f*(f*(.003971*u-.001529*f)-.013791))/Math.PI+.5),y:1-.5*(l*(1.007226+u*(.015085+f*(.028874*u-.044475-.005916*f)))/Math.PI+1),z:0}}unproject(o,l){o=(2*o-.5)*Math.PI;let u=l=(2*(1-l)-1)*Math.PI,f=25,b=0,y=u*u;do{y=u*u;const E=y*y;b=(u*(1.007226+y*(.015085+E*(.028874*y-.044475-.005916*E)))-l)/(1.007226+y*(.045255+E*(.259866*y-.311325-.005916*11*E))),u=Ke(u-b,-S1,S1)}while(Math.abs(b)>1e-6&&--f>0);y=u*u;const S=Ke(ee(o/(.8707+y*(y*(y*y*y*(.003971-.001529*y)-.013791)-.131979))),-180,180),T=ee(u);return new Xi(S,T)}}const T1=Ae(_a);class I0 extends Wc{project(o,l){l=Ae(l),o=Ae(o);const u=Math.cos(l),f=2/Math.PI,b=Math.acos(u*Math.cos(o/2)),y=Math.sin(b)/b,S=.5*(o*f+2*u*Math.sin(o/2)/y)||0,T=.5*(l+Math.sin(l)/y)||0;return{x:.5*(S/Math.PI+.5),y:1-.5*(T/Math.PI+1),z:0}}unproject(o,l){let u=o=(2*o-.5)*Math.PI,f=l=(2*(1-l)-1)*Math.PI,b=25;const y=1e-6;let S=0,T=0;do{const E=Math.cos(f),M=Math.sin(f),P=2*M*E,O=M*M,B=E*E,V=Math.cos(u/2),G=Math.sin(u/2),Z=2*V*G,ce=G*G,ye=1-B*V*V,ue=ye?1/ye:0,ge=ye?Math.acos(E*V)*Math.sqrt(1/ye):0,De=.5*(2*ge*E*G+2*u/Math.PI)-o,xe=.5*(ge*M+f)-l,tt=.5*ue*(B*ce+ge*E*V*O)+1/Math.PI,Ze=ue*(Z*P/4-ge*M*G),lt=.125*ue*(P*G-ge*M*B*Z),Mt=.5*ue*(O*V+ge*ce*E)+.5,ot=Ze*lt-Mt*tt;S=(xe*Ze-De*Mt)/ot,T=(De*lt-xe*tt)/ot,u=Ke(u-S,-Math.PI,Math.PI),f=Ke(f-T,-T1,T1)}while((Math.abs(S)>y||Math.abs(T)>y)&&--b>0);return new Xi(ee(u),ee(f))}}class P_ extends Wc{constructor(o){super(o),this.center=o.center||[0,0],this.parallels=o.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Ae(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(o,l){const{scale:u,cosPhi:f}=this;return{x:Ae(o)*f*u+.5,y:-Math.sin(Ae(l))/f*u+.5,z:0}}unproject(o,l){const{scale:u,cosPhi:f}=this,b=-(l-.5)/u,y=Ke(ee((o-.5)/u)/f,-180,180),S=Math.asin(Ke(b*f,-1,1)),T=Ke(ee(S),-85.051129,_a);return new Xi(y,T)}}class D1 extends R_{constructor(o){super(o),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(o,l,u){const f=np(o,l,u);return mo(f,f,ip(Hc(u))),{x:f[0],y:f[1],z:f[2]}}locationPoint(o,l){const u=Dd(l.lat,l.lng),f=Ds([],u),b=o.elevation?o.elevation.getAtPointOrZero(o.locationCoordinate(l),o._centerAltitude):o._centerAltitude;Bc(u,u,f,Fa(1,0)*Mn*b);const y=ic(new Float64Array(16));return Fh(y,o.pixelMatrix,o.globeMatrix),mo(u,u,y),new mt(u[0],u[1])}pixelsPerMeter(o,l){return Fa(1,0)*l}pixelSpaceConversion(o,l,u){const f=Fa(1,o)*l,b=zi(Fa(1,45)*l,f,u);return this.pixelsPerMeter(o,l)/b}createTileMatrix(o,l,u){const f=rp(Hc(u.canonical));return Fh(new Float64Array(16),o.globeMatrix,f)}createInversionMatrix(o,l){const{center:u}=o,f=ip(Hc(l));return Na(f,f,Ae(u.lng)),Js(f,f,Ae(u.lat)),_d(f,f,[o._pixelsPerMercatorPixel,o._pixelsPerMercatorPixel,1]),Float32Array.from(f)}pointCoordinate(o,l,u,f){return C0(o,l,u,!0)||new bd(0,0)}pointCoordinate3D(o,l,u){const f=this.pointCoordinate(o,l,u,0);return[f.x,f.y,f.z]}isPointAboveHorizon(o,l){return!C0(o,l.x,l.y,!1)}farthestPixelDistance(o){const l=function(f,b){const y=f.cameraToCenterDistance,S=f._centerAltitude*b,T=f._camera,E=f._camera.forward(),M=Nc([],Ba([],E,-y),[0,0,S]),P=f.worldSize/(2*Math.PI),O=[0,0,-P],B=f.width/f.height,V=Math.tan(f.fovAboveCenter),G=Ba([],T.up(),V),Z=Ba([],T.right(),V*B),ce=Ds([],Nc([],Nc([],E,G),Z)),ye=[];let ue;if(new zb(M,ce).closestPointOnSphere(O,P,ye)){const ge=Nc([],ye,O),De=rc([],ge,M);ue=Math.cos(f.fovAboveCenter)*hf(De)}else{const ge=rc([],M,O),De=rc([],O,M);Ds(De,De);const xe=hf(ge)-P;ue=Math.sqrt(xe*(xe+2*P));const tt=Math.acos(ue/(P+xe))-Math.acos(Ao(E,De));ue*=Math.cos(tt)}return 1.01*ue}(o,this.pixelsPerMeter(o.center.lat,o.worldSize)),u=Ed(o.zoom);if(u>0){const f=k_(o,Fa(1,o.center.lat)*o.worldSize),b=o.worldSize/(2*Math.PI),y=Math.max(o.width,o.height)/o.worldSize*Math.PI;return zi(l,f+b*(1-Math.cos(y)),Math.pow(u,10))}return l}upVector(o,l,u){return np(l,u,o,1)}upVectorScale(o){return{metersToTile:Rf*hg(Hc(o))}}}function mg(a){const o=a.parallels,l=!!o&&Math.abs(o[0]+o[1])<.01;switch(a.name){case"mercator":return new R_(a);case"equirectangular":return new x1(a);case"naturalEarth":return new C1(a);case"equalEarth":return new $E(a);case"winkelTripel":return new I0(a);case"albers":return l?new P_(a):new HE(a);case"lambertConformalConic":return l?new P_(a):new w1(a);case"globe":return new D1(a)}throw new Error(`Invalid projection name: ${a.name}`)}const GE=Uh.types,qE=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function O_(a,o,l,u,f,b,y,S,T,E,M,P,O){const B=S?Math.min(Tu,Math.round(S[0])):0,V=S?Math.min(Tu,Math.round(S[1])):0;a.emplaceBack(o,l,Math.round(32*u),Math.round(32*f),b,y,(B<<1)+(T?1:0),V,16*E,16*M,256*P,256*O)}function L_(a,o,l,u,f,b,y){a.emplaceBack(o,l,u,f,b,y)}function F_(a,o,l,u,f){a.emplaceBack(o,l,u,f),a.emplaceBack(o,l,u,f),a.emplaceBack(o,l,u,f),a.emplaceBack(o,l,u,f)}function WE(a){for(const o of a.sections)if(F(o.text))return!0;return!1}class M0{constructor(o){this.layoutVertexArray=new zr,this.indexArray=new Co,this.programConfigurations=o,this.segments=new fo,this.dynamicLayoutVertexArray=new io,this.opacityVertexArray=new po,this.placedSymbolArray=new _S,this.globeExtVertexArray=new Pi}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(o,l,u,f){this.isEmpty()||(u&&(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,a_.members),this.indexBuffer=o.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=o.createVertexBuffer(this.dynamicLayoutVertexArray,l_.members,!0),this.opacityVertexBuffer=o.createVertexBuffer(this.opacityVertexArray,qE,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=o.createVertexBuffer(this.globeExtVertexArray,e0.members,!0)),this.opacityVertexBuffer.itemSize=1),(u||f)&&this.programConfigurations.upload(o))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}tn(M0,"SymbolBuffers");class A0{constructor(o,l,u){this.layoutVertexArray=new o,this.layoutAttributes=l,this.indexArray=new u,this.segments=new fo,this.collisionVertexArray=new tc,this.collisionVertexArrayExt=new Vr}upload(o){this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=o.createVertexBuffer(this.collisionVertexArray,Cf.members,!0),this.collisionVertexBufferExt=o.createVertexBuffer(this.collisionVertexArrayExt,o1.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}tn(A0,"CollisionBuffers");class Ad{constructor(o){this.collisionBoxArray=o.collisionBoxArray,this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(y=>y.id),this.index=o.index,this.pixelRatio=o.pixelRatio,this.sourceLayerIndex=o.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ic([]),this.placementViewportMatrix=ic([]);const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Tf(this.zoom,l["text-size"]),this.iconSizeData=Tf(this.zoom,l["icon-size"]);const u=this.layers[0].layout,f=u.get("symbol-sort-key"),b=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==b&&void 0!==f.constantOr(1),this.sortFeaturesByY=("viewport-y"===b||"auto"===b&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(y=>ta[y]),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=o.sourceID,this.projection=o.projection}createArrays(){this.text=new M0(new Lc(this.layers,this.zoom,o=>/^text/.test(o))),this.icon=new M0(new Lc(this.layers,this.zoom,o=>/^icon/.test(o))),this.glyphOffsetArray=new vS,this.lineVertexArray=new xS,this.symbolInstances=new kh}calculateGlyphDependencies(o,l,u,f,b){for(let y=0;y<o.length;y++)if(l[o.charCodeAt(y)]=!0,f&&b){const S=Wh[o.charAt(y)];S&&(l[S.charCodeAt(0)]=!0)}}populate(o,l,u,f){const b=this.layers[0],y=b.layout,S="globe"===this.projection.name,T=y.get("text-font"),E=y.get("text-field"),M=y.get("icon-image"),P=("constant"!==E.value.kind||E.value.value instanceof Ss&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&("constant"!==T.value.kind||T.value.value.length>0),O="constant"!==M.value.kind||!!M.value.value||Object.keys(M.parameters).length>0,B=y.get("symbol-sort-key");if(this.features=[],!P&&!O)return;const V=l.iconDependencies,G=l.glyphDependencies,Z=l.availableImages,ce=new he(this.zoom);for(const{feature:ye,id:ue,index:ge,sourceLayerIndex:De}of o){const xe=b._featureFilter.needGeometry,tt=Lh(ye,xe);if(!b._featureFilter.filter(ce,tt,u))continue;if(xe||(tt.geometry=Fc(ye,u,f)),S&&1!==ye.type&&u.z<=5){const ot=tt.geometry,_t=.98078528056,yt=(Ct,Rt)=>Ao(np(Ct.x,Ct.y,u,1),np(Rt.x,Rt.y,u,1))<_t;for(let Ct=0;Ct<ot.length;Ct++)ot[Ct]=af(ot[Ct],yt)}let Ze,lt;if(P){const ot=b.getValueAndResolveTokens("text-field",tt,u,Z),_t=Ss.factory(ot);WE(_t)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===J()||this.hasRTLText&&ve.isParsed())&&(Ze=a1(_t,b,tt))}if(O){const ot=b.getValueAndResolveTokens("icon-image",tt,u,Z);lt=ot instanceof Hs?ot:Hs.fromString(ot)}if(!Ze&&!lt)continue;const Mt=this.sortFeaturesByKey?B.evaluate(tt,{},u):void 0;if(this.features.push({id:ue,text:Ze,icon:lt,index:ge,sourceLayerIndex:De,geometry:tt.geometry,properties:ye.properties,type:GE[ye.type],sortKey:Mt}),lt&&(V[lt.name]=!0),Ze){const ot=T.evaluate(tt,{},u).join(","),_t="map"===y.get("text-rotation-alignment")&&"point"!==y.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ta.vertical)>=0;for(const yt of Ze.sections)if(yt.image)V[yt.image.name]=!0;else{const Ct=h(Ze.toString()),Rt=yt.fontStack||ot,pt=G[Rt]=G[Rt]||{};this.calculateGlyphDependencies(yt.text,pt,_t,this.allowVerticalPlacement,Ct)}}}"line"===y.get("symbol-placement")&&(this.features=function(ye){const ue={},ge={},De=[];let xe=0;function tt(ot){De.push(ye[ot]),xe++}function Ze(ot,_t,yt){const Ct=ge[ot];return delete ge[ot],ge[_t]=Ct,De[Ct].geometry[0].pop(),De[Ct].geometry[0]=De[Ct].geometry[0].concat(yt[0]),Ct}function lt(ot,_t,yt){const Ct=ue[_t];return delete ue[_t],ue[ot]=Ct,De[Ct].geometry[0].shift(),De[Ct].geometry[0]=yt[0].concat(De[Ct].geometry[0]),Ct}function Mt(ot,_t,yt){const Ct=yt?_t[0][_t[0].length-1]:_t[0][0];return`${ot}:${Ct.x}:${Ct.y}`}for(let ot=0;ot<ye.length;ot++){const _t=ye[ot],yt=_t.geometry,Ct=_t.text?_t.text.toString():null;if(!Ct){tt(ot);continue}const Rt=Mt(Ct,yt),pt=Mt(Ct,yt,!0);if(Rt in ge&&pt in ue&&ge[Rt]!==ue[pt]){const nn=lt(Rt,pt,yt),ut=Ze(Rt,pt,De[nn].geometry);delete ue[Rt],delete ge[pt],ge[Mt(Ct,De[ut].geometry,!0)]=ut,De[nn].geometry=null}else Rt in ge?Ze(Rt,pt,yt):pt in ue?lt(Rt,pt,yt):(tt(ot),ue[Rt]=xe-1,ge[pt]=xe-1)}return De.filter(ot=>ot.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ye,ue)=>ye.sortKey-ue.sortKey)}update(o,l,u,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(o,l,this.layers,u,f),this.icon.programConfigurations.updatePaintArrays(o,l,this.layers,u,f))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(o){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(o),this.iconCollisionBox.upload(o)),this.text.upload(o,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(o,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=mg(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(o,l){const u=this.lineVertexArray.length,f=o.segment;if(void 0!==f){let b=o.dist(l[f+1]),y=o.dist(l[f]);const S={};for(let T=f+1;T<l.length;T++)S[T]={x:l[T].x,y:l[T].y,tileUnitDistanceFromAnchor:b},T<l.length-1&&(b+=l[T+1].dist(l[T]));for(let T=f||0;T>=0;T--)S[T]={x:l[T].x,y:l[T].y,tileUnitDistanceFromAnchor:y},T>0&&(y+=l[T-1].dist(l[T]));for(let T=0;T<l.length;T++){const E=S[T];this.lineVertexArray.emplaceBack(E.x,E.y,E.tileUnitDistanceFromAnchor)}}return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(o,l,u,f,b,y,S,T,E,M,P,O,B,V){const G=o.indexArray,Z=o.layoutVertexArray,ce=o.globeExtVertexArray,ye=o.segments.prepareSegment(4*l.length,Z,G,this.canOverlap?y.sortKey:void 0),ue=this.glyphOffsetArray.length,ge=ye.vertexLength,De=this.allowVerticalPlacement&&S===ta.vertical?Math.PI/2:0,xe=y.text&&y.text.sections;for(let Ze=0;Ze<l.length;Ze++){const{tl:lt,tr:Mt,bl:ot,br:_t,tex:yt,pixelOffsetTL:Ct,pixelOffsetBR:Rt,minFontScaleX:pt,minFontScaleY:nn,glyphOffset:ut,isSDF:vn,sectionIndex:hn}=l[Ze],Yt=ye.vertexLength,Zn=ut[1];if(O_(Z,E.x,E.y,lt.x,Zn+lt.y,yt.x,yt.y,u,vn,Ct.x,Ct.y,pt,nn),O_(Z,E.x,E.y,Mt.x,Zn+Mt.y,yt.x+yt.w,yt.y,u,vn,Rt.x,Ct.y,pt,nn),O_(Z,E.x,E.y,ot.x,Zn+ot.y,yt.x,yt.y+yt.h,u,vn,Ct.x,Rt.y,pt,nn),O_(Z,E.x,E.y,_t.x,Zn+_t.y,yt.x+yt.w,yt.y+yt.h,u,vn,Rt.x,Rt.y,pt,nn),T){const fi=T.anchor,mi=T.up;L_(ce,fi.x,fi.y,fi.z,mi[0],mi[1],mi[2]),L_(ce,fi.x,fi.y,fi.z,mi[0],mi[1],mi[2]),L_(ce,fi.x,fi.y,fi.z,mi[0],mi[1],mi[2]),L_(ce,fi.x,fi.y,fi.z,mi[0],mi[1],mi[2]),F_(o.dynamicLayoutVertexArray,fi.x,fi.y,fi.z,De)}else F_(o.dynamicLayoutVertexArray,E.x,E.y,E.z,De);G.emplaceBack(Yt,Yt+1,Yt+2),G.emplaceBack(Yt+1,Yt+2,Yt+3),ye.vertexLength+=4,ye.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ut[0]),Ze!==l.length-1&&hn===l[Ze+1].sectionIndex||o.programConfigurations.populatePaintArrays(Z.length,y,y.index,{},B,V,xe&&xe[hn])}const tt=T?T.anchor:E;o.placedSymbolArray.emplaceBack(tt.x,tt.y,tt.z,E.x,E.y,ue,this.glyphOffsetArray.length-ue,ge,M,P,E.segment,u?u[0]:0,u?u[1]:0,f[0],f[1],S,0,!1,0,O,0)}_commitLayoutVertex(o,l,u,f,b,y,S){o.emplaceBack(l,u,f,b,y,Math.round(S.x),Math.round(S.y))}_addCollisionDebugVertices(o,l,u,f,b,y,S){const T=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),E=T.vertexLength,M=S.tileAnchorX,P=S.tileAnchorY;for(let B=0;B<4;B++)u.collisionVertexArray.emplaceBack(0,0,0,0);u.collisionVertexArrayExt.emplaceBack(l,-o.padding,-o.padding),u.collisionVertexArrayExt.emplaceBack(l,o.padding,-o.padding),u.collisionVertexArrayExt.emplaceBack(l,o.padding,o.padding),u.collisionVertexArrayExt.emplaceBack(l,-o.padding,o.padding),this._commitLayoutVertex(u.layoutVertexArray,f,b,y,M,P,new mt(o.x1,o.y1)),this._commitLayoutVertex(u.layoutVertexArray,f,b,y,M,P,new mt(o.x2,o.y1)),this._commitLayoutVertex(u.layoutVertexArray,f,b,y,M,P,new mt(o.x2,o.y2)),this._commitLayoutVertex(u.layoutVertexArray,f,b,y,M,P,new mt(o.x1,o.y2)),T.vertexLength+=4;const O=u.indexArray;O.emplaceBack(E,E+1),O.emplaceBack(E+1,E+2),O.emplaceBack(E+2,E+3),O.emplaceBack(E+3,E),T.primitiveLength+=4}_addTextDebugCollisionBoxes(o,l,u,f,b,y){for(let S=f;S<b;S++){const T=u.get(S),E=this.getSymbolInstanceTextSize(o,y,l,S);this._addCollisionDebugVertices(T,E,this.textCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,y)}}_addIconDebugCollisionBoxes(o,l,u,f,b,y){for(let S=f;S<b;S++){const T=u.get(S),E=this.getSymbolInstanceIconSize(o,l,y.placedIconSymbolIndex);this._addCollisionDebugVertices(T,E,this.iconCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,y)}}generateCollisionDebugBuffers(o,l){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new A0(vr,c_.members,sl),this.iconCollisionBox=new A0(vr,c_.members,sl);const u=Ef(this.iconSizeData,o),f=Ef(this.textSizeData,o);for(let b=0;b<this.symbolInstances.length;b++){const y=this.symbolInstances.get(b);this._addTextDebugCollisionBoxes(f,o,l,y.textBoxStartIndex,y.textBoxEndIndex,y),this._addTextDebugCollisionBoxes(f,o,l,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._addIconDebugCollisionBoxes(u,o,l,y.iconBoxStartIndex,y.iconBoxEndIndex,y),this._addIconDebugCollisionBoxes(u,o,l,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y)}}getSymbolInstanceTextSize(o,l,u,f){const b=this.text.placedSymbolArray.get(l.rightJustifiedTextSymbolIndex>=0?l.rightJustifiedTextSymbolIndex:l.centerJustifiedTextSymbolIndex>=0?l.centerJustifiedTextSymbolIndex:l.leftJustifiedTextSymbolIndex>=0?l.leftJustifiedTextSymbolIndex:l.verticalPlacedTextSymbolIndex>=0?l.verticalPlacedTextSymbolIndex:f),y=Df(this.textSizeData,o,b)/24;return this.tilePixelRatio*y}getSymbolInstanceIconSize(o,l,u){const f=this.icon.placedSymbolArray.get(u),b=Df(this.iconSizeData,o,f);return this.tilePixelRatio*b}_commitDebugCollisionVertexUpdate(o,l,u){o.emplaceBack(l,-u,-u),o.emplaceBack(l,u,-u),o.emplaceBack(l,u,u),o.emplaceBack(l,-u,u)}_updateTextDebugCollisionBoxes(o,l,u,f,b,y){for(let S=f;S<b;S++){const T=u.get(S),E=this.getSymbolInstanceTextSize(o,y,l,S);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,E,T.padding)}}_updateIconDebugCollisionBoxes(o,l,u,f,b,y){for(let S=f;S<b;S++){const T=u.get(S),E=this.getSymbolInstanceIconSize(o,l,y);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,E,T.padding)}}updateCollisionDebugBuffers(o,l){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const u=Ef(this.iconSizeData,o),f=Ef(this.textSizeData,o);for(let b=0;b<this.symbolInstances.length;b++){const y=this.symbolInstances.get(b);this._updateTextDebugCollisionBoxes(f,o,l,y.textBoxStartIndex,y.textBoxEndIndex,y),this._updateTextDebugCollisionBoxes(f,o,l,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._updateIconDebugCollisionBoxes(u,o,l,y.iconBoxStartIndex,y.iconBoxEndIndex,y.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(u,o,l,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(o,l,u,f,b,y,S,T,E){const M={};for(let P=l;P<u;P++){const O=o.get(P);M.textBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,padding:O.padding,projectedAnchorX:O.projectedAnchorX,projectedAnchorY:O.projectedAnchorY,projectedAnchorZ:O.projectedAnchorZ,tileAnchorX:O.tileAnchorX,tileAnchorY:O.tileAnchorY},M.textFeatureIndex=O.featureIndex;break}for(let P=f;P<b;P++){const O=o.get(P);M.verticalTextBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,padding:O.padding,projectedAnchorX:O.projectedAnchorX,projectedAnchorY:O.projectedAnchorY,projectedAnchorZ:O.projectedAnchorZ,tileAnchorX:O.tileAnchorX,tileAnchorY:O.tileAnchorY},M.verticalTextFeatureIndex=O.featureIndex;break}for(let P=y;P<S;P++){const O=o.get(P);M.iconBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,padding:O.padding,projectedAnchorX:O.projectedAnchorX,projectedAnchorY:O.projectedAnchorY,projectedAnchorZ:O.projectedAnchorZ,tileAnchorX:O.tileAnchorX,tileAnchorY:O.tileAnchorY},M.iconFeatureIndex=O.featureIndex;break}for(let P=T;P<E;P++){const O=o.get(P);M.verticalIconBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,padding:O.padding,projectedAnchorX:O.projectedAnchorX,projectedAnchorY:O.projectedAnchorY,projectedAnchorZ:O.projectedAnchorZ,tileAnchorX:O.tileAnchorX,tileAnchorY:O.tileAnchorY},M.verticalIconFeatureIndex=O.featureIndex;break}return M}deserializeCollisionBoxes(o){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const u=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(o,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(o,l){const u=o.placedSymbolArray.get(l),f=u.vertexStartIndex+4*u.numGlyphs;for(let b=u.vertexStartIndex;b<f;b+=4)o.indexArray.emplaceBack(b,b+1,b+2),o.indexArray.emplaceBack(b+1,b+2,b+3)}getSortedSymbolIndexes(o){if(this.sortedAngle===o&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const l=Math.sin(o),u=Math.cos(o),f=[],b=[],y=[];for(let S=0;S<this.symbolInstances.length;++S){y.push(S);const T=this.symbolInstances.get(S);f.push(0|Math.round(l*T.tileAnchorX+u*T.tileAnchorY)),b.push(T.featureIndex)}return y.sort((S,T)=>f[S]-f[T]||b[T]-b[S]),y}addToSortKeyRanges(o,l){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===l?u.symbolInstanceEnd=o+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:o,symbolInstanceEnd:o+1})}sortFeatures(o){if(this.sortFeaturesByY&&this.sortedAngle!==o&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(o),this.sortedAngle=o,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const u=this.symbolInstances.get(l);this.featureSortOrder.push(u.featureIndex),[u.rightJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.leftJustifiedTextSymbolIndex].forEach((f,b,y)=>{f>=0&&y.indexOf(f)===b&&this.addIndicesForPlacedSymbol(this.text,f)}),u.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,u.verticalPlacedTextSymbolIndex),u.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,u.placedIconSymbolIndex),u.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,u.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}tn(Ad,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Ad.MAX_GLYPHS=65535,Ad.addDynamicAttributes=F_;const XE=new Lt({"symbol-placement":new qe(ct.layout_symbol["symbol-placement"]),"symbol-spacing":new qe(ct.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new qe(ct.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Me(ct.layout_symbol["symbol-sort-key"]),"symbol-z-order":new qe(ct.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new qe(ct.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new qe(ct.layout_symbol["icon-ignore-placement"]),"icon-optional":new qe(ct.layout_symbol["icon-optional"]),"icon-rotation-alignment":new qe(ct.layout_symbol["icon-rotation-alignment"]),"icon-size":new Me(ct.layout_symbol["icon-size"]),"icon-text-fit":new qe(ct.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new qe(ct.layout_symbol["icon-text-fit-padding"]),"icon-image":new Me(ct.layout_symbol["icon-image"]),"icon-rotate":new Me(ct.layout_symbol["icon-rotate"]),"icon-padding":new qe(ct.layout_symbol["icon-padding"]),"icon-keep-upright":new qe(ct.layout_symbol["icon-keep-upright"]),"icon-offset":new Me(ct.layout_symbol["icon-offset"]),"icon-anchor":new Me(ct.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new qe(ct.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new qe(ct.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new qe(ct.layout_symbol["text-rotation-alignment"]),"text-field":new Me(ct.layout_symbol["text-field"]),"text-font":new Me(ct.layout_symbol["text-font"]),"text-size":new Me(ct.layout_symbol["text-size"]),"text-max-width":new Me(ct.layout_symbol["text-max-width"]),"text-line-height":new Me(ct.layout_symbol["text-line-height"]),"text-letter-spacing":new Me(ct.layout_symbol["text-letter-spacing"]),"text-justify":new Me(ct.layout_symbol["text-justify"]),"text-radial-offset":new Me(ct.layout_symbol["text-radial-offset"]),"text-variable-anchor":new qe(ct.layout_symbol["text-variable-anchor"]),"text-anchor":new Me(ct.layout_symbol["text-anchor"]),"text-max-angle":new qe(ct.layout_symbol["text-max-angle"]),"text-writing-mode":new qe(ct.layout_symbol["text-writing-mode"]),"text-rotate":new Me(ct.layout_symbol["text-rotate"]),"text-padding":new qe(ct.layout_symbol["text-padding"]),"text-keep-upright":new qe(ct.layout_symbol["text-keep-upright"]),"text-transform":new Me(ct.layout_symbol["text-transform"]),"text-offset":new Me(ct.layout_symbol["text-offset"]),"text-allow-overlap":new qe(ct.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new qe(ct.layout_symbol["text-ignore-placement"]),"text-optional":new qe(ct.layout_symbol["text-optional"])});var lc={paint:new Lt({"icon-opacity":new Me(ct.paint_symbol["icon-opacity"]),"icon-color":new Me(ct.paint_symbol["icon-color"]),"icon-halo-color":new Me(ct.paint_symbol["icon-halo-color"]),"icon-halo-width":new Me(ct.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Me(ct.paint_symbol["icon-halo-blur"]),"icon-translate":new qe(ct.paint_symbol["icon-translate"]),"icon-translate-anchor":new qe(ct.paint_symbol["icon-translate-anchor"]),"text-opacity":new Me(ct.paint_symbol["text-opacity"]),"text-color":new Me(ct.paint_symbol["text-color"],{runtimeType:Ja,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new Me(ct.paint_symbol["text-halo-color"]),"text-halo-width":new Me(ct.paint_symbol["text-halo-width"]),"text-halo-blur":new Me(ct.paint_symbol["text-halo-blur"]),"text-translate":new qe(ct.paint_symbol["text-translate"]),"text-translate-anchor":new qe(ct.paint_symbol["text-translate-anchor"])}),layout:XE};class gg{constructor(o){this.type=o.property.overrides?o.property.overrides.runtimeType:cr,this.defaultValue=o}evaluate(o){if(o.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(o.formattedSection))return l.getOverride(o.formattedSection)}return o.feature&&o.featureState?this.defaultValue.evaluate(o.feature,o.featureState):this.defaultValue.property.specification.default}eachChild(o){this.defaultValue.isConstant()||o(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}tn(gg,"FormatSectionOverride",{omit:["defaultValue"]});class bg extends ba{constructor(o){super(o,lc)}recalculate(o,l){super.recalculate(o,l),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const u=this.layout.get("text-writing-mode");if(u){const f=[];for(const b of u)f.indexOf(b)<0&&f.push(b);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(o,l,u,f){const b=this.layout.get(o).evaluate(l,{},u,f),y=this._unevaluatedLayout._values[o];return y.isDataDriven()||dr(y.value)||!b?b:(S=l.properties,b.replace(/{([^{}]+)}/g,(E,M)=>M in S?String(S[M]):""));var S}createBucket(o){return new Ad(o)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const o of lc.paint.overridableProperties){if(!bg.hasPaintOverride(this.layout,o))continue;const l=this.paint.get(o),u=new gg(l),f=new id(u,l.property.specification);let b=null;b="constant"===l.value.kind||"source"===l.value.kind?new bh("source",f):new _h("composite",f,l.value.zoomStops,l.value._interpolationType),this.paint._values[o]=new ft(l.property,b,l.parameters)}}_handleOverridablePaintPropertyUpdate(o,l,u){return!(!this.layout||l.isDataDriven()||u.isDataDriven())&&bg.hasPaintOverride(this.layout,o)}static hasPaintOverride(o,l){const u=o.get("text-field"),f=lc.paint.properties[l];let b=!1;const y=S=>{for(const T of S)if(f.overrides&&f.overrides.hasOverride(T))return void(b=!0)};if("constant"===u.value.kind&&u.value.value instanceof Ss)y(u.value.value.sections);else if("source"===u.value.kind){const S=E=>{b||(E instanceof lh&&ur(E.value)===Wu?y(E.value.sections):E instanceof el?y(E.sections):E.eachChild(S))},T=u.value;T._styleExpression&&S(T._styleExpression.expression)}return b}getProgramConfiguration(o){return new al(this,o)}}var k0={paint:new Lt({"background-color":new qe(ct.paint_background["background-color"]),"background-pattern":new It(ct.paint_background["background-pattern"]),"background-opacity":new qe(ct.paint_background["background-opacity"])})},N_={paint:new Lt({"raster-opacity":new qe(ct.paint_raster["raster-opacity"]),"raster-hue-rotate":new qe(ct.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new qe(ct.paint_raster["raster-brightness-min"]),"raster-brightness-max":new qe(ct.paint_raster["raster-brightness-max"]),"raster-saturation":new qe(ct.paint_raster["raster-saturation"]),"raster-contrast":new qe(ct.paint_raster["raster-contrast"]),"raster-resampling":new qe(ct.paint_raster["raster-resampling"]),"raster-fade-duration":new qe(ct.paint_raster["raster-fade-duration"])})};class R0 extends ba{constructor(o){super(o,{}),this.implementation=o}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(o){this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)}onRemove(o){this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)}}var B_={paint:new Lt({"sky-type":new qe(ct.paint_sky["sky-type"]),"sky-atmosphere-sun":new qe(ct.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new qe(ct.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new qe(ct.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new qe(ct.paint_sky["sky-gradient-radius"]),"sky-gradient":new jt(ct.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new qe(ct.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new qe(ct.paint_sky["sky-atmosphere-color"]),"sky-opacity":new qe(ct.paint_sky["sky-opacity"])})};function z_(a,o,l){const u=[0,0,1],f=NS([]);return Pv(f,f,l?-Ae(a)+Math.PI:Ae(a)),Bb(f,f,-Ae(o)),Nb(u,u,f),Ds(u,u)}const Mu={circle:class extends ba{constructor(a){super(a,Rb)}createBucket(a){return new Ab(a)}queryRadius(a){const o=a;return Pl("circle-radius",this,o)+Pl("circle-stroke-width",this,o)+zm(this.paint.get("circle-translate"))}queryIntersectsFeature(a,o,l,u,f,b,y,S){const T=OS(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),b.angle,a.pixelToTileUnitsFactor),E=this.paint.get("circle-radius").evaluate(o,l)+this.paint.get("circle-stroke-width").evaluate(o,l);return jb(a,u,b,y,S,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),T,E)}getProgramIds(){return["circle"]}getProgramConfiguration(a){return new al(this,a)}},heatmap:class extends ba{createBucket(a){return new Lv(a)}constructor(a){super(a,VS),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){"heatmap-color"===a&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Gb({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(a){return Pl("heatmap-radius",this,a)}queryIntersectsFeature(a,o,l,u,f,b,y,S){const T=this.paint.get("heatmap-radius").evaluate(o,l);return jb(a,u,b,y,S,!0,!0,new mt(0,0),T)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(a){return new al(this,a)}},hillshade:class extends ba{constructor(a){super(a,RE)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends ba{constructor(a){super(a,QS)}getProgramIds(){const a=this.paint.get("fill-pattern"),o=a&&a.constantOr(1),l=[o?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&l.push(o&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),l}getProgramConfiguration(a){return new al(this,a)}recalculate(a,o){super.recalculate(a,o);const l=this.paint._values["fill-outline-color"];"constant"===l.value.kind&&void 0===l.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new Zm(a)}queryRadius(){return zm(this.paint.get("fill-translate"))}queryIntersectsFeature(a,o,l,u,f,b){return!a.queryGeometry.isAboveHorizon&&wv(Iv(a.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),b.angle,a.pixelToTileUnitsFactor),u)}isTileClipped(){return!0}},"fill-extrusion":class extends ba{constructor(a){super(a,Wv)}createBucket(a){return new xf(a)}queryRadius(){return zm(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(a){return new al(this,a)}queryIntersectsFeature(a,o,l,u,f,b,y,S,T){const E=OS(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),b.angle,a.pixelToTileUnitsFactor),M=this.paint.get("fill-extrusion-height").evaluate(o,l),P=this.paint.get("fill-extrusion-base").evaluate(o,l),O=[0,0],B=S&&b.elevation,V=b.elevation?b.elevation.exaggeration():1,G=a.tile.getBucket(this);if(B&&G instanceof xf){const ge=G.centroidVertexArray,De=T+1;if(De<ge.length){const xe=ge.get(De);O[0]=xe.a_centroid_pos0,O[1]=xe.a_centroid_pos1}}if(0===O[0]&&1===O[1])return!1;"globe"===b.projection.name&&(u=i_([u],[new mt(0,0),new mt(Mn,Mn)],a.tileID.canonical).map(ge=>ge.polygon).flat());const Z=B?S:null,[ce,ye]=(De=u,xe=P,tt=M,Ze=E,lt=y,Mt=Z,ot=O,_t=V,yt=b.center.lat,"globe"===(ge=b).projection.name?function(Rt,pt,nn,ut,vn,hn,Yt,Zn,fi,mi,Ui){const ii=[],Cr=[],ri=Rt.projection.upVectorScale(Ui,Rt.center.lat,Rt.worldSize).metersToTile,ki=[0,0,0,1],Zi=[0,0,0,1],Or=(Tr,Nr,fr,go)=>{Tr[0]=Nr,Tr[1]=fr,Tr[2]=go,Tr[3]=1},Rr=qv();nn>0&&(nn+=Rr),ut+=Rr;for(const Tr of pt){const Nr=[],fr=[];for(const go of Tr){const yi=go.x+vn.x,jr=go.y+vn.y,Kr=Rt.projection.projectTilePoint(yi,jr,Ui),vi=Rt.projection.upVector(Ui,go.x,go.y);let Ht=nn,Jr=ut;if(Yt){const Hi=Zv(yi,jr,nn,ut,Yt,Zn,fi,mi);Ht+=Hi.base,Jr+=Hi.top}0!==nn?Or(ki,Kr.x+vi[0]*ri*Ht,Kr.y+vi[1]*ri*Ht,Kr.z+vi[2]*ri*Ht):Or(ki,Kr.x,Kr.y,Kr.z),Or(Zi,Kr.x+vi[0]*ri*Jr,Kr.y+vi[1]*ri*Jr,Kr.z+vi[2]*ri*Jr),mo(ki,ki,hn),mo(Zi,Zi,hn),Nr.push(new cl(ki[0],ki[1],ki[2])),fr.push(new cl(Zi[0],Zi[1],Zi[2]))}ii.push(Nr),Cr.push(fr)}return[ii,Cr]}(ge,De,xe,tt,Ze,lt,Mt,ot,_t,yt,a.tileID.canonical):Mt?function(Rt,pt,nn,ut,vn,hn,Yt,Zn,fi){const mi=[],Ui=[],ii=[0,0,0,1];for(const Cr of Rt){const ri=[],ki=[];for(const Zi of Cr){const Or=Zi.x+ut.x,Rr=Zi.y+ut.y,Tr=Zv(Or,Rr,pt,nn,hn,Yt,Zn,fi);ii[0]=Or,ii[1]=Rr,ii[2]=Tr.base,ii[3]=1,zc(ii,ii,vn),ii[3]=Math.max(ii[3],1e-5);const Nr=new cl(ii[0]/ii[3],ii[1]/ii[3],ii[2]/ii[3]);ii[0]=Or,ii[1]=Rr,ii[2]=Tr.top,ii[3]=1,zc(ii,ii,vn),ii[3]=Math.max(ii[3],1e-5);const fr=new cl(ii[0]/ii[3],ii[1]/ii[3],ii[2]/ii[3]);ri.push(Nr),ki.push(fr)}mi.push(ri),Ui.push(ki)}return[mi,Ui]}(De,xe,tt,Ze,lt,Mt,ot,_t,yt):function(Rt,pt,nn,ut,vn){const hn=[],Yt=[],Zn=vn[8]*pt,fi=vn[9]*pt,mi=vn[10]*pt,Ui=vn[11]*pt,ii=vn[8]*nn,Cr=vn[9]*nn,ri=vn[10]*nn,ki=vn[11]*nn;for(const Zi of Rt){const Or=[],Rr=[];for(const Tr of Zi){const Nr=Tr.x+ut.x,fr=Tr.y+ut.y,go=vn[0]*Nr+vn[4]*fr+vn[12],yi=vn[1]*Nr+vn[5]*fr+vn[13],jr=vn[2]*Nr+vn[6]*fr+vn[14],Kr=vn[3]*Nr+vn[7]*fr+vn[15],vi=go+Zn,Ht=yi+fi,Jr=jr+mi,Hi=Math.max(Kr+Ui,1e-5),Br=go+ii,To=yi+Cr,oo=jr+ri,so=Math.max(Kr+ki,1e-5);Or.push(new cl(vi/Hi,Ht/Hi,Jr/Hi)),Rr.push(new cl(Br/so,To/so,oo/so))}hn.push(Or),Yt.push(Rr)}return[hn,Yt]}(De,xe,tt,Ze,lt)),ue=a.queryGeometry;var ge,De,xe,tt,Ze,lt,Mt,ot,_t,yt;return function(ge,De,xe){let tt=1/0;wv(xe,De)&&(tt=o_(xe,De[0]));for(let Ze=0;Ze<De.length;Ze++){const lt=De[Ze],Mt=ge[Ze];for(let ot=0;ot<lt.length-1;ot++){const _t=lt[ot],yt=[_t,lt[ot+1],Mt[ot+1],Mt[ot],_t];lf(xe,yt)&&(tt=Math.min(tt,o_(xe,yt)))}}return tt!==1/0&&tt}(ce,ye,ue.isPointQuery()?ue.screenBounds:ue.screenGeometry)}},line:class extends ba{constructor(a){super(a,wf),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(a){if("line-gradient"===a){const o=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=o._styleExpression&&o._styleExpression.expression instanceof uu,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(a,o){super.recalculate(a,o),this.paint._values["line-floorwidth"]=Sf.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new qh(a)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(a){return new al(this,a)}queryRadius(a){const o=a,l=s_(Pl("line-width",this,o),Pl("line-gap-width",this,o)),u=Pl("line-offset",this,o);return l/2+Math.abs(u)+zm(this.paint.get("line-translate"))}queryIntersectsFeature(a,o,l,u,f,b){if(a.queryGeometry.isAboveHorizon)return!1;const y=Iv(a.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),b.angle,a.pixelToTileUnitsFactor),S=a.pixelToTileUnitsFactor/2*s_(this.paint.get("line-width").evaluate(o,l),this.paint.get("line-gap-width").evaluate(o,l)),T=this.paint.get("line-offset").evaluate(o,l);return T&&(u=function(E,M){const P=[],O=new mt(0,0);for(let B=0;B<E.length;B++){const V=E[B],G=[];for(let Z=0;Z<V.length;Z++){const ce=V[Z-1],ye=V[Z],ue=V[Z+1],ge=0===Z?O:ye.sub(ce)._unit()._perp(),De=Z===V.length-1?O:ue.sub(ye)._unit()._perp(),xe=ge._add(De)._unit();xe._mult(1/(xe.x*De.x+xe.y*De.y)),G.push(xe._mult(M)._add(ye))}P.push(G)}return P}(u,T*a.pixelToTileUnitsFactor)),function(E,M,P){for(let O=0;O<M.length;O++){const B=M[O];if(E.length>=3)for(let V=0;V<B.length;V++)if(vu(E,B[V]))return!0;if(Sv(E,B,P))return!0}return!1}(y,u,S)}isTileClipped(){return!0}},symbol:bg,background:class extends ba{constructor(a){super(a,k0)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends ba{constructor(a){super(a,N_)}getProgramIds(){return["raster"]}},sky:class extends ba{constructor(a){super(a,B_),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){"sky-gradient"===a?this._updateColorRamp():"sky-atmosphere-sun"!==a&&"sky-atmosphere-halo-color"!==a&&"sky-atmosphere-color"!==a&&"sky-atmosphere-sun-intensity"!==a||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Gb({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(a){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const o=a.style.light.properties.get("position");return this._lightPosition.azimuthal!==o.azimuthal||this._lightPosition.polar!==o.polar}return!1}getCenter(a,o){if("atmosphere"===this.paint.get("sky-type")){const u=this.paint.get("sky-atmosphere-sun"),f=!u,b=a.style.light,y=b.properties.get("position");return f&&"viewport"===b.properties.get("anchor")&&Ni("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),f?z_(y.azimuthal,90-y.polar,o):z_(u[0],90-u[1],o)}const l=this.paint.get("sky-gradient-center");return z_(l[0],90-l[1],o)}is3D(){return!1}isSky(){return!0}markSkyboxValid(a){this._skyboxInvalidated=!1,this._lightPosition=a.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const a=this.paint.get("sky-type");return"atmosphere"===a?["skyboxCapture","skybox"]:"gradient"===a?["skyboxGradient"]:null}}};class ap{constructor(o,l,u,f){this.context=o,this.format=u,this.texture=o.gl.createTexture(),this.update(l,f)}update(o,l,u){const{width:f,height:b}=o,{context:y}=this,{gl:S}=y,{HTMLImageElement:T,HTMLCanvasElement:E,HTMLVideoElement:M,ImageData:P,ImageBitmap:O}=me;if(S.bindTexture(S.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===S.RGBA&&(!l||!1!==l.premultiply)),u||this.size&&this.size[0]===f&&this.size[1]===b){const{x:B,y:V}=u||{x:0,y:0};o instanceof T||o instanceof E||o instanceof M||o instanceof P||O&&o instanceof O?S.texSubImage2D(S.TEXTURE_2D,0,B,V,S.RGBA,S.UNSIGNED_BYTE,o):S.texSubImage2D(S.TEXTURE_2D,0,B,V,f,b,S.RGBA,S.UNSIGNED_BYTE,o.data)}else this.size=[f,b],o instanceof T||o instanceof E||o instanceof M||o instanceof P||O&&o instanceof O?S.texImage2D(S.TEXTURE_2D,0,this.format,this.format,S.UNSIGNED_BYTE,o):S.texImage2D(S.TEXTURE_2D,0,this.format,f,b,0,this.format,S.UNSIGNED_BYTE,o.data);this.useMipmap=Boolean(l&&l.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&S.generateMipmap(S.TEXTURE_2D)}bind(o,l){const{context:u}=this,{gl:f}=u;f.bindTexture(f.TEXTURE_2D,this.texture),o!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,o),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap?o===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_NEAREST:o),this.filter=o),l!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,l),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,l),this.wrap=l)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}class E1{constructor(o){this._callback=o,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class V_{constructor(){this.tasks={},this.taskQueue=[],Rs(["process"],this),this.invoker=new E1(this.process),this.nextId=0}add(o,l){const u=this.nextId++,f=function({type:b,isSymbolTile:y,zoom:S}){return S=S||0,"message"===b?0:"maybePrepare"!==b||y?"parseTile"!==b||y?"parseTile"===b&&y?300-S:"maybePrepare"===b&&y?400-S:500:200-S:100-S}(l);if(0===f){Sn();try{o()}finally{}return{cancel:()=>{}}}return this.tasks[u]={fn:o,metadata:l,priority:f,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){Sn();try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;const o=this.pick();if(null===o)return;const l=this.tasks[o];if(delete this.tasks[o],this.taskQueue.length&&this.invoker.trigger(),!l)return;l.fn()}finally{}}pick(){let o=null,l=1/0;for(let f=0;f<this.taskQueue.length;f++){const b=this.tasks[this.taskQueue[f]];b.priority<l&&(l=b.priority,o=f)}if(null===o)return null;const u=this.taskQueue[o];return this.taskQueue.splice(o,1),u}remove(){this.invoker.remove()}}class P0{constructor(o){this._stringToNumber={},this._numberToString=[];for(let l=0;l<o.length;l++){const u=o[l];this._stringToNumber[u]=l,this._numberToString[l]=u}}encode(o){return this._stringToNumber[o]}decode(o){return this._numberToString[o]}}const O0=["tile","layer","source","sourceLayer","state"];class L0{constructor(o,l,u,f,b){this.type="Feature",this._vectorTileFeature=o,this._z=l,this._x=u,this._y=f,this.properties=o.properties,this.id=b}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(o){this._geometry=o}toJSON(){const o={type:"Feature",geometry:this.geometry,properties:this.properties};void 0!==this.id&&(o.id=this.id);for(const l of O0)void 0!==this[l]&&(o[l]=this[l]);return o}}const Va=new Uint16Array(8184);for(let a=0;a<2046;a++){let o=a+2,l=0,u=0,f=0,b=0,y=0,S=0;for(1&o?f=b=y=32:l=u=S=32;(o>>=1)>1;){const E=l+f>>1,M=u+b>>1;1&o?(f=l,b=u,l=y,u=S):(l=f,u=b,f=y,b=S),y=E,S=M}const T=4*a;Va[T+0]=l,Va[T+1]=u,Va[T+2]=f,Va[T+3]=b}const hl=new Uint16Array(2178),ja=new Uint8Array(1089),kd=new Uint16Array(1089);function lp(a){return 0===a?-.03125:32===a?.03125:0}var F0=Nt([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const j_={type:2,extent:Mn,loadGeometry:()=>[[new mt(0,0),new mt(8193,0),new mt(8193,8193),new mt(0,8193),new mt(0,0)]]};class _g{constructor(o,l,u,f,b){this.tileID=o,this.uid=nr(),this.uses=0,this.tileSize=l,this.tileZoom=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=b,this.expiredRequestCount=0,this.state="loading",f&&f.transform&&(this.projection=f.transform.projection)}registerFadeDuration(o){const l=o+this.timeAdded;l<qi.now()||this.fadeEndTime&&l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=qc(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(o,l,u){if(this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=function(f,b){const y={};if(!b)return y;for(const S of f){const T=S.layerIds.map(E=>b.getLayer(E)).filter(Boolean);if(0!==T.length){S.layers=T,S.stateDependentLayerIds&&(S.stateDependentLayers=S.stateDependentLayerIds.map(E=>T.filter(M=>M.id===E)[0]));for(const E of T)y[E.id]=S}}return y}(o.buckets,l.style),this.hasSymbolBuckets=!1;for(const f in this.buckets){const b=this.buckets[f];if(b instanceof Ad){if(this.hasSymbolBuckets=!0,!u)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const f in this.buckets){const b=this.buckets[f];if(b instanceof Ad&&b.hasRTLText){this.hasRTLText=!0,ve.isLoading()||ve.isLoaded()||"deferred"!==J()||_e();break}}this.queryPadding=0;for(const f in this.buckets){const b=this.buckets[f];this.queryPadding=Math.max(this.queryPadding,l.style.getLayer(f).queryRadius(b))}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage),o.lineAtlas&&(this.lineAtlas=o.lineAtlas)}else this.collisionBoxArray=new fv}unloadVectorData(){if(this.hasData()){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(o){return this.buckets[o.id]}upload(o){for(const u in this.buckets){const f=this.buckets[u];f.uploadPending()&&f.upload(o)}const l=o.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ap(o,this.imageAtlas.image,l.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ap(o,this.glyphAtlasImage,l.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new ap(o,this.lineAtlas.image,l.ALPHA),this.lineAtlas.uploaded=!0)}prepare(o){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture)}queryRenderedFeatures(o,l,u,f,b,y,S,T){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:f,pixelPosMatrix:S,transform:y,params:b,tileTransform:this.tileTransform},o,l,u):{}}querySourceFeatures(o,l){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const f=u.loadVTLayers(),b=l?l.sourceLayer:"",y=f._geojsonTileLayer||f[b];if(!y)return;const S=vh(l&&l.filter),{z:T,x:E,y:M}=this.tileID.canonical,P={z:T,x:E,y:M};for(let O=0;O<y.length;O++){const B=y.feature(O);if(S.needGeometry){const Z=Lh(B,!0);if(!S.filter(new he(this.tileID.overscaledZ),Z,this.tileID.canonical))continue}else if(!S.filter(new he(this.tileID.overscaledZ),B))continue;const V=u.getId(B,b),G=new L0(B,T,E,M,V);G.tile=P,o.push(G)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(o){const l=this.expirationTime;if(o.cacheControl){const u=ru(o.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const u=Date.now();let f=!1;if(this.expirationTime>u)f=!1;else if(l)if(this.expirationTime<l)f=!0;else{const b=this.expirationTime-l;b?this.expirationTime=u+Math.max(b,3e4):f=!0}else f=!0;f?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(o,l){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(o).length||!l)return;const u=this.latestFeatureIndex.loadVTLayers(),f=l.style.listImages();for(const b in this.buckets){if(!l.style.hasLayer(b))continue;const y=this.buckets[b],S=y.layers[0].sourceLayer||"_geojsonTileLayer",T=u[S],E=o[S];if(!T||!E||0===Object.keys(E).length)continue;if(y.update(E,T,f,this.imageAtlas&&this.imageAtlas.patternPositions||{}),y instanceof qh||y instanceof Zm){const P=l.style._getSourceCache(y.layers[0].source);l._terrain&&l._terrain.enabled&&P&&y.programConfigurations.needsUpload&&l._terrain._clearRenderCacheForTile(P.id,this.tileID)}const M=l&&l.style&&l.style.getLayer(b);M&&(this.queryPadding=Math.max(this.queryPadding,M.queryRadius(y)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<qi.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=qi.now()+o}setTexture(o,l){const u=l.context,f=u.gl;this.texture=this.texture||l.getTileTexture(o.width),this.texture?this.texture.update(o,{useMipmap:!0}):(this.texture=new ap(u,o,f.RGBA,{useMipmap:!0}),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE),u.extTextureFilterAnisotropic&&f.texParameterf(f.TEXTURE_2D,u.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,u.extTextureFilterAnisotropicMax))}setDependencies(o,l){const u={};for(const f of l)u[f]=!0;this.dependencies[o]=u}hasDependency(o,l){for(const u of o){const f=this.dependencies[u];if(f)for(const b of l)if(f[b])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(o,l){if(!l||"mercator"===l.name||this._tileDebugBuffer)return;const u=Fc(j_,this.tileID.canonical,this.tileTransform)[0],f=new bi,b=new nf;for(let y=0;y<u.length;y++){const{x:S,y:T}=u[y];f.emplaceBack(S,T),b.emplaceBack(y)}b.emplaceBack(0),this._tileDebugIndexBuffer=o.createIndexBuffer(b),this._tileDebugBuffer=o.createVertexBuffer(f,Cd.members),this._tileDebugSegments=fo.simpleSegment(0,0,f.length,b.length)}_makeTileBoundsBuffers(o,l){if(this._tileBoundsBuffer||!l||"mercator"===l.name)return;const u=Fc(j_,this.tileID.canonical,this.tileTransform)[0];let f,b;if(this.isRaster){const y=function(S,T){const E=qc(S,T),M=Math.pow(2,S.z);for(let Z=0;Z<33;Z++)for(let ce=0;ce<33;ce++){const ye=Ts((S.x+(ce+lp(ce))/32)/M),ue=us((S.y+(Z+lp(Z))/32)/M),ge=T.project(ye,ue),De=33*Z+ce;hl[2*De+0]=Math.round((ge.x*E.scale-E.x)*Mn),hl[2*De+1]=Math.round((ge.y*E.scale-E.y)*Mn)}ja.fill(0),kd.fill(0);for(let Z=2045;Z>=0;Z--){const ce=4*Z,ye=Va[ce+0],ue=Va[ce+1],ge=Va[ce+2],De=Va[ce+3],xe=ye+ge>>1,tt=ue+De>>1,Ze=xe+tt-ue,lt=tt+ye-xe,Mt=33*ue+ye,ot=33*De+ge,_t=33*tt+xe,yt=Math.hypot((hl[2*Mt+0]+hl[2*ot+0])/2-hl[2*_t+0],(hl[2*Mt+1]+hl[2*ot+1])/2-hl[2*_t+1])>=16;if(ja[_t]=ja[_t]||(yt?1:0),Z<1022){const Ct=33*(ue+lt>>1)+(ye+Ze>>1),Rt=33*(De+lt>>1)+(ge+Ze>>1);ja[_t]=ja[_t]||ja[Ct]||ja[Rt]}}const P=new pr,O=new Co;let B=0;function V(Z,ce){const ye=33*ce+Z;return 0===kd[ye]&&(P.emplaceBack(hl[2*ye+0],hl[2*ye+1],Z*Mn/32,ce*Mn/32),kd[ye]=++B),kd[ye]-1}function G(Z,ce,ye,ue,ge,De){const xe=Z+ye>>1,tt=ce+ue>>1;if(Math.abs(Z-ge)+Math.abs(ce-De)>1&&ja[33*tt+xe])G(ge,De,Z,ce,xe,tt),G(ye,ue,ge,De,xe,tt);else{const Ze=V(Z,ce),lt=V(ye,ue),Mt=V(ge,De);O.emplaceBack(Ze,lt,Mt)}}return G(0,0,32,32,32,0),G(32,32,0,0,0,32),{vertices:P,indices:O}}(this.tileID.canonical,l);f=y.vertices,b=y.indices}else{f=new pr,b=new Co;for(const{x:S,y:T}of u)f.emplaceBack(S,T,0,0);const y=wd.exports(f.int16,void 0,4);for(let S=0;S<y.length;S+=3)b.emplaceBack(y[S],y[S+1],y[S+2])}this._tileBoundsBuffer=o.createVertexBuffer(f,F0.members),this._tileBoundsIndexBuffer=o.createIndexBuffer(b),this._tileBoundsSegments=fo.simpleSegment(0,0,f.length,b.length)}_makeGlobeTileDebugBuffers(o,l){const u=l.projection;if(!u||"globe"!==u.name||l.freezeTileCoverage)return;const f=this.tileID.canonical,b=ip(y1(f,l)),y=Ed(l.zoom);let S;y>0&&(S=Ob(new Float64Array(16),l.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(o,f,l,b,S,y),this._makeGlobeTileDebugTextBuffer(o,f,l,b,S,y)}_globePoint(o,l,u,f,b,y,S){let T=np(o,l,u);if(y){const E=1<<u.z,M=ll(f.center.lng),P=Cs(f.center.lat),O=(u.x+.5)/E-M;let B=0;O>.5?B=-1:O<-.5&&(B=1);let V=(o/Mn+u.x)/E+B,G=(l/Mn+u.y)/E;V=(V-M)*f._pixelsPerMercatorPixel+M,G=(G-P)*f._pixelsPerMercatorPixel+P;const Z=[V*f.worldSize,G*f.worldSize,0];mo(Z,Z,y),T=$c(T,Z,S)}return mo(T,T,b)}_makeGlobeTileDebugBorderBuffer(o,l,u,f,b,y){const S=new bi,T=new nf,E=new hr,M=(O,B,V,G,Z)=>{const ce=(V-O)/(Z-1),ye=(G-B)/(Z-1),ue=S.length;for(let ge=0;ge<Z;ge++){const De=O+ge*ce,xe=B+ge*ye;S.emplaceBack(De,xe);const tt=this._globePoint(De,xe,l,u,f,b,y);E.emplaceBack(tt[0],tt[1],tt[2]),T.emplaceBack(ue+ge)}},P=Mn;M(0,0,P,0,16),M(P,0,P,P,16),M(P,P,0,P,16),M(0,P,0,0,16),this._tileDebugIndexBuffer=o.createIndexBuffer(T),this._tileDebugBuffer=o.createVertexBuffer(S,Cd.members),this._globeTileDebugBorderBuffer=o.createVertexBuffer(E,D_.members),this._tileDebugSegments=fo.simpleSegment(0,0,S.length,T.length)}_makeGlobeTileDebugTextBuffer(o,l,u,f,b,y){const S=new bi,T=new Co,E=new hr,M=25;T.reserve(32),S.reserve(M),E.reserve(M);const P=(O,B)=>M*O+B;for(let O=0;O<M;O++){const B=2048*O;for(let V=0;V<M;V++){const G=2048*V;S.emplaceBack(G,B);const Z=this._globePoint(G,B,l,u,f,b,y);E.emplaceBack(Z[0],Z[1],Z[2])}}for(let O=0;O<4;O++)for(let B=0;B<4;B++){const V=P(O,B),G=P(O,B+1),Z=P(O+1,B),ce=P(O+1,B+1);T.emplaceBack(V,G,Z),T.emplaceBack(Z,G,ce)}this._tileDebugTextIndexBuffer=o.createIndexBuffer(T),this._tileDebugTextBuffer=o.createVertexBuffer(S,Cd.members),this._globeTileDebugTextBuffer=o.createVertexBuffer(E,D_.members),this._tileDebugTextSegments=fo.simpleSegment(0,0,M,32)}}class U_{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,l,u){const f=String(l);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][f]=this.stateChanges[o][f]||{},en(this.stateChanges[o][f],u),null===this.deletedStates[o]){this.deletedStates[o]={};for(const b in this.state[o])b!==f&&(this.deletedStates[o][b]=null)}else if(this.deletedStates[o]&&null===this.deletedStates[o][f]){this.deletedStates[o][f]={};for(const b in this.state[o][f])u[b]||(this.deletedStates[o][f][b]=null)}else for(const b in u)this.deletedStates[o]&&this.deletedStates[o][f]&&null===this.deletedStates[o][f][b]&&delete this.deletedStates[o][f][b]}removeFeatureState(o,l,u){if(null===this.deletedStates[o])return;const f=String(l);if(this.deletedStates[o]=this.deletedStates[o]||{},u&&void 0!==l)null!==this.deletedStates[o][f]&&(this.deletedStates[o][f]=this.deletedStates[o][f]||{},this.deletedStates[o][f][u]=null);else if(void 0!==l)if(this.stateChanges[o]&&this.stateChanges[o][f])for(u in this.deletedStates[o][f]={},this.stateChanges[o][f])this.deletedStates[o][f][u]=null;else this.deletedStates[o][f]=null;else this.deletedStates[o]=null}getState(o,l){const u=String(l),f=en({},(this.state[o]||{})[u],(this.stateChanges[o]||{})[u]);if(null===this.deletedStates[o])return{};if(this.deletedStates[o]){const b=this.deletedStates[o][l];if(null===b)return{};for(const y in b)delete f[y]}return f}initializeTileState(o,l){o.setFeatureState(this.state,l)}coalesceChanges(o,l){const u={};for(const f in this.stateChanges){this.state[f]=this.state[f]||{};const b={};for(const y in this.stateChanges[f])this.state[f][y]||(this.state[f][y]={}),en(this.state[f][y],this.stateChanges[f][y]),b[y]=this.state[f][y];u[f]=b}for(const f in this.deletedStates){this.state[f]=this.state[f]||{};const b={};if(null===this.deletedStates[f])for(const y in this.state[f])b[y]={},this.state[f][y]={};else for(const y in this.deletedStates[f]){if(null===this.deletedStates[f][y])this.state[f][y]={};else for(const S of Object.keys(this.deletedStates[f][y]))delete this.state[f][y][S];b[y]=this.state[f][y]}u[f]=u[f]||{},en(u[f],b)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(u).length)for(const f in o)o[f].setFeatureState(u,l)}}class yg{constructor(o){this.size=o,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(o,l){const u=this.toIdx(o,l);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(o,l){return this.leaves[this.toIdx(o,l)]}toIdx(o,l){return l*this.size+o}}function H_(a,o,l,u){let f=0,b=Number.MAX_VALUE;for(let y=0;y<3;y++)if(Math.abs(u[y])<1e-15){if(l[y]<a[y]||l[y]>o[y])return null}else{const S=1/u[y];let T=(a[y]-l[y])*S,E=(o[y]-l[y])*S;if(T>E){const M=T;T=E,E=M}if(T>f&&(f=T),E<b&&(b=E),f>b)return null}return f}function vg(a,o,l,u,f,b,y,S,T,E,M){const P=u-a,O=f-o,B=b-l,V=y-a,G=S-o,Z=T-l,ce=M[1]*Z-M[2]*G,ye=M[2]*V-M[0]*Z,ue=M[0]*G-M[1]*V,ge=P*ce+O*ye+B*ue;if(Math.abs(ge)<1e-15)return null;const De=1/ge,xe=E[0]-a,tt=E[1]-o,Ze=E[2]-l,lt=(xe*ce+tt*ye+Ze*ue)*De;if(lt<0||lt>1)return null;const Mt=tt*B-Ze*O,ot=Ze*P-xe*B,_t=xe*O-tt*P,yt=(M[0]*Mt+M[1]*ot+M[2]*_t)*De;return yt<0||lt+yt>1?null:(V*Mt+G*ot+Z*_t)*De}function N0(a,o,l){return(a-o)/(l-o)}function I1(a,o,l,u,f,b,y,S,T){const E=1<<l,M=b-u,P=y-f,O=(a+1)/E*M+u,B=(o+0)/E*P+f,V=(o+1)/E*P+f;S[0]=(a+0)/E*M+u,S[1]=B,T[0]=O,T[1]=V}class B0{constructor(o){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=o,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const l=function(b){const y=Math.ceil(Math.log2(b.dim/8)),S=[];let T=Math.ceil(Math.pow(2,y));const E=1/T,M=(B,V,G,Z,ce)=>{const ye=Z?1:0,ue=(B+1)*G-ye,ge=V*G,De=(V+1)*G-ye;ce[0]=B*G,ce[1]=ge,ce[2]=ue,ce[3]=De};let P=new yg(T);const O=[];for(let B=0;B<T*T;B++){M(B%T,Math.floor(B/T),E,!1,O);const V=Au(O[0],O[1],b),G=Au(O[2],O[1],b),Z=Au(O[2],O[3],b),ce=Au(O[0],O[3],b);P.minimums.push(Math.min(V,G,Z,ce)),P.maximums.push(Math.max(V,G,Z,ce)),P.leaves.push(1)}for(S.push(P),T/=2;T>=1;T/=2){const B=S[S.length-1];P=new yg(T);for(let V=0;V<T*T;V++){M(V%T,Math.floor(V/T),2,!0,O);const G=B.getElevation(O[0],O[1]),Z=B.getElevation(O[2],O[1]),ce=B.getElevation(O[2],O[3]),ye=B.getElevation(O[0],O[3]),ue=B.isLeaf(O[0],O[1]),ge=B.isLeaf(O[2],O[1]),De=B.isLeaf(O[2],O[3]),xe=B.isLeaf(O[0],O[3]),tt=Math.min(G.min,Z.min,ce.min,ye.min),Ze=Math.max(G.max,Z.max,ce.max,ye.max),lt=ue&&ge&&De&&xe;P.maximums.push(Ze),P.minimums.push(tt),P.leaves.push(Ze-tt<=5&&lt?1:0)}S.push(P)}return S}(this.dem),u=l.length-1,f=l[u];this._addNode(f.minimums[0],f.maximums[0],f.leaves[0]),this._construct(l,0,0,u,0)}raycastRoot(o,l,u,f,b,y,S=1){return H_([o,l,-100],[u,f,this.maximums[0]*S],b,y)}raycast(o,l,u,f,b,y,S=1){if(!this.nodeCount)return null;const T=this.raycastRoot(o,l,u,f,b,y,S);if(null==T)return null;const E=[],M=[],P=[],O=[],B=[{idx:0,t:T,nodex:0,nodey:0,depth:0}];for(;B.length>0;){const{idx:V,t:G,nodex:Z,nodey:ce,depth:ye}=B.pop();if(this.leaves[V]){I1(Z,ce,ye,o,l,u,f,P,O);const ge=1<<ye,De=(Z+0)/ge,xe=(Z+1)/ge,tt=(ce+0)/ge,Ze=(ce+1)/ge,lt=Au(De,tt,this.dem)*S,Mt=Au(xe,tt,this.dem)*S,ot=Au(xe,Ze,this.dem)*S,_t=Au(De,Ze,this.dem)*S,yt=vg(P[0],P[1],lt,O[0],P[1],Mt,O[0],O[1],ot,b,y),Ct=vg(O[0],O[1],ot,P[0],O[1],_t,P[0],P[1],lt,b,y),Rt=Math.min(null!==yt?yt:Number.MAX_VALUE,null!==Ct?Ct:Number.MAX_VALUE);if(Rt!==Number.MAX_VALUE)return Rt;{const pt=Bc([],b,y,G);if($_(lt,Mt,_t,ot,N0(pt[0],P[0],O[0]),N0(pt[1],P[1],O[1]))>=pt[2])return G}continue}let ue=0;for(let ge=0;ge<this._siblingOffset.length;ge++){I1((Z<<1)+this._siblingOffset[ge][0],(ce<<1)+this._siblingOffset[ge][1],ye+1,o,l,u,f,P,O),P[2]=-100,O[2]=this.maximums[this.childOffsets[V]+ge]*S;const De=H_(P,O,b,y);if(null!=De){const xe=De;E[ge]=xe;let tt=!1;for(let Ze=0;Ze<ue&&!tt;Ze++)xe>=E[M[Ze]]&&(M.splice(Ze,0,ge),tt=!0);tt||(M[ue]=ge),ue++}}for(let ge=0;ge<ue;ge++){const De=M[ge];B.push({idx:this.childOffsets[V]+De,t:E[De],nodex:(Z<<1)+this._siblingOffset[De][0],nodey:(ce<<1)+this._siblingOffset[De][1],depth:ye+1})}}return null}_addNode(o,l,u){return this.minimums.push(o),this.maximums.push(l),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(o,l,u,f,b){if(1===o[f].isLeaf(l,u))return;this.childOffsets[b]||(this.childOffsets[b]=this.nodeCount);const y=f-1,S=o[y];let T=0,E=0;for(let M=0;M<this._siblingOffset.length;M++){const P=2*l+this._siblingOffset[M][0],O=2*u+this._siblingOffset[M][1],B=S.getElevation(P,O),V=S.isLeaf(P,O),G=this._addNode(B.min,B.max,V);V&&(T|=1<<M),E||(E=G)}for(let M=0;M<this._siblingOffset.length;M++)T&1<<M||this._construct(o,2*l+this._siblingOffset[M][0],2*u+this._siblingOffset[M][1],y,E+M)}}function $_(a,o,l,u,f,b){return zi(zi(a,l,b),zi(o,u,b),f)}function Au(a,o,l){const u=l.dim,f=Ke(a*u-.5,0,u-1),b=Ke(o*u-.5,0,u-1),y=Math.floor(f),S=Math.floor(b),T=Math.min(y+1,u-1),E=Math.min(S+1,u-1);return $_(l.get(y,S),l.get(T,S),l.get(y,E),l.get(T,E),f-y,b-S)}const G_={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class xg{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(o,l,u,f=!1,b=!1){if(this.uid=o,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(u&&"mapbox"!==u&&"terrarium"!==u)return Ni(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=l.height;const y=this.dim=l.height-2,S=new Uint32Array(l.data.buffer);if(this.pixels=new Uint8Array(l.data.buffer),this.encoding=u||"mapbox",this.borderReady=f,!f){for(let T=0;T<y;T++)S[this._idx(-1,T)]=S[this._idx(0,T)],S[this._idx(y,T)]=S[this._idx(y-1,T)],S[this._idx(T,-1)]=S[this._idx(T,0)],S[this._idx(T,y)]=S[this._idx(T,y-1)];S[this._idx(-1,-1)]=S[this._idx(0,0)],S[this._idx(y,-1)]=S[this._idx(y-1,0)],S[this._idx(-1,y)]=S[this._idx(0,y-1)],S[this._idx(y,y)]=S[this._idx(y-1,y-1)],b&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new B0(this)}get(o,l,u=!1){u&&(o=Ke(o,-1,this.dim),l=Ke(l,-1,this.dim));const f=4*this._idx(o,l);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(this.pixels[f],this.pixels[f+1],this.pixels[f+2])}static getUnpackVector(o){return G_[o]}get unpackVector(){return G_[this.encoding]}_idx(o,l){if(o<-1||o>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(o+1)}_unpackMapbox(o,l,u){return(256*o*256+256*l+u)/10-1e4}_unpackTerrarium(o,l,u){return 256*o+l+u/256-32768}static pack(o,l){const u=[0,0,0,0],f=xg.getUnpackVector(l);let b=Math.floor((o+f[3])/f[2]);return u[2]=b%256,b=Math.floor(b/256),u[1]=b%256,b=Math.floor(b/256),u[0]=b,u}getPixels(){return new ya({width:this.stride,height:this.stride},this.pixels)}backfillBorder(o,l,u){if(this.dim!==o.dim)throw new Error("dem dimension mismatch");let f=l*this.dim,b=l*this.dim+this.dim,y=u*this.dim,S=u*this.dim+this.dim;switch(l){case-1:f=b-1;break;case 1:b=f+1}switch(u){case-1:y=S-1;break;case 1:S=y+1}const T=-l*this.dim,E=-u*this.dim;for(let M=y;M<S;M++)for(let P=f;P<b;P++){const O=4*this._idx(P,M),B=4*this._idx(P+T,M+E);this.pixels[O+0]=o.pixels[B+0],this.pixels[O+1]=o.pixels[B+1],this.pixels[O+2]=o.pixels[B+2],this.pixels[O+3]=o.pixels[B+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}tn(xg,"DEMData"),tn(B0,"DemMinMaxQuadTree",{omit:["dem"]});class M1{constructor(o,l){this.max=o,this.onRemove=l,this.reset()}reset(){for(const o in this.data)for(const l of this.data[o])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(o,l,u){const f=o.wrapped().key;void 0===this.data[f]&&(this.data[f]=[]);const b={value:l,timeout:void 0};if(void 0!==u&&(b.timeout=setTimeout(()=>{this.remove(o,b)},u)),this.data[f].push(b),this.order.push(f),this.order.length>this.max){const y=this._getAndRemoveByKey(this.order[0]);y&&this.onRemove(y)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const l=this.data[o].shift();return l.timeout&&clearTimeout(l.timeout),0===this.data[o].length&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),l.value}getByKey(o){const l=this.data[o];return l?l[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,l){if(!this.has(o))return this;const u=o.wrapped().key,f=void 0===l?0:this.data[u].indexOf(l),b=this.data[u][f];return this.data[u].splice(f,1),b.timeout&&clearTimeout(b.timeout),0===this.data[u].length&&delete this.data[u],this.onRemove(b.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(o){const l=[];for(const u in this.data)for(const f of this.data[u])o(f.value)||l.push(f);for(const u of l)this.remove(u.value.tileID,u)}}class ps{constructor(o,l,u){this.func=o,this.mask=l,this.range=u}}ps.ReadOnly=!1,ps.ReadWrite=!0,ps.disabled=new ps(519,ps.ReadOnly,[0,1]);class W_{constructor(o,l,u,f,b,y){this.test=o,this.ref=l,this.mask=u,this.fail=f,this.depthFail=b,this.pass=y}}W_.disabled=new W_({func:519,mask:0},0,0,7680,7680,7680);class Xc{constructor(o,l,u){this.blendFunction=o,this.blendColor=l,this.mask=u}}Xc.Replace=[1,0],Xc.disabled=new Xc(Xc.Replace,uo.transparent,[!1,!1,!1,!1]),Xc.unblended=new Xc(Xc.Replace,uo.transparent,[!0,!0,!0,!0]),Xc.alphaBlended=new Xc([1,771],uo.transparent,[!0,!0,!0,!0]);class pl{constructor(o,l,u){this.enable=o,this.mode=l,this.frontFace=u}}pl.disabled=new pl(!1,1029,2305),pl.backCCW=new pl(!0,1029,2305),pl.backCW=new pl(!0,1029,2304),pl.frontCW=new pl(!0,1028,2304),pl.frontCCW=new pl(!0,1028,2305);class Rd extends xl{constructor(o,l,u){super(),this.id=o,this._onlySymbols=u,l.on("data",f=>{"source"===f.dataType&&"metadata"===f.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===f.dataType&&"content"===f.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),l.on("error",()=>{this._sourceErrored=!0}),this._source=l,this._tiles={},this._cache=new M1(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new U_,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(o){this.map=o,this._minTileCacheSize=void 0===this._minTileCacheSize&&o?o._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&o?o._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const o in this._tiles){const l=this._tiles[o];if("loaded"!==l.state&&"errored"!==l.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(o,l){return o.isSymbolTile=this._onlySymbols,this._source.loadTile(o,l)}_unloadTile(o){if(this._source.unloadTile)return this._source.unloadTile(o,()=>{})}_abortTile(o){if(this._source.abortTile)return this._source.abortTile(o,()=>{})}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const l in this._tiles){const u=this._tiles[l];u.upload(o),u.prepare(this.map.style.imageManager)}}getIds(){return Fi(this._tiles).map(o=>o.tileID).sort(z0).map(o=>o.key)}getRenderableIds(o){const l=[];for(const u in this._tiles)this._isIdRenderable(+u,o)&&l.push(this._tiles[u]);return o?l.sort((u,f)=>{const b=u.tileID,y=f.tileID,S=new mt(b.canonical.x,b.canonical.y)._rotate(this.transform.angle),T=new mt(y.canonical.x,y.canonical.y)._rotate(this.transform.angle);return b.overscaledZ-y.overscaledZ||T.y-S.y||T.x-S.x}).map(u=>u.tileID.key):l.map(u=>u.tileID).sort(z0).map(u=>u.key)}hasRenderableParent(o){const l=this.findLoadedParent(o,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(o,l){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(l||!this._tiles[o].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)"errored"!==this._tiles[o].state&&this._reloadTile(+o,"reloading")}}_reloadTile(o,l){const u=this._tiles[o];u&&("loading"!==u.state&&(u.state=l),this._loadTile(u,this._tileLoaded.bind(this,u,o,l)))}_tileLoaded(o,l,u,f){if(f)if(o.state="errored",404!==f.status)this._source.fire(new Ul(f,{tile:o}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const b=this.map.painter.terrain;this.update(this.transform,b.getScaledDemTileSize(),!0),b.resetTileLookupCache(this.id)}else this.update(this.transform);else o.timeAdded=qi.now(),"expired"===u&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(l,o),"raster-dem"===this._source.type&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),this._source.fire(new _r("data",{dataType:"source",tile:o,coord:o.tileID,sourceCacheId:this.id}))}_backfillDEM(o){const l=this.getRenderableIds();for(let f=0;f<l.length;f++){const b=l[f];if(o.neighboringTiles&&o.neighboringTiles[b]){const y=this.getTileByID(b);u(o,y),u(y,o)}}function u(f,b){if(!f.dem||f.dem.borderReady)return;f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0;let y=b.tileID.canonical.x-f.tileID.canonical.x;const S=b.tileID.canonical.y-f.tileID.canonical.y,T=Math.pow(2,f.tileID.canonical.z),E=b.tileID.key;0===y&&0===S||Math.abs(S)>1||(Math.abs(y)>1&&(1===Math.abs(y+T)?y+=T:1===Math.abs(y-T)&&(y-=T)),b.dem&&f.dem&&(f.dem.backfillBorder(b.dem,y,S),f.neighboringTiles&&f.neighboringTiles[E]&&(f.neighboringTiles[E].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,l,u,f){for(const b in this._tiles){let y=this._tiles[b];if(f[b]||!y.hasData()||y.tileID.overscaledZ<=l||y.tileID.overscaledZ>u)continue;let S=y.tileID;for(;y&&y.tileID.overscaledZ>l+1;){const E=y.tileID.scaledTo(y.tileID.overscaledZ-1);y=this._tiles[E.key],y&&y.hasData()&&(S=E)}let T=S;for(;T.overscaledZ>l;)if(T=T.scaledTo(T.overscaledZ-1),o[T.key]){f[S.key]=S;break}}}findLoadedParent(o,l){if(o.key in this._loadedParentTiles){const u=this._loadedParentTiles[o.key];return u&&u.tileID.overscaledZ>=l?u:null}for(let u=o.overscaledZ-1;u>=l;u--){const f=o.scaledTo(u),b=this._getLoadedTile(f);if(b)return b}}_getLoadedTile(o){const l=this._tiles[o.key];return l&&l.hasData()?l:this._cache.getByKey(this._source.reparseOverscaled?o.wrapped().key:o.canonical.key)}updateCacheSize(o,l){l=l||this._source.tileSize;const u=Math.ceil(o.width/l)+1,f=Math.ceil(o.height/l)+1,b=Math.floor(u*f*5),y="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,b):b,S="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,y):y;this._cache.setMaxSize(S)}handleWrapJump(o){const l=Math.round((o-(void 0===this._prevLng?o:this._prevLng))/360);if(this._prevLng=o,l){const u={};for(const f in this._tiles){const b=this._tiles[f];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+l),u[b.tileID.key]=b}this._tiles=u;for(const f in this._timers)clearTimeout(this._timers[f]),delete this._timers[f];for(const f in this._tiles)this._setTileReloadTimer(+f,this._tiles[f])}}update(o,l,u){if(this.transform=o,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!u)return;let f;this.updateCacheSize(o,l),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?f=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(S=>new Is(S.canonical.z,S.wrap,S.canonical.z,S.canonical.x,S.canonical.y)):(f=o.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(f=f.filter(S=>this._source.hasTile(S)))):f=[];const b=this._updateRetainedTiles(f);if(V0(this._source.type)&&0!==f.length){const S={},T={},E=Object.keys(b);for(const P of E){const O=b[P],B=this._tiles[P];if(!B||B.fadeEndTime&&B.fadeEndTime<=qi.now())continue;const V=this.findLoadedParent(O,Math.max(O.overscaledZ-Rd.maxOverzooming,this._source.minzoom));V&&(this._addTile(V.tileID),S[V.tileID.key]=V.tileID),T[P]=O}const M=f[f.length-1].overscaledZ;for(const P in this._tiles){const O=this._tiles[P];if(b[P]||!O.hasData())continue;let B=O.tileID;for(;B.overscaledZ>M;){B=B.scaledTo(B.overscaledZ-1);const V=this._tiles[B.key];if(V&&V.hasData()&&T[B.key]){b[P]=O.tileID;break}}}for(const P in S)b[P]||(this._coveredTiles[P]=!0,b[P]=S[P])}for(const S in b)this._tiles[S].clearFadeHold();const y=function(S,T){const E=[];for(const M in S)M in T||E.push(M);return E}(this._tiles,b);for(const S of y){const T=this._tiles[S];T.hasSymbolBuckets&&!T.holdingForFade()?T.setHoldDuration(this.map._fadeDuration):T.hasSymbolBuckets&&!T.symbolFadeFinished()||this._removeTile(+S)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(+o)}_updateRetainedTiles(o){const l={};if(0===o.length)return l;const u={},f=o.reduce((E,M)=>Math.min(E,M.overscaledZ),1/0),b=o[0].overscaledZ,y=Math.max(b-Rd.maxOverzooming,this._source.minzoom),S=Math.max(b+Rd.maxUnderzooming,this._source.minzoom),T={};for(const E of o){const M=this._addTile(E);l[E.key]=E,M.hasData()||f<this._source.maxzoom&&(T[E.key]=E)}this._retainLoadedChildren(T,f,S,l);for(const E of o){let M=this._tiles[E.key];if(M.hasData())continue;if(E.canonical.z>=this._source.maxzoom){const O=E.children(this._source.maxzoom)[0],B=this.getTile(O);if(B&&B.hasData()){l[O.key]=O;continue}}else{const O=E.children(this._source.maxzoom);if(l[O[0].key]&&l[O[1].key]&&l[O[2].key]&&l[O[3].key])continue}let P=M.wasRequested();for(let O=E.overscaledZ-1;O>=y;--O){const B=E.scaledTo(O);if(u[B.key]||(u[B.key]=!0,M=this.getTile(B),!M&&P&&(M=this._addTile(B)),M&&(l[B.key]=B,P=M.wasRequested(),M.hasData())))break}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const l=[];let u,f=this._tiles[o].tileID;for(;f.overscaledZ>0;){if(f.key in this._loadedParentTiles){u=this._loadedParentTiles[f.key];break}l.push(f.key);const b=f.scaledTo(f.overscaledZ-1);if(u=this._getLoadedTile(b),u)break;f=b}for(const b of l)this._loadedParentTiles[b]=u}}_addTile(o){let l=this._tiles[o.key];if(l)return l;l=this._cache.getAndRemove(o),l&&(this._setTileReloadTimer(o.key,l),l.tileID=o,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,l)));const u=Boolean(l);if(!u){const f=this.map?this.map.painter:null;l=new _g(o,this._source.tileSize*o.overscaleFactor(),this.transform.tileZoom,f,this._isRaster),this._loadTile(l,this._tileLoaded.bind(this,l,o.key,l.state))}return l?(l.uses++,this._tiles[o.key]=l,u||this._source.fire(new _r("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l):null}_setTileReloadTimer(o,l){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const u=l.getExpiryTimeout();u&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},u))}_removeTile(o){const l=this._tiles[o];l&&(l.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),l.uses>0||(l.hasData()&&"reloading"!==l.state?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(+o);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(o,l,u){const f=[],b=this.transform;if(!b)return f;const y="globe"===b.projection.name,S=ll(b.center.lng);for(const T in this._tiles){const E=this._tiles[T];if(u&&E.clearQueryDebugViz(),E.holdingForFade())continue;let M;if(y){const P=E.tileID.canonical;if(0===P.z){const O=[Math.abs(Ke(S,...cp(P,-1))-S),Math.abs(Ke(S,...cp(P,1))-S)];M=[0,2*O.indexOf(Math.min(...O))-1]}else{const O=[Math.abs(Ke(S,...cp(P,-1))-S),Math.abs(Ke(S,...cp(P,0))-S),Math.abs(Ke(S,...cp(P,1))-S)];M=[O.indexOf(Math.min(...O))-1]}}else M=[0];for(const P of M){const O=o.containsTile(E,b,l,P);O&&f.push(O)}}return f}getVisibleCoordinates(o){const l=this.getRenderableIds(o).map(u=>this._tiles[u].tileID);for(const u of l)u.projMatrix=this.transform.calculateProjMatrix(u.toUnwrapped());return l}hasTransition(){if(this._source.hasTransition())return!0;if(V0(this._source.type))for(const o in this._tiles){const l=this._tiles[o];if(void 0!==l.fadeEndTime&&l.fadeEndTime>=qi.now())return!0}return!1}setFeatureState(o,l,u){this._state.updateState(o=o||"_geojsonTileLayer",l,u)}removeFeatureState(o,l,u){this._state.removeFeatureState(o=o||"_geojsonTileLayer",l,u)}getFeatureState(o,l){return this._state.getState(o=o||"_geojsonTileLayer",l)}setDependencies(o,l,u){const f=this._tiles[o];f&&f.setDependencies(l,u)}reloadTilesForDependencies(o,l){for(const u in this._tiles)this._tiles[u].hasDependency(o,l)&&this._reloadTile(+u,"reloading");this._cache.filter(u=>!u.hasDependency(o,l))}_preloadTiles(o,l){const u=new Map,f=Array.isArray(o)?o:[o],b=this.map.painter.terrain,y=this.usedForTerrain&&b?b.getScaledDemTileSize():this._source.tileSize;for(const S of f){const T=S.coveringTiles({tileSize:y,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const E of T)u.set(E.key,E);this.usedForTerrain&&S.updateElevation(!1)}Un(Array.from(u.values()),(S,T)=>{const E=new _g(S,this._source.tileSize*S.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(E,M=>{"raster-dem"===this._source.type&&E.dem&&this._backfillDEM(E),T(M,E)})},l)}}function z0(a,o){const l=Math.abs(2*a.wrap)-+(a.wrap<0),u=Math.abs(2*o.wrap)-+(o.wrap<0);return a.overscaledZ-o.overscaledZ||u-l||o.canonical.y-a.canonical.y||o.canonical.x-a.canonical.x}function V0(a){return"raster"===a||"image"===a||"video"===a||"custom"===a}function cp(a,o){const l=1<<a.z;return[a.x/l+o,(a.x+1)/l+o]}Rd.maxOverzooming=10,Rd.maxUnderzooming=3;class wg{constructor(o,l,u){this._demTile=o,this._dem=this._demTile.dem,this._scale=l,this._offset=u}static create(o,l,u){const f=u||o.findDEMTileFor(l);if(!f||!f.dem)return;const b=f.dem,y=f.tileID,S=1<<l.canonical.z-y.canonical.z;return new wg(f,f.tileSize/Mn/S,[(l.canonical.x/S-y.canonical.x)*b.dim,(l.canonical.y/S-y.canonical.y)*b.dim])}tileCoordToPixel(o,l){const u=l*this._scale+this._offset[1],f=Math.floor(o*this._scale+this._offset[0]),b=Math.floor(u);return new mt(f,b)}getElevationAt(o,l,u,f){const b=o*this._scale+this._offset[0],y=l*this._scale+this._offset[1],S=Math.floor(b),T=Math.floor(y),E=this._dem;return f=!!f,u?zi(zi(E.get(S,T,f),E.get(S,T+1,f),y-T),zi(E.get(S+1,T,f),E.get(S+1,T+1,f),y-T),b-S):E.get(S,T,f)}getElevationAtPixel(o,l,u){return this._dem.get(o,l,!!u)}getMeterToDEM(o){return(1<<this._demTile.tileID.canonical.z)*Fa(1,o)*this._dem.stride}}class Z_{constructor(o,l){this.tileID=o,this.x=o.canonical.x,this.y=o.canonical.y,this.z=o.canonical.z,this.grid=new ec(Mn,16,0),this.featureIndexArray=new Pm,this.promoteId=l}insert(o,l,u,f,b,y=0){const S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,f,b,y);const T=this.grid;for(let E=0;E<l.length;E++){const M=l[E],P=[1/0,1/0,-1/0,-1/0];for(let O=0;O<M.length;O++){const B=M[O];P[0]=Math.min(P[0],B.x),P[1]=Math.min(P[1],B.y),P[2]=Math.max(P[2],B.x),P[3]=Math.max(P[3],B.y)}P[0]<Mn&&P[1]<Mn&&P[2]>=0&&P[3]>=0&&T.insert(S,P[0],P[1],P[2],P[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Ym(new ea(this.rawTileData)).layers,this.sourceLayerCoder=new P0(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const o in this.vtLayers)this.vtFeatures[o]=[]}return this.vtLayers}query(o,l,u,f){this.loadVTLayers();const b=o.params||{},y=vh(b.filter),S=o.tileResult,T=o.transform,E=S.bufferedTilespaceBounds,M=this.grid.query(E.min.x,E.min.y,E.max.x,E.max.y,(V,G,Z,ce)=>cf(S.bufferedTilespaceGeometry,V,G,Z,ce));M.sort(A1);let P=null;T.elevation&&M.length>0&&(P=wg.create(T.elevation,this.tileID));const O={};let B;for(let V=0;V<M.length;V++){const G=M[V];if(G===B)continue;B=G;const Z=this.featureIndexArray.get(G);let ce=null;this.loadMatchingFeature(O,Z,y,b.layers,b.availableImages,l,u,f,(ye,ue,ge,De=0)=>(ce||(ce=Fc(ye,this.tileID.canonical,o.tileTransform)),ue.queryIntersectsFeature(S,ye,ge,ce,this.z,o.transform,o.pixelPosMatrix,P,De)))}return O}loadMatchingFeature(o,l,u,f,b,y,S,T,E){const{featureIndex:M,bucketIndex:P,sourceLayerIndex:O,layoutVertexArrayOffset:B}=l,V=this.bucketLayerIDs[P];if(f&&!function(ye,ue){for(let ge=0;ge<ye.length;ge++)if(ue.indexOf(ye[ge])>=0)return!0;return!1}(f,V))return;const G=this.sourceLayerCoder.decode(O),Z=this.vtLayers[G].feature(M);if(u.needGeometry){const ye=Lh(Z,!0);if(!u.filter(new he(this.tileID.overscaledZ),ye,this.tileID.canonical))return}else if(!u.filter(new he(this.tileID.overscaledZ),Z))return;const ce=this.getId(Z,G);for(let ye=0;ye<V.length;ye++){const ue=V[ye];if(f&&f.indexOf(ue)<0)continue;const ge=y[ue];if(!ge)continue;let De={};void 0!==ce&&T&&(De=T.getState(ge.sourceLayer||"_geojsonTileLayer",ce));const xe=en({},S[ue]);xe.paint=j0(xe.paint,ge.paint,Z,De,b),xe.layout=j0(xe.layout,ge.layout,Z,De,b);const tt=!E||E(Z,ge,De,B);if(!tt)continue;const Ze=new L0(Z,this.z,this.x,this.y,ce);Ze.layer=xe;let lt=o[ue];void 0===lt&&(lt=o[ue]=[]),lt.push({featureIndex:M,feature:Ze,intersectionZ:tt})}}lookupSymbolFeatures(o,l,u,f,b,y,S,T){const E={};this.loadVTLayers();const M=vh(b);for(const P of o)this.loadMatchingFeature(E,{bucketIndex:u,sourceLayerIndex:f,featureIndex:P,layoutVertexArrayOffset:0},M,y,S,T,l);return E}loadFeature(o){const{featureIndex:l,sourceLayerIndex:u}=o;this.loadVTLayers();const f=this.sourceLayerCoder.decode(u),b=this.vtFeatures[f];if(b[l])return b[l];const y=this.vtLayers[f].feature(l);return b[l]=y,y}hasLayer(o){for(const l of this.bucketLayerIDs)for(const u of l)if(o===u)return!0;return!1}getId(o,l){let u=o.id;if(this.promoteId){const f="string"==typeof this.promoteId?this.promoteId:this.promoteId[l];null!=f&&(u=o.properties[f]),"boolean"==typeof u&&(u=Number(u))}return u}}function j0(a,o,l,u,f){return di(a,(b,y)=>{const S=o instanceof gt?o.get(y):null;return S&&S.evaluate?S.evaluate(l,u,f):S})}function A1(a,o){return o-a}tn(Z_,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class Y_{constructor(o,l){this.width=o,this.height=l,this.nextRow=0,this.image=new Vc({width:o,height:l}),this.positions={},this.uploaded=!1}getDash(o,l){const u=this.getKey(o,l);return this.positions[u]}trim(){const o=this.width,l=this.height=ni(this.nextRow);this.image.resize({width:o,height:l})}getKey(o,l){return o.join(",")+l}getDashRanges(o,l,u){const f=[];let b=o.length%2==1?-o[o.length-1]*u:0,y=o[0]*u,S=!0;f.push({left:b,right:y,isDash:S,zeroLength:0===o[0]});let T=o[0];for(let E=1;E<o.length;E++){S=!S;const M=o[E];b=T*u,T+=M,y=T*u,f.push({left:b,right:y,isDash:S,zeroLength:0===M})}return f}addRoundDash(o,l,u){const f=l/2;for(let b=-u;b<=u;b++){const y=this.width*(this.nextRow+u+b);let S=0,T=o[S];for(let E=0;E<this.width;E++){E/T.right>1&&(T=o[++S]);const M=Math.abs(E-T.left),P=Math.abs(E-T.right),O=Math.min(M,P);let B;const V=b/u*(f+1);if(T.isDash){const G=f-Math.abs(V);B=Math.sqrt(O*O+G*G)}else B=f-Math.sqrt(O*O+V*V);this.image.data[y+E]=Math.max(0,Math.min(255,B+128))}}}addRegularDash(o,l){for(let T=o.length-1;T>=0;--T){const E=o[T],M=o[T+1];E.zeroLength?o.splice(T,1):M&&M.isDash===E.isDash&&(M.left=E.left,o.splice(T,1))}const u=o[0],f=o[o.length-1];u.isDash===f.isDash&&(u.left=f.left-this.width,f.right=u.right+this.width);const b=this.width*this.nextRow;let y=0,S=o[y];for(let T=0;T<this.width;T++){T/S.right>1&&(S=o[++y]);const E=Math.abs(T-S.left),M=Math.abs(T-S.right),P=Math.min(E,M);this.image.data[b+T]=Math.max(0,Math.min(255,(S.isDash?P:-P)+l+128))}}addDash(o,l){const u=this.getKey(o,l);if(this.positions[u])return this.positions[u];const f="round"===l,b=f?7:0,y=2*b+1;if(this.nextRow+y>this.height)return Ni("LineAtlas out of space"),null;0===o.length&&o.push(1);let S=0;for(let M=0;M<o.length;M++)o[M]<0&&(Ni("Negative value is found in line dasharray, replacing values with 0"),o[M]=0),S+=o[M];if(0!==S){const M=this.width/S,P=this.getDashRanges(o,this.width,M);f?this.addRoundDash(P,M,b):this.addRegularDash(P,"square"===l?.5*M:0)}const T=this.nextRow+b;this.nextRow+=y;const E={tl:[T,b],br:[S,0]};return this.positions[u]=E,E}}tn(Y_,"LineAtlas");class Q_{constructor(o){const l={},u=[];for(const S in o){const T=o[S],E=l[S]={};for(const M in T.glyphs){const P=T.glyphs[+M];if(!P||0===P.bitmap.width||0===P.bitmap.height)continue;const O=P.metrics.localGlyph?2:1,B={x:0,y:0,w:P.bitmap.width+2*O,h:P.bitmap.height+2*O};u.push(B),E[M]=B}}const{w:f,h:b}=p_(u),y=new Vc({width:f||1,height:b||1});for(const S in o){const T=o[S];for(const E in T.glyphs){const M=T.glyphs[+E];if(!M||0===M.bitmap.width||0===M.bitmap.height)continue;const P=l[S][E],O=M.metrics.localGlyph?2:1;Vc.copy(M.bitmap,y,{x:0,y:0},{x:P.x+O,y:P.y+O},M.bitmap)}}this.image=y,this.positions=l}}tn(Q_,"GlyphAtlas");class k1{constructor(o){this.tileID=new Is(o.tileID.overscaledZ,o.tileID.wrap,o.tileID.canonical.z,o.tileID.canonical.x,o.tileID.canonical.y),this.tileZoom=o.tileZoom,this.uid=o.uid,this.zoom=o.zoom,this.canonical=o.tileID.canonical,this.pixelRatio=o.pixelRatio,this.tileSize=o.tileSize,this.source=o.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=o.showCollisionBoxes,this.collectResourceTiming=!!o.collectResourceTiming,this.returnDependencies=!!o.returnDependencies,this.promoteId=o.promoteId,this.enableTerrain=!!o.enableTerrain,this.isSymbolTile=o.isSymbolTile,this.tileTransform=qc(o.tileID.canonical,o.projection),this.projection=o.projection}parse(o,l,u,f,b){this.status="parsing",this.data=o,this.collisionBoxArray=new fv;const y=new P0(Object.keys(o.layers).sort()),S=new Z_(this.tileID,this.promoteId);S.bucketLayerIDs=[];const T={},E=new Y_(256,256),M={featureIndex:S,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:E,availableImages:u},P=l.familiesBySource[this.source];for(const De in P){const xe=o.layers[De];if(!xe)continue;let tt=!1,Ze=!1;for(const ot of P[De])"symbol"===ot[0].type?tt=!0:Ze=!0;if(!0===this.isSymbolTile&&!tt||!1===this.isSymbolTile&&!Ze)continue;1===xe.version&&Ni(`Vector tile source "${this.source}" layer "${De}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const lt=y.encode(De),Mt=[];for(let ot=0;ot<xe.length;ot++){const _t=xe.feature(ot),yt=S.getId(_t,De);Mt.push({feature:_t,id:yt,index:ot,sourceLayerIndex:lt})}for(const ot of P[De]){const _t=ot[0];void 0!==this.isSymbolTile&&"symbol"===_t.type!==this.isSymbolTile||_t.minzoom&&this.zoom<Math.floor(_t.minzoom)||_t.maxzoom&&this.zoom>=_t.maxzoom||"none"!==_t.visibility&&(fl(ot,this.zoom,u),(T[_t.id]=_t.createBucket({index:S.bucketLayerIDs.length,layers:ot,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:lt,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:u})).populate(Mt,M,this.tileID.canonical,this.tileTransform),S.bucketLayerIDs.push(ot.map(yt=>yt.id)))}}let O,B,V,G;E.trim();const Z={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ce=di(M.glyphDependencies,De=>Object.keys(De).map(Number));Object.keys(ce).length?f.send("getGlyphs",{uid:this.uid,stacks:ce},(De,xe)=>{O||(O=De,B=xe,ge.call(this))},void 0,!1,Z):B={};const ye=Object.keys(M.iconDependencies);ye.length?f.send("getImages",{icons:ye,source:this.source,tileID:this.tileID,type:"icons"},(De,xe)=>{O||(O=De,V=xe,ge.call(this))},void 0,!1,Z):V={};const ue=Object.keys(M.patternDependencies);function ge(){if(O)return b(O);if(B&&V&&G){const De=new Q_(B),xe=new f_(V,G);for(const tt in T){const Ze=T[tt];Ze instanceof Ad?(fl(Ze.layers,this.zoom,u),ug(Ze,B,De.positions,V,xe.iconPositions,this.showCollisionBoxes,u,this.tileID.canonical,this.tileZoom,this.projection)):Ze.hasPattern&&(Ze instanceof qh||Ze instanceof Zm||Ze instanceof xf)&&(fl(Ze.layers,this.zoom,u),Ze.addFeatures(M,this.tileID.canonical,xe.patternPositions,u,this.tileTransform))}this.status="done",b(null,{buckets:Fi(T).filter(tt=>!tt.isEmpty()),featureIndex:S,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:De.image,lineAtlas:E,imageAtlas:xe,glyphMap:this.returnDependencies?B:null,iconMap:this.returnDependencies?V:null,glyphPositions:this.returnDependencies?De.positions:null})}}ue.length?f.send("getImages",{icons:ue,source:this.source,tileID:this.tileID,type:"patterns"},(De,xe)=>{O||(O=De,G=xe,ge.call(this))},void 0,!1,Z):G={},ge.call(this)}}function fl(a,o,l){const u=new he(o);for(const f of a)f.recalculate(u,l)}class Sg{constructor(o){this.entries={},this.scheduler=o}request(o,l,u,f){const b=this.entries[o]=this.entries[o]||{callbacks:[]};if(b.result){const[y,S]=b.result;return this.scheduler?this.scheduler.add(()=>{f(y,S)},l):f(y,S),()=>{}}return b.callbacks.push(f),b.cancel||(b.cancel=u((y,S)=>{b.result=[y,S];for(const T of b.callbacks)this.scheduler?this.scheduler.add(()=>{T(y,S)},l):T(y,S);setTimeout(()=>delete this.entries[o],3e3)})),()=>{b.result||(b.callbacks=b.callbacks.filter(y=>y!==f),b.callbacks.length||(b.cancel(),delete this.entries[o]))}}}function U0(a,o,l){const u=JSON.stringify(a.request);return a.data&&(this.deduped.entries[u]={result:[null,a.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom},f=>{const b=Qa(a.request,(y,S,T,E)=>{y?f(y):S&&f(null,{vectorTile:l?void 0:new Ym(new ea(S)),rawData:S,cacheControl:T,expires:E})});return()=>{b.cancel(),f()}},o)}p.ARRAY_TYPE=Ks,p.AUTH_ERR_MSG=Ve,p.Aabb=Zo,p.Actor=class{constructor(a,o,l){this.target=a,this.parent=o,this.mapId=l,this.callbacks={},this.cancelCallbacks={},Rs(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Sn()?a:me,this.scheduler=new V_}send(a,o,l,u,f=!1,b){const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(l.metadata=b,this.callbacks[y]=l);const S=In(this.globalScope)?void 0:[];return this.target.postMessage({id:y,type:a,hasCallback:!!l,targetMapId:u,mustQueue:f,sourceMapId:this.mapId,data:Zs(o,S)},S),{cancel:()=>{l&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(a){const o=a.data,l=o.id;if(l&&(!o.targetMapId||this.mapId===o.targetMapId))if("<cancel>"===o.type){const u=this.cancelCallbacks[l];delete this.cancelCallbacks[l],u&&u.cancel()}else if(o.mustQueue||Sn()){const u=this.callbacks[l];this.cancelCallbacks[l]=this.scheduler.add(()=>this.processTask(l,o),u&&u.metadata||{type:"message"})}else this.processTask(l,o)}processTask(a,o){if("<response>"===o.type){const l=this.callbacks[a];delete this.callbacks[a],l&&(o.error?l(El(o.error)):l(null,El(o.data)))}else{const l=In(this.globalScope)?void 0:[],u=o.hasCallback?(b,y)=>{delete this.cancelCallbacks[a],this.target.postMessage({id:a,type:"<response>",sourceMapId:this.mapId,error:b?Zs(b):null,data:Zs(y,l)},l)}:b=>{},f=El(o.data);if(this.parent[o.type])this.parent[o.type](o.sourceMapId,f,u);else if(this.parent.getWorkerSource){const b=o.type.split(".");this.parent.getWorkerSource(o.sourceMapId,b[0],f.source)[b[1]](f,u)}else u(new Error(`Could not find function ${o.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},p.CanonicalTileID=Jm,p.Color=uo,p.ColorMode=Xc,p.CullFaceMode=pl,p.DEMData=xg,p.DataConstantProperty=qe,p.DedupedRequest=Sg,p.DepthMode=ps,p.EXTENT=Mn,p.Elevation=class{isDataAvailableAtPoint(a){const o=this._source();if(this.isUsingMockSource()||!o||a.y<0||a.y>1)return!1;const l=o.getSource().maxzoom,u=1<<l,f=Math.floor(a.x),b=Math.floor((a.x-f)*u),y=Math.floor(a.y*u),S=this.findDEMTileFor(new Is(l,f,l,b,y));return!(!S||!S.dem)}getAtPointOrZero(a,o=0){return this.getAtPoint(a,o)||0}getAtPoint(a,o,l=!0){if(this.isUsingMockSource())return null;null==o&&(o=null);const u=this._source();if(!u||a.y<0||a.y>1)return o;const f=u.getSource().maxzoom,b=1<<f,y=Math.floor(a.x),S=a.x-y,T=new Is(f,y,f,Math.floor(S*b),Math.floor(a.y*b)),E=this.findDEMTileFor(T);if(!E||!E.dem)return o;const M=E.dem,P=1<<E.tileID.canonical.z,O=(S*P-E.tileID.canonical.x)*M.dim,B=(a.y*P-E.tileID.canonical.y)*M.dim,V=Math.floor(O),G=Math.floor(B);return(l?this.exaggeration():1)*zi(zi(M.get(V,G),M.get(V,G+1),B-G),zi(M.get(V+1,G),M.get(V+1,G+1),B-G),O-V)}getAtTileOffset(a,o,l){const u=1<<a.canonical.z;return this.getAtPointOrZero(new bd(a.wrap+(a.canonical.x+o/Mn)/u,(a.canonical.y+l/Mn)/u))}getAtTileOffsetFunc(a,o,l,u){return f=>{const b=this.getAtTileOffset(a,f.x,f.y),y=u.upVector(a.canonical,f.x,f.y);return Ba(y,y,b*u.upVectorScale(a.canonical,o,l).metersToTile),y}}getForTilePoints(a,o,l,u){if(this.isUsingMockSource())return!1;const f=wg.create(this,a,u);return!!f&&(o.forEach(b=>{b[2]=this.exaggeration()*f.getElevationAt(b[0],b[1],l)}),!0)}getMinMaxForTile(a){if(this.isUsingMockSource())return null;const o=this.findDEMTileFor(a);if(!o||!o.dem)return null;const l=o.dem.tree,u=o.tileID,f=1<<a.canonical.z-u.canonical.z;let b=a.canonical.x/f-u.canonical.x,y=a.canonical.y/f-u.canonical.y,S=0;for(let T=0;T<a.canonical.z-u.canonical.z&&!l.leaves[S];T++){b*=2,y*=2;const E=2*Math.floor(y)+Math.floor(b);S=l.childOffsets[S]+E,b%=1,y%=1}return{min:this.exaggeration()*l.minimums[S],max:this.exaggeration()*l.maximums[S]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(a,o,l){throw new Error("Pure virtual method called.")}pointCoordinate(a){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(a){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},p.ErrorEvent=Ul,p.EvaluationParameters=he,p.Event=_r,p.Evented=xl,p.FillExtrusionBucket=xf,p.Frustum=$m,p.FrustumCorners=Vb,p.GLOBE_METERS_TO_ECEF=Rf,p.GLOBE_RADIUS=Du,p.GLOBE_SCALE_MATCH_LATITUDE=45,p.GLOBE_ZOOM_THRESHOLD_MAX=6,p.GLOBE_ZOOM_THRESHOLD_MIN=5,p.GlobeSharedBuffers=class{constructor(a){this._createGrid(a),this._createPoles(a)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const a of this._poleSegments)a.destroy();for(const a of this._gridSegments)a.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const a of this._wireframeSegments)a.destroy()}}_createGrid(a){const o=new bi,l=new Co,u=65;for(let f=0;f<u;f++)for(let b=0;b<u;b++)o.emplaceBack(b,f);this._gridSegments=[];for(let f=0,b=0;f<Pf.length;f++){const y=Pf[f];for(let T=0;T<y;T++)for(let E=0;E<64;E++){const M=T*u+E;l.emplaceBack(M+1,M,M+u),l.emplaceBack(M+u,M+u+1,M+1)}const S=64*y*2;this._gridSegments.push(fo.simpleSegment(0,b,(y+1)*u,S)),b+=S}this._gridBuffer=a.createVertexBuffer(o,Cd.members),this._gridIndexBuffer=a.createIndexBuffer(l,!0)}_createPoles(a){const o=new Co;for(let f=0;f<=64;f++)o.emplaceBack(0,f+1,f+2);this._poleIndexBuffer=a.createIndexBuffer(o,!0);const l=new fa,u=new fa;this._poleSegments=[];for(let f=0,b=0;f<5;f++){const y=360/(1<<f);l.emplaceBack(0,-Du,0,.5,0),u.emplaceBack(0,-Du,0,.5,1);for(let S=0;S<=64;S++){const T=S/64,E=zi(0,y,T),[M,P,O]=Td(Gc,A_,E,Du);l.emplaceBack(M,P,O,T,0),u.emplaceBack(M,P,O,T,1)}this._poleSegments.push(fo.simpleSegment(b,0,66,64)),b+=66}this._poleNorthVertexBuffer=a.createVertexBuffer(l,T_,!1),this._poleSouthVertexBuffer=a.createVertexBuffer(u,T_,!1)}getGridBuffers(a){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments[a]]}getPoleBuffers(a){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[a]]}getWirefameBuffers(a,o){if(!this._wireframeSegments){const l=new sl,u=64,f=u+1;this._wireframeSegments=[];for(let b=0,y=0;b<Pf.length;b++){const S=Pf[b];for(let E=0;E<S;E++)for(let M=0;M<u;M++){const P=E*f+M;l.emplaceBack(P,P+1),l.emplaceBack(P,P+f),l.emplaceBack(P,P+f+1)}const T=S*u*3;this._wireframeSegments.push(fo.simpleSegment(0,y,(S+1)*f,T)),y+=T}this._wireframeIndexBuffer=a.createIndexBuffer(l)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[o]]}},p.GlyphManager=xr,p.ImagePosition=tg,p.LivePerformanceUtils=ht,p.LngLat=Xi,p.LngLatBounds=nc,p.LocalGlyphMode=ag,p.MAX_MERCATOR_LATITUDE=_a,p.MercatorCoordinate=bd,p.ONE_EM=24,p.OverscaledTileID=Is,p.PerformanceMarkers=ke,p.Properties=Lt,p.RGBAImage=ya,p.Ray=zb,p.RequestManager=class{constructor(a,o,l){this._transformRequestFn=a,this._customAccessToken=o,this._silenceAuthErrors=!!l,this._createSkuToken()}_createSkuToken(){const a=function(){let o="";for(let l=0;l<10;l++)o+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",dn,o].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=a.token,this._skuTokenExpiresAt=a.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(a,o){return this._transformRequestFn&&this._transformRequestFn(a,o)||{url:a}}normalizeStyleURL(a,o){if(!le(a))return a;const l=Wn(a);return l.path=`/styles/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||o)}normalizeGlyphsURL(a,o){if(!le(a))return a;const l=Wn(a);return l.path=`/fonts/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||o)}normalizeSourceURL(a,o,l,u){if(!le(a))return a;const f=Wn(a);return f.path=`/v4/${f.authority}.json`,f.params.push("secure"),l&&f.params.push(`language=${l}`),u&&f.params.push(`worldview=${u}`),this._makeAPIURL(f,this._customAccessToken||o)}normalizeSpriteURL(a,o,l,u){const f=Wn(a);return le(a)?(f.path=`/styles/v1${f.path}/sprite${o}${l}`,this._makeAPIURL(f,this._customAccessToken||u)):(f.path+=`${o}${l}`,Zr(f))}normalizeTileURL(a,o,l){if(this._isSkuTokenExpired()&&this._createSkuToken(),a&&!le(a))return a;const u=Wn(a);u.path=u.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${o||l&&"raster"!==u.authority&&512===l?"@2x":""}${Ye.supported?".webp":"$1"}`),"raster"===u.authority?u.path=`/${Ge.RASTER_URL_PREFIX}${u.path}`:(u.path=u.path.replace(/^.+\/v4\//,"/"),u.path=`/${Ge.TILE_URL_VERSION}${u.path}`);const f=this._customAccessToken||function(b){for(const y of b){const S=y.match(/^access_token=(.*)$/);if(S)return S[1]}return null}(u.params)||Ge.ACCESS_TOKEN;return Ge.REQUIRE_ACCESS_TOKEN&&f&&this._skuToken&&u.params.push(`sku=${this._skuToken}`),this._makeAPIURL(u,f)}canonicalizeTileURL(a,o){const l=Wn(a);if(!l.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!l.path.match(/\.[\w]+$/))return a;let u="mapbox://";l.path.match(/^\/raster\/v1\//)?u+=`raster/${l.path.replace(`/${Ge.RASTER_URL_PREFIX}/`,"")}`:u+=`tiles/${l.path.replace(`/${Ge.TILE_URL_VERSION}/`,"")}`;let f=l.params;return o&&(f=f.filter(b=>!b.match(/^access_token=/))),f.length&&(u+=`?${f.join("&")}`),u}canonicalizeTileset(a,o){const l=!!o&&le(o),u=[];for(const f of a.tiles||[])mn(f)?u.push(this.canonicalizeTileURL(f,l)):u.push(f);return u}_makeAPIURL(a,o){const l="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",u=Wn(Ge.API_URL);if(a.protocol=u.protocol,a.authority=u.authority,"http"===a.protocol){const f=a.params.indexOf("secure");f>=0&&a.params.splice(f,1)}if("/"!==u.path&&(a.path=`${u.path}${a.path}`),!Ge.REQUIRE_ACCESS_TOKEN)return Zr(a);if(o=o||Ge.ACCESS_TOKEN,!this._silenceAuthErrors){if(!o)throw new Error(`An API access token is required to use Mapbox GL. ${l}`);if("s"===o[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${l}`)}return a.params=a.params.filter(f=>-1===f.indexOf("access_token")),a.params.push(`access_token=${o||""}`),Zr(a)}},p.ResourceType=Xr,p.SegmentVector=fo,p.SourceCache=Rd,p.StencilMode=W_,p.StructArrayLayout1ui2=nf,p.StructArrayLayout2f1f2i16=Ns,p.StructArrayLayout2i4=bi,p.StructArrayLayout2ui4=sl,p.StructArrayLayout3f12=Vr,p.StructArrayLayout3ui6=Co,p.StructArrayLayout4i8=pr,p.StructArrayLayout5f20=fa,p.Texture=ap,p.Tile=_g,p.Transitionable=it,p.Uniform1f=Oc,p.Uniform1i=class extends kl{constructor(a){super(a),this.current=0}set(a,o,l){this.fetchUniformLocation(a,o)&&this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}},p.Uniform2f=class extends kl{constructor(a){super(a),this.current=[0,0]}set(a,o,l){this.fetchUniformLocation(a,o)&&(l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1])))}},p.Uniform3f=class extends kl{constructor(a){super(a),this.current=[0,0,0]}set(a,o,l){this.fetchUniformLocation(a,o)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2])))}},p.Uniform4f=TS,p.UniformColor=Sb,p.UniformMatrix2f=class extends kl{constructor(a){super(a),this.current=IS}set(a,o,l){if(this.fetchUniformLocation(a,o))for(let u=0;u<4;u++)if(l[u]!==this.current[u]){this.current=l,this.gl.uniformMatrix2fv(this.location,!1,l);break}}},p.UniformMatrix3f=class extends kl{constructor(a){super(a),this.current=ES}set(a,o,l){if(this.fetchUniformLocation(a,o))for(let u=0;u<9;u++)if(l[u]!==this.current[u]){this.current=l,this.gl.uniformMatrix3fv(this.location,!1,l);break}}},p.UniformMatrix4f=class extends kl{constructor(a){super(a),this.current=DS}set(a,o,l){if(this.fetchUniformLocation(a,o)){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let u=1;u<16;u++)if(l[u]!==this.current[u]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}}},p.UnwrappedTileID=Xv,p.ValidationError=Kt,p.VectorTileFeature=Uh,p.VectorTileWorkerSource=class extends xl{constructor(a,o,l,u,f){super(),this.actor=a,this.layerIndex=o,this.availableImages=l,this.loadVectorData=f||U0,this.loading={},this.loaded={},this.deduped=new Sg(a.scheduler),this.isSpriteLoaded=u,this.scheduler=a.scheduler}loadTile(a,o){const l=a.uid,u=a&&a.request,f=u&&u.collectResourceTiming,b=this.loading[l]=new k1(a);b.abort=this.loadVectorData(a,(y,S)=>{const T=!this.loading[l];if(delete this.loading[l],T||y||!S)return b.status="done",T||(this.loaded[l]=b),o(y);const E=S.rawData,M={};S.expires&&(M.expires=S.expires),S.cacheControl&&(M.cacheControl=S.cacheControl),b.vectorTile=S.vectorTile||new Ym(new ea(E));const P=()=>{b.parse(b.vectorTile,this.layerIndex,this.availableImages,this.actor,(O,B)=>{if(O||!B)return o(O);const V={};if(f){const G=Ln(u);G.length>0&&(V.resourceTiming=JSON.parse(JSON.stringify(G)))}o(null,en({rawTileData:E.slice(0)},B,M,V))})};this.isSpriteLoaded?P():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(P,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom}):P()}),this.loaded=this.loaded||{},this.loaded[l]=b})}reloadTile(a,o){const l=this.loaded,u=a.uid,f=this;if(l&&l[u]){const b=l[u];b.showCollisionBoxes=a.showCollisionBoxes,b.enableTerrain=!!a.enableTerrain,b.projection=a.projection,b.tileTransform=qc(a.tileID.canonical,a.projection);const y=(S,T)=>{const E=b.reloadCallback;E&&(delete b.reloadCallback,b.parse(b.vectorTile,f.layerIndex,this.availableImages,f.actor,E)),o(S,T)};"parsing"===b.status?b.reloadCallback=y:"done"===b.status&&(b.vectorTile?b.parse(b.vectorTile,this.layerIndex,this.availableImages,this.actor,y):y())}}abortTile(a,o){const l=a.uid,u=this.loading[l];u&&(u.abort&&u.abort(),delete this.loading[l]),o()}removeTile(a,o){const l=this.loaded,u=a.uid;l&&l[u]&&delete l[u],o()}},p.WritingMode=ta,p.ZoomHistory=Mc,p.add=Nc,p.addDynamicAttributes=F_,p.adjoint=function(a,o){var l=o[0],u=o[1],f=o[2],b=o[3],y=o[4],S=o[5],T=o[6],E=o[7],M=o[8];return a[0]=y*M-S*E,a[1]=f*E-u*M,a[2]=u*S-f*y,a[3]=S*T-b*M,a[4]=l*M-f*T,a[5]=f*b-l*S,a[6]=b*E-y*T,a[7]=u*T-l*E,a[8]=l*y-u*b,a},p.asyncAll=Un,p.bezier=pe,p.bindAll=Rs,p.boundsAttributes=F0,p.bufferConvexPolygon=function(a,o){const l=[];for(let u=0;u<a.length;u++){const f=wn(u-1,-1,a.length-1),b=wn(u+1,-1,a.length-1),y=a[u],S=a[b],T=a[f].sub(y).unit(),E=S.sub(y).unit(),M=E.angleWithSep(T.x,T.y),P=T.add(E).unit().mult(-1*o/Math.sin(M/2));l.push(y.add(P))}return l},p.cacheEntryPossiblyAdded=function(a){Wo++,Wo>qo&&(a.getActor().send("enforceCacheSizeLimit",ys),Wo=0)},p.calculateGlobeLabelMatrix=function(a,o){const{x:l,y:u}=a.point,f=ul(l,u,a.worldSize/a._pixelsPerMercatorPixel,0,0);return Fh(f,f,rp(Hc(o)))},p.calculateGlobeMatrix=function(a){const{x:o,y:l}=a.point,{lng:u,lat:f}=a._center;return ul(o,l,a.worldSize,u,f)},p.calculateGlobeMercatorMatrix=function(a){const o=a.pixelsPerMeter,l=o/Fa(1,a.center.lat),u=ic(new Float64Array(16));return df(u,u,[a.point.x,a.point.y,0]),_d(u,u,[l,l,o]),Float32Array.from(u)},p.circumferenceAtLatitude=Db,p.clamp=Ke,p.clearTileCache=function(a){if(!vs())return;const o=me.caches.delete(pn);a&&o.catch(a).then(()=>a())},p.clipLine=b0,p.clone=function(a){var o=new Ks(16);return o[0]=a[0],o[1]=a[1],o[2]=a[2],o[3]=a[3],o[4]=a[4],o[5]=a[5],o[6]=a[6],o[7]=a[7],o[8]=a[8],o[9]=a[9],o[10]=a[10],o[11]=a[11],o[12]=a[12],o[13]=a[13],o[14]=a[14],o[15]=a[15],o},p.clone$1=Jt,p.collisionCircleLayout=s1,p.config=Ge,p.conjugate=function(a,o){return a[0]=-o[0],a[1]=-o[1],a[2]=-o[2],a[3]=o[3],a},p.create=function(){var a=new Ks(16);return Ks!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},p.create$1=Pb,p.createExpression=Kl,p.createLayout=Nt,p.createStyleLayer=function(a){return"custom"===a.type?new R0(a):new Mu[a.type](a)},p.cross=vd,p.degToRad=Ae,p.distance=function(a,o){return Math.hypot(o[0]-a[0],o[1]-a[1],o[2]-a[2])},p.div=function(a,o,l){return a[0]=o[0]/l[0],a[1]=o[1]/l[1],a[2]=o[2]/l[2],a},p.dot=Ao,p.earthRadius=_u,p.ease=et,p.easeCubicInOut=at,p.ecefToLatLng=function([a,o,l]){const u=Math.hypot(a,o,l),f=Math.atan2(a,l),b=.5*Math.PI-Math.acos(-o/u);return new Xi(ee(f),ee(b))},p.emitValidationErrors=cd,p.endsWith=Eo,p.enforceCacheSizeLimit=function(a){On(),Wr&&Wr.then(o=>{o.keys().then(l=>{for(let u=0;u<l.length-a;u++)o.delete(l[u])})})},p.evaluateSizeForFeature=Df,p.evaluateSizeForZoom=Ef,p.evaluateVariableOffset=w_,p.evented=se,p.exactEquals=function(a,o){return a[0]===o[0]&&a[1]===o[1]&&a[2]===o[2]&&a[3]===o[3]},p.exactEquals$1=function(a,o){return a[0]===o[0]&&a[1]===o[1]&&a[2]===o[2]},p.exported=qi,p.exported$1=Ye,p.extend=en,p.extend$1=Ka,p.fillExtrusionHeightLift=qv,p.filterObject=Tt,p.fromMat4=function(a,o){return a[0]=o[0],a[1]=o[1],a[2]=o[2],a[3]=o[4],a[4]=o[5],a[5]=o[6],a[6]=o[8],a[7]=o[9],a[8]=o[10],a},p.fromQuat=function(a,o){var l=o[0],u=o[1],f=o[2],b=o[3],y=l+l,S=u+u,T=f+f,E=l*y,M=u*y,P=u*S,O=f*y,B=f*S,V=f*T,G=b*y,Z=b*S,ce=b*T;return a[0]=1-P-V,a[1]=M+ce,a[2]=O-Z,a[3]=0,a[4]=M-ce,a[5]=1-E-V,a[6]=B+G,a[7]=0,a[8]=O+Z,a[9]=B-G,a[10]=1-E-P,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},p.fromRotation=function(a,o){var l=Math.sin(o),u=Math.cos(o);return a[0]=u,a[1]=l,a[2]=0,a[3]=-l,a[4]=u,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},p.fromScaling=Mv,p.furthestTileCorner=function(a){const o=Math.round((a+45+360)%360/90)%4;return nt[o]},p.getAABBPointSquareDist=function(a,o,l){let u=0;for(let f=0;f<2;++f){const b=l?l[f]:0;a[f]>b&&(u+=(a[f]-b)*(a[f]-b)),o[f]<b&&(u+=(b-o[f])*(b-o[f]))}return u},p.getAnchorAlignment=b_,p.getAnchorJustification=S_,p.getBounds=function(a){let o=1/0,l=1/0,u=-1/0,f=-1/0;for(const b of a)o=Math.min(o,b.x),l=Math.min(l,b.y),u=Math.max(u,b.x),f=Math.max(f,b.y);return{min:new mt(o,l),max:new mt(u,f)}},p.getColumn=vl,p.getGridMatrix=function(a,o,l,u){const f=o.getNorth(),b=o.getSouth(),y=o.getWest(),S=o.getEast(),T=1<<a.z,E=S-y,M=f-b,P=E/64,O=-M/Pf[l],B=[0,P,0,O,0,0,f,y,0];if(a.z>0){const V=180/u;xu(B,B,[V/E+1,0,0,0,V/M+1,0,-.5*V/P,.5*V/O,1])}return B[2]=T,B[5]=a.x,B[8]=a.y,B},p.getImage=Oe,p.getJSON=function(a,o){return hi(en(a,{type:"json"}),o)},p.getLatitudinalLod=function(a){const o=80.051129;a=Ke(a,-80.051129,o)/o*90;const l=Math.pow(Math.abs(Math.sin(Ae(a))),3);return Math.round(l*(Pf.length-1))},p.getMapSessionAPI=de,p.getPerformanceMeasurement=Ln,p.getProjection=mg,p.getRTLTextPluginStatus=J,p.getReferrer=ca,p.getTilePoint=function(a,{x:o,y:l},u=0){return new mt(((o-u)*a.scale-a.x)*Mn,(l*a.scale-a.y)*Mn)},p.getTileVec3=function(a,o,l=0){return yd(((o.x-l)*a.scale-a.x)*Mn,(o.y*a.scale-a.y)*Mn,Eb(o.z,o.y))},p.getVideo=function(a,o){const l=me.document.createElement("video");l.muted=!0,l.onloadstart=function(){o(null,l)};for(let u=0;u<a.length;u++){const f=me.document.createElement("source");_c(a[u])||(l.crossOrigin="Anonymous"),f.src=a[u],l.appendChild(f)}return{cancel:()=>{}}},p.globeCenterToScreenPoint=function(a){const o=[0,0,0],l=ic(new Float64Array(16));return Fh(l,a.pixelMatrix,a.globeMatrix),mo(o,o,l),new mt(o[0],o[1])},p.globeDenormalizeECEF=rp,p.globeECEFOrigin=function(a,o){const l=[0,0,0];return mo(l,l,ip(Hc(o.canonical))),mo(l,l,a),l},p.globeNormalizeECEF=ip,p.globePixelsToTileUnits=function(a,o){return Mn/(512*Math.pow(2,a))*hg(Hc(o))},p.globePoleMatrixForTile=function(a,o,l){const u=ic(new Float64Array(16)),f=(o/(1<<a)-.5)*Math.PI*2;return Na(u,l.globeMatrix,f),Float32Array.from(u)},p.globeTileBounds=Hc,p.globeTiltAtLngLat=E0,p.globeToMercatorTransition=Ed,p.globeUseCustomAntiAliasing=function(a,o,l){const u=Ed(l.zoom),f=a.style.map._antialias,b=!!o.extStandardDerivatives,y=o.extStandardDerivativesForceOff||a.terrain&&a.terrain.exaggeration()>0;return 0===u&&!f&&!y&&b},p.identity=ic,p.identity$1=NS,p.invert=Ob,p.isFullscreen=function(){return!!me.document.fullscreenElement||!!me.document.webkitFullscreenElement},p.isLngLatBehindGlobe=function(a,o){return E0(a,o)>Math.PI/2*1.01},p.isMapAuthenticated=function(a){return be.has(a)},p.isMapboxURL=le,p.isSafariWithAntialiasingBug=function(a){const o=a.navigator?a.navigator.userAgent:null;return!!In(a)&&o&&(o.match("Version/15.4")||o.match("Version/15.5")||o.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},p.latFromMercatorY=us,p.latLngToECEF=Dd,p.len=kE,p.length=hf,p.length$1=function(a){return Math.hypot(a[0],a[1],a[2],a[3])},p.lngFromMercatorX=Ts,p.loadVectorTile=U0,p.makeRequest=hi,p.mapValue=function(a,o,l,u,f){return Ke((a-o)/(l-o)*(f-u)+u,u,f)},p.mercatorScale=sf,p.mercatorXfromLng=ll,p.mercatorYfromLat=Cs,p.mercatorZfromAltitude=Fa,p.mul=LS,p.mul$1=AE,p.multiply=Fh,p.multiply$1=xu,p.multiply$2=Rv,p.nextPowerOfTwo=ni,p.normalize=Ds,p.normalize$1=BS,p.normalize$2=Hm,p.number=zi,p.ortho=function(a,o,l,u,f,b,y){var S=1/(o-l),T=1/(u-f),E=1/(b-y);return a[0]=-2*S,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*T,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*E,a[11]=0,a[12]=(o+l)*S,a[13]=(f+u)*T,a[14]=(y+b)*E,a[15]=1,a},p.pbf=ea,p.perspective=function(a,o,l,u,f){var b,y=1/Math.tan(o/2);return a[0]=y/l,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=y,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,null!=f&&f!==1/0?(a[10]=(f+u)*(b=1/(u-f)),a[14]=2*f*u*b):(a[10]=-1,a[14]=-2*u),a},p.pick=function(a,o){const l={};for(let u=0;u<o.length;u++){const f=o[u];f in a&&(l[f]=a[f])}return l},p.plugin=ve,p.pointGeometry=mt,p.polygonContainsPoint=vu,p.polygonIntersectsBox=cf,p.polygonIntersectsPolygon=lf,p.polygonizeBounds=function(a,o,l=0,u=!0){const f=new mt(l,l),b=a.sub(f),y=o.add(f),S=[b,new mt(y.x,b.y),y,new mt(b.x,y.y)];return u&&S.push(b.clone()),S},p.posAttributes=Cd,p.postMapLoadEvent=oe,p.postPerformanceEvent=Te,p.postTurnstileEvent=U,p.potpack=p_,p.prevPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.floor(Math.log(a)/Math.LN2))},p.radToDeg=ee,p.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],p.registerForPluginStateChange=function(a){return a({pluginStatus:Q,pluginURL:ne}),se.on("pluginStateChange",a),a},p.removeAuthState=function(a){be.delete(a)},p.renderColorRamp=Gb,p.resample=yv,p.rotateX=Js,p.rotateX$1=Bb,p.rotateY=Na,p.rotateY$1=Pv,p.rotateZ=function(a,o,l){var u=Math.sin(l),f=Math.cos(l),b=o[0],y=o[1],S=o[2],T=o[3],E=o[4],M=o[5],P=o[6],O=o[7];return o!==a&&(a[8]=o[8],a[9]=o[9],a[10]=o[10],a[11]=o[11],a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15]),a[0]=b*f+E*u,a[1]=y*f+M*u,a[2]=S*f+P*u,a[3]=T*f+O*u,a[4]=E*f-b*u,a[5]=M*f-y*u,a[6]=P*f-S*u,a[7]=O*f-T*u,a},p.rotateZ$1=function(a,o,l){l*=.5;var u=o[0],f=o[1],b=o[2],y=o[3],S=Math.sin(l),T=Math.cos(l);return a[0]=u*T+f*S,a[1]=f*T-u*S,a[2]=b*T+y*S,a[3]=y*T-b*S,a},p.scale=_d,p.scale$1=Um,p.scale$2=Ba,p.scaleAndAdd=Bc,p.set=function(a,o,l,u){return a[0]=o,a[1]=l,a[2]=u,a},p.setCacheLimits=function(a,o){ys=a,qo=o},p.setColumn=function(a,o,l){a[4*o+0]=l[0],a[4*o+1]=l[1],a[4*o+2]=l[2],a[4*o+3]=l[3]},p.setRTLTextPlugin=function(a,o,l=!1){if(Q===N||Q===H||Q===X)throw new Error("setRTLTextPlugin cannot be called multiple times.");ne=qi.resolveURL(a),Q=N,te=o,Y(),l||_e()},p.smoothstep=sn,p.spec=ct,p.squaredLength=function(a){var o=a[0],l=a[1],u=a[2];return o*o+l*l+u*u},p.storeAuthState=function(a,o){o?be.add(a):be.delete(a)},p.sub=rc,p.subtract=Fb,p.symbolSize=t0,p.tileAABB=function(a,o,l,u,f,b,y,S,T){if("globe"===T.name)return function jE(a,o,l){const u=o/a.worldSize,f=a.globeMatrix;if(l.z<=1){const Ze=Hc(l).getCorners();return v1(Ze,f,u),Zo.fromPoints(Ze)}const b=I_(l),y=D0(b);v1(y,f,u);const S=Number.MAX_VALUE,T=[-S,-S,-S],E=[S,S,S];if(b.contains(a.center)){for(const Mt of y)pf(E,E,Mt),jm(T,T,Mt);T[2]=0;const Ze=a.point,lt=[Ze.x*u,Ze.y*u,0];return pf(E,E,lt),jm(T,T,lt),new Zo(E,T)}const M=[f[12]*u,f[13]*u,f[14]*u],P=b.getCenter(),O=Ke(a.center.lat,-85.051129,_a),B=Ke(P.lat,-85.051129,_a),V=ll(a.center.lng),G=Cs(O);let Z=V-ll(P.lng);const ce=G-Cs(B);Z>.5?Z-=1:Z<-.5&&(Z+=1);let ye=0;Math.abs(Z)>Math.abs(ce)?ye=Z>=0?1:3:(ye=ce>=0?0:2,Bc(M,M,[f[4]*u,f[5]*u,f[6]*u],-Math.sin(Ae(ce>=0?b.getSouth():b.getNorth()))*Du));const ue=y[ye],ge=y[(ye+1)%4],De=new E_(ue,ge,M),xe=[T0(De,0)||ue[0],T0(De,1)||ue[1],T0(De,2)||ue[2]],tt=Ed(a.zoom);if(tt>0){const Ze=function({x:Mt,y:ot,z:_t},yt,Ct,Rt,pt){const nn=1/(1<<_t);let ut=Mt*nn,vn=ut+nn,hn=ot*nn,Yt=hn+nn,Zn=0;const fi=(ut+vn)/2-Rt;return fi>.5?Zn=-1:fi<-.5&&(Zn=1),ut=((ut+Zn)*yt-(Rt*=yt))*Ct+Rt,vn=((vn+Zn)*yt-Rt)*Ct+Rt,hn=(hn*yt-(pt*=yt))*Ct+pt,Yt=(Yt*yt-pt)*Ct+pt,[[ut,Yt,0],[vn,Yt,0],[vn,hn,0],[ut,hn,0]]}(l,o,a._pixelsPerMercatorPixel,V,G);for(let Mt=0;Mt<y.length;Mt++)$c(y[Mt],Ze[Mt],tt);const lt=Nc([],Ze[ye],Ze[(ye+1)%4]);Ba(lt,lt,.5),$c(xe,lt,tt)}for(const Ze of y)pf(E,E,Ze),jm(T,T,Ze);return E[2]=Math.min(ue[2],ge[2]),pf(E,E,xe),jm(T,T,xe),new Zo(E,T)}(a,o,new Jm(l,u,f));const E=qc({z:l,x:u,y:f},T);return new Zo([(b+E.x/E.scale)*o,o*(E.y/E.scale),y],[(b+E.x2/E.scale)*o,o*(E.y2/E.scale),S])},p.tileCornersToBounds=I_,p.tileTransform=qc,p.transformMat3=function(a,o,l){var u=o[0],f=o[1],b=o[2];return a[0]=u*l[0]+f*l[3]+b*l[6],a[1]=u*l[1]+f*l[4]+b*l[7],a[2]=u*l[2]+f*l[5]+b*l[8],a},p.transformMat4=mo,p.transformMat4$1=zc,p.transformQuat=Nb,p.transitionTileAABBinECEF=y1,p.translate=df,p.transpose=function(a,o){if(a===o){var l=o[1],u=o[2],f=o[5];a[1]=o[3],a[2]=o[6],a[3]=l,a[5]=o[7],a[6]=u,a[7]=f}else a[0]=o[0],a[1]=o[3],a[2]=o[6],a[3]=o[1],a[4]=o[4],a[5]=o[7],a[6]=o[2],a[7]=o[5],a[8]=o[8];return a},p.triggerPluginCompletionEvent=K,p.uniqueId=nr,p.updateGlobeVertexNormal=function(a,o,l,u,f){const b=5*o+2;a.float32[b+0]=l,a.float32[b+1]=u,a.float32[b+2]=f},p.validateCustomStyleLayer=function(a){const o=[],l=a.id;return void 0===l&&o.push({message:`layers.${l}: missing required property "id"`}),void 0===a.render&&o.push({message:`layers.${l}: missing required method "render"`}),a.renderingMode&&"2d"!==a.renderingMode&&"3d"!==a.renderingMode&&o.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),o},p.validateFilter=a=>Fo(gu(a)),p.validateFog=a=>Fo(Ot(a)),p.validateLayer=a=>Fo(Zp(a)),p.validateLight=a=>Fo(ad(a)),p.validateSource=a=>Fo(sd(a)),p.validateStyle=So,p.validateTerrain=a=>Fo(Yp(a)),p.values=Fi,p.vectorTile=Qb,p.version=Et,p.warnOnce=Ni,p.window=me,p.wrap=wn}),Ue(0,function(p){function me(re){if("number"==typeof re||"boolean"==typeof re||"string"==typeof re||null==re)return JSON.stringify(re);if(Array.isArray(re)){let q="[";for(const oe of re)q+=`${me(oe)},`;return`${q}]`}let U="{";for(const q of Object.keys(re).sort())U+=`${q}:${me(re[q])},`;return`${U}}`}function Et(re){let U="";for(const q of p.refProperties)U+=`/${me(re[q])}`;return U}class $e{constructor(U){this.keyCache={},U&&this.replace(U)}replace(U){this._layerConfigs={},this._layers={},this.update(U,[])}update(U,q){for(const fe of U)this._layerConfigs[fe.id]=fe,(this._layers[fe.id]=p.createStyleLayer(fe)).compileFilter(),this.keyCache[fe.id]&&delete this.keyCache[fe.id];for(const fe of q)delete this.keyCache[fe],delete this._layerConfigs[fe],delete this._layers[fe];this.familiesBySource={};const oe=function(fe,Te){const je={};for(let be=0;be<fe.length;be++){const ke=Te&&Te[fe[be].id]||Et(fe[be]);Te&&(Te[fe[be].id]=ke);let ht=je[ke];ht||(ht=je[ke]=[]),ht.push(fe[be])}const de=[];for(const be in je)de.push(je[be]);return de}(p.values(this._layerConfigs),this.keyCache);for(const fe of oe){const Te=fe.map(Vt=>this._layers[Vt.id]),je=Te[0];if("none"===je.visibility)continue;const de=je.source||"";let be=this.familiesBySource[de];be||(be=this.familiesBySource[de]={});const ke=je.sourceLayer||"_geojsonTileLayer";let ht=be[ke];ht||(ht=be[ke]=[]),ht.push(Te)}}}class Ge{loadTile(U,q){const{uid:oe,encoding:fe,rawImageData:Te,padding:je,buildQuadTree:de}=U,be=p.window.ImageBitmap&&Te instanceof p.window.ImageBitmap?this.getImageData(Te,je):Te;q(null,new p.DEMData(oe,be,fe,je<1,de))}getImageData(U,q){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(U.width,U.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=U.width,this.offscreenCanvas.height=U.height,this.offscreenCanvasContext.drawImage(U,0,0,U.width,U.height);const oe=this.offscreenCanvasContext.getImageData(-q,-q,U.width+2*q,U.height+2*q);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),oe}}var Ye=function re(U,q){var oe,fe=U&&U.type;if("FeatureCollection"===fe)for(oe=0;oe<U.features.length;oe++)re(U.features[oe],q);else if("GeometryCollection"===fe)for(oe=0;oe<U.geometries.length;oe++)re(U.geometries[oe],q);else if("Feature"===fe)re(U.geometry,q);else if("Polygon"===fe)Ft(U.coordinates,q);else if("MultiPolygon"===fe)for(oe=0;oe<U.coordinates.length;oe++)Ft(U.coordinates[oe],q);return U};function Ft(re,U){if(0!==re.length){kt(re[0],U);for(var q=1;q<re.length;q++)kt(re[q],!U)}}function kt(re,U){for(var q=0,oe=0,fe=0,Te=re.length,je=Te-1;fe<Te;je=fe++){var de=(re[fe][0]-re[je][0])*(re[je][1]+re[fe][1]),be=q+de;oe+=Math.abs(q)>=Math.abs(de)?q-be+de:de-be+q,q=be}q+oe>=0!=!!U&&re.reverse()}const Xe=p.VectorTileFeature.prototype.toGeoJSON;class St{constructor(U){this._feature=U,this.extent=p.EXTENT,this.type=U.type,this.properties=U.tags,"id"in U&&!isNaN(U.id)&&(this.id=parseInt(U.id,10))}loadGeometry(){if(1===this._feature.type){const U=[];for(const q of this._feature.geometry)U.push([new p.pointGeometry(q[0],q[1])]);return U}{const U=[];for(const q of this._feature.geometry){const oe=[];for(const fe of q)oe.push(new p.pointGeometry(fe[0],fe[1]));U.push(oe)}return U}}toGeoJSON(U,q,oe){return Xe.call(this,U,q,oe)}}class $t{constructor(U){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=p.EXTENT,this.length=U.length,this._features=U}feature(U){return new St(this._features[U])}}var dn={exports:{}},Ne=p.pointGeometry,jn=p.vectorTile.VectorTileFeature,mt=gi;function gi(re,U){this.options=U||{},this.features=re,this.length=re.length}function Ie(re,U){this.id="number"==typeof re.id?re.id:void 0,this.type=re.type,this.rawGeometry=1===re.type?[re.geometry]:re.geometry,this.properties=re.tags,this.extent=U||4096}gi.prototype.feature=function(re){return new Ie(this.features[re],this.options.extent)},Ie.prototype.loadGeometry=function(){var re=this.rawGeometry;this.geometry=[];for(var U=0;U<re.length;U++){for(var q=re[U],oe=[],fe=0;fe<q.length;fe++)oe.push(new Ne(q[fe][0],q[fe][1]));this.geometry.push(oe)}return this.geometry},Ie.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var re=this.geometry,U=1/0,q=-1/0,oe=1/0,fe=-1/0,Te=0;Te<re.length;Te++)for(var je=re[Te],de=0;de<je.length;de++){var be=je[de];U=Math.min(U,be.x),q=Math.max(q,be.x),oe=Math.min(oe,be.y),fe=Math.max(fe,be.y)}return[U,oe,q,fe]},Ie.prototype.toGeoJSON=jn.prototype.toGeoJSON;var Se=p.pbf,Ae=mt;function ee(re){var U=new Se;return function(q,oe){for(var fe in q.layers)oe.writeMessage(3,nt,q.layers[fe])}(re,U),U.finish()}function nt(re,U){var q;U.writeVarintField(15,re.version||1),U.writeStringField(1,re.name||""),U.writeVarintField(5,re.extent||4096);var oe={keys:[],values:[],keycache:{},valuecache:{}};for(q=0;q<re.length;q++)oe.feature=re.feature(q),U.writeMessage(2,at,oe);var fe=oe.keys;for(q=0;q<fe.length;q++)U.writeStringField(3,fe[q]);var Te=oe.values;for(q=0;q<Te.length;q++)U.writeMessage(4,wn,Te[q])}function at(re,U){var q=re.feature;void 0!==q.id&&U.writeVarintField(1,q.id),U.writeMessage(2,pe,re),U.writeVarintField(3,q.type),U.writeMessage(4,sn,q)}function pe(re,U){var q=re.feature,oe=re.keys,fe=re.values,Te=re.keycache,je=re.valuecache;for(var de in q.properties){var be=q.properties[de],ke=Te[de];if(null!==be){void 0===ke&&(oe.push(de),Te[de]=ke=oe.length-1),U.writeVarint(ke);var ht=typeof be;"string"!==ht&&"boolean"!==ht&&"number"!==ht&&(be=JSON.stringify(be));var Vt=ht+":"+be,At=je[Vt];void 0===At&&(fe.push(be),je[Vt]=At=fe.length-1),U.writeVarint(At)}}}function et(re,U){return(U<<3)+(7&re)}function Ke(re){return re<<1^re>>31}function sn(re,U){for(var q=re.loadGeometry(),oe=re.type,fe=0,Te=0,je=q.length,de=0;de<je;de++){var be=q[de],ke=1;1===oe&&(ke=be.length),U.writeVarint(et(1,ke));for(var ht=3===oe?be.length-1:be.length,Vt=0;Vt<ht;Vt++){1===Vt&&1!==oe&&U.writeVarint(et(2,ht-1));var At=be[Vt].x-fe,Ln=be[Vt].y-Te;U.writeVarint(Ke(At)),U.writeVarint(Ke(Ln)),fe+=At,Te+=Ln}3===oe&&U.writeVarint(et(7,1))}}function wn(re,U){var q=typeof re;"string"===q?U.writeStringField(1,re):"boolean"===q?U.writeBooleanField(7,re):"number"===q&&(re%1!=0?U.writeDoubleField(3,re):re<0?U.writeSVarintField(6,re):U.writeVarintField(5,re))}function Un(re,U,q,oe,fe,Te){if(fe-oe<=q)return;const je=oe+fe>>1;Fi(re,U,je,oe,fe,Te%2),Un(re,U,q,oe,je-1,Te+1),Un(re,U,q,je+1,fe,Te+1)}function Fi(re,U,q,oe,fe,Te){for(;fe>oe;){if(fe-oe>600){const ke=fe-oe+1,ht=q-oe+1,Vt=Math.log(ke),At=.5*Math.exp(2*Vt/3),Ln=.5*Math.sqrt(Vt*At*(ke-At)/ke)*(ht-ke/2<0?-1:1);Fi(re,U,q,Math.max(oe,Math.floor(q-ht*At/ke+Ln)),Math.min(fe,Math.floor(q+(ke-ht)*At/ke+Ln)),Te)}const je=U[2*q+Te];let de=oe,be=fe;for(en(re,U,oe,q),U[2*fe+Te]>je&&en(re,U,oe,fe);de<be;){for(en(re,U,de,be),de++,be--;U[2*de+Te]<je;)de++;for(;U[2*be+Te]>je;)be--}U[2*oe+Te]===je?en(re,U,oe,be):(be++,en(re,U,be,fe)),be<=q&&(oe=be+1),q<=be&&(fe=be-1)}}function en(re,U,q,oe){ti(re,q,oe),ti(U,2*q,2*oe),ti(U,2*q+1,2*oe+1)}function ti(re,U,q){const oe=re[U];re[U]=re[q],re[q]=oe}function nr(re,U,q,oe){const fe=re-q,Te=U-oe;return fe*fe+Te*Te}dn.exports=ee,dn.exports.fromVectorTileJs=ee,dn.exports.fromGeojsonVt=function(re,U){U=U||{};var q={};for(var oe in re)q[oe]=new Ae(re[oe].features,U),q[oe].name=oe,q[oe].version=U.version,q[oe].extent=U.extent;return ee({layers:q})},dn.exports.GeoJSONWrapper=Ae;const qr=re=>re[0],ni=re=>re[1];class Qt{constructor(U,q=qr,oe=ni,fe=64,Te=Float64Array){this.nodeSize=fe,this.points=U;const je=U.length<65536?Uint16Array:Uint32Array,de=this.ids=new je(U.length),be=this.coords=new Te(2*U.length);for(let ke=0;ke<U.length;ke++)de[ke]=ke,be[2*ke]=q(U[ke]),be[2*ke+1]=oe(U[ke]);Un(de,be,fe,0,de.length-1,0)}range(U,q,oe,fe){return function(Te,je,de,be,ke,ht,Vt){const At=[0,Te.length-1,0],Ln=[];let An,Dn;for(;At.length;){const Xn=At.pop(),pi=At.pop(),qi=At.pop();if(pi-qi<=Vt){for(let _r=qi;_r<=pi;_r++)An=je[2*_r],Dn=je[2*_r+1],An>=de&&An<=ke&&Dn>=be&&Dn<=ht&&Ln.push(Te[_r]);continue}const $n=Math.floor((qi+pi)/2);An=je[2*$n],Dn=je[2*$n+1],An>=de&&An<=ke&&Dn>=be&&Dn<=ht&&Ln.push(Te[$n]);const lr=(Xn+1)%2;(0===Xn?de<=An:be<=Dn)&&(At.push(qi),At.push($n-1),At.push(lr)),(0===Xn?ke>=An:ht>=Dn)&&(At.push($n+1),At.push(pi),At.push(lr))}return Ln}(this.ids,this.coords,U,q,oe,fe,this.nodeSize)}within(U,q,oe){return function(fe,Te,je,de,be,ke){const ht=[0,fe.length-1,0],Vt=[],At=be*be;for(;ht.length;){const Ln=ht.pop(),An=ht.pop(),Dn=ht.pop();if(An-Dn<=ke){for(let lr=Dn;lr<=An;lr++)nr(Te[2*lr],Te[2*lr+1],je,de)<=At&&Vt.push(fe[lr]);continue}const Xn=Math.floor((Dn+An)/2),pi=Te[2*Xn],qi=Te[2*Xn+1];nr(pi,qi,je,de)<=At&&Vt.push(fe[Xn]);const $n=(Ln+1)%2;(0===Ln?je-be<=pi:de-be<=qi)&&(ht.push(Dn),ht.push(Xn-1),ht.push($n)),(0===Ln?je+be>=pi:de+be>=qi)&&(ht.push(Xn+1),ht.push(An),ht.push($n))}return Vt}(this.ids,this.coords,U,q,oe,this.nodeSize)}}const Rs={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:re=>re},Eo=Math.fround||(di=new Float32Array(1),re=>(di[0]=+re,di[0]));var di;class Tt{constructor(U){this.options=Ya(Object.create(Rs),U),this.trees=new Array(this.options.maxZoom+1)}load(U){const{log:q,minZoom:oe,maxZoom:fe,nodeSize:Te}=this.options;q&&console.time("total time");const je=`prepare ${U.length} points`;q&&console.time(je),this.points=U;let de=[];for(let be=0;be<U.length;be++)U[be].geometry&&de.push(Hn(U[be],be));this.trees[fe+1]=new Qt(de,In,_o,Te,Float32Array),q&&console.timeEnd(je);for(let be=fe;be>=oe;be--){const ke=+Date.now();de=this._cluster(de,be),this.trees[be]=new Qt(de,In,_o,Te,Float32Array),q&&console.log("z%d: %d clusters in %dms",be,de.length,+Date.now()-ke)}return q&&console.timeEnd("total time"),this}getClusters(U,q){let oe=((U[0]+180)%360+360)%360-180;const fe=Math.max(-90,Math.min(90,U[1]));let Te=180===U[2]?180:((U[2]+180)%360+360)%360-180;const je=Math.max(-90,Math.min(90,U[3]));if(U[2]-U[0]>=360)oe=-180,Te=180;else if(oe>Te){const ht=this.getClusters([oe,fe,180,je],q),Vt=this.getClusters([-180,fe,Te,je],q);return ht.concat(Vt)}const de=this.trees[this._limitZoom(q)],be=de.range(zt(oe),Sn(je),zt(Te),Sn(fe)),ke=[];for(const ht of be){const Vt=de.points[ht];ke.push(Vt.numPoints?Ni(Vt):this.points[Vt.index])}return ke}getChildren(U){const q=this._getOriginId(U),oe=this._getOriginZoom(U),fe="No cluster with the specified id.",Te=this.trees[oe];if(!Te)throw new Error(fe);const je=Te.points[q];if(!je)throw new Error(fe);const de=this.options.radius/(this.options.extent*Math.pow(2,oe-1)),be=Te.within(je.x,je.y,de),ke=[];for(const ht of be){const Vt=Te.points[ht];Vt.parentId===U&&ke.push(Vt.numPoints?Ni(Vt):this.points[Vt.index])}if(0===ke.length)throw new Error(fe);return ke}getLeaves(U,q,oe){const fe=[];return this._appendLeaves(fe,U,q=q||10,oe=oe||0,0),fe}getTile(U,q,oe){const fe=this.trees[this._limitZoom(U)],Te=Math.pow(2,U),{extent:je,radius:de}=this.options,be=de/je,ke=(oe-be)/Te,ht=(oe+1+be)/Te,Vt={features:[]};return this._addTileFeatures(fe.range((q-be)/Te,ke,(q+1+be)/Te,ht),fe.points,q,oe,Te,Vt),0===q&&this._addTileFeatures(fe.range(1-be/Te,ke,1,ht),fe.points,Te,oe,Te,Vt),q===Te-1&&this._addTileFeatures(fe.range(0,ke,be/Te,ht),fe.points,-1,oe,Te,Vt),Vt.features.length?Vt:null}getClusterExpansionZoom(U){let q=this._getOriginZoom(U)-1;for(;q<=this.options.maxZoom;){const oe=this.getChildren(U);if(q++,1!==oe.length)break;U=oe[0].properties.cluster_id}return q}_appendLeaves(U,q,oe,fe,Te){const je=this.getChildren(q);for(const de of je){const be=de.properties;if(be&&be.cluster?Te+be.point_count<=fe?Te+=be.point_count:Te=this._appendLeaves(U,be.cluster_id,oe,fe,Te):Te<fe?Te++:U.push(de),U.length===oe)break}return Te}_addTileFeatures(U,q,oe,fe,Te,je){for(const de of U){const be=q[de],ke=be.numPoints;let ht,Vt,At;if(ke)ht=ir(be),Vt=be.x,At=be.y;else{const Dn=this.points[be.index];ht=Dn.properties,Vt=zt(Dn.geometry.coordinates[0]),At=Sn(Dn.geometry.coordinates[1])}const Ln={type:1,geometry:[[Math.round(this.options.extent*(Vt*Te-oe)),Math.round(this.options.extent*(At*Te-fe))]],tags:ht};let An;ke?An=be.id:this.options.generateId?An=be.index:this.points[be.index].id&&(An=this.points[be.index].id),void 0!==An&&(Ln.id=An),je.features.push(Ln)}}_limitZoom(U){return Math.max(this.options.minZoom,Math.min(Math.floor(+U),this.options.maxZoom+1))}_cluster(U,q){const oe=[],{radius:fe,extent:Te,reduce:je,minPoints:de}=this.options,be=fe/(Te*Math.pow(2,q));for(let ke=0;ke<U.length;ke++){const ht=U[ke];if(ht.zoom<=q)continue;ht.zoom=q;const Vt=this.trees[q+1],At=Vt.within(ht.x,ht.y,be),Ln=ht.numPoints||1;let An=Ln;for(const Dn of At){const Xn=Vt.points[Dn];Xn.zoom>q&&(An+=Xn.numPoints||1)}if(An>Ln&&An>=de){let Dn=ht.x*Ln,Xn=ht.y*Ln,pi=je&&Ln>1?this._map(ht,!0):null;const qi=(ke<<5)+(q+1)+this.points.length;for(const $n of At){const lr=Vt.points[$n];if(lr.zoom<=q)continue;lr.zoom=q;const _r=lr.numPoints||1;Dn+=lr.x*_r,Xn+=lr.y*_r,lr.parentId=qi,je&&(pi||(pi=this._map(ht,!0)),je(pi,this._map(lr)))}ht.parentId=qi,oe.push(Jt(Dn/An,Xn/An,qi,An,pi))}else if(oe.push(ht),An>1)for(const Dn of At){const Xn=Vt.points[Dn];Xn.zoom<=q||(Xn.zoom=q,oe.push(Xn))}}return oe}_getOriginId(U){return U-this.points.length>>5}_getOriginZoom(U){return(U-this.points.length)%32}_map(U,q){if(U.numPoints)return q?Ya({},U.properties):U.properties;const oe=this.points[U.index].properties,fe=this.options.map(oe);return q&&fe===oe?Ya({},fe):fe}}function Jt(re,U,q,oe,fe){return{x:Eo(re),y:Eo(U),zoom:1/0,id:q,parentId:-1,numPoints:oe,properties:fe}}function Hn(re,U){const[q,oe]=re.geometry.coordinates;return{x:Eo(zt(q)),y:Eo(Sn(oe)),zoom:1/0,index:U,parentId:-1}}function Ni(re){return{type:"Feature",id:re.id,properties:ir(re),geometry:{type:"Point",coordinates:[(U=re.x,360*(U-.5)),ru(re.y)]}};var U}function ir(re){const U=re.numPoints,q=U>=1e4?`${Math.round(U/1e3)}k`:U>=1e3?Math.round(U/100)/10+"k":U;return Ya(Ya({},re.properties),{cluster:!0,cluster_id:re.id,point_count:U,point_count_abbreviated:q})}function zt(re){return re/360+.5}function Sn(re){const U=Math.sin(re*Math.PI/180),q=.5-.25*Math.log((1+U)/(1-U))/Math.PI;return q<0?0:q>1?1:q}function ru(re){const U=(180-360*re)*Math.PI/180;return 360*Math.atan(Math.exp(U))/Math.PI-90}function Ya(re,U){for(const q in U)re[q]=U[q];return re}function In(re){return re.x}function _o(re){return re.y}function vl(re,U,q,oe){for(var fe,Te=oe,je=q-U>>1,de=q-U,be=re[U],ke=re[U+1],ht=re[q],Vt=re[q+1],At=U+3;At<q;At+=3){var Ln=pn(re[At],re[At+1],be,ke,ht,Vt);if(Ln>Te)fe=At,Te=Ln;else if(Ln===Te){var An=Math.abs(At-je);An<de&&(fe=At,de=An)}}Te>oe&&(fe-U>3&&vl(re,U,fe,oe),re[fe+2]=Te,q-fe>3&&vl(re,fe,q,oe))}function pn(re,U,q,oe,fe,Te){var je=fe-q,de=Te-oe;if(0!==je||0!==de){var be=((re-q)*je+(U-oe)*de)/(je*je+de*de);be>1?(q=fe,oe=Te):be>0&&(q+=je*be,oe+=de*be)}return(je=re-q)*je+(de=U-oe)*de}function Wr(re,U,q,oe){var fe={id:void 0===re?null:re,type:U,geometry:q,tags:oe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Te){var je=Te.geometry,de=Te.type;if("Point"===de||"MultiPoint"===de||"LineString"===de)yo(Te,je);else if("Polygon"===de||"MultiLineString"===de)for(var be=0;be<je.length;be++)yo(Te,je[be]);else if("MultiPolygon"===de)for(be=0;be<je.length;be++)for(var ke=0;ke<je[be].length;ke++)yo(Te,je[be][ke])}(fe),fe}function yo(re,U){for(var q=0;q<U.length;q+=3)re.minX=Math.min(re.minX,U[q]),re.minY=Math.min(re.minY,U[q+1]),re.maxX=Math.max(re.maxX,U[q]),re.maxY=Math.max(re.maxY,U[q+1])}function ys(re,U,q,oe){if(U.geometry){var fe=U.geometry.coordinates,Te=U.geometry.type,je=Math.pow(q.tolerance/((1<<q.maxZoom)*q.extent),2),de=[],be=U.id;if(q.promoteId?be=U.properties[q.promoteId]:q.generateId&&(be=oe||0),"Point"===Te)qo(fe,de);else if("MultiPoint"===Te)for(var ke=0;ke<fe.length;ke++)qo(fe[ke],de);else if("LineString"===Te)vs(fe,de,je,!1);else if("MultiLineString"===Te){if(q.lineMetrics){for(ke=0;ke<fe.length;ke++)vs(fe[ke],de=[],je,!1),re.push(Wr(be,"LineString",de,U.properties));return}On(fe,de,je,!1)}else if("Polygon"===Te)On(fe,de,je,!0);else{if("MultiPolygon"!==Te){if("GeometryCollection"===Te){for(ke=0;ke<U.geometry.geometries.length;ke++)ys(re,{id:be,geometry:U.geometry.geometries[ke],properties:U.properties},q,oe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ke=0;ke<fe.length;ke++){var ht=[];On(fe[ke],ht,je,!0),de.push(ht)}}re.push(Wr(be,Te,de,U.properties))}}function qo(re,U){U.push(an(re[0])),U.push(Wo(re[1])),U.push(0)}function vs(re,U,q,oe){for(var fe,Te,je=0,de=0;de<re.length;de++){var be=an(re[de][0]),ke=Wo(re[de][1]);U.push(be),U.push(ke),U.push(0),de>0&&(je+=oe?(fe*ke-be*Te)/2:Math.sqrt(Math.pow(be-fe,2)+Math.pow(ke-Te,2))),fe=be,Te=ke}var ht=U.length-3;U[2]=1,vl(U,0,ht,q),U[ht+2]=1,U.size=Math.abs(je),U.start=0,U.end=U.size}function On(re,U,q,oe){for(var fe=0;fe<re.length;fe++){var Te=[];vs(re[fe],Te,q,oe),U.push(Te)}}function an(re){return re/360+.5}function Wo(re){var U=Math.sin(re*Math.PI/180),q=.5-.25*Math.log((1+U)/(1-U))/Math.PI;return q<0?0:q>1?1:q}function Xr(re,U,q,oe,fe,Te,je,de){if(oe/=U,Te>=(q/=U)&&je<oe)return re;if(je<q||Te>=oe)return null;for(var be=[],ke=0;ke<re.length;ke++){var ht=re[ke],Vt=ht.geometry,At=ht.type,Ln=0===fe?ht.minX:ht.minY,An=0===fe?ht.maxX:ht.maxY;if(Ln>=q&&An<oe)be.push(ht);else if(!(An<q||Ln>=oe)){var Dn=[];if("Point"===At||"MultiPoint"===At)la(Vt,Dn,q,oe,fe);else if("LineString"===At)ca(Vt,Dn,q,oe,fe,!1,de.lineMetrics);else if("MultiLineString"===At)Qa(Vt,Dn,q,oe,fe,!1);else if("Polygon"===At)Qa(Vt,Dn,q,oe,fe,!0);else if("MultiPolygon"===At)for(var Xn=0;Xn<Vt.length;Xn++){var pi=[];Qa(Vt[Xn],pi,q,oe,fe,!0),pi.length&&Dn.push(pi)}if(Dn.length){if(de.lineMetrics&&"LineString"===At){for(Xn=0;Xn<Dn.length;Xn++)be.push(Wr(ht.id,At,Dn[Xn],ht.tags));continue}"LineString"!==At&&"MultiLineString"!==At||(1===Dn.length?(At="LineString",Dn=Dn[0]):At="MultiLineString"),"Point"!==At&&"MultiPoint"!==At||(At=3===Dn.length?"Point":"MultiPoint"),be.push(Wr(ht.id,At,Dn,ht.tags))}}}return be.length?be:null}function la(re,U,q,oe,fe){for(var Te=0;Te<re.length;Te+=3){var je=re[Te+fe];je>=q&&je<=oe&&(U.push(re[Te]),U.push(re[Te+1]),U.push(re[Te+2]))}}function ca(re,U,q,oe,fe,Te,je){for(var de,be,ke=hi(re),ht=0===fe?x:z,Vt=re.start,At=0;At<re.length-3;At+=3){var Ln=re[At],An=re[At+1],Dn=re[At+2],Xn=re[At+3],pi=re[At+4],qi=0===fe?Ln:An,$n=0===fe?Xn:pi,lr=!1;je&&(de=Math.sqrt(Math.pow(Ln-Xn,2)+Math.pow(An-pi,2))),qi<q?$n>q&&(be=ht(ke,Ln,An,Xn,pi,q),je&&(ke.start=Vt+de*be)):qi>oe?$n<oe&&(be=ht(ke,Ln,An,Xn,pi,oe),je&&(ke.start=Vt+de*be)):_c(ke,Ln,An,Dn),$n<q&&qi>=q&&(be=ht(ke,Ln,An,Xn,pi,q),lr=!0),$n>oe&&qi<=oe&&(be=ht(ke,Ln,An,Xn,pi,oe),lr=!0),!Te&&lr&&(je&&(ke.end=Vt+de*be),U.push(ke),ke=hi(re)),je&&(Vt+=de)}var _r=re.length-3;Ln=re[_r],An=re[_r+1],Dn=re[_r+2],(qi=0===fe?Ln:An)>=q&&qi<=oe&&_c(ke,Ln,An,Dn),_r=ke.length-3,Te&&_r>=3&&(ke[_r]!==ke[0]||ke[_r+1]!==ke[1])&&_c(ke,ke[0],ke[1],ke[2]),ke.length&&U.push(ke)}function hi(re){var U=[];return U.size=re.size,U.start=re.start,U.end=re.end,U}function Qa(re,U,q,oe,fe,Te){for(var je=0;je<re.length;je++)ca(re[je],U,q,oe,fe,Te,!1)}function _c(re,U,q,oe){re.push(U),re.push(q),re.push(oe)}function x(re,U,q,oe,fe,Te){var je=(Te-U)/(oe-U);return re.push(Te),re.push(q+(fe-q)*je),re.push(1),je}function z(re,U,q,oe,fe,Te){var je=(Te-q)/(fe-q);return re.push(U+(oe-U)*je),re.push(Te),re.push(1),je}function ae(re,U){for(var q=[],oe=0;oe<re.length;oe++){var fe,Te=re[oe],je=Te.type;if("Point"===je||"MultiPoint"===je||"LineString"===je)fe=Oe(Te.geometry,U);else if("MultiLineString"===je||"Polygon"===je){fe=[];for(var de=0;de<Te.geometry.length;de++)fe.push(Oe(Te.geometry[de],U))}else if("MultiPolygon"===je)for(fe=[],de=0;de<Te.geometry.length;de++){for(var be=[],ke=0;ke<Te.geometry[de].length;ke++)be.push(Oe(Te.geometry[de][ke],U));fe.push(be)}q.push(Wr(Te.id,je,fe,Te.tags))}return q}function Oe(re,U){var q=[];q.size=re.size,void 0!==re.start&&(q.start=re.start,q.end=re.end);for(var oe=0;oe<re.length;oe+=3)q.push(re[oe]+U,re[oe+1],re[oe+2]);return q}function Ve(re,U){if(re.transformed)return re;var q,oe,fe,Te=1<<re.z,je=re.x,de=re.y;for(q=0;q<re.features.length;q++){var be=re.features[q],ke=be.geometry,ht=be.type;if(be.geometry=[],1===ht)for(oe=0;oe<ke.length;oe+=2)be.geometry.push(le(ke[oe],ke[oe+1],U,Te,je,de));else for(oe=0;oe<ke.length;oe++){var Vt=[];for(fe=0;fe<ke[oe].length;fe+=2)Vt.push(le(ke[oe][fe],ke[oe][fe+1],U,Te,je,de));be.geometry.push(Vt)}}return re.transformed=!0,re}function le(re,U,q,oe,fe,Te){return[Math.round(q*(re*oe-fe)),Math.round(q*(U*oe-Te))]}function mn(re,U,q,oe,fe){for(var Te=U===fe.maxZoom?0:fe.tolerance/((1<<U)*fe.extent),je={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:q,y:oe,z:U,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},de=0;de<re.length;de++){je.numFeatures++,_i(je,re[de],Te,fe);var be=re[de].minX,ke=re[de].minY,ht=re[de].maxX,Vt=re[de].maxY;be<je.minX&&(je.minX=be),ke<je.minY&&(je.minY=ke),ht>je.maxX&&(je.maxX=ht),Vt>je.maxY&&(je.maxY=Vt)}return je}function _i(re,U,q,oe){var fe=U.geometry,Te=U.type,je=[];if("Point"===Te||"MultiPoint"===Te)for(var de=0;de<fe.length;de+=3)je.push(fe[de]),je.push(fe[de+1]),re.numPoints++,re.numSimplified++;else if("LineString"===Te)Ii(je,fe,re,q,!1,!1);else if("MultiLineString"===Te||"Polygon"===Te)for(de=0;de<fe.length;de++)Ii(je,fe[de],re,q,"Polygon"===Te,0===de);else if("MultiPolygon"===Te)for(var be=0;be<fe.length;be++){var ke=fe[be];for(de=0;de<ke.length;de++)Ii(je,ke[de],re,q,!0,0===de)}if(je.length){var ht=U.tags||null;if("LineString"===Te&&oe.lineMetrics){for(var Vt in ht={},U.tags)ht[Vt]=U.tags[Vt];ht.mapbox_clip_start=fe.start/fe.size,ht.mapbox_clip_end=fe.end/fe.size}var At={geometry:je,type:"Polygon"===Te||"MultiPolygon"===Te?3:"LineString"===Te||"MultiLineString"===Te?2:1,tags:ht};null!==U.id&&(At.id=U.id),re.features.push(At)}}function Ii(re,U,q,oe,fe,Te){var je=oe*oe;if(oe>0&&U.size<(fe?je:oe))q.numPoints+=U.length/3;else{for(var de=[],be=0;be<U.length;be+=3)(0===oe||U[be+2]>je)&&(q.numSimplified++,de.push(U[be]),de.push(U[be+1])),q.numPoints++;fe&&function(ke,ht){for(var Vt=0,At=0,Ln=ke.length,An=Ln-2;At<Ln;An=At,At+=2)Vt+=(ke[At]-ke[An])*(ke[At+1]+ke[An+1]);if(Vt>0===ht)for(At=0,Ln=ke.length;At<Ln/2;At+=2){var Dn=ke[At],Xn=ke[At+1];ke[At]=ke[Ln-2-At],ke[At+1]=ke[Ln-1-At],ke[Ln-2-At]=Dn,ke[Ln-1-At]=Xn}}(de,Te),re.push(de)}}function un(re,U){var q=(U=this.options=function(fe,Te){for(var je in Te)fe[je]=Te[je];return fe}(Object.create(this.options),U)).debug;if(q&&console.time("preprocess data"),U.maxZoom<0||U.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(U.promoteId&&U.generateId)throw new Error("promoteId and generateId cannot be used together.");var fe,Te,je,de,be,ke,oe=function(fe,Te){var je=[];if("FeatureCollection"===fe.type)for(var de=0;de<fe.features.length;de++)ys(je,fe.features[de],Te,de);else ys(je,"Feature"===fe.type?fe:{geometry:fe},Te);return je}(re,U);this.tiles={},this.tileCoords=[],q&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",U.indexMaxZoom,U.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),de=fe=oe,be=Xr(fe,1,-1-(je=(Te=U).buffer/Te.extent),je,0,-1,2,Te),ke=Xr(fe,1,1-je,2+je,0,-1,2,Te),(be||ke)&&(de=Xr(fe,1,-je,1+je,0,-1,2,Te)||[],be&&(de=ae(be,1).concat(de)),ke&&(de=de.concat(ae(ke,-1)))),(oe=de).length&&this.splitTile(oe,0,0,0),q&&(oe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Wn(re,U,q){return 32*((1<<re)*q+U)+re}function Zr(re,U){const q=re.tileID.canonical;if(!this._geoJSONIndex)return U(null,null);const oe=this._geoJSONIndex.getTile(q.z,q.x,q.y);if(!oe)return U(null,null);const fe=new $t(oe.features);let Te=dn.exports(fe);0===Te.byteOffset&&Te.byteLength===Te.buffer.byteLength||(Te=new Uint8Array(Te)),U(null,{vectorTile:fe,rawData:Te.buffer})}un.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},un.prototype.splitTile=function(re,U,q,oe,fe,Te,je){for(var de=[re,U,q,oe],be=this.options,ke=be.debug;de.length;){oe=de.pop(),q=de.pop(),U=de.pop(),re=de.pop();var ht=1<<U,Vt=Wn(U,q,oe),At=this.tiles[Vt];if(!At&&(ke>1&&console.time("creation"),At=this.tiles[Vt]=mn(re,U,q,oe,be),this.tileCoords.push({z:U,x:q,y:oe}),ke)){ke>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",U,q,oe,At.numFeatures,At.numPoints,At.numSimplified),console.timeEnd("creation"));var Ln="z"+U;this.stats[Ln]=(this.stats[Ln]||0)+1,this.total++}if(At.source=re,fe){if(U===be.maxZoom||U===fe)continue;var An=1<<fe-U;if(q!==Math.floor(Te/An)||oe!==Math.floor(je/An))continue}else if(U===be.indexMaxZoom||At.numPoints<=be.indexMaxPoints)continue;if(At.source=null,0!==re.length){ke>1&&console.time("clipping");var Dn,Xn,pi,qi,$n,lr,_r=.5*be.buffer/be.extent,Ul=.5-_r,xl=.5+_r,ct=1+_r;Dn=Xn=pi=qi=null,$n=Xr(re,ht,q-_r,q+xl,0,At.minX,At.maxX,be),lr=Xr(re,ht,q+Ul,q+ct,0,At.minX,At.maxX,be),re=null,$n&&(Dn=Xr($n,ht,oe-_r,oe+xl,1,At.minY,At.maxY,be),Xn=Xr($n,ht,oe+Ul,oe+ct,1,At.minY,At.maxY,be),$n=null),lr&&(pi=Xr(lr,ht,oe-_r,oe+xl,1,At.minY,At.maxY,be),qi=Xr(lr,ht,oe+Ul,oe+ct,1,At.minY,At.maxY,be),lr=null),ke>1&&console.timeEnd("clipping"),de.push(Dn||[],U+1,2*q,2*oe),de.push(Xn||[],U+1,2*q,2*oe+1),de.push(pi||[],U+1,2*q+1,2*oe),de.push(qi||[],U+1,2*q+1,2*oe+1)}}},un.prototype.getTile=function(re,U,q){var oe=this.options,fe=oe.extent,Te=oe.debug;if(re<0||re>24)return null;var je=1<<re,de=Wn(re,U=(U%je+je)%je,q);if(this.tiles[de])return Ve(this.tiles[de],fe);Te>1&&console.log("drilling down to z%d-%d-%d",re,U,q);for(var be,ke=re,ht=U,Vt=q;!be&&ke>0;)ke--,ht=Math.floor(ht/2),Vt=Math.floor(Vt/2),be=this.tiles[Wn(ke,ht,Vt)];return be&&be.source?(Te>1&&console.log("found parent tile z%d-%d-%d",ke,ht,Vt),Te>1&&console.time("drilling down"),this.splitTile(be.source,ke,ht,Vt,re,U,q),Te>1&&console.timeEnd("drilling down"),this.tiles[de]?Ve(this.tiles[de],fe):null):null};class Xo extends p.VectorTileWorkerSource{constructor(U,q,oe,fe,Te){super(U,q,oe,fe,Zr),Te&&(this.loadGeoJSON=Te)}loadData(U,q){const oe=U&&U.request,fe=oe&&oe.collectResourceTiming;this.loadGeoJSON(U,(Te,je)=>{if(Te||!je)return q(Te);if("object"!=typeof je)return q(new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`));{Ye(je,!0);try{if(U.filter){const be=p.createExpression(U.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===be.result)throw new Error(be.value.map(ht=>`${ht.key}: ${ht.message}`).join(", "));const ke=je.features.filter(ht=>be.value.evaluate({zoom:0},ht));je={type:"FeatureCollection",features:ke}}this._geoJSONIndex=U.cluster?new Tt(function({superclusterOptions:be,clusterProperties:ke}){if(!ke||!be)return be;const ht={},Vt={},At={accumulated:null,zoom:0},Ln={properties:null},An=Object.keys(ke);for(const Dn of An){const[Xn,pi]=ke[Dn],qi=p.createExpression(pi),$n=p.createExpression("string"==typeof Xn?[Xn,["accumulated"],["get",Dn]]:Xn);ht[Dn]=qi.value,Vt[Dn]=$n.value}return be.map=Dn=>{Ln.properties=Dn;const Xn={};for(const pi of An)Xn[pi]=ht[pi].evaluate(At,Ln);return Xn},be.reduce=(Dn,Xn)=>{Ln.properties=Xn;for(const pi of An)At.accumulated=Dn[pi],Dn[pi]=Vt[pi].evaluate(At,Ln)},be}(U)).load(je.features):new un(be=je,U.geojsonVtOptions)}catch(be){return q(be)}this.loaded={};const de={};if(fe){const be=p.getPerformanceMeasurement(oe);be&&(de.resourceTiming={},de.resourceTiming[U.source]=JSON.parse(JSON.stringify(be)))}q(null,de)}var be})}reloadTile(U,q){const oe=this.loaded;return oe&&oe[U.uid]?super.reloadTile(U,q):this.loadTile(U,q)}loadGeoJSON(U,q){if(U.request)p.getJSON(U.request,q);else{if("string"!=typeof U.data)return q(new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`));try{return q(null,JSON.parse(U.data))}catch(oe){return q(new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(U,q){try{q(null,this._geoJSONIndex.getClusterExpansionZoom(U.clusterId))}catch(oe){q(oe)}}getClusterChildren(U,q){try{q(null,this._geoJSONIndex.getChildren(U.clusterId))}catch(oe){q(oe)}}getClusterLeaves(U,q){try{q(null,this._geoJSONIndex.getLeaves(U.clusterId,U.limit,U.offset))}catch(oe){q(oe)}}}class li{constructor(U){this.self=U,this.actor=new p.Actor(U,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=p.getProjection({name:"mercator"}),this.workerSourceTypes={vector:p.VectorTileWorkerSource,geojson:Xo},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(q,oe)=>{if(this.workerSourceTypes[q])throw new Error(`Worker source with name "${q}" already registered.`);this.workerSourceTypes[q]=oe},this.self.registerRTLTextPlugin=q=>{if(p.plugin.isParsed())throw new Error("RTL text plugin already registered.");p.plugin.applyArabicShaping=q.applyArabicShaping,p.plugin.processBidirectionalText=q.processBidirectionalText,p.plugin.processStyledBidirectionalText=q.processStyledBidirectionalText}}clearCaches(U,q,oe){delete this.layerIndexes[U],delete this.availableImages[U],delete this.workerSources[U],delete this.demWorkerSources[U],oe()}checkIfReady(U,q,oe){oe()}setReferrer(U,q){this.referrer=q}spriteLoaded(U,q){this.isSpriteLoaded[U]=q;for(const oe in this.workerSources[U]){const fe=this.workerSources[U][oe];for(const Te in fe)fe[Te]instanceof p.VectorTileWorkerSource&&(fe[Te].isSpriteLoaded=q,fe[Te].fire(new p.Event("isSpriteLoaded")))}}setImages(U,q,oe){this.availableImages[U]=q;for(const fe in this.workerSources[U]){const Te=this.workerSources[U][fe];for(const je in Te)Te[je].availableImages=q}oe()}enableTerrain(U,q,oe){this.terrain=q,oe()}setProjection(U,q){this.projections[U]=p.getProjection(q)}setLayers(U,q,oe){this.getLayerIndex(U).replace(q),oe()}updateLayers(U,q,oe){this.getLayerIndex(U).update(q.layers,q.removedIds),oe()}loadTile(U,q,oe){const fe=this.enableTerrain?p.extend({enableTerrain:this.terrain},q):q;fe.projection=this.projections[U]||this.defaultProjection,this.getWorkerSource(U,q.type,q.source).loadTile(fe,oe)}loadDEMTile(U,q,oe){const fe=this.enableTerrain?p.extend({buildQuadTree:this.terrain},q):q;this.getDEMWorkerSource(U,q.source).loadTile(fe,oe)}reloadTile(U,q,oe){const fe=this.enableTerrain?p.extend({enableTerrain:this.terrain},q):q;fe.projection=this.projections[U]||this.defaultProjection,this.getWorkerSource(U,q.type,q.source).reloadTile(fe,oe)}abortTile(U,q,oe){this.getWorkerSource(U,q.type,q.source).abortTile(q,oe)}removeTile(U,q,oe){this.getWorkerSource(U,q.type,q.source).removeTile(q,oe)}removeSource(U,q,oe){if(!this.workerSources[U]||!this.workerSources[U][q.type]||!this.workerSources[U][q.type][q.source])return;const fe=this.workerSources[U][q.type][q.source];delete this.workerSources[U][q.type][q.source],void 0!==fe.removeSource?fe.removeSource(q,oe):oe()}loadWorkerSource(U,q,oe){try{this.self.importScripts(q.url),oe()}catch(fe){oe(fe.toString())}}syncRTLPluginState(U,q,oe){try{p.plugin.setState(q);const fe=p.plugin.getPluginURL();if(p.plugin.isLoaded()&&!p.plugin.isParsed()&&null!=fe){this.self.importScripts(fe);const Te=p.plugin.isParsed();oe(Te?void 0:new Error(`RTL Text Plugin failed to import scripts from ${fe}`),Te)}}catch(fe){oe(fe.toString())}}getAvailableImages(U){let q=this.availableImages[U];return q||(q=[]),q}getLayerIndex(U){let q=this.layerIndexes[U];return q||(q=this.layerIndexes[U]=new $e),q}getWorkerSource(U,q,oe){return this.workerSources[U]||(this.workerSources[U]={}),this.workerSources[U][q]||(this.workerSources[U][q]={}),this.workerSources[U][q][oe]||(this.workerSources[U][q][oe]=new this.workerSourceTypes[q]({send:(Te,je,de,be,ke,ht)=>{this.actor.send(Te,je,de,U,ke,ht)},scheduler:this.actor.scheduler},this.getLayerIndex(U),this.getAvailableImages(U),this.isSpriteLoaded[U])),this.workerSources[U][q][oe]}getDEMWorkerSource(U,q){return this.demWorkerSources[U]||(this.demWorkerSources[U]={}),this.demWorkerSources[U][q]||(this.demWorkerSources[U][q]=new Ge),this.demWorkerSources[U][q]}enforceCacheSizeLimit(U,q){p.enforceCacheSizeLimit(q)}getWorkerPerformanceMetrics(U,q,oe){oe(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new li(self)),li}),Ue(0,function(p){function me(g,c){if(Array.isArray(g)){if(!Array.isArray(c)||g.length!==c.length)return!1;for(let h=0;h<g.length;h++)if(!me(g[h],c[h]))return!1;return!0}if("object"==typeof g&&null!==g&&null!==c){if("object"!=typeof c||Object.keys(g).length!==Object.keys(c).length)return!1;for(const h in g)if(!me(g[h],c[h]))return!1;return!0}return g===c}var Et=$e;function $e(g){return c=g,!("undefined"==typeof window||"undefined"==typeof document||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var _,w,C=new Blob([""],{type:"text/javascript"}),I=URL.createObjectURL(C);try{w=new Worker(I),_=!0}catch(k){_=!1}return w&&w.terminate(),URL.revokeObjectURL(I),_}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var _=document.createElement("canvas");_.width=_.height=1;var w=_.getContext("2d");if(!w)return!1;var C=w.getImageData(0,0,1,1);return C&&C.width===_.width}()||(void 0===Ge[h=c&&c.failIfMajorPerformanceCaveat]&&(Ge[h]=function(_){var w,I,k,R,C=(I=_,k=document.createElement("canvas"),(R=Object.create($e.webGLContextAttributes)).failIfMajorPerformanceCaveat=I,k.getContext("webgl",R)||k.getContext("experimental-webgl",R));if(!C)return!1;try{w=C.createShader(C.VERTEX_SHADER)}catch(I){return!1}return!(!w||C.isContextLost())&&(C.shaderSource(w,"void main() {}"),C.compileShader(w),!0===C.getShaderParameter(w,C.COMPILE_STATUS))}(h)),!Ge[h]||document.documentMode));var c,h}var Ge={};function Ye(g,c,h){const _=p.window.document.createElement(g);return void 0!==c&&(_.className=c),h&&h.appendChild(_),_}function Ft(g,c,h){const _=p.window.document.createElementNS("http://www.w3.org/2000/svg",g);for(const w of Object.keys(c))_.setAttributeNS(null,w,c[w]);return h&&h.appendChild(_),_}$e.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const kt=p.window.document&&p.window.document.documentElement.style,Xe=kt&&void 0!==kt.userSelect?"userSelect":"WebkitUserSelect";let St;function $t(){kt&&Xe&&(St=kt[Xe],kt[Xe]="none")}function dn(){kt&&Xe&&(kt[Xe]=St)}function Ne(g){g.preventDefault(),g.stopPropagation(),p.window.removeEventListener("click",Ne,!0)}function jn(){p.window.addEventListener("click",Ne,!0),p.window.setTimeout(()=>{p.window.removeEventListener("click",Ne,!0)},0)}function mt(g,c){const h=g.getBoundingClientRect();return Se(g,h,c)}function gi(g,c){const h=g.getBoundingClientRect(),_=[];for(let w=0;w<c.length;w++)_.push(Se(g,h,c[w]));return _}function Ie(g){return void 0!==p.window.InstallTrigger&&2===g.button&&g.ctrlKey&&p.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:g.button}function Se(g,c,h){const _=g.offsetWidth===c.width?1:g.offsetWidth/c.width;return new p.pointGeometry((h.clientX-c.left)*_,(h.clientY-c.top)*_)}function Ae(g,c){var h=c[0],_=c[1],w=c[2],C=c[3],I=h*C-w*_;return I?(g[0]=C*(I=1/I),g[1]=-_*I,g[2]=-w*I,g[3]=h*I,g):null}function ee(g){const{userImage:c}=g;return!!(c&&c.render&&c.render())&&(g.data.replace(new Uint8Array(c.data.buffer)),!0)}class nt extends p.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new p.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(c){if(this.loaded!==c&&(this.loaded=c,c)){for(const{ids:h,callback:_}of this.requestors)this._notify(h,_);this.requestors=[]}}hasImage(c){return!!this.getImage(c)}getImage(c){return this.images[c]}addImage(c,h){this._validate(c,h)&&(this.images[c]=h)}_validate(c,h){let _=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new p.ErrorEvent(new Error(`Image "${c}" has invalid "stretchX" value`))),_=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new p.ErrorEvent(new Error(`Image "${c}" has invalid "stretchY" value`))),_=!1),this._validateContent(h.content,h)||(this.fire(new p.ErrorEvent(new Error(`Image "${c}" has invalid "content" value`))),_=!1),_}_validateStretch(c,h){if(!c)return!0;let _=0;for(const w of c){if(w[0]<_||w[1]<w[0]||h<w[1])return!1;_=w[1]}return!0}_validateContent(c,h){return!(c&&(4!==c.length||c[0]<0||h.data.width<c[0]||c[1]<0||h.data.height<c[1]||c[2]<0||h.data.width<c[2]||c[3]<0||h.data.height<c[3]||c[2]<c[0]||c[3]<c[1]))}updateImage(c,h){h.version=this.images[c].version+1,this.images[c]=h,this.updatedImages[c]=!0}removeImage(c){const h=this.images[c];delete this.images[c],delete this.patterns[c],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(c,h){let _=!0;if(!this.isLoaded())for(const w of c)this.images[w]||(_=!1);this.isLoaded()||_?this._notify(c,h):this.requestors.push({ids:c,callback:h})}_notify(c,h){const _={};for(const w of c){this.images[w]||this.fire(new p.Event("styleimagemissing",{id:w}));const C=this.images[w];C?_[w]={data:C.data.clone(),pixelRatio:C.pixelRatio,sdf:C.sdf,version:C.version,stretchX:C.stretchX,stretchY:C.stretchY,content:C.content,hasRenderCallback:Boolean(C.userImage&&C.userImage.render)}:p.warnOnce(`Image "${w}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}h(null,_)}getPixelSize(){const{width:c,height:h}=this.atlasImage;return{width:c,height:h}}getPattern(c){const h=this.patterns[c],_=this.getImage(c);if(!_)return null;if(h&&h.position.version===_.version)return h.position;if(h)h.position.version=_.version;else{const w={w:_.data.width+2,h:_.data.height+2,x:0,y:0},C=new p.ImagePosition(w,_);this.patterns[c]={bin:w,position:C}}return this._updatePatternAtlas(),this.patterns[c].position}bind(c){const h=c.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new p.Texture(c,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const c=[];for(const C in this.patterns)c.push(this.patterns[C].bin);const{w:h,h:_}=p.potpack(c),w=this.atlasImage;w.resize({width:h||1,height:_||1});for(const C in this.patterns){const{bin:I}=this.patterns[C],k=I.x+1,R=I.y+1,F=this.images[C].data,N=F.width,H=F.height;p.RGBAImage.copy(F,w,{x:0,y:0},{x:k,y:R},{width:N,height:H}),p.RGBAImage.copy(F,w,{x:0,y:H-1},{x:k,y:R-1},{width:N,height:1}),p.RGBAImage.copy(F,w,{x:0,y:0},{x:k,y:R+H},{width:N,height:1}),p.RGBAImage.copy(F,w,{x:N-1,y:0},{x:k-1,y:R},{width:1,height:H}),p.RGBAImage.copy(F,w,{x:0,y:0},{x:k+N,y:R},{width:1,height:H})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(c){for(const h of c){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const _=this.images[h];ee(_)&&this.updateImage(h,_)}}}const at=new p.Properties({anchor:new p.DataConstantProperty(p.spec.light.anchor),position:new class{constructor(){this.specification=p.spec.light.position}possiblyEvaluate(g,c){return function([h,_,w]){const C=p.degToRad(_+90),I=p.degToRad(w);return{x:h*Math.cos(C)*Math.sin(I),y:h*Math.sin(C)*Math.sin(I),z:h*Math.cos(I),azimuthal:_,polar:w}}(g.expression.evaluate(c))}interpolate(g,c,h){return{x:p.number(g.x,c.x,h),y:p.number(g.y,c.y,h),z:p.number(g.z,c.z,h),azimuthal:p.number(g.azimuthal,c.azimuthal,h),polar:p.number(g.polar,c.polar,h)}}},color:new p.DataConstantProperty(p.spec.light.color),intensity:new p.DataConstantProperty(p.spec.light.intensity)}),pe="-transition";class et extends p.Evented{constructor(c){super(),this._transitionable=new p.Transitionable(at),this.setLight(c),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(c,h={}){if(!this._validate(p.validateLight,c,h))for(const _ in c){const w=c[_];p.endsWith(_,pe)?this._transitionable.setTransition(_.slice(0,-pe.length),w):this._transitionable.setValue(_,w)}}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,h,_){return(!_||!1!==_.validate)&&p.emitValidationErrors(this,c.call(p.validateStyle,p.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:p.spec})))}}const Ke=new p.Properties({source:new p.DataConstantProperty(p.spec.terrain.source),exaggeration:new p.DataConstantProperty(p.spec.terrain.exaggeration)}),sn="-transition";class wn extends p.Evented{constructor(c,h){super(),this._transitionable=new p.Transitionable(Ke),this.set(c),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=h}get(){return this._transitionable.serialize()}set(c){for(const h in c){const _=c[h];p.endsWith(h,sn)?this._transitionable.setTransition(h.slice(0,-sn.length),_):this._transitionable.setValue(h,_)}}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}}function Un(g,c,h,_){const w=p.smoothstep(45,65,h),[C,I]=Fi(g,_),k=p.length(c);let R=1-Math.min(1,Math.exp((k-C)/(I-C)*-6));return R*=R*R,R=Math.min(1,1.00747*R),R*w*g.alpha}function Fi(g,c){const h=.5/Math.tan(.5*c);return[g.range[0]+h,g.range[1]+h]}const en=new p.Properties({range:new p.DataConstantProperty(p.spec.fog.range),color:new p.DataConstantProperty(p.spec.fog.color),"high-color":new p.DataConstantProperty(p.spec.fog["high-color"]),"space-color":new p.DataConstantProperty(p.spec.fog["space-color"]),"horizon-blend":new p.DataConstantProperty(p.spec.fog["horizon-blend"]),"star-intensity":new p.DataConstantProperty(p.spec.fog["star-intensity"])}),ti="-transition";class nr extends p.Evented{constructor(c,h){super(),this._transitionable=new p.Transitionable(en),this.set(c),this._transitioning=this._transitionable.untransitioned(),this._transform=h}get state(){const c=this._transform,h="globe"===c.projection.name,_=p.globeToMercatorTransition(c.zoom),w=this.properties.get("range"),C=[.5,3];return{range:h?[p.number(C[0],w[0],_),p.number(C[1],w[1],_)]:w,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(c,h={}){if(!this._validate(p.validateFog,c,h)){for(const _ of Object.keys(p.spec.fog))c&&void 0===c[_]&&(c[_]=p.spec.fog[_].default);for(const _ in c){const w=c[_];p.endsWith(_,ti)?this._transitionable.setTransition(_.slice(0,-ti.length),w):this._transitionable.setValue(_,w)}}}getOpacity(c){if(!this._transform.projection.supportsFog)return 0;const h=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:p.smoothstep(45,65,c))*h.a}getOpacityAtLatLng(c,h){return this._transform.projection.supportsFog?function(_,w,C){const I=p.MercatorCoordinate.fromLngLat(w),k=C.elevation?C.elevation.getAtPointOrZero(I):0,R=[I.x,I.y,k];return p.transformMat4(R,R,C.mercatorFogMatrix),Un(_,R,C.pitch,C._fov)}(this.state,c,h):0}getFovAdjustedRange(c){return this._transform.projection.supportsFog?Fi(this.state,c):[0,1]}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,h,_){return(!_||!1!==_.validate)&&p.emitValidationErrors(this,c.call(p.validateStyle,p.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:p.spec})))}}class qr{constructor(c,h){this.workerPool=c,this.actors=[],this.currentActor=0,this.id=p.uniqueId();const _=this.workerPool.acquire(this.id);for(let w=0;w<_.length;w++){const C=new qr.Actor(_[w],h,this.id);C.name=`Worker ${w}`,this.actors.push(C)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(c,h,_){p.asyncAll(this.actors,(w,C)=>{w.send(c,h,C)},_=_||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(c=>{c.remove()}),this.actors=[],this.workerPool.release(this.id)}}function ni(g,c,h){return c*(p.EXTENT/(g.tileSize*Math.pow(2,h-g.tileID.overscaledZ)))}qr.Actor=p.Actor;class Qt{constructor(c,h,_,w){this.screenBounds=c,this.cameraPoint=h,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=_,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,w)}static createFromScreenPoints(c,h){let _,w;if(c instanceof p.pointGeometry||"number"==typeof c[0]){const C=p.pointGeometry.convert(c);_=[C],w=h.isPointAboveHorizon(C)}else{const C=p.pointGeometry.convert(c[0]),I=p.pointGeometry.convert(c[1]);_=[C,I],w=p.polygonizeBounds(C,I).every(k=>h.isPointAboveHorizon(k))}return new Qt(_,h.getCameraPoint(),w,h)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(c){return p.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],c)}bufferedCameraGeometry(c){const h=this.screenBounds[0],_=1===this.screenBounds.length?this.screenBounds[0].add(new p.pointGeometry(1,1)):this.screenBounds[1],w=p.polygonizeBounds(h,_,0,!1);return this.cameraPoint.y>_.y&&(this.cameraPoint.x>h.x&&this.cameraPoint.x<_.x?w.splice(3,0,this.cameraPoint):this.cameraPoint.x>=_.x?w[2]=this.cameraPoint:this.cameraPoint.x<=h.x&&(w[3]=this.cameraPoint)),p.bufferConvexPolygon(w,c)}bufferedCameraGeometryGlobe(c){const h=this.screenBounds[0],_=1===this.screenBounds.length?this.screenBounds[0].add(new p.pointGeometry(1,1)):this.screenBounds[1],w=p.polygonizeBounds(h,_,c),C=this.cameraPoint.clone();switch(3*((C.y>h.y)+(C.y>_.y))+((C.x>h.x)+(C.x>_.x))){case 0:w[0]=C,w[4]=C.clone();break;case 1:w.splice(1,0,C);break;case 2:w[1]=C;break;case 3:w.splice(4,0,C);break;case 5:w.splice(2,0,C);break;case 6:w[3]=C;break;case 7:w.splice(3,0,C);break;case 8:w[2]=C}return w}containsTile(c,h,_,w=0){const C=c.queryPadding/h._pixelsPerMercatorPixel+1,I=_?this._bufferedCameraMercator(C,h):this._bufferedScreenMercator(C,h);let k=c.tileID.wrap+(I.unwrapped?w:0);const R=I.polygon.map(K=>p.getTilePoint(c.tileTransform,K,k));if(!p.polygonIntersectsBox(R,0,0,p.EXTENT,p.EXTENT))return;k=c.tileID.wrap+(this.screenGeometryMercator.unwrapped?w:0);const F=this.screenGeometryMercator.polygon.map(K=>p.getTileVec3(c.tileTransform,K,k)),N=F.map(K=>new p.pointGeometry(K[0],K[1])),H=h.getFreeCameraOptions().position||new p.MercatorCoordinate(0,0,0),X=p.getTileVec3(c.tileTransform,H,k),te=F.map(K=>{const Y=p.sub(K,K,X);return p.normalize(Y,Y),new p.Ray(X,Y)}),Q=ni(c,1,h.zoom)*h._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:N,tilespaceRays:te,bufferedTilespaceGeometry:R,bufferedTilespaceBounds:(ne=p.getBounds(R),ne.min.x=p.clamp(ne.min.x,0,p.EXTENT),ne.min.y=p.clamp(ne.min.y,0,p.EXTENT),ne.max.x=p.clamp(ne.max.x,0,p.EXTENT),ne.max.y=p.clamp(ne.max.y,0,p.EXTENT),ne),tile:c,tileID:c.tileID,pixelToTileUnitsFactor:Q};var ne}_bufferedScreenMercator(c,h){const _=di(c);if(this._screenRaycastCache[_])return this._screenRaycastCache[_];{let w;return w="globe"===h.projection.name?this._projectAndResample(this.bufferedScreenGeometry(c),h):{polygon:this.bufferedScreenGeometry(c).map(C=>h.pointCoordinate3D(C)),unwrapped:!0},this._screenRaycastCache[_]=w,w}}_bufferedCameraMercator(c,h){const _=di(c);if(this._cameraRaycastCache[_])return this._cameraRaycastCache[_];{let w;return w="globe"===h.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(c),h):{polygon:this.bufferedCameraGeometry(c).map(C=>h.pointCoordinate3D(C)),unwrapped:!0},this._cameraRaycastCache[_]=w,w}}_projectAndResample(c,h){const _=function(C,I){const k=p.multiply([],I.pixelMatrix,I.globeMatrix),R=[0,-p.GLOBE_RADIUS,0,1],F=[0,p.GLOBE_RADIUS,0,1],N=[0,0,0,1];p.transformMat4$1(R,R,k),p.transformMat4$1(F,F,k),p.transformMat4$1(N,N,k);const H=new p.pointGeometry(R[0]/R[3],R[1]/R[3]),X=new p.pointGeometry(F[0]/F[3],F[1]/F[3]),te=p.polygonContainsPoint(C,H)&&R[3]<N[3],Q=p.polygonContainsPoint(C,X)&&F[3]<N[3];if(!te&&!Q)return null;const ne=function(Ce,He,it){for(let Qe=1;Qe<Ce.length;Qe++){const wt=Eo(He.pointCoordinate3D(Ce[Qe-1]).x),Le=Eo(He.pointCoordinate3D(Ce[Qe]).x);if(it<0){if(wt<Le)return{idx:Qe,t:-wt/(Le-1-wt)}}else if(Le<wt)return{idx:Qe,t:(1-wt)/(Le+1-wt)}}return null}(C,I,te?-1:1);if(!ne)return null;const{idx:K,t:Y}=ne;let se=K>1?Rs(C.slice(0,K),I):[],J=K<C.length?Rs(C.slice(K),I):[];se=se.map(Ce=>new p.pointGeometry(Eo(Ce.x),Ce.y)),J=J.map(Ce=>new p.pointGeometry(Eo(Ce.x),Ce.y));const _e=[...se];0===_e.length&&_e.push(J[J.length-1]);const ve=p.number(_e[_e.length-1].y,(0===J.length?se[0]:J[0]).y,Y);let he;return he=te?[new p.pointGeometry(0,ve),new p.pointGeometry(0,0),new p.pointGeometry(1,0),new p.pointGeometry(1,ve)]:[new p.pointGeometry(1,ve),new p.pointGeometry(1,1),new p.pointGeometry(0,1),new p.pointGeometry(0,ve)],_e.push(...he),0===J.length?_e.push(se[0]):_e.push(...J),{polygon:_e.map(Ce=>new p.MercatorCoordinate(Ce.x,Ce.y)),unwrapped:!1}}(c,h);if(_)return _;const w=function(C,I){let k=!1,R=-1/0,F=0;for(let H=0;H<C.length-1;H++)C[H].x>R&&(R=C[H].x,F=H);for(let H=0;H<C.length-1;H++){const X=(F+H)%(C.length-1),te=C[X],Q=C[X+1];Math.abs(te.x-Q.x)>.5&&(te.x<Q.x?(te.x+=1,0===X&&(C[C.length-1].x+=1)):(Q.x+=1,X+1===C.length-1&&(C[0].x+=1)),k=!0)}const N=p.mercatorXfromLng(I.center.lng);return k&&N<Math.abs(N-1)&&C.forEach(H=>{H.x-=1}),{polygon:C,unwrapped:k}}(Rs(c,h).map(C=>new p.pointGeometry(Eo(C.x),C.y)),h);return{polygon:w.polygon.map(C=>new p.MercatorCoordinate(C.x,C.y)),unwrapped:w.unwrapped}}}function Rs(g,c){return p.resample(g,h=>{const _=c.pointCoordinate3D(h);h.x=_.x,h.y=_.y},1/256)}function Eo(g){return g<0?1+g%1:g%1}function di(g){return 100*g|0}function Tt(g,c,h,_,w){const C=function(I,k){if(I)return w(I);if(k){g.url&&k.tiles&&g.tiles&&delete g.tiles;const R=p.pick(p.extend(k,g),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);k.vector_layers&&(R.vectorLayers=k.vector_layers,R.vectorLayerIds=R.vectorLayers.map(F=>F.id)),R.tiles=c.canonicalizeTileset(R,g.url),w(null,R)}};return g.url?p.getJSON(c.transformRequest(c.normalizeSourceURL(g.url,null,h,_),p.ResourceType.Source),C):p.exported.frame(()=>C(null,g))}class Jt{constructor(c,h,_){this.bounds=p.LngLatBounds.convert(this.validateBounds(c)),this.minzoom=h||0,this.maxzoom=_||24}validateBounds(c){return Array.isArray(c)&&4===c.length?[Math.max(-180,c[0]),Math.max(-90,c[1]),Math.min(180,c[2]),Math.min(90,c[3])]:[-180,-90,180,90]}contains(c){const h=Math.pow(2,c.z),_=Math.floor(p.mercatorXfromLng(this.bounds.getWest())*h),w=Math.floor(p.mercatorYfromLat(this.bounds.getNorth())*h),C=Math.ceil(p.mercatorXfromLng(this.bounds.getEast())*h),I=Math.ceil(p.mercatorYfromLat(this.bounds.getSouth())*h);return c.x>=_&&c.x<C&&c.y>=w&&c.y<I}}class Hn{constructor(c,h,_){this.context=c;const w=c.gl;this.buffer=w.createBuffer(),this.dynamicDraw=Boolean(_),this.context.unbindVAO(),c.bindElementBuffer.set(this.buffer),w.bufferData(w.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||h.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(c){const h=this.context.gl;this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,c.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ni={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ir{constructor(c,h,_,w){this.length=h.length,this.attributes=_,this.itemSize=h.bytesPerElement,this.dynamicDraw=w,this.context=c;const C=c.gl;this.buffer=C.createBuffer(),c.bindVertexBuffer.set(this.buffer),C.bufferData(C.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||h.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(c){const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,c.arrayBuffer)}enableAttributes(c,h){for(let _=0;_<this.attributes.length;_++){const w=h.attributes[this.attributes[_].name];void 0!==w&&c.enableVertexAttribArray(w)}}setVertexAttribPointers(c,h,_){for(let w=0;w<this.attributes.length;w++){const C=this.attributes[w],I=h.attributes[C.name];void 0!==I&&c.vertexAttribPointer(I,C.components,c[Ni[C.type]],!1,this.itemSize,C.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class zt{constructor(c){this.gl=c.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(c){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Sn extends zt{getDefault(){return p.Color.transparent}set(c){const h=this.current;(c.r!==h.r||c.g!==h.g||c.b!==h.b||c.a!==h.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class ru extends zt{getDefault(){return 1}set(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)}}class Ya extends zt{getDefault(){return 0}set(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)}}class In extends zt{getDefault(){return[!0,!0,!0,!0]}set(c){const h=this.current;(c[0]!==h[0]||c[1]!==h[1]||c[2]!==h[2]||c[3]!==h[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class _o extends zt{getDefault(){return!0}set(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)}}class vl extends zt{getDefault(){return 255}set(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)}}class pn extends zt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(c){const h=this.current;(c.func!==h.func||c.ref!==h.ref||c.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)}}class Wr extends zt{getDefault(){const c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]}set(c){const h=this.current;(c[0]!==h[0]||c[1]!==h[1]||c[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)}}class yo extends zt{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;c?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=c,this.dirty=!1}}class ys extends zt{getDefault(){return[0,1]}set(c){const h=this.current;(c[0]!==h[0]||c[1]!==h[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)}}class qo extends zt{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;c?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=c,this.dirty=!1}}class vs extends zt{getDefault(){return this.gl.LESS}set(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)}}class On extends zt{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;c?h.enable(h.BLEND):h.disable(h.BLEND),this.current=c,this.dirty=!1}}class an extends zt{getDefault(){const c=this.gl;return[c.ONE,c.ZERO]}set(c){const h=this.current;(c[0]!==h[0]||c[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(c[0],c[1]),this.current=c,this.dirty=!1)}}class Wo extends zt{getDefault(){return p.Color.transparent}set(c){const h=this.current;(c.r!==h.r||c.g!==h.g||c.b!==h.b||c.a!==h.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class Xr extends zt{getDefault(){return this.gl.FUNC_ADD}set(c){(c!==this.current||this.dirty)&&(this.gl.blendEquation(c),this.current=c,this.dirty=!1)}}class la extends zt{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;c?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=c,this.dirty=!1}}class ca extends zt{getDefault(){return this.gl.BACK}set(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)}}class hi extends zt{getDefault(){return this.gl.CCW}set(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)}}class Qa extends zt{getDefault(){return null}set(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)}}class _c extends zt{getDefault(){return this.gl.TEXTURE0}set(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)}}class x extends zt{getDefault(){const c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]}set(c){const h=this.current;(c[0]!==h[0]||c[1]!==h[1]||c[2]!==h[2]||c[3]!==h[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class z extends zt{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,c),this.current=c,this.dirty=!1}}class ae extends zt{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class Oe extends zt{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,c),this.current=c,this.dirty=!1}}class Ve extends zt{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class le extends zt{getDefault(){return null}set(c){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class mn extends zt{constructor(c){super(c),this.vao=c.extVertexArrayObject}getDefault(){return null}set(c){this.vao&&(c!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(c),this.current=c,this.dirty=!1)}}class _i extends zt{getDefault(){return 4}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}}class Ii extends zt{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}}class un extends zt{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}}class Wn extends zt{constructor(c,h){super(c),this.context=c,this.parent=h}getDefault(){return null}}class Zr extends Wn{setDirty(){this.dirty=!0}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}}class Xo extends Wn{attachment(){return this.gl.DEPTH_ATTACHMENT}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,this.attachment(),h.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class li extends Xo{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class re{constructor(c,h,_,w){this.context=c,this.width=h,this.height=_;const C=this.framebuffer=c.gl.createFramebuffer();this.colorAttachment=new Zr(c,C),w&&(this.depthAttachment=new Xo(c,C))}destroy(){const c=this.context.gl,h=this.colorAttachment.get();if(h&&c.deleteTexture(h),this.depthAttachment){const _=this.depthAttachment.get();_&&c.deleteRenderbuffer(_)}c.deleteFramebuffer(this.framebuffer)}}class U{constructor(c){this.gl=c,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Sn(this),this.clearDepth=new ru(this),this.clearStencil=new Ya(this),this.colorMask=new In(this),this.depthMask=new _o(this),this.stencilMask=new vl(this),this.stencilFunc=new pn(this),this.stencilOp=new Wr(this),this.stencilTest=new yo(this),this.depthRange=new ys(this),this.depthTest=new qo(this),this.depthFunc=new vs(this),this.blend=new On(this),this.blendFunc=new an(this),this.blendColor=new Wo(this),this.blendEquation=new Xr(this),this.cullFace=new la(this),this.cullFaceSide=new ca(this),this.frontFace=new hi(this),this.program=new Qa(this),this.activeTexture=new _c(this),this.viewport=new x(this),this.bindFramebuffer=new z(this),this.bindRenderbuffer=new ae(this),this.bindTexture=new Oe(this),this.bindVertexBuffer=new Ve(this),this.bindElementBuffer=new le(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new mn(this),this.pixelStoreUnpack=new _i(this),this.pixelStoreUnpackPremultiplyAlpha=new Ii(this),this.pixelStoreUnpackFlipY=new un(this),this.extTextureFilterAnisotropic=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=c.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=c.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=c.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=c.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.extTextureHalfFloat=c.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(c.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=c.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=c.getExtension("OES_standard_derivatives"),this.extTimerQuery=c.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=c.getParameter(c.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(c,h){return new Hn(this,c,h)}createVertexBuffer(c,h,_){return new ir(this,c,h,_)}createRenderbuffer(c,h,_){const w=this.gl,C=w.createRenderbuffer();return this.bindRenderbuffer.set(C),w.renderbufferStorage(w.RENDERBUFFER,c,h,_),this.bindRenderbuffer.set(null),C}createFramebuffer(c,h,_){return new re(this,c,h,_)}clear({color:c,depth:h,stencil:_}){const w=this.gl;let C=0;c&&(C|=w.COLOR_BUFFER_BIT,this.clearColor.set(c),this.colorMask.set([!0,!0,!0,!0])),void 0!==h&&(C|=w.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),void 0!==_&&(C|=w.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),w.clear(C)}setCullFace(c){!1===c.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(c.mode),this.frontFace.set(c.frontFace))}setDepthMode(c){c.func!==this.gl.ALWAYS||c.mask?(this.depthTest.set(!0),this.depthFunc.set(c.func),this.depthMask.set(c.mask),this.depthRange.set(c.range)):this.depthTest.set(!1)}setStencilMode(c){c.test.func!==this.gl.ALWAYS||c.mask?(this.stencilTest.set(!0),this.stencilMask.set(c.mask),this.stencilOp.set([c.fail,c.depthFail,c.pass]),this.stencilFunc.set({func:c.test.func,ref:c.ref,mask:c.test.mask})):this.stencilTest.set(!1)}setColorMode(c){me(c.blendFunction,p.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(c.blendFunction),this.blendColor.set(c.blendColor)),this.colorMask.set(c.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class q extends p.Evented{constructor(c,h,_,w){super(),this.id=c,this.dispatcher=_,this.setEventedParent(w),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=p.extend({type:"raster"},h),p.extend(this,p.pick(h,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Tt(this._options,this.map._requestManager,null,null,(c,h)=>{this._tileJSONRequest=null,this._loaded=!0,c?this.fire(new p.ErrorEvent(c)):h&&(p.extend(this,h),h.bounds&&(this.tileBounds=new Jt(h.bounds,this.minzoom,this.maxzoom)),p.postTurnstileEvent(h.tiles),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(c){this.map=c,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return p.extend({},this._options)}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}loadTile(c,h){const _=p.exported.devicePixelRatio>=2,w=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),_,this.tileSize);c.request=p.getImage(this.map._requestManager.transformRequest(w,p.ResourceType.Tile),(C,I,k,R)=>(delete c.request,c.aborted?(c.state="unloaded",h(null)):C?(c.state="errored",h(C)):I?(this.map._refreshExpiredTiles&&c.setExpiryData({cacheControl:k,expires:R}),c.setTexture(I,this.map.painter),c.state="loaded",p.cacheEntryPossiblyAdded(this.dispatcher),void h(null)):h(null)))}static loadTileData(c,h,_){c.setTexture(h,_)}static unloadTileData(c,h){c.texture&&h.saveTileTexture(c.texture)}abortTile(c,h){c.request&&(c.request.cancel(),delete c.request),h()}unloadTile(c,h){c.texture&&this.map.painter.saveTileTexture(c.texture),h()}hasTransition(){return!1}}let oe;function fe(g,c,h,_,w,C,I,k){const R=[g,h,w,c,_,C,1,1,1],F=[I,k,1],N=p.adjoint([],R),[H,X,te]=p.transformMat3(F,F,p.transpose(N,N));return p.multiply$1(R,[H,0,0,0,X,0,0,0,te],R)}class Te extends p.Evented{constructor(c,h,_,w){super(),this.id=c,this.dispatcher=_,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(w),this.options=h,this._dirty=!1}load(c,h){this._loaded=h||!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=p.getImage(this.map._requestManager.transformRequest(this.url,p.ResourceType.Image),(_,w)=>{if(this._imageRequest=null,this._loaded=!0,_)this.fire(new p.ErrorEvent(_));else if(w){const{HTMLImageElement:C}=p.window;this.image=w instanceof C?p.exported.getImageData(w):w,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,c&&(this.coordinates=c),this._finishLoading()}})}loaded(){return this._loaded}updateImage(c){return this.image&&c.url?(this._imageRequest&&c.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=c.url,this.load(c.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(c){this.map=c,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(c){this.coordinates=c,this._boundsArray=void 0;const h=c.map(p.MercatorCoordinate.fromLngLat);return this.tileID=function(_){let w=1/0,C=1/0,I=-1/0,k=-1/0;for(const H of _)w=Math.min(w,H.x),C=Math.min(C,H.y),I=Math.max(I,H.x),k=Math.max(k,H.y);const R=Math.max(I-w,k-C),F=Math.max(0,Math.floor(-Math.log(R)/Math.LN2)),N=Math.pow(2,F);return new p.CanonicalTileID(F,Math.floor((w+I)/2*N),Math.floor((C+k)/2*N))}(h),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(c){for(const R in this.tiles){const F=this.tiles[R];"loaded"!==F.state&&(F.state="loaded",F.texture=this.texture)}if(this._boundsArray)return;const h=p.tileTransform(this.tileID,this.map.transform.projection),[_,w,C,I]=this.coordinates.map(R=>{const F=h.projection.project(R[0],R[1]);return p.getTilePoint(h,F)._round()});this.perspectiveTransform=function(R,F,N,H,X,te,Q,ne,K,Y){const se=fe(0,0,R,0,0,F,R,F),J=fe(N,H,X,te,Q,ne,K,Y);return p.multiply$1(J,p.adjoint(se,se),J),[J[6]/J[8]*R/p.EXTENT,J[7]/J[8]*F/p.EXTENT]}(this.width,this.height,_.x,_.y,w.x,w.y,I.x,I.y,C.x,C.y);const k=this._boundsArray=new p.StructArrayLayout4i8;k.emplaceBack(_.x,_.y,0,0),k.emplaceBack(w.x,w.y,p.EXTENT,0),k.emplaceBack(I.x,I.y,0,p.EXTENT),k.emplaceBack(C.x,C.y,p.EXTENT,p.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=c.createVertexBuffer(k,p.boundsAttributes.members),this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const c=this.map.painter.context,h=c.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new p.Texture(c,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(c)}loadTile(c,h){this.tileID&&this.tileID.equals(c.tileID.canonical)?(this.tiles[String(c.tileID.wrap)]=c,c.buckets={},h(null)):(c.state="errored",h(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const je={vector:class extends p.Evented{constructor(g,c,h,_){if(super(),this.id=g,this.dispatcher=h,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,p.extend(this,p.pick(c,["url","scheme","tileSize","promoteId"])),this._options=p.extend({type:"vector"},c),this._collectResourceTiming=c.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_),this._tileWorkers={},this._deduped=new p.DedupedRequest}load(g){this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"}));const c=Array.isArray(this.map._language)?this.map._language.join():this.map._language,h=this.map._worldview;this._tileJSONRequest=Tt(this._options,this.map._requestManager,c,h,(_,w)=>{this._tileJSONRequest=null,this._loaded=!0,_?(c&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${c}`),h&&2!==h.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${h}`),this.fire(new p.ErrorEvent(_))):w&&(p.extend(this,w),w.bounds&&(this.tileBounds=new Jt(w.bounds,this.minzoom,this.maxzoom)),p.postTurnstileEvent(w.tiles,this.map._requestManager._customAccessToken),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))),g&&g(_)})}loaded(){return this._loaded}hasTile(g){return!this.tileBounds||this.tileBounds.contains(g.canonical)}onAdd(g){this.map=g,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>{const g=this.map.style._getSourceCaches(this.id);for(const c of g)c.clearTiles()})}setSourceProperty(g){g(),this.reload()}setTiles(g){return this._options.tiles=g,this.reload(),this}setUrl(g){return this.url=g,this._options.url=g,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return p.extend({},this._options)}loadTile(g,c){const h=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme)),_={request:this.map._requestManager.transformRequest(h,p.ResourceType.Tile),data:void 0,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,tileSize:this.tileSize*g.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:p.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:g.isSymbolTile};if(_.request.collectResourceTiming=this._collectResourceTiming,g.actor&&"expired"!==g.state)"loading"===g.state?g.reloadCallback=c:g.request=g.actor.send("reloadTile",_,w.bind(this));else if(g.actor=this._tileWorkers[h]=this._tileWorkers[h]||this.dispatcher.getActor(),this.dispatcher.ready)g.request=g.actor.send("loadTile",_,w.bind(this),void 0,!0);else{const C=p.loadVectorTile.call({deduped:this._deduped},_,(I,k)=>{I||!k?w.call(this,I):(_.data={cacheControl:k.cacheControl,expires:k.expires,rawData:k.rawData.slice(0)},g.actor&&g.actor.send("loadTile",_,w.bind(this),void 0,!0))},!0);g.request={cancel:C}}function w(C,I){return delete g.request,g.aborted?c(null):C&&404!==C.status?c(C):(I&&I.resourceTiming&&(g.resourceTiming=I.resourceTiming),this.map._refreshExpiredTiles&&I&&g.setExpiryData(I),g.loadVectorData(I,this.map.painter),p.cacheEntryPossiblyAdded(this.dispatcher),c(null),void(g.reloadCallback&&(this.loadTile(g,g.reloadCallback),g.reloadCallback=null)))}}abortTile(g){g.request&&(g.request.cancel(),delete g.request),g.actor&&g.actor.send("abortTile",{uid:g.uid,type:this.type,source:this.id})}unloadTile(g){g.unloadVectorData(),g.actor&&g.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}},raster:q,"raster-dem":class extends q{constructor(g,c,h,_){super(g,c,h,_),this.type="raster-dem",this.maxzoom=22,this._options=p.extend({type:"raster-dem"},c),this.encoding=c.encoding||"mapbox"}loadTile(g,c){const h=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function _(w,C){w&&(g.state="errored",c(w)),C&&(g.dem=C,g.dem.onDeserialize(),g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0,g.state="loaded",c(null))}g.request=p.getImage(this.map._requestManager.transformRequest(h,p.ResourceType.Tile),function(w,C,I,k){if(delete g.request,g.aborted)g.state="unloaded",c(null);else if(w)g.state="errored",c(w);else if(C){this.map._refreshExpiredTiles&&g.setExpiryData({cacheControl:I,expires:k});const R=p.window.ImageBitmap&&C instanceof p.window.ImageBitmap&&(null==oe&&(oe=p.window.OffscreenCanvas&&new p.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof p.window.createImageBitmap),oe),F=1-(C.width-p.prevPowerOfTwo(C.width))/2;F<1||g.neighboringTiles||(g.neighboringTiles=this._getNeighboringTiles(g.tileID));const N=R?C:p.exported.getImageData(C,F),H={uid:g.uid,coord:g.tileID,source:this.id,rawImageData:N,encoding:this.encoding,padding:F};g.actor&&"expired"!==g.state||(g.actor=this.dispatcher.getActor(),g.actor.send("loadDEMTile",H,_.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(g){const c=g.canonical,h=Math.pow(2,c.z),_=(c.x-1+h)%h,w=0===c.x?g.wrap-1:g.wrap,C=(c.x+1+h)%h,I=c.x+1===h?g.wrap+1:g.wrap,k={};return k[new p.OverscaledTileID(g.overscaledZ,w,c.z,_,c.y).key]={backfilled:!1},k[new p.OverscaledTileID(g.overscaledZ,I,c.z,C,c.y).key]={backfilled:!1},c.y>0&&(k[new p.OverscaledTileID(g.overscaledZ,w,c.z,_,c.y-1).key]={backfilled:!1},k[new p.OverscaledTileID(g.overscaledZ,g.wrap,c.z,c.x,c.y-1).key]={backfilled:!1},k[new p.OverscaledTileID(g.overscaledZ,I,c.z,C,c.y-1).key]={backfilled:!1}),c.y+1<h&&(k[new p.OverscaledTileID(g.overscaledZ,w,c.z,_,c.y+1).key]={backfilled:!1},k[new p.OverscaledTileID(g.overscaledZ,g.wrap,c.z,c.x,c.y+1).key]={backfilled:!1},k[new p.OverscaledTileID(g.overscaledZ,I,c.z,C,c.y+1).key]={backfilled:!1}),k}unloadTile(g){g.demTexture&&this.map.painter.saveTileTexture(g.demTexture),g.fbo&&(g.fbo.destroy(),delete g.fbo),g.dem&&delete g.dem,delete g.neighboringTiles,g.state="unloaded"}},geojson:class extends p.Evented{constructor(g,c,h,_){super(),this.id=g,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=h.getActor(),this.setEventedParent(_),this._data=c.data,this._options=p.extend({},c),this._collectResourceTiming=c.collectResourceTiming,void 0!==c.maxzoom&&(this.maxzoom=c.maxzoom),c.type&&(this.type=c.type),c.attribution&&(this.attribution=c.attribution),this.promoteId=c.promoteId;const w=p.EXTENT/this.tileSize;this.workerOptions=p.extend({source:this.id,cluster:c.cluster||!1,geojsonVtOptions:{buffer:(void 0!==c.buffer?c.buffer:128)*w,tolerance:(void 0!==c.tolerance?c.tolerance:.375)*w,extent:p.EXTENT,maxZoom:this.maxzoom,lineMetrics:c.lineMetrics||!1,generateId:c.generateId||!1},superclusterOptions:{maxZoom:void 0!==c.clusterMaxZoom?c.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,c.clusterMinPoints||2),extent:p.EXTENT,radius:(void 0!==c.clusterRadius?c.clusterRadius:50)*w,log:!1,generateId:c.generateId||!1},clusterProperties:c.clusterProperties,filter:c.filter},c.workerOptions)}onAdd(g){this.map=g,this.setData(this._data)}setData(g){return this._data=g,this._updateWorkerData(),this}getClusterExpansionZoom(g,c){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:g,source:this.id},c),this}getClusterChildren(g,c){return this.actor.send("geojson.getClusterChildren",{clusterId:g,source:this.id},c),this}getClusterLeaves(g,c,h,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:g,limit:c,offset:h},_),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new p.Event("dataloading",{dataType:"source"})),this._loaded=!1;const g=p.extend({},this.workerOptions),c=this._data;"string"==typeof c?(g.request=this.map._requestManager.transformRequest(p.exported.resolveURL(c),p.ResourceType.Source),g.request.collectResourceTiming=this._collectResourceTiming):g.data=JSON.stringify(c),this._pendingLoad=this.actor.send(`${this.type}.loadData`,g,(h,_)=>{if(this._loaded=!0,this._pendingLoad=null,h)this.fire(new p.ErrorEvent(h));else{const w={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(w.resourceTiming=_.resourceTiming[this.id]),this.fire(new p.Event("data",w)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(g,c){const h=g.actor?"reloadTile":"loadTile";g.actor=this.actor,g.request=this.actor.send(h,{type:this.type,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:p.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(_,w)=>(delete g.request,g.unloadVectorData(),g.aborted?c(null):_?c(_):(g.loadVectorData(w,this.map.painter,"reloadTile"===h),c(null))),void 0,"loadTile"===h)}abortTile(g){g.request&&(g.request.cancel(),delete g.request),g.aborted=!0}unloadTile(g){g.unloadVectorData(),this.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return p.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Te{constructor(g,c,h,_){super(g,c,h,_),this.roundZoom=!0,this.type="video",this.options=c}load(){this._loaded=!1;const g=this.options;this.urls=[];for(const c of g.urls)this.urls.push(this.map._requestManager.transformRequest(c,p.ResourceType.Source).url);p.getVideo(this.urls,(c,h)=>{this._loaded=!0,c?this.fire(new p.ErrorEvent(c)):h&&(this.video=h,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(g){if(this.video){const c=this.video.seekable;g<c.start(0)||g>c.end(0)?this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${c.start(0)} and ${c.end(0)}-second mark.`))):this.video.currentTime=g}}getVideo(){return this.video}onAdd(g){this.map||(this.map=g,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const g=this.map.painter.context,c=g.gl;this.texture?this.video.paused||(this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),c.texSubImage2D(c.TEXTURE_2D,0,0,0,c.RGBA,c.UNSIGNED_BYTE,this.video)):(this.texture=new p.Texture(g,this.video,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(g)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Te,canvas:class extends Te{constructor(g,c,h,_){super(g,c,h,_),c.coordinates?Array.isArray(c.coordinates)&&4===c.coordinates.length&&!c.coordinates.some(w=>!Array.isArray(w)||2!==w.length||w.some(C=>"number"!=typeof C))||this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${g}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${g}`,null,'missing required property "coordinates"'))),c.animate&&"boolean"!=typeof c.animate&&this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${g}`,null,'optional "animate" property must be a boolean value'))),c.canvas?"string"==typeof c.canvas||c.canvas instanceof p.window.HTMLCanvasElement||this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${g}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${g}`,null,'missing required property "canvas"'))),this.options=c,this.animate=void 0===c.animate||c.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof p.window.HTMLCanvasElement?this.options.canvas:p.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new p.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(g){this.map=g,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let g=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,g=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,g=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const c=this.map.painter.context;this.texture?(g||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new p.Texture(c,this.canvas,c.gl.RGBA,{premultiply:!0}),this._prepareData(c)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const g of[this.canvas.width,this.canvas.height])if(isNaN(g)||g<=0)return!0;return!1}},custom:class extends p.Evented{constructor(g,c,h,_){super(),this.id=g,this.type="custom",this._dataType="raster",this._dispatcher=h,this._implementation=c,this.setEventedParent(_),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new p.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new p.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Jt(this._implementation.bounds,this.minzoom,this.maxzoom)),c.update=this._update.bind(this),c.clearTiles=this._clearTiles.bind(this),c.coveringTiles=this._coveringTiles.bind(this),p.extend(this,p.pick(c,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return p.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(g){this._map=g,this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(g),this.load()}onRemove(g){this._implementation.onRemove&&this._implementation.onRemove(g)}hasTile(g){if(this._implementation.hasTile){const{x:c,y:h,z:_}=g.canonical;return this._implementation.hasTile({x:c,y:h,z:_})}return!this.tileBounds||this.tileBounds.contains(g.canonical)}loadTile(g,c){const{x:h,y:_,z:w}=g.tileID.canonical,C=new p.window.AbortController;g.request=Promise.resolve(this._implementation.loadTile({x:h,y:_,z:w},{signal:C.signal})).then(function(I){return delete g.request,g.aborted?(g.state="unloaded",c(null)):void 0===I?(g.state="errored",c(null)):null===I?(this.loadTileData(g,{width:this.tileSize,height:this.tileSize,data:null}),g.state="loaded",c(null)):(k=I)instanceof p.window.ImageData||k instanceof p.window.HTMLCanvasElement||k instanceof p.window.ImageBitmap||k instanceof p.window.HTMLImageElement?(this.loadTileData(g,I),g.state="loaded",void c(null)):(g.state="errored",c(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var k}.bind(this)).catch(I=>{20!==I.code&&(g.state="errored",c(I))}),g.request.cancel=()=>C.abort()}loadTileData(g,c){q.loadTileData(g,c,this._map.painter)}unloadTileData(g){q.unloadTileData(g,this._map.painter)}unloadTile(g,c){if(this.unloadTileData(g),this._implementation.unloadTile){const{x:h,y:_,z:w}=g.tileID.canonical;this._implementation.unloadTile({x:h,y:_,z:w})}c()}abortTile(g,c){g.request&&g.request.cancel&&(g.request.cancel(),delete g.request),c()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(g=>({x:g.canonical.x,y:g.canonical.y,z:g.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))}}},de=function(g,c,h,_){const w=new je[c.type](g,c,h,_);if(w.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${w.id}`);return p.bindAll(["load","abort","unload","serialize","prepare"],w),w};function be(g,c){const h=p.identity([]);return p.scale(h,h,[.5*g.width,.5*-g.height,1]),p.translate(h,h,[1,-1,0]),p.multiply(h,h,g.calculateProjMatrix(c.toUnwrapped())),Float32Array.from(h)}function ke(g,c,h,_,w,C,I,k=!1){const R=g.tilesIn(_,I,k);R.sort(Vt);const F=[];for(const H of R)F.push({wrappedTileID:H.tile.tileID.wrapped().key,queryResults:H.tile.queryRenderedFeatures(c,h,g._state,H,w,C,be(g.transform,H.tile.tileID),k)});const N=function(H){const X={},te={};for(const Q of H){const ne=Q.queryResults,K=Q.wrappedTileID,Y=te[K]=te[K]||{};for(const se in ne){const J=ne[se],_e=Y[se]=Y[se]||{},ve=X[se]=X[se]||[];for(const he of J)_e[he.featureIndex]||(_e[he.featureIndex]=!0,ve.push(he))}}return X}(F);for(const H in N)N[H].forEach(X=>{const te=X.feature,Q=te.layer;Q&&"background"!==Q.type&&"sky"!==Q.type&&(te.source=Q.source,Q["source-layer"]&&(te.sourceLayer=Q["source-layer"]),te.state=void 0!==te.id?g.getFeatureState(Q["source-layer"],te.id):{})});return N}function ht(g,c){const h=g.getRenderableIds().map(C=>g.getTileByID(C)),_=[],w={};for(let C=0;C<h.length;C++){const I=h[C],k=I.tileID.canonical.key;w[k]||(w[k]=!0,I.querySourceFeatures(_,c))}return _}function Vt(g,c){const h=g.tileID,_=c.tileID;return h.overscaledZ-_.overscaledZ||h.canonical.y-_.canonical.y||h.wrap-_.wrap||h.canonical.x-_.canonical.x}function At(){return null!=Al.workerClass?new Al.workerClass:new p.window.Worker(Al.workerUrl)}const Ln="mapboxgl_preloaded_worker_pool";class An{constructor(){this.active={}}acquire(c){if(!this.workers)for(this.workers=[];this.workers.length<An.workerCount;)this.workers.push(new At);return this.active[c]=!0,this.workers.slice()}release(c){delete this.active[c],0===this.numActive()&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ln]}numActive(){return Object.keys(this.active).length}}let Dn;function Xn(){return Dn||(Dn=new An),Dn}function pi(g,c){const h={};for(const _ in g)"ref"!==_&&(h[_]=g[_]);return p.refProperties.forEach(_=>{_ in c&&(h[_]=c[_])}),h}function qi(g){g=g.slice();const c=Object.create(null);for(let h=0;h<g.length;h++)c[g[h].id]=g[h];for(let h=0;h<g.length;h++)"ref"in g[h]&&(g[h]=pi(g[h],c[g[h].ref]));return g}An.workerCount=2;const $n={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function lr(g,c,h){h.push({command:$n.addSource,args:[g,c[g]]})}function _r(g,c,h){c.push({command:$n.removeSource,args:[g]}),h[g]=!0}function Ul(g,c,h,_){_r(g,h,_),lr(g,c,h)}function xl(g,c,h){let _;for(_ in g[h])if(g[h].hasOwnProperty(_)&&"data"!==_&&!me(g[h][_],c[h][_]))return!1;for(_ in c[h])if(c[h].hasOwnProperty(_)&&"data"!==_&&!me(g[h][_],c[h][_]))return!1;return!0}function ct(g,c,h,_,w,C){let I;for(I in c=c||{},g=g||{})g.hasOwnProperty(I)&&(me(g[I],c[I])||h.push({command:C,args:[_,I,c[I],w]}));for(I in c)c.hasOwnProperty(I)&&!g.hasOwnProperty(I)&&(me(g[I],c[I])||h.push({command:C,args:[_,I,c[I],w]}))}function Ka(g){return g.id}function co(g,c){return g[c.id]=c,g}class Hl{constructor(c,h){this.reset(c,h)}reset(c,h){this.points=c||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(c){if(1===this.points.length)return this.points[0];c=p.clamp(c,0,1);let h=1,_=this._distances[h];const w=c*this.paddedLength+this.padding;for(;_<w&&h<this._distances.length;)_=this._distances[++h];const C=h-1,I=this._distances[C],k=_-I,R=k>0?(w-I)/k:0;return this.points[C].mult(1-R).add(this.points[h].mult(R))}}class vo{constructor(c,h,_){const w=this.boxCells=[],C=this.circleCells=[];this.xCellCount=Math.ceil(c/_),this.yCellCount=Math.ceil(h/_);for(let I=0;I<this.xCellCount*this.yCellCount;I++)w.push([]),C.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=c,this.height=h,this.xScale=this.xCellCount/c,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(c,h,_,w,C){this._forEachCell(h,_,w,C,this._insertBoxCell,this.boxUid++),this.boxKeys.push(c),this.bboxes.push(h),this.bboxes.push(_),this.bboxes.push(w),this.bboxes.push(C)}insertCircle(c,h,_,w){this._forEachCell(h-w,_-w,h+w,_+w,this._insertCircleCell,this.circleUid++),this.circleKeys.push(c),this.circles.push(h),this.circles.push(_),this.circles.push(w)}_insertBoxCell(c,h,_,w,C,I){this.boxCells[C].push(I)}_insertCircleCell(c,h,_,w,C,I){this.circleCells[C].push(I)}_query(c,h,_,w,C,I){if(_<0||c>this.width||w<0||h>this.height)return!C&&[];const k=[];if(c<=0&&h<=0&&this.width<=_&&this.height<=w){if(C)return!0;for(let R=0;R<this.boxKeys.length;R++)k.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(let R=0;R<this.circleKeys.length;R++){const F=this.circles[3*R],N=this.circles[3*R+1],H=this.circles[3*R+2];k.push({key:this.circleKeys[R],x1:F-H,y1:N-H,x2:F+H,y2:N+H})}return I?k.filter(I):k}return this._forEachCell(c,h,_,w,this._queryCell,k,{hitTest:C,seenUids:{box:{},circle:{}}},I),C?k.length>0:k}_queryCircle(c,h,_,w,C){const I=c-_,k=c+_,R=h-_,F=h+_;if(k<0||I>this.width||F<0||R>this.height)return!w&&[];const N=[];return this._forEachCell(I,R,k,F,this._queryCellCircle,N,{hitTest:w,circle:{x:c,y:h,radius:_},seenUids:{box:{},circle:{}}},C),w?N.length>0:N}query(c,h,_,w,C){return this._query(c,h,_,w,!1,C)}hitTest(c,h,_,w,C){return this._query(c,h,_,w,!0,C)}hitTestCircle(c,h,_,w){return this._queryCircle(c,h,_,!0,w)}_queryCell(c,h,_,w,C,I,k,R){const F=k.seenUids,N=this.boxCells[C];if(null!==N){const X=this.bboxes;for(const te of N)if(!F.box[te]){F.box[te]=!0;const Q=4*te;if(c<=X[Q+2]&&h<=X[Q+3]&&_>=X[Q+0]&&w>=X[Q+1]&&(!R||R(this.boxKeys[te]))){if(k.hitTest)return I.push(!0),!0;I.push({key:this.boxKeys[te],x1:X[Q],y1:X[Q+1],x2:X[Q+2],y2:X[Q+3]})}}}const H=this.circleCells[C];if(null!==H){const X=this.circles;for(const te of H)if(!F.circle[te]){F.circle[te]=!0;const Q=3*te;if(this._circleAndRectCollide(X[Q],X[Q+1],X[Q+2],c,h,_,w)&&(!R||R(this.circleKeys[te]))){if(k.hitTest)return I.push(!0),!0;{const ne=X[Q],K=X[Q+1],Y=X[Q+2];I.push({key:this.circleKeys[te],x1:ne-Y,y1:K-Y,x2:ne+Y,y2:K+Y})}}}}}_queryCellCircle(c,h,_,w,C,I,k,R){const F=k.circle,N=k.seenUids,H=this.boxCells[C];if(null!==H){const te=this.bboxes;for(const Q of H)if(!N.box[Q]){N.box[Q]=!0;const ne=4*Q;if(this._circleAndRectCollide(F.x,F.y,F.radius,te[ne+0],te[ne+1],te[ne+2],te[ne+3])&&(!R||R(this.boxKeys[Q])))return I.push(!0),!0}}const X=this.circleCells[C];if(null!==X){const te=this.circles;for(const Q of X)if(!N.circle[Q]){N.circle[Q]=!0;const ne=3*Q;if(this._circlesCollide(te[ne],te[ne+1],te[ne+2],F.x,F.y,F.radius)&&(!R||R(this.circleKeys[Q])))return I.push(!0),!0}}}_forEachCell(c,h,_,w,C,I,k,R){const F=this._convertToXCellCoord(c),N=this._convertToYCellCoord(h),H=this._convertToXCellCoord(_),X=this._convertToYCellCoord(w);for(let te=F;te<=H;te++)for(let Q=N;Q<=X;Q++)if(C.call(this,c,h,_,w,this.xCellCount*Q+te,I,k,R))return}_convertToXCellCoord(c){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(c*this.xScale)))}_convertToYCellCoord(c){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(c*this.yScale)))}_circlesCollide(c,h,_,w,C,I){const k=w-c,R=C-h,F=_+I;return F*F>k*k+R*R}_circleAndRectCollide(c,h,_,w,C,I,k){const R=(I-w)/2,F=Math.abs(c-(w+R));if(F>R+_)return!1;const N=(k-C)/2,H=Math.abs(h-(C+N));if(H>N+_)return!1;if(F<=R||H<=N)return!0;const X=F-R,te=H-N;return X*X+te*te<=_*_}}const rr=Math.tan(85*Math.PI/180);function yc(g,c,h,_,w,C,I){const k=p.create();if(h)if("globe"===C.name){const R=p.calculateGlobeLabelMatrix(w,c);p.multiply(k,k,R)}else{const R=Ae([],I);k[0]=R[0],k[1]=R[1],k[4]=R[2],k[5]=R[3],_||p.rotateZ(k,k,w.angle)}else p.multiply(k,w.labelPlaneMatrix,g);return k}function sh(g,c,h,_,w,C,I){const k=yc(g,c,h,_,w,C,I);return"globe"===C.name&&h||(k[2]=k[6]=k[10]=k[14]=0),k}function cr(g,c,h,_,w,C,I){if(h){if("globe"===C.name){const k=yc(g,c,h,_,w,C,I);return p.invert(k,k),p.multiply(k,g,k),k}{const k=p.clone(g),R=p.identity([]);return R[0]=I[0],R[1]=I[1],R[4]=I[2],R[5]=I[3],p.multiply(k,k,R),_||p.rotateZ(k,k,-w.angle),k}}return w.glCoordMatrix}function qt(g,c,h=0){const _=[g.x,g.y,h,1];h?p.transformMat4$1(_,_,c):Np(_,_,c);const w=_[3];return{point:[_[0]/w,_[1]/w,_[2]/w],signedDistanceFromCamera:w}}function xn(g,c){const h=[g[0],g[1],g[2],1];p.transformMat4$1(h,h,c);const _=h[3];return{point:[h[0]/_,h[1]/_,h[2]/_],signedDistanceFromCamera:_}}function Ti(g,c){return Math.min(.5+g/c*.5,1.5)}function Ja(g,c){const h=g[0]/g[3],_=g[1]/g[3];return h>=-c[0]&&h<=c[0]&&_>=-c[1]&&_<=c[1]}function Ri(g,c,h,_,w,C,I,k,R,F){const N=h.transform,H=_?g.textSizeData:g.iconSizeData,X=p.evaluateSizeForZoom(H,h.transform.zoom),te="globe"===N.projection.name,Q=[256/h.width*2+1,256/h.height*2+1],ne=_?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;ne.clear();let K=null;te&&(K=_?g.text.globeExtVertexArray:g.icon.globeExtVertexArray);const Y=g.lineVertexArray,se=_?g.text.placedSymbolArray:g.icon.placedSymbolArray,J=h.transform.width/h.transform.height;let _e=!1;for(let ve=0;ve<se.length;ve++){const he=se.get(ve);if(he.writingMode!==p.WritingMode.vertical||_e||0!==ve&&se.get(ve-1).writingMode===p.WritingMode.horizontal||(_e=!0),(he.hidden||he.writingMode===p.WritingMode.vertical)&&!_e){Ia(he.numGlyphs,ne);continue}_e=!1;const Ce=new p.pointGeometry(he.tileAnchorX,he.tileAnchorY),He=R?R(Ce):[0,0,0],it=N.projection.projectTilePoint(Ce.x,Ce.y,F.canonical),Qe=[it.x+He[0],it.y+He[1],it.z+He[2]],wt=[...Qe,1];if(p.transformMat4$1(wt,wt,c),!Ja(wt,Q)){Ia(he.numGlyphs,ne);continue}const Le=Ti(h.transform.cameraToCenterDistance,wt[3]),ft=p.evaluateSizeForFeature(H,X,he),gt=I?ft/Le:ft*Le,qe=qt(new p.pointGeometry(Qe[0],Qe[1]),w,Qe[2]);if(qe.signedDistanceFromCamera<=0){Ia(he.numGlyphs,ne);continue}let Me={};const Gt=I?null:R,It=Wu(he,gt,!1,k,c,w,C,g.glyphOffsetArray,Y,ne,K,qe.point,Ce,Me,J,Gt,N.projection,F,I);_e=It.useVertical,Gt&&It.needsFlipping&&(Me={}),(It.notEnoughRoom||_e||It.needsFlipping&&Wu(he,gt,!0,k,c,w,C,g.glyphOffsetArray,Y,ne,K,qe.point,Ce,Me,J,Gt,N.projection,F,I).notEnoughRoom)&&Ia(he.numGlyphs,ne)}_?(g.text.dynamicLayoutVertexBuffer.updateData(ne),K&&g.text.globeExtVertexBuffer.updateData(K)):(g.icon.dynamicLayoutVertexBuffer.updateData(ne),K&&g.icon.globeExtVertexBuffer.updateData(K))}function Zt(g,c,h,_,w,C,I,k,R,F,N,H,X,te,Q,ne){const K=k.glyphStartIndex+k.numGlyphs,Y=k.lineStartIndex,se=k.lineStartIndex+k.lineLength,J=c.getoffsetX(k.glyphStartIndex),_e=c.getoffsetX(K-1),ve=Cn(g*J,h,_,w,C,I,k.segment,Y,se,R,F,N,H,X,!0,te,Q,ne);if(!ve)return null;const he=Cn(g*_e,h,_,w,C,I,k.segment,Y,se,R,F,N,H,X,!0,te,Q,ne);return he?{first:ve,last:he}:null}function vc(g,c,h,_){return g.writingMode===p.WritingMode.horizontal&&Math.abs(h.y-c.y)>Math.abs(h.x-c.x)*_?{useVertical:!0}:g.writingMode===p.WritingMode.vertical?c.y<h.y?{needsFlipping:!0}:null:0!==g.flipState&&function(w,C,I){const k=(C.x-w.x)*I;return 0===k||Math.abs((C.y-w.y)/k)>rr}(c,h,_)?1===g.flipState?{needsFlipping:!0}:null:c.x>h.x?{needsFlipping:!0}:null}function Wu(g,c,h,_,w,C,I,k,R,F,N,H,X,te,Q,ne,K,Y,se){const J=c/24,_e=g.lineOffsetX*J,ve=g.lineOffsetY*J;let he=[];if(g.numGlyphs>1){const Ce=g.glyphStartIndex+g.numGlyphs,He=g.lineStartIndex,it=g.lineStartIndex+g.lineLength,Qe=Zt(J,k,_e,ve,h,H,X,g,R,C,te,ne,!1,K,Y,se);if(!Qe)return{notEnoughRoom:!0};const wt=xn(Qe.first.point,I).point,Le=xn(Qe.last.point,I).point,ft=new p.pointGeometry(wt[0],wt[1]),gt=new p.pointGeometry(Le[0],Le[1]);if(_&&!h){const qe=vc(g,ft,gt,Q);if(g.flipState=qe&&qe.needsFlipping?1:2,qe)return qe}he=[Qe.first];for(let qe=g.glyphStartIndex+1;qe<Ce-1;qe++){const Me=Cn(J*k.getoffsetX(qe),_e,ve,h,H,X,g.segment,He,it,R,C,te,ne,!1,!1,K,Y,se);if(!Me)return{notEnoughRoom:!0};he.push(Me)}he.push(Qe.last)}else{if(_&&!h){const He=qt(X,w).point,it=g.lineStartIndex+g.segment+1,Qe=new p.pointGeometry(R.getx(it),R.gety(it)),wt=qt(Qe,w),Le=wt.signedDistanceFromCamera>0?wt.point:Jo(X,Qe,He,1,w,void 0,K,Y.canonical),ft=vc(g,new p.pointGeometry(He[0],He[1]),new p.pointGeometry(Le[0],Le[1]),Q);if(g.flipState=ft&&ft.needsFlipping?1:2,ft)return ft}const Ce=Cn(J*k.getoffsetX(g.glyphStartIndex),_e,ve,h,H,X,g.segment,g.lineStartIndex,g.lineStartIndex+g.lineLength,R,C,te,ne,!1,!1,K,Y,se);if(!Ce)return{notEnoughRoom:!0};he=[Ce]}if(N)for(const Ce of he)p.updateGlobeVertexNormal(N,F.length+0,Ce.up[0],Ce.up[1],Ce.up[2]),p.updateGlobeVertexNormal(N,F.length+1,Ce.up[0],Ce.up[1],Ce.up[2]),p.updateGlobeVertexNormal(N,F.length+2,Ce.up[0],Ce.up[1],Ce.up[2]),p.updateGlobeVertexNormal(N,F.length+3,Ce.up[0],Ce.up[1],Ce.up[2]),p.addDynamicAttributes(F,Ce.point[0],Ce.point[1],Ce.point[2],Ce.angle);else for(const Ce of he)p.addDynamicAttributes(F,Ce.point[0],Ce.point[1],Ce.point[2],Ce.angle);return{}}function Dt(g,c,h,_,w){const C=_.projectTilePoint(g.x,g.y,c);if(!w)return qt(C,h,C.z);const I=w(g);return qt(new p.pointGeometry(C.x+I[0],C.y+I[1]),h,C.z+I[2])}function Jo(g,c,h,_,w,C,I,k){const R=Dt(g.add(g.sub(c)._unit()),k,w,I,C).point,F=p.sub([],h,R);return p.scaleAndAdd([],h,F,_/p.length(F))}function Cn(g,c,h,_,w,C,I,k,R,F,N,H,X,te,Q,ne,K,Y){const se=_?g-c:g+c;let J=se>0?1:-1,_e=0;_&&(J*=-1,_e=Math.PI),J<0&&(_e+=Math.PI);let ve=J>0?k+I:k+I+1,he=w,Ce=w,He=0,it=0;const Qe=Math.abs(se),wt=[],Le=[];let ft=C;const gt=()=>{const Nt=ve-J;return 0===He?C:new p.pointGeometry(F.getx(Nt),F.gety(Nt))},qe=()=>{const Nt=gt();return Jo(Nt,ft||Nt,Ce,Qe-He+1,N,X,ne,K.canonical)};for(;He+it<=Qe;){if(ve+=J,ve<k||ve>=R)return null;if(Ce=he,wt.push(he),te&&Le.push(ft||gt()),he=H[ve],void 0===he){ft=new p.pointGeometry(F.getx(ve),F.gety(ve));const Nt=Dt(ft,K.canonical,N,ne,X);he=Nt.signedDistanceFromCamera>0?H[ve]=Nt.point:qe()}else ft=null;He+=it,it=p.distance(Ce,he)}ft=ft||new p.pointGeometry(F.getx(ve),F.gety(ve));const Me=gt();Q&&X&&(H[ve]=he=void 0===H[ve]?he:qe(),it=p.distance(Ce,he));const Gt=(Qe-He)/it,It=ft.sub(Me).mult(Gt)._add(Me),jt=p.sub([],he,Ce),Lt=p.scaleAndAdd([],Ce,jt,Gt);let bn=[0,0,1],Gn=jt[0],Rn=jt[1];if(Y&&(bn=ne.upVector(K.canonical,It.x,It.y),0!==bn[0]||0!==bn[1]||1!==bn[2])){const Nt=[1,0,0],Jn=[0,1,0];Nt[0]=bn[2],Nt[1]=0,Nt[2]=-bn[0],p.cross(Jn,bn,Nt),p.normalize(Nt,Nt),p.normalize(Jn,Jn),Gn=p.dot(jt,Nt),Rn=p.dot(jt,Jn)}if(h){const Nt=p.cross([],bn,jt);p.normalize(Nt,Nt),p.scaleAndAdd(Lt,Lt,Nt,h*J)}const yn=_e+Math.atan2(Rn,Gn);return wt.push(Lt),te&&Le.push(It),{point:Lt,angle:yn,path:wt,tilePath:Le,up:bn}}const yr=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ia(g,c){for(let h=0;h<g;h++){const _=c.length;c.resize(_+4),c.float32.set(yr,4*_)}}function Np(g,c,h){const _=c[0],w=c[1];return g[0]=h[0]*_+h[4]*w+h[12],g[1]=h[1]*_+h[5]*w+h[13],g[3]=h[3]*_+h[7]*w+h[15],g}const Ps=100;class ou{constructor(c,h,_=new vo(c.width+200,c.height+200,25),w=new vo(c.width+200,c.height+200,25)){this.transform=c,this.grid=_,this.ignoredGrid=w,this.pitchfactor=Math.cos(c._pitch)*c.cameraToCenterDistance,this.screenRightBoundary=c.width+Ps,this.screenBottomBoundary=c.height+Ps,this.gridRightBoundary=c.width+200,this.gridBottomBoundary=c.height+200,this.fogState=h}placeCollisionBox(c,h,_,w,C,I,k,R){let F=_.projectedAnchorX,N=_.projectedAnchorY,H=_.projectedAnchorZ;const X=_.elevation,te=_.tileID;if(X&&te){const ve=c.getProjection().upVector(te.canonical,_.tileAnchorX,_.tileAnchorY),he=c.getProjection().upVectorScale(te.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;F+=ve[0]*X*he,N+=ve[1]*X*he,H+=ve[2]*X*he}const Q=this.projectAndGetPerspectiveRatio(k,[F,N,H],_.tileID,"globe"===c.projection.name||!!X||this.transform.pitch>0,c.getProjection()),ne=I*Q.perspectiveRatio,K=(_.x1*h+w.x-_.padding)*ne+Q.point.x,Y=(_.y1*h+w.y-_.padding)*ne+Q.point.y,se=(_.x2*h+w.x+_.padding)*ne+Q.point.x,J=(_.y2*h+w.y+_.padding)*ne+Q.point.y,_e=Q.perspectiveRatio<=.55||Q.occluded;return!this.isInsideGrid(K,Y,se,J)||!C&&this.grid.hitTest(K,Y,se,J,R)||_e?{box:[],offscreen:!1,occluded:Q.occluded}:{box:[K,Y,se,J],offscreen:this.isOffscreen(K,Y,se,J),occluded:!1}}placeCollisionCircles(c,h,_,w,C,I,k,R,F,N,H,X,te,Q,ne){const K=[],Y=this.transform.elevation,se=Y?Y.getAtTileOffsetFunc(ne,this.transform.center.lat,this.transform.worldSize,c.getProjection()):Me=>[0,0,0],J=new p.pointGeometry(_.tileAnchorX,_.tileAnchorY),_e=c.getProjection().projectTilePoint(_.tileAnchorX,_.tileAnchorY,ne.canonical),ve=se(J),he=[_e.x+ve[0],_e.y+ve[1],_e.z+ve[2]],Ce="globe"===c.projection.name,He=this.projectAndGetPerspectiveRatio(k,[he[0],he[1],he[2]],ne,Ce||!!Y||this.transform.pitch>0,c.getProjection()),{perspectiveRatio:it}=He,Qe=(H?I/it:I*it)/p.ONE_EM,wt=qt(new p.pointGeometry(he[0],he[1]),R,he[2]).point,Le=He.signedDistanceFromCamera>0?Zt(Qe,C,_.lineOffsetX*Qe,_.lineOffsetY*Qe,!1,wt,J,_,w,R,{},Y&&!H?se:null,H&&!!Y,c.getProjection(),ne,H):null;let ft=!1,gt=!1,qe=!0;if(Le&&!He.occluded){const Me=.5*te*it+Q,Gt=new p.pointGeometry(-100,-100),It=new p.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),jt=new Hl,Lt=Le.first,bn=Le.last;let Gn=[];for(let Nt=Lt.path.length-1;Nt>=1;Nt--)Gn.push(Lt.path[Nt]);for(let Nt=1;Nt<bn.path.length;Nt++)Gn.push(bn.path[Nt]);const Rn=2.5*Me;if(F){const Nt=Gn.map(Y&&!Ce?(Jn,bi)=>{const hr=se(bi<Lt.path.length-1?Lt.tilePath[Lt.path.length-1-bi]:bn.tilePath[bi-Lt.path.length+2]);return Jn[2]=hr[2],xn(Jn,F)}:Jn=>xn(Jn,F));Gn=Nt.some(Jn=>Jn.signedDistanceFromCamera<=0)?[]:Nt.map(Jn=>Jn.point)}let yn=[];if(Gn.length>0){const Nt=Gn.map(or=>new p.pointGeometry(or[0],or[1]));let Jn=1/0,bi=-1/0,hr=1/0,pr=-1/0;for(let or=0;or<Nt.length;or++)Jn=Math.min(Jn,Nt[or].x),hr=Math.min(hr,Nt[or].y),bi=Math.max(bi,Nt[or].x),pr=Math.max(pr,Nt[or].y);yn=Jn>=Gt.x&&bi<=It.x&&hr>=Gt.y&&pr<=It.y?[Nt]:bi<Gt.x||Jn>It.x||pr<Gt.y||hr>It.y?[]:p.clipLine([Nt],Gt.x,Gt.y,It.x,It.y)}for(const Nt of yn){jt.reset(Nt,.25*Me);let Jn=0;Jn=jt.length<=.5*Me?1:Math.ceil(jt.paddedLength/Rn)+1;for(let bi=0;bi<Jn;bi++){const hr=bi/Math.max(Jn-1,1),pr=jt.lerp(hr),or=pr.x+Ps,io=pr.y+Ps;K.push(or,io,Me,0);const Mo=or-Me,ol=io-Me,Mr=or+Me,zr=io+Me;if(qe=qe&&this.isOffscreen(Mo,ol,Mr,zr),gt=gt||this.isInsideGrid(Mo,ol,Mr,zr),!h&&this.grid.hitTestCircle(or,io,Me,X)&&(ft=!0,!N))return{circles:[],offscreen:!1,collisionDetected:ft,occluded:!1}}}}return{circles:!N&&ft||!gt?[]:K,offscreen:qe,collisionDetected:ft,occluded:He.occluded}}queryRenderedSymbols(c){if(0===c.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const h=[];let _=1/0,w=1/0,C=-1/0,I=-1/0;for(const N of c){const H=new p.pointGeometry(N.x+Ps,N.y+Ps);_=Math.min(_,H.x),w=Math.min(w,H.y),C=Math.max(C,H.x),I=Math.max(I,H.y),h.push(H)}const k=this.grid.query(_,w,C,I).concat(this.ignoredGrid.query(_,w,C,I)),R={},F={};for(const N of k){const H=N.key;if(void 0===R[H.bucketInstanceId]&&(R[H.bucketInstanceId]={}),R[H.bucketInstanceId][H.featureIndex])continue;const X=[new p.pointGeometry(N.x1,N.y1),new p.pointGeometry(N.x2,N.y1),new p.pointGeometry(N.x2,N.y2),new p.pointGeometry(N.x1,N.y2)];p.polygonIntersectsPolygon(h,X)&&(R[H.bucketInstanceId][H.featureIndex]=!0,void 0===F[H.bucketInstanceId]&&(F[H.bucketInstanceId]=[]),F[H.bucketInstanceId].push(H.featureIndex))}return F}insertCollisionBox(c,h,_,w,C){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:w,collisionGroupID:C},c[0],c[1],c[2],c[3])}insertCollisionCircles(c,h,_,w,C){const I=h?this.ignoredGrid:this.grid,k={bucketInstanceId:_,featureIndex:w,collisionGroupID:C};for(let R=0;R<c.length;R+=4)I.insertCircle(k,c[R],c[R+1],c[R+2])}projectAndGetPerspectiveRatio(c,h,_,w,C){const I=[h[0],h[1],h[2],1];let k=!1;if(h[2]||this.transform.pitch>0){p.transformMat4$1(I,I,c);const R="globe"===C.name;this.fogState&&_&&!R&&(k=function(F,N,H,X,te,Q){const ne=Q.calculateFogTileMatrix(te),K=[N,H,X];return p.transformMat4(K,K,ne),Un(F,K,Q.pitch,Q._fov)}(this.fogState,h[0],h[1],h[2],_.toUnwrapped(),this.transform)>.9)}else Np(I,I,c);return{point:new p.pointGeometry((I[0]/I[3]+1)/2*this.transform.width+Ps,(-I[1]/I[3]+1)/2*this.transform.height+Ps),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(C)/I[3]*.5,1.5),signedDistanceFromCamera:I[3],occluded:w&&I[2]>I[3]||k}}isOffscreen(c,h,_,w){return _<Ps||c>=this.screenRightBoundary||w<Ps||h>this.screenBottomBoundary}isInsideGrid(c,h,_,w){return _>=0&&c<this.gridRightBoundary&&w>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const c=p.identity([]);return p.translate(c,c,[-100,-100,0]),c}}function es(g,c,h){const _=c.createTileMatrix(g,g.worldSize,h.toUnwrapped());return p.multiply(new Float32Array(16),g.projMatrix,_)}function Bp(g,c,h){if(c.projection.name===h.projection.name)return g.projMatrix;const _=h.clone();return _.setProjection(c.projection),es(_,c.getProjection(),g)}function Xu(g,c,h){return c.name===h.projection.name?g.projMatrix:es(h,c,g)}class ah{constructor(c,h,_,w){this.opacity=c?Math.max(0,Math.min(1,c.opacity+(c.placed?h:-h))):w&&_?1:0,this.placed=_}isHidden(){return 0===this.opacity&&!this.placed}}class xs{constructor(c,h,_,w,C,I=!1){this.text=new ah(c?c.text:null,h,_,C),this.icon=new ah(c?c.icon:null,h,w,C),this.clipped=I}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ws{constructor(c,h,_,w=!1){this.text=c,this.icon=h,this.skipFade=_,this.clipped=w}}class uo{constructor(){this.invProjMatrix=p.create(),this.viewportMatrix=p.create(),this.circles=[]}}class fm{constructor(c,h,_,w,C){this.bucketInstanceId=c,this.featureIndex=h,this.sourceLayerIndex=_,this.bucketIndex=w,this.tileID=C}}class mm{constructor(c){this.crossSourceCollisions=c,this.maxGroupID=0,this.collisionGroups={}}get(c){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[c]){const h=++this.maxGroupID;this.collisionGroups[c]={ID:h,predicate:_=>_.collisionGroupID===h}}return this.collisionGroups[c]}}function Ss(g,c,h,_,w){const{horizontalAlign:C,verticalAlign:I}=p.getAnchorAlignment(g),k=-(C-.5)*c,R=-(I-.5)*h,F=p.evaluateVariableOffset(g,_);return new p.pointGeometry(k+F[0]*w,R+F[1]*w)}function Hs(g,c,h,_,w){const C=new p.pointGeometry(g,c);return h&&C._rotate(_?w:-w),C}class gm{constructor(c,h,_,w,C){this.transform=c.clone(),this.projection=c.projection.name,this.collisionIndex=new ou(this.transform,C),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new mm(_),this.collisionCircleArrays={},this.prevPlacement=w,w&&(w.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(c,h,_,w){const C=_.getBucket(h),I=_.latestFeatureIndex;if(!C||!I||h.id!==C.layerIds[0])return;const k=C.layers[0].layout,R=_.collisionBoxArray,F=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),N=_.tileSize/p.EXTENT,H=_.tileID.toUnwrapped();this.transform.setProjection(C.projection);const X=(te=_.tileID,Q=C.getProjection(),ne=this.transform,Q.name===this.projection?ne.calculateProjMatrix(te.toUnwrapped()):es(ne,Q,te));var te,Q,ne;const K="map"===k.get("text-pitch-alignment"),Y="map"===k.get("text-rotation-alignment");h.compileFilter();const se=h.dynamicFilter(),J=h.dynamicFilterNeedsFeature(),_e=this.transform.calculatePixelsToTileUnitsMatrix(_),ve=sh(X,_.tileID.canonical,K,Y,this.transform,C.getProjection(),_e);let he=null;if(K){const it=cr(X,_.tileID.canonical,K,Y,this.transform,C.getProjection(),_e);he=p.multiply([],this.transform.labelPlaneMatrix,it)}let Ce=null;se&&_.latestFeatureIndex&&(Ce={unwrappedTileID:H,dynamicFilter:se,dynamicFilterNeedsFeature:J,featureIndex:_.latestFeatureIndex}),this.retainedQueryData[C.bucketInstanceId]=new fm(C.bucketInstanceId,I,C.sourceLayerIndex,C.index,_.tileID);const He={bucket:C,layout:k,posMatrix:X,textLabelPlaneMatrix:ve,labelToScreenMatrix:he,clippingData:Ce,scale:F,textPixelRatio:N,holdingForFade:_.holdingForFade(),collisionBoxArray:R,partiallyEvaluatedTextSize:p.evaluateSizeForZoom(C.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:p.evaluateSizeForZoom(C.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(C.sourceID)};if(w)for(const it of C.sortKeyRanges){const{sortKey:Qe,symbolInstanceStart:wt,symbolInstanceEnd:Le}=it;c.push({sortKey:Qe,symbolInstanceStart:wt,symbolInstanceEnd:Le,parameters:He})}else c.push({symbolInstanceStart:0,symbolInstanceEnd:C.symbolInstances.length,parameters:He})}attemptAnchorPlacement(c,h,_,w,C,I,k,R,F,N,H,X,te,Q,ne,K,Y,se){const J=[X.textOffset0,X.textOffset1],_e=Ss(c,_,w,J,C),ve=this.collisionIndex.placeCollisionBox(Q,C,h,Hs(_e.x,_e.y,I,k,this.transform.angle),H,R,F,N.predicate);if(K){const he=Q.getSymbolInstanceIconSize(se,this.transform.zoom,X.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(Q,he,K,Hs(_e.x,_e.y,I,k,this.transform.angle),H,R,F,N.predicate).box.length)return}if(ve.box.length>0){let he;return this.prevPlacement&&this.prevPlacement.variableOffsets[X.crossTileID]&&this.prevPlacement.placements[X.crossTileID]&&this.prevPlacement.placements[X.crossTileID].text&&(he=this.prevPlacement.variableOffsets[X.crossTileID].anchor),this.variableOffsets[X.crossTileID]={textOffset:J,width:_,height:w,anchor:c,textScale:C,prevAnchor:he},this.markUsedJustification(Q,c,X,ne),Q.allowVerticalPlacement&&(this.markUsedOrientation(Q,ne,X),this.placedOrientations[X.crossTileID]=ne),{shift:_e,placedGlyphBoxes:ve}}}placeLayerBucketPart(c,h,_,w){const{bucket:C,layout:I,posMatrix:k,textLabelPlaneMatrix:R,labelToScreenMatrix:F,clippingData:N,textPixelRatio:H,holdingForFade:X,collisionBoxArray:te,partiallyEvaluatedTextSize:Q,partiallyEvaluatedIconSize:ne,collisionGroup:K}=c.parameters,Y=I.get("text-optional"),se=I.get("icon-optional"),J=I.get("text-allow-overlap"),_e=I.get("icon-allow-overlap"),ve="map"===I.get("text-rotation-alignment"),he="map"===I.get("text-pitch-alignment"),Ce="none"!==I.get("icon-text-fit"),He="viewport-y"===I.get("symbol-z-order");this.transform.setProjection(C.projection);let it=J&&(_e||!C.hasIconData()||se),Qe=_e&&(J||!C.hasTextData()||Y);!C.collisionArrays&&te&&C.deserializeCollisionBoxes(te),_&&w&&C.updateCollisionDebugBuffers(this.transform.zoom,te);const wt=(Le,ft,gt)=>{if(N){const Mr={zoom:this.transform.zoom,pitch:this.transform.pitch};let zr=null;if(N.dynamicFilterNeedsFeature){const Pi=this.retainedQueryData[C.bucketInstanceId];zr=N.featureIndex.loadFeature({featureIndex:Le.featureIndex,bucketIndex:Pi.bucketIndex,sourceLayerIndex:Pi.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,N.dynamicFilter)(Mr,zr,this.retainedQueryData[C.bucketInstanceId].tileID.canonical,new p.pointGeometry(Le.tileAnchorX,Le.tileAnchorY),this.transform.calculateDistanceTileData(N.unwrappedTileID)))return this.placements[Le.crossTileID]=new ws(!1,!1,!1,!0),void(h[Le.crossTileID]=!0)}if(h[Le.crossTileID])return;if(X)return void(this.placements[Le.crossTileID]=new ws(!1,!1,!1));let qe=!1,Me=!1,Gt=!0,It=!1,jt=!1,Lt=null,bn={box:null,offscreen:null,occluded:null},Gn={box:null,offscreen:null,occluded:null},Rn=null,yn=null,Nt=null,Jn=0,bi=0,hr=0;gt.textFeatureIndex?Jn=gt.textFeatureIndex:Le.useRuntimeCollisionCircles&&(Jn=Le.featureIndex),gt.verticalTextFeatureIndex&&(bi=gt.verticalTextFeatureIndex);const pr=Mr=>{Mr.tileID=this.retainedQueryData[C.bucketInstanceId].tileID,(this.transform.elevation||Mr.elevation)&&(Mr.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[C.bucketInstanceId].tileID,Mr.tileAnchorX,Mr.tileAnchorY):0)},or=gt.textBox;if(or){pr(or);const Mr=Pi=>{let po=p.WritingMode.horizontal;if(C.allowVerticalPlacement&&!Pi&&this.prevPlacement){const ui=this.prevPlacement.placedOrientations[Le.crossTileID];ui&&(this.placedOrientations[Le.crossTileID]=ui,po=ui,this.markUsedOrientation(C,po,Le))}return po},zr=(Pi,po)=>{if(C.allowVerticalPlacement&&Le.numVerticalGlyphVertices>0&&gt.verticalTextBox){for(const ui of C.writingModes)if(ui===p.WritingMode.vertical?(bn=po(),Gn=bn):bn=Pi(),bn&&bn.box&&bn.box.length)break}else bn=Pi()};if(I.get("text-variable-anchor")){let Pi=I.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Le.crossTileID]){const vr=this.prevPlacement.variableOffsets[Le.crossTileID];Pi.indexOf(vr.anchor)>0&&(Pi=Pi.filter(Ns=>Ns!==vr.anchor),Pi.unshift(vr.anchor))}const po=(vr,Ns,tc)=>{const Vr=C.getSymbolInstanceTextSize(Q,Le,this.transform.zoom,ft),Co=(vr.x2-vr.x1)*Vr+2*vr.padding,La=(vr.y2-vr.y1)*Vr+2*vr.padding,Ys=Ce&&!_e?Ns:null;Ys&&pr(Ys);let No={box:[],offscreen:!1,occluded:!1};const fa=J?2*Pi.length:Pi.length;for(let Qs=0;Qs<fa;++Qs){const sl=this.attemptAnchorPlacement(Pi[Qs%Pi.length],vr,Co,La,Vr,ve,he,H,k,K,Qs>=Pi.length,Le,ft,C,tc,Ys,Q,ne);if(sl&&(No=sl.placedGlyphBoxes,No&&No.box&&No.box.length)){qe=!0,Lt=sl.shift;break}}return No};zr(()=>po(or,gt.iconBox,p.WritingMode.horizontal),()=>{const vr=gt.verticalTextBox;return vr&&pr(vr),C.allowVerticalPlacement&&!(bn&&bn.box&&bn.box.length)&&Le.numVerticalGlyphVertices>0&&vr?po(vr,gt.verticalIconBox,p.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),bn&&(qe=bn.box,Gt=bn.offscreen,It=bn.occluded);const ui=Mr(bn&&bn.box);if(!qe&&this.prevPlacement){const vr=this.prevPlacement.variableOffsets[Le.crossTileID];vr&&(this.variableOffsets[Le.crossTileID]=vr,this.markUsedJustification(C,vr.anchor,Le,ui))}}else{const Pi=(po,ui)=>{const vr=C.getSymbolInstanceTextSize(Q,Le,this.transform.zoom,ft),Ns=this.collisionIndex.placeCollisionBox(C,vr,po,new p.pointGeometry(0,0),J,H,k,K.predicate);return Ns&&Ns.box&&Ns.box.length&&(this.markUsedOrientation(C,ui,Le),this.placedOrientations[Le.crossTileID]=ui),Ns};zr(()=>Pi(or,p.WritingMode.horizontal),()=>{const po=gt.verticalTextBox;return C.allowVerticalPlacement&&Le.numVerticalGlyphVertices>0&&po?(pr(po),Pi(po,p.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Mr(bn&&bn.box&&bn.box.length)}}if(Rn=bn,qe=Rn&&Rn.box&&Rn.box.length>0,Gt=Rn&&Rn.offscreen,It=Rn&&Rn.occluded,Le.useRuntimeCollisionCircles){const Mr=C.text.placedSymbolArray.get(Le.centerJustifiedTextSymbolIndex>=0?Le.centerJustifiedTextSymbolIndex:Le.verticalPlacedTextSymbolIndex),zr=p.evaluateSizeForFeature(C.textSizeData,Q,Mr),Pi=I.get("text-padding");yn=this.collisionIndex.placeCollisionCircles(C,J,Mr,C.lineVertexArray,C.glyphOffsetArray,zr,k,R,F,_,he,K.predicate,Le.collisionCircleDiameter*zr/p.ONE_EM,Pi,this.retainedQueryData[C.bucketInstanceId].tileID),qe=J||yn.circles.length>0&&!yn.collisionDetected,Gt=Gt&&yn.offscreen,It=yn.occluded}if(gt.iconFeatureIndex&&(hr=gt.iconFeatureIndex),gt.iconBox){const Mr=zr=>{pr(zr);const Pi=Ce&&Lt?Hs(Lt.x,Lt.y,ve,he,this.transform.angle):new p.pointGeometry(0,0),po=C.getSymbolInstanceIconSize(ne,this.transform.zoom,Le.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(C,po,zr,Pi,_e,H,k,K.predicate)};Gn&&Gn.box&&Gn.box.length&&gt.verticalIconBox?(Nt=Mr(gt.verticalIconBox),Me=Nt.box.length>0):(Nt=Mr(gt.iconBox),Me=Nt.box.length>0),Gt=Gt&&Nt.offscreen,jt=Nt.occluded}const io=Y||0===Le.numHorizontalGlyphVertices&&0===Le.numVerticalGlyphVertices,Mo=se||0===Le.numIconVertices;if(io||Mo?Mo?io||(Me=Me&&qe):qe=Me&&qe:Me=qe=Me&&qe,qe&&Rn&&Rn.box&&this.collisionIndex.insertCollisionBox(Rn.box,I.get("text-ignore-placement"),C.bucketInstanceId,Gn&&Gn.box&&bi?bi:Jn,K.ID),Me&&Nt&&this.collisionIndex.insertCollisionBox(Nt.box,I.get("icon-ignore-placement"),C.bucketInstanceId,hr,K.ID),yn&&(qe&&this.collisionIndex.insertCollisionCircles(yn.circles,I.get("text-ignore-placement"),C.bucketInstanceId,Jn,K.ID),_)){const Mr=C.bucketInstanceId;let zr=this.collisionCircleArrays[Mr];void 0===zr&&(zr=this.collisionCircleArrays[Mr]=new uo);for(let Pi=0;Pi<yn.circles.length;Pi+=4)zr.circles.push(yn.circles[Pi+0]),zr.circles.push(yn.circles[Pi+1]),zr.circles.push(yn.circles[Pi+2]),zr.circles.push(yn.collisionDetected?1:0)}const ol="globe"!==C.projection.name;it=it&&(ol||!It),Qe=Qe&&(ol||!jt),this.placements[Le.crossTileID]=new ws(qe||it,Me||Qe,Gt||C.justReloaded),h[Le.crossTileID]=!0};if(He){const Le=C.getSortedSymbolIndexes(this.transform.angle);for(let ft=Le.length-1;ft>=0;--ft){const gt=Le[ft];wt(C.symbolInstances.get(gt),gt,C.collisionArrays[gt])}}else for(let Le=c.symbolInstanceStart;Le<c.symbolInstanceEnd;Le++)wt(C.symbolInstances.get(Le),Le,C.collisionArrays[Le]);if(_&&C.bucketInstanceId in this.collisionCircleArrays){const Le=this.collisionCircleArrays[C.bucketInstanceId];p.invert(Le.invProjMatrix,k),Le.viewportMatrix=this.collisionIndex.getViewportMatrix()}C.justReloaded=!1}markUsedJustification(c,h,_,w){let C;C=w===p.WritingMode.vertical?_.verticalPlacedTextSymbolIndex:{left:_.leftJustifiedTextSymbolIndex,center:_.centerJustifiedTextSymbolIndex,right:_.rightJustifiedTextSymbolIndex}[p.getAnchorJustification(h)];const I=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex,_.verticalPlacedTextSymbolIndex];for(const k of I)k>=0&&(c.text.placedSymbolArray.get(k).crossTileID=C>=0&&k!==C?0:_.crossTileID)}markUsedOrientation(c,h,_){const w=h===p.WritingMode.horizontal||h===p.WritingMode.horizontalOnly?h:0,C=h===p.WritingMode.vertical?h:0,I=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex].filter(k=>-1!==k);for(const k of I)c.text.placedSymbolArray.get(k).placedOrientation=w;-1!==_.verticalPlacedTextSymbolIndex&&(c.text.placedSymbolArray.get(_.verticalPlacedTextSymbolIndex).placedOrientation=C)}commit(c){this.commitTime=c,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let _=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const w=h?h.symbolFadeChange(c):1,C=h?h.opacities:{},I=h?h.variableOffsets:{},k=h?h.placedOrientations:{};for(const R in this.placements){const F=this.placements[R],N=C[R];N?(this.opacities[R]=new xs(N,w,F.text,F.icon,null,F.clipped),_=_||F.text!==N.text.placed||F.icon!==N.icon.placed):(this.opacities[R]=new xs(null,w,F.text,F.icon,F.skipFade,F.clipped),_=_||F.text||F.icon)}for(const R in C){const F=C[R];if(!this.opacities[R]){const N=new xs(F,w,!1,!1);N.isHidden()||(this.opacities[R]=N,_=_||F.text.placed||F.icon.placed)}}for(const R in I)this.variableOffsets[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.variableOffsets[R]=I[R]);for(const R in k)this.placedOrientations[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.placedOrientations[R]=k[R]);_?this.lastPlacementChangeTime=c:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:c)}updateLayerOpacities(c,h){const _={};for(const w of h){const C=w.getBucket(c);C&&w.latestFeatureIndex&&c.id===C.layerIds[0]&&this.updateBucketOpacities(C,_,w.collisionBoxArray)}}updateBucketOpacities(c,h,_){c.hasTextData()&&c.text.opacityVertexArray.clear(),c.hasIconData()&&c.icon.opacityVertexArray.clear(),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexArray.clear(),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexArray.clear();const w=c.layers[0].layout,C=!!c.layers[0].dynamicFilter(),I=new xs(null,0,!1,!1,!0),k=w.get("text-allow-overlap"),R=w.get("icon-allow-overlap"),F=w.get("text-variable-anchor"),N="map"===w.get("text-rotation-alignment"),H="map"===w.get("text-pitch-alignment"),X="none"!==w.get("icon-text-fit"),te=new xs(null,0,k&&(R||!c.hasIconData()||w.get("icon-optional")),R&&(k||!c.hasTextData()||w.get("text-optional")),!0);!c.collisionArrays&&_&&(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData())&&c.deserializeCollisionBoxes(_);const Q=(K,Y,se)=>{for(let J=0;J<Y/4;J++)K.opacityVertexArray.emplaceBack(se)};let ne=0;for(let K=0;K<c.symbolInstances.length;K++){const Y=c.symbolInstances.get(K),{numHorizontalGlyphVertices:se,numVerticalGlyphVertices:J,crossTileID:_e}=Y;let ve=this.opacities[_e];h[_e]?ve=I:ve||(ve=te,this.opacities[_e]=ve),h[_e]=!0;const he=se>0||J>0,Ce=Y.numIconVertices>0,He=this.placedOrientations[Y.crossTileID],it=He===p.WritingMode.vertical,Qe=He===p.WritingMode.horizontal||He===p.WritingMode.horizontalOnly;if(!he&&!Ce||ve.isHidden()||ne++,he){const wt=ln(ve.text);Q(c.text,se,it?el:wt),Q(c.text,J,Qe?el:wt);const Le=ve.text.isHidden();[Y.rightJustifiedTextSymbolIndex,Y.centerJustifiedTextSymbolIndex,Y.leftJustifiedTextSymbolIndex].forEach(qe=>{qe>=0&&(c.text.placedSymbolArray.get(qe).hidden=Le||it?1:0)}),Y.verticalPlacedTextSymbolIndex>=0&&(c.text.placedSymbolArray.get(Y.verticalPlacedTextSymbolIndex).hidden=Le||Qe?1:0);const ft=this.variableOffsets[Y.crossTileID];ft&&this.markUsedJustification(c,ft.anchor,Y,He);const gt=this.placedOrientations[Y.crossTileID];gt&&(this.markUsedJustification(c,"left",Y,gt),this.markUsedOrientation(c,gt,Y))}if(Ce){const wt=ln(ve.icon);Y.placedIconSymbolIndex>=0&&(Q(c.icon,Y.numIconVertices,it?el:wt),c.icon.placedSymbolArray.get(Y.placedIconSymbolIndex).hidden=ve.icon.isHidden()),Y.verticalPlacedIconSymbolIndex>=0&&(Q(c.icon,Y.numVerticalIconVertices,Qe?el:wt),c.icon.placedSymbolArray.get(Y.verticalPlacedIconSymbolIndex).hidden=ve.icon.isHidden())}if(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData()){const wt=c.collisionArrays[K];if(wt){let Le=new p.pointGeometry(0,0),ft=!0;if(wt.textBox||wt.verticalTextBox){if(F){const qe=this.variableOffsets[_e];qe?(Le=Ss(qe.anchor,qe.width,qe.height,qe.textOffset,qe.textScale),N&&Le._rotate(H?this.transform.angle:-this.transform.angle)):ft=!1}C&&(ft=!ve.clipped),wt.textBox&&su(c.textCollisionBox.collisionVertexArray,ve.text.placed,!ft||it,Le.x,Le.y),wt.verticalTextBox&&su(c.textCollisionBox.collisionVertexArray,ve.text.placed,!ft||Qe,Le.x,Le.y)}const gt=ft&&Boolean(!Qe&&wt.verticalIconBox);wt.iconBox&&su(c.iconCollisionBox.collisionVertexArray,ve.icon.placed,gt,X?Le.x:0,X?Le.y:0),wt.verticalIconBox&&su(c.iconCollisionBox.collisionVertexArray,ve.icon.placed,!gt,X?Le.x:0,X?Le.y:0)}}}if(c.fullyClipped=0===ne,c.sortFeatures(this.transform.angle),this.retainedQueryData[c.bucketInstanceId]&&(this.retainedQueryData[c.bucketInstanceId].featureSortOrder=c.featureSortOrder),c.hasTextData()&&c.text.opacityVertexBuffer&&c.text.opacityVertexBuffer.updateData(c.text.opacityVertexArray),c.hasIconData()&&c.icon.opacityVertexBuffer&&c.icon.opacityVertexBuffer.updateData(c.icon.opacityVertexArray),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexBuffer&&c.iconCollisionBox.collisionVertexBuffer.updateData(c.iconCollisionBox.collisionVertexArray),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexBuffer&&c.textCollisionBox.collisionVertexBuffer.updateData(c.textCollisionBox.collisionVertexArray),c.bucketInstanceId in this.collisionCircleArrays){const K=this.collisionCircleArrays[c.bucketInstanceId];c.placementInvProjMatrix=K.invProjMatrix,c.placementViewportMatrix=K.viewportMatrix,c.collisionCircleArray=K.circles,delete this.collisionCircleArrays[c.bucketInstanceId]}}symbolFadeChange(c){return 0===this.fadeDuration?1:(c-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(c){return Math.max(0,(this.transform.zoom-c)/1.5)}hasTransitions(c){return this.stale||c-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(c,h){const _=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*_>c}setStale(){this.stale=!0}}function su(g,c,h,_,w){g.emplaceBack(c?1:0,h?1:0,_||0,w||0),g.emplaceBack(c?1:0,h?1:0,_||0,w||0),g.emplaceBack(c?1:0,h?1:0,_||0,w||0),g.emplaceBack(c?1:0,h?1:0,_||0,w||0)}const ur=Math.pow(2,25),Ki=Math.pow(2,24),bm=Math.pow(2,17),lh=Math.pow(2,16),ts=Math.pow(2,9),Ut=Math.pow(2,8),_m=Math.pow(2,1);function ln(g){if(0===g.opacity&&!g.placed)return 0;if(1===g.opacity&&g.placed)return 4294967295;const c=g.placed?1:0,h=Math.floor(127*g.opacity);return h*ur+c*Ki+h*bm+c*lh+h*ts+c*Ut+h*_m+c}const el=0;class Zu{constructor(c){this._sortAcrossTiles="viewport-y"!==c.layout.get("symbol-z-order")&&void 0!==c.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(c,h,_,w,C){const I=this._bucketParts;for(;this._currentTileIndex<c.length;)if(h.getBucketParts(I,w,c[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,C())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((k,R)=>k.sortKey-R.sortKey));this._currentPartIndex<I.length;){const k=I[this._currentPartIndex];if(h.placeLayerBucketPart(k,this._seenCrossTileIDs,_,0===k.symbolInstanceStart),this._currentPartIndex++,C())return!0}return!1}}class hb{constructor(c,h,_,w,C,I,k,R){this.placement=new gm(c,C,I,k,R),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=w,this._done=!1}isDone(){return this._done}continuePlacement(c,h,_){const w=p.exported.now(),C=()=>{const I=p.exported.now()-w;return!this._forceFullPlacement&&I>2};for(;this._currentPlacementIndex>=0;){const I=h[c[this._currentPlacementIndex]],k=this.placement.collisionIndex.transform.zoom;if("symbol"===I.type&&(!I.minzoom||I.minzoom<=k)&&(!I.maxzoom||I.maxzoom>k)){if(this._inProgressLayer||(this._inProgressLayer=new Zu(I)),this._inProgressLayer.continuePlacement(_[I.source],this.placement,this._showCollisionBoxes,I,C))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(c){return this.placement.commit(c),this.placement}}const zp=512/p.EXTENT/2;class xc{constructor(c,h,_){this.tileID=c,this.indexedSymbolInstances={},this.bucketInstanceId=_;for(let w=0;w<h.length;w++){const C=h.get(w),I=C.key;this.indexedSymbolInstances[I]||(this.indexedSymbolInstances[I]=[]),this.indexedSymbolInstances[I].push({crossTileID:C.crossTileID,coord:this.getScaledCoordinates(C,c)})}}getScaledCoordinates(c,h){const _=zp/Math.pow(2,h.canonical.z-this.tileID.canonical.z);return{x:Math.floor((h.canonical.x*p.EXTENT+c.tileAnchorX)*_),y:Math.floor((h.canonical.y*p.EXTENT+c.tileAnchorY)*_)}}findMatches(c,h,_){const w=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let C=0;C<c.length;C++){const I=c.get(C);if(I.crossTileID)continue;const k=this.indexedSymbolInstances[I.key];if(!k)continue;const R=this.getScaledCoordinates(I,h);for(const F of k)if(Math.abs(F.coord.x-R.x)<=w&&Math.abs(F.coord.y-R.y)<=w&&!_[F.crossTileID]){_[F.crossTileID]=!0,I.crossTileID=F.crossTileID;break}}}}class ch{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class uh{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(c){const h=Math.round((c-this.lng)/360);if(0!==h)for(const _ in this.indexes){const w=this.indexes[_],C={};for(const I in w){const k=w[I];k.tileID=k.tileID.unwrapTo(k.tileID.wrap+h),C[k.tileID.key]=k}this.indexes[_]=C}this.lng=c}addBucket(c,h,_){if(this.indexes[c.overscaledZ]&&this.indexes[c.overscaledZ][c.key]){if(this.indexes[c.overscaledZ][c.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(c.overscaledZ,this.indexes[c.overscaledZ][c.key])}for(let C=0;C<h.symbolInstances.length;C++)h.symbolInstances.get(C).crossTileID=0;this.usedCrossTileIDs[c.overscaledZ]||(this.usedCrossTileIDs[c.overscaledZ]={});const w=this.usedCrossTileIDs[c.overscaledZ];for(const C in this.indexes){const I=this.indexes[C];if(Number(C)>c.overscaledZ)for(const k in I){const R=I[k];R.tileID.isChildOf(c)&&R.findMatches(h.symbolInstances,c,w)}else{const k=I[c.scaledTo(Number(C)).key];k&&k.findMatches(h.symbolInstances,c,w)}}for(let C=0;C<h.symbolInstances.length;C++){const I=h.symbolInstances.get(C);I.crossTileID||(I.crossTileID=_.generate(),w[I.crossTileID]=!0)}return void 0===this.indexes[c.overscaledZ]&&(this.indexes[c.overscaledZ]={}),this.indexes[c.overscaledZ][c.key]=new xc(c,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(c,h){for(const _ in h.indexedSymbolInstances)for(const w of h.indexedSymbolInstances[_])delete this.usedCrossTileIDs[c][w.crossTileID]}removeStaleBuckets(c){let h=!1;for(const _ in this.indexes){const w=this.indexes[_];for(const C in w)c[w[C].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,w[C]),delete w[C],h=!0)}return h}}class $l{constructor(){this.layerIndexes={},this.crossTileIDs=new ch,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(c,h,_,w){let C=this.layerIndexes[c.id];void 0===C&&(C=this.layerIndexes[c.id]=new uh);let I=!1;const k={};"globe"!==w.name&&C.handleWrapJump(_);for(const R of h){const F=R.getBucket(c);F&&c.id===F.layerIds[0]&&(F.bucketInstanceId||(F.bucketInstanceId=++this.maxBucketInstanceId),C.addBucket(R.tileID,F,this.crossTileIDs)&&(I=!0),k[F.bucketInstanceId]=!0)}return C.removeStaleBuckets(k)&&(I=!0),I}pruneUnusedLayers(c){const h={};c.forEach(_=>{h[_]=!0});for(const _ in this.layerIndexes)h[_]||delete this.layerIndexes[_]}}const Ma=(g,c)=>p.emitValidationErrors(g,c&&c.filter(h=>"source.canvas"!==h.identifier)),Yn=p.pick($n,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),tl=p.pick($n,["setCenter","setZoom","setBearing","setPitch"]),Vp={version:8,layers:[],sources:{}},$s={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Aa extends p.Evented{constructor(c,h={}){super(),this.map=c,this.dispatcher=new qr(Xn(),this),this.imageManager=new nt,this.imageManager.setEventedParent(this),this.glyphManager=new p.GlyphManager(c._requestManager,h.localFontFamily?p.LocalGlyphMode.all:h.localIdeographFontFamily?p.LocalGlyphMode.ideographs:p.LocalGlyphMode.none,h.localFontFamily||h.localIdeographFontFamily),this.crossTileSymbolIndex=new $l,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new p.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",p.getReferrer());const _=this;this._rtlTextPluginCallback=Aa.registerForPluginStateChange(w=>{_.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:w.pluginStatus,pluginURL:w.pluginURL},(C,I)=>{if(p.triggerPluginCompletionEvent(C),I&&I.every(k=>k))for(const k in _._sourceCaches){const R=_._sourceCaches[k],F=R.getSource().type;"vector"!==F&&"geojson"!==F||R.reload()}})}),this.on("data",w=>{if("source"!==w.dataType||"metadata"!==w.sourceDataType)return;const C=this.getSource(w.sourceId);if(C&&C.vectorLayerIds)for(const I in this._layers){const k=this._layers[I];k.source===C.id&&this._validateLayer(k)}})}loadURL(c,h={}){this.fire(new p.Event("dataloading",{dataType:"style"}));const _="boolean"==typeof h.validate?h.validate:!p.isMapboxURL(c);c=this.map._requestManager.normalizeStyleURL(c,h.accessToken);const w=this.map._requestManager.transformRequest(c,p.ResourceType.Style);this._request=p.getJSON(w,(C,I)=>{this._request=null,C?this.fire(new p.ErrorEvent(C)):I&&this._load(I,_)})}loadJSON(c,h={}){this.fire(new p.Event("dataloading",{dataType:"style"})),this._request=p.exported.frame(()=>{this._request=null,this._load(c,!1!==h.validate)})}loadEmpty(){this.fire(new p.Event("dataloading",{dataType:"style"})),this._load(Vp,!1)}_updateLayerCount(c,h){const _=h?1:-1;c.is3D()&&(this._num3DLayers+=_),"circle"===c.type&&(this._numCircleLayers+=_),"symbol"===c.type&&(this._numSymbolLayers+=_)}_load(c,h){if(h&&Ma(this,p.validateStyle(c)))return;this._loaded=!0,this.stylesheet=p.clone$1(c),this._updateMapProjection();for(const w in c.sources)this.addSource(w,c.sources[w],{validate:!1});this._changed=!1,c.sprite?this._loadSprite(c.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(c.glyphs);const _=qi(this.stylesheet.layers);this._order=_.map(w=>w.id),this._layers={},this._serializedLayers={};for(let w of _)w=p.createStyleLayer(w),w.setEventedParent(this,{layer:{id:w.id}}),this._layers[w.id]=w,this._serializedLayers[w.id]=w.serialize(),this._updateLayerCount(w,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new et(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new p.Event("data",{dataType:"style"})),this.fire(new p.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(c){c?this.stylesheet.projection=c:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(c){this._spriteRequest=function(h,_,w){let C,I,k;const R=p.exported.devicePixelRatio>1?"@2x":"";let F=p.getJSON(_.transformRequest(_.normalizeSpriteURL(h,R,".json"),p.ResourceType.SpriteJSON),(X,te)=>{F=null,k||(k=X,C=te,H())}),N=p.getImage(_.transformRequest(_.normalizeSpriteURL(h,R,".png"),p.ResourceType.SpriteImage),(X,te)=>{N=null,k||(k=X,I=te,H())});function H(){if(k)w(k);else if(C&&I){const X=p.exported.getImageData(I),te={};for(const Q in C){const{width:ne,height:K,x:Y,y:se,sdf:J,pixelRatio:_e,stretchX:ve,stretchY:he,content:Ce}=C[Q],He=new p.RGBAImage({width:ne,height:K});p.RGBAImage.copy(X,He,{x:Y,y:se},{x:0,y:0},{width:ne,height:K}),te[Q]={data:He,pixelRatio:_e,sdf:J,stretchX:ve,stretchY:he,content:Ce}}w(null,te)}}return{cancel(){F&&(F.cancel(),F=null),N&&(N.cancel(),N=null)}}}(c,this.map._requestManager,(h,_)=>{if(this._spriteRequest=null,h)this.fire(new p.ErrorEvent(h));else if(_)for(const w in _)this.imageManager.addImage(w,_[w]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new p.Event("data",{dataType:"style"}))})}_validateLayer(c){const h=this.getSource(c.source);if(!h)return;const _=c.sourceLayer;_&&("geojson"===h.type||h.vectorLayerIds&&-1===h.vectorLayerIds.indexOf(_))&&this.fire(new p.ErrorEvent(new Error(`Source layer "${_}" does not exist on source "${h.id}" as specified by style layer "${c.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const c in this._sourceCaches)if(!this._sourceCaches[c].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(c){const h=[];for(const _ of c){const w=this._layers[_];"custom"!==w.type&&h.push(w.serialize())}return h}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const c in this._sourceCaches)if(this._sourceCaches[c].hasTransition())return!0;for(const c in this._layers)if(this._layers[c].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(c){return!!this.terrain&&$s[c.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(c){if(!this._loaded)return;const h=this._changed;if(this._changed){const w=Object.keys(this._updatedLayers),C=Object.keys(this._removedLayers);(w.length||C.length)&&this._updateWorkerLayers(w,C);for(const I in this._updatedSources){const k=this._updatedSources[I];"reload"===k?this._reloadSource(I):"clear"===k&&this._clearSource(I)}this._updateTilesForChangedImages();for(const I in this._updatedPaintProps)this._layers[I].updateTransitions(c);this.light.updateTransitions(c),this.fog&&this.fog.updateTransitions(c),this._resetUpdates()}const _={};for(const w in this._sourceCaches){const C=this._sourceCaches[w];_[w]=C.used,C.used=!1}for(const w of this._order){const C=this._layers[w];if(C.recalculate(c,this._availableImages),!C.isHidden(c.zoom)){const k=this._getLayerSourceCache(C);k&&(k.used=!0)}const I=this.map.painter;if(I){const k=C.getProgramIds();if(!k)continue;const R=C.getProgramConfiguration(c.zoom);for(const F of k)I.useProgram(F,R)}}for(const w in _){const C=this._sourceCaches[w];_[w]!==C.used&&C.getSource().fire(new p.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:C.getSource().id}))}this.light.recalculate(c),this.terrain&&this.terrain.recalculate(c),this.fog&&this.fog.recalculate(c),this.z=c.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),h&&this.fire(new p.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const c=Object.keys(this._changedImages);if(c.length){for(const h in this._sourceCaches)this._sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],c);this._changedImages={}}}_updateWorkerLayers(c,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(c),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(c){if(this._checkLoaded(),Ma(this,p.validateStyle(c)))return!1;(c=p.clone$1(c)).layers=qi(c.layers);const h=function(w,C){if(!w)return[{command:$n.setStyle,args:[C]}];let I=[];try{if(!me(w.version,C.version))return[{command:$n.setStyle,args:[C]}];me(w.center,C.center)||I.push({command:$n.setCenter,args:[C.center]}),me(w.zoom,C.zoom)||I.push({command:$n.setZoom,args:[C.zoom]}),me(w.bearing,C.bearing)||I.push({command:$n.setBearing,args:[C.bearing]}),me(w.pitch,C.pitch)||I.push({command:$n.setPitch,args:[C.pitch]}),me(w.sprite,C.sprite)||I.push({command:$n.setSprite,args:[C.sprite]}),me(w.glyphs,C.glyphs)||I.push({command:$n.setGlyphs,args:[C.glyphs]}),me(w.transition,C.transition)||I.push({command:$n.setTransition,args:[C.transition]}),me(w.light,C.light)||I.push({command:$n.setLight,args:[C.light]}),me(w.fog,C.fog)||I.push({command:$n.setFog,args:[C.fog]}),me(w.projection,C.projection)||I.push({command:$n.setProjection,args:[C.projection]});const k={},R=[];!function(H,X,te,Q){let ne;for(ne in X=X||{},H=H||{})H.hasOwnProperty(ne)&&(X.hasOwnProperty(ne)||_r(ne,te,Q));for(ne in X)X.hasOwnProperty(ne)&&(H.hasOwnProperty(ne)?me(H[ne],X[ne])||("geojson"===H[ne].type&&"geojson"===X[ne].type&&xl(H,X,ne)?te.push({command:$n.setGeoJSONSourceData,args:[ne,X[ne].data]}):Ul(ne,X,te,Q)):lr(ne,X,te))}(w.sources,C.sources,R,k);const F=[];w.layers&&w.layers.forEach(H=>{H.source&&k[H.source]?I.push({command:$n.removeLayer,args:[H.id]}):F.push(H)});let N=w.terrain;N&&k[N.source]&&(I.push({command:$n.setTerrain,args:[void 0]}),N=void 0),I=I.concat(R),me(N,C.terrain)||I.push({command:$n.setTerrain,args:[C.terrain]}),function(H,X,te){X=X||[];const Q=(H=H||[]).map(Ka),ne=X.map(Ka),K=H.reduce(co,{}),Y=X.reduce(co,{}),se=Q.slice(),J=Object.create(null);let _e,ve,he,Ce,He,it,Qe;for(_e=0,ve=0;_e<Q.length;_e++)he=Q[_e],Y.hasOwnProperty(he)?ve++:(te.push({command:$n.removeLayer,args:[he]}),se.splice(se.indexOf(he,ve),1));for(_e=0,ve=0;_e<ne.length;_e++)he=ne[ne.length-1-_e],se[se.length-1-_e]!==he&&(K.hasOwnProperty(he)?(te.push({command:$n.removeLayer,args:[he]}),se.splice(se.lastIndexOf(he,se.length-ve),1)):ve++,it=se[se.length-_e],te.push({command:$n.addLayer,args:[Y[he],it]}),se.splice(se.length-_e,0,he),J[he]=!0);for(_e=0;_e<ne.length;_e++)if(he=ne[_e],Ce=K[he],He=Y[he],!J[he]&&!me(Ce,He))if(me(Ce.source,He.source)&&me(Ce["source-layer"],He["source-layer"])&&me(Ce.type,He.type)){for(Qe in ct(Ce.layout,He.layout,te,he,null,$n.setLayoutProperty),ct(Ce.paint,He.paint,te,he,null,$n.setPaintProperty),me(Ce.filter,He.filter)||te.push({command:$n.setFilter,args:[he,He.filter]}),me(Ce.minzoom,He.minzoom)&&me(Ce.maxzoom,He.maxzoom)||te.push({command:$n.setLayerZoomRange,args:[he,He.minzoom,He.maxzoom]}),Ce)Ce.hasOwnProperty(Qe)&&"layout"!==Qe&&"paint"!==Qe&&"filter"!==Qe&&"metadata"!==Qe&&"minzoom"!==Qe&&"maxzoom"!==Qe&&(0===Qe.indexOf("paint.")?ct(Ce[Qe],He[Qe],te,he,Qe.slice(6),$n.setPaintProperty):me(Ce[Qe],He[Qe])||te.push({command:$n.setLayerProperty,args:[he,Qe,He[Qe]]}));for(Qe in He)He.hasOwnProperty(Qe)&&!Ce.hasOwnProperty(Qe)&&"layout"!==Qe&&"paint"!==Qe&&"filter"!==Qe&&"metadata"!==Qe&&"minzoom"!==Qe&&"maxzoom"!==Qe&&(0===Qe.indexOf("paint.")?ct(Ce[Qe],He[Qe],te,he,Qe.slice(6),$n.setPaintProperty):me(Ce[Qe],He[Qe])||te.push({command:$n.setLayerProperty,args:[he,Qe,He[Qe]]}))}else te.push({command:$n.removeLayer,args:[he]}),it=se[se.lastIndexOf(he)+1],te.push({command:$n.addLayer,args:[He,it]})}(F,C.layers,I)}catch(k){console.warn("Unable to compute style diff:",k),I=[{command:$n.setStyle,args:[C]}]}return I}(this.serialize(),c).filter(w=>!(w.command in tl));if(0===h.length)return!1;const _=h.filter(w=>!(w.command in Yn));if(_.length>0)throw new Error(`Unimplemented: ${_.map(w=>w.command).join(", ")}.`);return h.forEach(w=>{"setTransition"!==w.command&&"setProjection"!==w.command&&this[w.command].apply(this,w.args)}),this.stylesheet=c,this._updateMapProjection(),!0}addImage(c,h){return this.getImage(c)?this.fire(new p.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(c,h),this._afterImageUpdated(c),this)}updateImage(c,h){this.imageManager.updateImage(c,h)}getImage(c){return this.imageManager.getImage(c)}removeImage(c){return this.getImage(c)?(this.imageManager.removeImage(c),this._afterImageUpdated(c),this):this.fire(new p.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(c){this._availableImages=this.imageManager.listImages(),this._changedImages[c]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new p.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(c,h,_={}){if(this._checkLoaded(),void 0!==this.getSource(c))throw new Error("There is already a source with this ID");if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(p.validateSource,`sources.${c}`,h,null,_))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const w=de(c,h,this.dispatcher,this);w.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(c),source:w.serialize(),sourceId:c}));const C=I=>{const k=(I?"symbol:":"other:")+c,R=this._sourceCaches[k]=new p.SourceCache(k,w,I);(I?this._symbolSourceCaches:this._otherSourceCaches)[c]=R,R.style=this,R.onAdd(this.map)};C(!1),"vector"!==h.type&&"geojson"!==h.type||C(!0),w.onAdd&&w.onAdd(this.map),this._changed=!0}removeSource(c){this._checkLoaded();const h=this.getSource(c);if(!h)throw new Error("There is no source with this ID");for(const w in this._layers)if(this._layers[w].source===c)return this.fire(new p.ErrorEvent(new Error(`Source "${c}" cannot be removed while layer "${w}" is using it.`)));if(this.terrain&&this.terrain.get().source===c)return this.fire(new p.ErrorEvent(new Error(`Source "${c}" cannot be removed while terrain is using it.`)));const _=this._getSourceCaches(c);for(const w of _)delete this._sourceCaches[w.id],delete this._updatedSources[w.id],w.fire(new p.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:w.getSource().id})),w.setEventedParent(null),w.clearTiles();return delete this._otherSourceCaches[c],delete this._symbolSourceCaches[c],h.setEventedParent(null),h.onRemove&&h.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(c,h){this._checkLoaded(),this.getSource(c).setData(h),this._changed=!0}getSource(c){const h=this._getSourceCache(c);return h&&h.getSource()}_getSources(){const c=[];for(const h in this._otherSourceCaches){const _=this._getSourceCache(h);_&&c.push(_.getSource())}return c}addLayer(c,h,_={}){this._checkLoaded();const w=c.id;if(this.getLayer(w))return void this.fire(new p.ErrorEvent(new Error(`Layer with id "${w}" already exists on this map`)));let C;if("custom"===c.type){if(Ma(this,p.validateCustomStyleLayer(c)))return;C=p.createStyleLayer(c)}else{if("object"==typeof c.source&&(this.addSource(w,c.source),c=p.clone$1(c),c=p.extend(c,{source:w})),this._validate(p.validateLayer,`layers.${w}`,c,{arrayIndex:-1},_))return;C=p.createStyleLayer(c),this._validateLayer(C),C.setEventedParent(this,{layer:{id:w}}),this._serializedLayers[C.id]=C.serialize(),this._updateLayerCount(C,!0)}const I=h?this._order.indexOf(h):this._order.length;if(h&&-1===I)return void this.fire(new p.ErrorEvent(new Error(`Layer with id "${h}" does not exist on this map.`)));this._order.splice(I,0,w),this._layerOrderChanged=!0,this._layers[w]=C;const k=this._getLayerSourceCache(C);if(this._removedLayers[w]&&C.source&&k&&"custom"!==C.type){const R=this._removedLayers[w];delete this._removedLayers[w],R.type!==C.type?this._updatedSources[C.source]="clear":(this._updatedSources[C.source]="reload",k.pause())}this._updateLayer(C),C.onAdd&&C.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(c,h){if(this._checkLoaded(),this._changed=!0,!this._layers[c])return void this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be moved.`)));if(c===h)return;const _=this._order.indexOf(c);this._order.splice(_,1);const w=h?this._order.indexOf(h):this._order.length;h&&-1===w?this.fire(new p.ErrorEvent(new Error(`Layer with id "${h}" does not exist on this map.`))):(this._order.splice(w,0,c),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(c){this._checkLoaded();const h=this._layers[c];if(!h)return void this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be removed.`)));h.setEventedParent(null),this._updateLayerCount(h,!1);const _=this._order.indexOf(c);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[c]=h,delete this._layers[c],delete this._serializedLayers[c],delete this._updatedLayers[c],delete this._updatedPaintProps[c],h.onRemove&&h.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(c){return this._layers[c]}hasLayer(c){return c in this._layers}hasLayerType(c){for(const h in this._layers)if(this._layers[h].type===c)return!0;return!1}setLayerZoomRange(c,h,_){this._checkLoaded();const w=this.getLayer(c);w?w.minzoom===h&&w.maxzoom===_||(null!=h&&(w.minzoom=h),null!=_&&(w.maxzoom=_),this._updateLayer(w)):this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(c,h,_={}){this._checkLoaded();const w=this.getLayer(c);if(w){if(!me(w.filter,h))return null==h?(w.filter=void 0,void this._updateLayer(w)):void(this._validate(p.validateFilter,`layers.${w.id}.filter`,h,{layerType:w.type},_)||(w.filter=p.clone$1(h),this._updateLayer(w)))}else this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be filtered.`)))}getFilter(c){const h=this.getLayer(c);return h&&p.clone$1(h.filter)}setLayoutProperty(c,h,_,w={}){this._checkLoaded();const C=this.getLayer(c);C?me(C.getLayoutProperty(h),_)||(C.setLayoutProperty(h,_,w),this._updateLayer(C)):this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(c,h){const _=this.getLayer(c);if(_)return _.getLayoutProperty(h);this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style.`)))}setPaintProperty(c,h,_,w={}){this._checkLoaded();const C=this.getLayer(c);C?me(C.getPaintProperty(h),_)||(C.setPaintProperty(h,_,w)&&this._updateLayer(C),this._changed=!0,this._updatedPaintProps[c]=!0):this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(c,h){const _=this.getLayer(c);return _&&_.getPaintProperty(h)}setFeatureState(c,h){this._checkLoaded();const _=c.source,w=c.sourceLayer,C=this.getSource(_);if(!C)return void this.fire(new p.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const I=C.type;if("geojson"===I&&w)return void this.fire(new p.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===I&&!w)return void this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===c.id&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided.")));const k=this._getSourceCaches(_);for(const R of k)R.setFeatureState(w,c.id,h)}removeFeatureState(c,h){this._checkLoaded();const _=c.source,w=this.getSource(_);if(!w)return void this.fire(new p.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const C=w.type,I="vector"===C?c.sourceLayer:void 0;if("vector"===C&&!I)return void this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(h&&"string"!=typeof c.id&&"number"!=typeof c.id)return void this.fire(new p.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const k=this._getSourceCaches(_);for(const R of k)R.removeFeatureState(I,c.id,h)}getFeatureState(c){this._checkLoaded();const h=c.source,_=c.sourceLayer,w=this.getSource(h);if(w){if("vector"!==w.type||_)return void 0===c.id&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(h)[0].getFeatureState(_,c.id);this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return p.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const c={};for(const h in this._sourceCaches){const _=this._sourceCaches[h].getSource();c[_.id]||(c[_.id]=_.serialize())}return p.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:c,layers:this._serializeLayers(this._order)},h=>void 0!==h)}_updateLayer(c){this._updatedLayers[c.id]=!0;const h=this._getLayerSourceCache(c);c.source&&!this._updatedSources[c.source]&&h&&"raster"!==h.getSource().type&&(this._updatedSources[c.source]="reload",h.pause()),this._changed=!0,c.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(c){const h=I=>"fill-extrusion"===this._layers[I].type,_={},w=[];for(let I=this._order.length-1;I>=0;I--){const k=this._order[I];if(h(k)){_[k]=I;for(const R of c){const F=R[k];if(F)for(const N of F)w.push(N)}}}w.sort((I,k)=>k.intersectionZ-I.intersectionZ);const C=[];for(let I=this._order.length-1;I>=0;I--){const k=this._order[I];if(h(k))for(let R=w.length-1;R>=0;R--){const F=w[R].feature;if(_[F.layer.id]<I)break;C.push(F),w.pop()}else for(const R of c){const F=R[k];if(F)for(const N of F)C.push(N.feature)}}return C}queryRenderedFeatures(c,h,_){h&&h.filter&&this._validate(p.validateFilter,"queryRenderedFeatures.filter",h.filter,null,h);const w={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new p.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const R of h.layers){const F=this._layers[R];if(!F)return this.fire(new p.ErrorEvent(new Error(`The layer '${R}' does not exist in the map's style and cannot be queried for features.`))),[];w[F.source]=!0}}const C=[];h.availableImages=this._availableImages;const I=h&&h.layers?h.layers.some(R=>{const F=this.getLayer(R);return F&&F.is3D()}):this.has3DLayers(),k=Qt.createFromScreenPoints(c,_);for(const R in this._sourceCaches){const F=this._sourceCaches[R].getSource().id;h.layers&&!w[F]||C.push(ke(this._sourceCaches[R],this._layers,this._serializedLayers,k,h,_,I,!!this.map._showQueryGeometry))}return this.placement&&C.push(function(R,F,N,H,X,te,Q){const ne={},K=te.queryRenderedSymbols(H),Y=[];for(const se of Object.keys(K).map(Number))Y.push(Q[se]);Y.sort(Vt);for(const se of Y){const J=se.featureIndex.lookupSymbolFeatures(K[se.bucketInstanceId],F,se.bucketIndex,se.sourceLayerIndex,X.filter,X.layers,X.availableImages,R);for(const _e in J){const ve=ne[_e]=ne[_e]||[],he=J[_e];he.sort((Ce,He)=>{const it=se.featureSortOrder;if(it){const Qe=it.indexOf(Ce.featureIndex);return it.indexOf(He.featureIndex)-Qe}return He.featureIndex-Ce.featureIndex});for(const Ce of he)ve.push(Ce)}}for(const se in ne)ne[se].forEach(J=>{const _e=J.feature,ve=N(R[se]).getFeatureState(_e.layer["source-layer"],_e.id);_e.source=_e.layer.source,_e.layer["source-layer"]&&(_e.sourceLayer=_e.layer["source-layer"]),_e.state=ve});return ne}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),k.screenGeometry,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(C)}querySourceFeatures(c,h){h&&h.filter&&this._validate(p.validateFilter,"querySourceFeatures.filter",h.filter,null,h);const _=this._getSourceCaches(c);let w=[];for(const C of _)w=w.concat(ht(C,h));return w}addSourceType(c,h,_){return Aa.getSourceType(c)?_(new Error(`A source type called "${c}" already exists.`)):(Aa.setSourceType(c,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:c,url:h.workerSourceURL},_):_(null,null))}getLight(){return this.light.getLight()}setLight(c,h={}){this._checkLoaded();const _=this.light.getLight();let w=!1;for(const I in c)if(!me(c[I],_[I])){w=!0;break}if(!w)return;const C=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(c,h),this.light.updateTransitions(C)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(c,h=1){if(this._checkLoaded(),!c)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===h){if("object"==typeof c.source){const _="terrain-dem-src";this.addSource(_,c.source),c=p.clone$1(c),c=p.extend(c,{source:_})}if(this._validate(p.validateTerrain,"terrain",c))return}if(!this.terrain||this.terrain&&h!==this.terrain.drapeRenderMode)this._createTerrain(c,h);else{const _=this.terrain,w=_.get();for(const C of Object.keys(p.spec.terrain))!c.hasOwnProperty(C)&&p.spec.terrain[C].default&&(c[C]=p.spec.terrain[C].default);for(const C in c)if(!me(c[C],w[C])){_.set(c),this.stylesheet.terrain=c;const I=this._setTransitionParameters({duration:0});_.updateTransitions(I);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(c){const h=this.fog=new nr(c,this.map.transform);this.stylesheet.fog=c;const _=this._setTransitionParameters({duration:0});h.updateTransitions(_)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const c of this.map._markers)c._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(c){if(this._checkLoaded(),!c)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const h=this.fog,_=h.get();0===Object.keys(c).length&&h.set(c);for(const w in c)if(!me(c[w],_[w])){h.set(c),this.stylesheet.fog=c;const C=this._setTransitionParameters({duration:0});h.updateTransitions(C);break}}else this._createFog(c);this._markersNeedUpdate=!0}_setTransitionParameters(c){return{now:p.exported.now(),transition:p.extend(c,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const c=this._order.filter(_=>this.isLayerDraped(this._layers[_])),h=this._order.filter(_=>!this.isLayerDraped(this._layers[_]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...c),this._drapedFirstOrder.push(...h)}_createTerrain(c,h){const _=this.terrain=new wn(c,h);this.stylesheet.terrain=c,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const w=this._setTransitionParameters({duration:0});_.updateTransitions(w)}_force3DLayerUpdate(){for(const c in this._layers){const h=this._layers[c];"fill-extrusion"===h.type&&this._updateLayer(h)}}_forceSymbolLayerUpdate(){for(const c in this._layers){const h=this._layers[c];"symbol"===h.type&&this._updateLayer(h)}}_validate(c,h,_,w,C={}){return(!C||!1!==C.validate)&&Ma(this,c.call(p.validateStyle,p.extend({key:h,style:this.serialize(),value:_,styleSpec:p.spec},w)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),p.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const c in this._layers)this._layers[c].setEventedParent(null);for(const c in this._sourceCaches)this._sourceCaches[c].clearTiles(),this._sourceCaches[c].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(c){const h=this._getSourceCaches(c);for(const _ of h)_.clearTiles()}_reloadSource(c){const h=this._getSourceCaches(c);for(const _ of h)_.resume(),_.reload()}_reloadSources(){for(const c of this._getSources())c.reload&&c.reload()}_updateSources(c){for(const h in this._sourceCaches)this._sourceCaches[h].update(c)}_generateCollisionBoxes(){for(const c in this._sourceCaches){const h=this._sourceCaches[c];h.resume(),h.reload()}}_updatePlacement(c,h,_,w,C=!1){let I=!1,k=!1;const R={};for(const F of this._order){const N=this._layers[F];if("symbol"!==N.type)continue;if(!R[N.source]){const X=this._getLayerSourceCache(N);if(!X)continue;R[N.source]=X.getRenderableIds(!0).map(te=>X.getTileByID(te)).sort((te,Q)=>Q.tileID.overscaledZ-te.tileID.overscaledZ||(te.tileID.isLessThan(Q.tileID)?-1:1))}const H=this.crossTileSymbolIndex.addLayer(N,R[N.source],c.center.lng,c.projection);I=I||H}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),C=C||this._layerOrderChanged||0===_,this._layerOrderChanged&&this.fire(new p.Event("neworder")),(C||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(p.exported.now(),c.zoom))&&(this.pauseablePlacement=new hb(c,this._order,C,h,_,w,this.placement,this.fog&&c.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,R),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(p.exported.now()),k=!0),I&&this.pauseablePlacement.placement.setStale()),k||I)for(const F of this._order){const N=this._layers[F];"symbol"===N.type&&this.placement.updateLayerOpacities(N,R[N.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(p.exported.now())}_releaseSymbolFadeTiles(){for(const c in this._sourceCaches)this._sourceCaches[c].releaseSymbolFadeTiles()}getImages(c,h,_){this.imageManager.getImages(h.icons,_),this._updateTilesForChangedImages();const w=C=>{C&&C.setDependencies(h.tileID.key,h.type,h.icons)};w(this._otherSourceCaches[h.source]),w(this._symbolSourceCaches[h.source])}getGlyphs(c,h,_){this.glyphManager.getGlyphs(h.stacks,_)}getResource(c,h,_){return p.makeRequest(h,_)}_getSourceCache(c){return this._otherSourceCaches[c]}_getLayerSourceCache(c){return"symbol"===c.type?this._symbolSourceCaches[c.source]:this._otherSourceCaches[c.source]}_getSourceCaches(c){const h=[];return this._otherSourceCaches[c]&&h.push(this._otherSourceCaches[c]),this._symbolSourceCaches[c]&&h.push(this._symbolSourceCaches[c]),h}_isSourceCacheLoaded(c){const h=this._getSourceCaches(c);return 0===h.length?(this.fire(new p.ErrorEvent(new Error(`There is no source with ID '${c}'`))),!1):h.every(_=>_.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Aa.getSourceType=function(g){return je[g]},Aa.setSourceType=function(g,c){je[g]=c},Aa.registerForPluginStateChange=p.registerForPluginStateChange;var pb="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",ka="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",ua="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",ym="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",fb="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let Gs={},Sr={};const au=[];da(pb,au),da(ua,au),da(ym,au),da(fb,au),Gs=Bi("",ua),Sr=Bi(fb,ym);const vm=Bi("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),Gl=pb,Ji="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var lu={background:Bi("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:Bi("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:Bi("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:Bi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Bi("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:Bi("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Bi("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Bi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Bi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:Bi("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:Bi("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:Bi("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:Bi("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:Bi("varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\nvoid main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvec3 normal=v_normal;\n#endif\nfloat z;vec4 color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);\n#else\ncolor=v_color;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef ZERO_ROOF_RADIUS\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#endif\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;\n#endif\nfloat colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);directional*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\nv_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef ZERO_ROOF_RADIUS\nv_roof_color=vec4(0.0,0.0,0.0,1.0);float roof_radiance=clamp(u_lightpos.z,0.0,1.0);roof_radiance=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roof_radiance);v_roof_color.rgb+=clamp(color.rgb*roof_radiance*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:Bi("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);directional*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\nv_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:Bi("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Bi("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:Bi("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nuniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nhighp vec4 out_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nvec4 out_color=color;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);}}\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);\n#ifdef RENDER_LINE_BORDER_AUTO\nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}\n#else\nout_color.rgb=mix(u_border_color.rgb,out_color.rgb,smoothAlpha);\n#endif\n}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:Bi("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:Bi("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:Bi("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:Bi("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:Bi("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:Bi("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:Bi("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Bi("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",ka),skyboxGradient:Bi("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",ka),skyboxCapture:Bi("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Bi("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\ncolor=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;\n#ifdef GLOBE_POLES\nvec3 up_vector=normalize(globe_pos)*u_tile_up_scale;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:Bi("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function da(g,c){const h=g.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let _ of h)if(_=_.trim(),"#"===_[0]&&_.includes("if")&&!_.includes("endif")){_=_.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const w=_.split(" ");for(const C of w)c.includes(C)||c.push(C)}}function Bi(g,c){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,_=c.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),w={},C=[...au];return da(g,C),da(c,C),{fragmentSource:g=g.replace(h,(I,k,R,F,N)=>(w[N]=!0,"define"===k?`\n#ifndef HAS_UNIFORM_u_${N}\nvarying ${R} ${F} ${N};\n#else\nuniform ${R} ${F} u_${N};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${N}\n    ${R} ${F} ${N} = u_${N};\n#endif\n`)),vertexSource:c=c.replace(h,(I,k,R,F,N)=>{const H="float"===F?"vec2":"vec4",X=N.match(/color/)?"color":H;return w[N]?"define"===k?`\n#ifndef HAS_UNIFORM_u_${N}\nuniform lowp float u_${N}_t;\nattribute ${R} ${H} a_${N};\nvarying ${R} ${F} ${N};\n#else\nuniform ${R} ${F} u_${N};\n#endif\n`:"vec4"===X?`\n#ifndef HAS_UNIFORM_u_${N}\n    ${N} = a_${N};\n#else\n    ${R} ${F} ${N} = u_${N};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${N}\n    ${N} = unpack_mix_${X}(a_${N}, u_${N}_t);\n#else\n    ${R} ${F} ${N} = u_${N};\n#endif\n`:"define"===k?`\n#ifndef HAS_UNIFORM_u_${N}\nuniform lowp float u_${N}_t;\nattribute ${R} ${H} a_${N};\n#else\nuniform ${R} ${F} u_${N};\n#endif\n`:"vec4"===X?`\n#ifndef HAS_UNIFORM_u_${N}\n    ${R} ${F} ${N} = a_${N};\n#else\n    ${R} ${F} ${N} = u_${N};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${N}\n    ${R} ${F} ${N} = unpack_mix_${X}(a_${N}, u_${N}_t);\n#else\n    ${R} ${F} ${N} = u_${N};\n#endif\n`}),staticAttributes:_,usedDefines:C}}class cu{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(c,h,_,w,C,I,k){this.context=c;let R=this.boundPaintVertexBuffers.length!==w.length;for(let N=0;!R&&N<w.length;N++)this.boundPaintVertexBuffers[N]!==w[N]&&(R=!0);let F=this.boundDynamicVertexBuffers.length!==k.length;for(let N=0;!F&&N<k.length;N++)this.boundDynamicVertexBuffers[N]!==k[N]&&(F=!0);if(!c.extVertexArrayObject||!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==_||R||F||this.boundIndexBuffer!==C||this.boundVertexOffset!==I)this.freshBind(h,_,w,C,I,k);else{c.bindVertexArrayOES.set(this.vao);for(const N of k)N&&N.bind();C&&C.dynamicDraw&&C.bind()}}freshBind(c,h,_,w,C,I){let k;const R=c.numAttributes,F=this.context,N=F.gl;if(F.extVertexArrayObject)this.vao&&this.destroy(),this.vao=F.extVertexArrayObject.createVertexArrayOES(),F.bindVertexArrayOES.set(this.vao),k=0,this.boundProgram=c,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=w,this.boundVertexOffset=C,this.boundDynamicVertexBuffers=I;else{k=F.currentNumAttributes||0;for(let H=R;H<k;H++)N.disableVertexAttribArray(H)}h.enableAttributes(N,c),h.bind(),h.setVertexAttribPointers(N,c,C);for(const H of _)H.enableAttributes(N,c),H.bind(),H.setVertexAttribPointers(N,c,C);for(const H of I)H&&(H.enableAttributes(N,c),H.bind(),H.setVertexAttribPointers(N,c,C));w&&w.bind(),F.currentNumAttributes=R}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function ha(g,c){const h=Math.pow(2,c.canonical.z),_=c.canonical.y;return[new p.MercatorCoordinate(0,_/h).toLngLat().lat,new p.MercatorCoordinate(0,(_+1)/h).toLngLat().lat]}function ql(g,c,h,_,w,C,I){const k=g.context,R=k.gl,F=h.fbo;if(!F)return;g.prepareDrawTile();const N=g.useProgram("hillshade");k.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,F.colorAttachment.get());const H=((ne,K,Y,se)=>{const J=Y.paint.get("hillshade-shadow-color"),_e=Y.paint.get("hillshade-highlight-color"),ve=Y.paint.get("hillshade-accent-color");let he=Y.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===Y.paint.get("hillshade-illumination-anchor")&&(he-=ne.transform.angle);const Ce=!ne.options.moving;return{u_matrix:se||ne.transform.calculateProjMatrix(K.tileID.toUnwrapped(),Ce),u_image:0,u_latrange:ha(0,K.tileID),u_light:[Y.paint.get("hillshade-exaggeration"),he],u_shadow:J,u_highlight:_e,u_accent:ve}})(g,h,_,g.terrain?c.projMatrix:null);g.prepareDrawProgram(k,N,c.toUnwrapped());const{tileBoundsBuffer:X,tileBoundsIndexBuffer:te,tileBoundsSegments:Q}=g.getTileBoundsBuffers(h);N.draw(k,R.TRIANGLES,w,C,I,p.CullFaceMode.disabled,H,_.id,X,te,Q)}function dh(g,c,h){if(!c.needsDEMTextureUpload)return;const _=g.context,w=_.gl;_.pixelStoreUnpackPremultiplyAlpha.set(!1),c.demTexture=c.demTexture||g.getTileTexture(h.stride);const C=h.getPixels();c.demTexture?c.demTexture.update(C,{premultiply:!1}):c.demTexture=new p.Texture(_,C,w.RGBA,{premultiply:!1}),c.needsDEMTextureUpload=!1}function kn(g,c,h,_,w,C){const I=g.context,k=I.gl;if(!c.dem)return;const R=c.dem;if(I.activeTexture.set(k.TEXTURE1),dh(g,c,R),!c.demTexture)return;c.demTexture.bind(k.NEAREST,k.CLAMP_TO_EDGE);const F=R.dim;I.activeTexture.set(k.TEXTURE0);let N=c.fbo;if(!N){const Q=new p.Texture(I,{width:F,height:F,data:null},k.RGBA);Q.bind(k.LINEAR,k.CLAMP_TO_EDGE),N=c.fbo=I.createFramebuffer(F,F,!0),N.colorAttachment.set(Q.texture)}I.bindFramebuffer.set(N.framebuffer),I.viewport.set([0,0,F,F]);const{tileBoundsBuffer:H,tileBoundsIndexBuffer:X,tileBoundsSegments:te}=g.getMercatorTileBoundsBuffers();g.useProgram("hillshadePrepare").draw(I,k.TRIANGLES,_,w,C,p.CullFaceMode.disabled,((Q,ne)=>{const K=ne.stride,Y=p.create();return p.ortho(Y,0,p.EXTENT,-p.EXTENT,0,0,1),p.translate(Y,Y,[0,-p.EXTENT,0]),{u_matrix:Y,u_image:1,u_dimension:[K,K],u_zoom:Q.overscaledZ,u_unpack:ne.unpackVector}})(c.tileID,R),h.id,H,X,te),c.needsHillshadePrepare=!1}const hh=g=>({u_matrix:new p.UniformMatrix4f(g),u_image0:new p.Uniform1i(g),u_skirt_height:new p.Uniform1f(g)}),ph=(g,c)=>({u_matrix:g,u_image0:0,u_skirt_height:c}),Yu=(g,c,h,_,w,C,I,k,R,F,N,H,X,te)=>({u_proj_matrix:Float32Array.from(g),u_globe_matrix:c,u_normalize_matrix:Float32Array.from(_),u_merc_matrix:h,u_zoom_transition:w,u_merc_center:C,u_image0:0,u_frustum_tl:I,u_frustum_tr:k,u_frustum_br:R,u_frustum_bl:F,u_globe_pos:N,u_globe_radius:H,u_viewport:X,u_grid_matrix:te?Float32Array.from(te):new Float32Array(9)});function Qu(g,c){return null!=g&&null!=c&&!(!g.hasData()||!c.hasData())&&null!=g.demTexture&&null!=c.demTexture&&g.tileID.key!==c.tileID.key}const gn=new class{constructor(){this.operations={}}newMorphing(g,c,h,_,w){if(g in this.operations){const C=this.operations[g];C.to.tileID.key!==h.tileID.key&&(C.queued=h)}else this.operations[g]={startTime:_,phase:0,duration:w,from:c,to:h,queued:null}}getMorphValuesForProxy(g){if(!(g in this.operations))return null;const c=this.operations[g];return{from:c.from,to:c.to,phase:c.phase}}update(g){for(const c in this.operations){const h=this.operations[c];for(h.phase=(g-h.startTime)/h.duration;h.phase>=1||!this._validOp(h);)if(!this._nextOp(h,g)){delete this.operations[c];break}}}_nextOp(g,c){return!!g.queued&&(g.from=g.to,g.to=g.queued,g.queued=null,g.phase=0,g.startTime=c,!0)}_validOp(g){return g.from.hasData()&&g.to.hasData()}},uu={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function zi(g,c){const h=1<<g.z;return!c&&(0===g.x||g.x===h-1)||0===g.y||g.y===h-1}const vt=g=>({u_matrix:g});function ns(g,c,h,_,w){if(w>0){const C=p.exported.now(),I=(C-g.timeAdded)/w,k=c?(C-c.timeAdded)/w:-1,R=h.getSource(),F=_.coveringZoomLevel({tileSize:R.tileSize,roundZoom:R.roundZoom}),N=!c||Math.abs(c.tileID.overscaledZ-F)>Math.abs(g.tileID.overscaledZ-F),H=N&&g.refreshedUponExpiration?1:p.clamp(N?I:1-k,0,1);return g.refreshedUponExpiration&&I>=1&&(g.refreshedUponExpiration=!1),c?{opacity:1,mix:1-H}:{opacity:H,mix:0}}return{opacity:1,mix:0}}class Fr extends p.SourceCache{constructor(c){const h={type:"raster-dem",maxzoom:c.transform.maxZoom},_=new qr(Xn(),null),w=de("mock-dem",h,_,c.style);super("mock-dem",w,!1),w.setEventedParent(this),this._sourceLoaded=!0}_loadTile(c,h){c.state="loaded",h(null)}}class is extends p.SourceCache{constructor(c){const h=de("proxy",{type:"geojson",maxzoom:c.transform.maxZoom},new qr(Xn(),null),c.style);super("proxy",h,!1),h.setEventedParent(this),this.map=this.getSource().map=c,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(c,h,_){if(c.freezeTileCoverage)return;this.transform=c;const w=c.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((C,I)=>{if(C[I.key]="",!this._tiles[I.key]){const k=new p.Tile(I,this._source.tileSize*I.overscaleFactor(),c.tileZoom);k.state="loaded",this._tiles[I.key]=k}return C},{});for(const C in this._tiles)C in w||(this.freeFBO(C),this._tiles[C].unloadVectorData(),delete this._tiles[C])}freeFBO(c){const h=this.proxyCachedFBO[c];if(void 0!==h){const _=Object.values(h);this.renderCachePool.push(..._),delete this.proxyCachedFBO[c]}}deallocRenderCache(){this.renderCache.forEach(c=>c.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Lo extends p.OverscaledTileID{constructor(c,h,_){super(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,c.canonical.y),this.proxyTileKey=h,this.projMatrix=_}}class Os extends p.Elevation{constructor(c,h){super(),this.painter=c,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[_,w,C]=function(R){const F=new p.StructArrayLayout4i8,N=new p.StructArrayLayout3ui6,H=131;F.reserve(17161),N.reserve(33800);const X=p.EXTENT/128,te=p.EXTENT+X/2,Q=te+X;for(let K=-X;K<Q;K+=X)for(let Y=-X;Y<Q;Y+=X){const se=Y<0||Y>te||K<0||K>te?24575:0,J=p.clamp(Math.round(Y),0,p.EXTENT),_e=p.clamp(Math.round(K),0,p.EXTENT);F.emplaceBack(J+se,_e,J,_e)}const ne=(K,Y)=>{const se=Y*H+K;N.emplaceBack(se+1,se,se+H),N.emplaceBack(se+H,se+H+1,se+1)};for(let K=1;K<129;K++)for(let Y=1;Y<129;Y++)ne(Y,K);return[0,129].forEach(K=>{for(let Y=0;Y<130;Y++)ne(Y,K),ne(K,Y)}),[F,N,32768]}(),I=c.context;this.gridBuffer=I.createVertexBuffer(_,p.boundsAttributes.members),this.gridIndexBuffer=I.createIndexBuffer(w),this.gridSegments=p.SegmentVector.simpleSegment(0,0,_.length,w.length),this.gridNoSkirtSegments=p.SegmentVector.simpleSegment(0,0,_.length,C),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new is(h.map),this.orthoMatrix=p.create(),p.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,p.EXTENT,0,p.EXTENT,0,1);const k=I.gl;this._overlapStencilMode=new p.StencilMode({func:k.GEQUAL,mask:255},0,255,k.KEEP,k.KEEP,k.REPLACE),this._previousZoom=c.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=h,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Fr(h.map)}set style(c){c.on("data",this._onStyleDataEvent.bind(this)),c.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=c,this._checkRenderCacheEfficiency()}update(c,h,_){if(c&&c.terrain){this._style!==c&&(this.style=c),this.enabled=!0;const w=c.terrain.properties;this.sourceCache=0===c.terrain.drapeRenderMode?this._mockSourceCache:c._getSourceCache(w.get("source")),this._exaggeration=w.get("exaggeration");const C=()=>{this.sourceCache.used&&p.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const I=this.getScaledDemTileSize();this.sourceCache.update(h,I,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,C(),this._initializing=!0),C(),h.updateElevation(!_),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(h),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(c){this._findCoveringTileCache[c]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const c=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==c.efficiency&&p.warnOnce(`Terrain render cache efficiency is not optimal (${c.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${c.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(c){c.coord&&"source"===c.dataType?this._clearRenderCacheForTile(c.sourceCacheId,c.coord):"style"===c.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const c in this._style._sourceCaches)this._style._sourceCaches[c].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(c=>c.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const c=2*this.proxySourceCache.getSource().tileSize;return[c,c]}set useVertexMorphing(c){this._useVertexMorphing=c}updateTileBinding(c){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const h=this.proxySourceCache,_=this.painter.transform;this._initializing&&(this._initializing=0===_._centerAltitude&&-1===this.getAtPointOrZero(p.MercatorCoordinate.fromLngLat(_.center),-1),this._emptyDEMTextureDirty=!this._initializing);const w=this.proxyCoords=h.getIds().map(R=>{const F=h.getTileByID(R).tileID;return F.projMatrix=_.calculateProjMatrix(F.toUnwrapped()),F});(function(R,F){const N=F.transform.pointCoordinate(F.transform.getCameraPoint()),H=new p.pointGeometry(N.x,N.y);R.sort((X,te)=>{if(te.overscaledZ-X.overscaledZ)return te.overscaledZ-X.overscaledZ;const Q=new p.pointGeometry(X.canonical.x+(1<<X.canonical.z)*X.wrap,X.canonical.y),ne=new p.pointGeometry(te.canonical.x+(1<<te.canonical.z)*te.wrap,te.canonical.y),K=H.mult(1<<X.canonical.z);return K.x-=.5,K.y-=.5,K.distSqr(Q)-K.distSqr(ne)})})(w,this.painter),this._previousZoom=_.zoom;const C=this.proxyToSource||{};this.proxyToSource={},w.forEach(R=>{this.proxyToSource[R.key]={}}),this.terrainTileForTile={};const I=this._style._sourceCaches;for(const R in I){const F=I[R];if(!F.used||(F!==this.sourceCache&&this.resetTileLookupCache(F.id),this._setupProxiedCoordsForOrtho(F,c[R],C),F.usedForTerrain))continue;const N=c[R];F.getSource().reparseOverscaled&&this._assignTerrainTiles(N)}this.proxiedCoords[h.id]=w.map(R=>new Lo(R,R.key,this.orthoMatrix)),this._assignTerrainTiles(w),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(C),this.renderingToTexture=!1,this._updateTimestamp=p.exported.now();const k={};this._visibleDemTiles=[];for(const R of this.proxyCoords){const F=this.terrainTileForTile[R.key];if(!F)continue;const N=F.tileID.key;N in k||(this._visibleDemTiles.push(F),k[N]=N)}}_assignTerrainTiles(c){this._initializing||c.forEach(h=>{if(this.terrainTileForTile[h.key])return;const _=this._findTileCoveringTileID(h,this.sourceCache);_&&(this.terrainTileForTile[h.key]=_)})}_prepareDEMTextures(){const c=this.painter.context,h=c.gl;for(const _ in this.terrainTileForTile){const w=this.terrainTileForTile[_],C=w.dem;!C||w.demTexture&&!w.needsDEMTextureUpload||(c.activeTexture.set(h.TEXTURE1),dh(this.painter,w,C))}}_prepareDemTileUniforms(c,h,_,w){if(!h||null==h.demTexture)return!1;const C=c.tileID.canonical,I=Math.pow(2,h.tileID.canonical.z-C.z),k=w||"";return _[`u_dem_tl${k}`]=[C.x*I%1,C.y*I%1],_[`u_dem_scale${k}`]=I,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const c=this.painter.context,h=c.gl;if(!this._emptyDepthBufferTexture){const _=new p.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new p.Texture(c,_,h.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let c=0;const h=this._visibleDemTiles.reduce((_,w)=>{if(!w.dem)return _;const C=w.dem.tree.minimums[0];return C>0&&c++,_+C},0);return c?h/c:0}_updateEmptyDEMTexture(){const c=this.painter.context,h=c.gl;c.activeTexture.set(h.TEXTURE2);const _=this._getLoadedAreaMinimum(),w=new p.RGBAImage({width:1,height:1},new Uint8Array(p.DEMData.pack(_,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let C=this._emptyDEMTexture;return C?C.update(w,{premultiply:!1}):C=this._emptyDEMTexture=new p.Texture(c,w,h.RGBA,{premultiply:!1}),C}setupElevationDraw(c,h,_){const w=this.painter.context,C=w.gl,I=(k=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:p.DEMData.getUnpackVector(k),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var k;I.u_dem_size=this.sourceCache.getSource().tileSize,I.u_exaggeration=this.exaggeration();let R=null,F=null,N=1;if(_&&_.morphing&&this._useVertexMorphing){const H=_.morphing.srcDemTile,X=_.morphing.dstDemTile;N=_.morphing.phase,H&&X&&(this._prepareDemTileUniforms(c,H,I,"_prev")&&(F=H),this._prepareDemTileUniforms(c,X,I)&&(R=X))}if(F&&R?(w.activeTexture.set(C.TEXTURE2),R.demTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE,C.NEAREST),w.activeTexture.set(C.TEXTURE4),F.demTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE,C.NEAREST),I.u_dem_lerp=N):(R=this.terrainTileForTile[c.tileID.key],w.activeTexture.set(C.TEXTURE2),(this._prepareDemTileUniforms(c,R,I)?R.demTexture:this.emptyDEMTexture).bind(C.NEAREST,C.CLAMP_TO_EDGE)),w.activeTexture.set(C.TEXTURE3),_&&_.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE),this._depthFBO&&(I.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE),I.u_depth_size_inv=[1,1]),_&&_.useMeterToDem&&R){const H=(1<<R.tileID.canonical.z)*p.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;I.u_meter_to_dem=H}if(_&&_.labelPlaneMatrixInv&&(I.u_label_plane_matrix_inv=_.labelPlaneMatrixInv),h.setTerrainUniformValues(w,I),"globe"===this.painter.transform.projection.name){const H=this.globeUniformValues(this.painter.transform,c.tileID.canonical,_&&_.useDenormalizedUpVectorScale);h.setGlobeUniformValues(w,H)}}globeUniformValues(c,h,_){const w=c.projection;return{u_tile_tl_up:w.upVector(h,0,0),u_tile_tr_up:w.upVector(h,p.EXTENT,0),u_tile_br_up:w.upVector(h,p.EXTENT,p.EXTENT),u_tile_bl_up:w.upVector(h,0,p.EXTENT),u_tile_up_scale:_?p.GLOBE_METERS_TO_ECEF:w.upVectorScale(h,c.center.lat,c.worldSize).metersToTile}}renderToBackBuffer(c){const h=this.painter,_=this.painter.context;0!==c.length&&(_.bindFramebuffer.set(null),_.viewport.set([0,0,h.width,h.height]),h.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(w,C,I,k,R){if("globe"===w.transform.projection.name)!function(F,N,H,X,te){const Q=F.context,ne=Q.gl;let K,Y;const se=F.options.showTerrainWireframe?2:0,J=F.transform,_e=p.globeUseCustomAntiAliasing(F,Q,J),ve=(qe,Me)=>{if(Y===qe)return;const Gt=[uu[qe],"PROJECTION_GLOBE_VIEW"];_e&&Gt.push("CUSTOM_ANTIALIASING"),Me&&Gt.push(uu[se]),K=F.useProgram("globeRaster",null,Gt),Y=qe},he=F.colorModeForRenderPass(),Ce=new p.DepthMode(ne.LEQUAL,p.DepthMode.ReadWrite,F.depthRangeFor3D);gn.update(te);const He=p.calculateGlobeMercatorMatrix(J),it=[p.mercatorXfromLng(J.center.lng),p.mercatorYfromLat(J.center.lat)],Qe=se?[!1,!0]:[!1],wt=F.globeSharedBuffers,Le=[J.width*p.exported.devicePixelRatio,J.height*p.exported.devicePixelRatio],ft=Float32Array.from(J.globeMatrix),gt={useDenormalizedUpVectorScale:!0};if(Qe.forEach(qe=>{Y=-1;const Me=qe?ne.LINES:ne.TRIANGLES;for(const Gt of X){const It=H.getTile(Gt),jt=p.StencilMode.disabled,Lt=N.prevTerrainTileForTile[Gt.key],bn=N.terrainTileForTile[Gt.key];Qu(Lt,bn)&&gn.newMorphing(Gt.key,Lt,bn,te,250),Q.activeTexture.set(ne.TEXTURE0),It.texture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE);const Gn=gn.getMorphValuesForProxy(Gt.key),Rn=Gn?1:0;Gn&&p.extend$1(gt,{morphing:{srcDemTile:Gn.from,dstDemTile:Gn.to,phase:p.easeCubicInOut(Gn.phase)}});const yn=p.tileCornersToBounds(Gt.canonical),Nt=p.getLatitudinalLod(yn.getCenter().lat),Jn=p.getGridMatrix(Gt.canonical,yn,Nt,J.worldSize/J._pixelsPerMercatorPixel),bi=p.globeNormalizeECEF(p.globeTileBounds(Gt.canonical)),hr=Yu(J.projMatrix,ft,He,bi,p.globeToMercatorTransition(J.zoom),it,J.frustumCorners.TL,J.frustumCorners.TR,J.frustumCorners.BR,J.frustumCorners.BL,J.globeCenterInViewSpace,J.globeRadius,Le,Jn);if(ve(Rn,qe),N.setupElevationDraw(It,K,gt),F.prepareDrawProgram(Q,K,Gt.toUnwrapped()),wt){const[pr,or,io]=qe?wt.getWirefameBuffers(F.context,Nt):wt.getGridBuffers(Nt);K.draw(Q,Me,Ce,jt,he,p.CullFaceMode.backCCW,hr,"globe_raster",pr,or,io)}}}),wt){const qe=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];_e&&qe.push("CUSTOM_ANTIALIASING"),K=F.useProgram("globeRaster",null,qe);for(const Me of X){const{x:Gt,y:It,z:jt}=Me.canonical,Lt=0===It,bn=It===(1<<jt)-1,[Gn,Rn,yn,Nt]=wt.getPoleBuffers(jt);if(Nt&&(Lt||bn)){const Jn=H.getTile(Me);Q.activeTexture.set(ne.TEXTURE0),Jn.texture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE);let bi=p.globePoleMatrixForTile(jt,Gt,J);const hr=p.globeNormalizeECEF(p.globeTileBounds(Me.canonical)),pr=(or,io)=>or.draw(Q,ne.TRIANGLES,Ce,p.StencilMode.disabled,he,p.CullFaceMode.disabled,Yu(J.projMatrix,bi,bi,hr,0,it,J.frustumCorners.TL,J.frustumCorners.TR,J.frustumCorners.BR,J.frustumCorners.BL,J.globeCenterInViewSpace,J.globeRadius,Le),"globe_pole_raster",io,yn,Nt);N.setupElevationDraw(Jn,K,gt),F.prepareDrawProgram(Q,K,Me.toUnwrapped()),Lt&&pr(K,Gn),bn&&(bi=p.scale(p.create(),bi,[1,-1,1]),pr(K,Rn))}}}}(w,C,I,k,R);else{const F=w.context,N=F.gl;let H,X;const te=w.options.showTerrainWireframe?2:0,Q=(J,_e)=>{if(X===J)return;const ve=[uu[J]];_e&&ve.push(uu[te]),H=w.useProgram("terrainRaster",null,ve),X=J},ne=w.colorModeForRenderPass(),K=new p.DepthMode(N.LEQUAL,p.DepthMode.ReadWrite,w.depthRangeFor3D);gn.update(R);const Y=w.transform,se=6*Math.pow(1.5,22-Y.zoom)*C.exaggeration();(te?[!1,!0]:[!1]).forEach(J=>{X=-1;const _e=J?N.LINES:N.TRIANGLES,[ve,he]=J?C.getWirefameBuffer():[C.gridIndexBuffer,C.gridSegments];for(const Ce of k){const He=I.getTile(Ce),it=p.StencilMode.disabled,Qe=C.prevTerrainTileForTile[Ce.key],wt=C.terrainTileForTile[Ce.key];Qu(Qe,wt)&&gn.newMorphing(Ce.key,Qe,wt,R,250),F.activeTexture.set(N.TEXTURE0),He.texture.bind(N.LINEAR,N.CLAMP_TO_EDGE,N.LINEAR_MIPMAP_NEAREST);const Le=gn.getMorphValuesForProxy(Ce.key),ft=Le?1:0;let gt;Le&&(gt={morphing:{srcDemTile:Le.from,dstDemTile:Le.to,phase:p.easeCubicInOut(Le.phase)}});const qe=ph(Ce.projMatrix,zi(Ce.canonical,Y.renderWorldCopies)?se/10:se);Q(ft,J),C.setupElevationDraw(He,H,gt),w.prepareDrawProgram(F,H,Ce.toUnwrapped()),H.draw(F,_e,K,it,ne,p.CullFaceMode.backCCW,qe,"terrain_raster",C.gridBuffer,ve,he)}})}}(h,this,this.proxySourceCache,c,this._updateTimestamp),this.renderingToTexture=!0,h.gpuTimingDeferredRenderEnd(),c.splice(0,c.length))}renderBatch(c){if(0===this._drapedRenderBatches.length)return c+1;this.renderingToTexture=!0;const h=this.painter,_=this.painter.context,w=this.proxySourceCache,C=this.proxiedCoords[w.id],I=this._drapedRenderBatches.shift(),k=[],R=h.style.order;let F=0;for(const N of C){const H=w.getTileByID(N.proxyTileKey),X=w.proxyCachedFBO[N.key]?w.proxyCachedFBO[N.key][c]:void 0,te=void 0!==X?w.renderCache[X]:this.pool[F++],Q=void 0!==X;if(H.texture=te.tex,Q&&!te.dirty){k.push(H.tileID);continue}let ne;_.bindFramebuffer.set(te.fb.framebuffer),this.renderedToTile=!1,te.dirty&&(_.clear({color:p.Color.transparent,stencil:0}),te.dirty=!1);for(let K=I.start;K<=I.end;++K){const Y=h.style._layers[R[K]];if(Y.isHidden(h.transform.zoom))continue;const se=h.style._getLayerSourceCache(Y),J=se?this.proxyToSource[N.key][se.id]:[N];if(!J)continue;const _e=J;_.viewport.set([0,0,te.fb.width,te.fb.height]),ne!==(se?se.id:null)&&(this._setupStencil(te,J,Y,se),ne=se?se.id:null),h.renderLayer(h,se,Y,_e)}this.renderedToTile?(te.dirty=!0,k.push(H.tileID)):Q||--F,5===F&&(F=0,this.renderToBackBuffer(k))}return this.renderToBackBuffer(k),this.renderingToTexture=!1,_.bindFramebuffer.set(null),_.viewport.set([0,0,h.width,h.height]),I.end+1}postRender(){}renderCacheEfficiency(c){const h=c.order.length;if(0===h)return{efficiency:100};let _,w=0,C=0,I=!1;for(let k=0;k<h;++k){const R=c._layers[c.order[k]];this._style.isLayerDraped(R)?(I&&++w,++C):I||(I=!0,_=R.id)}return 0===C?{efficiency:100}:{efficiency:100*(1-w/C),firstUndrapedLayer:_}}getMinElevationBelowMSL(){let c=0;return this._visibleDemTiles.filter(h=>h.dem).forEach(h=>{c=Math.min(c,h.dem.tree.minimums[0])}),0===c?c:(c-30)*this._exaggeration}raycast(c,h,_){if(!this._visibleDemTiles)return null;const w=this._visibleDemTiles.filter(C=>C.dem).map(C=>{const I=C.tileID,k=1<<I.overscaledZ,{x:R,y:F}=I.canonical,N=R/k,H=(R+1)/k,X=F/k,te=(F+1)/k;return{minx:N,miny:X,maxx:H,maxy:te,t:C.dem.tree.raycastRoot(N,X,H,te,c,h,_),tile:C}});w.sort((C,I)=>(null!==C.t?C.t:Number.MAX_VALUE)-(null!==I.t?I.t:Number.MAX_VALUE));for(const C of w){if(null==C.t)return null;const I=C.tile.dem.tree.raycast(C.minx,C.miny,C.maxx,C.maxy,c,h,_);if(null!=I)return I}return null}_createFBO(){const c=this.painter.context,h=c.gl,_=this.drapeBufferSize;c.activeTexture.set(h.TEXTURE0);const w=new p.Texture(c,{width:_[0],height:_[1],data:null},h.RGBA);w.bind(h.LINEAR,h.CLAMP_TO_EDGE);const C=c.createFramebuffer(_[0],_[1],!1);return C.colorAttachment.set(w.texture),C.depthAttachment=new li(c,C.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=c.createRenderbuffer(c.gl.DEPTH_STENCIL,_[0],_[1]),this._stencilRef=0,C.depthAttachment.set(this._sharedDepthStencil),c.clear({stencil:0})):C.depthAttachment.set(this._sharedDepthStencil),c.extTextureFilterAnisotropic&&!c.extTextureFilterAnisotropicForceOff&&h.texParameterf(h.TEXTURE_2D,c.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c.extTextureFilterAnisotropicMax),{fb:C,tex:w,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const c in this._style._sourceCaches)if(this._style._sourceCaches[c].hasTransition())return!0;return this._style.order.some(c=>{const h=this._style._layers[c],_=h.isHidden(this.painter.transform.zoom),w=h.getCrossfadeParameters(),C=!!w&&1!==w.t,I=h.hasTransition();return"custom"!==h.type&&!_&&(C||I)})}_clearRasterFadeFromRenderCache(){let c=!1;for(const h in this._style._sourceCaches)if(this._style._sourceCaches[h]._source instanceof q){c=!0;break}if(c)for(let h=0;h<this._style.order.length;++h){const _=this._style._layers[this._style.order[h]],w=_.isHidden(this.painter.transform.zoom),C=this._style._getLayerSourceCache(_);if("raster"!==_.type||w||!C)continue;const I=_.paint.get("raster-fade-duration");for(const k of this.proxyCoords){const R=this.proxyToSource[k.key][C.id];if(R)for(const F of R){const N=ns(C.getTile(F),C.findLoadedParent(F,0),C,this.painter.transform,I);(1!==N.opacity||0!==N.mix)&&this._clearRenderCacheForTile(C.id,F)}}}}_setupDrapedRenderBatches(){const c=this._style.order,h=c.length;if(0===h)return;const _=[];let w,C=0,I=this._style._layers[c[C]];for(;!this._style.isLayerDraped(I)&&I.isHidden(this.painter.transform.zoom)&&++C<h;)I=this._style._layers[c[C]];for(;C<h;++C){const k=this._style._layers[c[C]];k.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(k)?void 0===w&&(w=C):void 0!==w&&(_.push({start:w,end:C-1}),w=void 0))}void 0!==w&&_.push({start:w,end:C-1}),this._drapedRenderBatches=_}_setupRenderCache(c){const h=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,h.renderCache.length>h.renderCachePool.length){const I=Object.values(h.proxyCachedFBO);h.proxyCachedFBO={};for(let k=0;k<I.length;++k){const R=Object.values(I[k]);h.renderCachePool.push(...R)}}return}this._clearRasterFadeFromRenderCache();const _=this.proxyCoords,w=this._tilesDirty;for(let I=_.length-1;I>=0;I--){const k=_[I];if(h.getTileByID(k.key),void 0!==h.proxyCachedFBO[k.key]){const R=c[k.key],F=this.proxyToSource[k.key];let N=0;for(const H in F){const X=F[H],te=R[H];if(!te||te.length!==X.length||X.some((Q,ne)=>Q!==te[ne]||w[H]&&w[H].hasOwnProperty(Q.key))){N=-1;break}++N}for(const H in h.proxyCachedFBO[k.key])h.renderCache[h.proxyCachedFBO[k.key][H]].dirty=N<0||N!==Object.values(R).length}}const C=[...this._drapedRenderBatches];C.sort((I,k)=>k.end-k.start-(I.end-I.start));for(const I of C)for(const k of _){if(h.proxyCachedFBO[k.key])continue;let R=h.renderCachePool.pop();void 0===R&&h.renderCache.length<50&&(R=h.renderCache.length,h.renderCache.push(this._createFBO())),void 0!==R&&(h.proxyCachedFBO[k.key]={},h.proxyCachedFBO[k.key][I.start]=R,h.renderCache[R].dirty=!0)}this._tilesDirty={}}_setupStencil(c,h,_,w){if(!w||!this._sourceTilesOverlap[w.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const C=this.painter.context,I=C.gl;if(h.length<=1)return void(this._overlapStencilType=!1);let k;if(_.isTileClipped())k=h.length,this._overlapStencilMode.test={func:I.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(h[0].overscaledZ>h[h.length-1].overscaledZ))return void(this._overlapStencilType=!1);k=1,this._overlapStencilMode.test={func:I.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+k>255&&(C.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=k,this._overlapStencilMode.ref=this._stencilRef,_.isTileClipped()&&this._renderTileClippingMasks(h,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(c){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[c.key]),this._overlapStencilMode):p.StencilMode.disabled}_renderTileClippingMasks(c,h){const _=this.painter,w=this.painter.context,C=w.gl;_._tileClippingMaskIDs={},w.setColorMode(p.ColorMode.disabled),w.setDepthMode(p.DepthMode.disabled);const I=_.useProgram("clippingMask");for(const k of c){const R=_._tileClippingMaskIDs[k.key]=--h;I.draw(w,C.TRIANGLES,p.DepthMode.disabled,new p.StencilMode({func:C.ALWAYS,mask:0},R,255,C.KEEP,C.KEEP,C.REPLACE),p.ColorMode.disabled,p.CullFaceMode.disabled,vt(k.projMatrix),"$clipping",_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}}pointCoordinate(c){const h=this.painter.transform;if(c.x<0||c.x>h.width||c.y<0||c.y>h.height)return null;const _=[c.x,c.y,1,1];p.transformMat4$1(_,_,h.pixelMatrixInverse),p.scale$1(_,_,1/_[3]),_[0]/=h.worldSize,_[1]/=h.worldSize;const w=h._camera.position,C=p.mercatorZfromAltitude(1,h.center.lat),I=[w[0],w[1],w[2]/C,0],k=p.subtract([],_.slice(0,3),I);p.normalize(k,k);const R=this.raycast(I,k,this._exaggeration);return null!==R&&R?(p.scaleAndAdd(I,I,k,R),I[3]=I[2],I[2]*=C,I):null}drawDepth(){const c=this.painter,h=c.context,_=this.proxySourceCache,w=Math.ceil(c.width),C=Math.ceil(c.height);if(!this._depthFBO||this._depthFBO.width===w&&this._depthFBO.height===C||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const I=h.gl,k=h.createFramebuffer(w,C,!0);h.activeTexture.set(I.TEXTURE0);const R=new p.Texture(h,{width:w,height:C,data:null},I.RGBA);R.bind(I.NEAREST,I.CLAMP_TO_EDGE),k.colorAttachment.set(R.texture);const F=h.createRenderbuffer(h.gl.DEPTH_COMPONENT16,w,C);k.depthAttachment.set(F),this._depthFBO=k,this._depthTexture=R}h.bindFramebuffer.set(this._depthFBO.framebuffer),h.viewport.set([0,0,w,C]),function(I,k,R,F){if("globe"===I.transform.projection.name)return;const N=I.context,H=N.gl;N.clear({depth:1});const X=I.useProgram("terrainDepth"),te=new p.DepthMode(H.LESS,p.DepthMode.ReadWrite,I.depthRangeFor3D);for(const Q of F){const ne=R.getTile(Q),K=ph(Q.projMatrix,0);k.setupElevationDraw(ne,X),X.draw(N,H.TRIANGLES,te,p.StencilMode.disabled,p.ColorMode.unblended,p.CullFaceMode.backCCW,K,"terrain_depth",k.gridBuffer,k.gridIndexBuffer,k.gridNoSkirtSegments)}}(c,this,_,this.proxyCoords)}_setupProxiedCoordsForOrtho(c,h,_){if(c.getSource()instanceof Te)return this._setupProxiedCoordsForImageSource(c,h,_);this._findCoveringTileCache[c.id]=this._findCoveringTileCache[c.id]||{};const w=this.proxiedCoords[c.id]=[],C=this.proxyCoords;for(let k=0;k<C.length;k++){const R=C[k],F=this._findTileCoveringTileID(R,c);if(F){const N=this._createProxiedId(R,F,_[R.key]&&_[R.key][c.id]);w.push(N),this.proxyToSource[R.key][c.id]=[N]}}let I=!1;for(let k=0;k<h.length;k++){const R=c.getTile(h[k]);if(!R||!R.hasData())continue;const F=this._findTileCoveringTileID(R.tileID,this.proxySourceCache);if(F&&F.tileID.canonical.z!==R.tileID.canonical.z){const N=this.proxyToSource[F.tileID.key][c.id],H=this._createProxiedId(F.tileID,R,_[F.tileID.key]&&_[F.tileID.key][c.id]);N?N.splice(N.length-1,0,H):this.proxyToSource[F.tileID.key][c.id]=[H],w.push(H),I=!0}}this._sourceTilesOverlap[c.id]=I}_setupProxiedCoordsForImageSource(c,h,_){if(!c.getSource().loaded())return;const w=this.proxiedCoords[c.id]=[],C=this.proxyCoords,I=c.getSource(),k=new p.pointGeometry(I.tileID.x,I.tileID.y)._div(1<<I.tileID.z),R=I.coordinates.map(p.MercatorCoordinate.fromLngLat).reduce((N,H)=>(N.min.x=Math.min(N.min.x,H.x-k.x),N.min.y=Math.min(N.min.y,H.y-k.y),N.max.x=Math.max(N.max.x,H.x-k.x),N.max.y=Math.max(N.max.y,H.y-k.y),N),{min:new p.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new p.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),F=(N,H)=>{const X=N.wrap+N.canonical.x/(1<<N.canonical.z),te=N.canonical.y/(1<<N.canonical.z),Q=p.EXTENT/(1<<N.canonical.z),ne=H.wrap+H.canonical.x/(1<<H.canonical.z),K=H.canonical.y/(1<<H.canonical.z);return X+Q<ne+R.min.x||X>ne+R.max.x||te+Q<K+R.min.y||te>K+R.max.y};for(let N=0;N<C.length;N++){const H=C[N];for(let X=0;X<h.length;X++){const te=c.getTile(h[X]);if(!te||!te.hasData()||F(H,te.tileID))continue;const Q=this._createProxiedId(H,te,_[H.key]&&_[H.key][c.id]),ne=this.proxyToSource[H.key][c.id];ne?ne.push(Q):this.proxyToSource[H.key][c.id]=[Q],w.push(Q)}}}_createProxiedId(c,h,_){let w=this.orthoMatrix;if(_){const C=_.find(I=>I.key===h.tileID.key);if(C)return C}if(h.tileID.key!==c.key){const C=c.canonical.z-h.tileID.canonical.z;let I,k,R;w=p.create();const F=h.tileID.wrap-c.wrap<<c.overscaledZ;C>0?(I=p.EXTENT>>C,k=I*((h.tileID.canonical.x<<C)-c.canonical.x+F),R=I*((h.tileID.canonical.y<<C)-c.canonical.y)):(I=p.EXTENT<<-C,k=p.EXTENT*(h.tileID.canonical.x-(c.canonical.x+F<<-C)),R=p.EXTENT*(h.tileID.canonical.y-(c.canonical.y<<-C))),p.ortho(w,0,I,0,I,0,1),p.translate(w,w,[k,R,0])}return new Lo(h.tileID,c.key,w)}_findTileCoveringTileID(c,h){let _=h.getTile(c);if(_&&_.hasData())return _;const w=this._findCoveringTileCache[h.id],C=w[c.key];if(_=C?h.getTileByID(C):null,_&&_.hasData()||null===C)return _;let I=_?_.tileID:c,k=I.overscaledZ;const R=h.getSource().minzoom,F=[];if(!C){const H=h.getSource().maxzoom;if(c.canonical.z>=H){const X=c.canonical.z-H;h.getSource().reparseOverscaled?(k=Math.max(c.canonical.z+2,h.transform.tileZoom),I=new p.OverscaledTileID(k,c.wrap,H,c.canonical.x>>X,c.canonical.y>>X)):0!==X&&(k=H,I=new p.OverscaledTileID(k,c.wrap,H,c.canonical.x>>X,c.canonical.y>>X))}I.key!==c.key&&(F.push(I.key),_=h.getTile(I))}const N=H=>{F.forEach(X=>{w[X]=H}),F.length=0};for(k-=1;k>=R&&(!_||!_.hasData());k--){_&&N(_.tileID.key);const H=I.calculateScaledKey(k);if(_=h.getTileByID(H),_&&_.hasData())break;const X=w[H];if(null===X)break;void 0===X?F.push(H):_=h.getTileByID(X)}return N(_?_.tileID.key:null),_&&_.hasData()?_:null}findDEMTileFor(c){return this.enabled?this._findTileCoveringTileID(c,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(c,h){let _=this._tilesDirty[c];_||(_=this._tilesDirty[c]={}),_[h.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const c=function(h){let _=0;const w=new p.StructArrayLayout2ui4,C=131;for(let I=1;I<129;I++){for(let k=1;k<129;k++)_=I*C+k,w.emplaceBack(_,_+1),w.emplaceBack(_,_+C),w.emplaceBack(_+1,_+C),128===I&&w.emplaceBack(_+C,_+C+1);w.emplaceBack(_+1,_+1+C)}return w}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(c),this.wireframeSegments=p.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,c.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class Ku{static cacheKey(c,h,_,w){let C=`${h}${w?w.cacheKey:""}`;for(const I of _)c.usedDefines.includes(I)&&(C+=`/${I}`);return C}constructor(c,h,_,w,C,I){const k=c.gl;this.program=k.createProgram();const R=function(K){const Y=[];for(let se=0;se<K.length;se++){if(null===K[se])continue;const J=K[se].split(" ");Y.push(J.pop())}return Y}(_.staticAttributes),F=w?w.getBinderAttributes():[],N=R.concat(F);let H=w?w.defines():[];H=H.concat(I.map(K=>`#define ${K}`));const X=H.concat(c.extStandardDerivatives?"#extension GL_OES_standard_derivatives : enable\n".concat(Ji):Ji,Ji,Gl,vm.fragmentSource,Sr.fragmentSource,_.fragmentSource).join("\n"),te=H.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Gl,vm.vertexSource,Sr.vertexSource,Gs.vertexSource,_.vertexSource).join("\n"),Q=k.createShader(k.FRAGMENT_SHADER);if(k.isContextLost())return void(this.failedToCreate=!0);k.shaderSource(Q,X),k.compileShader(Q),k.attachShader(this.program,Q);const ne=k.createShader(k.VERTEX_SHADER);if(k.isContextLost())this.failedToCreate=!0;else{k.shaderSource(ne,te),k.compileShader(ne),k.attachShader(this.program,ne),this.attributes={},this.numAttributes=N.length;for(let K=0;K<this.numAttributes;K++)N[K]&&(k.bindAttribLocation(this.program,K,N[K]),this.attributes[N[K]]=K);k.linkProgram(this.program),k.deleteShader(ne),k.deleteShader(Q),this.fixedUniforms=C(c),this.binderUniforms=w?w.getUniforms(c):[],I.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new p.Uniform1i(K=c),u_dem_prev:new p.Uniform1i(K),u_dem_unpack:new p.Uniform4f(K),u_dem_tl:new p.Uniform2f(K),u_dem_scale:new p.Uniform1f(K),u_dem_tl_prev:new p.Uniform2f(K),u_dem_scale_prev:new p.Uniform1f(K),u_dem_size:new p.Uniform1f(K),u_dem_lerp:new p.Uniform1f(K),u_exaggeration:new p.Uniform1f(K),u_depth:new p.Uniform1i(K),u_depth_size_inv:new p.Uniform2f(K),u_meter_to_dem:new p.Uniform1f(K),u_label_plane_matrix_inv:new p.UniformMatrix4f(K)}),I.includes("GLOBE")&&(this.globeUniforms=(K=>({u_tile_tl_up:new p.Uniform3f(K),u_tile_tr_up:new p.Uniform3f(K),u_tile_br_up:new p.Uniform3f(K),u_tile_bl_up:new p.Uniform3f(K),u_tile_up_scale:new p.Uniform1f(K)}))(c)),I.includes("FOG")&&(this.fogUniforms=(K=>({u_fog_matrix:new p.UniformMatrix4f(K),u_fog_range:new p.Uniform2f(K),u_fog_color:new p.Uniform4f(K),u_fog_horizon_blend:new p.Uniform1f(K),u_fog_temporal_offset:new p.Uniform1f(K),u_frustum_tl:new p.Uniform3f(K),u_frustum_tr:new p.Uniform3f(K),u_frustum_br:new p.Uniform3f(K),u_frustum_bl:new p.Uniform3f(K),u_globe_pos:new p.Uniform3f(K),u_globe_radius:new p.Uniform1f(K),u_globe_transition:new p.Uniform1f(K),u_is_globe:new p.Uniform1i(K),u_viewport:new p.Uniform2f(K)}))(c))}var K}setTerrainUniformValues(c,h){if(!this.terrainUniforms)return;const _=this.terrainUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const w in h)_[w]&&_[w].set(this.program,w,h[w])}}setGlobeUniformValues(c,h){if(!this.globeUniforms)return;const _=this.globeUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const w in h)_[w]&&_[w].set(this.program,w,h[w])}}setFogUniformValues(c,h){if(!this.fogUniforms)return;const _=this.fogUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const w in h)_[w].set(this.program,w,h[w])}}draw(c,h,_,w,C,I,k,R,F,N,H,X,te,Q,ne){const K=c.gl;if(this.failedToCreate)return;c.program.set(this.program),c.setDepthMode(_),c.setStencilMode(w),c.setColorMode(C),c.setCullFace(I);for(const se of Object.keys(this.fixedUniforms))this.fixedUniforms[se].set(this.program,se,k[se]);Q&&Q.setUniforms(this.program,c,this.binderUniforms,X,{zoom:te});const Y={[K.LINES]:2,[K.TRIANGLES]:3,[K.LINE_STRIP]:1}[h];for(const se of H.get()){const J=se.vaos||(se.vaos={});(J[R]||(J[R]=new cu)).bind(c,this,F,Q?Q.getPaintVertexBuffers():[],N,se.vertexOffset,ne||[]),K.drawElements(h,se.primitiveLength*Y,K.UNSIGNED_SHORT,se.primitiveOffset*Y*2)}}}function fh(g,c,h){const _=1/ni(h,1,c.transform.tileZoom),w=Math.pow(2,h.tileID.overscaledZ),C=h.tileSize*Math.pow(2,c.transform.tileZoom)/w,I=C*(h.tileID.canonical.x+h.tileID.wrap*w),k=C*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[_,g.fromScale,g.toScale],u_fade:g.t,u_pixel_coord_upper:[I>>16,k>>16],u_pixel_coord_lower:[65535&I,65535&k]}}const wc=p.create(),Sc=(g,c,h,_,w,C,I,k,R,F,N)=>{const H=c.style.light,X=H.properties.get("position"),te=[X.x,X.y,X.z],Q=p.create$1();"viewport"===H.properties.get("anchor")&&(p.fromRotation(Q,-c.transform.angle),p.transformMat3(te,te,Q));const ne=H.properties.get("color"),K=c.transform,Y={u_matrix:g,u_lightpos:te,u_lightintensity:H.properties.get("intensity"),u_lightcolor:[ne.r,ne.g,ne.b],u_vertical_gradient:+h,u_opacity:_,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:wc,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:w,u_edge_radius:C};return"globe"===K.projection.name&&(Y.u_tile_id=[I.canonical.x,I.canonical.y,1<<I.canonical.z],Y.u_zoom_transition=R,Y.u_inv_rot_matrix=N,Y.u_merc_center=F,Y.u_up_dir=K.projection.upVector(new p.CanonicalTileID(0,0,0),F[0]*p.EXTENT,F[1]*p.EXTENT),Y.u_height_lift=k),Y},wl=(g,c,h,_,w,C,I,k,R,F,N,H,X)=>{const te=Sc(g,c,h,_,w,C,I,F,N,H,X),Q={u_height_factor:-Math.pow(2,I.overscaledZ)/R.tileSize/8};return p.extend(te,fh(k,c,R),Q)},Io=g=>({u_matrix:g}),jp=(g,c,h,_)=>p.extend(Io(g),fh(h,c,_)),qs=(g,c)=>({u_matrix:g,u_world:c}),_n=(g,c,h,_,w)=>p.extend(jp(g,c,h,_),{u_world:w}),Si=p.create(),Pr=(g,c,h,_,w,C)=>{const I=g.transform,k="globe"===I.projection.name;let R;if("map"===C.paint.get("circle-pitch-alignment"))if(k){const N=p.globePixelsToTileUnits(I.zoom,c.canonical)*I._pixelsPerMercatorPixel;R=Float32Array.from([N,0,0,N])}else R=I.calculatePixelsToTileUnitsMatrix(h);else R=new Float32Array([I.pixelsToGLUnits[0],0,0,I.pixelsToGLUnits[1]]);const F={u_camera_to_center_distance:I.cameraToCenterDistance,u_matrix:g.translatePosMatrix(c.projMatrix,h,C.paint.get("circle-translate"),C.paint.get("circle-translate-anchor")),u_device_pixel_ratio:p.exported.devicePixelRatio,u_extrude_scale:R,u_inv_rot_matrix:Si,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(k){F.u_inv_rot_matrix=_,F.u_merc_center=w,F.u_tile_id=[c.canonical.x,c.canonical.y,1<<c.canonical.z],F.u_zoom_transition=p.globeToMercatorTransition(I.zoom);const N=w[0]*p.EXTENT,H=w[1]*p.EXTENT;F.u_up_dir=I.projection.upVector(new p.CanonicalTileID(0,0,0),N,H)}return F},Ls=g=>{const c=[];return"map"===g.paint.get("circle-pitch-alignment")&&c.push("PITCH_WITH_MAP"),"map"===g.paint.get("circle-pitch-scale")&&c.push("SCALE_WITH_MAP"),c},nl=(g,c,h,_)=>{const w=p.EXTENT/h.tileSize;return{u_matrix:g,u_camera_to_center_distance:c.getCameraToCenterDistance(_),u_extrude_scale:[c.pixelsToGLUnits[0]/w,c.pixelsToGLUnits[1]/w]}},ho=(g,c,h=1)=>({u_matrix:g,u_color:c,u_overlay:0,u_overlay_scale:h}),rs=p.create(),Yr=(g,c,h,_,w,C,I)=>{const k=g.transform,R="globe"===k.projection.name,F=R?p.globePixelsToTileUnits(k.zoom,c.canonical)*k._pixelsPerMercatorPixel:ni(h,1,C),N={u_matrix:c.projMatrix,u_extrude_scale:F,u_intensity:I,u_inv_rot_matrix:rs,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(R){N.u_inv_rot_matrix=_,N.u_merc_center=w,N.u_tile_id=[c.canonical.x,c.canonical.y,1<<c.canonical.z],N.u_zoom_transition=p.globeToMercatorTransition(k.zoom);const H=w[0]*p.EXTENT,X=w[1]*p.EXTENT;N.u_up_dir=k.projection.upVector(new p.CanonicalTileID(0,0,0),H,X)}return N},du=(g,c,h,_,w,C,I,k)=>{const R=g.transform,F=R.calculatePixelsToTileUnitsMatrix(c),N={u_matrix:Cc(g,c,h,w),u_pixels_to_tile_units:F,u_device_pixel_ratio:I,u_units_to_pixels:[1/R.pixelsToGLUnits[0],1/R.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:C,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0,u_trim_offset:k};if(Tc(h)){const H=Mi(c,g.transform);N.u_texsize=c.lineAtlasTexture.size,N.u_scale=[H,_.fromScale,_.toScale],N.u_mix=_.t}return N},Wl=(g,c,h,_,w,C)=>{const I=g.transform,k=Mi(c,I);return{u_matrix:Cc(g,c,h,w),u_texsize:c.imageAtlasTexture.size,u_pixels_to_tile_units:I.calculatePixelsToTileUnitsMatrix(c),u_device_pixel_ratio:C,u_image:0,u_scale:[k,_.fromScale,_.toScale],u_fade:_.t,u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Mi(g,c){return 1/ni(g,1,c.tileZoom)}function Cc(g,c,h,_){return g.translatePosMatrix(_||c.tileID.projMatrix,c,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}function Tc(g){const c=g.paint.get("line-dasharray").value;return c.value||"constant"!==c.kind}const Ju=(g,c,h,_,w,C)=>{return{u_matrix:g,u_tl_parent:c,u_scale_parent:h,u_fade_t:_.mix,u_opacity:_.opacity*w.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:w.paint.get("raster-brightness-min"),u_brightness_high:w.paint.get("raster-brightness-max"),u_saturation_factor:(k=w.paint.get("raster-saturation"),k>0?1-1/(1.001-k):-k),u_contrast_factor:(I=w.paint.get("raster-contrast"),I>0?1/(1-I):1+I),u_spin_weights:Dc(w.paint.get("raster-hue-rotate")),u_perspective_transform:C};var I,k};function Dc(g){g*=Math.PI/180;const c=Math.sin(g),h=Math.cos(g);return[(2*h+1)/3,(-Math.sqrt(3)*c-h+1)/3,(Math.sqrt(3)*c-h+1)/3]}const xo=p.create(),hu=(g,c,h,_,w,C,I,k,R,F,N,H,X,te,Q,ne)=>{const K=w.transform,Y={u_is_size_zoom_constant:+("constant"===g||"source"===g),u_is_size_feature_constant:+("constant"===g||"camera"===g),u_size_t:c?c.uSizeT:0,u_size:c?c.uSize:0,u_camera_to_center_distance:K.cameraToCenterDistance,u_rotate_symbol:+h,u_aspect_ratio:K.width/K.height,u_fade_change:w.options.fadeDuration?w.symbolFadeChange:1,u_matrix:C,u_label_plane_matrix:I,u_coord_matrix:k,u_is_text:+R,u_pitch_with_map:+_,u_texsize:F,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:xo,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:xo,u_up_vector:[0,-1,0]};return"globe"===ne.name&&(Y.u_tile_id=[N.canonical.x,N.canonical.y,1<<N.canonical.z],Y.u_zoom_transition=H,Y.u_inv_rot_matrix=te,Y.u_merc_center=X,Y.u_camera_forward=K._camera.forward(),Y.u_ecef_origin=p.globeECEFOrigin(K.globeMatrix,N.toUnwrapped()),Y.u_tile_matrix=Float32Array.from(K.globeMatrix),Y.u_up_vector=Q),Y},Sl=(g,c,h,_,w,C,I,k,R,F,N,H,X,te,Q,ne,K)=>p.extend(hu(g,c,h,_,w,C,I,k,R,F,H,X,te,Q,ne,K),{u_gamma_scale:_?w.transform.cameraToCenterDistance*Math.cos(w.terrain?0:w.transform._pitch):1,u_device_pixel_ratio:p.exported.devicePixelRatio,u_is_halo:+N}),Ra=(g,c,h,_,w,C,I,k,R,F,N,H,X,te,Q,ne)=>p.extend(Sl(g,c,h,_,w,C,I,k,!0,R,!0,N,H,X,te,Q,ne),{u_texsize_icon:F,u_texture_icon:1}),Xl=(g,c,h)=>({u_matrix:g,u_opacity:c,u_color:h}),xm=(g,c,h,_,w,C)=>p.extend(function(I,k,R,F){const N=R.imageManager.getPattern(I.from.toString()),H=R.imageManager.getPattern(I.to.toString()),{width:X,height:te}=R.imageManager.getPixelSize(),Q=Math.pow(2,F.tileID.overscaledZ),ne=F.tileSize*Math.pow(2,R.transform.tileZoom)/Q,K=ne*(F.tileID.canonical.x+F.tileID.wrap*Q),Y=ne*F.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:N.tl,u_pattern_br_a:N.br,u_pattern_tl_b:H.tl,u_pattern_br_b:H.br,u_texsize:[X,te],u_mix:k.t,u_pattern_size_a:N.displaySize,u_pattern_size_b:H.displaySize,u_scale_a:k.fromScale,u_scale_b:k.toScale,u_tile_units_to_pixels:1/ni(F,1,R.transform.tileZoom),u_pixel_coord_upper:[K>>16,Y>>16],u_pixel_coord_lower:[65535&K,65535&Y]}}(_,C,h,w),{u_matrix:g,u_opacity:c}),Ir={fillExtrusion:g=>({u_matrix:new p.UniformMatrix4f(g),u_lightpos:new p.Uniform3f(g),u_lightintensity:new p.Uniform1f(g),u_lightcolor:new p.Uniform3f(g),u_vertical_gradient:new p.Uniform1f(g),u_opacity:new p.Uniform1f(g),u_edge_radius:new p.Uniform1f(g),u_ao:new p.Uniform2f(g),u_tile_id:new p.Uniform3f(g),u_zoom_transition:new p.Uniform1f(g),u_inv_rot_matrix:new p.UniformMatrix4f(g),u_merc_center:new p.Uniform2f(g),u_up_dir:new p.Uniform3f(g),u_height_lift:new p.Uniform1f(g)}),fillExtrusionPattern:g=>({u_matrix:new p.UniformMatrix4f(g),u_lightpos:new p.Uniform3f(g),u_lightintensity:new p.Uniform1f(g),u_lightcolor:new p.Uniform3f(g),u_vertical_gradient:new p.Uniform1f(g),u_height_factor:new p.Uniform1f(g),u_edge_radius:new p.Uniform1f(g),u_ao:new p.Uniform2f(g),u_tile_id:new p.Uniform3f(g),u_zoom_transition:new p.Uniform1f(g),u_inv_rot_matrix:new p.UniformMatrix4f(g),u_merc_center:new p.Uniform2f(g),u_up_dir:new p.Uniform3f(g),u_height_lift:new p.Uniform1f(g),u_image:new p.Uniform1i(g),u_texsize:new p.Uniform2f(g),u_pixel_coord_upper:new p.Uniform2f(g),u_pixel_coord_lower:new p.Uniform2f(g),u_scale:new p.Uniform3f(g),u_fade:new p.Uniform1f(g),u_opacity:new p.Uniform1f(g)}),fill:g=>({u_matrix:new p.UniformMatrix4f(g)}),fillPattern:g=>({u_matrix:new p.UniformMatrix4f(g),u_image:new p.Uniform1i(g),u_texsize:new p.Uniform2f(g),u_pixel_coord_upper:new p.Uniform2f(g),u_pixel_coord_lower:new p.Uniform2f(g),u_scale:new p.Uniform3f(g),u_fade:new p.Uniform1f(g)}),fillOutline:g=>({u_matrix:new p.UniformMatrix4f(g),u_world:new p.Uniform2f(g)}),fillOutlinePattern:g=>({u_matrix:new p.UniformMatrix4f(g),u_world:new p.Uniform2f(g),u_image:new p.Uniform1i(g),u_texsize:new p.Uniform2f(g),u_pixel_coord_upper:new p.Uniform2f(g),u_pixel_coord_lower:new p.Uniform2f(g),u_scale:new p.Uniform3f(g),u_fade:new p.Uniform1f(g)}),circle:g=>({u_camera_to_center_distance:new p.Uniform1f(g),u_extrude_scale:new p.UniformMatrix2f(g),u_device_pixel_ratio:new p.Uniform1f(g),u_matrix:new p.UniformMatrix4f(g),u_inv_rot_matrix:new p.UniformMatrix4f(g),u_merc_center:new p.Uniform2f(g),u_tile_id:new p.Uniform3f(g),u_zoom_transition:new p.Uniform1f(g),u_up_dir:new p.Uniform3f(g)}),collisionBox:g=>({u_matrix:new p.UniformMatrix4f(g),u_camera_to_center_distance:new p.Uniform1f(g),u_extrude_scale:new p.Uniform2f(g)}),collisionCircle:g=>({u_matrix:new p.UniformMatrix4f(g),u_inv_matrix:new p.UniformMatrix4f(g),u_camera_to_center_distance:new p.Uniform1f(g),u_viewport_size:new p.Uniform2f(g)}),debug:g=>({u_color:new p.UniformColor(g),u_matrix:new p.UniformMatrix4f(g),u_overlay:new p.Uniform1i(g),u_overlay_scale:new p.Uniform1f(g)}),clippingMask:g=>({u_matrix:new p.UniformMatrix4f(g)}),heatmap:g=>({u_extrude_scale:new p.Uniform1f(g),u_intensity:new p.Uniform1f(g),u_matrix:new p.UniformMatrix4f(g),u_inv_rot_matrix:new p.UniformMatrix4f(g),u_merc_center:new p.Uniform2f(g),u_tile_id:new p.Uniform3f(g),u_zoom_transition:new p.Uniform1f(g),u_up_dir:new p.Uniform3f(g)}),heatmapTexture:g=>({u_image:new p.Uniform1i(g),u_color_ramp:new p.Uniform1i(g),u_opacity:new p.Uniform1f(g)}),hillshade:g=>({u_matrix:new p.UniformMatrix4f(g),u_image:new p.Uniform1i(g),u_latrange:new p.Uniform2f(g),u_light:new p.Uniform2f(g),u_shadow:new p.UniformColor(g),u_highlight:new p.UniformColor(g),u_accent:new p.UniformColor(g)}),hillshadePrepare:g=>({u_matrix:new p.UniformMatrix4f(g),u_image:new p.Uniform1i(g),u_dimension:new p.Uniform2f(g),u_zoom:new p.Uniform1f(g),u_unpack:new p.Uniform4f(g)}),line:g=>({u_matrix:new p.UniformMatrix4f(g),u_pixels_to_tile_units:new p.UniformMatrix2f(g),u_device_pixel_ratio:new p.Uniform1f(g),u_units_to_pixels:new p.Uniform2f(g),u_dash_image:new p.Uniform1i(g),u_gradient_image:new p.Uniform1i(g),u_image_height:new p.Uniform1f(g),u_texsize:new p.Uniform2f(g),u_scale:new p.Uniform3f(g),u_mix:new p.Uniform1f(g),u_alpha_discard_threshold:new p.Uniform1f(g),u_trim_offset:new p.Uniform2f(g)}),linePattern:g=>({u_matrix:new p.UniformMatrix4f(g),u_texsize:new p.Uniform2f(g),u_pixels_to_tile_units:new p.UniformMatrix2f(g),u_device_pixel_ratio:new p.Uniform1f(g),u_image:new p.Uniform1i(g),u_units_to_pixels:new p.Uniform2f(g),u_scale:new p.Uniform3f(g),u_fade:new p.Uniform1f(g),u_alpha_discard_threshold:new p.Uniform1f(g)}),raster:g=>({u_matrix:new p.UniformMatrix4f(g),u_tl_parent:new p.Uniform2f(g),u_scale_parent:new p.Uniform1f(g),u_fade_t:new p.Uniform1f(g),u_opacity:new p.Uniform1f(g),u_image0:new p.Uniform1i(g),u_image1:new p.Uniform1i(g),u_brightness_low:new p.Uniform1f(g),u_brightness_high:new p.Uniform1f(g),u_saturation_factor:new p.Uniform1f(g),u_contrast_factor:new p.Uniform1f(g),u_spin_weights:new p.Uniform3f(g),u_perspective_transform:new p.Uniform2f(g)}),symbolIcon:g=>({u_is_size_zoom_constant:new p.Uniform1i(g),u_is_size_feature_constant:new p.Uniform1i(g),u_size_t:new p.Uniform1f(g),u_size:new p.Uniform1f(g),u_camera_to_center_distance:new p.Uniform1f(g),u_rotate_symbol:new p.Uniform1i(g),u_aspect_ratio:new p.Uniform1f(g),u_fade_change:new p.Uniform1f(g),u_matrix:new p.UniformMatrix4f(g),u_label_plane_matrix:new p.UniformMatrix4f(g),u_coord_matrix:new p.UniformMatrix4f(g),u_is_text:new p.Uniform1i(g),u_pitch_with_map:new p.Uniform1i(g),u_texsize:new p.Uniform2f(g),u_tile_id:new p.Uniform3f(g),u_zoom_transition:new p.Uniform1f(g),u_inv_rot_matrix:new p.UniformMatrix4f(g),u_merc_center:new p.Uniform2f(g),u_camera_forward:new p.Uniform3f(g),u_tile_matrix:new p.UniformMatrix4f(g),u_up_vector:new p.Uniform3f(g),u_ecef_origin:new p.Uniform3f(g),u_texture:new p.Uniform1i(g)}),symbolSDF:g=>({u_is_size_zoom_constant:new p.Uniform1i(g),u_is_size_feature_constant:new p.Uniform1i(g),u_size_t:new p.Uniform1f(g),u_size:new p.Uniform1f(g),u_camera_to_center_distance:new p.Uniform1f(g),u_rotate_symbol:new p.Uniform1i(g),u_aspect_ratio:new p.Uniform1f(g),u_fade_change:new p.Uniform1f(g),u_matrix:new p.UniformMatrix4f(g),u_label_plane_matrix:new p.UniformMatrix4f(g),u_coord_matrix:new p.UniformMatrix4f(g),u_is_text:new p.Uniform1i(g),u_pitch_with_map:new p.Uniform1i(g),u_texsize:new p.Uniform2f(g),u_texture:new p.Uniform1i(g),u_gamma_scale:new p.Uniform1f(g),u_device_pixel_ratio:new p.Uniform1f(g),u_tile_id:new p.Uniform3f(g),u_zoom_transition:new p.Uniform1f(g),u_inv_rot_matrix:new p.UniformMatrix4f(g),u_merc_center:new p.Uniform2f(g),u_camera_forward:new p.Uniform3f(g),u_tile_matrix:new p.UniformMatrix4f(g),u_up_vector:new p.Uniform3f(g),u_ecef_origin:new p.Uniform3f(g),u_is_halo:new p.Uniform1i(g)}),symbolTextAndIcon:g=>({u_is_size_zoom_constant:new p.Uniform1i(g),u_is_size_feature_constant:new p.Uniform1i(g),u_size_t:new p.Uniform1f(g),u_size:new p.Uniform1f(g),u_camera_to_center_distance:new p.Uniform1f(g),u_rotate_symbol:new p.Uniform1i(g),u_aspect_ratio:new p.Uniform1f(g),u_fade_change:new p.Uniform1f(g),u_matrix:new p.UniformMatrix4f(g),u_label_plane_matrix:new p.UniformMatrix4f(g),u_coord_matrix:new p.UniformMatrix4f(g),u_is_text:new p.Uniform1i(g),u_pitch_with_map:new p.Uniform1i(g),u_texsize:new p.Uniform2f(g),u_texsize_icon:new p.Uniform2f(g),u_texture:new p.Uniform1i(g),u_texture_icon:new p.Uniform1i(g),u_gamma_scale:new p.Uniform1f(g),u_device_pixel_ratio:new p.Uniform1f(g),u_is_halo:new p.Uniform1i(g)}),background:g=>({u_matrix:new p.UniformMatrix4f(g),u_opacity:new p.Uniform1f(g),u_color:new p.UniformColor(g)}),backgroundPattern:g=>({u_matrix:new p.UniformMatrix4f(g),u_opacity:new p.Uniform1f(g),u_image:new p.Uniform1i(g),u_pattern_tl_a:new p.Uniform2f(g),u_pattern_br_a:new p.Uniform2f(g),u_pattern_tl_b:new p.Uniform2f(g),u_pattern_br_b:new p.Uniform2f(g),u_texsize:new p.Uniform2f(g),u_mix:new p.Uniform1f(g),u_pattern_size_a:new p.Uniform2f(g),u_pattern_size_b:new p.Uniform2f(g),u_scale_a:new p.Uniform1f(g),u_scale_b:new p.Uniform1f(g),u_pixel_coord_upper:new p.Uniform2f(g),u_pixel_coord_lower:new p.Uniform2f(g),u_tile_units_to_pixels:new p.Uniform1f(g)}),terrainRaster:hh,terrainDepth:hh,skybox:g=>({u_matrix:new p.UniformMatrix4f(g),u_sun_direction:new p.Uniform3f(g),u_cubemap:new p.Uniform1i(g),u_opacity:new p.Uniform1f(g),u_temporal_offset:new p.Uniform1f(g)}),skyboxGradient:g=>({u_matrix:new p.UniformMatrix4f(g),u_color_ramp:new p.Uniform1i(g),u_center_direction:new p.Uniform3f(g),u_radius:new p.Uniform1f(g),u_opacity:new p.Uniform1f(g),u_temporal_offset:new p.Uniform1f(g)}),skyboxCapture:g=>({u_matrix_3f:new p.UniformMatrix3f(g),u_sun_direction:new p.Uniform3f(g),u_sun_intensity:new p.Uniform1f(g),u_color_tint_r:new p.Uniform4f(g),u_color_tint_m:new p.Uniform4f(g),u_luminance:new p.Uniform1f(g)}),globeRaster:g=>({u_proj_matrix:new p.UniformMatrix4f(g),u_globe_matrix:new p.UniformMatrix4f(g),u_normalize_matrix:new p.UniformMatrix4f(g),u_merc_matrix:new p.UniformMatrix4f(g),u_zoom_transition:new p.Uniform1f(g),u_merc_center:new p.Uniform2f(g),u_image0:new p.Uniform1i(g),u_grid_matrix:new p.UniformMatrix3f(g),u_frustum_tl:new p.Uniform3f(g),u_frustum_tr:new p.Uniform3f(g),u_frustum_br:new p.Uniform3f(g),u_frustum_bl:new p.Uniform3f(g),u_globe_pos:new p.Uniform3f(g),u_globe_radius:new p.Uniform1f(g),u_viewport:new p.Uniform2f(g)}),globeAtmosphere:g=>({u_frustum_tl:new p.Uniform3f(g),u_frustum_tr:new p.Uniform3f(g),u_frustum_br:new p.Uniform3f(g),u_frustum_bl:new p.Uniform3f(g),u_horizon:new p.Uniform1f(g),u_transition:new p.Uniform1f(g),u_fadeout_range:new p.Uniform1f(g),u_color:new p.Uniform4f(g),u_high_color:new p.Uniform4f(g),u_space_color:new p.Uniform4f(g),u_star_intensity:new p.Uniform1f(g),u_star_density:new p.Uniform1f(g),u_star_size:new p.Uniform1f(g),u_temporal_offset:new p.Uniform1f(g),u_horizon_angle:new p.Uniform1f(g),u_rotation_matrix:new p.UniformMatrix4f(g)})};let mh;function Up(g,c,h,_,w,C,I){const k=g.context,R=k.gl,F=g.transform,N=g.useProgram("collisionBox"),H=[];let X=0,te=0;for(let _e=0;_e<_.length;_e++){const ve=_[_e],he=c.getTile(ve),Ce=he.getBucket(h);if(!Ce)continue;const He=Bp(ve,Ce,F);let it=He;0===w[0]&&0===w[1]||(it=g.translatePosMatrix(He,he,w,C));const Qe=I?Ce.textCollisionBox:Ce.iconCollisionBox,wt=Ce.collisionCircleArray;if(wt.length>0){const Le=p.create(),ft=it;p.mul(Le,Ce.placementInvProjMatrix,F.glCoordMatrix),p.mul(Le,Le,Ce.placementViewportMatrix),H.push({circleArray:wt,circleOffset:te,transform:ft,invTransform:Le,projection:Ce.getProjection()}),X+=wt.length/4,te=X}Qe&&(g.terrain&&g.terrain.setupElevationDraw(he,N),N.draw(k,R.LINES,p.DepthMode.disabled,p.StencilMode.disabled,g.colorModeForRenderPass(),p.CullFaceMode.disabled,nl(it,F,he,Ce.getProjection()),h.id,Qe.layoutVertexBuffer,Qe.indexBuffer,Qe.segments,null,F.zoom,null,[Qe.collisionVertexBuffer,Qe.collisionVertexBufferExt]))}if(!I||!H.length)return;const Q=g.useProgram("collisionCircle"),ne=new p.StructArrayLayout2f1f2i16;ne.resize(4*X),ne._trim();let K=0;for(const _e of H)for(let ve=0;ve<_e.circleArray.length/4;ve++){const he=4*ve,Ce=_e.circleArray[he+0],He=_e.circleArray[he+1],it=_e.circleArray[he+2],Qe=_e.circleArray[he+3];ne.emplace(K++,Ce,He,it,Qe,0),ne.emplace(K++,Ce,He,it,Qe,1),ne.emplace(K++,Ce,He,it,Qe,2),ne.emplace(K++,Ce,He,it,Qe,3)}(!mh||mh.length<2*X)&&(mh=function(_e){const ve=2*_e,he=new p.StructArrayLayout3ui6;he.resize(ve),he._trim();for(let Ce=0;Ce<ve;Ce++){const He=6*Ce;he.uint16[He+0]=4*Ce+0,he.uint16[He+1]=4*Ce+1,he.uint16[He+2]=4*Ce+2,he.uint16[He+3]=4*Ce+2,he.uint16[He+4]=4*Ce+3,he.uint16[He+5]=4*Ce+0}return he}(X));const Y=k.createIndexBuffer(mh,!0),se=k.createVertexBuffer(ne,p.collisionCircleLayout.members,!0);for(const _e of H){const ve={u_matrix:_e.transform,u_inv_matrix:_e.invTransform,u_camera_to_center_distance:(J=F).getCameraToCenterDistance(_e.projection),u_viewport_size:[J.width,J.height]};Q.draw(k,R.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,g.colorModeForRenderPass(),p.CullFaceMode.disabled,ve,h.id,se,Y,p.SegmentVector.simpleSegment(0,2*_e.circleOffset,_e.circleArray.length,_e.circleArray.length/2),null,F.zoom)}var J;se.destroy(),Y.destroy()}const os=p.create();function ss(g,c,h,_,w,C){const{horizontalAlign:I,verticalAlign:k}=p.getAnchorAlignment(g),R=-(I-.5)*c,F=-(k-.5)*h,N=p.evaluateVariableOffset(g,_);return new p.pointGeometry((R/w+N[0])*C,(F/w+N[1])*C)}function Hp(g,c,h,_,w,C,I,k,R,F,N){const H=g.text.placedSymbolArray,X=g.text.dynamicLayoutVertexArray,te=g.icon.dynamicLayoutVertexArray,Q={},ne=Xu(k,g.getProjection(),C),K=C.elevation,Y=g.getProjection().upVectorScale(k.canonical,C.center.lat,C.worldSize);X.clear();for(let se=0;se<H.length;se++){const J=H.get(se),_e=g.allowVerticalPlacement&&!J.placedOrientation,ve=J.hidden||!J.crossTileID||_e?null:_[J.crossTileID];if(ve){const he=new p.pointGeometry(J.tileAnchorX,J.tileAnchorY),Ce=g.getProjection().upVector(k.canonical,he.x,he.y),He=K?K.getAtTileOffset(k,he.x,he.y):0,it=xn([J.projectedAnchorX+He*Ce[0]*Y.metersToTile,J.projectedAnchorY+He*Ce[1]*Y.metersToTile,J.projectedAnchorZ+He*Ce[2]*Y.metersToTile],h?ne:I),Qe=Ti(C.getCameraToCenterDistance(g.getProjection()),it.signedDistanceFromCamera);let wt=w.evaluateSizeForFeature(g.textSizeData,F,J)*Qe/p.ONE_EM;h&&(wt*=g.tilePixelRatio/R);const{width:Le,height:ft,anchor:gt,textOffset:qe,textScale:Me}=ve,Gt=ss(gt,Le,ft,qe,Me,wt);let It;if(h){const Lt=he.add(Gt),{x:bn,y:Gn,z:Rn}=g.getProjection().projectTilePoint(Lt.x,Lt.y,k.canonical);It=xn([bn+He*Ce[0]*Y.metersToTile,Gn+He*Ce[1]*Y.metersToTile,Rn+He*Ce[2]*Y.metersToTile],I).point}else{const Lt=c?Gt.rotate(-C.angle):Gt;It=[it.point[0]+Lt.x,it.point[1]+Lt.y,0]}const jt=g.allowVerticalPlacement&&J.placedOrientation===p.WritingMode.vertical?Math.PI/2:0;for(let Lt=0;Lt<J.numGlyphs;Lt++)p.addDynamicAttributes(X,It[0],It[1],It[2],jt);N&&J.associatedIconIndex>=0&&(Q[J.associatedIconIndex]={shiftedAnchor:It,angle:jt})}else Ia(J.numGlyphs,X)}if(N){te.clear();const se=g.icon.placedSymbolArray;for(let J=0;J<se.length;J++){const _e=se.get(J);if(_e.hidden)Ia(_e.numGlyphs,te);else{const ve=Q[J];if(ve)for(let he=0;he<_e.numGlyphs;he++)p.addDynamicAttributes(te,ve.shiftedAnchor[0],ve.shiftedAnchor[1],ve.shiftedAnchor[2],ve.angle);else Ia(_e.numGlyphs,te)}}g.icon.dynamicLayoutVertexBuffer.updateData(te)}g.text.dynamicLayoutVertexBuffer.updateData(X)}function gh(g,c,h){return h.iconsInText&&c?"symbolTextAndIcon":g?"symbolSDF":"symbolIcon"}function ed(g,c,h,_,w,C,I,k,R,F,N,H){const X=g.context,te=X.gl,Q=g.transform,ne="map"===k,K="map"===R,Y=ne&&"point"!==h.layout.get("symbol-placement"),se=ne&&!K&&!Y,J=void 0!==h.layout.get("symbol-sort-key").constantOr(1);let _e=!1;const ve=g.depthModeForSublayer(0,p.DepthMode.ReadOnly),he=[p.mercatorXfromLng(Q.center.lng),p.mercatorYfromLat(Q.center.lat)],Ce=h.layout.get("text-variable-anchor"),He="globe"===Q.projection.name,it=[],Qe=[0,-1,0];let wt=Qe;!He&&!Q.mercatorFromTransition||ne||(wt=function(Le){const ft=Le._camera.getWorldToCamera(Le.worldSize,1),gt=p.multiply([],ft,Le.globeMatrix);p.invert(gt,gt);const qe=[0,0,0],Me=[0,1,0,0];return p.transformMat4$1(Me,Me,gt),qe[0]=Me[0],qe[1]=Me[1],qe[2]=Me[2],p.normalize(qe,qe),qe}(Q));for(const Le of _){const ft=c.getTile(Le),gt=ft.getBucket(h);if(!gt||"mercator"===gt.projection.name&&He)continue;const qe=w?gt.text:gt.icon;if(!qe||gt.fullyClipped||!qe.segments.get().length)continue;const Me=qe.programConfigurations.get(h.id),Gt=w||gt.sdfIcons,It=w?gt.textSizeData:gt.iconSizeData,jt=K||0!==Q.pitch,Lt=p.evaluateSizeForZoom(It,Q.zoom);let bn,Gn,Rn,yn,Nt=[0,0],Jn=null;if(w){if(Gn=ft.glyphAtlasTexture,Rn=te.LINEAR,bn=ft.glyphAtlasTexture.size,gt.iconsInText){Nt=ft.imageAtlasTexture.size,Jn=ft.imageAtlasTexture;const No="composite"===It.kind||"camera"===It.kind;yn=jt||g.options.rotating||g.options.zooming||No?te.LINEAR:te.NEAREST}}else{const No=1!==h.layout.get("icon-size").constantOr(0)||gt.iconsNeedLinear;Gn=ft.imageAtlasTexture,Rn=Gt||g.options.rotating||g.options.zooming||No||jt?te.LINEAR:te.NEAREST,bn=ft.imageAtlasTexture.size}const bi="globe"===gt.projection.name,hr=bi?wt:Qe,pr=bi?p.globeToMercatorTransition(Q.zoom):0,or=Xu(Le,gt.getProjection(),Q),io=Q.calculatePixelsToTileUnitsMatrix(ft),Mo=yc(or,ft.tileID.canonical,K,ne,Q,gt.getProjection(),io),ol=g.terrain&&K&&Y?p.invert(p.create(),Mo):os,Mr=cr(or,ft.tileID.canonical,K,ne,Q,gt.getProjection(),io),zr=Ce&&gt.hasTextData(),Pi="none"!==h.layout.get("icon-text-fit")&&zr&&gt.hasIconData();if(Y){const No=Q.elevation,fa=No?No.getAtTileOffsetFunc(Le,Q.center.lat,Q.worldSize,gt.getProjection()):sl=>[0,0,0],Qs=sh(or,ft.tileID.canonical,K,ne,Q,gt.getProjection(),io);Ri(gt,or,g,w,Qs,Mr,K,F,fa,Le)}const po=Y||w&&Ce||Pi,ui=g.translatePosMatrix(or,ft,C,I),vr=po?os:Mo,Ns=g.translatePosMatrix(Mr,ft,C,I,!0),tc=gt.getProjection().createInversionMatrix(Q,Le.canonical),Vr=[];g.terrainRenderModeElevated()&&K&&Vr.push("PITCH_WITH_MAP_TERRAIN"),bi&&Vr.push("PROJECTION_GLOBE_VIEW"),po&&Vr.push("PROJECTED_POS_ON_VIEWPORT");const Co=Gt&&0!==h.paint.get(w?"text-halo-width":"icon-halo-width").constantOr(1);let La;La=Gt?gt.iconsInText?Ra(It.kind,Lt,se,K,g,ui,vr,Ns,bn,Nt,Le,pr,he,tc,hr,gt.getProjection()):Sl(It.kind,Lt,se,K,g,ui,vr,Ns,w,bn,!0,Le,pr,he,tc,hr,gt.getProjection()):hu(It.kind,Lt,se,K,g,ui,vr,Ns,w,bn,Le,pr,he,tc,hr,gt.getProjection());const Ys={program:g.useProgram(gh(Gt,w,gt),Me,Vr),buffers:qe,uniformValues:La,atlasTexture:Gn,atlasTextureIcon:Jn,atlasInterpolation:Rn,atlasInterpolationIcon:yn,isSDF:Gt,hasHalo:Co,tile:ft,labelPlaneMatrixInv:ol};if(J&&gt.canOverlap){_e=!0;const No=qe.segments.get();for(const fa of No)it.push({segments:new p.SegmentVector([fa]),sortKey:fa.sortKey,state:Ys})}else it.push({segments:qe.segments,sortKey:0,state:Ys})}_e&&it.sort((Le,ft)=>Le.sortKey-ft.sortKey);for(const Le of it){const ft=Le.state;if(g.terrain&&g.terrain.setupElevationDraw(ft.tile,ft.program,{useDepthForOcclusion:!He,labelPlaneMatrixInv:ft.labelPlaneMatrixInv}),X.activeTexture.set(te.TEXTURE0),ft.atlasTexture.bind(ft.atlasInterpolation,te.CLAMP_TO_EDGE),ft.atlasTextureIcon&&(X.activeTexture.set(te.TEXTURE1),ft.atlasTextureIcon&&ft.atlasTextureIcon.bind(ft.atlasInterpolationIcon,te.CLAMP_TO_EDGE)),ft.isSDF){const gt=ft.uniformValues;ft.hasHalo&&(gt.u_is_halo=1,pa(ft.buffers,Le.segments,h,g,ft.program,ve,N,H,gt)),gt.u_is_halo=0}pa(ft.buffers,Le.segments,h,g,ft.program,ve,N,H,ft.uniformValues)}}function pa(g,c,h,_,w,C,I,k,R){const F=_.context,N=[g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer,g.globeExtVertexBuffer];w.draw(F,F.gl.TRIANGLES,C,I,k,p.CullFaceMode.disabled,R,h.id,g.layoutVertexBuffer,g.indexBuffer,c,h.paint,_.transform.zoom,g.programConfigurations.get(h.id),N)}function wm(g,c,h,_,w,C,I){const k=g.context.gl,R=h.paint.get("fill-pattern"),F=R&&R.constantOr(1),N=h.getCrossfadeParameters();let H,X,te,Q,ne;I?(X=F&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",H=k.LINES):(X=F?"fillPattern":"fill",H=k.TRIANGLES);for(const K of _){const Y=c.getTile(K);if(F&&!Y.patternsLoaded())continue;const se=Y.getBucket(h);if(!se)continue;g.prepareDrawTile();const J=se.programConfigurations.get(h.id),_e=g.useProgram(X,J);F&&(g.context.activeTexture.set(k.TEXTURE0),Y.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),J.updatePaintBuffers(N));const ve=R.constantOr(null);if(ve&&Y.imageAtlas){const Ce=Y.imageAtlas,He=Ce.patternPositions[ve.to.toString()],it=Ce.patternPositions[ve.from.toString()];He&&it&&J.setConstantPatternPositions(He,it)}const he=g.translatePosMatrix(K.projMatrix,Y,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(I){Q=se.indexBuffer2,ne=se.segments2;const Ce=g.terrain&&g.terrain.renderingToTexture?g.terrain.drapeBufferSize:[k.drawingBufferWidth,k.drawingBufferHeight];te="fillOutlinePattern"===X&&F?_n(he,g,N,Y,Ce):qs(he,Ce)}else Q=se.indexBuffer,ne=se.segments,te=F?jp(he,g,N,Y):Io(he);g.prepareDrawProgram(g.context,_e,K.toUnwrapped()),_e.draw(g.context,H,w,g.stencilModeForClipping(K),C,p.CullFaceMode.disabled,te,h.id,se.layoutVertexBuffer,Q,ne,h.paint,g.transform.zoom,J)}}function Sm(g,c,h,_,w,C,I){const k=g.context,R=k.gl,F=g.transform,N=h.paint.get("fill-extrusion-pattern"),H=N.constantOr(1),X=h.getCrossfadeParameters(),te=h.paint.get("fill-extrusion-opacity"),Q=[h.paint.get("fill-extrusion-ambient-occlusion-intensity"),h.paint.get("fill-extrusion-ambient-occlusion-radius")],ne=h.layout.get("fill-extrusion-edge-radius"),K="globe"===F.projection.name?p.fillExtrusionHeightLift():0,Y="globe"===F.projection.name,se=Y?p.globeToMercatorTransition(F.zoom):0,J=[p.mercatorXfromLng(F.center.lng),p.mercatorYfromLat(F.center.lat)],_e=[];Y&&(_e.push("PROJECTION_GLOBE_VIEW"),g.style.terrainSetForDrapingOnly()&&_e.push("TERRAIN")),Q[0]>0&&_e.push("FAUX_AO");for(const ve of _){const he=c.getTile(ve),Ce=he.getBucket(h);if(!Ce||Ce.projection.name!==F.projection.name)continue;const He=Ce.programConfigurations.get(h.id),it=g.useProgram(H?"fillExtrusionPattern":"fillExtrusion",He,_e);if(g.terrain){const Me=g.terrain;if(g.style.terrainSetForDrapingOnly())Me.setupElevationDraw(he,it,{useMeterToDem:!0});else{if(!Ce.enableTerrain)continue;if(Me.setupElevationDraw(he,it,{useMeterToDem:!0}),$p(k,c,ve,Ce,h,Me),!Ce.centroidVertexBuffer){const Gt=it.attributes.a_centroid_pos;void 0!==Gt&&R.vertexAttrib2f(Gt,0,0)}}}H&&(g.context.activeTexture.set(R.TEXTURE0),he.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),He.updatePaintBuffers(X));const Qe=N.constantOr(null);if(Qe&&he.imageAtlas){const Me=he.imageAtlas,Gt=Me.patternPositions[Qe.to.toString()],It=Me.patternPositions[Qe.from.toString()];Gt&&It&&He.setConstantPatternPositions(Gt,It)}const wt=g.translatePosMatrix(ve.projMatrix,he,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Le=F.projection.createInversionMatrix(F,ve.canonical),ft=h.paint.get("fill-extrusion-vertical-gradient"),gt=H?wl(wt,g,ft,te,Q,ne,ve,X,he,K,se,J,Le):Sc(wt,g,ft,te,Q,ne,ve,K,se,J,Le);g.prepareDrawProgram(k,it,ve.toUnwrapped());const qe=[];g.terrain&&qe.push(Ce.centroidVertexBuffer),Y&&qe.push(Ce.layoutVertexExtBuffer),it.draw(k,k.gl.TRIANGLES,w,C,I,p.CullFaceMode.backCCW,gt,h.id,Ce.layoutVertexBuffer,Ce.indexBuffer,Ce.segments,h.paint,g.transform.zoom,He,qe)}}function $p(g,c,h,_,w,C){const I=[Y=>{let se=Y.canonical.x-1,J=Y.wrap;return se<0&&(se=(1<<Y.canonical.z)-1,J--),new p.OverscaledTileID(Y.overscaledZ,J,Y.canonical.z,se,Y.canonical.y)},Y=>{let se=Y.canonical.x+1,J=Y.wrap;return se===1<<Y.canonical.z&&(se=0,J++),new p.OverscaledTileID(Y.overscaledZ,J,Y.canonical.z,se,Y.canonical.y)},Y=>new p.OverscaledTileID(Y.overscaledZ,Y.wrap,Y.canonical.z,Y.canonical.x,(0===Y.canonical.y?1<<Y.canonical.z:Y.canonical.y)-1),Y=>new p.OverscaledTileID(Y.overscaledZ,Y.wrap,Y.canonical.z,Y.canonical.x,Y.canonical.y===(1<<Y.canonical.z)-1?0:Y.canonical.y+1)],k=Y=>{const se=c.getSource().minzoom,J=ve=>{const he=c.getTileByID(ve);if(he&&he.hasData())return he.getBucket(w)},_e=[0,-1,1];for(const ve of _e){if(Y.overscaledZ+ve<se)continue;const he=J(Y.calculateScaledKey(Y.overscaledZ+ve));if(he)return he}},R=[0,0,0],F=(Y,se)=>(R[0]=Math.min(Y.min.y,se.min.y),R[1]=Math.max(Y.max.y,se.max.y),R[2]=p.EXTENT-se.min.x>Y.max.x?se.min.x-p.EXTENT:Y.max.x,R),N=(Y,se)=>(R[0]=Math.min(Y.min.x,se.min.x),R[1]=Math.max(Y.max.x,se.max.x),R[2]=p.EXTENT-se.min.y>Y.max.y?se.min.y-p.EXTENT:Y.max.y,R),H=[(Y,se)=>F(Y,se),(Y,se)=>F(se,Y),(Y,se)=>N(Y,se),(Y,se)=>N(se,Y)],X=new p.pointGeometry(0,0);let te,Q,ne;const K=(Y,se,J,_e,ve)=>{const he=[[_e?J:Y,_e?Y:J,0],[_e?J:se,_e?se:J,0]],Ce=ve<0?p.EXTENT+ve:ve,He=[_e?Ce:(Y+se)/2,_e?(Y+se)/2:Ce,0];return 0===J&&ve<0||0!==J&&ve>0?C.getForTilePoints(ne,[He],!0,Q):he.push(He),C.getForTilePoints(h,he,!0,te),Math.max(he[0][2],he[1][2],He[2])/C.exaggeration()};for(let Y=0;Y<4;Y++){const se=(Y<2?1:5)-Y,J=_.borders[Y];if(0===J.length)continue;const _e=ne=I[Y](h),ve=k(_e);if(!(ve&&ve instanceof p.FillExtrusionBucket&&ve.enableTerrain)||_.borderDoneWithNeighborZ[Y]===ve.canonical.z&&ve.borderDoneWithNeighborZ[se]===_.canonical.z||(Q=C.findDEMTileFor(_e),!Q||!Q.dem))continue;if(!te){const it=C.findDEMTileFor(h);if(!it||!it.dem)return;te=it}const he=ve.borders[se];let Ce=0;const He=ve.borderDoneWithNeighborZ[se]!==_.canonical.z;if(_.canonical.z===ve.canonical.z){for(let it=0;it<J.length;it++){const Qe=_.featuresOnBorder[J[it]],wt=Qe.borders[Y];let Le;for(;Ce<he.length&&(Le=ve.featuresOnBorder[he[Ce]],!(Le.borders[se][1]>wt[0]+3));)He&&ve.encodeCentroid(void 0,Le,!1),Ce++;if(Le&&Ce<he.length){const ft=Ce;let gt=0;for(;!(Le.borders[se][0]>wt[1]-3)&&(gt++,++Ce!==he.length);)Le=ve.featuresOnBorder[he[Ce]];if(Le=ve.featuresOnBorder[he[ft]],Qe.intersectsCount()>1||Le.intersectsCount()>1||1!==gt){1!==gt&&(Ce=ft),_.encodeCentroid(void 0,Qe,!1),He&&ve.encodeCentroid(void 0,Le,!1);continue}const qe=H[Y](Qe,Le),Me=Y%2?p.EXTENT-1:0;X.x=K(qe[0],Math.min(p.EXTENT-1,qe[1]),Me,Y<2,qe[2]),X.y=0,_.encodeCentroid(X,Qe,!1),He&&ve.encodeCentroid(X,Le,!1)}else _.encodeCentroid(void 0,Qe,!1)}_.borderDoneWithNeighborZ[Y]=ve.canonical.z,_.needsCentroidUpdate=!0,He&&(ve.borderDoneWithNeighborZ[se]=_.canonical.z,ve.needsCentroidUpdate=!0)}else{for(const it of J)_.encodeCentroid(void 0,_.featuresOnBorder[it],!1);if(He){for(const it of he)ve.encodeCentroid(void 0,ve.featuresOnBorder[it],!1);ve.borderDoneWithNeighborZ[se]=_.canonical.z,ve.needsCentroidUpdate=!0}_.borderDoneWithNeighborZ[Y]=ve.canonical.z,_.needsCentroidUpdate=!0}}(_.needsCentroidUpdate||!_.centroidVertexBuffer&&0!==_.centroidVertexArray.length)&&_.uploadCentroid(g)}const Gp=new p.Color(1,0,0,1),mb=new p.Color(0,1,0,1),gb=new p.Color(0,0,1,1),bb=new p.Color(1,0,1,1),Cm=new p.Color(0,1,1,1);function pu(g,c,h){const _=g.context,w=g.transform,C=_.gl,I="globe"===w.projection.name,k=I?["PROJECTION_GLOBE_VIEW"]:null;let R=h.projMatrix;if(I&&p.globeToMercatorTransition(w.zoom)>0){const Qe=p.transitionTileAABBinECEF(h.canonical,w),wt=p.globeDenormalizeECEF(Qe);R=p.multiply(new Float32Array(16),w.globeMatrix,wt),p.multiply(R,w.projMatrix,R)}const F=g.useProgram("debug",null,k),N=c.getTileByID(h.key);g.terrain&&g.terrain.setupElevationDraw(N,F);const H=p.DepthMode.disabled,X=p.StencilMode.disabled,te=g.colorModeForRenderPass(),Q="$debug";_.activeTexture.set(C.TEXTURE0),g.emptyTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),I?N._makeGlobeTileDebugBuffers(g.context,w):N._makeDebugTileBoundsBuffers(g.context,w.projection);const ne=N._tileDebugBuffer||g.debugBuffer,K=N._tileDebugIndexBuffer||g.debugIndexBuffer,Y=N._tileDebugSegments||g.debugSegments;F.draw(_,C.LINE_STRIP,H,X,te,p.CullFaceMode.disabled,ho(R,p.Color.red),Q,ne,K,Y,null,null,null,[N._globeTileDebugBorderBuffer]);const se=N.latestRawTileData,J=Math.floor((se&&se.byteLength||0)/1024),_e=c.getTile(h).tileSize,ve=512/Math.min(_e,512)*(h.overscaledZ/w.zoom)*.5;let he=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(he+=` => ${h.overscaledZ}`),he+=` ${J}kb`,function(Qe,wt){Qe.initDebugOverlayCanvas();const Le=Qe.debugOverlayCanvas,ft=Qe.context.gl,gt=Qe.debugOverlayCanvas.getContext("2d");gt.clearRect(0,0,Le.width,Le.height),gt.shadowColor="white",gt.shadowBlur=2,gt.lineWidth=1.5,gt.strokeStyle="white",gt.textBaseline="top",gt.font="bold 36px Open Sans, sans-serif",gt.fillText(wt,5,5),gt.strokeText(wt,5,5),Qe.debugOverlayTexture.update(Le),Qe.debugOverlayTexture.bind(ft.LINEAR,ft.CLAMP_TO_EDGE)}(g,he);const Ce=N._tileDebugTextBuffer||g.debugBuffer,He=N._tileDebugTextIndexBuffer||g.quadTriangleIndexBuffer,it=N._tileDebugTextSegments||g.debugSegments;F.draw(_,C.TRIANGLES,H,X,p.ColorMode.alphaBlended,p.CullFaceMode.disabled,ho(R,p.Color.transparent,ve),Q,Ce,He,it,null,null,null,[N._globeTileDebugTextBuffer])}function td(g,c,h,_){Zl(g,0,c+h/2,g.transform.width,h,_)}function Tm(g,c,h,_){Zl(g,c-h/2,0,h,g.transform.height,_)}function Zl(g,c,h,_,w,C){const I=g.context,k=I.gl;k.enable(k.SCISSOR_TEST),k.scissor(c*p.exported.devicePixelRatio,h*p.exported.devicePixelRatio,_*p.exported.devicePixelRatio,w*p.exported.devicePixelRatio),I.clear({color:C}),k.disable(k.SCISSOR_TEST)}const nd=p.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:_b}=nd;function Cl(g,c,h,_){g.emplaceBack(c,h,_)}class er{constructor(c){this.vertexArray=new p.StructArrayLayout3f12,this.indices=new p.StructArrayLayout3ui6,Cl(this.vertexArray,-1,-1,1),Cl(this.vertexArray,1,-1,1),Cl(this.vertexArray,-1,1,1),Cl(this.vertexArray,1,1,1),Cl(this.vertexArray,-1,-1,-1),Cl(this.vertexArray,1,-1,-1),Cl(this.vertexArray,-1,1,-1),Cl(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=c.createVertexBuffer(this.vertexArray,_b),this.indexBuffer=c.createIndexBuffer(this.indices),this.segment=p.SegmentVector.simpleSegment(0,0,36,12)}}function Yl(g,c,h,_,w,C){const I=g.gl,k=c.paint.get("sky-atmosphere-color"),R=c.paint.get("sky-atmosphere-halo-color"),F=c.paint.get("sky-atmosphere-sun-intensity"),N={u_matrix_3f:p.fromMat4(p.create$1(),_),u_sun_direction:w,u_sun_intensity:F,u_color_tint_r:[(Q=k).r,Q.g,Q.b,Q.a],u_color_tint_m:[(ne=R).r,ne.g,ne.b,ne.a],u_luminance:5e-5};var Q,ne;I.framebufferTexture2D(I.FRAMEBUFFER,I.COLOR_ATTACHMENT0,I.TEXTURE_CUBE_MAP_POSITIVE_X+C,c.skyboxTexture,0),h.draw(g,I.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,p.ColorMode.unblended,p.CullFaceMode.frontCW,N,"skyboxCapture",c.skyboxGeometry.vertexBuffer,c.skyboxGeometry.indexBuffer,c.skyboxGeometry.segment)}const dv=p.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class qp{constructor(c){const h=new p.StructArrayLayout5f20;h.emplaceBack(-1,1,1,0,0),h.emplaceBack(1,1,1,1,0),h.emplaceBack(1,-1,1,1,1),h.emplaceBack(-1,-1,1,0,1);const _=new p.StructArrayLayout3ui6;_.emplaceBack(0,1,2),_.emplaceBack(2,3,0),this.vertexBuffer=c.createVertexBuffer(h,dv.members),this.indexBuffer=c.createIndexBuffer(_),this.segments=p.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Ql={symbol:function(g,c,h,_,w){if("translucent"!==g.renderPass)return;const C=p.StencilMode.disabled,I=g.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(k,R,F,N,H,X,te){const Q=R.transform,ne="map"===H,K="map"===X;for(const Y of k){const se=N.getTile(Y),J=se.getBucket(F);if(!J||!J.text||!J.text.segments.get().length)continue;const _e=p.evaluateSizeForZoom(J.textSizeData,Q.zoom),ve=Xu(Y,J.getProjection(),Q),he=Q.calculatePixelsToTileUnitsMatrix(se),Ce=yc(ve,se.tileID.canonical,K,ne,Q,J.getProjection(),he),He="none"!==F.layout.get("icon-text-fit")&&J.hasIconData();if(_e){const it=Math.pow(2,Q.zoom-se.tileID.overscaledZ);Hp(J,ne,K,te,p.symbolSize,Q,Ce,Y,it,_e,He)}}}(_,g,h,c,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),w),0!==h.paint.get("icon-opacity").constantOr(1)&&ed(g,c,h,_,!1,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),h.layout.get("icon-rotation-alignment"),h.layout.get("icon-pitch-alignment"),h.layout.get("icon-keep-upright"),C,I),0!==h.paint.get("text-opacity").constantOr(1)&&ed(g,c,h,_,!0,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),h.layout.get("text-keep-upright"),C,I),c.map.showCollisionBoxes&&(Up(g,c,h,_,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),Up(g,c,h,_,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(g,c,h,_){if("translucent"!==g.renderPass)return;const w=h.paint.get("circle-opacity"),C=h.paint.get("circle-stroke-width"),I=h.paint.get("circle-stroke-opacity"),k=void 0!==h.layout.get("circle-sort-key").constantOr(1);if(0===w.constantOr(1)&&(0===C.constantOr(1)||0===I.constantOr(1)))return;const R=g.context,F=R.gl,N=g.transform,H=g.depthModeForSublayer(0,p.DepthMode.ReadOnly),X=p.StencilMode.disabled,te=g.colorModeForRenderPass(),Q="globe"===N.projection.name,ne=[p.mercatorXfromLng(N.center.lng),p.mercatorYfromLat(N.center.lat)],K=[];for(let se=0;se<_.length;se++){const J=_[se],_e=c.getTile(J),ve=_e.getBucket(h);if(!ve||ve.projection.name!==N.projection.name)continue;const he=ve.programConfigurations.get(h.id),Ce=Ls(h);Q&&Ce.push("PROJECTION_GLOBE_VIEW");const He=g.useProgram("circle",he,Ce),it=ve.layoutVertexBuffer,Qe=ve.globeExtVertexBuffer,wt=ve.indexBuffer,Le=N.projection.createInversionMatrix(N,J.canonical),ft={programConfiguration:he,program:He,layoutVertexBuffer:it,globeExtVertexBuffer:Qe,indexBuffer:wt,uniformValues:Pr(g,J,_e,Le,ne,h),tile:_e};if(k){const gt=ve.segments.get();for(const qe of gt)K.push({segments:new p.SegmentVector([qe]),sortKey:qe.sortKey,state:ft})}else K.push({segments:ve.segments,sortKey:0,state:ft})}k&&K.sort((se,J)=>se.sortKey-J.sortKey);const Y={useDepthForOcclusion:!Q};for(const se of K){const{programConfiguration:J,program:_e,layoutVertexBuffer:ve,globeExtVertexBuffer:he,indexBuffer:Ce,uniformValues:He,tile:it}=se.state,Qe=se.segments;g.terrain&&g.terrain.setupElevationDraw(it,_e,Y),g.prepareDrawProgram(R,_e,it.tileID.toUnwrapped()),_e.draw(R,F.TRIANGLES,H,X,te,p.CullFaceMode.disabled,He,h.id,ve,Ce,Qe,h.paint,N.zoom,J,[he])}},heatmap:function(g,c,h,_){if(0!==h.paint.get("heatmap-opacity"))if("offscreen"===g.renderPass){const w=g.context,C=w.gl,I=p.StencilMode.disabled,k=new p.ColorMode([C.ONE,C.ONE],p.Color.transparent,[!0,!0,!0,!0]);(function(te,Q,ne,K){const Y=te.gl,se=Q.width*K,J=Q.height*K;te.activeTexture.set(Y.TEXTURE1),te.viewport.set([0,0,se,J]);let _e=ne.heatmapFbo;if(!_e||_e&&(_e.width!==se||_e.height!==J)){_e&&_e.destroy();const ve=Y.createTexture();Y.bindTexture(Y.TEXTURE_2D,ve),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_WRAP_S,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_WRAP_T,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_MIN_FILTER,Y.LINEAR),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_MAG_FILTER,Y.LINEAR),_e=ne.heatmapFbo=te.createFramebuffer(se,J,!1),function(he,Ce,He,it,Qe,wt){const Le=he.gl;Le.texImage2D(Le.TEXTURE_2D,0,Le.RGBA,Qe,wt,0,Le.RGBA,he.extRenderToTextureHalfFloat?he.extTextureHalfFloat.HALF_FLOAT_OES:Le.UNSIGNED_BYTE,null),it.colorAttachment.set(He)}(te,0,ve,_e,se,J)}else Y.bindTexture(Y.TEXTURE_2D,_e.colorAttachment.get()),te.bindFramebuffer.set(_e.framebuffer)})(w,g,h,"globe"===g.transform.projection.name?.5:.25),w.clear({color:p.Color.transparent});const R=g.transform,F="globe"===R.projection.name,N=F?["PROJECTION_GLOBE_VIEW"]:null,H=F?p.CullFaceMode.frontCCW:p.CullFaceMode.disabled,X=[p.mercatorXfromLng(R.center.lng),p.mercatorYfromLat(R.center.lat)];for(let te=0;te<_.length;te++){const Q=_[te];if(c.hasRenderableParent(Q))continue;const ne=c.getTile(Q),K=ne.getBucket(h);if(!K||K.projection.name!==R.projection.name)continue;const Y=K.programConfigurations.get(h.id),se=g.useProgram("heatmap",Y,N),{zoom:J}=g.transform;g.terrain&&g.terrain.setupElevationDraw(ne,se),g.prepareDrawProgram(w,se,Q.toUnwrapped());const _e=R.projection.createInversionMatrix(R,Q.canonical);se.draw(w,C.TRIANGLES,p.DepthMode.disabled,I,k,H,Yr(g,Q,ne,_e,X,J,h.paint.get("heatmap-intensity")),h.id,K.layoutVertexBuffer,K.indexBuffer,K.segments,h.paint,g.transform.zoom,Y,F?[K.globeExtVertexBuffer]:null)}w.viewport.set([0,0,g.width,g.height])}else"translucent"===g.renderPass&&(g.context.setColorMode(g.colorModeForRenderPass()),function(w,C){const I=w.context,k=I.gl,R=C.heatmapFbo;if(!R)return;I.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,R.colorAttachment.get()),I.activeTexture.set(k.TEXTURE1);let F=C.colorRampTexture;F||(F=C.colorRampTexture=new p.Texture(I,C.colorRamp,k.RGBA)),F.bind(k.LINEAR,k.CLAMP_TO_EDGE),w.useProgram("heatmapTexture").draw(I,k.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,w.colorModeForRenderPass(),p.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:C.paint.get("heatmap-opacity")},C.id,w.viewportBuffer,w.quadTriangleIndexBuffer,w.viewportSegments,C.paint,w.transform.zoom)}(g,h))},line:function(g,c,h,_){if("translucent"!==g.renderPass)return;const w=h.paint.get("line-opacity"),C=h.paint.get("line-width");if(0===w.constantOr(1)||0===C.constantOr(1))return;const I=g.depthModeForSublayer(0,p.DepthMode.ReadOnly),k=g.colorModeForRenderPass(),R=g.terrain&&g.terrain.renderingToTexture?1:p.exported.devicePixelRatio,F=h.paint.get("line-dasharray"),N=F.constantOr(1),H=h.layout.get("line-cap"),X=h.paint.get("line-pattern"),te=X.constantOr(1),Q=h.paint.get("line-gradient"),ne=h.getCrossfadeParameters(),K=te?"linePattern":"line",Y=g.context,se=Y.gl,J=(ve=>{const he=[];Tc(ve)&&he.push("RENDER_LINE_DASH"),ve.paint.get("line-gradient")&&he.push("RENDER_LINE_GRADIENT");const Ce=ve.paint.get("line-trim-offset");0===Ce[0]&&0===Ce[1]||he.push("RENDER_LINE_TRIM_OFFSET");const He=ve.paint.get("line-pattern").constantOr(1),it=1!==ve.paint.get("line-opacity").constantOr(1);return!He&&it&&he.push("RENDER_LINE_ALPHA_DISCARD"),he})(h);let _e=J.includes("RENDER_LINE_ALPHA_DISCARD");g.terrain&&g.terrain.clipOrMaskOverlapStencilType()&&(_e=!1);for(const ve of _){const he=c.getTile(ve);if(te&&!he.patternsLoaded())continue;const Ce=he.getBucket(h);if(!Ce)continue;g.prepareDrawTile();const He=Ce.programConfigurations.get(h.id),it=g.useProgram(K,He,J),Qe=X.constantOr(null);if(Qe&&he.imageAtlas){const It=he.imageAtlas,jt=It.patternPositions[Qe.to.toString()],Lt=It.patternPositions[Qe.from.toString()];jt&&Lt&&He.setConstantPatternPositions(jt,Lt)}const wt=F.constantOr(null),Le=H.constantOr(null);if(!te&&wt&&Le&&he.lineAtlas){const It=he.lineAtlas,jt=It.getDash(wt.to,Le),Lt=It.getDash(wt.from,Le);jt&&Lt&&He.setConstantPatternPositions(jt,Lt)}let[ft,gt]=h.paint.get("line-trim-offset");("round"===Le||"square"===Le)&&ft!==gt&&(0===ft&&(ft-=1),1===gt&&(gt+=1));const qe=g.terrain?ve.projMatrix:null,Me=te?Wl(g,he,h,ne,qe,R):du(g,he,h,ne,qe,Ce.lineClipsArray.length,R,[ft,gt]);if(Q){const It=Ce.gradients[h.id];let jt=It.texture;if(h.gradientVersion!==It.version){let Lt=256;if(h.stepInterpolant){const bn=c.getSource().maxzoom,Gn=ve.canonical.z===bn?Math.ceil(1<<g.transform.maxZoom-ve.canonical.z):1;Lt=p.clamp(p.nextPowerOfTwo(Ce.maxLineLength/p.EXTENT*1024*Gn),256,Y.maxTextureSize)}It.gradient=p.renderColorRamp({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:Lt,image:It.gradient||void 0,clips:Ce.lineClipsArray}),It.texture?It.texture.update(It.gradient):It.texture=new p.Texture(Y,It.gradient,se.RGBA),It.version=h.gradientVersion,jt=It.texture}Y.activeTexture.set(se.TEXTURE1),jt.bind(h.stepInterpolant?se.NEAREST:se.LINEAR,se.CLAMP_TO_EDGE)}N&&(Y.activeTexture.set(se.TEXTURE0),he.lineAtlasTexture.bind(se.LINEAR,se.REPEAT),He.updatePaintBuffers(ne)),te&&(Y.activeTexture.set(se.TEXTURE0),he.imageAtlasTexture.bind(se.LINEAR,se.CLAMP_TO_EDGE),He.updatePaintBuffers(ne)),g.prepareDrawProgram(Y,it,ve.toUnwrapped());const Gt=It=>{it.draw(Y,se.TRIANGLES,I,It,k,p.CullFaceMode.disabled,Me,h.id,Ce.layoutVertexBuffer,Ce.indexBuffer,Ce.segments,h.paint,g.transform.zoom,He,[Ce.layoutVertexBuffer2])};if(_e){const It=g.stencilModeForClipping(ve).ref;0===It&&g.terrain&&Y.clear({stencil:0});const jt={func:se.EQUAL,mask:255};Me.u_alpha_discard_threshold=.8,Gt(new p.StencilMode(jt,It,255,se.KEEP,se.KEEP,se.INVERT)),Me.u_alpha_discard_threshold=0,Gt(new p.StencilMode(jt,It,255,se.KEEP,se.KEEP,se.KEEP))}else Gt(g.stencilModeForClipping(ve))}_e&&(g.resetStencilClippingMasks(),g.terrain&&Y.clear({stencil:0}))},fill:function(g,c,h,_){const w=h.paint.get("fill-color"),C=h.paint.get("fill-opacity");if(0===C.constantOr(1))return;const I=g.colorModeForRenderPass(),k=h.paint.get("fill-pattern"),R=g.opaquePassEnabledForLayer()&&!k.constantOr(1)&&1===w.constantOr(p.Color.transparent).a&&1===C.constantOr(0)?"opaque":"translucent";if(g.renderPass===R){const F=g.depthModeForSublayer(1,"opaque"===g.renderPass?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly);wm(g,c,h,_,F,I,!1)}if("translucent"===g.renderPass&&h.paint.get("fill-antialias")){const F=g.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,p.DepthMode.ReadOnly);wm(g,c,h,_,F,I,!0)}},"fill-extrusion":function(g,c,h,_){const w=h.paint.get("fill-extrusion-opacity");if(0!==w&&"translucent"===g.renderPass){const C=new p.DepthMode(g.context.gl.LEQUAL,p.DepthMode.ReadWrite,g.depthRangeFor3D);if(1!==w||h.paint.get("fill-extrusion-pattern").constantOr(1))Sm(g,c,h,_,C,p.StencilMode.disabled,p.ColorMode.disabled),Sm(g,c,h,_,C,g.stencilModeFor3D(),g.colorModeForRenderPass()),g.resetStencilClippingMasks();else{const I=g.colorModeForRenderPass();Sm(g,c,h,_,C,p.StencilMode.disabled,I)}}},hillshade:function(g,c,h,_){if("offscreen"!==g.renderPass&&"translucent"!==g.renderPass)return;const w=g.context,C=g.depthModeForSublayer(0,p.DepthMode.ReadOnly),I=g.colorModeForRenderPass(),k=g.terrain&&g.terrain.renderingToTexture,[R,F]="translucent"!==g.renderPass||k?[{},_]:g.stencilConfigForOverlap(_);for(const N of F){const H=c.getTile(N);if(H.needsHillshadePrepare&&"offscreen"===g.renderPass)kn(g,H,h,C,p.StencilMode.disabled,I);else if("translucent"===g.renderPass){const X=k&&g.terrain?g.terrain.stencilModeForRTTOverlap(N):R[N.overscaledZ];ql(g,N,H,h,C,X,I)}}w.viewport.set([0,0,g.width,g.height]),g.resetStencilClippingMasks()},raster:function(g,c,h,_,w,C){if("translucent"!==g.renderPass||0===h.paint.get("raster-opacity")||!_.length)return;const I=g.context,k=I.gl,R=c.getSource(),F=g.useProgram("raster"),N=g.colorModeForRenderPass(),H=g.terrain&&g.terrain.renderingToTexture,[X,te]=R instanceof Te||H?[{},_]:g.stencilConfigForOverlap(_),Q=te[te.length-1].overscaledZ,ne=!g.options.moving;for(const K of te){const Y=H?p.DepthMode.disabled:g.depthModeForSublayer(K.overscaledZ-Q,1===h.paint.get("raster-opacity")?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly,k.LESS),se=K.toUnwrapped(),J=c.getTile(K);if(H&&(!J||!J.hasData()))continue;const _e=H?K.projMatrix:g.transform.calculateProjMatrix(se,ne),ve=g.terrain&&H?g.terrain.stencilModeForRTTOverlap(K):X[K.overscaledZ],he=C?0:h.paint.get("raster-fade-duration");J.registerFadeDuration(he);const Ce=c.findLoadedParent(K,0),He=ns(J,Ce,c,g.transform,he);let it,Qe;g.terrain&&g.terrain.prepareDrawTile();const wt="nearest"===h.paint.get("raster-resampling")?k.NEAREST:k.LINEAR;I.activeTexture.set(k.TEXTURE0),J.texture.bind(wt,k.CLAMP_TO_EDGE),I.activeTexture.set(k.TEXTURE1),Ce?(Ce.texture.bind(wt,k.CLAMP_TO_EDGE),it=Math.pow(2,Ce.tileID.overscaledZ-J.tileID.overscaledZ),Qe=[J.tileID.canonical.x*it%1,J.tileID.canonical.y*it%1]):J.texture.bind(wt,k.CLAMP_TO_EDGE);const Le=Ju(_e,Qe||[0,0],it||1,He,h,R instanceof Te?R.perspectiveTransform:[0,0]);if(g.prepareDrawProgram(I,F,se),R instanceof Te)R.boundsBuffer&&R.boundsSegments&&F.draw(I,k.TRIANGLES,Y,p.StencilMode.disabled,N,p.CullFaceMode.disabled,Le,h.id,R.boundsBuffer,g.quadTriangleIndexBuffer,R.boundsSegments);else{const{tileBoundsBuffer:ft,tileBoundsIndexBuffer:gt,tileBoundsSegments:qe}=g.getTileBoundsBuffers(J);F.draw(I,k.TRIANGLES,Y,ve,N,p.CullFaceMode.disabled,Le,h.id,ft,gt,qe)}}g.resetStencilClippingMasks()},background:function(g,c,h,_){const w=h.paint.get("background-color"),C=h.paint.get("background-opacity");if(0===C)return;const I=g.context,k=I.gl,R=g.transform,F=R.tileSize,N=h.paint.get("background-pattern");if(g.isPatternMissing(N))return;const H=!N&&1===w.a&&1===C&&g.opaquePassEnabledForLayer()?"opaque":"translucent";if(g.renderPass!==H)return;const X=p.StencilMode.disabled,te=g.depthModeForSublayer(0,"opaque"===H?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly),Q=g.colorModeForRenderPass(),ne=g.useProgram(N?"backgroundPattern":"background");let K,Y=_;Y||(K=g.getBackgroundTiles(),Y=Object.values(K).map(J=>J.tileID)),N&&(I.activeTexture.set(k.TEXTURE0),g.imageManager.bind(g.context));const se=h.getCrossfadeParameters();for(const J of Y){const _e=J.toUnwrapped(),ve=_?J.projMatrix:g.transform.calculateProjMatrix(_e);g.prepareDrawTile();const he=c?c.getTile(J):K?K[J.key]:new p.Tile(J,F,R.zoom,g),Ce=N?xm(ve,C,g,N,{tileID:J,tileSize:F},se):Xl(ve,C,w);g.prepareDrawProgram(I,ne,_e);const{tileBoundsBuffer:He,tileBoundsIndexBuffer:it,tileBoundsSegments:Qe}=g.getTileBoundsBuffers(he);ne.draw(I,k.TRIANGLES,te,X,Q,p.CullFaceMode.disabled,Ce,h.id,He,it,Qe)}},sky:function(g,c,h){const _=g.transform,w="mercator"===_.projection.name||"globe"===_.projection.name?1:p.smoothstep(7,8,_.zoom),C=h.paint.get("sky-opacity")*w;if(0===C)return;const I=g.context,k=h.paint.get("sky-type"),R=new p.DepthMode(I.gl.LEQUAL,p.DepthMode.ReadOnly,[0,1]),F=g.frameCounter/1e3%1;"atmosphere"===k?"offscreen"===g.renderPass?h.needsSkyboxCapture(g)&&(function(N,H,X,te){const Q=N.context,ne=Q.gl;let K=H.skyboxFbo;if(!K){K=H.skyboxFbo=Q.createFramebuffer(32,32,!1),H.skyboxGeometry=new er(Q),H.skyboxTexture=Q.gl.createTexture(),ne.bindTexture(ne.TEXTURE_CUBE_MAP,H.skyboxTexture),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_WRAP_S,ne.CLAMP_TO_EDGE),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_WRAP_T,ne.CLAMP_TO_EDGE),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_MIN_FILTER,ne.LINEAR),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_MAG_FILTER,ne.LINEAR);for(let _e=0;_e<6;++_e)ne.texImage2D(ne.TEXTURE_CUBE_MAP_POSITIVE_X+_e,0,ne.RGBA,32,32,0,ne.RGBA,ne.UNSIGNED_BYTE,null)}Q.bindFramebuffer.set(K.framebuffer),Q.viewport.set([0,0,32,32]);const Y=H.getCenter(N,!0),se=N.useProgram("skyboxCapture"),J=new Float64Array(16);p.identity(J),p.rotateY(J,J,.5*-Math.PI),Yl(Q,H,se,J,Y,0),p.identity(J),p.rotateY(J,J,.5*Math.PI),Yl(Q,H,se,J,Y,1),p.identity(J),p.rotateX(J,J,.5*-Math.PI),Yl(Q,H,se,J,Y,2),p.identity(J),p.rotateX(J,J,.5*Math.PI),Yl(Q,H,se,J,Y,3),p.identity(J),Yl(Q,H,se,J,Y,4),p.identity(J),p.rotateY(J,J,Math.PI),Yl(Q,H,se,J,Y,5),Q.viewport.set([0,0,N.width,N.height])}(g,h),h.markSkyboxValid(g)):"sky"===g.renderPass&&function(N,H,X,te,Q){const ne=N.context,K=ne.gl,Y=N.transform,se=N.useProgram("skybox");ne.activeTexture.set(K.TEXTURE0),K.bindTexture(K.TEXTURE_CUBE_MAP,H.skyboxTexture);const J={u_matrix:Y.skyboxMatrix,u_sun_direction:H.getCenter(N,!1),u_cubemap:0,u_opacity:te,u_temporal_offset:Q};N.prepareDrawProgram(ne,se),se.draw(ne,K.TRIANGLES,X,p.StencilMode.disabled,N.colorModeForRenderPass(),p.CullFaceMode.backCW,J,"skybox",H.skyboxGeometry.vertexBuffer,H.skyboxGeometry.indexBuffer,H.skyboxGeometry.segment)}(g,h,R,C,F):"gradient"===k&&"sky"===g.renderPass&&function(N,H,X,te,Q){const ne=N.context,K=ne.gl,Y=N.transform,se=N.useProgram("skyboxGradient");H.skyboxGeometry||(H.skyboxGeometry=new er(ne)),ne.activeTexture.set(K.TEXTURE0);let J=H.colorRampTexture;J||(J=H.colorRampTexture=new p.Texture(ne,H.colorRamp,K.RGBA)),J.bind(K.LINEAR,K.CLAMP_TO_EDGE);const _e=(ve=Y.skyboxMatrix,he=H.getCenter(N,!1),Ce=H.paint.get("sky-gradient-radius"),He=te,it=Q,{u_matrix:ve,u_color_ramp:0,u_center_direction:he,u_radius:p.degToRad(Ce),u_opacity:He,u_temporal_offset:it});var ve,he,Ce,He,it;N.prepareDrawProgram(ne,se),se.draw(ne,K.TRIANGLES,X,p.StencilMode.disabled,N.colorModeForRenderPass(),p.CullFaceMode.backCW,_e,"skyboxGradient",H.skyboxGeometry.vertexBuffer,H.skyboxGeometry.indexBuffer,H.skyboxGeometry.segment)}(g,h,R,C,F)},debug:function(g,c,h){for(let _=0;_<h.length;_++)pu(g,c,h[_])},custom:function(g,c,h){const _=g.context,w=h.implementation;if(g.transform.projection.unsupportedLayers&&g.transform.projection.unsupportedLayers.includes("custom"))p.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if("offscreen"===g.renderPass){const C=w.prerender;C&&(g.setCustomLayerDefaults(),_.setColorMode(g.colorModeForRenderPass()),C.call(w,_.gl,g.transform.customLayerMatrix()),_.setDirty(),g.setBaseState())}else if("translucent"===g.renderPass){g.setCustomLayerDefaults(),_.setColorMode(g.colorModeForRenderPass()),_.setStencilMode(p.StencilMode.disabled);const C="3d"===w.renderingMode?new p.DepthMode(g.context.gl.LEQUAL,p.DepthMode.ReadWrite,g.depthRangeFor3D):g.depthModeForSublayer(0,p.DepthMode.ReadOnly);_.setDepthMode(C),w.render(_.gl,g.transform.customLayerMatrix()),_.setDirty(),g.setBaseState(),_.bindFramebuffer.set(null)}}};class hv{constructor(c,h){this.context=new U(c),this.transform=h,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=p.SourceCache.maxUnderzooming+p.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new $l,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(c,h){const _=!!c&&!!c.terrain&&this.transform.projection.supportsTerrain;if(!(_||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Os(this,c));const w=this._terrain;this.transform.elevation=_?w:null,w.update(c,this.transform,h)}_updateFog(c){const h=c.fog;if(!h||"globe"===this.transform.projection.name||h.getOpacity(this.transform.pitch)<1||h.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[_,w]=h.getFovAdjustedRange(this.transform._fov);if(_>w)return void(this.transform.fogCullDistSq=null);const C=_+.78*(w-_);this.transform.fogCullDistSq=C*C}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(c,h){if(this.width=c*p.exported.devicePixelRatio,this.height=h*p.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style.order)this.style._layers[_].resize()}setup(){const c=this.context,h=new p.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(p.EXTENT,0),h.emplaceBack(0,p.EXTENT),h.emplaceBack(p.EXTENT,p.EXTENT),this.tileExtentBuffer=c.createVertexBuffer(h,p.posAttributes.members),this.tileExtentSegments=p.SegmentVector.simpleSegment(0,0,4,2);const _=new p.StructArrayLayout2i4;_.emplaceBack(0,0),_.emplaceBack(p.EXTENT,0),_.emplaceBack(0,p.EXTENT),_.emplaceBack(p.EXTENT,p.EXTENT),this.debugBuffer=c.createVertexBuffer(_,p.posAttributes.members),this.debugSegments=p.SegmentVector.simpleSegment(0,0,4,5);const w=new p.StructArrayLayout2i4;w.emplaceBack(-1,-1),w.emplaceBack(1,-1),w.emplaceBack(-1,1),w.emplaceBack(1,1),this.viewportBuffer=c.createVertexBuffer(w,p.posAttributes.members),this.viewportSegments=p.SegmentVector.simpleSegment(0,0,4,2);const C=new p.StructArrayLayout4i8;C.emplaceBack(0,0,0,0),C.emplaceBack(p.EXTENT,0,p.EXTENT,0),C.emplaceBack(0,p.EXTENT,0,p.EXTENT),C.emplaceBack(p.EXTENT,p.EXTENT,p.EXTENT,p.EXTENT),this.mercatorBoundsBuffer=c.createVertexBuffer(C,p.boundsAttributes.members),this.mercatorBoundsSegments=p.SegmentVector.simpleSegment(0,0,4,2);const I=new p.StructArrayLayout3ui6;I.emplaceBack(0,1,2),I.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=c.createIndexBuffer(I);const k=new p.StructArrayLayout1ui2;for(const F of[0,1,3,2,0])k.emplaceBack(F);this.debugIndexBuffer=c.createIndexBuffer(k),this.emptyTexture=new p.Texture(c,new p.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),c.gl.RGBA),this.identityMat=p.create();const R=this.context.gl;this.stencilClearMode=new p.StencilMode({func:R.ALWAYS,mask:0},0,255,R.ZERO,R.ZERO,R.ZERO),this.loadTimeStamps.push(p.window.performance.now()),this.atmosphereBuffer=new qp(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(c){return c._makeTileBoundsBuffers(this.context,this.transform.projection),c._tileBoundsBuffer?{tileBoundsBuffer:c._tileBoundsBuffer,tileBoundsIndexBuffer:c._tileBoundsIndexBuffer,tileBoundsSegments:c._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const c=this.context,h=c.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(c,h.TRIANGLES,p.DepthMode.disabled,this.stencilClearMode,p.ColorMode.disabled,p.CullFaceMode.disabled,vt(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(c,h,_){if(!h||this.currentStencilSource===h.id||!c.isTileClipped()||!_||0===_.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let k=!1;for(const R of _)if(void 0===this._tileClippingMaskIDs[R.key]){k=!0;break}if(!k)return}this.currentStencilSource=h.id;const w=this.context,C=w.gl;this.nextStencilID+_.length>256&&this.clearStencil(),w.setColorMode(p.ColorMode.disabled),w.setDepthMode(p.DepthMode.disabled);const I=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const k of _){const R=h.getTile(k),F=this._tileClippingMaskIDs[k.key]=this.nextStencilID++,{tileBoundsBuffer:N,tileBoundsIndexBuffer:H,tileBoundsSegments:X}=this.getTileBoundsBuffers(R);I.draw(w,C.TRIANGLES,p.DepthMode.disabled,new p.StencilMode({func:C.ALWAYS,mask:0},F,255,C.KEEP,C.KEEP,C.REPLACE),p.ColorMode.disabled,p.CullFaceMode.disabled,vt(k.projMatrix),"$clipping",N,H,X)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const c=this.nextStencilID++,h=this.context.gl;return new p.StencilMode({func:h.NOTEQUAL,mask:255},c,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(c){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(c);const h=this.context.gl;return new p.StencilMode({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[c.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(c){const h=this.context.gl,_=c.sort((I,k)=>k.overscaledZ-I.overscaledZ),w=_[_.length-1].overscaledZ,C=_[0].overscaledZ-w+1;if(C>1){this.currentStencilSource=void 0,this.nextStencilID+C>256&&this.clearStencil();const I={};for(let k=0;k<C;k++)I[k+w]=new p.StencilMode({func:h.GEQUAL,mask:255},k+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=C,[I,_]}return[{[w]:p.StencilMode.disabled},_]}colorModeForRenderPass(){const c=this.context.gl;return this._showOverdrawInspector?new p.ColorMode([c.CONSTANT_COLOR,c.ONE],new p.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?p.ColorMode.unblended:p.ColorMode.alphaBlended}depthModeForSublayer(c,h,_){if(!this.opaquePassEnabledForLayer())return p.DepthMode.disabled;const w=1-((1+this.currentLayer)*this.numSublayers+c)*this.depthEpsilon;return new p.DepthMode(_||this.context.gl.LEQUAL,h,[w,w])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(c,h){this.style=c,this.options=h,this.imageManager=c.imageManager,this.glyphManager=c.glyphManager,this.symbolFadeChange=c.placement.symbolFadeChange(p.exported.now()),this.imageManager.beginFrame();const _=this.style.order,w=this.style._sourceCaches;for(const R in w){const F=w[R];F.used&&F.prepare(this.context)}const C={},I={},k={};for(const R in w){const F=w[R];C[R]=F.getVisibleCoordinates(),I[R]=C[R].slice().reverse(),k[R]=F.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let R=0;R<_.length;R++)if(this.style._layers[_[R]].is3D()){this.opaquePassCutoff=R;break}if(this.terrain&&(this.terrain.updateTileBinding(k),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new p.GlobeSharedBuffers(this.context)),p.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const R of _){const F=this.style._layers[R],N=c._getLayerSourceCache(F);if(!F.hasOffscreenPass()||F.isHidden(this.transform.zoom))continue;const H=N?I[N.id]:void 0;("custom"===F.type||F.isSky()||H&&H.length)&&this.renderLayer(this,N,F,H)}if(this.depthRangeFor3D=[0,1-(c.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:h.showOverdrawInspector?p.Color.black:p.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const R=this.style._layers[_[this.currentLayer]],F=c._getLayerSourceCache(R);if(R.isSky())continue;const N=F?I[F.id]:void 0;this._renderTileClippingMasks(R,F,N),this.renderLayer(this,F,R,N)}if(this.style.fog&&this.transform.projection.supportsFog&&function(R,F){const N=R.context,H=N.gl,X=R.transform,te=new p.DepthMode(H.LEQUAL,p.DepthMode.ReadOnly,[0,1]),Q=R.useProgram("globeAtmosphere",null,"globe"===X.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),ne=p.globeToMercatorTransition(X.zoom),K=F.properties.get("color").toArray01(),Y=F.properties.get("high-color").toArray01(),se=F.properties.get("space-color").toArray01PremultipliedAlpha(),J=p.identity$1([]);p.rotateY$1(J,J,-p.degToRad(X._center.lng)),p.rotateX$1(J,J,p.degToRad(X._center.lat)),p.rotateZ$1(J,J,X.angle),p.rotateX$1(J,J,-X._pitch);const _e=p.fromQuat(new Float32Array(16),J),ve=p.mapValue(F.properties.get("star-intensity"),0,1,0,.25),Ce=p.mapValue(F.properties.get("horizon-blend"),0,1,5e-4,.25),He=p.globeUseCustomAntiAliasing(R,N,X)&&5e-4===Ce?X.worldSize/(2*Math.PI*1.025)-1:X.globeRadius,it=R.frameCounter/1e3%1,Qe=p.length(X.globeCenterInViewSpace),wt=Math.sqrt(Math.pow(Qe,2)-Math.pow(He,2)),Le=Math.acos(wt/Qe),ft={u_frustum_tl:X.frustumCorners.TL,u_frustum_tr:X.frustumCorners.TR,u_frustum_br:X.frustumCorners.BR,u_frustum_bl:X.frustumCorners.BL,u_horizon:X.frustumCorners.horizon,u_transition:ne,u_fadeout_range:Ce,u_color:K,u_high_color:Y,u_space_color:se,u_star_intensity:ve,u_star_size:5*p.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:it,u_horizon_angle:Le,u_rotation_matrix:_e};R.prepareDrawProgram(N,Q);const gt=R.atmosphereBuffer;gt&&Q.draw(N,H.TRIANGLES,te,p.StencilMode.disabled,p.ColorMode.alphaBlended,p.CullFaceMode.backCW,ft,"skybox",gt.vertexBuffer,gt.indexBuffer,gt.segments)}(this,this.style.fog),this.renderPass="sky",(p.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const R=this.style._layers[_[this.currentLayer]],F=c._getLayerSourceCache(R);R.isSky()&&this.renderLayer(this,F,R,F?I[F.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<_.length;){const R=this.style._layers[_[this.currentLayer]],F=c._getLayerSourceCache(R);if(R.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(R)){if(R.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const N=F?("symbol"===R.type?k:I)[F.id]:void 0;this._renderTileClippingMasks(R,F,F?C[F.id]:void 0),this.renderLayer(this,F,R,N),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let R=null;p.values(this.style._layers).forEach(F=>{const N=c._getLayerSourceCache(F);N&&!F.isHidden(this.transform.zoom)&&(!R||R.getSource().maxzoom<N.getSource().maxzoom)&&(R=N)}),R&&this.options.showTileBoundaries&&Ql.debug(this,R,R.getVisibleCoordinates())}this.options.showPadding&&function(R){const F=R.transform.padding;td(R,R.transform.height-(F.top||0),3,Gp),td(R,F.bottom||0,3,mb),Tm(R,F.left||0,3,gb),Tm(R,R.transform.width-(F.right||0),3,bb);const N=R.transform.centerPoint;var H,X,te,Q;Zl(H=R,(X=N.x)-1,(te=R.transform.height-N.y)-10,2,20,Q=Cm),Zl(H,X-10,te-1,20,2,Q)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(p.window.performance.now()),this.saveCanvasCopy())}}renderLayer(c,h,_,w){_.isHidden(this.transform.zoom)||("background"===_.type||"sky"===_.type||"custom"===_.type||w&&w.length)&&(this.id=_.id,this.gpuTimingStart(_),c.transform.projection.unsupportedLayers&&c.transform.projection.unsupportedLayers.includes(_.type)||Ql[_.type](c,h,_,w,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(c){if(!this.options.gpuTiming)return;const h=this.context.extTimerQuery;let _=this.gpuTimers[c.id];_||(_=this.gpuTimers[c.id]={calls:0,cpuTime:0,query:h.createQueryEXT()}),_.calls++,h.beginQueryEXT(h.TIME_ELAPSED_EXT,_.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const c=this.context.extTimerQuery,h=c.createQueryEXT();this.deferredRenderGpuTimeQueries.push(h),c.beginQueryEXT(c.TIME_ELAPSED_EXT,h)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const c=this.context.extTimerQuery;c.endQueryEXT(c.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery;c.endQueryEXT(c.TIME_ELAPSED_EXT)}collectGpuTimers(){const c=this.gpuTimers;return this.gpuTimers={},c}collectDeferredRenderGpuQueries(){const c=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],c}queryGpuTimers(c){const h={};for(const _ in c){const w=c[_],C=this.context.extTimerQuery,I=C.getQueryObjectEXT(w.query,C.QUERY_RESULT_EXT)/1e6;C.deleteQueryEXT(w.query),h[_]=I}return h}queryGpuTimeDeferredRender(c){if(!this.options.gpuTimingDeferredRender)return 0;const h=this.context.extTimerQuery;let _=0;for(const w of c)_+=h.getQueryObjectEXT(w,h.QUERY_RESULT_EXT)/1e6,h.deleteQueryEXT(w);return _}translatePosMatrix(c,h,_,w,C){if(!_[0]&&!_[1])return c;const I=C?"map"===w?this.transform.angle:0:"viewport"===w?-this.transform.angle:0;if(I){const F=Math.sin(I),N=Math.cos(I);_=[_[0]*N-_[1]*F,_[0]*F+_[1]*N]}const k=[C?_[0]:ni(h,_[0],this.transform.zoom),C?_[1]:ni(h,_[1],this.transform.zoom),0],R=new Float32Array(16);return p.translate(R,c,k),R}saveTileTexture(c){const h=this._tileTextures[c.size[0]];h?h.push(c):this._tileTextures[c.size[0]]=[c]}getTileTexture(c){const h=this._tileTextures[c];return h&&h.length>0?h.pop():null}isPatternMissing(c){if(!c)return!1;if(!c.from||!c.to)return!0;const h=this.imageManager.getPattern(c.from.toString()),_=this.imageManager.getPattern(c.to.toString());return!h||!_}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const c=this.terrain&&this.terrain.renderingToTexture,h=this.style&&this.style.fog,_=[];return this.terrainRenderModeElevated()&&_.push("TERRAIN"),"globe"===this.transform.projection.name&&_.push("GLOBE"),h&&!c&&0!==h.getOpacity(this.transform.pitch)&&_.push("FOG"),c&&_.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&_.push("OVERDRAW_INSPECTOR"),_}useProgram(c,h,_){this.cache=this.cache||{};const w=_||[],C=this.currentGlobalDefines().concat(w),I=Ku.cacheKey(lu[c],c,C,h);return this.cache[I]||(this.cache[I]=new Ku(this.context,c,lu[c],h,Ir[c],C)),this.cache[I]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const c=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(c.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=p.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new p.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(c,h,_){if(this.terrain&&this.terrain.renderingToTexture)return;const w=this.style.fog;if(w){const C=w.getOpacity(this.transform.pitch),I=((k,R,F,N,H,X,te,Q,ne,K,Y)=>{const se=k.transform,J=R.properties.get("color").toArray01();J[3]=N;const _e=k.frameCounter/1e3%1;return{u_fog_matrix:F?se.calculateFogTileMatrix(F):k.identityMat,u_fog_range:R.getFovAdjustedRange(se._fov),u_fog_color:J,u_fog_horizon_blend:R.properties.get("horizon-blend"),u_fog_temporal_offset:_e,u_frustum_tl:H,u_frustum_tr:X,u_frustum_br:te,u_frustum_bl:Q,u_globe_pos:ne,u_globe_radius:K,u_viewport:Y,u_globe_transition:p.globeToMercatorTransition(se.zoom),u_is_globe:+("globe"===se.projection.name)}})(this,w,_,C,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*p.exported.devicePixelRatio,this.transform.height*p.exported.devicePixelRatio]);h.setFogUniformValues(c,I)}}setTileLoadedFlag(c){this.tileLoaded=c}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const c=this.context.gl,h=c.createTexture();return c.bindTexture(c.TEXTURE_2D,h),c.copyTexImage2D(c.TEXTURE_2D,0,c.RGBA,0,0,c.drawingBufferWidth,c.drawingBufferHeight,0),h}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const c=this.style&&this.style.fog;return!!c&&0!==c.getOpacity(this.transform.pitch)}getBackgroundTiles(){const c=this._backgroundTiles,h=this._backgroundTiles={},_=this.transform.coveringTiles({tileSize:512});for(const w of _)h[w.key]=c[w.key]||new p.Tile(w,512,this.transform.tileZoom,this);return h}clearBackgroundTiles(){this._backgroundTiles={}}}class Dm{constructor(c=0,h=0,_=0,w=0){if(isNaN(c)||c<0||isNaN(h)||h<0||isNaN(_)||_<0||isNaN(w)||w<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=c,this.bottom=h,this.left=_,this.right=w}interpolate(c,h,_){return null!=h.top&&null!=c.top&&(this.top=p.number(c.top,h.top,_)),null!=h.bottom&&null!=c.bottom&&(this.bottom=p.number(c.bottom,h.bottom,_)),null!=h.left&&null!=c.left&&(this.left=p.number(c.left,h.left,_)),null!=h.right&&null!=c.right&&(this.right=p.number(c.right,h.right,_)),this}getCenter(c,h){const _=p.clamp((this.left+c-this.right)/2,0,c),w=p.clamp((this.top+h-this.bottom)/2,0,h);return new p.pointGeometry(_,w)}equals(c){return this.top===c.top&&this.bottom===c.bottom&&this.left===c.left&&this.right===c.right}clone(){return new Dm(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Em(g,c){const h=p.getColumn(g,3);p.fromQuat(g,c),p.setColumn(g,3,h)}function Tl(g,c){const h=p.identity$1([]);return p.rotateZ$1(h,h,-c),p.rotateX$1(h,h,-g),h}function id(g,c){const h=[g[0],g[1],0],_=[c[0],c[1],0];if(p.length(h)>=1e-15){const I=p.normalize([],h);p.scale$2(_,I,p.dot(_,I)),c[0]=_[0],c[1]=_[1]}const w=p.cross([],c,g);if(p.len(w)<1e-15)return null;const C=Math.atan2(-w[1],w[0]);return Tl(Math.atan2(Math.sqrt(g[0]*g[0]+g[1]*g[1]),-g[2]),C)}class dr{constructor(c,h){this.position=c,this.orientation=h}get position(){return this._position}set position(c){if(c){const h=c instanceof p.MercatorCoordinate?c:new p.MercatorCoordinate(c[0],c[1],c[2]);this._renderWorldCopies&&(h.x=p.wrap(h.x,0,1)),this._position=h}else this._position=null}lookAtPoint(c,h){if(this.orientation=null,!this.position)return;const _=this._elevation?this._elevation.getAtPointOrZero(p.MercatorCoordinate.fromLngLat(c)):0,w=this.position,C=p.MercatorCoordinate.fromLngLat(c,_),I=[C.x-w.x,C.y-w.y,C.z-w.z];h||(h=[0,0,1]),h[2]=Math.abs(h[2]),this.orientation=id(I,h)}setPitchBearing(c,h){this.orientation=Tl(p.degToRad(c),p.degToRad(-h))}}class Kl{constructor(c,h){this._transform=p.identity([]),this.orientation=h,this.position=c}get mercatorPosition(){const c=this.position;return new p.MercatorCoordinate(c[0],c[1],c[2])}get position(){const c=p.getColumn(this._transform,3);return[c[0],c[1],c[2]]}set position(c){var h;c&&p.setColumn(this._transform,3,[(h=c)[0],h[1],h[2],1])}get orientation(){return this._orientation}set orientation(c){this._orientation=c||p.identity$1([]),c&&Em(this._transform,this._orientation)}getPitchBearing(){const c=this.forward(),h=this.right();return{bearing:Math.atan2(-h[1],h[0]),pitch:Math.atan2(Math.sqrt(c[0]*c[0]+c[1]*c[1]),-c[2])}}setPitchBearing(c,h){this._orientation=Tl(c,h),Em(this._transform,this._orientation)}forward(){const c=p.getColumn(this._transform,2);return[-c[0],-c[1],-c[2]]}up(){const c=p.getColumn(this._transform,1);return[-c[0],-c[1],-c[2]]}right(){const c=p.getColumn(this._transform,0);return[c[0],c[1],c[2]]}getCameraToWorld(c,h){const _=new Float64Array(16);return p.invert(_,this.getWorldToCamera(c,h)),_}getWorldToCameraPosition(c,h,_){const w=this.position;p.scale$2(w,w,-c);const C=new Float64Array(16);return p.fromScaling(C,[_,_,_]),p.translate(C,C,w),C[10]*=h,C}getWorldToCamera(c,h){const _=new Float64Array(16),w=new Float64Array(4),C=this.position;return p.conjugate(w,this._orientation),p.scale$2(C,C,-c),p.fromQuat(_,w),p.translate(_,_,C),_[1]*=-1,_[5]*=-1,_[9]*=-1,_[13]*=-1,_[8]*=h,_[9]*=h,_[10]*=h,_[11]*=h,_}getCameraToClipPerspective(c,h,_,w){const C=new Float64Array(16);return p.perspective(C,c,h,_,w),C}getDistanceToElevation(c){const h=0===c?0:p.mercatorZfromAltitude(c,this.position[1]),_=this.forward();return(h-this.position[2])/_[2]}clone(){return new Kl([...this.position],[...this.orientation])}}function bh(g,c){const h=fu(g.projection,g.zoom,g.width,g.height),_=function(C,I,k,R,F){const N=new p.LngLat(k.lng-180*il,k.lat),H=new p.LngLat(k.lng+180*il,k.lat),X=C.project(N.lng,N.lat),te=C.project(H.lng,H.lat),Q=-Math.atan2(te.y-X.y,te.x-X.x),ne=p.MercatorCoordinate.fromLngLat(k);ne.y=p.clamp(ne.y,-.999975,.999975);const K=ne.toLngLat(),Y=C.project(K.lng,K.lat),se=p.MercatorCoordinate.fromLngLat(K);se.x+=il;const J=se.toLngLat(),_e=C.project(J.lng,J.lat),ve=Kt(_e.x-Y.x,_e.y-Y.y,Q),he=p.MercatorCoordinate.fromLngLat(K);he.y+=il;const Ce=he.toLngLat(),He=C.project(Ce.lng,Ce.lat),it=Kt(He.x-Y.x,He.y-Y.y,Q),Qe=Math.abs(ve.x)/Math.abs(it.y),wt=p.identity([]);p.rotateZ(wt,wt,-Q*(1-(F?0:R)));const Le=p.identity([]);return p.scale(Le,Le,[1,1-(1-Qe)*R,1]),Le[4]=-it.x/it.y*R,p.rotateZ(Le,Le,Q),p.multiply(Le,wt,Le),Le}(g.projection,0,g.center,h,c),w=_h(g);return p.scale(_,_,[w,w,1]),_}function _h(g){const c=g.projection,h=fu(g.projection,g.zoom,g.width,g.height),_=rd(c,g.center),w=rd(c,p.LngLat.convert(c.center));return Math.pow(2,_*h+(1-h)*w)}function fu(g,c,h,_,w=1/0){const C=g.range;if(!C)return 0;const I=Math.min(w,Math.max(h,_)),k=Math.log(I/1024)/Math.LN2;return p.smoothstep(C[0]+k,C[1]+k,c)}const il=1/4e4;function rd(g,c){const h=p.clamp(c.lat,-p.MAX_MERCATOR_LATITUDE,p.MAX_MERCATOR_LATITUDE),_=new p.LngLat(c.lng-180*il,h),w=new p.LngLat(c.lng+180*il,h),C=g.project(_.lng,h),I=g.project(w.lng,h),k=p.MercatorCoordinate.fromLngLat(_),R=p.MercatorCoordinate.fromLngLat(w),F=I.x-C.x,N=I.y-C.y,H=R.x-k.x,X=R.y-k.y,te=Math.sqrt((H*H+X*X)/(F*F+N*N));return Math.log(te)/Math.LN2}function Kt(g,c,h){const _=Math.cos(h),w=Math.sin(h);return{x:g*_-c*w,y:g*w+c*_}}class Ws{constructor(c,h,_,w,C,I,k){this.tileSize=512,this._renderWorldCopies=void 0===C||C,this._minZoom=c||0,this._maxZoom=h||22,this._minPitch=null==_?0:_,this._maxPitch=null==w?60:w,this.setProjection(I),this.setMaxBounds(k),this.width=0,this.height=0,this._center=new p.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Dm,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Kl,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const c=new Ws(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return c._elevation=this._elevation,c._centerAltitude=this._centerAltitude,c._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,c.tileSize=this.tileSize,c.mercatorFromTransition=this.mercatorFromTransition,c.width=this.width,c.height=this.height,c.cameraElevationReference=this.cameraElevationReference,c._center=this._center,c._setZoom(this.zoom),c._seaLevelZoom=this._seaLevelZoom,c.angle=this.angle,c._fov=this._fov,c._pitch=this._pitch,c._nearZ=this._nearZ,c._farZ=this._farZ,c._averageElevation=this._averageElevation,c._unmodified=this._unmodified,c._edgeInsets=this._edgeInsets.clone(),c._camera=this._camera.clone(),c._calcMatrices(),c.freezeTileCoverage=this.freezeTileCoverage,c.frustumCorners=this.frustumCorners,c}get elevation(){return this._elevation}set elevation(c){this._elevation!==c&&(this._elevation=c,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(c){const h=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||h)&&this._updateCameraOnTerrain(),(c||h)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return p.pick(this.projection,["name","center","parallels"])}setProjection(c){this.projectionOptions=c||{name:"mercator"};const h=this.projection?this.getProjection():void 0;this.projection=p.getProjection(this.projectionOptions);const _=!me(h,this.getProjection());return _&&this._calcMatrices(),this.mercatorFromTransition=!1,_}setMercatorFromTransition(){const c=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=p.getProjection({name:"mercator"});const h=c!==this.projection.name;return h&&this._calcMatrices(),h}get minZoom(){return this._minZoom}set minZoom(c){this._minZoom!==c&&(this._minZoom=c,this.zoom=Math.max(this.zoom,c))}get maxZoom(){return this._maxZoom}set maxZoom(c){this._maxZoom!==c&&(this._maxZoom=c,this.zoom=Math.min(this.zoom,c))}get minPitch(){return this._minPitch}set minPitch(c){this._minPitch!==c&&(this._minPitch=c,this.pitch=Math.max(this.pitch,c))}get maxPitch(){return this._maxPitch}set maxPitch(c){this._maxPitch!==c&&(this._maxPitch=c,this.pitch=Math.min(this.pitch,c))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(c){void 0===c?c=!0:null===c&&(c=!1),this._renderWorldCopies=c}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const c=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(c))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return p.mercatorZfromAltitude(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new p.pointGeometry(this.width,this.height)}get bearing(){return p.wrap(this.rotation,-180,180)}set bearing(c){this.rotation=c}get rotation(){return-this.angle/Math.PI*180}set rotation(c){const h=-c*Math.PI/180;var _,w,C,I,k,R,F,N,H,X;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=(_=new p.ARRAY_TYPE(4),p.ARRAY_TYPE!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_),w=this.rotationMatrix,I=this.angle,k=(C=this.rotationMatrix)[0],R=C[1],F=C[2],N=C[3],H=Math.sin(I),X=Math.cos(I),w[0]=k*X+F*H,w[1]=R*X+N*H,w[2]=k*-H+F*X,w[3]=R*-H+N*X)}get pitch(){return this._pitch/Math.PI*180}set pitch(c){const h=p.clamp(c,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get aspect(){return this.width/this.height}get fovX(){return this._fov}get fovY(){const c=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/c)}set fov(c){c=Math.max(.01,Math.min(60,c)),this._fov!==c&&(this._unmodified=!1,this._fov=p.degToRad(c),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(c){this._averageElevation=c,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(c){const h=Math.min(Math.max(c,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._setZoom(h),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(c){this._zoom=c,this.scale=this.zoomScale(c),this.tileZoom=Math.floor(c),this.zoomFraction=c-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const c=this._elevation;this._centerAltitude=c.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=c.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const c=this._elevation,h=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],_=this.horizonLineFromTop();let w=0,C=0;for(let I=0;I<h.length;I++){const k=new p.pointGeometry(h[I][0]*this.width,_+h[I][1]*(this.height-_)),R=c.pointCoordinate(k);if(!R)continue;const F=1/Math.hypot(R[0]-this._camera.position[0],R[1]-this._camera.position[1]);w+=R[3]*F,C+=F}return 0===C?NaN:w/C}get center(){return this._center}set center(c){c.lat===this._center.lat&&c.lng===this._center.lng||(this._unmodified=!1,this._center=c,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const c=this._seaLevelZoom,h=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),_=this.pixelsPerMeter/this.worldSize*h,w=this._mercatorZfromZoom(c),C=this._mercatorZfromZoom(this._maxZoom),I=Math.max(w-_,C);this._setZoom(this._zoomFromMercatorZ(I))}get padding(){return this._edgeInsets.toJSON()}set padding(c){this._edgeInsets.equals(c)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,c,1),this._calcMatrices())}computeZoomRelativeTo(c){const h=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,c.toAltitude()));let _;_=c.z<this._camera.position[2]?[h.x,h.y,h.z]:[c.x,c.y,c.z];const w=p.length(p.sub([],this._camera.position,_));return p.clamp(this._zoomFromMercatorZ(w),this._minZoom,this._maxZoom)}setFreeCameraOptions(c){if(!this.height||!c.position&&!c.orientation)return;this._updateCameraState();let h=!1;if(c.orientation&&!p.exactEquals(c.orientation,this._camera.orientation)&&(h=this._setCameraOrientation(c.orientation)),c.position){const _=[c.position.x,c.position.y,c.position.z];p.exactEquals$1(_,this._camera.position)||(this._setCameraPosition(_),h=!0)}h&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const c=this._camera.position,h=new dr;return h.position=new p.MercatorCoordinate(c[0],c[1],c[2]),h.orientation=this._camera.orientation,h._elevation=this.elevation,h._renderWorldCopies=this.renderWorldCopies,h}_setCameraOrientation(c){if(!p.length$1(c))return!1;p.normalize$1(c,c);const h=p.transformQuat([],[0,0,-1],c),_=p.transformQuat([],[0,-1,0],c);if(_[2]<0)return!1;const w=id(h,_);return!!w&&(this._camera.orientation=w,!0)}_setCameraPosition(c){const h=this.zoomScale(this.minZoom)*this.tileSize,_=this.zoomScale(this.maxZoom)*this.tileSize,w=this.cameraToCenterDistance;c[2]=p.clamp(c[2],w/_,w/h),this._camera.position=c}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(c){return this._edgeInsets.equals(c)}interpolatePadding(c,h,_){this._unmodified=!1,this._edgeInsets.interpolate(c,h,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(c){const h=(c.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/c.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(c){const h=[new p.UnwrappedTileID(0,c)];if(this.renderWorldCopies){const _=this.pointCoordinate(new p.pointGeometry(0,0)),w=this.pointCoordinate(new p.pointGeometry(this.width,0)),C=this.pointCoordinate(new p.pointGeometry(this.width,this.height)),I=this.pointCoordinate(new p.pointGeometry(0,this.height)),k=Math.floor(Math.min(_.x,w.x,C.x,I.x)),R=Math.floor(Math.max(_.x,w.x,C.x,I.x)),F=1;for(let N=k-F;N<=R+F;N++)0!==N&&h.push(new p.UnwrappedTileID(N,c))}return h}coveringTiles(c){let h=this.coveringZoomLevel(c);const _=h,w=this.elevation&&!c.isTerrainDEM,C="mercator"===this.projection.name;if(void 0!==c.minzoom&&h<c.minzoom)return[];void 0!==c.maxzoom&&h>c.maxzoom&&(h=c.maxzoom);const I=this.locationCoordinate(this.center),k=this.center.lat,R=1<<h,F=[R*I.x,R*I.y,0],N="globe"===this.projection.name,H=!N,X=p.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h,H),te=N?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Q=R*p.mercatorZfromAltitude(1,this.center.lat),ne=this._camera.position[2]/p.mercatorZfromAltitude(1,this.center.lat),K=[R*te.x,R*te.y,ne*(H?1:Q)],Y=this.cameraToCenterDistance/c.tileSize*(c.roundZoom?1:.502),se=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?h:0,J=c.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,_e=c.isTerrainDEM?-J:this._elevation?this._elevation.getMinElevationBelowMSL():0,ve=this.projection.isReprojectedInTileSpace?_h(this):1,he=Me=>{const It=new p.MercatorCoordinate(Me.x+25e-6,Me.y,Me.z),jt=new p.MercatorCoordinate(Me.x,Me.y+25e-6,Me.z),Lt=Me.toLngLat(),bn=It.toLngLat(),Gn=jt.toLngLat(),Rn=this.locationCoordinate(Lt),yn=this.locationCoordinate(bn),Nt=this.locationCoordinate(Gn),Jn=Math.hypot(yn.x-Rn.x,yn.y-Rn.y),bi=Math.hypot(Nt.x-Rn.x,Nt.y-Rn.y);return Math.sqrt(Jn*bi)*ve/25e-6},Ce=Me=>{const Gt=J,It=_e;return{aabb:p.tileAABB(this,R,0,0,0,Me,It,Gt,this.projection),zoom:0,x:0,y:0,minZ:It,maxZ:Gt,wrap:Me,fullyVisible:!1}},He=[];let it=[];const Qe=h,wt=c.reparseOverscaled?_:h,Le=Me=>Me*Me,ft=Le((ne-this._centerAltitude)*Q),gt=Me=>{if(!this._elevation||!Me.tileID||!C)return;const Gt=this._elevation.getMinMaxForTile(Me.tileID),It=Me.aabb;Gt?(It.min[2]=Gt.min,It.max[2]=Gt.max,It.center[2]=(It.min[2]+It.max[2])/2):(Me.shouldSplit=qe(Me),Me.shouldSplit||(It.min[2]=It.max[2]=It.center[2]=this._centerAltitude))},qe=Me=>{if(Me.zoom<se)return!0;if(Me.zoom===Qe)return!1;if(null!=Me.shouldSplit)return Me.shouldSplit;const Gt=Me.aabb.distanceX(K),It=Me.aabb.distanceY(K);let jt=ft,Lt=1;if(N){jt=Le(Me.aabb.distanceZ(K));const Rn=Math.pow(2,Me.zoom),yn=p.latFromMercatorY((Me.y+1)/Rn),Nt=p.latFromMercatorY(Me.y/Rn),Jn=Math.min(Math.max(k,yn),Nt),bi=p.circumferenceAtLatitude(Jn)/p.circumferenceAtLatitude(k);if(Lt=Jn===k?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,bi/this._mercatorScaleRatio),this.zoom<=p.GLOBE_ZOOM_THRESHOLD_MIN&&Me.zoom===Qe-1&&bi>=.9)return!0}else if(w&&(jt=Le(Me.aabb.distanceZ(K)*Q)),this.projection.isReprojectedInTileSpace&&_<=5){const Rn=Math.pow(2,Me.zoom),yn=he(new p.MercatorCoordinate((Me.x+.5)/Rn,(Me.y+.5)/Rn));Lt=yn>.85?1:yn}const bn=Gt*Gt+It*It+jt;return bn<Le((1<<Qe-Me.zoom)*Y*Lt*((Rn,yn)=>{if(yn*Le(.707)<Rn)return 1;const Nt=Math.sqrt(yn/Rn);return Nt/(1.4144271570014144+(Math.pow(1.1,Nt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(jt,ft),bn))};if(this.renderWorldCopies)for(let Me=1;Me<=3;Me++)He.push(Ce(-Me)),He.push(Ce(Me));for(He.push(Ce(0));He.length>0;){const Me=He.pop(),Gt=Me.x,It=Me.y;let jt=Me.fullyVisible;if(!jt){const Lt=Me.aabb.intersects(X);if(0===Lt)continue;jt=2===Lt}if(Me.zoom!==Qe&&qe(Me))for(let Lt=0;Lt<4;Lt++){const bn=(Gt<<1)+Lt%2,Gn=(It<<1)+(Lt>>1),Rn={aabb:C?Me.aabb.quadrant(Lt):p.tileAABB(this,R,Me.zoom+1,bn,Gn,Me.wrap,Me.minZ,Me.maxZ,this.projection),zoom:Me.zoom+1,x:bn,y:Gn,wrap:Me.wrap,fullyVisible:jt,tileID:void 0,shouldSplit:void 0,minZ:Me.minZ,maxZ:Me.maxZ};w&&!N&&(Rn.tileID=new p.OverscaledTileID(Me.zoom+1===Qe?wt:Me.zoom+1,Me.wrap,Me.zoom+1,bn,Gn),gt(Rn)),He.push(Rn)}else{const Lt=Me.zoom===Qe?wt:Me.zoom;if(c.minzoom&&c.minzoom>Lt)continue;const bn=F[0]-(.5+Gt+(Me.wrap<<Me.zoom))*(1<<h-Me.zoom),Gn=F[1]-.5-It,Rn=Me.tileID?Me.tileID:new p.OverscaledTileID(Lt,Me.wrap,Me.zoom,Gt,It);it.push({tileID:Rn,distanceSq:bn*bn+Gn*Gn})}}if(this.fogCullDistSq){const Me=this.fogCullDistSq,Gt=this.horizonLineFromTop();it=it.filter(It=>{const jt=[0,0,0,1],Lt=[p.EXTENT,p.EXTENT,0,1],bn=this.calculateFogTileMatrix(It.tileID.toUnwrapped());p.transformMat4$1(jt,jt,bn),p.transformMat4$1(Lt,Lt,bn);const Gn=p.getAABBPointSquareDist(jt,Lt);if(0===Gn)return!0;let Rn=!1;const yn=this._elevation;if(yn&&Gn>Me&&0!==Gt){const Nt=this.calculateProjMatrix(It.tileID.toUnwrapped());let Jn;c.isTerrainDEM||(Jn=yn.getMinMaxForTile(It.tileID)),Jn||(Jn={min:_e,max:J});const bi=p.furthestTileCorner(this.rotation),hr=[bi[0]*p.EXTENT,bi[1]*p.EXTENT,Jn.max];p.transformMat4(hr,hr,Nt),Rn=(1-hr[1])*this.height*.5<Gt}return Gn<Me||Rn})}return it.sort((Me,Gt)=>Me.distanceSq-Gt.distanceSq).map(Me=>Me.tileID)}resize(c,h){this.width=c,this.height=h,this.pixelsToGLUnits=[2/c,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(c){return Math.pow(2,c)}scaleZoom(c){return Math.log(c)/Math.LN2}project(c){const h=p.clamp(c.lat,-p.MAX_MERCATOR_LATITUDE,p.MAX_MERCATOR_LATITUDE),_=this.projection.project(c.lng,h);return new p.pointGeometry(_.x*this.worldSize,_.y*this.worldSize)}unproject(c){return this.projection.unproject(c.x/this.worldSize,c.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(c,h){let _,w;const C=this.centerPoint;if("globe"===this.projection.name){const k=this.worldSize;_=(h.x-C.x)/k,w=(h.y-C.y)/k}else{const k=this.pointCoordinate(h),R=this.pointCoordinate(C);_=k.x-R.x,w=k.y-R.y}const I=this.locationCoordinate(c);this.setLocation(new p.MercatorCoordinate(I.x-_,I.y-w))}setLocation(c){this.center=this.coordinateLocation(c),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(c){return this.projection.locationPoint(this,c)}locationPoint3D(c){return this.projection.locationPoint(this,c,!0)}pointLocation(c){return this.coordinateLocation(this.pointCoordinate(c))}pointLocation3D(c){return this.coordinateLocation(this.pointCoordinate3D(c))}locationCoordinate(c,h){const _=h?p.mercatorZfromAltitude(h,c.lat):void 0,w=this.projection.project(c.lng,c.lat);return new p.MercatorCoordinate(w.x,w.y,_)}coordinateLocation(c){return this.projection.unproject(c.x,c.y)}pointRayIntersection(c,h){const _=null!=h?h:this._centerAltitude,w=[c.x,c.y,0,1],C=[c.x,c.y,1,1];p.transformMat4$1(w,w,this.pixelMatrixInverse),p.transformMat4$1(C,C,this.pixelMatrixInverse);const I=C[3];p.scale$1(w,w,1/w[3]),p.scale$1(C,C,1/I);const k=w[2],R=C[2];return{p0:w,p1:C,t:k===R?0:(_-k)/(R-k)}}screenPointToMercatorRay(c){const h=[c.x,c.y,0,1],_=[c.x,c.y,1,1];return p.transformMat4$1(h,h,this.pixelMatrixInverse),p.transformMat4$1(_,_,this.pixelMatrixInverse),p.scale$1(h,h,1/h[3]),p.scale$1(_,_,1/_[3]),h[2]=p.mercatorZfromAltitude(h[2],this._center.lat)*this.worldSize,_[2]=p.mercatorZfromAltitude(_[2],this._center.lat)*this.worldSize,p.scale$1(h,h,1/this.worldSize),p.scale$1(_,_,1/this.worldSize),new p.Ray([h[0],h[1],h[2]],p.normalize([],p.sub([],_,h)))}rayIntersectionCoordinate(c){const{p0:h,p1:_,t:w}=c,C=p.mercatorZfromAltitude(h[2],this._center.lat),I=p.mercatorZfromAltitude(_[2],this._center.lat);return new p.MercatorCoordinate(p.number(h[0],_[0],w)/this.worldSize,p.number(h[1],_[1],w)/this.worldSize,p.number(C,I,w))}pointCoordinate(c,h=this._centerAltitude){return this.projection.pointCoordinate(this,c.x,c.y,h)}pointCoordinate3D(c){if(!this.elevation)return this.pointCoordinate(c);let h=this.projection.pointCoordinate3D(this,c.x,c.y);if(h)return new p.MercatorCoordinate(h[0],h[1],h[2]);let _=0,w=this.horizonLineFromTop();if(c.y>w)return this.pointCoordinate(c);const C=.02*w,I=c.clone();for(let k=0;k<10&&w-_>C;k++){I.y=p.number(_,w,.66);const R=this.projection.pointCoordinate3D(this,I.x,I.y);R?(w=I.y,h=R):_=I.y}return h?new p.MercatorCoordinate(h[0],h[1],h[2]):this.pointCoordinate(c)}isPointAboveHorizon(c){return this.projection.isPointAboveHorizon(this,c)}_coordinatePoint(c,h){const _=h&&this.elevation?this.elevation.getAtPointOrZero(c,this._centerAltitude):this._centerAltitude,w=[c.x*this.worldSize,c.y*this.worldSize,_+c.toAltitude(),1];return p.transformMat4$1(w,w,this.pixelMatrix),w[3]>0?new p.pointGeometry(w[0]/w[3],w[1]/w[3]):new p.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getGlobeBounds(){const{top:c,left:h}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,w=this.width-this._edgeInsets.right,C=this.pointCoordinate3D(new p.pointGeometry(h,c)),I=this.pointCoordinate3D(new p.pointGeometry(w,c)),k=this.pointCoordinate3D(new p.pointGeometry(w,_)),R=this.pointCoordinate3D(new p.pointGeometry(h,_));let F=Math.min(C.x,R.x),N=Math.max(I.x,k.x),H=Math.min(C.y,I.y),X=Math.max(R.y,k.y);const te=Math.pow(2,-this.zoom)/16,Q=(Y,se,J,_e)=>{const ve=(Y+J)/2,he=(se+_e)/2,Ce=new p.pointGeometry(ve,he),He=this.pointCoordinate3D(Ce),it=Math.max(0,F-He.x,H-He.y,He.x-N,He.y-X);F=Math.min(F,He.x),N=Math.max(N,He.x),H=Math.min(H,He.y),X=Math.max(X,He.y),it>te&&(Q(Y,se,ve,he),Q(ve,he,J,_e))};Q(h,c,w,c),Q(w,c,w,_),Q(w,_,h,_),Q(h,_,h,c);const ne=new p.LngLat(p.lngFromMercatorX(N),p.latFromMercatorY(H)),K=new p.LngLat(p.lngFromMercatorX(F),p.latFromMercatorY(X));return new p.LngLatBounds(K,ne)}_getBounds(c,h){if("globe"===this.projection.name)return this._getGlobeBounds();const _=new p.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),w=new p.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),C=new p.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),I=new p.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let k=this.pointCoordinate(_,c),R=this.pointCoordinate(w,c);const F=this.pointCoordinate(C,h),N=this.pointCoordinate(I,h),H=(X,te)=>(te.y-X.y)/(te.x-X.x);return k.y>1&&R.y>=0?k=new p.MercatorCoordinate((1-N.y)/H(N,k)+N.x,1):k.y<0&&R.y<=1&&(k=new p.MercatorCoordinate(-N.y/H(N,k)+N.x,0)),R.y>1&&k.y>=0?R=new p.MercatorCoordinate((1-F.y)/H(F,R)+F.x,1):R.y<0&&k.y<=1&&(R=new p.MercatorCoordinate(-F.y/H(F,R)+F.x,0)),(new p.LngLatBounds).extend(this.coordinateLocation(k)).extend(this.coordinateLocation(R)).extend(this.coordinateLocation(N)).extend(this.coordinateLocation(F))}_getBounds3D(){const c=this.elevation;if(!c.visibleDemTiles.length||c.isUsingMockSource())return this._getBounds(0,0);const h=c.visibleDemTiles.reduce((_,w)=>{if(w.dem){const C=w.dem.tree;_.min=Math.min(_.min,C.minimums[0]),_.max=Math.max(_.max,C.maximums[0])}return _},{min:Number.MAX_VALUE,max:0});return this._getBounds(h.min*c.exaggeration(),h.max*c.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(c=!0){const h=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,_=this.height/2-h*(1-this._horizonShift);return c?Math.max(0,_):_}getMaxBounds(){return this.maxBounds}setMaxBounds(c){this.maxBounds=c,this.minLat=-p.MAX_MERCATOR_LATITUDE,this.maxLat=p.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,c&&(this.minLat=c.getSouth(),this.maxLat=c.getNorth(),this.minLng=c.getWest(),this.maxLng=c.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=p.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=p.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=p.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=p.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(c,h){return this.projection.createTileMatrix(this,h,c)}calculateDistanceTileData(c){const h=c.key,_=this._distanceTileDataCache;if(_[h])return _[h];const w=c.canonical,C=1/this.height,I=this.cameraWorldSize/this.zoomScale(w.z),k=(w.x+Math.pow(2,w.z)*c.wrap)*I,R=w.y*I,F=this.point,N=this.angle,H=Math.sin(-N),X=-Math.cos(-N);return _[h]={bearing:[H,X],center:[(F.x-k)*C,(F.y-R)*C],scale:I/p.EXTENT*C},_[h]}calculateFogTileMatrix(c){const h=c.key,_=this._fogTileMatrixCache;if(_[h])return _[h];const w=this.projection.createTileMatrix(this,this.cameraWorldSize,c);return p.multiply(w,this.worldToFogMatrix,w),_[h]=new Float32Array(w),_[h]}calculateProjMatrix(c,h=!1){const _=c.key,w=h?this._alignedProjMatrixCache:this._projMatrixCache;if(w[_])return w[_];const C=this.calculatePosMatrix(c,this.worldSize);return p.multiply(C,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:h?this.alignedProjMatrix:this.projMatrix,C),w[_]=new Float32Array(C),w[_]}calculatePixelsToTileUnitsMatrix(c){const h=c.tileID.key,_=this._pixelsToTileUnitsCache;if(_[h])return _[h];const w=function(C,I){const{scale:k}=C.tileTransform,R=k*p.EXTENT/(C.tileSize*Math.pow(2,I.zoom-C.tileID.overscaledZ+C.tileID.canonical.z));return F=new Float32Array(4),X=(N=I.inverseAdjustmentMatrix)[1],te=N[2],Q=N[3],K=(H=[R,R])[1],F[0]=N[0]*(ne=H[0]),F[1]=X*ne,F[2]=te*K,F[3]=Q*K,F;var F,N,H,X,te,Q,ne,K}(c,this);return _[h]=w,_[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const c=this._elevation;this._updateCameraState();const h=p.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(h),w=this._camera.forward(),C=p.mercatorZfromAltitude(1,this._center.lat);_[2]/=C,w[2]/=C,p.normalize(w,w);const I=c.raycast(_,w,c.exaggeration());if(I){const k=p.scaleAndAdd([],_,w,I),R=new p.MercatorCoordinate(k[0],k[1],p.mercatorZfromAltitude(k[2],p.latFromMercatorY(k[1]))),F=(R.z+p.length([R.x-_[0],R.y-_[1],R.z-_[2]*C]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(F),this._centerAltitude=R.toAltitude(),this._center=this.coordinateLocation(R),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const c=this._elevation;this._updateCameraState();const h=p.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(h),w=c.getAtPointOrZero(new p.MercatorCoordinate(..._)),C=this._minimumHeightOverTerrain()*Math.cos(p.degToRad(this._maxPitch)),I=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*w;if(I<C){const k=this.locationCoordinate(this._center,this._centerAltitude),R=[k.x-_[0],k.y-_[1],k.z-_[2]],F=p.length(R);R[2]-=(C-I)/this._pixelsPerMercatorPixel;const N=p.length(R);if(0===N)return;p.scale$2(R,R,F/N*this._pixelsPerMercatorPixel),this._camera.position=[k.x-R[0],k.y-R[1],k.z*this._pixelsPerMercatorPixel-R[2]],this._camera.orientation=id(R,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const c="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||c){const X=this.center;return X.lat=p.clamp(X.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!c)&&(X.lng=p.clamp(X.lng,this.minLng,this.maxLng)),this.center=X,void(this._constraining=!1)}const h=this._unmodified,{x:_,y:w}=this.point;let C=0,I=_,k=w;const R=this.width/2,F=this.height/2,N=this.worldMinY*this.scale,H=this.worldMaxY*this.scale;if(w-F<N&&(k=N+F),w+F>H&&(k=H-F),H-N<this.height&&(C=Math.max(C,this.height/(H-N)),k=(H+N)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const X=this.worldMinX*this.scale,te=this.worldMaxX*this.scale,Q=this.worldSize/2-(X+te)/2;I=(_+Q+this.worldSize)%this.worldSize-Q,I-R<X&&(I=X+R),I+R>te&&(I=te-R),te-X<this.width&&(C=Math.max(C,this.width/(te-X)),I=(te+X)/2)}I===_&&k===w||(this.center=this.unproject(new p.pointGeometry(I,k))),C&&(this.zoom+=this.scaleZoom(C)),this._constrainCameraAltitude(),this._unmodified=h,this._constraining=!1}_minZoomForBounds(){let c=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(c=Math.max(c,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),c}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const c=this.centerOffset,h=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=p.mercatorZfromAltitude(1,this.center.lat)/p.mercatorZfromAltitude(1,p.GLOBE_SCALE_MATCH_LATITUDE));const _=fu(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,_),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const w=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?h:1),C=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);C[8]=2*-c.x/this.width,C[9]=2*c.y/this.height;let I=p.mul([],C,w);if(this.projection.isReprojectedInTileSpace){const ve=this.locationCoordinate(this.center),he=p.identity([]);p.translate(he,he,[ve.x*this.worldSize,ve.y*this.worldSize,0]),p.multiply(he,he,bh(this)),p.translate(he,he,[-ve.x*this.worldSize,-ve.y*this.worldSize,0]),p.multiply(I,I,he),this.inverseAdjustmentMatrix=function(Ce){const He=bh(Ce,!0);return Ae([],[He[0],He[1],He[4],He[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=p.scale([],I,[this.worldSize,this.worldSize,this.worldSize/h,1]),this.projMatrix=I,this.invProjMatrix=p.invert(new Float64Array(16),this.projMatrix);const k=p.invert([],C);this.frustumCorners=p.FrustumCorners.fromInvProjectionMatrix(k,this.horizonLineFromTop(),this.height);const R=new Float32Array(16);p.identity(R),p.scale(R,R,[1,-1,1]),p.rotateX(R,R,this._pitch),p.rotateZ(R,R,this.angle);const F=p.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),N=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;F[8]=2*-c.x/this.width,F[9]=2*(c.y+N)/this.height,this.skyboxMatrix=p.multiply(R,F,R);const H=this.point,X=H.x,te=H.y,Q=this.width%2/2,ne=this.height%2/2,K=Math.cos(this.angle),Y=Math.sin(this.angle),se=X-Math.round(X)+K*Q+Y*ne,J=te-Math.round(te)+K*ne+Y*Q,_e=new Float64Array(I);if(p.translate(_e,_e,[se>.5?se-1:se,J>.5?J-1:J,0]),this.alignedProjMatrix=_e,I=p.create(),p.scale(I,I,[this.width/2,-this.height/2,1]),p.translate(I,I,[1,-1,0]),this.labelPlaneMatrix=I,I=p.create(),p.scale(I,I,[1,-1,1]),p.translate(I,I,[-1,-1,0]),p.scale(I,I,[2/this.width,2/this.height,1]),this.glCoordMatrix=I,this.pixelMatrix=p.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},I=p.invert(new Float64Array(16),this.pixelMatrix),!I)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=I,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=p.calculateGlobeMatrix(this);const ve=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=p.transformMat4(ve,ve,w),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=I;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const c=this.cameraWorldSize,h=this.cameraPixelsPerMeter,_=this._camera.position,w=1/this.height/this._pixelsPerMercatorPixel,C=[c,c,h];p.scale$2(C,C,w),p.scale$2(_,_,-1),p.multiply$2(_,_,C);const I=p.create();p.translate(I,I,_),p.scale(I,I,C),this.mercatorFogMatrix=I,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(c,h,w)}_computeCameraPosition(c){const h=(c=c||this.pixelsPerMeter)/this.pixelsPerMeter,_=this._camera.forward(),w=this.point,C=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*h-c/this.worldSize*this._centerAltitude;return[w.x/this.worldSize-_[0]*C,w.y/this.worldSize-_[1]*C,c/this.worldSize*this._centerAltitude-_[2]*C]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(c){const h=this._maxCameraBoundsDistance()*Math.cos(this._pitch),_=this._camera.position[2],w=c[2];let C=1;this.projection.wrap&&(this.center=this.center.wrap()),w>0&&(C=Math.min((h-_)/w,1)),this._camera.position=p.scaleAndAdd([],this._camera.position,c,C),this._updateStateFromCamera()}_updateStateFromCamera(){const c=this._camera.position,h=this._camera.forward(),{pitch:_,bearing:w}=this._camera.getPitchBearing(),C=p.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,I=this._mercatorZfromZoom(this._maxZoom)*Math.cos(p.degToRad(this._maxPitch)),k=Math.max((c[2]-C)/Math.cos(_),I),R=this._zoomFromMercatorZ(k);p.scaleAndAdd(c,c,h,k),this._pitch=p.clamp(_,p.degToRad(this.minPitch),p.degToRad(this.maxPitch)),this.angle=p.wrap(w,-Math.PI,Math.PI),this._setZoom(p.clamp(R,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new p.MercatorCoordinate(c[0],c[1],c[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(c){return Math.pow(2,c)*this.tileSize}_mercatorZfromZoom(c){return this.cameraToCenterDistance/this._worldSizeFromZoom(c)}_minimumHeightOverTerrain(){const c=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(c)}_zoomFromMercatorZ(c){return this.scaleZoom(this.cameraToCenterDistance/(c*this.tileSize))}zoomFromMercatorZAdjusted(c){const h=I=>{const k=this.getCameraToCenterDistance(this.projection,I);return this.scaleZoom(k/(c*this.tileSize))};let _,w=h(this.zoom),C=Math.abs(w-h(w));for(;_!==C;)w=h(w),_=C,C=Math.abs(w-h(w));return w}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(p.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(c,h){const _=Math.min(c.x,h.x),w=Math.max(c.x,h.x),C=Math.min(c.y,h.y),I=Math.max(c.y,h.y);if(C<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const k=[new p.pointGeometry(_,C),new p.pointGeometry(w,I),new p.pointGeometry(_,I),new p.pointGeometry(w,C)],R=this.renderWorldCopies?-3:0,F=this.renderWorldCopies?4:1;for(const N of k){const H=this.pointRayIntersection(N);if(H.t<0)return!0;const X=this.rayIntersectionCoordinate(H);if(X.x<R||X.y<0||X.x>F||X.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+p.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new p.pointGeometry(0,0),new p.pointGeometry(this.width,this.height))}zoomDeltaToMovement(c,h){const _=p.length(p.sub([],this._camera.position,c)),w=this._zoomFromMercatorZ(_)+h;return _-this._mercatorZfromZoom(w)}getCameraPoint(){if("globe"===this.projection.name){const c=function(h,_){const w=[h[0],h[1],h[2],1];p.transformMat4$1(w,w,_);const C=Math.max(w[3],1e-6);return[w[0]/C,w[1]/C,w[2]/C,C]}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new p.pointGeometry(c[0],c[1])}{const c=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new p.pointGeometry(0,c))}}getCameraToCenterDistance(c,h=this.zoom){const _=fu(c,h,this.width,this.height,1024),w=c.pixelSpaceConversion(this.center.lat,this.worldSize,_);return.5/Math.tan(.5*this._fov)*this.height*w}getWorldToCameraMatrix(){const c=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&p.multiply(c,c,this.globeMatrix),c}}function Fs(g,c){let h=!1,_=null;const w=()=>{_=null,h&&(g(),_=setTimeout(w,c),h=!1)};return()=>(h=!0,_||w(),_)}class yh{constructor(c){this._hashName=c&&encodeURIComponent(c),p.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Fs(this._updateHashUnthrottled.bind(this),300)}addTo(c){return this._map=c,p.window.addEventListener("hashchange",this._onHashChange,!1),c.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),p.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const c=this._map;if(!c)return"";const h=Wp(c);if(this._hashName){const _=this._hashName;let w=!1;const C=p.window.location.hash.slice(1).split("&").map(I=>{const k=I.split("=")[0];return k===_?(w=!0,`${k}=${h}`):I}).filter(I=>I);return w||C.push(`${_}=${h}`),`#${C.join("&")}`}return`#${h}`}_getCurrentHash(){const c=p.window.location.hash.replace("#","");if(this._hashName){let h;return c.split("&").map(_=>_.split("=")).forEach(_=>{_[0]===this._hashName&&(h=_)}),(h&&h[1]||"").split("/")}return c.split("/")}_onHashChange(){const c=this._map;if(!c)return!1;const h=this._getCurrentHash();if(h.length>=3&&!h.some(_=>isNaN(_))){const _=c.dragRotate.isEnabled()&&c.touchZoomRotate.isEnabled()?+(h[3]||0):c.getBearing();return c.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:_,pitch:+(h[4]||0)}),!0}return!1}_updateHashUnthrottled(){const c=p.window.location.href.replace(/(#.+)?$/,this.getHashString());p.window.history.replaceState(p.window.history.state,null,c)}}function Wp(g,c){const h=g.getCenter(),_=Math.round(100*g.getZoom())/100,w=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),C=Math.pow(10,w),I=Math.round(h.lng*C)/C,k=Math.round(h.lat*C)/C,R=g.getBearing(),F=g.getPitch();let N=c?`/${I}/${k}/${_}`:`${_}/${k}/${I}`;return(R||F)&&(N+="/"+Math.round(10*R)/10),F&&(N+=`/${Math.round(F)}`),N}const Pa={linearity:.3,easing:p.bezier(0,0,.3,1)},Im=p.extend({deceleration:2500,maxSpeed:1400},Pa),Xp=p.extend({deceleration:20,maxSpeed:1400},Pa),to=p.extend({deceleration:1e3,maxSpeed:360},Pa),vh=p.extend({deceleration:1e3,maxSpeed:90},Pa);class yb{constructor(c){this._map=c,this.clear()}clear(){this._inertiaBuffer=[]}record(c){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:p.exported.now(),settings:c})}_drainInertiaBuffer(){const c=this._inertiaBuffer,h=p.exported.now();for(;c.length>0&&h-c[0].time>160;)c.shift()}_onMoveEnd(c){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,pan:new p.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:C}of this._inertiaBuffer)h.zoom+=C.zoomDelta||0,h.bearing+=C.bearingDelta||0,h.pitch+=C.pitchDelta||0,C.panDelta&&h.pan._add(C.panDelta),C.around&&(h.around=C.around),C.pinchAround&&(h.pinchAround=C.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,w={};if(h.pan.mag()){const C=wo(h.pan.mag(),_,p.extend({},Im,c||{}));w.offset=h.pan.mult(C.amount/h.pan.mag()),w.center=this._map.transform.center,Jl(w,C)}if(h.zoom){const C=wo(h.zoom,_,Xp);w.zoom=this._map.transform.zoom+C.amount,Jl(w,C)}if(h.bearing){const C=wo(h.bearing,_,to);w.bearing=this._map.transform.bearing+p.clamp(C.amount,-179,179),Jl(w,C)}if(h.pitch){const C=wo(h.pitch,_,vh);w.pitch=this._map.transform.pitch+C.amount,Jl(w,C)}if(w.zoom||w.bearing){const C=void 0===h.pinchAround?h.around:h.pinchAround;w.around=C?this._map.unproject(C):this._map.getCenter()}return this.clear(),w.noMoveStart=!0,w}}function Jl(g,c){(!g.duration||g.duration<c.duration)&&(g.duration=c.duration,g.easing=c.easing)}function wo(g,c,h){const{maxSpeed:_,linearity:w,deceleration:C}=h,I=p.clamp(g*w/(c/1e3),-_,_),k=Math.abs(I)/(C*w);return{easing:h.easing,duration:1e3*k,amount:I*(k/2)}}class Xs extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,h,_,w={}){const C=mt(h.getCanvasContainer(),_),I=h.unproject(C);super(c,p.extend({point:C,lngLat:I,originalEvent:_},w)),this._defaultPrevented=!1,this.target=h}}class mu extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,h,_){const w="touchend"===c?_.changedTouches:_.touches,C=gi(h.getCanvasContainer(),w),I=C.map(R=>h.unproject(R)),k=C.reduce((R,F,N,H)=>R.add(F.div(H.length)),new p.pointGeometry(0,0));super(c,{points:C,point:k,lngLats:I,lngLat:h.unproject(k),originalEvent:_}),this._defaultPrevented=!1}}class Ec extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,h,_){super(c,{originalEvent:_}),this._defaultPrevented=!1}}class as{constructor(c,h){this._map=c,this._clickTolerance=h.clickTolerance}reset(){this._mousedownPos=void 0}wheel(c){return this._firePreventable(new Ec(c.type,this._map,c))}mousedown(c,h){return this._mousedownPos=h,this._firePreventable(new Xs(c.type,this._map,c))}mouseup(c){this._map.fire(new Xs(c.type,this._map,c))}preclick(c){const h=p.extend({},c);h.type="preclick",this._map.fire(new Xs(h.type,this._map,h))}click(c,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||(this.preclick(c),this._map.fire(new Xs(c.type,this._map,c)))}dblclick(c){return this._firePreventable(new Xs(c.type,this._map,c))}mouseover(c){this._map.fire(new Xs(c.type,this._map,c))}mouseout(c){this._map.fire(new Xs(c.type,this._map,c))}touchstart(c){return this._firePreventable(new mu(c.type,this._map,c))}touchmove(c){this._map.fire(new mu(c.type,this._map,c))}touchend(c){this._map.fire(new mu(c.type,this._map,c))}touchcancel(c){this._map.fire(new mu(c.type,this._map,c))}_firePreventable(c){if(this._map.fire(c),c.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class xh{constructor(c){this._map=c}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(c){this._map.fire(new Xs(c.type,this._map,c))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Xs("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(c){this._delayContextMenu?this._contextMenuEvent=c:this._map.fire(new Xs(c.type,this._map,c)),this._map.listens("contextmenu")&&c.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class wh{constructor(c,h){this._map=c,this._el=c.getCanvasContainer(),this._container=c.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(c,h){this.isEnabled()&&c.shiftKey&&0===c.button&&($t(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(c,h){if(!this._active)return;const _=h,w=this._startPos,C=this._lastPos;if(!w||!C||C.equals(_)||!this._box&&_.dist(w)<this._clickTolerance)return;this._lastPos=_,this._box||(this._box=Ye("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",c));const I=Math.min(w.x,_.x),k=Math.max(w.x,_.x),R=Math.min(w.y,_.y),F=Math.max(w.y,_.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${I}px,${R}px)`,this._box.style.width=k-I+"px",this._box.style.height=F-R+"px")})}mouseupWindow(c,h){if(!this._active)return;const _=this._startPos,w=h;if(_&&0===c.button){if(this.reset(),jn(),_.x!==w.x||_.y!==w.y)return this._map.fire(new p.Event("boxzoomend",{originalEvent:c})),{cameraAnimation:C=>C.fitScreenCoordinates(_,w,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",c)}}keydown(c){this._active&&27===c.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",c))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),dn(),delete this._startPos,delete this._lastPos}_fireEvent(c,h){return this._map.fire(new p.Event(c,{originalEvent:h}))}}function Sh(g,c){const h={};for(let _=0;_<g.length;_++)h[g[_].identifier]=c[_];return h}class Oa{constructor(c){this.reset(),this.numTouches=c.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(c,h,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=c.timeStamp),_.length===this.numTouches&&(this.centroid=function(w){const C=new p.pointGeometry(0,0);for(const I of w)C._add(I);return C.div(w.length)}(h),this.touches=Sh(_,h)))}touchmove(c,h,_){if(this.aborted||!this.centroid)return;const w=Sh(_,h);for(const C in this.touches){const I=this.touches[C],k=w[C];(!k||k.dist(I)>30)&&(this.aborted=!0)}}touchend(c,h,_){if((!this.centroid||c.timeStamp-this.startTime>500)&&(this.aborted=!0),0===_.length){const w=!this.aborted&&this.centroid;if(this.reset(),w)return w}}}class gu{constructor(c){this.singleTap=new Oa(c),this.numTaps=c.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(c,h,_){this.singleTap.touchstart(c,h,_)}touchmove(c,h,_){this.singleTap.touchmove(c,h,_)}touchend(c,h,_){const w=this.singleTap.touchend(c,h,_);if(w){const C=c.timeStamp-this.lastTime<500,I=!this.lastTap||this.lastTap.dist(w)<30;if(C&&I||this.reset(),this.count++,this.lastTime=c.timeStamp,this.lastTap=w,this.count===this.numTaps)return this.reset(),w}}}class Ch{constructor(){this._zoomIn=new gu({numTouches:1,numTaps:2}),this._zoomOut=new gu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(c,h,_){this._zoomIn.touchstart(c,h,_),this._zoomOut.touchstart(c,h,_)}touchmove(c,h,_){this._zoomIn.touchmove(c,h,_),this._zoomOut.touchmove(c,h,_)}touchend(c,h,_){const w=this._zoomIn.touchend(c,h,_),C=this._zoomOut.touchend(c,h,_);return w?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:I.getZoom()+1,around:I.unproject(w)},{originalEvent:c})}):C?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:I.getZoom()-1,around:I.unproject(C)},{originalEvent:c})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Ci={0:1,2:2};class od{constructor(c){this.reset(),this._clickTolerance=c.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(c,h){return!1}_move(c,h){return{}}mousedown(c,h){if(this._lastPoint)return;const _=Ie(c);this._correctButton(c,_)&&(this._lastPoint=h,this._eventButton=_)}mousemoveWindow(c,h){const _=this._lastPoint;if(_)if(c.preventDefault(),null!=this._eventButton&&function(w,C){const I=Ci[C];return void 0===w.buttons||(w.buttons&I)!==I}(c,this._eventButton))this.reset();else if(this._moved||!(h.dist(_)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(_,h)}mouseupWindow(c){this._lastPoint&&Ie(c)===this._eventButton&&(this._moved&&jn(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vb extends od{mousedown(c,h){super.mousedown(c,h),this._lastPoint&&(this._active=!0)}_correctButton(c,h){return 0===h&&!c.ctrlKey}_move(c,h){return{around:h,panDelta:h.sub(c)}}}class Zp extends od{_correctButton(c,h){return 0===h&&c.ctrlKey||2===h}_move(c,h){const _=.8*(h.x-c.x);if(_)return this._active=!0,{bearingDelta:_}}contextmenu(c){c.preventDefault()}}class Ic extends od{_correctButton(c,h){return 0===h&&c.ctrlKey||2===h}_move(c,h){const _=-.5*(h.y-c.y);if(_)return this._active=!0,{pitchDelta:_}}contextmenu(c){c.preventDefault()}}class Mm{constructor(c,h){this._map=c,this._el=c.getCanvasContainer(),this._minTouches=1,this._clickTolerance=h.clickTolerance||1,this.reset(),p.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new p.pointGeometry(0,0)}touchstart(c,h,_){return this._calculateTransform(c,h,_)}touchmove(c,h,_){if(this._active&&!(_.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===_.length&&!p.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return c.cancelable&&c.preventDefault(),this._calculateTransform(c,h,_)}}touchend(c,h,_){this._calculateTransform(c,h,_),this._active&&_.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(c,h,_){_.length>0&&(this._active=!0);const w=Sh(_,h),C=new p.pointGeometry(0,0),I=new p.pointGeometry(0,0);let k=0;for(const F in w){const N=w[F],H=this._touches[F];H&&(C._add(N),I._add(N.sub(H)),k++,w[F]=N)}if(this._touches=w,k<this._minTouches||!I.mag())return;const R=I.div(k);return this._sum._add(R),this._sum.mag()<this._clickTolerance?void 0:{around:C.div(k),panDelta:R}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ye("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class sd{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(c){}_move(c,h,_){return{}}touchstart(c,h,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([h[0],h[1]]))}touchmove(c,h,_){const w=this._firstTwoTouches;if(!w)return;c.preventDefault();const[C,I]=w,k=ad(_,h,C),R=ad(_,h,I);if(!k||!R)return;const F=this._aroundCenter?null:k.add(R).div(2);return this._move([k,R],F,c)}touchend(c,h,_){if(!this._firstTwoTouches)return;const[w,C]=this._firstTwoTouches,I=ad(_,h,w),k=ad(_,h,C);I&&k||(this._active&&jn(),this.reset())}touchcancel(){this.reset()}enable(c){this._enabled=!0,this._aroundCenter=!!c&&"center"===c.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function ad(g,c,h){for(let _=0;_<g.length;_++)if(g[_].identifier===h)return c[_]}function Yp(g,c){return Math.log(g/c)/Math.LN2}class Ot extends sd{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(c){this._startDistance=this._distance=c[0].dist(c[1])}_move(c,h){const _=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(Yp(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Yp(this._distance,_),pinchAround:h}}}function ji(g,c){return 180*g.angleWith(c)/Math.PI}class Wi extends sd{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])}_move(c,h){const _=this._vector;if(this._vector=c[0].sub(c[1]),_&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:ji(this._vector,_),pinchAround:h}}_isBelowThreshold(c){this._minDiameter=Math.min(this._minDiameter,c.mag());const h=25/(Math.PI*this._minDiameter)*360,_=this._startVector;if(!_)return!1;const w=ji(c,_);return Math.abs(w)<h}}function no(g){return Math.abs(g.y)>Math.abs(g.x)}class So extends sd{constructor(c){super(),this._map=c}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(c){this._lastPoints=c,no(c[0].sub(c[1]))&&(this._valid=!1)}_move(c,h,_){const w=this._lastPoints;if(!w)return;const C=c[0].sub(w[0]),I=c[1].sub(w[1]);return this._map._cooperativeGestures&&!p.isFullscreen()&&_.touches.length<3||(this._valid=this.gestureBeginsVertically(C,I,_.timeStamp),!this._valid)?void 0:(this._lastPoints=c,this._active=!0,{pitchDelta:(C.y+I.y)/2*-.5})}gestureBeginsVertically(c,h,_){if(void 0!==this._valid)return this._valid;const w=c.mag()>=2,C=h.mag()>=2;if(!w&&!C)return;if(!w||!C)return null==this._firstMove&&(this._firstMove=_),_-this._firstMove<100&&void 0;const I=c.y>0==h.y>0;return no(c)&&no(h)&&I}}const Am={panStep:100,bearingStep:15,pitchStep:10};class ld{constructor(){const c=Am;this._panStep=c.panStep,this._bearingStep=c.bearingStep,this._pitchStep=c.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(c){if(c.altKey||c.ctrlKey||c.metaKey)return;let h=0,_=0,w=0,C=0,I=0;switch(c.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:c.shiftKey?_=-1:(c.preventDefault(),C=-1);break;case 39:c.shiftKey?_=1:(c.preventDefault(),C=1);break;case 38:c.shiftKey?w=1:(c.preventDefault(),I=-1);break;case 40:c.shiftKey?w=-1:(c.preventDefault(),I=1);break;default:return}return this._rotationDisabled&&(_=0,w=0),{cameraAnimation:k=>{const R=k.getZoom();k.easeTo({duration:300,easeId:"keyboardHandler",easing:Fo,zoom:h?Math.round(R)+h*(c.shiftKey?2:1):R,bearing:k.getBearing()+_*this._bearingStep,pitch:k.getPitch()+w*this._pitchStep,offset:[-C*this._panStep,-I*this._panStep],center:k.getCenter()},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Fo(g){return g*(2-g)}const cd=4.000244140625;class ec{constructor(c,h){this._map=c,this._el=c.getCanvasContainer(),this._handler=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,p.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(c){this._defaultZoomRate=c}setWheelZoomRate(c){this._wheelZoomRate=c}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(c){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!c&&"center"===c.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(c){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(c.ctrlKey||c.metaKey||this.isZooming()||p.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let h=c.deltaMode===p.window.WheelEvent.DOM_DELTA_LINE?40*c.deltaY:c.deltaY;const _=p.exported.now(),w=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,0!==h&&h%cd==0?this._type="wheel":0!==h&&Math.abs(h)<4?this._type="trackpad":w>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,c)):this._type||(this._type=Math.abs(w*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),c.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=c,this._delta-=h,this._active||this._start(c)),c.preventDefault()}_onTimeout(c){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)}_start(c){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=mt(this._el,c);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:h,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const c=this._map.transform;"wheel"===this._type&&c.projection.wrap&&(c._center.lng>=180||c._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const h=()=>c._terrainEnabled()&&this._aroundCoord?c.computeZoomRelativeTo(this._aroundCoord):c.zoom;if(0!==this._delta){const R="wheel"===this._type&&Math.abs(this._delta)>cd?this._wheelZoomRate:this._defaultZoomRate;let F=2/(1+Math.exp(-Math.abs(this._delta*R)));this._delta<0&&0!==F&&(F=1/F);const N=h(),H=Math.pow(2,N),X="number"==typeof this._targetZoom?c.zoomScale(this._targetZoom):H;this._targetZoom=Math.min(c.maxZoom,Math.max(c.minZoom,c.scaleZoom(X*F))),"wheel"===this._type&&(this._startZoom=N,this._easing=this._smoothOutEasing(200)),this._delta=0}const _="number"==typeof this._targetZoom?this._targetZoom:h(),w=this._startZoom,C=this._easing;let I,k=!1;if("wheel"===this._type&&w&&C){const R=Math.min((p.exported.now()-this._lastWheelEventTime)/200,1),F=C(R);I=p.number(w,_,F),R<1?this._frameId||(this._frameId=!0):k=!0}else I=_,k=!0;return this._active=!0,k&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!k,zoomDelta:I-h(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(c){let h=p.ease;if(this._prevEase){const _=this._prevEase,w=(p.exported.now()-_.start)/_.duration,C=_.easing(w+.01)-_.easing(w),I=.27/Math.sqrt(C*C+1e-4)*.01,k=Math.sqrt(.0729-I*I);h=p.bezier(I,k,.25,1)}return this._prevEase={start:p.exported.now(),duration:c,easing:h},h}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ye("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(p.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class Dl{constructor(c,h){this._clickZoom=c,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Th{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(c,h){return c.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:_.getZoom()+(c.shiftKey?-1:1),around:_.unproject(h)},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class tn{constructor(){this._tap=new gu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(c,h,_){this._swipePoint||(this._tapTime&&c.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?_.length>0&&(this._swipePoint=h[0],this._swipeTouch=_[0].identifier):this._tap.touchstart(c,h,_))}touchmove(c,h,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const w=h[0],C=w.y-this._swipePoint.y;return this._swipePoint=w,c.preventDefault(),this._active=!0,{zoomDelta:C/128}}}else this._tap.touchmove(c,h,_)}touchend(c,h,_){this._tapTime?this._swipePoint&&0===_.length&&this.reset():this._tap.touchend(c,h,_)&&(this._tapTime=c.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ud{constructor(c,h,_){this._el=c,this._mousePan=h,this._touchPan=_}enable(c){this._inertiaOptions=c||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ls{constructor(c,h,_){this._pitchWithRotate=c.pitchWithRotate,this._mouseRotate=h,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Zs{constructor(c,h,_,w){this._el=c,this._touchZoom=h,this._touchRotate=_,this._tapDragZoom=w,this._rotationDisabled=!1,this._enabled=!0}enable(c){this._touchZoom.enable(c),this._rotationDisabled||this._touchRotate.enable(c),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const El=g=>g.zoom||g.drag||g.pitch||g.rotate;class Mc extends p.Event{}class rl{constructor(){this.constants=[1,1,.01],this.radius=0}setup(c,h){const _=p.sub([],h,c);this.radius=p.length(_[2]<0?p.div([],_,this.constants):[_[0],_[1],0])}projectRay(c){p.div(c,c,this.constants),p.normalize(c,c),p.mul$1(c,c,this.constants);const h=p.scale$2([],c,this.radius);if(h[2]>0){const _=p.scale$2([],[0,0,1],p.dot(h,[0,0,1])),w=p.scale$2([],p.normalize([],[h[0],h[1],0]),this.radius),C=p.add([],h,p.scale$2([],p.sub([],p.add([],w,_),h),2));h[0]=C[0],h[1]=C[1]}return h}}function dd(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta}class Qp{constructor(c,h){this._map=c,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new yb(c),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new rl,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(h),p.bindAll(["handleEvent","handleWindowEvent"],this);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[p.window.document,"mousemove",{capture:!0}],[p.window.document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[p.window,"blur",void 0]];for(const[w,C,I]of this._listeners)w.addEventListener(C,w===p.window.document?this.handleWindowEvent:this.handleEvent,I)}destroy(){for(const[c,h,_]of this._listeners)c.removeEventListener(h,c===p.window.document?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(c){const h=this._map,_=h.getCanvasContainer();this._add("mapEvent",new as(h,c));const w=h.boxZoom=new wh(h,c);this._add("boxZoom",w);const C=new Ch,I=new Th;h.doubleClickZoom=new Dl(I,C),this._add("tapZoom",C),this._add("clickZoom",I);const k=new tn;this._add("tapDragZoom",k);const R=h.touchPitch=new So(h);this._add("touchPitch",R);const F=new Zp(c),N=new Ic(c);h.dragRotate=new ls(c,F,N),this._add("mouseRotate",F,["mousePitch"]),this._add("mousePitch",N,["mouseRotate"]);const H=new vb(c),X=new Mm(h,c);h.dragPan=new ud(_,H,X),this._add("mousePan",H),this._add("touchPan",X,["touchZoom","touchRotate"]);const te=new Wi,Q=new Ot;h.touchZoomRotate=new Zs(_,Q,te,k),this._add("touchRotate",te,["touchPan","touchZoom"]),this._add("touchZoom",Q,["touchPan","touchRotate"]),this._add("blockableMapEvent",new xh(h));const ne=h.scrollZoom=new ec(h,this);this._add("scrollZoom",ne,["mousePan"]);const K=h.keyboard=new ld;this._add("keyboard",K);for(const Y of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])c.interactive&&c[Y]&&h[Y].enable(c[Y])}_add(c,h,_){this._handlers.push({handlerName:c,handler:h,allowed:_}),this._handlersById[c]=h}stop(c){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},c),this._changes=[]}}isActive(){for(const{handler:c}of this._handlers)if(c.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!El(this._eventsInProgress)||this.isZooming()}_blockedByActive(c,h,_){for(const w in c)if(w!==_&&(!h||h.indexOf(w)<0))return!0;return!1}handleWindowEvent(c){this.handleEvent(c,`${c.type}Window`)}_getMapTouches(c){const h=[];for(const _ of c)this._el.contains(_.target)&&h.push(_);return h}handleEvent(c,h){this._updatingCamera=!0;const _="renderFrame"===c.type,w=_?void 0:c,C={needsRenderFrame:!1},I={},k={},R=c.touches?this._getMapTouches(c.touches):void 0,F=R?gi(this._el,R):_?void 0:mt(this._el,c);for(const{handlerName:X,handler:te,allowed:Q}of this._handlers){if(!te.isEnabled())continue;let ne;this._blockedByActive(k,Q,X)?te.reset():te[h||c.type]&&(ne=te[h||c.type](c,F,R),this.mergeHandlerResult(C,I,ne,X,w),ne&&ne.needsRenderFrame&&this._triggerRenderFrame()),(ne||te.isActive())&&(k[X]=te)}const N={};for(const X in this._previousActiveHandlers)k[X]||(N[X]=w);this._previousActiveHandlers=k,(Object.keys(N).length||dd(C))&&(this._changes.push([C,I,N]),this._triggerRenderFrame()),(Object.keys(k).length||dd(C))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:H}=C;H&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],H(this._map))}mergeHandlerResult(c,h,_,w,C){if(!_)return;p.extend(c,_);const I={handlerName:w,originalEvent:_.originalEvent||C};void 0!==_.zoomDelta&&(h.zoom=I),void 0!==_.panDelta&&(h.drag=I),void 0!==_.pitchDelta&&(h.pitch=I),void 0!==_.bearingDelta&&(h.rotate=I)}_applyChanges(){const c={},h={},_={};for(const[w,C,I]of this._changes)w.panDelta&&(c.panDelta=(c.panDelta||new p.pointGeometry(0,0))._add(w.panDelta)),w.zoomDelta&&(c.zoomDelta=(c.zoomDelta||0)+w.zoomDelta),w.bearingDelta&&(c.bearingDelta=(c.bearingDelta||0)+w.bearingDelta),w.pitchDelta&&(c.pitchDelta=(c.pitchDelta||0)+w.pitchDelta),void 0!==w.around&&(c.around=w.around),void 0!==w.aroundCoord&&(c.aroundCoord=w.aroundCoord),void 0!==w.pinchAround&&(c.pinchAround=w.pinchAround),w.noInertia&&(c.noInertia=w.noInertia),p.extend(h,C),p.extend(_,I);this._updateMapTransform(c,h,_),this._changes=[]}_updateMapTransform(c,h,_){const w=this._map,C=w.transform,I=se=>[se.x,se.y,se.z];if((se=>{const J=this._eventsInProgress.drag;return J&&!this._handlersById[J.handlerName].isActive()})()&&!dd(c)){const se=C.zoom;C.cameraElevationReference="sea",C.recenterOnTerrain(),C.cameraElevationReference="ground",se!==C.zoom&&this._map._update(!0)}if(!dd(c))return void this._fireEvents(h,_,!0);let{panDelta:k,zoomDelta:R,bearingDelta:F,pitchDelta:N,around:H,aroundCoord:X,pinchAround:te}=c;void 0!==te&&(H=te),(se=>h.drag&&!this._eventsInProgress.drag)()&&H&&(this._dragOrigin=I(C.pointCoordinate3D(H)),this._trackingEllipsoid.setup(C._camera.position,this._dragOrigin)),C.cameraElevationReference="sea",w._stop(!0),H=H||w.transform.centerPoint,F&&(C.bearing+=F),N&&(C.pitch+=N),C._updateCameraState();const Q=[0,0,0];if(k)if("mercator"===C.projection.name){const se=this._trackingEllipsoid.projectRay(C.screenPointToMercatorRay(H).dir),J=this._trackingEllipsoid.projectRay(C.screenPointToMercatorRay(H.sub(k)).dir);Q[0]=J[0]-se[0],Q[1]=J[1]-se[1]}else{const se=C.pointCoordinate(H);if("globe"===C.projection.name){k=k.rotate(-C.angle);const J=C._pixelsPerMercatorPixel/C.worldSize;Q[0]=-k.x*p.mercatorScale(p.latFromMercatorY(se.y))*J,Q[1]=-k.y*p.mercatorScale(C.center.lat)*J}else{const J=C.pointCoordinate(H.sub(k));se&&J&&(Q[0]=J.x-se.x,Q[1]=J.y-se.y)}}const ne=C.zoom,K=[0,0,0];if(R){const se=I(X||C.pointCoordinate3D(H)),J={dir:p.normalize([],p.sub([],se,C._camera.position))};if(J.dir[2]<0){const _e=C.zoomDeltaToMovement(se,R);p.scale$2(K,J.dir,_e)}}const Y=p.add(Q,Q,K);C._translateCameraConstrained(Y),R&&Math.abs(C.zoom-ne)>1e-4&&C.recenterOnTerrain(),C.cameraElevationReference="ground",this._map._update(),c.noInertia||this._inertia.record(c),this._fireEvents(h,_,!0)}_fireEvents(c,h,_){const w=El(this._eventsInProgress),C=El(c),I={};for(const N in c){const{originalEvent:H}=c[N];this._eventsInProgress[N]||(I[`${N}start`]=H),this._eventsInProgress[N]=c[N]}!w&&C&&this._fireEvent("movestart",C.originalEvent);for(const N in I)this._fireEvent(N,I[N]);C&&this._fireEvent("move",C.originalEvent);for(const N in c){const{originalEvent:H}=c[N];this._fireEvent(N,H)}const k={};let R;for(const N in this._eventsInProgress){const{handlerName:H,originalEvent:X}=this._eventsInProgress[N];this._handlersById[H].isActive()||(delete this._eventsInProgress[N],R=h[H]||X,k[`${N}end`]=R)}for(const N in k)this._fireEvent(N,k[N]);const F=El(this._eventsInProgress);if(_&&(w||C)&&!F){this._updatingCamera=!0;const N=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),H=X=>0!==X&&-this._bearingSnap<X&&X<this._bearingSnap;N?(H(N.bearing||this._map.getBearing())&&(N.bearing=0),this._map.easeTo(N,{originalEvent:R})):(this._map.fire(new p.Event("moveend",{originalEvent:R})),H(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(c,h){this._map.fire(new p.Event(c,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(c=>{this._frameId=void 0,this.handleEvent(new Mc("renderFrame",{timeStamp:c})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Kp="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class km extends p.Evented{constructor(c,h){super(),this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=h.bearingSnap,p.bindAll(["_renderFrameCallback"],this)}getCenter(){return new p.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(c,h){return this.jumpTo({center:c},h)}panBy(c,h,_){return c=p.pointGeometry.convert(c).mult(-1),this.panTo(this.transform.center,p.extend({offset:c},h),_)}panTo(c,h,_){return this.easeTo(p.extend({center:c},h),_)}getZoom(){return this.transform.zoom}setZoom(c,h){return this.jumpTo({zoom:c},h),this}zoomTo(c,h,_){return this.easeTo(p.extend({zoom:c},h),_)}zoomIn(c,h){return this.zoomTo(this.getZoom()+1,c,h),this}zoomOut(c,h){return this.zoomTo(this.getZoom()-1,c,h),this}getBearing(){return this.transform.bearing}setBearing(c,h){return this.jumpTo({bearing:c},h),this}getPadding(){return this.transform.padding}setPadding(c,h){return this.jumpTo({padding:c},h),this}rotateTo(c,h,_){return this.easeTo(p.extend({bearing:c},h),_)}resetNorth(c,h){return this.rotateTo(0,p.extend({duration:1e3},c),h),this}resetNorthPitch(c,h){return this.easeTo(p.extend({bearing:0,pitch:0,duration:1e3},c),h),this}snapToNorth(c,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,h):this}getPitch(){return this.transform.pitch}setPitch(c,h){return this.jumpTo({pitch:c},h),this}cameraForBounds(c,h){c=p.LngLatBounds.convert(c);const _=h&&h.bearing||0,w=c.getNorthWest(),C=c.getSouthEast();return this._cameraForBounds(this.transform,w,C,_,h)}_extendCameraOptions(c){const h={top:0,bottom:0,right:0,left:0};if("number"==typeof(c=p.extend({padding:h,offset:[0,0],maxZoom:this.transform.maxZoom},c)).padding){const _=c.padding;c.padding={top:_,bottom:_,right:_,left:_}}return c.padding=p.extend(h,c.padding),c}_minimumAABBFrustumDistance(c,h){const _=h.max[0]-h.min[0],w=h.max[1]-h.min[1];return _/w>c.aspect?_/(2*Math.tan(.5*c.fovX)*c.aspect):w/(2*Math.tan(.5*c.fovY)*c.aspect)}_cameraForBoundsOnGlobe(c,h,_,w,C){const I=c.clone(),k=this._extendCameraOptions(C);I.bearing=w;const R=p.LngLat.convert(h),F=p.LngLat.convert(_),N=.5*(R.lat+F.lat),H=.5*(R.lng+F.lng),X=p.latLngToECEF(N,H),te=p.normalize([],X),Q=p.normalize([],p.cross([],te,[0,1,0])),ne=p.cross([],Q,te),K=[Q[0],Q[1],Q[2],0,ne[0],ne[1],ne[2],0,te[0],te[1],te[2],0,0,0,0,1],Y=[X,p.latLngToECEF(R.lat,R.lng),p.latLngToECEF(F.lat,R.lng),p.latLngToECEF(F.lat,F.lng),p.latLngToECEF(R.lat,F.lng),p.latLngToECEF(N,R.lng),p.latLngToECEF(N,F.lng),p.latLngToECEF(R.lat,H),p.latLngToECEF(F.lat,H)];let se=p.Aabb.fromPoints(Y.map(It=>[p.dot(Q,It),p.dot(ne,It),p.dot(te,It)]));const J=p.transformMat4([],se.center,K);0===p.squaredLength(J)&&p.set(J,0,0,1),p.normalize(J,J),p.scale$2(J,J,p.GLOBE_RADIUS),I.center=p.ecefToLatLng(J);const _e=I.getWorldToCameraMatrix(),ve=p.invert(new Float64Array(16),_e);se=p.Aabb.applyTransform(se,p.multiply([],_e,K)),p.transformMat4(J,J,_e);const he=.5*(se.max[2]-se.min[2]),Ce=this._minimumAABBFrustumDistance(I,se),He=p.scale$2([],[0,0,1],he),it=p.add(He,J,He),Qe=Ce+(0===I.pitch?0:p.distance(J,it)),wt=I.globeCenterInViewSpace,Le=p.sub([],J,[wt[0],wt[1],wt[2]]);p.normalize(Le,Le),p.scale$2(Le,Le,Qe);const ft=p.add([],J,Le);p.transformMat4(ft,ft,ve);const gt=p.earthRadius/p.GLOBE_RADIUS,qe=p.length(ft),Me=p.mercatorZfromAltitude(qe*gt-p.earthRadius,0),Gt=Math.min(I.zoomFromMercatorZAdjusted(Me),k.maxZoom);return Gt>.5*(p.GLOBE_ZOOM_THRESHOLD_MIN+p.GLOBE_ZOOM_THRESHOLD_MAX)?(I.setProjection({name:"mercator"}),I.zoom=Gt,this._cameraForBounds(I,h,_,w,C)):{center:I.center,zoom:Gt,bearing:w}}queryTerrainElevation(c,h){const _=this.transform.elevation;return _?(h=p.extend({},{exaggerated:!0},h),_.getAtPoint(p.MercatorCoordinate.fromLngLat(c),null,h.exaggerated)):null}_cameraForBounds(c,h,_,w,C){if("globe"===c.projection.name)return this._cameraForBoundsOnGlobe(c,h,_,w,C);const I=c.clone(),k=this._extendCameraOptions(C),R=I.padding;I.bearing=w;const F=p.LngLat.convert(h),N=p.LngLat.convert(_),H=new p.LngLat(F.lng,N.lat),X=new p.LngLat(N.lng,F.lat),te=I.project(F),Q=I.project(N),ne=this.queryTerrainElevation(F),K=this.queryTerrainElevation(N),Y=this.queryTerrainElevation(H),se=this.queryTerrainElevation(X),J=[[te.x,te.y,Math.min(ne||0,K||0,Y||0,se||0)],[Q.x,Q.y,Math.max(ne||0,K||0,Y||0,se||0)]];let _e=p.Aabb.fromPoints(J);const ve=I.getWorldToCameraMatrix(),he=p.invert(new Float64Array(16),ve);_e=p.Aabb.applyTransform(_e,ve);const Ce=p.sub([],_e.max,_e.min),He=R.left||0,it=R.right||0,Qe=R.bottom||0,wt=R.top||0,{left:Le,right:ft,top:gt,bottom:qe}=k.padding,Me=.5*(He+it),Gt=.5*(wt+Qe),It=Math.min(I.scaleZoom(I.scale*Math.min((I.width-(He+it+Le+ft))/Ce[0],(I.height-(Qe+wt+qe+gt))/Ce[1])),k.maxZoom),jt=I.scale/I.zoomScale(It);_e=new p.Aabb([_e.min[0]-(Le+Me)*jt,_e.min[1]-(qe+Gt)*jt,_e.min[2]],[_e.max[0]+(ft+Me)*jt,_e.max[1]+(gt+Gt)*jt,_e.max[2]]);const Lt=.5*Ce[2],bn=this._minimumAABBFrustumDistance(I,_e),Gn=[0,0,1,0];p.transformMat4$1(Gn,Gn,ve),p.normalize$2(Gn,Gn);const Rn=p.scale$2([],Gn,bn+Lt),yn=p.add([],_e.center,Rn),Nt=("number"==typeof k.offset.x&&"number"==typeof k.offset.y?new p.pointGeometry(k.offset.x,k.offset.y):p.pointGeometry.convert(k.offset)).rotate(-p.degToRad(w));_e.center[0]-=Nt.x*jt,_e.center[1]+=Nt.y*jt,p.transformMat4(_e.center,_e.center,he),p.transformMat4(yn,yn,he);const Jn=[_e.center[0],_e.center[1],yn[2]*I.pixelsPerMeter];p.scale$2(Jn,Jn,1/I.worldSize);const bi=p.lngFromMercatorX(Jn[0]),hr=p.latFromMercatorY(Jn[1]),pr=Math.min(I._zoomFromMercatorZ(Jn[2]),k.maxZoom),or=new p.LngLat(bi,hr);return I.mercatorFromTransition&&pr<.5*(p.GLOBE_ZOOM_THRESHOLD_MIN+p.GLOBE_ZOOM_THRESHOLD_MAX)?(I.setProjection({name:"globe"}),I.zoom=pr,this._cameraForBounds(I,h,_,w,C)):{center:or,zoom:pr,bearing:w}}fitBounds(c,h,_){const w=this.cameraForBounds(c,h);return this._fitInternal(w,h,_)}fitScreenCoordinates(c,h,_,w,C){const I=p.pointGeometry.convert(c),k=p.pointGeometry.convert(h),R=new p.pointGeometry(Math.min(I.x,k.x),Math.min(I.y,k.y)),F=new p.pointGeometry(Math.max(I.x,k.x),Math.max(I.y,k.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(I,k))return this;const N=this.transform.pointLocation3D(R),H=this.transform.pointLocation3D(F),X=this.transform.pointLocation3D(new p.pointGeometry(R.x,F.y)),te=this.transform.pointLocation3D(new p.pointGeometry(F.x,R.y)),Q=[Math.min(N.lng,H.lng,X.lng,te.lng),Math.min(N.lat,H.lat,X.lat,te.lat)],ne=[Math.max(N.lng,H.lng,X.lng,te.lng),Math.max(N.lat,H.lat,X.lat,te.lat)],K=this._cameraForBounds(this.transform,Q,ne,_,w);return this._fitInternal(K,w,C)}_fitInternal(c,h,_){return c?(delete(h=p.extend(c,h)).padding,h.linear?this.easeTo(h,_):this.flyTo(h,_)):this}jumpTo(c,h){this.stop();const _=c.preloadOnly?this.transform.clone():this.transform;let w=!1,C=!1,I=!1;return"zoom"in c&&_.zoom!==+c.zoom&&(w=!0,_.zoom=+c.zoom),void 0!==c.center&&(_.center=p.LngLat.convert(c.center)),"bearing"in c&&_.bearing!==+c.bearing&&(C=!0,_.bearing=+c.bearing),"pitch"in c&&_.pitch!==+c.pitch&&(I=!0,_.pitch=+c.pitch),null==c.padding||_.isPaddingEqual(c.padding)||(_.padding=c.padding),c.preloadOnly?(this._preloadTiles(_),this):(this.fire(new p.Event("movestart",h)).fire(new p.Event("move",h)),w&&this.fire(new p.Event("zoomstart",h)).fire(new p.Event("zoom",h)).fire(new p.Event("zoomend",h)),C&&this.fire(new p.Event("rotatestart",h)).fire(new p.Event("rotate",h)).fire(new p.Event("rotateend",h)),I&&this.fire(new p.Event("pitchstart",h)).fire(new p.Event("pitch",h)).fire(new p.Event("pitchend",h)),this.fire(new p.Event("moveend",h)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||p.warnOnce(Kp),this.transform.getFreeCameraOptions()}setFreeCameraOptions(c,h){const _=this.transform;if(!_.projection.supportsFreeCamera)return p.warnOnce(Kp),this;this.stop();const w=_.zoom,C=_.pitch,I=_.bearing;_.setFreeCameraOptions(c);const k=w!==_.zoom,R=C!==_.pitch,F=I!==_.bearing;return this.fire(new p.Event("movestart",h)).fire(new p.Event("move",h)),k&&this.fire(new p.Event("zoomstart",h)).fire(new p.Event("zoom",h)).fire(new p.Event("zoomend",h)),F&&this.fire(new p.Event("rotatestart",h)).fire(new p.Event("rotate",h)).fire(new p.Event("rotateend",h)),R&&this.fire(new p.Event("pitchstart",h)).fire(new p.Event("pitch",h)).fire(new p.Event("pitchend",h)),this.fire(new p.Event("moveend",h)),this}easeTo(c,h){this._stop(!1,c.easeId),(!1===(c=p.extend({offset:[0,0],duration:500,easing:p.ease},c)).animate||!c.essential&&p.exported.prefersReducedMotion)&&(c.duration=0);const _=this.transform,w=this.getZoom(),C=this.getBearing(),I=this.getPitch(),k=this.getPadding(),R="zoom"in c?+c.zoom:w,F="bearing"in c?this._normalizeBearing(c.bearing,C):C,N="pitch"in c?+c.pitch:I,H="padding"in c?c.padding:_.padding,X=p.pointGeometry.convert(c.offset);let te,Q,ne;if("globe"===_.projection.name){const it=p.MercatorCoordinate.fromLngLat(_.center),Qe=X.rotate(-_.angle);it.x+=Qe.x/_.worldSize,it.y+=Qe.y/_.worldSize;const wt=it.toLngLat(),Le=p.LngLat.convert(c.center||wt);this._normalizeCenter(Le),te=_.centerPoint.add(Qe),Q=new p.pointGeometry(it.x,it.y).mult(_.worldSize),ne=new p.pointGeometry(p.mercatorXfromLng(Le.lng),p.mercatorYfromLat(Le.lat)).mult(_.worldSize).sub(Q)}else{te=_.centerPoint.add(X);const it=_.pointLocation(te),Qe=p.LngLat.convert(c.center||it);this._normalizeCenter(Qe),Q=_.project(it),ne=_.project(Qe).sub(Q)}const K=_.zoomScale(R-w);let Y,se;c.around&&(Y=p.LngLat.convert(c.around),se=_.locationPoint(Y));const J=this._zooming||R!==w,_e=this._rotating||C!==F,ve=this._pitching||N!==I,he=!_.isPaddingEqual(H),Ce=it=>Qe=>{if(J&&(it.zoom=p.number(w,R,Qe)),_e&&(it.bearing=p.number(C,F,Qe)),ve&&(it.pitch=p.number(I,N,Qe)),he&&(it.interpolatePadding(k,H,Qe),te=it.centerPoint.add(X)),Y)it.setLocationAtPoint(Y,se);else{const wt=it.zoomScale(it.zoom-w),Le=R>w?Math.min(2,K):Math.max(.5,K),ft=Math.pow(Le,1-Qe),gt=it.unproject(Q.add(ne.mult(Qe*ft)).mult(wt));it.setLocationAtPoint(it.renderWorldCopies?gt.wrap():gt,te)}return c.preloadOnly||this._fireMoveEvents(h),it};if(c.preloadOnly){const it=this._emulate(Ce,c.duration,_);return this._preloadTiles(it),this}const He={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=J,this._rotating=_e,this._pitching=ve,this._padding=he,this._easeId=c.easeId,this._prepareEase(h,c.noMoveStart,He),this._ease(Ce(_),it=>{_.recenterOnTerrain(),this._afterEase(h,it)},c),this}_prepareEase(c,h,_={}){this._moving=!0,this.transform.cameraElevationReference="sea",h||_.moving||this.fire(new p.Event("movestart",c)),this._zooming&&!_.zooming&&this.fire(new p.Event("zoomstart",c)),this._rotating&&!_.rotating&&this.fire(new p.Event("rotatestart",c)),this._pitching&&!_.pitching&&this.fire(new p.Event("pitchstart",c))}_fireMoveEvents(c){this.fire(new p.Event("move",c)),this._zooming&&this.fire(new p.Event("zoom",c)),this._rotating&&this.fire(new p.Event("rotate",c)),this._pitching&&this.fire(new p.Event("pitch",c))}_afterEase(c,h){if(this._easeId&&h&&this._easeId===h)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const _=this._zooming,w=this._rotating,C=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new p.Event("zoomend",c)),w&&this.fire(new p.Event("rotateend",c)),C&&this.fire(new p.Event("pitchend",c)),this.fire(new p.Event("moveend",c))}flyTo(c,h){if(!c.essential&&p.exported.prefersReducedMotion){const jt=p.pick(c,["center","zoom","bearing","pitch","around"]);return this.jumpTo(jt,h)}this.stop(),c=p.extend({offset:[0,0],speed:1.2,curve:1.42,easing:p.ease},c);const _=this.transform,w=this.getZoom(),C=this.getBearing(),I=this.getPitch(),k=this.getPadding(),R="zoom"in c?p.clamp(+c.zoom,_.minZoom,_.maxZoom):w,F="bearing"in c?this._normalizeBearing(c.bearing,C):C,N="pitch"in c?+c.pitch:I,H="padding"in c?c.padding:_.padding,X=_.zoomScale(R-w),te=p.pointGeometry.convert(c.offset);let Q=_.centerPoint.add(te);const ne=_.pointLocation(Q),K=p.LngLat.convert(c.center||ne);this._normalizeCenter(K);const Y=_.project(ne),se=_.project(K).sub(Y);let J=c.curve;const _e=Math.max(_.width,_.height),ve=_e/X,he=se.mag();if("minZoom"in c){const jt=p.clamp(Math.min(c.minZoom,w,R),_.minZoom,_.maxZoom),Lt=_e/_.zoomScale(jt-w);J=Math.sqrt(Lt/he*2)}const Ce=J*J;function He(jt){const Lt=(ve*ve-_e*_e+(jt?-1:1)*Ce*Ce*he*he)/(2*(jt?ve:_e)*Ce*he);return Math.log(Math.sqrt(Lt*Lt+1)-Lt)}function it(jt){return(Math.exp(jt)-Math.exp(-jt))/2}function Qe(jt){return(Math.exp(jt)+Math.exp(-jt))/2}const wt=He(0);let Le=function(jt){return Qe(wt)/Qe(wt+J*jt)},ft=function(jt){return _e*((Qe(wt)*(it(Lt=wt+J*jt)/Qe(Lt))-it(wt))/Ce)/he;var Lt},gt=(He(1)-wt)/J;if(Math.abs(he)<1e-6||!isFinite(gt)){if(Math.abs(_e-ve)<1e-6)return this.easeTo(c,h);const jt=ve<_e?-1:1;gt=Math.abs(Math.log(ve/_e))/J,ft=function(){return 0},Le=function(Lt){return Math.exp(jt*J*Lt)}}c.duration="duration"in c?+c.duration:1e3*gt/("screenSpeed"in c?+c.screenSpeed/J:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0);const qe=C!==F,Me=N!==I,Gt=!_.isPaddingEqual(H),It=jt=>Lt=>{const bn=Lt*gt,Gn=1/Le(bn);jt.zoom=1===Lt?R:w+jt.scaleZoom(Gn),qe&&(jt.bearing=p.number(C,F,Lt)),Me&&(jt.pitch=p.number(I,N,Lt)),Gt&&(jt.interpolatePadding(k,H,Lt),Q=jt.centerPoint.add(te));const Rn=1===Lt?K:jt.unproject(Y.add(se.mult(ft(bn))).mult(Gn));return jt.setLocationAtPoint(jt.renderWorldCopies?Rn.wrap():Rn,Q),jt._updateCameraOnTerrain(),c.preloadOnly||this._fireMoveEvents(h),jt};if(c.preloadOnly){const jt=this._emulate(It,c.duration,_);return this._preloadTiles(jt),this}return this._zooming=!0,this._rotating=qe,this._pitching=Me,this._padding=Gt,this._prepareEase(h,!1),this._ease(It(_),()=>this._afterEase(h),c),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(c,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const _=this._onEaseEnd;this._onEaseEnd=void 0,_.call(this,h)}if(!c){const _=this.handlers;_&&_.stop(!1)}return this}_ease(c,h,_){!1===_.animate||0===_.duration?(c(1),h()):(this._easeStart=p.exported.now(),this._easeOptions=_,this._onEaseFrame=c,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const c=Math.min((p.exported.now()-this._easeStart)/this._easeOptions.duration,1),h=this._onEaseFrame;h&&h(this._easeOptions.easing(c)),c<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(c,h){c=p.wrap(c,-180,180);const _=Math.abs(c-h);return Math.abs(c-360-h)<_&&(c-=360),Math.abs(c+360-h)<_&&(c+=360),c}_normalizeCenter(c){const h=this.transform;if(!h.renderWorldCopies||h.maxBounds)return;const _=c.lng-h.center.lng;c.lng+=_>180?-360:_<-180?360:0}_emulate(c,h,_){const w=Math.ceil(15*h/1e3),C=[],I=c(_.clone());for(let k=0;k<=w;k++){const R=I(k/w);C.push(R.clone())}return C}}class hd{constructor(c={}){this.options=c,p.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(c){const h=this.options&&this.options.compact;return this._map=c,this._container=Ye("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Ye("button","mapboxgl-ctrl-attrib-button",this._container),Ye("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Ye("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===h&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(c,h){const _=this._map._getUIString(`AttributionControl.${h}`);c.setAttribute("aria-label",_),c.removeAttribute("title"),c.firstElementChild&&c.firstElementChild.setAttribute("title",_)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let c=this._editLink;c||(c=this._editLink=this._container.querySelector(".mapbox-improve-map"));const h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||p.config.ACCESS_TOKEN}];if(c){const _=h.reduce((w,C,I)=>(C.value&&(w+=`${C.key}=${C.value}${I<h.length-1?"&":""}`),w),"?");c.href=`${p.config.FEEDBACK_URL}/${_}#${Wp(this._map,!0)}`,c.rel="noopener nofollow",this._setElementTitle(c,"MapFeedback")}}_updateData(c){!c||"metadata"!==c.sourceDataType&&"visibility"!==c.sourceDataType&&"style"!==c.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let c=[];if(this._map.style.stylesheet){const w=this._map.style.stylesheet;this.styleOwner=w.owner,this.styleId=w.id}const h=this._map.style._sourceCaches;for(const w in h){const C=h[w];if(C.used){const I=C.getSource();I.attribution&&c.indexOf(I.attribution)<0&&c.push(I.attribution)}}c.sort((w,C)=>w.length-C.length),c=c.filter((w,C)=>{for(let I=C+1;I<c.length;I++)if(c[I].indexOf(w)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?c=[...this.options.customAttribution,...c]:c.unshift(this.options.customAttribution));const _=c.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,c.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Ac{constructor(){p.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(c){this._map=c,this._container=Ye("div","mapboxgl-ctrl");const h=Ye("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(c){c&&"metadata"!==c.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const c=this._map.style._sourceCaches;if(0===Object.entries(c).length)return!0;for(const h in c){const _=c[h].getSource();if(_.hasOwnProperty("mapbox_logo")&&!_.mapbox_logo)return!1}return!0}_updateCompact(){const c=this._container.children;if(c.length){const h=c[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}}}class pd{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(c){const h=++this._id;return this._queue.push({callback:c,id:h,cancelled:!1}),h}remove(c){const h=this._currentlyRunning,_=h?this._queue.concat(h):this._queue;for(const w of _)if(w.id===c)return void(w.cancelled=!0)}run(c=0){const h=this._currentlyRunning=this._queue;this._queue=[];for(const _ of h)if(!_.cancelled&&(_.callback(c),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function kc(g,c,h){if(g=new p.LngLat(g.lng,g.lat),c){const _=new p.LngLat(g.lng-360,g.lat),w=new p.LngLat(g.lng+360,g.lat),C=360*Math.ceil(Math.abs(g.lng-h.center.lng)/360),I=h.locationPoint(g).distSqr(c),k=c.x<0||c.y<0||c.x>h.width||c.y>h.height;h.locationPoint(_).distSqr(c)<I&&(k||Math.abs(_.lng-h.center.lng)<C)?g=_:h.locationPoint(w).distSqr(c)<I&&(k||Math.abs(w.lng-h.center.lng)<C)&&(g=w)}for(;Math.abs(g.lng-h.center.lng)>180;){const _=h.locationPoint(g);if(_.x>=0&&_.y>=0&&_.x<=h.width&&_.y<=h.height)break;g.lng>h.center.lng?g.lng-=360:g.lng+=360}return g}const Dh={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class fd extends p.Evented{constructor(c,h){if(super(),(c instanceof p.window.HTMLElement||h)&&(c=p.extend({element:c},h)),p.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=c&&c.occludedOpacity||.2,c&&c.element)this._element=c.element,this._offset=p.pointGeometry.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=Ye("div");const w=41,C=27,I=Ft("svg",{display:"block",height:w*this._scale+"px",width:C*this._scale+"px",viewBox:`0 0 ${C} ${w}`},this._element),k=Ft("radialGradient",{id:"shadowGradient"},Ft("defs",{},I));Ft("stop",{offset:"10%","stop-opacity":.4},k),Ft("stop",{offset:"100%","stop-opacity":.05},k),Ft("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},I),Ft("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},I),Ft("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},I),Ft("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},I),this._offset=p.pointGeometry.convert(c&&c.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",w=>{w.preventDefault()}),this._element.addEventListener("mousedown",w=>{w.preventDefault()});const _=this._element.classList;for(const w in Dh)_.remove(`mapboxgl-marker-anchor-${w}`);_.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(c){return c===this._map||(this.remove(),this._map=c,c.getCanvasContainer().appendChild(this._element),c.on("move",this._updateMoving),c.on("moveend",this._update),c.on("remove",this._clearFadeTimer),c._addMarker(this),this.setDraggable(this._draggable),this._update(),c.on("click",this._onMapClick)),this}remove(){const c=this._map;return c&&(c.off("click",this._onMapClick),c.off("move",this._updateMoving),c.off("moveend",this._update),c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler),c.off("mouseup",this._onUp),c.off("touchend",this._onUp),c.off("mousemove",this._onMove),c.off("touchmove",this._onMove),c.off("remove",this._clearFadeTimer),c._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(c){return this._lngLat=p.LngLat.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){const w=Math.sqrt(Math.pow(13.5,2)/2);c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[w,-1*(24.6+w)],"bottom-right":[-w,-1*(24.6+w)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=c,c._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(c){const h=c.code,_=c.charCode||c.keyCode;"Space"!==h&&"Enter"!==h&&32!==_&&13!==_||this.togglePopup()}_onMapClick(c){const h=c.originalEvent.target,_=this._element;this._popup&&(h===_||_.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const c=this._popup;return c?(c.isOpen()?(c.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(c.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const c=this._map,h=this._pos;if(!c||!h)return!1;const _=c.unproject(h),w=c.getFreeCameraOptions();if(!w.position)return!1;const C=w.position.toLngLat();return C.distanceTo(_)<.9*C.distanceTo(this._lngLat)}_evaluateOpacity(){const c=this._map;if(!c)return;const h=this._pos;if(!h||h.x<0||h.x>c.transform.width||h.y<0||h.y>c.transform.height)return void this._clearFadeTimer();const _=c.unproject(h);let w;c._showingGlobe()&&p.isLngLatBehindGlobe(c.transform,this._lngLat)?w=0:(w=1-c._queryFogOpacity(_),c.transform._terrainEnabled()&&c.getTerrain()&&this._behindTerrain()&&(w*=this._occludedOpacity)),this._element.style.opacity=`${w}`,this._element.style.pointerEvents=w>0?"auto":"none",this._popup&&this._popup._setOpacity(w),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const c=this._pos;if(!c||!this._map)return;const h=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${c.x}px,${c.y}px)\n            ${Dh[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${h.x}px,${h.y}px)\n        `}_calculateXYTransform(){const c=this._pos,h=this._map,_=this.getPitchAlignment();if(!h||!c||"map"!==_)return"";if(!h._showingGlobe()){const R=h.getPitch();return R?`rotateX(${R}deg)`:""}const w=p.radToDeg(p.globeTiltAtLngLat(h.transform,this._lngLat)),C=c.sub(p.globeCenterToScreenPoint(h.transform)),I=Math.abs(C.x)+Math.abs(C.y);if(0===I)return"";const k=w/I;return`rotateX(${-C.y*k}deg) rotateY(${C.x*k}deg)`}_calculateZTransform(){const c=this._pos,h=this._map;if(!h||!c)return"";let _=0;const w=this.getRotationAlignment();if("map"===w)if(h._showingGlobe()){const C=h.project(new p.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),I=h.project(new p.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(C);_=p.radToDeg(Math.atan2(I.y,I.x))-90}else _=-h.getBearing();else if("horizon"===w){const C=p.smoothstep(4,6,h.getZoom()),I=p.globeCenterToScreenPoint(h.transform);I.y+=C*h.transform.height;const k=c.sub(I),R=p.radToDeg(Math.atan2(k.y,k.x));_=(R>90?R-270:R+90)*(1-C)}return _+=this._rotation,_?`rotateZ(${_}deg)`:""}_update(c){p.window.cancelAnimationFrame(this._updateFrameId);const h=this._map;h&&(h.transform.renderWorldCopies&&(this._lngLat=kc(this._lngLat,this._pos,h.transform)),this._pos=h.project(this._lngLat),!0===c?this._updateFrameId=p.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),h._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(h._showingGlobe()||h.getTerrain()||h.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(c){return this._offset=p.pointGeometry.convert(c),this._update(),this}_onMove(c){const h=this._map;if(!h)return;const _=this._pointerdownPos,w=this._positionDelta;if(_&&w){if(!this._isDragging){const C=this._clickTolerance||h._clickTolerance;if(c.point.dist(_)<C)return;this._isDragging=!0}this._pos=c.point.sub(w),this._lngLat=h.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new p.Event("dragstart"))),this.fire(new p.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const c=this._map;c&&(c.off("mousemove",this._onMove),c.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new p.Event("dragend")),this._state="inactive"}_addDragHandler(c){const h=this._map,_=this._pos;h&&_&&this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(_),this._pointerdownPos=c.point,this._state="pending",h.on("mousemove",this._onMove),h.on("touchmove",this._onMove),h.once("mouseup",this._onUp),h.once("touchend",this._onUp))}setDraggable(c){this._draggable=!!c;const h=this._map;return h&&(c?(h.on("mousedown",this._addDragHandler),h.on("touchstart",this._addDragHandler)):(h.off("mousedown",this._addDragHandler),h.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(c){return this._rotation=c||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(c){return this._rotationAlignment=c||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(c){return this._pitchAlignment=c||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(c){return this._occludedOpacity=c||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Eh={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Jp=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ih(g=new p.pointGeometry(0,0),c="bottom"){if("number"==typeof g){const h=Math.round(Math.sqrt(.5*Math.pow(g,2)));switch(c){case"top":return new p.pointGeometry(0,g);case"top-left":return new p.pointGeometry(h,h);case"top-right":return new p.pointGeometry(-h,h);case"bottom":return new p.pointGeometry(0,-g);case"bottom-left":return new p.pointGeometry(h,-h);case"bottom-right":return new p.pointGeometry(-h,-h);case"left":return new p.pointGeometry(g,0);case"right":return new p.pointGeometry(-g,0)}return new p.pointGeometry(0,0)}return g instanceof p.pointGeometry||Array.isArray(g)?p.pointGeometry.convert(g):p.pointGeometry.convert(g[c]||[0,0])}class ef{constructor(c){this.jumpTo(c)}getValue(c){if(c<=this._startTime)return this._start;if(c>=this._endTime)return this._end;const h=p.easeCubicInOut((c-this._startTime)/(this._endTime-this._startTime));return this._start*(1-h)+this._end*h}isEasing(c){return c>=this._startTime&&c<=this._endTime}jumpTo(c){this._startTime=-1/0,this._endTime=-1/0,this._start=c,this._end=c}easeTo(c,h,_){this._start=this.getValue(h),this._end=c,this._startTime=h,this._endTime=h+_}}const tf={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},md={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function Mh(g){g.parentNode&&g.parentNode.removeChild(g)}const Rm={showCompass:!0,showZoom:!0,visualizePitch:!1};class cs{constructor(c,h,_=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new Zp({clickTolerance:c.dragRotate._mouseRotate._clickTolerance}),this.map=c,_&&(this.mousePitch=new Ic({clickTolerance:c.dragRotate._mousePitch._clickTolerance})),p.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),h.addEventListener("mousedown",this.mousedown),h.addEventListener("touchstart",this.touchstart,{passive:!1}),h.addEventListener("touchmove",this.touchmove),h.addEventListener("touchend",this.touchend),h.addEventListener("touchcancel",this.reset)}down(c,h){this.mouseRotate.mousedown(c,h),this.mousePitch&&this.mousePitch.mousedown(c,h),$t()}move(c,h){const _=this.map,w=this.mouseRotate.mousemoveWindow(c,h),C=w&&w.bearingDelta;if(C&&_.setBearing(_.getBearing()+C),this.mousePitch){const I=this.mousePitch.mousemoveWindow(c,h),k=I&&I.pitchDelta;k&&_.setPitch(_.getPitch()+k)}}off(){const c=this.element;c.removeEventListener("mousedown",this.mousedown),c.removeEventListener("touchstart",this.touchstart,{passive:!1}),c.removeEventListener("touchmove",this.touchmove),c.removeEventListener("touchend",this.touchend),c.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){dn(),p.window.removeEventListener("mousemove",this.mousemove),p.window.removeEventListener("mouseup",this.mouseup)}mousedown(c){this.down(p.extend({},c,{ctrlKey:!0,preventDefault:()=>c.preventDefault()}),mt(this.element,c)),p.window.addEventListener("mousemove",this.mousemove),p.window.addEventListener("mouseup",this.mouseup)}mousemove(c){this.move(c,mt(this.element,c))}mouseup(c){this.mouseRotate.mouseupWindow(c),this.mousePitch&&this.mousePitch.mouseupWindow(c),this.offTemp()}touchstart(c){1!==c.targetTouches.length?this.reset():(this._startPos=this._lastPos=gi(this.element,c.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>c.preventDefault()},this._startPos))}touchmove(c){1!==c.targetTouches.length?this.reset():(this._lastPos=gi(this.element,c.targetTouches)[0],this.move({preventDefault:()=>c.preventDefault()},this._lastPos))}touchend(c){0===c.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Il={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Qr={maxWidth:100,unit:"metric"};function Ml(g,c,h){const _=Ah(c),w=_/c,C={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[h];this._map._requestDomTask(()=>{this._container.style.width=g*w+"px",this._container.innerHTML=`${_}&nbsp;${C}`})}function Ah(g){const c=Math.pow(10,`${Math.floor(g)}`.length-1);let h=g/c;return h=h>=10?10:h>=5?5:h>=3?3:h>=2?2:h>=1?1:function(_){const w=Math.pow(10,Math.ceil(-Math.log(_)/Math.LN10));return Math.round(_*w)/w}(h),c*h}const Al={version:p.version,supported:Et,setRTLTextPlugin:p.setRTLTextPlugin,getRTLTextPluginStatus:p.getRTLTextPluginStatus,Map:class extends km{constructor(g){if(p.LivePerformanceUtils.mark(p.PerformanceMarkers.create),null!=(g=p.extend({},md,g)).minZoom&&null!=g.maxZoom&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=g.minPitch&&null!=g.maxPitch&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=g.minPitch&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=g.maxPitch&&g.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(g.antialias&&p.isSafariWithAntialiasingBug(p.window)&&(g.antialias=!1,p.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Ws(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies),g),this._interactive=g.interactive,this._minTileCacheSize=g.minTileCacheSize,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=g.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=g.collectResourceTiming,this._optimizeForTerrain=g.optimizeForTerrain,this._language=this._parseLanguage(g.language),this._worldview=g.worldview,this._renderTaskQueue=new pd,this._domRenderTaskQueue=new pd,this._controls=[],this._markers=[],this._popups=[],this._mapId=p.uniqueId(),this._locale=p.extend({},tf,g.locale),this._clickTolerance=g.clickTolerance,this._cooperativeGestures=g.cooperativeGestures,this._performanceMetricsCollection=g.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new ef(0),this._interactionRange=[1/0,-1/0],this._useExplicitProjection=!1,this._requestManager=new p.RequestManager(g.transformRequest,g.accessToken,g.testMode),this._silenceAuthErrors=!!g.testMode,"string"==typeof g.container){if(this._container=p.window.document.getElementById(g.container),!this._container)throw new Error(`Container '${g.container}' not found.`)}else{if(!(g.container instanceof p.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(this._container.childNodes.length>0&&p.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),g.maxBounds&&this.setMaxBounds(g.maxBounds),p.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==p.window&&(p.window.addEventListener("online",this._onWindowOnline,!1),p.window.addEventListener("resize",this._onWindowResize,!1),p.window.addEventListener("orientationchange",this._onWindowResize,!1),p.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Qp(this,g),this._localFontFamily=g.localFontFamily,this._localIdeographFontFamily=g.localIdeographFontFamily,g.style&&this.setStyle(g.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),g.projection&&this.setProjection(g.projection),this._hash=g.hash&&new yh("string"==typeof g.hash&&g.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch}),g.bounds&&(this.resize(),this.fitBounds(g.bounds,p.extend({},g.fitBoundsOptions,{duration:0})))),this.resize(),g.attributionControl&&this.addControl(new hd({customAttribution:g.customAttribution})),this._logoControl=new Ac,this.addControl(this._logoControl,g.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",c=>{this._update("style"===c.dataType),this.fire(new p.Event(`${c.dataType}data`,c))}),this.on("dataloading",c=>{this.fire(new p.Event(`${c.dataType}dataloading`,c))})}_getMapId(){return this._mapId}addControl(g,c){if(void 0===c&&(c=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=g.onAdd(this);this._controls.push(g);const _=this._controlPositions[c];return-1!==c.indexOf("bottom")?_.insertBefore(h,_.firstChild):_.appendChild(h),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const c=this._controls.indexOf(g);return c>-1&&this._controls.splice(c,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(g){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const c=!this._moving;return c&&this.fire(new p.Event("movestart",g)).fire(new p.Event("move",g)),this.fire(new p.Event("resize",g)),c&&this.fire(new p.Event("moveend",g)),this}getBounds(){return"globe"===this.transform.projection.name&&p.warnOnce('Globe projection does not support getBounds API, this API may behave unexpectedly when viewing the poles."'),this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(g){return this.transform.setMaxBounds(p.LngLatBounds.convert(g)),this._update()}setMinZoom(g){if((g=null==g?-2:g)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g?this.setZoom(g):this.fire(new p.Event("zoomstart")).fire(new p.Event("zoom")).fire(new p.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=null==g?22:g)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g?this.setZoom(g):this.fire(new p.Event("zoomstart")).fire(new p.Event("zoom")).fire(new p.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=null==g?0:g)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g?this.setPitch(g):this.fire(new p.Event("pitchstart")).fire(new p.Event("pitch")).fire(new p.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=null==g?85:g)>85)throw new Error("maxPitch must be less than or equal to 85");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g?this.setPitch(g):this.fire(new p.Event("pitchstart")).fire(new p.Event("pitch")).fire(new p.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.renderWorldCopies=g,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(g){return"auto"===g?p.window.navigator.language:Array.isArray(g)?0===g.length?void 0:g.map(c=>"auto"===c?p.window.navigator.language:c):g}setLanguage(g){const c=this._parseLanguage(g);if(!this.style||c===this._language)return this;this._language=c,this.style._reloadSources();for(const h of this._controls)h._setLanguage&&h._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(g){return this.style&&g!==this._worldview?(this._worldview=g,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(g){return this._lazyInitEmptyStyle(),g?"string"==typeof g&&(g={name:g}):g=null,this._useExplicitProjection=!!g,this._prioritizeAndUpdateProjection(g,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const g=this.transform,c=g.projection.name;let h;"globe"===c&&g.zoom>=p.GLOBE_ZOOM_THRESHOLD_MAX?(g.setMercatorFromTransition(),h=!0):"mercator"===c&&g.zoom<p.GLOBE_ZOOM_THRESHOLD_MAX&&(g.setProjection({name:"globe"}),h=!0),h&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(g,c){return this._updateProjection(g||c||{name:"mercator"})}_updateProjection(g){let c;if(c="globe"===g.name&&this.transform.zoom>=p.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(g),this.style.applyProjectionUpdate(),c){this.painter.clearBackgroundTiles();for(const h in this.style._sourceCaches)this.style._sourceCaches[h].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(g){return this.transform.locationPoint3D(p.LngLat.convert(g))}unproject(g){return this.transform.pointLocation3D(p.pointGeometry.convert(g))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(g,c,h){if("mouseenter"===g||"mouseover"===g){let _=!1;const w=I=>{const k=c.filter(F=>this.getLayer(F)),R=k.length?this.queryRenderedFeatures(I.point,{layers:k}):[];R.length?_||(_=!0,h.call(this,new Xs(g,this,I.originalEvent,{features:R}))):_=!1},C=()=>{_=!1};return{layers:new Set(c),listener:h,delegates:{mousemove:w,mouseout:C}}}if("mouseleave"===g||"mouseout"===g){let _=!1;const w=I=>{const k=c.filter(R=>this.getLayer(R));(k.length?this.queryRenderedFeatures(I.point,{layers:k}):[]).length?_=!0:_&&(_=!1,h.call(this,new Xs(g,this,I.originalEvent)))},C=I=>{_&&(_=!1,h.call(this,new Xs(g,this,I.originalEvent)))};return{layers:new Set(c),listener:h,delegates:{mousemove:w,mouseout:C}}}{const _=w=>{const C=c.filter(k=>this.getLayer(k)),I=C.length?this.queryRenderedFeatures(w.point,{layers:C}):[];I.length&&(w.features=I,h.call(this,w),delete w.features)};return{layers:new Set(c),listener:h,delegates:{[g]:_}}}}on(g,c,h){if(void 0===h)return super.on(g,c);Array.isArray(c)||(c=[c]);const _=this._createDelegatedListener(g,c,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(_);for(const w in _.delegates)this.on(w,_.delegates[w]);return this}once(g,c,h){if(void 0===h)return super.once(g,c);Array.isArray(c)||(c=[c]);const _=this._createDelegatedListener(g,c,h);for(const w in _.delegates)this.once(w,_.delegates[w]);return this}off(g,c,h){if(void 0===h)return super.off(g,c);c=new Set(Array.isArray(c)?c:[c]);const _=(C,I)=>{if(C.size!==I.size)return!1;for(const k of C)if(!I.has(k))return!1;return!0},w=this._delegatedListeners?this._delegatedListeners[g]:void 0;return w&&(C=>{for(let I=0;I<C.length;I++){const k=C[I];if(k.listener===h&&_(k.layers,c)){for(const R in k.delegates)this.off(R,k.delegates[R]);return C.splice(I,1),this}}})(w),this}queryRenderedFeatures(g,c){return this.style?(void 0!==c||void 0===g||g instanceof p.pointGeometry||Array.isArray(g)||(c=g,g=void 0),this.style.queryRenderedFeatures(g=g||[[0,0],[this.transform.width,this.transform.height]],c=c||{},this.transform)):[]}querySourceFeatures(g,c){return this.style.querySourceFeatures(g,c)}setStyle(g,c){return!1!==(c=p.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},c)).diff&&c.localIdeographFontFamily===this._localIdeographFontFamily&&c.localFontFamily===this._localFontFamily&&this.style&&g?(this._diffStyle(g,c),this):(this._localIdeographFontFamily=c.localIdeographFontFamily,this._localFontFamily=c.localFontFamily,this._updateStyle(g,c))}_getUIString(g){const c=this._locale[g];if(null==c)throw new Error(`Missing UI string '${g}'`);return c}_updateStyle(g,c){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),g&&(this.style=new Aa(this,c||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof g?this.style.loadURL(g):this.style.loadJSON(g)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Aa(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(g,c){if("string"==typeof g){const h=this._requestManager.normalizeStyleURL(g),_=this._requestManager.transformRequest(h,p.ResourceType.Style);p.getJSON(_,(w,C)=>{w?this.fire(new p.ErrorEvent(w)):C&&this._updateDiff(C,c)})}else"object"==typeof g&&this._updateDiff(g,c)}_updateDiff(g,c){try{this.style.setState(g)&&this._update(!0)}catch(h){p.warnOnce(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(g,c)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(p.warnOnce("There is no style added to the map."),!1)}addSource(g,c){return this._lazyInitEmptyStyle(),this.style.addSource(g,c),this._update(!0)}isSourceLoaded(g){return!!this.style&&this.style._isSourceCacheLoaded(g)}areTilesLoaded(){const g=this.style&&this.style._sourceCaches;for(const c in g){const h=g[c]._tiles;for(const _ in h){const w=h[_];if("loaded"!==w.state&&"errored"!==w.state)return!1}}return!0}addSourceType(g,c,h){this._lazyInitEmptyStyle(),this.style.addSourceType(g,c,h)}removeSource(g){return this.style.removeSource(g),this._updateTerrain(),this._update(!0)}getSource(g){return this.style.getSource(g)}addImage(g,c,{pixelRatio:h=1,sdf:_=!1,stretchX:w,stretchY:C,content:I}={}){if(this._lazyInitEmptyStyle(),c instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&c instanceof p.window.ImageBitmap){const{width:k,height:R,data:F}=p.exported.getImageData(c);this.style.addImage(g,{data:new p.RGBAImage({width:k,height:R},F),pixelRatio:h,stretchX:w,stretchY:C,content:I,sdf:_,version:0})}else if(void 0===c.width||void 0===c.height)this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:k,height:R}=c,F=c;this.style.addImage(g,{data:new p.RGBAImage({width:k,height:R},new Uint8Array(F.data)),pixelRatio:h,stretchX:w,stretchY:C,content:I,sdf:_,version:0,userImage:F}),F.onAdd&&F.onAdd(this,g)}}updateImage(g,c){const h=this.style.getImage(g);if(!h)return void this.fire(new p.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=c instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&c instanceof p.window.ImageBitmap?p.exported.getImageData(c):c,{width:w,height:C}=_;void 0!==w&&void 0!==C?w===h.data.width&&C===h.data.height?(h.data.replace(_.data,!(c instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&c instanceof p.window.ImageBitmap)),this.style.updateImage(g,h)):this.fire(new p.ErrorEvent(new Error(`The width and height of the updated image (${w}, ${C})\n                must be that same as the previous version of the image\n                (${h.data.width}, ${h.data.height})`))):this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(g){return g?!!this.style.getImage(g):(this.fire(new p.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(g)}loadImage(g,c){p.getImage(this._requestManager.transformRequest(g,p.ResourceType.Image),(h,_)=>{c(h,_ instanceof p.window.HTMLImageElement?p.exported.getImageData(_):_)})}listImages(){return this.style.listImages()}addLayer(g,c){return this._lazyInitEmptyStyle(),this.style.addLayer(g,c),this._update(!0)}moveLayer(g,c){return this.style.moveLayer(g,c),this._update(!0)}removeLayer(g){return this.style.removeLayer(g),this._update(!0)}getLayer(g){return this.style.getLayer(g)}setLayerZoomRange(g,c,h){return this.style.setLayerZoomRange(g,c,h),this._update(!0)}setFilter(g,c,h={}){return this.style.setFilter(g,c,h),this._update(!0)}getFilter(g){return this.style.getFilter(g)}setPaintProperty(g,c,h,_={}){return this.style.setPaintProperty(g,c,h,_),this._update(!0)}getPaintProperty(g,c){return this.style.getPaintProperty(g,c)}setLayoutProperty(g,c,h,_={}){return this.style.setLayoutProperty(g,c,h,_),this._update(!0)}getLayoutProperty(g,c){return this.style.getLayoutProperty(g,c)}setLight(g,c={}){return this._lazyInitEmptyStyle(),this.style.setLight(g,c),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(g){return this._lazyInitEmptyStyle(),!g&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(g),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(g){return this._lazyInitEmptyStyle(),this.style.setFog(g),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(g){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(p.LngLat.convert(g),this.transform):0}setFeatureState(g,c){return this.style.setFeatureState(g,c),this._update()}removeFeatureState(g,c){return this.style.removeFeatureState(g,c),this._update()}getFeatureState(g){return this.style.getFeatureState(g)}_updateContainerDimensions(){if(!this._container)return;const g=this._container.getBoundingClientRect().width||400,c=this._container.getBoundingClientRect().height||300;let h,_,w,C=this._container;for(;C&&(!_||!w);){const I=p.window.getComputedStyle(C).transform;I&&"none"!==I&&(h=I.match(/matrix.*\((.+)\)/)[1].split(", "),h[0]&&"0"!==h[0]&&"1"!==h[0]&&(_=h[0]),h[3]&&"0"!==h[3]&&"1"!==h[3]&&(w=h[3])),C=C.parentElement}this._containerWidth=_?Math.abs(g/_):g,this._containerHeight=w?Math.abs(c/w):c}_detectMissingCSS(){"rgb(250, 128, 114)"!==p.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&p.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=Ye("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();const c=this._canvasContainer=Ye("div","mapboxgl-canvas-container",g);this._interactive&&c.classList.add("mapboxgl-interactive"),this._canvas=Ye("canvas","mapboxgl-canvas",c),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const h=this._controlContainer=Ye("div","mapboxgl-control-container",g),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(w=>{_[w]=Ye("div",`mapboxgl-ctrl-${w}`,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,c){const h=p.exported.devicePixelRatio||1;this._canvas.width=h*Math.ceil(g),this._canvas.height=h*Math.ceil(c),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${c}px`}_addMarker(g){this._markers.push(g)}_removeMarker(g){const c=this._markers.indexOf(g);-1!==c&&this._markers.splice(c,1)}_addPopup(g){this._popups.push(g)}_removePopup(g){const c=this._popups.indexOf(g);-1!==c&&this._popups.splice(c,1)}_setupPainter(){const g=p.extend({},Et.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),c=this._canvas.getContext("webgl",g)||this._canvas.getContext("experimental-webgl",g);c?(p.storeAuthState(c,!0),this.painter=new hv(c,this.transform),this.on("data",h=>{"source"===h.dataType&&this.painter.setTileLoadedFlag(!0)}),p.exported$1.testSupport(c)):this.fire(new p.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new p.Event("webglcontextlost",{originalEvent:g}))}_contextRestored(g){this._setupPainter(),this.resize(),this._update(),this.fire(new p.Event("webglcontextrestored",{originalEvent:g}))}_onMapScroll(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_requestDomTask(g){!this.loaded()||this.loaded()&&!this.isMoving()?g():this._domRenderTaskQueue.add(g)}_render(g){let c;const h=this.painter.context.extTimerQuery,_=p.exported.now();if(this.listens("gpu-timing-frame")&&(c=h.createQueryEXT(),h.beginQueryEXT(h.TIME_ELAPSED_EXT,c)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],p.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],p.window.performance.now())),this._renderTaskQueue.run(g),this._domRenderTaskQueue.run(g),this._removed)return;this._updateProjectionTransition();let w=!1;const C=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const R=this.transform.zoom,F=this.transform.pitch,N=p.exported.now();this.style.zoomHistory.update(R,N);const H=new p.EvaluationParameters(R,{now:N,fadeDuration:C,pitch:F,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),X=H.crossFadingFactor();1===X&&X===this._crossFadingFactor||(w=!0,this._crossFadingFactor=X),this.style.update(H)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let I=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),I=this._updateAverageElevation(_),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):I=this._updateAverageElevation(_),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,C,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:C,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new p.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new p.Event("load"))),this.style&&(this.style.hasTransitions()||w)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),c){const R=p.exported.now()-_;h.endQueryEXT(h.TIME_ELAPSED_EXT,c),setTimeout(()=>{const F=h.getQueryObjectEXT(c,h.QUERY_RESULT_EXT)/1e6;h.deleteQueryEXT(c),this.fire(new p.Event("gpu-timing-frame",{cpuTime:R,gpuTime:F})),p.window.performance.mark("frame-gpu",{startTime:_,detail:{gpuTime:F}})},50)}if(this.listens("gpu-timing-layer")){const R=this.painter.collectGpuTimers();setTimeout(()=>{const F=this.painter.queryGpuTimers(R);this.fire(new p.Event("gpu-timing-layer",{layerTimes:F}))},50)}if(this.listens("gpu-timing-deferred-render")){const R=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const F=this.painter.queryGpuTimeDeferredRender(R);this.fire(new p.Event("gpu-timing-deferred-render",{gpuTime:F}))},50)}const k=this._sourcesDirty||this._styleDirty||this._placementDirty||I;if(k||this._repaint)this.triggerRepaint();else{const R=!this.isMoving()&&this.loaded();if(R&&(I=this._updateAverageElevation(_,!0)),I)this.triggerRepaint();else if(this._triggerFrame(!1),R&&(this.fire(new p.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const F=this._calculateSpeedIndex();this.fire(new p.Event("speedindexcompleted",{speedIndex:F})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||k||(this._fullyLoaded=!0,p.LivePerformanceUtils.mark(p.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&p.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.painter.transform.projection,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(g){for(const c of this._markers)g&&!this.getRenderWorldCopies()&&(c._lngLat=c._lngLat.wrap()),c._update();for(const c of this._popups)!g||this.getRenderWorldCopies()||c._trackPointer||(c._lngLat=c._lngLat.wrap()),c._update()}_updateAverageElevation(g,c=!1){const h=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&h(0);if((c||g-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(g)){const _=this.transform.averageElevation;let w=this.transform.sampleAverageElevation(),C=!1;this.transform.elevation&&(C=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(w)?w=0:this._averageElevationLastSampledAt=g;const I=Math.abs(_-w);if(I>1){if(this._isInitialLoad||C)return this._averageElevation.jumpTo(w),h(w);this._averageElevation.easeTo(w,g,300)}else if(I>1e-4)return this._averageElevation.jumpTo(w),h(w)}return!!this._averageElevation.isEasing(g)&&h(this._averageElevation.getValue(g))}_authenticate(){p.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,g=>{if(g&&(g.message===p.AUTH_ERR_MSG||401===g.status)){const c=this.painter.context.gl;p.storeAuthState(c,!1),this._logoControl instanceof Ac&&this._logoControl._updateLogo(),c&&c.clear(c.DEPTH_BUFFER_BIT|c.COLOR_BUFFER_BIT|c.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new p.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),p.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const g=this.painter.canvasCopy(),c=this.painter.getCanvasCopiesAndTimestamps();c.timeStamps.push(performance.now());const h=this.painter.context.gl,_=h.createFramebuffer();function w(C){h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,C,0);const I=new Uint8Array(h.drawingBufferWidth*h.drawingBufferHeight*4);return h.readPixels(0,0,h.drawingBufferWidth,h.drawingBufferHeight,h.RGBA,h.UNSIGNED_BYTE,I),I}return h.bindFramebuffer(h.FRAMEBUFFER,_),this._canvasPixelComparison(w(g),c.canvasCopies.map(w),c.timeStamps)}_canvasPixelComparison(g,c,h){let _=h[1]-h[0];const w=g.length/4;for(let C=0;C<c.length;C++){const I=c[C];let k=0;for(let R=0;R<I.length;R+=4)I[R]===g[R]&&I[R+1]===g[R+1]&&I[R+2]===g[R+2]&&I[R+3]===g[R+3]&&(k+=1);_+=(h[C+2]-h[C+1])*(1-k/w)}return _}remove(){this._hash&&this._hash.remove();for(const c of this._controls)c.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==p.window&&(p.window.removeEventListener("resize",this._onWindowResize,!1),p.window.removeEventListener("orientationchange",this._onWindowResize,!1),p.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),p.window.removeEventListener("online",this._onWindowOnline,!1));const g=this.painter.context.gl.getExtension("WEBGL_lose_context");g&&g.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),Mh(this._canvasContainer),Mh(this._controlContainer),Mh(this._missingCSSCanary),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),p.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new p.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(g){this._renderNextFrame=this._renderNextFrame||g,this.style&&!this._frame&&(this._frame=p.exported.frame(c=>{const h=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,h&&this._render(c)}))}_preloadTiles(g){const c=this.style?Object.values(this.style._sourceCaches):[];return p.asyncAll(c,(h,_)=>h._preloadTiles(g,_),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(g){this._trackResize&&this.resize({originalEvent:g})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(g){this._showTerrainWireframe!==g&&(this._showTerrainWireframe=g,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(g){this._speedIndexTiming!==g&&(this._speedIndexTiming=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(g){this._showTileAABBs!==g&&(this._showTileAABBs=g,g&&this._update())}_setCacheLimits(g,c){p.setCacheLimits(g,c)}get version(){return p.version}},NavigationControl:class{constructor(g){this.options=p.extend({},Rm,g),this._container=Ye("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",c=>c.preventDefault()),this.options.showZoom&&(p.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",c=>{this._map&&this._map.zoomIn({},{originalEvent:c})}),Ye("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",c=>{this._map&&this._map.zoomOut({},{originalEvent:c})}),Ye("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(p.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",c=>{const h=this._map;h&&(this.options.visualizePitch?h.resetNorthPitch({},{originalEvent:c}):h.resetNorth({},{originalEvent:c}))}),this._compassIcon=Ye("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const g=this._map;if(!g)return;const c=g.getZoom(),h=c===g.getMaxZoom(),_=c===g.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())}_rotateCompassArrow(){const g=this._map;if(!g)return;const c=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(g.transform.pitch*(Math.PI/180)),.5)}) rotateX(${g.transform.pitch}deg) rotateZ(${g.transform.angle*(180/Math.PI)}deg)`:`rotate(${g.transform.angle*(180/Math.PI)}deg)`;g._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=c)})}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),g.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&g.on("pitch",this._rotateCompassArrow),g.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new cs(g,this._compass,this.options.visualizePitch)),this._container}onRemove(){const g=this._map;g&&(this._container.remove(),this.options.showZoom&&g.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&g.off("pitch",this._rotateCompassArrow),g.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(g,c){const h=Ye("button",g,this._container);return h.type="button",h.addEventListener("click",c),h}_setButtonTitle(g,c){if(!this._map)return;const h=this._map._getUIString(`NavigationControl.${c}`);g.setAttribute("aria-label",h),g.firstElementChild&&g.firstElementChild.setAttribute("title",h)}},GeolocateControl:class extends p.Evented{constructor(g){super(),this.options=p.extend({geolocation:p.window.navigator.geolocation},Il,g),p.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Fs(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(g){return this._map=g,this._container=Ye("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(g){const c=(h=!!this.options.geolocation)=>{this._supportsGeolocation=h,g(h)};void 0!==this._supportsGeolocation?g(this._supportsGeolocation):void 0!==p.window.navigator.permissions?p.window.navigator.permissions.query({name:"geolocation"}).then(h=>c("denied"!==h.state)).catch(()=>c()):c()}_isOutOfMapMaxBounds(g){const c=this._map.getMaxBounds(),h=g.coords;return!!c&&(h.longitude<c.getWest()||h.longitude>c.getEast()||h.latitude<c.getSouth()||h.latitude>c.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(g){if(this._map){if(this._isOutOfMapMaxBounds(g))return this._setErrorState(),this.fire(new p.Event("outofmaxbounds",g)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=g,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(g),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(g),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("geolocate",g)),this._finish()}}_updateCamera(g){const c=new p.LngLat(g.coords.longitude,g.coords.latitude),h=g.coords.accuracy,_=this._map.getBearing(),w=p.extend({bearing:_},this.options.fitBoundsOptions);this._map.fitBounds(c.toBounds(h),w,{geolocateSource:!0})}_updateMarker(g){if(g){const c=new p.LngLat(g.coords.longitude,g.coords.latitude);this._accuracyCircleMarker.setLngLat(c).addTo(this._map),this._userLocationDotMarker.setLngLat(c).addTo(this._map),this._accuracy=g.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const g=this._map.transform,c=p.mercatorZfromAltitude(1,g._center.lat)*g.worldSize,h=Math.ceil(2*this._accuracy*c);this._circleElement.style.width=`${h}px`,this._circleElement.style.height=`${h}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(g){if(this._map){if(this.options.trackUserLocation)if(1===g.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===g.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("error",g)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(g){if(this._container.addEventListener("contextmenu",c=>c.preventDefault()),this._geolocateButton=Ye("button","mapboxgl-ctrl-geolocate",this._container),Ye("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===g){p.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c)}else{const c=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Ye("div","mapboxgl-user-location"),this._dotElement.appendChild(Ye("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Ye("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new fd({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Ye("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new fd({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",c=>{c.geolocateSource||"ACTIVE_LOCK"!==this._watchState||c.originalEvent&&"resize"===c.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new p.Event("trackuserlocationend")))})}_onDeviceOrientation(g){this._userLocationDotMarker&&(g.webkitCompassHeading?this._heading=g.webkitCompassHeading:!0===g.absolute&&(this._heading=-1*g.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return p.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new p.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new p.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new p.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let g;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(g={maximumAge:6e5,timeout:0},this._noTimeout=!0):(g=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,g),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const g=()=>{p.window.addEventListener("ondeviceorientationabsolute"in p.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==p.window.DeviceMotionEvent&&"function"==typeof p.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(c=>{"granted"===c&&g()}).catch(console.error):g()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),p.window.removeEventListener("deviceorientation",this._onDeviceOrientation),p.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:hd,ScaleControl:class{constructor(g){this.options=p.extend({},Qr,g),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch(c){return!1}}()||(this._setScale=Ml.bind(this)),p.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const g=this.options.maxWidth||100,c=this._map,h=c._containerHeight/2,_=c._containerWidth/2-g/2,w=c.unproject([_,h]),C=c.unproject([_+g,h]),I=w.distanceTo(C);if("imperial"===this.options.unit){const k=3.2808*I;k>5280?this._setScale(g,k/5280,"mile"):this._setScale(g,k,"foot")}else"nautical"===this.options.unit?this._setScale(g,I/1852,"nautical-mile"):I>=1e3?this._setScale(g,I/1e3,"kilometer"):this._setScale(g,I,"meter")}_setScale(g,c,h){const _=Ah(c),w=_/c;this._map._requestDomTask(()=>{this._container.style.width=g*w+"px",this._container.innerHTML="nautical-mile"!==h?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:h}).format(_):`${_}&nbsp;nm`})}onAdd(g){return this._map=g,this._language=g.getLanguage(),this._container=Ye("div","mapboxgl-ctrl mapboxgl-ctrl-scale",g.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(g){this._language=g,this._update()}setUnit(g){this.options.unit=g,this._update()}},FullscreenControl:class{constructor(g){this._fullscreen=!1,g&&g.container&&(g.container instanceof p.window.HTMLElement?this._container=g.container:p.warnOnce("Full screen control 'container' must be a DOM element.")),p.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in p.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in p.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=Ye("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",p.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,p.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!p.window.document.fullscreenEnabled&&!p.window.document.webkitFullscreenEnabled)}_setupUI(){const g=this._fullscreenButton=Ye("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Ye("span","mapboxgl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),p.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",g)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(p.window.document.fullscreenElement||p.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?p.window.document.exitFullscreen?p.window.document.exitFullscreen():p.window.document.webkitCancelFullScreen&&p.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends p.Evented{constructor(g){super(),this.options=p.extend(Object.create(Eh),g),p.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(g&&g.className?g.className.trim().split(/\s+/):[])}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&g.on("preclick",this._onClose),this.options.closeOnMove&&g.on("move",this._onClose),g.on("remove",this.remove),this._update(),g._addPopup(this),this._focusFirstElement(),this._trackPointer?(g.on("mousemove",this._onMouseEvent),g.on("mouseup",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")):g.on("move",this._update),this.fire(new p.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const g=this._map;return g&&(g.off("move",this._update),g.off("move",this._onClose),g.off("preclick",this._onClose),g.off("click",this._onClose),g.off("remove",this.remove),g.off("mousemove",this._onMouseEvent),g.off("mouseup",this._onMouseEvent),g.off("drag",this._onMouseEvent),g._canvasContainer&&g._canvasContainer.classList.remove("mapboxgl-track-pointer"),g._removePopup(this),this._map=void 0),this.fire(new p.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(g){this._lngLat=p.LngLat.convert(g),this._pos=null,this._trackPointer=!1,this._update();const c=this._map;return c&&(c.on("move",this._update),c.off("mousemove",this._onMouseEvent),c._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const g=this._map;return g&&(g.off("move",this._update),g.on("mousemove",this._onMouseEvent),g.on("drag",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(p.window.document.createTextNode(g))}setHTML(g){const c=p.window.document.createDocumentFragment(),h=p.window.document.createElement("body");let _;for(h.innerHTML=g;_=h.firstChild,_;)c.appendChild(_);return this.setDOMContent(c)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){let c=this._content;if(c)for(;c.hasChildNodes();)c.firstChild&&c.removeChild(c.firstChild);else c=this._content=Ye("div","mapboxgl-popup-content",this._container||void 0);if(c.appendChild(g),this.options.closeButton){const h=this._closeButton=Ye("button","mapboxgl-popup-close-button",c);h.type="button",h.setAttribute("aria-label","Close popup"),h.setAttribute("aria-hidden","true"),h.innerHTML="&#215;",h.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(g){return this._classList.add(g),this._updateClassList(),this}removeClassName(g){return this._classList.delete(g),this._updateClassList(),this}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){let c;return this._classList.delete(g)?c=!1:(this._classList.add(g),c=!0),this._updateClassList(),c}_onMouseEvent(g){this._update(g.point)}_getAnchor(g){if(this.options.anchor)return this.options.anchor;const c=this._map,h=this._container,_=this._pos;if(!c||!h||!_)return"bottom";const w=h.offsetWidth,C=h.offsetHeight,I=_.x<w/2,k=_.x>c.transform.width-w/2;if(_.y+g<C)return I?"top-left":k?"top-right":"top";if(_.y>c.transform.height-C){if(I)return"bottom-left";if(k)return"bottom-right"}return I?"left":k?"right":"bottom"}_updateClassList(){const g=this._container;if(!g)return;const c=[...this._classList];c.push("mapboxgl-popup"),this._anchor&&c.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&c.push("mapboxgl-popup-track-pointer"),g.className=c.join(" ")}_update(g){const c=this._map,h=this._content;if(!c||!this._lngLat&&!this._trackPointer||!h)return;let _=this._container;if(_||(_=this._container=Ye("div","mapboxgl-popup",c.getContainer()),this._tip=Ye("div","mapboxgl-popup-tip",_),_.appendChild(h)),this.options.maxWidth&&_.style.maxWidth!==this.options.maxWidth&&(_.style.maxWidth=this.options.maxWidth),c.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=kc(this._lngLat,this._pos,c.transform)),!this._trackPointer||g){const w=this._pos=this._trackPointer&&g?g:c.project(this._lngLat),C=Ih(this.options.offset),I=this._anchor=this._getAnchor(C.y),k=Ih(this.options.offset,I),R=w.add(k).round();c._requestDomTask(()=>{this._container&&I&&(this._container.style.transform=`${Dh[I]} translate(${R.x}px,${R.y}px)`)})}if(!this._marker&&c._showingGlobe()){const w=p.isLngLatBehindGlobe(c.transform,this._lngLat)?0:1;this._setOpacity(w)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(Jp);g&&g.focus()}_onClose(){this.remove()}_setOpacity(g){this._container&&(this._container.style.opacity=`${g}`),this._content&&(this._content.style.pointerEvents=g?"auto":"none")}},Marker:fd,Style:Aa,LngLat:p.LngLat,LngLatBounds:p.LngLatBounds,Point:p.pointGeometry,MercatorCoordinate:p.MercatorCoordinate,FreeCameraOptions:dr,Evented:p.Evented,config:p.config,prewarm:function(){Xn().acquire(Ln)},clearPrewarmedResources:function(){const g=Dn;g&&(g.isPreloaded()&&1===g.numActive()?(g.release(Ln),Dn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return p.config.ACCESS_TOKEN},set accessToken(g){p.config.ACCESS_TOKEN=g},get baseApiUrl(){return p.config.API_URL},set baseApiUrl(g){p.config.API_URL=g},get workerCount(){return An.workerCount},set workerCount(g){An.workerCount=g},get maxParallelImageRequests(){return p.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(g){p.config.MAX_PARALLEL_IMAGE_REQUESTS=g},clearStorage(g){p.clearTileCache(g)},workerUrl:"",workerClass:null,setNow:p.exported.setNow,restoreNow:p.exported.restoreNow};return Al}),Fe}()},599:function(rn){(function(){rn.exports={Disconnected:1,Preceding:2,Following:4,Contains:8,ContainedBy:16,ImplementationSpecific:32}}).call(this)},269:function(rn){(function(){rn.exports={Element:1,Attribute:2,Text:3,CData:4,EntityReference:5,EntityDeclaration:6,ProcessingInstruction:7,Comment:8,Document:9,DocType:10,DocumentFragment:11,NotationDeclaration:12,Declaration:201,Raw:202,AttributeDeclaration:203,ElementDeclaration:204,Dummy:205}}).call(this)},452:function(rn){(function(){var Ei,rt,Fe,Ue,ze,p,me,Et={}.hasOwnProperty;Ei=function($e,...Ge){var Ye,Ft,kt,Xe;if(ze(Object.assign))Object.assign.apply(null,arguments);else for(Ye=0,kt=Ge.length;Ye<kt;Ye++)if(null!=(Xe=Ge[Ye]))for(Ft in Xe)!Et.call(Xe,Ft)||($e[Ft]=Xe[Ft]);return $e},ze=function($e){return!!$e&&"[object Function]"===Object.prototype.toString.call($e)},p=function($e){var Ge;return!!$e&&("function"==(Ge=typeof $e)||"object"===Ge)},Fe=function($e){return ze(Array.isArray)?Array.isArray($e):"[object Array]"===Object.prototype.toString.call($e)},Ue=function($e){var Ge;if(Fe($e))return!$e.length;for(Ge in $e)if(Et.call($e,Ge))return!1;return!0},me=function($e){var Ge,Ye;return p($e)&&(Ye=Object.getPrototypeOf($e))&&(Ge=Ye.constructor)&&"function"==typeof Ge&&Ge instanceof Ge&&Function.prototype.toString.call(Ge)===Function.prototype.toString.call(Object)},rt=function($e){return ze($e.valueOf)?$e.valueOf():$e},rn.exports.assign=Ei,rn.exports.isFunction=ze,rn.exports.isObject=p,rn.exports.isArray=Fe,rn.exports.isEmpty=Ue,rn.exports.isPlainObject=me,rn.exports.getValue=rt}).call(this)},316:function(rn){(function(){rn.exports={None:0,OpenTag:1,InsideTag:2,CloseTag:3}}).call(this)},968:function(rn,Ei,rt){(function(){var Fe;Fe=rt(269),rt(563),rn.exports=function(){class p{constructor(Et,$e,Ge){if(this.parent=Et,this.parent&&(this.options=this.parent.options,this.stringify=this.parent.stringify),null==$e)throw new Error("Missing attribute name. "+this.debugInfo($e));this.name=this.stringify.name($e),this.value=this.stringify.attValue(Ge),this.type=Fe.Attribute,this.isId=!1,this.schemaTypeInfo=null}clone(){return Object.create(this)}toString(Et){return this.options.writer.attribute(this,this.options.writer.filterOptions(Et))}debugInfo(Et){return null==(Et=Et||this.name)?"parent: <"+this.parent.name+">":"attribute: {"+Et+"}, parent: <"+this.parent.name+">"}isEqualNode(Et){return!(Et.namespaceURI!==this.namespaceURI||Et.prefix!==this.prefix||Et.localName!==this.localName||Et.value!==this.value)}}return Object.defineProperty(p.prototype,"nodeType",{get:function(){return this.type}}),Object.defineProperty(p.prototype,"ownerElement",{get:function(){return this.parent}}),Object.defineProperty(p.prototype,"textContent",{get:function(){return this.value},set:function(me){return this.value=me||""}}),Object.defineProperty(p.prototype,"namespaceURI",{get:function(){return""}}),Object.defineProperty(p.prototype,"prefix",{get:function(){return""}}),Object.defineProperty(p.prototype,"localName",{get:function(){return this.name}}),Object.defineProperty(p.prototype,"specified",{get:function(){return!0}}),p}.call(this)}).call(this)},361:function(rn,Ei,rt){(function(){var Fe,ze;Fe=rt(269),ze=rt(182),rn.exports=class extends ze{constructor(me,Et){if(super(me),null==Et)throw new Error("Missing CDATA text. "+this.debugInfo());this.name="#cdata-section",this.type=Fe.CData,this.value=this.stringify.cdata(Et)}clone(){return Object.create(this)}toString(me){return this.options.writer.cdata(this,this.options.writer.filterOptions(me))}}}).call(this)},182:function(rn,Ei,rt){(function(){var Ue;Ue=rt(563),rn.exports=function(){class ze extends Ue{constructor(me){super(me),this.value=""}clone(){return Object.create(this)}substringData(me,Et){throw new Error("This DOM method is not implemented."+this.debugInfo())}appendData(me){throw new Error("This DOM method is not implemented."+this.debugInfo())}insertData(me,Et){throw new Error("This DOM method is not implemented."+this.debugInfo())}deleteData(me,Et){throw new Error("This DOM method is not implemented."+this.debugInfo())}replaceData(me,Et,$e){throw new Error("This DOM method is not implemented."+this.debugInfo())}isEqualNode(me){return!(!super.isEqualNode(me)||me.data!==this.data)}}return Object.defineProperty(ze.prototype,"data",{get:function(){return this.value},set:function(p){return this.value=p||""}}),Object.defineProperty(ze.prototype,"length",{get:function(){return this.value.length}}),Object.defineProperty(ze.prototype,"textContent",{get:function(){return this.value},set:function(p){return this.value=p||""}}),ze}.call(this)}).call(this)},516:function(rn,Ei,rt){(function(){var Fe,Ue;Fe=rt(269),Ue=rt(182),rn.exports=class extends Ue{constructor(me,Et){if(super(me),null==Et)throw new Error("Missing comment text. "+this.debugInfo());this.name="#comment",this.type=Fe.Comment,this.value=this.stringify.comment(Et)}clone(){return Object.create(this)}toString(me){return this.options.writer.comment(this,this.options.writer.filterOptions(me))}}}).call(this)},806:function(rn,Ei,rt){(function(){var Ue,ze;Ue=rt(276),ze=rt(735),rn.exports=function(){class p{constructor(){this.defaultParams={"canonical-form":!1,"cdata-sections":!1,comments:!1,"datatype-normalization":!1,"element-content-whitespace":!0,entities:!0,"error-handler":new Ue,infoset:!0,"validate-if-schema":!1,namespaces:!0,"namespace-declarations":!0,"normalize-characters":!1,"schema-location":"","schema-type":"","split-cdata-sections":!0,validate:!1,"well-formed":!0},this.params=Object.create(this.defaultParams)}getParameter(Et){return this.params.hasOwnProperty(Et)?this.params[Et]:null}canSetParameter(Et,$e){return!0}setParameter(Et,$e){return null!=$e?this.params[Et]=$e:delete this.params[Et]}}return Object.defineProperty(p.prototype,"parameterNames",{get:function(){return new ze(Object.keys(this.defaultParams))}}),p}.call(this)}).call(this)},276:function(rn){(function(){rn.exports=class{constructor(){}handleError(Fe){throw new Error(Fe)}}}).call(this)},906:function(rn){(function(){rn.exports=class{hasFeature(Fe,Ue){return!0}createDocumentType(Fe,Ue,ze){throw new Error("This DOM method is not implemented.")}createDocument(Fe,Ue,ze){throw new Error("This DOM method is not implemented.")}createHTMLDocument(Fe){throw new Error("This DOM method is not implemented.")}getFeature(Fe,Ue){throw new Error("This DOM method is not implemented.")}}}).call(this)},735:function(rn){(function(){rn.exports=function(){class rt{constructor(Ue){this.arr=Ue||[]}item(Ue){return this.arr[Ue]||null}contains(Ue){return-1!==this.arr.indexOf(Ue)}}return Object.defineProperty(rt.prototype,"length",{get:function(){return this.arr.length}}),rt}.call(this)}).call(this)},274:function(rn,Ei,rt){(function(){var Fe,ze;ze=rt(563),Fe=rt(269),rn.exports=class extends ze{constructor(me,Et,$e,Ge,Ye,Ft){if(super(me),null==Et)throw new Error("Missing DTD element name. "+this.debugInfo());if(null==$e)throw new Error("Missing DTD attribute name. "+this.debugInfo(Et));if(!Ge)throw new Error("Missing DTD attribute type. "+this.debugInfo(Et));if(!Ye)throw new Error("Missing DTD attribute default. "+this.debugInfo(Et));if(0!==Ye.indexOf("#")&&(Ye="#"+Ye),!Ye.match(/^(#REQUIRED|#IMPLIED|#FIXED|#DEFAULT)$/))throw new Error("Invalid default value type; expected: #REQUIRED, #IMPLIED, #FIXED or #DEFAULT. "+this.debugInfo(Et));if(Ft&&!Ye.match(/^(#FIXED|#DEFAULT)$/))throw new Error("Default value only applies to #FIXED or #DEFAULT. "+this.debugInfo(Et));this.elementName=this.stringify.name(Et),this.type=Fe.AttributeDeclaration,this.attributeName=this.stringify.name($e),this.attributeType=this.stringify.dtdAttType(Ge),Ft&&(this.defaultValue=this.stringify.dtdAttDefault(Ft)),this.defaultValueType=Ye}toString(me){return this.options.writer.dtdAttList(this,this.options.writer.filterOptions(me))}}}).call(this)},68:function(rn,Ei,rt){(function(){var Fe,ze;ze=rt(563),Fe=rt(269),rn.exports=class extends ze{constructor(me,Et,$e){if(super(me),null==Et)throw new Error("Missing DTD element name. "+this.debugInfo());$e||($e="(#PCDATA)"),Array.isArray($e)&&($e="("+$e.join(",")+")"),this.name=this.stringify.name(Et),this.type=Fe.ElementDeclaration,this.value=this.stringify.dtdElementValue($e)}toString(me){return this.options.writer.dtdElement(this,this.options.writer.filterOptions(me))}}}).call(this)},349:function(rn,Ei,rt){(function(){var Fe,ze,p;({isObject:p}=rt(452)),ze=rt(563),Fe=rt(269),rn.exports=function(){class me extends ze{constructor($e,Ge,Ye,Ft){if(super($e),null==Ye)throw new Error("Missing DTD entity name. "+this.debugInfo(Ye));if(null==Ft)throw new Error("Missing DTD entity value. "+this.debugInfo(Ye));if(this.pe=!!Ge,this.name=this.stringify.name(Ye),this.type=Fe.EntityDeclaration,p(Ft)){if(!Ft.pubID&&!Ft.sysID)throw new Error("Public and/or system identifiers are required for an external entity. "+this.debugInfo(Ye));if(Ft.pubID&&!Ft.sysID)throw new Error("System identifier is required for a public external entity. "+this.debugInfo(Ye));if(this.internal=!1,null!=Ft.pubID&&(this.pubID=this.stringify.dtdPubID(Ft.pubID)),null!=Ft.sysID&&(this.sysID=this.stringify.dtdSysID(Ft.sysID)),null!=Ft.nData&&(this.nData=this.stringify.dtdNData(Ft.nData)),this.pe&&this.nData)throw new Error("Notation declaration is not allowed in a parameter entity. "+this.debugInfo(Ye))}else this.value=this.stringify.dtdEntityValue(Ft),this.internal=!0}toString($e){return this.options.writer.dtdEntity(this,this.options.writer.filterOptions($e))}}return Object.defineProperty(me.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(me.prototype,"systemId",{get:function(){return this.sysID}}),Object.defineProperty(me.prototype,"notationName",{get:function(){return this.nData||null}}),Object.defineProperty(me.prototype,"inputEncoding",{get:function(){return null}}),Object.defineProperty(me.prototype,"xmlEncoding",{get:function(){return null}}),Object.defineProperty(me.prototype,"xmlVersion",{get:function(){return null}}),me}.call(this)}).call(this)},87:function(rn,Ei,rt){(function(){var Fe,ze;ze=rt(563),Fe=rt(269),rn.exports=function(){class p extends ze{constructor(Et,$e,Ge){if(super(Et),null==$e)throw new Error("Missing DTD notation name. "+this.debugInfo($e));if(!Ge.pubID&&!Ge.sysID)throw new Error("Public or system identifiers are required for an external entity. "+this.debugInfo($e));this.name=this.stringify.name($e),this.type=Fe.NotationDeclaration,null!=Ge.pubID&&(this.pubID=this.stringify.dtdPubID(Ge.pubID)),null!=Ge.sysID&&(this.sysID=this.stringify.dtdSysID(Ge.sysID))}toString(Et){return this.options.writer.dtdNotation(this,this.options.writer.filterOptions(Et))}}return Object.defineProperty(p.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(p.prototype,"systemId",{get:function(){return this.sysID}}),p}.call(this)}).call(this)},789:function(rn,Ei,rt){(function(){var Fe,ze,p;({isObject:p}=rt(452)),ze=rt(563),Fe=rt(269),rn.exports=class extends ze{constructor(Et,$e,Ge,Ye){super(Et),p($e)&&({version:$e,encoding:Ge,standalone:Ye}=$e),$e||($e="1.0"),this.type=Fe.Declaration,this.version=this.stringify.xmlVersion($e),null!=Ge&&(this.encoding=this.stringify.xmlEncoding(Ge)),null!=Ye&&(this.standalone=this.stringify.xmlStandalone(Ye))}toString(Et){return this.options.writer.declaration(this,this.options.writer.filterOptions(Et))}}}).call(this)},195:function(rn,Ei,rt){(function(){var Fe,Ue,ze,p,me,$e,Ge,Ye;({isObject:Ye}=rt(452)),Ge=rt(563),Fe=rt(269),Ue=rt(274),p=rt(349),ze=rt(68),me=rt(87),$e=rt(264),rn.exports=function(){class Ft extends Ge{constructor(Xe,St,$t){var dn,Ne,jn,mt;if(super(Xe),this.type=Fe.DocType,Xe.children)for(Ne=0,jn=(mt=Xe.children).length;Ne<jn;Ne++)if((dn=mt[Ne]).type===Fe.Element){this.name=dn.name;break}this.documentObject=Xe,Ye(St)&&({pubID:St,sysID:$t}=St),null==$t&&([$t,St]=[St,$t]),null!=St&&(this.pubID=this.stringify.dtdPubID(St)),null!=$t&&(this.sysID=this.stringify.dtdSysID($t))}element(Xe,St){var $t;return $t=new ze(this,Xe,St),this.children.push($t),this}attList(Xe,St,$t,dn,Ne){var jn;return jn=new Ue(this,Xe,St,$t,dn,Ne),this.children.push(jn),this}entity(Xe,St){var $t;return $t=new p(this,!1,Xe,St),this.children.push($t),this}pEntity(Xe,St){var $t;return $t=new p(this,!0,Xe,St),this.children.push($t),this}notation(Xe,St){var $t;return $t=new me(this,Xe,St),this.children.push($t),this}toString(Xe){return this.options.writer.docType(this,this.options.writer.filterOptions(Xe))}ele(Xe,St){return this.element(Xe,St)}att(Xe,St,$t,dn,Ne){return this.attList(Xe,St,$t,dn,Ne)}ent(Xe,St){return this.entity(Xe,St)}pent(Xe,St){return this.pEntity(Xe,St)}not(Xe,St){return this.notation(Xe,St)}up(){return this.root()||this.documentObject}isEqualNode(Xe){return!(!super.isEqualNode(Xe)||Xe.name!==this.name||Xe.publicId!==this.publicId||Xe.systemId!==this.systemId)}}return Object.defineProperty(Ft.prototype,"entities",{get:function(){var kt,Xe,St,$t,dn;for($t={},Xe=0,St=(dn=this.children).length;Xe<St;Xe++)(kt=dn[Xe]).type===Fe.EntityDeclaration&&!kt.pe&&($t[kt.name]=kt);return new $e($t)}}),Object.defineProperty(Ft.prototype,"notations",{get:function(){var kt,Xe,St,$t,dn;for($t={},Xe=0,St=(dn=this.children).length;Xe<St;Xe++)(kt=dn[Xe]).type===Fe.NotationDeclaration&&($t[kt.name]=kt);return new $e($t)}}),Object.defineProperty(Ft.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(Ft.prototype,"systemId",{get:function(){return this.sysID}}),Object.defineProperty(Ft.prototype,"internalSubset",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Ft}.call(this)}).call(this)},519:function(rn,Ei,rt){(function(){var Fe,Ue,ze,me,Et,$e,Ge;({isPlainObject:Ge}=rt(452)),ze=rt(906),Ue=rt(806),me=rt(563),Fe=rt(269),$e=rt(41),Et=rt(354),rn.exports=function(){class Ye extends me{constructor(kt){super(null),this.name="#document",this.type=Fe.Document,this.documentURI=null,this.domConfig=new Ue,kt||(kt={}),kt.writer||(kt.writer=new Et),this.options=kt,this.stringify=new $e(kt)}end(kt){var Xe;return Xe={},kt?Ge(kt)&&(Xe=kt,kt=this.options.writer):kt=this.options.writer,kt.document(this,kt.filterOptions(Xe))}toString(kt){return this.options.writer.document(this,this.options.writer.filterOptions(kt))}createElement(kt){throw new Error("This DOM method is not implemented."+this.debugInfo())}createDocumentFragment(){throw new Error("This DOM method is not implemented."+this.debugInfo())}createTextNode(kt){throw new Error("This DOM method is not implemented."+this.debugInfo())}createComment(kt){throw new Error("This DOM method is not implemented."+this.debugInfo())}createCDATASection(kt){throw new Error("This DOM method is not implemented."+this.debugInfo())}createProcessingInstruction(kt,Xe){throw new Error("This DOM method is not implemented."+this.debugInfo())}createAttribute(kt){throw new Error("This DOM method is not implemented."+this.debugInfo())}createEntityReference(kt){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagName(kt){throw new Error("This DOM method is not implemented."+this.debugInfo())}importNode(kt,Xe){throw new Error("This DOM method is not implemented."+this.debugInfo())}createElementNS(kt,Xe){throw new Error("This DOM method is not implemented."+this.debugInfo())}createAttributeNS(kt,Xe){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagNameNS(kt,Xe){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementById(kt){throw new Error("This DOM method is not implemented."+this.debugInfo())}adoptNode(kt){throw new Error("This DOM method is not implemented."+this.debugInfo())}normalizeDocument(){throw new Error("This DOM method is not implemented."+this.debugInfo())}renameNode(kt,Xe,St){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByClassName(kt){throw new Error("This DOM method is not implemented."+this.debugInfo())}createEvent(kt){throw new Error("This DOM method is not implemented."+this.debugInfo())}createRange(){throw new Error("This DOM method is not implemented."+this.debugInfo())}createNodeIterator(kt,Xe,St){throw new Error("This DOM method is not implemented."+this.debugInfo())}createTreeWalker(kt,Xe,St){throw new Error("This DOM method is not implemented."+this.debugInfo())}}return Object.defineProperty(Ye.prototype,"implementation",{value:new ze}),Object.defineProperty(Ye.prototype,"doctype",{get:function(){var Ft,kt,Xe,St;for(kt=0,Xe=(St=this.children).length;kt<Xe;kt++)if((Ft=St[kt]).type===Fe.DocType)return Ft;return null}}),Object.defineProperty(Ye.prototype,"documentElement",{get:function(){return this.rootObject||null}}),Object.defineProperty(Ye.prototype,"inputEncoding",{get:function(){return null}}),Object.defineProperty(Ye.prototype,"strictErrorChecking",{get:function(){return!1}}),Object.defineProperty(Ye.prototype,"xmlEncoding",{get:function(){return 0!==this.children.length&&this.children[0].type===Fe.Declaration?this.children[0].encoding:null}}),Object.defineProperty(Ye.prototype,"xmlStandalone",{get:function(){return 0!==this.children.length&&this.children[0].type===Fe.Declaration&&"yes"===this.children[0].standalone}}),Object.defineProperty(Ye.prototype,"xmlVersion",{get:function(){return 0!==this.children.length&&this.children[0].type===Fe.Declaration?this.children[0].version:"1.0"}}),Object.defineProperty(Ye.prototype,"URL",{get:function(){return this.documentURI}}),Object.defineProperty(Ye.prototype,"origin",{get:function(){return null}}),Object.defineProperty(Ye.prototype,"compatMode",{get:function(){return null}}),Object.defineProperty(Ye.prototype,"characterSet",{get:function(){return null}}),Object.defineProperty(Ye.prototype,"contentType",{get:function(){return null}}),Ye}.call(this)}).call(this)},105:function(rn,Ei,rt){(function(){var Fe,Ue,ze,p,me,Et,$e,Ge,Ye,Ft,kt,Xe,$t,dn,Ne,jn,mt,gi,Ie,Se,Ae,ee,nt={}.hasOwnProperty;({isObject:Ae,isFunction:Se,isPlainObject:ee,getValue:Ie}=rt(452)),Fe=rt(269),Xe=rt(519),$t=rt(352),p=rt(361),me=rt(516),Ne=rt(942),gi=rt(474),dn=rt(666),Ft=rt(789),kt=rt(195),Et=rt(274),Ge=rt(349),$e=rt(68),Ye=rt(87),ze=rt(968),mt=rt(41),jn=rt(354),Ue=rt(316),rn.exports=class{constructor(pe,et,Ke){var sn;this.name="?xml",this.type=Fe.Document,pe||(pe={}),sn={},pe.writer?ee(pe.writer)&&(sn=pe.writer,pe.writer=new jn):pe.writer=new jn,this.options=pe,this.writer=pe.writer,this.writerOptions=this.writer.filterOptions(sn),this.stringify=new mt(pe),this.onDataCallback=et||function(){},this.onEndCallback=Ke||function(){},this.currentNode=null,this.currentLevel=-1,this.openTags={},this.documentStarted=!1,this.documentCompleted=!1,this.root=null}createChildNode(pe){var Ke,sn,wn,Un,Fi,en,ti;switch(pe.type){case Fe.CData:this.cdata(pe.value);break;case Fe.Comment:this.comment(pe.value);break;case Fe.Element:for(Ke in sn={},en=pe.attribs)!nt.call(en,Ke)||(sn[Ke]=en[Ke].value);this.node(pe.name,sn);break;case Fe.Dummy:this.dummy();break;case Fe.Raw:this.raw(pe.value);break;case Fe.Text:this.text(pe.value);break;case Fe.ProcessingInstruction:this.instruction(pe.target,pe.value);break;default:throw new Error("This XML node type is not supported in a JS object: "+pe.constructor.name)}for(Un=0,Fi=(ti=pe.children).length;Un<Fi;Un++)this.createChildNode(wn=ti[Un]),wn.type===Fe.Element&&this.up();return this}dummy(){return this}node(pe,et,Ke){if(null==pe)throw new Error("Missing node name.");if(this.root&&-1===this.currentLevel)throw new Error("Document can only have one root node. "+this.debugInfo(pe));return this.openCurrent(),pe=Ie(pe),null==et&&(et={}),et=Ie(et),Ae(et)||([Ke,et]=[et,Ke]),this.currentNode=new $t(this,pe,et),this.currentNode.children=!1,this.currentLevel++,this.openTags[this.currentLevel]=this.currentNode,null!=Ke&&this.text(Ke),this}element(pe,et,Ke){var sn,wn,Un,Fi,en,ti;if(this.currentNode&&this.currentNode.type===Fe.DocType)this.dtdElement(...arguments);else if(Array.isArray(pe)||Ae(pe)||Se(pe))for(Fi=this.options.noValidation,this.options.noValidation=!0,(ti=new Xe(this.options).element("TEMP_ROOT")).element(pe),this.options.noValidation=Fi,wn=0,Un=(en=ti.children).length;wn<Un;wn++)this.createChildNode(sn=en[wn]),sn.type===Fe.Element&&this.up();else this.node(pe,et,Ke);return this}attribute(pe,et){var Ke;if(!this.currentNode||this.currentNode.children)throw new Error("att() can only be used immediately after an ele() call in callback mode. "+this.debugInfo(pe));if(null!=pe&&(pe=Ie(pe)),Ae(pe))for(Ke in pe)!nt.call(pe,Ke)||this.attribute(Ke,pe[Ke]);else Se(et)&&(et=et.apply()),this.options.keepNullAttributes&&null==et?this.currentNode.attribs[pe]=new ze(this,pe,""):null!=et&&(this.currentNode.attribs[pe]=new ze(this,pe,et));return this}text(pe){var et;return this.openCurrent(),et=new gi(this,pe),this.onData(this.writer.text(et,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}cdata(pe){var et;return this.openCurrent(),et=new p(this,pe),this.onData(this.writer.cdata(et,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}comment(pe){var et;return this.openCurrent(),et=new me(this,pe),this.onData(this.writer.comment(et,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}raw(pe){var et;return this.openCurrent(),et=new Ne(this,pe),this.onData(this.writer.raw(et,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}instruction(pe,et){var Ke,sn,Un,Fi;if(this.openCurrent(),null!=pe&&(pe=Ie(pe)),null!=et&&(et=Ie(et)),Array.isArray(pe))for(Ke=0,Un=pe.length;Ke<Un;Ke++)this.instruction(sn=pe[Ke]);else if(Ae(pe))for(sn in pe)!nt.call(pe,sn)||this.instruction(sn,pe[sn]);else Se(et)&&(et=et.apply()),Fi=new dn(this,pe,et),this.onData(this.writer.processingInstruction(Fi,this.writerOptions,this.currentLevel+1),this.currentLevel+1);return this}declaration(pe,et,Ke){var sn;if(this.openCurrent(),this.documentStarted)throw new Error("declaration() must be the first node.");return sn=new Ft(this,pe,et,Ke),this.onData(this.writer.declaration(sn,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}doctype(pe,et,Ke){if(this.openCurrent(),null==pe)throw new Error("Missing root node name.");if(this.root)throw new Error("dtd() must come before the root node.");return this.currentNode=new kt(this,et,Ke),this.currentNode.rootNodeName=pe,this.currentNode.children=!1,this.currentLevel++,this.openTags[this.currentLevel]=this.currentNode,this}dtdElement(pe,et){var Ke;return this.openCurrent(),Ke=new $e(this,pe,et),this.onData(this.writer.dtdElement(Ke,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}attList(pe,et,Ke,sn,wn){var Un;return this.openCurrent(),Un=new Et(this,pe,et,Ke,sn,wn),this.onData(this.writer.dtdAttList(Un,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}entity(pe,et){var Ke;return this.openCurrent(),Ke=new Ge(this,!1,pe,et),this.onData(this.writer.dtdEntity(Ke,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}pEntity(pe,et){var Ke;return this.openCurrent(),Ke=new Ge(this,!0,pe,et),this.onData(this.writer.dtdEntity(Ke,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}notation(pe,et){var Ke;return this.openCurrent(),Ke=new Ye(this,pe,et),this.onData(this.writer.dtdNotation(Ke,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}up(){if(this.currentLevel<0)throw new Error("The document node has no parent.");return this.currentNode?(this.currentNode.children?this.closeNode(this.currentNode):this.openNode(this.currentNode),this.currentNode=null):this.closeNode(this.openTags[this.currentLevel]),delete this.openTags[this.currentLevel],this.currentLevel--,this}end(){for(;this.currentLevel>=0;)this.up();return this.onEnd()}openCurrent(){if(this.currentNode)return this.currentNode.children=!0,this.openNode(this.currentNode)}openNode(pe){var Ke,sn,wn;if(!pe.isOpen){if(!this.root&&0===this.currentLevel&&pe.type===Fe.Element&&(this.root=pe),Ke="",pe.type===Fe.Element){for(sn in this.writerOptions.state=Ue.OpenTag,Ke=this.writer.indent(pe,this.writerOptions,this.currentLevel)+"<"+pe.name,wn=pe.attribs)!nt.call(wn,sn)||(Ke+=this.writer.attribute(wn[sn],this.writerOptions,this.currentLevel));Ke+=(pe.children?">":"/>")+this.writer.endline(pe,this.writerOptions,this.currentLevel),this.writerOptions.state=Ue.InsideTag}else this.writerOptions.state=Ue.OpenTag,Ke=this.writer.indent(pe,this.writerOptions,this.currentLevel)+"<!DOCTYPE "+pe.rootNodeName,pe.pubID&&pe.sysID?Ke+=' PUBLIC "'+pe.pubID+'" "'+pe.sysID+'"':pe.sysID&&(Ke+=' SYSTEM "'+pe.sysID+'"'),pe.children?(Ke+=" [",this.writerOptions.state=Ue.InsideTag):(this.writerOptions.state=Ue.CloseTag,Ke+=">"),Ke+=this.writer.endline(pe,this.writerOptions,this.currentLevel);return this.onData(Ke,this.currentLevel),pe.isOpen=!0}}closeNode(pe){var et;if(!pe.isClosed)return"",this.writerOptions.state=Ue.CloseTag,et=pe.type===Fe.Element?this.writer.indent(pe,this.writerOptions,this.currentLevel)+"</"+pe.name+">"+this.writer.endline(pe,this.writerOptions,this.currentLevel):this.writer.indent(pe,this.writerOptions,this.currentLevel)+"]>"+this.writer.endline(pe,this.writerOptions,this.currentLevel),this.writerOptions.state=Ue.None,this.onData(et,this.currentLevel),pe.isClosed=!0}onData(pe,et){return this.documentStarted=!0,this.onDataCallback(pe,et+1)}onEnd(){return this.documentCompleted=!0,this.onEndCallback()}debugInfo(pe){return null==pe?"":"node: <"+pe+">"}ele(){return this.element(...arguments)}nod(pe,et,Ke){return this.node(pe,et,Ke)}txt(pe){return this.text(pe)}dat(pe){return this.cdata(pe)}com(pe){return this.comment(pe)}ins(pe,et){return this.instruction(pe,et)}dec(pe,et,Ke){return this.declaration(pe,et,Ke)}dtd(pe,et,Ke){return this.doctype(pe,et,Ke)}e(pe,et,Ke){return this.element(pe,et,Ke)}n(pe,et,Ke){return this.node(pe,et,Ke)}t(pe){return this.text(pe)}d(pe){return this.cdata(pe)}c(pe){return this.comment(pe)}r(pe){return this.raw(pe)}i(pe,et){return this.instruction(pe,et)}att(){return this.currentNode&&this.currentNode.type===Fe.DocType?this.attList(...arguments):this.attribute(...arguments)}a(){return this.currentNode&&this.currentNode.type===Fe.DocType?this.attList(...arguments):this.attribute(...arguments)}ent(pe,et){return this.entity(pe,et)}pent(pe,et){return this.pEntity(pe,et)}not(pe,et){return this.notation(pe,et)}}}).call(this)},173:function(rn,Ei,rt){(function(){var Fe,ze;ze=rt(563),Fe=rt(269),rn.exports=class extends ze{constructor(me){super(me),this.type=Fe.Dummy}clone(){return Object.create(this)}toString(me){return""}}}).call(this)},352:function(rn,Ei,rt){(function(){var Fe,Ue,p,me,Et,$e,Ge,Ye={}.hasOwnProperty;({isObject:Ge,isFunction:$e,getValue:Et}=rt(452)),me=rt(563),Fe=rt(269),Ue=rt(968),p=rt(264),rn.exports=function(){class Ft extends me{constructor(Xe,St,$t){var dn,Ne,jn,mt;if(super(Xe),null==St)throw new Error("Missing element name. "+this.debugInfo());if(this.name=this.stringify.name(St),this.type=Fe.Element,this.attribs={},this.schemaTypeInfo=null,null!=$t&&this.attribute($t),Xe.type===Fe.Document&&(this.isRoot=!0,this.documentObject=Xe,Xe.rootObject=this,Xe.children))for(Ne=0,jn=(mt=Xe.children).length;Ne<jn;Ne++)if((dn=mt[Ne]).type===Fe.DocType){dn.name=this.name;break}}clone(){var St,$t,dn;for(St in($t=Object.create(this)).isRoot&&($t.documentObject=null),$t.attribs={},dn=this.attribs)!Ye.call(dn,St)||($t.attribs[St]=dn[St].clone());return $t.children=[],this.children.forEach(function(Ne){var jn;return(jn=Ne.clone()).parent=$t,$t.children.push(jn)}),$t}attribute(Xe,St){var $t;if(null!=Xe&&(Xe=Et(Xe)),Ge(Xe))for($t in Xe)!Ye.call(Xe,$t)||this.attribute($t,Xe[$t]);else $e(St)&&(St=St.apply()),this.options.keepNullAttributes&&null==St?this.attribs[Xe]=new Ue(this,Xe,""):null!=St&&(this.attribs[Xe]=new Ue(this,Xe,St));return this}removeAttribute(Xe){var $t,dn;if(null==Xe)throw new Error("Missing attribute name. "+this.debugInfo());if(Xe=Et(Xe),Array.isArray(Xe))for($t=0,dn=Xe.length;$t<dn;$t++)delete this.attribs[Xe[$t]];else delete this.attribs[Xe];return this}toString(Xe){return this.options.writer.element(this,this.options.writer.filterOptions(Xe))}att(Xe,St){return this.attribute(Xe,St)}a(Xe,St){return this.attribute(Xe,St)}getAttribute(Xe){return this.attribs.hasOwnProperty(Xe)?this.attribs[Xe].value:null}setAttribute(Xe,St){throw new Error("This DOM method is not implemented."+this.debugInfo())}getAttributeNode(Xe){return this.attribs.hasOwnProperty(Xe)?this.attribs[Xe]:null}setAttributeNode(Xe){throw new Error("This DOM method is not implemented."+this.debugInfo())}removeAttributeNode(Xe){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagName(Xe){throw new Error("This DOM method is not implemented."+this.debugInfo())}getAttributeNS(Xe,St){throw new Error("This DOM method is not implemented."+this.debugInfo())}setAttributeNS(Xe,St,$t){throw new Error("This DOM method is not implemented."+this.debugInfo())}removeAttributeNS(Xe,St){throw new Error("This DOM method is not implemented."+this.debugInfo())}getAttributeNodeNS(Xe,St){throw new Error("This DOM method is not implemented."+this.debugInfo())}setAttributeNodeNS(Xe){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagNameNS(Xe,St){throw new Error("This DOM method is not implemented."+this.debugInfo())}hasAttribute(Xe){return this.attribs.hasOwnProperty(Xe)}hasAttributeNS(Xe,St){throw new Error("This DOM method is not implemented."+this.debugInfo())}setIdAttribute(Xe,St){return this.attribs.hasOwnProperty(Xe)?this.attribs[Xe].isId:St}setIdAttributeNS(Xe,St,$t){throw new Error("This DOM method is not implemented."+this.debugInfo())}setIdAttributeNode(Xe,St){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagName(Xe){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagNameNS(Xe,St){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByClassName(Xe){throw new Error("This DOM method is not implemented."+this.debugInfo())}isEqualNode(Xe){var St,$t,dn;if(!super.isEqualNode(Xe)||Xe.namespaceURI!==this.namespaceURI||Xe.prefix!==this.prefix||Xe.localName!==this.localName||Xe.attribs.length!==this.attribs.length)return!1;for(St=$t=0,dn=this.attribs.length-1;0<=dn?$t<=dn:$t>=dn;St=0<=dn?++$t:--$t)if(!this.attribs[St].isEqualNode(Xe.attribs[St]))return!1;return!0}}return Object.defineProperty(Ft.prototype,"tagName",{get:function(){return this.name}}),Object.defineProperty(Ft.prototype,"namespaceURI",{get:function(){return""}}),Object.defineProperty(Ft.prototype,"prefix",{get:function(){return""}}),Object.defineProperty(Ft.prototype,"localName",{get:function(){return this.name}}),Object.defineProperty(Ft.prototype,"id",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(Ft.prototype,"className",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(Ft.prototype,"classList",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(Ft.prototype,"attributes",{get:function(){return(!this.attributeMap||!this.attributeMap.nodes)&&(this.attributeMap=new p(this.attribs)),this.attributeMap}}),Ft}.call(this)}).call(this)},264:function(rn){(function(){rn.exports=function(){class rt{constructor(Ue){this.nodes=Ue}clone(){return this.nodes=null}getNamedItem(Ue){return this.nodes[Ue]}setNamedItem(Ue){var ze;return ze=this.nodes[Ue.nodeName],this.nodes[Ue.nodeName]=Ue,ze||null}removeNamedItem(Ue){var ze;return ze=this.nodes[Ue],delete this.nodes[Ue],ze||null}item(Ue){return this.nodes[Object.keys(this.nodes)[Ue]]||null}getNamedItemNS(Ue,ze){throw new Error("This DOM method is not implemented.")}setNamedItemNS(Ue){throw new Error("This DOM method is not implemented.")}removeNamedItemNS(Ue,ze){throw new Error("This DOM method is not implemented.")}}return Object.defineProperty(rt.prototype,"length",{get:function(){return Object.keys(this.nodes).length||0}}),rt}.call(this)}).call(this)},563:function(rn,Ei,rt){(function(){var Fe,Ue,ze,p,me,Et,$e,Ge,kt,Xe,St,$t,dn,Ne,jn,mt,gi={}.hasOwnProperty,Ie=[].splice;({isObject:mt,isFunction:jn,isEmpty:Ne,getValue:dn}=rt(452)),Ge=null,ze=null,p=null,me=null,Et=null,St=null,$t=null,Xe=null,$e=null,Ue=null,kt=null,Fe=null,rn.exports=function(){class Se{constructor(ee){this.parent=ee,this.parent&&(this.options=this.parent.options,this.stringify=this.parent.stringify),this.value=null,this.children=[],this.baseURI=null,Ge||(Ge=rt(352),ze=rt(361),p=rt(516),me=rt(789),Et=rt(195),St=rt(942),$t=rt(474),Xe=rt(666),$e=rt(173),Ue=rt(269),kt=rt(112),rt(264),Fe=rt(599))}setParent(ee){var at,pe,et,Ke;for(this.parent=ee,ee&&(this.options=ee.options,this.stringify=ee.stringify),Ke=[],at=0,pe=(et=this.children).length;at<pe;at++)Ke.push(et[at].setParent(this));return Ke}element(ee,nt,at){var pe,Ke,sn,wn,Un,Fi,en,ti;if(Un=null,null===nt&&null==at&&([nt,at]=[{},null]),null==nt&&(nt={}),nt=dn(nt),mt(nt)||([at,nt]=[nt,at]),null!=ee&&(ee=dn(ee)),Array.isArray(ee))for(Ke=0,Fi=ee.length;Ke<Fi;Ke++)Un=this.element(ee[Ke]);else if(jn(ee))Un=this.element(ee.apply());else if(mt(ee)){for(wn in ee)if(gi.call(ee,wn))if(jn(ti=ee[wn])&&(ti=ti.apply()),!this.options.ignoreDecorators&&this.stringify.convertAttKey&&0===wn.indexOf(this.stringify.convertAttKey))Un=this.attribute(wn.substr(this.stringify.convertAttKey.length),ti);else if(!this.options.separateArrayItems&&Array.isArray(ti)&&Ne(ti))Un=this.dummy();else if(mt(ti)&&Ne(ti))Un=this.element(wn);else if(this.options.keepNullNodes||null!=ti)if(!this.options.separateArrayItems&&Array.isArray(ti))for(sn=0,en=ti.length;sn<en;sn++)(pe={})[wn]=ti[sn],Un=this.element(pe);else mt(ti)?!this.options.ignoreDecorators&&this.stringify.convertTextKey&&0===wn.indexOf(this.stringify.convertTextKey)?Un=this.element(ti):(Un=this.element(wn)).element(ti):Un=this.element(wn,ti);else Un=this.dummy()}else Un=this.options.keepNullNodes||null!==at?!this.options.ignoreDecorators&&this.stringify.convertTextKey&&0===ee.indexOf(this.stringify.convertTextKey)?this.text(at):!this.options.ignoreDecorators&&this.stringify.convertCDataKey&&0===ee.indexOf(this.stringify.convertCDataKey)?this.cdata(at):!this.options.ignoreDecorators&&this.stringify.convertCommentKey&&0===ee.indexOf(this.stringify.convertCommentKey)?this.comment(at):!this.options.ignoreDecorators&&this.stringify.convertRawKey&&0===ee.indexOf(this.stringify.convertRawKey)?this.raw(at):!this.options.ignoreDecorators&&this.stringify.convertPIKey&&0===ee.indexOf(this.stringify.convertPIKey)?this.instruction(ee.substr(this.stringify.convertPIKey.length),at):this.node(ee,nt,at):this.dummy();if(null==Un)throw new Error("Could not create any elements with: "+ee+". "+this.debugInfo());return Un}insertBefore(ee,nt,at){var pe,et,Ke,sn,wn;if(null!=ee&&ee.type)return sn=nt,(Ke=ee).setParent(this),sn?(et=children.indexOf(sn),wn=children.splice(et),children.push(Ke),Array.prototype.push.apply(children,wn)):children.push(Ke),Ke;if(this.isRoot)throw new Error("Cannot insert elements at root level. "+this.debugInfo(ee));return et=this.parent.children.indexOf(this),wn=this.parent.children.splice(et),pe=this.parent.element(ee,nt,at),Array.prototype.push.apply(this.parent.children,wn),pe}insertAfter(ee,nt,at){var pe,et,Ke;if(this.isRoot)throw new Error("Cannot insert elements at root level. "+this.debugInfo(ee));return et=this.parent.children.indexOf(this),Ke=this.parent.children.splice(et+1),pe=this.parent.element(ee,nt,at),Array.prototype.push.apply(this.parent.children,Ke),pe}remove(){var ee;if(this.isRoot)throw new Error("Cannot remove the root element. "+this.debugInfo());return ee=this.parent.children.indexOf(this),Ie.apply(this.parent.children,[ee,ee-ee+1].concat([])),this.parent}node(ee,nt,at){var pe;return null!=ee&&(ee=dn(ee)),nt||(nt={}),nt=dn(nt),mt(nt)||([at,nt]=[nt,at]),pe=new Ge(this,ee,nt),null!=at&&pe.text(at),this.children.push(pe),pe}text(ee){var nt;return mt(ee)&&this.element(ee),nt=new $t(this,ee),this.children.push(nt),this}cdata(ee){var nt;return nt=new ze(this,ee),this.children.push(nt),this}comment(ee){var nt;return nt=new p(this,ee),this.children.push(nt),this}commentBefore(ee){var at,pe;return at=this.parent.children.indexOf(this),pe=this.parent.children.splice(at),this.parent.comment(ee),Array.prototype.push.apply(this.parent.children,pe),this}commentAfter(ee){var at,pe;return at=this.parent.children.indexOf(this),pe=this.parent.children.splice(at+1),this.parent.comment(ee),Array.prototype.push.apply(this.parent.children,pe),this}raw(ee){var nt;return nt=new St(this,ee),this.children.push(nt),this}dummy(){return new $e(this)}instruction(ee,nt){var at,et,Ke,sn;if(null!=ee&&(ee=dn(ee)),null!=nt&&(nt=dn(nt)),Array.isArray(ee))for(Ke=0,sn=ee.length;Ke<sn;Ke++)this.instruction(at=ee[Ke]);else if(mt(ee))for(at in ee)!gi.call(ee,at)||this.instruction(at,ee[at]);else jn(nt)&&(nt=nt.apply()),et=new Xe(this,ee,nt),this.children.push(et);return this}instructionBefore(ee,nt){var pe,et;return pe=this.parent.children.indexOf(this),et=this.parent.children.splice(pe),this.parent.instruction(ee,nt),Array.prototype.push.apply(this.parent.children,et),this}instructionAfter(ee,nt){var pe,et;return pe=this.parent.children.indexOf(this),et=this.parent.children.splice(pe+1),this.parent.instruction(ee,nt),Array.prototype.push.apply(this.parent.children,et),this}declaration(ee,nt,at){var pe,et;return pe=this.document(),et=new me(pe,ee,nt,at),0===pe.children.length?pe.children.unshift(et):pe.children[0].type===Ue.Declaration?pe.children[0]=et:pe.children.unshift(et),pe.root()||pe}dtd(ee,nt){var pe,et,Ke,sn,wn,Un,Fi,en,ti;for(pe=this.document(),et=new Et(pe,ee,nt),Ke=sn=0,Un=(en=pe.children).length;sn<Un;Ke=++sn)if(en[Ke].type===Ue.DocType)return pe.children[Ke]=et,et;for(Ke=wn=0,Fi=(ti=pe.children).length;wn<Fi;Ke=++wn)if(ti[Ke].isRoot)return pe.children.splice(Ke,0,et),et;return pe.children.push(et),et}up(){if(this.isRoot)throw new Error("The root node has no parent. Use doc() if you need to get the document object.");return this.parent}root(){var ee;for(ee=this;ee;){if(ee.type===Ue.Document)return ee.rootObject;if(ee.isRoot)return ee;ee=ee.parent}}document(){var ee;for(ee=this;ee;){if(ee.type===Ue.Document)return ee;ee=ee.parent}}end(ee){return this.document().end(ee)}prev(){var ee;if((ee=this.parent.children.indexOf(this))<1)throw new Error("Already at the first node. "+this.debugInfo());return this.parent.children[ee-1]}next(){var ee;if(-1===(ee=this.parent.children.indexOf(this))||ee===this.parent.children.length-1)throw new Error("Already at the last node. "+this.debugInfo());return this.parent.children[ee+1]}importDocument(ee){var nt,at,pe,et,Ke;if((at=ee.root().clone()).parent=this,at.isRoot=!1,this.children.push(at),this.type===Ue.Document&&(at.isRoot=!0,at.documentObject=this,this.rootObject=at,this.children))for(pe=0,et=(Ke=this.children).length;pe<et;pe++)if((nt=Ke[pe]).type===Ue.DocType){nt.name=at.name;break}return this}debugInfo(ee){var nt,at;return null!=(ee=ee||this.name)||null!=(nt=this.parent)&&nt.name?null==ee?"parent: <"+this.parent.name+">":null!=(at=this.parent)&&at.name?"node: <"+ee+">, parent: <"+this.parent.name+">":"node: <"+ee+">":""}ele(ee,nt,at){return this.element(ee,nt,at)}nod(ee,nt,at){return this.node(ee,nt,at)}txt(ee){return this.text(ee)}dat(ee){return this.cdata(ee)}com(ee){return this.comment(ee)}ins(ee,nt){return this.instruction(ee,nt)}doc(){return this.document()}dec(ee,nt,at){return this.declaration(ee,nt,at)}e(ee,nt,at){return this.element(ee,nt,at)}n(ee,nt,at){return this.node(ee,nt,at)}t(ee){return this.text(ee)}d(ee){return this.cdata(ee)}c(ee){return this.comment(ee)}r(ee){return this.raw(ee)}i(ee,nt){return this.instruction(ee,nt)}u(){return this.up()}importXMLBuilder(ee){return this.importDocument(ee)}attribute(ee,nt){throw new Error("attribute() applies to element nodes only.")}att(ee,nt){return this.attribute(ee,nt)}a(ee,nt){return this.attribute(ee,nt)}removeAttribute(ee){throw new Error("attribute() applies to element nodes only.")}replaceChild(ee,nt){throw new Error("This DOM method is not implemented."+this.debugInfo())}removeChild(ee){throw new Error("This DOM method is not implemented."+this.debugInfo())}appendChild(ee){throw new Error("This DOM method is not implemented."+this.debugInfo())}hasChildNodes(){return 0!==this.children.length}cloneNode(ee){throw new Error("This DOM method is not implemented."+this.debugInfo())}normalize(){throw new Error("This DOM method is not implemented."+this.debugInfo())}isSupported(ee,nt){return!0}hasAttributes(){return 0!==this.attribs.length}compareDocumentPosition(ee){var at;return this===ee?0:this.document()!==ee.document()?(at=Fe.Disconnected|Fe.ImplementationSpecific,Math.random()<.5?at|=Fe.Preceding:at|=Fe.Following,at):this.isAncestor(ee)?Fe.Contains|Fe.Preceding:this.isDescendant(ee)?Fe.Contains|Fe.Following:this.isPreceding(ee)?Fe.Preceding:Fe.Following}isSameNode(ee){throw new Error("This DOM method is not implemented."+this.debugInfo())}lookupPrefix(ee){throw new Error("This DOM method is not implemented."+this.debugInfo())}isDefaultNamespace(ee){throw new Error("This DOM method is not implemented."+this.debugInfo())}lookupNamespaceURI(ee){throw new Error("This DOM method is not implemented."+this.debugInfo())}isEqualNode(ee){var nt,at,pe;if(ee.nodeType!==this.nodeType||ee.children.length!==this.children.length)return!1;for(nt=at=0,pe=this.children.length-1;0<=pe?at<=pe:at>=pe;nt=0<=pe?++at:--at)if(!this.children[nt].isEqualNode(ee.children[nt]))return!1;return!0}getFeature(ee,nt){throw new Error("This DOM method is not implemented."+this.debugInfo())}setUserData(ee,nt,at){throw new Error("This DOM method is not implemented."+this.debugInfo())}getUserData(ee){throw new Error("This DOM method is not implemented."+this.debugInfo())}contains(ee){return!!ee&&(ee===this||this.isDescendant(ee))}isDescendant(ee){var nt,pe,et,Ke;for(pe=0,et=(Ke=this.children).length;pe<et;pe++)if(ee===(nt=Ke[pe])||nt.isDescendant(ee))return!0;return!1}isAncestor(ee){return ee.isDescendant(this)}isPreceding(ee){var nt,at;return nt=this.treePosition(ee),at=this.treePosition(this),-1!==nt&&-1!==at&&nt<at}isFollowing(ee){var nt,at;return nt=this.treePosition(ee),at=this.treePosition(this),-1!==nt&&-1!==at&&nt>at}treePosition(ee){var nt,at;return at=0,nt=!1,this.foreachTreeNode(this.document(),function(pe){if(at++,!nt&&pe===ee)return nt=!0}),nt?at:-1}foreachTreeNode(ee,nt){var at,pe,et,Ke,sn;for(ee||(ee=this.document()),pe=0,et=(Ke=ee.children).length;pe<et;pe++){if(sn=nt(at=Ke[pe]))return sn;if(sn=this.foreachTreeNode(at,nt))return sn}}}return Object.defineProperty(Se.prototype,"nodeName",{get:function(){return this.name}}),Object.defineProperty(Se.prototype,"nodeType",{get:function(){return this.type}}),Object.defineProperty(Se.prototype,"nodeValue",{get:function(){return this.value}}),Object.defineProperty(Se.prototype,"parentNode",{get:function(){return this.parent}}),Object.defineProperty(Se.prototype,"childNodes",{get:function(){return(!this.childNodeList||!this.childNodeList.nodes)&&(this.childNodeList=new kt(this.children)),this.childNodeList}}),Object.defineProperty(Se.prototype,"firstChild",{get:function(){return this.children[0]||null}}),Object.defineProperty(Se.prototype,"lastChild",{get:function(){return this.children[this.children.length-1]||null}}),Object.defineProperty(Se.prototype,"previousSibling",{get:function(){var Ae;return Ae=this.parent.children.indexOf(this),this.parent.children[Ae-1]||null}}),Object.defineProperty(Se.prototype,"nextSibling",{get:function(){var Ae;return Ae=this.parent.children.indexOf(this),this.parent.children[Ae+1]||null}}),Object.defineProperty(Se.prototype,"ownerDocument",{get:function(){return this.document()||null}}),Object.defineProperty(Se.prototype,"textContent",{get:function(){var Ae,ee,nt,at,pe;if(this.nodeType===Ue.Element||this.nodeType===Ue.DocumentFragment){for(pe="",ee=0,nt=(at=this.children).length;ee<nt;ee++)(Ae=at[ee]).textContent&&(pe+=Ae.textContent);return pe}return null},set:function(Ae){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Se}.call(this)}).call(this)},112:function(rn){(function(){rn.exports=function(){class rt{constructor(Ue){this.nodes=Ue}clone(){return this.nodes=null}item(Ue){return this.nodes[Ue]||null}}return Object.defineProperty(rt.prototype,"length",{get:function(){return this.nodes.length||0}}),rt}.call(this)}).call(this)},666:function(rn,Ei,rt){(function(){var Fe,Ue;Fe=rt(269),Ue=rt(182),rn.exports=class extends Ue{constructor(me,Et,$e){if(super(me),null==Et)throw new Error("Missing instruction target. "+this.debugInfo());this.type=Fe.ProcessingInstruction,this.target=this.stringify.insTarget(Et),this.name=this.target,$e&&(this.value=this.stringify.insValue($e))}clone(){return Object.create(this)}toString(me){return this.options.writer.processingInstruction(this,this.options.writer.filterOptions(me))}isEqualNode(me){return!(!super.isEqualNode(me)||me.target!==this.target)}}}).call(this)},942:function(rn,Ei,rt){(function(){var Fe,Ue;Fe=rt(269),Ue=rt(563),rn.exports=class extends Ue{constructor(me,Et){if(super(me),null==Et)throw new Error("Missing raw text. "+this.debugInfo());this.type=Fe.Raw,this.value=this.stringify.raw(Et)}clone(){return Object.create(this)}toString(me){return this.options.writer.raw(this,this.options.writer.filterOptions(me))}}}).call(this)},647:function(rn,Ei,rt){(function(){var Fe,Ue,p,me={}.hasOwnProperty;Fe=rt(269),p=rt(576),Ue=rt(316),rn.exports=class extends p{constructor($e,Ge){super(Ge),this.stream=$e}endline($e,Ge,Ye){return $e.isLastRootNode&&Ge.state===Ue.CloseTag?"":super.endline($e,Ge,Ye)}document($e,Ge){var Ft,kt,Xe,St,$t,dn,Ne,jn;for(Ft=kt=0,St=(dn=$e.children).length;kt<St;Ft=++kt)dn[Ft].isLastRootNode=Ft===$e.children.length-1;for(Ge=this.filterOptions(Ge),jn=[],Xe=0,$t=(Ne=$e.children).length;Xe<$t;Xe++)jn.push(this.writeChildNode(Ne[Xe],Ge,0));return jn}cdata($e,Ge,Ye){return this.stream.write(super.cdata($e,Ge,Ye))}comment($e,Ge,Ye){return this.stream.write(super.comment($e,Ge,Ye))}declaration($e,Ge,Ye){return this.stream.write(super.declaration($e,Ge,Ye))}docType($e,Ge,Ye){var kt,Xe,St;if(Ye||(Ye=0),this.openNode($e,Ge,Ye),Ge.state=Ue.OpenTag,this.stream.write(this.indent($e,Ge,Ye)),this.stream.write("<!DOCTYPE "+$e.root().name),$e.pubID&&$e.sysID?this.stream.write(' PUBLIC "'+$e.pubID+'" "'+$e.sysID+'"'):$e.sysID&&this.stream.write(' SYSTEM "'+$e.sysID+'"'),$e.children.length>0){for(this.stream.write(" ["),this.stream.write(this.endline($e,Ge,Ye)),Ge.state=Ue.InsideTag,kt=0,Xe=(St=$e.children).length;kt<Xe;kt++)this.writeChildNode(St[kt],Ge,Ye+1);Ge.state=Ue.CloseTag,this.stream.write("]")}return Ge.state=Ue.CloseTag,this.stream.write(Ge.spaceBeforeSlash+">"),this.stream.write(this.endline($e,Ge,Ye)),Ge.state=Ue.None,this.closeNode($e,Ge,Ye)}element($e,Ge,Ye){var St,$t,dn,Ne,jn,mt,Ie,Se,Ae,ee,nt,at;if(Ye||(Ye=0),this.openNode($e,Ge,Ye),Ge.state=Ue.OpenTag,Ie=this.indent($e,Ge,Ye)+"<"+$e.name,Ge.pretty&&Ge.width>0)for(mt in Ne=Ie.length,Ae=$e.attribs)!me.call(Ae,mt)||(Ne+(Se=this.attribute(Ae[mt],Ge,Ye)).length>Ge.width?(at=this.indent($e,Ge,Ye+1)+Se,Ie+=this.endline($e,Ge,Ye)+at,Ne=at.length):(Ie+=at=" "+Se,Ne+=at.length));else for(mt in ee=$e.attribs)!me.call(ee,mt)||(Ie+=this.attribute(ee[mt],Ge,Ye));if(this.stream.write(Ie),$t=0===(St=$e.children.length)?null:$e.children[0],0===St||$e.children.every(function(pe){return(pe.type===Fe.Text||pe.type===Fe.Raw||pe.type===Fe.CData)&&""===pe.value}))Ge.allowEmpty?(this.stream.write(">"),Ge.state=Ue.CloseTag,this.stream.write("</"+$e.name+">")):(Ge.state=Ue.CloseTag,this.stream.write(Ge.spaceBeforeSlash+"/>"));else if(!Ge.pretty||1!==St||$t.type!==Fe.Text&&$t.type!==Fe.Raw&&$t.type!==Fe.CData||null==$t.value){for(this.stream.write(">"+this.endline($e,Ge,Ye)),Ge.state=Ue.InsideTag,dn=0,jn=(nt=$e.children).length;dn<jn;dn++)this.writeChildNode(nt[dn],Ge,Ye+1);Ge.state=Ue.CloseTag,this.stream.write(this.indent($e,Ge,Ye)+"</"+$e.name+">")}else this.stream.write(">"),Ge.state=Ue.InsideTag,Ge.suppressPrettyCount++,this.writeChildNode($t,Ge,Ye+1),Ge.suppressPrettyCount--,Ge.state=Ue.CloseTag,this.stream.write("</"+$e.name+">");return this.stream.write(this.endline($e,Ge,Ye)),Ge.state=Ue.None,this.closeNode($e,Ge,Ye)}processingInstruction($e,Ge,Ye){return this.stream.write(super.processingInstruction($e,Ge,Ye))}raw($e,Ge,Ye){return this.stream.write(super.raw($e,Ge,Ye))}text($e,Ge,Ye){return this.stream.write(super.text($e,Ge,Ye))}dtdAttList($e,Ge,Ye){return this.stream.write(super.dtdAttList($e,Ge,Ye))}dtdElement($e,Ge,Ye){return this.stream.write(super.dtdElement($e,Ge,Ye))}dtdEntity($e,Ge,Ye){return this.stream.write(super.dtdEntity($e,Ge,Ye))}dtdNotation($e,Ge,Ye){return this.stream.write(super.dtdNotation($e,Ge,Ye))}}}).call(this)},354:function(rn,Ei,rt){(function(){var Ue;Ue=rt(576),rn.exports=class extends Ue{constructor(p){super(p)}document(p,me){var $e,Ge,Ye,Ft;for(me=this.filterOptions(me),Ye="",$e=0,Ge=(Ft=p.children).length;$e<Ge;$e++)Ye+=this.writeChildNode(Ft[$e],me,0);return me.pretty&&Ye.slice(-me.newline.length)===me.newline&&(Ye=Ye.slice(0,-me.newline.length)),Ye}}}).call(this)},41:function(rn){(function(){var rt={}.hasOwnProperty;rn.exports=function(){class Fe{constructor(ze){var p,me;for(p in this.assertLegalChar=this.assertLegalChar.bind(this),this.assertLegalName=this.assertLegalName.bind(this),ze||(ze={}),this.options=ze,this.options.version||(this.options.version="1.0"),me=ze.stringify||{})!rt.call(me,p)||(this[p]=me[p])}name(ze){return this.options.noValidation?ze:this.assertLegalName(""+ze||"")}text(ze){return this.options.noValidation?ze:this.assertLegalChar(this.textEscape(""+ze||""))}cdata(ze){return this.options.noValidation?ze:(ze=(ze=""+ze||"").replace("]]>","]]]]><![CDATA[>"),this.assertLegalChar(ze))}comment(ze){if(this.options.noValidation)return ze;if((ze=""+ze||"").match(/--/))throw new Error("Comment text cannot contain double-hypen: "+ze);return this.assertLegalChar(ze)}raw(ze){return this.options.noValidation?ze:""+ze||""}attValue(ze){return this.options.noValidation?ze:this.assertLegalChar(this.attEscape(ze=""+ze||""))}insTarget(ze){return this.options.noValidation?ze:this.assertLegalChar(""+ze||"")}insValue(ze){if(this.options.noValidation)return ze;if((ze=""+ze||"").match(/\?>/))throw new Error("Invalid processing instruction value: "+ze);return this.assertLegalChar(ze)}xmlVersion(ze){if(this.options.noValidation)return ze;if(!(ze=""+ze||"").match(/1\.[0-9]+/))throw new Error("Invalid version number: "+ze);return ze}xmlEncoding(ze){if(this.options.noValidation)return ze;if(!(ze=""+ze||"").match(/^[A-Za-z](?:[A-Za-z0-9._-])*$/))throw new Error("Invalid encoding: "+ze);return this.assertLegalChar(ze)}xmlStandalone(ze){return this.options.noValidation?ze:ze?"yes":"no"}dtdPubID(ze){return this.options.noValidation?ze:this.assertLegalChar(""+ze||"")}dtdSysID(ze){return this.options.noValidation?ze:this.assertLegalChar(""+ze||"")}dtdElementValue(ze){return this.options.noValidation?ze:this.assertLegalChar(""+ze||"")}dtdAttType(ze){return this.options.noValidation?ze:this.assertLegalChar(""+ze||"")}dtdAttDefault(ze){return this.options.noValidation?ze:this.assertLegalChar(""+ze||"")}dtdEntityValue(ze){return this.options.noValidation?ze:this.assertLegalChar(""+ze||"")}dtdNData(ze){return this.options.noValidation?ze:this.assertLegalChar(""+ze||"")}assertLegalChar(ze){var p,me;if(this.options.noValidation)return ze;if("1.0"===this.options.version){if(p=/[\0-\x08\x0B\f\x0E-\x1F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/g,void 0!==this.options.invalidCharReplacement)ze=ze.replace(p,this.options.invalidCharReplacement);else if(me=ze.match(p))throw new Error(`Invalid character in string: ${ze} at index ${me.index}`)}else if("1.1"===this.options.version)if(p=/[\0\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/g,void 0!==this.options.invalidCharReplacement)ze=ze.replace(p,this.options.invalidCharReplacement);else if(me=ze.match(p))throw new Error(`Invalid character in string: ${ze} at index ${me.index}`);return ze}assertLegalName(ze){if(this.options.noValidation)return ze;if(!(ze=this.assertLegalChar(ze)).match(/^([:A-Z_a-z\xC0-\xD6\xD8-\xF6\xF8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])([\x2D\.0-:A-Z_a-z\xB7\xC0-\xD6\xD8-\xF6\xF8-\u037D\u037F-\u1FFF\u200C\u200D\u203F\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])*$/))throw new Error(`Invalid character in name: ${ze}`);return ze}textEscape(ze){return this.options.noValidation?ze:ze.replace(this.options.noDoubleEncoding?/(?!&(lt|gt|amp|apos|quot);)&/g:/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r/g,"&#xD;")}attEscape(ze){return this.options.noValidation?ze:ze.replace(this.options.noDoubleEncoding?/(?!&(lt|gt|amp|apos|quot);)&/g:/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;")}}return Fe.prototype.convertAttKey="@",Fe.prototype.convertPIKey="?",Fe.prototype.convertTextKey="#text",Fe.prototype.convertCDataKey="#cdata",Fe.prototype.convertCommentKey="#comment",Fe.prototype.convertRawKey="#raw",Fe}.call(this)}).call(this)},474:function(rn,Ei,rt){(function(){var Fe,Ue;Fe=rt(269),Ue=rt(182),rn.exports=function(){class p extends Ue{constructor(Et,$e){if(super(Et),null==$e)throw new Error("Missing element text. "+this.debugInfo());this.name="#text",this.type=Fe.Text,this.value=this.stringify.text($e)}clone(){return Object.create(this)}toString(Et){return this.options.writer.text(this,this.options.writer.filterOptions(Et))}splitText(Et){throw new Error("This DOM method is not implemented."+this.debugInfo())}replaceWholeText(Et){throw new Error("This DOM method is not implemented."+this.debugInfo())}}return Object.defineProperty(p.prototype,"isElementContentWhitespace",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(p.prototype,"wholeText",{get:function(){var me,Et,$e;for($e="",Et=this.previousSibling;Et;)$e=Et.data+$e,Et=Et.previousSibling;for($e+=this.data,me=this.nextSibling;me;)$e+=me.data,me=me.nextSibling;return $e}}),p}.call(this)}).call(this)},576:function(rn,Ei,rt){(function(){var Fe,Ue,jn,mt={}.hasOwnProperty;({assign:jn}=rt(452)),Fe=rt(269),rt(789),rt(195),rt(361),rt(516),rt(352),rt(942),rt(474),rt(666),rt(173),rt(274),rt(68),rt(349),rt(87),Ue=rt(316),rn.exports=class{constructor(Ie){var Se,Ae,ee;for(Se in Ie||(Ie={}),this.options=Ie,Ae=Ie.writer||{})!mt.call(Ae,Se)||(ee=Ae[Se],this["_"+Se]=this[Se],this[Se]=ee)}filterOptions(Ie){var Se,Ae,ee,nt,at,pe,et,Ke,sn;return Ie||(Ie={}),Ie=jn({},this.options,Ie),(Se={writer:this}).pretty=Ie.pretty||!1,Se.allowEmpty=Ie.allowEmpty||!1,Se.indent=null!=(Ae=Ie.indent)?Ae:"  ",Se.newline=null!=(ee=Ie.newline)?ee:"\n",Se.offset=null!=(nt=Ie.offset)?nt:0,Se.width=null!=(at=Ie.width)?at:0,Se.dontPrettyTextNodes=null!=(pe=null!=(et=Ie.dontPrettyTextNodes)?et:Ie.dontprettytextnodes)?pe:0,Se.spaceBeforeSlash=null!=(Ke=null!=(sn=Ie.spaceBeforeSlash)?sn:Ie.spacebeforeslash)?Ke:"",!0===Se.spaceBeforeSlash&&(Se.spaceBeforeSlash=" "),Se.suppressPrettyCount=0,Se.user={},Se.state=Ue.None,Se}indent(Ie,Se,Ae){var ee;return!Se.pretty||Se.suppressPrettyCount?"":Se.pretty&&(ee=(Ae||0)+Se.offset+1)>0?new Array(ee).join(Se.indent):""}endline(Ie,Se,Ae){return!Se.pretty||Se.suppressPrettyCount?"":Se.newline}attribute(Ie,Se,Ae){var ee;return this.openAttribute(Ie,Se,Ae),ee=Se.pretty&&Se.width>0?Ie.name+'="'+Ie.value+'"':" "+Ie.name+'="'+Ie.value+'"',this.closeAttribute(Ie,Se,Ae),ee}cdata(Ie,Se,Ae){var ee;return this.openNode(Ie,Se,Ae),Se.state=Ue.OpenTag,ee=this.indent(Ie,Se,Ae)+"<![CDATA[",Se.state=Ue.InsideTag,ee+=Ie.value,Se.state=Ue.CloseTag,ee+="]]>"+this.endline(Ie,Se,Ae),Se.state=Ue.None,this.closeNode(Ie,Se,Ae),ee}comment(Ie,Se,Ae){var ee;return this.openNode(Ie,Se,Ae),Se.state=Ue.OpenTag,ee=this.indent(Ie,Se,Ae)+"\x3c!-- ",Se.state=Ue.InsideTag,ee+=Ie.value,Se.state=Ue.CloseTag,ee+=" --\x3e"+this.endline(Ie,Se,Ae),Se.state=Ue.None,this.closeNode(Ie,Se,Ae),ee}declaration(Ie,Se,Ae){var ee;return this.openNode(Ie,Se,Ae),Se.state=Ue.OpenTag,ee=this.indent(Ie,Se,Ae)+"<?xml",Se.state=Ue.InsideTag,ee+=' version="'+Ie.version+'"',null!=Ie.encoding&&(ee+=' encoding="'+Ie.encoding+'"'),null!=Ie.standalone&&(ee+=' standalone="'+Ie.standalone+'"'),Se.state=Ue.CloseTag,ee+=Se.spaceBeforeSlash+"?>",ee+=this.endline(Ie,Se,Ae),Se.state=Ue.None,this.closeNode(Ie,Se,Ae),ee}docType(Ie,Se,Ae){var nt,at,pe,et;if(Ae||(Ae=0),this.openNode(Ie,Se,Ae),Se.state=Ue.OpenTag,pe=this.indent(Ie,Se,Ae),pe+="<!DOCTYPE "+Ie.root().name,Ie.pubID&&Ie.sysID?pe+=' PUBLIC "'+Ie.pubID+'" "'+Ie.sysID+'"':Ie.sysID&&(pe+=' SYSTEM "'+Ie.sysID+'"'),Ie.children.length>0){for(pe+=" [",pe+=this.endline(Ie,Se,Ae),Se.state=Ue.InsideTag,nt=0,at=(et=Ie.children).length;nt<at;nt++)pe+=this.writeChildNode(et[nt],Se,Ae+1);Se.state=Ue.CloseTag,pe+="]"}return Se.state=Ue.CloseTag,pe+=Se.spaceBeforeSlash+">",pe+=this.endline(Ie,Se,Ae),Se.state=Ue.None,this.closeNode(Ie,Se,Ae),pe}element(Ie,Se,Ae){var at,pe,et,Ke,sn,wn,Un,Fi,en,ti,nr,qr,ni,Qt,Rs,Eo,di;if(Ae||(Ae=0),ti=!1,this.openNode(Ie,Se,Ae),Se.state=Ue.OpenTag,nr=this.indent(Ie,Se,Ae)+"<"+Ie.name,Se.pretty&&Se.width>0)for(en in wn=nr.length,ni=Ie.attribs)!mt.call(ni,en)||(wn+(qr=this.attribute(ni[en],Se,Ae)).length>Se.width?(di=this.indent(Ie,Se,Ae+1)+qr,nr+=this.endline(Ie,Se,Ae)+di,wn=di.length):(nr+=di=" "+qr,wn+=di.length));else for(en in Qt=Ie.attribs)!mt.call(Qt,en)||(nr+=this.attribute(Qt[en],Se,Ae));if(et=0===(pe=Ie.children.length)?null:Ie.children[0],0===pe||Ie.children.every(function(Tt){return(Tt.type===Fe.Text||Tt.type===Fe.Raw||Tt.type===Fe.CData)&&""===Tt.value}))Se.allowEmpty?(nr+=">",Se.state=Ue.CloseTag,nr+="</"+Ie.name+">"+this.endline(Ie,Se,Ae)):(Se.state=Ue.CloseTag,nr+=Se.spaceBeforeSlash+"/>"+this.endline(Ie,Se,Ae));else if(!Se.pretty||1!==pe||et.type!==Fe.Text&&et.type!==Fe.Raw&&et.type!==Fe.CData||null==et.value){if(Se.dontPrettyTextNodes)for(Ke=0,Un=(Rs=Ie.children).length;Ke<Un;Ke++)if(((at=Rs[Ke]).type===Fe.Text||at.type===Fe.Raw||at.type===Fe.CData)&&null!=at.value){Se.suppressPrettyCount++,ti=!0;break}for(nr+=">"+this.endline(Ie,Se,Ae),Se.state=Ue.InsideTag,sn=0,Fi=(Eo=Ie.children).length;sn<Fi;sn++)nr+=this.writeChildNode(at=Eo[sn],Se,Ae+1);Se.state=Ue.CloseTag,nr+=this.indent(Ie,Se,Ae)+"</"+Ie.name+">",ti&&Se.suppressPrettyCount--,nr+=this.endline(Ie,Se,Ae),Se.state=Ue.None}else nr+=">",Se.state=Ue.InsideTag,Se.suppressPrettyCount++,ti=!0,nr+=this.writeChildNode(et,Se,Ae+1),Se.suppressPrettyCount--,ti=!1,Se.state=Ue.CloseTag,nr+="</"+Ie.name+">"+this.endline(Ie,Se,Ae);return this.closeNode(Ie,Se,Ae),nr}writeChildNode(Ie,Se,Ae){switch(Ie.type){case Fe.CData:return this.cdata(Ie,Se,Ae);case Fe.Comment:return this.comment(Ie,Se,Ae);case Fe.Element:return this.element(Ie,Se,Ae);case Fe.Raw:return this.raw(Ie,Se,Ae);case Fe.Text:return this.text(Ie,Se,Ae);case Fe.ProcessingInstruction:return this.processingInstruction(Ie,Se,Ae);case Fe.Dummy:return"";case Fe.Declaration:return this.declaration(Ie,Se,Ae);case Fe.DocType:return this.docType(Ie,Se,Ae);case Fe.AttributeDeclaration:return this.dtdAttList(Ie,Se,Ae);case Fe.ElementDeclaration:return this.dtdElement(Ie,Se,Ae);case Fe.EntityDeclaration:return this.dtdEntity(Ie,Se,Ae);case Fe.NotationDeclaration:return this.dtdNotation(Ie,Se,Ae);default:throw new Error("Unknown XML node type: "+Ie.constructor.name)}}processingInstruction(Ie,Se,Ae){var ee;return this.openNode(Ie,Se,Ae),Se.state=Ue.OpenTag,ee=this.indent(Ie,Se,Ae)+"<?",Se.state=Ue.InsideTag,ee+=Ie.target,Ie.value&&(ee+=" "+Ie.value),Se.state=Ue.CloseTag,ee+=Se.spaceBeforeSlash+"?>",ee+=this.endline(Ie,Se,Ae),Se.state=Ue.None,this.closeNode(Ie,Se,Ae),ee}raw(Ie,Se,Ae){var ee;return this.openNode(Ie,Se,Ae),Se.state=Ue.OpenTag,ee=this.indent(Ie,Se,Ae),Se.state=Ue.InsideTag,ee+=Ie.value,Se.state=Ue.CloseTag,ee+=this.endline(Ie,Se,Ae),Se.state=Ue.None,this.closeNode(Ie,Se,Ae),ee}text(Ie,Se,Ae){var ee;return this.openNode(Ie,Se,Ae),Se.state=Ue.OpenTag,ee=this.indent(Ie,Se,Ae),Se.state=Ue.InsideTag,ee+=Ie.value,Se.state=Ue.CloseTag,ee+=this.endline(Ie,Se,Ae),Se.state=Ue.None,this.closeNode(Ie,Se,Ae),ee}dtdAttList(Ie,Se,Ae){var ee;return this.openNode(Ie,Se,Ae),Se.state=Ue.OpenTag,ee=this.indent(Ie,Se,Ae)+"<!ATTLIST",Se.state=Ue.InsideTag,ee+=" "+Ie.elementName+" "+Ie.attributeName+" "+Ie.attributeType,"#DEFAULT"!==Ie.defaultValueType&&(ee+=" "+Ie.defaultValueType),Ie.defaultValue&&(ee+=' "'+Ie.defaultValue+'"'),Se.state=Ue.CloseTag,ee+=Se.spaceBeforeSlash+">"+this.endline(Ie,Se,Ae),Se.state=Ue.None,this.closeNode(Ie,Se,Ae),ee}dtdElement(Ie,Se,Ae){var ee;return this.openNode(Ie,Se,Ae),Se.state=Ue.OpenTag,ee=this.indent(Ie,Se,Ae)+"<!ELEMENT",Se.state=Ue.InsideTag,ee+=" "+Ie.name+" "+Ie.value,Se.state=Ue.CloseTag,ee+=Se.spaceBeforeSlash+">"+this.endline(Ie,Se,Ae),Se.state=Ue.None,this.closeNode(Ie,Se,Ae),ee}dtdEntity(Ie,Se,Ae){var ee;return this.openNode(Ie,Se,Ae),Se.state=Ue.OpenTag,ee=this.indent(Ie,Se,Ae)+"<!ENTITY",Se.state=Ue.InsideTag,Ie.pe&&(ee+=" %"),ee+=" "+Ie.name,Ie.value?ee+=' "'+Ie.value+'"':(Ie.pubID&&Ie.sysID?ee+=' PUBLIC "'+Ie.pubID+'" "'+Ie.sysID+'"':Ie.sysID&&(ee+=' SYSTEM "'+Ie.sysID+'"'),Ie.nData&&(ee+=" NDATA "+Ie.nData)),Se.state=Ue.CloseTag,ee+=Se.spaceBeforeSlash+">"+this.endline(Ie,Se,Ae),Se.state=Ue.None,this.closeNode(Ie,Se,Ae),ee}dtdNotation(Ie,Se,Ae){var ee;return this.openNode(Ie,Se,Ae),Se.state=Ue.OpenTag,ee=this.indent(Ie,Se,Ae)+"<!NOTATION",Se.state=Ue.InsideTag,ee+=" "+Ie.name,Ie.pubID&&Ie.sysID?ee+=' PUBLIC "'+Ie.pubID+'" "'+Ie.sysID+'"':Ie.pubID?ee+=' PUBLIC "'+Ie.pubID+'"':Ie.sysID&&(ee+=' SYSTEM "'+Ie.sysID+'"'),Se.state=Ue.CloseTag,ee+=Se.spaceBeforeSlash+">"+this.endline(Ie,Se,Ae),Se.state=Ue.None,this.closeNode(Ie,Se,Ae),ee}openNode(Ie,Se,Ae){}closeNode(Ie,Se,Ae){}openAttribute(Ie,Se,Ae){}closeAttribute(Ie,Se,Ae){}}}).call(this)},904:function(rn,Ei,rt){(function(){var Fe,Ue,ze,p,me,Et,$e,Ge,Ye;({assign:Ge,isFunction:Ye}=rt(452)),ze=rt(906),p=rt(519),me=rt(105),$e=rt(354),Et=rt(647),Fe=rt(269),Ue=rt(316),rn.exports.create=function(Ft,kt,Xe,St){var $t,dn;if(null==Ft)throw new Error("Root element needs a name.");return St=Ge({},kt,Xe,St),dn=($t=new p(St)).element(Ft),St.headless||($t.declaration(St),(null!=St.pubID||null!=St.sysID)&&$t.dtd(St)),dn},rn.exports.begin=function(Ft,kt,Xe){return Ye(Ft)&&([kt,Xe]=[Ft,kt],Ft={}),kt?new me(Ft,kt,Xe):new p(Ft)},rn.exports.stringWriter=function(Ft){return new $e(Ft)},rn.exports.streamWriter=function(Ft,kt){return new Et(Ft,kt)},rn.exports.implementation=new ze,rn.exports.nodeType=Fe,rn.exports.writerState=Ue}).call(this)},823:(rn,Ei)=>{!function(Fe){"use strict";var ze=function(x,z){for(var ae=0;ae<z.length;ae+=1)x(z[ae],ae,z)},p=function(x,z,ae){var Oe=z;return ze(function(Ve,le){Oe=x(Oe,Ve,le)},ae),Oe},me=function(x,z){var ae=new Array(z.length);return ze(function(Oe,Ve){ae[Ve]=x(Oe)},z),ae};function Ge(x){return function(){return x}}function Ye(x){return x.toString()}var Ft=function(x,z){return z.join(x)},kt=function(x,z,ae){return x+ae+z},Xe=Array.prototype.concat;function dn(x,z){for(var ae=Object(x),Oe=1;Oe<arguments.length;Oe++){var Ve=arguments[Oe];if(null!=Ve)for(var le in Ve)Object.prototype.hasOwnProperty.call(Ve,le)&&(ae[le]=Ve[le])}return ae}function Ne(){this.init()}function jn(x){this.expression=x}function mt(x,z,ae){z in x||(x[z]=ae)}function gi(){}function Ie(x){arguments.length>0&&this.init(x)}function Se(x){arguments.length>0&&this.init(x)}function Ae(x,z){arguments.length>0&&this.init(x,z)}function ee(x,z){arguments.length>0&&this.init(x,z)}function nt(x,z){arguments.length>0&&this.init(x,z)}function at(x,z){arguments.length>0&&this.init(x,z)}function pe(x,z){arguments.length>0&&this.init(x,z)}function et(x,z){arguments.length>0&&this.init(x,z)}function Ke(x,z){arguments.length>0&&this.init(x,z)}function sn(x,z){arguments.length>0&&this.init(x,z)}function wn(x,z){arguments.length>0&&this.init(x,z)}function Un(x,z){arguments.length>0&&this.init(x,z)}function Fi(x,z){arguments.length>0&&this.init(x,z)}function en(x,z){arguments.length>0&&this.init(x,z)}function ti(x,z){arguments.length>0&&this.init(x,z)}function nr(x,z){arguments.length>0&&this.init(x,z)}function qr(x,z){arguments.length>0&&this.init(x,z)}function ni(x,z,ae){arguments.length>0&&this.init(x,z,ae)}function Qt(x){for(;x&&x.parentNode;)x=x.parentNode;return x}function Rs(x,z,ae){return ni.applyPredicates(x.predicates,z,ni.applyStep(x,z,ae))}function Eo(x,z,ae){return function $t(x){for(var z=[],ae=0;ae<x.length;ae+=32767){var Oe=x.slice(ae,ae+32767);z=Xe.apply(z,Oe)}return z}(me(Rs.bind(null,ae,x),z))}function di(x,z){arguments.length>0&&this.init(x,z)}function Tt(x,z,ae){arguments.length>0&&this.init(x,z,ae)}function Jt(x,z){arguments.length>0&&this.init(x,z)}function Hn(x){arguments.length>0&&this.init(x)}function Ni(x,z){arguments.length>0&&this.init(x,z)}(Ne.prototype=new Object).constructor=Ne,Ne.superclass=Object.prototype,Ne.prototype.init=function(){this.reduceActions=[],this.reduceActions[3]=function(x){return new ee(x[0],x[2])},this.reduceActions[5]=function(x){return new nt(x[0],x[2])},this.reduceActions[7]=function(x){return new at(x[0],x[2])},this.reduceActions[8]=function(x){return new pe(x[0],x[2])},this.reduceActions[10]=function(x){return new et(x[0],x[2])},this.reduceActions[11]=function(x){return new Ke(x[0],x[2])},this.reduceActions[12]=function(x){return new sn(x[0],x[2])},this.reduceActions[13]=function(x){return new wn(x[0],x[2])},this.reduceActions[15]=function(x){return new Un(x[0],x[2])},this.reduceActions[16]=function(x){return new Fi(x[0],x[2])},this.reduceActions[18]=function(x){return new en(x[0],x[2])},this.reduceActions[19]=function(x){return new ti(x[0],x[2])},this.reduceActions[20]=function(x){return new nr(x[0],x[2])},this.reduceActions[22]=function(x){return new Se(x[1])},this.reduceActions[24]=function(x){return new qr(x[0],x[2])},this.reduceActions[25]=function(x){return new ni(void 0,void 0,x[0])},this.reduceActions[27]=function(x){return x[0].locationPath=x[2],x[0]},this.reduceActions[28]=function(x){return x[0].locationPath=x[2],x[0].locationPath.steps.unshift(new Tt(Tt.DESCENDANTORSELF,Jt.nodeTest,[])),x[0]},this.reduceActions[29]=function(x){return new ni(x[0],[],void 0)},this.reduceActions[30]=function(x){return an.instance_of(x[0],ni)?(null==x[0].filterPredicates&&(x[0].filterPredicates=[]),x[0].filterPredicates.push(x[1]),x[0]):new ni(x[0],[x[1]],void 0)},this.reduceActions[32]=function(x){return x[1]},this.reduceActions[33]=function(x){return new zt(x[0])},this.reduceActions[34]=function(x){return new Sn(x[0])},this.reduceActions[36]=function(x){return new Ni(x[0],[])},this.reduceActions[37]=function(x){return new Ni(x[0],x[2])},this.reduceActions[38]=function(x){return[x[0]]},this.reduceActions[39]=function(x){return x[2].unshift(x[0]),x[2]},this.reduceActions[43]=function(x){return new di(!0,[])},this.reduceActions[44]=function(x){return x[1].absolute=!0,x[1]},this.reduceActions[46]=function(x){return new di(!1,[x[0]])},this.reduceActions[47]=function(x){return x[0].steps.push(x[2]),x[0]},this.reduceActions[49]=function(x){return new Tt(x[0],x[1],[])},this.reduceActions[50]=function(x){return new Tt(Tt.CHILD,x[0],[])},this.reduceActions[51]=function(x){return new Tt(x[0],x[1],x[2])},this.reduceActions[52]=function(x){return new Tt(Tt.CHILD,x[0],x[1])},this.reduceActions[54]=function(x){return[x[0]]},this.reduceActions[55]=function(x){return x[1].unshift(x[0]),x[1]},this.reduceActions[56]=function(x){return"ancestor"==x[0]?Tt.ANCESTOR:"ancestor-or-self"==x[0]?Tt.ANCESTORORSELF:"attribute"==x[0]?Tt.ATTRIBUTE:"child"==x[0]?Tt.CHILD:"descendant"==x[0]?Tt.DESCENDANT:"descendant-or-self"==x[0]?Tt.DESCENDANTORSELF:"following"==x[0]?Tt.FOLLOWING:"following-sibling"==x[0]?Tt.FOLLOWINGSIBLING:"namespace"==x[0]?Tt.NAMESPACE:"parent"==x[0]?Tt.PARENT:"preceding"==x[0]?Tt.PRECEDING:"preceding-sibling"==x[0]?Tt.PRECEDINGSIBLING:"self"==x[0]?Tt.SELF:-1},this.reduceActions[57]=function(x){return Tt.ATTRIBUTE},this.reduceActions[59]=function(x){return"comment"==x[0]?Jt.commentTest:"text"==x[0]?Jt.textTest:"processing-instruction"==x[0]?Jt.anyPiTest:"node"==x[0]?Jt.nodeTest:new Jt(-1,void 0)},this.reduceActions[60]=function(x){return new Jt.PITest(x[2])},this.reduceActions[61]=function(x){return x[1]},this.reduceActions[63]=function(x){return x[1].absolute=!0,x[1].steps.unshift(new Tt(Tt.DESCENDANTORSELF,Jt.nodeTest,[])),x[1]},this.reduceActions[64]=function(x){return x[0].steps.push(new Tt(Tt.DESCENDANTORSELF,Jt.nodeTest,[])),x[0].steps.push(x[2]),x[0]},this.reduceActions[65]=function(x){return new Tt(Tt.SELF,Jt.nodeTest,[])},this.reduceActions[66]=function(x){return new Tt(Tt.PARENT,Jt.nodeTest,[])},this.reduceActions[67]=function(x){return new Hn(x[1])},this.reduceActions[68]=function(x){return Jt.nameTestAny},this.reduceActions[69]=function(x){return new Jt.NameTestPrefixAny(x[0].split(":")[0])},this.reduceActions[70]=function(x){return new Jt.NameTestQName(x[0])}},Ne.actionTable=[" s s        sssssssss    s ss  s  ss","                 s                  ","r  rrrrrrrrr         rrrrrrr rr  r  ","                rrrrr               "," s s        sssssssss    s ss  s  ss","rs  rrrrrrrr s  sssssrrrrrr  rrs rs "," s s        sssssssss    s ss  s  ss","                            s       ","                            s       ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","  s                                 ","                            s       "," s           s  sssss          s  s ","r  rrrrrrrrr         rrrrrrr rr  r  ","a                                   ","r       s                    rr  r  ","r      sr                    rr  r  ","r   s  rr            s       rr  r  ","r   rssrr            rss     rr  r  ","r   rrrrr            rrrss   rr  r  ","r   rrrrrsss         rrrrr   rr  r  ","r   rrrrrrrr         rrrrr   rr  r  ","r   rrrrrrrr         rrrrrs  rr  r  ","r   rrrrrrrr         rrrrrr  rr  r  ","r   rrrrrrrr         rrrrrr  rr  r  ","r  srrrrrrrr         rrrrrrs rr sr  ","r  srrrrrrrr         rrrrrrs rr  r  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r   rrrrrrrr         rrrrrr  rr  r  ","r   rrrrrrrr         rrrrrr  rr  r  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr  r  ","                sssss               ","r  rrrrrrrrr         rrrrrrr rr sr  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","                             s      ","r  srrrrrrrr         rrrrrrs rr  r  ","r   rrrrrrrr         rrrrr   rr  r  ","              s                     ","                             s      ","                rrrrr               "," s s        sssssssss    s sss s  ss","r  srrrrrrrr         rrrrrrs rr  r  "," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss    s ss  s  ss"," s s        sssssssss      ss  s  ss"," s s        sssssssss    s ss  s  ss"," s           s  sssss          s  s "," s           s  sssss          s  s ","r  rrrrrrrrr         rrrrrrr rr rr  "," s           s  sssss          s  s "," s           s  sssss          s  s ","r  rrrrrrrrr         rrrrrrr rr sr  ","r  rrrrrrrrr         rrrrrrr rr sr  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr rr  ","                             s      ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  ","                             rr     ","                             s      ","                             rs     ","r      sr                    rr  r  ","r   s  rr            s       rr  r  ","r   rssrr            rss     rr  r  ","r   rssrr            rss     rr  r  ","r   rrrrr            rrrss   rr  r  ","r   rrrrr            rrrss   rr  r  ","r   rrrrr            rrrss   rr  r  ","r   rrrrr            rrrss   rr  r  ","r   rrrrrsss         rrrrr   rr  r  ","r   rrrrrsss         rrrrr   rr  r  ","r   rrrrrrrr         rrrrr   rr  r  ","r   rrrrrrrr         rrrrr   rr  r  ","r   rrrrrrrr         rrrrr   rr  r  ","r   rrrrrrrr         rrrrrr  rr  r  ","                                 r  ","                                 s  ","r  srrrrrrrr         rrrrrrs rr  r  ","r  srrrrrrrr         rrrrrrs rr  r  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr  r  ","r  rrrrrrrrr         rrrrrrr rr rr  ","r  rrrrrrrrr         rrrrrrr rr rr  "," s s        sssssssss    s ss  s  ss","r  rrrrrrrrr         rrrrrrr rr rr  ","                             r      "],Ne.actionTableNumber=[" 1 0        /.-,+*)('    & %$  #  \"!","                 J                  ","a  aaaaaaaaa         aaaaaaa aa  a  ","                YYYYY               "," 1 0        /.-,+*)('    & %$  #  \"!","K1  KKKKKKKK .  +*)('KKKKKK  KK# K\" "," 1 0        /.-,+*)('    & %$  #  \"!","                            N       ","                            O       ","e  eeeeeeeee         eeeeeee ee ee  ","f  fffffffff         fffffff ff ff  ","d  ddddddddd         ddddddd dd dd  ","B  BBBBBBBBB         BBBBBBB BB BB  ","A  AAAAAAAAA         AAAAAAA AA AA  ","  P                                 ","                            Q       "," 1           .  +*)('          #  \" ","b  bbbbbbbbb         bbbbbbb bb  b  ","                                    ","!       S                    !!  !  ",'"      T"                    ""  "  ',"$   V  $$            U       $$  $  ","&   &ZY&&            &XW     &&  &  ",")   )))))            )))\\[   ))  )  ",".   ....._^]         .....   ..  .  ","1   11111111         11111   11  1  ","5   55555555         55555`  55  5  ","7   77777777         777777  77  7  ","9   99999999         999999  99  9  ",":  c::::::::         ::::::b :: a:  ","I  fIIIIIIII         IIIIIIe II  I  ","=  =========         ======= == ==  ","?  ?????????         ??????? ?? ??  ","C  CCCCCCCCC         CCCCCCC CC CC  ","J   JJJJJJJJ         JJJJJJ  JJ  J  ","M   MMMMMMMM         MMMMMM  MM  M  ","N  NNNNNNNNN         NNNNNNN NN  N  ","P  PPPPPPPPP         PPPPPPP PP  P  ","                +*)('               ","R  RRRRRRRRR         RRRRRRR RR aR  ","U  UUUUUUUUU         UUUUUUU UU  U  ","Z  ZZZZZZZZZ         ZZZZZZZ ZZ ZZ  ","c  ccccccccc         ccccccc cc cc  ","                             j      ","L  fLLLLLLLL         LLLLLLe LL  L  ","6   66666666         66666   66  6  ","              k                     ","                             l      ","                XXXXX               "," 1 0        /.-,+*)('    & %$m #  \"!","_  f________         ______e __  _  "," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1 0        /.-,+*)('      %$  #  \"!"," 1 0        /.-,+*)('    & %$  #  \"!"," 1           .  +*)('          #  \" "," 1           .  +*)('          #  \" ",">  >>>>>>>>>         >>>>>>> >> >>  "," 1           .  +*)('          #  \" "," 1           .  +*)('          #  \" ","Q  QQQQQQQQQ         QQQQQQQ QQ aQ  ","V  VVVVVVVVV         VVVVVVV VV aV  ","T  TTTTTTTTT         TTTTTTT TT  T  ","@  @@@@@@@@@         @@@@@@@ @@ @@  ","                             \x87      ","[  [[[[[[[[[         [[[[[[[ [[ [[  ","D  DDDDDDDDD         DDDDDDD DD DD  ","                             HH     ","                             \x88      ","                             F\x89     ","#      T#                    ##  #  ","%   V  %%            U       %%  %  ","'   'ZY''            'XW     ''  '  ","(   (ZY((            (XW     ((  (  ","+   +++++            +++\\[   ++  +  ","*   *****            ***\\[   **  *  ","-   -----            ---\\[   --  -  ",",   ,,,,,            ,,,\\[   ,,  ,  ","0   00000_^]         00000   00  0  ","/   /////_^]         /////   //  /  ","2   22222222         22222   22  2  ","3   33333333         33333   33  3  ","4   44444444         44444   44  4  ","8   88888888         888888  88  8  ","                                 ^  ","                                 \x8a  ",";  f;;;;;;;;         ;;;;;;e ;;  ;  ","<  f<<<<<<<<         <<<<<<e <<  <  ","O  OOOOOOOOO         OOOOOOO OO  O  ","`  `````````         ``````` ``  `  ","S  SSSSSSSSS         SSSSSSS SS  S  ","W  WWWWWWWWW         WWWWWWW WW  W  ","\\  \\\\\\\\\\\\\\\\\\         \\\\\\\\\\\\\\ \\\\ \\\\  ","E  EEEEEEEEE         EEEEEEE EE EE  "," 1 0        /.-,+*)('    & %$  #  \"!","]  ]]]]]]]]]         ]]]]]]] ]] ]]  ","                             G      "],Ne.gotoTable=["3456789:;<=>?@ AB  CDEFGH IJ ","                             ","                             ","                             ","L456789:;<=>?@ AB  CDEFGH IJ ","            M        EFGH IJ ","       N;<=>?@ AB  CDEFGH IJ ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","            S        EFGH IJ ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","              e              ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                        h  J ","              i          j   ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","o456789:;<=>?@ ABpqCDEFGH IJ ","                             ","  r6789:;<=>?@ AB  CDEFGH IJ ","   s789:;<=>?@ AB  CDEFGH IJ ","    t89:;<=>?@ AB  CDEFGH IJ ","    u89:;<=>?@ AB  CDEFGH IJ ","     v9:;<=>?@ AB  CDEFGH IJ ","     w9:;<=>?@ AB  CDEFGH IJ ","     x9:;<=>?@ AB  CDEFGH IJ ","     y9:;<=>?@ AB  CDEFGH IJ ","      z:;<=>?@ AB  CDEFGH IJ ","      {:;<=>?@ AB  CDEFGH IJ ","       |;<=>?@ AB  CDEFGH IJ ","       };<=>?@ AB  CDEFGH IJ ","       ~;<=>?@ AB  CDEFGH IJ ","         \x7f=>?@ AB  CDEFGH IJ ","\x80456789:;<=>?@ AB  CDEFGH IJ\x81","            \x82        EFGH IJ ","            \x83        EFGH IJ ","                             ","                     \x84 GH IJ ","                     \x85 GH IJ ","              i          \x86   ","              i          \x87   ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","                             ","o456789:;<=>?@ AB\x8cqCDEFGH IJ ","                             ","                             "],Ne.productions=[[1,1,2],[2,1,3],[3,1,4],[3,3,3,-9,4],[4,1,5],[4,3,4,-8,5],[5,1,6],[5,3,5,-22,6],[5,3,5,-5,6],[6,1,7],[6,3,6,-23,7],[6,3,6,-24,7],[6,3,6,-6,7],[6,3,6,-7,7],[7,1,8],[7,3,7,-25,8],[7,3,7,-26,8],[8,1,9],[8,3,8,-12,9],[8,3,8,-11,9],[8,3,8,-10,9],[9,1,10],[9,2,-26,9],[10,1,11],[10,3,10,-27,11],[11,1,12],[11,1,13],[11,3,13,-28,14],[11,3,13,-4,14],[13,1,15],[13,2,13,16],[15,1,17],[15,3,-29,2,-30],[15,1,-15],[15,1,-16],[15,1,18],[18,3,-13,-29,-30],[18,4,-13,-29,19,-30],[19,1,20],[19,3,20,-31,19],[20,1,2],[12,1,14],[12,1,21],[21,1,-28],[21,2,-28,14],[21,1,22],[14,1,23],[14,3,14,-28,23],[14,1,24],[23,2,25,26],[23,1,26],[23,3,25,26,27],[23,2,26,27],[23,1,28],[27,1,16],[27,2,16,27],[25,2,-14,-3],[25,1,-32],[26,1,29],[26,3,-20,-29,-30],[26,4,-21,-29,-15,-30],[16,3,-33,30,-34],[30,1,2],[22,2,-4,14],[24,3,14,-4,23],[28,1,-35],[28,1,-2],[17,2,-36,-18],[29,1,-17],[29,1,-19],[29,1,-18]],Ne.DOUBLEDOT=2,Ne.DOUBLECOLON=3,Ne.DOUBLESLASH=4,Ne.NOTEQUAL=5,Ne.LESSTHANOREQUAL=6,Ne.GREATERTHANOREQUAL=7,Ne.AND=8,Ne.OR=9,Ne.MOD=10,Ne.DIV=11,Ne.MULTIPLYOPERATOR=12,Ne.FUNCTIONNAME=13,Ne.AXISNAME=14,Ne.LITERAL=15,Ne.NUMBER=16,Ne.ASTERISKNAMETEST=17,Ne.QNAME=18,Ne.NCNAMECOLONASTERISK=19,Ne.NODETYPE=20,Ne.PROCESSINGINSTRUCTIONWITHLITERAL=21,Ne.EQUALS=22,Ne.LESSTHAN=23,Ne.GREATERTHAN=24,Ne.PLUS=25,Ne.MINUS=26,Ne.BAR=27,Ne.SLASH=28,Ne.LEFTPARENTHESIS=29,Ne.RIGHTPARENTHESIS=30,Ne.COMMA=31,Ne.AT=32,Ne.LEFTBRACKET=33,Ne.RIGHTBRACKET=34,Ne.DOT=35,Ne.DOLLAR=36,Ne.prototype.tokenize=function(x){for(var z=[],ae=[],Oe=x+"\0",Ve=0,le=Oe.charAt(Ve++);;){for(;" "==le||"\t"==le||"\r"==le||"\n"==le;)le=Oe.charAt(Ve++);if("\0"==le||Ve>=Oe.length)break;if("("!=le)if(")"!=le)if("["!=le)if("]"!=le)if("@"!=le)if(","!=le)if("|"!=le)if("+"!=le)if("-"!=le)if("="!=le)if("$"!=le)if("."!=le)if("'"!=le&&'"'!=le)if(le>="0"&&le<="9"){for(mn=le,le=Oe.charAt(Ve++);le>="0"&&le<="9";)mn+=le,le=Oe.charAt(Ve++);if("."==le&&Oe.charAt(Ve)>="0"&&Oe.charAt(Ve)<="9")for(mn+=le,mn+=Oe.charAt(Ve++),le=Oe.charAt(Ve++);le>="0"&&le<="9";)mn+=le,le=Oe.charAt(Ve++);z.push(Ne.NUMBER),ae.push(mn)}else if("*"!=le)if(":"!=le||":"!=Oe.charAt(Ve))if("/"!=le)if("!"!=le||"="!=Oe.charAt(Ve))if("<"!=le)if(">"!=le){if("_"!=le&&!an.isLetter(le.charCodeAt(0)))throw new Error("Unexpected character "+le);var Wn=le;for(le=Oe.charAt(Ve++);an.isNCNameChar(le.charCodeAt(0));)Wn+=le,le=Oe.charAt(Ve++);if(z.length>0&&(un=z[z.length-1])!=Ne.AT&&un!=Ne.DOUBLECOLON&&un!=Ne.LEFTPARENTHESIS&&un!=Ne.LEFTBRACKET&&un!=Ne.AND&&un!=Ne.OR&&un!=Ne.MOD&&un!=Ne.DIV&&un!=Ne.MULTIPLYOPERATOR&&un!=Ne.SLASH&&un!=Ne.DOUBLESLASH&&un!=Ne.BAR&&un!=Ne.PLUS&&un!=Ne.MINUS&&un!=Ne.EQUALS&&un!=Ne.NOTEQUAL&&un!=Ne.LESSTHAN&&un!=Ne.LESSTHANOREQUAL&&un!=Ne.GREATERTHAN&&un!=Ne.GREATERTHANOREQUAL){if("and"==Wn){z.push(Ne.AND),ae.push(Wn);continue}if("or"==Wn){z.push(Ne.OR),ae.push(Wn);continue}if("mod"==Wn){z.push(Ne.MOD),ae.push(Wn);continue}if("div"==Wn){z.push(Ne.DIV),ae.push(Wn);continue}}if(":"==le){if("*"==Oe.charAt(Ve)){z.push(Ne.NCNAMECOLONASTERISK),ae.push(Wn+":*"),Ve++,le=Oe.charAt(Ve++);continue}if("_"==Oe.charAt(Ve)||an.isLetter(Oe.charCodeAt(Ve))){for(Wn+=":",le=Oe.charAt(Ve++);an.isNCNameChar(le.charCodeAt(0));)Wn+=le,le=Oe.charAt(Ve++);if("("==le){z.push(Ne.FUNCTIONNAME),ae.push(Wn);continue}z.push(Ne.QNAME),ae.push(Wn);continue}if(":"==Oe.charAt(Ve)){z.push(Ne.AXISNAME),ae.push(Wn);continue}}if("("==le){if("comment"==Wn||"text"==Wn||"node"==Wn){z.push(Ne.NODETYPE),ae.push(Wn);continue}if("processing-instruction"==Wn){")"==Oe.charAt(Ve)?z.push(Ne.NODETYPE):z.push(Ne.PROCESSINGINSTRUCTIONWITHLITERAL),ae.push(Wn);continue}z.push(Ne.FUNCTIONNAME),ae.push(Wn);continue}z.push(Ne.QNAME),ae.push(Wn)}else{if("="==Oe.charAt(Ve)){z.push(Ne.GREATERTHANOREQUAL),ae.push(">="),Ve++,le=Oe.charAt(Ve++);continue}z.push(Ne.GREATERTHAN),ae.push(">"),le=Oe.charAt(Ve++)}else{if("="==Oe.charAt(Ve)){z.push(Ne.LESSTHANOREQUAL),ae.push("<="),Ve++,le=Oe.charAt(Ve++);continue}z.push(Ne.LESSTHAN),ae.push("<"),le=Oe.charAt(Ve++)}else z.push(Ne.NOTEQUAL),ae.push("!="),Ve++,le=Oe.charAt(Ve++);else{if("/"==(le=Oe.charAt(Ve++))){z.push(Ne.DOUBLESLASH),ae.push("//"),le=Oe.charAt(Ve++);continue}z.push(Ne.SLASH),ae.push("/")}else z.push(Ne.DOUBLECOLON),ae.push("::"),Ve++,le=Oe.charAt(Ve++);else{var un;if(z.length>0&&(un=z[z.length-1])!=Ne.AT&&un!=Ne.DOUBLECOLON&&un!=Ne.LEFTPARENTHESIS&&un!=Ne.LEFTBRACKET&&un!=Ne.AND&&un!=Ne.OR&&un!=Ne.MOD&&un!=Ne.DIV&&un!=Ne.MULTIPLYOPERATOR&&un!=Ne.SLASH&&un!=Ne.DOUBLESLASH&&un!=Ne.BAR&&un!=Ne.PLUS&&un!=Ne.MINUS&&un!=Ne.EQUALS&&un!=Ne.NOTEQUAL&&un!=Ne.LESSTHAN&&un!=Ne.LESSTHANOREQUAL&&un!=Ne.GREATERTHAN&&un!=Ne.GREATERTHANOREQUAL){z.push(Ne.MULTIPLYOPERATOR),ae.push(le),le=Oe.charAt(Ve++);continue}z.push(Ne.ASTERISKNAMETEST),ae.push(le),le=Oe.charAt(Ve++)}else{for(var _i=le,Ii="";Ve<Oe.length&&(le=Oe.charAt(Ve))!==_i;)Ii+=le,Ve+=1;if(le!==_i)throw Wo.fromMessage("Unterminated string literal: "+_i+Ii);Ve+=1,z.push(Ne.LITERAL),ae.push(Ii),le=Oe.charAt(Ve++)}else{if("."==(le=Oe.charAt(Ve++))){z.push(Ne.DOUBLEDOT),ae.push(".."),le=Oe.charAt(Ve++);continue}if(le>="0"&&le<="9"){var mn="."+le;for(le=Oe.charAt(Ve++);le>="0"&&le<="9";)mn+=le,le=Oe.charAt(Ve++);z.push(Ne.NUMBER),ae.push(mn);continue}z.push(Ne.DOT),ae.push(".")}else z.push(Ne.DOLLAR),ae.push(le),le=Oe.charAt(Ve++);else z.push(Ne.EQUALS),ae.push(le),le=Oe.charAt(Ve++);else z.push(Ne.MINUS),ae.push(le),le=Oe.charAt(Ve++);else z.push(Ne.PLUS),ae.push(le),le=Oe.charAt(Ve++);else z.push(Ne.BAR),ae.push(le),le=Oe.charAt(Ve++);else z.push(Ne.COMMA),ae.push(le),le=Oe.charAt(Ve++);else z.push(Ne.AT),ae.push(le),le=Oe.charAt(Ve++);else z.push(Ne.RIGHTBRACKET),ae.push(le),le=Oe.charAt(Ve++);else z.push(Ne.LEFTBRACKET),ae.push(le),le=Oe.charAt(Ve++);else z.push(Ne.RIGHTPARENTHESIS),ae.push(le),le=Oe.charAt(Ve++);else z.push(Ne.LEFTPARENTHESIS),ae.push(le),le=Oe.charAt(Ve++)}return z.push(1),ae.push("[EOF]"),[z,ae]},Ne.SHIFT="s",Ne.REDUCE="r",Ne.ACCEPT="a",Ne.prototype.parse=function(Ii){var z,ae,Oe=this.tokenize(Ii);if(null!=Oe){z=Oe[0],ae=Oe[1];var un,Wn,Ve=0,le=[],mn=[],_i=[];for(le.push(0),mn.push(1),_i.push("_S"),un=z[Ve],Wn=ae[Ve++];;)switch(Ii=le[le.length-1],Ne.actionTable[Ii].charAt(un-1)){case Ne.SHIFT:mn.push(-un),_i.push(Wn),le.push(Ne.actionTableNumber[Ii].charCodeAt(un-1)-32),un=z[Ve],Wn=ae[Ve++];break;case Ne.REDUCE:for(var Zr=Ne.productions[Ne.actionTableNumber[Ii].charCodeAt(un-1)-32][1],Xo=[],li=0;li<Zr;li++)mn.pop(),Xo.unshift(_i.pop()),le.pop();var re=le[le.length-1];mn.push(Ne.productions[Ne.actionTableNumber[Ii].charCodeAt(un-1)-32][0]),null==this.reduceActions[Ne.actionTableNumber[Ii].charCodeAt(un-1)-32]?_i.push(Xo[0]):_i.push(this.reduceActions[Ne.actionTableNumber[Ii].charCodeAt(un-1)-32](Xo)),le.push(Ne.gotoTable[re].charCodeAt(Ne.productions[Ne.actionTableNumber[Ii].charCodeAt(un-1)-32][0]-2)-33);break;case Ne.ACCEPT:return new jn(_i.pop());default:throw new Error("XPath parse error")}}},(jn.prototype=new Object).constructor=jn,jn.superclass=Object.prototype,jn.prototype.toString=function(){return this.expression.toString()},jn.prototype.evaluate=function(x){return x.contextNode=x.expressionContextNode,x.contextSize=1,x.contextPosition=1,x.isHtml&&(mt(x,"caseInsensitive",!0),mt(x,"allowAnyNamespaceForNoPrefix",!0)),mt(x,"caseInsensitive",!1),this.expression.evaluate(x)},jn.XML_NAMESPACE_URI="http://www.w3.org/XML/1998/namespace",jn.XMLNS_NAMESPACE_URI="http://www.w3.org/2000/xmlns/",(gi.prototype=new Object).constructor=gi,gi.superclass=Object.prototype,gi.prototype.init=function(){},gi.prototype.toString=function(){return"<Expression>"},gi.prototype.evaluate=function(x){throw new Error("Could not evaluate expression.")},(Ie.prototype=new gi).constructor=Ie,Ie.superclass=gi.prototype,Ie.prototype.init=function(x){this.rhs=x},(Se.prototype=new Ie).constructor=Se,Se.superclass=Ie.prototype,Se.prototype.init=function(x){Se.superclass.init.call(this,x)},Se.prototype.evaluate=function(x){return this.rhs.evaluate(x).number().negate()},Se.prototype.toString=function(){return"-"+this.rhs.toString()},(Ae.prototype=new gi).constructor=Ae,Ae.superclass=gi.prototype,Ae.prototype.init=function(x,z){this.lhs=x,this.rhs=z},(ee.prototype=new Ae).constructor=ee,ee.superclass=Ae.prototype,ee.prototype.init=function(x,z){ee.superclass.init.call(this,x,z)},ee.prototype.toString=function(){return"("+this.lhs.toString()+" or "+this.rhs.toString()+")"},ee.prototype.evaluate=function(x){var z=this.lhs.evaluate(x).bool();return z.booleanValue()?z:this.rhs.evaluate(x).bool()},(nt.prototype=new Ae).constructor=nt,nt.superclass=Ae.prototype,nt.prototype.init=function(x,z){nt.superclass.init.call(this,x,z)},nt.prototype.toString=function(){return"("+this.lhs.toString()+" and "+this.rhs.toString()+")"},nt.prototype.evaluate=function(x){var z=this.lhs.evaluate(x).bool();return z.booleanValue()?this.rhs.evaluate(x).bool():z},(at.prototype=new Ae).constructor=at,at.superclass=Ae.prototype,at.prototype.init=function(x,z){at.superclass.init.call(this,x,z)},at.prototype.toString=function(){return"("+this.lhs.toString()+" = "+this.rhs.toString()+")"},at.prototype.evaluate=function(x){return this.lhs.evaluate(x).equals(this.rhs.evaluate(x))},(pe.prototype=new Ae).constructor=pe,pe.superclass=Ae.prototype,pe.prototype.init=function(x,z){pe.superclass.init.call(this,x,z)},pe.prototype.toString=function(){return"("+this.lhs.toString()+" != "+this.rhs.toString()+")"},pe.prototype.evaluate=function(x){return this.lhs.evaluate(x).notequal(this.rhs.evaluate(x))},(et.prototype=new Ae).constructor=et,et.superclass=Ae.prototype,et.prototype.init=function(x,z){et.superclass.init.call(this,x,z)},et.prototype.evaluate=function(x){return this.lhs.evaluate(x).lessthan(this.rhs.evaluate(x))},et.prototype.toString=function(){return"("+this.lhs.toString()+" < "+this.rhs.toString()+")"},(Ke.prototype=new Ae).constructor=Ke,Ke.superclass=Ae.prototype,Ke.prototype.init=function(x,z){Ke.superclass.init.call(this,x,z)},Ke.prototype.evaluate=function(x){return this.lhs.evaluate(x).greaterthan(this.rhs.evaluate(x))},Ke.prototype.toString=function(){return"("+this.lhs.toString()+" > "+this.rhs.toString()+")"},(sn.prototype=new Ae).constructor=sn,sn.superclass=Ae.prototype,sn.prototype.init=function(x,z){sn.superclass.init.call(this,x,z)},sn.prototype.evaluate=function(x){return this.lhs.evaluate(x).lessthanorequal(this.rhs.evaluate(x))},sn.prototype.toString=function(){return"("+this.lhs.toString()+" <= "+this.rhs.toString()+")"},(wn.prototype=new Ae).constructor=wn,wn.superclass=Ae.prototype,wn.prototype.init=function(x,z){wn.superclass.init.call(this,x,z)},wn.prototype.evaluate=function(x){return this.lhs.evaluate(x).greaterthanorequal(this.rhs.evaluate(x))},wn.prototype.toString=function(){return"("+this.lhs.toString()+" >= "+this.rhs.toString()+")"},(Un.prototype=new Ae).constructor=Un,Un.superclass=Ae.prototype,Un.prototype.init=function(x,z){Un.superclass.init.call(this,x,z)},Un.prototype.evaluate=function(x){return this.lhs.evaluate(x).number().plus(this.rhs.evaluate(x).number())},Un.prototype.toString=function(){return"("+this.lhs.toString()+" + "+this.rhs.toString()+")"},(Fi.prototype=new Ae).constructor=Fi,Fi.superclass=Ae.prototype,Fi.prototype.init=function(x,z){Fi.superclass.init.call(this,x,z)},Fi.prototype.evaluate=function(x){return this.lhs.evaluate(x).number().minus(this.rhs.evaluate(x).number())},Fi.prototype.toString=function(){return"("+this.lhs.toString()+" - "+this.rhs.toString()+")"},(en.prototype=new Ae).constructor=en,en.superclass=Ae.prototype,en.prototype.init=function(x,z){en.superclass.init.call(this,x,z)},en.prototype.evaluate=function(x){return this.lhs.evaluate(x).number().multiply(this.rhs.evaluate(x).number())},en.prototype.toString=function(){return"("+this.lhs.toString()+" * "+this.rhs.toString()+")"},(ti.prototype=new Ae).constructor=ti,ti.superclass=Ae.prototype,ti.prototype.init=function(x,z){ti.superclass.init.call(this,x,z)},ti.prototype.evaluate=function(x){return this.lhs.evaluate(x).number().div(this.rhs.evaluate(x).number())},ti.prototype.toString=function(){return"("+this.lhs.toString()+" div "+this.rhs.toString()+")"},(nr.prototype=new Ae).constructor=nr,nr.superclass=Ae.prototype,nr.prototype.init=function(x,z){nr.superclass.init.call(this,x,z)},nr.prototype.evaluate=function(x){return this.lhs.evaluate(x).number().mod(this.rhs.evaluate(x).number())},nr.prototype.toString=function(){return"("+this.lhs.toString()+" mod "+this.rhs.toString()+")"},(qr.prototype=new Ae).constructor=qr,qr.superclass=Ae.prototype,qr.prototype.init=function(x,z){qr.superclass.init.call(this,x,z)},qr.prototype.evaluate=function(x){return this.lhs.evaluate(x).nodeset().union(this.rhs.evaluate(x).nodeset())},qr.prototype.toString=function(){return me(Ye,[this.lhs,this.rhs]).join(" | ")},(ni.prototype=new gi).constructor=ni,ni.superclass=gi.prototype,ni.prototype.init=function(x,z,ae){ni.superclass.init.call(this),this.filter=x,this.filterPredicates=z,this.locationPath=ae},ni.applyPredicates=function(x,z,ae){if(0===x.length)return ae;var Oe=z.extend({});return p(function(Ve,le){return Oe.contextSize=Ve.length,function(x,z){var ae=[];return ze(function(Oe,Ve){x(Oe,Ve)&&ae.push(Oe)},z),ae}(function(mn,_i){return Oe.contextNode=mn,Oe.contextPosition=_i+1,ni.predicateMatches(le,Oe)},Ve)},ae,x)},ni.getRoot=function(x,z){var ae=z[0];if(9===ae.nodeType)return ae;if(x.virtualRoot)return x.virtualRoot;var Oe=ae.ownerDocument;if(Oe)return Oe;for(var Ve=ae;null!=Ve.parentNode;)Ve=Ve.parentNode;return Ve},ni.applyStep=function(x,z,ae){var Ve=[];switch(z.contextNode=ae,x.axis){case Tt.ANCESTOR:if(z.contextNode===z.virtualRoot)break;for(le=2==z.contextNode.nodeType?ni.getOwnerElement(z.contextNode):z.contextNode.parentNode;null!=le&&(x.nodeTest.matches(le,z)&&Ve.push(le),le!==z.virtualRoot);)le=le.parentNode;break;case Tt.ANCESTORORSELF:for(var le=z.contextNode;null!=le&&(x.nodeTest.matches(le,z)&&Ve.push(le),le!==z.virtualRoot);le=2==le.nodeType?ni.getOwnerElement(le):le.parentNode);break;case Tt.ATTRIBUTE:var mn=z.contextNode.attributes;if(null!=mn)for(var _i=0;_i<mn.length;_i++)le=mn.item(_i),x.nodeTest.matches(le,z)&&Ve.push(le);break;case Tt.CHILD:for(le=z.contextNode.firstChild;null!=le;le=le.nextSibling)x.nodeTest.matches(le,z)&&Ve.push(le);break;case Tt.DESCENDANT:for(var li=[z.contextNode.firstChild];li.length>0;)for(le=li.pop();null!=le;)x.nodeTest.matches(le,z)&&Ve.push(le),null!=le.firstChild?(li.push(le.nextSibling),le=le.firstChild):le=le.nextSibling;break;case Tt.DESCENDANTORSELF:for(x.nodeTest.matches(z.contextNode,z)&&Ve.push(z.contextNode),li=[z.contextNode.firstChild];li.length>0;)for(le=li.pop();null!=le;)x.nodeTest.matches(le,z)&&Ve.push(le),null!=le.firstChild?(li.push(le.nextSibling),le=le.firstChild):le=le.nextSibling;break;case Tt.FOLLOWING:if(z.contextNode===z.virtualRoot)break;for((li=[]).unshift(null!=z.contextNode.firstChild?z.contextNode.firstChild:z.contextNode.nextSibling),le=z.contextNode.parentNode;null!=le&&9!=le.nodeType&&le!==z.virtualRoot;le=le.parentNode)li.unshift(le.nextSibling);do{for(le=li.pop();null!=le;)x.nodeTest.matches(le,z)&&Ve.push(le),null!=le.firstChild?(li.push(le.nextSibling),le=le.firstChild):le=le.nextSibling}while(li.length>0);break;case Tt.FOLLOWINGSIBLING:if(z.contextNode===z.virtualRoot)break;for(le=z.contextNode.nextSibling;null!=le;le=le.nextSibling)x.nodeTest.matches(le,z)&&Ve.push(le);break;case Tt.NAMESPACE:var Ii={};if(1==z.contextNode.nodeType){for(Ii.xml=jn.XML_NAMESPACE_URI,Ii.xmlns=jn.XMLNS_NAMESPACE_URI,le=z.contextNode;null!=le&&1==le.nodeType;le=le.parentNode)for(_i=0;_i<le.attributes.length;_i++){var un=le.attributes.item(_i),Wn=String(un.name);"xmlns"==Wn?null==Ii[""]&&(Ii[""]=un.value):Wn.length>6&&"xmlns:"==Wn.substring(0,6)&&null==Ii[Zr=Wn.substring(6,Wn.length)]&&(Ii[Zr]=un.value)}for(var Zr in Ii){var Xo=new Wr(Zr,Ii[Zr],z.contextNode);x.nodeTest.matches(Xo,z)&&Ve.push(Xo)}}break;case Tt.PARENT:le=null,z.contextNode!==z.virtualRoot&&(le=2==z.contextNode.nodeType?ni.getOwnerElement(z.contextNode):z.contextNode.parentNode),null!=le&&x.nodeTest.matches(le,z)&&Ve.push(le);break;case Tt.PRECEDING:li=null!=z.virtualRoot?[z.virtualRoot]:[Qt(z.contextNode)];e:for(;li.length>0;)for(le=li.pop();null!=le;){if(le==z.contextNode)break e;x.nodeTest.matches(le,z)&&Ve.unshift(le),null!=le.firstChild?(li.push(le.nextSibling),le=le.firstChild):le=le.nextSibling}break;case Tt.PRECEDINGSIBLING:if(z.contextNode===z.virtualRoot)break;for(le=z.contextNode.previousSibling;null!=le;le=le.previousSibling)x.nodeTest.matches(le,z)&&Ve.push(le);break;case Tt.SELF:x.nodeTest.matches(z.contextNode,z)&&Ve.push(z.contextNode)}return Ve},ni.applySteps=function(x,z,ae){return p(Eo.bind(null,z),ae,x)},ni.prototype.applyFilter=function(x,z){if(!this.filter)return{nodes:[x.contextNode]};var ae=this.filter.evaluate(x);if(!an.instance_of(ae,pn)){if(null!=this.filterPredicates&&this.filterPredicates.length>0||null!=this.locationPath)throw new Error("Path expression filter must evaluate to a nodeset if predicates or location path are used");return{nonNodes:ae}}return{nodes:ni.applyPredicates(this.filterPredicates||[],z,ae.toUnsortedArray())}},ni.applyLocationPath=function(x,z,ae){if(!x)return ae;var Oe=x.absolute?[ni.getRoot(z,ae)]:ae;return ni.applySteps(x.steps,z,Oe)},ni.prototype.evaluate=function(x){var z=dn(new yo,x),ae=this.applyFilter(x,z);if("nonNodes"in ae)return ae.nonNodes;var Oe=new pn;return Oe.addArray(ni.applyLocationPath(this.locationPath,z,ae.nodes)),Oe},ni.predicateMatches=function(x,z){var ae=x.evaluate(z);return an.instance_of(ae,Sn)?z.contextPosition===ae.numberValue():ae.booleanValue()},ni.predicateString=function(x){return kt("[","]",x.toString())},ni.predicatesString=function(x){return Ft("",me(ni.predicateString,x))},ni.prototype.toString=function(){if(null!=this.filter){var x=Ye(this.filter);return an.instance_of(this.filter,zt)?kt("'","'",x):null!=this.filterPredicates&&this.filterPredicates.length?kt("(",")",x)+ni.predicatesString(this.filterPredicates):null!=this.locationPath?x+(this.locationPath.absolute?"":"/")+Ye(this.locationPath):x}return Ye(this.locationPath)},ni.getOwnerElement=function(x){if(x.ownerElement)return x.ownerElement;try{if(x.selectSingleNode)return x.selectSingleNode("..")}catch(Ii){}for(var ae=(9==x.nodeType?x:x.ownerDocument).getElementsByTagName("*"),Oe=0;Oe<ae.length;Oe++)for(var Ve=ae.item(Oe),le=Ve.attributes,mn=0;mn<le.length;mn++)if(le.item(mn)===x)return Ve;return null},(di.prototype=new Object).constructor=di,di.superclass=Object.prototype,di.prototype.init=function(x,z){this.absolute=x,this.steps=z},di.prototype.toString=function(){return(this.absolute?"/":"")+me(Ye,this.steps).join("/")},(Tt.prototype=new Object).constructor=Tt,Tt.superclass=Object.prototype,Tt.prototype.init=function(x,z,ae){this.axis=x,this.nodeTest=z,this.predicates=ae},Tt.prototype.toString=function(){return Tt.STEPNAMES[this.axis]+"::"+this.nodeTest.toString()+ni.predicatesString(this.predicates)},Tt.STEPNAMES=p(function(x,z){return x[z[0]]=z[1],x},{},[[Tt.ANCESTOR=0,"ancestor"],[Tt.ANCESTORORSELF=1,"ancestor-or-self"],[Tt.ATTRIBUTE=2,"attribute"],[Tt.CHILD=3,"child"],[Tt.DESCENDANT=4,"descendant"],[Tt.DESCENDANTORSELF=5,"descendant-or-self"],[Tt.FOLLOWING=6,"following"],[Tt.FOLLOWINGSIBLING=7,"following-sibling"],[Tt.NAMESPACE=8,"namespace"],[Tt.PARENT=9,"parent"],[Tt.PRECEDING=10,"preceding"],[Tt.PRECEDINGSIBLING=11,"preceding-sibling"],[Tt.SELF=12,"self"]]),(Jt.prototype=new Object).constructor=Jt,Jt.superclass=Object.prototype,Jt.prototype.init=function(x,z){this.type=x,this.value=z},Jt.prototype.toString=function(){return"<unknown nodetest type>"},Jt.prototype.matches=function(x,z){console.warn("unknown node test type")},Jt.NAMETESTANY=0,Jt.NAMETESTPREFIXANY=1,Jt.NAMETESTQNAME=2,Jt.COMMENT=3,Jt.TEXT=4,Jt.PI=5,Jt.NODE=6,Jt.isNodeType=function(x){return function(z){return function(x,z){for(var ae=0;ae<x.length;ae+=1)if(x[ae]===z)return!0;return!1}(x,z.nodeType)}},Jt.makeNodeTestType=function(x,z,ae){var Oe=ae||function(){};return Oe.prototype=new Jt(x),Oe.prototype.constructor=Oe,dn(Oe.prototype,z),Oe},Jt.makeNodeTypeTest=function(x,z,ae){return new(Jt.makeNodeTestType(x,{matches:Jt.isNodeType(z),toString:Ge(ae)}))},Jt.hasPrefix=function(x){return x.prefix||-1!==(x.nodeName||x.tagName).indexOf(":")},Jt.isElementOrAttribute=Jt.isNodeType([1,2]),Jt.nameSpaceMatches=function(x,z,ae){var Oe=ae.namespaceURI||"";if(!x)return!Oe||z.allowAnyNamespaceForNoPrefix&&!Jt.hasPrefix(ae);var Ve=z.namespaceResolver.getNamespace(x,z.expressionContextNode);if(null==Ve)throw new Error("Cannot resolve QName "+x);return Ve===Oe},Jt.localNameMatches=function(x,z,ae){var Oe=ae.localName||ae.nodeName;return z.caseInsensitive?x.toLowerCase()===Oe.toLowerCase():x===Oe},Jt.NameTestPrefixAny=Jt.makeNodeTestType(Jt.NAMETESTPREFIXANY,{matches:function(x,z){return Jt.isElementOrAttribute(x)&&Jt.nameSpaceMatches(this.prefix,z,x)},toString:function(){return this.prefix+":*"}},function(z){this.prefix=z}),Jt.NameTestQName=Jt.makeNodeTestType(Jt.NAMETESTQNAME,{matches:function(x,z){return Jt.isNodeType([1,2,Wr.XPATH_NAMESPACE_NODE])(x)&&Jt.nameSpaceMatches(this.prefix,z,x)&&Jt.localNameMatches(this.localName,z,x)},toString:function(){return this.name}},function(z){var ae=z.split(":");this.name=z,this.prefix=ae.length>1?ae[0]:null,this.localName=ae[ae.length>1?1:0]}),Jt.PITest=Jt.makeNodeTestType(Jt.PI,{matches:function(x,z){return Jt.isNodeType([7])(x)&&(x.target||x.nodeName)===this.name},toString:function(){return kt('processing-instruction("','")',this.name)}},function(x){this.name=x}),Jt.nameTestAny=Jt.makeNodeTypeTest(Jt.NAMETESTANY,[1,2,Wr.XPATH_NAMESPACE_NODE],"*"),Jt.textTest=Jt.makeNodeTypeTest(Jt.TEXT,[3,4],"text()"),Jt.commentTest=Jt.makeNodeTypeTest(Jt.COMMENT,[8],"comment()"),Jt.nodeTest=Jt.makeNodeTypeTest(Jt.NODE,[1,2,3,4,7,8,9],"node()"),Jt.anyPiTest=Jt.makeNodeTypeTest(Jt.PI,[7],"processing-instruction()"),(Hn.prototype=new gi).constructor=Hn,Hn.superclass=gi.prototype,Hn.prototype.init=function(x){this.variable=x},Hn.prototype.toString=function(){return"$"+this.variable},Hn.prototype.evaluate=function(x){var z=an.resolveQName(this.variable,x.namespaceResolver,x.contextNode,!1);if(null==z[0])throw new Error("Cannot resolve QName "+fn);var ae=x.variableResolver.getVariable(z[1],z[0]);if(!ae)throw Wo.fromMessage("Undeclared variable: "+this.toString());return ae},(Ni.prototype=new gi).constructor=Ni,Ni.superclass=gi.prototype,Ni.prototype.init=function(x,z){this.functionName=x,this.arguments=z},Ni.prototype.toString=function(){for(var x=this.functionName+"(",z=0;z<this.arguments.length;z++)z>0&&(x+=", "),x+=this.arguments[z].toString();return x+")"},Ni.prototype.evaluate=function(x){var z=qo.getFunctionFromContext(this.functionName,x);if(!z)throw new Error("Unknown function "+this.functionName);var ae=[x].concat(this.arguments);return z.apply(x.functionResolver.thisArg,ae)};var ir=new Object;function zt(x){arguments.length>0&&this.init(x)}function Sn(x){arguments.length>0&&this.init(x)}function In(x){arguments.length>0&&this.init(x)}function _o(x){this.init(x)}function pn(){this.init()}function Wr(x,z,ae){this.isXPathNamespace=!0,this.ownerDocument=ae.ownerDocument,this.nodeName="#namespace",this.prefix=x,this.localName=x,this.namespaceURI=z,this.nodeValue=z,this.ownerElement=ae,this.nodeType=Wr.XPATH_NAMESPACE_NODE}function yo(x,z,ae){this.variableResolver=null!=x?x:new ys,this.namespaceResolver=null!=z?z:new vs,this.functionResolver=null!=ae?ae:new qo}function ys(){}function qo(x){this.thisArg=null!=x?x:On,this.functions=new Object,this.addStandardFunctions()}function vs(){}ir.equals=function(x,z){return x.equals(z)},ir.notequal=function(x,z){return x.notequal(z)},ir.lessthan=function(x,z){return x.lessthan(z)},ir.greaterthan=function(x,z){return x.greaterthan(z)},ir.lessthanorequal=function(x,z){return x.lessthanorequal(z)},ir.greaterthanorequal=function(x,z){return x.greaterthanorequal(z)},(zt.prototype=new gi).constructor=zt,zt.superclass=gi.prototype,zt.prototype.init=function(x){this.str=String(x)},zt.prototype.toString=function(){return this.str},zt.prototype.evaluate=function(x){return this},zt.prototype.string=function(){return this},zt.prototype.number=function(){return new Sn(this.str)},zt.prototype.bool=function(){return new In(this.str)},zt.prototype.nodeset=function(){throw new Error("Cannot convert string to nodeset")},zt.prototype.stringValue=function(){return this.str},zt.prototype.numberValue=function(){return this.number().numberValue()},zt.prototype.booleanValue=function(){return this.bool().booleanValue()},zt.prototype.equals=function(x){return an.instance_of(x,In)?this.bool().equals(x):an.instance_of(x,Sn)?this.number().equals(x):an.instance_of(x,pn)?x.compareWithString(this,ir.equals):new In(this.str==x.str)},zt.prototype.notequal=function(x){return an.instance_of(x,In)?this.bool().notequal(x):an.instance_of(x,Sn)?this.number().notequal(x):an.instance_of(x,pn)?x.compareWithString(this,ir.notequal):new In(this.str!=x.str)},zt.prototype.lessthan=function(x){return this.number().lessthan(x)},zt.prototype.greaterthan=function(x){return this.number().greaterthan(x)},zt.prototype.lessthanorequal=function(x){return this.number().lessthanorequal(x)},zt.prototype.greaterthanorequal=function(x){return this.number().greaterthanorequal(x)},(Sn.prototype=new gi).constructor=Sn,Sn.superclass=gi.prototype,Sn.prototype.init=function(x){this.num="string"==typeof x?this.parse(x):Number(x)},Sn.prototype.numberFormat=/^\s*-?[0-9]*\.?[0-9]+\s*$/,Sn.prototype.parse=function(x){return this.numberFormat.test(x)?parseFloat(x):Number.NaN},Sn.prototype.toString=function(){var x=this.num.toString();return-1!==x.indexOf("e-")?function ru(x){for(var z=x.split("e-"),ae=z[0].replace(".",""),Oe=Number(z[1]),Ve=0;Ve<Oe-1;Ve+=1)ae="0"+ae;return"0."+ae}(x):-1!==x.indexOf("e")?function Ya(x){for(var z=x.split("e"),ae=z[0].replace(".",""),Ve=Number(z[1])+1-ae.length,le=0;le<Ve;le+=1)ae+="0";return ae}(x):x},Sn.prototype.evaluate=function(x){return this},Sn.prototype.string=function(){return new zt(this.toString())},Sn.prototype.number=function(){return this},Sn.prototype.bool=function(){return new In(this.num)},Sn.prototype.nodeset=function(){throw new Error("Cannot convert number to nodeset")},Sn.prototype.stringValue=function(){return this.string().stringValue()},Sn.prototype.numberValue=function(){return this.num},Sn.prototype.booleanValue=function(){return this.bool().booleanValue()},Sn.prototype.negate=function(){return new Sn(-this.num)},Sn.prototype.equals=function(x){return an.instance_of(x,In)?this.bool().equals(x):an.instance_of(x,zt)?this.equals(x.number()):an.instance_of(x,pn)?x.compareWithNumber(this,ir.equals):new In(this.num==x.num)},Sn.prototype.notequal=function(x){return an.instance_of(x,In)?this.bool().notequal(x):an.instance_of(x,zt)?this.notequal(x.number()):an.instance_of(x,pn)?x.compareWithNumber(this,ir.notequal):new In(this.num!=x.num)},Sn.prototype.lessthan=function(x){return an.instance_of(x,pn)?x.compareWithNumber(this,ir.greaterthan):an.instance_of(x,In)||an.instance_of(x,zt)?this.lessthan(x.number()):new In(this.num<x.num)},Sn.prototype.greaterthan=function(x){return an.instance_of(x,pn)?x.compareWithNumber(this,ir.lessthan):an.instance_of(x,In)||an.instance_of(x,zt)?this.greaterthan(x.number()):new In(this.num>x.num)},Sn.prototype.lessthanorequal=function(x){return an.instance_of(x,pn)?x.compareWithNumber(this,ir.greaterthanorequal):an.instance_of(x,In)||an.instance_of(x,zt)?this.lessthanorequal(x.number()):new In(this.num<=x.num)},Sn.prototype.greaterthanorequal=function(x){return an.instance_of(x,pn)?x.compareWithNumber(this,ir.lessthanorequal):an.instance_of(x,In)||an.instance_of(x,zt)?this.greaterthanorequal(x.number()):new In(this.num>=x.num)},Sn.prototype.plus=function(x){return new Sn(this.num+x.num)},Sn.prototype.minus=function(x){return new Sn(this.num-x.num)},Sn.prototype.multiply=function(x){return new Sn(this.num*x.num)},Sn.prototype.div=function(x){return new Sn(this.num/x.num)},Sn.prototype.mod=function(x){return new Sn(this.num%x.num)},(In.prototype=new gi).constructor=In,In.superclass=gi.prototype,In.prototype.init=function(x){this.b=Boolean(x)},In.prototype.toString=function(){return this.b.toString()},In.prototype.evaluate=function(x){return this},In.prototype.string=function(){return new zt(this.b)},In.prototype.number=function(){return new Sn(this.b)},In.prototype.bool=function(){return this},In.prototype.nodeset=function(){throw new Error("Cannot convert boolean to nodeset")},In.prototype.stringValue=function(){return this.string().stringValue()},In.prototype.numberValue=function(){return this.number().numberValue()},In.prototype.booleanValue=function(){return this.b},In.prototype.not=function(){return new In(!this.b)},In.prototype.equals=function(x){return an.instance_of(x,zt)||an.instance_of(x,Sn)?this.equals(x.bool()):an.instance_of(x,pn)?x.compareWithBoolean(this,ir.equals):new In(this.b==x.b)},In.prototype.notequal=function(x){return an.instance_of(x,zt)||an.instance_of(x,Sn)?this.notequal(x.bool()):an.instance_of(x,pn)?x.compareWithBoolean(this,ir.notequal):new In(this.b!=x.b)},In.prototype.lessthan=function(x){return this.number().lessthan(x)},In.prototype.greaterthan=function(x){return this.number().greaterthan(x)},In.prototype.lessthanorequal=function(x){return this.number().lessthanorequal(x)},In.prototype.greaterthanorequal=function(x){return this.number().greaterthanorequal(x)},In.true_=new In(!0),In.false_=new In(!1),(_o.prototype=new Object).constructor=_o,_o.superclass=Object.prototype,_o.prototype.init=function(x){this.left=null,this.right=null,this.node=x,this.depth=1},_o.prototype.balance=function(){var x=null==this.left?0:this.left.depth,z=null==this.right?0:this.right.depth;x>z+1?((null==this.left.left?0:this.left.left.depth)<(null==this.left.right?0:this.left.right.depth)&&this.left.rotateRR(),this.rotateLL()):x+1<z&&((null==this.right.left?0:this.right.left.depth)>(null==this.right.right?0:this.right.right.depth)&&this.right.rotateLL(),this.rotateRR())},_o.prototype.rotateLL=function(){var x=this.node,z=this.right;this.node=this.left.node,this.right=this.left,this.left=this.left.left,this.right.left=this.right.right,this.right.right=z,this.right.node=x,this.right.updateInNewLocation(),this.updateInNewLocation()},_o.prototype.rotateRR=function(){var x=this.node,z=this.left;this.node=this.right.node,this.left=this.right,this.right=this.right.right,this.left.right=this.left.left,this.left.left=z,this.left.node=x,this.left.updateInNewLocation(),this.updateInNewLocation()},_o.prototype.updateInNewLocation=function(){this.getDepthFromChildren()},_o.prototype.getDepthFromChildren=function(){this.depth=null==this.node?0:1,null!=this.left&&(this.depth=this.left.depth+1),null!=this.right&&this.depth<=this.right.depth&&(this.depth=this.right.depth+1)},_o.prototype.add=function(x){if(x===this.node)return!1;var z=function vl(x,z){if(x===z)return 0;if(x.compareDocumentPosition){var ae=x.compareDocumentPosition(z);return 1&ae||10&ae?1:20&ae?-1:0}for(var Oe=0,Ve=0,le=x;null!=le;le=le.parentNode||le.ownerElement)Oe++;for(var mn=z;null!=mn;mn=mn.parentNode||mn.ownerElement)Ve++;if(Oe>Ve){for(;Oe>Ve;)x=x.parentNode||x.ownerElement,Oe--;if(x===z)return 1}else if(Ve>Oe){for(;Ve>Oe;)z=z.parentNode||z.ownerElement,Ve--;if(x===z)return-1}for(var _i=x.parentNode||x.ownerElement,Ii=z.parentNode||z.ownerElement;_i!==Ii;)_i=(x=_i).parentNode||x.ownerElement,Ii=(z=Ii).parentNode||z.ownerElement;var un=an.isAttribute(x),Wn=an.isAttribute(z);if(un&&!Wn)return-1;if(!un&&Wn)return 1;if(_i)for(var Zr=un?_i.attributes:_i.childNodes,Xo=Zr.length,li=0;li<Xo;li+=1){var re=Zr[li];if(re===x)return-1;if(re===z)return 1}throw new Error("Unexpected: could not determine node order")}(x,this.node),ae=!1;return-1==z?null==this.left?(this.left=new _o(x),ae=!0):(ae=this.left.add(x))&&this.balance():1==z&&(null==this.right?(this.right=new _o(x),ae=!0):(ae=this.right.add(x))&&this.balance()),ae&&this.getDepthFromChildren(),ae},(pn.prototype=new gi).constructor=pn,pn.superclass=gi.prototype,pn.prototype.init=function(){this.tree=null,this.nodes=[],this.size=0},pn.prototype.toString=function(){var x=this.first();return null==x?"":this.stringForNode(x)},pn.prototype.evaluate=function(x){return this},pn.prototype.string=function(){return new zt(this.toString())},pn.prototype.stringValue=function(){return this.toString()},pn.prototype.number=function(){return new Sn(this.string())},pn.prototype.numberValue=function(){return Number(this.string())},pn.prototype.bool=function(){return new In(this.booleanValue())},pn.prototype.booleanValue=function(){return!!this.size},pn.prototype.nodeset=function(){return this},pn.prototype.stringForNode=function(x){return 9==x.nodeType||1==x.nodeType||11===x.nodeType?this.stringForContainerNode(x):2===x.nodeType?x.value||x.nodeValue:x.isNamespaceNode?x.namespace:x.nodeValue},pn.prototype.stringForContainerNode=function(x){for(var z="",ae=x.firstChild;null!=ae;ae=ae.nextSibling){var Oe=ae.nodeType;(1===Oe||3===Oe||4===Oe||9===Oe||11===Oe)&&(z+=this.stringForNode(ae))}return z},pn.prototype.buildTree=function(){if(!this.tree&&this.nodes.length){this.tree=new _o(this.nodes[0]);for(var x=1;x<this.nodes.length;x+=1)this.tree.add(this.nodes[x])}return this.tree},pn.prototype.first=function(){var x=this.buildTree();if(null==x)return null;for(;null!=x.left;)x=x.left;return x.node},pn.prototype.add=function(x){for(var z=0;z<this.nodes.length;z+=1)if(x===this.nodes[z])return;this.tree=null,this.nodes.push(x),this.size+=1},pn.prototype.addArray=function(x){var z=this;ze(function(ae){z.add(ae)},x)},pn.prototype.toArray=function(){var x=[];return this.toArrayRec(this.buildTree(),x),x},pn.prototype.toArrayRec=function(x,z){null!=x&&(this.toArrayRec(x.left,z),z.push(x.node),this.toArrayRec(x.right,z))},pn.prototype.toUnsortedArray=function(){return this.nodes.slice()},pn.prototype.compareWithString=function(x,z){for(var ae=this.toUnsortedArray(),Oe=0;Oe<ae.length;Oe++){var mn=z(new zt(this.stringForNode(ae[Oe])),x);if(mn.booleanValue())return mn}return new In(!1)},pn.prototype.compareWithNumber=function(x,z){for(var ae=this.toUnsortedArray(),Oe=0;Oe<ae.length;Oe++){var mn=z(new Sn(this.stringForNode(ae[Oe])),x);if(mn.booleanValue())return mn}return new In(!1)},pn.prototype.compareWithBoolean=function(x,z){return z(this.bool(),x)},pn.prototype.compareWithNodeSet=function(x,z){for(var ae=this.toUnsortedArray(),Oe=function(_i,Ii){return z(Ii,_i)},Ve=0;Ve<ae.length;Ve++){var le=new zt(this.stringForNode(ae[Ve])),mn=x.compareWithString(le,Oe);if(mn.booleanValue())return mn}return new In(!1)},pn.compareWith=function Ue(x){var z=Array.prototype.slice,ae=x.length,Oe=function(le,mn){return function(){return mn.apply(this,le.concat(z.call(arguments)))}},Ve=function(){var le=z.call(arguments);return le.length<ae?Oe(le,Ve):x.apply(this,z.apply(arguments,[0,ae]))};return Ve}(function(x,z){return an.instance_of(z,zt)?this.compareWithString(z,x):an.instance_of(z,Sn)?this.compareWithNumber(z,x):an.instance_of(z,In)?this.compareWithBoolean(z,x):this.compareWithNodeSet(z,x)}),pn.prototype.equals=pn.compareWith(ir.equals),pn.prototype.notequal=pn.compareWith(ir.notequal),pn.prototype.lessthan=pn.compareWith(ir.lessthan),pn.prototype.greaterthan=pn.compareWith(ir.greaterthan),pn.prototype.lessthanorequal=pn.compareWith(ir.lessthanorequal),pn.prototype.greaterthanorequal=pn.compareWith(ir.greaterthanorequal),pn.prototype.union=function(x){var z=new pn;return z.addArray(this.toUnsortedArray()),z.addArray(x.toUnsortedArray()),z},(Wr.prototype=new Object).constructor=Wr,Wr.superclass=Object.prototype,Wr.prototype.toString=function(){return'{ "'+this.prefix+'", "'+this.namespaceURI+'" }'},(yo.prototype=new Object).constructor=yo,yo.superclass=Object.prototype,yo.prototype.extend=function(x){return dn(new yo,this,x)},(ys.prototype=new Object).constructor=ys,ys.superclass=Object.prototype,ys.prototype.getVariable=function(x,z){return null},(qo.prototype=new Object).constructor=qo,qo.superclass=Object.prototype,qo.prototype.addStandardFunctions=function(){this.functions["{}last"]=On.last,this.functions["{}position"]=On.position,this.functions["{}count"]=On.count,this.functions["{}id"]=On.id,this.functions["{}local-name"]=On.localName,this.functions["{}namespace-uri"]=On.namespaceURI,this.functions["{}name"]=On.name,this.functions["{}string"]=On.string,this.functions["{}concat"]=On.concat,this.functions["{}starts-with"]=On.startsWith,this.functions["{}contains"]=On.contains,this.functions["{}substring-before"]=On.substringBefore,this.functions["{}substring-after"]=On.substringAfter,this.functions["{}substring"]=On.substring,this.functions["{}string-length"]=On.stringLength,this.functions["{}normalize-space"]=On.normalizeSpace,this.functions["{}translate"]=On.translate,this.functions["{}boolean"]=On.boolean_,this.functions["{}not"]=On.not,this.functions["{}true"]=On.true_,this.functions["{}false"]=On.false_,this.functions["{}lang"]=On.lang,this.functions["{}number"]=On.number,this.functions["{}sum"]=On.sum,this.functions["{}floor"]=On.floor,this.functions["{}ceiling"]=On.ceiling,this.functions["{}round"]=On.round},qo.prototype.addFunction=function(x,z,ae){this.functions["{"+x+"}"+z]=ae},qo.getFunctionFromContext=function(x,z){var ae=an.resolveQName(x,z.namespaceResolver,z.contextNode,!1);if(null===ae[0])throw new Error("Cannot resolve QName "+name);return z.functionResolver.getFunction(ae[1],ae[0])},qo.prototype.getFunction=function(x,z){return this.functions["{"+z+"}"+x]},(vs.prototype=new Object).constructor=vs,vs.superclass=Object.prototype,vs.prototype.getNamespace=function(x,z){if("xml"==x)return jn.XML_NAMESPACE_URI;if("xmlns"==x)return jn.XMLNS_NAMESPACE_URI;for(9==z.nodeType?z=z.documentElement:2==z.nodeType?z=ni.getOwnerElement(z):1!=z.nodeType&&(z=z.parentNode);null!=z&&1==z.nodeType;){for(var ae=z.attributes,Oe=0;Oe<ae.length;Oe++){var Ve=ae.item(Oe),le=Ve.name||Ve.nodeName;if("xmlns"===le&&""===x||le==="xmlns:"+x)return String(Ve.value||Ve.nodeValue)}z=z.parentNode}return null};var On=new Object;On.last=function(x){if(1!=arguments.length)throw new Error("Function last expects ()");return new Sn(x.contextSize)},On.position=function(x){if(1!=arguments.length)throw new Error("Function position expects ()");return new Sn(x.contextPosition)},On.count=function(){var z,x=arguments[0];if(2!=arguments.length||!an.instance_of(z=arguments[1].evaluate(x),pn))throw new Error("Function count expects (node-set)");return new Sn(z.size)},On.id=function(){var z,x=arguments[0];if(2!=arguments.length)throw new Error("Function id expects (object)");z=arguments[1].evaluate(x);for(var ae=(z=an.instance_of(z,pn)?z.toArray().join(" "):z.stringValue()).split(/[\x0d\x0a\x09\x20]+/),Ve=new pn,le=9==x.contextNode.nodeType?x.contextNode:x.contextNode.ownerDocument,mn=0;mn<ae.length;mn++){var _i;null!=(_i=le.getElementById?le.getElementById(ae[mn]):an.getElementById(le,ae[mn]))&&Ve.add(_i)}return Ve},On.localName=function(x,z){var ae;if(1==arguments.length)ae=x.contextNode;else{if(2!=arguments.length)throw new Error("Function local-name expects (node-set?)");ae=z.evaluate(x).first()}return new zt(null==ae?"":ae.localName||ae.baseName||ae.target||ae.nodeName||"")},On.namespaceURI=function(){var z,x=arguments[0];if(1==arguments.length)z=x.contextNode;else{if(2!=arguments.length)throw new Error("Function namespace-uri expects (node-set?)");z=arguments[1].evaluate(x).first()}return new zt(null==z?"":z.namespaceURI)},On.name=function(){var z,x=arguments[0];if(1==arguments.length)z=x.contextNode;else{if(2!=arguments.length)throw new Error("Function name expects (node-set?)");z=arguments[1].evaluate(x).first()}return new zt(null==z?"":1==z.nodeType?z.nodeName:2==z.nodeType?z.name||z.nodeName:7===z.nodeType?z.target||z.nodeName:null==z.localName?"":z.localName)},On.string=function(){var x=arguments[0];if(1==arguments.length)return new zt(pn.prototype.stringForNode(x.contextNode));if(2==arguments.length)return arguments[1].evaluate(x).string();throw new Error("Function string expects (object?)")},On.concat=function(x){if(arguments.length<3)throw new Error("Function concat expects (string, string[, string]*)");for(var z="",ae=1;ae<arguments.length;ae++)z+=arguments[ae].evaluate(x).stringValue();return new zt(z)},On.startsWith=function(){var x=arguments[0];if(3!=arguments.length)throw new Error("Function startsWith expects (string, string)");var z=arguments[1].evaluate(x).stringValue(),ae=arguments[2].evaluate(x).stringValue();return new In(z.substring(0,ae.length)==ae)},On.contains=function(){var x=arguments[0];if(3!=arguments.length)throw new Error("Function contains expects (string, string)");var z=arguments[1].evaluate(x).stringValue(),ae=arguments[2].evaluate(x).stringValue();return new In(-1!==z.indexOf(ae))},On.substringBefore=function(){var x=arguments[0];if(3!=arguments.length)throw new Error("Function substring-before expects (string, string)");var z=arguments[1].evaluate(x).stringValue(),ae=arguments[2].evaluate(x).stringValue();return new zt(z.substring(0,z.indexOf(ae)))},On.substringAfter=function(){var x=arguments[0];if(3!=arguments.length)throw new Error("Function substring-after expects (string, string)");var z=arguments[1].evaluate(x).stringValue(),ae=arguments[2].evaluate(x).stringValue();if(0==ae.length)return new zt(z);var Oe=z.indexOf(ae);return new zt(-1==Oe?"":z.substring(Oe+ae.length))},On.substring=function(){var x=arguments[0];if(3!=arguments.length&&4!=arguments.length)throw new Error("Function substring expects (string, number, number?)");var z=arguments[1].evaluate(x).stringValue(),ae=Math.round(arguments[2].evaluate(x).numberValue())-1,Oe=4==arguments.length?ae+Math.round(arguments[3].evaluate(x).numberValue()):void 0;return new zt(z.substring(ae,Oe))},On.stringLength=function(){var z,x=arguments[0];if(1==arguments.length)z=pn.prototype.stringForNode(x.contextNode);else{if(2!=arguments.length)throw new Error("Function string-length expects (string?)");z=arguments[1].evaluate(x).stringValue()}return new Sn(z.length)},On.normalizeSpace=function(){var z,x=arguments[0];if(1==arguments.length)z=pn.prototype.stringForNode(x.contextNode);else{if(2!=arguments.length)throw new Error("Function normalize-space expects (string?)");z=arguments[1].evaluate(x).stringValue()}for(var ae=0,Oe=z.length-1;an.isSpace(z.charCodeAt(Oe));)Oe--;for(var Ve="";ae<=Oe&&an.isSpace(z.charCodeAt(ae));)ae++;for(;ae<=Oe;)if(an.isSpace(z.charCodeAt(ae)))for(Ve+=" ";ae<=Oe&&an.isSpace(z.charCodeAt(ae));)ae++;else Ve+=z.charAt(ae),ae++;return new zt(Ve)},On.translate=function(x,z,ae,Oe){if(4!=arguments.length)throw new Error("Function translate expects (string, string, string)");var Ve=z.evaluate(x).stringValue(),le=ae.evaluate(x).stringValue(),mn=Oe.evaluate(x).stringValue(),_i=p(function(un,Wn,Zr){return Wn in un||(un[Wn]=Zr>mn.length?"":mn[Zr]),un},{},le),Ii=Ft("",me(function(un){return un in _i?_i[un]:un},Ve));return new zt(Ii)},On.boolean_=function(){var x=arguments[0];if(2!=arguments.length)throw new Error("Function boolean expects (object)");return arguments[1].evaluate(x).bool()},On.not=function(x,z){if(2!=arguments.length)throw new Error("Function not expects (object)");return z.evaluate(x).bool().not()},On.true_=function(){if(1!=arguments.length)throw new Error("Function true expects ()");return In.true_},On.false_=function(){if(1!=arguments.length)throw new Error("Function false expects ()");return In.false_},On.lang=function(){var x=arguments[0];if(2!=arguments.length)throw new Error("Function lang expects (string)");for(var z,ae=x.contextNode;null!=ae&&9!=ae.nodeType;ae=ae.parentNode){var Oe=ae.getAttributeNS(jn.XML_NAMESPACE_URI,"lang");if(null!=Oe){z=String(Oe);break}}if(null==z)return In.false_;var Ve=arguments[1].evaluate(x).stringValue();return new In(z.substring(0,Ve.length)==Ve&&(z.length==Ve.length||"-"==z.charAt(Ve.length)))},On.number=function(){var x=arguments[0];if(1!=arguments.length&&2!=arguments.length)throw new Error("Function number expects (object?)");return 1==arguments.length?new Sn(pn.prototype.stringForNode(x.contextNode)):arguments[1].evaluate(x).number()},On.sum=function(){var z,x=arguments[0];if(2!=arguments.length||!an.instance_of(z=arguments[1].evaluate(x),pn))throw new Error("Function sum expects (node-set)");z=z.toUnsortedArray();for(var ae=0,Oe=0;Oe<z.length;Oe++)ae+=new Sn(pn.prototype.stringForNode(z[Oe])).numberValue();return new Sn(ae)},On.floor=function(){var x=arguments[0];if(2!=arguments.length)throw new Error("Function floor expects (number)");return new Sn(Math.floor(arguments[1].evaluate(x).numberValue()))},On.ceiling=function(){var x=arguments[0];if(2!=arguments.length)throw new Error("Function ceiling expects (number)");return new Sn(Math.ceil(arguments[1].evaluate(x).numberValue()))},On.round=function(){var x=arguments[0];if(2!=arguments.length)throw new Error("Function round expects (number)");return new Sn(Math.round(arguments[1].evaluate(x).numberValue()))};var an=new Object;an.isAttribute=function(x){return x&&(2===x.nodeType||x.ownerElement)},an.splitQName=function(x){var z=x.indexOf(":");return-1==z?[null,x]:[x.substring(0,z),x.substring(z+1)]},an.resolveQName=function(x,z,ae,Oe){var Ve=an.splitQName(x);return null!=Ve[0]?Ve[0]=z.getNamespace(Ve[0],ae):Oe?(Ve[0]=z.getNamespace("",ae),null==Ve[0]&&(Ve[0]="")):Ve[0]="",Ve},an.isSpace=function(x){return 9==x||13==x||10==x||32==x},an.isLetter=function(x){return x>=65&&x<=90||x>=97&&x<=122||x>=192&&x<=214||x>=216&&x<=246||x>=248&&x<=255||x>=256&&x<=305||x>=308&&x<=318||x>=321&&x<=328||x>=330&&x<=382||x>=384&&x<=451||x>=461&&x<=496||x>=500&&x<=501||x>=506&&x<=535||x>=592&&x<=680||x>=699&&x<=705||902==x||x>=904&&x<=906||908==x||x>=910&&x<=929||x>=931&&x<=974||x>=976&&x<=982||986==x||988==x||990==x||992==x||x>=994&&x<=1011||x>=1025&&x<=1036||x>=1038&&x<=1103||x>=1105&&x<=1116||x>=1118&&x<=1153||x>=1168&&x<=1220||x>=1223&&x<=1224||x>=1227&&x<=1228||x>=1232&&x<=1259||x>=1262&&x<=1269||x>=1272&&x<=1273||x>=1329&&x<=1366||1369==x||x>=1377&&x<=1414||x>=1488&&x<=1514||x>=1520&&x<=1522||x>=1569&&x<=1594||x>=1601&&x<=1610||x>=1649&&x<=1719||x>=1722&&x<=1726||x>=1728&&x<=1742||x>=1744&&x<=1747||1749==x||x>=1765&&x<=1766||x>=2309&&x<=2361||2365==x||x>=2392&&x<=2401||x>=2437&&x<=2444||x>=2447&&x<=2448||x>=2451&&x<=2472||x>=2474&&x<=2480||2482==x||x>=2486&&x<=2489||x>=2524&&x<=2525||x>=2527&&x<=2529||x>=2544&&x<=2545||x>=2565&&x<=2570||x>=2575&&x<=2576||x>=2579&&x<=2600||x>=2602&&x<=2608||x>=2610&&x<=2611||x>=2613&&x<=2614||x>=2616&&x<=2617||x>=2649&&x<=2652||2654==x||x>=2674&&x<=2676||x>=2693&&x<=2699||2701==x||x>=2703&&x<=2705||x>=2707&&x<=2728||x>=2730&&x<=2736||x>=2738&&x<=2739||x>=2741&&x<=2745||2749==x||2784==x||x>=2821&&x<=2828||x>=2831&&x<=2832||x>=2835&&x<=2856||x>=2858&&x<=2864||x>=2866&&x<=2867||x>=2870&&x<=2873||2877==x||x>=2908&&x<=2909||x>=2911&&x<=2913||x>=2949&&x<=2954||x>=2958&&x<=2960||x>=2962&&x<=2965||x>=2969&&x<=2970||2972==x||x>=2974&&x<=2975||x>=2979&&x<=2980||x>=2984&&x<=2986||x>=2990&&x<=2997||x>=2999&&x<=3001||x>=3077&&x<=3084||x>=3086&&x<=3088||x>=3090&&x<=3112||x>=3114&&x<=3123||x>=3125&&x<=3129||x>=3168&&x<=3169||x>=3205&&x<=3212||x>=3214&&x<=3216||x>=3218&&x<=3240||x>=3242&&x<=3251||x>=3253&&x<=3257||3294==x||x>=3296&&x<=3297||x>=3333&&x<=3340||x>=3342&&x<=3344||x>=3346&&x<=3368||x>=3370&&x<=3385||x>=3424&&x<=3425||x>=3585&&x<=3630||3632==x||x>=3634&&x<=3635||x>=3648&&x<=3653||x>=3713&&x<=3714||3716==x||x>=3719&&x<=3720||3722==x||3725==x||x>=3732&&x<=3735||x>=3737&&x<=3743||x>=3745&&x<=3747||3749==x||3751==x||x>=3754&&x<=3755||x>=3757&&x<=3758||3760==x||x>=3762&&x<=3763||3773==x||x>=3776&&x<=3780||x>=3904&&x<=3911||x>=3913&&x<=3945||x>=4256&&x<=4293||x>=4304&&x<=4342||4352==x||x>=4354&&x<=4355||x>=4357&&x<=4359||4361==x||x>=4363&&x<=4364||x>=4366&&x<=4370||4412==x||4414==x||4416==x||4428==x||4430==x||4432==x||x>=4436&&x<=4437||4441==x||x>=4447&&x<=4449||4451==x||4453==x||4455==x||4457==x||x>=4461&&x<=4462||x>=4466&&x<=4467||4469==x||4510==x||4520==x||4523==x||x>=4526&&x<=4527||x>=4535&&x<=4536||4538==x||x>=4540&&x<=4546||4587==x||4592==x||4601==x||x>=7680&&x<=7835||x>=7840&&x<=7929||x>=7936&&x<=7957||x>=7960&&x<=7965||x>=7968&&x<=8005||x>=8008&&x<=8013||x>=8016&&x<=8023||8025==x||8027==x||8029==x||x>=8031&&x<=8061||x>=8064&&x<=8116||x>=8118&&x<=8124||8126==x||x>=8130&&x<=8132||x>=8134&&x<=8140||x>=8144&&x<=8147||x>=8150&&x<=8155||x>=8160&&x<=8172||x>=8178&&x<=8180||x>=8182&&x<=8188||8486==x||x>=8490&&x<=8491||8494==x||x>=8576&&x<=8578||x>=12353&&x<=12436||x>=12449&&x<=12538||x>=12549&&x<=12588||x>=44032&&x<=55203||x>=19968&&x<=40869||12295==x||x>=12321&&x<=12329},an.isNCNameChar=function(x){return x>=48&&x<=57||x>=1632&&x<=1641||x>=1776&&x<=1785||x>=2406&&x<=2415||x>=2534&&x<=2543||x>=2662&&x<=2671||x>=2790&&x<=2799||x>=2918&&x<=2927||x>=3047&&x<=3055||x>=3174&&x<=3183||x>=3302&&x<=3311||x>=3430&&x<=3439||x>=3664&&x<=3673||x>=3792&&x<=3801||x>=3872&&x<=3881||46==x||45==x||95==x||an.isLetter(x)||x>=768&&x<=837||x>=864&&x<=865||x>=1155&&x<=1158||x>=1425&&x<=1441||x>=1443&&x<=1465||x>=1467&&x<=1469||1471==x||x>=1473&&x<=1474||1476==x||x>=1611&&x<=1618||1648==x||x>=1750&&x<=1756||x>=1757&&x<=1759||x>=1760&&x<=1764||x>=1767&&x<=1768||x>=1770&&x<=1773||x>=2305&&x<=2307||2364==x||x>=2366&&x<=2380||2381==x||x>=2385&&x<=2388||x>=2402&&x<=2403||x>=2433&&x<=2435||2492==x||2494==x||2495==x||x>=2496&&x<=2500||x>=2503&&x<=2504||x>=2507&&x<=2509||2519==x||x>=2530&&x<=2531||2562==x||2620==x||2622==x||2623==x||x>=2624&&x<=2626||x>=2631&&x<=2632||x>=2635&&x<=2637||x>=2672&&x<=2673||x>=2689&&x<=2691||2748==x||x>=2750&&x<=2757||x>=2759&&x<=2761||x>=2763&&x<=2765||x>=2817&&x<=2819||2876==x||x>=2878&&x<=2883||x>=2887&&x<=2888||x>=2891&&x<=2893||x>=2902&&x<=2903||x>=2946&&x<=2947||x>=3006&&x<=3010||x>=3014&&x<=3016||x>=3018&&x<=3021||3031==x||x>=3073&&x<=3075||x>=3134&&x<=3140||x>=3142&&x<=3144||x>=3146&&x<=3149||x>=3157&&x<=3158||x>=3202&&x<=3203||x>=3262&&x<=3268||x>=3270&&x<=3272||x>=3274&&x<=3277||x>=3285&&x<=3286||x>=3330&&x<=3331||x>=3390&&x<=3395||x>=3398&&x<=3400||x>=3402&&x<=3405||3415==x||3633==x||x>=3636&&x<=3642||x>=3655&&x<=3662||3761==x||x>=3764&&x<=3769||x>=3771&&x<=3772||x>=3784&&x<=3789||x>=3864&&x<=3865||3893==x||3895==x||3897==x||3902==x||3903==x||x>=3953&&x<=3972||x>=3974&&x<=3979||x>=3984&&x<=3989||3991==x||x>=3993&&x<=4013||x>=4017&&x<=4023||4025==x||x>=8400&&x<=8412||8417==x||x>=12330&&x<=12335||12441==x||12442==x||183==x||720==x||721==x||903==x||1600==x||3654==x||3782==x||12293==x||x>=12337&&x<=12341||x>=12445&&x<=12446||x>=12540&&x<=12542},an.coalesceText=function(x){for(var z=x.firstChild;null!=z;z=z.nextSibling)if(3==z.nodeType||4==z.nodeType){var ae=z.nodeValue,Oe=z;for(z=z.nextSibling;null!=z&&(3==z.nodeType||4==z.nodeType);){ae+=z.nodeValue;var Ve=z;z=z.nextSibling,Ve.parentNode.removeChild(Ve)}if(4==Oe.nodeType){var le=Oe.parentNode;if(null==Oe.nextSibling)le.removeChild(Oe),le.appendChild(le.ownerDocument.createTextNode(ae));else{var mn=Oe.nextSibling;le.removeChild(Oe),le.insertBefore(le.ownerDocument.createTextNode(ae),mn)}}else Oe.nodeValue=ae;if(null==z)break}else 1==z.nodeType&&an.coalesceText(z)},an.instance_of=function(x,z){for(;null!=x;){if(x.constructor===z)return!0;if(x===Object)return!1;x=x.constructor.superclass}return!1},an.getElementById=function(x,z){if(1==x.nodeType&&(x.getAttribute("id")==z||x.getAttributeNS(null,"id")==z))return x;for(var ae=x.firstChild;null!=ae;ae=ae.nextSibling){var Oe=an.getElementById(ae,z);if(null!=Oe)return Oe}return null};var Wo=function(){function z(ae,Oe,Ve){var le=Error.call(this,function x(ae,Oe){var Ve=Oe?": "+Oe.toString():"";switch(ae){case z.INVALID_EXPRESSION_ERR:return"Invalid expression"+Ve;case z.TYPE_ERR:return"Type error"+Ve}return null}(ae,Oe)||Ve);return le.code=ae,le.exception=Oe,le}return(z.prototype=Object.create(Error.prototype)).constructor=z,z.superclass=Error,z.prototype.toString=function(){return this.message},z.fromMessage=function(ae,Oe){return new z(null,Oe,ae)},z.INVALID_EXPRESSION_ERR=51,z.TYPE_ERR=52,z}();function Xr(x,z,ae){this.xpath=ae.parse(x),this.context=new yo,this.context.namespaceResolver=new la(z)}function la(x){this.xpathNSResolver=x}function ca(x){this.node=x,this.namespaceResolver=new vs}function hi(x,z){switch(z==hi.ANY_TYPE&&(x.constructor===zt?z=hi.STRING_TYPE:x.constructor===Sn?z=hi.NUMBER_TYPE:x.constructor===In?z=hi.BOOLEAN_TYPE:x.constructor===pn&&(z=hi.UNORDERED_NODE_ITERATOR_TYPE)),this.resultType=z,z){case hi.NUMBER_TYPE:return void(this.numberValue=x.numberValue());case hi.STRING_TYPE:return void(this.stringValue=x.stringValue());case hi.BOOLEAN_TYPE:return void(this.booleanValue=x.booleanValue());case hi.ANY_UNORDERED_NODE_TYPE:case hi.FIRST_ORDERED_NODE_TYPE:if(x.constructor===pn)return void(this.singleNodeValue=x.first());break;case hi.UNORDERED_NODE_ITERATOR_TYPE:case hi.ORDERED_NODE_ITERATOR_TYPE:if(x.constructor===pn)return this.invalidIteratorState=!1,this.nodes=x.toArray(),void(this.iteratorIndex=0);break;case hi.UNORDERED_NODE_SNAPSHOT_TYPE:case hi.ORDERED_NODE_SNAPSHOT_TYPE:if(x.constructor===pn)return this.nodes=x.toArray(),void(this.snapshotLength=this.nodes.length)}throw new Wo(Wo.TYPE_ERR)}function Qa(x,z){x.createExpression=function(ae,Oe){try{return new Xr(ae,Oe,z)}catch(Ve){throw new Wo(Wo.INVALID_EXPRESSION_ERR,Ve)}},x.createNSResolver=function(ae){return new ca(ae)},x.evaluate=function(ae,Oe,Ve,le,mn){if(le<0||le>9)throw{code:0,toString:function(){return"Request type not supported"}};return x.createExpression(ae,Ve,z).evaluate(Oe,le,mn)}}(Xr.prototype={}).constructor=Xr,Xr.superclass=Object.prototype,Xr.getOwnerDocument=function(x){return 9===x.nodeType?x:x.ownerDocument},Xr.detectHtmlDom=function(x){if(!x)return!1;var z=Xr.getOwnerDocument(x);try{return z.implementation.hasFeature("HTML","2.0")}catch(ae){return!0}},Xr.prototype.evaluate=function(x,z,ae){return this.context.expressionContextNode=x,this.context.caseInsensitive=Xr.detectHtmlDom(x),new hi(this.xpath.evaluate(this.context),z)},(la.prototype={}).constructor=la,la.superclass=Object.prototype,la.prototype.getNamespace=function(x,z){return null==this.xpathNSResolver?null:this.xpathNSResolver.lookupNamespaceURI(x)},(ca.prototype={}).constructor=ca,ca.superclass=Object.prototype,ca.prototype.lookupNamespaceURI=function(x){return this.namespaceResolver.getNamespace(x,this.node)},(hi.prototype={}).constructor=hi,hi.superclass=Object.prototype,hi.prototype.iterateNext=function(){if(this.resultType!=hi.UNORDERED_NODE_ITERATOR_TYPE&&this.resultType!=hi.ORDERED_NODE_ITERATOR_TYPE)throw new Wo(Wo.TYPE_ERR);return this.nodes[this.iteratorIndex++]},hi.prototype.snapshotItem=function(x){if(this.resultType!=hi.UNORDERED_NODE_SNAPSHOT_TYPE&&this.resultType!=hi.ORDERED_NODE_SNAPSHOT_TYPE)throw new Wo(Wo.TYPE_ERR);return this.nodes[x]},hi.ANY_TYPE=0,hi.NUMBER_TYPE=1,hi.STRING_TYPE=2,hi.BOOLEAN_TYPE=3,hi.UNORDERED_NODE_ITERATOR_TYPE=4,hi.ORDERED_NODE_ITERATOR_TYPE=5,hi.UNORDERED_NODE_SNAPSHOT_TYPE=6,hi.ORDERED_NODE_SNAPSHOT_TYPE=7,hi.ANY_UNORDERED_NODE_TYPE=8,hi.FIRST_ORDERED_NODE_TYPE=9;try{var _c=!0;try{document.implementation&&document.implementation.hasFeature&&document.implementation.hasFeature("XPath",null)&&(_c=!1)}catch(x){}_c&&Qa(document,new Ne)}catch(x){}Qa(Fe,new Ne),function(){var x=new Ne,z=new vs,ae=new qo,Oe=new ys;function Ve(de){return{getNamespace:function(be,ke){return de(be,ke)||z.getNamespace(be,ke)}}}function Ii(de){if(null==de||de instanceof zt||de instanceof In||de instanceof Sn||de instanceof pn)return de;switch(typeof de){case"string":return new zt(de);case"boolean":return new In(de);case"number":return new Sn(de)}var be=new pn;return be.addArray([].concat(de)),be}function Wn(de){return{getFunction:function(be,ke){var ht=de(be,ke);return ht?function un(de){return function(be){var ke=Array.prototype.slice.call(arguments,1).map(function(Vt){return Vt.evaluate(be)});return Ii(de.apply(this,[].concat(be,ke)))}}(ht):ae.getFunction(be,ke)}}}function re(de){return{getVariable:function(be,ke){return Ii(de(be,ke))}}}function q(de,be,ke){de in ke&&(be[de]=ke[de])}function oe(de){var be=new yo;return de?(be.namespaceResolver=function _i(de){return de&&"function"==typeof de.getNamespace?function le(de){return Ve(de.getNamespace.bind(de))}(de):"function"==typeof de?Ve(de):"object"==typeof de?function mn(de){return Ve(function(be){return de[be]})}(de):z}(de.namespaces),be.functionResolver=function li(de){return de&&"function"==typeof de.getFunction?function Zr(de){return Wn(de.getFunction.bind(de))}(de):"function"==typeof de?Wn(de):"object"==typeof de?function Xo(de){return Wn(function(be){return de[be]})}(de):ae}(de.functions),be.variableResolver=function U(de){if(de){if("function"==typeof de.getVariable)return re(de.getVariable.bind(de));if("function"==typeof de)return re(de);if("object"==typeof de)return re(function(be){return de[be]})}return Oe}(de.variables),be.expressionContextNode=de.node,q("allowAnyNamespaceForNoPrefix",be,de),q("isHtml",be,de)):be.namespaceResolver=z,be}var Te={evaluate:function(de){return function fe(de,be){var ke=oe(be);return de.evaluate(ke)}(this.expression,de)},evaluateNumber:function(de){return this.evaluate(de).numberValue()},evaluateString:function(de){return this.evaluate(de).stringValue()},evaluateBoolean:function(de){return this.evaluate(de).booleanValue()},evaluateNodeSet:function(de){return this.evaluate(de).nodeset()},select:function(de){return this.evaluateNodeSet(de).toArray()},select1:function(de){return this.select(de)[0]}};Fe.parse=function je(de){var be=x.parse(de);return Object.create(Te,{expression:{value:be}})}}(),dn(Fe,{XPath:jn,XPathParser:Ne,XPathResult:hi,Step:Tt,PathExpr:ni,NodeTest:Jt,LocationPath:di,OrOperation:ee,AndOperation:nt,BarOperation:qr,EqualsOperation:at,NotEqualOperation:pe,LessThanOperation:et,GreaterThanOperation:Ke,LessThanOrEqualOperation:sn,GreaterThanOrEqualOperation:wn,PlusOperation:Un,MinusOperation:Fi,MultiplyOperation:en,DivOperation:ti,ModOperation:nr,UnaryMinusOperation:Se,FunctionCall:Ni,VariableReference:Hn,XPathContext:yo,XNodeSet:pn,XBoolean:In,XString:zt,XNumber:Sn,NamespaceResolver:vs,FunctionResolver:qo,VariableResolver:ys,Utilities:an}),Fe.select=function(x,z,ae){return Fe.selectWithResolver(x,z,null,ae)},Fe.useNamespaces=function(x){var z={mappings:x||{},lookupNamespaceURI:function(ae){return this.mappings[ae]}};return function(ae,Oe,Ve){return Fe.selectWithResolver(ae,Oe,z,Ve)}},Fe.selectWithResolver=function(x,z,ae,Oe){var mn=new Xr(x,ae,new Ne).evaluate(z,hi.ANY_TYPE,null);return mn.resultType==hi.STRING_TYPE?mn=mn.stringValue:mn.resultType==hi.NUMBER_TYPE?mn=mn.numberValue:mn.resultType==hi.BOOLEAN_TYPE?mn=mn.booleanValue:(mn=mn.nodes,Oe&&(mn=mn[0])),mn},Fe.select1=function(x,z){return Fe.select(x,z,!0)}}(Ei)}},rn=>{rn(rn.s=583)}]);